<!DOCTYPE html><html><head><meta charset="utf-8" /><title>[Unity] Mesh Cutのサンプルを読む（メッシュの切断） - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/edo_m18/items/31961cd19fd19e09b675" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="OG43XgFHvdoB0BxsMahVEvj9Ti40uwzvWfyNVtsZdt9lj6GKdjy5CFdQcVdWkafCsM/7oCpYgj44aZJy5e0ykw==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@edo_m18" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="[Unity] Mesh Cutのサンプルを読む（メッシュの切断） - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XMVZ1YVhSNVhTQk5aWE5vSUVOMWRPT0JydU9DdGVPRHMtT0RsLU9EcS1PQ2t1aXFyZU9DZ08tOGlPT0RvZU9EZy1PQ3QtT0RwZU9CcnVXSWgtYVdyZS04aVEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MzY0ZmE4NDQ1NjJmMzc1M2MxM2ExMWRjMGY3MmIwZjc&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR1ZrYjE5dE1UZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTJiZGQ0YjdlNjEwYjJjMzBhYmZmMDI1ZGRiZjYxODZm&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=6e3a60d9a7fa5ee827f937cc7521918d"><meta property="og:description" content="

概要

Unity以外でもそうですが、メッシュは頂点の塊です。
そしてそれらはTriangleやそれらを結ぶIndexで構成されています。
つまり、勝手に順番を変えてしまうと頂点の情報はぐちゃぐちゃになってしまい、ちゃんとしたオブ..."><meta content="https://qiita.com/edo_m18/items/31961cd19fd19e09b675" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Unity,3D" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-fd317a3d-3cf6-480d-b282-dd14640abd74"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fedo_m18%2Fitems%2F31961cd19fd19e09b675">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fedo_m18%2Fitems%2F31961cd19fd19e09b675">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-fd317a3d-3cf6-480d-b282-dd14640abd74">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2016-10-15T11:59:28.000+09:00","dateModified":"2019-11-19T20:04:19.000+09:00","headline":"[Unity] Mesh Cutのサンプルを読む（メッシュの切断）","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XMVZ1YVhSNVhTQk5aWE5vSUVOMWRPT0JydU9DdGVPRHMtT0RsLU9EcS1PQ2t1aXFyZU9DZ08tOGlPT0RvZU9EZy1PQ3QtT0RwZU9CcnVXSWgtYVdyZS04aVEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MzY0ZmE4NDQ1NjJmMzc1M2MxM2ExMWRjMGY3MmIwZjc\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR1ZrYjE5dE1UZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTJiZGQ0YjdlNjEwYjJjMzBhYmZmMDI1ZGRiZjYxODZm\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=6e3a60d9a7fa5ee827f937cc7521918d","mainEntityOfPage":"https://qiita.com/edo_m18/items/31961cd19fd19e09b675","author":{"@type":"Person","address":"Tokyo","email":null,"identifier":"edo_m18","name":"edo_m18","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F5616%2Fprofile-images%2F1600303663?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1ce546b4f5f5fa68735e8f95d42d50f1","url":"https://qiita.com/edo_m18","description":"現在はUnity ARエンジニア。\r\n主にARのコンテンツ制作をしています。\r\n\r\n最近は機械学習にも興味が出て勉強中です。\r\n\r\nUnityに関するブログは別で書いています↓\r\nhttps://edom18.hateblo.jp/","memberOf":[{"@type":"Organization","address":"オンライン@Slack","legalName":"Unityゲーム開発者ギルド","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/5e3ba3bb442371003e6b5d4618ef627b9b478357/original.jpg?1570216541","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","identifier":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。"},{"@type":"Organization","address":"東京都渋谷区松濤1-29-11 松濤1丁目ビルB棟 2F","legalName":"株式会社 MESON","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/2088feed06f7938968dfdb4eb83d6a62032439ed/original.jpg?1596592578","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f1bcbb928e3f5d18655679c6ff801fd0055b80fe/original.jpg?1596592578","identifier":"meson","description":"MESON is an Experience Augmentation Company.\r\nMESONは、AR時代のユースケースとUXをつくる会社です。"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita&amp;utm_medium=header-banner">運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"edo_m18","type":"items","id":"31961cd19fd19e09b675"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"edo_m18","type":"items","id":"31961cd19fd19e09b675"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"edo_m18","type":"items","id":"31961cd19fd19e09b675"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/edo_m18/items/31961cd19fd19e09b675","location":"/edo_m18/items/31961cd19fd19e09b675","scheme":"https","host":"qiita.com","port":null,"pathname":"/edo_m18/items/31961cd19fd19e09b675","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"3hQsl/9w8XDFA3h8jDiN42XVOwQSzzTAvYldVK25M6WD9bpDiAv1opODFUfrAX8zLeeOigwsuhHcHEJwk0136Q==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-7108b763-a505-444a-8ae9-3763da5a75f3"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/edo_m18/items/31961cd19fd19e09b675/likers" class="css-1iupg5d">142</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">124</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/31961cd19fd19e09b675/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/edo_m18/items/31961cd19fd19e09b675/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/edo_m18/items/31961cd19fd19e09b675/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/edo_m18/items/31961cd19fd19e09b675/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/edo_m18/items/31961cd19fd19e09b675.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/edo_m18"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/5616/profile-images/1600303663" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/edo_m18" class="css-10ougpm">@<!-- -->edo_m18</a><div class="css-1ay9vb9"><span><meta content="2016-10-15T02:59:28Z"/><time dateTime="2019-11-19T11:04:19Z" class="css-m19uds">updated at 2019-11-19</time></span></div></div></div></div></div><h1 class="css-cgzq40">[Unity] Mesh Cutのサンプルを読む（メッシュの切断）</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/3d" class="css-4czcte">3D</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h2>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>

<p>Unity以外でもそうですが、メッシュは頂点の塊です。<br>
そしてそれらはTriangleやそれらを結ぶIndexで構成されています。<br>
つまり、勝手に順番を変えてしまうと頂点の情報はぐちゃぐちゃになってしまい、ちゃんとしたオブジェクトとして表示することはできません。<br>
そのため、メッシュを切断して別のオブジェクトに分けようとすると、それなりに頂点郡を計算してポリゴンを縫い合わせてやる必要があります。</p>

<p>今回はそんなメッシュのカットを行うサンプルを公開してくれている人がいたので、そのサンプルを読んだメモを書いていきます。</p>

<p>実際に実行してみたのが以下のものです↓<br>
<a href="https://camo.qiitausercontent.com/bc51fb900d56ecd456eb592ad1558292c0c74039/68747470733a2f2f692e6779617a6f2e636f6d2f64343233663964616233613239326435373066376266306264303164643461302e676966" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.gyazo.com%2Fd423f9dab3a292d570f7bf0bd01dd4a0.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=960ac4a8890ff9b4c11b796cc63487c5" alt="" data-canonical-src="https://i.gyazo.com/d423f9dab3a292d570f7bf0bd01dd4a0.gif" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.gyazo.com%2Fd423f9dab3a292d570f7bf0bd01dd4a0.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=103105bdc859453664ddf0ba596a1217 1x" loading="lazy"></a></p>

<p>左側の3本のラインがカット面を示していて、その平面できれいに切断されているのが分かるかと思います。<br>
しかも、しっかりと切断面に別のマテリアルが割り当てられているのにも注目です。</p>

<h2>
<span id="大まかな流れ" class="fragment"></span><a href="#%E5%A4%A7%E3%81%BE%E3%81%8B%E3%81%AA%E6%B5%81%E3%82%8C"><i class="fa fa-link"></i></a>大まかな流れ</h2>

<p>まずは大まかな流れから説明します。<br>
具体的になにをしているかを見るよりも、切断に必要な処理がなんなのか、という視点で見てもらうといいかと思います。<br>
全体像を把握した上でコードを読んでいくと処理内容が推測しやすくなり、理解を促すはずです。</p>

<ol>
<li>切断する平面を定義する</li>
<li>切断するオブジェクトを選択する</li>
<li>選択されたメッシュの全頂点に対し、平面の左側か右側かを計算する<br>
<em>※ 評価する単位はポリゴン（トライアングル）単位で行う</em>
</li>
<li>(3)の際、3頂点すべてが平面の左か右のどちらかに寄っている場合は切断対象外なので、左側か右側かだけを判別して適切に頂点を保持する<br>
<em>※ 最終的にふたつのオブジェクトに分割するため、左右の頂点情報などを保持するオブジェクトを用意してそれに格納する</em>
</li>
<li>(3)の際、3頂点が平面の左右にバラけた場合に切断処理を実行する</li>
<li>切断処理はまず、3頂点がそれぞれ平面の左右どちらにあるかを判断し、(3)同様に適切に振り分ける</li>
<li>その後、切断平面と重なる2頂点を新しい頂点として計算する（※1）</li>
<li>すべての頂点に対して振り分けおよび頂点の生成が終わったら、(7)で生成した新頂点すべてに対しペアを算出しポリゴンを形成する</li>
<li>最後に、生成したポリゴンを用いて切断面を定義し、新しいマテリアルを適用する</li>
</ol>

<p>※1 ... 三角形（ポリゴン）を線（平面）で分断するとどこをどう切っても必ず2辺と交わる。つまり<strong>新しい頂点は2つ</strong>作られる。</p>

<p><a href="https://camo.qiitausercontent.com/afd1f1ac281adbd785913174bd2ebe0c41ef98b8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f353631362f62323130656330342d633965632d333364372d323433392d3865636635336635643338342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2Fb210ec04-c9ec-33d7-2439-8ecf53f5d384.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4daf857adeb2d43772e4d31bd6af215e" alt="cut-triangles.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/5616/b210ec04-c9ec-33d7-2439-8ecf53f5d384.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2Fb210ec04-c9ec-33d7-2439-8ecf53f5d384.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=aa90eeff2c9be2e9bd98c752cada55de 1x" loading="lazy"></a><br>
<em>どれかの辺に平行でない限り、必ず2辺と交わる</em></p>

<h2>
<span id="実装と考え方" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E3%81%A8%E8%80%83%E3%81%88%E6%96%B9"><i class="fa fa-link"></i></a>実装と考え方</h2>

<h3>
<span id="頂点が平面のどちら側にあるかを調べる" class="fragment"></span><a href="#%E9%A0%82%E7%82%B9%E3%81%8C%E5%B9%B3%E9%9D%A2%E3%81%AE%E3%81%A9%E3%81%A1%E3%82%89%E5%81%B4%E3%81%AB%E3%81%82%E3%82%8B%E3%81%8B%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B"><i class="fa fa-link"></i></a>頂点が平面のどちら側にあるかを調べる</h3>

<p>頂点が平面のどちら側にあるかは内積を使って簡単に調べることができます。<br>
具体的には、点 $p$ と、平面の位置 $p_0$、および面の法線 $n$ を使って、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>(p - p_0) \cdot n &lt; 0 ... 裏  \\
(p - p_0) \cdot n &gt; 0 ... 表  \\
(p - p_0) \cdot n = 0 ... 平面上
</code></pre></div></div>

<p>として計算することができます。<br>
<em>ちなみに <code>UnityEngine.Plane</code> クラスにはこうした平面に対する処理を簡単にしてくれるメソッドが多数あるので、実際はそちらを利用したほうが手軽です。</em></p>

<p>サンプルのコードを抜粋すると以下になります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">sides</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="n">blade</span><span class="p">.</span><span class="nf">GetSide</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">p1</span><span class="p">]);</span>
<span class="n">sides</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="n">blade</span><span class="p">.</span><span class="nf">GetSide</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">p2</span><span class="p">]);</span>
<span class="n">sides</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">=</span> <span class="n">blade</span><span class="p">.</span><span class="nf">GetSide</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">p3</span><span class="p">]);</span>
</code></pre></div></div>

<p>これは、切断対象となったメッシュの、計算中の頂点が平面のどちらにあるかを <code>bool</code> で取得している部分です。</p>

<h3>
<span id="平面に分断された点を求める" class="fragment"></span><a href="#%E5%B9%B3%E9%9D%A2%E3%81%AB%E5%88%86%E6%96%AD%E3%81%95%E3%82%8C%E3%81%9F%E7%82%B9%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>平面に分断された点を求める</h3>

<p>さて、上記の平面の表裏の判定により、大部分の頂点は左右に適切に振り分けることができます。<br>
残るは、平面と交差しているポリゴンの各辺を分離して、新しい頂点を得ることができれば、ひとまずすべての頂点を左右に振り分け、かつ切断面に使える頂点郡を得ることができます。</p>

<p>ということで、辺を分断する頂点の求め方です。</p>

<p>色々文章で説明する前に、下の図を見てもらうと分かりやすいかと思います。</p>

<p><a href="https://camo.qiitausercontent.com/a1a61dc8de3ed451eee6e8ae7093b404cc4f6c5d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f353631362f61386665613133662d613365312d643965342d343534362d6132656661383061613666342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2Fa8fea13f-a3e1-d9e4-4546-a2efa80aa6f4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5fd29b2b6b44db83ca2b96cf6c0ab84c" alt="平面分割.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/5616/a8fea13f-a3e1-d9e4-4546-a2efa80aa6f4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2Fa8fea13f-a3e1-d9e4-4546-a2efa80aa6f4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b650b1093a82e8cdf3c440af6bb86bc0 1x" loading="lazy"></a></p>

<p>グラデーションがかかっている平面が切断面です。<br>
この平面により、頂点が左右どちらかに分断されます。</p>

<p>図では $p_0$ と $p_1$ が平面の左側、$p_2$ が平面の右側、そして黄色い点が分断された頂点になります。</p>

<h4>
<span id="平面方向への距離を算出する" class="fragment"></span><a href="#%E5%B9%B3%E9%9D%A2%E6%96%B9%E5%90%91%E3%81%B8%E3%81%AE%E8%B7%9D%E9%9B%A2%E3%82%92%E7%AE%97%E5%87%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>平面方向への距離を算出する</h4>

<p>点の割り出し方は、$p_0$ および $p_1$ から、$p_2$ 方向への距離を算出します。（$\vec{p_2 p_0}$ と $\vec{p_2 p_1}$）<br>
（平面への距離の算出は、以前書いた「<a href="http://qiita.com/edo_m18/items/c8808f318f5abfa8af1e" id="reference-901f38ced984ee8183bb">[Unity] 任意の無限遠の平面とベクトルとの交点を求める</a>」を見てもらうと分かるかと思います）</p>

<p>が、上の方でも書きましたが、<code>UnityEngine.Plane</code> クラスにはこの距離を算出するのに適したメソッドがあります。<br>
参考にしたコードでもそれを利用して計算を行っています。<br>
その部分だけを抜粋すると、</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">blade</span><span class="p">.</span><span class="nf">Raycast</span><span class="p">(</span><span class="k">new</span> <span class="nf">Ray</span><span class="p">(</span><span class="n">leftPoints</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="p">(</span><span class="n">rightPoints</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">-</span> <span class="n">leftPoints</span><span class="p">[</span><span class="m">0</span><span class="p">]).</span><span class="n">normalized</span><span class="p">),</span> <span class="k">out</span> <span class="n">distance</span><span class="p">);</span>
</code></pre></div></div>

<p>ここで <code>blade</code> は切断面を表す <code>UnityEngine.Plane</code> クラスのインスタンスです。<br>
これに <code>Raycast</code> メソッドがあり、レイを飛ばしてやることで、任意の点と方向を元に、平面への距離を算出することができます。<br>
（上の例では <code>out distance</code> に距離が入り、メソッド自体は、平面とレイが交差する場合に <code>true</code> を返します）</p>

<h4>
<span id="辺と距離から切断頂点を求める" class="fragment"></span><a href="#%E8%BE%BA%E3%81%A8%E8%B7%9D%E9%9B%A2%E3%81%8B%E3%82%89%E5%88%87%E6%96%AD%E9%A0%82%E7%82%B9%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>辺と距離から切断頂点を求める</h4>

<p><code>Raycast</code> を用いて切断頂点までの「距離」を求めることができました。<br>
ただこれはスカラー値で、あくまで「距離」しか分かりません。<br>
しかし、辺の長さとの比率と各頂点情報から平面上の頂点（つまり分断点）を求めることができます。</p>

<p>具体的には</p>

<ol>
<li>辺の長さを計算する</li>
<li>「頂点までの距離 / 辺の長さ」＝ 比率</li>
<li>辺の両端の点の間を(2)の比率で補完する</li>
</ol>

<p>この3工程を行うことで頂点を求めることができます。<br>
これを、分断された辺の分、つまり2辺分行うことで分断された頂点を求めることができる、というわけです。</p>

<p>サンプルコードの該当部分を抜粋すると以下のような形になります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// ---------------------------</span>
<span class="c1">// 左側の処理</span>

<span class="c1">// 定義した面と交差する点を探す。</span>
<span class="c1">// つまり、平面によって分割される点を探す。</span>
<span class="c1">// 左の点を起点に、右の点に向けたレイを飛ばし、その分割点を探る。</span>
<span class="n">blade</span><span class="p">.</span><span class="nf">Raycast</span><span class="p">(</span><span class="k">new</span> <span class="nf">Ray</span><span class="p">(</span><span class="n">leftPoints</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="p">(</span><span class="n">rightPoints</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">-</span> <span class="n">leftPoints</span><span class="p">[</span><span class="m">0</span><span class="p">]).</span><span class="n">normalized</span><span class="p">),</span> <span class="k">out</span> <span class="n">distance</span><span class="p">);</span>

<span class="c1">// 見つかった交差点を、頂点間の距離で割ることで、分割点の左右の割合を算出する</span>
<span class="n">normalizedDistance</span> <span class="p">=</span> <span class="n">distance</span> <span class="p">/</span> <span class="p">(</span><span class="n">rightPoints</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">-</span> <span class="n">leftPoints</span><span class="p">[</span><span class="m">0</span><span class="p">]).</span><span class="n">magnitude</span><span class="p">;</span>

<span class="c1">// カット後の新頂点に対する処理。フラグメントシェーダでの補完と同じく、分割した位置に応じて適切に補完した値を設定する</span>
<span class="n">Vector3</span> <span class="n">newVertex1</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Lerp</span><span class="p">(</span><span class="n">leftPoints</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">rightPoints</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">normalizedDistance</span><span class="p">);</span>
<span class="n">Vector2</span> <span class="n">newUv1</span>     <span class="p">=</span> <span class="n">Vector2</span><span class="p">.</span><span class="nf">Lerp</span><span class="p">(</span><span class="n">leftUvs</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">rightUvs</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">normalizedDistance</span><span class="p">);</span>
<span class="n">Vector3</span> <span class="n">newNormal1</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Lerp</span><span class="p">(</span><span class="n">leftNormals</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">,</span> <span class="n">rightNormals</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">normalizedDistance</span><span class="p">);</span>

<span class="c1">// 新頂点郡に新しい頂点を追加</span>
<span class="n">new_vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">newVertex1</span><span class="p">);</span>
</code></pre></div></div>

<p><em>↑の日本語は解説用に自分が付け加えたコメントです。</em></p>

<h3>
<span id="切断面を構築する" class="fragment"></span><a href="#%E5%88%87%E6%96%AD%E9%9D%A2%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>切断面を構築する</h3>

<p>上記までで全頂点の振り分け、および新頂点の算出が終わりました。<br>
最後は、新しく生成された頂点を利用して、切断面のポリゴンを形成します。</p>

<h4>
<span id="新頂点のペアを選択しポリゴンを形成する" class="fragment"></span><a href="#%E6%96%B0%E9%A0%82%E7%82%B9%E3%81%AE%E3%83%9A%E3%82%A2%E3%82%92%E9%81%B8%E6%8A%9E%E3%81%97%E3%83%9D%E3%83%AA%E3%82%B4%E3%83%B3%E3%82%92%E5%BD%A2%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>新頂点のペアを選択し、ポリゴンを形成する</h4>

<p>切断面の形成には、上記で算出した新頂点を使って行います。<br>
基本的な考え方は以下のフローになります。</p>

<ol>
<li>生成された頂点郡からペアとなる頂点を探し、それを順番に配列に格納する（※1）</li>
<li>新頂点のペアの探索が終わった段階でペアごとの順番に配列が形成されている</li>
<li>(1)の配列の重心を計算する（単純に全頂点足して、頂点数で割る）</li>
<li>(3)で算出した重心と、配列の頂点を使ってポリゴンを形成する</li>
<li>(4)のポリゴンを、左右のメッシュそれぞれに追加する</li>
<li>その際、左右でポリゴンの法線を逆向きにする（※2）</li>
</ol>

<p>※1 ... 切断対象となったポリゴンから必ず2頂点が生成される<br>
※2 ... 切断面は左右のオブジェクトそれぞれに必要で、単純に向きが逆のため</p>

<p>該当のコードを示すと以下になります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// カットを実行</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">Capping</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// カット用頂点追跡リスト</span>
    <span class="c1">// 具体的には新頂点全部に対する調査を行う。その過程で調査済みをマークする目的で利用する。</span>
    <span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

    <span class="c1">// 新しく生成した頂点分だけループする＝全新頂点に対してポリゴンを形成するため調査を行う</span>
    <span class="c1">// 具体的には、カット面を構成するポリゴンを形成するため、カット時に重複した頂点を網羅して「面」を形成する頂点を調査する</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">new_vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="c1">// 対象頂点がすでに調査済みのマークされて（追跡配列に含まれて）いたらスキップ</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// カット用ポリゴン配列をクリア</span>
        <span class="n">capVertpolygon</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

        <span class="c1">// 調査頂点と次の頂点をポリゴン配列に保持する</span>
        <span class="n">capVertpolygon</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">0</span><span class="p">]);</span>
        <span class="n">capVertpolygon</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">]);</span>

        <span class="c1">// 追跡配列に自身と次の頂点を追加する（調査済みのマークをつける）</span>
        <span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">0</span><span class="p">]);</span>
        <span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">]);</span>

        <span class="c1">// 重複頂点がなくなるまでループし調査する</span>
        <span class="kt">bool</span> <span class="n">isDone</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(!</span><span class="n">isDone</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">isDone</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

            <span class="c1">// 新頂点郡をループし、「面」を構成する要因となる頂点をすべて抽出する。抽出が終わるまでループを繰り返す</span>
            <span class="c1">// 2頂点ごとに調査を行うため、ループは2単位ですすめる</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">k</span> <span class="p">&lt;</span> <span class="n">new_vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">k</span> <span class="p">+=</span> <span class="m">2</span><span class="p">)</span>
            <span class="p">{</span> <span class="c1">// go through the pairs</span>
                <span class="c1">// ペアとなる頂点を探す</span>
                <span class="c1">// ここでのペアとは、いちトライアングルから生成される新頂点のペア。</span>
                <span class="c1">// トライアングルからは必ず2頂点が生成されるため、それを探す。</span>
                <span class="c1">// また、全ポリゴンに対して分割点を生成しているため、ほぼ必ず、まったく同じ位置に存在する、別トライアングルの分割頂点が存在するはずである。</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">==</span> <span class="n">capVertpolygon</span><span class="p">[</span><span class="n">capVertpolygon</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">]</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span> <span class="p">+</span> <span class="m">1</span><span class="p">]))</span>
                <span class="p">{</span>   <span class="c1">// if so add the other</span>
                    <span class="c1">// ペアの頂点が見つかったらそれをポリゴン配列に追加し、</span>
                    <span class="c1">// 調査済マークをつけて、次のループ処理に回す</span>
                    <span class="n">isDone</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                    <span class="n">capVertpolygon</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span> <span class="p">+</span> <span class="m">1</span><span class="p">]);</span>
                    <span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span> <span class="p">+</span> <span class="m">1</span><span class="p">]);</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span> <span class="p">+</span> <span class="m">1</span><span class="p">]</span> <span class="p">==</span> <span class="n">capVertpolygon</span><span class="p">[</span><span class="n">capVertpolygon</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">]</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="p">{</span>   <span class="c1">// if so add the other</span>
                    <span class="n">isDone</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                    <span class="n">capVertpolygon</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
                    <span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// 見つかった頂点郡を元に、ポリゴンを形成する</span>
        <span class="nf">FillCap</span><span class="p">(</span><span class="n">capVertpolygon</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上記のコードを理解する上で地味にポイントだったのは、重複する頂点が存在する、という点。<br>
簡単のためにまず板ポリを考えてみます。</p>

<p>すると、板ポリは2枚のポリゴンで形成されますが、これを切断すると新頂点は<strong>4つ</strong>生成されます。<br>
三角形（ポリゴン）1枚に対して2頂点生成されるからですね。<br>
そして重複する点は1つです。</p>

<p><a href="https://camo.qiitausercontent.com/882852ed4b1a91a2d523634376bd97dfb9734312/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f353631362f35323934383335382d343838612d333137622d373362302d6337633536663536373936652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2F52948358-488a-317b-73b0-c7c56f56796e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b2a5ead9321807bfccd96024ef749da9" alt="切断頂点.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/5616/52948358-488a-317b-73b0-c7c56f56796e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2F52948358-488a-317b-73b0-c7c56f56796e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=01e06a2e6384f15895f2a9037e737574 1x" loading="lazy"></a></p>

<p>上記画像の左右の頂点はそれぞれの色に対応したポリゴンから生成された頂点です。<br>
そして中央のものが2つの色に分けられていますが、これが重複した頂点になります。<br>
左右それぞれのポリゴンから頂点が生成されるので4つ生成されているのが分かるかと思います。</p>

<p>さて、今度はこれをキューブに拡張して考えると、先程は重複しなかった両端の点も、キューブの側面側の頂点と重複することになります。<br>
結果としてすべての新頂点が必ず2つずつ重なることになります。</p>

<p><a href="https://camo.qiitausercontent.com/9d958f237853381d58b13ef9ce88f67dc2bcdbe2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f353631362f65373362646231312d363066342d636535612d383263332d3230356439373965613166312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2Fe73bdb11-60f4-ce5a-82c3-205d979ea1f1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1be044c7dccbffeefaae6569611df1c4" alt="切断キューブ.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/5616/e73bdb11-60f4-ce5a-82c3-205d979ea1f1.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2Fe73bdb11-60f4-ce5a-82c3-205d979ea1f1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=524fb8bf5fe3a2b83677ec2fa9c823ba 1x" loading="lazy"></a></p>

<p>なので冒頭の動画のように、キューブを切断すると新頂点は16個生成され、実際に切断面のポリゴンとして利用される頂点は8つになります。<br>
実際に、上図の点を数えると8個あるのが分かるかと思います。それぞれが重複しているため、新頂点として生成されるのは16、ということですね。</p>

<h3>
<span id="カット面をグルーピングする" class="fragment"></span><a href="#%E3%82%AB%E3%83%83%E3%83%88%E9%9D%A2%E3%82%92%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%94%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>カット面をグルーピングする</h3>

<p>上記の<code>for</code>文の入れ子になっている方（<code>k += 2</code>で回している方）は、ここで生成された重複頂点を調べてグルーピングする役割を担っています。<br>
すでに説明したように、Cubeを切断した場合、Cubeをぐるっと取り囲むように16個の頂点が作られます。</p>

<p>対象がCubeひとつならこの頂点郡をひとつのカット面として利用しても問題ありませんが、大体の場合はモデルは複雑な形状をしています。</p>

<p>例えば角を持つモンスターが腕を振り上げているシーンを想像してください。<br>
そしてその振り上げた手と角を一度に切断した場合、角の部分と腕の部分、それぞれ「ふたつのカット面」が生成されるのがイメージできるかと思います。<br>
この「角」と「腕」のカット面を形成する頂点郡をグルーピングするのが前述のグルーピングの役割、と書いた意味です。</p>

<p>実装としてはシンプルです。<br>
上記では「角」と「腕」を例に出しました。<br>
そして大体の場合において、このふたつのカット平面の頂点は重なることがありません。</p>

<p>つまり、入れ子の<code>for</code>文が行っているのは、必ず重複頂点が生成される事実を利用して、重複頂点を結んでいくことで「角」と「腕」のカット面を意味的にふたつにグルーピングしている、というわけです。</p>

<p>上の板ポリの例で言えば、最初に青い色の頂点をグループに追加し、そこから調査を開始します。（調査用のリストとして<code>capVertTracker</code>を利用しています）<br>
最後に追加した頂点と同じ位置にある頂点を探します。<br>
すると、重複した位置にある黄色い頂点が見つかります。</p>

<p>そして「<strong>見つかった頂点の次の頂点</strong>」を<code>capVertTracker</code>リストに加え、再度検索を行います。（板ポリの例で言えば右端の黄色い頂点）<br>
板ポリではこれでグルーピングが完了します。</p>

<p>仮に、板ポリの次に示したCubeの例で言えば連続的に別の面の頂点が見つかります。<br>
あとは同じ検索・追加処理を、対象頂点が見つからなくなるまで繰り返すことで、無事にカット面を形成する頂点郡のグルーピングが完成する、というわけです。</p>

<h4>
<span id="新頂点を結びポリゴンを形成する" class="fragment"></span><a href="#%E6%96%B0%E9%A0%82%E7%82%B9%E3%82%92%E7%B5%90%E3%81%B3%E3%83%9D%E3%83%AA%E3%82%B4%E3%83%B3%E3%82%92%E5%BD%A2%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>新頂点を結び、ポリゴンを形成する</h4>

<p>さぁ、これで必要な情報はすべて整いました。<br>
あとは調べられた頂点を使ってポリゴンを形成する、つまり3頂点を選び出してそれを結んでいく作業です。</p>

<p>ただ、上図とコードを見てもらうと分かりますが、新しく生成された頂点は16、うちポリゴン形成に利用するのは8頂点（※）あります。<br>
これをどう結ぶか、を考えないとなりません。</p>

<p>今回のサンプルではシンプルに、全頂点の平均位置を求め、それと、新頂点を順番に結んで、ピザを切り分けたような形でポリゴンを形成するような処理になっています。</p>

<p>※ ... 最初、頂点検索のアルゴリズムが分かりづらかったのですが、上のように8頂点を見つけ出す処理でした。が、実はこのアルゴリズムの場合、重複した、同じ位置にある点についてもポリゴンを形成していて、若干冗長な処理になっているようです。（つまり、同じ位置に重なるように2枚のカット平面が存在することになる）<br>
ただ、負荷的にとても増える、というものでもないのでこのままにしているのだと思います。（Simple Cutって言ってるし）</p>

<p><a href="https://camo.qiitausercontent.com/a1f92525b3fbe91be9dc054ecb4abae6bcd355a4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f353631362f32356631316334352d663531382d313864362d663961362d3633323831663161383764332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2F25f11c45-f518-18d6-f9a6-63281f1a87d3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=67e04f79b15841dd2682e33e6412adaf" alt="中心点.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/5616/25f11c45-f518-18d6-f9a6-63281f1a87d3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2F25f11c45-f518-18d6-f9a6-63281f1a87d3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=67bed7719dab2da96c68111553812b68 1x" loading="lazy"></a></p>

<p>上記はキューブの断面ではないですが、青い8頂点が新頂点として生成されたもの、として考えてください。<br>
これの平均位置を取ると中心あたりになり、オレンジの点（$c$）となります。</p>

<p>あとはこれを、順番に結んでいけば切断面のポリゴンが形成できる、というわけです。<br>
順番とは、「$1, 2, c$」,「$2, 3, c$」,「$3, 4, c$」... という具合です。</p>

<p>最後にこの、切断面のポリゴンを形成するコードを以下に示します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// カット面を埋める</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="c1">/// &lt;param name="vertices"&gt;ポリゴンを形成する頂点リスト&lt;/param&gt;</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">FillCap</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;</span> <span class="n">vertices</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// center of the cap</span>
    <span class="c1">// カット平面の中心点を計算する</span>
    <span class="n">Vector3</span> <span class="n">center</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>

    <span class="c1">// 引数で渡された頂点位置をすべて合計する</span>
    <span class="k">foreach</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">point</span> <span class="k">in</span> <span class="n">vertices</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">center</span> <span class="p">+=</span> <span class="n">point</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// それを頂点数の合計で割り、中心とする</span>
    <span class="n">center</span> <span class="p">=</span> <span class="n">center</span> <span class="p">/</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span>

    <span class="c1">// you need an axis based on the cap</span>
    <span class="c1">// カット平面をベースにしたupward</span>
    <span class="n">Vector3</span> <span class="n">upward</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>

    <span class="c1">// 90 degree turn</span>
    <span class="c1">// カット平面の法線を利用して、「上」方向を求める</span>
    <span class="c1">// 具体的には、平面の左側を上として利用する</span>
    <span class="n">upward</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span>  <span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="n">upward</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="p">-</span><span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">upward</span><span class="p">.</span><span class="n">z</span> <span class="p">=</span>  <span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>

    <span class="c1">// 法線と「上方向」から、横軸を算出</span>
    <span class="n">Vector3</span> <span class="n">left</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Cross</span><span class="p">(</span><span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="n">upward</span><span class="p">);</span>

    <span class="n">Vector3</span> <span class="n">displacement</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
    <span class="n">Vector3</span> <span class="n">newUV1</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
    <span class="n">Vector3</span> <span class="n">newUV2</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>

    <span class="c1">// 引数で与えられた頂点分ループを回す</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="c1">// 計算で求めた中心点から、各頂点への方向ベクトル</span>
        <span class="n">displacement</span> <span class="p">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">-</span> <span class="n">center</span><span class="p">;</span>

        <span class="c1">// 新規生成するポリゴンのUV座標を求める。</span>
        <span class="c1">// displacementが中心からのベクトルのため、UV的な中心である0.5をベースに、内積を使ってUVの最終的な位置を得る</span>
        <span class="n">newUV1</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
        <span class="n">newUV1</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="m">0.5f</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">left</span><span class="p">);</span>
        <span class="n">newUV1</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="m">0.5f</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">upward</span><span class="p">);</span>
        <span class="n">newUV1</span><span class="p">.</span><span class="n">z</span> <span class="p">=</span> <span class="m">0.5f</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>

        <span class="c1">// 次の頂点。ただし、最後の頂点の次は最初の頂点を利用するため、若干トリッキーな指定方法をしている（% vertices.Count）</span>
        <span class="n">displacement</span> <span class="p">=</span> <span class="n">vertices</span><span class="p">[(</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span> <span class="p">%</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">]</span> <span class="p">-</span> <span class="n">center</span><span class="p">;</span>

        <span class="n">newUV2</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
        <span class="n">newUV2</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="m">0.5f</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">left</span><span class="p">);</span>
        <span class="n">newUV2</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="m">0.5f</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">upward</span><span class="p">);</span>
        <span class="n">newUV2</span><span class="p">.</span><span class="n">z</span> <span class="p">=</span> <span class="m">0.5f</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>

        <span class="c1">// uvs.Add(new Vector2(relativePosition.x, relativePosition.y));</span>
        <span class="c1">// normals.Add(blade.normal);</span>

        <span class="c1">// 左側のポリゴンとして、求めたUVを利用してトライアングルを追加</span>
        <span class="n">left_side</span><span class="p">.</span><span class="nf">AddTriangle</span><span class="p">(</span>
            <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span>
                <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">vertices</span><span class="p">[(</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span> <span class="p">%</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">],</span>
                <span class="n">center</span>
            <span class="p">},</span>
            <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span>
                <span class="p">-</span><span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span>
                <span class="p">-</span><span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span>
                <span class="p">-</span><span class="n">blade</span><span class="p">.</span><span class="n">normal</span>
            <span class="p">},</span>
            <span class="k">new</span> <span class="n">Vector2</span><span class="p">[]{</span>
                <span class="n">newUV1</span><span class="p">,</span>
                <span class="n">newUV2</span><span class="p">,</span>
                <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">0.5f</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">-</span><span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span>
            <span class="n">left_side</span><span class="p">.</span><span class="n">subIndices</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span> <span class="c1">// カット面。最後のサブメッシュとしてトライアングルを追加</span>
        <span class="p">);</span>

        <span class="c1">// 右側のトライアングル。基本は左側と同じだが、法線だけ逆向き。</span>
        <span class="n">right_side</span><span class="p">.</span><span class="nf">AddTriangle</span><span class="p">(</span>
            <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span>
                <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">vertices</span><span class="p">[(</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span> <span class="p">%</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">],</span>
                <span class="n">center</span>
            <span class="p">},</span>
            <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span>
                <span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span>
                <span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span>
                <span class="n">blade</span><span class="p">.</span><span class="n">normal</span>
            <span class="p">},</span>
            <span class="k">new</span> <span class="n">Vector2</span><span class="p">[]{</span>
                <span class="n">newUV1</span><span class="p">,</span>
                <span class="n">newUV2</span><span class="p">,</span>
                <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">0.5f</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span>
            <span class="n">right_side</span><span class="p">.</span><span class="n">subIndices</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span> <span class="c1">// カット面。最後のサブメッシュとしてトライアングルを追加</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>以上が、メッシュの切断を行っているコードの解説となります。</p>

<h2>
<span id="サンプルコード" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>サンプルコード</h2>

<p>下のコードは、上で解説したコードの全文です。<br>
自分の理解のために各処理について日本語でコメントを入れているので、分かりづらい点などはそちらも合わせて見てもらうと理解が促されるかもしれません。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">BLINDED_AM_ME</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MeshCut</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">class</span> <span class="nc">MeshCutSide</span>
        <span class="p">{</span>
            <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;</span>  <span class="n">vertices</span>  <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;();</span>
            <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;</span>  <span class="n">normals</span>   <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;();</span>
            <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector2</span><span class="p">&gt;</span>  <span class="n">uvs</span>       <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector2</span><span class="p">&gt;();</span>
            <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span>      <span class="n">triangles</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>
            <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;</span> <span class="n">subIndices</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;();</span>

            <span class="k">public</span> <span class="k">void</span> <span class="nf">ClearAll</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">vertices</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>
                <span class="n">normals</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>
                <span class="n">uvs</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>
                <span class="n">triangles</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>
                <span class="n">subIndices</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="c1">/// &lt;summary&gt;</span>
            <span class="c1">/// トライアングルとして3頂点を追加</span>
            <span class="c1">/// ※ 頂点情報は元のメッシュからコピーする</span>
            <span class="c1">/// &lt;/summary&gt;</span>
            <span class="c1">/// &lt;param name="p1"&gt;頂点1&lt;/param&gt;</span>
            <span class="c1">/// &lt;param name="p2"&gt;頂点2&lt;/param&gt;</span>
            <span class="c1">/// &lt;param name="p3"&gt;頂点3&lt;/param&gt;</span>
            <span class="c1">/// &lt;param name="submesh"&gt;対象のサブメシュ&lt;/param&gt;</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">AddTriangle</span><span class="p">(</span><span class="kt">int</span> <span class="n">p1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">p2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">p3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">submesh</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// triangle index order goes 1,2,3,4....</span>

                <span class="c1">// 頂点配列のカウント。随時追加されていくため、ベースとなるindexを定義する。</span>
                <span class="c1">// ※ AddTriangleが呼ばれるたびに頂点数は増えていく。</span>
                <span class="kt">int</span> <span class="n">base_index</span> <span class="p">=</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span>

                <span class="c1">// 対象サブメッシュのインデックスに追加していく</span>
                <span class="n">subIndices</span><span class="p">[</span><span class="n">submesh</span><span class="p">].</span><span class="nf">Add</span><span class="p">(</span><span class="n">base_index</span> <span class="p">+</span> <span class="m">0</span><span class="p">);</span>
                <span class="n">subIndices</span><span class="p">[</span><span class="n">submesh</span><span class="p">].</span><span class="nf">Add</span><span class="p">(</span><span class="n">base_index</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
                <span class="n">subIndices</span><span class="p">[</span><span class="n">submesh</span><span class="p">].</span><span class="nf">Add</span><span class="p">(</span><span class="n">base_index</span> <span class="p">+</span> <span class="m">2</span><span class="p">);</span>

                <span class="c1">// 三角形郡の頂点を設定</span>
                <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">base_index</span> <span class="p">+</span> <span class="m">0</span><span class="p">);</span>
                <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">base_index</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
                <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">base_index</span> <span class="p">+</span> <span class="m">2</span><span class="p">);</span>

                <span class="c1">// 対象オブジェクトの頂点配列から頂点情報を取得し設定する</span>
                <span class="c1">// （victim_meshはstaticメンバなんだけどいいんだろうか・・）</span>
                <span class="n">vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">p1</span><span class="p">]);</span>
                <span class="n">vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">p2</span><span class="p">]);</span>
                <span class="n">vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">p3</span><span class="p">]);</span>

                <span class="c1">// 同様に、対象オブジェクトの法線配列から法線を取得し設定する</span>
                <span class="n">normals</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">normals</span><span class="p">[</span><span class="n">p1</span><span class="p">]);</span>
                <span class="n">normals</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">normals</span><span class="p">[</span><span class="n">p2</span><span class="p">]);</span>
                <span class="n">normals</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">normals</span><span class="p">[</span><span class="n">p3</span><span class="p">]);</span>

                <span class="c1">// 同様に、UVも。</span>
                <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">uv</span><span class="p">[</span><span class="n">p1</span><span class="p">]);</span>
                <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">uv</span><span class="p">[</span><span class="n">p2</span><span class="p">]);</span>
                <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">uv</span><span class="p">[</span><span class="n">p3</span><span class="p">]);</span>
            <span class="p">}</span>

            <span class="c1">/// &lt;summary&gt;</span>
            <span class="c1">/// トライアングルを追加する</span>
            <span class="c1">/// ※ オーバーロードしている他メソッドとは異なり、引数の値で頂点（ポリゴン）を追加する</span>
            <span class="c1">/// &lt;/summary&gt;</span>
            <span class="c1">/// &lt;param name="points3"&gt;トライアングルを形成する3頂点&lt;/param&gt;</span>
            <span class="c1">/// &lt;param name="normals3"&gt;3頂点の法線&lt;/param&gt;</span>
            <span class="c1">/// &lt;param name="uvs3"&gt;3頂点のUV&lt;/param&gt;</span>
            <span class="c1">/// &lt;param name="faceNormal"&gt;ポリゴンの法線&lt;/param&gt;</span>
            <span class="c1">/// &lt;param name="submesh"&gt;サブメッシュID&lt;/param&gt;</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">AddTriangle</span><span class="p">(</span><span class="n">Vector3</span><span class="p">[]</span> <span class="n">points3</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">[]</span> <span class="n">normals3</span><span class="p">,</span> <span class="n">Vector2</span><span class="p">[]</span> <span class="n">uvs3</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">faceNormal</span><span class="p">,</span> <span class="kt">int</span> <span class="n">submesh</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// 引数の3頂点から法線を計算</span>
                <span class="n">Vector3</span> <span class="n">calculated_normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Cross</span><span class="p">((</span><span class="n">points3</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">-</span> <span class="n">points3</span><span class="p">[</span><span class="m">0</span><span class="p">]).</span><span class="n">normalized</span><span class="p">,</span> <span class="p">(</span><span class="n">points3</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">-</span> <span class="n">points3</span><span class="p">[</span><span class="m">0</span><span class="p">]).</span><span class="n">normalized</span><span class="p">);</span>

                <span class="kt">int</span> <span class="n">p1</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                <span class="kt">int</span> <span class="n">p2</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
                <span class="kt">int</span> <span class="n">p3</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>

                <span class="c1">// 引数で指定された法線と逆だった場合はインデックスの順番を逆順にする（つまり面を裏返す）</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">calculated_normal</span><span class="p">,</span> <span class="n">faceNormal</span><span class="p">)</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">p1</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
                    <span class="n">p2</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
                    <span class="n">p3</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="kt">int</span> <span class="n">base_index</span> <span class="p">=</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span>

                <span class="n">subIndices</span><span class="p">[</span><span class="n">submesh</span><span class="p">].</span><span class="nf">Add</span><span class="p">(</span><span class="n">base_index</span> <span class="p">+</span> <span class="m">0</span><span class="p">);</span>
                <span class="n">subIndices</span><span class="p">[</span><span class="n">submesh</span><span class="p">].</span><span class="nf">Add</span><span class="p">(</span><span class="n">base_index</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
                <span class="n">subIndices</span><span class="p">[</span><span class="n">submesh</span><span class="p">].</span><span class="nf">Add</span><span class="p">(</span><span class="n">base_index</span> <span class="p">+</span> <span class="m">2</span><span class="p">);</span>

                <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">base_index</span> <span class="p">+</span> <span class="m">0</span><span class="p">);</span>
                <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">base_index</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
                <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">base_index</span> <span class="p">+</span> <span class="m">2</span><span class="p">);</span>

                <span class="n">vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">points3</span><span class="p">[</span><span class="n">p1</span><span class="p">]);</span>
                <span class="n">vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">points3</span><span class="p">[</span><span class="n">p2</span><span class="p">]);</span>
                <span class="n">vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">points3</span><span class="p">[</span><span class="n">p3</span><span class="p">]);</span>

                <span class="n">normals</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">normals3</span><span class="p">[</span><span class="n">p1</span><span class="p">]);</span>
                <span class="n">normals</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">normals3</span><span class="p">[</span><span class="n">p2</span><span class="p">]);</span>
                <span class="n">normals</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">normals3</span><span class="p">[</span><span class="n">p3</span><span class="p">]);</span>

                <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">uvs3</span><span class="p">[</span><span class="n">p1</span><span class="p">]);</span>
                <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">uvs3</span><span class="p">[</span><span class="n">p2</span><span class="p">]);</span>
                <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">uvs3</span><span class="p">[</span><span class="n">p3</span><span class="p">]);</span>
            <span class="p">}</span>

        <span class="p">}</span>

        <span class="k">private</span> <span class="k">static</span> <span class="n">MeshCutSide</span> <span class="n">left_side</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MeshCutSide</span><span class="p">();</span>
        <span class="k">private</span> <span class="k">static</span> <span class="n">MeshCutSide</span> <span class="n">right_side</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MeshCutSide</span><span class="p">();</span>

        <span class="k">private</span> <span class="k">static</span> <span class="n">Plane</span> <span class="n">blade</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">static</span> <span class="n">Mesh</span> <span class="n">victim_mesh</span><span class="p">;</span>

        <span class="c1">// capping stuff</span>
        <span class="k">private</span> <span class="k">static</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;</span> <span class="n">new_vertices</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;();</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// Cut the specified victim, blade_plane and capMaterial.</span>
        <span class="c1">/// （指定された「victim」をカットする。ブレード（平面）とマテリアルから切断を実行する）</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="victim"&gt;Victim.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="blade_plane"&gt;Blade plane.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="capMaterial"&gt;Cap material.&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">GameObject</span><span class="p">[]</span> <span class="nf">Cut</span><span class="p">(</span><span class="n">GameObject</span> <span class="n">victim</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">anchorPoint</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">normalDirection</span><span class="p">,</span> <span class="n">Material</span> <span class="n">capMaterial</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// set the blade relative to victim</span>
            <span class="c1">// victimから相対的な平面（ブレード）をセット</span>
            <span class="c1">// 具体的には、対象オブジェクトのローカル座標での平面の法線と位置から平面を生成する</span>
            <span class="n">blade</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Plane</span><span class="p">(</span>
                <span class="n">victim</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">InverseTransformDirection</span><span class="p">(-</span><span class="n">normalDirection</span><span class="p">),</span>
                <span class="n">victim</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">InverseTransformPoint</span><span class="p">(</span><span class="n">anchorPoint</span><span class="p">)</span>
            <span class="p">);</span>

            <span class="c1">// get the victims mesh</span>
            <span class="c1">// 対象のメッシュを取得</span>
            <span class="n">victim_mesh</span> <span class="p">=</span> <span class="n">victim</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">MeshFilter</span><span class="p">&gt;().</span><span class="n">mesh</span><span class="p">;</span>

            <span class="c1">// reset values</span>
            <span class="c1">// 新しい頂点郡</span>
            <span class="n">new_vertices</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="c1">// 平面より左の頂点郡（MeshCutSide）</span>
            <span class="n">left_side</span><span class="p">.</span><span class="nf">ClearAll</span><span class="p">();</span>

            <span class="c1">//平面より右の頂点郡（MeshCutSide）</span>
            <span class="n">right_side</span><span class="p">.</span><span class="nf">ClearAll</span><span class="p">();</span>

            <span class="c1">// ここでの「3」はトライアングル？</span>
            <span class="kt">bool</span><span class="p">[]</span> <span class="n">sides</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="m">3</span><span class="p">];</span>
            <span class="kt">int</span><span class="p">[]</span> <span class="n">indices</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span><span class="p">;</span>

            <span class="c1">// go throught the submeshes</span>
            <span class="c1">// サブメッシュの数だけループ</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">sub</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">sub</span> <span class="p">&lt;</span> <span class="n">victim_mesh</span><span class="p">.</span><span class="n">subMeshCount</span><span class="p">;</span> <span class="n">sub</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="c1">// サブメッシュのインデックス数を取得</span>
                <span class="n">indices</span> <span class="p">=</span> <span class="n">victim_mesh</span><span class="p">.</span><span class="nf">GetIndices</span><span class="p">(</span><span class="n">sub</span><span class="p">);</span>

                <span class="c1">// List&lt;List&lt;int&gt;&gt;型のリスト。サブメッシュ一つ分のインデックスリスト</span>
                <span class="n">left_side</span><span class="p">.</span><span class="n">subIndices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;());</span>  <span class="c1">// 左</span>
                <span class="n">right_side</span><span class="p">.</span><span class="n">subIndices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;());</span> <span class="c1">// 右</span>

                <span class="c1">// サブメッシュのインデックス数分ループ</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">indices</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span> <span class="p">+=</span> <span class="m">3</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// p1 - p3のインデックスを取得。つまりトライアングル</span>
                    <span class="n">p1</span> <span class="p">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">0</span><span class="p">];</span>
                    <span class="n">p2</span> <span class="p">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">];</span>
                    <span class="n">p3</span> <span class="p">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">2</span><span class="p">];</span>

                    <span class="c1">// それぞれ評価中のメッシュの頂点が、冒頭で定義された平面の左右どちらにあるかを評価。</span>
                    <span class="c1">// `GetSide` メソッドによりboolを得る。</span>
                    <span class="n">sides</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="n">blade</span><span class="p">.</span><span class="nf">GetSide</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">p1</span><span class="p">]);</span>
                    <span class="n">sides</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="n">blade</span><span class="p">.</span><span class="nf">GetSide</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">p2</span><span class="p">]);</span>
                    <span class="n">sides</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">=</span> <span class="n">blade</span><span class="p">.</span><span class="nf">GetSide</span><span class="p">(</span><span class="n">victim_mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">p3</span><span class="p">]);</span>

                    <span class="c1">// whole triangle</span>
                    <span class="c1">// 頂点０と頂点１および頂点２がどちらも同じ側にある場合はカットしない</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">sides</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">==</span> <span class="n">sides</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">&amp;&amp;</span> <span class="n">sides</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">==</span> <span class="n">sides</span><span class="p">[</span><span class="m">2</span><span class="p">])</span>
                    <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">sides</span><span class="p">[</span><span class="m">0</span><span class="p">])</span>
                        <span class="p">{</span> <span class="c1">// left side</span>
                          <span class="c1">// GetSideメソッドでポジティブ（true）の場合は左側にあり</span>
                            <span class="n">left_side</span><span class="p">.</span><span class="nf">AddTriangle</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">sub</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="k">else</span>
                        <span class="p">{</span>
                            <span class="n">right_side</span><span class="p">.</span><span class="nf">AddTriangle</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">sub</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">else</span>
                    <span class="p">{</span> <span class="c1">// cut the triangle</span>
                      <span class="c1">// そうではなく、どちらかの点が平面の反対側にある場合はカットを実行する</span>
                        <span class="nf">Cut_this_Face</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">sides</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// 設定されているマテリアル配列を取得</span>
            <span class="n">Material</span><span class="p">[]</span> <span class="n">mats</span> <span class="p">=</span> <span class="n">victim</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">MeshRenderer</span><span class="p">&gt;().</span><span class="n">sharedMaterials</span><span class="p">;</span>

            <span class="c1">// 取得したマテリアル配列の最後のマテリアルが、カット面のマテリアルでない場合</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mats</span><span class="p">[</span><span class="n">mats</span><span class="p">.</span><span class="n">Length</span> <span class="p">-</span> <span class="m">1</span><span class="p">].</span><span class="n">name</span> <span class="p">!=</span> <span class="n">capMaterial</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
            <span class="p">{</span> <span class="c1">// add cap indices</span>
                <span class="c1">// カット面用のインデックス配列を追加？</span>
                <span class="n">left_side</span><span class="p">.</span><span class="n">subIndices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;());</span>
                <span class="n">right_side</span><span class="p">.</span><span class="n">subIndices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;());</span>

                <span class="c1">// カット面分増やしたマテリアル配列を準備</span>
                <span class="n">Material</span><span class="p">[]</span> <span class="n">newMats</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Material</span><span class="p">[</span><span class="n">mats</span><span class="p">.</span><span class="n">Length</span> <span class="p">+</span> <span class="m">1</span><span class="p">];</span>

                <span class="c1">// 既存のものを新しい配列にコピー</span>
                <span class="n">mats</span><span class="p">.</span><span class="nf">CopyTo</span><span class="p">(</span><span class="n">newMats</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>

                <span class="c1">// 新しいマテリアル配列の最後に、カット面用マテリアルを追加</span>
                <span class="n">newMats</span><span class="p">[</span><span class="n">mats</span><span class="p">.</span><span class="n">Length</span><span class="p">]</span> <span class="p">=</span> <span class="n">capMaterial</span><span class="p">;</span>

                <span class="c1">// 生成したマテリアルリストを再設定</span>
                <span class="n">mats</span> <span class="p">=</span> <span class="n">newMats</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// cap the opennings</span>
            <span class="c1">// カット開始</span>
            <span class="nf">Capping</span><span class="p">();</span>


            <span class="c1">// Left Mesh</span>
            <span class="c1">// 左側のメッシュを生成</span>
            <span class="c1">// MeshCutSideクラスのメンバから各値をコピー</span>
            <span class="n">Mesh</span> <span class="n">left_HalfMesh</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mesh</span><span class="p">();</span>
            <span class="n">left_HalfMesh</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="s">"Split Mesh Left"</span><span class="p">;</span>
            <span class="n">left_HalfMesh</span><span class="p">.</span><span class="n">vertices</span>  <span class="p">=</span> <span class="n">left_side</span><span class="p">.</span><span class="n">vertices</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
            <span class="n">left_HalfMesh</span><span class="p">.</span><span class="n">triangles</span> <span class="p">=</span> <span class="n">left_side</span><span class="p">.</span><span class="n">triangles</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
            <span class="n">left_HalfMesh</span><span class="p">.</span><span class="n">normals</span>   <span class="p">=</span> <span class="n">left_side</span><span class="p">.</span><span class="n">normals</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
            <span class="n">left_HalfMesh</span><span class="p">.</span><span class="n">uv</span>        <span class="p">=</span> <span class="n">left_side</span><span class="p">.</span><span class="n">uvs</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>

            <span class="n">left_HalfMesh</span><span class="p">.</span><span class="n">subMeshCount</span> <span class="p">=</span> <span class="n">left_side</span><span class="p">.</span><span class="n">subIndices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">left_side</span><span class="p">.</span><span class="n">subIndices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">left_HalfMesh</span><span class="p">.</span><span class="nf">SetIndices</span><span class="p">(</span><span class="n">left_side</span><span class="p">.</span><span class="n">subIndices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToArray</span><span class="p">(),</span> <span class="n">MeshTopology</span><span class="p">.</span><span class="n">Triangles</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> 
            <span class="p">}</span>


            <span class="c1">// Right Mesh</span>
            <span class="c1">// 右側のメッシュも同様に生成</span>
            <span class="n">Mesh</span> <span class="n">right_HalfMesh</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mesh</span><span class="p">();</span>
            <span class="n">right_HalfMesh</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="s">"Split Mesh Right"</span><span class="p">;</span>
            <span class="n">right_HalfMesh</span><span class="p">.</span><span class="n">vertices</span>  <span class="p">=</span> <span class="n">right_side</span><span class="p">.</span><span class="n">vertices</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
            <span class="n">right_HalfMesh</span><span class="p">.</span><span class="n">triangles</span> <span class="p">=</span> <span class="n">right_side</span><span class="p">.</span><span class="n">triangles</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
            <span class="n">right_HalfMesh</span><span class="p">.</span><span class="n">normals</span>   <span class="p">=</span> <span class="n">right_side</span><span class="p">.</span><span class="n">normals</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
            <span class="n">right_HalfMesh</span><span class="p">.</span><span class="n">uv</span>        <span class="p">=</span> <span class="n">right_side</span><span class="p">.</span><span class="n">uvs</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>

            <span class="n">right_HalfMesh</span><span class="p">.</span><span class="n">subMeshCount</span> <span class="p">=</span> <span class="n">right_side</span><span class="p">.</span><span class="n">subIndices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">right_side</span><span class="p">.</span><span class="n">subIndices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">right_HalfMesh</span><span class="p">.</span><span class="nf">SetIndices</span><span class="p">(</span><span class="n">right_side</span><span class="p">.</span><span class="n">subIndices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ToArray</span><span class="p">(),</span> <span class="n">MeshTopology</span><span class="p">.</span><span class="n">Triangles</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
            <span class="p">}</span>


            <span class="c1">// assign the game objects</span>

            <span class="c1">// 元のオブジェクトを左側のオブジェクトに</span>
            <span class="n">victim</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="s">"left side"</span><span class="p">;</span>
            <span class="n">victim</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">MeshFilter</span><span class="p">&gt;().</span><span class="n">mesh</span> <span class="p">=</span> <span class="n">left_HalfMesh</span><span class="p">;</span>


            <span class="c1">// 右側のオブジェクトは新規作成</span>
            <span class="n">GameObject</span> <span class="n">leftSideObj</span> <span class="p">=</span> <span class="n">victim</span><span class="p">;</span>

            <span class="n">GameObject</span> <span class="n">rightSideObj</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GameObject</span><span class="p">(</span><span class="s">"right side"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">MeshFilter</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">MeshRenderer</span><span class="p">));</span>
            <span class="n">rightSideObj</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">victim</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
            <span class="n">rightSideObj</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span> <span class="p">=</span> <span class="n">victim</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">;</span>
            <span class="n">rightSideObj</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">MeshFilter</span><span class="p">&gt;().</span><span class="n">mesh</span> <span class="p">=</span> <span class="n">right_HalfMesh</span><span class="p">;</span>

            <span class="c1">// assign mats</span>
            <span class="c1">// 新規生成したマテリアルリストをそれぞれのオブジェクトに適用する</span>
            <span class="n">leftSideObj</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">MeshRenderer</span><span class="p">&gt;().</span><span class="n">materials</span> <span class="p">=</span> <span class="n">mats</span><span class="p">;</span>
            <span class="n">rightSideObj</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">MeshRenderer</span><span class="p">&gt;().</span><span class="n">materials</span> <span class="p">=</span> <span class="n">mats</span><span class="p">;</span>

            <span class="c1">// 左右のGameObjectの配列を返す</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">GameObject</span><span class="p">[]{</span> <span class="n">leftSideObj</span><span class="p">,</span> <span class="n">rightSideObj</span> <span class="p">};</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// カットを実行する。ただし、実際のメッシュの操作ではなく、あくまで頂点の振り分け、事前準備としての実行</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="submesh"&gt;サブメッシュのインデックス&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="sides"&gt;評価した3頂点の左右情報&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="index1"&gt;頂点1&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="index2"&gt;頂点2&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="index3"&gt;頂点3&lt;/param&gt;</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Cut_this_Face</span><span class="p">(</span><span class="kt">int</span> <span class="n">submesh</span><span class="p">,</span> <span class="kt">bool</span><span class="p">[]</span> <span class="n">sides</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index3</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 左右それぞれの情報を保持するための配列郡</span>
            <span class="n">Vector3</span><span class="p">[]</span> <span class="n">leftPoints</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>
            <span class="n">Vector3</span><span class="p">[]</span> <span class="n">leftNormals</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>
            <span class="n">Vector2</span><span class="p">[]</span> <span class="n">leftUvs</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>
            <span class="n">Vector3</span><span class="p">[]</span> <span class="n">rightPoints</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>
            <span class="n">Vector3</span><span class="p">[]</span> <span class="n">rightNormals</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>
            <span class="n">Vector2</span><span class="p">[]</span> <span class="n">rightUvs</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>

            <span class="kt">bool</span> <span class="n">didset_left</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="kt">bool</span> <span class="n">didset_right</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

            <span class="c1">// 3頂点分繰り返す</span>
            <span class="c1">// 処理内容としては、左右を判定して、左右の配列に3頂点を振り分ける処理を行っている</span>
            <span class="kt">int</span> <span class="n">p</span> <span class="p">=</span> <span class="n">index1</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">side</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">side</span> <span class="p">&lt;</span> <span class="m">3</span><span class="p">;</span> <span class="n">side</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="k">switch</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">case</span> <span class="m">0</span><span class="p">:</span>
                        <span class="n">p</span> <span class="p">=</span> <span class="n">index1</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="m">1</span><span class="p">:</span>
                        <span class="n">p</span> <span class="p">=</span> <span class="n">index2</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="m">2</span><span class="p">:</span>
                        <span class="n">p</span> <span class="p">=</span> <span class="n">index3</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="c1">// sides[side]がtrue、つまり左側の場合</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">sides</span><span class="p">[</span><span class="n">side</span><span class="p">])</span>
                <span class="p">{</span>
                    <span class="c1">// すでに左側の頂点が設定されているか（3頂点が左右に振り分けられるため、必ず左右どちらかは2つの頂点を持つことになる）</span>
                    <span class="k">if</span> <span class="p">(!</span><span class="n">didset_left</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">didset_left</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

                        <span class="c1">// ここは0,1ともに同じ値にしているのは、続く処理で</span>
                        <span class="c1">// leftPoints[0,1]の値を使って分割点を求める処理をしているため。</span>
                        <span class="c1">// つまり、アクセスされる可能性がある</span>

                        <span class="c1">// 頂点の設定</span>
                        <span class="n">leftPoints</span><span class="p">[</span><span class="m">0</span><span class="p">]</span>  <span class="p">=</span> <span class="n">victim_mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
                        <span class="n">leftPoints</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="p">=</span> <span class="n">leftPoints</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>

                        <span class="c1">// UVの設定</span>
                        <span class="n">leftUvs</span><span class="p">[</span><span class="m">0</span><span class="p">]</span>     <span class="p">=</span> <span class="n">victim_mesh</span><span class="p">.</span><span class="n">uv</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
                        <span class="n">leftUvs</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>     <span class="p">=</span> <span class="n">leftUvs</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>

                        <span class="c1">// 法線の設定</span>
                        <span class="n">leftNormals</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="n">victim_mesh</span><span class="p">.</span><span class="n">normals</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
                        <span class="n">leftNormals</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="n">leftNormals</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
                    <span class="p">}</span>
                    <span class="k">else</span>
                    <span class="p">{</span>
                        <span class="c1">// 2頂点目の場合は2番目に直接頂点情報を設定する</span>
                        <span class="n">leftPoints</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="p">=</span> <span class="n">victim_mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
                        <span class="n">leftUvs</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>     <span class="p">=</span> <span class="n">victim_mesh</span><span class="p">.</span><span class="n">uv</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
                        <span class="n">leftNormals</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="n">victim_mesh</span><span class="p">.</span><span class="n">normals</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="c1">// 左と同様の操作を右にも行う</span>
                    <span class="k">if</span> <span class="p">(!</span><span class="n">didset_right</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">didset_right</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

                        <span class="n">rightPoints</span><span class="p">[</span><span class="m">0</span><span class="p">]</span>  <span class="p">=</span> <span class="n">victim_mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
                        <span class="n">rightPoints</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="p">=</span> <span class="n">rightPoints</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
                        <span class="n">rightUvs</span><span class="p">[</span><span class="m">0</span><span class="p">]</span>     <span class="p">=</span> <span class="n">victim_mesh</span><span class="p">.</span><span class="n">uv</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
                        <span class="n">rightUvs</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>     <span class="p">=</span> <span class="n">rightUvs</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
                        <span class="n">rightNormals</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="n">victim_mesh</span><span class="p">.</span><span class="n">normals</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
                        <span class="n">rightNormals</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="n">rightNormals</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
                    <span class="p">}</span>
                    <span class="k">else</span>
                    <span class="p">{</span>
                        <span class="n">rightPoints</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="p">=</span> <span class="n">victim_mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
                        <span class="n">rightUvs</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>     <span class="p">=</span> <span class="n">victim_mesh</span><span class="p">.</span><span class="n">uv</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
                        <span class="n">rightNormals</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="n">victim_mesh</span><span class="p">.</span><span class="n">normals</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// 分割された点の比率計算のための距離</span>
            <span class="kt">float</span> <span class="n">normalizedDistance</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>

            <span class="c1">// 距離</span>
            <span class="kt">float</span> <span class="n">distance</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>


            <span class="c1">// ---------------------------</span>
            <span class="c1">// 左側の処理</span>

            <span class="c1">// 定義した面と交差する点を探す。</span>
            <span class="c1">// つまり、平面によって分割される点を探す。</span>
            <span class="c1">// 左の点を起点に、右の点に向けたレイを飛ばし、その分割点を探る。</span>
            <span class="n">blade</span><span class="p">.</span><span class="nf">Raycast</span><span class="p">(</span><span class="k">new</span> <span class="nf">Ray</span><span class="p">(</span><span class="n">leftPoints</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="p">(</span><span class="n">rightPoints</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">-</span> <span class="n">leftPoints</span><span class="p">[</span><span class="m">0</span><span class="p">]).</span><span class="n">normalized</span><span class="p">),</span> <span class="k">out</span> <span class="n">distance</span><span class="p">);</span>

            <span class="c1">// 見つかった交差点を、頂点間の距離で割ることで、分割点の左右の割合を算出する</span>
            <span class="n">normalizedDistance</span> <span class="p">=</span> <span class="n">distance</span> <span class="p">/</span> <span class="p">(</span><span class="n">rightPoints</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">-</span> <span class="n">leftPoints</span><span class="p">[</span><span class="m">0</span><span class="p">]).</span><span class="n">magnitude</span><span class="p">;</span>

            <span class="c1">// カット後の新頂点に対する処理。フラグメントシェーダでの補完と同じく、分割した位置に応じて適切に補完した値を設定する</span>
            <span class="n">Vector3</span> <span class="n">newVertex1</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Lerp</span><span class="p">(</span><span class="n">leftPoints</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">rightPoints</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">normalizedDistance</span><span class="p">);</span>
            <span class="n">Vector2</span> <span class="n">newUv1</span>     <span class="p">=</span> <span class="n">Vector2</span><span class="p">.</span><span class="nf">Lerp</span><span class="p">(</span><span class="n">leftUvs</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">rightUvs</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">normalizedDistance</span><span class="p">);</span>
            <span class="n">Vector3</span> <span class="n">newNormal1</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Lerp</span><span class="p">(</span><span class="n">leftNormals</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">,</span> <span class="n">rightNormals</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">normalizedDistance</span><span class="p">);</span>

            <span class="c1">// 新頂点郡に新しい頂点を追加</span>
            <span class="n">new_vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">newVertex1</span><span class="p">);</span>


            <span class="c1">// ---------------------------</span>
            <span class="c1">// 右側の処理</span>

            <span class="n">blade</span><span class="p">.</span><span class="nf">Raycast</span><span class="p">(</span><span class="k">new</span> <span class="nf">Ray</span><span class="p">(</span><span class="n">leftPoints</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="p">(</span><span class="n">rightPoints</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">-</span> <span class="n">leftPoints</span><span class="p">[</span><span class="m">1</span><span class="p">]).</span><span class="n">normalized</span><span class="p">),</span> <span class="k">out</span> <span class="n">distance</span><span class="p">);</span>

            <span class="n">normalizedDistance</span> <span class="p">=</span> <span class="n">distance</span> <span class="p">/</span> <span class="p">(</span><span class="n">rightPoints</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">-</span> <span class="n">leftPoints</span><span class="p">[</span><span class="m">1</span><span class="p">]).</span><span class="n">magnitude</span><span class="p">;</span>
            <span class="n">Vector3</span> <span class="n">newVertex2</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Lerp</span><span class="p">(</span><span class="n">leftPoints</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">rightPoints</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">normalizedDistance</span><span class="p">);</span>
            <span class="n">Vector2</span> <span class="n">newUv2</span>     <span class="p">=</span> <span class="n">Vector2</span><span class="p">.</span><span class="nf">Lerp</span><span class="p">(</span><span class="n">leftUvs</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">rightUvs</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">normalizedDistance</span><span class="p">);</span>
            <span class="n">Vector3</span> <span class="n">newNormal2</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Lerp</span><span class="p">(</span><span class="n">leftNormals</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">,</span> <span class="n">rightNormals</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">normalizedDistance</span><span class="p">);</span>

            <span class="c1">// 新頂点郡に新しい頂点を追加</span>
            <span class="n">new_vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">newVertex2</span><span class="p">);</span>


            <span class="c1">// 計算された新しい頂点を使って、新トライアングルを左右ともに追加する</span>
            <span class="c1">// memo: どう分割されても、左右どちらかは1つの三角形になる気がするけど、縮退三角形的な感じでとにかく2つずつ追加している感じだろうか？</span>
            <span class="n">left_side</span><span class="p">.</span><span class="nf">AddTriangle</span><span class="p">(</span>
                <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span><span class="n">leftPoints</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">newVertex1</span><span class="p">,</span> <span class="n">newVertex2</span><span class="p">},</span>
                <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span><span class="n">leftNormals</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">newNormal1</span><span class="p">,</span> <span class="n">newNormal2</span> <span class="p">},</span>
                <span class="k">new</span> <span class="n">Vector2</span><span class="p">[]{</span><span class="n">leftUvs</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">newUv1</span><span class="p">,</span> <span class="n">newUv2</span><span class="p">},</span>
                <span class="n">newNormal1</span><span class="p">,</span>
                <span class="n">submesh</span>
            <span class="p">);</span>

            <span class="n">left_side</span><span class="p">.</span><span class="nf">AddTriangle</span><span class="p">(</span>
                <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span><span class="n">leftPoints</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">leftPoints</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">newVertex2</span><span class="p">},</span>
                <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span><span class="n">leftNormals</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">leftNormals</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">newNormal2</span><span class="p">},</span>
                <span class="k">new</span> <span class="n">Vector2</span><span class="p">[]{</span><span class="n">leftUvs</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">leftUvs</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">newUv2</span><span class="p">},</span>
                <span class="n">newNormal2</span><span class="p">,</span>
                <span class="n">submesh</span>
            <span class="p">);</span>

            <span class="n">right_side</span><span class="p">.</span><span class="nf">AddTriangle</span><span class="p">(</span>
                <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span><span class="n">rightPoints</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">newVertex1</span><span class="p">,</span> <span class="n">newVertex2</span><span class="p">},</span>
                <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span><span class="n">rightNormals</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">newNormal1</span><span class="p">,</span> <span class="n">newNormal2</span><span class="p">},</span>
                <span class="k">new</span> <span class="n">Vector2</span><span class="p">[]{</span><span class="n">rightUvs</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">newUv1</span><span class="p">,</span> <span class="n">newUv2</span><span class="p">},</span>
                <span class="n">newNormal1</span><span class="p">,</span>
                <span class="n">submesh</span>
            <span class="p">);</span>

            <span class="n">right_side</span><span class="p">.</span><span class="nf">AddTriangle</span><span class="p">(</span>
                <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span><span class="n">rightPoints</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">rightPoints</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">newVertex2</span><span class="p">},</span>
                <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span><span class="n">rightNormals</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">rightNormals</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">newNormal2</span><span class="p">},</span>
                <span class="k">new</span> <span class="n">Vector2</span><span class="p">[]{</span><span class="n">rightUvs</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">rightUvs</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">newUv2</span><span class="p">},</span>
                <span class="n">newNormal2</span><span class="p">,</span>
                <span class="n">submesh</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">static</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;</span> <span class="n">capVertTracker</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;();</span>
        <span class="k">private</span> <span class="k">static</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;</span> <span class="n">capVertpolygon</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;();</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// カットを実行</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Capping</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// カット用頂点追跡リスト</span>
            <span class="c1">// 具体的には新頂点全部に対する調査を行う。その過程で調査済みをマークする目的で利用する。</span>
            <span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

            <span class="c1">// 新しく生成した頂点分だけループする＝全新頂点に対してポリゴンを形成するため調査を行う</span>
            <span class="c1">// 具体的には、カット面を構成するポリゴンを形成するため、カット時に重複した頂点を網羅して「面」を形成する頂点を調査する</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">new_vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="c1">// 対象頂点がすでに調査済みのマークされて（追跡配列に含まれて）いたらスキップ</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="p">{</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="c1">// カット用ポリゴン配列をクリア</span>
                <span class="n">capVertpolygon</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

                <span class="c1">// 調査頂点と次の頂点をポリゴン配列に保持する</span>
                <span class="n">capVertpolygon</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">0</span><span class="p">]);</span>
                <span class="n">capVertpolygon</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">]);</span>

                <span class="c1">// 追跡配列に自身と次の頂点を追加する（調査済みのマークをつける）</span>
                <span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">0</span><span class="p">]);</span>
                <span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">]);</span>

                <span class="c1">// 重複頂点がなくなるまでループし調査する</span>
                <span class="kt">bool</span> <span class="n">isDone</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                <span class="k">while</span> <span class="p">(!</span><span class="n">isDone</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">isDone</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

                    <span class="c1">// 新頂点郡をループし、「面」を構成する要因となる頂点をすべて抽出する。抽出が終わるまでループを繰り返す</span>
                    <span class="c1">// 2頂点ごとに調査を行うため、ループは2単位ですすめる</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">k</span> <span class="p">&lt;</span> <span class="n">new_vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">k</span> <span class="p">+=</span> <span class="m">2</span><span class="p">)</span>
                    <span class="p">{</span> <span class="c1">// go through the pairs</span>
                        <span class="c1">// ペアとなる頂点を探す</span>
                        <span class="c1">// ここでのペアとは、いちトライアングルから生成される新頂点のペア。</span>
                        <span class="c1">// トライアングルからは必ず2頂点が生成されるため、それを探す。</span>
                        <span class="c1">// また、全ポリゴンに対して分割点を生成しているため、ほぼ必ず、まったく同じ位置に存在する、別トライアングルの分割頂点が存在するはずである。</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">==</span> <span class="n">capVertpolygon</span><span class="p">[</span><span class="n">capVertpolygon</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">]</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span> <span class="p">+</span> <span class="m">1</span><span class="p">]))</span>
                        <span class="p">{</span>   <span class="c1">// if so add the other</span>
                            <span class="c1">// ペアの頂点が見つかったらそれをポリゴン配列に追加し、</span>
                            <span class="c1">// 調査済マークをつけて、次のループ処理に回す</span>
                            <span class="n">isDone</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                            <span class="n">capVertpolygon</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span> <span class="p">+</span> <span class="m">1</span><span class="p">]);</span>
                            <span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span> <span class="p">+</span> <span class="m">1</span><span class="p">]);</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span> <span class="p">+</span> <span class="m">1</span><span class="p">]</span> <span class="p">==</span> <span class="n">capVertpolygon</span><span class="p">[</span><span class="n">capVertpolygon</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">]</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                        <span class="p">{</span>   <span class="c1">// if so add the other</span>
                            <span class="n">isDone</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                            <span class="n">capVertpolygon</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
                            <span class="n">capVertTracker</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">new_vertices</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="c1">// 見つかった頂点郡を元に、ポリゴンを形成する</span>
                <span class="nf">FillCap</span><span class="p">(</span><span class="n">capVertpolygon</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// カット面を埋める？</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="vertices"&gt;ポリゴンを形成する頂点リスト&lt;/param&gt;</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">FillCap</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;</span> <span class="n">vertices</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// center of the cap</span>
            <span class="c1">// カット平面の中心点を計算する</span>
            <span class="n">Vector3</span> <span class="n">center</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>

            <span class="c1">// 引数で渡された頂点位置をすべて合計する</span>
            <span class="k">foreach</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">point</span> <span class="k">in</span> <span class="n">vertices</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">center</span> <span class="p">+=</span> <span class="n">point</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// それを頂点数の合計で割り、中心とする</span>
            <span class="n">center</span> <span class="p">=</span> <span class="n">center</span> <span class="p">/</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span>

            <span class="c1">// you need an axis based on the cap</span>
            <span class="c1">// カット平面をベースにしたupward</span>
            <span class="n">Vector3</span> <span class="n">upward</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>

            <span class="c1">// 90 degree turn</span>
            <span class="c1">// カット平面の法線を利用して、「上」方向を求める</span>
            <span class="c1">// 具体的には、平面の左側を上として利用する</span>
            <span class="n">upward</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span>  <span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
            <span class="n">upward</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="p">-</span><span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
            <span class="n">upward</span><span class="p">.</span><span class="n">z</span> <span class="p">=</span>  <span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>

            <span class="c1">// 法線と「上方向」から、横軸を算出</span>
            <span class="n">Vector3</span> <span class="n">left</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Cross</span><span class="p">(</span><span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="n">upward</span><span class="p">);</span>

            <span class="n">Vector3</span> <span class="n">displacement</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
            <span class="n">Vector3</span> <span class="n">newUV1</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
            <span class="n">Vector3</span> <span class="n">newUV2</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>

            <span class="c1">// 引数で与えられた頂点分ループを回す</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="c1">// 計算で求めた中心点から、各頂点への方向ベクトル</span>
                <span class="n">displacement</span> <span class="p">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">-</span> <span class="n">center</span><span class="p">;</span>

                <span class="c1">// 新規生成するポリゴンのUV座標を求める。</span>
                <span class="c1">// displacementが中心からのベクトルのため、UV的な中心である0.5をベースに、内積を使ってUVの最終的な位置を得る</span>
                <span class="n">newUV1</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
                <span class="n">newUV1</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="m">0.5f</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">left</span><span class="p">);</span>
                <span class="n">newUV1</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="m">0.5f</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">upward</span><span class="p">);</span>
                <span class="n">newUV1</span><span class="p">.</span><span class="n">z</span> <span class="p">=</span> <span class="m">0.5f</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>

                <span class="c1">// 次の頂点。ただし、最後の頂点の次は最初の頂点を利用するため、若干トリッキーな指定方法をしている（% vertices.Count）</span>
                <span class="n">displacement</span> <span class="p">=</span> <span class="n">vertices</span><span class="p">[(</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span> <span class="p">%</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">]</span> <span class="p">-</span> <span class="n">center</span><span class="p">;</span>

                <span class="n">newUV2</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
                <span class="n">newUV2</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="m">0.5f</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">left</span><span class="p">);</span>
                <span class="n">newUV2</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="m">0.5f</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">upward</span><span class="p">);</span>
                <span class="n">newUV2</span><span class="p">.</span><span class="n">z</span> <span class="p">=</span> <span class="m">0.5f</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>

                <span class="c1">// uvs.Add(new Vector2(relativePosition.x, relativePosition.y));</span>
                <span class="c1">// normals.Add(blade.normal);</span>

                <span class="c1">// 左側のポリゴンとして、求めたUVを利用してトライアングルを追加</span>
                <span class="n">left_side</span><span class="p">.</span><span class="nf">AddTriangle</span><span class="p">(</span>
                    <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span>
                        <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">vertices</span><span class="p">[(</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span> <span class="p">%</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">],</span>
                        <span class="n">center</span>
                    <span class="p">},</span>
                    <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span>
                        <span class="p">-</span><span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span>
                        <span class="p">-</span><span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span>
                        <span class="p">-</span><span class="n">blade</span><span class="p">.</span><span class="n">normal</span>
                    <span class="p">},</span>
                    <span class="k">new</span> <span class="n">Vector2</span><span class="p">[]{</span>
                        <span class="n">newUV1</span><span class="p">,</span>
                        <span class="n">newUV2</span><span class="p">,</span>
                        <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">0.5f</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">)</span>
                    <span class="p">},</span>
                    <span class="p">-</span><span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span>
                    <span class="n">left_side</span><span class="p">.</span><span class="n">subIndices</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span> <span class="c1">// カット面。最後のサブメッシュとしてトライアングルを追加</span>
                <span class="p">);</span>

                <span class="c1">// 右側のトライアングル。基本は左側と同じだが、法線だけ逆向き。</span>
                <span class="n">right_side</span><span class="p">.</span><span class="nf">AddTriangle</span><span class="p">(</span>
                    <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span>
                        <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">vertices</span><span class="p">[(</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span> <span class="p">%</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">],</span>
                        <span class="n">center</span>
                    <span class="p">},</span>
                    <span class="k">new</span> <span class="n">Vector3</span><span class="p">[]{</span>
                        <span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span>
                        <span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span>
                        <span class="n">blade</span><span class="p">.</span><span class="n">normal</span>
                    <span class="p">},</span>
                    <span class="k">new</span> <span class="n">Vector2</span><span class="p">[]{</span>
                        <span class="n">newUV1</span><span class="p">,</span>
                        <span class="n">newUV2</span><span class="p">,</span>
                        <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">0.5f</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">)</span>
                    <span class="p">},</span>
                    <span class="n">blade</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span>
                    <span class="n">right_side</span><span class="p">.</span><span class="n">subIndices</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span> <span class="c1">// カット面。最後のサブメッシュとしてトライアングルを追加</span>
                <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fedo_m18%2Fitems%2F31961cd19fd19e09b675&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fedo_m18%2Fitems%2F31961cd19fd19e09b675&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/edo_m18/items/31961cd19fd19e09b675/likers" class="css-1iupg5d">142</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">124</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/31961cd19fd19e09b675/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/edo_m18/items/31961cd19fd19e09b675/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/edo_m18/items/31961cd19fd19e09b675/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/edo_m18/items/31961cd19fd19e09b675/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/edo_m18/items/31961cd19fd19e09b675.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-7108b763-a505-444a-8ae9-3763da5a75f3">{"authorAnalyticsTrackingId":"UA-42967648-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-7a35f367-a2bf-44bc-bcaf-12e25d1658e6"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-7a35f367-a2bf-44bc-bcaf-12e25d1658e6">{}</script>
      
<div id="LoginModal-react-component-a29c099a-e9dd-4221-943b-7efe292f76bd"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-a29c099a-e9dd-4221-943b-7efe292f76bd">{}</script>
      
<div id="StockModal-react-component-7b6b4804-3229-4b0b-80f2-56e4694d8d8b"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-7b6b4804-3229-4b0b-80f2-56e4694d8d8b">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;dNBsH7LptP0QZzW8vYc3u3RPYN1fwjtUMC1a0ySMri0pMfrLxZKwL0bnWIfavsVrPH3VU0EhtYVRuEX3GnjqYQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch2\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h2\u003e\n\n\u003cp\u003eUnity以外でもそうですが、メッシュは頂点の塊です。\u003cbr\u003e\nそしてそれらはTriangleやそれらを結ぶIndexで構成されています。\u003cbr\u003e\nつまり、勝手に順番を変えてしまうと頂点の情報はぐちゃぐちゃになってしまい、ちゃんとしたオブジェクトとして表示することはできません。\u003cbr\u003e\nそのため、メッシュを切断して別のオブジェクトに分けようとすると、それなりに頂点郡を計算してポリゴンを縫い合わせてやる必要があります。\u003c/p\u003e\n\n\u003cp\u003e今回はそんなメッシュのカットを行うサンプルを公開してくれている人がいたので、そのサンプルを読んだメモを書いていきます。\u003c/p\u003e\n\n\u003cp\u003e実際に実行してみたのが以下のものです↓\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/bc51fb900d56ecd456eb592ad1558292c0c74039/68747470733a2f2f692e6779617a6f2e636f6d2f64343233663964616233613239326435373066376266306264303164643461302e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.gyazo.com%2Fd423f9dab3a292d570f7bf0bd01dd4a0.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=960ac4a8890ff9b4c11b796cc63487c5\" alt=\"\" data-canonical-src=\"https://i.gyazo.com/d423f9dab3a292d570f7bf0bd01dd4a0.gif\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.gyazo.com%2Fd423f9dab3a292d570f7bf0bd01dd4a0.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=103105bdc859453664ddf0ba596a1217 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e左側の3本のラインがカット面を示していて、その平面できれいに切断されているのが分かるかと思います。\u003cbr\u003e\nしかも、しっかりと切断面に別のマテリアルが割り当てられているのにも注目です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"大まかな流れ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%A4%A7%E3%81%BE%E3%81%8B%E3%81%AA%E6%B5%81%E3%82%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e大まかな流れ\u003c/h2\u003e\n\n\u003cp\u003eまずは大まかな流れから説明します。\u003cbr\u003e\n具体的になにをしているかを見るよりも、切断に必要な処理がなんなのか、という視点で見てもらうといいかと思います。\u003cbr\u003e\n全体像を把握した上でコードを読んでいくと処理内容が推測しやすくなり、理解を促すはずです。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e切断する平面を定義する\u003c/li\u003e\n\u003cli\u003e切断するオブジェクトを選択する\u003c/li\u003e\n\u003cli\u003e選択されたメッシュの全頂点に対し、平面の左側か右側かを計算する\u003cbr\u003e\n\u003cem\u003e※ 評価する単位はポリゴン（トライアングル）単位で行う\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003e(3)の際、3頂点すべてが平面の左か右のどちらかに寄っている場合は切断対象外なので、左側か右側かだけを判別して適切に頂点を保持する\u003cbr\u003e\n\u003cem\u003e※ 最終的にふたつのオブジェクトに分割するため、左右の頂点情報などを保持するオブジェクトを用意してそれに格納する\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003e(3)の際、3頂点が平面の左右にバラけた場合に切断処理を実行する\u003c/li\u003e\n\u003cli\u003e切断処理はまず、3頂点がそれぞれ平面の左右どちらにあるかを判断し、(3)同様に適切に振り分ける\u003c/li\u003e\n\u003cli\u003eその後、切断平面と重なる2頂点を新しい頂点として計算する（※1）\u003c/li\u003e\n\u003cli\u003eすべての頂点に対して振り分けおよび頂点の生成が終わったら、(7)で生成した新頂点すべてに対しペアを算出しポリゴンを形成する\u003c/li\u003e\n\u003cli\u003e最後に、生成したポリゴンを用いて切断面を定義し、新しいマテリアルを適用する\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e※1 ... 三角形（ポリゴン）を線（平面）で分断するとどこをどう切っても必ず2辺と交わる。つまり\u003cstrong\u003e新しい頂点は2つ\u003c/strong\u003e作られる。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/afd1f1ac281adbd785913174bd2ebe0c41ef98b8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f353631362f62323130656330342d633965632d333364372d323433392d3865636635336635643338342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2Fb210ec04-c9ec-33d7-2439-8ecf53f5d384.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4daf857adeb2d43772e4d31bd6af215e\" alt=\"cut-triangles.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/5616/b210ec04-c9ec-33d7-2439-8ecf53f5d384.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2Fb210ec04-c9ec-33d7-2439-8ecf53f5d384.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=aa90eeff2c9be2e9bd98c752cada55de 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003cem\u003eどれかの辺に平行でない限り、必ず2辺と交わる\u003c/em\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"実装と考え方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85%E3%81%A8%E8%80%83%E3%81%88%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装と考え方\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"頂点が平面のどちら側にあるかを調べる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%A0%82%E7%82%B9%E3%81%8C%E5%B9%B3%E9%9D%A2%E3%81%AE%E3%81%A9%E3%81%A1%E3%82%89%E5%81%B4%E3%81%AB%E3%81%82%E3%82%8B%E3%81%8B%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e頂点が平面のどちら側にあるかを調べる\u003c/h3\u003e\n\n\u003cp\u003e頂点が平面のどちら側にあるかは内積を使って簡単に調べることができます。\u003cbr\u003e\n具体的には、点 $p$ と、平面の位置 $p_0$、および面の法線 $n$ を使って、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e(p - p_0) \\cdot n \u0026lt; 0 ... 裏  \\\\\n(p - p_0) \\cdot n \u0026gt; 0 ... 表  \\\\\n(p - p_0) \\cdot n = 0 ... 平面上\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとして計算することができます。\u003cbr\u003e\n\u003cem\u003eちなみに \u003ccode\u003eUnityEngine.Plane\u003c/code\u003e クラスにはこうした平面に対する処理を簡単にしてくれるメソッドが多数あるので、実際はそちらを利用したほうが手軽です。\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eサンプルのコードを抜粋すると以下になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetSide\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetSide\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetSide\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれは、切断対象となったメッシュの、計算中の頂点が平面のどちらにあるかを \u003ccode\u003ebool\u003c/code\u003e で取得している部分です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"平面に分断された点を求める\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%B9%B3%E9%9D%A2%E3%81%AB%E5%88%86%E6%96%AD%E3%81%95%E3%82%8C%E3%81%9F%E7%82%B9%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e平面に分断された点を求める\u003c/h3\u003e\n\n\u003cp\u003eさて、上記の平面の表裏の判定により、大部分の頂点は左右に適切に振り分けることができます。\u003cbr\u003e\n残るは、平面と交差しているポリゴンの各辺を分離して、新しい頂点を得ることができれば、ひとまずすべての頂点を左右に振り分け、かつ切断面に使える頂点郡を得ることができます。\u003c/p\u003e\n\n\u003cp\u003eということで、辺を分断する頂点の求め方です。\u003c/p\u003e\n\n\u003cp\u003e色々文章で説明する前に、下の図を見てもらうと分かりやすいかと思います。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/a1a61dc8de3ed451eee6e8ae7093b404cc4f6c5d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f353631362f61386665613133662d613365312d643965342d343534362d6132656661383061613666342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2Fa8fea13f-a3e1-d9e4-4546-a2efa80aa6f4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5fd29b2b6b44db83ca2b96cf6c0ab84c\" alt=\"平面分割.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/5616/a8fea13f-a3e1-d9e4-4546-a2efa80aa6f4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2Fa8fea13f-a3e1-d9e4-4546-a2efa80aa6f4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b650b1093a82e8cdf3c440af6bb86bc0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eグラデーションがかかっている平面が切断面です。\u003cbr\u003e\nこの平面により、頂点が左右どちらかに分断されます。\u003c/p\u003e\n\n\u003cp\u003e図では $p_0$ と $p_1$ が平面の左側、$p_2$ が平面の右側、そして黄色い点が分断された頂点になります。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"平面方向への距離を算出する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%B9%B3%E9%9D%A2%E6%96%B9%E5%90%91%E3%81%B8%E3%81%AE%E8%B7%9D%E9%9B%A2%E3%82%92%E7%AE%97%E5%87%BA%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e平面方向への距離を算出する\u003c/h4\u003e\n\n\u003cp\u003e点の割り出し方は、$p_0$ および $p_1$ から、$p_2$ 方向への距離を算出します。（$\\vec{p_2 p_0}$ と $\\vec{p_2 p_1}$）\u003cbr\u003e\n（平面への距離の算出は、以前書いた「\u003ca href=\"http://qiita.com/edo_m18/items/c8808f318f5abfa8af1e\" id=\"reference-901f38ced984ee8183bb\"\u003e[Unity] 任意の無限遠の平面とベクトルとの交点を求める\u003c/a\u003e」を見てもらうと分かるかと思います）\u003c/p\u003e\n\n\u003cp\u003eが、上の方でも書きましたが、\u003ccode\u003eUnityEngine.Plane\u003c/code\u003e クラスにはこの距離を算出するのに適したメソッドがあります。\u003cbr\u003e\n参考にしたコードでもそれを利用して計算を行っています。\u003cbr\u003e\nその部分だけを抜粋すると、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRaycast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]).\u003c/span\u003e\u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003edistance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eここで \u003ccode\u003eblade\u003c/code\u003e は切断面を表す \u003ccode\u003eUnityEngine.Plane\u003c/code\u003e クラスのインスタンスです。\u003cbr\u003e\nこれに \u003ccode\u003eRaycast\u003c/code\u003e メソッドがあり、レイを飛ばしてやることで、任意の点と方向を元に、平面への距離を算出することができます。\u003cbr\u003e\n（上の例では \u003ccode\u003eout distance\u003c/code\u003e に距離が入り、メソッド自体は、平面とレイが交差する場合に \u003ccode\u003etrue\u003c/code\u003e を返します）\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"辺と距離から切断頂点を求める\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%BE%BA%E3%81%A8%E8%B7%9D%E9%9B%A2%E3%81%8B%E3%82%89%E5%88%87%E6%96%AD%E9%A0%82%E7%82%B9%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e辺と距離から切断頂点を求める\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003eRaycast\u003c/code\u003e を用いて切断頂点までの「距離」を求めることができました。\u003cbr\u003e\nただこれはスカラー値で、あくまで「距離」しか分かりません。\u003cbr\u003e\nしかし、辺の長さとの比率と各頂点情報から平面上の頂点（つまり分断点）を求めることができます。\u003c/p\u003e\n\n\u003cp\u003e具体的には\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e辺の長さを計算する\u003c/li\u003e\n\u003cli\u003e「頂点までの距離 / 辺の長さ」＝ 比率\u003c/li\u003e\n\u003cli\u003e辺の両端の点の間を(2)の比率で補完する\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eこの3工程を行うことで頂点を求めることができます。\u003cbr\u003e\nこれを、分断された辺の分、つまり2辺分行うことで分断された頂点を求めることができる、というわけです。\u003c/p\u003e\n\n\u003cp\u003eサンプルコードの該当部分を抜粋すると以下のような形になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// ---------------------------\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 左側の処理\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 定義した面と交差する点を探す。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// つまり、平面によって分割される点を探す。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 左の点を起点に、右の点に向けたレイを飛ばし、その分割点を探る。\u003c/span\u003e\n\u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRaycast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]).\u003c/span\u003e\u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003edistance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 見つかった交差点を、頂点間の距離で割ることで、分割点の左右の割合を算出する\u003c/span\u003e\n\u003cspan class=\"n\"\u003enormalizedDistance\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edistance\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]).\u003c/span\u003e\u003cspan class=\"n\"\u003emagnitude\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// カット後の新頂点に対する処理。フラグメントシェーダでの補完と同じく、分割した位置に応じて適切に補完した値を設定する\u003c/span\u003e\n\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003enewVertex1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLerp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eVector2\u003c/span\u003e \u003cspan class=\"n\"\u003enewUv1\u003c/span\u003e     \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLerp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleftUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003erightUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003enewNormal1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLerp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleftNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erightNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 新頂点郡に新しい頂点を追加\u003c/span\u003e\n\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enewVertex1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cem\u003e↑の日本語は解説用に自分が付け加えたコメントです。\u003c/em\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"切断面を構築する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%87%E6%96%AD%E9%9D%A2%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e切断面を構築する\u003c/h3\u003e\n\n\u003cp\u003e上記までで全頂点の振り分け、および新頂点の算出が終わりました。\u003cbr\u003e\n最後は、新しく生成された頂点を利用して、切断面のポリゴンを形成します。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"新頂点のペアを選択しポリゴンを形成する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%B0%E9%A0%82%E7%82%B9%E3%81%AE%E3%83%9A%E3%82%A2%E3%82%92%E9%81%B8%E6%8A%9E%E3%81%97%E3%83%9D%E3%83%AA%E3%82%B4%E3%83%B3%E3%82%92%E5%BD%A2%E6%88%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e新頂点のペアを選択し、ポリゴンを形成する\u003c/h4\u003e\n\n\u003cp\u003e切断面の形成には、上記で算出した新頂点を使って行います。\u003cbr\u003e\n基本的な考え方は以下のフローになります。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e生成された頂点郡からペアとなる頂点を探し、それを順番に配列に格納する（※1）\u003c/li\u003e\n\u003cli\u003e新頂点のペアの探索が終わった段階でペアごとの順番に配列が形成されている\u003c/li\u003e\n\u003cli\u003e(1)の配列の重心を計算する（単純に全頂点足して、頂点数で割る）\u003c/li\u003e\n\u003cli\u003e(3)で算出した重心と、配列の頂点を使ってポリゴンを形成する\u003c/li\u003e\n\u003cli\u003e(4)のポリゴンを、左右のメッシュそれぞれに追加する\u003c/li\u003e\n\u003cli\u003eその際、左右でポリゴンの法線を逆向きにする（※2）\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e※1 ... 切断対象となったポリゴンから必ず2頂点が生成される\u003cbr\u003e\n※2 ... 切断面は左右のオブジェクトそれぞれに必要で、単純に向きが逆のため\u003c/p\u003e\n\n\u003cp\u003e該当のコードを示すと以下になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// カットを実行\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCapping\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// カット用頂点追跡リスト\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 具体的には新頂点全部に対する調査を行う。その過程で調査済みをマークする目的で利用する。\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 新しく生成した頂点分だけループする＝全新頂点に対してポリゴンを形成するため調査を行う\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 具体的には、カット面を構成するポリゴンを形成するため、カット時に重複した頂点を網羅して「面」を形成する頂点を調査する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 対象頂点がすでに調査済みのマークされて（追跡配列に含まれて）いたらスキップ\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// カット用ポリゴン配列をクリア\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 調査頂点と次の頂点をポリゴン配列に保持する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 追跡配列に自身と次の頂点を追加する（調査済みのマークをつける）\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 重複頂点がなくなるまでループし調査する\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisDone\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003eisDone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eisDone\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 新頂点郡をループし、「面」を構成する要因となる頂点をすべて抽出する。抽出が終わるまでループを繰り返す\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 2頂点ごとに調査を行うため、ループは2単位ですすめる\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// go through the pairs\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// ペアとなる頂点を探す\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// ここでのペアとは、いちトライアングルから生成される新頂点のペア。\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// トライアングルからは必ず2頂点が生成されるため、それを探す。\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// また、全ポリゴンに対して分割点を生成しているため、ほぼ必ず、まったく同じ位置に存在する、別トライアングルの分割頂点が存在するはずである。\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// if so add the other\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// ペアの頂点が見つかったらそれをポリゴン配列に追加し、\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 調査済マークをつけて、次のループ処理に回す\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eisDone\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// if so add the other\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eisDone\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 見つかった頂点郡を元に、ポリゴンを形成する\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eFillCap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e上記のコードを理解する上で地味にポイントだったのは、重複する頂点が存在する、という点。\u003cbr\u003e\n簡単のためにまず板ポリを考えてみます。\u003c/p\u003e\n\n\u003cp\u003eすると、板ポリは2枚のポリゴンで形成されますが、これを切断すると新頂点は\u003cstrong\u003e4つ\u003c/strong\u003e生成されます。\u003cbr\u003e\n三角形（ポリゴン）1枚に対して2頂点生成されるからですね。\u003cbr\u003e\nそして重複する点は1つです。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/882852ed4b1a91a2d523634376bd97dfb9734312/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f353631362f35323934383335382d343838612d333137622d373362302d6337633536663536373936652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2F52948358-488a-317b-73b0-c7c56f56796e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b2a5ead9321807bfccd96024ef749da9\" alt=\"切断頂点.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/5616/52948358-488a-317b-73b0-c7c56f56796e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2F52948358-488a-317b-73b0-c7c56f56796e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=01e06a2e6384f15895f2a9037e737574 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e上記画像の左右の頂点はそれぞれの色に対応したポリゴンから生成された頂点です。\u003cbr\u003e\nそして中央のものが2つの色に分けられていますが、これが重複した頂点になります。\u003cbr\u003e\n左右それぞれのポリゴンから頂点が生成されるので4つ生成されているのが分かるかと思います。\u003c/p\u003e\n\n\u003cp\u003eさて、今度はこれをキューブに拡張して考えると、先程は重複しなかった両端の点も、キューブの側面側の頂点と重複することになります。\u003cbr\u003e\n結果としてすべての新頂点が必ず2つずつ重なることになります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/9d958f237853381d58b13ef9ce88f67dc2bcdbe2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f353631362f65373362646231312d363066342d636535612d383263332d3230356439373965613166312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2Fe73bdb11-60f4-ce5a-82c3-205d979ea1f1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1be044c7dccbffeefaae6569611df1c4\" alt=\"切断キューブ.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/5616/e73bdb11-60f4-ce5a-82c3-205d979ea1f1.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2Fe73bdb11-60f4-ce5a-82c3-205d979ea1f1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=524fb8bf5fe3a2b83677ec2fa9c823ba 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eなので冒頭の動画のように、キューブを切断すると新頂点は16個生成され、実際に切断面のポリゴンとして利用される頂点は8つになります。\u003cbr\u003e\n実際に、上図の点を数えると8個あるのが分かるかと思います。それぞれが重複しているため、新頂点として生成されるのは16、ということですね。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"カット面をグルーピングする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AB%E3%83%83%E3%83%88%E9%9D%A2%E3%82%92%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%94%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eカット面をグルーピングする\u003c/h3\u003e\n\n\u003cp\u003e上記の\u003ccode\u003efor\u003c/code\u003e文の入れ子になっている方（\u003ccode\u003ek += 2\u003c/code\u003eで回している方）は、ここで生成された重複頂点を調べてグルーピングする役割を担っています。\u003cbr\u003e\nすでに説明したように、Cubeを切断した場合、Cubeをぐるっと取り囲むように16個の頂点が作られます。\u003c/p\u003e\n\n\u003cp\u003e対象がCubeひとつならこの頂点郡をひとつのカット面として利用しても問題ありませんが、大体の場合はモデルは複雑な形状をしています。\u003c/p\u003e\n\n\u003cp\u003e例えば角を持つモンスターが腕を振り上げているシーンを想像してください。\u003cbr\u003e\nそしてその振り上げた手と角を一度に切断した場合、角の部分と腕の部分、それぞれ「ふたつのカット面」が生成されるのがイメージできるかと思います。\u003cbr\u003e\nこの「角」と「腕」のカット面を形成する頂点郡をグルーピングするのが前述のグルーピングの役割、と書いた意味です。\u003c/p\u003e\n\n\u003cp\u003e実装としてはシンプルです。\u003cbr\u003e\n上記では「角」と「腕」を例に出しました。\u003cbr\u003e\nそして大体の場合において、このふたつのカット平面の頂点は重なることがありません。\u003c/p\u003e\n\n\u003cp\u003eつまり、入れ子の\u003ccode\u003efor\u003c/code\u003e文が行っているのは、必ず重複頂点が生成される事実を利用して、重複頂点を結んでいくことで「角」と「腕」のカット面を意味的にふたつにグルーピングしている、というわけです。\u003c/p\u003e\n\n\u003cp\u003e上の板ポリの例で言えば、最初に青い色の頂点をグループに追加し、そこから調査を開始します。（調査用のリストとして\u003ccode\u003ecapVertTracker\u003c/code\u003eを利用しています）\u003cbr\u003e\n最後に追加した頂点と同じ位置にある頂点を探します。\u003cbr\u003e\nすると、重複した位置にある黄色い頂点が見つかります。\u003c/p\u003e\n\n\u003cp\u003eそして「\u003cstrong\u003e見つかった頂点の次の頂点\u003c/strong\u003e」を\u003ccode\u003ecapVertTracker\u003c/code\u003eリストに加え、再度検索を行います。（板ポリの例で言えば右端の黄色い頂点）\u003cbr\u003e\n板ポリではこれでグルーピングが完了します。\u003c/p\u003e\n\n\u003cp\u003e仮に、板ポリの次に示したCubeの例で言えば連続的に別の面の頂点が見つかります。\u003cbr\u003e\nあとは同じ検索・追加処理を、対象頂点が見つからなくなるまで繰り返すことで、無事にカット面を形成する頂点郡のグルーピングが完成する、というわけです。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"新頂点を結びポリゴンを形成する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%B0%E9%A0%82%E7%82%B9%E3%82%92%E7%B5%90%E3%81%B3%E3%83%9D%E3%83%AA%E3%82%B4%E3%83%B3%E3%82%92%E5%BD%A2%E6%88%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e新頂点を結び、ポリゴンを形成する\u003c/h4\u003e\n\n\u003cp\u003eさぁ、これで必要な情報はすべて整いました。\u003cbr\u003e\nあとは調べられた頂点を使ってポリゴンを形成する、つまり3頂点を選び出してそれを結んでいく作業です。\u003c/p\u003e\n\n\u003cp\u003eただ、上図とコードを見てもらうと分かりますが、新しく生成された頂点は16、うちポリゴン形成に利用するのは8頂点（※）あります。\u003cbr\u003e\nこれをどう結ぶか、を考えないとなりません。\u003c/p\u003e\n\n\u003cp\u003e今回のサンプルではシンプルに、全頂点の平均位置を求め、それと、新頂点を順番に結んで、ピザを切り分けたような形でポリゴンを形成するような処理になっています。\u003c/p\u003e\n\n\u003cp\u003e※ ... 最初、頂点検索のアルゴリズムが分かりづらかったのですが、上のように8頂点を見つけ出す処理でした。が、実はこのアルゴリズムの場合、重複した、同じ位置にある点についてもポリゴンを形成していて、若干冗長な処理になっているようです。（つまり、同じ位置に重なるように2枚のカット平面が存在することになる）\u003cbr\u003e\nただ、負荷的にとても増える、というものでもないのでこのままにしているのだと思います。（Simple Cutって言ってるし）\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/a1f92525b3fbe91be9dc054ecb4abae6bcd355a4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f353631362f32356631316334352d663531382d313864362d663961362d3633323831663161383764332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2F25f11c45-f518-18d6-f9a6-63281f1a87d3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=67e04f79b15841dd2682e33e6412adaf\" alt=\"中心点.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/5616/25f11c45-f518-18d6-f9a6-63281f1a87d3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F5616%2F25f11c45-f518-18d6-f9a6-63281f1a87d3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=67bed7719dab2da96c68111553812b68 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e上記はキューブの断面ではないですが、青い8頂点が新頂点として生成されたもの、として考えてください。\u003cbr\u003e\nこれの平均位置を取ると中心あたりになり、オレンジの点（$c$）となります。\u003c/p\u003e\n\n\u003cp\u003eあとはこれを、順番に結んでいけば切断面のポリゴンが形成できる、というわけです。\u003cbr\u003e\n順番とは、「$1, 2, c$」,「$2, 3, c$」,「$3, 4, c$」... という具合です。\u003c/p\u003e\n\n\u003cp\u003e最後にこの、切断面のポリゴンを形成するコードを以下に示します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// カット面を埋める\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"vertices\"\u0026gt;ポリゴンを形成する頂点リスト\u0026lt;/param\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eFillCap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// center of the cap\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// カット平面の中心点を計算する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 引数で渡された頂点位置をすべて合計する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// それを頂点数の合計で割り、中心とする\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// you need an axis based on the cap\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// カット平面をベースにしたupward\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003eupward\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 90 degree turn\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// カット平面の法線を利用して、「上」方向を求める\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 具体的には、平面の左側を上として利用する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eupward\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e  \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eupward\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eupward\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e  \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 法線と「上方向」から、横軸を算出\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003eleft\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCross\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eupward\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003enewUV1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003enewUV2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 引数で与えられた頂点分ループを回す\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 計算で求めた中心点から、各頂点への方向ベクトル\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 新規生成するポリゴンのUV座標を求める。\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// displacementが中心からのベクトルのため、UV的な中心である0.5をベースに、内積を使ってUVの最終的な位置を得る\u003c/span\u003e\n        \u003cspan class=\"n\"\u003enewUV1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003enewUV1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003enewUV1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eupward\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003enewUV1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 次の頂点。ただし、最後の頂点の次は最初の頂点を利用するため、若干トリッキーな指定方法をしている（% vertices.Count）\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003enewUV2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003enewUV2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003enewUV2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eupward\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003enewUV2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// uvs.Add(new Vector2(relativePosition.x, relativePosition.y));\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// normals.Add(blade.normal);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 左側のポリゴンとして、求めたUVを利用してトライアングルを追加\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddTriangle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewUV1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewUV2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"c1\"\u003e// カット面。最後のサブメッシュとしてトライアングルを追加\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 右側のトライアングル。基本は左側と同じだが、法線だけ逆向き。\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddTriangle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewUV1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewUV2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"c1\"\u003e// カット面。最後のサブメッシュとしてトライアングルを追加\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e以上が、メッシュの切断を行っているコードの解説となります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"サンプルコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサンプルコード\u003c/h2\u003e\n\n\u003cp\u003e下のコードは、上で解説したコードの全文です。\u003cbr\u003e\n自分の理解のために各処理について日本語でコメントを入れているので、分かりづらい点などはそちらも合わせて見てもらうと理解が促されるかもしれません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eBLINDED_AM_ME\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMeshCut\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMeshCutSide\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e  \u003cspan class=\"n\"\u003evertices\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e  \u003cspan class=\"n\"\u003enormals\u003c/span\u003e   \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e  \u003cspan class=\"n\"\u003euvs\u003c/span\u003e       \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e      \u003cspan class=\"n\"\u003etriangles\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;();\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eClearAll\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"n\"\u003euvs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etriangles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// トライアングルとして3頂点を追加\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// ※ 頂点情報は元のメッシュからコピーする\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"p1\"\u0026gt;頂点1\u0026lt;/param\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"p2\"\u0026gt;頂点2\u0026lt;/param\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"p3\"\u0026gt;頂点3\u0026lt;/param\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"submesh\"\u0026gt;対象のサブメシュ\u0026lt;/param\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAddTriangle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ep3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003esubmesh\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// triangle index order goes 1,2,3,4....\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 頂点配列のカウント。随時追加されていくため、ベースとなるindexを定義する。\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// ※ AddTriangleが呼ばれるたびに頂点数は増えていく。\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ebase_index\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 対象サブメッシュのインデックスに追加していく\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esubmesh\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_index\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esubmesh\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_index\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esubmesh\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_index\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 三角形郡の頂点を設定\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etriangles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_index\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etriangles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_index\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etriangles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_index\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 対象オブジェクトの頂点配列から頂点情報を取得し設定する\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// （victim_meshはstaticメンバなんだけどいいんだろうか・・）\u003c/span\u003e\n                \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 同様に、対象オブジェクトの法線配列から法線を取得し設定する\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 同様に、UVも。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003euvs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003euvs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003euvs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// トライアングルを追加する\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// ※ オーバーロードしている他メソッドとは異なり、引数の値で頂点（ポリゴン）を追加する\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"points3\"\u0026gt;トライアングルを形成する3頂点\u0026lt;/param\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"normals3\"\u0026gt;3頂点の法線\u0026lt;/param\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"uvs3\"\u0026gt;3頂点のUV\u0026lt;/param\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"faceNormal\"\u0026gt;ポリゴンの法線\u0026lt;/param\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"submesh\"\u0026gt;サブメッシュID\u0026lt;/param\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAddTriangle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003epoints3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003enormals3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003euvs3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003efaceNormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003esubmesh\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 引数の3頂点から法線を計算\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003ecalculated_normal\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCross\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003epoints3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003epoints3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]).\u003c/span\u003e\u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoints3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003epoints3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]).\u003c/span\u003e\u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ep1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ep2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ep3\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 引数で指定された法線と逆だった場合はインデックスの順番を逆順にする（つまり面を裏返す）\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecalculated_normal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efaceNormal\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ep1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ep2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ep3\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n                \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ebase_index\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esubmesh\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_index\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esubmesh\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_index\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esubmesh\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_index\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003etriangles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_index\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etriangles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_index\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etriangles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_index\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoints3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoints3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoints3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enormals3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enormals3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enormals3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003euvs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euvs3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003euvs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euvs3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003euvs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euvs3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eMeshCutSide\u003c/span\u003e \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMeshCutSide\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eMeshCutSide\u003c/span\u003e \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMeshCutSide\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003ePlane\u003c/span\u003e \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eMesh\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// capping stuff\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// Cut the specified victim, blade_plane and capMaterial.\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// （指定された「victim」をカットする。ブレード（平面）とマテリアルから切断を実行する）\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"victim\"\u0026gt;Victim.\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"blade_plane\"\u0026gt;Blade plane.\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"capMaterial\"\u0026gt;Cap material.\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eGameObject\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"nf\"\u003eCut\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eGameObject\u003c/span\u003e \u003cspan class=\"n\"\u003evictim\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003eanchorPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003enormalDirection\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e \u003cspan class=\"n\"\u003ecapMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// set the blade relative to victim\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// victimから相対的な平面（ブレード）をセット\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 具体的には、対象オブジェクトのローカル座標での平面の法線と位置から平面を生成する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eblade\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePlane\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"n\"\u003evictim\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInverseTransformDirection\u003c/span\u003e\u003cspan class=\"p\"\u003e(-\u003c/span\u003e\u003cspan class=\"n\"\u003enormalDirection\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                \u003cspan class=\"n\"\u003evictim\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInverseTransformPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eanchorPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// get the victims mesh\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 対象のメッシュを取得\u003c/span\u003e\n            \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMeshFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;().\u003c/span\u003e\u003cspan class=\"n\"\u003emesh\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// reset values\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 新しい頂点郡\u003c/span\u003e\n            \u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 平面より左の頂点郡（MeshCutSide）\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClearAll\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//平面より右の頂点郡（MeshCutSide）\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClearAll\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// ここでの「3」はトライアングル？\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003esides\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eindices\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ep3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// go throught the submeshes\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// サブメッシュの数だけループ\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003esub\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003esub\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubMeshCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// サブメッシュのインデックス数を取得\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eindices\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// List\u0026lt;List\u0026lt;int\u0026gt;\u0026gt;型のリスト。サブメッシュ一つ分のインデックスリスト\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;());\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// 左\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;());\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 右\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// サブメッシュのインデックス数分ループ\u003c/span\u003e\n                \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eindices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// p1 - p3のインデックスを取得。つまりトライアングル\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ep1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eindices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ep2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eindices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ep3\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eindices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n                    \u003cspan class=\"c1\"\u003e// それぞれ評価中のメッシュの頂点が、冒頭で定義された平面の左右どちらにあるかを評価。\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// `GetSide` メソッドによりboolを得る。\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetSide\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetSide\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetSide\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n                    \u003cspan class=\"c1\"\u003e// whole triangle\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 頂点０と頂点１および頂点２がどちらも同じ側にある場合はカットしない\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// left side\u003c/span\u003e\n                          \u003cspan class=\"c1\"\u003e// GetSideメソッドでポジティブ（true）の場合は左側にあり\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddTriangle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddTriangle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// cut the triangle\u003c/span\u003e\n                      \u003cspan class=\"c1\"\u003e// そうではなく、どちらかの点が平面の反対側にある場合はカットを実行する\u003c/span\u003e\n                        \u003cspan class=\"nf\"\u003eCut_this_Face\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep3\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 設定されているマテリアル配列を取得\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003emats\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMeshRenderer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;().\u003c/span\u003e\u003cspan class=\"n\"\u003esharedMaterials\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 取得したマテリアル配列の最後のマテリアルが、カット面のマテリアルでない場合\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emats\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003emats\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003ecapMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// add cap indices\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// カット面用のインデックス配列を追加？\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;());\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;());\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// カット面分増やしたマテリアル配列を準備\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003enewMats\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003emats\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 既存のものを新しい配列にコピー\u003c/span\u003e\n                \u003cspan class=\"n\"\u003emats\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCopyTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enewMats\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 新しいマテリアル配列の最後に、カット面用マテリアルを追加\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewMats\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003emats\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecapMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 生成したマテリアルリストを再設定\u003c/span\u003e\n                \u003cspan class=\"n\"\u003emats\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enewMats\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// cap the opennings\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// カット開始\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eCapping\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\n            \u003cspan class=\"c1\"\u003e// Left Mesh\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 左側のメッシュを生成\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// MeshCutSideクラスのメンバから各値をコピー\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMesh\u003c/span\u003e \u003cspan class=\"n\"\u003eleft_HalfMesh\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eleft_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Split Mesh Left\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eleft_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eleft_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etriangles\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etriangles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eleft_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormals\u003c/span\u003e   \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eleft_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e        \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euvs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eleft_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubMeshCount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eleft_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003eMeshTopology\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTriangles\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n            \u003cspan class=\"c1\"\u003e// Right Mesh\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 右側のメッシュも同様に生成\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMesh\u003c/span\u003e \u003cspan class=\"n\"\u003eright_HalfMesh\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eright_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Split Mesh Right\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eright_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eright_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etriangles\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etriangles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eright_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormals\u003c/span\u003e   \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eright_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e        \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euvs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eright_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubMeshCount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eright_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003eMeshTopology\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTriangles\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n            \u003cspan class=\"c1\"\u003e// assign the game objects\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 元のオブジェクトを左側のオブジェクトに\u003c/span\u003e\n            \u003cspan class=\"n\"\u003evictim\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"left side\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003evictim\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMeshFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;().\u003c/span\u003e\u003cspan class=\"n\"\u003emesh\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eleft_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\n            \u003cspan class=\"c1\"\u003e// 右側のオブジェクトは新規作成\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eGameObject\u003c/span\u003e \u003cspan class=\"n\"\u003eleftSideObj\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eGameObject\u003c/span\u003e \u003cspan class=\"n\"\u003erightSideObj\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eGameObject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"right side\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMeshFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMeshRenderer\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n            \u003cspan class=\"n\"\u003erightSideObj\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eposition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003erightSideObj\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erotation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erotation\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003erightSideObj\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMeshFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;().\u003c/span\u003e\u003cspan class=\"n\"\u003emesh\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eright_HalfMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// assign mats\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 新規生成したマテリアルリストをそれぞれのオブジェクトに適用する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eleftSideObj\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMeshRenderer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;().\u003c/span\u003e\u003cspan class=\"n\"\u003ematerials\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emats\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003erightSideObj\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMeshRenderer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;().\u003c/span\u003e\u003cspan class=\"n\"\u003ematerials\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emats\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 左右のGameObjectの配列を返す\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eGameObject\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e \u003cspan class=\"n\"\u003eleftSideObj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erightSideObj\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// カットを実行する。ただし、実際のメッシュの操作ではなく、あくまで頂点の振り分け、事前準備としての実行\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"submesh\"\u0026gt;サブメッシュのインデックス\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"sides\"\u0026gt;評価した3頂点の左右情報\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"index1\"\u0026gt;頂点1\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"index2\"\u0026gt;頂点2\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"index3\"\u0026gt;頂点3\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCut_this_Face\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003esubmesh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 左右それぞれの情報を保持するための配列郡\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eleftNormals\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eleftUvs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003erightNormals\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003erightUvs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003edidset_left\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003edidset_right\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 3頂点分繰り返す\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 処理内容としては、左右を判定して、左右の配列に3頂点を振り分ける処理を行っている\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eindex1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eside\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003eside\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003eside\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eside\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eindex1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eindex2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eindex3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// sides[side]がtrue、つまり左側の場合\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eside\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// すでに左側の頂点が設定されているか（3頂点が左右に振り分けられるため、必ず左右どちらかは2つの頂点を持つことになる）\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003edidset_left\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003edidset_left\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                        \u003cspan class=\"c1\"\u003e// ここは0,1ともに同じ値にしているのは、続く処理で\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// leftPoints[0,1]の値を使って分割点を求める処理をしているため。\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// つまり、アクセスされる可能性がある\u003c/span\u003e\n\n                        \u003cspan class=\"c1\"\u003e// 頂点の設定\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n                        \u003cspan class=\"c1\"\u003e// UVの設定\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eleftUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e     \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eleftUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e     \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eleftUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n                        \u003cspan class=\"c1\"\u003e// 法線の設定\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eleftNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eleftNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eleftNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// 2頂点目の場合は2番目に直接頂点情報を設定する\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eleftUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e     \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eleftNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 左と同様の操作を右にも行う\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003edidset_right\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003edidset_right\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                        \u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003erightUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e     \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003erightUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e     \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erightUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003erightNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003erightNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erightNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003erightUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e     \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003erightNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evictim_mesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 分割された点の比率計算のための距離\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedDistance\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 距離\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003edistance\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\n            \u003cspan class=\"c1\"\u003e// ---------------------------\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 左側の処理\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 定義した面と交差する点を探す。\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// つまり、平面によって分割される点を探す。\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 左の点を起点に、右の点に向けたレイを飛ばし、その分割点を探る。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRaycast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]).\u003c/span\u003e\u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003edistance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 見つかった交差点を、頂点間の距離で割ることで、分割点の左右の割合を算出する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003enormalizedDistance\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edistance\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]).\u003c/span\u003e\u003cspan class=\"n\"\u003emagnitude\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// カット後の新頂点に対する処理。フラグメントシェーダでの補完と同じく、分割した位置に応じて適切に補完した値を設定する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003enewVertex1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLerp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e \u003cspan class=\"n\"\u003enewUv1\u003c/span\u003e     \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLerp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleftUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003erightUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003enewNormal1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLerp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleftNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erightNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 新頂点郡に新しい頂点を追加\u003c/span\u003e\n            \u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enewVertex1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\n            \u003cspan class=\"c1\"\u003e// ---------------------------\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 右側の処理\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRaycast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]).\u003c/span\u003e\u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003edistance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003enormalizedDistance\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edistance\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]).\u003c/span\u003e\u003cspan class=\"n\"\u003emagnitude\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003enewVertex2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLerp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e \u003cspan class=\"n\"\u003enewUv2\u003c/span\u003e     \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLerp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleftUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003erightUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003enewNormal2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLerp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleftNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erightNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 新頂点郡に新しい頂点を追加\u003c/span\u003e\n            \u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enewVertex2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\n            \u003cspan class=\"c1\"\u003e// 計算された新しい頂点を使って、新トライアングルを左右ともに追加する\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// memo: どう分割されても、左右どちらかは1つの三角形になる気がするけど、縮退三角形的な感じでとにかく2つずつ追加している感じだろうか？\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddTriangle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enewVertex1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enewVertex2\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"n\"\u003eleftNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enewNormal1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enewNormal2\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"n\"\u003eleftUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enewUv1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enewUv2\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewNormal1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esubmesh\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddTriangle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eleftPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enewVertex2\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"n\"\u003eleftNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eleftNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enewNormal2\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"n\"\u003eleftUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eleftUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enewUv2\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewNormal2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esubmesh\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddTriangle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enewVertex1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enewVertex2\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"n\"\u003erightNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enewNormal1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enewNormal2\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"n\"\u003erightUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enewUv1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enewUv2\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewNormal1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esubmesh\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddTriangle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003erightPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enewVertex2\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"n\"\u003erightNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003erightNormals\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enewNormal2\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"n\"\u003erightUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003erightUvs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003enewUv2\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewNormal2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esubmesh\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// カットを実行\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCapping\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// カット用頂点追跡リスト\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 具体的には新頂点全部に対する調査を行う。その過程で調査済みをマークする目的で利用する。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 新しく生成した頂点分だけループする＝全新頂点に対してポリゴンを形成するため調査を行う\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 具体的には、カット面を構成するポリゴンを形成するため、カット時に重複した頂点を網羅して「面」を形成する頂点を調査する\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 対象頂点がすでに調査済みのマークされて（追跡配列に含まれて）いたらスキップ\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// カット用ポリゴン配列をクリア\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 調査頂点と次の頂点をポリゴン配列に保持する\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 追跡配列に自身と次の頂点を追加する（調査済みのマークをつける）\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 重複頂点がなくなるまでループし調査する\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisDone\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003eisDone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eisDone\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                    \u003cspan class=\"c1\"\u003e// 新頂点郡をループし、「面」を構成する要因となる頂点をすべて抽出する。抽出が終わるまでループを繰り返す\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 2頂点ごとに調査を行うため、ループは2単位ですすめる\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// go through the pairs\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// ペアとなる頂点を探す\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// ここでのペアとは、いちトライアングルから生成される新頂点のペア。\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// トライアングルからは必ず2頂点が生成されるため、それを探す。\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// また、全ポリゴンに対して分割点を生成しているため、ほぼ必ず、まったく同じ位置に存在する、別トライアングルの分割頂点が存在するはずである。\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e{\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// if so add the other\u003c/span\u003e\n                            \u003cspan class=\"c1\"\u003e// ペアの頂点が見つかったらそれをポリゴン配列に追加し、\u003c/span\u003e\n                            \u003cspan class=\"c1\"\u003e// 調査済マークをつけて、次のループ処理に回す\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003eisDone\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e{\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// if so add the other\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003eisDone\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003ecapVertTracker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enew_vertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 見つかった頂点郡を元に、ポリゴンを形成する\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eFillCap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecapVertpolygon\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// カット面を埋める？\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"vertices\"\u0026gt;ポリゴンを形成する頂点リスト\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eFillCap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// center of the cap\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// カット平面の中心点を計算する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 引数で渡された頂点位置をすべて合計する\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// それを頂点数の合計で割り、中心とする\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// you need an axis based on the cap\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// カット平面をベースにしたupward\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003eupward\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 90 degree turn\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// カット平面の法線を利用して、「上」方向を求める\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 具体的には、平面の左側を上として利用する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eupward\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e  \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eupward\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eupward\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e  \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 法線と「上方向」から、横軸を算出\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003eleft\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCross\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eupward\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003enewUV1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003enewUV2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 引数で与えられた頂点分ループを回す\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 計算で求めた中心点から、各頂点への方向ベクトル\u003c/span\u003e\n                \u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 新規生成するポリゴンのUV座標を求める。\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// displacementが中心からのベクトルのため、UV的な中心である0.5をベースに、内積を使ってUVの最終的な位置を得る\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewUV1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewUV1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewUV1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eupward\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewUV1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 次の頂点。ただし、最後の頂点の次は最初の頂点を利用するため、若干トリッキーな指定方法をしている（% vertices.Count）\u003c/span\u003e\n                \u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003enewUV2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewUV2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewUV2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eupward\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enewUV2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edisplacement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// uvs.Add(new Vector2(relativePosition.x, relativePosition.y));\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// normals.Add(blade.normal);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 左側のポリゴンとして、求めたUVを利用してトライアングルを追加\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddTriangle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003enewUV1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003enewUV2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eleft_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"c1\"\u003e// カット面。最後のサブメッシュとしてトライアングルを追加\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 右側のトライアングル。基本は左側と同じだが、法線だけ逆向き。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddTriangle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003ecenter\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003enewUV1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003enewUV2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVector2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eblade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eright_side\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubIndices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"c1\"\u003e// カット面。最後のサブメッシュとしてトライアングルを追加\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","createdAt":"2016-10-15T02:59:28Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"coQT4mZGtyfqfWa1ADS4x2L24HE3Mf8Q--CGvFnvOdeB2S/nQV--z8gPjSdUvufb2GYQ5lJ2Ig==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2019-11-19T11:04:19Z","likesCount":142,"linkUrl":"https://qiita.com/edo_m18/items/31961cd19fd19e09b675","organization":null,"originalId":430641,"stockedCount":124,"title":"[Unity] Mesh Cutのサンプルを読む（メッシュの切断）","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%A4%A7%E3%81%BE%E3%81%8B%E3%81%AA%E6%B5%81%E3%82%8C\"\u003e大まかな流れ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85%E3%81%A8%E8%80%83%E3%81%88%E6%96%B9\"\u003e実装と考え方\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%A0%82%E7%82%B9%E3%81%8C%E5%B9%B3%E9%9D%A2%E3%81%AE%E3%81%A9%E3%81%A1%E3%82%89%E5%81%B4%E3%81%AB%E3%81%82%E3%82%8B%E3%81%8B%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B\"\u003e頂点が平面のどちら側にあるかを調べる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%B9%B3%E9%9D%A2%E3%81%AB%E5%88%86%E6%96%AD%E3%81%95%E3%82%8C%E3%81%9F%E7%82%B9%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B\"\u003e平面に分断された点を求める\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%B9%B3%E9%9D%A2%E6%96%B9%E5%90%91%E3%81%B8%E3%81%AE%E8%B7%9D%E9%9B%A2%E3%82%92%E7%AE%97%E5%87%BA%E3%81%99%E3%82%8B\"\u003e平面方向への距離を算出する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%BE%BA%E3%81%A8%E8%B7%9D%E9%9B%A2%E3%81%8B%E3%82%89%E5%88%87%E6%96%AD%E9%A0%82%E7%82%B9%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B\"\u003e辺と距離から切断頂点を求める\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%88%87%E6%96%AD%E9%9D%A2%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B\"\u003e切断面を構築する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%96%B0%E9%A0%82%E7%82%B9%E3%81%AE%E3%83%9A%E3%82%A2%E3%82%92%E9%81%B8%E6%8A%9E%E3%81%97%E3%83%9D%E3%83%AA%E3%82%B4%E3%83%B3%E3%82%92%E5%BD%A2%E6%88%90%E3%81%99%E3%82%8B\"\u003e新頂点のペアを選択し、ポリゴンを形成する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AB%E3%83%83%E3%83%88%E9%9D%A2%E3%82%92%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%94%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B\"\u003eカット面をグルーピングする\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%96%B0%E9%A0%82%E7%82%B9%E3%82%92%E7%B5%90%E3%81%B3%E3%83%9D%E3%83%AA%E3%82%B4%E3%83%B3%E3%82%92%E5%BD%A2%E6%88%90%E3%81%99%E3%82%8B\"\u003e新頂点を結び、ポリゴンを形成する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89\"\u003eサンプルコード\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":43157,"uuid":"31961cd19fd19e09b675","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"8da6dwwHwzLAZ2o/+5MnX8PJjQ==--QuJfbqrMsOOyja75--69NEuVbsbwjf3oMqX6zRqw==","originalId":5616,"description":"現在はUnity ARエンジニア。\r\n主にARのコンテンツ制作をしています。\r\n\r\n最近は機械学習にも興味が出て勉強中です。\r\n\r\nUnityに関するブログは別で書いています↓\r\nhttps://edom18.hateblo.jp/","facebookUrl":"https://facebook.com/hiruma.kazuya","githubUrl":"https://github.com/edom18","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":"https://www.linkedin.com/in/158950946","name":"Kazuya Hiruma","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/5616/profile-images/1600303663","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F5616%2Fprofile-images%2F1600303663?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=4276bce05844b2fdd757df10763a7c4f","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F5616%2Fprofile-images%2F1600303663?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1ce546b4f5f5fa68735e8f95d42d50f1","urlName":"edo_m18","websiteUrl":"http://edom18.hateblo.jp/","twitterUrl":"https://twitter.com/edo_m18","twitterUrlName":"edo_m18","revealedOrganizations":{"edges":[{"node":{"encryptedId":"eVDgGea4BT2Ed2d1sBPq0uSnLgFKjog2e+I=--XmiKkZNKSo/VpJDN--xhNMMCM8hwXE7ZefhL/stg==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"Unityゲーム開発者ギルド","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","urlName":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。","url":"https://unity-game-dev-guild.github.io/"}},{"node":{"encryptedId":"vVP5sVh4r5cudmzmQsHvXWHD/p8xtGnRjCho--SMuPZ2/rEg2ivWEe--SDi9r3KByChd7mpsj6w2vw==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"株式会社 MESON","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f1bcbb928e3f5d18655679c6ff801fd0055b80fe/original.jpg?1596592578","urlName":"meson","description":"MESON is an Experience Augmentation Company.\r\nMESONは、AR時代のユースケースとUXをつくる会社です。","url":"http://meson.tokyo/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Unity","urlName":"unity"},{"name":"3D","urlName":"3d"}],"followingLikers":{"edges":[]},"comments":{"totalCount":3}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

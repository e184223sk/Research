<!DOCTYPE html><html><head><meta charset="utf-8" /><title>クォータニオンからオイラー角を求めてみる - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/edo_m18/items/5db35b60112e281f840e" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="o3vVjwGOT/Zd9/x6Pe50rwfYfqYeO+2WbMxJoyjVMrSXgtE/bdlAi60TCECJd3a4vHY3BXlUN5BAkXToO6ZS3A==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@edo_m18" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="クォータニオンからオイラー角を求めてみる - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEt2NDRLcDQ0Tzg0NEtfNDRPTDQ0S3E0NE96NDRHTDQ0S0o0NEtxNDRLazQ0T3A0NE84NktlUzQ0S1M1ckdDNDRLQjQ0R200NEdfNDRLTCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1iNjllMjRhYjA0MDcyZTllZDkwMzJhNzFlM2M2ODBhMw&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR1ZrYjE5dE1UZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTJiZGQ0YjdlNjEwYjJjMzBhYmZmMDI1ZGRiZjYxODZm&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=23e972d670294539305156f09ecae576"><meta property="og:description" content="

概要

Unityは基本的に回転をクォータニオンで管理しています。
その他のエンジンも、おそらくクォータニオンで回転を制御していると思います。
というのも、オイラー角では「ジンバルロック」などの問題があるため、制御するのに不安定さ..."><meta content="https://qiita.com/edo_m18/items/5db35b60112e281f840e" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Unity,数学" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-489096a4-96c8-4bef-9ecd-c4b3653e22f1"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fedo_m18%2Fitems%2F5db35b60112e281f840e">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fedo_m18%2Fitems%2F5db35b60112e281f840e">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-489096a4-96c8-4bef-9ecd-c4b3653e22f1">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-10-19T09:34:56.000+09:00","dateModified":"2017-10-19T14:15:08.000+09:00","headline":"クォータニオンからオイラー角を求めてみる","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEt2NDRLcDQ0Tzg0NEtfNDRPTDQ0S3E0NE96NDRHTDQ0S0o0NEtxNDRLazQ0T3A0NE84NktlUzQ0S1M1ckdDNDRLQjQ0R200NEdfNDRLTCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1iNjllMjRhYjA0MDcyZTllZDkwMzJhNzFlM2M2ODBhMw\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR1ZrYjE5dE1UZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTJiZGQ0YjdlNjEwYjJjMzBhYmZmMDI1ZGRiZjYxODZm\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=23e972d670294539305156f09ecae576","mainEntityOfPage":"https://qiita.com/edo_m18/items/5db35b60112e281f840e","author":{"@type":"Person","address":"Tokyo","email":null,"identifier":"edo_m18","name":"edo_m18","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F5616%2Fprofile-images%2F1600303663?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1ce546b4f5f5fa68735e8f95d42d50f1","url":"https://qiita.com/edo_m18","description":"現在はUnity ARエンジニア。\r\n主にARのコンテンツ制作をしています。\r\n\r\n最近は機械学習にも興味が出て勉強中です。\r\n\r\nUnityに関するブログは別で書いています↓\r\nhttps://edom18.hateblo.jp/","memberOf":[{"@type":"Organization","address":"オンライン@Slack","legalName":"Unityゲーム開発者ギルド","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/5e3ba3bb442371003e6b5d4618ef627b9b478357/original.jpg?1570216541","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","identifier":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。"},{"@type":"Organization","address":"東京都渋谷区松濤1-29-11 松濤1丁目ビルB棟 2F","legalName":"株式会社 MESON","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/2088feed06f7938968dfdb4eb83d6a62032439ed/original.jpg?1596592578","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f1bcbb928e3f5d18655679c6ff801fd0055b80fe/original.jpg?1596592578","identifier":"meson","description":"MESON is an Experience Augmentation Company.\r\nMESONは、AR時代のユースケースとUXをつくる会社です。"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"edo_m18","type":"items","id":"5db35b60112e281f840e"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"edo_m18","type":"items","id":"5db35b60112e281f840e"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"edo_m18","type":"items","id":"5db35b60112e281f840e"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/edo_m18/items/5db35b60112e281f840e","location":"/edo_m18/items/5db35b60112e281f840e","scheme":"https","host":"qiita.com","port":null,"pathname":"/edo_m18/items/5db35b60112e281f840e","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"A+rsEwTEOWo55Gh3NmhMYo35OoIrM7UygbOhbVUXi4M3E+ijaJM2F8kAnE2C8U51NldzIUxcbzSt7pwmRmTr6w==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-149776c9-ec2f-4ec9-8593-ca04d47dc43b"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/edo_m18/items/5db35b60112e281f840e/likers" class="css-1iupg5d">56</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">55</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/5db35b60112e281f840e/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/edo_m18/items/5db35b60112e281f840e/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/edo_m18/items/5db35b60112e281f840e/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/edo_m18/items/5db35b60112e281f840e/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/edo_m18/items/5db35b60112e281f840e.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/edo_m18"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/5616/profile-images/1600303663" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/edo_m18" class="css-10ougpm">@<!-- -->edo_m18</a><div class="css-1ay9vb9"><span><meta content="2017-10-19T00:34:56Z"/><time dateTime="2017-10-19T05:15:08Z" class="css-m19uds">updated at 2017-10-19</time></span></div></div></div></div></div><h1 class="css-cgzq40">クォータニオンからオイラー角を求めてみる</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/%e6%95%b0%e5%ad%a6" class="css-4czcte">数学</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h2>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>

<p>Unityは基本的に回転をクォータニオンで管理しています。<br>
その他のエンジンも、おそらくクォータニオンで回転を制御していると思います。<br>
というのも、オイラー角では「ジンバルロック」などの問題があるため、制御するのに不安定さがあるためです。</p>

<p>しかし、場合によってはオイラー角で値を求めたい場合があります。</p>

<p>Unityであれば、クォータニオンから簡単にオイラー角を取得することができますが、では内部ではどういう処理が行われているのか。<br>
それを色々な記事を参考にまとめてみたいと思います。</p>

<h2>
<span id="クォータニオンから回転行列を取り出す" class="fragment"></span><a href="#%E3%82%AF%E3%82%A9%E3%83%BC%E3%82%BF%E3%83%8B%E3%82%AA%E3%83%B3%E3%81%8B%E3%82%89%E5%9B%9E%E8%BB%A2%E8%A1%8C%E5%88%97%E3%82%92%E5%8F%96%E3%82%8A%E5%87%BA%E3%81%99"><i class="fa fa-link"></i></a>クォータニオンから回転行列を取り出す</h2>

<p>まずはクォータニオンから回転行列を取り出します。<br>
回転行列の要素から、オイラー角を推測するためです。</p>

<p>まるぺけさんのこちらの記事（<a href="http://marupeke296.com/DXG_No58_RotQuaternionTrans.html" rel="nofollow noopener" target="_blank">その58 やっぱり欲しい回転行列⇔クォータニオン相互変換</a>）を参考にさせてもらうと、クォータニオンの各成分から回転行列を求めることができるようです。</p>

<h3>
<span id="任意軸の回転行列" class="fragment"></span><a href="#%E4%BB%BB%E6%84%8F%E8%BB%B8%E3%81%AE%E5%9B%9E%E8%BB%A2%E8%A1%8C%E5%88%97"><i class="fa fa-link"></i></a>任意軸の回転行列</h3>

<p>まず、任意軸の回転行列は以下のように構成されます。<br>
$n$は回転の軸ベクトルの各成分です。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\begin{vmatrix}
n_x^2(1 - cos \theta) + cos \theta &amp;n_xn_y(1 - cos \theta) + n_z sin \theta &amp;n_xn_z(1 - cos \theta) - n_y sin \theta &amp;0 \\

n_xn_y(1 - cos \theta) + n_z sin \theta &amp;n_y^2(1 - cos \theta) + cos \theta &amp;n_yn_z(1 - cos \theta) - n_x sin \theta &amp;0 \\

n_xn_z(1 - cos \theta) + n_y sin \theta &amp;n_yn_z(1 - cos \theta) - n_x sin \theta &amp;n_z^2(1 - cos \theta) + cos \theta &amp;0 \\

0 &amp;0 &amp;0 &amp;1
\end{vmatrix}
</code></pre></div></div>

<h3>
<span id="クォータニオンの成分" class="fragment"></span><a href="#%E3%82%AF%E3%82%A9%E3%83%BC%E3%82%BF%E3%83%8B%E3%82%AA%E3%83%B3%E3%81%AE%E6%88%90%E5%88%86"><i class="fa fa-link"></i></a>クォータニオンの成分</h3>

<p>クォータニオンの各成分は、回転軸ベクトル$\vec N$と角度$\theta$を用いて以下のように構成されます。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>x = n_x sin(\frac{\theta}{2}) \\
y = n_y sin(\frac{\theta}{2}) \\
z = n_z sin(\frac{\theta}{2}) \\
w = cos(\frac{\theta}{2})
</code></pre></div></div>

<h3>
<span id="回転行列の各要素を計算する" class="fragment"></span><a href="#%E5%9B%9E%E8%BB%A2%E8%A1%8C%E5%88%97%E3%81%AE%E5%90%84%E8%A6%81%E7%B4%A0%E3%82%92%E8%A8%88%E7%AE%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>回転行列の各要素を計算する</h3>

<p>行列の位置を明確化するために、行列を以下のようにナンバリングしておきます。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\begin{vmatrix}
m00 &amp;m01 &amp;m02 &amp;m03 \\
m10 &amp;m11 &amp;m12 &amp;m13 \\
m20 &amp;m21 &amp;m22 &amp;m23 \\
m30 &amp;m31 &amp;m32 &amp;m33
\end{vmatrix}
</code></pre></div></div>

<p><em>※ m03, m13, m23, m30, m31, m32はすべて0、m33は1です。</em></p>

<p>さて、ではまずはじめに、m00の値（$n_x^2(1 - cos \theta) + cos \theta$）を見てみましょう。<br>
これを、クォータニオンの成分から表すと$1 - 2y^2 - 2z^2$となるようです。</p>

<p>一瞬、「なんでやねん」と思うかもしれませんが（自分は思いました）、倍角の公式などを使って展開してやるとしっかりとその値が出現します。</p>

<p>ちなみに三角関数の公式などは前にまとめた記事があるのでそちらも参照してみてください。（<a href="https://qiita.com/edo_m18/items/f8b8f86a857d34eec3c5" id="reference-271131c37d3f658f0cbf">[数学] 三角関数について整理する</a>）</p>

<h4>
<span id="三角関数の公式を使って導き出す" class="fragment"></span><a href="#%E4%B8%89%E8%A7%92%E9%96%A2%E6%95%B0%E3%81%AE%E5%85%AC%E5%BC%8F%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E5%B0%8E%E3%81%8D%E5%87%BA%E3%81%99"><i class="fa fa-link"></i></a>三角関数の公式を使って導き出す</h4>

<p>倍角の公式は以下になります。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>sin(α±β) = sin(α)cos(β) ± cos(α)sin(β) \\
cos(α±β) = cos(α)cos(β) ± sin(α)sin(β)
</code></pre></div></div>

<p>試しにやってみましょう。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>1 - 2y^2 - 2z^2
</code></pre></div></div>

<p>まずは$-2y^2$から展開してみましょう。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>y = ny * sin(\frac{\theta}{2})
</code></pre></div></div>

<p>なので、2乗すると、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>-2y^2 = -2 * (ny * sin(\frac{\theta}{2})) * (ny * sin(\frac{\theta}{2})) \\
= -2 * ny^2 * sin^2(\frac{\theta}{2})
</code></pre></div></div>

<p>となります。<br>
さて、ここで「$cos(\theta) = 1 - 2sin^2(\frac{\theta}{2})$」を使います。<br>
上記にこれを代入すると、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>cosθ = 1 -2sin^2(\frac{\theta}{2}) \\
-2sin^2(\frac{\theta}{2}) = cos(\theta) - 1 \\
よって、
ny^2 * -2sin^2(\frac{\theta}{2}) = ny^2 * (cos(\theta) - 1) \\
</code></pre></div></div>

<p>となります。</p>

<p>同様に、$-2z^2$を展開して以下を得ます。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>ny^2 * (cosθ - 1) \\
nz^2 * (cosθ - 1)
</code></pre></div></div>

<p>さてここで、各$n$成分は正規化したベクトルなので以下が成り立ちます。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\sqrt[]{nx^2 + ny^2 + nz^2} = 1 ... 正規化ベクトルの長さは1 \\
\sqrt[]{nx^2 + ny^2 + nz^2}^2 = 1^2 \\
nx^2 + ny^2 + nz^2 = 1
</code></pre></div></div>

<p>つまり、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>nz^2 = 1 - nx^2 - ny^2
</code></pre></div></div>

<p>求めたい値は$1 - 2y^2 - 2z^2$です。</p>

<p>現状の状態で整理すると以下のようになります。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>1 + (ny^2 * (cosθ - 1)) + (nz^2 * (cosθ - 1))
</code></pre></div></div>

<p>これに「$nz^2 = 1 - nx^2 - ny^2$」を代入すると、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>1 + (ny^2(cosθ - 1)) + ((1 - nx^2 - ny^2)(cosθ - 1)) \\
= 1 + (1 - nx^2 - ny^2 + ny^2)(cosθ - 1) \\
= 1 + (1 - nx^2)(cosθ - 1)
</code></pre></div></div>

<p>ゴールが見えてきました。<br>
これを展開すると、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>1 + (cosθ - 1 - nx^2cosθ + nx^2) \\
1 + (nx^2(1 - cosθ) + cosθ - 1) \\
nx^2(1 - cosθ) + cosθ
</code></pre></div></div>

<p>最初に示したm00の値が出てきました！ なんともすばらしいですね。</p>

<p>あとは、他の要素もこうして算出していくと、最終的に以下のようになります。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\begin{vmatrix}
1 - 2y^2 - 2z^2 &amp;2xy + 2wz &amp;2xz - 2wy &amp;0 \\
2xy - 2wz &amp;1 - 2x^2 - 2z^2 &amp;2yz + 2wx &amp;0 \\
2xz + 2wy &amp;2yz - 2wx &amp;1 - 2x^2 - 2y^2 &amp;0 \\
0 &amp;0 &amp;0 &amp;1
\end{vmatrix}
</code></pre></div></div>

<h2>
<span id="回転行列からオイラー角を求める" class="fragment"></span><a href="#%E5%9B%9E%E8%BB%A2%E8%A1%8C%E5%88%97%E3%81%8B%E3%82%89%E3%82%AA%E3%82%A4%E3%83%A9%E3%83%BC%E8%A7%92%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>回転行列からオイラー角を求める</h2>

<p>回転行列からオイラー角を求める部分についてはこちらの記事（<a href="http://d.hatena.ne.jp/It_lives_vainly/20070829/1188384519" rel="nofollow noopener" target="_blank">回転行列からオイラー角のパラメータ抽出を行う | It_lives_vainlyの日記</a>）を参考にさせてもらいました。</p>

<p>そして、Unityでの回転行列の作り方（各軸の回転行列のかける順番）は、上記記事と同じくZXYです。<br>
ドキュメント→ <a href="https://docs.unity3d.com/ja/current/ScriptReference/Transform-eulerAngles.html" rel="nofollow noopener" target="_blank">Unity DOCUMENT | Transform.eulerAngles</a></p>

<p>実際に行列をそれぞれ合成していくと以下のようになります。<br>
<em>※ CnはCos、SnはSinを表し、それぞれの添字はどの回転行列のものか、を示しています。</em></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>-----------------------------------------------------------------
【z x y合成（Unityの場合）】

Z:         |  X:          |  Y:        
---------- |  ----------  |  ----------
Cz -Sz  0  |  1   0   0   |  Cy  0  Sy 
Sz  Cz  0  |  0  Cx -Sx   |   0  1   0 
 0   0  1  |  0  Sx  Cx   | -Sy  0  Cy 

ZX:
----------------
Cz  -SzCx  SzSx
Sz   CzCx -CzSx
 0     Sx    Cx

ZXY:
----------------
 CzCy-SzSxSy  -SzCx  CzSy+SzSxCy
 SzCy+CzSxSy   CzCx  SzSy-CzSxCy
-CxSy            Sx         CxCy
</code></pre></div></div>

<p>さて、ここで$m21$を見ると$Sin(x)$となっています。<br>
ここから、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>m21 = sin(x) \\
θx = Asin(m21)
</code></pre></div></div>

<p>が導き出されます。<br>
次に、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>tan = \frac{sin}{cos}
</code></pre></div></div>

<p>を利用して、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\frac{-Sz}{Cz} = \frac{m01}{m11} = -tan(x) \\
θz = Atan2(-m01, m11)
</code></pre></div></div>

<p>として、$\theta z$が求まります。</p>

<p>同様にして、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\frac{-Sy}{Cy} = \frac{m20}{m22} = -tan(x) \\
θy = Atan2(-m20, m22)
</code></pre></div></div>

<p>と、$\theta y$が求まります。</p>

<p>これで無事、各値が求まった・・と思いきや、特殊なケースが存在します。<br>
それが、$cos(\theta x) = 0$のときです。</p>

<p>$cos$が$0$の場合、そう、$\theta x$が$\frac{\pi}{2}$と$\frac{-\pi}{2}$のときですね。<br>
<code>Cx</code>が<code>0</code>の場合、すべての値<code>0</code>になってしまって答えを求めることができなくなってしまいます。</p>

<p>そこで、その特殊なケースを場合分けして以下のように考えます。<br>
まず、$cos(\theta x) = 0$のとき、回転行列がどうなっているかを見てましょう。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\begin{vmatrix}
CzCy±SzSy   &amp;0  &amp;CzSy±SzCy \\
SzCy±CzSy   &amp;0  &amp;SzSy±CzCy \\
        0  &amp;±1          &amp;0
\end{vmatrix}
</code></pre></div></div>

<p><code>Cx</code>を使っている部分がすべて<code>0</code>となり、<code>Sx</code>の部分が$±1$になります。</p>

<p>※ cos(θx) = 0のとき、sin(θx) = ±1 ... $θx$ = 90° or 270°</p>

<p>さて、ここで三角関数の加法定理を持ち出すと、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>sin(α±β) = sin(α)cos(β) ± cos(α)sin(β) \\
cos(α±β) = cos(α)cos(β) ± sin(α)sin(β)
</code></pre></div></div>

<p>これを使って上の行列は以下のように整理することができます。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\begin{vmatrix}
cos(θz±θy)  &amp;0 &amp;sin(θz±θy) \\
sin(θz±θy)  &amp;0 &amp;cos(θz±θy) \\
         0 &amp;±1         &amp;0
\end{vmatrix}
</code></pre></div></div>

<p>なんともきれいに加法定理の形になってますねｗ<br>
さて、これだけでは加減算された形での値しか求まっていないので、一意に角度を求めることができません。</p>

<p>そこで、適当に$\theta y = 0$と置くと、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\frac{m10}{m00} = \frac{-sin(\theta z)}{cos(\theta z)} = -tan(\theta z)
</code></pre></div></div>

<p>となります。つまり、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\theta z = Atan2(m10, m00)
</code></pre></div></div>

<p>ですね。</p>

<p>問題点として、適当に$\theta y = 0$とおいているため、回転を表すオイラー角としては正しい姿勢になるものの、もともと設定した$y$と$z$の値が復元できないことが分かります。</p>

<p>とはいえ、$\theta x = 90° or 270°$という限定された状態のみなので、だいたいの場合は問題にならないでしょう。</p>

<p>つまり、$m21 = 1$の場合は$\theta x = \frac{\pi}{2} = 90°$、$m21 = -1$の場合は$\theta x = \frac{-\pi}{2} = 270°$となります。<br>
この状態のときだけ条件分岐してやればいいわけですね。</p>

<p>ここまでをまとめると、</p>

<p>$sin(\theta x) = ±1$以外のとき、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\theta x = Asin(m21) \\
\theta y = Atan2(-m20, m22) \\
\theta z = Atan2(-m01, m11)
</code></pre></div></div>

<p>$sin(\theta x) = 1$のとき（$m21 = 1$のとき）、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\theta x = \frac{\pi}{2} \\
\theta y = 0 \\
\theta z = Atan2(m10, m00)
</code></pre></div></div>

<p>$sin(θx) = -1$のとき（$m21 = -1$のとき）、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\theta x = \frac{-\pi}{2} \\
\theta y = 0 \\
\theta z = Atan2(m10, m00)
</code></pre></div></div>

<p>となります。</p>

<h3>
<span id="unityで実行してみる" class="fragment"></span><a href="#unity%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>Unityで実行してみる</h3>

<p>これを元に、実際にUnity上で実行してみました。<br>
実行したコードは以下になります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="n">Vector3</span> <span class="nf">Calc</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Quaternion</span> <span class="n">r</span> <span class="p">=</span> <span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">x</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">y</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">z</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">w</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">x2</span> <span class="p">=</span> <span class="n">x</span> <span class="p">*</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">y2</span> <span class="p">=</span> <span class="n">y</span> <span class="p">*</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">z2</span> <span class="p">=</span> <span class="n">z</span> <span class="p">*</span> <span class="n">z</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">xy</span> <span class="p">=</span> <span class="n">x</span> <span class="p">*</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">xz</span> <span class="p">=</span> <span class="n">x</span> <span class="p">*</span> <span class="n">z</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">yz</span> <span class="p">=</span> <span class="n">y</span> <span class="p">*</span> <span class="n">z</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">wx</span> <span class="p">=</span> <span class="n">w</span> <span class="p">*</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">wy</span> <span class="p">=</span> <span class="n">w</span> <span class="p">*</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">wz</span> <span class="p">=</span> <span class="n">w</span> <span class="p">*</span> <span class="n">z</span><span class="p">;</span>

    <span class="c1">// 1 - 2y^2 - 2z^2</span>
    <span class="kt">float</span> <span class="n">m00</span> <span class="p">=</span> <span class="m">1f</span> <span class="p">-</span> <span class="p">(</span><span class="m">2f</span> <span class="p">*</span> <span class="n">y2</span><span class="p">)</span> <span class="p">-</span> <span class="p">(</span><span class="m">2f</span> <span class="p">*</span> <span class="n">z2</span><span class="p">);</span>

    <span class="c1">// 2xy + 2wz</span>
    <span class="kt">float</span> <span class="n">m01</span> <span class="p">=</span> <span class="p">(</span><span class="m">2f</span> <span class="p">*</span> <span class="n">xy</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="m">2f</span> <span class="p">*</span> <span class="n">wz</span><span class="p">);</span>

    <span class="c1">// 2xy - 2wz</span>
    <span class="kt">float</span> <span class="n">m10</span> <span class="p">=</span> <span class="p">(</span><span class="m">2f</span> <span class="p">*</span> <span class="n">xy</span><span class="p">)</span> <span class="p">-</span> <span class="p">(</span><span class="m">2f</span> <span class="p">*</span> <span class="n">wz</span><span class="p">);</span>

    <span class="c1">// 1 - 2x^2 - 2z^2</span>
    <span class="kt">float</span> <span class="n">m11</span> <span class="p">=</span> <span class="m">1f</span> <span class="p">-</span> <span class="p">(</span><span class="m">2f</span> <span class="p">*</span> <span class="n">x2</span><span class="p">)</span> <span class="p">-</span> <span class="p">(</span><span class="m">2f</span> <span class="p">*</span> <span class="n">z2</span><span class="p">);</span>

    <span class="c1">// 2xz + 2wy</span>
    <span class="kt">float</span> <span class="n">m20</span> <span class="p">=</span> <span class="p">(</span><span class="m">2f</span> <span class="p">*</span> <span class="n">xz</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="m">2f</span> <span class="p">*</span> <span class="n">wy</span><span class="p">);</span>

    <span class="c1">// 2yz+2wx</span>
    <span class="kt">float</span> <span class="n">m21</span> <span class="p">=</span> <span class="p">(</span><span class="m">2f</span> <span class="p">*</span> <span class="n">yz</span><span class="p">)</span> <span class="p">-</span> <span class="p">(</span><span class="m">2f</span> <span class="p">*</span> <span class="n">wx</span><span class="p">);</span>

    <span class="c1">// 1 - 2x^2 - 2y^2</span>
    <span class="kt">float</span> <span class="n">m22</span> <span class="p">=</span> <span class="m">1f</span> <span class="p">-</span> <span class="p">(</span><span class="m">2f</span> <span class="p">*</span> <span class="n">x2</span><span class="p">)</span> <span class="p">-</span> <span class="p">(</span><span class="m">2f</span> <span class="p">*</span> <span class="n">y2</span><span class="p">);</span>


    <span class="kt">float</span> <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">tz</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">Mathf</span><span class="p">.</span><span class="nf">Approximately</span><span class="p">(</span><span class="n">m21</span><span class="p">,</span> <span class="m">1f</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">tx</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="n">PI</span> <span class="p">/</span> <span class="m">2f</span><span class="p">;</span>
        <span class="n">ty</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">tz</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Atan2</span><span class="p">(</span><span class="n">m10</span><span class="p">,</span> <span class="n">m00</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Mathf</span><span class="p">.</span><span class="nf">Approximately</span><span class="p">(</span><span class="n">m21</span><span class="p">,</span> <span class="p">-</span><span class="m">1f</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">tx</span> <span class="p">=</span> <span class="p">-</span><span class="n">Mathf</span><span class="p">.</span><span class="n">PI</span> <span class="p">/</span> <span class="m">2f</span><span class="p">;</span>
        <span class="n">ty</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">tz</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Atan2</span><span class="p">(</span><span class="n">m10</span><span class="p">,</span> <span class="n">m00</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">tx</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Asin</span><span class="p">(-</span><span class="n">m21</span><span class="p">);</span>
        <span class="n">ty</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Atan2</span><span class="p">(</span><span class="n">m20</span><span class="p">,</span> <span class="n">m22</span><span class="p">);</span>
        <span class="n">tz</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Atan2</span><span class="p">(</span><span class="n">m01</span><span class="p">,</span> <span class="n">m11</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">tx</span> <span class="p">*=</span> <span class="n">Mathf</span><span class="p">.</span><span class="n">Rad2Deg</span><span class="p">;</span>
    <span class="n">ty</span> <span class="p">*=</span> <span class="n">Mathf</span><span class="p">.</span><span class="n">Rad2Deg</span><span class="p">;</span>
    <span class="n">tz</span> <span class="p">*=</span> <span class="n">Mathf</span><span class="p">.</span><span class="n">Rad2Deg</span><span class="p">;</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">tz</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これを実行すると無事、同じ回転を設定することができました。<br>
が、<strong>実はよーく見てもらうと上で求めた式とは若干違う部分があります。</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">tx</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Asin</span><span class="p">(-</span><span class="n">m21</span><span class="p">);</span>
<span class="n">ty</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Atan2</span><span class="p">(</span><span class="n">m20</span><span class="p">,</span> <span class="n">m22</span><span class="p">);</span>
<span class="n">tz</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Atan2</span><span class="p">(</span><span class="n">m01</span><span class="p">,</span> <span class="n">m11</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>引数に与えている成分のマイナス記号が逆</strong>になっているんですね。<br>
<del>そして、なぜここが逆転するのかは分かりませんでした・・。<br>
ただ、マイナスを逆転したら正常に回転がコピーできました。</del></p>

<del>そもそも、UnityのAPIである`Quatarnion.eulerAngles`の値はさらに違った値になっていました。（360°から該当の角度を減算したものになっていた）</del>

<p><del>このあたりがもしかしたら逆転している理由かもしれません。<br>
が、値としては想定した値になっていたので、ひとまずはOKとしました・・。<br>
もしなにかご存知の人いたら教えてください(´・ω・`)</del></p>

<p><em>これについてはコメントで指摘をもらって、以下に追記しました。</em></p>

<p><strong>[追記]</strong><br>
コメントで指摘してもらいましたが、そもそも参考にした記事が、座標変換のための回転行列と、位置ベクトルの回転行列による話で、そもそも対象としているのが違うためでは、ということでした。<br>
「教えて！goo」に似た質問とそれに対する回答があったので追記しておきます。</p>

<p><qiita-embed-ogp src="https://oshiete.goo.ne.jp/qa/8764676.html"></qiita-embed-ogp></p>

<p>見てもらうと分かりますが、まさに符号だけが逆転しているのが分かります。</p>

<h3>
<span id="その他メモ" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%83%A1%E3%83%A2"><i class="fa fa-link"></i></a>その他メモ</h3>

<p>最初間違えてUnityのつもりで違う順番で行列を計算しちゃったけどメモとして残しておきますｗ</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>-----------------------------------------------------------------
【z y x合成】

Z:          |  Y:          |  X:
----------  |  ----------  |  ----------
Cz -Sz  0   |  Cy  0  Sy   |  1   0   0
Sz  Cz  0   |   0  1   0   |  0  Cx -Sx
 0   0  1   | -Sy  0  Cy   |  0  Sx  Cx

ZY:
-----------------
CzCy  -Sz  CzSy
SzCy   Cz  SzSy
-Sy     0    Cy

ZYX:
-------------------------------
CzCy  -SzCx+CzSySx   SzSx+CzSyCx
SzCy   CzCx+SzSySx  -CzSx+SzSyCx
 -Sy          CySx          CyCx
</code></pre></div></div>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fedo_m18%2Fitems%2F5db35b60112e281f840e&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fedo_m18%2Fitems%2F5db35b60112e281f840e&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/edo_m18/items/5db35b60112e281f840e/likers" class="css-1iupg5d">56</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">55</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/5db35b60112e281f840e/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/edo_m18/items/5db35b60112e281f840e/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/edo_m18/items/5db35b60112e281f840e/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/edo_m18/items/5db35b60112e281f840e/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/edo_m18/items/5db35b60112e281f840e.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-149776c9-ec2f-4ec9-8593-ca04d47dc43b">{"authorAnalyticsTrackingId":"UA-42967648-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-b720002e-2382-4d53-8232-566430ce645b"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-b720002e-2382-4d53-8232-566430ce645b">{}</script>
      
<div id="LoginModal-react-component-4e7be80e-32cc-491a-a34a-a8370698c88c"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-4e7be80e-32cc-491a-a34a-a8370698c88c">{}</script>
      
<div id="StockModal-react-component-4f9e579b-9b72-4816-aecb-730a9b190a7b"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-4f9e579b-9b72-4816-aecb-730a9b190a7b">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;nJU4P9ckCgjirSUua1Dw6dQNMeDlkAqXpr3Q7H6toc6obDyPu3MFdRJJ0RTfyfL+b6N4Q4L/0JGK4O2nbd7Bpg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch2\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h2\u003e\n\n\u003cp\u003eUnityは基本的に回転をクォータニオンで管理しています。\u003cbr\u003e\nその他のエンジンも、おそらくクォータニオンで回転を制御していると思います。\u003cbr\u003e\nというのも、オイラー角では「ジンバルロック」などの問題があるため、制御するのに不安定さがあるためです。\u003c/p\u003e\n\n\u003cp\u003eしかし、場合によってはオイラー角で値を求めたい場合があります。\u003c/p\u003e\n\n\u003cp\u003eUnityであれば、クォータニオンから簡単にオイラー角を取得することができますが、では内部ではどういう処理が行われているのか。\u003cbr\u003e\nそれを色々な記事を参考にまとめてみたいと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"クォータニオンから回転行列を取り出す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AF%E3%82%A9%E3%83%BC%E3%82%BF%E3%83%8B%E3%82%AA%E3%83%B3%E3%81%8B%E3%82%89%E5%9B%9E%E8%BB%A2%E8%A1%8C%E5%88%97%E3%82%92%E5%8F%96%E3%82%8A%E5%87%BA%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eクォータニオンから回転行列を取り出す\u003c/h2\u003e\n\n\u003cp\u003eまずはクォータニオンから回転行列を取り出します。\u003cbr\u003e\n回転行列の要素から、オイラー角を推測するためです。\u003c/p\u003e\n\n\u003cp\u003eまるぺけさんのこちらの記事（\u003ca href=\"http://marupeke296.com/DXG_No58_RotQuaternionTrans.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eその58 やっぱり欲しい回転行列⇔クォータニオン相互変換\u003c/a\u003e）を参考にさせてもらうと、クォータニオンの各成分から回転行列を求めることができるようです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"任意軸の回転行列\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%BB%E6%84%8F%E8%BB%B8%E3%81%AE%E5%9B%9E%E8%BB%A2%E8%A1%8C%E5%88%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e任意軸の回転行列\u003c/h3\u003e\n\n\u003cp\u003eまず、任意軸の回転行列は以下のように構成されます。\u003cbr\u003e\n$n$は回転の軸ベクトルの各成分です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\begin{vmatrix}\nn_x^2(1 - cos \\theta) + cos \\theta \u0026amp;n_xn_y(1 - cos \\theta) + n_z sin \\theta \u0026amp;n_xn_z(1 - cos \\theta) - n_y sin \\theta \u0026amp;0 \\\\\n\nn_xn_y(1 - cos \\theta) + n_z sin \\theta \u0026amp;n_y^2(1 - cos \\theta) + cos \\theta \u0026amp;n_yn_z(1 - cos \\theta) - n_x sin \\theta \u0026amp;0 \\\\\n\nn_xn_z(1 - cos \\theta) + n_y sin \\theta \u0026amp;n_yn_z(1 - cos \\theta) - n_x sin \\theta \u0026amp;n_z^2(1 - cos \\theta) + cos \\theta \u0026amp;0 \\\\\n\n0 \u0026amp;0 \u0026amp;0 \u0026amp;1\n\\end{vmatrix}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"クォータニオンの成分\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AF%E3%82%A9%E3%83%BC%E3%82%BF%E3%83%8B%E3%82%AA%E3%83%B3%E3%81%AE%E6%88%90%E5%88%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eクォータニオンの成分\u003c/h3\u003e\n\n\u003cp\u003eクォータニオンの各成分は、回転軸ベクトル$\\vec N$と角度$\\theta$を用いて以下のように構成されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003ex = n_x sin(\\frac{\\theta}{2}) \\\\\ny = n_y sin(\\frac{\\theta}{2}) \\\\\nz = n_z sin(\\frac{\\theta}{2}) \\\\\nw = cos(\\frac{\\theta}{2})\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"回転行列の各要素を計算する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9B%9E%E8%BB%A2%E8%A1%8C%E5%88%97%E3%81%AE%E5%90%84%E8%A6%81%E7%B4%A0%E3%82%92%E8%A8%88%E7%AE%97%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e回転行列の各要素を計算する\u003c/h3\u003e\n\n\u003cp\u003e行列の位置を明確化するために、行列を以下のようにナンバリングしておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\begin{vmatrix}\nm00 \u0026amp;m01 \u0026amp;m02 \u0026amp;m03 \\\\\nm10 \u0026amp;m11 \u0026amp;m12 \u0026amp;m13 \\\\\nm20 \u0026amp;m21 \u0026amp;m22 \u0026amp;m23 \\\\\nm30 \u0026amp;m31 \u0026amp;m32 \u0026amp;m33\n\\end{vmatrix}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cem\u003e※ m03, m13, m23, m30, m31, m32はすべて0、m33は1です。\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eさて、ではまずはじめに、m00の値（$n_x^2(1 - cos \\theta) + cos \\theta$）を見てみましょう。\u003cbr\u003e\nこれを、クォータニオンの成分から表すと$1 - 2y^2 - 2z^2$となるようです。\u003c/p\u003e\n\n\u003cp\u003e一瞬、「なんでやねん」と思うかもしれませんが（自分は思いました）、倍角の公式などを使って展開してやるとしっかりとその値が出現します。\u003c/p\u003e\n\n\u003cp\u003eちなみに三角関数の公式などは前にまとめた記事があるのでそちらも参照してみてください。（\u003ca href=\"https://qiita.com/edo_m18/items/f8b8f86a857d34eec3c5\" id=\"reference-271131c37d3f658f0cbf\"\u003e[数学] 三角関数について整理する\u003c/a\u003e）\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"三角関数の公式を使って導き出す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%89%E8%A7%92%E9%96%A2%E6%95%B0%E3%81%AE%E5%85%AC%E5%BC%8F%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E5%B0%8E%E3%81%8D%E5%87%BA%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e三角関数の公式を使って導き出す\u003c/h4\u003e\n\n\u003cp\u003e倍角の公式は以下になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003esin(α±β) = sin(α)cos(β) ± cos(α)sin(β) \\\\\ncos(α±β) = cos(α)cos(β) ± sin(α)sin(β)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e試しにやってみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e1 - 2y^2 - 2z^2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまずは$-2y^2$から展開してみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003ey = ny * sin(\\frac{\\theta}{2})\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなので、2乗すると、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e-2y^2 = -2 * (ny * sin(\\frac{\\theta}{2})) * (ny * sin(\\frac{\\theta}{2})) \\\\\n= -2 * ny^2 * sin^2(\\frac{\\theta}{2})\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとなります。\u003cbr\u003e\nさて、ここで「$cos(\\theta) = 1 - 2sin^2(\\frac{\\theta}{2})$」を使います。\u003cbr\u003e\n上記にこれを代入すると、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003ecosθ = 1 -2sin^2(\\frac{\\theta}{2}) \\\\\n-2sin^2(\\frac{\\theta}{2}) = cos(\\theta) - 1 \\\\\nよって、\nny^2 * -2sin^2(\\frac{\\theta}{2}) = ny^2 * (cos(\\theta) - 1) \\\\\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとなります。\u003c/p\u003e\n\n\u003cp\u003e同様に、$-2z^2$を展開して以下を得ます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eny^2 * (cosθ - 1) \\\\\nnz^2 * (cosθ - 1)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eさてここで、各$n$成分は正規化したベクトルなので以下が成り立ちます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\sqrt[]{nx^2 + ny^2 + nz^2} = 1 ... 正規化ベクトルの長さは1 \\\\\n\\sqrt[]{nx^2 + ny^2 + nz^2}^2 = 1^2 \\\\\nnx^2 + ny^2 + nz^2 = 1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eつまり、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003enz^2 = 1 - nx^2 - ny^2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e求めたい値は$1 - 2y^2 - 2z^2$です。\u003c/p\u003e\n\n\u003cp\u003e現状の状態で整理すると以下のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e1 + (ny^2 * (cosθ - 1)) + (nz^2 * (cosθ - 1))\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれに「$nz^2 = 1 - nx^2 - ny^2$」を代入すると、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e1 + (ny^2(cosθ - 1)) + ((1 - nx^2 - ny^2)(cosθ - 1)) \\\\\n= 1 + (1 - nx^2 - ny^2 + ny^2)(cosθ - 1) \\\\\n= 1 + (1 - nx^2)(cosθ - 1)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eゴールが見えてきました。\u003cbr\u003e\nこれを展開すると、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e1 + (cosθ - 1 - nx^2cosθ + nx^2) \\\\\n1 + (nx^2(1 - cosθ) + cosθ - 1) \\\\\nnx^2(1 - cosθ) + cosθ\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e最初に示したm00の値が出てきました！ なんともすばらしいですね。\u003c/p\u003e\n\n\u003cp\u003eあとは、他の要素もこうして算出していくと、最終的に以下のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\begin{vmatrix}\n1 - 2y^2 - 2z^2 \u0026amp;2xy + 2wz \u0026amp;2xz - 2wy \u0026amp;0 \\\\\n2xy - 2wz \u0026amp;1 - 2x^2 - 2z^2 \u0026amp;2yz + 2wx \u0026amp;0 \\\\\n2xz + 2wy \u0026amp;2yz - 2wx \u0026amp;1 - 2x^2 - 2y^2 \u0026amp;0 \\\\\n0 \u0026amp;0 \u0026amp;0 \u0026amp;1\n\\end{vmatrix}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"回転行列からオイラー角を求める\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9B%9E%E8%BB%A2%E8%A1%8C%E5%88%97%E3%81%8B%E3%82%89%E3%82%AA%E3%82%A4%E3%83%A9%E3%83%BC%E8%A7%92%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e回転行列からオイラー角を求める\u003c/h2\u003e\n\n\u003cp\u003e回転行列からオイラー角を求める部分についてはこちらの記事（\u003ca href=\"http://d.hatena.ne.jp/It_lives_vainly/20070829/1188384519\" rel=\"nofollow noopener\" target=\"_blank\"\u003e回転行列からオイラー角のパラメータ抽出を行う | It_lives_vainlyの日記\u003c/a\u003e）を参考にさせてもらいました。\u003c/p\u003e\n\n\u003cp\u003eそして、Unityでの回転行列の作り方（各軸の回転行列のかける順番）は、上記記事と同じくZXYです。\u003cbr\u003e\nドキュメント→ \u003ca href=\"https://docs.unity3d.com/ja/current/ScriptReference/Transform-eulerAngles.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUnity DOCUMENT | Transform.eulerAngles\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e実際に行列をそれぞれ合成していくと以下のようになります。\u003cbr\u003e\n\u003cem\u003e※ CnはCos、SnはSinを表し、それぞれの添字はどの回転行列のものか、を示しています。\u003c/em\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e-----------------------------------------------------------------\n【z x y合成（Unityの場合）】\n\nZ:         |  X:          |  Y:        \n---------- |  ----------  |  ----------\nCz -Sz  0  |  1   0   0   |  Cy  0  Sy \nSz  Cz  0  |  0  Cx -Sx   |   0  1   0 \n 0   0  1  |  0  Sx  Cx   | -Sy  0  Cy \n\nZX:\n----------------\nCz  -SzCx  SzSx\nSz   CzCx -CzSx\n 0     Sx    Cx\n\nZXY:\n----------------\n CzCy-SzSxSy  -SzCx  CzSy+SzSxCy\n SzCy+CzSxSy   CzCx  SzSy-CzSxCy\n-CxSy            Sx         CxCy\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eさて、ここで$m21$を見ると$Sin(x)$となっています。\u003cbr\u003e\nここから、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003em21 = sin(x) \\\\\nθx = Asin(m21)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eが導き出されます。\u003cbr\u003e\n次に、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003etan = \\frac{sin}{cos}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eを利用して、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\frac{-Sz}{Cz} = \\frac{m01}{m11} = -tan(x) \\\\\nθz = Atan2(-m01, m11)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとして、$\\theta z$が求まります。\u003c/p\u003e\n\n\u003cp\u003e同様にして、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\frac{-Sy}{Cy} = \\frac{m20}{m22} = -tan(x) \\\\\nθy = Atan2(-m20, m22)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eと、$\\theta y$が求まります。\u003c/p\u003e\n\n\u003cp\u003eこれで無事、各値が求まった・・と思いきや、特殊なケースが存在します。\u003cbr\u003e\nそれが、$cos(\\theta x) = 0$のときです。\u003c/p\u003e\n\n\u003cp\u003e$cos$が$0$の場合、そう、$\\theta x$が$\\frac{\\pi}{2}$と$\\frac{-\\pi}{2}$のときですね。\u003cbr\u003e\n\u003ccode\u003eCx\u003c/code\u003eが\u003ccode\u003e0\u003c/code\u003eの場合、すべての値\u003ccode\u003e0\u003c/code\u003eになってしまって答えを求めることができなくなってしまいます。\u003c/p\u003e\n\n\u003cp\u003eそこで、その特殊なケースを場合分けして以下のように考えます。\u003cbr\u003e\nまず、$cos(\\theta x) = 0$のとき、回転行列がどうなっているかを見てましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\begin{vmatrix}\nCzCy±SzSy   \u0026amp;0  \u0026amp;CzSy±SzCy \\\\\nSzCy±CzSy   \u0026amp;0  \u0026amp;SzSy±CzCy \\\\\n        0  \u0026amp;±1          \u0026amp;0\n\\end{vmatrix}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eCx\u003c/code\u003eを使っている部分がすべて\u003ccode\u003e0\u003c/code\u003eとなり、\u003ccode\u003eSx\u003c/code\u003eの部分が$±1$になります。\u003c/p\u003e\n\n\u003cp\u003e※ cos(θx) = 0のとき、sin(θx) = ±1 ... $θx$ = 90° or 270°\u003c/p\u003e\n\n\u003cp\u003eさて、ここで三角関数の加法定理を持ち出すと、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003esin(α±β) = sin(α)cos(β) ± cos(α)sin(β) \\\\\ncos(α±β) = cos(α)cos(β) ± sin(α)sin(β)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれを使って上の行列は以下のように整理することができます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\begin{vmatrix}\ncos(θz±θy)  \u0026amp;0 \u0026amp;sin(θz±θy) \\\\\nsin(θz±θy)  \u0026amp;0 \u0026amp;cos(θz±θy) \\\\\n         0 \u0026amp;±1         \u0026amp;0\n\\end{vmatrix}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんともきれいに加法定理の形になってますねｗ\u003cbr\u003e\nさて、これだけでは加減算された形での値しか求まっていないので、一意に角度を求めることができません。\u003c/p\u003e\n\n\u003cp\u003eそこで、適当に$\\theta y = 0$と置くと、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\frac{m10}{m00} = \\frac{-sin(\\theta z)}{cos(\\theta z)} = -tan(\\theta z)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとなります。つまり、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\theta z = Atan2(m10, m00)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eですね。\u003c/p\u003e\n\n\u003cp\u003e問題点として、適当に$\\theta y = 0$とおいているため、回転を表すオイラー角としては正しい姿勢になるものの、もともと設定した$y$と$z$の値が復元できないことが分かります。\u003c/p\u003e\n\n\u003cp\u003eとはいえ、$\\theta x = 90° or 270°$という限定された状態のみなので、だいたいの場合は問題にならないでしょう。\u003c/p\u003e\n\n\u003cp\u003eつまり、$m21 = 1$の場合は$\\theta x = \\frac{\\pi}{2} = 90°$、$m21 = -1$の場合は$\\theta x = \\frac{-\\pi}{2} = 270°$となります。\u003cbr\u003e\nこの状態のときだけ条件分岐してやればいいわけですね。\u003c/p\u003e\n\n\u003cp\u003eここまでをまとめると、\u003c/p\u003e\n\n\u003cp\u003e$sin(\\theta x) = ±1$以外のとき、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\theta x = Asin(m21) \\\\\n\\theta y = Atan2(-m20, m22) \\\\\n\\theta z = Atan2(-m01, m11)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e$sin(\\theta x) = 1$のとき（$m21 = 1$のとき）、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\theta x = \\frac{\\pi}{2} \\\\\n\\theta y = 0 \\\\\n\\theta z = Atan2(m10, m00)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e$sin(θx) = -1$のとき（$m21 = -1$のとき）、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\theta x = \\frac{-\\pi}{2} \\\\\n\\theta y = 0 \\\\\n\\theta z = Atan2(m10, m00)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとなります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"unityで実行してみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unity%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUnityで実行してみる\u003c/h3\u003e\n\n\u003cp\u003eこれを元に、実際にUnity上で実行してみました。\u003cbr\u003e\n実行したコードは以下になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"nf\"\u003eCalc\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erotation\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003ex2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003ey2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003ez2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003exy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003exz\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eyz\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003ewx\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003ewy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003ewz\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 1 - 2y^2 - 2z^2\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003em00\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1f\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ey2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ez2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 2xy + 2wz\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003em01\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003exy\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ewz\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 2xy - 2wz\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003em10\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003exy\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ewz\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 1 - 2x^2 - 2z^2\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003em11\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1f\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ex2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ez2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 2xz + 2wy\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003em20\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003exz\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ewy\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 2yz+2wx\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003em21\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eyz\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ewx\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 1 - 2x^2 - 2y^2\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003em22\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1f\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ex2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ey2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003etx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ety\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etz\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eApproximately\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em21\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1f\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etx\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePI\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e2f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ety\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etz\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAtan2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003em00\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eApproximately\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em21\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1f\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etx\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePI\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e2f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ety\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etz\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAtan2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003em00\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etx\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAsin\u003c/span\u003e\u003cspan class=\"p\"\u003e(-\u003c/span\u003e\u003cspan class=\"n\"\u003em21\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ety\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAtan2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em20\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003em22\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etz\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAtan2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em01\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003em11\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003etx\u003c/span\u003e \u003cspan class=\"p\"\u003e*=\u003c/span\u003e \u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRad2Deg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ety\u003c/span\u003e \u003cspan class=\"p\"\u003e*=\u003c/span\u003e \u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRad2Deg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etz\u003c/span\u003e \u003cspan class=\"p\"\u003e*=\u003c/span\u003e \u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRad2Deg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ety\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etz\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれを実行すると無事、同じ回転を設定することができました。\u003cbr\u003e\nが、\u003cstrong\u003e実はよーく見てもらうと上で求めた式とは若干違う部分があります。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003etx\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAsin\u003c/span\u003e\u003cspan class=\"p\"\u003e(-\u003c/span\u003e\u003cspan class=\"n\"\u003em21\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003ety\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAtan2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em20\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003em22\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003etz\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAtan2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em01\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003em11\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003e引数に与えている成分のマイナス記号が逆\u003c/strong\u003eになっているんですね。\u003cbr\u003e\n\u003cdel\u003eそして、なぜここが逆転するのかは分かりませんでした・・。\u003cbr\u003e\nただ、マイナスを逆転したら正常に回転がコピーできました。\u003c/del\u003e\u003c/p\u003e\n\n\u003cdel\u003eそもそも、UnityのAPIである`Quatarnion.eulerAngles`の値はさらに違った値になっていました。（360°から該当の角度を減算したものになっていた）\u003c/del\u003e\n\n\u003cp\u003e\u003cdel\u003eこのあたりがもしかしたら逆転している理由かもしれません。\u003cbr\u003e\nが、値としては想定した値になっていたので、ひとまずはOKとしました・・。\u003cbr\u003e\nもしなにかご存知の人いたら教えてください(´・ω・`)\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eこれについてはコメントで指摘をもらって、以下に追記しました。\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e[追記]\u003c/strong\u003e\u003cbr\u003e\nコメントで指摘してもらいましたが、そもそも参考にした記事が、座標変換のための回転行列と、位置ベクトルの回転行列による話で、そもそも対象としているのが違うためでは、ということでした。\u003cbr\u003e\n「教えて！goo」に似た質問とそれに対する回答があったので追記しておきます。\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://oshiete.goo.ne.jp/qa/8764676.html\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003e見てもらうと分かりますが、まさに符号だけが逆転しているのが分かります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"その他メモ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96%E3%83%A1%E3%83%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他メモ\u003c/h3\u003e\n\n\u003cp\u003e最初間違えてUnityのつもりで違う順番で行列を計算しちゃったけどメモとして残しておきますｗ\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e-----------------------------------------------------------------\n【z y x合成】\n\nZ:          |  Y:          |  X:\n----------  |  ----------  |  ----------\nCz -Sz  0   |  Cy  0  Sy   |  1   0   0\nSz  Cz  0   |   0  1   0   |  0  Cx -Sx\n 0   0  1   | -Sy  0  Cy   |  0  Sx  Cx\n\nZY:\n-----------------\nCzCy  -Sz  CzSy\nSzCy   Cz  SzSy\n-Sy     0    Cy\n\nZYX:\n-------------------------------\nCzCy  -SzCx+CzSySx   SzSx+CzSyCx\nSzCy   CzCx+SzSySx  -CzSx+SzSyCx\n -Sy          CySx          CyCx\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","createdAt":"2017-10-19T00:34:56Z","elapsedYearsFromLastModifiedAt":3,"encryptedId":"qhz11qomPwX36aaDGWW0OTcrhbT0qyT7--n0y5hftYxZ1iPEvw--R/rPlMXJz1a6/qQ/IRtTpw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2017-10-19T05:15:08Z","likesCount":56,"linkUrl":"https://qiita.com/edo_m18/items/5db35b60112e281f840e","organization":null,"originalId":533239,"stockedCount":55,"title":"クォータニオンからオイラー角を求めてみる","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AF%E3%82%A9%E3%83%BC%E3%82%BF%E3%83%8B%E3%82%AA%E3%83%B3%E3%81%8B%E3%82%89%E5%9B%9E%E8%BB%A2%E8%A1%8C%E5%88%97%E3%82%92%E5%8F%96%E3%82%8A%E5%87%BA%E3%81%99\"\u003eクォータニオンから回転行列を取り出す\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%BB%E6%84%8F%E8%BB%B8%E3%81%AE%E5%9B%9E%E8%BB%A2%E8%A1%8C%E5%88%97\"\u003e任意軸の回転行列\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AF%E3%82%A9%E3%83%BC%E3%82%BF%E3%83%8B%E3%82%AA%E3%83%B3%E3%81%AE%E6%88%90%E5%88%86\"\u003eクォータニオンの成分\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%9B%9E%E8%BB%A2%E8%A1%8C%E5%88%97%E3%81%AE%E5%90%84%E8%A6%81%E7%B4%A0%E3%82%92%E8%A8%88%E7%AE%97%E3%81%99%E3%82%8B\"\u003e回転行列の各要素を計算する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%B8%89%E8%A7%92%E9%96%A2%E6%95%B0%E3%81%AE%E5%85%AC%E5%BC%8F%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E5%B0%8E%E3%81%8D%E5%87%BA%E3%81%99\"\u003e三角関数の公式を使って導き出す\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%9B%9E%E8%BB%A2%E8%A1%8C%E5%88%97%E3%81%8B%E3%82%89%E3%82%AA%E3%82%A4%E3%83%A9%E3%83%BC%E8%A7%92%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B\"\u003e回転行列からオイラー角を求める\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#unity%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003eUnityで実行してみる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96%E3%83%A1%E3%83%A2\"\u003eその他メモ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":44738,"uuid":"5db35b60112e281f840e","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"u3RKq7i2Aqw/Uwth10Xe9i00oQ==--l7mzQOe/OiGTDuki--0kEbfXliXmr1KRYa4PmruQ==","originalId":5616,"description":"現在はUnity ARエンジニア。\r\n主にARのコンテンツ制作をしています。\r\n\r\n最近は機械学習にも興味が出て勉強中です。\r\n\r\nUnityに関するブログは別で書いています↓\r\nhttps://edom18.hateblo.jp/","facebookUrl":"https://facebook.com/hiruma.kazuya","githubUrl":"https://github.com/edom18","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":"https://www.linkedin.com/in/158950946","name":"Kazuya Hiruma","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/5616/profile-images/1600303663","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F5616%2Fprofile-images%2F1600303663?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=4276bce05844b2fdd757df10763a7c4f","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F5616%2Fprofile-images%2F1600303663?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1ce546b4f5f5fa68735e8f95d42d50f1","urlName":"edo_m18","websiteUrl":"http://edom18.hateblo.jp/","twitterUrl":"https://twitter.com/edo_m18","twitterUrlName":"edo_m18","revealedOrganizations":{"edges":[{"node":{"encryptedId":"Uc/jwgD7HbriQly2gPGvSBTBJ/HIv351Udg=--LDHh2fv3h25ldohq--8gCbs3dGnUIWw/XCNSa/tQ==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"Unityゲーム開発者ギルド","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","urlName":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。","url":"https://unity-game-dev-guild.github.io/"}},{"node":{"encryptedId":"YwCV31pjvvXW2loHB2cgzPry8/3hva0zuklp--ZSje0thBSB0tiM/M--kE2y43HPaJwv1G3gTXcqew==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"株式会社 MESON","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f1bcbb928e3f5d18655679c6ff801fd0055b80fe/original.jpg?1596592578","urlName":"meson","description":"MESON is an Experience Augmentation Company.\r\nMESONは、AR時代のユースケースとUXをつくる会社です。","url":"http://meson.tokyo/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Unity","urlName":"unity"},{"name":"数学","urlName":"%e6%95%b0%e5%ad%a6"}],"followingLikers":{"edges":[]},"comments":{"totalCount":5}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

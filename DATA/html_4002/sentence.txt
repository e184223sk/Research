More than 1 year has passed since last update.ゲームのマスターデータ(変化しないアイテムや敵のパラメータのテーブル)をゲーム中に保持していると、マスターデータのレコード数が増えるとランタイムでのメモリ使用量が気になってくる。
特にレコードに配列やリストをもたせた場合、オーバーヘッドが無視できないので配列やリストのメモリ量を測ってみる。Unity 2018.2.8fのエディタ上で実行してプロファイラーを使って計測した。.NetのバージョンやAndroid、iPhone、IL2CPP環境では結果が異なるかもしれない。おそらく配列のオーバーヘッドは40byteでn個のint型配列なら(n * 4 + 40)byteのメモリが確保される。Listは内部で配列を持っているので最初にAddされたときにデフォルトサイズ4で配列が生成される。
4よりもさらに要素が増えた場合は倍のサイズの配列が確保される。キャパシティを指定した場合は、そのサイズで配列が生成される。上記のようなレコードを1000個生成しようとした場合、配列のオーバーヘッドだけで40*1000byteとなり、かなりのメモリが消費されてしまうので以下のようにバラバラのメンバーにして保持したほうがメモリ効率はよくなる。Listを使う場合はキャパシティを設定するほうがメモリ効率がいい。レコードを入れるコンテナをリストにするか配列にするかは、リストにキャパシティを指定しているならそこまでメモリに差はない。



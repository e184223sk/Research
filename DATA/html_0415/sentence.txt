本稿は、Microsoft Azure の App Center Analytics を用いて、アプリの使用状況を分析する機能を製品に入れる場合の注意点を記します。App Center というのは、Microsoftが提供している「モバイルやデスクトップアプリを作成、テスト、リリース、監視するための開発者向け統合サービス」です。
App Cente についての詳細はこちら(公式)今回は、App Center の機能のうち、「App Center Analytics」という分析情報の収集機能についての説明です。
この機能は、アプリの任意の操作をした時に、任意の情報をクラウドにイベントログとして登録して確認することができます。上記の公式ページには、以下のように説明されています。App Center Analytics を使用して、使用パターン、ユーザーによる導入、その他のエンゲージメント メトリックを追跡します。カスタム イベントを使用して、最も重要なユーザーの行動に関する詳細な分析情報を収集できますApp Center には実装するための便利なSDKがあります。
利用できるプラットフォームは、Android、iOS、React Native、Xamarin、Unity、UWP、WPF/WinForms、macOSなど、多数あります。
SDKが利用可能なプラットフォームの詳細はこちら本稿では、例として、WPFの場合で紹介します。まず対象のプロジェクトに「Microsoft.AppCenter.Analytics」と「Microsoft.AppCenter.Crashes」をnugetからインストールしてから、以下のように、AppCenterの機能を有効化させれば、準備完了です。上記についての詳細は以下の公式ページを参照ください。
Get Started with WPF/WinFormsあとは、任意のタイミングで、任意の情報をイベントログとして登録する実装をします。
以下のように、Analytics.TrackEventメソッドで、イベントの名前を指定してイベントログが登録できます。必要があれば、Dictionaryを用いてプロパティごとの値も登録できます。上記についての詳細は以下の公式ページを参照ください。
App Center Analytics（Windows）ここまでの実装ができていれば、下図のように、App CenterのWebサイトから、イベントの名前ごとに、実行回数や実行ユーザー数が確認できます。
また、実装方法については、Microsoftの かずきさん の以下の記事が、とてもわかり易いと思います。
Visual Studio App Center の WPF 対応機能を使ってみようApp Center へのイベントログ登録時に、アプリがオフラインの場合、SDKが自動的にログを保存し、オンラインに戻ったらログを送信してくれると、以下のFAQに書いてありました。
ネットワーク接続がない場合、SDKが最大10 MB(デフォルト)のログをローカルストレージに保存しているとのことです。
Analytics FAQ(公式)本稿で紹介している App Center Analytics は、Freeプラン(無料)で利用できます。特に利用制限もなく、イベントログを登録できます。
また、サポートに問い合わせて確認したところ、「Freeプランで、法人が商用利用する場合でも、制限はない」とのことでした。素晴らしいですね。
App Center の価格(公式)App Center Analytics は、イベントログを登録する際に、自動的にユーザーのOSバージョンなどの情報も収集しています。
ということで、GDPRの対応について、確認しました。EUでは、EU域内の個人データ保護を規定する法として、1995年から現在に至るまで適用されている「EUデータ保護指令（Data Protection Directive 95）」に代わり、2016年4月に制定された「GDPR（General Data Protection Regulation：一般データ保護規則）」が2018年5月25日に施行されました。
GDPRは個人データやプライバシーの保護に関して、EUデータ保護指令より厳格に規定します。GDPRの詳細はこちらこちらの記事を参考にすると、GDPRでは以下の情報が「個人情報」とみなされて、厳格な取り扱いが必要になります。ということで、GDPRでの「個人情報」に該当する情報を、App Center Analytics が収集しているのかどうか、Microsoftのサポートに確認したところ、GDPRでの「個人情報」に該当する情報は、デフォルトでは収集していないとのことでした。ちなみに、イベントログとして登録した情報に、デフォルトでどんな情報が入っているのかは、以下のページに書いてあります。
App Center Export(公式)以下に App Center が GDPR に準拠するための取り組み方針が書いてあります。
Visual Studio App Center and GDPRなお、GDPRでの「個人情報」を収集する場合の、ユーザー同意画面の文章案については、以下のサイトで公開されています。各企業が真似しても良さそうなニュアンスで書かれていますので、必要な場合はこちらを参考にすると良いと思います。
知らなかったでは済まされない世界各国の個人情報保護。従業員情報も対象に！ - KDDIApp Center Analytics を製品に入れる場合の注意点などを紹介しました。ちなみに私は、普段はエンジニアリングマネージャーとして、チームの皆で楽しく開発する施策を色々実施しています。詳しくは以下を参照ください。
1年以上かけて生産性倍増＋成長し続けるチームになった施策を全部公開Twitterでも開発に役立つ情報を発信しています → @kojimadev



<!DOCTYPE html><html><head><meta charset="utf-8" /><title>DbSharp（ストアドを実行するC#のソースコード自動生成ツール）の紹介 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/higty/items/3c7000c06c83321e2319" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="bLOjtgLQhwKI40+r9HurB7dNlCZD2HJz/dEZ9ky4MEEfa7iOs1g0M9nKqmjHCiZVof1C4ILMHEFeHsiLC7Y1yg==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@higlabo" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="DbSharp（ストアドを実行するC#のソースコード自動生成ツール）の紹介 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1SR0pUYUdGeWNPLThpT09DdWVPRGlPT0NvdU9EaWVPQ2t1V3VuLWloak9PQm1lT0NpME1qNDRHdTQ0Szk0NE84NDRLNTQ0S3o0NE84NDRPSjZJZXE1WXVWNTVTZjVvaVE0NE9FNDRPODQ0T3I3N3lKNDRHdTU3UzU1THVMJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWEzYzM4NzA1NTc3NTUyNDY2OTc3YzhlY2MyM2E3ODA5&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR2hwWjNSNSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWQxYzc2NGU3NGNjZjE3N2NiOTdhY2E4YTY3NDlhNmMy&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=4882b34ddd27a664df5e7dcecbdf1ac0"><meta property="og:description" content="

概要

この記事ではOOP、TestFirst、SRP(Single Responsibility Principle)について実際にDAL Generatorを作りながら解説していきます。
※OOP→オブジェクト指向、SRP→単..."><meta content="https://qiita.com/higty/items/3c7000c06c83321e2319" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,tool,Database,ORM,便利ツール" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-66124600-4b13-478c-b224-df3f877e5c5c"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fhigty%2Fitems%2F3c7000c06c83321e2319">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fhigty%2Fitems%2F3c7000c06c83321e2319">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-66124600-4b13-478c-b224-df3f877e5c5c">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-10-18T11:06:12.000+09:00","dateModified":"2020-08-18T13:50:57.000+09:00","headline":"DbSharp（ストアドを実行するC#のソースコード自動生成ツール）の紹介","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1SR0pUYUdGeWNPLThpT09DdWVPRGlPT0NvdU9EaWVPQ2t1V3VuLWloak9PQm1lT0NpME1qNDRHdTQ0Szk0NE84NDRLNTQ0S3o0NE84NDRPSjZJZXE1WXVWNTVTZjVvaVE0NE9FNDRPODQ0T3I3N3lKNDRHdTU3UzU1THVMJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWEzYzM4NzA1NTc3NTUyNDY2OTc3YzhlY2MyM2E3ODA5\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR2hwWjNSNSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWQxYzc2NGU3NGNjZjE3N2NiOTdhY2E4YTY3NDlhNmMy\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=4882b34ddd27a664df5e7dcecbdf1ac0","mainEntityOfPage":"https://qiita.com/higty/items/3c7000c06c83321e2319","author":{"@type":"Person","address":"Tokyo","email":null,"identifier":"higty","name":"higty","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F96483%2Fprofile-images%2F1548390071?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=cfd641f4961ac44fd5ef70299a20a2b9","url":"https://qiita.com/higty","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202106-uzabase-3/">バリューフィットを大切にするユーザベースの「The 7 Values」とは？</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202106-uzabase-3/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"higty","type":"items","id":"3c7000c06c83321e2319"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"バリューフィットを大切にするユーザベースの「The 7 Values」とは？","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"higty","type":"items","id":"3c7000c06c83321e2319"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"バリューフィットを大切にするユーザベースの「The 7 Values」とは？","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"higty","type":"items","id":"3c7000c06c83321e2319"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"バリューフィットを大切にするユーザベースの「The 7 Values」とは？","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/higty/items/3c7000c06c83321e2319","location":"/higty/items/3c7000c06c83321e2319","scheme":"https","host":"qiita.com","port":null,"pathname":"/higty/items/3c7000c06c83321e2319","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"AX3mVYZ8hv6kTqnoB31ShB7WROhKHdk52CYf3zN5cHNypf1tN/Q1z/VnTCs0DN/WCGaSLosJtwt76c6idHd1+A==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-2a42cf4c-098e-412f-90ac-4ffb65eda1af"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/higty/items/3c7000c06c83321e2319/likers" class="css-1iupg5d">3</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">2</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3c7000c06c83321e2319/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/higty/items/3c7000c06c83321e2319/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/higty/items/3c7000c06c83321e2319/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/higty/items/3c7000c06c83321e2319/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/higty/items/3c7000c06c83321e2319.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/higty"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/96483/profile-images/1548390071" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/higty" class="css-10ougpm">@<!-- -->higty</a><div class="css-1ay9vb9"><span><meta content="2019-10-18T02:06:12Z"/><time dateTime="2020-08-18T04:50:57Z" class="css-m19uds">updated at 2020-08-18</time></span></div></div></div></div></div><h1 class="css-cgzq40">DbSharp（ストアドを実行するC#のソースコード自動生成ツール）の紹介</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/tool" class="css-4czcte">tool</a><a href="/tags/database" class="css-4czcte">Database</a><a href="/tags/orm" class="css-4czcte">ORM</a><a href="/tags/%e4%be%bf%e5%88%a9%e3%83%84%e3%83%bc%e3%83%ab" class="css-4czcte">便利ツール</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h1>

<p>この記事ではOOP、TestFirst、SRP(Single Responsibility Principle)について実際にDAL Generatorを作りながら解説していきます。<br>
※OOP→オブジェクト指向、SRP→単一責任の原則、DAL→データアクセスレイヤー</p>

<p>DbSharpというツールは実は5年くらい前に作って海外サイトで記事にして非常に高い評価を貰いました。（4.97/5.0が満点)<br>
<a href="https://www.codeproject.com/Articles/776811/DbSharp-DAL-generator-tool-on-NET-Core" rel="nofollow noopener" target="_blank">CodeProjectのDbSharpの記事</a></p>

<p>Nugetでのダウンロードは7600ダウンロードくらいいきました。私の各アカウントは以下になります。<br>
<a href="https://github.com/higty" rel="nofollow noopener" target="_blank">GitHub account</a><br>
<a href="https://github.com/higty/higlabo" rel="nofollow noopener" target="_blank">HigLabo.NetStandard on GitHub</a><br>
<a href="https://www.nuget.org/profiles/higty" rel="nofollow noopener" target="_blank">Higty on Nuget (15万ダウンロード！)</a><br>
<a href="https://twitter.com/higlabo" rel="nofollow noopener" target="_blank">Twitter</a></p>

<p>CodeProjectの記事は今のバージョンと若干違いがあります。あまり日本ではSNSとかで活動してなかったのですが、日本語でも記事を書いた方がいいよと言われたので最新版について日本語記事を書きます。</p>

<h2>
<span id="dbsharpとは" class="fragment"></span><a href="#dbsharp%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>DbSharpとは？</h2>

<p>DbSharpはDALのC#コードを自動で生成するツールです。</p>

<p>DbSharpApplicationを使用してDBに接続し、ストアドプロシージャのスキーマからストアドプロシージャを呼び出すC#のソースコードを自動で生成します。5年前くらいに海外サイトで紹介記事を書いて今はNugetで7600ダウンロードくらいです。</p>

<p><a href="https://github.com/higty/higlabo/tree/master/NetStandard/Tools/DbSharp" rel="nofollow noopener" target="_blank">GitHubのリンク</a><br>
<a href="https://github.com/higty/higlabo/tree/master/NetStandard/Tools/DbSharp/Compiled" rel="nofollow noopener" target="_blank">Download</a></p>

<p>以下のように直感的にDBのストアドを実行できるコードが生成されます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">db1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HigLabo</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="nf">SqlServerDatabase</span><span class="p">(</span><span class="s">"connection string to DB1"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">db2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HigLabo</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="nf">SqlServerDatabase</span><span class="p">(</span><span class="s">"connection string to DB2"</span><span class="p">);</span>

<span class="c1">//Execute stored procedure</span>
<span class="kt">var</span> <span class="n">sp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyTaskTableInsert</span><span class="p">();</span>
<span class="n">sp</span><span class="p">.</span><span class="n">TaskId</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">();</span>
<span class="n">sp</span><span class="p">.</span><span class="n">Title</span> <span class="p">=</span> <span class="s">"Post article to CodeProject"</span><span class="p">;</span>
<span class="n">sp</span><span class="p">.</span><span class="n">Priority</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
<span class="n">sp</span><span class="p">.</span><span class="n">State</span> <span class="p">=</span> <span class="s">"Executing"</span><span class="p">;</span>
<span class="n">sp</span><span class="p">.</span><span class="n">CreateTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>
<span class="n">sp</span><span class="p">.</span><span class="n">ScheduleDate</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">2014</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">25</span><span class="p">);</span>
<span class="n">sp</span><span class="p">.</span><span class="n">Detail</span> <span class="p">=</span> <span class="s">"...Draft..."</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">db1Result1</span> <span class="p">=</span> <span class="n">sp</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">(</span><span class="n">db1</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">db2Result1</span> <span class="p">=</span> <span class="k">await</span> <span class="n">sp</span><span class="p">.</span><span class="nf">ExecuteNonQueryAsync</span><span class="p">(</span><span class="n">db2</span><span class="p">);</span>


<span class="c1">//With transaction</span>
<span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HigLabo</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="nf">SqlServerDatabase</span><span class="p">(</span><span class="s">"connection string"</span><span class="p">);</span>
<span class="k">using</span> <span class="p">(</span><span class="n">TransactionContext</span> <span class="n">tx</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TransactionContext</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
<span class="p">{</span>
    <span class="n">tx</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">(</span><span class="n">IsolationLevel</span><span class="p">.</span><span class="n">ReadCommitted</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">3</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">sp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyTaskTableInsert</span><span class="p">();</span>
        <span class="c1">//...Set property of MyTaskTableInsert object</span>
        <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">sp</span><span class="p">.</span><span class="nf">ExecuteNonQueryAsync</span><span class="p">(</span><span class="n">tx</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">tx</span><span class="p">.</span><span class="nf">CommitTransaction</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>またテーブルのCRUD用のストアドを自動で生成する機能（アルファ版）もあります。</p>

<p>基本的にはストアドプロシージャの実行を簡単に出来るようにするためのツールです。業務アプリケーションでストアドプロシージャを使用する場合、C#でストアドプロシージャを呼び出すコードを書かないといけません。それをボタン一つで簡単に生成できるのが一番のメリットになります。</p>

<h2>
<span id="この記事の目次" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E7%9B%AE%E6%AC%A1"><i class="fa fa-link"></i></a>この記事の目次</h2>

<p>・DbSharpApplicationの使い方<br>
・テストファーストでの開発<br>
・単一責任の原則を適用する<br>
・StringBuilder vs TextWriter<br>
・StoredProcedureクラスの設計<br>
・データベースからスキーマデータを取得する(SqlGeometry,SqlGeography,HierarchyIdなども含む)<br>
・Enumのサポート<br>
・UserDefinedTypeについて<br>
・複数の結果セットを返すストアドプロシージャ<br>
・Asyncについて<br>
・Indentity列、RowGuid、Timestamp列について<br>
・高度な使い方<br>
・その他のORM、DALレイヤーのライブラリの紹介<br>
・まとめ</p>

<p>DbSharpはORMのようなマッピングの機能はなく、単純にストアドプロシージャの呼び出しのためのC#コードを自動生成します。ORMを使用している人でマッピングが辛くなった人は是非検討してみてください。</p>

<h1>
<span id="dbsharpapplicationの使い方" class="fragment"></span><a href="#dbsharpapplication%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>DbSharpApplicationの使い方</h1>

<p>DbSharpApplicationをお試しで使うための目次です。<br>
・Sample Databaseのセットアップ<br>
・DbSharpApplicationの起動<br>
・DatabaseTypeの選択（SQLサーバー、MySQL）と接続文字列の設定<br>
・ストアドプロシージャとユーザー定義型のインポート。メニューバー→編集→インポート<br>
・C#コードの生成。メニューバー→編集→C#ファイルの生成<br>
・VisualStudioでのクラスライブラリプロジェクトの作成とDLLへコンパイル<br>
・DLLを自分のアプリケーションで使用する</p>

<p><a href="https://github.com/higty/higlabo.netstandard/tree/master/Tools/DbSharp/HigLabo.DbSharp.Sample" rel="nofollow noopener" target="_blank">DbSharpSample on GitHub</a></p>

<p>GitHubにサンプルプロジェクトがあります。サンプルプロジェクトの構成は以下になります。<br>
・DbSharpSample.MySql.CSharp<br>
・DbSharpSample.SqlServer.CSharp<br>
・DbSharpSampleApp.MultiDatabase<br>
現状、作成済みなのはSqlServerとMySqlのみです。DbSharpSample.MySql.CSharpとDbSharpSample.SqlServer.CSharpのプロジェクトは全て自動生成されたC#のクラスで構成されています。Extensionsフォルダだけ自分で定義したEnumクラスがあります。Generatedフォルダ以下は自動生成です。</p>

<p>以下、これらのプロジェクトと同じプロジェクトを自分で作るためのチュートリアルです。SQLサーバーを例に解説していきます。<br>
※MySQLもほぼ同じ手順でできます。</p>

<h2>
<span id="dbsharpapplicationのチュートリアル" class="fragment"></span><a href="#dbsharpapplication%E3%81%AE%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB"><i class="fa fa-link"></i></a>DbSharpApplicationのチュートリアル</h2>

<p>SQLサーバーにデータベースを作成しManagementStudioでDbSharp_SqlServer.sqlを実行します。Azureの場合はDbSharp_SqlServer_Azure.sqlを実行してください。<br>
※DbSharp_SqlServer.sqlは<a href="https://github.com/higty/higlabo.netstandard/tree/master/Tools/DbSharp/HigLabo.DbSharp.Sample/DbSharpSample.SqlServer.CSharp" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/higty/higlabo.netstandard/tree/master/Tools/DbSharp/HigLabo.DbSharp.Sample/DbSharpSample.SqlServer.CSharp</a><br>
にあります。</p>

<p>DbSharpApplicationを起動しSqlServerを選択します。<br>
<a href="https://camo.qiitausercontent.com/1d5b0386cf8474b5356fb2d822d8e6be8234ccad/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e4c61756e63682e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationLaunch.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6492aa9857beb5b7a2955342c2e0398d" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationLaunch.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationLaunch.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e545d97064974951fb6292c1be06d3f5 1x" loading="lazy"></a></p>

<p>メニューバー→ツール→オプションからテーブル機能を使用にチェックをします。</p>

<p>メニューバー→編集→接続先の管理から接続文字列を追加します。<br>
<a href="https://camo.qiitausercontent.com/112d283384461d9da8021053375f877adb43c747/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e416464436f6e6e656374696f6e537472696e672e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAddConnectionString.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a0eb79620b7dc12b17b56e6f77508b62" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationAddConnectionString.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAddConnectionString.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=93750edd0af9b089a302f9f26e5f2d1a 1x" loading="lazy"></a></p>

<p>メニューバー→編集→インポートからDBに作成済みのストアドプロシージャをインポートします。<br>
<a href="https://camo.qiitausercontent.com/0413a2843a9fe2a14a21681fd62bda0156c7b656/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e456469744d656e752e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationEditMenu.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f4ff50c9fe04a3c1c636c4a4fd7e5a84" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationEditMenu.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationEditMenu.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=de50360cacfb93c04ef48782b1b13a2b 1x" loading="lazy"></a></p>

<p>接続ボタンをクリックしてDBのオブジェクトを読み込みます。読み込んだオブジェクトのチェックして実行ボタンを押します。<br>
<a href="https://camo.qiitausercontent.com/dc38c799e8e5b385237295c2184c775d718daaf3/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e496d706f72744f626a6563742e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationImportObject.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=327659b275a24d5923f20976ba68023e" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationImportObject.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationImportObject.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d38d6db8a0497d758520a3b802387644 1x" loading="lazy"></a></p>

<p>テーブル、ストアドプロシージャ、ユーザー定義型がインポートされます。<br>
<a href="https://camo.qiitausercontent.com/88c5001ee2c4face6eeffdcb5f9cd4dd378974ba/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e416c6c44617461547970655461626c652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTable.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a55fd37685a644970b68dfb43ea75367" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationAllDataTypeTable.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTable.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b24b5f5d50ee9b31b89a9001d5998728 1x" loading="lazy"></a></p>

<p>インポートしたオブジェクトのデータはファイル→保存でXML形式で保存できます。保存したXMLファイルはファイル→開くで開くことが可能です。</p>

<p>インポートしたストアドプロシージャはタブを切り替えることで確認できます。<br>
<a href="https://camo.qiitausercontent.com/04e84657d81a1c0f2c15600a40412dae48e77262/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e5573705f4f7574707574506172616d657465722e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationUsp_OutputParameter.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a9599a05dae861004a54c90bfe824219" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationUsp_OutputParameter.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationUsp_OutputParameter.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=835ef8b3c8223c4eb70b1fe39696f468 1x" loading="lazy"></a></p>

<p>インポートしたユーザー定義型はタブを切り替えることで確認できます。<br>
<a href="https://camo.qiitausercontent.com/2925b9a3c0fb91264ec35762c9478eec73b805e2/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e4d795461626c65547970652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationMyTableType.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c3424924f95da5ca814a50b38d8bbc88" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationMyTableType.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationMyTableType.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=fe7d1c0889b7692de0fc471808021ea9 1x" loading="lazy"></a></p>

<h3>
<span id="テーブル機能で生成されるcrud用のストアドプロシージャ" class="fragment"></span><a href="#%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E6%A9%9F%E8%83%BD%E3%81%A7%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%82%8Bcrud%E7%94%A8%E3%81%AE%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3"><i class="fa fa-link"></i></a>テーブル機能で生成されるCRUD用のストアドプロシージャ</h3>

<p>テーブル機能を有効にしてテーブルをインポートした場合、以下の5つのストアドプロシージャがインポートされているのが確認できます。<br>
・SelectAll<br>
・SelectByPrimaryKey<br>
・Insert<br>
・Update<br>
・Delete</p>

<p>これらのストアドプロシージャが作成されているのもタブを切り替えることで確認できます。<br>
<a href="https://camo.qiitausercontent.com/fc5fcae275fdcf1b1dfb2bc6fcc63168157e846c/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e416c6c44617461547970655461626c6553656c656374416c6c2e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTableSelectAll.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b7edcfc8f06a8b758f21896a6d693313" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationAllDataTypeTableSelectAll.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTableSelectAll.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9fee0ba8ba4c9196046577be2faba08d 1x" loading="lazy"></a></p>

<p>ストアドプロシージャに渡す引数や結果セットの列の値をEnumにしたい場合、EnumNameにEnumの名前を入力することでEnumで値をやり取りできるようになります。<br>
<a href="https://camo.qiitausercontent.com/fd8bb5062fda2ce69d2a8088f470f41f2d002adf/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e416c6c44617461547970655461626c65456e756d4e616d652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTableEnumName.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5d9cd599480ed8c1b06ee81dce66ec3f" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationAllDataTypeTableEnumName.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTableEnumName.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7d2f232fcf98fbe55c46206d76a4c8b1 1x" loading="lazy"></a></p>

<p>テーブルのEnumを変更すると対応するストアドプロシージャの引数のEnumNameも自動的に同期されているのが確認できます。<br>
<a href="https://camo.qiitausercontent.com/6f7e3ac5aabbf55a215335c50ff7d4449d9bc9d2/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e416c6c44617461547970655461626c65496e73657274456e756d4e616d652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTableInsertEnumName.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7dc85e758206617eebcc08bb5462a608" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationAllDataTypeTableInsertEnumName.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTableInsertEnumName.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e360af4ce42b08a730bc245a140aa38e 1x" loading="lazy"></a></p>

<h3>
<span id="複数の結果セットを返すストアドプロシージャ" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E3%81%AE%E7%B5%90%E6%9E%9C%E3%82%BB%E3%83%83%E3%83%88%E3%82%92%E8%BF%94%E3%81%99%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3"><i class="fa fa-link"></i></a>複数の結果セットを返すストアドプロシージャ</h3>

<p>Usp_SelectMultiTableを見ると複数の結果セットを返しているのが確認できます。<br>
<a href="https://camo.qiitausercontent.com/29d002451d93d1d23fe0ac392b2d1c0bc7342008/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e5573705f53656c6563744d756c74695461626c652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationUsp_SelectMultiTable.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=18c664aa0b7a20f8966482fd42f0f909" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationUsp_SelectMultiTable.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationUsp_SelectMultiTable.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a2d9ba2792721f5a74bd6ff2363a956e 1x" loading="lazy"></a></p>

<p>結果セットの名前は自由に変更できます。<br>
<a href="https://camo.qiitausercontent.com/ef103208284777bc8ad1b7dd49ca813cd7300b2d/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e4368616e6765526573756c745365744e616d652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationChangeResultSetName.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0d7752d62571b1225252dc1028837eb7" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationChangeResultSetName.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationChangeResultSetName.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=814ff7906249081c25ad4fd06b5ae6b3 1x" loading="lazy"></a></p>

<h3>
<span id="cファイルの自動生成" class="fragment"></span><a href="#c%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>C#ファイルの自動生成</h3>

<p>ここまで必要な設定（Enum,ResutSetの名前など）をしたらC#コードの生成をしてみましょう。<br>
・OutputDirectoryPath = フォルダパスを設定します。<br>
・RootNamespaceName = 生成されるファイルの名前空間を指定します。<br>
・DatabaseKey = 後で解説します。</p>

<p>実行ボタンを押して指定したフォルダにファイルを生成します。</p>

<p><a href="https://camo.qiitausercontent.com/e2ad0a0a00b0b06766c371ab56081b33436ef728/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e47656e6572617465435368617270436f64652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationGenerateCSharpCode.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4bb5dbf2899d35e21f30ed5d8a953fee" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationGenerateCSharpCode.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationGenerateCSharpCode.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=749ac29006fa29b691959ca843278c22 1x" loading="lazy"></a></p>

<p>クラスライブラリプロジェクト以下のGeneratedFilesフォルダの下にファイルが生成されます。<br>
<a href="https://camo.qiitausercontent.com/074e71b8fdfce62195c9539c52519c3be5a11436/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e47656e657261746564436f6465312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationGeneratedCode1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=96bfc4a46776b44ae4b076fe62be4930" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationGeneratedCode1.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationGeneratedCode1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ad6fa7def9e39f7e16a23ef75a33539d 1x" loading="lazy"></a></p>

<p>MyEnumを定義します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">enum</span> <span class="n">MyEnum</span>
<span class="p">{</span>
    <span class="n">Default</span><span class="p">,</span>
    <span class="n">Value1</span><span class="p">,</span>
    <span class="n">Value2</span><span class="p">,</span>
<span class="p">}</span>

</code></pre></div></div>

<p>クラスライブラリにMyEnumを追加します。<br>
<a href="https://camo.qiitausercontent.com/0c4ecaefe0193f87b196ae99b0c387b1a1c0b1e9/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e4164644d79456e756d2e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAddMyEnum.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ae59e8dc7b00969c7b486b3e01480bf5" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationAddMyEnum.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAddMyEnum.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6d7f69d4d6d9d47114ba5b781a643c94 1x" loading="lazy"></a></p>

<p>必要なDLLを追加します。<br>
・HigLabo.Core<br>
・HigLabo.Data<br>
・HigLabo.DbSharp<br>
SqlGeometry, SqlGeography, HierarchyIdを使用するならMicrosoft.SqlServer.Typesも必要です。</p>

<p><a href="https://camo.qiitausercontent.com/ab2fd75e1152536acb3cd7bf9ff886c24fb523b6/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e47656e657261746564436f64655265666572656e63652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationGeneratedCodeReference.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=767168f648e4aaa3b836d028a81932ac" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationGeneratedCodeReference.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationGeneratedCodeReference.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=cf28e9f4360b8495b61323bd3be349e3 1x" loading="lazy"></a></p>

<p>コンパイルしてこのプロジェクトをコンソールアプリケーションから参照します。これで以下のようなコードで簡単にDBへアクセスできます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">ss</span> <span class="p">=</span> <span class="n">Environment</span><span class="p">.</span><span class="nf">GetCommandLineArgs</span><span class="p">();</span>
<span class="n">String</span> <span class="n">connectionString</span> <span class="p">=</span> <span class="n">ss</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>
<span class="n">DatabaseFactory</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="nf">SetCreateDatabaseMethod</span><span class="p">(</span><span class="s">"DbSharpSample"</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">SqlServerDatabase</span><span class="p">(</span><span class="n">connectionString</span><span class="p">));</span>

<span class="n">AllDataTypeTable</span> <span class="n">t</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AllDataTypeTable</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">r</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AllDataTypeTable</span><span class="p">.</span><span class="nf">Record</span><span class="p">();</span>
<span class="n">r</span><span class="p">.</span><span class="n">PrimaryKeyColumn</span> <span class="p">=</span> <span class="m">11</span><span class="p">;</span>
<span class="n">r</span><span class="p">.</span><span class="n">IntColumn</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
<span class="c1">//Set properties...</span>
<span class="kt">var</span> <span class="n">x1</span> <span class="p">=</span> <span class="n">t</span><span class="p">.</span><span class="nf">Insert</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>

</code></pre></div></div>

<p>詳しい使用方法は後のセクションで解説します。</p>

<h1>
<span id="テストファーストで開発する" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%83%95%E3%82%A1%E3%83%BC%E3%82%B9%E3%83%88%E3%81%A7%E9%96%8B%E7%99%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>テストファーストで開発する</h1>

<p>このセクションでは「テストファースト」での開発手法について実際の開発を例にして解説していきます。このセクションでは以下のようなC#のクラスを生成することをゴールにして順番に説明していきます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">Int32</span> <span class="n">_Age</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

    <span class="k">public</span> <span class="n">String</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">Int32</span> <span class="n">Age</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_Age</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;</span> <span class="n">Children</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">Person</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">Children</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;();</span>
        <span class="k">this</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">ShowName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">AddAge</span><span class="p">(</span><span class="n">Int32</span> <span class="k">value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_Age</span> <span class="p">+=</span> <span class="k">value</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>自動生成するC#の構成要素を以下のように分類して設計しました。<br>
・TypeName<br>
・Field<br>
・AccessModifier<br>
・MethodAccessModifier<br>
・FieldModifier<br>
・ConstructorModifier<br>
・Constructor<br>
・MethodModifier<br>
・MethodParameter<br>
・Method<br>
・PropertyBody<br>
・Property<br>
・ClassModifier<br>
・Class<br>
・InterfaceProperty<br>
・InterfaceMethod<br>
・Interface<br>
・Namespace<br>
・SourceCode</p>

<p>TypeNameは型の名前の部分を生成するためのクラスになります。Int32,Person,List,Dictionary&gt;といったクラス名を生成します。最初にこのTypeNameのテストケースを考えてみましょう。以下のようなテストケースを作ってみます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="p">[</span><span class="n">TestClass</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">TypeNameTest</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">TypeNameWithoutGenericTypes</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">tp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"Int32"</span><span class="p">);</span>
        <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="s">"Int32"</span><span class="p">,</span> <span class="n">tp</span><span class="p">.</span><span class="nf">Write</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">TypeNameWithGenericTypes</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">tp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"Func"</span><span class="p">);</span>
        <span class="n">tp</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"String"</span><span class="p">));</span>
        <span class="n">tp</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"Int32"</span><span class="p">));</span>
        <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="s">"Func&lt;String, Int32&gt;"</span><span class="p">,</span> <span class="n">tp</span><span class="p">.</span><span class="nf">Write</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">TypeNameWithNestedGenericTypes</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">tp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"Func"</span><span class="p">);</span>
        <span class="n">tp</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"String"</span><span class="p">));</span>
        <span class="kt">var</span> <span class="n">tp1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"Action"</span><span class="p">);</span>
        <span class="n">tp1</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"String"</span><span class="p">));</span>
        <span class="n">tp1</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"Int32"</span><span class="p">));</span>
        <span class="n">tp</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">tp1</span><span class="p">);</span>
        <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="s">"Func&lt;String, Action&lt;String, Int32&gt;&gt;"</span><span class="p">,</span> <span class="n">tp</span><span class="p">.</span><span class="nf">Write</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これらのテストケースをパスするようにTypeNameクラスを作成します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">TypeName</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">TypeName</span><span class="p">&gt;</span> <span class="n">GenericTypes</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="nf">TypeName</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">GenericTypes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">TypeName</span><span class="p">&gt;();</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="n">String</span> <span class="nf">Write</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

        <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"&lt;"</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">tp</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">tp</span><span class="p">.</span><span class="nf">Write</span><span class="p">());</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"&gt;"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>テストを実行し全てのテストがパスされることを確認します。同様にテストケースを作成しそれからクラスを作成してテストをパスしていきます。C#のソースコードを生成するのはDbSharp以外の場所でも利用できるのでHigLabo.CodeGeneratorプロジェクトに置いてあります。</p>

<p><a href="https://github.com/higty/higlabo.netstandard/tree/master/HigLabo.Test" rel="nofollow noopener" target="_blank">HigLabo.Test on GitHub</a></p>

<h1>
<span id="単一責任の原則single-responsibility-principle" class="fragment"></span><a href="#%E5%8D%98%E4%B8%80%E8%B2%AC%E4%BB%BB%E3%81%AE%E5%8E%9F%E5%89%87single-responsibility-principle"><i class="fa fa-link"></i></a>単一責任の原則（Single Responsibility Principle）</h1>

<p>このセクションでは単一責任の原則を適用し、複数の言語（C#,VB.NET）に対してソースコードを生成するクラスの設計について解説します。上記のクラスでVB.NETのソースを生成しようとした場合、設計上の問題が発生します。VB.NETのソースを生成しようとした場合、以下のようにVB.NET用のメソッドを追加する必要があります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">TypeName</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">TypeName</span><span class="p">&gt;</span> <span class="n">GenericTypes</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="nf">TypeName</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">GenericTypes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">TypeName</span><span class="p">&gt;();</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="n">String</span> <span class="nf">WriteCSharp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//..method body</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="n">String</span> <span class="nf">WriteVB</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//..method body</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>もし他にもJavaやF#やPythonのGeneratorを追加しようとした場合、その度にWriteXXXメソッドをTypeNameクラスに追加する必要があります。C#の担当者とVBの担当者が同じファイルに対して作業をすることになります。最近のソースコード管理の充実から同じファイルでもそんなに問題ないとはいえ、可能であれば別のファイルに対して作業ができるとマージ作業などをする必要がないのでベターです。</p>

<h2>
<span id="クラスの設計を改善する" class="fragment"></span><a href="#%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E8%A8%AD%E8%A8%88%E3%82%92%E6%94%B9%E5%96%84%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>クラスの設計を改善する</h2>

<p>さて以上を踏まえクラスのデザインを見直します。TypeNameクラスはクラスの情報のみをもち、ソースコードの生成機能を持たないように変更します。新たにSourceCodeGeneratorクラスを作成し、こちらでソースの生成とソースのフォーマットの設定などをできるように設計します。</p>

<p>これが単一責任の原則で<br>
・TypeNameクラス→クラスの情報を持つEntityクラス<br>
・SourceCodeGeneratorクラス→ソースコードの生成<br>
という形でそれぞれが単一の責任を持つように設計します。変更前はTypeNameがクラスの情報＋ソースコードの生成という二つの役割を持っていたためどうしてもクラスが肥大化してしまいがちになります。このように責任を単一にして分割することですっきりとした設計になります。</p>

<p>さて分割し終わったところで新たにテストファーストでテストを作成します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="p">[</span><span class="n">TestClass</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">TypeNameTest</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">TypeNameWithoutGenericTypes</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">tp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"Int32"</span><span class="p">);</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">g</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CSharpSourceCodeGenerator</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="s">"Int32"</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">tp</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">g</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">VisualBasicSourceCodeGenerator</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="s">"Int32"</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">tp</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">TypeNameWithGenericTypes</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">tp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"Func"</span><span class="p">);</span>
        <span class="n">tp</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"String"</span><span class="p">));</span>
        <span class="n">tp</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"Int32"</span><span class="p">));</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">g</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CSharpSourceCodeGenerator</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="s">"Func&lt;String, Int32&gt;"</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">tp</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">g</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">VisualBasicSourceCodeGenerator</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="s">"Func(Of String, Int32)"</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">tp</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">TypeNameWithNestedGenericTypes</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">tp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"Func"</span><span class="p">);</span>
        <span class="n">tp</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"String"</span><span class="p">));</span>
        <span class="kt">var</span> <span class="n">tp1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"Action"</span><span class="p">);</span>
        <span class="n">tp1</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"String"</span><span class="p">));</span>
        <span class="n">tp1</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypeName</span><span class="p">(</span><span class="s">"Int32"</span><span class="p">));</span>
        <span class="n">tp</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">tp1</span><span class="p">);</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">g</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CSharpSourceCodeGenerator</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="s">"Func&lt;String, Action&lt;String, Int32&gt;&gt;"</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">tp</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">g</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">VisualBasicSourceCodeGenerator</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="s">"Func(Of String, Action(Of String, Int32))"</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">tp</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>CSharpSourceCodeGeneratorクラスの内部実装は以下のようにあるでしょう。TypeNameにあったメソッドを移してきた形になります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">CSharpSourceCodeGenerator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">CSharpSourceCodeGenerator</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="n">String</span> <span class="nf">Write</span><span class="p">(</span><span class="n">TypeName</span> <span class="n">typeName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

        <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">typeName</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"&lt;"</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">tp</span> <span class="p">=</span> <span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">tp</span><span class="p">));</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;</span> <span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"&gt;"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>VisualBasicSourceCodeGeneratorは以下のようになります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">VisualBasicSourceCodeGenerator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">String</span> <span class="nf">Write</span><span class="p">(</span><span class="n">TypeName</span> <span class="n">typeName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

        <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">typeName</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"(Of "</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">tp</span> <span class="p">=</span> <span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">tp</span><span class="p">));</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;</span> <span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">")"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>TypeNameクラスは以下のようになります。ソース生成部分が無くなったおかげで簡単になりました。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">TypeName</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">TypeName</span><span class="p">&gt;</span> <span class="n">GenericTypes</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="nf">TypeName</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">GenericTypes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">TypeName</span><span class="p">&gt;();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>以上の設計の改善により、TypeNameとSourceCodeGeneratorクラスでファイルが分割され、さらに各言語ごとでSourceCodeGeneratorクラスを分割でき非常に作業がしやすくなりました。新しい言語やフォーマットを追加する際に、TypeNameなどのクラスに一切手を入れずに変更が可能です。これにより変更に強く、拡張もしやすいという形になっています。例えばクラスの定義をHTMLに表示するためのHTML Generatorなどを作成しHigLabo.HtmlGenerator.dllのようなDLLを作成することも既存コードを破壊することなく簡単に作成できます。</p>

<h1>
<span id="stringbuilder-vs-textwriter" class="fragment"></span><a href="#stringbuilder-vs-textwriter"><i class="fa fa-link"></i></a>StringBuilder vs TextWriter</h1>

<p>このセクションではTextWriterを使ってStringBuilderを使った時よりもより良いパフォーマンスを実現する方法について解説します。その為にCSharpSourceCodeGeneratorの設計を変更します。</p>

<p>実際の業務アプリケーションでは大量のストアドプロシージャからソースコードの生成を行う可能性があります。パフォーマンス、メモリの使用量などはしっかりと考慮したいところです。</p>

<p>StringBuilderを使用するとStringの使用時よりは遥かに良いパフォーマンスを実現できます。しかしToStringメソッドを読んだ瞬間にStringBuilderはメモリを浪費してしまいます。TextWriterを使用することでファイルシステムに直接データを書き込むことが可能です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="p">(</span><span class="n">TextWriter</span> <span class="n">writer</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="nf">CreateText</span><span class="p">(</span><span class="s">"MyFile.txt"</span><span class="p">))</span>
<span class="p">{</span>
    <span class="n">writer</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"my data"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>SourceCodeGeneratorクラスをTextWriterに対応した形に設計を改善してみます。<br>
CSharpSourceCodeGeneratorは以下のようになります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">CSharpSourceCodeGenerator</span> <span class="p">:</span> <span class="n">SourceCodeGenerator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">SourceCodeLanguage</span> <span class="n">Language</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">SourceCodeLanguage</span><span class="p">.</span><span class="n">CSharp</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nf">CSharpSourceCodeGenerator</span><span class="p">(</span><span class="n">TextWriter</span> <span class="n">textWriter</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">textWriter</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">TypeName</span> <span class="n">typeName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">writer</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">TextWriter</span><span class="p">;</span>

        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">typeName</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">"&lt;"</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">tp</span> <span class="p">=</span> <span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">tp</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;</span> <span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">"&gt;"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//Other method...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>VisualBasicSourceCodeGeneratorの実装です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">VisualBasicSourceCodeGenerator</span><span class="p">:</span> <span class="n">SourceCodeGenerator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">SourceCodeLanguage</span> <span class="n">Language</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">SourceCodeLanguage</span><span class="p">.</span><span class="n">VB</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nf">VisualBasicSourceCodeGenerator</span><span class="p">(</span><span class="n">TextWriter</span> <span class="n">textWriter</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">textWriter</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">TypeName</span> <span class="n">typeName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">writer</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">TextWriter</span><span class="p">;</span>

        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">typeName</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">"(Of "</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">tp</span> <span class="p">=</span> <span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">tp</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;</span> <span class="n">typeName</span><span class="p">.</span><span class="n">GenericTypes</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">")"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//Other method...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>SourceCodeGeneratorに共通のメソッドを定義しCSharpSourceCodeGenerator,VisualBasicSourceCodeGeneratorで実装することにします。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">SourceCodeGenerator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">Indent</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">Int32</span> <span class="n">CurrentIndentLevel</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">TextWriter</span> <span class="n">TextWriter</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="n">SourceCodeLanguage</span> <span class="n">Language</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">protected</span> <span class="nf">SourceCodeGenerator</span><span class="p">(</span><span class="n">TextWriter</span> <span class="n">textWriter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">Indent</span> <span class="p">=</span> <span class="s">"    "</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">CurrentIndentLevel</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">TextWriter</span> <span class="p">=</span> <span class="n">textWriter</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">TypeName</span> <span class="n">typeName</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">CodeBlock</span> <span class="n">codeBlock</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">AccessModifier</span> <span class="n">modifier</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">MethodAccessModifier</span> <span class="n">modifier</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">FieldModifier</span> <span class="n">modifier</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">Field</span> <span class="n">field</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">ConstructorModifier</span> <span class="n">modifier</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">Constructor</span> <span class="n">constructor</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">MethodModifier</span> <span class="n">modifier</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">MethodParameter</span> <span class="n">parameter</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">Method</span> <span class="n">method</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">PropertyBody</span> <span class="n">propertyBody</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">Property</span> <span class="n">property</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">ClassModifier</span> <span class="n">modifier</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">Class</span> <span class="n">@class</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">InterfaceProperty</span> <span class="n">property</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">InterfaceMethod</span> <span class="n">method</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">Interface</span> <span class="n">@interface</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">Namespace</span> <span class="n">@namespace</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">SourceCode</span> <span class="n">sourceCode</span><span class="p">);</span>

    <span class="k">protected</span> <span class="k">void</span> <span class="nf">WriteIndent</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="n">CurrentIndentLevel</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">TextWriter</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Indent</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">protected</span> <span class="k">void</span> <span class="nf">WriteLineAndIndent</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">WriteLineAndIndent</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">protected</span> <span class="k">void</span> <span class="nf">WriteLineAndIndent</span><span class="p">(</span><span class="n">String</span> <span class="n">text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">TextWriter</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="n">CurrentIndentLevel</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">TextWriter</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Indent</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Flush</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">TextWriter</span><span class="p">.</span><span class="nf">Flush</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上記の完全な実装はGitHubにあります。<br>
<a href="https://github.com/higty/higlabo.netstandard/tree/master/HigLabo.CodeGenerator" rel="nofollow noopener" target="_blank">HigLabo.CodeGenerator on GitHub</a></p>

<p>自動生成されたC#のソースコードは以下にあります。<br>
<a href="https://github.com/higty/higlabo.netstandard/tree/master/Tools/DbSharp/HigLabo.DbSharp.Sample" rel="nofollow noopener" target="_blank">HigLabo.DbSharp.Sample on GitHub</a></p>

<p>実は時間がなくてVB.NETバージョンはありません。（誰かに作ってくれる人なんていないかな…）</p>

<h1>
<span id="storedprocedureクラスの利用方法を設計する" class="fragment"></span><a href="#storedprocedure%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95%E3%82%92%E8%A8%AD%E8%A8%88%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>StoredProcedureクラスの利用方法を設計する</h1>

<p>このセクションではストアドプロシージャを呼び出す時のAPIの設計について解説します。ストアドプロシージャは2つのタイプに分けられます。<br>
・結果セットを返さないストアドプロシージャ（insert,updateなど）<br>
・結果セットを返すストアドプロシージャ（select * from...）<br>
この二つと複数データベース、トランザクションを直感的に利用できるAPIについて考えます。</p>

<p>以下のスクリプトでデータベースにサンプルのテーブルとストアドプロシージャを作成します。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre class="with-code"><code><span class="k">Create</span> <span class="k">Table</span> <span class="n">MyTaskTable</span>
<span class="p">(</span><span class="n">TaskId</span> <span class="n">UniqueIdentifier</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">,</span><span class="n">Title</span> <span class="n">Nvarchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">Not</span> <span class="k">Null</span>
<span class="p">,[</span><span class="n">Priority</span><span class="p">]</span> <span class="nb">Int</span> <span class="k">Not</span> <span class="k">Null</span>
<span class="p">,[</span><span class="k">State</span><span class="p">]</span> <span class="n">Nvarchar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">Not</span> <span class="k">Null</span>
<span class="p">,</span><span class="n">CreateTime</span> <span class="nb">Datetime</span> <span class="k">Not</span> <span class="k">Null</span>
<span class="p">,</span><span class="n">ScheduleDate</span> <span class="nb">Date</span>
<span class="p">,</span><span class="n">Detail</span> <span class="n">Nvarchar</span><span class="p">(</span><span class="k">max</span><span class="p">)</span> <span class="k">Not</span> <span class="k">Null</span>
<span class="p">,</span><span class="n">TimestampColumn</span> <span class="nb">Timestamp</span>
<span class="p">)</span>

<span class="k">Go</span>

<span class="k">Alter</span> <span class="k">Table</span> <span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">MyTaskTable</span><span class="p">]</span> <span class="k">Add</span> <span class="k">Constraint</span> <span class="p">[</span><span class="n">PK_MyTaskTable</span><span class="p">]</span>
<span class="k">Primary</span> <span class="k">Key</span> <span class="n">Clustered</span> <span class="p">(</span><span class="n">TaskId</span><span class="p">)</span>

<span class="k">Go</span>


<span class="k">Create</span> <span class="k">Procedure</span> <span class="n">MyTaskTableInsert</span>
<span class="p">(</span><span class="o">@</span><span class="n">TaskId</span> <span class="n">UniqueIdentifier</span>
<span class="p">,</span><span class="o">@</span><span class="n">Title</span> <span class="n">Nvarchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">,</span><span class="o">@</span><span class="n">Priority</span> <span class="nb">Int</span>
<span class="p">,</span><span class="o">@</span><span class="k">State</span> <span class="n">Nvarchar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">,</span><span class="o">@</span><span class="n">CreateTime</span> <span class="nb">Datetime</span>
<span class="p">,</span><span class="o">@</span><span class="n">ScheduleDate</span> <span class="nb">Date</span>
<span class="p">,</span><span class="o">@</span><span class="n">Detail</span> <span class="n">Nvarchar</span><span class="p">(</span><span class="k">max</span><span class="p">)</span>
<span class="p">)</span> <span class="k">As</span>

<span class="k">Insert</span> <span class="k">Into</span> <span class="n">MyTaskTable</span> <span class="p">(</span><span class="n">TaskId</span><span class="p">,</span> <span class="n">Title</span><span class="p">,</span> <span class="p">[</span><span class="n">Priority</span><span class="p">],</span> <span class="p">[</span><span class="k">State</span><span class="p">],</span> <span class="n">CreateTime</span><span class="p">,</span> <span class="n">ScheduleDate</span><span class="p">,</span> <span class="n">Detail</span><span class="p">)</span>
<span class="k">Values</span> <span class="p">(</span><span class="o">@</span><span class="n">TaskId</span><span class="p">,</span> <span class="o">@</span><span class="n">Title</span><span class="p">,</span> <span class="o">@</span><span class="n">Priority</span><span class="p">,</span> <span class="o">@</span><span class="k">State</span><span class="p">,</span> <span class="o">@</span><span class="n">CreateTime</span><span class="p">,</span> <span class="o">@</span><span class="n">ScheduleDate</span><span class="p">,</span> <span class="o">@</span><span class="n">Detail</span><span class="p">)</span>

<span class="k">Go</span>


<span class="k">Create</span> <span class="k">Procedure</span> <span class="n">MyTaskTableSelectBy_TaskId</span>
<span class="p">(</span><span class="o">@</span><span class="n">TaskId</span> <span class="n">UniqueIdentifier</span>
<span class="p">)</span> <span class="k">As</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">MyTaskTable</span> <span class="k">with</span><span class="p">(</span><span class="n">nolock</span><span class="p">)</span>
<span class="k">where</span> <span class="n">TaskId</span> <span class="o">=</span> <span class="o">@</span><span class="n">TaskId</span>


<span class="k">Go</span>
</code></pre></div></div>

<p>ストアドプロシージャを使用する場合、C#でストアドプロシージャを呼び出すコードを書かなければなりません。呼び出しやすいコードについて設計します。</p>

<h2>
<span id="単純なストアドプロシージャの実行" class="fragment"></span><a href="#%E5%8D%98%E7%B4%94%E3%81%AA%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3%E3%81%AE%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>単純なストアドプロシージャの実行</h2>

<p>例えば以下のような形で呼び出せると分かりやすく感じます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HigLabo</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="nf">SqlServerDatabase</span><span class="p">(</span><span class="s">"connection string"</span><span class="p">);</span>

<span class="c1">//Execute stored procedure</span>
<span class="kt">var</span> <span class="n">sp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyTaskTableInsert</span><span class="p">();</span><span class="c1">//Same name to stored procedure on database</span>
<span class="n">sp</span><span class="p">.</span><span class="n">TaskId</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">();</span><span class="c1">//Strongly typed property corresponding to stored procedure's parameter</span>
<span class="n">sp</span><span class="p">.</span><span class="n">Title</span> <span class="p">=</span> <span class="s">"Post article to CodeProject"</span><span class="p">;</span>
<span class="n">sp</span><span class="p">.</span><span class="n">Priority</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
<span class="n">sp</span><span class="p">.</span><span class="n">State</span> <span class="p">=</span> <span class="s">"Executing"</span><span class="p">;</span>
<span class="n">sp</span><span class="p">.</span><span class="n">CreateTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>
<span class="n">sp</span><span class="p">.</span><span class="n">ScheduleDate</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">2014</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">25</span><span class="p">);</span>
<span class="n">sp</span><span class="p">.</span><span class="n">Detail</span> <span class="p">=</span> <span class="s">"...Draft..."</span><span class="p">;</span>
<span class="c1">//Execute MyTaskTableInsert stored procedure on database and get affected record count.</span>
<span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">sp</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">(</span><span class="n">db</span><span class="p">);</span>
<span class="c1">//or call like this</span>
<span class="c1">//var result1 = db.Execute(sp);</span>

<span class="kt">var</span> <span class="n">sp1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyTaskTableSelectBy_TaskId</span><span class="p">();</span>
<span class="n">sp1</span><span class="p">.</span><span class="n">TaskId</span> <span class="p">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">TaskId</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">recordList</span> <span class="p">=</span> <span class="n">sp</span><span class="p">.</span><span class="nf">GetResultSets</span><span class="p">();</span><span class="c1">//Get list of POCO object that represent a record of table on database.</span>
<span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">record</span> <span class="k">in</span> <span class="n">recordList</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//Do something...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ストアドの名前でプロパティに引数の値をセットしてメソッド実行という形で非常に直感的に使えそうです。SqlCommandのParameterだと引数名を入力しなければなりませんが、自動生成でプロパティが生成されていればインテリセンスが利いて仕様書を見る必要もなく、型も適切に定義されていて安全に使用できそうです。</p>

<h2>
<span id="同じスキーマの複数のデータベースへの実行" class="fragment"></span><a href="#%E5%90%8C%E3%81%98%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%AE%E8%A4%87%E6%95%B0%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%B8%E3%81%AE%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>同じスキーマの複数のデータベースへの実行</h2>

<p>複数の同じスキーマのDBへストアドプロシージャを実行するには以下のように書けると良いです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">db1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HigLabo</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="nf">SqlServerDatabase</span><span class="p">(</span><span class="s">"connection string to DB1"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">db2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HigLabo</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="nf">SqlServerDatabase</span><span class="p">(</span><span class="s">"connection string to DB2"</span><span class="p">);</span>

<span class="c1">//Execute stored procedure</span>
<span class="kt">var</span> <span class="n">sp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyTaskTableInsert</span><span class="p">();</span>
<span class="n">sp</span><span class="p">.</span><span class="n">TaskId</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">();</span>
<span class="n">sp</span><span class="p">.</span><span class="n">Title</span> <span class="p">=</span> <span class="s">"Post article to CodeProject"</span><span class="p">;</span>
<span class="n">sp</span><span class="p">.</span><span class="n">Priority</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
<span class="n">sp</span><span class="p">.</span><span class="n">State</span> <span class="p">=</span> <span class="s">"Executing"</span><span class="p">;</span>
<span class="n">sp</span><span class="p">.</span><span class="n">CreateTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>
<span class="n">sp</span><span class="p">.</span><span class="n">ScheduleDate</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">2014</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">25</span><span class="p">);</span>
<span class="n">sp</span><span class="p">.</span><span class="n">Detail</span> <span class="p">=</span> <span class="s">"...Draft..."</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">db1Result1</span> <span class="p">=</span> <span class="n">sp</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">(</span><span class="n">db1</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">db2Result1</span> <span class="p">=</span> <span class="n">sp</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">(</span><span class="n">db2</span><span class="p">);</span>
<span class="c1">//Or call like this</span>
<span class="kt">var</span> <span class="n">db1Result2</span> <span class="p">=</span> <span class="n">db1</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="n">sp</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">db2Result2</span> <span class="p">=</span> <span class="n">db2</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="n">sp</span><span class="p">);</span>
</code></pre></div></div>

<h2>
<span id="トランザクションについて" class="fragment"></span><a href="#%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B6%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>トランザクションについて</h2>

<p>トランザクションについては以下のように実行できると直感的に使えそうです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HigLabo</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="nf">SqlServerDatabase</span><span class="p">(</span><span class="s">"connection string"</span><span class="p">);</span>
<span class="k">using</span> <span class="p">(</span><span class="n">TransactionContext</span> <span class="n">tx</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TransactionContext</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
<span class="p">{</span>
    <span class="n">tx</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">(</span><span class="n">IsolationLevel</span><span class="p">.</span><span class="n">ReadCommitted</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">3</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">sp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyTaskTableInsert</span><span class="p">();</span>
        <span class="c1">//...Set property of MyTaskTableInsert object</span>
        <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">sp</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">(</span><span class="n">tx</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">tx</span><span class="p">.</span><span class="nf">CommitTransaction</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>時には複数のトランザクションを並列に実行したい場合もあるかもしれません。その時は以下のように書けると分かりやすく実行できそうです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">db1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HigLabo</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="nf">SqlServerDatabase</span><span class="p">(</span><span class="s">"connection string to DB1"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">db2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HigLabo</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="nf">SqlServerDatabase</span><span class="p">(</span><span class="s">"connection string to DB2"</span><span class="p">);</span>

<span class="k">using</span> <span class="p">(</span><span class="n">TransactionContext</span> <span class="n">tx1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TransactionContext</span><span class="p">(</span><span class="n">db1</span><span class="p">)))</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="n">TransactionContext</span> <span class="n">tx2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TransactionContext</span><span class="p">(</span><span class="n">db2</span><span class="p">)))</span>
    <span class="p">{</span>
        <span class="n">tx1</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">(</span><span class="n">IsolationLevel</span><span class="p">.</span><span class="n">ReadCommitted</span><span class="p">);</span>
        <span class="n">tx2</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">(</span><span class="n">IsolationLevel</span><span class="p">.</span><span class="n">ReadCommitted</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">3</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">sp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyTaskTable1Insert</span><span class="p">();</span>
            <span class="c1">//...Set property of MyTaskTableInsert object</span>
            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">sp</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">(</span><span class="n">tx1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">3</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">sp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyTaskTable2Insert</span><span class="p">();</span>
            <span class="c1">//...Set property of MyTaskTableInsert object</span>
            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">sp</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">(</span><span class="n">tx2</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">tx1</span><span class="p">.</span><span class="nf">CommitTransaction</span><span class="p">();</span>
        <span class="n">tx2</span><span class="p">.</span><span class="nf">CommitTransaction</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="データベースが一つの場合" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%8C%E4%B8%80%E3%81%A4%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>データベースが一つの場合</h2>

<p>データベースが複数の場合は以上のような書き方で良いけれども、小規模なシステムでは毎回DBを渡すのは少し面倒かもしれません。例えば以下のようにデフォルトのDBを設定してそれを使用してくれる形になっているとさらに使いやすくなりそうです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">//Call once on application start what database you use...</span>
<span class="n">DatabaseFactory</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="nf">SetCreateDatabaseMethod</span><span class="p">(</span><span class="s">"DbSharpSample"</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">HigLabo</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="nf">SqlServerDatabase</span><span class="p">(</span><span class="s">"connection string to db"</span><span class="p">));</span>

<span class="kt">var</span> <span class="n">sp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyTaskTableInsert</span><span class="p">();</span>
<span class="c1">//sp.GetDatabaseKey() returns "DbSharpSample".</span>
<span class="c1">//You can specify DatabaseKey when you generate code.</span>
<span class="c1">//That makes you set different factory method for each database that has different schema.</span>

<span class="n">sp</span><span class="p">.</span><span class="n">TaskId</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">();</span>
<span class="c1">//Set other properties...</span>
<span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">sp</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span><span class="c1">//Executed to db</span>
</code></pre></div></div>

<p>ここでDbSharpApplicationで設定したDatabaseKeyの値が使われることになります。自動生成されたストアドプロシージャクラスのDatabaseKeyの既定値が設定した値になっています。そのキーの値でDatabaseFactory.Current.SetCreateDatabaseMethodでHigLabo.Data.SqlServerDatabaseオブジェクトを生成するように設定します。そうすることでアプリケーション全体でこの既定のデータベースが使用されることになります。</p>

<h2>
<span id="databasekeyとtransactioncontextの混在" class="fragment"></span><a href="#databasekey%E3%81%A8transactioncontext%E3%81%AE%E6%B7%B7%E5%9C%A8"><i class="fa fa-link"></i></a>DatabaseKeyとTransactionContextの混在</h2>

<p>DatabaseKeyとTransactionContextを直接渡すのが混在した場合は、TransactionContextのほうが優先されることになります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">//Call once on application start what database you use...</span>
<span class="n">DatabaseFactory</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="nf">SetCreateDatabaseMethod</span><span class="p">(</span><span class="s">"DbSharpSample"</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">HigLabo</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="nf">SqlServerDatabase</span><span class="p">(</span><span class="s">"connection string to db1"</span><span class="p">));</span>

<span class="kt">var</span> <span class="n">db2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HigLabo</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="nf">SqlServerDatabase</span><span class="p">(</span><span class="s">"connection string"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">sp1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyTaskTableInsert</span><span class="p">();</span>
<span class="c1">//...Set property of MyTaskTableInsert object</span>
<span class="kt">var</span> <span class="n">result1</span> <span class="p">=</span> <span class="n">sp1</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span><span class="c1">//Executed to db1</span>
<span class="k">using</span> <span class="p">(</span><span class="n">TransactionContext</span> <span class="n">tx</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TransactionContext</span><span class="p">(</span><span class="n">db2</span><span class="p">))</span>
<span class="p">{</span>
    <span class="n">tx</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">(</span><span class="n">IsolationLevel</span><span class="p">.</span><span class="n">ReadCommitted</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">sp2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyTaskTableInsert</span><span class="p">();</span>
    <span class="c1">//...Set property of MyTaskTableInsert object</span>
    <span class="kt">var</span> <span class="n">result2</span> <span class="p">=</span> <span class="n">sp2</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">(</span><span class="n">tx</span><span class="p">);</span>
    <span class="n">tx</span><span class="p">.</span><span class="nf">CommitTransaction</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h1>
<span id="ストアドプロシージャクラスの実装の設計" class="fragment"></span><a href="#%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%AE%E8%A8%AD%E8%A8%88"><i class="fa fa-link"></i></a>ストアドプロシージャクラスの実装の設計</h1>

<p>実際に実装するに当たってのクラスの設計はこんな感じで設計してみました。</p>

<p><a href="https://camo.qiitausercontent.com/a90deb722dd4e3e978084e778550fc61b016851a/68747470733a2f2f692e696d6775722e636f6d2f575044615563592e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.imgur.com%2FWPDaUcY.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=af9092859551fbedee5cbc78e3075edd" alt="alt" data-canonical-src="https://i.imgur.com/WPDaUcY.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.imgur.com%2FWPDaUcY.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=52bf20cc8265348a85a82553ee5086f4 1x" loading="lazy"></a></p>

<h2>
<span id="higlabodbsharpdllに定義されるクラス" class="fragment"></span><a href="#higlabodbsharpdll%E3%81%AB%E5%AE%9A%E7%BE%A9%E3%81%95%E3%82%8C%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>HigLabo.DbSharp.dllに定義されるクラス</h2>

<h3>
<span id="storedprocedureクラス" class="fragment"></span><a href="#storedprocedure%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>StoredProcedureクラス</h3>

<p>StoredProcedureクラスはストアドプロシージャ（結果セット無し）の共通の処理を定義することになります。具体的には<br>
・ExecuteNonQuery()<br>
・ExecuteNonQueryAsync()<br>
になる。さらに子クラスで実装するべき抽象メソッドとして<br>
・GetStoredProcedureName()<br>
・CreateCommand()<br>
・SetOutputParameterValue()<br>
が定義されます。GetStoredProcedureName()はストアドの名前を返すメソッド、CreateCommand()はプロパティにセットされた値からDbCommandを生成するメソッドになります。ExecuteNonQuery()を呼ぶとストアドが実行されます。SetOutputParameterValue()の内部ではOutputパラメータの値がプロパティにセットされます。このメソッドはTimestamp、Identity列などを使用した際に内部で使われ、ExecuteNonQuery()を実行後にDB上で生成された値をStoredProcedureクラスのプロパティにセットしてくれます。</p>

<h3>
<span id="databaserecordとstoredprocedureresultsetクラス" class="fragment"></span><a href="#databaserecord%E3%81%A8storedprocedureresultset%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>DatabaseRecordとStoredProcedureResultSetクラス</h3>

<p>これらは結果セットのクラスの基底クラスになります。MultiPkTableSelectByPrimaryKey.ResultSetクラスの親クラスがStoredProcedureResultSetになります。MultiPkTableSelectByPrimaryKey.ResultSetクラスはいわゆるPOCOクラスで結果セットの各値をプロパティとして持つクラスです。</p>

<h3>
<span id="storedprocedurewithresultsetクラス" class="fragment"></span><a href="#storedprocedurewithresultset%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>StoredProcedureWithResultSetクラス</h3>

<p>StoredProcedureWithResultSetクラスはストアドプロシージャ（結果セット有り）の共通の処理が定義されています。<br>
・GetDataTable()<br>
・GetResultSets()<br>
・EnumerateResultSets()<br>
に共通ロジックが実装されています。ただこのままでは戻り値はStoredProcedureResultSetとなり、自動生成されてResultSetクラスではないので使い勝手が悪い状態です。</p>

<h3>
<span id="storedprocedurewithresultsettクラス" class="fragment"></span><a href="#storedprocedurewithresultsett%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>StoredProcedureWithResultSet&lt;T&gt;クラス</h3>

<p>StoredProcedureWithResultSet&lt;T&gt;クラスはStoredProcedureWithResultSetクラスの戻り値をより具体的な型として返す機能を提供するクラスになります。このクラスには<br>
・SetResultSet()<br>
・CreateResultSet()<br>
が定義されていて、これらの抽象メソッドは自動生成される子クラスで実装するべき抽象メソッドになります。StoredProcedureWithResultSetクラスを自動生成されたストアドプロシージャクラスで継承することで共通処理を1か所に定義しつつ、より具体的な型でメソッドが使用でき、保守性と利便性を両立させることができるようになります。</p>

<h3>
<span id="storedprocedurewithresultsetlistクラス" class="fragment"></span><a href="#storedprocedurewithresultsetlist%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>StoredProcedureWithResultSetListクラス</h3>

<p>このクラスは複数の結果セットを返すストアドプロシージャクラスが継承する基底クラスになります。<br>
MARSに対応したストアドプロシージャの共通処理がこのクラスに定義されることになります。</p>

<h2>
<span id="自動生成されるクラス" class="fragment"></span><a href="#%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>自動生成されるクラス</h2>

<h3>
<span id="multipktableinsertクラス" class="fragment"></span><a href="#multipktableinsert%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>MultiPkTableInsertクラス</h3>

<p>MultiPkTableInsertは実際にDBに存在するストアドプロシージャに1対1対応して自動生成されるクラスになります。ストアドプロシージャの引数がプロパティとして定義され、プロパティに値をセットしてExecuteNonQuery()メソッドを呼び出せばストアドプロシージャが呼び出せます。このクラスにGetStoredProcedureName, CreateCommand, SetOutputParameterValueの具体的な実装が定義されることになります。</p>

<h3>
<span id="multipktableselectbyprimarykeyクラス" class="fragment"></span><a href="#multipktableselectbyprimarykey%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>MultiPkTableSelectByPrimaryKeyクラス</h3>

<p>MultiPkTableSelectByPrimaryKeyクラスは主キーで結果セットを取得するクラスになります。結果セットの1レコードを表すクラスはMultiPkTableSelectByPrimaryKey.ResultSetクラスとして定義されています。</p>

<p>それぞれのクラスが単一責任を持っていて処理は1か所に書かれ保守がしやすくなっており、ほとんどの処理がHigLabo.DbSharp.dll側で定義されることになります。結果として自動生成で考えなければいけないのは<br>
・CreateCommand()<br>
・SetOutputParameterValue()<br>
・SetResultSet()<br>
・CreateResultSet()<br>
の内部実装だけということになります。</p>

<h1>
<span id="スキーマからコードを生成する" class="fragment"></span><a href="#%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%8B%E3%82%89%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>スキーマからコードを生成する</h1>

<p>上記のクラス設計により<br>
・CreateCommand（常に必要）<br>
・SetOutputParameterValue（Output引数があれば）<br>
・SetResultSet（結果セットがある場合）<br>
・CreateResultSet（結果セットがある場合）<br>
を生成すればほぼ自動生成部分が完了することになります。</p>

<p>マイクロソフトのSQLサーバーの一般的な型は以下になります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>bigint
timestamp
bigint
binary
image
varbinary
bit
char
nchar
ntext
nvarchar
text
varchar
xml
datetime
smalldatetime
date
time
datetime2
decimal
money
smallmoney
float
int
real
uniqueidentifier
smallint
tinyint
datetimeoffset
variant
</code></pre></div></div>

<p>さらにSQLサーバーにはユーザー定義型という機能がありこれもサポートすることにしましょう。ユーザー定義型を利用すると複数のレコードを1回のラウンドトリップで一括で更新するなどの処理が実行できるようになります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>ユーザー定義型
udt(SqlGeometry)
udt(SqlGeography)
udt(HierarchyId)
</code></pre></div></div>

<p>さらにC#のEnumにマッピングする機能も提供することにします。</p>

<p>まとめると以下のリストの機能がサポートされます。<br>
・一般的な型<br>
・Udt(SqlGeometry,SqlGeography,HierarchyId)<br>
・Enum</p>

<h2>
<span id="createcommandの実装" class="fragment"></span><a href="#createcommand%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>CreateCommandの実装</h2>

<p>このセクションではUsp_Structureストアドプロシージャを例に解説していきます。CreateCommandメソッドの内部実装は以下のようになるはずです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">override</span> <span class="n">DbCommand</span> <span class="nf">CreateCommand</span><span class="p">(</span><span class="n">Database</span> <span class="n">database</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="n">database</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">cm</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">();</span>
    <span class="n">cm</span><span class="p">.</span><span class="n">CommandType</span> <span class="p">=</span> <span class="n">CommandType</span><span class="p">.</span><span class="n">StoredProcedure</span><span class="p">;</span>
    <span class="n">cm</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetStoredProcedureName</span><span class="p">();</span>

    <span class="n">DbParameter</span> <span class="n">p</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="n">p</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">CreateParameter</span><span class="p">(</span><span class="s">"@BigIntColumn"</span><span class="p">,</span> <span class="n">SqlDbType</span><span class="p">.</span><span class="n">BigInt</span><span class="p">,</span> <span class="m">19</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
    <span class="n">p</span><span class="p">.</span><span class="n">SourceColumn</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">ParameterName</span><span class="p">;</span>
    <span class="n">p</span><span class="p">.</span><span class="n">Direction</span> <span class="p">=</span> <span class="n">ParameterDirection</span><span class="p">.</span><span class="n">InputOutput</span><span class="p">;</span>
    <span class="n">p</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">BigIntColumn</span><span class="p">;</span>
    <span class="n">cm</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

    <span class="n">p</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">CreateParameter</span><span class="p">(</span><span class="s">"@StructuredColumn"</span><span class="p">,</span> <span class="n">SqlDbType</span><span class="p">.</span><span class="n">Structured</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
    <span class="n">p</span><span class="p">.</span><span class="n">SourceColumn</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">ParameterName</span><span class="p">;</span>
    <span class="n">p</span><span class="p">.</span><span class="n">Direction</span> <span class="p">=</span> <span class="n">ParameterDirection</span><span class="p">.</span><span class="n">Input</span><span class="p">;</span>
    <span class="n">p</span><span class="p">.</span><span class="nf">SetTypeName</span><span class="p">(</span><span class="s">"MyTableType"</span><span class="p">);</span>

    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">dt</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">StructuredColumn</span><span class="p">.</span><span class="nf">CreateDataTable</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="n">StructuredColumn</span><span class="p">.</span><span class="n">Records</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">dt</span><span class="p">.</span><span class="n">Rows</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="nf">GetValues</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="n">p</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cm</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">cm</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cm</span><span class="p">.</span><span class="n">Parameters</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Value</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="n">cm</span><span class="p">.</span><span class="n">Parameters</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Value</span> <span class="p">=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">cm</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<h2>
<span id="setoutputparametervalueの実装" class="fragment"></span><a href="#setoutputparametervalue%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>SetOutputParameterValueの実装</h2>

<p>SetOutputParameterValueメソッドの内部実装は以下のようになります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">SetOutputParameterValue</span><span class="p">(</span><span class="n">DbCommand</span> <span class="n">command</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">cm</span> <span class="p">=</span> <span class="n">command</span><span class="p">;</span>
    <span class="n">DbParameter</span> <span class="n">p</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">p</span> <span class="p">=</span> <span class="n">cm</span><span class="p">.</span><span class="n">Parameters</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="k">as</span> <span class="n">DbParameter</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">Value</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">&amp;&amp;</span> <span class="n">p</span><span class="p">.</span><span class="n">Value</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="n">BigIntColumn</span> <span class="p">=</span> <span class="p">(</span><span class="n">Int64</span><span class="p">)</span><span class="n">p</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>結果セット無しのストアドプロシージャの自動生成コードは主にこの2か所と各プロパティで済みます。設計がうまくいったので最小限の自動生成コードで済みました。</p>

<h2>
<span id="createresultsetとsetresultsetの内部実装" class="fragment"></span><a href="#createresultset%E3%81%A8setresultset%E3%81%AE%E5%86%85%E9%83%A8%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>CreateResultSetとSetResultSetの内部実装</h2>

<p>結果セットがある場合はCreateResultSetメソッドとSetResultSetメソッドを生成する必要があります。AllDataTypeTableSelectAllの内部実装を例に解説します。</p>

<p>CreateResultSetメソッドはこのStoredProcedureクラスの結果セットに対応するResultSetクラスを生成するメソッドで以下のようになります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">override</span> <span class="n">AllDataTypeTableSelectAll</span><span class="p">.</span><span class="n">ResultSet</span> <span class="nf">CreateResultSet</span><span class="p">()</span>
<span class="p">{</span>
   <span class="k">return</span> <span class="k">new</span> <span class="nf">ResultSet</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>SetResultSetの内部実装は以下のようになります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">SetResultSet</span><span class="p">(</span><span class="n">AllDataTypeTableSelectAll</span><span class="p">.</span><span class="n">ResultSet</span> <span class="n">resultSet</span><span class="p">,</span> <span class="n">IDataReader</span> <span class="n">reader</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">r</span> <span class="p">=</span> <span class="n">resultSet</span><span class="p">;</span>
    <span class="n">Int32</span> <span class="n">index</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">PrimaryKeyColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetInt64</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">TimestampColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">Byte</span><span class="p">[];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">BigIntColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetInt64</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">BinaryColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">Byte</span><span class="p">[];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">ImageColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">Byte</span><span class="p">[];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">VarBinaryColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">Byte</span><span class="p">[];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">BitColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetBoolean</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">CharColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">NCharColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">NTextColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">NVarCharColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">TextColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">VarCharColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">XmlColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">DateTimeColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDateTime</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">SmallDateTimeColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDateTime</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">DateColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDateTime</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">TimeColumn</span> <span class="p">=</span> <span class="p">(</span><span class="n">TimeSpan</span><span class="p">)</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">DateTime2Column</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDateTime</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">DecimalColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDecimal</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">MoneyColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDecimal</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">SmallMoneyColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDecimal</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">FloatColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDouble</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">IntColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetInt32</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">RealColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetFloat</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">UniqueIdentifierColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetGuid</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">SmallIntColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetInt16</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">TinyIntColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetByte</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">DateTimeOffsetColumn</span> <span class="p">=</span> <span class="p">(</span><span class="n">DateTimeOffset</span><span class="p">)</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">SqlVariantColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">Object</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">GeometryColumn</span> <span class="p">=</span> <span class="p">(</span><span class="k">global</span><span class="p">::</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">SqlServer</span><span class="p">.</span><span class="n">Types</span><span class="p">.</span><span class="n">SqlGeometry</span><span class="p">)</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">GeographyColumn</span> <span class="p">=</span> <span class="p">(</span><span class="k">global</span><span class="p">::</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">SqlServer</span><span class="p">.</span><span class="n">Types</span><span class="p">.</span><span class="n">SqlGeography</span><span class="p">)</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">HierarchyIDColumn</span> <span class="p">=</span> <span class="p">(</span><span class="k">global</span><span class="p">::</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">SqlServer</span><span class="p">.</span><span class="n">Types</span><span class="p">.</span><span class="n">SqlHierarchyId</span><span class="p">)</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">EnumColumn</span> <span class="p">=</span> <span class="n">StoredProcedure</span><span class="p">.</span><span class="n">ToEnum</span><span class="p">&lt;</span><span class="n">MyEnum</span><span class="p">&gt;(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">)</span> <span class="p">??</span> <span class="n">r</span><span class="p">.</span><span class="n">EnumColumn</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullBigIntColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetInt64</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullBinaryColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">Byte</span><span class="p">[];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullImageColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">Byte</span><span class="p">[];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullVarBinaryColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">Byte</span><span class="p">[];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullBitColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetBoolean</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullCharColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullNCharColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullNTextColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullNVarCharColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullTextColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullVarCharColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullXmlColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullDateTimeColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDateTime</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullSmallDateTimeColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDateTime</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullDateColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDateTime</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullTimeColumn</span> <span class="p">=</span> <span class="p">(</span><span class="n">TimeSpan</span><span class="p">)</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullDateTime2Column</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDateTime</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullDecimalColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDecimal</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullMoneyColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDecimal</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullSmallMoneyColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDecimal</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullFloatColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetDouble</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullIntColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetInt32</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullRealColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetFloat</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullUniqueIdentifierColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetGuid</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullSmallIntColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetInt16</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullTinyIntColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">GetByte</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullDateTimeOffsetColumn</span> <span class="p">=</span> <span class="p">(</span><span class="n">DateTimeOffset</span><span class="p">)</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullSqlVariantColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">Object</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullGeometryColumn</span> <span class="p">=</span> <span class="p">(</span><span class="k">global</span><span class="p">::</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">SqlServer</span><span class="p">.</span><span class="n">Types</span><span class="p">.</span><span class="n">SqlGeometry</span><span class="p">)</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullGeographyColumn</span> <span class="p">=</span> <span class="p">(</span><span class="k">global</span><span class="p">::</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">SqlServer</span><span class="p">.</span><span class="n">Types</span><span class="p">.</span><span class="n">SqlGeography</span><span class="p">)</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullHierarchyIDColumn</span> <span class="p">=</span> <span class="p">(</span><span class="k">global</span><span class="p">::</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">SqlServer</span><span class="p">.</span><span class="n">Types</span><span class="p">.</span><span class="n">SqlHierarchyId</span><span class="p">)</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="n">index</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullEnumColumn</span> <span class="p">=</span> <span class="n">StoredProcedure</span><span class="p">.</span><span class="n">ToEnum</span><span class="p">&lt;</span><span class="n">MyEnum</span><span class="p">&gt;(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">)</span> <span class="p">??</span> <span class="n">r</span><span class="p">.</span><span class="n">NotNullEnumColumn</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">InvalidCastException</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">StoredProcedureSchemaMismatchedException</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">ex</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>全ての型を適切に変換するコードを自動生成するだけです。</p>

<h2>
<span id="スキーマ情報の取得" class="fragment"></span><a href="#%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E6%83%85%E5%A0%B1%E3%81%AE%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>スキーマ情報の取得</h2>

<p>このコードを生成するにはデータベースのスキーマ情報が必要です。例えばCreateCommandメソッドを生成するには以下のスキーマ情報を取得する必要があります。<br>
・ColumnName<br>
・Type<br>
・Length<br>
・Precision<br>
・Scale<br>
・IsOutput parameter<br>
・UserTableTypeName<br>
・UdtTypeName</p>

<p>上記の情報を取得するためのスクリプトは以下になります。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre class="with-code"><code><span class="k">Select</span> <span class="n">T01</span><span class="p">.</span><span class="n">name</span> <span class="k">as</span> <span class="n">StoredProcedureName</span> 
<span class="p">,</span><span class="n">T02</span><span class="p">.</span><span class="n">name</span> <span class="k">as</span> <span class="n">ParameterName</span>
<span class="p">,</span><span class="k">CASE</span> <span class="n">T03</span><span class="p">.</span><span class="n">is_table_type</span> 
    <span class="k">When</span> <span class="mi">1</span> <span class="k">Then</span> <span class="s1">'structured'</span> 
    <span class="k">Else</span> 
        <span class="k">Case</span> <span class="n">T03</span><span class="p">.</span><span class="n">is_assembly_type</span>
        <span class="k">When</span> <span class="mi">1</span> <span class="k">Then</span> <span class="s1">'udt'</span> 
        <span class="k">Else</span>
            <span class="k">Case</span> <span class="n">T03</span><span class="p">.</span><span class="n">name</span> 
            <span class="k">When</span> <span class="s1">'sql_variant'</span> <span class="k">Then</span> <span class="s1">'variant'</span>
            <span class="k">Else</span> <span class="n">T03</span><span class="p">.</span><span class="n">name</span> 
            <span class="k">End</span>
    <span class="k">End</span>
<span class="k">End</span> <span class="k">as</span> <span class="n">ParameterType</span>
<span class="p">,</span><span class="k">Case</span> <span class="n">T02</span><span class="p">.</span><span class="n">max_length</span> 
    <span class="k">When</span> <span class="o">-</span><span class="mi">1</span> <span class="k">Then</span> <span class="o">-</span><span class="mi">1</span> 
    <span class="k">Else</span>
    <span class="k">Case</span> <span class="n">T03</span><span class="p">.</span><span class="n">name</span> 
        <span class="k">When</span> <span class="s1">'nvarchar'</span> <span class="k">Then</span> <span class="n">T02</span><span class="p">.</span><span class="n">max_length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">When</span> <span class="s1">'nchar'</span> <span class="k">Then</span> <span class="n">T02</span><span class="p">.</span><span class="n">max_length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">Else</span> <span class="n">T02</span><span class="p">.</span><span class="n">max_length</span> 
    <span class="k">End</span>
<span class="k">End</span> <span class="k">as</span> <span class="n">ParameterLength</span>
<span class="p">,</span><span class="n">T02</span><span class="p">.</span><span class="nb">precision</span> <span class="k">as</span> <span class="n">ParameterPrecision</span>
<span class="p">,</span><span class="n">T02</span><span class="p">.</span><span class="k">scale</span> <span class="k">as</span> <span class="n">ParameterScale</span>
<span class="p">,</span><span class="n">T02</span><span class="p">.</span><span class="n">is_output</span> <span class="k">as</span> <span class="n">IsOutput</span>
<span class="p">,</span><span class="n">T02</span><span class="p">.</span><span class="n">default_value</span> <span class="k">as</span> <span class="n">DefaultValue</span>
<span class="p">,</span><span class="k">CASE</span> <span class="n">T03</span><span class="p">.</span><span class="n">is_table_type</span> 
    <span class="k">When</span> <span class="mi">1</span> <span class="k">Then</span> <span class="n">T03</span><span class="p">.</span><span class="n">name</span> 
    <span class="k">Else</span> <span class="s1">''</span>
<span class="k">End</span> <span class="k">as</span> <span class="n">UserTableTypeName</span>
<span class="p">,</span><span class="k">Case</span> <span class="n">T03</span><span class="p">.</span><span class="n">is_assembly_type</span>
<span class="k">When</span> <span class="mi">1</span> <span class="k">Then</span> <span class="n">T03</span><span class="p">.</span><span class="n">name</span>
<span class="k">Else</span> <span class="s1">''</span> 
<span class="k">End</span> <span class="k">as</span> <span class="n">UdtTypeName</span> 
<span class="k">From</span> <span class="n">sys</span><span class="p">.</span><span class="n">procedures</span> <span class="k">as</span> <span class="n">T01</span> 
<span class="k">Inner</span> <span class="k">Join</span> <span class="n">sys</span><span class="p">.</span><span class="k">parameters</span> <span class="k">as</span> <span class="n">T02</span> 
<span class="k">ON</span> <span class="n">T01</span><span class="p">.</span><span class="n">object_id</span> <span class="o">=</span> <span class="n">T02</span><span class="p">.</span><span class="n">object_id</span> 
<span class="k">Inner</span> <span class="k">Join</span> <span class="n">sys</span><span class="p">.</span><span class="n">types</span> <span class="k">as</span> <span class="n">T03</span> 
<span class="k">ON</span> <span class="n">T02</span><span class="p">.</span><span class="n">user_type_id</span> <span class="o">=</span> <span class="n">T03</span><span class="p">.</span><span class="n">user_type_id</span>
<span class="k">Where</span> <span class="n">T01</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'MyStoredProcedureName'</span>
<span class="k">Order</span> <span class="k">By</span> <span class="n">T02</span><span class="p">.</span><span class="n">parameter_id</span>
</code></pre></div></div>

<p>以下のような情報が取得できます。<br>
<a href="https://camo.qiitausercontent.com/cb583322938cc4a7f1038abf2877456931122c1e/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f47657453746f72656450726f636564757265536368656d615363726970742e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FGetStoredProcedureSchemaScript.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8b2330206c9c1a6d9719af2c33439b30" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/GetStoredProcedureSchemaScript.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FGetStoredProcedureSchemaScript.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=cbb15b088d2f727378785037c61e6415 1x" loading="lazy"></a></p>

<p>SetResultSetメソッドのスキーマ情報は適当なパラメーターを与えてストアドを実行し、DataReaderクラスのGetSchemaTableメソッドから取得します。</p>

<p>これで自動生成のための情報が全て揃い、後はコードを生成するだけとなります。</p>

<h2>
<span id="postgresとoracleへの対応" class="fragment"></span><a href="#postgres%E3%81%A8oracle%E3%81%B8%E3%81%AE%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>PostgresとOracleへの対応</h2>

<p>DbSharpApplicationは現状SQLサーバーとMySQLに対応しています。PostgresとOracleには対応していません。どこかに<br>
・スキーマデータを取得するSQLスクリプト<br>
・全ての型のメソッドの実装コード（CreateCommand,SetResutSet,SetOutputParameter）<br>
を作ってもいいよ、なんて人を探してます。</p>

<p>実装コードは</p>

<h3>
<span id="createcommandメソッド" class="fragment"></span><a href="#createcommand%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>CreateCommandメソッド</h3>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">p</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">CreateParameter</span><span class="p">(</span><span class="s">"@NVarCharColumn"</span><span class="p">,</span> <span class="n">SqlDbType</span><span class="p">.</span><span class="n">NVarChar</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
<span class="n">p</span><span class="p">.</span><span class="n">SourceColumn</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">ParameterName</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">Direction</span> <span class="p">=</span> <span class="n">ParameterDirection</span><span class="p">.</span><span class="n">InputOutput</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">Size</span> <span class="p">=</span> <span class="m">100</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">NVarCharColumn</span><span class="p">;</span>
<span class="n">cm</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

<span class="n">p</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">CreateParameter</span><span class="p">(</span><span class="s">"@GeometryColumn"</span><span class="p">,</span> <span class="n">SqlDbType</span><span class="p">.</span><span class="n">Udt</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span><span class="c1">//SqlDbType is Udt</span>
<span class="n">p</span><span class="p">.</span><span class="n">SourceColumn</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">ParameterName</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">Direction</span> <span class="p">=</span> <span class="n">ParameterDirection</span><span class="p">.</span><span class="n">InputOutput</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">Size</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="nf">SetUdtTypeName</span><span class="p">(</span><span class="s">"geometry"</span><span class="p">);</span><span class="c1">//Set UdtTypeName property.</span>
<span class="n">p</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">GeometryColumn</span><span class="p">;</span>
<span class="n">cm</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</code></pre></div></div>

<h3>
<span id="setresultset" class="fragment"></span><a href="#setresultset"><i class="fa fa-link"></i></a>SetResultSet</h3>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">r</span><span class="p">.</span><span class="n">NVarCharColumn</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">;</span>
</code></pre></div></div>

<h3>
<span id="setoutputparametervalue" class="fragment"></span><a href="#setoutputparametervalue"><i class="fa fa-link"></i></a>SetOutputParameterValue</h3>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">this</span><span class="p">.</span><span class="n">NVarCharColumn</span> <span class="p">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="n">p</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</code></pre></div></div>

<p>を作っていただけるとPostgresとOracle対応ができそうです。PostgresとOracleのプロフェッショナルな方、お待ちしております。</p>

<h1>
<span id="enumのサポート" class="fragment"></span><a href="#enum%E3%81%AE%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>Enumのサポート</h1>

<p>特定の値のみ許可する場合、Enumのサポートがあると便利です。Enumサポートの仕様は以下のようにデザインします。<br>
・C#上でプロパティがEnumになり、強く型付けされた形で扱える<br>
・Enumの値は文字列になってデータベースへ保存される。<br>
・データベースの列の型はテキストを格納できる型のみ</p>

<p>Enum機能によりデータベースに間違った値が挿入されることを防ぐことが可能です。データベースへ値を送るときはCreateCommandメソッドの中で以下のように変換されます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">p</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">CreateParameter</span><span class="p">(</span><span class="s">"@EnumColumn"</span><span class="p">,</span> <span class="n">SqlDbType</span><span class="p">.</span><span class="n">NVarChar</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
<span class="n">p</span><span class="p">.</span><span class="n">SourceColumn</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">ParameterName</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">Direction</span> <span class="p">=</span> <span class="n">ParameterDirection</span><span class="p">.</span><span class="n">Input</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">Size</span> <span class="p">=</span> <span class="m">20</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">EnumColumn</span><span class="p">.</span><span class="nf">ToStringOrNullFromEnum</span><span class="p">();</span>
<span class="n">cm</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

</code></pre></div></div>

<p>データベースから取得された文字列はEnumに変換されます。変換には以下のメソッドが使用されます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">static</span> <span class="n">T</span><span class="p">?</span> <span class="n">ToEnum</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">Object</span> <span class="k">value</span><span class="p">)</span>
    <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="k">struct</span>
<span class="err">{</span>
    <span class="nc">if</span> <span class="p">(</span><span class="k">value</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">).</span><span class="n">IsEnum</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"T must be Enum type"</span><span class="p">);</span>
    <span class="n">T</span> <span class="n">result</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">tp</span> <span class="p">=</span> <span class="k">value</span><span class="p">.</span><span class="nf">GetType</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tp</span> <span class="p">==</span> <span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">))</span> <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="k">value</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tp</span> <span class="p">==</span> <span class="k">typeof</span><span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">Enum</span><span class="p">.</span><span class="nf">TryParse</span><span class="p">((</span><span class="n">String</span><span class="p">)</span><span class="k">value</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="k">out</span> <span class="n">result</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidEnumDataException</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="k">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>このメソッドを使用してSetResutSetメソッドで以下のようにテキストからEnumへ変換されます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">r</span><span class="p">.</span><span class="n">EnumColumn</span> <span class="p">=</span> <span class="n">StoredProcedure</span><span class="p">.</span><span class="n">ToEnum</span><span class="p">&lt;</span><span class="n">MyEnum</span><span class="p">&gt;(</span><span class="n">reader</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">String</span><span class="p">)</span> <span class="p">??</span> <span class="n">r</span><span class="p">.</span><span class="n">EnumColumn</span><span class="p">;</span>
</code></pre></div></div>

<p>データベースにEnumへ変換ができない不正な値が含まれている場合、InvalidEnumDataExceptionがスローされます。</p>

<h1>
<span id="ユーザー定義型" class="fragment"></span><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E5%AE%9A%E7%BE%A9%E5%9E%8B"><i class="fa fa-link"></i></a>ユーザー定義型</h1>

<p>このセクションではユーザー定義型について解説します。サンプルプロジェクトの中にMyTableTypeというユーザー定義型を作成するコードがあります。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre class="with-code"><code><span class="k">Create</span> <span class="k">Type</span> <span class="n">MyTableType</span> <span class="k">As</span> <span class="k">Table</span>
<span class="p">(</span><span class="n">BigIntColumn</span> <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">,</span><span class="n">BinaryColumn</span> <span class="nb">binary</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">,</span><span class="n">ImageColumn</span> <span class="n">image</span>
<span class="p">,</span><span class="n">VarBinaryColumn</span> <span class="nb">varbinary</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">,</span><span class="n">BitColumn</span> <span class="nb">bit</span>
<span class="p">,</span><span class="n">CharColumn</span> <span class="nb">char</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">,</span><span class="n">NCharColumn</span> <span class="nb">nchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">,</span><span class="n">NTextColumn</span> <span class="n">ntext</span>
<span class="p">,</span><span class="n">NVarCharColumn</span> <span class="n">nvarchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">,</span><span class="n">TextColumn</span> <span class="nb">text</span>
<span class="p">,</span><span class="n">VarCharColumn</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">,</span><span class="n">XmlColumn</span> <span class="n">xml</span>
<span class="p">,</span><span class="n">DateTimeColumn</span> <span class="nb">datetime</span>
<span class="p">,</span><span class="n">SmallDateTimeColumn</span> <span class="n">smalldatetime</span>
<span class="p">,</span><span class="n">DateColumn</span> <span class="nb">date</span>
<span class="p">,</span><span class="n">TimeColumn</span> <span class="nb">time</span>
<span class="p">,</span><span class="n">DateTime2Column</span> <span class="n">datetime2</span>
<span class="p">,</span><span class="n">DecimalColumn</span> <span class="nb">decimal</span>
<span class="p">,</span><span class="n">MoneyColumn</span> <span class="n">money</span>
<span class="p">,</span><span class="n">SmallMoneyColumn</span> <span class="n">smallmoney</span>
<span class="p">,</span><span class="n">FloatColumn</span> <span class="nb">float</span>
<span class="p">,</span><span class="n">IntColumn</span> <span class="nb">int</span>
<span class="p">,</span><span class="n">RealColumn</span> <span class="nb">real</span>
<span class="p">,</span><span class="n">UniqueIdentifierColumn</span> <span class="n">uniqueidentifier</span>
<span class="p">,</span><span class="n">SmallIntColumn</span> <span class="nb">smallint</span>
<span class="p">,</span><span class="n">TinyIntColumn</span> <span class="nb">tinyint</span>
<span class="p">,</span><span class="n">DateTimeOffsetColumn</span> <span class="n">datetimeoffset</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="p">,</span><span class="n">EnumColumn</span> <span class="n">nvarchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>TimeStamp,Geometry,Geography,HierarchyIdとSqlVariantは対応しません。</p>

<p>作成したユーザー定義型をストアドプロシージャの引数で使用できます。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre class="with-code"><code><span class="k">Create</span> <span class="k">Procedure</span> <span class="n">Usp_Structure</span>
<span class="p">(</span><span class="o">@</span><span class="n">BigIntColumn</span> <span class="nb">bigint</span> <span class="k">out</span>
<span class="p">,</span><span class="o">@</span><span class="n">StructuredColumn</span> <span class="k">as</span> <span class="n">MyTableType</span> <span class="n">readonly</span>
<span class="p">)</span> <span class="k">As</span>
<span class="p">...</span><span class="err">省略</span>
</code></pre></div></div>

<p>引数で使用する際にはreadonlyキーワードをつける必要があります。</p>

<h2>
<span id="ユーザー定義型とは" class="fragment"></span><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E5%AE%9A%E7%BE%A9%E5%9E%8B%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>ユーザー定義型とは？</h2>

<p>引数でユーザー定義型を使用することでレコードのリストをデータベースに送ることができます。例えば100件のUPDATEする処理を1回のラウンドトリップでデータベースに送れるのでラウンドトリップを100回繰り返す場合に比べパフォーマンスが大幅に向上します。</p>

<h2>
<span id="ユーザー定義型の使い方" class="fragment"></span><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E5%AE%9A%E7%BE%A9%E5%9E%8B%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>ユーザー定義型の使い方</h2>

<p>DbSharpApplicationでユーザー定義型を使用する場合は以下のように書けます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">udt</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyTableType</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">record</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyTableType</span><span class="p">.</span><span class="nf">Record</span><span class="p">();</span>
<span class="n">record</span><span class="p">.</span><span class="n">BigIntColumn</span> <span class="p">=</span> <span class="m">100</span><span class="p">;</span>
<span class="c1">//Set other property...</span>
<span class="n">udt</span><span class="p">.</span><span class="n">Records</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">record</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">sp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Usp_Structure</span><span class="p">();</span>
<span class="n">sp</span><span class="p">.</span><span class="n">StructuredColumn</span> <span class="p">=</span> <span class="n">udt</span><span class="p">;</span>
<span class="c1">//Set other property...</span>
<span class="n">sp</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span>
</code></pre></div></div>

<h2>
<span id="ユーザー定義型の実装の設計" class="fragment"></span><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E5%AE%9A%E7%BE%A9%E5%9E%8B%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%AE%E8%A8%AD%E8%A8%88"><i class="fa fa-link"></i></a>ユーザー定義型の実装の設計</h2>

<p>ユーザー定義型に関係するクラスを以下のように設計しました。<br>
・UserDefinedTableType<br>
・UserDefinedTableType<br>
・MyTableType<br>
・MyTableType.Record<br>
ストアドの時と同様に単一責任、共通処理をまとめるなどを設計で行い、自動生成部分のコードを最小限に抑えます。クラスダイアグラムは以下のようになります。<br>
<a href="https://camo.qiitausercontent.com/446a7388d54c639c428d6dd20f12bf0549046491/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f55736572446566696e656454797065436c6173734469616772616d2e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FUserDefinedTypeClassDiagram.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f2aa80ce901b67c63d951a47c5877290" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/UserDefinedTypeClassDiagram.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FUserDefinedTypeClassDiagram.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=48d2b5e3267601c9287b6ece7c9c7783 1x" loading="lazy"></a></p>

<p>ほぼ全ての共通処理はUserDefinedTableType,UserDefinedTableTypeに定義されています。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">UserDefinedTableType</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> 
    <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="n">UserDefinedTableTypeRecord</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">_Records</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;();</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">Records</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_Records</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">abstract</span> <span class="n">DataTable</span> <span class="nf">CreateDataTable</span><span class="p">();</span>
    <span class="k">public</span> <span class="n">DataTable</span> <span class="nf">CreateDataTable</span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">records</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">dt</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">CreateDataTable</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">records</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">dt</span><span class="p">.</span><span class="n">Rows</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="nf">GetValues</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">dt</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">UserDefinedTableTypeRecord</span> <span class="p">:</span> <span class="n">DatabaseRecord</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="n">Object</span><span class="p">[]</span> <span class="nf">GetValues</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>自動生成されたクラスは以下のようになります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MyTableType</span> <span class="p">:</span> <span class="n">UserDefinedTableType</span><span class="p">&lt;</span><span class="n">MyTableType</span><span class="p">.</span><span class="n">Record</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">DataTable</span> <span class="nf">CreateDataTable</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">dt</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DataTable</span><span class="p">();</span>
        <span class="n">dt</span><span class="p">.</span><span class="n">Columns</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"BigIntColumn"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Int64</span><span class="p">));</span>
        <span class="c1">//abbreviated other code...</span>
        <span class="k">return</span> <span class="n">dt</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Record</span> <span class="p">:</span> <span class="n">UserDefinedTableTypeRecord</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">Int64</span> <span class="n">_BigIntColumn</span><span class="p">;</span>
        <span class="c1">//abbreviated other field...</span>

        <span class="k">public</span> <span class="n">Int64</span> <span class="n">BigIntColumn</span>
        <span class="p">{</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_BigIntColumn</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">SetPropertyValue</span><span class="p">(</span><span class="k">ref</span> <span class="n">_BigIntColumn</span><span class="p">,</span> <span class="k">value</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetPropertyChangedEventHandler</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">//abbreviated other properties...</span>

        <span class="k">public</span> <span class="nf">Record</span><span class="p">()</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="n">Object</span><span class="p">[]</span> <span class="nf">GetValues</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Object</span><span class="p">[]</span> <span class="n">oo</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Object</span><span class="p">[</span><span class="m">28</span><span class="p">];</span>
            <span class="n">oo</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">BigIntColumn</span><span class="p">;</span>
            <span class="c1">//abbreviated other...</span>
            <span class="k">return</span> <span class="n">oo</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ユーザー定義型はDbSharpApplicationにおいてはストアドプロシージャの引数のみで使用されます。使用できるようにするためにCreateCommandメソッドを生成する必要があります。内部実装は以下のようになります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">p</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">CreateParameter</span><span class="p">(</span><span class="s">"@StructuredColumn"</span><span class="p">,</span> <span class="n">SqlDbType</span><span class="p">.</span><span class="n">Structured</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
<span class="n">p</span><span class="p">.</span><span class="n">SourceColumn</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">ParameterName</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">Direction</span> <span class="p">=</span> <span class="n">ParameterDirection</span><span class="p">.</span><span class="n">Input</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">Size</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="nf">SetTypeName</span><span class="p">(</span><span class="s">"MyTableType"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">dt</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">StructuredColumn</span><span class="p">.</span><span class="nf">CreateDataTable</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="n">StructuredColumn</span><span class="p">.</span><span class="n">Records</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">dt</span><span class="p">.</span><span class="n">Rows</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="nf">GetValues</span><span class="p">());</span>
<span class="p">}</span>
<span class="n">p</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="n">dt</span><span class="p">;</span>
<span class="n">cm</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</code></pre></div></div>

<p>ユーザー定義型をOUTPUT引数に定義することはできないのでSetOutputParameterValueメソッドを生成する必要はありません。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre class="with-code"><code><span class="k">Create</span> <span class="k">Procedure</span> <span class="n">Usp_Structure</span>
<span class="p">(</span><span class="o">@</span><span class="n">BigIntColumn</span> <span class="nb">bigint</span> <span class="k">out</span>
<span class="p">,</span><span class="o">@</span><span class="n">StructuredColumn</span> <span class="k">as</span> <span class="n">MyTableType</span> <span class="k">out</span> <span class="c1">--エラー!!!</span>
<span class="p">)</span> <span class="k">As</span>
</code></pre></div></div>

<p>また結果セットでユーザー定義型を使用することはできないのでGetResultSetsメソッドも生成の必要はありません。</p>

<h1>
<span id="複数の結果セットを返すストアドプロシージャ-1" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E3%81%AE%E7%B5%90%E6%9E%9C%E3%82%BB%E3%83%83%E3%83%88%E3%82%92%E8%BF%94%E3%81%99%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3-1"><i class="fa fa-link"></i></a>複数の結果セットを返すストアドプロシージャ</h1>

<p>SQLサーバーにはMARSという機能があり、一度の呼び出しで複数の結果セットを取得することが可能です。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre class="with-code"><code><span class="k">Create</span> <span class="k">Procedure</span> <span class="n">MultipleResultSets_Procedure</span>
<span class="k">As</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">Table1</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">Table2</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">Table3</span>
</code></pre></div></div>

<p>DbSharpApplicationは複数の結果セットも対応しており以下のように書いて利用できます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">sp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MultipleResultSets_Procedure</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">rsl</span> <span class="p">=</span> <span class="n">sp</span><span class="p">.</span><span class="nf">GetResultSetsList</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">rsl</span><span class="p">.</span><span class="n">ResultSet1List</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">rsl</span><span class="p">.</span><span class="n">ResultSet2List</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">rsl</span><span class="p">.</span><span class="n">ResultSet3List</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ResultSet1,ResultSet2,ResultSet3という名前は自由に変更可能です。<br>
<a href="https://camo.qiitausercontent.com/29d002451d93d1d23fe0ac392b2d1c0bc7342008/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e5573705f53656c6563744d756c74695461626c652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationUsp_SelectMultiTable.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=18c664aa0b7a20f8966482fd42f0f909" alt="alt" data-canonical-src="https://www.codeproject.com/KB/cs/776811/DbSharpApplicationUsp_SelectMultiTable.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationUsp_SelectMultiTable.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a2d9ba2792721f5a74bd6ff2363a956e 1x" loading="lazy"></a></p>

<h1>
<span id="indentityrowguidtimestamp列の対応" class="fragment"></span><a href="#indentityrowguidtimestamp%E5%88%97%E3%81%AE%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>Indentity,RowGuid,Timestamp列の対応</h1>

<p>このセクションではIndentity,RowGuid,Timestampについて解説します。これらの列の特徴として2つの特徴があります。<br>
・実行時にデータベースで値が生成される<br>
・実行後に生成された値を取得したい</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">sp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">IdentityTableInsertc</span><span class="p">();</span>
<span class="c1">//sp.IntColumn = 1;//値のセットの必要無し</span>
<span class="n">sp</span><span class="p">.</span><span class="n">NVarCharColumn</span> <span class="p">=</span> <span class="s">"MyValue1"</span><span class="p">;</span>
<span class="n">sp</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span>
<span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">IntColumn</span><span class="p">);</span><span class="c1">//データベースで生成された値がセット済み。</span>
</code></pre></div></div>

<p>RowGuid,Timestampについても同様にExecuteNonQueryの実行後にプロパティにアクセスすると値を取得できます。</p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>DbSharpApplicationはデータベースアクセス回りのツールです。データベース回りのツールは他にもたくさんのライブラリがあります。<br>
・NHibernate<br>
・Entity Framework<br>
・Dapper<br>
・Repository pattern</p>

<p>DbSharpが良い点は以下になります。メインの機能は<br>
・直感的なAPI<br>
・SqlServer,MySqlのサポート(Oracle,PostgreSqlはそのうち...)<br>
・トランザクションのサポート<br>
・Timestamp,Identityのサポート<br>
・ユーザー定義型,RowGuid,Geometry,Geography,HierarchyIdの対応(SqlServer)<br>
・Table機能でのBulkInsertのサポート(SqlServer)<br>
・Enumのサポート<br>
・Setのサポート(MySql)<br>
・パフォーマンスペナルティが無い<br>
・No LINQ</p>

<p>何か足りない機能があれば気軽にTwitterまでDMください。<br>
<a href="https://twitter.com/higlabo" rel="nofollow noopener" target="_blank">HigLabo on Twitter</a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fhigty%2Fitems%2F3c7000c06c83321e2319&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fhigty%2Fitems%2F3c7000c06c83321e2319&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/higty/items/3c7000c06c83321e2319/likers" class="css-1iupg5d">3</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">2</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3c7000c06c83321e2319/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/higty/items/3c7000c06c83321e2319/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/higty/items/3c7000c06c83321e2319/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/higty/items/3c7000c06c83321e2319/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/higty/items/3c7000c06c83321e2319.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-2a42cf4c-098e-412f-90ac-4ffb65eda1af">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-477bf53d-0b1e-4fe5-96bb-68b40c015f01"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-477bf53d-0b1e-4fe5-96bb-68b40c015f01">{}</script>
      
<div id="LoginModal-react-component-0e26287a-09bd-4997-855f-be159c061a0d"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-0e26287a-09bd-4997-855f-be159c061a0d">{}</script>
      
<div id="StockModal-react-component-be9c7bc7-9f97-4454-b9e6-76e6058fe836"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-be9c7bc7-9f97-4454-b9e6-76e6058fe836">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;eO8i1slQG85a/xhWkCKwVHNbsqm3SWBsE49llLuL/IILNznueNio/wvW/ZWjUz0GZetkb3ZdDl6wQLTp/IX5CQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h1\u003e\n\n\u003cp\u003eこの記事ではOOP、TestFirst、SRP(Single Responsibility Principle)について実際にDAL Generatorを作りながら解説していきます。\u003cbr\u003e\n※OOP→オブジェクト指向、SRP→単一責任の原則、DAL→データアクセスレイヤー\u003c/p\u003e\n\n\u003cp\u003eDbSharpというツールは実は5年くらい前に作って海外サイトで記事にして非常に高い評価を貰いました。（4.97/5.0が満点)\u003cbr\u003e\n\u003ca href=\"https://www.codeproject.com/Articles/776811/DbSharp-DAL-generator-tool-on-NET-Core\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCodeProjectのDbSharpの記事\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eNugetでのダウンロードは7600ダウンロードくらいいきました。私の各アカウントは以下になります。\u003cbr\u003e\n\u003ca href=\"https://github.com/higty\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGitHub account\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/higty/higlabo\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHigLabo.NetStandard on GitHub\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://www.nuget.org/profiles/higty\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHigty on Nuget (15万ダウンロード！)\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://twitter.com/higlabo\" rel=\"nofollow noopener\" target=\"_blank\"\u003eTwitter\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eCodeProjectの記事は今のバージョンと若干違いがあります。あまり日本ではSNSとかで活動してなかったのですが、日本語でも記事を書いた方がいいよと言われたので最新版について日本語記事を書きます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"dbsharpとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dbsharp%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDbSharpとは？\u003c/h2\u003e\n\n\u003cp\u003eDbSharpはDALのC#コードを自動で生成するツールです。\u003c/p\u003e\n\n\u003cp\u003eDbSharpApplicationを使用してDBに接続し、ストアドプロシージャのスキーマからストアドプロシージャを呼び出すC#のソースコードを自動で生成します。5年前くらいに海外サイトで紹介記事を書いて今はNugetで7600ダウンロードくらいです。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/higty/higlabo/tree/master/NetStandard/Tools/DbSharp\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGitHubのリンク\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/higty/higlabo/tree/master/NetStandard/Tools/DbSharp/Compiled\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDownload\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e以下のように直感的にDBのストアドを実行できるコードが生成されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHigLabo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSqlServerDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"connection string to DB1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHigLabo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSqlServerDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"connection string to DB2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//Execute stored procedure\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyTaskTableInsert\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNewGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTitle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Post article to CodeProject\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePriority\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Executing\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreateTime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNow\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eScheduleDate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2014\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e25\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDetail\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"...Draft...\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb1Result1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edb1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb2Result1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQueryAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edb2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\n\u003cspan class=\"c1\"\u003e//With transaction\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHigLabo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSqlServerDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"connection string\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTransactionContext\u003c/span\u003e \u003cspan class=\"n\"\u003etx\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTransactionContext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBeginTransaction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIsolationLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReadCommitted\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyTaskTableInsert\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//...Set property of MyTaskTableInsert object\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQueryAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etx\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCommitTransaction\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまたテーブルのCRUD用のストアドを自動で生成する機能（アルファ版）もあります。\u003c/p\u003e\n\n\u003cp\u003e基本的にはストアドプロシージャの実行を簡単に出来るようにするためのツールです。業務アプリケーションでストアドプロシージャを使用する場合、C#でストアドプロシージャを呼び出すコードを書かないといけません。それをボタン一つで簡単に生成できるのが一番のメリットになります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"この記事の目次\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E7%9B%AE%E6%AC%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこの記事の目次\u003c/h2\u003e\n\n\u003cp\u003e・DbSharpApplicationの使い方\u003cbr\u003e\n・テストファーストでの開発\u003cbr\u003e\n・単一責任の原則を適用する\u003cbr\u003e\n・StringBuilder vs TextWriter\u003cbr\u003e\n・StoredProcedureクラスの設計\u003cbr\u003e\n・データベースからスキーマデータを取得する(SqlGeometry,SqlGeography,HierarchyIdなども含む)\u003cbr\u003e\n・Enumのサポート\u003cbr\u003e\n・UserDefinedTypeについて\u003cbr\u003e\n・複数の結果セットを返すストアドプロシージャ\u003cbr\u003e\n・Asyncについて\u003cbr\u003e\n・Indentity列、RowGuid、Timestamp列について\u003cbr\u003e\n・高度な使い方\u003cbr\u003e\n・その他のORM、DALレイヤーのライブラリの紹介\u003cbr\u003e\n・まとめ\u003c/p\u003e\n\n\u003cp\u003eDbSharpはORMのようなマッピングの機能はなく、単純にストアドプロシージャの呼び出しのためのC#コードを自動生成します。ORMを使用している人でマッピングが辛くなった人は是非検討してみてください。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"dbsharpapplicationの使い方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dbsharpapplication%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDbSharpApplicationの使い方\u003c/h1\u003e\n\n\u003cp\u003eDbSharpApplicationをお試しで使うための目次です。\u003cbr\u003e\n・Sample Databaseのセットアップ\u003cbr\u003e\n・DbSharpApplicationの起動\u003cbr\u003e\n・DatabaseTypeの選択（SQLサーバー、MySQL）と接続文字列の設定\u003cbr\u003e\n・ストアドプロシージャとユーザー定義型のインポート。メニューバー→編集→インポート\u003cbr\u003e\n・C#コードの生成。メニューバー→編集→C#ファイルの生成\u003cbr\u003e\n・VisualStudioでのクラスライブラリプロジェクトの作成とDLLへコンパイル\u003cbr\u003e\n・DLLを自分のアプリケーションで使用する\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/higty/higlabo.netstandard/tree/master/Tools/DbSharp/HigLabo.DbSharp.Sample\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDbSharpSample on GitHub\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eGitHubにサンプルプロジェクトがあります。サンプルプロジェクトの構成は以下になります。\u003cbr\u003e\n・DbSharpSample.MySql.CSharp\u003cbr\u003e\n・DbSharpSample.SqlServer.CSharp\u003cbr\u003e\n・DbSharpSampleApp.MultiDatabase\u003cbr\u003e\n現状、作成済みなのはSqlServerとMySqlのみです。DbSharpSample.MySql.CSharpとDbSharpSample.SqlServer.CSharpのプロジェクトは全て自動生成されたC#のクラスで構成されています。Extensionsフォルダだけ自分で定義したEnumクラスがあります。Generatedフォルダ以下は自動生成です。\u003c/p\u003e\n\n\u003cp\u003e以下、これらのプロジェクトと同じプロジェクトを自分で作るためのチュートリアルです。SQLサーバーを例に解説していきます。\u003cbr\u003e\n※MySQLもほぼ同じ手順でできます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"dbsharpapplicationのチュートリアル\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dbsharpapplication%E3%81%AE%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDbSharpApplicationのチュートリアル\u003c/h2\u003e\n\n\u003cp\u003eSQLサーバーにデータベースを作成しManagementStudioでDbSharp_SqlServer.sqlを実行します。Azureの場合はDbSharp_SqlServer_Azure.sqlを実行してください。\u003cbr\u003e\n※DbSharp_SqlServer.sqlは\u003ca href=\"https://github.com/higty/higlabo.netstandard/tree/master/Tools/DbSharp/HigLabo.DbSharp.Sample/DbSharpSample.SqlServer.CSharp\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/higty/higlabo.netstandard/tree/master/Tools/DbSharp/HigLabo.DbSharp.Sample/DbSharpSample.SqlServer.CSharp\u003c/a\u003e\u003cbr\u003e\nにあります。\u003c/p\u003e\n\n\u003cp\u003eDbSharpApplicationを起動しSqlServerを選択します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/1d5b0386cf8474b5356fb2d822d8e6be8234ccad/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e4c61756e63682e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationLaunch.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6492aa9857beb5b7a2955342c2e0398d\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationLaunch.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationLaunch.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e545d97064974951fb6292c1be06d3f5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eメニューバー→ツール→オプションからテーブル機能を使用にチェックをします。\u003c/p\u003e\n\n\u003cp\u003eメニューバー→編集→接続先の管理から接続文字列を追加します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/112d283384461d9da8021053375f877adb43c747/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e416464436f6e6e656374696f6e537472696e672e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAddConnectionString.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a0eb79620b7dc12b17b56e6f77508b62\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationAddConnectionString.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAddConnectionString.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=93750edd0af9b089a302f9f26e5f2d1a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eメニューバー→編集→インポートからDBに作成済みのストアドプロシージャをインポートします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/0413a2843a9fe2a14a21681fd62bda0156c7b656/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e456469744d656e752e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationEditMenu.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f4ff50c9fe04a3c1c636c4a4fd7e5a84\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationEditMenu.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationEditMenu.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=de50360cacfb93c04ef48782b1b13a2b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e接続ボタンをクリックしてDBのオブジェクトを読み込みます。読み込んだオブジェクトのチェックして実行ボタンを押します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/dc38c799e8e5b385237295c2184c775d718daaf3/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e496d706f72744f626a6563742e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationImportObject.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=327659b275a24d5923f20976ba68023e\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationImportObject.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationImportObject.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d38d6db8a0497d758520a3b802387644 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eテーブル、ストアドプロシージャ、ユーザー定義型がインポートされます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/88c5001ee2c4face6eeffdcb5f9cd4dd378974ba/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e416c6c44617461547970655461626c652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTable.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a55fd37685a644970b68dfb43ea75367\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationAllDataTypeTable.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTable.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b24b5f5d50ee9b31b89a9001d5998728 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eインポートしたオブジェクトのデータはファイル→保存でXML形式で保存できます。保存したXMLファイルはファイル→開くで開くことが可能です。\u003c/p\u003e\n\n\u003cp\u003eインポートしたストアドプロシージャはタブを切り替えることで確認できます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/04e84657d81a1c0f2c15600a40412dae48e77262/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e5573705f4f7574707574506172616d657465722e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationUsp_OutputParameter.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a9599a05dae861004a54c90bfe824219\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationUsp_OutputParameter.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationUsp_OutputParameter.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=835ef8b3c8223c4eb70b1fe39696f468 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eインポートしたユーザー定義型はタブを切り替えることで確認できます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/2925b9a3c0fb91264ec35762c9478eec73b805e2/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e4d795461626c65547970652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationMyTableType.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c3424924f95da5ca814a50b38d8bbc88\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationMyTableType.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationMyTableType.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fe7d1c0889b7692de0fc471808021ea9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"テーブル機能で生成されるcrud用のストアドプロシージャ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E6%A9%9F%E8%83%BD%E3%81%A7%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%82%8Bcrud%E7%94%A8%E3%81%AE%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eテーブル機能で生成されるCRUD用のストアドプロシージャ\u003c/h3\u003e\n\n\u003cp\u003eテーブル機能を有効にしてテーブルをインポートした場合、以下の5つのストアドプロシージャがインポートされているのが確認できます。\u003cbr\u003e\n・SelectAll\u003cbr\u003e\n・SelectByPrimaryKey\u003cbr\u003e\n・Insert\u003cbr\u003e\n・Update\u003cbr\u003e\n・Delete\u003c/p\u003e\n\n\u003cp\u003eこれらのストアドプロシージャが作成されているのもタブを切り替えることで確認できます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/fc5fcae275fdcf1b1dfb2bc6fcc63168157e846c/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e416c6c44617461547970655461626c6553656c656374416c6c2e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTableSelectAll.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b7edcfc8f06a8b758f21896a6d693313\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationAllDataTypeTableSelectAll.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTableSelectAll.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9fee0ba8ba4c9196046577be2faba08d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eストアドプロシージャに渡す引数や結果セットの列の値をEnumにしたい場合、EnumNameにEnumの名前を入力することでEnumで値をやり取りできるようになります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/fd8bb5062fda2ce69d2a8088f470f41f2d002adf/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e416c6c44617461547970655461626c65456e756d4e616d652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTableEnumName.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5d9cd599480ed8c1b06ee81dce66ec3f\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationAllDataTypeTableEnumName.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTableEnumName.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7d2f232fcf98fbe55c46206d76a4c8b1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eテーブルのEnumを変更すると対応するストアドプロシージャの引数のEnumNameも自動的に同期されているのが確認できます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6f7e3ac5aabbf55a215335c50ff7d4449d9bc9d2/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e416c6c44617461547970655461626c65496e73657274456e756d4e616d652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTableInsertEnumName.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7dc85e758206617eebcc08bb5462a608\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationAllDataTypeTableInsertEnumName.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAllDataTypeTableInsertEnumName.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e360af4ce42b08a730bc245a140aa38e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"複数の結果セットを返すストアドプロシージャ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AE%E7%B5%90%E6%9E%9C%E3%82%BB%E3%83%83%E3%83%88%E3%82%92%E8%BF%94%E3%81%99%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e複数の結果セットを返すストアドプロシージャ\u003c/h3\u003e\n\n\u003cp\u003eUsp_SelectMultiTableを見ると複数の結果セットを返しているのが確認できます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/29d002451d93d1d23fe0ac392b2d1c0bc7342008/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e5573705f53656c6563744d756c74695461626c652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationUsp_SelectMultiTable.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=18c664aa0b7a20f8966482fd42f0f909\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationUsp_SelectMultiTable.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationUsp_SelectMultiTable.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a2d9ba2792721f5a74bd6ff2363a956e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e結果セットの名前は自由に変更できます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ef103208284777bc8ad1b7dd49ca813cd7300b2d/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e4368616e6765526573756c745365744e616d652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationChangeResultSetName.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0d7752d62571b1225252dc1028837eb7\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationChangeResultSetName.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationChangeResultSetName.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=814ff7906249081c25ad4fd06b5ae6b3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"cファイルの自動生成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC#ファイルの自動生成\u003c/h3\u003e\n\n\u003cp\u003eここまで必要な設定（Enum,ResutSetの名前など）をしたらC#コードの生成をしてみましょう。\u003cbr\u003e\n・OutputDirectoryPath = フォルダパスを設定します。\u003cbr\u003e\n・RootNamespaceName = 生成されるファイルの名前空間を指定します。\u003cbr\u003e\n・DatabaseKey = 後で解説します。\u003c/p\u003e\n\n\u003cp\u003e実行ボタンを押して指定したフォルダにファイルを生成します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/e2ad0a0a00b0b06766c371ab56081b33436ef728/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e47656e6572617465435368617270436f64652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationGenerateCSharpCode.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4bb5dbf2899d35e21f30ed5d8a953fee\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationGenerateCSharpCode.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationGenerateCSharpCode.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=749ac29006fa29b691959ca843278c22 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eクラスライブラリプロジェクト以下のGeneratedFilesフォルダの下にファイルが生成されます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/074e71b8fdfce62195c9539c52519c3be5a11436/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e47656e657261746564436f6465312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationGeneratedCode1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=96bfc4a46776b44ae4b076fe62be4930\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationGeneratedCode1.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationGeneratedCode1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ad6fa7def9e39f7e16a23ef75a33539d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eMyEnumを定義します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eMyEnum\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eValue1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eValue2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eクラスライブラリにMyEnumを追加します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/0c4ecaefe0193f87b196ae99b0c387b1a1c0b1e9/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e4164644d79456e756d2e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAddMyEnum.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ae59e8dc7b00969c7b486b3e01480bf5\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationAddMyEnum.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationAddMyEnum.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6d7f69d4d6d9d47114ba5b781a643c94 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e必要なDLLを追加します。\u003cbr\u003e\n・HigLabo.Core\u003cbr\u003e\n・HigLabo.Data\u003cbr\u003e\n・HigLabo.DbSharp\u003cbr\u003e\nSqlGeometry, SqlGeography, HierarchyIdを使用するならMicrosoft.SqlServer.Typesも必要です。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ab2fd75e1152536acb3cd7bf9ff886c24fb523b6/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e47656e657261746564436f64655265666572656e63652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationGeneratedCodeReference.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=767168f648e4aaa3b836d028a81932ac\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationGeneratedCodeReference.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationGeneratedCodeReference.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cf28e9f4360b8495b61323bd3be349e3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eコンパイルしてこのプロジェクトをコンソールアプリケーションから参照します。これで以下のようなコードで簡単にDBへアクセスできます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ess\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCommandLineArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003econnectionString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ess\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"n\"\u003eDatabaseFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetCreateDatabaseMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"DbSharpSample\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSqlServerDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econnectionString\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eAllDataTypeTable\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAllDataTypeTable\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eAllDataTypeTable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrimaryKeyColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIntColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//Set properties...\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ex1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e詳しい使用方法は後のセクションで解説します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"テストファーストで開発する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%86%E3%82%B9%E3%83%88%E3%83%95%E3%82%A1%E3%83%BC%E3%82%B9%E3%83%88%E3%81%A7%E9%96%8B%E7%99%BA%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eテストファーストで開発する\u003c/h1\u003e\n\n\u003cp\u003eこのセクションでは「テストファースト」での開発手法について実際の開発を例にして解説していきます。このセクションでは以下のようなC#のクラスを生成することをゴールにして順番に説明していきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ePerson\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eInt32\u003c/span\u003e \u003cspan class=\"n\"\u003e_Age\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eInt32\u003c/span\u003e \u003cspan class=\"n\"\u003eAge\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003e_Age\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePerson\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eChildren\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003ePerson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eChildren\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePerson\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eShowName\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAddAge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInt32\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_Age\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e自動生成するC#の構成要素を以下のように分類して設計しました。\u003cbr\u003e\n・TypeName\u003cbr\u003e\n・Field\u003cbr\u003e\n・AccessModifier\u003cbr\u003e\n・MethodAccessModifier\u003cbr\u003e\n・FieldModifier\u003cbr\u003e\n・ConstructorModifier\u003cbr\u003e\n・Constructor\u003cbr\u003e\n・MethodModifier\u003cbr\u003e\n・MethodParameter\u003cbr\u003e\n・Method\u003cbr\u003e\n・PropertyBody\u003cbr\u003e\n・Property\u003cbr\u003e\n・ClassModifier\u003cbr\u003e\n・Class\u003cbr\u003e\n・InterfaceProperty\u003cbr\u003e\n・InterfaceMethod\u003cbr\u003e\n・Interface\u003cbr\u003e\n・Namespace\u003cbr\u003e\n・SourceCode\u003c/p\u003e\n\n\u003cp\u003eTypeNameは型の名前の部分を生成するためのクラスになります。Int32,Person,List,Dictionary\u0026gt;といったクラス名を生成します。最初にこのTypeNameのテストケースを考えてみましょう。以下のようなテストケースを作ってみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eTestClass\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTypeNameTest\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eTestMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeNameWithoutGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Int32\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Int32\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eTestMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeNameWithGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Func\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"String\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Int32\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Func\u0026lt;String, Int32\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eTestMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeNameWithNestedGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Func\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"String\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etp1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Action\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etp1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"String\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etp1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Int32\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Func\u0026lt;String, Action\u0026lt;String, Int32\u0026gt;\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれらのテストケースをパスするようにTypeNameクラスを作成します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTypeName\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eStringBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStringBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026lt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eテストを実行し全てのテストがパスされることを確認します。同様にテストケースを作成しそれからクラスを作成してテストをパスしていきます。C#のソースコードを生成するのはDbSharp以外の場所でも利用できるのでHigLabo.CodeGeneratorプロジェクトに置いてあります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/higty/higlabo.netstandard/tree/master/HigLabo.Test\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHigLabo.Test on GitHub\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"単一責任の原則single-responsibility-principle\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8D%98%E4%B8%80%E8%B2%AC%E4%BB%BB%E3%81%AE%E5%8E%9F%E5%89%87single-responsibility-principle\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e単一責任の原則（Single Responsibility Principle）\u003c/h1\u003e\n\n\u003cp\u003eこのセクションでは単一責任の原則を適用し、複数の言語（C#,VB.NET）に対してソースコードを生成するクラスの設計について解説します。上記のクラスでVB.NETのソースを生成しようとした場合、設計上の問題が発生します。VB.NETのソースを生成しようとした場合、以下のようにVB.NET用のメソッドを追加する必要があります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTypeName\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"nf\"\u003eWriteCSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//..method body\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"nf\"\u003eWriteVB\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//..method body\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eもし他にもJavaやF#やPythonのGeneratorを追加しようとした場合、その度にWriteXXXメソッドをTypeNameクラスに追加する必要があります。C#の担当者とVBの担当者が同じファイルに対して作業をすることになります。最近のソースコード管理の充実から同じファイルでもそんなに問題ないとはいえ、可能であれば別のファイルに対して作業ができるとマージ作業などをする必要がないのでベターです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"クラスの設計を改善する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E8%A8%AD%E8%A8%88%E3%82%92%E6%94%B9%E5%96%84%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eクラスの設計を改善する\u003c/h2\u003e\n\n\u003cp\u003eさて以上を踏まえクラスのデザインを見直します。TypeNameクラスはクラスの情報のみをもち、ソースコードの生成機能を持たないように変更します。新たにSourceCodeGeneratorクラスを作成し、こちらでソースの生成とソースのフォーマットの設定などをできるように設計します。\u003c/p\u003e\n\n\u003cp\u003eこれが単一責任の原則で\u003cbr\u003e\n・TypeNameクラス→クラスの情報を持つEntityクラス\u003cbr\u003e\n・SourceCodeGeneratorクラス→ソースコードの生成\u003cbr\u003e\nという形でそれぞれが単一の責任を持つように設計します。変更前はTypeNameがクラスの情報＋ソースコードの生成という二つの役割を持っていたためどうしてもクラスが肥大化してしまいがちになります。このように責任を単一にして分割することですっきりとした設計になります。\u003c/p\u003e\n\n\u003cp\u003eさて分割し終わったところで新たにテストファーストでテストを作成します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eTestClass\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTypeNameTest\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eTestMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeNameWithoutGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Int32\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCSharpSourceCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Int32\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVisualBasicSourceCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Int32\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eTestMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeNameWithGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Func\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"String\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Int32\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCSharpSourceCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Func\u0026lt;String, Int32\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVisualBasicSourceCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Func(Of String, Int32)\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eTestMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeNameWithNestedGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Func\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"String\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etp1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Action\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etp1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"String\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etp1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Int32\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCSharpSourceCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Func\u0026lt;String, Action\u0026lt;String, Int32\u0026gt;\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVisualBasicSourceCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Func(Of String, Action(Of String, Int32))\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eCSharpSourceCodeGeneratorクラスの内部実装は以下のようにあるでしょう。TypeNameにあったメソッドを移してきた形になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eCSharpSourceCodeGenerator\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eCSharpSourceCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeName\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eStringBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStringBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026lt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eVisualBasicSourceCodeGeneratorは以下のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eVisualBasicSourceCodeGenerator\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeName\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eStringBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStringBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"(Of \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\")\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eTypeNameクラスは以下のようになります。ソース生成部分が無くなったおかげで簡単になりました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTypeName\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e以上の設計の改善により、TypeNameとSourceCodeGeneratorクラスでファイルが分割され、さらに各言語ごとでSourceCodeGeneratorクラスを分割でき非常に作業がしやすくなりました。新しい言語やフォーマットを追加する際に、TypeNameなどのクラスに一切手を入れずに変更が可能です。これにより変更に強く、拡張もしやすいという形になっています。例えばクラスの定義をHTMLに表示するためのHTML Generatorなどを作成しHigLabo.HtmlGenerator.dllのようなDLLを作成することも既存コードを破壊することなく簡単に作成できます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"stringbuilder-vs-textwriter\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stringbuilder-vs-textwriter\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStringBuilder vs TextWriter\u003c/h1\u003e\n\n\u003cp\u003eこのセクションではTextWriterを使ってStringBuilderを使った時よりもより良いパフォーマンスを実現する方法について解説します。その為にCSharpSourceCodeGeneratorの設計を変更します。\u003c/p\u003e\n\n\u003cp\u003e実際の業務アプリケーションでは大量のストアドプロシージャからソースコードの生成を行う可能性があります。パフォーマンス、メモリの使用量などはしっかりと考慮したいところです。\u003c/p\u003e\n\n\u003cp\u003eStringBuilderを使用するとStringの使用時よりは遥かに良いパフォーマンスを実現できます。しかしToStringメソッドを読んだ瞬間にStringBuilderはメモリを浪費してしまいます。TextWriterを使用することでファイルシステムに直接データを書き込むことが可能です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTextWriter\u003c/span\u003e \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateText\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MyFile.txt\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"my data\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eSourceCodeGeneratorクラスをTextWriterに対応した形に設計を改善してみます。\u003cbr\u003e\nCSharpSourceCodeGeneratorは以下のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eCSharpSourceCodeGenerator\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSourceCodeGenerator\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eSourceCodeLanguage\u003c/span\u003e \u003cspan class=\"n\"\u003eLanguage\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eSourceCodeLanguage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eCSharpSourceCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTextWriter\u003c/span\u003e \u003cspan class=\"n\"\u003etextWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etextWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeName\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTextWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026lt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//Other method...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eVisualBasicSourceCodeGeneratorの実装です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eVisualBasicSourceCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSourceCodeGenerator\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eSourceCodeLanguage\u003c/span\u003e \u003cspan class=\"n\"\u003eLanguage\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eSourceCodeLanguage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVB\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eVisualBasicSourceCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTextWriter\u003c/span\u003e \u003cspan class=\"n\"\u003etextWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etextWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeName\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTextWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"(Of \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\")\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//Other method...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eSourceCodeGeneratorに共通のメソッドを定義しCSharpSourceCodeGenerator,VisualBasicSourceCodeGeneratorで実装することにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSourceCodeGenerator\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eIndent\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eInt32\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrentIndentLevel\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTextWriter\u003c/span\u003e \u003cspan class=\"n\"\u003eTextWriter\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"n\"\u003eSourceCodeLanguage\u003c/span\u003e \u003cspan class=\"n\"\u003eLanguage\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"nf\"\u003eSourceCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTextWriter\u003c/span\u003e \u003cspan class=\"n\"\u003etextWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIndent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"    \"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentIndentLevel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTextWriter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etextWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeName\u003c/span\u003e \u003cspan class=\"n\"\u003etypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCodeBlock\u003c/span\u003e \u003cspan class=\"n\"\u003ecodeBlock\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessModifier\u003c/span\u003e \u003cspan class=\"n\"\u003emodifier\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMethodAccessModifier\u003c/span\u003e \u003cspan class=\"n\"\u003emodifier\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldModifier\u003c/span\u003e \u003cspan class=\"n\"\u003emodifier\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eField\u003c/span\u003e \u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConstructorModifier\u003c/span\u003e \u003cspan class=\"n\"\u003emodifier\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConstructor\u003c/span\u003e \u003cspan class=\"n\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMethodModifier\u003c/span\u003e \u003cspan class=\"n\"\u003emodifier\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMethodParameter\u003c/span\u003e \u003cspan class=\"n\"\u003eparameter\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMethod\u003c/span\u003e \u003cspan class=\"n\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePropertyBody\u003c/span\u003e \u003cspan class=\"n\"\u003epropertyBody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eProperty\u003c/span\u003e \u003cspan class=\"n\"\u003eproperty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eClassModifier\u003c/span\u003e \u003cspan class=\"n\"\u003emodifier\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eClass\u003c/span\u003e \u003cspan class=\"n\"\u003e@class\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInterfaceProperty\u003c/span\u003e \u003cspan class=\"n\"\u003eproperty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInterfaceMethod\u003c/span\u003e \u003cspan class=\"n\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInterface\u003c/span\u003e \u003cspan class=\"n\"\u003e@interface\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNamespace\u003c/span\u003e \u003cspan class=\"n\"\u003e@namespace\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSourceCode\u003c/span\u003e \u003cspan class=\"n\"\u003esourceCode\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWriteIndent\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentIndentLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTextWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIndent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWriteLineAndIndent\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLineAndIndent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWriteLineAndIndent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTextWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentIndentLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTextWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIndent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eFlush\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTextWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFlush\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e上記の完全な実装はGitHubにあります。\u003cbr\u003e\n\u003ca href=\"https://github.com/higty/higlabo.netstandard/tree/master/HigLabo.CodeGenerator\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHigLabo.CodeGenerator on GitHub\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e自動生成されたC#のソースコードは以下にあります。\u003cbr\u003e\n\u003ca href=\"https://github.com/higty/higlabo.netstandard/tree/master/Tools/DbSharp/HigLabo.DbSharp.Sample\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHigLabo.DbSharp.Sample on GitHub\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e実は時間がなくてVB.NETバージョンはありません。（誰かに作ってくれる人なんていないかな…）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"storedprocedureクラスの利用方法を設計する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#storedprocedure%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95%E3%82%92%E8%A8%AD%E8%A8%88%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStoredProcedureクラスの利用方法を設計する\u003c/h1\u003e\n\n\u003cp\u003eこのセクションではストアドプロシージャを呼び出す時のAPIの設計について解説します。ストアドプロシージャは2つのタイプに分けられます。\u003cbr\u003e\n・結果セットを返さないストアドプロシージャ（insert,updateなど）\u003cbr\u003e\n・結果セットを返すストアドプロシージャ（select * from...）\u003cbr\u003e\nこの二つと複数データベース、トランザクションを直感的に利用できるAPIについて考えます。\u003c/p\u003e\n\n\u003cp\u003e以下のスクリプトでデータベースにサンプルのテーブルとストアドプロシージャを作成します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"sql\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eCreate\u003c/span\u003e \u003cspan class=\"k\"\u003eTable\u003c/span\u003e \u003cspan class=\"n\"\u003eMyTaskTable\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskId\u003c/span\u003e \u003cspan class=\"n\"\u003eUniqueIdentifier\u003c/span\u003e \u003cspan class=\"k\"\u003enot\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eTitle\u003c/span\u003e \u003cspan class=\"n\"\u003eNvarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eNot\u003c/span\u003e \u003cspan class=\"k\"\u003eNull\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,[\u003c/span\u003e\u003cspan class=\"n\"\u003ePriority\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e \u003cspan class=\"k\"\u003eNot\u003c/span\u003e \u003cspan class=\"k\"\u003eNull\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,[\u003c/span\u003e\u003cspan class=\"k\"\u003eState\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eNvarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eNot\u003c/span\u003e \u003cspan class=\"k\"\u003eNull\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eCreateTime\u003c/span\u003e \u003cspan class=\"nb\"\u003eDatetime\u003c/span\u003e \u003cspan class=\"k\"\u003eNot\u003c/span\u003e \u003cspan class=\"k\"\u003eNull\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eScheduleDate\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eDetail\u003c/span\u003e \u003cspan class=\"n\"\u003eNvarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003emax\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eNot\u003c/span\u003e \u003cspan class=\"k\"\u003eNull\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eTimestampColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003eTimestamp\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eGo\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eAlter\u003c/span\u003e \u003cspan class=\"k\"\u003eTable\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003edbo\u003c/span\u003e\u003cspan class=\"p\"\u003e].[\u003c/span\u003e\u003cspan class=\"n\"\u003eMyTaskTable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eAdd\u003c/span\u003e \u003cspan class=\"k\"\u003eConstraint\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePK_MyTaskTable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePrimary\u003c/span\u003e \u003cspan class=\"k\"\u003eKey\u003c/span\u003e \u003cspan class=\"n\"\u003eClustered\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskId\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eGo\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eCreate\u003c/span\u003e \u003cspan class=\"k\"\u003eProcedure\u003c/span\u003e \u003cspan class=\"n\"\u003eMyTaskTableInsert\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskId\u003c/span\u003e \u003cspan class=\"n\"\u003eUniqueIdentifier\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eTitle\u003c/span\u003e \u003cspan class=\"n\"\u003eNvarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003ePriority\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"k\"\u003eState\u003c/span\u003e \u003cspan class=\"n\"\u003eNvarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eCreateTime\u003c/span\u003e \u003cspan class=\"nb\"\u003eDatetime\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eScheduleDate\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eDetail\u003c/span\u003e \u003cspan class=\"n\"\u003eNvarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003emax\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eAs\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eInsert\u003c/span\u003e \u003cspan class=\"k\"\u003eInto\u003c/span\u003e \u003cspan class=\"n\"\u003eMyTaskTable\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTitle\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePriority\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003eState\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eCreateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eScheduleDate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDetail\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eValues\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eTitle\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003ePriority\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"k\"\u003eState\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eCreateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eScheduleDate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eDetail\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eGo\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eCreate\u003c/span\u003e \u003cspan class=\"k\"\u003eProcedure\u003c/span\u003e \u003cspan class=\"n\"\u003eMyTaskTableSelectBy_TaskId\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskId\u003c/span\u003e \u003cspan class=\"n\"\u003eUniqueIdentifier\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eAs\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003eMyTaskTable\u003c/span\u003e \u003cspan class=\"k\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enolock\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"n\"\u003eTaskId\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskId\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eGo\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eストアドプロシージャを使用する場合、C#でストアドプロシージャを呼び出すコードを書かなければなりません。呼び出しやすいコードについて設計します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"単純なストアドプロシージャの実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8D%98%E7%B4%94%E3%81%AA%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3%E3%81%AE%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e単純なストアドプロシージャの実行\u003c/h2\u003e\n\n\u003cp\u003e例えば以下のような形で呼び出せると分かりやすく感じます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHigLabo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSqlServerDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"connection string\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//Execute stored procedure\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyTaskTableInsert\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"c1\"\u003e//Same name to stored procedure on database\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNewGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"c1\"\u003e//Strongly typed property corresponding to stored procedure's parameter\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTitle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Post article to CodeProject\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePriority\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Executing\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreateTime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNow\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eScheduleDate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2014\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e25\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDetail\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"...Draft...\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//Execute MyTaskTableInsert stored procedure on database and get affected record count.\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//or call like this\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//var result1 = db.Execute(sp);\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esp1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyTaskTableSelectBy_TaskId\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003erecordList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetResultSets\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"c1\"\u003e//Get list of POCO object that represent a record of table on database.\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003erecord\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003erecordList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//Do something...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eストアドの名前でプロパティに引数の値をセットしてメソッド実行という形で非常に直感的に使えそうです。SqlCommandのParameterだと引数名を入力しなければなりませんが、自動生成でプロパティが生成されていればインテリセンスが利いて仕様書を見る必要もなく、型も適切に定義されていて安全に使用できそうです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"同じスキーマの複数のデータベースへの実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%90%8C%E3%81%98%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%AE%E8%A4%87%E6%95%B0%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%B8%E3%81%AE%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e同じスキーマの複数のデータベースへの実行\u003c/h2\u003e\n\n\u003cp\u003e複数の同じスキーマのDBへストアドプロシージャを実行するには以下のように書けると良いです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHigLabo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSqlServerDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"connection string to DB1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHigLabo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSqlServerDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"connection string to DB2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//Execute stored procedure\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyTaskTableInsert\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNewGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTitle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Post article to CodeProject\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePriority\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Executing\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreateTime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNow\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eScheduleDate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2014\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e25\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDetail\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"...Draft...\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb1Result1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edb1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb2Result1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edb2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//Or call like this\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb1Result2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edb1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb2Result2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edb2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"トランザクションについて\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B6%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eトランザクションについて\u003c/h2\u003e\n\n\u003cp\u003eトランザクションについては以下のように実行できると直感的に使えそうです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHigLabo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSqlServerDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"connection string\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTransactionContext\u003c/span\u003e \u003cspan class=\"n\"\u003etx\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTransactionContext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBeginTransaction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIsolationLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReadCommitted\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyTaskTableInsert\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//...Set property of MyTaskTableInsert object\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etx\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCommitTransaction\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e時には複数のトランザクションを並列に実行したい場合もあるかもしれません。その時は以下のように書けると分かりやすく実行できそうです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHigLabo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSqlServerDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"connection string to DB1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHigLabo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSqlServerDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"connection string to DB2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTransactionContext\u003c/span\u003e \u003cspan class=\"n\"\u003etx1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTransactionContext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edb1\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTransactionContext\u003c/span\u003e \u003cspan class=\"n\"\u003etx2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTransactionContext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edb2\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etx1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBeginTransaction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIsolationLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReadCommitted\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etx2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBeginTransaction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIsolationLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReadCommitted\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyTaskTable1Insert\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//...Set property of MyTaskTableInsert object\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etx1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyTaskTable2Insert\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//...Set property of MyTaskTableInsert object\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etx2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etx1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCommitTransaction\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etx2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCommitTransaction\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"データベースが一つの場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%8C%E4%B8%80%E3%81%A4%E3%81%AE%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデータベースが一つの場合\u003c/h2\u003e\n\n\u003cp\u003eデータベースが複数の場合は以上のような書き方で良いけれども、小規模なシステムでは毎回DBを渡すのは少し面倒かもしれません。例えば以下のようにデフォルトのDBを設定してそれを使用してくれる形になっているとさらに使いやすくなりそうです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//Call once on application start what database you use...\u003c/span\u003e\n\u003cspan class=\"n\"\u003eDatabaseFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetCreateDatabaseMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"DbSharpSample\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHigLabo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSqlServerDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"connection string to db\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyTaskTableInsert\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//sp.GetDatabaseKey() returns \"DbSharpSample\".\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//You can specify DatabaseKey when you generate code.\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//That makes you set different factory method for each database that has different schema.\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNewGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//Set other properties...\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"c1\"\u003e//Executed to db\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eここでDbSharpApplicationで設定したDatabaseKeyの値が使われることになります。自動生成されたストアドプロシージャクラスのDatabaseKeyの既定値が設定した値になっています。そのキーの値でDatabaseFactory.Current.SetCreateDatabaseMethodでHigLabo.Data.SqlServerDatabaseオブジェクトを生成するように設定します。そうすることでアプリケーション全体でこの既定のデータベースが使用されることになります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"databasekeyとtransactioncontextの混在\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#databasekey%E3%81%A8transactioncontext%E3%81%AE%E6%B7%B7%E5%9C%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDatabaseKeyとTransactionContextの混在\u003c/h2\u003e\n\n\u003cp\u003eDatabaseKeyとTransactionContextを直接渡すのが混在した場合は、TransactionContextのほうが優先されることになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//Call once on application start what database you use...\u003c/span\u003e\n\u003cspan class=\"n\"\u003eDatabaseFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetCreateDatabaseMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"DbSharpSample\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHigLabo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSqlServerDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"connection string to db1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHigLabo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSqlServerDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"connection string\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esp1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyTaskTableInsert\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//...Set property of MyTaskTableInsert object\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esp1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"c1\"\u003e//Executed to db1\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTransactionContext\u003c/span\u003e \u003cspan class=\"n\"\u003etx\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTransactionContext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edb2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBeginTransaction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIsolationLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReadCommitted\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esp2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyTaskTableInsert\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//...Set property of MyTaskTableInsert object\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esp2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etx\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCommitTransaction\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ストアドプロシージャクラスの実装の設計\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%AE%E8%A8%AD%E8%A8%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eストアドプロシージャクラスの実装の設計\u003c/h1\u003e\n\n\u003cp\u003e実際に実装するに当たってのクラスの設計はこんな感じで設計してみました。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/a90deb722dd4e3e978084e778550fc61b016851a/68747470733a2f2f692e696d6775722e636f6d2f575044615563592e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.imgur.com%2FWPDaUcY.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=af9092859551fbedee5cbc78e3075edd\" alt=\"alt\" data-canonical-src=\"https://i.imgur.com/WPDaUcY.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.imgur.com%2FWPDaUcY.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=52bf20cc8265348a85a82553ee5086f4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"higlabodbsharpdllに定義されるクラス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#higlabodbsharpdll%E3%81%AB%E5%AE%9A%E7%BE%A9%E3%81%95%E3%82%8C%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHigLabo.DbSharp.dllに定義されるクラス\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"storedprocedureクラス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#storedprocedure%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStoredProcedureクラス\u003c/h3\u003e\n\n\u003cp\u003eStoredProcedureクラスはストアドプロシージャ（結果セット無し）の共通の処理を定義することになります。具体的には\u003cbr\u003e\n・ExecuteNonQuery()\u003cbr\u003e\n・ExecuteNonQueryAsync()\u003cbr\u003e\nになる。さらに子クラスで実装するべき抽象メソッドとして\u003cbr\u003e\n・GetStoredProcedureName()\u003cbr\u003e\n・CreateCommand()\u003cbr\u003e\n・SetOutputParameterValue()\u003cbr\u003e\nが定義されます。GetStoredProcedureName()はストアドの名前を返すメソッド、CreateCommand()はプロパティにセットされた値からDbCommandを生成するメソッドになります。ExecuteNonQuery()を呼ぶとストアドが実行されます。SetOutputParameterValue()の内部ではOutputパラメータの値がプロパティにセットされます。このメソッドはTimestamp、Identity列などを使用した際に内部で使われ、ExecuteNonQuery()を実行後にDB上で生成された値をStoredProcedureクラスのプロパティにセットしてくれます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"databaserecordとstoredprocedureresultsetクラス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#databaserecord%E3%81%A8storedprocedureresultset%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDatabaseRecordとStoredProcedureResultSetクラス\u003c/h3\u003e\n\n\u003cp\u003eこれらは結果セットのクラスの基底クラスになります。MultiPkTableSelectByPrimaryKey.ResultSetクラスの親クラスがStoredProcedureResultSetになります。MultiPkTableSelectByPrimaryKey.ResultSetクラスはいわゆるPOCOクラスで結果セットの各値をプロパティとして持つクラスです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"storedprocedurewithresultsetクラス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#storedprocedurewithresultset%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStoredProcedureWithResultSetクラス\u003c/h3\u003e\n\n\u003cp\u003eStoredProcedureWithResultSetクラスはストアドプロシージャ（結果セット有り）の共通の処理が定義されています。\u003cbr\u003e\n・GetDataTable()\u003cbr\u003e\n・GetResultSets()\u003cbr\u003e\n・EnumerateResultSets()\u003cbr\u003e\nに共通ロジックが実装されています。ただこのままでは戻り値はStoredProcedureResultSetとなり、自動生成されてResultSetクラスではないので使い勝手が悪い状態です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"storedprocedurewithresultsettクラス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#storedprocedurewithresultsett%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStoredProcedureWithResultSet\u0026lt;T\u0026gt;クラス\u003c/h3\u003e\n\n\u003cp\u003eStoredProcedureWithResultSet\u0026lt;T\u0026gt;クラスはStoredProcedureWithResultSetクラスの戻り値をより具体的な型として返す機能を提供するクラスになります。このクラスには\u003cbr\u003e\n・SetResultSet()\u003cbr\u003e\n・CreateResultSet()\u003cbr\u003e\nが定義されていて、これらの抽象メソッドは自動生成される子クラスで実装するべき抽象メソッドになります。StoredProcedureWithResultSetクラスを自動生成されたストアドプロシージャクラスで継承することで共通処理を1か所に定義しつつ、より具体的な型でメソッドが使用でき、保守性と利便性を両立させることができるようになります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"storedprocedurewithresultsetlistクラス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#storedprocedurewithresultsetlist%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStoredProcedureWithResultSetListクラス\u003c/h3\u003e\n\n\u003cp\u003eこのクラスは複数の結果セットを返すストアドプロシージャクラスが継承する基底クラスになります。\u003cbr\u003e\nMARSに対応したストアドプロシージャの共通処理がこのクラスに定義されることになります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"自動生成されるクラス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自動生成されるクラス\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"multipktableinsertクラス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#multipktableinsert%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMultiPkTableInsertクラス\u003c/h3\u003e\n\n\u003cp\u003eMultiPkTableInsertは実際にDBに存在するストアドプロシージャに1対1対応して自動生成されるクラスになります。ストアドプロシージャの引数がプロパティとして定義され、プロパティに値をセットしてExecuteNonQuery()メソッドを呼び出せばストアドプロシージャが呼び出せます。このクラスにGetStoredProcedureName, CreateCommand, SetOutputParameterValueの具体的な実装が定義されることになります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"multipktableselectbyprimarykeyクラス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#multipktableselectbyprimarykey%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMultiPkTableSelectByPrimaryKeyクラス\u003c/h3\u003e\n\n\u003cp\u003eMultiPkTableSelectByPrimaryKeyクラスは主キーで結果セットを取得するクラスになります。結果セットの1レコードを表すクラスはMultiPkTableSelectByPrimaryKey.ResultSetクラスとして定義されています。\u003c/p\u003e\n\n\u003cp\u003eそれぞれのクラスが単一責任を持っていて処理は1か所に書かれ保守がしやすくなっており、ほとんどの処理がHigLabo.DbSharp.dll側で定義されることになります。結果として自動生成で考えなければいけないのは\u003cbr\u003e\n・CreateCommand()\u003cbr\u003e\n・SetOutputParameterValue()\u003cbr\u003e\n・SetResultSet()\u003cbr\u003e\n・CreateResultSet()\u003cbr\u003e\nの内部実装だけということになります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"スキーマからコードを生成する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%8B%E3%82%89%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスキーマからコードを生成する\u003c/h1\u003e\n\n\u003cp\u003e上記のクラス設計により\u003cbr\u003e\n・CreateCommand（常に必要）\u003cbr\u003e\n・SetOutputParameterValue（Output引数があれば）\u003cbr\u003e\n・SetResultSet（結果セットがある場合）\u003cbr\u003e\n・CreateResultSet（結果セットがある場合）\u003cbr\u003e\nを生成すればほぼ自動生成部分が完了することになります。\u003c/p\u003e\n\n\u003cp\u003eマイクロソフトのSQLサーバーの一般的な型は以下になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003ebigint\ntimestamp\nbigint\nbinary\nimage\nvarbinary\nbit\nchar\nnchar\nntext\nnvarchar\ntext\nvarchar\nxml\ndatetime\nsmalldatetime\ndate\ntime\ndatetime2\ndecimal\nmoney\nsmallmoney\nfloat\nint\nreal\nuniqueidentifier\nsmallint\ntinyint\ndatetimeoffset\nvariant\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eさらにSQLサーバーにはユーザー定義型という機能がありこれもサポートすることにしましょう。ユーザー定義型を利用すると複数のレコードを1回のラウンドトリップで一括で更新するなどの処理が実行できるようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eユーザー定義型\nudt(SqlGeometry)\nudt(SqlGeography)\nudt(HierarchyId)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eさらにC#のEnumにマッピングする機能も提供することにします。\u003c/p\u003e\n\n\u003cp\u003eまとめると以下のリストの機能がサポートされます。\u003cbr\u003e\n・一般的な型\u003cbr\u003e\n・Udt(SqlGeometry,SqlGeography,HierarchyId)\u003cbr\u003e\n・Enum\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"createcommandの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#createcommand%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCreateCommandの実装\u003c/h2\u003e\n\n\u003cp\u003eこのセクションではUsp_Structureストアドプロシージャを例に解説していきます。CreateCommandメソッドの内部実装は以下のようになるはずです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eDbCommand\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDatabase\u003c/span\u003e \u003cspan class=\"n\"\u003edatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecm\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCommandType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCommandType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStoredProcedure\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCommandText\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetStoredProcedureName\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eDbParameter\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateParameter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"@BigIntColumn\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSqlDbType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBigInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e19\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSourceColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameterName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDirection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eParameterDirection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInputOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBigIntColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateParameter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"@StructuredColumn\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSqlDbType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStructured\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSourceColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameterName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDirection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eParameterDirection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MyTableType\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStructuredColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateDataTable\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStructuredColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRecords\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValues\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"setoutputparametervalueの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#setoutputparametervalue%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSetOutputParameterValueの実装\u003c/h2\u003e\n\n\u003cp\u003eSetOutputParameterValueメソッドの内部実装は以下のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetOutputParameterValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDbCommand\u003c/span\u003e \u003cspan class=\"n\"\u003ecommand\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecm\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecommand\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDbParameter\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eDbParameter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBigIntColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInt64\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e結果セット無しのストアドプロシージャの自動生成コードは主にこの2か所と各プロパティで済みます。設計がうまくいったので最小限の自動生成コードで済みました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"createresultsetとsetresultsetの内部実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#createresultset%E3%81%A8setresultset%E3%81%AE%E5%86%85%E9%83%A8%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCreateResultSetとSetResultSetの内部実装\u003c/h2\u003e\n\n\u003cp\u003e結果セットがある場合はCreateResultSetメソッドとSetResultSetメソッドを生成する必要があります。AllDataTypeTableSelectAllの内部実装を例に解説します。\u003c/p\u003e\n\n\u003cp\u003eCreateResultSetメソッドはこのStoredProcedureクラスの結果セットに対応するResultSetクラスを生成するメソッドで以下のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eAllDataTypeTableSelectAll\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResultSet\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateResultSet\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eResultSet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eSetResultSetの内部実装は以下のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetResultSet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAllDataTypeTableSelectAll\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResultSet\u003c/span\u003e \u003cspan class=\"n\"\u003eresultSet\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIDataReader\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eresultSet\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eInt32\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrimaryKeyColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetInt64\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTimestampColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eByte\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBigIntColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetInt64\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBinaryColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eByte\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eImageColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eByte\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVarBinaryColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eByte\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBitColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBoolean\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCharColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNCharColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNTextColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNVarCharColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTextColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVarCharColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eXmlColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTimeColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSmallDateTimeColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDateColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTimeColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTime2Column\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDecimalColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDecimal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMoneyColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDecimal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSmallMoneyColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDecimal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFloatColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIntColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRealColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUniqueIdentifierColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSmallIntColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetInt16\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTinyIntColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetByte\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTimeOffsetColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTimeOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSqlVariantColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGeometryColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eglobal\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMicrosoft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSqlServer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSqlGeometry\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGeographyColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eglobal\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMicrosoft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSqlServer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSqlGeography\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHierarchyIDColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eglobal\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMicrosoft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSqlServer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSqlHierarchyId\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eDBNull\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eStoredProcedure\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToEnum\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMyEnum\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e??\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullBigIntColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetInt64\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullBinaryColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eByte\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullImageColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eByte\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullVarBinaryColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eByte\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullBitColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBoolean\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullCharColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullNCharColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullNTextColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullNVarCharColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullTextColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullVarCharColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullXmlColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullDateTimeColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullSmallDateTimeColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullDateColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullTimeColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullDateTime2Column\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullDecimalColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDecimal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullMoneyColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDecimal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullSmallMoneyColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDecimal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullFloatColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullIntColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullRealColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullUniqueIdentifierColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullSmallIntColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetInt16\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullTinyIntColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetByte\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullDateTimeOffsetColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTimeOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullSqlVariantColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullGeometryColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eglobal\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMicrosoft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSqlServer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSqlGeometry\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullGeographyColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eglobal\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMicrosoft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSqlServer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSqlGeography\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullHierarchyIDColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eglobal\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMicrosoft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSqlServer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSqlHierarchyId\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullEnumColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eStoredProcedure\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToEnum\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMyEnum\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e??\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotNullEnumColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInvalidCastException\u003c/span\u003e \u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStoredProcedureSchemaMismatchedException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e全ての型を適切に変換するコードを自動生成するだけです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"スキーマ情報の取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E6%83%85%E5%A0%B1%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスキーマ情報の取得\u003c/h2\u003e\n\n\u003cp\u003eこのコードを生成するにはデータベースのスキーマ情報が必要です。例えばCreateCommandメソッドを生成するには以下のスキーマ情報を取得する必要があります。\u003cbr\u003e\n・ColumnName\u003cbr\u003e\n・Type\u003cbr\u003e\n・Length\u003cbr\u003e\n・Precision\u003cbr\u003e\n・Scale\u003cbr\u003e\n・IsOutput parameter\u003cbr\u003e\n・UserTableTypeName\u003cbr\u003e\n・UdtTypeName\u003c/p\u003e\n\n\u003cp\u003e上記の情報を取得するためのスクリプトは以下になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"sql\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSelect\u003c/span\u003e \u003cspan class=\"n\"\u003eT01\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eStoredProcedureName\u003c/span\u003e \n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eT02\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eParameterName\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"k\"\u003eCASE\u003c/span\u003e \u003cspan class=\"n\"\u003eT03\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eis_table_type\u003c/span\u003e \n    \u003cspan class=\"k\"\u003eWhen\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e \u003cspan class=\"s1\"\u003e'structured'\u003c/span\u003e \n    \u003cspan class=\"k\"\u003eElse\u003c/span\u003e \n        \u003cspan class=\"k\"\u003eCase\u003c/span\u003e \u003cspan class=\"n\"\u003eT03\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eis_assembly_type\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eWhen\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e \u003cspan class=\"s1\"\u003e'udt'\u003c/span\u003e \n        \u003cspan class=\"k\"\u003eElse\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eCase\u003c/span\u003e \u003cspan class=\"n\"\u003eT03\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \n            \u003cspan class=\"k\"\u003eWhen\u003c/span\u003e \u003cspan class=\"s1\"\u003e'sql_variant'\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e \u003cspan class=\"s1\"\u003e'variant'\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eElse\u003c/span\u003e \u003cspan class=\"n\"\u003eT03\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \n            \u003cspan class=\"k\"\u003eEnd\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eEnd\u003c/span\u003e\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eParameterType\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"k\"\u003eCase\u003c/span\u003e \u003cspan class=\"n\"\u003eT02\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emax_length\u003c/span\u003e \n    \u003cspan class=\"k\"\u003eWhen\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \n    \u003cspan class=\"k\"\u003eElse\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eCase\u003c/span\u003e \u003cspan class=\"n\"\u003eT03\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \n        \u003cspan class=\"k\"\u003eWhen\u003c/span\u003e \u003cspan class=\"s1\"\u003e'nvarchar'\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e \u003cspan class=\"n\"\u003eT02\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emax_length\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eWhen\u003c/span\u003e \u003cspan class=\"s1\"\u003e'nchar'\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e \u003cspan class=\"n\"\u003eT02\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emax_length\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eElse\u003c/span\u003e \u003cspan class=\"n\"\u003eT02\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emax_length\u003c/span\u003e \n    \u003cspan class=\"k\"\u003eEnd\u003c/span\u003e\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eParameterLength\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eT02\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eprecision\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eParameterPrecision\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eT02\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003escale\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eParameterScale\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eT02\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eis_output\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eIsOutput\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eT02\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edefault_value\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eDefaultValue\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"k\"\u003eCASE\u003c/span\u003e \u003cspan class=\"n\"\u003eT03\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eis_table_type\u003c/span\u003e \n    \u003cspan class=\"k\"\u003eWhen\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e \u003cspan class=\"n\"\u003eT03\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \n    \u003cspan class=\"k\"\u003eElse\u003c/span\u003e \u003cspan class=\"s1\"\u003e''\u003c/span\u003e\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eUserTableTypeName\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"k\"\u003eCase\u003c/span\u003e \u003cspan class=\"n\"\u003eT03\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eis_assembly_type\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWhen\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e \u003cspan class=\"n\"\u003eT03\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\n\u003cspan class=\"k\"\u003eElse\u003c/span\u003e \u003cspan class=\"s1\"\u003e''\u003c/span\u003e \n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eUdtTypeName\u003c/span\u003e \n\u003cspan class=\"k\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003esys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprocedures\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eT01\u003c/span\u003e \n\u003cspan class=\"k\"\u003eInner\u003c/span\u003e \u003cspan class=\"k\"\u003eJoin\u003c/span\u003e \u003cspan class=\"n\"\u003esys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eparameters\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eT02\u003c/span\u003e \n\u003cspan class=\"k\"\u003eON\u003c/span\u003e \u003cspan class=\"n\"\u003eT01\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eobject_id\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eT02\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eobject_id\u003c/span\u003e \n\u003cspan class=\"k\"\u003eInner\u003c/span\u003e \u003cspan class=\"k\"\u003eJoin\u003c/span\u003e \u003cspan class=\"n\"\u003esys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etypes\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eT03\u003c/span\u003e \n\u003cspan class=\"k\"\u003eON\u003c/span\u003e \u003cspan class=\"n\"\u003eT02\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euser_type_id\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eT03\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euser_type_id\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWhere\u003c/span\u003e \u003cspan class=\"n\"\u003eT01\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'MyStoredProcedureName'\u003c/span\u003e\n\u003cspan class=\"k\"\u003eOrder\u003c/span\u003e \u003cspan class=\"k\"\u003eBy\u003c/span\u003e \u003cspan class=\"n\"\u003eT02\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eparameter_id\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e以下のような情報が取得できます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/cb583322938cc4a7f1038abf2877456931122c1e/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f47657453746f72656450726f636564757265536368656d615363726970742e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FGetStoredProcedureSchemaScript.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8b2330206c9c1a6d9719af2c33439b30\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/GetStoredProcedureSchemaScript.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FGetStoredProcedureSchemaScript.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cbb15b088d2f727378785037c61e6415 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSetResultSetメソッドのスキーマ情報は適当なパラメーターを与えてストアドを実行し、DataReaderクラスのGetSchemaTableメソッドから取得します。\u003c/p\u003e\n\n\u003cp\u003eこれで自動生成のための情報が全て揃い、後はコードを生成するだけとなります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"postgresとoracleへの対応\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#postgres%E3%81%A8oracle%E3%81%B8%E3%81%AE%E5%AF%BE%E5%BF%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePostgresとOracleへの対応\u003c/h2\u003e\n\n\u003cp\u003eDbSharpApplicationは現状SQLサーバーとMySQLに対応しています。PostgresとOracleには対応していません。どこかに\u003cbr\u003e\n・スキーマデータを取得するSQLスクリプト\u003cbr\u003e\n・全ての型のメソッドの実装コード（CreateCommand,SetResutSet,SetOutputParameter）\u003cbr\u003e\nを作ってもいいよ、なんて人を探してます。\u003c/p\u003e\n\n\u003cp\u003e実装コードは\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"createcommandメソッド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#createcommand%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCreateCommandメソッド\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateParameter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"@NVarCharColumn\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSqlDbType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNVarChar\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSourceColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameterName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDirection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eParameterDirection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInputOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNVarCharColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateParameter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"@GeometryColumn\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSqlDbType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUdt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e//SqlDbType is Udt\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSourceColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameterName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDirection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eParameterDirection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInputOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetUdtTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"geometry\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e//Set UdtTypeName property.\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGeometryColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"setresultset\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#setresultset\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSetResultSet\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNVarCharColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"setoutputparametervalue\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#setoutputparametervalue\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSetOutputParameterValue\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNVarCharColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eを作っていただけるとPostgresとOracle対応ができそうです。PostgresとOracleのプロフェッショナルな方、お待ちしております。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"enumのサポート\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#enum%E3%81%AE%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEnumのサポート\u003c/h1\u003e\n\n\u003cp\u003e特定の値のみ許可する場合、Enumのサポートがあると便利です。Enumサポートの仕様は以下のようにデザインします。\u003cbr\u003e\n・C#上でプロパティがEnumになり、強く型付けされた形で扱える\u003cbr\u003e\n・Enumの値は文字列になってデータベースへ保存される。\u003cbr\u003e\n・データベースの列の型はテキストを格納できる型のみ\u003c/p\u003e\n\n\u003cp\u003eEnum機能によりデータベースに間違った値が挿入されることを防ぐことが可能です。データベースへ値を送るときはCreateCommandメソッドの中で以下のように変換されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateParameter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"@EnumColumn\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSqlDbType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNVarChar\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSourceColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameterName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDirection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eParameterDirection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToStringOrNullFromEnum\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eデータベースから取得された文字列はEnumに変換されます。変換には以下のメソッドが使用されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003eToEnum\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eObject\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e\n\u003cspan class=\"err\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nc\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eIsEnum\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eArgumentException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"T must be Enum type\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etp\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eEnum\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryParse\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eInvalidEnumDataException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのメソッドを使用してSetResutSetメソッドで以下のようにテキストからEnumへ変換されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eStoredProcedure\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToEnum\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMyEnum\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e??\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eデータベースにEnumへ変換ができない不正な値が含まれている場合、InvalidEnumDataExceptionがスローされます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ユーザー定義型\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E5%AE%9A%E7%BE%A9%E5%9E%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eユーザー定義型\u003c/h1\u003e\n\n\u003cp\u003eこのセクションではユーザー定義型について解説します。サンプルプロジェクトの中にMyTableTypeというユーザー定義型を作成するコードがあります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"sql\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eCreate\u003c/span\u003e \u003cspan class=\"k\"\u003eType\u003c/span\u003e \u003cspan class=\"n\"\u003eMyTableType\u003c/span\u003e \u003cspan class=\"k\"\u003eAs\u003c/span\u003e \u003cspan class=\"k\"\u003eTable\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBigIntColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003ebigint\u003c/span\u003e \u003cspan class=\"k\"\u003enot\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eBinaryColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003ebinary\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eImageColumn\u003c/span\u003e \u003cspan class=\"n\"\u003eimage\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eVarBinaryColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003evarbinary\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eBitColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003ebit\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eCharColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003echar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eNCharColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003enchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eNTextColumn\u003c/span\u003e \u003cspan class=\"n\"\u003entext\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eNVarCharColumn\u003c/span\u003e \u003cspan class=\"n\"\u003envarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eTextColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003etext\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eVarCharColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003evarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eXmlColumn\u003c/span\u003e \u003cspan class=\"n\"\u003exml\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTimeColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003edatetime\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eSmallDateTimeColumn\u003c/span\u003e \u003cspan class=\"n\"\u003esmalldatetime\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eDateColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003edate\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eTimeColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003etime\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTime2Column\u003c/span\u003e \u003cspan class=\"n\"\u003edatetime2\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eDecimalColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003edecimal\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eMoneyColumn\u003c/span\u003e \u003cspan class=\"n\"\u003emoney\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eSmallMoneyColumn\u003c/span\u003e \u003cspan class=\"n\"\u003esmallmoney\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eFloatColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003efloat\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eIntColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eRealColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003ereal\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eUniqueIdentifierColumn\u003c/span\u003e \u003cspan class=\"n\"\u003euniqueidentifier\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eSmallIntColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003esmallint\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eTinyIntColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003etinyint\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTimeOffsetColumn\u003c/span\u003e \u003cspan class=\"n\"\u003edatetimeoffset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumColumn\u003c/span\u003e \u003cspan class=\"n\"\u003envarchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eTimeStamp,Geometry,Geography,HierarchyIdとSqlVariantは対応しません。\u003c/p\u003e\n\n\u003cp\u003e作成したユーザー定義型をストアドプロシージャの引数で使用できます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"sql\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eCreate\u003c/span\u003e \u003cspan class=\"k\"\u003eProcedure\u003c/span\u003e \u003cspan class=\"n\"\u003eUsp_Structure\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eBigIntColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003ebigint\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eStructuredColumn\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eMyTableType\u003c/span\u003e \u003cspan class=\"n\"\u003ereadonly\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eAs\u003c/span\u003e\n\u003cspan class=\"p\"\u003e...\u003c/span\u003e\u003cspan class=\"err\"\u003e省略\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e引数で使用する際にはreadonlyキーワードをつける必要があります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ユーザー定義型とは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E5%AE%9A%E7%BE%A9%E5%9E%8B%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eユーザー定義型とは？\u003c/h2\u003e\n\n\u003cp\u003e引数でユーザー定義型を使用することでレコードのリストをデータベースに送ることができます。例えば100件のUPDATEする処理を1回のラウンドトリップでデータベースに送れるのでラウンドトリップを100回繰り返す場合に比べパフォーマンスが大幅に向上します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ユーザー定義型の使い方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E5%AE%9A%E7%BE%A9%E5%9E%8B%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eユーザー定義型の使い方\u003c/h2\u003e\n\n\u003cp\u003eDbSharpApplicationでユーザー定義型を使用する場合は以下のように書けます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eudt\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyTableType\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003erecord\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eMyTableType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003erecord\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBigIntColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//Set other property...\u003c/span\u003e\n\u003cspan class=\"n\"\u003eudt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRecords\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erecord\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eUsp_Structure\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStructuredColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eudt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//Set other property...\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ユーザー定義型の実装の設計\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E5%AE%9A%E7%BE%A9%E5%9E%8B%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%AE%E8%A8%AD%E8%A8%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eユーザー定義型の実装の設計\u003c/h2\u003e\n\n\u003cp\u003eユーザー定義型に関係するクラスを以下のように設計しました。\u003cbr\u003e\n・UserDefinedTableType\u003cbr\u003e\n・UserDefinedTableType\u003cbr\u003e\n・MyTableType\u003cbr\u003e\n・MyTableType.Record\u003cbr\u003e\nストアドの時と同様に単一責任、共通処理をまとめるなどを設計で行い、自動生成部分のコードを最小限に抑えます。クラスダイアグラムは以下のようになります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/446a7388d54c639c428d6dd20f12bf0549046491/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f55736572446566696e656454797065436c6173734469616772616d2e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FUserDefinedTypeClassDiagram.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f2aa80ce901b67c63d951a47c5877290\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/UserDefinedTypeClassDiagram.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FUserDefinedTypeClassDiagram.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=48d2b5e3267601c9287b6ece7c9c7783 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eほぼ全ての共通処理はUserDefinedTableType,UserDefinedTableTypeに定義されています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUserDefinedTableType\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \n    \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUserDefinedTableTypeRecord\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_Records\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eRecords\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003e_Records\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"n\"\u003eDataTable\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateDataTable\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDataTable\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateDataTable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003erecords\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateDataTable\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003erecords\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValues\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUserDefinedTableTypeRecord\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eDatabaseRecord\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetValues\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e自動生成されたクラスは以下のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMyTableType\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUserDefinedTableType\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMyTableType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eDataTable\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateDataTable\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDataTable\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eColumns\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"BigIntColumn\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInt64\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//abbreviated other code...\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eRecord\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUserDefinedTableTypeRecord\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eInt64\u003c/span\u003e \u003cspan class=\"n\"\u003e_BigIntColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//abbreviated other field...\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eInt64\u003c/span\u003e \u003cspan class=\"n\"\u003eBigIntColumn\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eget\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003e_BigIntColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eset\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetPropertyValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003e_BigIntColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetPropertyChangedEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//abbreviated other properties...\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetValues\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eoo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e28\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eoo\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBigIntColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//abbreviated other...\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eoo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eユーザー定義型はDbSharpApplicationにおいてはストアドプロシージャの引数のみで使用されます。使用できるようにするためにCreateCommandメソッドを生成する必要があります。内部実装は以下のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateParameter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"@StructuredColumn\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSqlDbType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStructured\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSourceColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameterName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDirection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eParameterDirection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetTypeName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MyTableType\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStructuredColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateDataTable\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStructuredColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRecords\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValues\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eユーザー定義型をOUTPUT引数に定義することはできないのでSetOutputParameterValueメソッドを生成する必要はありません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"sql\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eCreate\u003c/span\u003e \u003cspan class=\"k\"\u003eProcedure\u003c/span\u003e \u003cspan class=\"n\"\u003eUsp_Structure\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eBigIntColumn\u003c/span\u003e \u003cspan class=\"nb\"\u003ebigint\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e\n\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eStructuredColumn\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eMyTableType\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"c1\"\u003e--エラー!!!\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eAs\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまた結果セットでユーザー定義型を使用することはできないのでGetResultSetsメソッドも生成の必要はありません。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"複数の結果セットを返すストアドプロシージャ-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AE%E7%B5%90%E6%9E%9C%E3%82%BB%E3%83%83%E3%83%88%E3%82%92%E8%BF%94%E3%81%99%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e複数の結果セットを返すストアドプロシージャ\u003c/h1\u003e\n\n\u003cp\u003eSQLサーバーにはMARSという機能があり、一度の呼び出しで複数の結果セットを取得することが可能です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"sql\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eCreate\u003c/span\u003e \u003cspan class=\"k\"\u003eProcedure\u003c/span\u003e \u003cspan class=\"n\"\u003eMultipleResultSets_Procedure\u003c/span\u003e\n\u003cspan class=\"k\"\u003eAs\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003eTable1\u003c/span\u003e\n\u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003eTable2\u003c/span\u003e\n\u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003eTable3\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eDbSharpApplicationは複数の結果セットも対応しており以下のように書いて利用できます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMultipleResultSets_Procedure\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ersl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetResultSetsList\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ersl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResultSet1List\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ersl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResultSet2List\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ersl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResultSet3List\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eResultSet1,ResultSet2,ResultSet3という名前は自由に変更可能です。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/29d002451d93d1d23fe0ac392b2d1c0bc7342008/68747470733a2f2f7777772e636f646570726f6a6563742e636f6d2f4b422f63732f3737363831312f446253686172704170706c69636174696f6e5573705f53656c6563744d756c74695461626c652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationUsp_SelectMultiTable.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=18c664aa0b7a20f8966482fd42f0f909\" alt=\"alt\" data-canonical-src=\"https://www.codeproject.com/KB/cs/776811/DbSharpApplicationUsp_SelectMultiTable.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.codeproject.com%2FKB%2Fcs%2F776811%2FDbSharpApplicationUsp_SelectMultiTable.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a2d9ba2792721f5a74bd6ff2363a956e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"indentityrowguidtimestamp列の対応\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#indentityrowguidtimestamp%E5%88%97%E3%81%AE%E5%AF%BE%E5%BF%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eIndentity,RowGuid,Timestamp列の対応\u003c/h1\u003e\n\n\u003cp\u003eこのセクションではIndentity,RowGuid,Timestampについて解説します。これらの列の特徴として2つの特徴があります。\u003cbr\u003e\n・実行時にデータベースで値が生成される\u003cbr\u003e\n・実行後に生成された値を取得したい\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eIdentityTableInsertc\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//sp.IntColumn = 1;//値のセットの必要無し\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNVarCharColumn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"MyValue1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIntColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e//データベースで生成された値がセット済み。\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eRowGuid,Timestampについても同様にExecuteNonQueryの実行後にプロパティにアクセスすると値を取得できます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003eDbSharpApplicationはデータベースアクセス回りのツールです。データベース回りのツールは他にもたくさんのライブラリがあります。\u003cbr\u003e\n・NHibernate\u003cbr\u003e\n・Entity Framework\u003cbr\u003e\n・Dapper\u003cbr\u003e\n・Repository pattern\u003c/p\u003e\n\n\u003cp\u003eDbSharpが良い点は以下になります。メインの機能は\u003cbr\u003e\n・直感的なAPI\u003cbr\u003e\n・SqlServer,MySqlのサポート(Oracle,PostgreSqlはそのうち...)\u003cbr\u003e\n・トランザクションのサポート\u003cbr\u003e\n・Timestamp,Identityのサポート\u003cbr\u003e\n・ユーザー定義型,RowGuid,Geometry,Geography,HierarchyIdの対応(SqlServer)\u003cbr\u003e\n・Table機能でのBulkInsertのサポート(SqlServer)\u003cbr\u003e\n・Enumのサポート\u003cbr\u003e\n・Setのサポート(MySql)\u003cbr\u003e\n・パフォーマンスペナルティが無い\u003cbr\u003e\n・No LINQ\u003c/p\u003e\n\n\u003cp\u003e何か足りない機能があれば気軽にTwitterまでDMください。\u003cbr\u003e\n\u003ca href=\"https://twitter.com/higlabo\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHigLabo on Twitter\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2019-10-18T02:06:12Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"8RJOculaSHddQB26Jlu8ukwYPHsqRAX/zQ==--ms7/mro0rH3qdID2--TuxnK84gqNWxK/hJVj1MMw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-08-18T04:50:57Z","likesCount":3,"linkUrl":"https://qiita.com/higty/items/3c7000c06c83321e2319","organization":null,"originalId":1050211,"stockedCount":2,"title":"DbSharp（ストアドを実行するC#のソースコード自動生成ツール）の紹介","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e概要\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#dbsharp%E3%81%A8%E3%81%AF\"\u003eDbSharpとは？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E7%9B%AE%E6%AC%A1\"\u003eこの記事の目次\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#dbsharpapplication%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9\"\u003eDbSharpApplicationの使い方\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#dbsharpapplication%E3%81%AE%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB\"\u003eDbSharpApplicationのチュートリアル\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E6%A9%9F%E8%83%BD%E3%81%A7%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%82%8Bcrud%E7%94%A8%E3%81%AE%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3\"\u003eテーブル機能で生成されるCRUD用のストアドプロシージャ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AE%E7%B5%90%E6%9E%9C%E3%82%BB%E3%83%83%E3%83%88%E3%82%92%E8%BF%94%E3%81%99%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3\"\u003e複数の結果セットを返すストアドプロシージャ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#c%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90\"\u003eC#ファイルの自動生成\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%86%E3%82%B9%E3%83%88%E3%83%95%E3%82%A1%E3%83%BC%E3%82%B9%E3%83%88%E3%81%A7%E9%96%8B%E7%99%BA%E3%81%99%E3%82%8B\"\u003eテストファーストで開発する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8D%98%E4%B8%80%E8%B2%AC%E4%BB%BB%E3%81%AE%E5%8E%9F%E5%89%87single-responsibility-principle\"\u003e単一責任の原則（Single Responsibility Principle）\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E8%A8%AD%E8%A8%88%E3%82%92%E6%94%B9%E5%96%84%E3%81%99%E3%82%8B\"\u003eクラスの設計を改善する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#stringbuilder-vs-textwriter\"\u003eStringBuilder vs TextWriter\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#storedprocedure%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95%E3%82%92%E8%A8%AD%E8%A8%88%E3%81%99%E3%82%8B\"\u003eStoredProcedureクラスの利用方法を設計する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8D%98%E7%B4%94%E3%81%AA%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3%E3%81%AE%E5%AE%9F%E8%A1%8C\"\u003e単純なストアドプロシージャの実行\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%90%8C%E3%81%98%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%AE%E8%A4%87%E6%95%B0%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%B8%E3%81%AE%E5%AE%9F%E8%A1%8C\"\u003e同じスキーマの複数のデータベースへの実行\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B6%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003eトランザクションについて\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%8C%E4%B8%80%E3%81%A4%E3%81%AE%E5%A0%B4%E5%90%88\"\u003eデータベースが一つの場合\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#databasekey%E3%81%A8transactioncontext%E3%81%AE%E6%B7%B7%E5%9C%A8\"\u003eDatabaseKeyとTransactionContextの混在\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%AE%E8%A8%AD%E8%A8%88\"\u003eストアドプロシージャクラスの実装の設計\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#higlabodbsharpdll%E3%81%AB%E5%AE%9A%E7%BE%A9%E3%81%95%E3%82%8C%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9\"\u003eHigLabo.DbSharp.dllに定義されるクラス\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#storedprocedure%E3%82%AF%E3%83%A9%E3%82%B9\"\u003eStoredProcedureクラス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#databaserecord%E3%81%A8storedprocedureresultset%E3%82%AF%E3%83%A9%E3%82%B9\"\u003eDatabaseRecordとStoredProcedureResultSetクラス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#storedprocedurewithresultset%E3%82%AF%E3%83%A9%E3%82%B9\"\u003eStoredProcedureWithResultSetクラス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#storedprocedurewithresultsett%E3%82%AF%E3%83%A9%E3%82%B9\"\u003eStoredProcedureWithResultSet\u0026lt;T\u0026gt;クラス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#storedprocedurewithresultsetlist%E3%82%AF%E3%83%A9%E3%82%B9\"\u003eStoredProcedureWithResultSetListクラス\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e自動生成されるクラス\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#multipktableinsert%E3%82%AF%E3%83%A9%E3%82%B9\"\u003eMultiPkTableInsertクラス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#multipktableselectbyprimarykey%E3%82%AF%E3%83%A9%E3%82%B9\"\u003eMultiPkTableSelectByPrimaryKeyクラス\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%8B%E3%82%89%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B\"\u003eスキーマからコードを生成する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#createcommand%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003eCreateCommandの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#setoutputparametervalue%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003eSetOutputParameterValueの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#createresultset%E3%81%A8setresultset%E3%81%AE%E5%86%85%E9%83%A8%E5%AE%9F%E8%A3%85\"\u003eCreateResultSetとSetResultSetの内部実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E6%83%85%E5%A0%B1%E3%81%AE%E5%8F%96%E5%BE%97\"\u003eスキーマ情報の取得\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#postgres%E3%81%A8oracle%E3%81%B8%E3%81%AE%E5%AF%BE%E5%BF%9C\"\u003ePostgresとOracleへの対応\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#createcommand%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003eCreateCommandメソッド\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#setresultset\"\u003eSetResultSet\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#setoutputparametervalue\"\u003eSetOutputParameterValue\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#enum%E3%81%AE%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88\"\u003eEnumのサポート\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E5%AE%9A%E7%BE%A9%E5%9E%8B\"\u003eユーザー定義型\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E5%AE%9A%E7%BE%A9%E5%9E%8B%E3%81%A8%E3%81%AF\"\u003eユーザー定義型とは？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E5%AE%9A%E7%BE%A9%E5%9E%8B%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9\"\u003eユーザー定義型の使い方\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E5%AE%9A%E7%BE%A9%E5%9E%8B%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%AE%E8%A8%AD%E8%A8%88\"\u003eユーザー定義型の実装の設計\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AE%E7%B5%90%E6%9E%9C%E3%82%BB%E3%83%83%E3%83%88%E3%82%92%E8%BF%94%E3%81%99%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3-1\"\u003e複数の結果セットを返すストアドプロシージャ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#indentityrowguidtimestamp%E5%88%97%E3%81%AE%E5%AF%BE%E5%BF%9C\"\u003eIndentity,RowGuid,Timestamp列の対応\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":2125,"uuid":"3c7000c06c83321e2319","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"8bBlXbHL+rkJonqYQhLl+H5M0sA=--nss/dWv1nVe/tUTE--W0MyKAb+sKaeKv/b166PMQ==","originalId":96483,"description":"","facebookUrl":null,"githubUrl":"https://github.com/higty","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/96483/profile-images/1548390071","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F96483%2Fprofile-images%2F1548390071?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=58527db5fda57c7507543a2a423105f4","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F96483%2Fprofile-images%2F1548390071?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=cfd641f4961ac44fd5ef70299a20a2b9","urlName":"higty","websiteUrl":"https://github.com/higty","twitterUrl":"https://twitter.com/higlabo","twitterUrlName":"higlabo","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"tool","urlName":"tool"},{"name":"Database","urlName":"database"},{"name":"ORM","urlName":"orm"},{"name":"便利ツール","urlName":"%e4%be%bf%e5%88%a9%e3%83%84%e3%83%bc%e3%83%ab"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

<!DOCTYPE html><html><head><meta charset="utf-8" /><title>HoloLensでTranslator Speech APIを使ったリアルタイム翻訳-その１Translator Speech APIの使い方 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/miyaura/items/febee8ca6f9050c9ff26" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="OOrTJTTkIP4T0Y+rLwZJOhjMy92CAJl8O/gIcCAxK9/YxBFzrF88MInj4JPFiAB1r5fEnCB6UiJ4YjSN3STJ5w==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@takabrz1" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="HoloLensでTranslator Speech APIを使ったリアルタイム翻訳-その１Translator Speech APIの使い方 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1TRzlzYjB4bGJuUGpnYWRVY21GdWMyeGhkRzl5SUZOd1pXVmphQ0JCVUVuamdwTGt2Yl9qZ2FQamdaX2pnNnJqZ3FMamc2dmpncl9qZ3FUamc2RG52N3ZvcUxNdDQ0R2Q0NEd1Nzd5UlZISmhibk5zWVhSdmNpQlRjR1ZsWTJnZ1FWQko0NEd1NUwyXzQ0R0U1cGE1JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTY5OTVlMzAwM2RlMjczZTFjZGQ4M2IyZWI2ZDY2MTVk&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzFwZVdGMWNtRSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTI5NmRhNjQ5ZDFkMTEzYjZiZjI5NTdmNDlkNjcwMGI0&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=46a14d6b8772c580f5a520ed45ed89af"><meta property="og:description" content="

Translator Speech APIの癖の強さ

Microsoftサポートに確認し、新たに判明した仕様などを更新。「（2017/06/02追記）」を赤字で入れました。

Transrator Speech APIはMaic..."><meta content="https://qiita.com/miyaura/items/febee8ca6f9050c9ff26" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Unity,VisualStudio2015,HoloLens" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-f2d87efa-6e65-4c38-9c61-efa693fd00b5"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fmiyaura%2Fitems%2Ffebee8ca6f9050c9ff26">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fmiyaura%2Fitems%2Ffebee8ca6f9050c9ff26">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-f2d87efa-6e65-4c38-9c61-efa693fd00b5">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-05-06T23:04:04.000+09:00","dateModified":"2017-06-02T18:20:31.000+09:00","headline":"HoloLensでTranslator Speech APIを使ったリアルタイム翻訳-その１Translator Speech APIの使い方","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1TRzlzYjB4bGJuUGpnYWRVY21GdWMyeGhkRzl5SUZOd1pXVmphQ0JCVUVuamdwTGt2Yl9qZ2FQamdaX2pnNnJqZ3FMamc2dmpncl9qZ3FUamc2RG52N3ZvcUxNdDQ0R2Q0NEd1Nzd5UlZISmhibk5zWVhSdmNpQlRjR1ZsWTJnZ1FWQko0NEd1NUwyXzQ0R0U1cGE1JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTY5OTVlMzAwM2RlMjczZTFjZGQ4M2IyZWI2ZDY2MTVk\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzFwZVdGMWNtRSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTI5NmRhNjQ5ZDFkMTEzYjZiZjI5NTdmNDlkNjcwMGI0\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=46a14d6b8772c580f5a520ed45ed89af","mainEntityOfPage":"https://qiita.com/miyaura/items/febee8ca6f9050c9ff26","author":{"@type":"Person","address":"Nara, Japan","email":null,"identifier":"miyaura","name":"miyaura","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F152548%2Fprofile-images%2F1616018241?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=61c4f9412b9ce18c58a30ab1b3cc989e","url":"https://qiita.com/miyaura","description":"C#ベース。現在はMR関連の技術に興味あり。\r\nMicrosoft MVP for Windows Development(2018-2022)","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"miyaura","type":"items","id":"febee8ca6f9050c9ff26"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"miyaura","type":"items","id":"febee8ca6f9050c9ff26"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"miyaura","type":"items","id":"febee8ca6f9050c9ff26"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/miyaura/items/febee8ca6f9050c9ff26","location":"/miyaura/items/febee8ca6f9050c9ff26","scheme":"https","host":"qiita.com","port":null,"pathname":"/miyaura/items/febee8ca6f9050c9ff26","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"6sOz/OeX8adET31V9Mryt4QPDype3FfIWtVtb2Jz7xwK7XGqfyztad59Em0eRLv4M1QAa/ymnJYZT1GSn2YNJA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-9d6f1b34-2b58-4369-883b-0fd53bd01d8b"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/miyaura/items/febee8ca6f9050c9ff26/likers" class="css-1iupg5d">19</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">16</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/febee8ca6f9050c9ff26/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/miyaura/items/febee8ca6f9050c9ff26/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/miyaura/items/febee8ca6f9050c9ff26/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/miyaura/items/febee8ca6f9050c9ff26/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/miyaura/items/febee8ca6f9050c9ff26.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/miyaura"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/152548/profile-images/1616018241" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/miyaura" class="css-10ougpm">@<!-- -->miyaura</a><div class="css-1ay9vb9"><span><meta content="2017-05-06T14:04:04Z"/><time dateTime="2017-06-02T09:20:31Z" class="css-m19uds">updated at 2017-06-02</time></span></div></div></div></div></div><h1 class="css-cgzq40">HoloLensでTranslator Speech APIを使ったリアルタイム翻訳-その１Translator Speech APIの使い方</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/visualstudio2015" class="css-4czcte">VisualStudio2015</a><a href="/tags/hololens" class="css-4czcte">HoloLens</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="translator-speech-apiの癖の強さ" class="fragment"></span><a href="#translator-speech-api%E3%81%AE%E7%99%96%E3%81%AE%E5%BC%B7%E3%81%95"><i class="fa fa-link"></i></a>Translator Speech APIの癖の強さ</h1>

<p><font color="Red">Microsoftサポートに確認し、新たに判明した仕様などを更新。「（2017/06/02追記）」を赤字で入れました。</font></p>

<p>Transrator Speech APIはMaicrosoft社のAzureのCognitive Serviceの1APIとして提供されています。音声送れば音声を解析し、その結果を翻訳してテキスト、合成音声で結果を返してくれます。<br>
なかなか楽しい機能なのですが、気軽に試そうとしていろいろ壁に当たりました。まだTransrator Speech APIについての情報があまり見つからない（探すのが下手なのかもしれないですが。。。）ので自分が四苦八苦したあたりを備忘録に残します。最終的にはHoloLensに搭載のやり方も含めて書きます。</p>

<h2>
<span id="translator-speech-apiとは" class="fragment"></span><a href="#translator-speech-api%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>Translator Speech APIとは</h2>

<p>Microsoft AzureのCognitive Serviceの1APIでTransrator Speech APIとして提供されています。</p>

<h3>
<span id="利用料金" class="fragment"></span><a href="#%E5%88%A9%E7%94%A8%E6%96%99%E9%87%91"><i class="fa fa-link"></i></a>利用料金</h3>

<p>おそらく個人ではF0,S0のいずれかになると思うんですが、S0使う場合<font color="Red">青天井で課金</font>されますので注意してください。</p>

<h4>
<span id="f0無料" class="fragment"></span><a href="#f0%E7%84%A1%E6%96%99"><i class="fa fa-link"></i></a>F0:無料</h4>

<ul>
<li>2h/月</li>
</ul>

<h4>
<span id="s0従量課金" class="fragment"></span><a href="#s0%E5%BE%93%E9%87%8F%E8%AA%B2%E9%87%91"><i class="fa fa-link"></i></a>S0:従量課金</h4>

<ul>
<li>12ドル/１時間</li>
</ul>

<p><font color="Red">課金のルールですが、Microsoftサポートに確認したところWebsocketのオープンからクローズの時間に対して課金されます。現時点では送ったデータ量ではないとの回答をもらっています（2017/06/02追記）。</font></p>

<h3>
<span id="translator-speech-apiの仕様" class="fragment"></span><a href="#translator-speech-api%E3%81%AE%E4%BB%95%E6%A7%98"><i class="fa fa-link"></i></a>Translator Speech APIの仕様</h3>

<p>公式にある仕様は以下のサイトに書かれています。<br>
<a href="http://docs.microsofttranslator.com/speech-translate.html" class="autolink" rel="nofollow noopener" target="_blank">http://docs.microsofttranslator.com/speech-translate.html</a><br>
以下はサイトの情報と、試行錯誤した部分を説明しています。</p>

<h4>
<span id="翻訳できる言語" class="fragment"></span><a href="#%E7%BF%BB%E8%A8%B3%E3%81%A7%E3%81%8D%E3%82%8B%E8%A8%80%E8%AA%9E"><i class="fa fa-link"></i></a>翻訳できる言語</h4>

<p>Translator Speech APIの機能の中に対応している言語の情報として以下のものをHTTP通信で取得可能です。<br>
資料はこのサイトになります。<br>
<a href="http://docs.microsofttranslator.com/languages.html" class="autolink" rel="nofollow noopener" target="_blank">http://docs.microsofttranslator.com/languages.html</a><br>
* Speech-to-text: 音声からテキスト翻訳できる言語の種類(speech)<br>
* Text translation: テキストの翻訳できる言語の種類(text)<br>
* Text-to-speech: テキストから音声に翻訳できる言語の種類(tts)<br>
カッコ内文字列は通信時のパラメータ「scope」で渡す値になります。これによりAPIがサポートする言語が返ります。組み合わせは、翻訳元の言語と翻訳先の言語を取得した言語で任意に構成できます。</p>

<h4>
<span id="apiの仕様" class="fragment"></span><a href="#api%E3%81%AE%E4%BB%95%E6%A7%98"><i class="fa fa-link"></i></a>APIの仕様</h4>

<h5>
<span id="このapiはストリーミングサービスです" class="fragment"></span><a href="#%E3%81%93%E3%81%AEapi%E3%81%AF%E3%82%B9%E3%83%88%E3%83%AA%E3%83%BC%E3%83%9F%E3%83%B3%E3%82%B0%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>このAPIはストリーミングサービスです。</h5>

<p>このAPIはWebSocketでストリーミングサービスとして提供されています。基本的な処理方法としては以下の通りです。<br>
1. Translator Speech APIと接続を確立する<br>
2. 翻訳したい音声データを<font color="Red">ストリーミング</font>で送信する<br>
3. 送信した音声データを文章単位で非同期にレスポンスが返ってくる<br>
ここではまったのが2.の手順です。どうもリアルタイム翻訳を前提にしたAPIだからなのか<font color="Red">一度に大量のデータを送信</font>すると処理してくれません（しかも送ったデータ分は課金対象かもしれない。。。）。<br>
ストリーミングだから当たり前といえばそれまでなのですが、例えば<font color="Red">録音済みのデータを一気に渡す</font>というやり方はうまく動かないです。録音済みの場合でも小出しに送る必要があります。</p>

<h5>
<span id="データの送り方" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E3%82%8A%E6%96%B9"><i class="fa fa-link"></i></a>データの送り方</h5>

<p>音声はwaveを使います。マイクからの音声入力考えるとwaveの方が扱いやすいという理由です。接続確立してからサービスにデータを送るのですが、最初にwaveのHeaderデータを送信します。以降は音声をサンプリングしたデータをひたすら送ります。<br>
Headerの仕様は一般的なwaveファイルとほぼ同じなのですがストリーミングで送信するためデータサイズは不定になります。<br>
このため音声データサイズに関する部分はサイズ0として送信します。<br>
データのサンプリングレートは以下で設定してください。<br>
* サンプリングレート:16kHz<br>
* 量子化ビット:16bit<br>
* チャネル:1<br>
<del>でおそらくこのTranslator Speech APIはwaveに関しては上記のデータしかうけつけない可能性があります（これ以外のレートではうまくやり取りできない）。</del><br>
<font color="Red">Microsoftサポートに確認したところ現時点では16Khz,16bit,1channelしかうけられない仕様との事です（2017/06/02追記）。</font></p>

<h5>
<span id="送信データの翻訳単位" class="fragment"></span><a href="#%E9%80%81%E4%BF%A1%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%BF%BB%E8%A8%B3%E5%8D%98%E4%BD%8D"><i class="fa fa-link"></i></a>送信データの翻訳単位</h5>

<p>基本的には文単位になります。文章の切れ目は一定時間の無音で判断するようです。リアルタイム翻訳であれば、間が開けば勝手に解析始めるという感じです。</p>

<h5>
<span id="データの受信" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%97%E4%BF%A1"><i class="fa fa-link"></i></a>データの受信</h5>

<p>データの受信については翻訳が完了したデータ（文単位）から順次送られてきます。デフォルト設定のままであれば、翻訳結果は文単位で一括で送信されます。翻訳途中を一定間隔で返させることも可能です（いるのかちょっと不明）。<br>
データは以下の順で返信されます。<br>
1. 翻訳後のテキストデータ(JSON)<br>
2. 翻訳後の音声データ(バイナリ)<br>
2.の音声データについてはテキスト→音声、または音声→音声の組み合わせでの翻訳の場合に送られてくるはずなのですが、なぜか要求しなくても返ってきてるような気がします。不要であればJSON以外は捨てれば一応処理はできます。</p>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<p>サンプルコード交えて音声を入力して翻訳後のテキストと音声を返す説明します。<br>
基本的な作業の流れは以下のサイトに書かれている通りです。<br>
<a href="http://docs.microsofttranslator.com/speech-translate.html" class="autolink" rel="nofollow noopener" target="_blank">http://docs.microsofttranslator.com/speech-translate.html</a></p>

<p>ソースコードは以下のgithubに公開しています。最終的にはHoloLensのアプリもここに公開する予定です。</p>

<p><qiita-embed-ogp src="https://github.com/TakahiroMiyaura/HoloTranslatorSpeechSamples"></qiita-embed-ogp></p>

<h3>
<span id="環境その他" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>環境その他</h3>

<p>今回は、HoloLensに使うライブラリとしての整備もかねているので、以下の環境で実行しています。</p>

<ul>
<li>IDE

<ul>
<li>Unity 5.5.0f3</li>
<li>Visual Studio 2015 update 3 Community Edition</li>
</ul>
</li>
<li>ライブラリ関連

<ul>
<li>.NET版のサンプル（.NET 3.5)

<ul>
<li>Naudio 1.8.0 (音声データのバッファリング用、再生用)</li>
<li>Websocket-sharp 1.0.3-rc11(Unityでも使えるライブラリ)</li>
<li>LitJson 0.7.0(Unityでも使えるライブラリ）</li>
</ul>
</li>
<li>UWP版のサンプル(のちのHoloLens用アプリ）

<ul>
<li>Microsoft.NETCore.UniversalWindowsPlatform 5.0.0(Unityがこのバージョンで出力される。）</li>
<li>Naudio 1.8.0 (音声データの再生用)</li>
</ul>
</li>
</ul>
</li>
</ul>

<p>各ライブラリはすべてNugetで取得可能です。HoloLensで使用する場合はUWP版のプロジェクトをUnityからビルド後に参照して利用します<sup id="fnref1"><a href="#fn1" title="Visual Studio 2015 update 3 Community EditionでUWPのプロジェクトを作成するとMicrosoft.NETCore.UniversalWindowsPlatformのバージョンは5.2.3です。">1</a></sup>。<br>
なお、もともとはUnity上で実装するつもりで.NET 3.5版を作成していたのですが、Unityのビルド時点でUWPに変換できなったです。結局のところUnityでビルドが通る場合でもUWPの変換に失敗するシチュエーションがあるようでもう少し整理が必要といった感じです。せっかくなのでコードは残しています。</p>

<h3>
<span id="処理の流れ" class="fragment"></span><a href="#%E5%87%A6%E7%90%86%E3%81%AE%E6%B5%81%E3%82%8C"><i class="fa fa-link"></i></a>処理の流れ</h3>

<p>処理の流れは以下になります。以降の説明はUWP版のソースコードで説明します。.NET版についても利用するライブラリが少し違うだけで行っていることは同じですのでこの説明を見ながらコード眺めれば処理は理解できると思います。</p>

<ol>
<li>Token ServiceにsubscriptionKeyを送り認証トークンを取得する。</li>
<li>サポート言語の取得（任意:理由は後述）</li>
<li>translator speech APIとの接続</li>
<li>音声データの送信</li>
<li>解析結果の受信</li>
</ol>

<h4>
<span id="1-token-serviceにsubscriptionkeyを送り認証トークンを取得する" class="fragment"></span><a href="#1-token-service%E3%81%ABsubscriptionkey%E3%82%92%E9%80%81%E3%82%8A%E8%AA%8D%E8%A8%BC%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>1. Token ServiceにsubscriptionKeyを送り認証トークンを取得する。</h4>

<p>最初にCognitive Serviceの認証トークンを取得します。認証トークンは予めAzureで追加したTranslator Speech APIのSubscriptionKeyを認証サービスに送信します。サービスの接続先は<a href="">https://api.cognitive.microsoft.com/sts/v1.0/issueToken</a>になります。クエリパラメータ以下の通りです。リクエストを送信すれば、レスポンスとしてトークンを取得できます。</p>

<table>
<thead>
<tr>
<th style="text-align: center">query</th>
<th style="text-align: center">設定値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">Subscription-Key</td>
<td style="text-align: center">[サブスクリプションキー]</td>
</tr>
</tbody>
</table>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">CognitiveTranslatorService.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">///     Cognitive Service API Token Service Url</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">TokenUrl</span> <span class="p">=</span> <span class="s">"https://api.cognitive.microsoft.com/sts/v1.0/issueToken?"</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">///     Request a token to the service.</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="c1">/// &lt;returns&gt;token string.&lt;/returns&gt;</span>
<span class="k">private</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="nf">RequestToken</span><span class="p">()</span>

<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">_subscriptionKey</span><span class="p">))</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentNullException</span><span class="p">(</span><span class="s">"SubscriptionKey"</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
    <span class="n">query</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"Subscription-Key="</span><span class="p">).</span><span class="nf">Append</span><span class="p">(</span><span class="n">_subscriptionKey</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">httpClient</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>
    <span class="kt">var</span> <span class="n">stringContent</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringContent</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">httpResponseMessage</span> <span class="p">=</span> <span class="k">await</span> <span class="n">httpClient</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">TokenUrl</span> <span class="p">+</span> <span class="n">query</span><span class="p">,</span> <span class="n">stringContent</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">stream</span> <span class="p">=</span> <span class="k">await</span> <span class="n">httpResponseMessage</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStreamAsync</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">stream</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="nf">GetEncoding</span><span class="p">(</span><span class="s">"UTF-8"</span><span class="p">)))</span>
                <span class="p">{</span>
                    <span class="k">return</span> <span class="n">reader</span><span class="p">.</span><span class="nf">ReadToEnd</span><span class="p">();</span>
                <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h4>
<span id="2-サポート言語の取得" class="fragment"></span><a href="#2-%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E8%A8%80%E8%AA%9E%E3%81%AE%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>2. サポート言語の取得</h4>

<p>Translator speech APIがサポートしている言語の種類などを取得します。ここで取得した情報からTranslator speech APIで変換する言語の組み合わせを指定します。Translator speech APIでは、３つのパラメータ「to/from」,「voice」を指定します。<br>
とりあえず使うのであれば、以下の設定を利用してみてください。この設定を使うことで英語→日本語の翻訳は可能です。</p>

<table>
<thead>
<tr>
<th style="text-align: center">query</th>
<th style="text-align: center">設定値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">from</td>
<td style="text-align: center">en</td>
</tr>
<tr>
<td style="text-align: center">to</td>
<td style="text-align: center">ja</td>
</tr>
<tr>
<td style="text-align: center">voice</td>
<td style="text-align: center">ja-JP-Sayaka</td>
</tr>
</tbody>
</table>

<p>サポート言語については以下のサービスに問い合わせます。なおこの機能はトークン<br>
不要です。こちらもHTTP通信で取得します。サービスの接続先は<a href="">https://dev.microsofttranslator.com/languages</a>になります。クエリパラメータは以下の通りです。</p>

<table>
<thead>
<tr>
<th style="text-align: center">query</th>
<th style="text-align: center">設定値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">api-version</td>
<td style="text-align: center">1.0</td>
</tr>
<tr>
<td style="text-align: center">scope</td>
<td style="text-align: center">speech,text,tts</td>
</tr>
</tbody>
</table>

<p>サンプルコードではそれぞれのscopeに分けて取得しています。以下のコードはspeechのデータをとるためのロジックです。UWPであれば、HttpClientクラスでPostAsyncメソッドを使用します。データはJSON形式の文字列表現となるので、解析してデータに格納しています。サンプルコードではUWP標準のJSON部品を使用しています。今回使っているJsonObjectは型不定の場合に自分で解析して処理するためのものです。構造わかってるならJSONシリアライザやほかのOSSのJSONライブラリでもいいと思います。<br>
所々で出てくるasync - awaitのキーワードですが、これはC# 5.0から導入された非同期関連の機能です<sup id="fnref2"><a href="#fn2" title="asyncはメソッドの修飾子で「非同期処理を伴っている」メソッドであることを示すものになります。この場合のメソッドも呼び出し元では非同期で処理され、戻り値はTaskクラス（戻り値なし）またはTask&lt;戻り値の型&gt;クラスで定義します。呼び出す場合は普通のメソッドと同じ呼び出し方をするだけで非同期で実行されます。このメソッドを呼ぶときに結果を待つ必要がある場合は呼び出し時にawait を付けます。awaitを付けると不思議なことにジェネリックで指定した型が返ってきます。注意点としてawaitを付けた処理を書いたメソッドはasync修飾子が必要になります。awaitを使えない事情がある場合（たいていUnityと連携したときに起きる）はMethodAsync().GetWaiter().GetResult()と書くと同期的に動作します。ただし、同期的に書いたときはスレッドが完全に待ち状態になりこれが仇になるパターンが多いです。非同期処理を一切使っていない自分のライブラリを非同期用に提供するようなパターンでは大丈夫そうですが、.NETの提供する非同期メソッドで同期処理書くとデッドロックっぽい動きしてる気が。。。（よく遭遇するので、同期にして異常に待ちが発生するのであれば同期処理はやめてフラグで待つなど原始的な方法に逃げたほうが幸せになるかもです）">2</a></sup>。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">CognitiveTranslatorService.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">///     Translator Language Info Service Url</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">LanguageUrl</span> <span class="p">=</span> <span class="s">"https://dev.microsofttranslator.com/languages?"</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">///     Gets speech informations that Cognitive Service API can provide.</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="c1">/// &lt;returns&gt;&lt;see cref="SpeechLanguageInfo" /&gt; object list.&lt;/returns&gt;</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ReadOnlyCollection</span><span class="p">&lt;</span><span class="n">SpeechLanguageInfo</span><span class="p">&gt;&gt;</span> <span class="nf">GetSpeechLanguageInfo</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">SpeechLanguageInfo</span><span class="p">&gt;</span> <span class="n">speechLanguageInfos</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
    <span class="n">query</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"api-version="</span><span class="p">).</span><span class="nf">Append</span><span class="p">(</span><span class="n">API_VERSION</span><span class="p">);</span>
    <span class="n">query</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"&amp;scope="</span><span class="p">).</span><span class="nf">Append</span><span class="p">(</span><span class="s">"speech"</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">httpClient</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">httpResponseMessage</span> <span class="p">=</span> <span class="k">await</span> <span class="n">httpClient</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="n">LanguageUrl</span> <span class="p">+</span> <span class="n">query</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">stream</span> <span class="p">=</span> <span class="k">await</span> <span class="n">httpResponseMessage</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStreamAsync</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">stream</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="nf">GetEncoding</span><span class="p">(</span><span class="s">"UTF-8"</span><span class="p">)))</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">json</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">ReadToEnd</span><span class="p">();</span>
                    <span class="kt">var</span> <span class="n">jsonObject</span> <span class="p">=</span> <span class="n">JsonObject</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">json</span><span class="p">);</span>
                    <span class="n">speechLanguageInfos</span> <span class="p">=</span> <span class="n">jsonObject</span><span class="p">[</span><span class="s">"speech"</span><span class="p">].</span><span class="nf">GetObject</span><span class="p">().</span><span class="nf">Select</span><span class="p">(</span>
                        <span class="n">x</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">SpeechLanguageInfo</span><span class="p">()</span>
                        <span class="p">{</span>
                            <span class="n">LocaleId</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span>
                            <span class="n">Language</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="nf">GetObject</span><span class="p">()[</span><span class="s">"language"</span><span class="p">].</span><span class="nf">GetString</span><span class="p">(),</span>
                            <span class="n">Name</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="nf">GetObject</span><span class="p">()[</span><span class="s">"name"</span><span class="p">].</span><span class="nf">GetString</span><span class="p">()</span>
                        <span class="p">});</span>
                <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ReadOnlyCollection</span><span class="p">&lt;</span><span class="n">SpeechLanguageInfo</span><span class="p">&gt;(</span><span class="n">speechLanguageInfos</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>scopeは複数設定可能でカンマ区切りで送ればまとめてJSON形式で結果が返ります。形式は以下のようなものです。</p>

<h5>
<span id="speechデータの例抜粋" class="fragment"></span><a href="#speech%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BE%8B%E6%8A%9C%E7%B2%8B"><i class="fa fa-link"></i></a>speechデータの例（抜粋）</h5>

<div class="code-frame" data-lang="json"><div class="highlight"><pre class="with-code"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"speech"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"ar-EG"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Arabic"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"language"</span><span class="p">:</span><span class="s2">"ar"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">.....</span><span class="w">
    </span><span class="nl">"zh-TW"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Chinese Traditional"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"language"</span><span class="p">:</span><span class="s2">"zh-Hant"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h5>
<span id="textデータの例抜粋" class="fragment"></span><a href="#text%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BE%8B%E6%8A%9C%E7%B2%8B"><i class="fa fa-link"></i></a>textデータの例（抜粋）</h5>

<div class="code-frame" data-lang="json"><div class="highlight"><pre class="with-code"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"text"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"af"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Afrikaans"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dir"</span><span class="p">:</span><span class="s2">"ltr"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">.....</span><span class="w">
    </span><span class="nl">"zh-Hant"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Chinese Traditional"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dir"</span><span class="p">:</span><span class="s2">"ltr"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h5>
<span id="ttsデータの例抜粋" class="fragment"></span><a href="#tts%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BE%8B%E6%8A%9C%E7%B2%8B"><i class="fa fa-link"></i></a>ttsデータの例（抜粋）</h5>

<div class="code-frame" data-lang="json"><div class="highlight"><pre class="with-code"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"tts"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"ar-EG-Hoda"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"gender"</span><span class="p">:</span><span class="s2">"female"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"locale"</span><span class="p">:</span><span class="s2">"ar-G"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"languageName"</span><span class="p">:</span><span class="s2">"Arabic"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"displayName"</span><span class="p">:</span><span class="s2">"Hoda"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"regionName"</span><span class="p">:</span><span class="s2">"Egypt"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"language"</span><span class="p">:</span><span class="s2">"ar"</span><span class="p">},</span><span class="w">
    </span><span class="err">.....</span><span class="w">
    </span><span class="nl">"zh-TW-Zhiwei"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"gender"</span><span class="p">:</span><span class="s2">"male"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"locale"</span><span class="p">:</span><span class="s2">"zh-TW"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"languageName"</span><span class="p">:</span><span class="s2">"Chinese Traditional"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"displayName"</span><span class="p">:</span><span class="s2">"Zhiwei"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"regionName"</span><span class="p">:</span><span class="s2">"Taiwan"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"language"</span><span class="p">:</span><span class="s2">"zh-Hant"</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4>
<span id="3-translator-speech-apiとの接続" class="fragment"></span><a href="#3-translator-speech-api%E3%81%A8%E3%81%AE%E6%8E%A5%E7%B6%9A"><i class="fa fa-link"></i></a>3. translator speech APIとの接続</h4>

<p>必要な情報が集まったら、translator speech APIに接続を行います。UWPでWebSocket用に提供されているクラスは<a href="https://msdn.microsoft.com/library/windows/apps/br226923" rel="nofollow noopener" target="_blank">StreamWebSocket</a>と<a href="https://msdn.microsoft.com/library/windows/apps/br226842" rel="nofollow noopener" target="_blank">MessageWebSocket</a>の２種類ありますが、今回は<a href="https://msdn.microsoft.com/library/windows/apps/br226842" rel="nofollow noopener" target="_blank">MessageWebSocket</a>クラスを使用します。<br>
使い方はすごく簡単で、インスタンス化の後初期設定を行い接続すれば完了します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">CognitiveTranslatorService.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">///     Translator WebSocket Url</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">SpeechTranslateUrl</span> <span class="p">=</span> <span class="s">@"wss://dev.microsofttranslator.com/speech/translate?"</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">///     Connect to the server before sending audio</span>
<span class="c1">///     It will get the authentication credentials and add it to the header</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="c1">/// &lt;param name="from"&gt;&lt;/param&gt;</span>
<span class="c1">/// &lt;param name="to"&gt;&lt;/param&gt;</span>
<span class="c1">/// &lt;param name="voice"&gt;&lt;/param&gt;</span>
<span class="c1">/// &lt;returns&gt;&lt;/returns&gt;</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Connect</span><span class="p">(</span><span class="kt">string</span> <span class="k">from</span><span class="p">,</span> <span class="kt">string</span> <span class="n">to</span><span class="p">,</span> <span class="kt">string</span> <span class="n">voice</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">webSocket</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MessageWebSocket</span><span class="p">();</span>

    <span class="n">webSocket</span><span class="p">.</span><span class="nf">SetRequestHeader</span><span class="p">(</span><span class="s">"Authorization"</span><span class="p">,</span> <span class="s">"Bearer "</span> <span class="p">+</span> <span class="n">bearerToken</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
    <span class="n">query</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"from="</span><span class="p">).</span><span class="nf">Append</span><span class="p">(</span><span class="k">from</span><span class="p">);</span>
    <span class="n">query</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"&amp;to="</span><span class="p">).</span><span class="nf">Append</span><span class="p">(</span><span class="n">to</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">voice</span><span class="p">))</span>
        <span class="n">query</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"&amp;features=texttospeech&amp;voice="</span><span class="p">).</span><span class="nf">Append</span><span class="p">(</span><span class="n">voice</span><span class="p">);</span>
    <span class="n">query</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"&amp;api-version="</span><span class="p">).</span><span class="nf">Append</span><span class="p">(</span><span class="n">API_VERSION</span><span class="p">);</span>


    <span class="n">webSocket</span><span class="p">.</span><span class="n">MessageReceived</span> <span class="p">+=</span> <span class="n">WebSocket_MessageReceived</span><span class="p">;</span>

    <span class="c1">// connect to the service</span>
    <span class="k">await</span> <span class="n">webSocket</span><span class="p">.</span><span class="nf">ConnectAsync</span><span class="p">(</span><span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="n">SpeechTranslateUrl</span> <span class="p">+</span> <span class="n">query</span><span class="p">));</span> 
<span class="p">}</span>

</code></pre></div>
</div>

<p>最初に引数なしでインスタンス化を行います。そのあとHeader情報に認証情報を付与します。これは先ほど取得した"Bearer "+認証トークン文字列をAuthorizationヘッダに付与するだけです。あとはAPIの接続先として<a href="">wss://dev.microsofttranslator.com/speech/translate</a>と翻訳する言語の設定として以下のクエリを設定します。</p>

<table>
<thead>
<tr>
<th style="text-align: center">query</th>
<th style="text-align: center">必須</th>
<th style="text-align: center">設定値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">api-version</td>
<td style="text-align: center">○</td>
<td style="text-align: center">1.0</td>
</tr>
<tr>
<td style="text-align: center">to</td>
<td style="text-align: center">○</td>
<td style="text-align: center">翻訳元の言語(例:en)</td>
</tr>
<tr>
<td style="text-align: center">from</td>
<td style="text-align: center">○</td>
<td style="text-align: center">翻訳後の言語(例:ja)</td>
</tr>
<tr>
<td style="text-align: center">voice</td>
<td style="text-align: center"></td>
<td style="text-align: center">合成音声のID(例:ja-JP-Sayaka)</td>
</tr>
<tr>
<td style="text-align: center">features</td>
<td style="text-align: center"></td>
<td style="text-align: center">texttospeech<sup id="fnref3"><a href="#fn3" title="voice指定時のみ">3</a></sup>
</td>
</tr>
</tbody>
</table>

<p>なお、ヘッダ情報を書き換えできないライブラリを利用する場合は、Authヘッダの代わりにクエリとしてaccess_tokenで認証トークンを渡せば正しく処理されます（詳細は公式資料を参照）。</p>

<h4>
<span id="4-音声データの送信" class="fragment"></span><a href="#4-%E9%9F%B3%E5%A3%B0%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E4%BF%A1"><i class="fa fa-link"></i></a>4. 音声データの送信</h4>

<h5>
<span id="処理の実装" class="fragment"></span><a href="#%E5%87%A6%E7%90%86%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>処理の実装</h5>

<p>音声データの送信については、Waveファイルを同じ形式でデータを送信します。まず最初にwaveのヘッダー情報を送信し、続いて音声データを送ります。<br>
ヘッダについてはMicrosoft社のドキュメントに書いている通りです。ロジックで表現すると次のような形になります。先にも書きましたが、16000Hz,16bit,1channelでヘッダはセットしてください（送るデータもこのレートになるようにします）。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">CognitiveTranslatorService.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">///     number of the wave audio channels.</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">readonly</span> <span class="kt">short</span> <span class="n">_channels</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">///     number of the wave audio sample rate.</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">_sampleRate</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">///     number of the wave audio bit per sample.</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">readonly</span> <span class="kt">short</span> <span class="n">_bitsPerSample</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">///     Create a RIFF Wave Header for PCM 16bit 16kHz Mono</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="c1">/// &lt;returns&gt;&lt;/returns&gt;</span>
<span class="k">private</span> <span class="kt">byte</span><span class="p">[]</span> <span class="nf">GetWaveHeader</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">extraSize</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">blockAlign</span> <span class="p">=</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span> <span class="p">(</span><span class="n">_channels</span> <span class="p">*</span> <span class="p">(</span><span class="n">_bitsPerSample</span> <span class="p">/</span> <span class="m">8</span><span class="p">));</span>
    <span class="kt">var</span> <span class="n">averageBytesPerSecond</span> <span class="p">=</span> <span class="n">_sampleRate</span> <span class="p">*</span> <span class="n">blockAlign</span><span class="p">;</span>

    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">stream</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MemoryStream</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">writer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BinaryWriter</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="s">"RIFF"</span><span class="p">));</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="s">"WAVE"</span><span class="p">));</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="s">"fmt "</span><span class="p">));</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="m">18</span> <span class="p">+</span> <span class="n">extraSize</span><span class="p">);</span> 
        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">((</span><span class="kt">short</span><span class="p">)</span> <span class="m">1</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">_channels</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">_sampleRate</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">averageBytesPerSecond</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">blockAlign</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">_bitsPerSample</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">((</span><span class="kt">short</span><span class="p">)</span> <span class="n">extraSize</span><span class="p">);</span>

        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="s">"data"</span><span class="p">));</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>

        <span class="n">stream</span><span class="p">.</span><span class="n">Position</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="n">stream</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span>
        <span class="n">stream</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">buffer</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">buffer</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>WebSocketにデータを送信する場合はMessageWebSocketクラスのOutputStreamプロパティにデータを書き込めば非同期で送信されます。書き込む毎にデータを送信するため非効率なので、定期的にこのStreamに書き込むためにバッファリングできるラッパークラスを利用します。UWPではDataWriterクラスがそれです。このクラスはWriteメソッドでデータをバッファリングし、StoreAsyncメソッドで元のStreamクラスに対してバッファリングされたデータの書き込みを実施するという便利なものです。このStoreAsyncメソッドを一定間隔で呼び出すようにタイマーで制御しておき、音声データについてはDataWriterのWriteメソッドで随時書き込めば非同期でリアルタイムにデータを送信する仕組みが実現します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">CognitiveTranslatorService.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="c1">// setup the data writer</span>
<span class="n">dataWriter</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DataWriter</span><span class="p">(</span><span class="n">webSocket</span><span class="p">.</span><span class="n">OutputStream</span><span class="p">);</span>
<span class="n">dataWriter</span><span class="p">.</span><span class="n">ByteOrder</span> <span class="p">=</span> <span class="n">ByteOrder</span><span class="p">.</span><span class="n">LittleEndian</span><span class="p">;</span>
<span class="n">dataWriter</span><span class="p">.</span><span class="nf">WriteBytes</span><span class="p">(</span><span class="nf">GetWaveHeader</span><span class="p">());</span>

<span class="c1">//// flush the dataWriter periodically</span>
<span class="n">_connectionTimer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Timer</span><span class="p">(</span><span class="k">async</span> <span class="n">s</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dataWriter</span><span class="p">.</span><span class="n">UnstoredBufferLength</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">await</span> <span class="n">dataWriter</span><span class="p">.</span><span class="nf">StoreAsync</span><span class="p">();</span>
        <span class="p">}</span>
         <span class="c1">// reset the timer</span>
        <span class="n">_connectionTimer</span><span class="p">.</span><span class="nf">Change</span><span class="p">(</span><span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMilliseconds</span><span class="p">(</span><span class="m">250</span><span class="p">),</span> <span class="n">Timeout</span><span class="p">.</span><span class="n">InfiniteTimeSpan</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="k">null</span><span class="p">,</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMilliseconds</span><span class="p">(</span><span class="m">250</span><span class="p">),</span> <span class="n">Timeout</span><span class="p">.</span><span class="n">InfiniteTimeSpan</span><span class="p">);</span>          

</code></pre></div>
</div>

<p>DataWriterのラッピングについてはMessageWebSocketのOutputStreamを引数に渡すだけで実現できます。定期的にバッファリングしたデータをOutputStreamに書き出すために、System.Threading.Timerクラスを使用します。このクラスは指定されたメソッドを一定時間後に一定時間間隔で実行することができます。上記の実装では250ms後に１回だけ実行するように設定しています。250ms後にs=&gt;{}内の処理が呼び出されるのですが、この最後のところで、250ms後に１度実行するようにTimerクラスの再設定を行うことで250ms毎に繰り返し実行するようにしています。</p>

<h5>
<span id="サンプルデータの書き込み" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF"><i class="fa fa-link"></i></a>サンプルデータの書き込み</h5>

<p>サンプルコードには何かのWaveファイルを読み込んでサービスに書き込むロジックも記載しています。waveファイルを扱いやすくするためにNaudioライブラリを使用しています。後述の受信データの再生にもNaudioを使用しています。<br>
waveのRAWデータを取得して、量子化ビットに合わせてサンプリング値に変換しサーバに送信しています。データは小出しに送るために適当な間隔で少しずつ送るロジックを記載しています。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">MainPage.xaml.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">waveStream</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FileStream</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">FileMode</span><span class="p">.</span><span class="n">Open</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawSourceWaveStream</span><span class="p">(</span><span class="n">waveStream</span><span class="p">,</span> <span class="k">new</span> <span class="nf">WaveFormat</span><span class="p">(</span><span class="m">16000</span><span class="p">,</span> <span class="m">16</span><span class="p">,</span> <span class="m">1</span><span class="p">));</span>

            <span class="kt">var</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="n">reader</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span>
            <span class="kt">var</span> <span class="n">bytesRead</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">buffer</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">samplesL</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">float</span><span class="p">[</span><span class="n">bytesRead</span> <span class="p">/</span> <span class="n">reader</span><span class="p">.</span><span class="n">BlockAlign</span><span class="p">];</span>

            <span class="k">switch</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">WaveFormat</span><span class="p">.</span><span class="n">BitsPerSample</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">case</span> <span class="m">8</span><span class="p">:</span>                    <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">samplesL</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
                        <span class="n">samplesL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="n">i</span> <span class="p">*</span> <span class="n">reader</span><span class="p">.</span><span class="n">BlockAlign</span><span class="p">]</span> <span class="p">-</span> <span class="m">128</span><span class="p">)</span> <span class="p">/</span> <span class="m">128f</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>

                <span class="k">case</span> <span class="m">16</span><span class="p">:</span> 
                    <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">samplesL</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
                        <span class="n">samplesL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">BitConverter</span><span class="p">.</span><span class="nf">ToInt16</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">i</span> <span class="p">*</span> <span class="n">reader</span><span class="p">.</span><span class="n">BlockAlign</span><span class="p">)</span> <span class="p">/</span> <span class="m">32768f</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>

                <span class="k">case</span> <span class="m">32</span><span class="p">:</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">samplesL</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
                        <span class="n">samplesL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">BitConverter</span><span class="p">.</span><span class="nf">ToSingle</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">i</span> <span class="p">*</span> <span class="n">reader</span><span class="p">.</span><span class="n">BlockAlign</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="kt">var</span> <span class="n">w</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="m">16000</span><span class="p">];</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">w</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
                <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="m">1000</span><span class="p">;</span>
            <span class="c1">//この部分は再生するwaveに応じて変更してください。</span>
            <span class="c1">//サンプルでは3～4秒程度のデータを送っていました。</span>
            <span class="n">service</span><span class="p">.</span><span class="nf">AddSamplingData</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">32000</span><span class="p">);</span>
            <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
            <span class="n">service</span><span class="p">.</span><span class="nf">AddSamplingData</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">32000</span><span class="p">,</span> <span class="m">32000</span><span class="p">);</span>
            <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
            <span class="n">service</span><span class="p">.</span><span class="nf">AddSamplingData</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">64000</span><span class="p">,</span> <span class="m">32000</span><span class="p">);</span>
            <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
            <span class="n">service</span><span class="p">.</span><span class="nf">AddSamplingData</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">96000</span><span class="p">,</span> <span class="n">buffer</span><span class="p">.</span><span class="n">Length</span> <span class="p">-</span> <span class="m">96000</span><span class="p">);</span>
            <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
            <span class="c1">//無音データを意図的に送っています。</span>
            <span class="n">service</span><span class="p">.</span><span class="nf">AddSamplingData</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">w</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div>
</div>

<h4>
<span id="5-解析結果の受信" class="fragment"></span><a href="#5-%E8%A7%A3%E6%9E%90%E7%B5%90%E6%9E%9C%E3%81%AE%E5%8F%97%E4%BF%A1"><i class="fa fa-link"></i></a>5. 解析結果の受信</h4>

<p>データの送信が問題なく行われて解析が実行されると処理結果が返ってきます。合成音声での翻訳結果を受け取る場合は２回レスポンスがあります。<br>
１回目は送信データの解析結果とその翻訳後の情報がJSON形式で取得できます。２回目のデータはバイナリのwave形式の音声データとなっています。サンプルは音声データをNAudioに渡すことで音声出力しています。<br>
データの振り分けについてはUWPのライブラリはかなり簡単です。メッセージ受信に発生するイベントのMessageWebSocketMessageReceivedEventArgsクラスにはMessageType プロパティというメッセージの種類がわかるものがあります。これでバイナリかどうか判断すればテキスト形式のデータか音声データか判別可能です。なお、ほかのWebSocket部品を利用する場合は最初の４バイトが"RIFF"のデータになっているかを確認すればOKです。もしRIFFなら音声データが受信できているので音声処理を行います。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">MainPage.xaml.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// An event that indicates that a message was received on the MessageWebSocket object.</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="c1">/// &lt;param name="sender"&gt;The event source.&lt;/param&gt;</span>
<span class="c1">/// &lt;param name="args"&gt;The event data. If there is no event data, this parameter will be null.&lt;/param&gt;</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">WebSocket_MessageReceived</span><span class="p">(</span><span class="n">MessageWebSocket</span> <span class="n">sender</span><span class="p">,</span> <span class="n">MessageWebSocketMessageReceivedEventArgs</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">OnRootMessage</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="nf">OnRootMessage</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">MessageType</span> <span class="p">==</span> <span class="n">SocketMessageType</span><span class="p">.</span><span class="n">Binary</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">OnVoiceMessage</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="nf">OnVoiceMessage</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">OnTextMessage</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="nf">OnTextMessage</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
</div>

<h5>
<span id="テキストデータの取得" class="fragment"></span><a href="#%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>テキストデータの取得</h5>

<p>テキストデータについては以下のような形式でデータが返ってきます。必要な部分を取り出して利用する形です。サンプルコードは特に加工せずにデータを出力します。</p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre class="with-code"><code><span class="p">{</span><span class="w">
  </span><span class="err">type:</span><span class="w"> </span><span class="s2">"final"</span><span class="w">
  </span><span class="err">id:</span><span class="w"> </span><span class="s2">"XXXXX"</span><span class="p">,</span><span class="w">
  </span><span class="err">recognition:</span><span class="w"> </span><span class="s2">"[理解した文章]"</span><span class="p">,</span><span class="w"> 
  </span><span class="err">translation:</span><span class="w"> </span><span class="s2">"[理解した文章に対する翻訳データ]"</span><span class="p">,</span><span class="w">
  </span><span class="err">audioStreamPosition:</span><span class="w"> </span><span class="err">xxxxx</span><span class="p">,</span><span class="w">
  </span><span class="err">audioSizeBytes:</span><span class="w"> </span><span class="err">xxxxx</span><span class="p">,</span><span class="w">
  </span><span class="err">audioTimeOffset:</span><span class="w"> </span><span class="err">xxxxx</span><span class="p">,</span><span class="w">
  </span><span class="err">audioTimeSize:</span><span class="w"> </span><span class="err">xxxxx</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h5>
<span id="音声データの取得" class="fragment"></span><a href="#%E9%9F%B3%E5%A3%B0%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>音声データの取得</h5>

<p>音声データはwaveフォーマットに従って送られてきます。ですので例えばファイルで保存すればそのまま再生できます。今回のサンプルではファイル出力なしにNaudio使って再生しています。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">MainPage.xaml.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">OnVoiceMessage</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">MessageWebSocketMessageReceivedEventArgs</span> <span class="n">messageEventArgs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="n">messageEventArgs</span><span class="p">.</span><span class="nf">GetDataStream</span><span class="p">())</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">stream</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">AsStreamForRead</span><span class="p">())</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">mStream</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MemoryStream</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">bufferSize</span> <span class="p">=</span> <span class="m">32000</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">bytes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;();</span>
        <span class="kt">var</span> <span class="n">buf</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="n">bufferSize</span><span class="p">];</span>
        <span class="kt">var</span> <span class="n">length</span> <span class="p">=</span> <span class="n">stream</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">length</span> <span class="p">-</span> <span class="n">bufferSize</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">bytes</span><span class="p">.</span><span class="nf">AddRange</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
            <span class="n">length</span> <span class="p">=</span> <span class="n">stream</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
            <span class="n">bytes</span><span class="p">.</span><span class="nf">AddRange</span><span class="p">(</span><span class="n">buf</span><span class="p">.</span><span class="nf">Take</span><span class="p">(</span><span class="n">length</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">());</span>

        <span class="kt">var</span> <span class="n">fullData</span> <span class="p">=</span> <span class="n">bytes</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
        <span class="n">mStream</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">fullData</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">fullData</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="n">mStream</span><span class="p">.</span><span class="n">Position</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">bitsPerSampleBytes</span> <span class="p">=</span> <span class="n">fullData</span><span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="m">34</span><span class="p">).</span><span class="nf">Take</span><span class="p">(</span><span class="m">2</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">channelBytes</span> <span class="p">=</span> <span class="n">fullData</span><span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="m">22</span><span class="p">).</span><span class="nf">Take</span><span class="p">(</span><span class="m">2</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">samplingBytes</span> <span class="p">=</span> <span class="n">fullData</span><span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="m">24</span><span class="p">).</span><span class="nf">Take</span><span class="p">(</span><span class="m">4</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">bitsPerSample</span> <span class="p">=</span> <span class="n">BitConverter</span><span class="p">.</span><span class="nf">ToInt16</span><span class="p">(</span><span class="n">bitsPerSampleBytes</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">channel</span> <span class="p">=</span> <span class="n">BitConverter</span><span class="p">.</span><span class="nf">ToInt16</span><span class="p">(</span><span class="n">channelBytes</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">samplingRate</span> <span class="p">=</span> <span class="n">BitConverter</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">(</span><span class="n">samplingBytes</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>

        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">player</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WasapiOutRT</span><span class="p">(</span><span class="n">AudioClientShareMode</span><span class="p">.</span><span class="n">Shared</span><span class="p">,</span> <span class="m">250</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">player</span><span class="p">.</span><span class="nf">Init</span><span class="p">(()</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">waveChannel32</span> <span class="p">=</span>
                    <span class="k">new</span> <span class="nf">WaveChannel32</span><span class="p">(</span><span class="k">new</span> <span class="nf">RawSourceWaveStream</span><span class="p">(</span><span class="n">mStream</span><span class="p">,</span>
                        <span class="k">new</span> <span class="nf">WaveFormat</span><span class="p">(</span><span class="n">samplingRate</span><span class="p">,</span> <span class="n">bitsPerSample</span><span class="p">,</span> <span class="n">channel</span><span class="p">)));</span>
                <span class="kt">var</span> <span class="n">mixer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MixingSampleProvider</span><span class="p">(</span><span class="k">new</span><span class="p">[]</span> <span class="p">{</span><span class="n">waveChannel32</span><span class="p">.</span><span class="nf">ToSampleProvider</span><span class="p">()});</span>

                <span class="k">return</span> <span class="n">mixer</span><span class="p">.</span><span class="nf">ToWaveProvider16</span><span class="p">();</span>
            <span class="p">});</span>

            <span class="n">player</span><span class="p">.</span><span class="nf">Play</span><span class="p">();</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">PlaybackState</span> <span class="p">==</span> <span class="n">PlaybackState</span><span class="p">.</span><span class="n">Playing</span><span class="p">)</span>
            <span class="p">{</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h2>

<p>Translator Speech APIの仕組みがまだあまり情報としてないので、分量は多くなりましたが何かの参考になれば幸いです。基本的にはこのUWPのライブラリを使いHoloLensのマイクからリアルタイムで集音した音声データをTranslator Speech APIに送信し、結果を文字でHoloLensに表示することで今回のものは実現しています。また、ライブラリ自体は使いまわせるはずなのでいろいろなアプリにも組み込めると思います。<br>
その2ではHoloLensからリアルタイムで音声を集音する方法を書きたいと思います。<br>
ほんとはその2でHoloLensで実装にするつもりでしたが、おそらく音声のリアルタイム集音はそれだけで何かに使える可能性が高いので別途整理したいなと思った次第です。</p>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>Visual Studio 2015 update 3 Community EditionでUWPのプロジェクトを作成するとMicrosoft.NETCore.UniversalWindowsPlatformのバージョンは5.2.3です。 <a href="#fnref1">↩</a></p>
</li>

<li id="fn2">
<p>asyncはメソッドの修飾子で「非同期処理を伴っている」メソッドであることを示すものになります。この場合のメソッドも呼び出し元では非同期で処理され、戻り値はTaskクラス（戻り値なし）またはTask&lt;戻り値の型&gt;クラスで定義します。呼び出す場合は普通のメソッドと同じ呼び出し方をするだけで非同期で実行されます。このメソッドを呼ぶときに結果を待つ必要がある場合は呼び出し時にawait を付けます。awaitを付けると不思議なことにジェネリックで指定した型が返ってきます。注意点としてawaitを付けた処理を書いたメソッドはasync修飾子が必要になります。awaitを使えない事情がある場合（たいていUnityと連携したときに起きる）はMethodAsync().GetWaiter().GetResult()と書くと同期的に動作します。ただし、同期的に書いたときはスレッドが完全に待ち状態になりこれが仇になるパターンが多いです。非同期処理を一切使っていない自分のライブラリを非同期用に提供するようなパターンでは大丈夫そうですが、.NETの提供する非同期メソッドで同期処理書くとデッドロックっぽい動きしてる気が。。。（よく遭遇するので、同期にして異常に待ちが発生するのであれば同期処理はやめてフラグで待つなど原始的な方法に逃げたほうが幸せになるかもです） <a href="#fnref2">↩</a></p>
</li>

<li id="fn3">
<p>voice指定時のみ <a href="#fnref3">↩</a></p>
</li>

</ol>
</div>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fmiyaura%2Fitems%2Ffebee8ca6f9050c9ff26&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fmiyaura%2Fitems%2Ffebee8ca6f9050c9ff26&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/miyaura/items/febee8ca6f9050c9ff26/likers" class="css-1iupg5d">19</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">16</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/febee8ca6f9050c9ff26/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/miyaura/items/febee8ca6f9050c9ff26/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/miyaura/items/febee8ca6f9050c9ff26/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/miyaura/items/febee8ca6f9050c9ff26/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/miyaura/items/febee8ca6f9050c9ff26.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-9d6f1b34-2b58-4369-883b-0fd53bd01d8b">{"authorAnalyticsTrackingId":"UA-92162552-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-b3dd5ed0-0849-4243-9e66-df8fcbfe41ad"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-b3dd5ed0-0849-4243-9e66-df8fcbfe41ad">{}</script>
      
<div id="LoginModal-react-component-abf18771-b4c4-42fd-b128-7f97d3b1df14"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-abf18771-b4c4-42fd-b128-7f97d3b1df14">{}</script>
      
<div id="StockModal-react-component-4032d7f6-a68e-4e5d-ac19-3720d8e45c6c"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-4032d7f6-a68e-4e5d-ac19-3720d8e45c6c">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;gW8QiRlS3YUP5FGe2a1Bu7Z/vGqdjA4DqN0QbDRPoIJhQdLfgenBS5XWPqYzIwj0ASSzKz/2xV3rRyyRyVpCug==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"translator-speech-apiの癖の強さ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#translator-speech-api%E3%81%AE%E7%99%96%E3%81%AE%E5%BC%B7%E3%81%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTranslator Speech APIの癖の強さ\u003c/h1\u003e\n\n\u003cp\u003e\u003cfont color=\"Red\"\u003eMicrosoftサポートに確認し、新たに判明した仕様などを更新。「（2017/06/02追記）」を赤字で入れました。\u003c/font\u003e\u003c/p\u003e\n\n\u003cp\u003eTransrator Speech APIはMaicrosoft社のAzureのCognitive Serviceの1APIとして提供されています。音声送れば音声を解析し、その結果を翻訳してテキスト、合成音声で結果を返してくれます。\u003cbr\u003e\nなかなか楽しい機能なのですが、気軽に試そうとしていろいろ壁に当たりました。まだTransrator Speech APIについての情報があまり見つからない（探すのが下手なのかもしれないですが。。。）ので自分が四苦八苦したあたりを備忘録に残します。最終的にはHoloLensに搭載のやり方も含めて書きます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"translator-speech-apiとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#translator-speech-api%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTranslator Speech APIとは\u003c/h2\u003e\n\n\u003cp\u003eMicrosoft AzureのCognitive Serviceの1APIでTransrator Speech APIとして提供されています。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"利用料金\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%A9%E7%94%A8%E6%96%99%E9%87%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e利用料金\u003c/h3\u003e\n\n\u003cp\u003eおそらく個人ではF0,S0のいずれかになると思うんですが、S0使う場合\u003cfont color=\"Red\"\u003e青天井で課金\u003c/font\u003eされますので注意してください。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"f0無料\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#f0%E7%84%A1%E6%96%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eF0:無料\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003e2h/月\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"s0従量課金\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#s0%E5%BE%93%E9%87%8F%E8%AA%B2%E9%87%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eS0:従量課金\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003e12ドル/１時間\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cfont color=\"Red\"\u003e課金のルールですが、Microsoftサポートに確認したところWebsocketのオープンからクローズの時間に対して課金されます。現時点では送ったデータ量ではないとの回答をもらっています（2017/06/02追記）。\u003c/font\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"translator-speech-apiの仕様\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#translator-speech-api%E3%81%AE%E4%BB%95%E6%A7%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTranslator Speech APIの仕様\u003c/h3\u003e\n\n\u003cp\u003e公式にある仕様は以下のサイトに書かれています。\u003cbr\u003e\n\u003ca href=\"http://docs.microsofttranslator.com/speech-translate.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://docs.microsofttranslator.com/speech-translate.html\u003c/a\u003e\u003cbr\u003e\n以下はサイトの情報と、試行錯誤した部分を説明しています。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"翻訳できる言語\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%BF%BB%E8%A8%B3%E3%81%A7%E3%81%8D%E3%82%8B%E8%A8%80%E8%AA%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e翻訳できる言語\u003c/h4\u003e\n\n\u003cp\u003eTranslator Speech APIの機能の中に対応している言語の情報として以下のものをHTTP通信で取得可能です。\u003cbr\u003e\n資料はこのサイトになります。\u003cbr\u003e\n\u003ca href=\"http://docs.microsofttranslator.com/languages.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://docs.microsofttranslator.com/languages.html\u003c/a\u003e\u003cbr\u003e\n* Speech-to-text: 音声からテキスト翻訳できる言語の種類(speech)\u003cbr\u003e\n* Text translation: テキストの翻訳できる言語の種類(text)\u003cbr\u003e\n* Text-to-speech: テキストから音声に翻訳できる言語の種類(tts)\u003cbr\u003e\nカッコ内文字列は通信時のパラメータ「scope」で渡す値になります。これによりAPIがサポートする言語が返ります。組み合わせは、翻訳元の言語と翻訳先の言語を取得した言語で任意に構成できます。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"apiの仕様\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#api%E3%81%AE%E4%BB%95%E6%A7%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAPIの仕様\u003c/h4\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"このapiはストリーミングサービスです\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%AEapi%E3%81%AF%E3%82%B9%E3%83%88%E3%83%AA%E3%83%BC%E3%83%9F%E3%83%B3%E3%82%B0%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%A7%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこのAPIはストリーミングサービスです。\u003c/h5\u003e\n\n\u003cp\u003eこのAPIはWebSocketでストリーミングサービスとして提供されています。基本的な処理方法としては以下の通りです。\u003cbr\u003e\n1. Translator Speech APIと接続を確立する\u003cbr\u003e\n2. 翻訳したい音声データを\u003cfont color=\"Red\"\u003eストリーミング\u003c/font\u003eで送信する\u003cbr\u003e\n3. 送信した音声データを文章単位で非同期にレスポンスが返ってくる\u003cbr\u003e\nここではまったのが2.の手順です。どうもリアルタイム翻訳を前提にしたAPIだからなのか\u003cfont color=\"Red\"\u003e一度に大量のデータを送信\u003c/font\u003eすると処理してくれません（しかも送ったデータ分は課金対象かもしれない。。。）。\u003cbr\u003e\nストリーミングだから当たり前といえばそれまでなのですが、例えば\u003cfont color=\"Red\"\u003e録音済みのデータを一気に渡す\u003c/font\u003eというやり方はうまく動かないです。録音済みの場合でも小出しに送る必要があります。\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"データの送り方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E3%82%8A%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデータの送り方\u003c/h5\u003e\n\n\u003cp\u003e音声はwaveを使います。マイクからの音声入力考えるとwaveの方が扱いやすいという理由です。接続確立してからサービスにデータを送るのですが、最初にwaveのHeaderデータを送信します。以降は音声をサンプリングしたデータをひたすら送ります。\u003cbr\u003e\nHeaderの仕様は一般的なwaveファイルとほぼ同じなのですがストリーミングで送信するためデータサイズは不定になります。\u003cbr\u003e\nこのため音声データサイズに関する部分はサイズ0として送信します。\u003cbr\u003e\nデータのサンプリングレートは以下で設定してください。\u003cbr\u003e\n* サンプリングレート:16kHz\u003cbr\u003e\n* 量子化ビット:16bit\u003cbr\u003e\n* チャネル:1\u003cbr\u003e\n\u003cdel\u003eでおそらくこのTranslator Speech APIはwaveに関しては上記のデータしかうけつけない可能性があります（これ以外のレートではうまくやり取りできない）。\u003c/del\u003e\u003cbr\u003e\n\u003cfont color=\"Red\"\u003eMicrosoftサポートに確認したところ現時点では16Khz,16bit,1channelしかうけられない仕様との事です（2017/06/02追記）。\u003c/font\u003e\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"送信データの翻訳単位\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%80%81%E4%BF%A1%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%BF%BB%E8%A8%B3%E5%8D%98%E4%BD%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e送信データの翻訳単位\u003c/h5\u003e\n\n\u003cp\u003e基本的には文単位になります。文章の切れ目は一定時間の無音で判断するようです。リアルタイム翻訳であれば、間が開けば勝手に解析始めるという感じです。\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"データの受信\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%97%E4%BF%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデータの受信\u003c/h5\u003e\n\n\u003cp\u003eデータの受信については翻訳が完了したデータ（文単位）から順次送られてきます。デフォルト設定のままであれば、翻訳結果は文単位で一括で送信されます。翻訳途中を一定間隔で返させることも可能です（いるのかちょっと不明）。\u003cbr\u003e\nデータは以下の順で返信されます。\u003cbr\u003e\n1. 翻訳後のテキストデータ(JSON)\u003cbr\u003e\n2. 翻訳後の音声データ(バイナリ)\u003cbr\u003e\n2.の音声データについてはテキスト→音声、または音声→音声の組み合わせでの翻訳の場合に送られてくるはずなのですが、なぜか要求しなくても返ってきてるような気がします。不要であればJSON以外は捨てれば一応処理はできます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"使い方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%84%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使い方\u003c/h2\u003e\n\n\u003cp\u003eサンプルコード交えて音声を入力して翻訳後のテキストと音声を返す説明します。\u003cbr\u003e\n基本的な作業の流れは以下のサイトに書かれている通りです。\u003cbr\u003e\n\u003ca href=\"http://docs.microsofttranslator.com/speech-translate.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://docs.microsofttranslator.com/speech-translate.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eソースコードは以下のgithubに公開しています。最終的にはHoloLensのアプリもここに公開する予定です。\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/TakahiroMiyaura/HoloTranslatorSpeechSamples\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"環境その他\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83%E3%81%9D%E3%81%AE%E4%BB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境その他\u003c/h3\u003e\n\n\u003cp\u003e今回は、HoloLensに使うライブラリとしての整備もかねているので、以下の環境で実行しています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eIDE\n\n\u003cul\u003e\n\u003cli\u003eUnity 5.5.0f3\u003c/li\u003e\n\u003cli\u003eVisual Studio 2015 update 3 Community Edition\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eライブラリ関連\n\n\u003cul\u003e\n\u003cli\u003e.NET版のサンプル（.NET 3.5)\n\n\u003cul\u003e\n\u003cli\u003eNaudio 1.8.0 (音声データのバッファリング用、再生用)\u003c/li\u003e\n\u003cli\u003eWebsocket-sharp 1.0.3-rc11(Unityでも使えるライブラリ)\u003c/li\u003e\n\u003cli\u003eLitJson 0.7.0(Unityでも使えるライブラリ）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUWP版のサンプル(のちのHoloLens用アプリ）\n\n\u003cul\u003e\n\u003cli\u003eMicrosoft.NETCore.UniversalWindowsPlatform 5.0.0(Unityがこのバージョンで出力される。）\u003c/li\u003e\n\u003cli\u003eNaudio 1.8.0 (音声データの再生用)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e各ライブラリはすべてNugetで取得可能です。HoloLensで使用する場合はUWP版のプロジェクトをUnityからビルド後に参照して利用します\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"Visual Studio 2015 update 3 Community EditionでUWPのプロジェクトを作成するとMicrosoft.NETCore.UniversalWindowsPlatformのバージョンは5.2.3です。\"\u003e1\u003c/a\u003e\u003c/sup\u003e。\u003cbr\u003e\nなお、もともとはUnity上で実装するつもりで.NET 3.5版を作成していたのですが、Unityのビルド時点でUWPに変換できなったです。結局のところUnityでビルドが通る場合でもUWPの変換に失敗するシチュエーションがあるようでもう少し整理が必要といった感じです。せっかくなのでコードは残しています。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"処理の流れ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%87%A6%E7%90%86%E3%81%AE%E6%B5%81%E3%82%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e処理の流れ\u003c/h3\u003e\n\n\u003cp\u003e処理の流れは以下になります。以降の説明はUWP版のソースコードで説明します。.NET版についても利用するライブラリが少し違うだけで行っていることは同じですのでこの説明を見ながらコード眺めれば処理は理解できると思います。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eToken ServiceにsubscriptionKeyを送り認証トークンを取得する。\u003c/li\u003e\n\u003cli\u003eサポート言語の取得（任意:理由は後述）\u003c/li\u003e\n\u003cli\u003etranslator speech APIとの接続\u003c/li\u003e\n\u003cli\u003e音声データの送信\u003c/li\u003e\n\u003cli\u003e解析結果の受信\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"1-token-serviceにsubscriptionkeyを送り認証トークンを取得する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-token-service%E3%81%ABsubscriptionkey%E3%82%92%E9%80%81%E3%82%8A%E8%AA%8D%E8%A8%BC%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. Token ServiceにsubscriptionKeyを送り認証トークンを取得する。\u003c/h4\u003e\n\n\u003cp\u003e最初にCognitive Serviceの認証トークンを取得します。認証トークンは予めAzureで追加したTranslator Speech APIのSubscriptionKeyを認証サービスに送信します。サービスの接続先は\u003ca href=\"\"\u003ehttps://api.cognitive.microsoft.com/sts/v1.0/issueToken\u003c/a\u003eになります。クエリパラメータ以下の通りです。リクエストを送信すれば、レスポンスとしてトークンを取得できます。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003equery\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e設定値\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eSubscription-Key\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e[サブスクリプションキー]\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCognitiveTranslatorService.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e///     Cognitive Service API Token Service Url\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eTokenUrl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"https://api.cognitive.microsoft.com/sts/v1.0/issueToken?\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e///     Request a token to the service.\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;returns\u0026gt;token string.\u0026lt;/returns\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eRequestToken\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsNullOrEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_subscriptionKey\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eArgumentNullException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SubscriptionKey\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStringBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Subscription-Key=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_subscriptionKey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ehttpClient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHttpClient\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estringContent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStringContent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ehttpResponseMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ehttpClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePostAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTokenUrl\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estringContent\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estream\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ehttpResponseMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadAsStreamAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStreamReader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"UTF-8\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadToEnd\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"2-サポート言語の取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E8%A8%80%E8%AA%9E%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. サポート言語の取得\u003c/h4\u003e\n\n\u003cp\u003eTranslator speech APIがサポートしている言語の種類などを取得します。ここで取得した情報からTranslator speech APIで変換する言語の組み合わせを指定します。Translator speech APIでは、３つのパラメータ「to/from」,「voice」を指定します。\u003cbr\u003e\nとりあえず使うのであれば、以下の設定を利用してみてください。この設定を使うことで英語→日本語の翻訳は可能です。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003equery\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e設定値\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003efrom\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003een\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eto\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003eja\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003evoice\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003eja-JP-Sayaka\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eサポート言語については以下のサービスに問い合わせます。なおこの機能はトークン\u003cbr\u003e\n不要です。こちらもHTTP通信で取得します。サービスの接続先は\u003ca href=\"\"\u003ehttps://dev.microsofttranslator.com/languages\u003c/a\u003eになります。クエリパラメータは以下の通りです。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003equery\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e設定値\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eapi-version\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e1.0\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003escope\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003espeech,text,tts\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eサンプルコードではそれぞれのscopeに分けて取得しています。以下のコードはspeechのデータをとるためのロジックです。UWPであれば、HttpClientクラスでPostAsyncメソッドを使用します。データはJSON形式の文字列表現となるので、解析してデータに格納しています。サンプルコードではUWP標準のJSON部品を使用しています。今回使っているJsonObjectは型不定の場合に自分で解析して処理するためのものです。構造わかってるならJSONシリアライザやほかのOSSのJSONライブラリでもいいと思います。\u003cbr\u003e\n所々で出てくるasync - awaitのキーワードですが、これはC# 5.0から導入された非同期関連の機能です\u003csup id=\"fnref2\"\u003e\u003ca href=\"#fn2\" title=\"asyncはメソッドの修飾子で「非同期処理を伴っている」メソッドであることを示すものになります。この場合のメソッドも呼び出し元では非同期で処理され、戻り値はTaskクラス（戻り値なし）またはTask\u0026lt;戻り値の型\u0026gt;クラスで定義します。呼び出す場合は普通のメソッドと同じ呼び出し方をするだけで非同期で実行されます。このメソッドを呼ぶときに結果を待つ必要がある場合は呼び出し時にawait を付けます。awaitを付けると不思議なことにジェネリックで指定した型が返ってきます。注意点としてawaitを付けた処理を書いたメソッドはasync修飾子が必要になります。awaitを使えない事情がある場合（たいていUnityと連携したときに起きる）はMethodAsync().GetWaiter().GetResult()と書くと同期的に動作します。ただし、同期的に書いたときはスレッドが完全に待ち状態になりこれが仇になるパターンが多いです。非同期処理を一切使っていない自分のライブラリを非同期用に提供するようなパターンでは大丈夫そうですが、.NETの提供する非同期メソッドで同期処理書くとデッドロックっぽい動きしてる気が。。。（よく遭遇するので、同期にして異常に待ちが発生するのであれば同期処理はやめてフラグで待つなど原始的な方法に逃げたほうが幸せになるかもです）\"\u003e2\u003c/a\u003e\u003c/sup\u003e。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCognitiveTranslatorService.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e///     Translator Language Info Service Url\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eLanguageUrl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"https://dev.microsofttranslator.com/languages?\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e///     Gets speech informations that Cognitive Service API can provide.\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;returns\u0026gt;\u0026lt;see cref=\"SpeechLanguageInfo\" /\u0026gt; object list.\u0026lt;/returns\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eReadOnlyCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSpeechLanguageInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetSpeechLanguageInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSpeechLanguageInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003espeechLanguageInfos\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStringBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"api-version=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAPI_VERSION\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026amp;scope=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"speech\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ehttpClient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHttpClient\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ehttpResponseMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ehttpClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLanguageUrl\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estream\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ehttpResponseMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadAsStreamAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStreamReader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"UTF-8\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ejson\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadToEnd\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonObject\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eJsonObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003espeechLanguageInfos\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonObject\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"speech\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetObject\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSpeechLanguageInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003eLocaleId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003eLanguage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetObject\u003c/span\u003e\u003cspan class=\"p\"\u003e()[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"language\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetObject\u003c/span\u003e\u003cspan class=\"p\"\u003e()[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eReadOnlyCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSpeechLanguageInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003espeechLanguageInfos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003escopeは複数設定可能でカンマ区切りで送ればまとめてJSON形式で結果が返ります。形式は以下のようなものです。\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"speechデータの例抜粋\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#speech%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BE%8B%E6%8A%9C%E7%B2%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003espeechデータの例（抜粋）\u003c/h5\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"speech\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"ar-EG\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Arabic\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"language\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"ar\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"err\"\u003e.....\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"zh-TW\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Chinese Traditional\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"language\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"zh-Hant\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"textデータの例抜粋\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#text%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BE%8B%E6%8A%9C%E7%B2%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003etextデータの例（抜粋）\u003c/h5\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"text\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"af\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Afrikaans\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"dir\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"ltr\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"err\"\u003e.....\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"zh-Hant\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Chinese Traditional\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"dir\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"ltr\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"ttsデータの例抜粋\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tts%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BE%8B%E6%8A%9C%E7%B2%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ettsデータの例（抜粋）\u003c/h5\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"tts\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"ar-EG-Hoda\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"gender\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"female\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"locale\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"ar-G\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"languageName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Arabic\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"displayName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Hoda\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"regionName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Egypt\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"language\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"ar\"\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"err\"\u003e.....\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"zh-TW-Zhiwei\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"gender\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"male\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"locale\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"zh-TW\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"languageName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Chinese Traditional\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"displayName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Zhiwei\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"regionName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Taiwan\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"language\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"zh-Hant\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"3-translator-speech-apiとの接続\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-translator-speech-api%E3%81%A8%E3%81%AE%E6%8E%A5%E7%B6%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. translator speech APIとの接続\u003c/h4\u003e\n\n\u003cp\u003e必要な情報が集まったら、translator speech APIに接続を行います。UWPでWebSocket用に提供されているクラスは\u003ca href=\"https://msdn.microsoft.com/library/windows/apps/br226923\" rel=\"nofollow noopener\" target=\"_blank\"\u003eStreamWebSocket\u003c/a\u003eと\u003ca href=\"https://msdn.microsoft.com/library/windows/apps/br226842\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMessageWebSocket\u003c/a\u003eの２種類ありますが、今回は\u003ca href=\"https://msdn.microsoft.com/library/windows/apps/br226842\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMessageWebSocket\u003c/a\u003eクラスを使用します。\u003cbr\u003e\n使い方はすごく簡単で、インスタンス化の後初期設定を行い接続すれば完了します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCognitiveTranslatorService.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e///     Translator WebSocket Url\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eSpeechTranslateUrl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"wss://dev.microsofttranslator.com/speech/translate?\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e///     Connect to the server before sending audio\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e///     It will get the authentication credentials and add it to the header\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"from\"\u0026gt;\u0026lt;/param\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"to\"\u0026gt;\u0026lt;/param\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"voice\"\u0026gt;\u0026lt;/param\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;returns\u0026gt;\u0026lt;/returns\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003evoice\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ewebSocket\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMessageWebSocket\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ewebSocket\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetRequestHeader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Authorization\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Bearer \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ebearerToken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStringBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"from=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026amp;to=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsNullOrEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evoice\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026amp;features=texttospeech\u0026amp;voice=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evoice\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026amp;api-version=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAPI_VERSION\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\n    \u003cspan class=\"n\"\u003ewebSocket\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageReceived\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eWebSocket_MessageReceived\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// connect to the service\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ewebSocket\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnectAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eUri\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSpeechTranslateUrl\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e \n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e最初に引数なしでインスタンス化を行います。そのあとHeader情報に認証情報を付与します。これは先ほど取得した\"Bearer \"+認証トークン文字列をAuthorizationヘッダに付与するだけです。あとはAPIの接続先として\u003ca href=\"\"\u003ewss://dev.microsofttranslator.com/speech/translate\u003c/a\u003eと翻訳する言語の設定として以下のクエリを設定します。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003equery\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e必須\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e設定値\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eapi-version\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e○\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e1.0\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eto\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e○\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e翻訳元の言語(例:en)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003efrom\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e○\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e翻訳後の言語(例:ja)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003evoice\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e合成音声のID(例:ja-JP-Sayaka)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003efeatures\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003etexttospeech\u003csup id=\"fnref3\"\u003e\u003ca href=\"#fn3\" title=\"voice指定時のみ\"\u003e3\u003c/a\u003e\u003c/sup\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eなお、ヘッダ情報を書き換えできないライブラリを利用する場合は、Authヘッダの代わりにクエリとしてaccess_tokenで認証トークンを渡せば正しく処理されます（詳細は公式資料を参照）。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"4-音声データの送信\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-%E9%9F%B3%E5%A3%B0%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E4%BF%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4. 音声データの送信\u003c/h4\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"処理の実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%87%A6%E7%90%86%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e処理の実装\u003c/h5\u003e\n\n\u003cp\u003e音声データの送信については、Waveファイルを同じ形式でデータを送信します。まず最初にwaveのヘッダー情報を送信し、続いて音声データを送ります。\u003cbr\u003e\nヘッダについてはMicrosoft社のドキュメントに書いている通りです。ロジックで表現すると次のような形になります。先にも書きましたが、16000Hz,16bit,1channelでヘッダはセットしてください（送るデータもこのレートになるようにします）。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCognitiveTranslatorService.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e///     number of the wave audio channels.\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003eshort\u003c/span\u003e \u003cspan class=\"n\"\u003e_channels\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e///     number of the wave audio sample rate.\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003e_sampleRate\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e///     number of the wave audio bit per sample.\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003eshort\u003c/span\u003e \u003cspan class=\"n\"\u003e_bitsPerSample\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e///     Create a RIFF Wave Header for PCM 16bit 16kHz Mono\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;returns\u0026gt;\u0026lt;/returns\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetWaveHeader\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eextraSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eblockAlign\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eshort\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_channels\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_bitsPerSample\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eaverageBytesPerSecond\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_sampleRate\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eblockAlign\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estream\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMemoryStream\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBinaryWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RIFF\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"WAVE\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"fmt \"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e18\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eextraSize\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eshort\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_channels\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_sampleRate\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaverageBytesPerSecond\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eblockAlign\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_bitsPerSample\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eshort\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eextraSize\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"data\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eWebSocketにデータを送信する場合はMessageWebSocketクラスのOutputStreamプロパティにデータを書き込めば非同期で送信されます。書き込む毎にデータを送信するため非効率なので、定期的にこのStreamに書き込むためにバッファリングできるラッパークラスを利用します。UWPではDataWriterクラスがそれです。このクラスはWriteメソッドでデータをバッファリングし、StoreAsyncメソッドで元のStreamクラスに対してバッファリングされたデータの書き込みを実施するという便利なものです。このStoreAsyncメソッドを一定間隔で呼び出すようにタイマーで制御しておき、音声データについてはDataWriterのWriteメソッドで随時書き込めば非同期でリアルタイムにデータを送信する仕組みが実現します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCognitiveTranslatorService.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// setup the data writer\u003c/span\u003e\n\u003cspan class=\"n\"\u003edataWriter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDataWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewebSocket\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOutputStream\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003edataWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eByteOrder\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eByteOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLittleEndian\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003edataWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetWaveHeader\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//// flush the dataWriter periodically\u003c/span\u003e\n\u003cspan class=\"n\"\u003e_connectionTimer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTimer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edataWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUnstoredBufferLength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003edataWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStoreAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n         \u003cspan class=\"c1\"\u003e// reset the timer\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_connectionTimer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eChange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromMilliseconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e250\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInfiniteTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromMilliseconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e250\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInfiniteTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e          \n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eDataWriterのラッピングについてはMessageWebSocketのOutputStreamを引数に渡すだけで実現できます。定期的にバッファリングしたデータをOutputStreamに書き出すために、System.Threading.Timerクラスを使用します。このクラスは指定されたメソッドを一定時間後に一定時間間隔で実行することができます。上記の実装では250ms後に１回だけ実行するように設定しています。250ms後にs=\u0026gt;{}内の処理が呼び出されるのですが、この最後のところで、250ms後に１度実行するようにTimerクラスの再設定を行うことで250ms毎に繰り返し実行するようにしています。\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"サンプルデータの書き込み\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサンプルデータの書き込み\u003c/h5\u003e\n\n\u003cp\u003eサンプルコードには何かのWaveファイルを読み込んでサービスに書き込むロジックも記載しています。waveファイルを扱いやすくするためにNaudioライブラリを使用しています。後述の受信データの再生にもNaudioを使用しています。\u003cbr\u003e\nwaveのRAWデータを取得して、量子化ビットに合わせてサンプリング値に変換しサーバに送信しています。データは小出しに送るために適当な間隔で少しずつ送るロジックを記載しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainPage.xaml.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ewaveStream\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFileStream\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFileMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRawSourceWaveStream\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewaveStream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaveFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e16000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebytesRead\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esamplesL\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebytesRead\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBlockAlign\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWaveFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBitsPerSample\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e                    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003esamplesL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003esamplesL\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBlockAlign\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e128\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e128f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \n                    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003esamplesL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003esamplesL\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBitConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToInt16\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBlockAlign\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e32768f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e32\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003esamplesL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003esamplesL\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBitConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToSingle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBlockAlign\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e16000\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//この部分は再生するwaveに応じて変更してください。\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//サンプルでは3～4秒程度のデータを送っていました。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddSamplingData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e32000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddSamplingData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e32000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e32000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddSamplingData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e64000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e32000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddSamplingData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e96000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e96000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//無音データを意図的に送っています。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddSamplingData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"5-解析結果の受信\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-%E8%A7%A3%E6%9E%90%E7%B5%90%E6%9E%9C%E3%81%AE%E5%8F%97%E4%BF%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5. 解析結果の受信\u003c/h4\u003e\n\n\u003cp\u003eデータの送信が問題なく行われて解析が実行されると処理結果が返ってきます。合成音声での翻訳結果を受け取る場合は２回レスポンスがあります。\u003cbr\u003e\n１回目は送信データの解析結果とその翻訳後の情報がJSON形式で取得できます。２回目のデータはバイナリのwave形式の音声データとなっています。サンプルは音声データをNAudioに渡すことで音声出力しています。\u003cbr\u003e\nデータの振り分けについてはUWPのライブラリはかなり簡単です。メッセージ受信に発生するイベントのMessageWebSocketMessageReceivedEventArgsクラスにはMessageType プロパティというメッセージの種類がわかるものがあります。これでバイナリかどうか判断すればテキスト形式のデータか音声データか判別可能です。なお、ほかのWebSocket部品を利用する場合は最初の４バイトが\"RIFF\"のデータになっているかを確認すればOKです。もしRIFFなら音声データが受信できているので音声処理を行います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainPage.xaml.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// An event that indicates that a message was received on the MessageWebSocket object.\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"sender\"\u0026gt;The event source.\u0026lt;/param\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"args\"\u0026gt;The event data. If there is no event data, this parameter will be null.\u0026lt;/param\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWebSocket_MessageReceived\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageWebSocket\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMessageWebSocketMessageReceivedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOnRootMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eOnRootMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageType\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eSocketMessageType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBinary\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOnVoiceMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eOnVoiceMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOnTextMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eOnTextMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"テキストデータの取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eテキストデータの取得\u003c/h5\u003e\n\n\u003cp\u003eテキストデータについては以下のような形式でデータが返ってきます。必要な部分を取り出して利用する形です。サンプルコードは特に加工せずにデータを出力します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"err\"\u003etype:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"final\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"err\"\u003eid:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"XXXXX\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"err\"\u003erecognition:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"[理解した文章]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \n  \u003c/span\u003e\u003cspan class=\"err\"\u003etranslation:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"[理解した文章に対する翻訳データ]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"err\"\u003eaudioStreamPosition:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003exxxxx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"err\"\u003eaudioSizeBytes:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003exxxxx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"err\"\u003eaudioTimeOffset:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003exxxxx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"err\"\u003eaudioTimeSize:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003exxxxx\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"音声データの取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%9F%B3%E5%A3%B0%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e音声データの取得\u003c/h5\u003e\n\n\u003cp\u003e音声データはwaveフォーマットに従って送られてきます。ですので例えばファイルで保存すればそのまま再生できます。今回のサンプルではファイル出力なしにNaudio使って再生しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainPage.xaml.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnVoiceMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMessageWebSocketMessageReceivedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003emessageEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessageEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDataStream\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estream\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAsStreamForRead\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emStream\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMemoryStream\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e32000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebytes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebytes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebytes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTake\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efullData\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebytes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emStream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efullData\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efullData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emStream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebitsPerSampleBytes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efullData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSkip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e34\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eTake\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003echannelBytes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efullData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSkip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e22\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eTake\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esamplingBytes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efullData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSkip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e24\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eTake\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebitsPerSample\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBitConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToInt16\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebitsPerSampleBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBitConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToInt16\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003echannelBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esamplingRate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBitConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esamplingBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWasapiOutRT\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAudioClientShareMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eShared\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e250\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ewaveChannel32\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaveChannel32\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRawSourceWaveStream\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emStream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaveFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esamplingRate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebitsPerSample\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emixer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMixingSampleProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ewaveChannel32\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToSampleProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e()});\u003c/span\u003e\n\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emixer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToWaveProvider16\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePlay\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlaybackState\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ePlaybackState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlaying\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h2\u003e\n\n\u003cp\u003eTranslator Speech APIの仕組みがまだあまり情報としてないので、分量は多くなりましたが何かの参考になれば幸いです。基本的にはこのUWPのライブラリを使いHoloLensのマイクからリアルタイムで集音した音声データをTranslator Speech APIに送信し、結果を文字でHoloLensに表示することで今回のものは実現しています。また、ライブラリ自体は使いまわせるはずなのでいろいろなアプリにも組み込めると思います。\u003cbr\u003e\nその2ではHoloLensからリアルタイムで音声を集音する方法を書きたいと思います。\u003cbr\u003e\nほんとはその2でHoloLensで実装にするつもりでしたが、おそらく音声のリアルタイム集音はそれだけで何かに使える可能性が高いので別途整理したいなと思った次第です。\u003c/p\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003eVisual Studio 2015 update 3 Community EditionでUWPのプロジェクトを作成するとMicrosoft.NETCore.UniversalWindowsPlatformのバージョンは5.2.3です。 \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn2\"\u003e\n\u003cp\u003easyncはメソッドの修飾子で「非同期処理を伴っている」メソッドであることを示すものになります。この場合のメソッドも呼び出し元では非同期で処理され、戻り値はTaskクラス（戻り値なし）またはTask\u0026lt;戻り値の型\u0026gt;クラスで定義します。呼び出す場合は普通のメソッドと同じ呼び出し方をするだけで非同期で実行されます。このメソッドを呼ぶときに結果を待つ必要がある場合は呼び出し時にawait を付けます。awaitを付けると不思議なことにジェネリックで指定した型が返ってきます。注意点としてawaitを付けた処理を書いたメソッドはasync修飾子が必要になります。awaitを使えない事情がある場合（たいていUnityと連携したときに起きる）はMethodAsync().GetWaiter().GetResult()と書くと同期的に動作します。ただし、同期的に書いたときはスレッドが完全に待ち状態になりこれが仇になるパターンが多いです。非同期処理を一切使っていない自分のライブラリを非同期用に提供するようなパターンでは大丈夫そうですが、.NETの提供する非同期メソッドで同期処理書くとデッドロックっぽい動きしてる気が。。。（よく遭遇するので、同期にして異常に待ちが発生するのであれば同期処理はやめてフラグで待つなど原始的な方法に逃げたほうが幸せになるかもです） \u003ca href=\"#fnref2\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn3\"\u003e\n\u003cp\u003evoice指定時のみ \u003ca href=\"#fnref3\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","createdAt":"2017-05-06T14:04:04Z","elapsedYearsFromLastModifiedAt":4,"encryptedId":"RLZOsAldCm+QdtTqWXcTMBuU8/TVbNBb--b9JwrE8htg5foOua--P/AuGynGNYUPiCwhyQK4TA==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2017-06-02T09:20:31Z","likesCount":19,"linkUrl":"https://qiita.com/miyaura/items/febee8ca6f9050c9ff26","organization":null,"originalId":490841,"stockedCount":16,"title":"HoloLensでTranslator Speech APIを使ったリアルタイム翻訳-その１Translator Speech APIの使い方","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#translator-speech-api%E3%81%AE%E7%99%96%E3%81%AE%E5%BC%B7%E3%81%95\"\u003eTranslator Speech APIの癖の強さ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#translator-speech-api%E3%81%A8%E3%81%AF\"\u003eTranslator Speech APIとは\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%88%A9%E7%94%A8%E6%96%99%E9%87%91\"\u003e利用料金\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#f0%E7%84%A1%E6%96%99\"\u003eF0:無料\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#s0%E5%BE%93%E9%87%8F%E8%AA%B2%E9%87%91\"\u003eS0:従量課金\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#translator-speech-api%E3%81%AE%E4%BB%95%E6%A7%98\"\u003eTranslator Speech APIの仕様\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%BF%BB%E8%A8%B3%E3%81%A7%E3%81%8D%E3%82%8B%E8%A8%80%E8%AA%9E\"\u003e翻訳できる言語\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#api%E3%81%AE%E4%BB%95%E6%A7%98\"\u003eAPIの仕様\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%93%E3%81%AEapi%E3%81%AF%E3%82%B9%E3%83%88%E3%83%AA%E3%83%BC%E3%83%9F%E3%83%B3%E3%82%B0%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%A7%E3%81%99\"\u003eこのAPIはストリーミングサービスです。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E3%82%8A%E6%96%B9\"\u003eデータの送り方\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%80%81%E4%BF%A1%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%BF%BB%E8%A8%B3%E5%8D%98%E4%BD%8D\"\u003e送信データの翻訳単位\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%97%E4%BF%A1\"\u003eデータの受信\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%BF%E3%81%84%E6%96%B9\"\u003e使い方\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%92%B0%E5%A2%83%E3%81%9D%E3%81%AE%E4%BB%96\"\u003e環境その他\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%87%A6%E7%90%86%E3%81%AE%E6%B5%81%E3%82%8C\"\u003e処理の流れ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1-token-service%E3%81%ABsubscriptionkey%E3%82%92%E9%80%81%E3%82%8A%E8%AA%8D%E8%A8%BC%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\"\u003e1. Token ServiceにsubscriptionKeyを送り認証トークンを取得する。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E8%A8%80%E8%AA%9E%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e2. サポート言語の取得\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#speech%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BE%8B%E6%8A%9C%E7%B2%8B\"\u003espeechデータの例（抜粋）\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#text%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BE%8B%E6%8A%9C%E7%B2%8B\"\u003etextデータの例（抜粋）\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#tts%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BE%8B%E6%8A%9C%E7%B2%8B\"\u003ettsデータの例（抜粋）\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3-translator-speech-api%E3%81%A8%E3%81%AE%E6%8E%A5%E7%B6%9A\"\u003e3. translator speech APIとの接続\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4-%E9%9F%B3%E5%A3%B0%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E4%BF%A1\"\u003e4. 音声データの送信\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%87%A6%E7%90%86%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e処理の実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF\"\u003eサンプルデータの書き込み\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#5-%E8%A7%A3%E6%9E%90%E7%B5%90%E6%9E%9C%E3%81%AE%E5%8F%97%E4%BF%A1\"\u003e5. 解析結果の受信\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%96%E5%BE%97\"\u003eテキストデータの取得\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%9F%B3%E5%A3%B0%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e音声データの取得\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e最後に\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":7356,"uuid":"febee8ca6f9050c9ff26","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"YlVWeF8+eS9rNMuxMoEEq78ZOp4J--JW+6R0ajWx3RATIO--wgWdF1xOr0ThMrtd8Yo5fQ==","originalId":152548,"description":"C#ベース。現在はMR関連の技術に興味あり。\r\nMicrosoft MVP for Windows Development(2018-2022)","facebookUrl":null,"githubUrl":"https://github.com/TakahiroMiyaura","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"Miyaura","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/152548/profile-images/1616018241","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F152548%2Fprofile-images%2F1616018241?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=c58087e984e4d654f6504a1c34bd6a30","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F152548%2Fprofile-images%2F1616018241?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=61c4f9412b9ce18c58a30ab1b3cc989e","urlName":"miyaura","websiteUrl":"","twitterUrl":"https://twitter.com/takabrz1","twitterUrlName":"takabrz1","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Unity","urlName":"unity"},{"name":"VisualStudio2015","urlName":"visualstudio2015"},{"name":"HoloLens","urlName":"hololens"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

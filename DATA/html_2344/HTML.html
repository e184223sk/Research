<!DOCTYPE html><html><head><meta charset="utf-8" /><title>【ハンズオン】UniNativeLinqで学ぶGitHub Actions【Mono.Cecil】 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/pCYSl5EDgo/items/cc5cc080dea1cc076b25" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="Itip6kIWai2nuqm3931W+8HFi6JBlt4bP5A/5YUqTRJhLOpIiYlGFsaIpH6yFU6CcWAhhCXBpUsrOt1Lv0YgJQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@pCYSl5EDgo" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="【ハンズオン】UniNativeLinqで学ぶGitHub Actions【Mono.Cecil】 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRNDRPUDQ0T3o0NEs2NDRLcTQ0T3o0NENSVlc1cFRtRjBhWFpsVEdsdWNlT0JwLVd0cHVPQnRrZHBkRWgxWWlCQlkzUnBiMjV6NDRDUVRXOXVieTVEWldOcGJPT0FrUSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1jMzAyNGYyN2ZjYmZjZjVlMWQ1YTJhOThhNDlkMDU3YQ&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSEJEV1ZOc05VVkVaMjgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01YmYwNDcwNjQ5YzY4NDM0OWU3ZDUxNDM3ODg5MWUzNQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=d77284d2845a2995a61c80cadbdbb0ec"><meta property="og:description" content="この記事はUnity Advent Calendar 2019の第1日目の記事です。


ハンズオンの目標


Mono.Cecilの使い方に慣れる
LINQの内部実装についての初歩の理解を得る
マネージドプラグイン開発に慣れる
Gi..."><meta content="https://qiita.com/pCYSl5EDgo/items/cc5cc080dea1cc076b25" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="GitHub,C#,LINQ,Unity,GitHubActions" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-c8a9c1f7-7623-4201-bafa-7f4ae54024ca"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2FpCYSl5EDgo%2Fitems%2Fcc5cc080dea1cc076b25">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2FpCYSl5EDgo%2Fitems%2Fcc5cc080dea1cc076b25">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-c8a9c1f7-7623-4201-bafa-7f4ae54024ca">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/github","name":"GitHub"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-11-30T23:55:08.000+09:00","dateModified":"2019-11-30T23:55:08.000+09:00","headline":"【ハンズオン】UniNativeLinqで学ぶGitHub Actions【Mono.Cecil】","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRNDRPUDQ0T3o0NEs2NDRLcTQ0T3o0NENSVlc1cFRtRjBhWFpsVEdsdWNlT0JwLVd0cHVPQnRrZHBkRWgxWWlCQlkzUnBiMjV6NDRDUVRXOXVieTVEWldOcGJPT0FrUSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1jMzAyNGYyN2ZjYmZjZjVlMWQ1YTJhOThhNDlkMDU3YQ\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSEJEV1ZOc05VVkVaMjgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01YmYwNDcwNjQ5YzY4NDM0OWU3ZDUxNDM3ODg5MWUzNQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=d77284d2845a2995a61c80cadbdbb0ec","mainEntityOfPage":"https://qiita.com/pCYSl5EDgo/items/cc5cc080dea1cc076b25","author":{"@type":"Person","address":"","email":"pcysl5edgo@yahoo.co.jp","identifier":"pCYSl5EDgo","name":"pCYSl5EDgo","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2Fprofile-images%2F1546351264?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=c5789bc76dd49b92c1ddc68bc158b06b","url":"https://qiita.com/pCYSl5EDgo","description":"C#!好き!!（語彙不足）\r\nUnityやヴァーレントゥーガ関連の投稿をしていく予定です。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202106-uzabase-3/">経済情報で世界を変えていけているユーザベースの可能性</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202106-uzabase-3/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"pCYSl5EDgo","type":"items","id":"cc5cc080dea1cc076b25"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"経済情報で世界を変えていけているユーザベースの可能性","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"pCYSl5EDgo","type":"items","id":"cc5cc080dea1cc076b25"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"経済情報で世界を変えていけているユーザベースの可能性","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"pCYSl5EDgo","type":"items","id":"cc5cc080dea1cc076b25"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"経済情報で世界を変えていけているユーザベースの可能性","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/pCYSl5EDgo/items/cc5cc080dea1cc076b25","location":"/pCYSl5EDgo/items/cc5cc080dea1cc076b25","scheme":"https","host":"qiita.com","port":null,"pathname":"/pCYSl5EDgo/items/cc5cc080dea1cc076b25","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"x6rY7h3xJkKvS3/dNVddBFrinVPHNd5hidk3Erv/djqEXptM1m4Kec55chRwP0V96kc3daNipTGdc9W8gZMbDQ==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-bcd696ca-5945-4653-adb8-6b2f9c70fe0e"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/pCYSl5EDgo/items/cc5cc080dea1cc076b25/likers" class="css-1iupg5d">11</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">6</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/cc5cc080dea1cc076b25/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/pCYSl5EDgo/items/cc5cc080dea1cc076b25/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/pCYSl5EDgo/items/cc5cc080dea1cc076b25/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/pCYSl5EDgo/items/cc5cc080dea1cc076b25/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/pCYSl5EDgo/items/cc5cc080dea1cc076b25.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><span><a href="/advent-calendar/2019/unity" class="it-AdcalRibbon_title">Unity<!-- --> Advent Calendar<!-- --> <!-- -->2019</a>Day 1</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/pCYSl5EDgo"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/256047/profile-images/1546351264" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/pCYSl5EDgo" class="css-10ougpm">@<!-- -->pCYSl5EDgo</a><div class="css-1ay9vb9"><time dateTime="2019-11-30T14:55:08Z" class="css-m19uds">posted at 2019-11-30</time></div></div></div></div></div><h1 class="css-cgzq40">【ハンズオン】UniNativeLinqで学ぶGitHub Actions【Mono.Cecil】</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/github" class="css-4czcte">GitHub</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/linq" class="css-4czcte">LINQ</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/githubactions" class="css-4czcte">GitHubActions</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>この記事は<a href="https://qiita.com/advent-calendar/2019/unity">Unity Advent Calendar 2019</a>の第1日目の記事です。</p>

<h1>
<span id="ハンズオンの目標" class="fragment"></span><a href="#%E3%83%8F%E3%83%B3%E3%82%BA%E3%82%AA%E3%83%B3%E3%81%AE%E7%9B%AE%E6%A8%99"><i class="fa fa-link"></i></a>ハンズオンの目標</h1>

<ul>
<li>Mono.Cecilの使い方に慣れる</li>
<li>LINQの内部実装についての初歩の理解を得る</li>
<li>マネージドプラグイン開発に慣れる</li>
<li>GitHub Actionsに慣れる</li>
<li>UniNativeLinqのファンになる</li>
</ul>

<p>LINQについては結構資料がありますので、主にMono.CecilとGitHub Actionsについてこの記事で学んでいただければと思います。</p>

<h1>
<span id="筆者の開発環境" class="fragment"></span><a href="#%E7%AD%86%E8%80%85%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>筆者の開発環境</h1>

<ul>
<li>Windows10 Home </li>
<li>Intel Core i7-8750H</li>
<li>RAM 16GB</li>
<li>Unity

<ul>
<li>2018.4.9f1</li>
</ul>
</li>
<li>.NET Core 3.0

<ul>
<li>3.0.101</li>
</ul>
</li>
<li>Visual Studio 2019

<ul>
<li>16.4.0 Preview2.0</li>
</ul>
</li>
<li>Git

<ul>
<li>2.24.0.windows.2</li>
</ul>
</li>
<li>Rider 2019.3 EAP</li>
</ul>

<h1>
<span id="前提知識" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90%E7%9F%A5%E8%AD%98"><i class="fa fa-link"></i></a>前提知識</h1>

<ul>
<li>C#

<ul>
<li>値型、参照型の違いとパフォーマンス特性への理解　<a href="https://ufcpp.net/study/csharp/oo_reference.html" rel="nofollow noopener" target="_blank">参考文献：C# によるプログラミング入門  [メモリとリソース管理] 値型と参照型</a>
</li>
<li>foreachとそのコンパイラによる展開、特にパターンベースであることの理解　<a href="https://ufcpp.net/study/csharp/sp_foreach.html" rel="nofollow noopener" target="_blank">参考文献：C# によるプログラミング入門  [データ列処理] foreach</a>
</li>
<li>LINQのAPIに対する理解　<a href="https://ufcpp.net/study/csharp/sp3_linq.html" rel="nofollow noopener" target="_blank">参考文献：C# によるプログラミング入門  [データ列処理] LINQ</a>
</li>
</ul>
</li>
<li>IL

<ul>
<li>C#のコードがIL(Intermediate Language)の集合にコンパイルされるということへの理解　<a href="https://ja.wikipedia.org/wiki/%E5%85%B1%E9%80%9A%E4%B8%AD%E9%96%93%E8%A8%80%E8%AA%9E" rel="nofollow noopener" target="_blank">参考文献：ILに関するWikipedia記事</a>
</li>
<li>各命令についてわからないことがあれば<a href="https://docs.microsoft.com/ja-jp/dotnet/api/system.reflection.emit.opcodes?view=netframework-4.8" rel="nofollow noopener" target="_blank">MSDocsのOpCodesクラスの説明を読むのが良いでしょう</a>
</li>
</ul>
</li>
<li>Unity

<ul>
<li>Unity2018でC#7.3の機能が使えるということの理解　<a href="https://blogs.unity3d.com/jp/2018/12/13/introducing-unity-2018-3/" rel="nofollow noopener" target="_blank">参考文献：Unity公式ブログより「Unity 2018.3 リリース」</a>
</li>
<li>Unity2018からUnity.Collections.NativeArray&lt;T&gt;というアンマネージドなヒープやスタック上の連続したメモリ領域を表す配列的構造体についての理解</li>
<li><a href="https://docs.unity3d.com/ScriptReference/Unity.Collections.NativeArray_1.html" rel="nofollow noopener" target="_blank">参考文献1：UnityのScriptingリファレンスのNativeArrayに関するページ</a></li>
<li><a href="https://www.urablog.xyz/entry/2018/03/24/140423" rel="nofollow noopener" target="_blank">参考文献2：【Unity】アセット読書会に行ってきたよ。NativeArrayってなんだろう？</a></li>
<li>Unity.Collections.UnsafeUtilityというstatic classがNativeArrayの基礎であることへの理解　<a href="https://qiita.com/mao_/items/fc9b4340b05e7e83c3ff" id="reference-db20c6b21011523db266">参考文献：【Unity】UnsafeUtilityについて纏めてみる</a>
</li>
<li>UnsafeUtilityの詳細なAPIとその機能についての理解</li>
<li><a href="https://qiita.com/pCYSl5EDgo/items/4b5a5e089eabc8f4387d" id="reference-ef44d37c52693017fd3c">参考文献1：【Unity】UnsafeUtility基礎論【入門者向け】</a></li>
<li><a href="https://docs.unity3d.com/ScriptReference/Unity.Collections.LowLevel.Unsafe.UnsafeUtility.html" rel="nofollow noopener" target="_blank">参考文献2：UnityのScriptingリファレンスのUnsafeUtilityに関するページ</a></li>
</ul>
</li>
<li>GitHub Actions

<ul>
<li>GitHubに統合されたCI/CDサービスであることの理解　<a href="https://help.github.com/ja/actions/automating-your-workflow-with-github-actions/about-github-actions" rel="nofollow noopener" target="_blank">参考文献：GitHub Actionsについて</a>
</li>
</ul>
</li>
<li>UniNativeLinq

<ul>
<li>NativeArray&lt;T&gt;向けのLINQライブラリであることの理解　<a href="https://speakerdeck.com/pcysl5edgo/uninativelinq-unity2018shi-dai-falsenativearrayyong-linq" rel="nofollow noopener" target="_blank">参考文献：UniNativeLinqに関して</a>
</li>
</ul>
</li>
</ul>

<h1>
<span id="事前にハンズオンを行う人がインストールしておくべきもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E3%81%AB%E3%83%8F%E3%83%B3%E3%82%BA%E3%82%AA%E3%83%B3%E3%82%92%E8%A1%8C%E3%81%86%E4%BA%BA%E3%81%8C%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%97%E3%81%A6%E3%81%8A%E3%81%8F%E3%81%B9%E3%81%8D%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前にハンズオンを行う人がインストールしておくべきもの</h1>

<ul>
<li>Unity2018.4

<ul>
<li>Unityのバージョンについては2018.4系列である限りなんでもよいです。適宜読み替えを行ってください。</li>
</ul>
</li>
<li>.NET Core 3.0</li>
<li>Visual Studio2019またはRider2019.2以上</li>
<li>Git</li>
</ul>

<h1>
<span id="第0章準備" class="fragment"></span><a href="#%E7%AC%AC0%E7%AB%A0%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>第0章　準備</h1>

<h2>
<span id="パス通し" class="fragment"></span><a href="#%E3%83%91%E3%82%B9%E9%80%9A%E3%81%97"><i class="fa fa-link"></i></a>パス通し</h2>

<p>以後ターミナル操作はPowerShell上で行います。</p>

<p>まずUnity2018.4の実体のあるパスを追加します。<br>
私は"コントロール パネル\システムとセキュリティ\システム\システムの詳細設定\環境変数\Path"に"C:\Users\conve\Documents\Unity\Editor"と追加していますが、環境変数を汚したくない方は都度下のように書いてパスを通すのが良いのではないでしょうか。</p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nv">$</span><span class="nn">Env</span><span class="p">:</span><span class="nv">Path</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">";C:\Program Files\Unity\Hub\Editor\2018.4.13f1\Editor"</span><span class="w">
</span></code></pre></div>
</div>

<h2>
<span id="作業ディレクトリ" class="fragment"></span><a href="#%E4%BD%9C%E6%A5%AD%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA"><i class="fa fa-link"></i></a>作業ディレクトリ</h2>

<p>適当なディレクトリの下に新規に作業ディレクトリを作成します。<br>
今回はUniNativeLinqHandsOnという名前にしましょう。</p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">mkdir</span><span class="w"> </span><span class="nx">UniNativeLinqHandsOn</span><span class="w">
</span></code></pre></div>
</div>

<p>前節で正常にパスが通っているならば次のシェルコマンドを実行してUnityエディタが起動するはずです。</p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">unity</span><span class="w"> </span><span class="nt">-createProject</span><span class="w"> </span><span class="o">.</span><span class="nx">/UniNativeLinqHandsOn/</span><span class="w">
</span></code></pre></div>
</div>

<p>起動して図のようにエディタが正常に起動しましたか？<br>
<a href="https://camo.qiitausercontent.com/9cc6677a71805173ea1de05c9f838099677820ec/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235363034372f33373232643963662d323063352d376630612d346234622d3535326534323566353636372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2F3722d9cf-20c5-7f0a-4b4b-552e425f5667.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=deb50b363159eaef7a785590650bf584" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/256047/3722d9cf-20c5-7f0a-4b4b-552e425f5667.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2F3722d9cf-20c5-7f0a-4b4b-552e425f5667.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b5c09f3f607e3e2e1034760da00ca49e 1x" loading="lazy"></a></p>

<p>では、一旦エディタを閉じましょう。</p>

<h2>
<span id="git初期化" class="fragment"></span><a href="#git%E5%88%9D%E6%9C%9F%E5%8C%96"><i class="fa fa-link"></i></a>Git初期化</h2>

<p>GitHub Actionsを使う兼ね合いもあり、Gitのリポジトリを用意しましょう。</p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">cd</span><span class="w"> </span><span class="nx">UniNativeLinqHandsOn</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">init</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="p">[</span><span class="n">Ll</span><span class="p">]</span><span class="nx">ibrary/</span><span class="w"> </span><span class="p">[</span><span class="n">Ll</span><span class="p">]</span><span class="nx">ogs/</span><span class="w"> </span><span class="p">[</span><span class="n">Oo</span><span class="p">]</span><span class="nx">bj/</span><span class="w"> </span><span class="o">.</span><span class="nf">idea</span><span class="nx">/</span><span class="w"> </span><span class="o">.</span><span class="nf">vs</span><span class="nx">/</span><span class="w"> </span><span class="o">.</span><span class="nf">vscode</span><span class="nx">/</span><span class="w"> </span><span class="nx">/</span><span class="o">*.</span><span class="nf">csproj</span><span class="w"> </span><span class="nx">/</span><span class="o">*.</span><span class="nf">sln</span><span class="w"> </span><span class="nx">/</span><span class="o">*.</span><span class="nf">sln</span><span class="o">.</span><span class="nf">user</span><span class="w"> </span><span class="nx">/TestResults-</span><span class="o">*.</span><span class="nf">xml</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="o">.</span><span class="nf">gitignore</span><span class="w">
</span></code></pre></div>
</div>

<h2>
<span id="マネージドプラグインの下拵え" class="fragment"></span><a href="#%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%89%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E4%B8%8B%E6%8B%B5%E3%81%88"><i class="fa fa-link"></i></a>マネージドプラグインの下拵え</h2>

<p>これからUniNativeLinqの基礎となるNativeEnumerable&lt;T&gt; where T : unmanagedを実装します。<br>
マネージドプラグインとしてUnity外でDLLをビルドしますので、フォルダを作りましょう。フォルダ名は"core~"とします。</p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">mkdir</span><span class="w"> </span><span class="nx">core~</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="nx">core~</span><span class="w">
</span></code></pre></div>
</div>

<p>DLLを作るためにdotnet newコマンドでclasslib（ライブラリ作成）オプションを指定して初期化します。<br>
Class1.csは特に要らないので削除します。<br>
追加で.gitignoreをこのフォルダにも定義します。</p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">dotnet</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">classlib</span><span class="w">
</span><span class="n">del</span><span class="w"> </span><span class="nx">Class1.cs</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="nx">bin/</span><span class="w"> </span><span class="nx">obj/</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="o">.</span><span class="nf">gitignore</span><span class="w">
</span></code></pre></div>
</div>

<p>次にcore~.csprojを編集します。<br>
初期状態では以下のように記述されているはずです。</p>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">core~.csproj</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>netstandard2.0<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;RootNamespace&gt;</span>core_<span class="nt">&lt;/RootNamespace&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>

<span class="nt">&lt;/Project&gt;</span>
</code></pre></div>
</div>

<p><details><summary>csprojの各要素の軽い解説</summary><br>
<div>Unity使いの方はcsprojファイルの中身をこれまで読んだ時に物凄く長くて冗長な記述を見てきたことでしょう。 そもそもcsprojの中身を読まない？　アッ、ハイ<br>
Visual Studio 2017の頃からcsprojの新しい形式としてSdk形式というものが登場しました。 <a href="https://ufcpp.net/blog/2017/5/newcsproj/" rel="nofollow noopener" target="_blank">参考文献：ufcppのブログ記事</a><br>
全てを設定していた従来のものよりも、デフォルト値と異なる点のみ設定するSdk形式の方が非常に記述量が少なく可読性が高いですね。<br>
<code>&amp;lt;Project Sdk=&amp;quot;Microsoft.NET.Sdk&amp;quot;&amp;gt;</code>というトップレベルのProject要素にSdk属性が定義されている場合Sdk形式となります。

<p>PropertyGroup要素以下に基本設定を記述します。<br>
TargetFarmework要素にビルド対象のプラットフォーム/フレームワークを指定します。<br>
Unity2018以上で使うことを考え、.NET Standard 2.0を意味するnetstandard2.0を指定しておきます。</p>

<p>RootNamespace要素はVisual Studioで新規にcsファイルを作成する時に使用される名前空間を指定します。<br>
</p>
</div>
<br>
</details></p>

<p>上記csprojを編集して以下の通りにします。</p>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">core~.csproj</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>netstandard2.0<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;RootNamespace&gt;</span>UniNativeLinq<span class="nt">&lt;/RootNamespace&gt;</span>
    <span class="nt">&lt;AllowUnsafeBlocks&gt;</span>True<span class="nt">&lt;/AllowUnsafeBlocks&gt;</span>
    <span class="nt">&lt;AssemblyName&gt;</span>UniNativeLinq<span class="nt">&lt;/AssemblyName&gt;</span>
    <span class="nt">&lt;LangVersion&gt;</span>8<span class="nt">&lt;/LangVersion&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;Reference</span> <span class="na">Include=</span><span class="s">"UnityEngine.CoreModule"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;HintPath&gt;</span>○Unityのインストールしてあるフォルダ○\Editor\Data\Managed\UnityEngine\UnityEngine.CoreModule.dll<span class="nt">&lt;/HintPath&gt;</span>
    <span class="nt">&lt;/Reference&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>
<span class="nt">&lt;/Project&gt;</span>
</code></pre></div>
</div>

<p>AllowUnsafeBlocks要素をTrueにしてポインタを使用可能にします。<br>
AssemblyName要素によりアセンブリ名と出力されたDllファイルの名前を指定します。<br>
そして、LangVersion要素を8に指定してunmanaged型制約の判定を緩めます。　<a href="https://ufcpp.net/study/csharp/sp_unsafe.html#unmanaged-generic-struct" rel="nofollow noopener" target="_blank">参考文献：アンマネージな総称型に関するunmanaged型制約</a></p>

<p>最後に、ItemGroup/Reference要素でUnityEngine.CoreModule.dllを参照に追加しましょう。<br>
Unityのランタイムで使用される基本的な機能はUnityEngine.CoreModule.dllを通じて提供されています。</p>

<p>以上で最初の下拵えを終わります。</p>

<h1>
<span id="第1章uninativelinq-coreの最低限の実装1" class="fragment"></span><a href="#%E7%AC%AC1%E7%AB%A0uninativelinq-core%E3%81%AE%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AE%E5%AE%9F%E8%A3%851"><i class="fa fa-link"></i></a>第1章　UniNativeLinq-Coreの最低限の実装(1)</h1>

<p>現在の作業ディレクトリが"UniNativeLinqHandsOn/core~"であることを確認してください。</p>

<p>これから私達は以下のファイル群を作成し、UniNativeLinqのコア機能を最低限の形で実装していきます。</p>

<ul>
<li>NativeEnumerable.cs

<ul>
<li>NativeEnumerable&lt;T&gt;構造体を定義します。</li>
<li>NativeArray&lt;T&gt;に対してSpan&lt;T&gt;的な役割を果たす基本的な構造体です。</li>
<li>IRefEnumerable&lt;T&gt;を実装します。</li>
</ul>
</li>
<li>IRefEnumerable.cs

<ul>
<li>System.Collections.IEnumerable&lt;T&gt;を継承したIRefEnumerable&lt;TEnumerator, T&gt;インターフェイスを定義します。</li>
<li>通常のIEnumerable&lt;T&gt;の型引数が1つであるのに対して、IRefEnumerable&lt;TEnumerator, T&gt;の型引数が2つであるのは、構造体イテレータのボクシングを避ける目的があります。</li>
</ul>
</li>
<li>IRefEnumerator.cs

<ul>
<li>System.Collections.IEnumerator&lt;T&gt;を継承したIRefEnumerator&lt;T&gt;インターフェイスを定義します。</li>
<li>foreach(ref var item in collection)のような参照をイテレーションするための種々の操作を定義します。</li>
</ul>
</li>
<li>AsRefEnumerable.cs

<ul>
<li>NativeEnumerable静的クラスを定義します。</li>
<li>NativeEnumerable&lt;T&gt;構造体と名前がほぼ同じですが別物です。</li>
<li>NativeArray&lt;T&gt;とT[]に対して拡張メソッドを定義します。</li>
</ul>
</li>
</ul>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">mkdir</span><span class="w"> </span><span class="nx">Collection</span><span class="w">
</span><span class="n">mkdir</span><span class="w"> </span><span class="nx">Interface</span><span class="w">
</span><span class="n">mkdir</span><span class="w"> </span><span class="nx">Utility</span><span class="w">
</span><span class="n">mkdir</span><span class="w"> </span><span class="nx">API</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">Collection/NativeEnumerable.cs</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">Interface/IRefEnumerator.cs</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">Interface/IRefEnumerable.cs</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">API/AsRefEnumerable.cs</span><span class="w">
</span></code></pre></div>
</div>

<h2>
<span id="nativeenumerabletの最初の定義" class="fragment"></span><a href="#nativeenumerablet%E3%81%AE%E6%9C%80%E5%88%9D%E3%81%AE%E5%AE%9A%E7%BE%A9"><i class="fa fa-link"></i></a>NativeEnumerable&lt;T&gt;の最初の定義</h2>

<p><details><summary>最初のNativeEnumerable.cs</summary><div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NativeEnumerable.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">UniNativeLinq</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">readonly</span> <span class="k">unsafe</span> <span class="k">struct</span> <span class="nc">NativeEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
    <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="n">unmanaged</span>
  <span class="p">{</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">T</span><span class="p">*</span> <span class="n">Ptr</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="kt">long</span> <span class="n">Length</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">NativeEnumerable</span><span class="p">(</span><span class="n">T</span><span class="p">*</span> <span class="n">ptr</span><span class="p">,</span> <span class="kt">long</span> <span class="n">length</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ptr</span> <span class="p">==</span> <span class="k">default</span> <span class="p">||</span> <span class="n">length</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">Ptr</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
        <span class="n">Length</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">Ptr</span> <span class="p">=</span> <span class="n">ptr</span><span class="p">;</span>
      <span class="n">Length</span> <span class="p">=</span> <span class="n">length</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">ref</span> <span class="n">T</span> <span class="k">this</span><span class="p">[</span><span class="kt">long</span> <span class="n">index</span><span class="p">]</span> <span class="p">=&gt;</span> <span class="k">ref</span> <span class="n">Ptr</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p></p>
</div></details></p>

<p>unsafeでreadonlyな構造体UniNativeLinq.NativeEnumerable&lt;T&gt;を定義します。<br>
これはジェネリックなTのポインタであるPtrと要素数であるLengthフィールドを露出させています。<br>
nullポインタやダングリングポインタに対する安全性保証は一切ないので、その辺りはエンドユーザーに一切合切投げっぱなしになるC++スタイルです。</p>

<p>これをビルドし、テストコードをUnityの方で実行してみましょう。</p>

<h2>
<span id="最低限のテスト" class="fragment"></span><a href="#%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>最低限のテスト</h2>

<p>現在のワーキングディレクトリは"UniNativeLinqHandsOn/core~"のはずです。<br>
以下のようにAssets以下Plugins/UNLフォルダを作成し、core~のビルド成果物であるUniNativeLinq.dllをコピーして配置します。</p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">mkdir</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="o">..</span><span class="nx">/Assets/Plugins/UNL</span><span class="w">
</span><span class="n">dotnet</span><span class="w"> </span><span class="nx">build</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="nx">Release</span><span class="w">
</span><span class="n">cp</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="o">.</span><span class="nx">/bin/Release/netstandard2.0/UniNativeLinq.dll</span><span class="w"> </span><span class="o">..</span><span class="nx">/Assets/Plugins/UNL/UniNativeLinq.dll</span><span class="w">
</span></code></pre></div>
</div>

<p>ビルドした後毎回"cp -Force ほげほげ"と入力するのも面倒ですので、core~.csprojにビルド後イベントを定義して自動化します。</p>

<p><details><summary>ビルド後イベントでコピーを自動化したcsproj</summary><div>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">core.csproj</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>netstandard2.0<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;RootNamespace&gt;</span>UniNativeLinq<span class="nt">&lt;/RootNamespace&gt;</span>
    <span class="nt">&lt;AllowUnsafeBlocks&gt;</span>True<span class="nt">&lt;/AllowUnsafeBlocks&gt;</span>
    <span class="nt">&lt;LangVersion&gt;</span>8<span class="nt">&lt;/LangVersion&gt;</span>
    <span class="nt">&lt;AssemblyName&gt;</span>UniNativeLinq<span class="nt">&lt;/AssemblyName&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;Reference</span> <span class="na">Include=</span><span class="s">"UnityEngine.CoreModule"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;HintPath&gt;</span>○Unityのインストールしてあるフォルダ○\Editor\Data\Managed\UnityEngine\UnityEngine.CoreModule.dll<span class="nt">&lt;/HintPath&gt;</span>
    <span class="nt">&lt;/Reference&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

  <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"PostBuild"</span> <span class="na">AfterTargets=</span><span class="s">"PostBuildEvent"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">"copy $(TargetPath) $(ProjectDir)..\Assets\Plugins\UNL\UniNativeLinq.dll"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Target&gt;</span>
<span class="nt">&lt;/Project&gt;</span>
</code></pre></div>
</div>

<p></p>
</div></details></p>

<p>ビルド後イベントでローカルデプロイの自動化は結構重宝しますのでオススメです。</p>

<p>さて、Assets/Plugins/UNL以下にdllを配置しましたので、それを対象としたテストコードを書きましょう。</p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">cd</span><span class="w"> </span><span class="o">..</span><span class="w">
</span><span class="n">unity</span><span class="w"> </span><span class="nt">-projectPath</span><span class="w"> </span><span class="o">.</span><span class="w">
</span></code></pre></div>
</div>

<p>エディタが起動しましたね？<br>
ProjectタブのAssetsを選択してコンテキストメニューから"Create/Testing/Tests Assembly Folder"を選択してTestsフォルダーを作成してください。<br>
<a href="https://camo.qiitausercontent.com/710865b533422d45b9ccf617be712f7f1c210060/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235363034372f65656537333533382d306433642d323737312d333538352d6265313738356138376439662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2Feee73538-0d3d-2771-3585-be1785a87d9f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4790d961781f095b93a606e33ec84085" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/256047/eee73538-0d3d-2771-3585-be1785a87d9f.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2Feee73538-0d3d-2771-3585-be1785a87d9f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=22373a01703565e9475335dde2482462 1x" loading="lazy"></a></p>

<p>無事にTestsフォルダが作成されたならばそのフォルダ以下にTests.asmdefファイルがあるはずです。<br>
それを選択し、Inspectorタブから設定を変更します。<br>
"Allow 'unsafe' Code"と"Override References"にチェックを入れ、"Assembly References"に"UniNativeLinq.dll"を加えてください。<br>
そしてPlatformsをEditorだけにしてください。<br>
次の画像のようなInspectorになるはずです。正しく設定できたならば一番下のApplyボタンを押して設定を保存してください。<br>
<a href="https://camo.qiitausercontent.com/f6695e988bb2b6bad0a18687905c003e9b12724e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235363034372f64666666616665332d626166642d656666362d616433382d3361333631396138306337332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2Fdfffafe3-bafd-eff6-ad38-3a3619a80c73.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f702eed7748092c220ae19e2de6e78d8" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/256047/dfffafe3-bafd-eff6-ad38-3a3619a80c73.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2Fdfffafe3-bafd-eff6-ad38-3a3619a80c73.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=36829c8215abdfc1fd23f6bfbe550e8c 1x" loading="lazy"></a></p>

<p>次にProjectタブでAssets/Testsフォルダを右クリックしてコンテキストメニューを呼び出し、"Create/Testing/C# Test Script"を押して新規にテスト用スクリプトを作成します。<br>
ファイル名は"NativeEnumerableTestScript"としましょう。</p>

<p>NativeEnumerableTestScriptをダブルクリックして編集を行います。</p>

<p><details><summary>NativeEnumerableTestScript.csの中身</summary><div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NativeEnumerableTestScript.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">NUnit.Framework</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UniNativeLinq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Unity.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Unity.Collections.LowLevel.Unsafe</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Tests</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">sealed</span> <span class="k">unsafe</span> <span class="k">class</span> <span class="nc">NativeEnumerableTestScript</span>
  <span class="p">{</span>
    <span class="p">[</span><span class="n">Test</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">DefaultValuePass</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="n">NativeEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">nativeEnumerable</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
      <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">0L</span><span class="p">,</span> <span class="n">nativeEnumerable</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
      <span class="n">Assert</span><span class="p">.</span><span class="nf">IsTrue</span><span class="p">(</span><span class="n">nativeEnumerable</span><span class="p">.</span><span class="n">Ptr</span> <span class="p">==</span> <span class="k">null</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">0L</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(-</span><span class="m">10L</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(-</span><span class="m">12241L</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="kt">long</span><span class="p">.</span><span class="n">MinValue</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">ZeroOrNegativeCountTest</span><span class="p">(</span><span class="kt">long</span> <span class="n">count</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">array</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NativeArray</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="m">1</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Persistent</span><span class="p">))</span>
      <span class="p">{</span>
        <span class="n">Assert</span><span class="p">.</span><span class="nf">IsFalse</span><span class="p">(</span><span class="n">array</span><span class="p">.</span><span class="nf">GetUnsafePtr</span><span class="p">()</span> <span class="p">==</span> <span class="k">null</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">nativeEnumerable</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NativeEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;((</span><span class="kt">int</span><span class="p">*)</span> <span class="n">array</span><span class="p">.</span><span class="nf">GetUnsafePtr</span><span class="p">(),</span> <span class="n">count</span><span class="p">);</span>
        <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">0L</span><span class="p">,</span> <span class="n">nativeEnumerable</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="n">Assert</span><span class="p">.</span><span class="nf">IsTrue</span><span class="p">(</span><span class="n">nativeEnumerable</span><span class="p">.</span><span class="n">Ptr</span> <span class="p">==</span> <span class="k">null</span><span class="p">);</span>  
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Temp</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Temp</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Temp</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">114</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Temp</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">TempJob</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">TempJob</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">TempJob</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">114</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">TempJob</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Persistent</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Persistent</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Persistent</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">114</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Persistent</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">FromNativeArrayPass</span><span class="p">(</span><span class="kt">int</span> <span class="n">count</span><span class="p">,</span> <span class="n">Allocator</span> <span class="n">allocator</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">array</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NativeArray</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="n">count</span><span class="p">,</span> <span class="n">allocator</span><span class="p">))</span>
      <span class="p">{</span>
        <span class="kt">var</span> <span class="n">nativeEnumerable</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NativeEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;((</span><span class="kt">int</span><span class="p">*)</span> <span class="n">array</span><span class="p">.</span><span class="nf">GetUnsafePtr</span><span class="p">(),</span> <span class="n">array</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">count</span><span class="p">,</span> <span class="n">nativeEnumerable</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">nativeEnumerable</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
          <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">nativeEnumerable</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
          <span class="n">nativeEnumerable</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
          <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p></p>
</div></details><br>
上記コードに従ってUnity Test Runnerの為のEditor Mode Testを複数個用意します。<br>
NUnit.Framework.TestCase属性はバリエーションを作り出すのにかなり便利な属性です。</p>

<p>テストコードの記述後はエディタに戻り、Unity Test Runnerのウィンドウを呼び出しましょう。メニューの"Window/General/Test Runner"をクリックすると開きます。<br>
<a href="https://camo.qiitausercontent.com/5e2e5f05e6b52f73d6180f525219640e15ef865e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235363034372f65316266376365312d636332612d316239332d656430362d3837383166356636333364352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2Fe1bf7ce1-cc2a-1b93-ed06-8781f5f633d5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1f3cb30c59d26feb211259f48f28c97b" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/256047/e1bf7ce1-cc2a-1b93-ed06-8781f5f633d5.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2Fe1bf7ce1-cc2a-1b93-ed06-8781f5f633d5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5bf83d1ea57e170fd6551e07a76e11b1 1x" loading="lazy"></a></p>

<p>出てきたウィンドウのRun Allを押すと全ての項目が緑になり、テスト全てをPassしたことがわかります。<br>
<a href="https://camo.qiitausercontent.com/b11efe73be3fef53af05cb912eaf57786d760ac9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235363034372f30353338643631362d666138622d326662352d313062652d3766643937316139623466642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2F0538d616-fa8b-2fb5-10be-7fd971a9b4fd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4ed3387861731b735efd8198b6fe72d3" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/256047/0538d616-fa8b-2fb5-10be-7fd971a9b4fd.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2F0538d616-fa8b-2fb5-10be-7fd971a9b4fd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5c7642aaaee9502eb50cb7081a06d9c9 1x" loading="lazy"></a></p>

<h2>
<span id="githubにリポジトリを作って成果物を公開する" class="fragment"></span><a href="#github%E3%81%AB%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E6%88%90%E6%9E%9C%E7%89%A9%E3%82%92%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>GitHubにリポジトリを作って成果物を公開する</h2>

<p>GitHubに適当なリポジトリ名で新規リポジトリを作成してください。そこにこのプロジェクトを公開します。<br>
私は"HandsOn_CSharpAdventCalendar20191201"と命名しました。<br>
現在のワーキングディレクトリはUniNativeLinqHandsOnのはずです。</p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">git</span><span class="w"> </span><span class="nx">switch</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="nx">develop</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="o">.</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">commit</span><span class="w"> </span><span class="nt">-m</span><span class="w"> </span><span class="s2">"[init]"</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">remote</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">origin</span><span class="w"> </span><span class="nx">https://github.com/pCYSl5EDgo/HandsOn_CSharpAdventCalendar20191201.git</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">push</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="nx">origin</span><span class="w"> </span><span class="nx">develop</span><span class="w">
</span></code></pre></div>
</div>

<p><code>git remote add origin https://github.com/pCYSl5EDgo/HandsOn_CSharpAdventCalendar20191201.git</code>については適切な読み替えを行ってください。<br>
適切な.gitignore設定を行っているならば上記の操作で最初のコミットを過不足なくできます。</p>

<p>基本的にローカルのワーキングブランチはdevelopとし、リモートリポジトリのdevelopブランチにpushすることとします。<br>
この措置はリモートのmasterブランチをUPM用にする為のものです。Assetsを含む通常のUnityプロジェクトはUPMの構成と相性が悪いのです。</p>

<h2>
<span id="github-actions対応-cicdを行う" class="fragment"></span><a href="#github-actions%E5%AF%BE%E5%BF%9C-cicd%E3%82%92%E8%A1%8C%E3%81%86"><i class="fa fa-link"></i></a>GitHub Actions対応 CI/CDを行う</h2>

<p>これからGitHub ReleasesでUniNativeLinq.dllをpush時に自動的に公開する仕組みを作ります。その際にテストも走らせ、テスト失敗時はリリースしないようにします。</p>

<p><details><summary>GitHub ActionsでUnityを使うための下拵え　<a href="https://qiita.com/pCYSl5EDgo/items/690dd56ffb0fcf64e70b" id="reference-f34ff71be099a0c52076">参考文献：GitHub ActionsでUnity開発</a></summary><div>GitHub ActionsではLinux, Windows, MacOSXの３種類の環境でCI/CDを行うことができます。<br>
CI/CDサービスからUnityを利用する場合にはLinux環境を利用する形になります。<br>
<details><summary>なぜWindowsやMacではなくLinuxなのかについての補足</summary><div>WindowsやMacOS環境でも<a href="https://github.com/pCYSl5EDgo/setup-unity" rel="nofollow noopener" target="_blank">pCYSl5EDgo/setup-unity</a>というGitHub Actionを利用してUnityをインストール可能です。<br>
WinやMacはVMインスタンスとして立ち上がるので、ジョブ毎にMachine IDが変化します。<br>
困ったことに後述するalfファイルの項目にMachine IDがありまして、ここがulfにも受け継がれてしまい、不一致だと認証にコケるのです。<br>
故にulfファイルを使用してオフライン認証を行う手法をWindowsとMacOS環境では取り得ません。</div></details>

<p>Unityを利用するためには必ずメールアドレスとパスワードで認証する必要があります。<br>
CUIで認証する場合には<a href="https://docs.unity3d.com/ja/2017.4/Manual/ManualActivationGuide.html" rel="nofollow noopener" target="_blank">オフライン/ 手動アクティベーション</a>を行う方がパスワード漏洩対策として安全です。<br>
これは事前にUnityを動かすPCの情報と、Unityのバージョン、ユーザーのパスワードとメールアドレス等全ての情報を含んだulfファイルを生成しておき、GitHub Actionsでの実行時にulfファイルを使用して認証を行うという手法です。</p>

<p>詳細な手順は<a href="https://docs.unity3d.com/ja/2017.4/Manual/ManualActivationGuide.html" rel="nofollow noopener" target="_blank">公式の参考文献</a>を読んで理解していただくとして、次のような手順でulfファイルを作成してください。</p>

<ul>
<li>
<a href="https://github.com/pCYSl5EDgo/CreateALF/releases" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/pCYSl5EDgo/CreateALF/releases</a> から v1028.4.12f1.alfをダウンロード</li>
<li>
<a href="https://license.unity3d.com/" rel="nofollow noopener" target="_blank">alfファイルを元にulfファイルにするためのUnityの提供するウェブページ</a>に行き、Unityにログインする（ログイン済の方はメールアドレスとパスワード入力不要）</li>
<li>alfファイルをアップロード <sup id="fnref1"><a href="#fn1" title="画像はUnityのサイトより引用">1</a></sup> <a href="https://camo.qiitausercontent.com/38a8cd11d852225f9ecfa5aba2a4c12cd9f85bfa/68747470733a2f2f646f63732e756e69747933642e636f6d2f6a612f323031372e342f75706c6f6164732f4d61696e2f6d616e75616c61637469766174696f6e77696e646f772e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fdocs.unity3d.com%2Fja%2F2017.4%2Fuploads%2FMain%2Fmanualactivationwindow.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=331cec6f1f0b3b487aaa4c2d2d2f434f" alt="manualactivationwindow.png" data-canonical-src="https://docs.unity3d.com/ja/2017.4/uploads/Main/manualactivationwindow.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fdocs.unity3d.com%2Fja%2F2017.4%2Fuploads%2FMain%2Fmanualactivationwindow.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=057007d0ebf631d6da05dcd6eac302d7 1x" loading="lazy"></a>
</li>
<li>使用しているUnityがProまたはPersonalであるかを選択 <sup id="fnref1"><a href="#fn1" title="画像はUnityのサイトより引用">1</a></sup> <a href="https://camo.qiitausercontent.com/7583cc13e5eee3d1a68702ca5cc44eddf009d6d5/68747470733a2f2f646f63732e756e69747933642e636f6d2f6a612f323031372e342f75706c6f6164732f4d61696e2f6163746976617465796f75726c6963656e73652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fdocs.unity3d.com%2Fja%2F2017.4%2Fuploads%2FMain%2Factivateyourlicense.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=497c1760c85e450a7e7665f4ba48d20d" alt="activateyourlicense.png" data-canonical-src="https://docs.unity3d.com/ja/2017.4/uploads/Main/activateyourlicense.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fdocs.unity3d.com%2Fja%2F2017.4%2Fuploads%2FMain%2Factivateyourlicense.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=46d68d70a19966f7639f610cec55eaba 1x" loading="lazy"></a>
</li>
<li>"Download License File"をクリックしてulfファイルを入手 <sup id="fnref1"><a href="#fn1" title="画像はUnityのサイトより引用">1</a></sup> <a href="https://camo.qiitausercontent.com/5db004a154772c46864ca328f1c7a60fbd53fa8b/68747470733a2f2f646f63732e756e69747933642e636f6d2f6a612f323031372e342f75706c6f6164732f4d61696e2f796f75417265416c6d6f7374446f6e652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fdocs.unity3d.com%2Fja%2F2017.4%2Fuploads%2FMain%2FyouAreAlmostDone.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=320321cd94291f5d21329d232adb6579" alt="youAreAlmostDone.png" data-canonical-src="https://docs.unity3d.com/ja/2017.4/uploads/Main/youAreAlmostDone.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fdocs.unity3d.com%2Fja%2F2017.4%2Fuploads%2FMain%2FyouAreAlmostDone.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=014283472f8a47cd357456bf1b9a2159 1x" loading="lazy"></a>
</li>
</ul>

<p><details><summary>もしあなたがUnity2018.4.12f1以外でこのハンズオンを行う場合</summary><div>そのバージョンのalfファイルを作成しなくてはいけません。<br>
<a href="https://github.com/pCYSl5EDgo/CreateALF" rel="nofollow noopener" target="_blank">CreateALFというGitHubのリポジトリ</a>をForkし、".github/workflows/CreateLicenseALF.yml"を編集してください。

<div class="code-frame" data-lang="yaml">
<div class="code-lang"><span class="bold">CreateLicenseALF.yml</span></div>
<div class="highlight"><pre class="with-code"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Create ALF File</span>

<span class="na">on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">push</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>

    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">unity-version</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">2018.4.9f1</span>
        <span class="pi">-</span> <span class="s">2018.4.10f1</span>
        <span class="pi">-</span> <span class="s">2018.4.11f1</span>
        <span class="pi">-</span> <span class="s">2018.4.12f1</span>
        <span class="pi">-</span> <span class="s">2018.4.13f1</span>
        <span class="pi">-</span> <span class="s">2019.3.0f1</span>
        <span class="pi">-</span> <span class="s">2020.1.0a14</span>

    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">pCYSl5EDgo/setup-unity@master</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">unity-version</span><span class="pi">:</span> <span class="s">${{ matrix.unity-version }}</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create Manual Activation File</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">/opt/Unity/Editor/Unity -quit -batchmode -nographics -logfile -createManualActivationFile || exit </span><span class="m">0</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create Release</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">create_release</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/create-release@v1.0.0</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">tag_name</span><span class="pi">:</span> <span class="s">setup-${{ matrix.unity-version }}</span>
        <span class="na">release_name</span><span class="pi">:</span> <span class="s">Release setup-Unity ${{ matrix.unity-version }}</span>
        <span class="na">draft</span><span class="pi">:</span> <span class="no">false</span>
        <span class="na">prerelease</span><span class="pi">:</span> <span class="no">false</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upload Release Asset</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">upload-release-asset</span> 
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/upload-release-asset@v1.0.1</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">upload_url</span><span class="pi">:</span> <span class="s">${{ steps.create_release.outputs.upload_url }}</span> <span class="c1"># This pulls from the CREATE RELEASE step above, referencing it's ID to get its outputs object, which include a `upload_url`. See this blog post for more info: https://jasonet.co/posts/new-features-of-github-actions/#passing-data-to-future-steps </span>
        <span class="na">asset_path</span><span class="pi">:</span> <span class="s">Unity_v${{ matrix.unity-version }}.alf</span>
        <span class="na">asset_name</span><span class="pi">:</span> <span class="s">Unity_v${{ matrix.unity-version }}.alf</span>
        <span class="na">asset_content_type</span><span class="pi">:</span> <span class="s">application/xml</span>
</code></pre></div>
</div>

<p>matrix.unity-versionにあなたの使うUnityのバージョンを指定してください。<br>
masterブランチにpushするとGitHub Releaseにそのバージョンのalfファイルが登録されます。<br>
</p>
</div></details></p>

<p>入手したulfファイルをリポジトリ"HandsOn_CSharpAdventCalendar20191201"で利用しますが、秘密にすべき情報であるため、GitHub Secretsという機能を使って暗号化しましょう。<br>
GitHub SecretsはSettings/Secretsを選択し、そこにキーと値のペアを登録します。<br>
<a href="https://camo.qiitausercontent.com/f54f9b1964a1c8b1596b272f3ca344c44d3476fb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235363034372f35653865333262362d396136362d323433632d623633342d3263376261383964383834642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2F5e8e32b6-9a66-243c-b634-2c7ba89d884d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=653d639a9439631f7431acb7b501b536" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/256047/5e8e32b6-9a66-243c-b634-2c7ba89d884d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2F5e8e32b6-9a66-243c-b634-2c7ba89d884d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=bc65b550fb4068f5756c6cfe0584052a 1x" loading="lazy"></a><br>
今回はulfというキーでulfファイルの中身を登録しましょう。<br>
以上でGitHub ActionsでUnityを扱う下拵えは完了です。</p>
</div></details></p>

<p>現在のワーキングディレクトリはUniNativeLinqHandsOnのはずです。</p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">mkdir</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="o">.</span><span class="nf">github</span><span class="nx">/workflows</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="o">.</span><span class="nf">github</span><span class="nx">/workflows/CI.yaml</span><span class="w">
</span></code></pre></div>
</div>

<p>".github/workflows"フォルダ以下にyamlファイルを作成し、そこに自動化する仕事を記述します。<br>
更にcore~.csproje.txtを新規に作成します。core~.csprojはWindows向けの記述をしていて、そのままではLinuxのDockerコンテナ上では動作しません。<br>
<details><summary>core~.csprojはこのように記述しなおしてください。</summary><div>ほぼ元のcore~.csprojと変わりは無いですが、HintPathが変更され、かつビルド後イベントが削除されています。

<div class="code-frame" data-lang="yaml">
<div class="code-lang"><span class="bold">core~.csproj.txt</span></div>
<div class="highlight"><pre class="with-code"><code><span class="s">&lt;Project Sdk="Microsoft.NET.Sdk"&gt;</span>

  <span class="s">&lt;PropertyGroup&gt;</span>
    <span class="s">&lt;TargetFramework&gt;netstandard2.0&lt;/TargetFramework&gt;</span>
    <span class="s">&lt;RootNamespace&gt;UniNativeLinq&lt;/RootNamespace&gt;</span>
    <span class="s">&lt;AllowUnsafeBlocks&gt;True&lt;/AllowUnsafeBlocks&gt;</span>
    <span class="s">&lt;LangVersion&gt;8&lt;/LangVersion&gt;</span>
    <span class="s">&lt;AssemblyName&gt;UniNativeLinq&lt;/AssemblyName&gt;</span>
  <span class="s">&lt;/PropertyGroup&gt;</span>

  <span class="s">&lt;ItemGroup&gt;</span>
    <span class="s">&lt;Reference Include="UnityEngine.CoreModule"&gt;</span>
      <span class="s">&lt;HintPath Condition="Exists('C:\Users\conve')"&gt;C:\Users\conve\Documents\Unity\Editor\Data\Managed\UnityEngine\UnityEngine.CoreModule.dll&lt;/HintPath&gt;</span>
      <span class="s">&lt;HintPath Condition="Exists('/opt/Unity/Editor/Unity')"&gt;/opt/Unity/Editor/Data/Managed/UnityEngine/UnityEngine.CoreModule.dll&lt;/HintPath&gt;</span>
    <span class="s">&lt;/Reference&gt;</span>
  <span class="s">&lt;/ItemGroup&gt;</span>
<span class="s">&lt;/Project&gt;</span>
</code></pre></div>
</div>

<p></p>
</div></details></p>

<p><details><summary>CI.yamlの内容</summary><div>

<div class="code-frame" data-lang="yaml">
<div class="code-lang"><span class="bold">CI.yaml</span></div>
<div class="highlight"><pre class="with-code"><code><span class="na">name</span><span class="pi">:</span> <span class="s">CreateRelease</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">develop</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">buildReleaseJob</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">unity-version</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">2018.4.9f1</span><span class="pi">]</span>
        <span class="na">user-name</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">pCYSl5EDgo</span><span class="pi">]</span>
        <span class="na">repository-name</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">HandsOn_CSharpAdventCalendar20191201</span><span class="pi">]</span>
        <span class="na">exe</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">/opt/Unity/Editor/Unity'</span><span class="pi">]</span>

    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">pCYSl5EDgo/setup-unity@master</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">unity-version</span><span class="pi">:</span> <span class="s">${{ matrix.unity-version }}</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">License Activation</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">echo -n "$ULF" &gt; unity.ulf</span>
        <span class="s">${{ matrix.exe }} -nographics -batchmode -quit -logFile -manualLicenseFile ./unity.ulf || exit 0</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="na">ULF</span><span class="pi">:</span> <span class="s">${{ secrets.ulf }}</span>

    <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">git clone https://github.com/${{ github.repository }}</span>

    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-dotnet@v1.0.2</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">dotnet-version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.0.101'</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Builds DLL</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">cd ${{ matrix.repository-name }}/core~</span>
        <span class="s">dotnet build -c Release</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Post Process DLL</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">cd ${{ matrix.repository-name }}</span>
        <span class="s">mv -f ./core~/bin/Release/netstandard2.0/UniNativeLinq.dll ./Assets/Plugins/UNL/UniNativeLinq.dll</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run Test</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">${{ matrix.exe }} -batchmode -nographics -projectPath ${{ matrix.repository-name }} -logFile ./log.log -runEditorTests -editorTestsResultFile ../result.xml || exit </span><span class="m">0</span>

    <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">ls -l</span>
    <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">cat log.log</span>
    <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">cat result.xml</span>

    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">pCYSl5EDgo/Unity-Test-Runner-Result-XML-interpreter@master</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">interpret</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">result.xml</span>

    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">steps.interpret.outputs.success != 'true'</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">exit </span><span class="m">1</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get Version</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">cd ${{ matrix.repository-name }}</span>
        <span class="s">git describe --tags 1&gt; ../version 2&gt; ../error || exit 0</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cat Error</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">pCYSl5EDgo/cat@master</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">error</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">error</span>

    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">startsWith(steps.error.outputs.text, 'fatal') != 'true'</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">cat version</span>
        <span class="s">cat version | awk '{ split($0, versions, "-"); split(versions[1], numbers, "."); numbers[3]=numbers[3]+1; variable=numbers[1]"."numbers[2]"."numbers[3]; print variable; }' &gt; version_increment</span>

    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">startsWith(steps.error.outputs.text, 'fatal')</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">echo -n "0.0.1" &gt; version_increment</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cat</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">pCYSl5EDgo/cat@master</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">version</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">version_increment</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create Release</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">create_release</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/create-release@v1.0.0</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">tag_name</span><span class="pi">:</span> <span class="s">${{ steps.version.outputs.text }}</span>
        <span class="na">release_name</span><span class="pi">:</span> <span class="s">Release Unity${{ matrix.unity-version }} - v${{ steps.version.outputs.text }}</span>
        <span class="na">draft</span><span class="pi">:</span> <span class="no">false</span>
        <span class="na">prerelease</span><span class="pi">:</span> <span class="no">false</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upload DLL</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/upload-release-asset@v1.0.1</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">upload_url</span><span class="pi">:</span> <span class="s">${{ steps.create_release.outputs.upload_url }}</span>
        <span class="na">asset_path</span><span class="pi">:</span> <span class="s">${{ matrix.repository-name }}/Assets/Plugins/UNL/UniNativeLinq.dll</span>
        <span class="na">asset_name</span><span class="pi">:</span> <span class="s">UniNativeLinq.dll</span>
        <span class="na">asset_content_type</span><span class="pi">:</span> <span class="s">application/vnd.microsoft.portable-executable</span>

</code></pre></div>
</div>

<p></p>
</div></details></p>

<p>jobs.buildReleaseJob.startegy.matrix以下の3項目は適切に書き換えてください。</p>

<div class="code-frame" data-lang="3項目抜粋"><div class="highlight"><pre class="with-code"><code>unity-tag: [2018.4.12f1]
user-name: [pCYSl5EDgo]
repository-name: [HandsOn_CSharpAdventCalendar20191201]
</code></pre></div></div>

<ul>
<li>unity-tag

<ul>
<li>Unityのバージョン</li>
</ul>
</li>
<li>user-name

<ul>
<li>あなたのGitHubアカウント名</li>
</ul>
</li>
<li>repository-name

<ul>
<li>あなたのリポジトリ名</li>
</ul>
</li>
</ul>

<p>全体の流れとしては以下の通りになります。</p>

<ul>
<li>作業リポジトリをクローン

<ul>
<li>actions/checkoutだとcore~などの隠しフォルダを無視してしまうのでgit cloneするのが安牌</li>
</ul>
</li>
<li>GitHub Secretsに登録したulfファイルをトップレベルに <code>echo -n "${ULF}" &gt; Unity_v2018.x.ulf</code>で出力

<ul>
<li>環境変数に仕込んでいるので外部にバレずに利用可能</li>
</ul>
</li>
<li>ビルドに必要なdotnet core 3.0環境のセットアップ</li>
<li>DLLをビルドしてそれをAssets/Plugins/UNL以下に配置</li>
<li>Unityのライセンス認証</li>
<li>Unity Test Runnerをコマンドラインから走らせる</li>
<li>テストに失敗したなら全体を失敗させて終了</li>
<li>前回のビルド時のバージョンを取得</li>
<li>取得に失敗したならば今回のバージョンを0.0.1とする</li>
<li>取得成功時はawkでゴニョゴニョしてマイナーバージョンをインクリメントする</li>
<li>GitHub Releasesに新規リリースを作成する</li>
<li>リリースにファイルを追加する</li>
</ul>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">git</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="o">.</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">commit</span><span class="w"> </span><span class="nt">-m</span><span class="w"> </span><span class="s2">"[update]Publish Release"</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">push</span><span class="w">
</span></code></pre></div>
</div>

<p>現在のワーキングディレクトリはUniNativeLinqHandsOnのはずです。<br>
全ての作業が終わったらGitHubにpushして最初のGitHub Releasesを公開しましょう。</p>

<h2>
<span id="ienumerabletの実装" class="fragment"></span><a href="#ienumerablet%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>IEnumerable&lt;T&gt;の実装</h2>

<p>NativeEnumerable&lt;T&gt;の中身として全てのフィールドとインデクサを定義しました。<br>
これからIEnumerable&lt;T&gt;を実装します。記述が増えるのでpartial structにします。<br>
<details><summary>IEnumerable&lt;T&gt;を実装したNativeEnumerable&lt;T&gt;</summary><div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NativeEnumerable.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">UniNativeLinq</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">readonly</span> <span class="k">unsafe</span> <span class="k">partial</span> <span class="k">struct</span> <span class="nc">NativeEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
    <span class="p">:</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
    <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="n">unmanaged</span>
  <span class="p">{</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">T</span><span class="p">*</span> <span class="n">Ptr</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="kt">long</span> <span class="n">Length</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">NativeEnumerable</span><span class="p">(</span><span class="n">T</span><span class="p">*</span> <span class="n">ptr</span><span class="p">,</span> <span class="kt">long</span> <span class="n">length</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ptr</span> <span class="p">==</span> <span class="k">default</span> <span class="p">||</span> <span class="n">length</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">Ptr</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
        <span class="n">Length</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">Ptr</span> <span class="p">=</span> <span class="n">ptr</span><span class="p">;</span>
      <span class="n">Length</span> <span class="p">=</span> <span class="n">length</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">ref</span> <span class="n">T</span> <span class="k">this</span><span class="p">[</span><span class="kt">long</span> <span class="n">index</span><span class="p">]</span> <span class="p">=&gt;</span> <span class="k">ref</span> <span class="n">Ptr</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>

    <span class="k">public</span> <span class="n">Enumerator</span> <span class="nf">GetEnumerator</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">Enumerator</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="n">IEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;.</span><span class="nf">GetEnumerator</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="nf">GetEnumerator</span><span class="p">();</span>
    <span class="n">IEnumerator</span> <span class="n">IEnumerable</span><span class="p">.</span><span class="nf">GetEnumerator</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="nf">GetEnumerator</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p></p>
</div></details><br>
<details><summary>IEnumerator&lt;T&gt;を実装したNativeEnumerable&lt;T&gt;.Enumerator</summary><div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NativeEnumerable.Enumerator.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">UniNativeLinq</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">readonly</span> <span class="k">partial</span> <span class="k">struct</span> <span class="nc">NativeEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
  <span class="p">{</span>
    <span class="k">public</span> <span class="k">unsafe</span> <span class="k">struct</span> <span class="nc">Enumerator</span> <span class="p">:</span> <span class="n">IEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
    <span class="p">{</span>
      <span class="k">private</span> <span class="k">readonly</span> <span class="n">T</span><span class="p">*</span> <span class="n">ptr</span><span class="p">;</span>
      <span class="k">private</span> <span class="k">readonly</span> <span class="kt">long</span> <span class="n">length</span><span class="p">;</span>
      <span class="k">private</span> <span class="kt">long</span> <span class="n">index</span><span class="p">;</span>

      <span class="k">public</span> <span class="nf">Enumerator</span><span class="p">(</span><span class="n">NativeEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">parent</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">ptr</span> <span class="p">=</span> <span class="n">parent</span><span class="p">.</span><span class="n">Ptr</span><span class="p">;</span>
        <span class="n">length</span> <span class="p">=</span> <span class="n">parent</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
        <span class="n">index</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">public</span> <span class="kt">bool</span> <span class="nf">MoveNext</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="p">++</span><span class="n">index</span> <span class="p">&lt;</span> <span class="n">length</span><span class="p">;</span>
      <span class="k">public</span> <span class="k">void</span> <span class="nf">Reset</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="n">index</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
      <span class="k">public</span> <span class="k">ref</span> <span class="n">T</span> <span class="n">Current</span> <span class="p">=&gt;</span> <span class="k">ref</span> <span class="n">ptr</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
      <span class="n">T</span> <span class="n">IEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;.</span><span class="n">Current</span> <span class="p">=&gt;</span> <span class="n">Current</span><span class="p">;</span>
      <span class="kt">object</span> <span class="n">IEnumerator</span><span class="p">.</span><span class="n">Current</span> <span class="p">=&gt;</span> <span class="n">Current</span><span class="p">;</span>
      <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="k">this</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p></p>
</div></details></p>

<p>イテレータ構造体を内部型として定義するのはforeachの性能向上の常套手段です。</p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">cd</span><span class="w"> </span><span class="nx">core~</span><span class="w">
</span><span class="n">dotnet</span><span class="w"> </span><span class="nx">build</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="nx">Release</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="o">..</span><span class="w">
</span><span class="n">unity</span><span class="w"> </span><span class="nt">-projectPath</span><span class="w"> </span><span class="o">.</span><span class="w">
</span></code></pre></div>
</div>

<p>ビルドをした後エディタを起動し、テストコードを書きましょう。<br>
NativeEnumerableTestScriptクラスに追記する形で単一のクラスを肥大させましょう。<br>
Unityのよくわからない仕様なのですが、１つのプロジェクトに２ファイル以上のテストスクリプトが存在するとコマンドラインからrunEditorTestsするとエラー吐きます。<br>
このような事情もあり、簡易的な処置ですが神テストクラスを肥えさせます。本格的な処置についてはいずれまた別の記事で書くこともあるかも知れません。<br>
<details><summary>NativeEnumerableTestScript.cs</summary><div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NativeEnumerableTestScript.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Temp</span><span class="p">)]</span>
<span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">114</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Temp</span><span class="p">)]</span>
<span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">114514</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Temp</span><span class="p">)]</span>
<span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">TempJob</span><span class="p">)]</span>
<span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">114</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">TempJob</span><span class="p">)]</span>
<span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">114514</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">TempJob</span><span class="p">)]</span>
<span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Persistent</span><span class="p">)]</span>
<span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">114</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Persistent</span><span class="p">)]</span>
<span class="p">[</span><span class="nf">TestCase</span><span class="p">(</span><span class="m">114514</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Persistent</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">IEnumerableTest</span><span class="p">(</span><span class="kt">int</span> <span class="n">count</span><span class="p">,</span> <span class="n">Allocator</span> <span class="n">allocator</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">array</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NativeArray</span><span class="p">&lt;</span><span class="kt">long</span><span class="p">&gt;(</span><span class="n">count</span><span class="p">,</span> <span class="n">allocator</span><span class="p">))</span>
    <span class="p">{</span>
    <span class="kt">var</span> <span class="n">nativeEnumerable</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NativeEnumerable</span><span class="p">&lt;</span><span class="kt">long</span><span class="p">&gt;((</span><span class="kt">long</span><span class="p">*)</span> <span class="n">array</span><span class="p">.</span><span class="nf">GetUnsafePtr</span><span class="p">(),</span> <span class="n">array</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">nativeEnumerable</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0L</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="n">nativeEnumerable</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">index</span> <span class="p">=</span> <span class="m">0L</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="k">ref</span> <span class="kt">var</span> <span class="n">i</span> <span class="k">in</span> <span class="n">nativeEnumerable</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="n">index</span><span class="p">++,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">i</span> <span class="p">=</span> <span class="n">index</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">index</span> <span class="p">=</span> <span class="m">1L</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="k">in</span> <span class="n">nativeEnumerable</span><span class="p">)</span>
        <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="n">index</span><span class="p">++,</span> <span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p></p>
</div></details></p>

<p>foreach文が正しく動いていることがこれで確認できます。<br>
Unityエディターを閉じた後、GitHubにpushしてCI/CDを体感しましょう。</p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">git</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="o">.</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">commit</span><span class="w"> </span><span class="nt">-m</span><span class="w"> </span><span class="s2">"[update]Implement IEnumerable&lt;T&gt; &amp; IEnumerator&lt;T&gt;"</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">push</span><span class="w">
</span></code></pre></div>
</div>

<h2>
<span id="asenumerableに相当するasrefenumerableの実装" class="fragment"></span><a href="#asenumerable%E3%81%AB%E7%9B%B8%E5%BD%93%E3%81%99%E3%82%8Basrefenumerable%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>AsEnumerable()に相当するAsRefEnumerable()の実装</h2>

<p>NativeArray&lt;T&gt;からNativeEnumerable&lt;T&gt;を生成するのに一々 <code>var nativeEnumerable = new NativeEnumerable&lt;T&gt;((T*) array.GetUnsafePtr(), array.Length);</code>と記述するのも手間です。<br>
<code>var nativeEnumerable = array.AsRefEnumerable();</code>だったら非常に楽ですので、拡張メソッドを定義します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">AsRefEnumerable.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">UniNativeLinq</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">unsafe</span> <span class="k">class</span> <span class="nc">NativeEnumerable</span>
  <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">NativeEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">AsRefEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="k">this</span> <span class="n">Unity</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">NativeArray</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">array</span><span class="p">)</span>
      <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="n">unmanaged</span>
      <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">NativeEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">ptr</span><span class="p">:</span> <span class="p">(</span><span class="n">T</span><span class="p">*)</span><span class="n">Unity</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">LowLevel</span><span class="p">.</span><span class="n">Unsafe</span><span class="p">.</span><span class="n">NativeArrayUnsafeUtility</span><span class="p">.</span><span class="nf">GetUnsafeBufferPointerWithoutChecks</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">length</span><span class="p">:</span> <span class="n">array</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="irefenumerabletorの定義と実装" class="fragment"></span><a href="#irefenumerabletor%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%81%A8%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>IRefEnumerable/torの定義と実装</h2>

<p>NativeEnumerable&lt;T&gt;とその内部型Enumeratorは <code>public Enumerator GetEnumetor();</code>と <code>public ref T Current{get;}</code>が特徴的な要素です。<br>
これをインターフェイスに抽出します。</p>

<p><details><summary>IRefEnumerable.csとIRefEnumerator.csの定義</summary><div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IRefEnumerable.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">UniNativeLinq</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">interface</span> <span class="nc">IRefEnumerable</span><span class="p">&lt;</span><span class="n">TEnumerator</span><span class="p">,</span> <span class="n">T</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="p">.</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
    <span class="k">where</span> <span class="n">TEnumerator</span> <span class="p">:</span> <span class="n">IRefEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
  <span class="p">{</span>
    <span class="k">new</span> <span class="n">TEnumerator</span> <span class="nf">GetEnumerator</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IRefEnumerator.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">UniNativeLinq</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">interface</span> <span class="nc">IRefEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="p">.</span><span class="n">IEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
  <span class="p">{</span>
    <span class="k">new</span> <span class="k">ref</span> <span class="n">T</span> <span class="n">Current</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p></p>
</div></details></p>

<p><details><summary>上記インターフェイスをNativeEnumerableに実装します。</summary><div>実際は各ファイルを一行書き換えるだけです。

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NativeEenumerable.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">readonly</span> <span class="k">unsafe</span> <span class="k">partial</span> <span class="k">struct</span> <span class="nc">NativeEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
  <span class="p">:</span> <span class="n">IRefEnumerable</span><span class="p">&lt;</span><span class="n">NativeEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;.</span><span class="n">Enumerator</span><span class="p">,</span> <span class="n">T</span><span class="p">&gt;</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NativeEenumerable.Enumerator.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">unsafe</span> <span class="k">struct</span> <span class="nc">Enumerator</span> <span class="p">:</span> <span class="n">IRefEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
</code></pre></div>
</div>

<p></p>
</div></details></p>

<p>テストコードには何も差は生じません。（既存の実装を元にインターフェイスを抽出しただけですので）</p>

<h1>
<span id="第2章初めてのapi---select" class="fragment"></span><a href="#%E7%AC%AC2%E7%AB%A0%E5%88%9D%E3%82%81%E3%81%A6%E3%81%AEapi---select"><i class="fa fa-link"></i></a>第2章　初めてのAPI - Select</h1>

<p>LINQで一番使うAPIはSelectまたはWhereのはずです。<br>
今回はUniNativeLinqの特異性を学ぶのに好適であるため、Selectを実装してみます。</p>

<h2>
<span id="通常linqのselectについて" class="fragment"></span><a href="#%E9%80%9A%E5%B8%B8linq%E3%81%AEselect%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>通常LINQのSelectについて</h2>

<p>通常のSystem.Linq.Enumerableの提供するSelectメソッドのシグネチャを見てみましょう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Select.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">static</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TTo</span><span class="p">&gt;</span> <span class="n">Select</span><span class="p">&lt;</span><span class="n">TFrom</span><span class="p">,</span> <span class="n">TTo</span><span class="p">&gt;(</span><span class="k">this</span> <span class="n">IEunmerable</span><span class="p">&lt;</span><span class="n">TFrom</span><span class="p">&gt;</span> <span class="n">collection</span><span class="p">,</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">TFrom</span><span class="p">,</span> <span class="n">TTo</span><span class="p">&gt;</span> <span class="n">func</span><span class="p">);</span>
</code></pre></div>
</div>

<p>引数にIEnumerable&lt;TFrom&gt;なコレクションと、Func&lt;TFrom, TTo&gt;な写像を取ってマッピングを行います。<br>
LINQの優れている点は拡張メソッドの型引数を（C#の貧弱な型推論でも）型推論完了できるという点にあります。</p>

<p>標準にLINQに習ってAPIを定義してみましょう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">UniNativeLinq.Select.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">static</span> <span class="n">IRefEnumerable</span><span class="p">&lt;</span><span class="n">TToEnumerator</span><span class="p">,</span> <span class="n">TTo</span><span class="p">&gt;</span> <span class="n">Select</span><span class="p">&lt;</span><span class="n">TFromEnumerator</span><span class="p">,</span> <span class="n">TFrom</span><span class="p">,</span> <span class="n">TToEnumerator</span><span class="p">,</span> <span class="n">TTo</span><span class="p">&gt;(</span><span class="k">this</span> <span class="n">IRefEunmerable</span><span class="p">&lt;</span><span class="n">TFromEnumerator</span><span class="p">,</span> <span class="n">TFrom</span><span class="p">&gt;</span> <span class="n">collection</span><span class="p">,</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">TFrom</span><span class="p">,</span> <span class="n">TTo</span><span class="p">&gt;</span> <span class="n">func</span><span class="p">);</span>
</code></pre></div>
</div>

<p>このような感じでしょうか？<br>
TToEnumeratorを引数から導出できず、センスが悪いですね。<br>
<details><summary>実際のUniNativeLinqでは新たにSelectEnumerable&lt;TPrevEnumerable, TPrevEnumerator, TPrev, T, TAction&gt;型を定義します。</summary><div>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">New-Item</span><span class="w"> </span><span class="nx">API/RefAction.cs</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">Interface/IRefAction.cs</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">Utility/DelegateRefActionToStructOperatorAction.cs</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">Utility/Unsafe.cs</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">Collection/SelectEnumerable.cs</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">Collection/SelectEnumerable.Enumerator.cs</span><span class="w">
</span></code></pre></div>
</div>

<p>細々と必要な型があるので他にもいくつか新規にファイルを作成します。</p>

<p><details><summary>RefAction.csとIRefAction.cs</summary><div>似たような内容なので同一ファイル内に記述するのも良いでしょう。

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">RefAction.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">UniNativeLinq</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">delegate</span> <span class="k">void</span> <span class="n">RefAction</span><span class="p">&lt;</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">&gt;(</span><span class="k">ref</span> <span class="n">T0</span> <span class="n">arg0</span><span class="p">,</span> <span class="k">ref</span> <span class="n">T1</span> <span class="n">arg1</span><span class="p">);</span>
  <span class="k">public</span> <span class="k">interface</span> <span class="nc">IRefAction</span><span class="p">&lt;</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">&gt;</span>
  <span class="p">{</span>
    <span class="k">void</span> <span class="nf">Execute</span><span class="p">(</span><span class="k">ref</span> <span class="n">T0</span> <span class="n">arg0</span><span class="p">,</span> <span class="k">ref</span> <span class="n">T1</span> <span class="n">arg1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">UniNativeLinq</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">readonly</span> <span class="k">struct</span> <span class="nc">DelegateRefActionToStructOperatorAction</span><span class="p">&lt;</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">IRefAction</span><span class="p">&lt;</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">&gt;</span>
  <span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">RefAction</span><span class="p">&lt;</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">&gt;</span> <span class="n">action</span><span class="p">;</span>
    <span class="k">public</span> <span class="nf">DelegateRefActionToStructOperatorAction</span><span class="p">(</span><span class="n">RefAction</span><span class="p">&lt;</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">&gt;</span> <span class="n">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="n">action</span> <span class="p">=</span> <span class="n">action</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Execute</span><span class="p">(</span><span class="k">ref</span> <span class="n">T0</span> <span class="n">arg0</span><span class="p">,</span> <span class="k">ref</span> <span class="n">T1</span> <span class="n">arg1</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nf">action</span><span class="p">(</span><span class="k">ref</span> <span class="n">arg0</span><span class="p">,</span> <span class="k">ref</span> <span class="n">arg1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p></p>
</div></details></p>

<p><details><summary>Unsafe.csは、<a href="https://ufcpp.net/blog/2018/12/unsafe/" rel="nofollow noopener" target="_blank">System.Runtime.CompilerServices.Unsafe</a>の一部抜粋です。</summary><div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Unsafe.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">UniNativeLinq</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Unsafe</span>
  <span class="p">{</span>
    <span class="c1">// ref T AsRef&lt;T&gt;(in T value) =&gt; ref value;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">ref</span> <span class="n">T</span> <span class="n">AsRef</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="k">in</span> <span class="n">T</span> <span class="k">value</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="nf">NotImplementedException</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>実際の所、NotImplementExceptionとして中身は空っぽなモックAPIです。<br>
後にいい感じにこのモックAPIを処理します。</p>

<p>Unsafe.AsRefはin引数をref戻り値に変換します。<br>
引数にreadonlyフィールドの参照を与えたら、その戻り値が変更可能な参照になります。<br>
</p>
</div></details></p>

<p><details><summary>SelectEnumerable.cs</summary><div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">SelectEnumerable.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">UniNativeLinq</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">readonly</span> <span class="k">partial</span> <span class="k">struct</span> <span class="nc">SelectEnumerable</span><span class="p">&lt;</span><span class="n">TPrevEnumerable</span><span class="p">,</span> <span class="n">TPrevEnumerator</span><span class="p">,</span> <span class="n">TPrev</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">TAction</span><span class="p">&gt;</span>
    <span class="p">:</span> <span class="n">IRefEnumerable</span><span class="p">&lt;</span><span class="n">SelectEnumerable</span><span class="p">&lt;</span><span class="n">TPrevEnumerable</span><span class="p">,</span> <span class="n">TPrevEnumerator</span><span class="p">,</span> <span class="n">TPrev</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">TAction</span><span class="p">&gt;.</span><span class="n">Enumerator</span><span class="p">,</span> <span class="n">T</span><span class="p">&gt;</span>
    <span class="k">where</span> <span class="n">TPrevEnumerable</span> <span class="p">:</span> <span class="n">IRefEnumerable</span><span class="p">&lt;</span><span class="n">TPrevEnumerator</span><span class="p">,</span> <span class="n">TPrev</span><span class="p">&gt;</span>
    <span class="k">where</span> <span class="n">TPrevEnumerator</span> <span class="p">:</span> <span class="n">IRefEnumerator</span><span class="p">&lt;</span><span class="n">TPrev</span><span class="p">&gt;</span>
    <span class="k">where</span> <span class="n">TAction</span> <span class="p">:</span> <span class="n">IRefAction</span><span class="p">&lt;</span><span class="n">TPrev</span><span class="p">,</span> <span class="n">T</span><span class="p">&gt;</span>
  <span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">TPrevEnumerable</span> <span class="n">enumerable</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">TAction</span> <span class="n">action</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">SelectEnumerable</span><span class="p">(</span><span class="k">in</span> <span class="n">TPrevEnumerable</span> <span class="n">enumerable</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="n">enumerable</span> <span class="p">=</span> <span class="n">enumerable</span><span class="p">;</span>
      <span class="n">action</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="nf">SelectEnumerable</span><span class="p">(</span><span class="k">in</span> <span class="n">TPrevEnumerable</span> <span class="n">enumerable</span><span class="p">,</span> <span class="k">in</span> <span class="n">TAction</span> <span class="n">action</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="n">enumerable</span> <span class="p">=</span> <span class="n">enumerable</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="n">action</span> <span class="p">=</span> <span class="n">action</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">Enumerator</span> <span class="nf">GetEnumerator</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">Enumerator</span><span class="p">(</span><span class="k">ref</span> <span class="n">Unsafe</span><span class="p">.</span><span class="nf">AsRef</span><span class="p">(</span><span class="k">in</span> <span class="n">enumerable</span><span class="p">),</span> <span class="n">action</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="p">.</span><span class="n">IEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="p">.</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;.</span><span class="nf">GetEnumerator</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="nf">GetEnumerator</span><span class="p">();</span>
    <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">IEnumerator</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">IEnumerable</span><span class="p">.</span><span class="nf">GetEnumerator</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="nf">GetEnumerator</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p></p>
</div></details><br>
GetEnumerator()においてUnsafe.AsRef(in enumerable)と記述されています。<br>
Unsafe.AsRefはreadonly制約を無視する危険なメソッドですが、この場合において問題はありません。<br>
UniNativeLinqの提供する範囲において、全てのGetEnumeratorメソッドがreadonlyなメソッドであるからです。<br>
この辺りをC#の型制約で保証できればよいのですが、出来ないため今回のようにUnsafe.AsRefを利用する必要があるのです。</p>

<p><details><summary>SelectEnumerable.Enumerator.cs</summary><div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">SelectEnumerable.Enumerator.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">UniNativeLinq</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">readonly</span> <span class="k">partial</span> <span class="k">struct</span> <span class="nc">SelectEnumerable</span><span class="p">&lt;</span><span class="n">TPrevEnumerable</span><span class="p">,</span> <span class="n">TPrevEnumerator</span><span class="p">,</span> <span class="n">TPrev</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">TAction</span><span class="p">&gt;</span>
  <span class="p">{</span>
    <span class="k">public</span> <span class="k">struct</span> <span class="nc">Enumerator</span> <span class="p">:</span> <span class="n">IRefEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
    <span class="p">{</span>
      <span class="k">private</span> <span class="n">TPrevEnumerator</span> <span class="n">enumerator</span><span class="p">;</span>
      <span class="k">private</span> <span class="n">TAction</span> <span class="n">action</span><span class="p">;</span>
      <span class="k">private</span> <span class="n">T</span> <span class="n">element</span><span class="p">;</span>

      <span class="k">public</span> <span class="nf">Enumerator</span><span class="p">(</span><span class="k">ref</span> <span class="n">TPrevEnumerable</span> <span class="n">enumerable</span><span class="p">,</span> <span class="k">in</span> <span class="n">TAction</span> <span class="n">action</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">enumerator</span> <span class="p">=</span> <span class="n">enumerable</span><span class="p">.</span><span class="nf">GetEnumerator</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="n">action</span> <span class="p">=</span> <span class="n">action</span><span class="p">;</span>
        <span class="n">element</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">public</span> <span class="kt">bool</span> <span class="nf">MoveNext</span><span class="p">()</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">enumerator</span><span class="p">.</span><span class="nf">MoveNext</span><span class="p">())</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">action</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="k">ref</span> <span class="n">enumerator</span><span class="p">.</span><span class="n">Current</span><span class="p">,</span> <span class="k">ref</span> <span class="n">element</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">public</span> <span class="k">void</span> <span class="nf">Reset</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="nf">InvalidOperationException</span><span class="p">();</span>
      <span class="k">public</span> <span class="k">ref</span> <span class="n">T</span> <span class="n">Current</span> <span class="p">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="nf">NotImplementedException</span><span class="p">();</span>
      <span class="n">T</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="p">.</span><span class="n">IEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;.</span><span class="n">Current</span> <span class="p">=&gt;</span> <span class="n">Current</span><span class="p">;</span>
      <span class="kt">object</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">IEnumerator</span><span class="p">.</span><span class="n">Current</span> <span class="p">=&gt;</span> <span class="n">Current</span><span class="p">;</span>
      <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p></p>
</div></details></p>
</div></details><br>
SelectEnumerableの実装はそこまで変なものではありません。<br>
コンストラクタで必要な情報をフィールドに初期化し、GetEnumerator()でEnumeratorを返すだけのシンプルな作りです。<br>
EnumeratorではIRefAction&lt;T0, T1&gt;を実装した型引数TActionのインスタンスactionを使用してMoveNext()する度にT型フィールドであるelementを更新しています。</p>

<p>このEnumeratorの最大の特徴は、 <code>public ref T Current =&gt; throw new System.NotImplementedException();</code>です。<br>
そう、未実装のままなのです。これはバグではなく極めて意図的な仕様です。<br>
これをこのままビルドしてテストコードを追加してもエラーを吐くだけです。</p>

<p>本当は <code>public ref T Current =&gt; ref element;</code>と記述したいのですが、<a href="https://ufcpp.net/study/csharp/sp_ref.html?p=2#struct-this" rel="nofollow noopener" target="_blank">C#の文法の制限として無理です</a>。</p>

<h2>
<span id="uninativelinqdllのポストプロセス用dotnet-core-30プロジェクト" class="fragment"></span><a href="#uninativelinqdll%E3%81%AE%E3%83%9D%E3%82%B9%E3%83%88%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E7%94%A8dotnet-core-30%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88"><i class="fa fa-link"></i></a>UniNativeLinq.dllのポストプロセス用dotnet core 3.0プロジェクト</h2>

<p>現在のワーキングディレクトリはUniNativeLinqHandsOnのはずです。<br>
Mono.Cecilを利用してUniNativeLinq.dllを編集してSelectEnumerable.Enumerator.CurrentからNotImplementedExceptionを消し飛ばしましょう。</p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">mkdir</span><span class="w"> </span><span class="nx">post~</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="nx">post~</span><span class="w">
</span><span class="n">dotnet</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">console</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="nx">bin/</span><span class="w"> </span><span class="nx">obj/</span><span class="w"> </span><span class="nx">post~.sln</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="o">.</span><span class="nf">gitignore</span><span class="w">
</span><span class="nx">dotnet</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">package</span><span class="w"> </span><span class="nx">Mono.Cecil</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">DllProcessor.cs</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">InstructionUtility.cs</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">ToDefinitionUtility.cs</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">GenericInstanceUtility.cs</span><span class="w">
</span></code></pre></div>
</div>

<p><details><summary>参考までにpost~.csprojの中身</summary><div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;TargetFramework&gt;netcoreapp3.0&lt;/TargetFramework&gt;
    &lt;RootNamespace&gt;_post&lt;/RootNamespace&gt;
  &lt;/PropertyGroup&gt;
  &lt;ItemGroup&gt;
    &lt;PackageReference Include="Mono.Cecil" Version="0.11.1" /&gt;
  &lt;/ItemGroup&gt;
&lt;/Project&gt;
</code></pre></div></div>

<p>PackageReferenceタグでMono.Cecilをインストール可能です。</p>
</div></details></p>

<p><details><summary>Program.cs</summary><div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Program.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="kt">int</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="nf">ValidateArguments</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="k">out</span> <span class="n">FileInfo</span> <span class="n">inputUniNativeLinqDll</span><span class="p">,</span> <span class="k">out</span> <span class="n">FileInfo</span> <span class="n">outputUniNativeLinqDllPath</span><span class="p">,</span> <span class="k">out</span> <span class="n">DirectoryInfo</span> <span class="n">unityEngineFolder</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="m">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">using</span> <span class="p">(</span><span class="n">DllProcessor</span> <span class="n">processor</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DllProcessor</span><span class="p">(</span><span class="n">inputUniNativeLinqDll</span><span class="p">,</span> <span class="n">outputUniNativeLinqDllPath</span><span class="p">,</span> <span class="n">unityEngineFolder</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">processor</span><span class="p">.</span><span class="nf">Process</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">ValidateArguments</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">,</span> <span class="k">out</span> <span class="n">FileInfo</span> <span class="n">inputUniNativeLinqDll</span><span class="p">,</span> <span class="k">out</span> <span class="n">FileInfo</span> <span class="n">outputNativeLinqDllPath</span><span class="p">,</span> <span class="k">out</span> <span class="n">DirectoryInfo</span> <span class="n">unityEngineFolder</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">Length</span> <span class="p">!=</span> <span class="m">3</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Invalid argument count."</span><span class="p">);</span>
      <span class="n">inputUniNativeLinqDll</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
      <span class="n">outputNativeLinqDllPath</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
      <span class="n">unityEngineFolder</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">inputUniNativeLinqDll</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FileInfo</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">inputUniNativeLinqDll</span><span class="p">.</span><span class="n">Exists</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Empty Input UniNativeLinq.dll path"</span><span class="p">);</span>
      <span class="n">outputNativeLinqDllPath</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
      <span class="n">unityEngineFolder</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">string</span> <span class="n">outputNativeLinqDllPathString</span> <span class="p">=</span> <span class="n">args</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">outputNativeLinqDllPathString</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Empty Output UniNativeLinq.dll path"</span><span class="p">);</span>
      <span class="n">unityEngineFolder</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
      <span class="n">outputNativeLinqDllPath</span> <span class="p">=</span> <span class="k">default</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">outputNativeLinqDllPath</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FileInfo</span><span class="p">(</span><span class="n">outputNativeLinqDllPathString</span><span class="p">);</span>
    <span class="n">unityEngineFolder</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DirectoryInfo</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="m">2</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">unityEngineFolder</span><span class="p">.</span><span class="n">Exists</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Unity Engine Dll Folder does not exist"</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>Main関数はコマンドライン引数を2つ要求します。</p>

<ul>
<li>第1引数：core~で生成したDllのパス "core~/bin/Release/netstandard2.0/UniNativeLinq.dll"</li>
<li>第2引数：Mono.Cecilで編集した後、Dllを出力するパス "Assets/Plugins/UNL/UniNativeLinq.dll"</li>
</ul>

<p>ValidateArgumentsで引数の妥当性を検証します。<br>
IDisposableを実装したDllProcessorのインスタンスを生成し、Processメソッドを実行することで適切な処理を加えます。<br>
</p>
</div></details><br>
<details><summary>DllProcessor.cs</summary><div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">DllProcessor.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Mono.Cecil</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Mono.Cecil.Cil</span><span class="p">;</span>
<span class="k">internal</span> <span class="k">struct</span> <span class="nc">DllProcessor</span> <span class="p">:</span> <span class="n">IDisposable</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="k">readonly</span> <span class="n">ModuleDefinition</span> <span class="n">mainModule</span><span class="p">;</span>
  <span class="k">private</span> <span class="k">readonly</span> <span class="n">FileInfo</span> <span class="n">outputDll</span><span class="p">;</span>

  <span class="k">public</span> <span class="nf">DllProcessor</span><span class="p">(</span><span class="n">FileInfo</span> <span class="n">input</span><span class="p">,</span> <span class="n">FileInfo</span> <span class="n">output</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">mainModule</span> <span class="p">=</span> <span class="n">ModuleDefinition</span><span class="p">.</span><span class="nf">ReadModule</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">FullName</span><span class="p">);</span>
    <span class="n">outputDll</span> <span class="p">=</span> <span class="n">output</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">void</span> <span class="nf">Process</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="nf">ProcessEachMethod</span><span class="p">(</span><span class="n">RewriteUnsafeAsRef</span><span class="p">);</span>
    <span class="n">mainModule</span><span class="p">.</span><span class="n">Types</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">mainModule</span><span class="p">.</span><span class="nf">GetType</span><span class="p">(</span><span class="s">"UniNativeLinq"</span><span class="p">,</span> <span class="s">"Unsafe"</span><span class="p">));</span>
    <span class="nf">ProcessEachMethod</span><span class="p">(</span><span class="n">RewriteThrowNotImplementedException</span><span class="p">,</span> <span class="n">PredicateThrowNotImplementedException</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessEachMethod</span><span class="p">(</span><span class="n">Action</span><span class="p">&lt;</span><span class="n">MethodDefinition</span><span class="p">&gt;</span> <span class="n">action</span><span class="p">,</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">TypeDefinition</span><span class="p">,</span> <span class="kt">bool</span><span class="p">&gt;</span> <span class="n">predicate</span> <span class="p">=</span> <span class="k">default</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="n">TypeDefinition</span> <span class="n">typeDefinition</span> <span class="k">in</span> <span class="n">mainModule</span><span class="p">.</span><span class="n">Types</span><span class="p">)</span>
      <span class="nf">ProcessEachMethod</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">typeDefinition</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessEachMethod</span><span class="p">(</span><span class="n">Action</span><span class="p">&lt;</span><span class="n">MethodDefinition</span><span class="p">&gt;</span> <span class="n">action</span><span class="p">,</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">TypeDefinition</span><span class="p">,</span> <span class="kt">bool</span><span class="p">&gt;</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">TypeDefinition</span> <span class="n">typeDefinition</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="n">TypeDefinition</span> <span class="n">nestedTypeDefinition</span> <span class="k">in</span> <span class="n">typeDefinition</span><span class="p">.</span><span class="n">NestedTypes</span><span class="p">)</span>
      <span class="nf">ProcessEachMethod</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">nestedTypeDefinition</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">predicate</span> <span class="k">is</span> <span class="k">null</span> <span class="p">||</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">typeDefinition</span><span class="p">))</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="n">MethodDefinition</span> <span class="n">methodDefinition</span> <span class="k">in</span> <span class="n">typeDefinition</span><span class="p">.</span><span class="n">Methods</span><span class="p">)</span>
        <span class="nf">action</span><span class="p">(</span><span class="n">methodDefinition</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="k">void</span> <span class="nf">RewriteUnsafeAsRef</span><span class="p">(</span><span class="n">MethodDefinition</span> <span class="n">methodDefinition</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Mono</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="p">.</span><span class="n">Collection</span><span class="p">&lt;</span><span class="n">Instruction</span><span class="p">&gt;</span> <span class="n">instructions</span><span class="p">;</span>
    <span class="k">try</span>
    <span class="p">{</span>
      <span class="n">instructions</span> <span class="p">=</span> <span class="n">methodDefinition</span><span class="p">.</span><span class="n">Body</span><span class="p">.</span><span class="n">Instructions</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">NullReferenceException</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">methodDefinition</span><span class="p">.</span><span class="n">FullName</span><span class="p">);</span>
      <span class="k">throw</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="n">instructions</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span><span class="p">--)</span>
    <span class="p">{</span>
      <span class="n">Instruction</span> <span class="n">instruction</span> <span class="p">=</span> <span class="n">instructions</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">instruction</span><span class="p">.</span><span class="n">OpCode</span><span class="p">.</span><span class="n">Code</span> <span class="p">!=</span> <span class="n">Code</span><span class="p">.</span><span class="n">Call</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">MethodDefinition</span> <span class="n">callMethodDefinition</span><span class="p">;</span>
      <span class="k">try</span>
      <span class="p">{</span>
        <span class="n">callMethodDefinition</span> <span class="p">=</span> <span class="p">((</span><span class="n">MethodReference</span><span class="p">)</span><span class="n">instruction</span><span class="p">.</span><span class="n">Operand</span><span class="p">).</span><span class="nf">ToDefinition</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">catch</span>
      <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">callMethodDefinition</span><span class="p">.</span><span class="n">Name</span> <span class="p">!=</span> <span class="s">"AsRef"</span> <span class="p">||</span> <span class="n">callMethodDefinition</span><span class="p">.</span><span class="n">DeclaringType</span><span class="p">.</span><span class="n">Name</span> <span class="p">!=</span> <span class="s">"Unsafe"</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">instructions</span><span class="p">.</span><span class="nf">RemoveAt</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="kt">bool</span> <span class="nf">PredicateThrowNotImplementedException</span><span class="p">(</span><span class="n">TypeDefinition</span> <span class="n">typeDefinition</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">typeDefinition</span><span class="p">.</span><span class="n">HasFields</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">typeDefinition</span><span class="p">.</span><span class="n">Fields</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">field</span> <span class="p">=&gt;</span> <span class="p">!</span><span class="n">field</span><span class="p">.</span><span class="n">IsStatic</span> <span class="p">&amp;&amp;</span> <span class="n">field</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"element"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="k">void</span> <span class="nf">RewriteThrowNotImplementedException</span><span class="p">(</span><span class="n">MethodDefinition</span> <span class="n">methodDefinition</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">methodDefinition</span><span class="p">.</span><span class="n">IsStatic</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="n">FieldReference</span> <span class="n">elementFieldReference</span> <span class="p">=</span> <span class="n">methodDefinition</span><span class="p">.</span><span class="n">DeclaringType</span><span class="p">.</span><span class="nf">FindField</span><span class="p">(</span><span class="s">"element"</span><span class="p">).</span><span class="nf">MakeHostInstanceGeneric</span><span class="p">(</span><span class="n">methodDefinition</span><span class="p">.</span><span class="n">DeclaringType</span><span class="p">.</span><span class="n">GenericParameters</span><span class="p">);</span>
    <span class="n">ILProcessor</span> <span class="n">processor</span> <span class="p">=</span> <span class="n">methodDefinition</span><span class="p">.</span><span class="n">Body</span><span class="p">.</span><span class="nf">GetILProcessor</span><span class="p">();</span>
    <span class="n">Mono</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="p">.</span><span class="n">Collection</span><span class="p">&lt;</span><span class="n">Instruction</span><span class="p">&gt;</span> <span class="n">instructions</span> <span class="p">=</span> <span class="n">methodDefinition</span><span class="p">.</span><span class="n">Body</span><span class="p">.</span><span class="n">Instructions</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="n">instructions</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span><span class="p">--)</span>
    <span class="p">{</span>
      <span class="n">Instruction</span> <span class="n">throwInstruction</span> <span class="p">=</span> <span class="n">instructions</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">throwInstruction</span><span class="p">.</span><span class="n">OpCode</span><span class="p">.</span><span class="n">Code</span> <span class="p">!=</span> <span class="n">Code</span><span class="p">.</span><span class="n">Throw</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">Instruction</span> <span class="n">newObjInstruction</span> <span class="p">=</span> <span class="n">instructions</span><span class="p">[</span><span class="n">i</span> <span class="p">-</span> <span class="m">1</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">newObjInstruction</span><span class="p">.</span><span class="n">OpCode</span><span class="p">.</span><span class="n">Code</span> <span class="p">!=</span> <span class="n">Code</span><span class="p">.</span><span class="n">Newobj</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">MethodDefinition</span> <span class="n">newObjMethodDefinition</span><span class="p">;</span>
      <span class="k">try</span>
      <span class="p">{</span>
        <span class="n">newObjMethodDefinition</span> <span class="p">=</span> <span class="p">((</span><span class="n">MethodReference</span><span class="p">)</span><span class="n">newObjInstruction</span><span class="p">.</span><span class="n">Operand</span><span class="p">).</span><span class="nf">ToDefinition</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">catch</span>
      <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">newObjMethodDefinition</span><span class="p">.</span><span class="n">Name</span> <span class="p">!=</span> <span class="s">".ctor"</span> <span class="p">||</span> <span class="n">newObjMethodDefinition</span><span class="p">.</span><span class="n">DeclaringType</span><span class="p">.</span><span class="n">FullName</span> <span class="p">!=</span> <span class="s">"System.NotImplementedException"</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">newObjInstruction</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="n">Instruction</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">OpCodes</span><span class="p">.</span><span class="n">Ldarg_0</span><span class="p">));</span>
      <span class="n">throwInstruction</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="n">Instruction</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">OpCodes</span><span class="p">.</span><span class="n">Ldflda</span><span class="p">,</span> <span class="n">elementFieldReference</span><span class="p">));</span>
      <span class="n">processor</span><span class="p">.</span><span class="nf">InsertAfter</span><span class="p">(</span><span class="n">throwInstruction</span><span class="p">,</span> <span class="n">Instruction</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">OpCodes</span><span class="p">.</span><span class="n">Ret</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="n">Stream</span> <span class="n">writer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FileStream</span><span class="p">(</span><span class="n">outputDll</span><span class="p">.</span><span class="n">FullName</span><span class="p">,</span> <span class="n">FileMode</span><span class="p">.</span><span class="n">Create</span><span class="p">,</span> <span class="n">FileAccess</span><span class="p">.</span><span class="n">Write</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">mainModule</span><span class="p">.</span><span class="n">Assembly</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">writer</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">mainModule</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<ul>
<li>Process

<ul>
<li>元となる不完全なDllに対して処理を加えて完全なDllにするメソッドです。</li>
</ul>
</li>
<li>ProcessEachMethod

<ul>
<li>Dllに含まれる全ての型の全てのメソッドを走査して全てのメソッドに対して引数のactionを適用します。</li>
</ul>
</li>
<li>RewriteUnsafeAsRef

<ul>
<li>Unsafe.AsRefはreadonlyな要素を非readonlyな状態に変換する極めて危険なAPIです。</li>
<li>使い所がGetEnumeratorに限定されているため特に問題はないです。</li>
</ul>
</li>
<li>PredicateThrowNotImplementedException

<ul>
<li>インスタンスフィールドに"element"という名前のそれが存在する型のみを処理対象に選ぶメソッドです。</li>
</ul>
</li>
<li>RewriteThrowNotImplementedException

<ul>
<li>
<code>throw new NotImplementedException();</code>を <code>return ref this.element;</code>に置換します。
</li>
</ul>
</li>
</ul>
</div></details>
<details><summary>InstructionUtility.cs</summary><div>



<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">InstructionUtility.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Mono.Cecil.Cil</span><span class="p">;</span>
<span class="k">internal</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">InstructionUtility</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Replace</span><span class="p">(</span><span class="k">this</span> <span class="n">Instruction</span> <span class="n">instruction</span><span class="p">,</span> <span class="n">Instruction</span> <span class="n">replace</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="n">instruction</span><span class="p">.</span><span class="n">OpCode</span><span class="p">,</span> <span class="n">instruction</span><span class="p">.</span><span class="n">Operand</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="n">replace</span><span class="p">.</span><span class="n">OpCode</span><span class="p">,</span> <span class="n">replace</span><span class="p">.</span><span class="n">Operand</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>RewriteThrowNotImplementedException内部で使用されます。<br>
ILの命令を置換するための拡張メソッドです。<br>
ILProcessorのReplaceメソッドはバグを誘発するわりと使い物にならないメソッドです。<br>
gotoやif, switchなどのジャンプ系の命令の行き先にまつわる致命的なバグを生じます。<br>
こうしてわざわざ拡張メソッドを用意する必要があるのです。<br>
</p>
</div></details><br>
<details><summary>ToDefinitionUtility.cs</summary><div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ToDefinitionUtility.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Mono.Cecil</span><span class="p">;</span>
<span class="k">internal</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">ToDefinitionUtility</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">static</span> <span class="n">TypeDefinition</span> <span class="nf">ToDefinition</span><span class="p">(</span><span class="k">this</span> <span class="n">TypeReference</span> <span class="n">reference</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">reference</span> <span class="k">switch</span>
  <span class="p">{</span>
    <span class="n">TypeDefinition</span> <span class="n">definition</span> <span class="p">=&gt;</span> <span class="n">definition</span><span class="p">,</span>
    <span class="n">GenericInstanceType</span> <span class="n">generic</span> <span class="p">=&gt;</span> <span class="n">generic</span><span class="p">.</span><span class="n">ElementType</span><span class="p">.</span><span class="nf">ToDefinition</span><span class="p">(),</span>
    <span class="n">_</span> <span class="p">=&gt;</span> <span class="n">reference</span><span class="p">.</span><span class="nf">Resolve</span><span class="p">(),</span>
  <span class="p">};</span>
  <span class="k">public</span> <span class="k">static</span> <span class="n">MethodDefinition</span> <span class="nf">ToDefinition</span><span class="p">(</span><span class="k">this</span> <span class="n">MethodReference</span> <span class="n">reference</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">reference</span> <span class="k">switch</span>
  <span class="p">{</span>
    <span class="n">MethodDefinition</span> <span class="n">definition</span> <span class="p">=&gt;</span> <span class="n">definition</span><span class="p">,</span>
    <span class="n">GenericInstanceMethod</span> <span class="n">generic</span> <span class="p">=&gt;</span> <span class="n">generic</span><span class="p">.</span><span class="n">ElementMethod</span><span class="p">.</span><span class="nf">ToDefinition</span><span class="p">(),</span>
    <span class="n">_</span> <span class="p">=&gt;</span> <span class="n">reference</span><span class="p">.</span><span class="nf">Resolve</span><span class="p">(),</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>特に気にする必要はない拡張メソッドです。<br>
Resolve()が例外を投げる可能性が結構あります。<br>
</p>
</div></details></p>

<p><details><summary>GenericInstanceUtility.cs</summary><div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">GenericInstanceUtility.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Mono.Cecil</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">internal</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">GenericInstanceUtility</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">static</span> <span class="n">FieldReference</span> <span class="nf">FindField</span><span class="p">(</span><span class="k">this</span> <span class="n">TypeReference</span> <span class="n">type</span><span class="p">,</span> <span class="kt">string</span> <span class="n">name</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="k">is</span> <span class="n">TypeDefinition</span> <span class="n">definition</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">definition</span><span class="p">.</span><span class="nf">FindField</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="k">is</span> <span class="n">GenericInstanceType</span> <span class="n">genericInstanceType</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">genericInstanceType</span><span class="p">.</span><span class="nf">FindField</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">typeDefinition</span> <span class="p">=</span> <span class="n">type</span><span class="p">.</span><span class="nf">ToDefinition</span><span class="p">();</span>
    <span class="kt">var</span> <span class="n">fieldDefinition</span> <span class="p">=</span> <span class="n">typeDefinition</span><span class="p">.</span><span class="n">Fields</span><span class="p">.</span><span class="nf">Single</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="n">name</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fieldDefinition</span><span class="p">.</span><span class="n">Module</span> <span class="p">==</span> <span class="n">type</span><span class="p">.</span><span class="n">Module</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">fieldDefinition</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">type</span><span class="p">.</span><span class="n">Module</span><span class="p">.</span><span class="nf">ImportReference</span><span class="p">(</span><span class="n">fieldDefinition</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">public</span> <span class="k">static</span> <span class="n">FieldReference</span> <span class="nf">FindField</span><span class="p">(</span><span class="k">this</span> <span class="n">TypeDefinition</span> <span class="n">type</span><span class="p">,</span> <span class="kt">string</span> <span class="n">name</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">type</span><span class="p">.</span><span class="n">Fields</span><span class="p">.</span><span class="nf">Single</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="n">name</span><span class="p">);</span>

  <span class="k">public</span> <span class="k">static</span> <span class="n">FieldReference</span> <span class="nf">FindField</span><span class="p">(</span><span class="k">this</span> <span class="n">GenericInstanceType</span> <span class="n">type</span><span class="p">,</span> <span class="kt">string</span> <span class="n">name</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="kt">var</span> <span class="n">typeDefinition</span> <span class="p">=</span> <span class="n">type</span><span class="p">.</span><span class="nf">ToDefinition</span><span class="p">();</span>
    <span class="kt">var</span> <span class="n">definition</span> <span class="p">=</span> <span class="n">typeDefinition</span><span class="p">.</span><span class="n">Fields</span><span class="p">.</span><span class="nf">Single</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="n">name</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">definition</span><span class="p">.</span><span class="nf">MakeHostInstanceGeneric</span><span class="p">(</span><span class="n">type</span><span class="p">.</span><span class="n">GenericArguments</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">static</span> <span class="n">FieldReference</span> <span class="nf">MakeHostInstanceGeneric</span><span class="p">(</span><span class="k">this</span> <span class="n">FieldReference</span> <span class="n">self</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TypeReference</span><span class="p">&gt;</span> <span class="n">arguments</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">FieldReference</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">FieldType</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">DeclaringType</span><span class="p">.</span><span class="nf">MakeGenericInstanceType</span><span class="p">(</span><span class="n">arguments</span><span class="p">));</span>

  <span class="k">public</span> <span class="k">static</span> <span class="n">GenericInstanceType</span> <span class="nf">MakeGenericInstanceType</span><span class="p">(</span><span class="k">this</span> <span class="n">TypeReference</span> <span class="n">self</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TypeReference</span><span class="p">&gt;</span> <span class="n">arguments</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="kt">var</span> <span class="n">instance</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GenericInstanceType</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">argument</span> <span class="k">in</span> <span class="n">arguments</span><span class="p">)</span>
      <span class="n">instance</span><span class="p">.</span><span class="n">GenericArguments</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">argument</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">instance</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p></p>
</div></details></p>

<h2>
<span id="ciyamlをアップデート" class="fragment"></span><a href="#ciyaml%E3%82%92%E3%82%A2%E3%83%83%E3%83%97%E3%83%87%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>CI.yamlをアップデート</h2>

<p><details><summary>post~によりUniNativeLinq.dllにポストプロセスをする必要があり、CI.yamlを書き換えます。</summary><div>

<p><details><summary>CI.yaml全文</summary><div>

<div class="code-frame" data-lang="yaml">
<div class="code-lang"><span class="bold">CI.yaml</span></div>
<div class="highlight"><pre class="with-code"><code><span class="na">name</span><span class="pi">:</span> <span class="s">CreateRelease</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">develop</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">buildReleaseJob</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">unity-version</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">2018.4.9f1</span><span class="pi">]</span>
        <span class="na">user-name</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">pCYSl5EDgo</span><span class="pi">]</span>
        <span class="na">repository-name</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">HandsOn_CSharpAdventCalendar20191201</span><span class="pi">]</span>
        <span class="na">exe</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">/opt/Unity/Editor/Unity'</span><span class="pi">]</span>

    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">pCYSl5EDgo/setup-unity@master</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">unity-version</span><span class="pi">:</span> <span class="s">${{ matrix.unity-version }}</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">License Activation</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">echo -n "$ULF" &gt; unity.ulf</span>
        <span class="s">${{ matrix.exe }} -nographics -batchmode -quit -logFile -manualLicenseFile ./unity.ulf || exit 0</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="na">ULF</span><span class="pi">:</span> <span class="s">${{ secrets.ulf }}</span>

    <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">git clone https://github.com/${{ github.repository }}</span>

    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-dotnet@v1.0.2</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">dotnet-version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.0.101'</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Builds DLL</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">cd ${{ matrix.repository-name }}/core~</span>
        <span class="s">dotnet build -c Release</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Post Process DLL</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">cd ${{ matrix.repository-name }}/post~</span>
        <span class="s">ls -l ../Assets/Plugins/UNL/</span>
        <span class="s">dotnet run ../core~/bin/Release/netstandard2.0/UniNativeLinq.dll ../Assets/Plugins/UNL/UniNativeLinq.dll</span>
        <span class="s">ls -l ../Assets/Plugins/UNL/</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run Test</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">${{ matrix.exe }} -batchmode -nographics -projectPath ${{ matrix.repository-name }} -logFile ./log.log -runEditorTests -editorTestsResultFile ../result.xml || exit </span><span class="m">0</span>

    <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">ls -l</span>
    <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">cat log.log</span>
    <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">cat result.xml</span>

    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">pCYSl5EDgo/Unity-Test-Runner-Result-XML-interpreter@master</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">interpret</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">result.xml</span>

    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">steps.interpret.outputs.success != 'true'</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">exit </span><span class="m">1</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get Version</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">cd ${{ matrix.repository-name }}</span>
        <span class="s">git describe --tags 1&gt; ../version 2&gt; ../error || exit 0</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cat Error</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">pCYSl5EDgo/cat@master</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">error</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">error</span>

    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">startsWith(steps.error.outputs.text, 'fatal') != 'true'</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">cat version</span>
        <span class="s">cat version | awk '{ split($0, versions, "-"); split(versions[1], numbers, "."); numbers[3]=numbers[3]+1; variable=numbers[1]"."numbers[2]"."numbers[3]; print variable; }' &gt; version_increment</span>

    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">startsWith(steps.error.outputs.text, 'fatal')</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">echo -n "0.0.1" &gt; version_increment</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cat</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">pCYSl5EDgo/cat@master</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">version</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">version_increment</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create Release</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">create_release</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/create-release@v1.0.0</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">tag_name</span><span class="pi">:</span> <span class="s">${{ steps.version.outputs.text }}</span>
        <span class="na">release_name</span><span class="pi">:</span> <span class="s">Release Unity${{ matrix.unity-tag }} - v${{ steps.version.outputs.text }}</span>
        <span class="na">draft</span><span class="pi">:</span> <span class="no">false</span>
        <span class="na">prerelease</span><span class="pi">:</span> <span class="no">false</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upload DLL</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/upload-release-asset@v1.0.1</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">upload_url</span><span class="pi">:</span> <span class="s">${{ steps.create_release.outputs.upload_url }}</span>
        <span class="na">asset_path</span><span class="pi">:</span> <span class="s">${{ matrix.repository-name }}/core~/bin/Release/netstandard2.0/UniNativeLinq.dll</span>
        <span class="na">asset_name</span><span class="pi">:</span> <span class="s">UniNativeLinq.dll</span>
        <span class="na">asset_content_type</span><span class="pi">:</span> <span class="s">application/vnd.microsoft.portable-executable</span>
</code></pre></div>
</div>

<p></p>
</div></details><br>
<details><summary>変更箇所のみ抜粋</summary><div>

<div class="code-frame" data-lang="yaml">
<div class="code-lang"><span class="bold">CI.yaml</span></div>
<div class="highlight"><pre class="with-code"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Builds DLL</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">mkdir artifact</span>
    <span class="s">cd ${{ matrix.repository-name }}/core~</span>
    <span class="s">dotnet build -c Release</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Post Process DLL</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">cd ${{ matrix.repository-name }}/post~</span>
    <span class="s">dotnet run ../core~/bin/Release/netstandard2.0/UniNativeLinq.dll ../Assets/Plugins/UNL/UniNativeLinq.dll</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">License Activation</span>
</code></pre></div>
</div>

<p></p>
</div></details><br>
</p>
</div></details></p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">git</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="o">.</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">commit</span><span class="w"> </span><span class="nt">-m</span><span class="w"> </span><span class="s2">"[add]post~ prot-process project"</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="nx">push</span><span class="w">
</span></code></pre></div>
</div>

<h1>
<span id="第3章-補足" class="fragment"></span><a href="#%E7%AC%AC3%E7%AB%A0-%E8%A3%9C%E8%B6%B3"><i class="fa fa-link"></i></a>第3章 補足</h1>

<h2>
<span id="unitypackage化" class="fragment"></span><a href="#unitypackage%E5%8C%96"><i class="fa fa-link"></i></a>UnityPackage化</h2>

<p>ライブラリをGitHubから提供するならば素のDLLを提供するだけというのも不親切です。<br>
やはりunitypackageファイルをGitHub Releasesから提供したいものです。</p>

<p>この節ではコマンドラインからUnityを操作してunitypackageを作成します。<br>
Unityのコマンドラインの機能自体ではunitypackageを作成することは不可能ですが、プロジェクトのEditorフォルダ直下に存在するクラスのstaticメソッドを呼び出すことが可能です。<br>
<a href="https://docs.unity3d.com/ja/2018.4/ScriptReference/AssetDatabase.ExportPackage.html" rel="nofollow noopener" target="_blank">UnityEditor.AssetDatabase.ExportPackageメソッド</a>をstaticメソッド内で呼び出してunitypackageを作成します。</p>

<p>現在のワーキングディレクトリはUniNativeLinqHandsOnのはずです。</p>

<div class="code-frame" data-lang="powershell">
<div class="code-lang"><span class="bold">powershell</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">mkdir</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">Assets/Editor</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">Assets/Editor/UnityPackageBuilder.cs</span><span class="w">
</span></code></pre></div>
</div>

<p><details><summary>UnityPackageBuilder.cs</summary><div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">UnityPackageBuilder.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">HandsOn</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">UnityPackageBuilder</span>
  <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Build</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="kt">string</span><span class="p">[]</span> <span class="n">args</span> <span class="p">=</span> <span class="n">Environment</span><span class="p">.</span><span class="nf">GetCommandLineArgs</span><span class="p">();</span>
      <span class="kt">string</span> <span class="n">exportPath</span> <span class="p">=</span> <span class="n">args</span><span class="p">[</span><span class="n">args</span><span class="p">.</span><span class="n">Length</span> <span class="p">-</span> <span class="m">1</span><span class="p">];</span>
      <span class="n">AssetDatabase</span><span class="p">.</span><span class="nf">ExportPackage</span><span class="p">(</span>
      <span class="k">new</span><span class="p">[]{</span>
        <span class="s">"Assets/Plugins/UNL/UniNativeLinq.dll"</span>
      <span class="p">},</span>
      <span class="n">exportPath</span><span class="p">,</span>
      <span class="n">ExportPackageOptions</span><span class="p">.</span><span class="n">Default</span>
      <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>コマンドラインから呼び出すメソッドのシグネチャは必ずSystem.Actionである必要があります。<br>
コマンドライン引数を扱いたい場合には<a href="https://docs.microsoft.com/en-us/dotnet/api/system.environment.getcommandlineargs?view=netframework-4.8" rel="nofollow noopener" target="_blank">System.Environment.GetCommandLineArgsメソッド</a>から適切に文節処理された文字列の配列を受け取りましょう。</p>

<p>これは今回限りの約束事ですが、最後のコマンドライン引数がunitypackageの出力先のパスを示すようにします。</p>

<p>AssetDatabase.ExportPackageの第一引数にstring[]を渡してunitypackageを構築します。<br>
ここで渡すファイルのパスはプロジェクトのルートに対する相対パスですね。<br>
</p>
</div></details></p>

<p>HandsOn.UnityPackageBuilder.BuildをGitHub Actionsから呼び出し、リリースに同梱します。<br>
<details><summary>yamlファイルの最後に追記する部分（インデントには気を付けてください）</summary><div>

<div class="code-frame" data-lang="yaml">
<div class="code-lang"><span class="bold">CI.yamlへの追記</span></div>
<div class="highlight"><pre class="with-code"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create UnityPackage</span>
  <span class="na">run</span><span class="pi">:</span> <span class="s">${{ matrix.exe }} -batchmode -nographics -quit -projectPath ${{ matrix.repository-name }} -logFile ./log.log -executeMethod HandsOn.UnityPackageBuilder.Build "../UniNativeLinq.unitypackage"</span>
<span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">cat log.log</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upload Unity Package</span>
  <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/upload-release-asset@v1.0.1</span>
  <span class="na">env</span><span class="pi">:</span>
    <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
  <span class="na">with</span><span class="pi">:</span>
    <span class="na">upload_url</span><span class="pi">:</span> <span class="s">${{ steps.create_release.outputs.upload_url }}</span>
    <span class="na">asset_path</span><span class="pi">:</span> <span class="s">UniNativeLinq.unitypackage</span>
    <span class="na">asset_name</span><span class="pi">:</span> <span class="s">UniNativeLinq.unitypackage</span>
    <span class="na">asset_content_type</span><span class="pi">:</span> <span class="s">application/x-gzip</span>
</code></pre></div>
</div>

<p></p>
</div></details></p>

<h1>
<span id="終わりに" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>終わりに</h1>

<p><a href="https://github.com/pCYSl5EDgo/UniNativeLinq-EditorExtension" rel="nofollow noopener" target="_blank">UniNativeLinq本家</a>ではエディタ拡張に関連して更にえげつない最適化やMono.Cecilテクニックが使用されています。<br>
既存のLINQに比べて非常に高速に動作しますので是非使ってください。</p>

<p>このハンズオンよりも更に深くMono.CecilやUniNativeLinqを学びたいという方は<a href="https://twitter.com/pCYSl5EDgo" rel="nofollow noopener" target="_blank">私のTwitter</a>のDMなどでご相談いただければ嬉しいです。</p>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>画像はUnityのサイトより引用 <a href="#fnref1">↩</a></p>
</li>

</ol>
</div>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2FpCYSl5EDgo%2Fitems%2Fcc5cc080dea1cc076b25&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2FpCYSl5EDgo%2Fitems%2Fcc5cc080dea1cc076b25&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/pCYSl5EDgo/items/cc5cc080dea1cc076b25/likers" class="css-1iupg5d">11</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">6</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/cc5cc080dea1cc076b25/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/pCYSl5EDgo/items/cc5cc080dea1cc076b25/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/pCYSl5EDgo/items/cc5cc080dea1cc076b25/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/pCYSl5EDgo/items/cc5cc080dea1cc076b25/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/pCYSl5EDgo/items/cc5cc080dea1cc076b25.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-bcd696ca-5945-4653-adb8-6b2f9c70fe0e">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-e585b740-3593-4244-895d-06ebb9cd05b2"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-e585b740-3593-4244-895d-06ebb9cd05b2">{}</script>
      
<div id="LoginModal-react-component-1f8dbff3-b4bf-4475-8140-7edeeb52a4b4"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-1f8dbff3-b4bf-4475-8140-7edeeb52a4b4">{}</script>
      
<div id="StockModal-react-component-9ab433a2-901b-4e0c-a661-462e72e45ba9"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-9ab433a2-901b-4e0c-a661-462e72e45ba9">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;37kjiRj3yxkKa9k3MxxTpEAGRKQSQi2UHABeRC6hOcqcTWAr02jnImtZ1P52dEvd8KPugnYVVsQIqrzqFM1U/Q==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003eこの記事は\u003ca href=\"https://qiita.com/advent-calendar/2019/unity\"\u003eUnity Advent Calendar 2019\u003c/a\u003eの第1日目の記事です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ハンズオンの目標\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%8F%E3%83%B3%E3%82%BA%E3%82%AA%E3%83%B3%E3%81%AE%E7%9B%AE%E6%A8%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eハンズオンの目標\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eMono.Cecilの使い方に慣れる\u003c/li\u003e\n\u003cli\u003eLINQの内部実装についての初歩の理解を得る\u003c/li\u003e\n\u003cli\u003eマネージドプラグイン開発に慣れる\u003c/li\u003e\n\u003cli\u003eGitHub Actionsに慣れる\u003c/li\u003e\n\u003cli\u003eUniNativeLinqのファンになる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eLINQについては結構資料がありますので、主にMono.CecilとGitHub Actionsについてこの記事で学んでいただければと思います。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"筆者の開発環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%AD%86%E8%80%85%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e筆者の開発環境\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eWindows10 Home \u003c/li\u003e\n\u003cli\u003eIntel Core i7-8750H\u003c/li\u003e\n\u003cli\u003eRAM 16GB\u003c/li\u003e\n\u003cli\u003eUnity\n\n\u003cul\u003e\n\u003cli\u003e2018.4.9f1\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e.NET Core 3.0\n\n\u003cul\u003e\n\u003cli\u003e3.0.101\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eVisual Studio 2019\n\n\u003cul\u003e\n\u003cli\u003e16.4.0 Preview2.0\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eGit\n\n\u003cul\u003e\n\u003cli\u003e2.24.0.windows.2\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eRider 2019.3 EAP\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"前提知識\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E6%8F%90%E7%9F%A5%E8%AD%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前提知識\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eC#\n\n\u003cul\u003e\n\u003cli\u003e値型、参照型の違いとパフォーマンス特性への理解　\u003ca href=\"https://ufcpp.net/study/csharp/oo_reference.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e参考文献：C# によるプログラミング入門  [メモリとリソース管理] 値型と参照型\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eforeachとそのコンパイラによる展開、特にパターンベースであることの理解　\u003ca href=\"https://ufcpp.net/study/csharp/sp_foreach.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e参考文献：C# によるプログラミング入門  [データ列処理] foreach\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eLINQのAPIに対する理解　\u003ca href=\"https://ufcpp.net/study/csharp/sp3_linq.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e参考文献：C# によるプログラミング入門  [データ列処理] LINQ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eIL\n\n\u003cul\u003e\n\u003cli\u003eC#のコードがIL(Intermediate Language)の集合にコンパイルされるということへの理解　\u003ca href=\"https://ja.wikipedia.org/wiki/%E5%85%B1%E9%80%9A%E4%B8%AD%E9%96%93%E8%A8%80%E8%AA%9E\" rel=\"nofollow noopener\" target=\"_blank\"\u003e参考文献：ILに関するWikipedia記事\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e各命令についてわからないことがあれば\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/api/system.reflection.emit.opcodes?view=netframework-4.8\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMSDocsのOpCodesクラスの説明を読むのが良いでしょう\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUnity\n\n\u003cul\u003e\n\u003cli\u003eUnity2018でC#7.3の機能が使えるということの理解　\u003ca href=\"https://blogs.unity3d.com/jp/2018/12/13/introducing-unity-2018-3/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e参考文献：Unity公式ブログより「Unity 2018.3 リリース」\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eUnity2018からUnity.Collections.NativeArray\u0026lt;T\u0026gt;というアンマネージドなヒープやスタック上の連続したメモリ領域を表す配列的構造体についての理解\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.unity3d.com/ScriptReference/Unity.Collections.NativeArray_1.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e参考文献1：UnityのScriptingリファレンスのNativeArrayに関するページ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.urablog.xyz/entry/2018/03/24/140423\" rel=\"nofollow noopener\" target=\"_blank\"\u003e参考文献2：【Unity】アセット読書会に行ってきたよ。NativeArrayってなんだろう？\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eUnity.Collections.UnsafeUtilityというstatic classがNativeArrayの基礎であることへの理解　\u003ca href=\"https://qiita.com/mao_/items/fc9b4340b05e7e83c3ff\" id=\"reference-db20c6b21011523db266\"\u003e参考文献：【Unity】UnsafeUtilityについて纏めてみる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eUnsafeUtilityの詳細なAPIとその機能についての理解\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/pCYSl5EDgo/items/4b5a5e089eabc8f4387d\" id=\"reference-ef44d37c52693017fd3c\"\u003e参考文献1：【Unity】UnsafeUtility基礎論【入門者向け】\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.unity3d.com/ScriptReference/Unity.Collections.LowLevel.Unsafe.UnsafeUtility.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e参考文献2：UnityのScriptingリファレンスのUnsafeUtilityに関するページ\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eGitHub Actions\n\n\u003cul\u003e\n\u003cli\u003eGitHubに統合されたCI/CDサービスであることの理解　\u003ca href=\"https://help.github.com/ja/actions/automating-your-workflow-with-github-actions/about-github-actions\" rel=\"nofollow noopener\" target=\"_blank\"\u003e参考文献：GitHub Actionsについて\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUniNativeLinq\n\n\u003cul\u003e\n\u003cli\u003eNativeArray\u0026lt;T\u0026gt;向けのLINQライブラリであることの理解　\u003ca href=\"https://speakerdeck.com/pcysl5edgo/uninativelinq-unity2018shi-dai-falsenativearrayyong-linq\" rel=\"nofollow noopener\" target=\"_blank\"\u003e参考文献：UniNativeLinqに関して\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"事前にハンズオンを行う人がインストールしておくべきもの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BA%8B%E5%89%8D%E3%81%AB%E3%83%8F%E3%83%B3%E3%82%BA%E3%82%AA%E3%83%B3%E3%82%92%E8%A1%8C%E3%81%86%E4%BA%BA%E3%81%8C%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%97%E3%81%A6%E3%81%8A%E3%81%8F%E3%81%B9%E3%81%8D%E3%82%82%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e事前にハンズオンを行う人がインストールしておくべきもの\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eUnity2018.4\n\n\u003cul\u003e\n\u003cli\u003eUnityのバージョンについては2018.4系列である限りなんでもよいです。適宜読み替えを行ってください。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e.NET Core 3.0\u003c/li\u003e\n\u003cli\u003eVisual Studio2019またはRider2019.2以上\u003c/li\u003e\n\u003cli\u003eGit\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"第0章準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%AC%AC0%E7%AB%A0%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e第0章　準備\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"パス通し\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%91%E3%82%B9%E9%80%9A%E3%81%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eパス通し\u003c/h2\u003e\n\n\u003cp\u003e以後ターミナル操作はPowerShell上で行います。\u003c/p\u003e\n\n\u003cp\u003eまずUnity2018.4の実体のあるパスを追加します。\u003cbr\u003e\n私は\"コントロール パネル\\システムとセキュリティ\\システム\\システムの詳細設定\\環境変数\\Path\"に\"C:\\Users\\conve\\Documents\\Unity\\Editor\"と追加していますが、環境変数を汚したくない方は都度下のように書いてパスを通すのが良いのではないでしょうか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$\u003c/span\u003e\u003cspan class=\"nn\"\u003eEnv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"nv\"\u003ePath\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e+=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\";C:\\Program Files\\Unity\\Hub\\Editor\\2018.4.13f1\\Editor\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"作業ディレクトリ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%9C%E6%A5%AD%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e作業ディレクトリ\u003c/h2\u003e\n\n\u003cp\u003e適当なディレクトリの下に新規に作業ディレクトリを作成します。\u003cbr\u003e\n今回はUniNativeLinqHandsOnという名前にしましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003emkdir\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eUniNativeLinqHandsOn\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e前節で正常にパスが通っているならば次のシェルコマンドを実行してUnityエディタが起動するはずです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eunity\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-createProject\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e/UniNativeLinqHandsOn/\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e起動して図のようにエディタが正常に起動しましたか？\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/9cc6677a71805173ea1de05c9f838099677820ec/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235363034372f33373232643963662d323063352d376630612d346234622d3535326534323566353636372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2F3722d9cf-20c5-7f0a-4b4b-552e425f5667.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=deb50b363159eaef7a785590650bf584\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/256047/3722d9cf-20c5-7f0a-4b4b-552e425f5667.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2F3722d9cf-20c5-7f0a-4b4b-552e425f5667.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b5c09f3f607e3e2e1034760da00ca49e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eでは、一旦エディタを閉じましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"git初期化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#git%E5%88%9D%E6%9C%9F%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGit初期化\u003c/h2\u003e\n\n\u003cp\u003eGitHub Actionsを使う兼ね合いもあり、Gitのリポジトリを用意しましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ecd\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eUniNativeLinqHandsOn\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003einit\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eecho\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eLl\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"nx\"\u003eibrary/\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eLl\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"nx\"\u003eogs/\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eOo\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"nx\"\u003ebj/\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eidea\u003c/span\u003e\u003cspan class=\"nx\"\u003e/\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003evs\u003c/span\u003e\u003cspan class=\"nx\"\u003e/\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003evscode\u003c/span\u003e\u003cspan class=\"nx\"\u003e/\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003e/\u003c/span\u003e\u003cspan class=\"o\"\u003e*.\u003c/span\u003e\u003cspan class=\"nf\"\u003ecsproj\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003e/\u003c/span\u003e\u003cspan class=\"o\"\u003e*.\u003c/span\u003e\u003cspan class=\"nf\"\u003esln\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003e/\u003c/span\u003e\u003cspan class=\"o\"\u003e*.\u003c/span\u003e\u003cspan class=\"nf\"\u003esln\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003euser\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003e/TestResults-\u003c/span\u003e\u003cspan class=\"o\"\u003e*.\u003c/span\u003e\u003cspan class=\"nf\"\u003exml\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egitignore\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"マネージドプラグインの下拵え\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%89%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E4%B8%8B%E6%8B%B5%E3%81%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eマネージドプラグインの下拵え\u003c/h2\u003e\n\n\u003cp\u003eこれからUniNativeLinqの基礎となるNativeEnumerable\u0026lt;T\u0026gt; where T : unmanagedを実装します。\u003cbr\u003e\nマネージドプラグインとしてUnity外でDLLをビルドしますので、フォルダを作りましょう。フォルダ名は\"core~\"とします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003emkdir\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003ecore~\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003ecd\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003ecore~\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eDLLを作るためにdotnet newコマンドでclasslib（ライブラリ作成）オプションを指定して初期化します。\u003cbr\u003e\nClass1.csは特に要らないので削除します。\u003cbr\u003e\n追加で.gitignoreをこのフォルダにも定義します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003edotnet\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eclasslib\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003edel\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eClass1.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eecho\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003ebin/\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eobj/\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egitignore\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e次にcore~.csprojを編集します。\u003cbr\u003e\n初期状態では以下のように記述されているはずです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecore~.csproj\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;Project\u003c/span\u003e \u003cspan class=\"na\"\u003eSdk=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Microsoft.NET.Sdk\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\n  \u003cspan class=\"nt\"\u003e\u0026lt;PropertyGroup\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;TargetFramework\u0026gt;\u003c/span\u003enetstandard2.0\u003cspan class=\"nt\"\u003e\u0026lt;/TargetFramework\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;RootNamespace\u0026gt;\u003c/span\u003ecore_\u003cspan class=\"nt\"\u003e\u0026lt;/RootNamespace\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/PropertyGroup\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"nt\"\u003e\u0026lt;/Project\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003ecsprojの各要素の軽い解説\u003c/summary\u003e\u003cbr\u003e\n\u003cdiv\u003eUnity使いの方はcsprojファイルの中身をこれまで読んだ時に物凄く長くて冗長な記述を見てきたことでしょう。 そもそもcsprojの中身を読まない？　アッ、ハイ\u003cbr\u003e\nVisual Studio 2017の頃からcsprojの新しい形式としてSdk形式というものが登場しました。 \u003ca href=\"https://ufcpp.net/blog/2017/5/newcsproj/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e参考文献：ufcppのブログ記事\u003c/a\u003e\u003cbr\u003e\n全てを設定していた従来のものよりも、デフォルト値と異なる点のみ設定するSdk形式の方が非常に記述量が少なく可読性が高いですね。\u003cbr\u003e\n\u003ccode\u003e\u0026amp;lt;Project Sdk=\u0026amp;quot;Microsoft.NET.Sdk\u0026amp;quot;\u0026amp;gt;\u003c/code\u003eというトップレベルのProject要素にSdk属性が定義されている場合Sdk形式となります。\n\n\u003cp\u003ePropertyGroup要素以下に基本設定を記述します。\u003cbr\u003e\nTargetFarmework要素にビルド対象のプラットフォーム/フレームワークを指定します。\u003cbr\u003e\nUnity2018以上で使うことを考え、.NET Standard 2.0を意味するnetstandard2.0を指定しておきます。\u003c/p\u003e\n\n\u003cp\u003eRootNamespace要素はVisual Studioで新規にcsファイルを作成する時に使用される名前空間を指定します。\u003cbr\u003e\n\u003c/p\u003e\n\u003c/div\u003e\n\u003cbr\u003e\n\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003e上記csprojを編集して以下の通りにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecore~.csproj\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;Project\u003c/span\u003e \u003cspan class=\"na\"\u003eSdk=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Microsoft.NET.Sdk\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\n  \u003cspan class=\"nt\"\u003e\u0026lt;PropertyGroup\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;TargetFramework\u0026gt;\u003c/span\u003enetstandard2.0\u003cspan class=\"nt\"\u003e\u0026lt;/TargetFramework\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;RootNamespace\u0026gt;\u003c/span\u003eUniNativeLinq\u003cspan class=\"nt\"\u003e\u0026lt;/RootNamespace\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;AllowUnsafeBlocks\u0026gt;\u003c/span\u003eTrue\u003cspan class=\"nt\"\u003e\u0026lt;/AllowUnsafeBlocks\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;AssemblyName\u0026gt;\u003c/span\u003eUniNativeLinq\u003cspan class=\"nt\"\u003e\u0026lt;/AssemblyName\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;LangVersion\u0026gt;\u003c/span\u003e8\u003cspan class=\"nt\"\u003e\u0026lt;/LangVersion\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/PropertyGroup\u0026gt;\u003c/span\u003e\n\n  \u003cspan class=\"nt\"\u003e\u0026lt;ItemGroup\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;Reference\u003c/span\u003e \u003cspan class=\"na\"\u003eInclude=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"UnityEngine.CoreModule\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;HintPath\u0026gt;\u003c/span\u003e○Unityのインストールしてあるフォルダ○\\Editor\\Data\\Managed\\UnityEngine\\UnityEngine.CoreModule.dll\u003cspan class=\"nt\"\u003e\u0026lt;/HintPath\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/Reference\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/ItemGroup\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/Project\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eAllowUnsafeBlocks要素をTrueにしてポインタを使用可能にします。\u003cbr\u003e\nAssemblyName要素によりアセンブリ名と出力されたDllファイルの名前を指定します。\u003cbr\u003e\nそして、LangVersion要素を8に指定してunmanaged型制約の判定を緩めます。　\u003ca href=\"https://ufcpp.net/study/csharp/sp_unsafe.html#unmanaged-generic-struct\" rel=\"nofollow noopener\" target=\"_blank\"\u003e参考文献：アンマネージな総称型に関するunmanaged型制約\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e最後に、ItemGroup/Reference要素でUnityEngine.CoreModule.dllを参照に追加しましょう。\u003cbr\u003e\nUnityのランタイムで使用される基本的な機能はUnityEngine.CoreModule.dllを通じて提供されています。\u003c/p\u003e\n\n\u003cp\u003e以上で最初の下拵えを終わります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"第1章uninativelinq-coreの最低限の実装1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%AC%AC1%E7%AB%A0uninativelinq-core%E3%81%AE%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AE%E5%AE%9F%E8%A3%851\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e第1章　UniNativeLinq-Coreの最低限の実装(1)\u003c/h1\u003e\n\n\u003cp\u003e現在の作業ディレクトリが\"UniNativeLinqHandsOn/core~\"であることを確認してください。\u003c/p\u003e\n\n\u003cp\u003eこれから私達は以下のファイル群を作成し、UniNativeLinqのコア機能を最低限の形で実装していきます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eNativeEnumerable.cs\n\n\u003cul\u003e\n\u003cli\u003eNativeEnumerable\u0026lt;T\u0026gt;構造体を定義します。\u003c/li\u003e\n\u003cli\u003eNativeArray\u0026lt;T\u0026gt;に対してSpan\u0026lt;T\u0026gt;的な役割を果たす基本的な構造体です。\u003c/li\u003e\n\u003cli\u003eIRefEnumerable\u0026lt;T\u0026gt;を実装します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eIRefEnumerable.cs\n\n\u003cul\u003e\n\u003cli\u003eSystem.Collections.IEnumerable\u0026lt;T\u0026gt;を継承したIRefEnumerable\u0026lt;TEnumerator, T\u0026gt;インターフェイスを定義します。\u003c/li\u003e\n\u003cli\u003e通常のIEnumerable\u0026lt;T\u0026gt;の型引数が1つであるのに対して、IRefEnumerable\u0026lt;TEnumerator, T\u0026gt;の型引数が2つであるのは、構造体イテレータのボクシングを避ける目的があります。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eIRefEnumerator.cs\n\n\u003cul\u003e\n\u003cli\u003eSystem.Collections.IEnumerator\u0026lt;T\u0026gt;を継承したIRefEnumerator\u0026lt;T\u0026gt;インターフェイスを定義します。\u003c/li\u003e\n\u003cli\u003eforeach(ref var item in collection)のような参照をイテレーションするための種々の操作を定義します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAsRefEnumerable.cs\n\n\u003cul\u003e\n\u003cli\u003eNativeEnumerable静的クラスを定義します。\u003c/li\u003e\n\u003cli\u003eNativeEnumerable\u0026lt;T\u0026gt;構造体と名前がほぼ同じですが別物です。\u003c/li\u003e\n\u003cli\u003eNativeArray\u0026lt;T\u0026gt;とT[]に対して拡張メソッドを定義します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003emkdir\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eCollection\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003emkdir\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eInterface\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003emkdir\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eUtility\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003emkdir\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eAPI\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eCollection/NativeEnumerable.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eInterface/IRefEnumerator.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eInterface/IRefEnumerable.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eAPI/AsRefEnumerable.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"nativeenumerabletの最初の定義\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nativeenumerablet%E3%81%AE%E6%9C%80%E5%88%9D%E3%81%AE%E5%AE%9A%E7%BE%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eNativeEnumerable\u0026lt;T\u0026gt;の最初の定義\u003c/h2\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003e最初のNativeEnumerable.cs\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNativeEnumerable.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUniNativeLinq\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eNativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eunmanaged\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ePtr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eNativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePtr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"n\"\u003ePtr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003ePtr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003eunsafeでreadonlyな構造体UniNativeLinq.NativeEnumerable\u0026lt;T\u0026gt;を定義します。\u003cbr\u003e\nこれはジェネリックなTのポインタであるPtrと要素数であるLengthフィールドを露出させています。\u003cbr\u003e\nnullポインタやダングリングポインタに対する安全性保証は一切ないので、その辺りはエンドユーザーに一切合切投げっぱなしになるC++スタイルです。\u003c/p\u003e\n\n\u003cp\u003eこれをビルドし、テストコードをUnityの方で実行してみましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"最低限のテスト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最低限のテスト\u003c/h2\u003e\n\n\u003cp\u003e現在のワーキングディレクトリは\"UniNativeLinqHandsOn/core~\"のはずです。\u003cbr\u003e\n以下のようにAssets以下Plugins/UNLフォルダを作成し、core~のビルド成果物であるUniNativeLinq.dllをコピーして配置します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003emkdir\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-p\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e..\u003c/span\u003e\u003cspan class=\"nx\"\u003e/Assets/Plugins/UNL\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003edotnet\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003ebuild\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-c\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eRelease\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003ecp\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-Force\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e/bin/Release/netstandard2.0/UniNativeLinq.dll\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e..\u003c/span\u003e\u003cspan class=\"nx\"\u003e/Assets/Plugins/UNL/UniNativeLinq.dll\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eビルドした後毎回\"cp -Force ほげほげ\"と入力するのも面倒ですので、core~.csprojにビルド後イベントを定義して自動化します。\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eビルド後イベントでコピーを自動化したcsproj\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecore.csproj\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;Project\u003c/span\u003e \u003cspan class=\"na\"\u003eSdk=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Microsoft.NET.Sdk\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\n  \u003cspan class=\"nt\"\u003e\u0026lt;PropertyGroup\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;TargetFramework\u0026gt;\u003c/span\u003enetstandard2.0\u003cspan class=\"nt\"\u003e\u0026lt;/TargetFramework\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;RootNamespace\u0026gt;\u003c/span\u003eUniNativeLinq\u003cspan class=\"nt\"\u003e\u0026lt;/RootNamespace\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;AllowUnsafeBlocks\u0026gt;\u003c/span\u003eTrue\u003cspan class=\"nt\"\u003e\u0026lt;/AllowUnsafeBlocks\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;LangVersion\u0026gt;\u003c/span\u003e8\u003cspan class=\"nt\"\u003e\u0026lt;/LangVersion\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;AssemblyName\u0026gt;\u003c/span\u003eUniNativeLinq\u003cspan class=\"nt\"\u003e\u0026lt;/AssemblyName\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/PropertyGroup\u0026gt;\u003c/span\u003e\n\n  \u003cspan class=\"nt\"\u003e\u0026lt;ItemGroup\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;Reference\u003c/span\u003e \u003cspan class=\"na\"\u003eInclude=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"UnityEngine.CoreModule\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;HintPath\u0026gt;\u003c/span\u003e○Unityのインストールしてあるフォルダ○\\Editor\\Data\\Managed\\UnityEngine\\UnityEngine.CoreModule.dll\u003cspan class=\"nt\"\u003e\u0026lt;/HintPath\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/Reference\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/ItemGroup\u0026gt;\u003c/span\u003e\n\n  \u003cspan class=\"nt\"\u003e\u0026lt;Target\u003c/span\u003e \u003cspan class=\"na\"\u003eName=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"PostBuild\"\u003c/span\u003e \u003cspan class=\"na\"\u003eAfterTargets=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"PostBuildEvent\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;Exec\u003c/span\u003e \u003cspan class=\"na\"\u003eCommand=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"copy $(TargetPath) $(ProjectDir)..\\Assets\\Plugins\\UNL\\UniNativeLinq.dll\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/Target\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/Project\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003eビルド後イベントでローカルデプロイの自動化は結構重宝しますのでオススメです。\u003c/p\u003e\n\n\u003cp\u003eさて、Assets/Plugins/UNL以下にdllを配置しましたので、それを対象としたテストコードを書きましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ecd\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e..\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eunity\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-projectPath\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eエディタが起動しましたね？\u003cbr\u003e\nProjectタブのAssetsを選択してコンテキストメニューから\"Create/Testing/Tests Assembly Folder\"を選択してTestsフォルダーを作成してください。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/710865b533422d45b9ccf617be712f7f1c210060/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235363034372f65656537333533382d306433642d323737312d333538352d6265313738356138376439662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2Feee73538-0d3d-2771-3585-be1785a87d9f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4790d961781f095b93a606e33ec84085\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/256047/eee73538-0d3d-2771-3585-be1785a87d9f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2Feee73538-0d3d-2771-3585-be1785a87d9f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=22373a01703565e9475335dde2482462 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e無事にTestsフォルダが作成されたならばそのフォルダ以下にTests.asmdefファイルがあるはずです。\u003cbr\u003e\nそれを選択し、Inspectorタブから設定を変更します。\u003cbr\u003e\n\"Allow 'unsafe' Code\"と\"Override References\"にチェックを入れ、\"Assembly References\"に\"UniNativeLinq.dll\"を加えてください。\u003cbr\u003e\nそしてPlatformsをEditorだけにしてください。\u003cbr\u003e\n次の画像のようなInspectorになるはずです。正しく設定できたならば一番下のApplyボタンを押して設定を保存してください。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f6695e988bb2b6bad0a18687905c003e9b12724e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235363034372f64666666616665332d626166642d656666362d616433382d3361333631396138306337332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2Fdfffafe3-bafd-eff6-ad38-3a3619a80c73.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f702eed7748092c220ae19e2de6e78d8\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/256047/dfffafe3-bafd-eff6-ad38-3a3619a80c73.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2Fdfffafe3-bafd-eff6-ad38-3a3619a80c73.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=36829c8215abdfc1fd23f6bfbe550e8c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e次にProjectタブでAssets/Testsフォルダを右クリックしてコンテキストメニューを呼び出し、\"Create/Testing/C# Test Script\"を押して新規にテスト用スクリプトを作成します。\u003cbr\u003e\nファイル名は\"NativeEnumerableTestScript\"としましょう。\u003c/p\u003e\n\n\u003cp\u003eNativeEnumerableTestScriptをダブルクリックして編集を行います。\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eNativeEnumerableTestScript.csの中身\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNativeEnumerableTestScript.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eNUnit.Framework\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUniNativeLinq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnity.Collections\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnity.Collections.LowLevel.Unsafe\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eTests\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003esealed\u003c/span\u003e \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNativeEnumerableTestScript\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eTest\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDefaultValuePass\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eNativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0L\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePtr\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0L\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(-\u003c/span\u003e\u003cspan class=\"m\"\u003e10L\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(-\u003c/span\u003e\u003cspan class=\"m\"\u003e12241L\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMinValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eZeroOrNegativeCountTest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePersistent\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetUnsafePtr\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e*)\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetUnsafePtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0L\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePtr\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e  \n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTemp\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTemp\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTemp\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e114\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTemp\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTempJob\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTempJob\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTempJob\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e114\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTempJob\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePersistent\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePersistent\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePersistent\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e114\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePersistent\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eFromNativeArrayPass\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e \u003cspan class=\"n\"\u003eallocator\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eallocator\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e*)\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetUnsafePtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n          \u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n          \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003cbr\u003e\n上記コードに従ってUnity Test Runnerの為のEditor Mode Testを複数個用意します。\u003cbr\u003e\nNUnit.Framework.TestCase属性はバリエーションを作り出すのにかなり便利な属性です。\u003c/p\u003e\n\n\u003cp\u003eテストコードの記述後はエディタに戻り、Unity Test Runnerのウィンドウを呼び出しましょう。メニューの\"Window/General/Test Runner\"をクリックすると開きます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/5e2e5f05e6b52f73d6180f525219640e15ef865e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235363034372f65316266376365312d636332612d316239332d656430362d3837383166356636333364352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2Fe1bf7ce1-cc2a-1b93-ed06-8781f5f633d5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1f3cb30c59d26feb211259f48f28c97b\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/256047/e1bf7ce1-cc2a-1b93-ed06-8781f5f633d5.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2Fe1bf7ce1-cc2a-1b93-ed06-8781f5f633d5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5bf83d1ea57e170fd6551e07a76e11b1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e出てきたウィンドウのRun Allを押すと全ての項目が緑になり、テスト全てをPassしたことがわかります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b11efe73be3fef53af05cb912eaf57786d760ac9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235363034372f30353338643631362d666138622d326662352d313062652d3766643937316139623466642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2F0538d616-fa8b-2fb5-10be-7fd971a9b4fd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4ed3387861731b735efd8198b6fe72d3\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/256047/0538d616-fa8b-2fb5-10be-7fd971a9b4fd.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2F0538d616-fa8b-2fb5-10be-7fd971a9b4fd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5c7642aaaee9502eb50cb7081a06d9c9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"githubにリポジトリを作って成果物を公開する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#github%E3%81%AB%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E6%88%90%E6%9E%9C%E7%89%A9%E3%82%92%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGitHubにリポジトリを作って成果物を公開する\u003c/h2\u003e\n\n\u003cp\u003eGitHubに適当なリポジトリ名で新規リポジトリを作成してください。そこにこのプロジェクトを公開します。\u003cbr\u003e\n私は\"HandsOn_CSharpAdventCalendar20191201\"と命名しました。\u003cbr\u003e\n現在のワーキングディレクトリはUniNativeLinqHandsOnのはずです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eswitch\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-c\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003edevelop\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eadd\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003ecommit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-m\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"[init]\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eremote\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eadd\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eorigin\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003ehttps://github.com/pCYSl5EDgo/HandsOn_CSharpAdventCalendar20191201.git\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-u\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eorigin\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003edevelop\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003egit remote add origin https://github.com/pCYSl5EDgo/HandsOn_CSharpAdventCalendar20191201.git\u003c/code\u003eについては適切な読み替えを行ってください。\u003cbr\u003e\n適切な.gitignore設定を行っているならば上記の操作で最初のコミットを過不足なくできます。\u003c/p\u003e\n\n\u003cp\u003e基本的にローカルのワーキングブランチはdevelopとし、リモートリポジトリのdevelopブランチにpushすることとします。\u003cbr\u003e\nこの措置はリモートのmasterブランチをUPM用にする為のものです。Assetsを含む通常のUnityプロジェクトはUPMの構成と相性が悪いのです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"github-actions対応-cicdを行う\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#github-actions%E5%AF%BE%E5%BF%9C-cicd%E3%82%92%E8%A1%8C%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGitHub Actions対応 CI/CDを行う\u003c/h2\u003e\n\n\u003cp\u003eこれからGitHub ReleasesでUniNativeLinq.dllをpush時に自動的に公開する仕組みを作ります。その際にテストも走らせ、テスト失敗時はリリースしないようにします。\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eGitHub ActionsでUnityを使うための下拵え　\u003ca href=\"https://qiita.com/pCYSl5EDgo/items/690dd56ffb0fcf64e70b\" id=\"reference-f34ff71be099a0c52076\"\u003e参考文献：GitHub ActionsでUnity開発\u003c/a\u003e\u003c/summary\u003e\u003cdiv\u003eGitHub ActionsではLinux, Windows, MacOSXの３種類の環境でCI/CDを行うことができます。\u003cbr\u003e\nCI/CDサービスからUnityを利用する場合にはLinux環境を利用する形になります。\u003cbr\u003e\n\u003cdetails\u003e\u003csummary\u003eなぜWindowsやMacではなくLinuxなのかについての補足\u003c/summary\u003e\u003cdiv\u003eWindowsやMacOS環境でも\u003ca href=\"https://github.com/pCYSl5EDgo/setup-unity\" rel=\"nofollow noopener\" target=\"_blank\"\u003epCYSl5EDgo/setup-unity\u003c/a\u003eというGitHub Actionを利用してUnityをインストール可能です。\u003cbr\u003e\nWinやMacはVMインスタンスとして立ち上がるので、ジョブ毎にMachine IDが変化します。\u003cbr\u003e\n困ったことに後述するalfファイルの項目にMachine IDがありまして、ここがulfにも受け継がれてしまい、不一致だと認証にコケるのです。\u003cbr\u003e\n故にulfファイルを使用してオフライン認証を行う手法をWindowsとMacOS環境では取り得ません。\u003c/div\u003e\u003c/details\u003e\n\n\u003cp\u003eUnityを利用するためには必ずメールアドレスとパスワードで認証する必要があります。\u003cbr\u003e\nCUIで認証する場合には\u003ca href=\"https://docs.unity3d.com/ja/2017.4/Manual/ManualActivationGuide.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eオフライン/ 手動アクティベーション\u003c/a\u003eを行う方がパスワード漏洩対策として安全です。\u003cbr\u003e\nこれは事前にUnityを動かすPCの情報と、Unityのバージョン、ユーザーのパスワードとメールアドレス等全ての情報を含んだulfファイルを生成しておき、GitHub Actionsでの実行時にulfファイルを使用して認証を行うという手法です。\u003c/p\u003e\n\n\u003cp\u003e詳細な手順は\u003ca href=\"https://docs.unity3d.com/ja/2017.4/Manual/ManualActivationGuide.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e公式の参考文献\u003c/a\u003eを読んで理解していただくとして、次のような手順でulfファイルを作成してください。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/pCYSl5EDgo/CreateALF/releases\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/pCYSl5EDgo/CreateALF/releases\u003c/a\u003e から v1028.4.12f1.alfをダウンロード\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://license.unity3d.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ealfファイルを元にulfファイルにするためのUnityの提供するウェブページ\u003c/a\u003eに行き、Unityにログインする（ログイン済の方はメールアドレスとパスワード入力不要）\u003c/li\u003e\n\u003cli\u003ealfファイルをアップロード \u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"画像はUnityのサイトより引用\"\u003e1\u003c/a\u003e\u003c/sup\u003e \u003ca href=\"https://camo.qiitausercontent.com/38a8cd11d852225f9ecfa5aba2a4c12cd9f85bfa/68747470733a2f2f646f63732e756e69747933642e636f6d2f6a612f323031372e342f75706c6f6164732f4d61696e2f6d616e75616c61637469766174696f6e77696e646f772e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fdocs.unity3d.com%2Fja%2F2017.4%2Fuploads%2FMain%2Fmanualactivationwindow.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=331cec6f1f0b3b487aaa4c2d2d2f434f\" alt=\"manualactivationwindow.png\" data-canonical-src=\"https://docs.unity3d.com/ja/2017.4/uploads/Main/manualactivationwindow.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fdocs.unity3d.com%2Fja%2F2017.4%2Fuploads%2FMain%2Fmanualactivationwindow.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=057007d0ebf631d6da05dcd6eac302d7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e使用しているUnityがProまたはPersonalであるかを選択 \u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"画像はUnityのサイトより引用\"\u003e1\u003c/a\u003e\u003c/sup\u003e \u003ca href=\"https://camo.qiitausercontent.com/7583cc13e5eee3d1a68702ca5cc44eddf009d6d5/68747470733a2f2f646f63732e756e69747933642e636f6d2f6a612f323031372e342f75706c6f6164732f4d61696e2f6163746976617465796f75726c6963656e73652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fdocs.unity3d.com%2Fja%2F2017.4%2Fuploads%2FMain%2Factivateyourlicense.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=497c1760c85e450a7e7665f4ba48d20d\" alt=\"activateyourlicense.png\" data-canonical-src=\"https://docs.unity3d.com/ja/2017.4/uploads/Main/activateyourlicense.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fdocs.unity3d.com%2Fja%2F2017.4%2Fuploads%2FMain%2Factivateyourlicense.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=46d68d70a19966f7639f610cec55eaba 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\"Download License File\"をクリックしてulfファイルを入手 \u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"画像はUnityのサイトより引用\"\u003e1\u003c/a\u003e\u003c/sup\u003e \u003ca href=\"https://camo.qiitausercontent.com/5db004a154772c46864ca328f1c7a60fbd53fa8b/68747470733a2f2f646f63732e756e69747933642e636f6d2f6a612f323031372e342f75706c6f6164732f4d61696e2f796f75417265416c6d6f7374446f6e652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fdocs.unity3d.com%2Fja%2F2017.4%2Fuploads%2FMain%2FyouAreAlmostDone.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=320321cd94291f5d21329d232adb6579\" alt=\"youAreAlmostDone.png\" data-canonical-src=\"https://docs.unity3d.com/ja/2017.4/uploads/Main/youAreAlmostDone.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fdocs.unity3d.com%2Fja%2F2017.4%2Fuploads%2FMain%2FyouAreAlmostDone.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=014283472f8a47cd357456bf1b9a2159 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eもしあなたがUnity2018.4.12f1以外でこのハンズオンを行う場合\u003c/summary\u003e\u003cdiv\u003eそのバージョンのalfファイルを作成しなくてはいけません。\u003cbr\u003e\n\u003ca href=\"https://github.com/pCYSl5EDgo/CreateALF\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCreateALFというGitHubのリポジトリ\u003c/a\u003eをForkし、\".github/workflows/CreateLicenseALF.yml\"を編集してください。\n\n\u003cdiv class=\"code-frame\" data-lang=\"yaml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCreateLicenseALF.yml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCreate ALF File\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eon\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003epush\u003c/span\u003e\u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ebuild\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n\n    \u003cspan class=\"na\"\u003eruns-on\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eubuntu-latest\u003c/span\u003e\n    \u003cspan class=\"na\"\u003estrategy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ematrix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eunity-version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e2018.4.9f1\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e2018.4.10f1\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e2018.4.11f1\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e2018.4.12f1\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e2018.4.13f1\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e2019.3.0f1\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e2020.1.0a14\u003c/span\u003e\n\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003epCYSl5EDgo/setup-unity@master\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eunity-version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ matrix.unity-version }}\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCreate Manual Activation File\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/opt/Unity/Editor/Unity -quit -batchmode -nographics -logfile -createManualActivationFile || exit \u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCreate Release\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecreate_release\u003c/span\u003e\n      \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactions/create-release@v1.0.0\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eenv\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eGITHUB_TOKEN\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ secrets.GITHUB_TOKEN }}\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003etag_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esetup-${{ matrix.unity-version }}\u003c/span\u003e\n        \u003cspan class=\"na\"\u003erelease_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eRelease setup-Unity ${{ matrix.unity-version }}\u003c/span\u003e\n        \u003cspan class=\"na\"\u003edraft\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003efalse\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eprerelease\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003efalse\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eUpload Release Asset\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eupload-release-asset\u003c/span\u003e \n      \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactions/upload-release-asset@v1.0.1\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eenv\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eGITHUB_TOKEN\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ secrets.GITHUB_TOKEN }}\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eupload_url\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ steps.create_release.outputs.upload_url }}\u003c/span\u003e \u003cspan class=\"c1\"\u003e# This pulls from the CREATE RELEASE step above, referencing it's ID to get its outputs object, which include a `upload_url`. See this blog post for more info: https://jasonet.co/posts/new-features-of-github-actions/#passing-data-to-future-steps \u003c/span\u003e\n        \u003cspan class=\"na\"\u003easset_path\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eUnity_v${{ matrix.unity-version }}.alf\u003c/span\u003e\n        \u003cspan class=\"na\"\u003easset_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eUnity_v${{ matrix.unity-version }}.alf\u003c/span\u003e\n        \u003cspan class=\"na\"\u003easset_content_type\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapplication/xml\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003ematrix.unity-versionにあなたの使うUnityのバージョンを指定してください。\u003cbr\u003e\nmasterブランチにpushするとGitHub Releaseにそのバージョンのalfファイルが登録されます。\u003cbr\u003e\n\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003e入手したulfファイルをリポジトリ\"HandsOn_CSharpAdventCalendar20191201\"で利用しますが、秘密にすべき情報であるため、GitHub Secretsという機能を使って暗号化しましょう。\u003cbr\u003e\nGitHub SecretsはSettings/Secretsを選択し、そこにキーと値のペアを登録します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f54f9b1964a1c8b1596b272f3ca344c44d3476fb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235363034372f35653865333262362d396136362d323433632d623633342d3263376261383964383834642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2F5e8e32b6-9a66-243c-b634-2c7ba89d884d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=653d639a9439631f7431acb7b501b536\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/256047/5e8e32b6-9a66-243c-b634-2c7ba89d884d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F256047%2F5e8e32b6-9a66-243c-b634-2c7ba89d884d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bc65b550fb4068f5756c6cfe0584052a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n今回はulfというキーでulfファイルの中身を登録しましょう。\u003cbr\u003e\n以上でGitHub ActionsでUnityを扱う下拵えは完了です。\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003e現在のワーキングディレクトリはUniNativeLinqHandsOnのはずです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003emkdir\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-p\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egithub\u003c/span\u003e\u003cspan class=\"nx\"\u003e/workflows\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egithub\u003c/span\u003e\u003cspan class=\"nx\"\u003e/workflows/CI.yaml\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\".github/workflows\"フォルダ以下にyamlファイルを作成し、そこに自動化する仕事を記述します。\u003cbr\u003e\n更にcore~.csproje.txtを新規に作成します。core~.csprojはWindows向けの記述をしていて、そのままではLinuxのDockerコンテナ上では動作しません。\u003cbr\u003e\n\u003cdetails\u003e\u003csummary\u003ecore~.csprojはこのように記述しなおしてください。\u003c/summary\u003e\u003cdiv\u003eほぼ元のcore~.csprojと変わりは無いですが、HintPathが変更され、かつビルド後イベントが削除されています。\n\n\u003cdiv class=\"code-frame\" data-lang=\"yaml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecore~.csproj.txt\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"s\"\u003e\u0026lt;Project Sdk=\"Microsoft.NET.Sdk\"\u0026gt;\u003c/span\u003e\n\n  \u003cspan class=\"s\"\u003e\u0026lt;PropertyGroup\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\u0026lt;TargetFramework\u0026gt;netstandard2.0\u0026lt;/TargetFramework\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\u0026lt;RootNamespace\u0026gt;UniNativeLinq\u0026lt;/RootNamespace\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\u0026lt;AllowUnsafeBlocks\u0026gt;True\u0026lt;/AllowUnsafeBlocks\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\u0026lt;LangVersion\u0026gt;8\u0026lt;/LangVersion\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\u0026lt;AssemblyName\u0026gt;UniNativeLinq\u0026lt;/AssemblyName\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"s\"\u003e\u0026lt;/PropertyGroup\u0026gt;\u003c/span\u003e\n\n  \u003cspan class=\"s\"\u003e\u0026lt;ItemGroup\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\u0026lt;Reference Include=\"UnityEngine.CoreModule\"\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e\u0026lt;HintPath Condition=\"Exists('C:\\Users\\conve')\"\u0026gt;C:\\Users\\conve\\Documents\\Unity\\Editor\\Data\\Managed\\UnityEngine\\UnityEngine.CoreModule.dll\u0026lt;/HintPath\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e\u0026lt;HintPath Condition=\"Exists('/opt/Unity/Editor/Unity')\"\u0026gt;/opt/Unity/Editor/Data/Managed/UnityEngine/UnityEngine.CoreModule.dll\u0026lt;/HintPath\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\u0026lt;/Reference\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"s\"\u003e\u0026lt;/ItemGroup\u0026gt;\u003c/span\u003e\n\u003cspan class=\"s\"\u003e\u0026lt;/Project\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eCI.yamlの内容\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"yaml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCI.yaml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCreateRelease\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eon\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epush\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ebranches\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003edevelop\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ebuildReleaseJob\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eruns-on\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eubuntu-latest\u003c/span\u003e\n    \u003cspan class=\"na\"\u003estrategy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ematrix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eunity-version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e2018.4.9f1\u003c/span\u003e\u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"na\"\u003euser-name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003epCYSl5EDgo\u003c/span\u003e\u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"na\"\u003erepository-name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003eHandsOn_CSharpAdventCalendar20191201\u003c/span\u003e\u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eexe\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s\"\u003e/opt/Unity/Editor/Unity'\u003c/span\u003e\u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003epCYSl5EDgo/setup-unity@master\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eunity-version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ matrix.unity-version }}\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eLicense Activation\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003eecho -n \"$ULF\" \u0026gt; unity.ulf\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e${{ matrix.exe }} -nographics -batchmode -quit -logFile -manualLicenseFile ./unity.ulf || exit 0\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eenv\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eULF\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ secrets.ulf }}\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egit clone https://github.com/${{ github.repository }}\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactions/setup-dotnet@v1.0.2\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003edotnet-version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s\"\u003e3.0.101'\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eBuilds DLL\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003ecd ${{ matrix.repository-name }}/core~\u003c/span\u003e\n        \u003cspan class=\"s\"\u003edotnet build -c Release\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ePost Process DLL\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003ecd ${{ matrix.repository-name }}\u003c/span\u003e\n        \u003cspan class=\"s\"\u003emv -f ./core~/bin/Release/netstandard2.0/UniNativeLinq.dll ./Assets/Plugins/UNL/UniNativeLinq.dll\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eRun Test\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ matrix.exe }} -batchmode -nographics -projectPath ${{ matrix.repository-name }} -logFile ./log.log -runEditorTests -editorTestsResultFile ../result.xml || exit \u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003els -l\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecat log.log\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecat result.xml\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003epCYSl5EDgo/Unity-Test-Runner-Result-XML-interpreter@master\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003einterpret\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eresult.xml\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eif\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esteps.interpret.outputs.success != 'true'\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eexit \u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eGet Version\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003ecd ${{ matrix.repository-name }}\u003c/span\u003e\n        \u003cspan class=\"s\"\u003egit describe --tags 1\u0026gt; ../version 2\u0026gt; ../error || exit 0\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCat Error\u003c/span\u003e\n      \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003epCYSl5EDgo/cat@master\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eerror\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eerror\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eif\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003estartsWith(steps.error.outputs.text, 'fatal') != 'true'\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003ecat version\u003c/span\u003e\n        \u003cspan class=\"s\"\u003ecat version | awk '{ split($0, versions, \"-\"); split(versions[1], numbers, \".\"); numbers[3]=numbers[3]+1; variable=numbers[1]\".\"numbers[2]\".\"numbers[3]; print variable; }' \u0026gt; version_increment\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eif\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003estartsWith(steps.error.outputs.text, 'fatal')\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eecho -n \"0.0.1\" \u0026gt; version_increment\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCat\u003c/span\u003e\n      \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003epCYSl5EDgo/cat@master\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eversion\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eversion_increment\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCreate Release\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecreate_release\u003c/span\u003e\n      \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactions/create-release@v1.0.0\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eenv\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eGITHUB_TOKEN\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ secrets.GITHUB_TOKEN }}\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003etag_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ steps.version.outputs.text }}\u003c/span\u003e\n        \u003cspan class=\"na\"\u003erelease_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eRelease Unity${{ matrix.unity-version }} - v${{ steps.version.outputs.text }}\u003c/span\u003e\n        \u003cspan class=\"na\"\u003edraft\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003efalse\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eprerelease\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003efalse\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eUpload DLL\u003c/span\u003e\n      \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactions/upload-release-asset@v1.0.1\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eenv\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eGITHUB_TOKEN\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ secrets.GITHUB_TOKEN }}\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eupload_url\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ steps.create_release.outputs.upload_url }}\u003c/span\u003e\n        \u003cspan class=\"na\"\u003easset_path\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ matrix.repository-name }}/Assets/Plugins/UNL/UniNativeLinq.dll\u003c/span\u003e\n        \u003cspan class=\"na\"\u003easset_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eUniNativeLinq.dll\u003c/span\u003e\n        \u003cspan class=\"na\"\u003easset_content_type\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapplication/vnd.microsoft.portable-executable\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003ejobs.buildReleaseJob.startegy.matrix以下の3項目は適切に書き換えてください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"3項目抜粋\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eunity-tag: [2018.4.12f1]\nuser-name: [pCYSl5EDgo]\nrepository-name: [HandsOn_CSharpAdventCalendar20191201]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003eunity-tag\n\n\u003cul\u003e\n\u003cli\u003eUnityのバージョン\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003euser-name\n\n\u003cul\u003e\n\u003cli\u003eあなたのGitHubアカウント名\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003erepository-name\n\n\u003cul\u003e\n\u003cli\u003eあなたのリポジトリ名\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e全体の流れとしては以下の通りになります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e作業リポジトリをクローン\n\n\u003cul\u003e\n\u003cli\u003eactions/checkoutだとcore~などの隠しフォルダを無視してしまうのでgit cloneするのが安牌\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eGitHub Secretsに登録したulfファイルをトップレベルに \u003ccode\u003eecho -n \"${ULF}\" \u0026gt; Unity_v2018.x.ulf\u003c/code\u003eで出力\n\n\u003cul\u003e\n\u003cli\u003e環境変数に仕込んでいるので外部にバレずに利用可能\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eビルドに必要なdotnet core 3.0環境のセットアップ\u003c/li\u003e\n\u003cli\u003eDLLをビルドしてそれをAssets/Plugins/UNL以下に配置\u003c/li\u003e\n\u003cli\u003eUnityのライセンス認証\u003c/li\u003e\n\u003cli\u003eUnity Test Runnerをコマンドラインから走らせる\u003c/li\u003e\n\u003cli\u003eテストに失敗したなら全体を失敗させて終了\u003c/li\u003e\n\u003cli\u003e前回のビルド時のバージョンを取得\u003c/li\u003e\n\u003cli\u003e取得に失敗したならば今回のバージョンを0.0.1とする\u003c/li\u003e\n\u003cli\u003e取得成功時はawkでゴニョゴニョしてマイナーバージョンをインクリメントする\u003c/li\u003e\n\u003cli\u003eGitHub Releasesに新規リリースを作成する\u003c/li\u003e\n\u003cli\u003eリリースにファイルを追加する\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eadd\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003ecommit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-m\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"[update]Publish Release\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e現在のワーキングディレクトリはUniNativeLinqHandsOnのはずです。\u003cbr\u003e\n全ての作業が終わったらGitHubにpushして最初のGitHub Releasesを公開しましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ienumerabletの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ienumerablet%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eIEnumerable\u0026lt;T\u0026gt;の実装\u003c/h2\u003e\n\n\u003cp\u003eNativeEnumerable\u0026lt;T\u0026gt;の中身として全てのフィールドとインデクサを定義しました。\u003cbr\u003e\nこれからIEnumerable\u0026lt;T\u0026gt;を実装します。記述が増えるのでpartial structにします。\u003cbr\u003e\n\u003cdetails\u003e\u003csummary\u003eIEnumerable\u0026lt;T\u0026gt;を実装したNativeEnumerable\u0026lt;T\u0026gt;\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNativeEnumerable.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUniNativeLinq\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eNativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eunmanaged\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ePtr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eNativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePtr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"n\"\u003ePtr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003ePtr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003cbr\u003e\n\u003cdetails\u003e\u003csummary\u003eIEnumerator\u0026lt;T\u0026gt;を実装したNativeEnumerable\u0026lt;T\u0026gt;.Enumerator\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNativeEnumerable.Enumerator.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUniNativeLinq\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eNativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eEnumerator\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n      \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eptr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePtr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n      \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveNext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eReset\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003eイテレータ構造体を内部型として定義するのはforeachの性能向上の常套手段です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ecd\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003ecore~\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003edotnet\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003ebuild\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-c\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eRelease\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003ecd\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e..\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eunity\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-projectPath\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eビルドをした後エディタを起動し、テストコードを書きましょう。\u003cbr\u003e\nNativeEnumerableTestScriptクラスに追記する形で単一のクラスを肥大させましょう。\u003cbr\u003e\nUnityのよくわからない仕様なのですが、１つのプロジェクトに２ファイル以上のテストスクリプトが存在するとコマンドラインからrunEditorTestsするとエラー吐きます。\u003cbr\u003e\nこのような事情もあり、簡易的な処置ですが神テストクラスを肥えさせます。本格的な処置についてはいずれまた別の記事で書くこともあるかも知れません。\u003cbr\u003e\n\u003cdetails\u003e\u003csummary\u003eNativeEnumerableTestScript.cs\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNativeEnumerableTestScript.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTemp\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e114\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTemp\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e114514\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTemp\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTempJob\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e114\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTempJob\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e114514\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTempJob\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePersistent\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e114\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePersistent\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eTestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e114514\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePersistent\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eIEnumerableTest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e \u003cspan class=\"n\"\u003eallocator\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eallocator\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e*)\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetUnsafePtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e++,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003enativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e++,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003eforeach文が正しく動いていることがこれで確認できます。\u003cbr\u003e\nUnityエディターを閉じた後、GitHubにpushしてCI/CDを体感しましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eadd\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003ecommit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-m\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"[update]Implement IEnumerable\u0026lt;T\u0026gt; \u0026amp; IEnumerator\u0026lt;T\u0026gt;\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"asenumerableに相当するasrefenumerableの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#asenumerable%E3%81%AB%E7%9B%B8%E5%BD%93%E3%81%99%E3%82%8Basrefenumerable%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAsEnumerable()に相当するAsRefEnumerable()の実装\u003c/h2\u003e\n\n\u003cp\u003eNativeArray\u0026lt;T\u0026gt;からNativeEnumerable\u0026lt;T\u0026gt;を生成するのに一々 \u003ccode\u003evar nativeEnumerable = new NativeEnumerable\u0026lt;T\u0026gt;((T*) array.GetUnsafePtr(), array.Length);\u003c/code\u003eと記述するのも手間です。\u003cbr\u003e\n\u003ccode\u003evar nativeEnumerable = array.AsRefEnumerable();\u003c/code\u003eだったら非常に楽ですので、拡張メソッドを定義します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eAsRefEnumerable.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUniNativeLinq\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNativeEnumerable\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eAsRefEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eUnity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eunmanaged\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e*)\u003c/span\u003e\u003cspan class=\"n\"\u003eUnity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLowLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUnsafe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNativeArrayUnsafeUtility\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetUnsafeBufferPointerWithoutChecks\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"irefenumerabletorの定義と実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#irefenumerabletor%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%81%A8%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eIRefEnumerable/torの定義と実装\u003c/h2\u003e\n\n\u003cp\u003eNativeEnumerable\u0026lt;T\u0026gt;とその内部型Enumeratorは \u003ccode\u003epublic Enumerator GetEnumetor();\u003c/code\u003eと \u003ccode\u003epublic ref T Current{get;}\u003c/code\u003eが特徴的な要素です。\u003cbr\u003e\nこれをインターフェイスに抽出します。\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eIRefEnumerable.csとIRefEnumerator.csの定義\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIRefEnumerable.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUniNativeLinq\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIRefEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGeneric\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"n\"\u003eTEnumerator\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIRefEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eTEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIRefEnumerator.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUniNativeLinq\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIRefEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGeneric\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003e上記インターフェイスをNativeEnumerableに実装します。\u003c/summary\u003e\u003cdiv\u003e実際は各ファイルを一行書き換えるだけです。\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNativeEenumerable.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eNativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIRefEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eNativeEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNativeEenumerable.Enumerator.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eEnumerator\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIRefEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003eテストコードには何も差は生じません。（既存の実装を元にインターフェイスを抽出しただけですので）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"第2章初めてのapi---select\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%AC%AC2%E7%AB%A0%E5%88%9D%E3%82%81%E3%81%A6%E3%81%AEapi---select\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e第2章　初めてのAPI - Select\u003c/h1\u003e\n\n\u003cp\u003eLINQで一番使うAPIはSelectまたはWhereのはずです。\u003cbr\u003e\n今回はUniNativeLinqの特異性を学ぶのに好適であるため、Selectを実装してみます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"通常linqのselectについて\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%80%9A%E5%B8%B8linq%E3%81%AEselect%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e通常LINQのSelectについて\u003c/h2\u003e\n\n\u003cp\u003e通常のSystem.Linq.Enumerableの提供するSelectメソッドのシグネチャを見てみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSelect.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTTo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTTo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eIEunmerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecollection\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTTo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e引数にIEnumerable\u0026lt;TFrom\u0026gt;なコレクションと、Func\u0026lt;TFrom, TTo\u0026gt;な写像を取ってマッピングを行います。\u003cbr\u003e\nLINQの優れている点は拡張メソッドの型引数を（C#の貧弱な型推論でも）型推論完了できるという点にあります。\u003c/p\u003e\n\n\u003cp\u003e標準にLINQに習ってAPIを定義してみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eUniNativeLinq.Select.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIRefEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTToEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTTo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTFromEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTToEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTTo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eIRefEunmerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTFromEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecollection\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTTo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこのような感じでしょうか？\u003cbr\u003e\nTToEnumeratorを引数から導出できず、センスが悪いですね。\u003cbr\u003e\n\u003cdetails\u003e\u003csummary\u003e実際のUniNativeLinqでは新たにSelectEnumerable\u0026lt;TPrevEnumerable, TPrevEnumerator, TPrev, T, TAction\u0026gt;型を定義します。\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eAPI/RefAction.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eInterface/IRefAction.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eUtility/DelegateRefActionToStructOperatorAction.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eUtility/Unsafe.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eCollection/SelectEnumerable.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eCollection/SelectEnumerable.Enumerator.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e細々と必要な型があるので他にもいくつか新規にファイルを作成します。\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eRefAction.csとIRefAction.cs\u003c/summary\u003e\u003cdiv\u003e似たような内容なので同一ファイル内に記述するのも良いでしょう。\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eRefAction.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUniNativeLinq\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003edelegate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eRefAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eT0\u003c/span\u003e \u003cspan class=\"n\"\u003earg0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e \u003cspan class=\"n\"\u003earg1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIRefAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eT0\u003c/span\u003e \u003cspan class=\"n\"\u003earg0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e \u003cspan class=\"n\"\u003earg1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUniNativeLinq\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eDelegateRefActionToStructOperatorAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIRefAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eRefAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eDelegateRefActionToStructOperatorAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRefAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaction\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eT0\u003c/span\u003e \u003cspan class=\"n\"\u003earg0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e \u003cspan class=\"n\"\u003earg1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003earg0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003earg1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eUnsafe.csは、\u003ca href=\"https://ufcpp.net/blog/2018/12/unsafe/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSystem.Runtime.CompilerServices.Unsafe\u003c/a\u003eの一部抜粋です。\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eUnsafe.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUniNativeLinq\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUnsafe\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ref T AsRef\u0026lt;T\u0026gt;(in T value) =\u0026gt; ref value;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eAsRef\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNotImplementedException\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e実際の所、NotImplementExceptionとして中身は空っぽなモックAPIです。\u003cbr\u003e\n後にいい感じにこのモックAPIを処理します。\u003c/p\u003e\n\n\u003cp\u003eUnsafe.AsRefはin引数をref戻り値に変換します。\u003cbr\u003e\n引数にreadonlyフィールドの参照を与えたら、その戻り値が変更可能な参照になります。\u003cbr\u003e\n\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eSelectEnumerable.cs\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSelectEnumerable.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUniNativeLinq\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eSelectEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTPrevEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTPrevEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTPrev\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIRefEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSelectEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTPrevEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTPrevEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTPrev\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"n\"\u003eTPrevEnumerable\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIRefEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTPrevEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTPrev\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"n\"\u003eTPrevEnumerator\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIRefEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTPrev\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"n\"\u003eTAction\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIRefAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTPrev\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eTPrevEnumerable\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eTAction\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSelectEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eTPrevEnumerable\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eaction\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSelectEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eTPrevEnumerable\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eTAction\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaction\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eUnsafe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAsRef\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGeneric\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGeneric\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003cbr\u003e\nGetEnumerator()においてUnsafe.AsRef(in enumerable)と記述されています。\u003cbr\u003e\nUnsafe.AsRefはreadonly制約を無視する危険なメソッドですが、この場合において問題はありません。\u003cbr\u003e\nUniNativeLinqの提供する範囲において、全てのGetEnumeratorメソッドがreadonlyなメソッドであるからです。\u003cbr\u003e\nこの辺りをC#の型制約で保証できればよいのですが、出来ないため今回のようにUnsafe.AsRefを利用する必要があるのです。\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eSelectEnumerable.Enumerator.cs\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSelectEnumerable.Enumerator.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUniNativeLinq\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eSelectEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTPrevEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTPrevEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTPrev\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eEnumerator\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIRefEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eTPrevEnumerator\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eTAction\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n      \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eTPrevEnumerable\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eTAction\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eenumerator\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaction\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eelement\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n      \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveNext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003eenumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMoveNext\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n      \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eReset\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvalidOperationException\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n      \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNotImplementedException\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGeneric\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003cbr\u003e\nSelectEnumerableの実装はそこまで変なものではありません。\u003cbr\u003e\nコンストラクタで必要な情報をフィールドに初期化し、GetEnumerator()でEnumeratorを返すだけのシンプルな作りです。\u003cbr\u003e\nEnumeratorではIRefAction\u0026lt;T0, T1\u0026gt;を実装した型引数TActionのインスタンスactionを使用してMoveNext()する度にT型フィールドであるelementを更新しています。\u003c/p\u003e\n\n\u003cp\u003eこのEnumeratorの最大の特徴は、 \u003ccode\u003epublic ref T Current =\u0026gt; throw new System.NotImplementedException();\u003c/code\u003eです。\u003cbr\u003e\nそう、未実装のままなのです。これはバグではなく極めて意図的な仕様です。\u003cbr\u003e\nこれをこのままビルドしてテストコードを追加してもエラーを吐くだけです。\u003c/p\u003e\n\n\u003cp\u003e本当は \u003ccode\u003epublic ref T Current =\u0026gt; ref element;\u003c/code\u003eと記述したいのですが、\u003ca href=\"https://ufcpp.net/study/csharp/sp_ref.html?p=2#struct-this\" rel=\"nofollow noopener\" target=\"_blank\"\u003eC#の文法の制限として無理です\u003c/a\u003e。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"uninativelinqdllのポストプロセス用dotnet-core-30プロジェクト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#uninativelinqdll%E3%81%AE%E3%83%9D%E3%82%B9%E3%83%88%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E7%94%A8dotnet-core-30%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniNativeLinq.dllのポストプロセス用dotnet core 3.0プロジェクト\u003c/h2\u003e\n\n\u003cp\u003e現在のワーキングディレクトリはUniNativeLinqHandsOnのはずです。\u003cbr\u003e\nMono.Cecilを利用してUniNativeLinq.dllを編集してSelectEnumerable.Enumerator.CurrentからNotImplementedExceptionを消し飛ばしましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003emkdir\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003epost~\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003ecd\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003epost~\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003edotnet\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eecho\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003ebin/\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eobj/\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003epost~.sln\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egitignore\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"nx\"\u003edotnet\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eadd\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003epackage\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eMono.Cecil\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eDllProcessor.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eInstructionUtility.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eToDefinitionUtility.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eGenericInstanceUtility.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003e参考までにpost~.csprojの中身\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u0026lt;Project Sdk=\"Microsoft.NET.Sdk\"\u0026gt;\n  \u0026lt;PropertyGroup\u0026gt;\n    \u0026lt;OutputType\u0026gt;Exe\u0026lt;/OutputType\u0026gt;\n    \u0026lt;TargetFramework\u0026gt;netcoreapp3.0\u0026lt;/TargetFramework\u0026gt;\n    \u0026lt;RootNamespace\u0026gt;_post\u0026lt;/RootNamespace\u0026gt;\n  \u0026lt;/PropertyGroup\u0026gt;\n  \u0026lt;ItemGroup\u0026gt;\n    \u0026lt;PackageReference Include=\"Mono.Cecil\" Version=\"0.11.1\" /\u0026gt;\n  \u0026lt;/ItemGroup\u0026gt;\n\u0026lt;/Project\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ePackageReferenceタグでMono.Cecilをインストール可能です。\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eProgram.cs\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eProgram.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.IO\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003esealed\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"nf\"\u003eValidateArguments\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eFileInfo\u003c/span\u003e \u003cspan class=\"n\"\u003einputUniNativeLinqDll\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eFileInfo\u003c/span\u003e \u003cspan class=\"n\"\u003eoutputUniNativeLinqDllPath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eDirectoryInfo\u003c/span\u003e \u003cspan class=\"n\"\u003eunityEngineFolder\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDllProcessor\u003c/span\u003e \u003cspan class=\"n\"\u003eprocessor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDllProcessor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einputUniNativeLinqDll\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoutputUniNativeLinqDllPath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eunityEngineFolder\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eprocessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eProcess\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eValidateArguments\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eFileInfo\u003c/span\u003e \u003cspan class=\"n\"\u003einputUniNativeLinqDll\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eFileInfo\u003c/span\u003e \u003cspan class=\"n\"\u003eoutputNativeLinqDllPath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eDirectoryInfo\u003c/span\u003e \u003cspan class=\"n\"\u003eunityEngineFolder\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Invalid argument count.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"n\"\u003einputUniNativeLinqDll\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eoutputNativeLinqDllPath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eunityEngineFolder\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003einputUniNativeLinqDll\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFileInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003einputUniNativeLinqDll\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExists\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Empty Input UniNativeLinq.dll path\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eoutputNativeLinqDllPath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eunityEngineFolder\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eoutputNativeLinqDllPathString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsNullOrWhiteSpace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoutputNativeLinqDllPathString\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Empty Output UniNativeLinq.dll path\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eunityEngineFolder\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eoutputNativeLinqDllPath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eoutputNativeLinqDllPath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFileInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoutputNativeLinqDllPathString\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eunityEngineFolder\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDirectoryInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003eunityEngineFolder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExists\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity Engine Dll Folder does not exist\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eMain関数はコマンドライン引数を2つ要求します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e第1引数：core~で生成したDllのパス \"core~/bin/Release/netstandard2.0/UniNativeLinq.dll\"\u003c/li\u003e\n\u003cli\u003e第2引数：Mono.Cecilで編集した後、Dllを出力するパス \"Assets/Plugins/UNL/UniNativeLinq.dll\"\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eValidateArgumentsで引数の妥当性を検証します。\u003cbr\u003e\nIDisposableを実装したDllProcessorのインスタンスを生成し、Processメソッドを実行することで適切な処理を加えます。\u003cbr\u003e\n\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003cbr\u003e\n\u003cdetails\u003e\u003csummary\u003eDllProcessor.cs\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eDllProcessor.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.IO\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMono.Cecil\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMono.Cecil.Cil\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eDllProcessor\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eModuleDefinition\u003c/span\u003e \u003cspan class=\"n\"\u003emainModule\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eFileInfo\u003c/span\u003e \u003cspan class=\"n\"\u003eoutputDll\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eDllProcessor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFileInfo\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFileInfo\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emainModule\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eModuleDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadModule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eoutputDll\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eProcess\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eProcessEachMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRewriteUnsafeAsRef\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emainModule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRemove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emainModule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"UniNativeLinq\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Unsafe\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eProcessEachMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRewriteThrowNotImplementedException\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePredicateThrowNotImplementedException\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eProcessEachMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003epredicate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeDefinition\u003c/span\u003e \u003cspan class=\"n\"\u003etypeDefinition\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003emainModule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"nf\"\u003eProcessEachMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epredicate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etypeDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eProcessEachMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003epredicate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeDefinition\u003c/span\u003e \u003cspan class=\"n\"\u003etypeDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeDefinition\u003c/span\u003e \u003cspan class=\"n\"\u003enestedTypeDefinition\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etypeDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNestedTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"nf\"\u003eProcessEachMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epredicate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enestedTypeDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epredicate\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"nf\"\u003epredicate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etypeDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMethodDefinition\u003c/span\u003e \u003cspan class=\"n\"\u003emethodDefinition\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etypeDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMethods\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eRewriteUnsafeAsRef\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMethodDefinition\u003c/span\u003e \u003cspan class=\"n\"\u003emethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMono\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGeneric\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003einstructions\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003einstructions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstructions\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNullReferenceException\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einstructions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e--)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e \u003cspan class=\"n\"\u003einstruction\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einstructions\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCode\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCall\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eMethodDefinition\u003c/span\u003e \u003cspan class=\"n\"\u003ecallMethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecallMethodDefinition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eMethodReference\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003einstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOperand\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecallMethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"AsRef\"\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003ecallMethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeclaringType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Unsafe\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003einstructions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRemoveAt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003ePredicateThrowNotImplementedException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeDefinition\u003c/span\u003e \u003cspan class=\"n\"\u003etypeDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003etypeDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHasFields\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003etypeDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFields\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAny\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efield\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsStatic\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"element\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eRewriteThrowNotImplementedException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMethodDefinition\u003c/span\u003e \u003cspan class=\"n\"\u003emethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsStatic\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eFieldReference\u003c/span\u003e \u003cspan class=\"n\"\u003eelementFieldReference\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeclaringType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"element\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eMakeHostInstanceGeneric\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeclaringType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eILProcessor\u003c/span\u003e \u003cspan class=\"n\"\u003eprocessor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetILProcessor\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMono\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGeneric\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003einstructions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstructions\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einstructions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e--)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e \u003cspan class=\"n\"\u003ethrowInstruction\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einstructions\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ethrowInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCode\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eThrow\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e \u003cspan class=\"n\"\u003enewObjInstruction\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einstructions\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enewObjInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCode\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewobj\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eMethodDefinition\u003c/span\u003e \u003cspan class=\"n\"\u003enewObjMethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003enewObjMethodDefinition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eMethodReference\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003enewObjInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOperand\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enewObjMethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"s\"\u003e\".ctor\"\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003enewObjMethodDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeclaringType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"System.NotImplementedException\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003enewObjInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLdarg_0\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n      \u003cspan class=\"n\"\u003ethrowInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLdflda\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eelementFieldReference\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eprocessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInsertAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ethrowInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRet\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eStream\u003c/span\u003e \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFileStream\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoutputDll\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFileMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFileAccess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003emainModule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emainModule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003eProcess\n\n\u003cul\u003e\n\u003cli\u003e元となる不完全なDllに対して処理を加えて完全なDllにするメソッドです。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eProcessEachMethod\n\n\u003cul\u003e\n\u003cli\u003eDllに含まれる全ての型の全てのメソッドを走査して全てのメソッドに対して引数のactionを適用します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eRewriteUnsafeAsRef\n\n\u003cul\u003e\n\u003cli\u003eUnsafe.AsRefはreadonlyな要素を非readonlyな状態に変換する極めて危険なAPIです。\u003c/li\u003e\n\u003cli\u003e使い所がGetEnumeratorに限定されているため特に問題はないです。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePredicateThrowNotImplementedException\n\n\u003cul\u003e\n\u003cli\u003eインスタンスフィールドに\"element\"という名前のそれが存在する型のみを処理対象に選ぶメソッドです。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eRewriteThrowNotImplementedException\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ethrow new NotImplementedException();\u003c/code\u003eを \u003ccode\u003ereturn ref this.element;\u003c/code\u003eに置換します。\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\u003c/details\u003e\n\u003cdetails\u003e\u003csummary\u003eInstructionUtility.cs\u003c/summary\u003e\u003cdiv\u003e\n\n\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eInstructionUtility.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMono.Cecil.Cil\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eInstructionUtility\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eReplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e \u003cspan class=\"n\"\u003einstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e \u003cspan class=\"n\"\u003ereplace\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOperand\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereplace\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ereplace\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOperand\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eRewriteThrowNotImplementedException内部で使用されます。\u003cbr\u003e\nILの命令を置換するための拡張メソッドです。\u003cbr\u003e\nILProcessorのReplaceメソッドはバグを誘発するわりと使い物にならないメソッドです。\u003cbr\u003e\ngotoやif, switchなどのジャンプ系の命令の行き先にまつわる致命的なバグを生じます。\u003cbr\u003e\nこうしてわざわざ拡張メソッドを用意する必要があるのです。\u003cbr\u003e\n\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003cbr\u003e\n\u003cdetails\u003e\u003csummary\u003eToDefinitionUtility.cs\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eToDefinitionUtility.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMono.Cecil\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eToDefinitionUtility\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeDefinition\u003c/span\u003e \u003cspan class=\"nf\"\u003eToDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeReference\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eTypeDefinition\u003c/span\u003e \u003cspan class=\"n\"\u003edefinition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003edefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGenericInstanceType\u003c/span\u003e \u003cspan class=\"n\"\u003egeneric\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003egeneric\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElementType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eResolve\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodDefinition\u003c/span\u003e \u003cspan class=\"nf\"\u003eToDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodReference\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMethodDefinition\u003c/span\u003e \u003cspan class=\"n\"\u003edefinition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003edefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGenericInstanceMethod\u003c/span\u003e \u003cspan class=\"n\"\u003egeneric\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003egeneric\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElementMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eResolve\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e特に気にする必要はない拡張メソッドです。\u003cbr\u003e\nResolve()が例外を投げる可能性が結構あります。\u003cbr\u003e\n\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eGenericInstanceUtility.cs\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eGenericInstanceUtility.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMono.Cecil\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eGenericInstanceUtility\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldReference\u003c/span\u003e \u003cspan class=\"nf\"\u003eFindField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeReference\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeDefinition\u003c/span\u003e \u003cspan class=\"n\"\u003edefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003eGenericInstanceType\u003c/span\u003e \u003cspan class=\"n\"\u003egenericInstanceType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003egenericInstanceType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etypeDefinition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efieldDefinition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFields\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSingle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efieldDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eModule\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eModule\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efieldDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eModule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eImportReference\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efieldDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldReference\u003c/span\u003e \u003cspan class=\"nf\"\u003eFindField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeDefinition\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFields\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSingle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldReference\u003c/span\u003e \u003cspan class=\"nf\"\u003eFindField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eGenericInstanceType\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etypeDefinition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edefinition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFields\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSingle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMakeHostInstanceGeneric\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericArguments\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldReference\u003c/span\u003e \u003cspan class=\"nf\"\u003eMakeHostInstanceGeneric\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldReference\u003c/span\u003e \u003cspan class=\"n\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeReference\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003earguments\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFieldReference\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeclaringType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMakeGenericInstanceType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003earguments\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eGenericInstanceType\u003c/span\u003e \u003cspan class=\"nf\"\u003eMakeGenericInstanceType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeReference\u003c/span\u003e \u003cspan class=\"n\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeReference\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003earguments\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003einstance\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eGenericInstanceType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eargument\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003earguments\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGenericArguments\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargument\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ciyamlをアップデート\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ciyaml%E3%82%92%E3%82%A2%E3%83%83%E3%83%97%E3%83%87%E3%83%BC%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCI.yamlをアップデート\u003c/h2\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003epost~によりUniNativeLinq.dllにポストプロセスをする必要があり、CI.yamlを書き換えます。\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eCI.yaml全文\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"yaml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCI.yaml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCreateRelease\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eon\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epush\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ebranches\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003edevelop\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ebuildReleaseJob\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eruns-on\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eubuntu-latest\u003c/span\u003e\n    \u003cspan class=\"na\"\u003estrategy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ematrix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eunity-version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e2018.4.9f1\u003c/span\u003e\u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"na\"\u003euser-name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003epCYSl5EDgo\u003c/span\u003e\u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"na\"\u003erepository-name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003eHandsOn_CSharpAdventCalendar20191201\u003c/span\u003e\u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eexe\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s\"\u003e/opt/Unity/Editor/Unity'\u003c/span\u003e\u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003epCYSl5EDgo/setup-unity@master\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eunity-version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ matrix.unity-version }}\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eLicense Activation\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003eecho -n \"$ULF\" \u0026gt; unity.ulf\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e${{ matrix.exe }} -nographics -batchmode -quit -logFile -manualLicenseFile ./unity.ulf || exit 0\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eenv\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eULF\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ secrets.ulf }}\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egit clone https://github.com/${{ github.repository }}\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactions/setup-dotnet@v1.0.2\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003edotnet-version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s\"\u003e3.0.101'\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eBuilds DLL\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003ecd ${{ matrix.repository-name }}/core~\u003c/span\u003e\n        \u003cspan class=\"s\"\u003edotnet build -c Release\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ePost Process DLL\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003ecd ${{ matrix.repository-name }}/post~\u003c/span\u003e\n        \u003cspan class=\"s\"\u003els -l ../Assets/Plugins/UNL/\u003c/span\u003e\n        \u003cspan class=\"s\"\u003edotnet run ../core~/bin/Release/netstandard2.0/UniNativeLinq.dll ../Assets/Plugins/UNL/UniNativeLinq.dll\u003c/span\u003e\n        \u003cspan class=\"s\"\u003els -l ../Assets/Plugins/UNL/\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eRun Test\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ matrix.exe }} -batchmode -nographics -projectPath ${{ matrix.repository-name }} -logFile ./log.log -runEditorTests -editorTestsResultFile ../result.xml || exit \u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003els -l\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecat log.log\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecat result.xml\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003epCYSl5EDgo/Unity-Test-Runner-Result-XML-interpreter@master\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003einterpret\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eresult.xml\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eif\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esteps.interpret.outputs.success != 'true'\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eexit \u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eGet Version\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003ecd ${{ matrix.repository-name }}\u003c/span\u003e\n        \u003cspan class=\"s\"\u003egit describe --tags 1\u0026gt; ../version 2\u0026gt; ../error || exit 0\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCat Error\u003c/span\u003e\n      \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003epCYSl5EDgo/cat@master\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eerror\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eerror\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eif\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003estartsWith(steps.error.outputs.text, 'fatal') != 'true'\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003ecat version\u003c/span\u003e\n        \u003cspan class=\"s\"\u003ecat version | awk '{ split($0, versions, \"-\"); split(versions[1], numbers, \".\"); numbers[3]=numbers[3]+1; variable=numbers[1]\".\"numbers[2]\".\"numbers[3]; print variable; }' \u0026gt; version_increment\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eif\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003estartsWith(steps.error.outputs.text, 'fatal')\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eecho -n \"0.0.1\" \u0026gt; version_increment\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCat\u003c/span\u003e\n      \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003epCYSl5EDgo/cat@master\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eversion\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eversion_increment\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCreate Release\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecreate_release\u003c/span\u003e\n      \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactions/create-release@v1.0.0\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eenv\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eGITHUB_TOKEN\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ secrets.GITHUB_TOKEN }}\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003etag_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ steps.version.outputs.text }}\u003c/span\u003e\n        \u003cspan class=\"na\"\u003erelease_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eRelease Unity${{ matrix.unity-tag }} - v${{ steps.version.outputs.text }}\u003c/span\u003e\n        \u003cspan class=\"na\"\u003edraft\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003efalse\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eprerelease\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003efalse\u003c/span\u003e\n\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eUpload DLL\u003c/span\u003e\n      \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactions/upload-release-asset@v1.0.1\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eenv\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eGITHUB_TOKEN\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ secrets.GITHUB_TOKEN }}\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eupload_url\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ steps.create_release.outputs.upload_url }}\u003c/span\u003e\n        \u003cspan class=\"na\"\u003easset_path\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ matrix.repository-name }}/core~/bin/Release/netstandard2.0/UniNativeLinq.dll\u003c/span\u003e\n        \u003cspan class=\"na\"\u003easset_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eUniNativeLinq.dll\u003c/span\u003e\n        \u003cspan class=\"na\"\u003easset_content_type\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapplication/vnd.microsoft.portable-executable\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003cbr\u003e\n\u003cdetails\u003e\u003csummary\u003e変更箇所のみ抜粋\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"yaml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCI.yaml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eBuilds DLL\u003c/span\u003e\n  \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n    \u003cspan class=\"s\"\u003emkdir artifact\u003c/span\u003e\n    \u003cspan class=\"s\"\u003ecd ${{ matrix.repository-name }}/core~\u003c/span\u003e\n    \u003cspan class=\"s\"\u003edotnet build -c Release\u003c/span\u003e\n\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ePost Process DLL\u003c/span\u003e\n  \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n    \u003cspan class=\"s\"\u003ecd ${{ matrix.repository-name }}/post~\u003c/span\u003e\n    \u003cspan class=\"s\"\u003edotnet run ../core~/bin/Release/netstandard2.0/UniNativeLinq.dll ../Assets/Plugins/UNL/UniNativeLinq.dll\u003c/span\u003e\n\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eLicense Activation\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003cbr\u003e\n\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eadd\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003ecommit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-m\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"[add]post~ prot-process project\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"第3章-補足\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%AC%AC3%E7%AB%A0-%E8%A3%9C%E8%B6%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e第3章 補足\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"unitypackage化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitypackage%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUnityPackage化\u003c/h2\u003e\n\n\u003cp\u003eライブラリをGitHubから提供するならば素のDLLを提供するだけというのも不親切です。\u003cbr\u003e\nやはりunitypackageファイルをGitHub Releasesから提供したいものです。\u003c/p\u003e\n\n\u003cp\u003eこの節ではコマンドラインからUnityを操作してunitypackageを作成します。\u003cbr\u003e\nUnityのコマンドラインの機能自体ではunitypackageを作成することは不可能ですが、プロジェクトのEditorフォルダ直下に存在するクラスのstaticメソッドを呼び出すことが可能です。\u003cbr\u003e\n\u003ca href=\"https://docs.unity3d.com/ja/2018.4/ScriptReference/AssetDatabase.ExportPackage.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUnityEditor.AssetDatabase.ExportPackageメソッド\u003c/a\u003eをstaticメソッド内で呼び出してunitypackageを作成します。\u003c/p\u003e\n\n\u003cp\u003e現在のワーキングディレクトリはUniNativeLinqHandsOnのはずです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epowershell\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003emkdir\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-p\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eAssets/Editor\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"n\"\u003eNew-Item\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eAssets/Editor/UnityPackageBuilder.cs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eUnityPackageBuilder.cs\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eUnityPackageBuilder.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEditor\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eHandsOn\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUnityPackageBuilder\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eBuild\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCommandLineArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n      \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eexportPath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eAssetDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExportPackage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e\"Assets/Plugins/UNL/UniNativeLinq.dll\"\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eexportPath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eExportPackageOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eコマンドラインから呼び出すメソッドのシグネチャは必ずSystem.Actionである必要があります。\u003cbr\u003e\nコマンドライン引数を扱いたい場合には\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/api/system.environment.getcommandlineargs?view=netframework-4.8\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSystem.Environment.GetCommandLineArgsメソッド\u003c/a\u003eから適切に文節処理された文字列の配列を受け取りましょう。\u003c/p\u003e\n\n\u003cp\u003eこれは今回限りの約束事ですが、最後のコマンドライン引数がunitypackageの出力先のパスを示すようにします。\u003c/p\u003e\n\n\u003cp\u003eAssetDatabase.ExportPackageの第一引数にstring[]を渡してunitypackageを構築します。\u003cbr\u003e\nここで渡すファイルのパスはプロジェクトのルートに対する相対パスですね。\u003cbr\u003e\n\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003eHandsOn.UnityPackageBuilder.BuildをGitHub Actionsから呼び出し、リリースに同梱します。\u003cbr\u003e\n\u003cdetails\u003e\u003csummary\u003eyamlファイルの最後に追記する部分（インデントには気を付けてください）\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"yaml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCI.yamlへの追記\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCreate UnityPackage\u003c/span\u003e\n  \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ matrix.exe }} -batchmode -nographics -quit -projectPath ${{ matrix.repository-name }} -logFile ./log.log -executeMethod HandsOn.UnityPackageBuilder.Build \"../UniNativeLinq.unitypackage\"\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecat log.log\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eUpload Unity Package\u003c/span\u003e\n  \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactions/upload-release-asset@v1.0.1\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eenv\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eGITHUB_TOKEN\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ secrets.GITHUB_TOKEN }}\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eupload_url\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ steps.create_release.outputs.upload_url }}\u003c/span\u003e\n    \u003cspan class=\"na\"\u003easset_path\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eUniNativeLinq.unitypackage\u003c/span\u003e\n    \u003cspan class=\"na\"\u003easset_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eUniNativeLinq.unitypackage\u003c/span\u003e\n    \u003cspan class=\"na\"\u003easset_content_type\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapplication/x-gzip\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"終わりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e終わりに\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/pCYSl5EDgo/UniNativeLinq-EditorExtension\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUniNativeLinq本家\u003c/a\u003eではエディタ拡張に関連して更にえげつない最適化やMono.Cecilテクニックが使用されています。\u003cbr\u003e\n既存のLINQに比べて非常に高速に動作しますので是非使ってください。\u003c/p\u003e\n\n\u003cp\u003eこのハンズオンよりも更に深くMono.CecilやUniNativeLinqを学びたいという方は\u003ca href=\"https://twitter.com/pCYSl5EDgo\" rel=\"nofollow noopener\" target=\"_blank\"\u003e私のTwitter\u003c/a\u003eのDMなどでご相談いただければ嬉しいです。\u003c/p\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003e画像はUnityのサイトより引用 \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","createdAt":"2019-11-30T14:55:08Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"qPssHXxLOBONnVKOuCMfp+9yLoSEFJF5Vg==--kaZfekLZS9VC8ai+--370tKnY8krCKDKSu5Q6siw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":false,"lastModifiedAt":"2019-11-30T14:55:08Z","likesCount":11,"linkUrl":"https://qiita.com/pCYSl5EDgo/items/cc5cc080dea1cc076b25","organization":null,"originalId":1094440,"stockedCount":6,"title":"【ハンズオン】UniNativeLinqで学ぶGitHub Actions【Mono.Cecil】","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%8F%E3%83%B3%E3%82%BA%E3%82%AA%E3%83%B3%E3%81%AE%E7%9B%AE%E6%A8%99\"\u003eハンズオンの目標\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%AD%86%E8%80%85%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\"\u003e筆者の開発環境\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%89%8D%E6%8F%90%E7%9F%A5%E8%AD%98\"\u003e前提知識\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BA%8B%E5%89%8D%E3%81%AB%E3%83%8F%E3%83%B3%E3%82%BA%E3%82%AA%E3%83%B3%E3%82%92%E8%A1%8C%E3%81%86%E4%BA%BA%E3%81%8C%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%97%E3%81%A6%E3%81%8A%E3%81%8F%E3%81%B9%E3%81%8D%E3%82%82%E3%81%AE\"\u003e事前にハンズオンを行う人がインストールしておくべきもの\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%AC%AC0%E7%AB%A0%E6%BA%96%E5%82%99\"\u003e第0章　準備\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%91%E3%82%B9%E9%80%9A%E3%81%97\"\u003eパス通し\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%9C%E6%A5%AD%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA\"\u003e作業ディレクトリ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#git%E5%88%9D%E6%9C%9F%E5%8C%96\"\u003eGit初期化\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%89%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E4%B8%8B%E6%8B%B5%E3%81%88\"\u003eマネージドプラグインの下拵え\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%AC%AC1%E7%AB%A0uninativelinq-core%E3%81%AE%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AE%E5%AE%9F%E8%A3%851\"\u003e第1章　UniNativeLinq-Coreの最低限の実装(1)\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#nativeenumerablet%E3%81%AE%E6%9C%80%E5%88%9D%E3%81%AE%E5%AE%9A%E7%BE%A9\"\u003eNativeEnumerable\u0026lt;T\u0026gt;の最初の定義\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88\"\u003e最低限のテスト\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#github%E3%81%AB%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E6%88%90%E6%9E%9C%E7%89%A9%E3%82%92%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B\"\u003eGitHubにリポジトリを作って成果物を公開する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#github-actions%E5%AF%BE%E5%BF%9C-cicd%E3%82%92%E8%A1%8C%E3%81%86\"\u003eGitHub Actions対応 CI/CDを行う\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ienumerablet%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003eIEnumerable\u0026lt;T\u0026gt;の実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#asenumerable%E3%81%AB%E7%9B%B8%E5%BD%93%E3%81%99%E3%82%8Basrefenumerable%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003eAsEnumerable()に相当するAsRefEnumerable()の実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#irefenumerabletor%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%81%A8%E5%AE%9F%E8%A3%85\"\u003eIRefEnumerable/torの定義と実装\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%AC%AC2%E7%AB%A0%E5%88%9D%E3%82%81%E3%81%A6%E3%81%AEapi---select\"\u003e第2章　初めてのAPI - Select\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%80%9A%E5%B8%B8linq%E3%81%AEselect%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e通常LINQのSelectについて\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#uninativelinqdll%E3%81%AE%E3%83%9D%E3%82%B9%E3%83%88%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E7%94%A8dotnet-core-30%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88\"\u003eUniNativeLinq.dllのポストプロセス用dotnet core 3.0プロジェクト\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ciyaml%E3%82%92%E3%82%A2%E3%83%83%E3%83%97%E3%83%87%E3%83%BC%E3%83%88\"\u003eCI.yamlをアップデート\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%AC%AC3%E7%AB%A0-%E8%A3%9C%E8%B6%B3\"\u003e第3章 補足\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#unitypackage%E5%8C%96\"\u003eUnityPackage化\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e終わりに\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":2072,"uuid":"cc5cc080dea1cc076b25","banReason":null,"adventCalendarItem":{"day":1,"calendar":{"name":"Unity","urlName":"unity","year":2019,"organization":null}},"author":{"encryptedId":"pEF7KaGiqXhtsQf7nJuUcUSAXXg7--omFVQPIQRPCWTAXI--ucQGdfPfk1EmSn8/m8mo/w==","originalId":256047,"description":"C#!好き!!（語彙不足）\r\nUnityやヴァーレントゥーガ関連の投稿をしていく予定です。","facebookUrl":null,"githubUrl":"https://github.com/pCYSl5EDgo","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"自治区 スーギ・ノウコ","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/256047/profile-images/1546351264","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2Fprofile-images%2F1546351264?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=976dab58dc56a745da2171d56fec56a7","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2Fprofile-images%2F1546351264?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=c5789bc76dd49b92c1ddc68bc158b06b","urlName":"pCYSl5EDgo","websiteUrl":"","twitterUrl":"https://twitter.com/pCYSl5EDgo","twitterUrlName":"pCYSl5EDgo","revealedOrganizations":{"edges":[]}},"tags":[{"name":"GitHub","urlName":"github"},{"name":"C#","urlName":"csharp"},{"name":"LINQ","urlName":"linq"},{"name":"Unity","urlName":"unity"},{"name":"GitHubActions","urlName":"githubactions"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

<!DOCTYPE html><html><head><meta charset="utf-8" /><title>デスクトップマスコットを作ってみた - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/fumittu/items/b22ad70c36d20765c4b6" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="oxJMSpK0ftmy+IfZdPSaTyFykt2u9rQkFD0qg8eKMJ1hPklvHBvXKJUsgnKCUZpTdoc/EZbe1FxQINih0kA5nQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@fumittu" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="デスクトップマスコットを作ってみた - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NE9INDRLNTQ0S3Y0NE9JNDRPRDQ0T1g0NE9lNDRLNTQ0S3o0NE9ENDRPSTQ0S1M1TDJjNDRHajQ0R200NEdfNDRHZiZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1hNTBhNjc0NjU4MmQ4MGI0YTY3MzhiMmQ4YjcwNDcyMw&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR1oxYldsMGRIVSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTE2MjQ0ZjBlOTFhNmZiNjkxN2M0MDgyNzU5NDE2ZTI1&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=87469118774839746614e7dc0bf0c994"><meta property="og:description" content="息抜きと趣味のプログラミングも兼ねて作成してみました。
作ってみたと書いてはいますが下記の記事の発展版みたいな感じです。
デスクトップマスコットの作り方
上記の記事の内容までできていることが前提となります。


デスクトップ内を移動さ..."><meta content="https://qiita.com/fumittu/items/b22ad70c36d20765c4b6" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,DXライブラリ" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-9e5b8c61-0d8f-4680-9d51-8aada50d6697"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Ffumittu%2Fitems%2Fb22ad70c36d20765c4b6">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Ffumittu%2Fitems%2Fb22ad70c36d20765c4b6">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-9e5b8c61-0d8f-4680-9d51-8aada50d6697">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-07-28T17:51:21.000+09:00","dateModified":"2018-07-30T13:28:22.000+09:00","headline":"デスクトップマスコットを作ってみた","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NE9INDRLNTQ0S3Y0NE9JNDRPRDQ0T1g0NE9lNDRLNTQ0S3o0NE9ENDRPSTQ0S1M1TDJjNDRHajQ0R200NEdfNDRHZiZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1hNTBhNjc0NjU4MmQ4MGI0YTY3MzhiMmQ4YjcwNDcyMw\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR1oxYldsMGRIVSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTE2MjQ0ZjBlOTFhNmZiNjkxN2M0MDgyNzU5NDE2ZTI1\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=87469118774839746614e7dc0bf0c994","mainEntityOfPage":"https://qiita.com/fumittu/items/b22ad70c36d20765c4b6","author":{"@type":"Person","address":"","email":null,"identifier":"fumittu","name":"fumittu","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F252878%2Fprofile-images%2F1539438492?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=6c213055787b92763eefeb90da612823","url":"https://qiita.com/fumittu","description":"ゲーム会社でエンジニアしてます。まだまだ未熟者ですが精進していきたいです。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202104-ga-technologies/?utm_source=qiita&amp;utm_medium=header-banner">社内改善＝業界革新。GA technologiesの一石三鳥な社内プロダクト開発とは</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202104-ga-technologies/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"fumittu","type":"items","id":"b22ad70c36d20765c4b6"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"社内改善＝業界革新。GA technologiesの一石三鳥な社内プロダクト開発とは","url":"https://zine.qiita.com/interview/202104-ga-technologies/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"fumittu","type":"items","id":"b22ad70c36d20765c4b6"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"社内改善＝業界革新。GA technologiesの一石三鳥な社内プロダクト開発とは","url":"https://zine.qiita.com/interview/202104-ga-technologies/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"fumittu","type":"items","id":"b22ad70c36d20765c4b6"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"社内改善＝業界革新。GA technologiesの一石三鳥な社内プロダクト開発とは","url":"https://zine.qiita.com/interview/202104-ga-technologies/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/fumittu/items/b22ad70c36d20765c4b6","location":"/fumittu/items/b22ad70c36d20765c4b6","scheme":"https","host":"qiita.com","port":null,"pathname":"/fumittu/items/b22ad70c36d20765c4b6","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"XVXetM0IlDqYfD0xnABWevFCnGz1yAaVYnaszk9GpSWfeduRQ6c9y7+oOJpqpVZmprcxoM3gZu0ma17sWoysJQ==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-a4d6efa9-a50c-4dd7-8293-a2ed2a4bfefe"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/fumittu/items/b22ad70c36d20765c4b6/likers" class="css-1iupg5d">5</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">4</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/b22ad70c36d20765c4b6/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/fumittu/items/b22ad70c36d20765c4b6/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/fumittu/items/b22ad70c36d20765c4b6/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/fumittu/items/b22ad70c36d20765c4b6/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/fumittu/items/b22ad70c36d20765c4b6.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/fumittu"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/252878/profile-images/1539438492" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/fumittu" class="css-10ougpm">@<!-- -->fumittu</a><div class="css-1ay9vb9"><span><meta content="2018-07-28T08:51:21Z"/><time dateTime="2018-07-30T04:28:22Z" class="css-m19uds">updated at 2018-07-30</time></span></div></div></div></div></div><h1 class="css-cgzq40">デスクトップマスコットを作ってみた</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/dx%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa" class="css-4czcte">DXライブラリ</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>息抜きと趣味のプログラミングも兼ねて作成してみました。<br>
作ってみたと書いてはいますが下記の記事の発展版みたいな感じです。<br>
<a href="https://qiita.com/massoumen/items/2985a0fb30472b97a590" id="reference-5a8cd699f7043b354a9f">デスクトップマスコットの作り方</a><br>
上記の記事の内容までできていることが前提となります。</p>

<h1>
<span id="デスクトップ内を移動させる" class="fragment"></span><a href="#%E3%83%87%E3%82%B9%E3%82%AF%E3%83%88%E3%83%83%E3%83%97%E5%86%85%E3%82%92%E7%A7%BB%E5%8B%95%E3%81%95%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>デスクトップ内を移動させる</h1>

<p>表示したモデルをデスクトップ内をマウスで自由に移動させたいですよね。<br>
移動させようと思うと少し面倒かもしれません。<br>
というのもマウスの座標はスクリーン座標、モデルはワールド座標を使用しており、これらの座標を合わせてあげる必要があります。<br>
ワールド座標、スクリーン座標について記述するとそれだけで長くなるのと私も完璧に理解しているわけではないので私が勉強しているリンク先を載せておきます<br>
<a href="https://yttm-work.jp/gmpg/gmpg_0002.html" rel="nofollow noopener" target="_blank">座標変換</a><br>
<a href="https://www.slideshare.net/AimingStudy/20130708-aimosaka-instudyyasui" rel="nofollow noopener" target="_blank">モデルの描画について</a></p>

<p>・マウスポインタがモデル上にあるかの判定<br>
まずは左クリックした際にマウスポインタがモデル上にあるかの判定です。<br>
考え方としては<strong>マウスを左クリックした際に線分を飛ばし、それがモデルに当たればマウスポインタはモデル上にある</strong>と判定します。<br>
その際に線分の始点、終点はワールド座標へ変換します。<br>
コードにすると下記のような感じです。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="kt">int</span> <span class="n">MouseX</span><span class="p">,</span> <span class="n">MouseY</span> <span class="p">;</span>

<span class="c1">// マウスカーソルの座標を取得</span>
<span class="nf">GetMousePoint</span><span class="p">(</span> <span class="p">&amp;</span><span class="n">MouseX</span><span class="p">,</span> <span class="p">&amp;</span><span class="n">MouseY</span> <span class="p">)</span> <span class="p">;</span>
<span class="c1">// マウスボタンの入力状態を更新</span>
<span class="n">PrevInput</span> <span class="p">=</span> <span class="n">NowInput</span> <span class="p">;</span>
<span class="n">NowInput</span> <span class="p">=</span> <span class="nf">GetMouseInput</span><span class="p">()</span> <span class="p">;</span>
<span class="n">EdgeInput</span> <span class="p">=</span> <span class="n">NowInput</span> <span class="p">&amp;</span> <span class="p">~</span><span class="n">PrevInput</span> <span class="p">;</span>

<span class="c1">// 既にモデルを掴んでいるかどうかで処理を分岐</span>
<span class="k">if</span><span class="p">(</span> <span class="n">Catch</span> <span class="p">==</span> <span class="m">0</span> <span class="p">)</span>
<span class="p">{</span>
<span class="err">　　　　</span><span class="c1">// 掴んでいない場合</span>

    <span class="c1">// 左クリックされたらモデルをクリックしたかを調べる</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">EdgeInput</span> <span class="p">&amp;</span> <span class="n">MOUSE_INPUT_1</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">VECTOR</span> <span class="n">ScreenPos1</span> <span class="p">;</span>
        <span class="n">VECTOR</span> <span class="n">ScreenPos2</span> <span class="p">;</span>
        <span class="n">VECTOR</span> <span class="n">WorldPos1</span> <span class="p">;</span>
        <span class="n">VECTOR</span> <span class="n">WorldPos2</span> <span class="p">;</span>

        <span class="c1">// モデルとの当たり判定用の線分の２座標を作成</span>
        <span class="n">ScreenPos1</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="p">(</span> <span class="kt">float</span> <span class="p">)</span><span class="n">MouseX</span> <span class="p">;</span>
        <span class="n">ScreenPos1</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="p">(</span> <span class="kt">float</span> <span class="p">)</span><span class="n">MouseY</span> <span class="p">;</span>
        <span class="n">ScreenPos1</span><span class="p">.</span><span class="n">z</span> <span class="p">=</span> <span class="m">0.0f</span> <span class="p">;</span>

        <span class="n">ScreenPos2</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="p">(</span> <span class="kt">float</span> <span class="p">)</span><span class="n">MouseX</span> <span class="p">;</span>
        <span class="n">ScreenPos2</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="p">(</span> <span class="kt">float</span> <span class="p">)</span><span class="n">MouseY</span> <span class="p">;</span>
        <span class="n">ScreenPos2</span><span class="p">.</span><span class="n">z</span> <span class="p">=</span> <span class="m">1.0f</span> <span class="p">;</span>

        <span class="n">WorldPos1</span> <span class="p">=</span> <span class="nf">ConvScreenPosToWorldPos</span><span class="p">(</span> <span class="n">ScreenPos1</span> <span class="p">)</span> <span class="p">;</span>
        <span class="n">WorldPos2</span> <span class="p">=</span> <span class="nf">ConvScreenPosToWorldPos</span><span class="p">(</span> <span class="n">ScreenPos2</span> <span class="p">)</span> <span class="p">;</span>

        <span class="c1">// モデルの当たり判定情報を更新</span>
        <span class="nf">MV1RefreshCollInfo</span><span class="p">(</span> <span class="n">ModelHandle</span><span class="p">,</span> <span class="p">-</span><span class="m">1</span> <span class="p">)</span> <span class="p">;</span>

        <span class="c1">// モデルと線分の当たり判定</span>
        <span class="n">MV1_COLL_RESULT_POLY</span> <span class="n">Result</span> <span class="p">=</span> <span class="nf">MV1CollCheck_Line</span><span class="p">(</span> <span class="n">ModelHandle</span><span class="p">,</span> <span class="p">-</span><span class="m">1</span><span class="p">,</span> <span class="n">WorldPos1</span><span class="p">,</span> <span class="n">WorldPos2</span> <span class="p">)</span> <span class="p">;</span>
<span class="c1">// 当たっていたら掴み状態にする</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">Result</span><span class="p">.</span><span class="n">HitFlag</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 掴んでいるかどうかのフラグを立てる</span>
            <span class="n">Catch</span> <span class="p">=</span> <span class="m">1</span> <span class="p">;</span>

            <span class="c1">// 掴んだときのスクリーン座標を保存</span>
            <span class="n">CatchMouseX</span> <span class="p">=</span> <span class="n">MouseX</span> <span class="p">;</span>
            <span class="n">CatchMouseY</span> <span class="p">=</span> <span class="n">MouseY</span> <span class="p">;</span>

            <span class="c1">// 掴んだときのモデルのワールド座標を保存</span>
            <span class="n">Catch3DModelPosition</span> <span class="p">=</span> <span class="nf">MV1GetPosition</span><span class="p">(</span> <span class="n">ModelHandle</span> <span class="p">)</span> <span class="p">;</span>

            <span class="c1">// 掴んだときのモデルと線分が当たった座標を保存( 座標をスクリーン座標に変換したものも保存しておく )</span>
            <span class="n">Catch3DHitPosition</span> <span class="p">=</span> <span class="n">Result</span><span class="p">.</span><span class="n">HitPosition</span> <span class="p">;</span>
            <span class="n">Catch2DHitPosition</span> <span class="p">=</span> <span class="nf">ConvWorldPosToScreenPos</span><span class="p">(</span> <span class="n">Catch3DHitPosition</span> <span class="p">)</span> <span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>抜粋しているので変なところもありますがこんな感じです。<br>
EdgeInputは前回のフレームでは押されていなくて今回のフレームでは押されているボタンのみの押下状態を格納しております。<br>
何もないところをクリックしてからオブジェクト上にマウスを動かした際にクリックしたと判定されるとまずいからです。</p>

<p>線分の始点、終点の座標をそれぞれConvScreenPosToWorldPos関数でワールド座標に変換しています。<br>
MV1CollCheck_Lineで線分とモデルの当たり判定をしています。</p>

<p>・モデルの移動<br>
次にマウスの移動に合わせてモデルを移動させる処理です。<br>
処理としては<br>
モデルをクリックしたときの座標を保存しておき、左クリックが離されるまでその座標との差分で計算する。<br>
モデルの移動値にはマウス座標の移動分をそのままモデルの移動分とするのではなく、マウスがクリックした３Ｄ座標にマウス座標の移動分を加味した３Ｄ座標の差分をモデルの移動値とする。<br>
*マウスでクリックしたスクリーン座標とモデルの３Ｄ座標をスクリーン座標化したものが離れていればいるほどマウスカーソルを移動した際の誤差が大きくなるため</p>

<p>コードは下記のようになります</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>// 掴んでいる場合

// マウスの左クリックが離されていたら掴み状態を解除
if( ( NowInput &amp; MOUSE_INPUT_1 ) == 0 )
{
    Catch = 0 ;
}
else
{
    // 掴み状態が継続していたらマウスカーソルの移動に合わせてモデルも移動

    float MoveX, MoveY ;
    VECTOR NowCatch2DHitPosition ;
    VECTOR NowCatch3DHitPosition ;
    VECTOR Now3DModelPosition ;

    // 掴んだときのマウス座標から現在のマウス座標までの移動分を算出
    MoveX = ( float )( MouseX - CatchMouseX ) ;
    MoveY = ( float )( MouseY - CatchMouseY ) ;

    // 掴んだときのモデルと線分が当たった座標をスクリーン座標に変換したものにマウスの移動分を足す
    NowCatch2DHitPosition.x = Catch2DHitPosition.x + MoveX ;
    NowCatch2DHitPosition.y = Catch2DHitPosition.y + MoveY ;
    NowCatch2DHitPosition.z = Catch2DHitPosition.z ;

    // 掴んだときのモデルと線分が当たった座標をスクリーン座標に変換したものにマウスの移動分を足した座標をワールド座標に変換
    NowCatch3DHitPosition = ConvScreenPosToWorldPos( NowCatch2DHitPosition ) ;

    // 掴んだときのモデルのワールド座標に『掴んだときのモデルと線分が当たった座標にマウスの移動分を足した座標をワールド座標に
    // 変換した座標』と、『掴んだときのモデルと線分が当たった座標』との差分を加算
    Now3DModelPosition.x = Catch3DModelPosition.x + NowCatch3DHitPosition.x - Catch3DHitPosition.x ;
    Now3DModelPosition.y = Catch3DModelPosition.y + NowCatch3DHitPosition.y - Catch3DHitPosition.y ;
    Now3DModelPosition.z = Catch3DModelPosition.z + NowCatch3DHitPosition.z - Catch3DHitPosition.z ;

    // ↑の計算で求まった新しい座標をモデルの座標としてセット
    MV1SetPosition( ModelHandle, Now3DModelPosition ) ;
}
</code></pre></div></div>

<p>一度スクリーン座標でマウスの移動値を計算しておき、その移動値をモデルと線分が当たった時のスクリーン座標に足し、それをワールド座標に変換します。<br>
そしてクリック時のモデルのワールド座標にマウスがクリックした３Ｄ座標にマウス座標の移動分を加味した３Ｄ座標の差分をモデルの移動値を加算しています。<br>
移動値には掴んだときのモデルと線分が当たった座標分も含まれてしまっているのでこちらを引いておきます。引かないとクリック時にモデルの原点がクリックした座標に飛んで行ってしまうと思います。</p>

<p>全体のコードです</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>int MouseX, MouseY ;

// マウスカーソルの座標を取得
GetMousePoint( &amp;MouseX, &amp;MouseY ) ;

// マウスボタンの入力状態を更新
PrevInput = NowInput ;
NowInput = GetMouseInput() ;
EdgeInput = NowInput &amp; ~PrevInput ;

// 既にモデルを掴んでいるかどうかで処理を分岐
if( Catch == 0 )
{
        // 掴んでいない場合

    // 左クリックされたらモデルをクリックしたかを調べる
    if( EdgeInput &amp; MOUSE_INPUT_1 )
    {
        VECTOR ScreenPos1 ;
        VECTOR ScreenPos2 ;
        VECTOR WorldPos1 ;
        VECTOR WorldPos2 ;

        // モデルとの当たり判定用の線分の２座標を作成
        ScreenPos1.x = ( float )MouseX ;
        ScreenPos1.y = ( float )MouseY ;
        ScreenPos1.z = 0.0f ;

        ScreenPos2.x = ( float )MouseX ;
        ScreenPos2.y = ( float )MouseY ;
        ScreenPos2.z = 1.0f ;

            WorldPos1 = ConvScreenPosToWorldPos( ScreenPos1 ) ;
        WorldPos2 = ConvScreenPosToWorldPos( ScreenPos2 ) ;

        // モデルの当たり判定情報を更新
        MV1RefreshCollInfo( ModelHandle, -1 ) ;

        // モデルと線分の当たり判定
        MV1_COLL_RESULT_POLY Result = MV1CollCheck_Line( ModelHandle, -1, WorldPos1, WorldPos2 ) ;

        // 当たっていたら掴み状態にする
        if( Result.HitFlag )
        {
            // 掴んでいるかどうかのフラグを立てる
            Catch = 1 ;

            // 掴んだときのスクリーン座標を保存
            CatchMouseX = MouseX ;
            CatchMouseY = MouseY ;

            // 掴んだときのモデルのワールド座標を保存
            Catch3DModelPosition = MV1GetPosition( ModelHandle ) ;

            // 掴んだときのモデルと線分が当たった座標を保存( 座標をスクリーン座標に変換したものも保存しておく )
            Catch3DHitPosition = Result.HitPosition ;
            Catch2DHitPosition = ConvWorldPosToScreenPos( Catch3DHitPosition ) ;
        }
    }
}
else
{
    // 掴んでいる場合

    // マウスの左クリックが離されていたら掴み状態を解除
    if( ( NowInput &amp; MOUSE_INPUT_1 ) == 0 )
    {
        Catch = 0 ;
    }
    else
    {
        // 掴み状態が継続していたらマウスカーソルの移動に合わせてモデルも移動

        float MoveX, MoveY ;
        VECTOR NowCatch2DHitPosition ;
        VECTOR NowCatch3DHitPosition ;
        VECTOR Now3DModelPosition ;

        // 掴んだときのマウス座標から現在のマウス座標までの移動分を算出
        MoveX = ( float )( MouseX - CatchMouseX ) ;
        MoveY = ( float )( MouseY - CatchMouseY ) ;

        // 掴んだときのモデルと線分が当たった座標をスクリーン座標に変換したものにマウスの移動分を足す
        NowCatch2DHitPosition.x = Catch2DHitPosition.x + MoveX ;
        NowCatch2DHitPosition.y = Catch2DHitPosition.y + MoveY ;
        NowCatch2DHitPosition.z = Catch2DHitPosition.z ;

        // 掴んだときのモデルと線分が当たった座標をスクリーン座標に変換したものにマウスの移動分を足した座標をワールド座標に変換
        NowCatch3DHitPosition = ConvScreenPosToWorldPos( NowCatch2DHitPosition ) ;

        // 掴んだときのモデルのワールド座標に『掴んだときのモデルと線分が当たった座標にマウスの移動分を足した座標をワールド座標に
        // 変換した座標』と、『掴んだときのモデルと線分が当たった座標』との差分を加算
        Now3DModelPosition.x = Catch3DModelPosition.x + NowCatch3DHitPosition.x - Catch3DHitPosition.x ;
        Now3DModelPosition.y = Catch3DModelPosition.y + NowCatch3DHitPosition.y - Catch3DHitPosition.y ;
        Now3DModelPosition.z = Catch3DModelPosition.z + NowCatch3DHitPosition.z - Catch3DHitPosition.z ;

        // ↑の計算で求まった新しい座標をモデルの座標としてセット
        MV1SetPosition( ModelHandle, Now3DModelPosition ) ;
    }
</code></pre></div></div>

<p>分かりにくいところもあると思いますが参考になったら幸いです。<br>
変数の定義とかの部分は省略しています。<br>
私はこれを関数化して使用しています。<br>
個人的には3Dの当たり判定、座標変換の勉強にはなったと思いました。</p>

<p>次回はホイールの動きに合わせてのモデルの拡大縮小を書こうと思います。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Ffumittu%2Fitems%2Fb22ad70c36d20765c4b6&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Ffumittu%2Fitems%2Fb22ad70c36d20765c4b6&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/fumittu/items/b22ad70c36d20765c4b6/likers" class="css-1iupg5d">5</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">4</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/b22ad70c36d20765c4b6/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/fumittu/items/b22ad70c36d20765c4b6/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/fumittu/items/b22ad70c36d20765c4b6/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/fumittu/items/b22ad70c36d20765c4b6/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/fumittu/items/b22ad70c36d20765c4b6.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-a4d6efa9-a50c-4dd7-8293-a2ed2a4bfefe">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-f655f235-be42-42bc-920f-31cd652fa337"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-f655f235-be42-42bc-920f-31cd652fa337">{}</script>
      
<div id="LoginModal-react-component-f985bcd1-48ad-426f-a8aa-d1ad4db5ac7d"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-f985bcd1-48ad-426f-a8aa-d1ad4db5ac7d">{}</script>
      
<div id="StockModal-react-component-1c579d2f-88c9-4fef-8236-db58ea69e6f9"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-1c579d2f-88c9-4fef-8236-db58ea69e6f9">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;KzTGqnKetb9OAu1nGys2qDhww+V9Y2rCtFfTA7w7tAbpGMOP/DEcTmnW6Mztjja0b4VuKUVLCrrwSiEhqfG9Bg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e息抜きと趣味のプログラミングも兼ねて作成してみました。\u003cbr\u003e\n作ってみたと書いてはいますが下記の記事の発展版みたいな感じです。\u003cbr\u003e\n\u003ca href=\"https://qiita.com/massoumen/items/2985a0fb30472b97a590\" id=\"reference-5a8cd699f7043b354a9f\"\u003eデスクトップマスコットの作り方\u003c/a\u003e\u003cbr\u003e\n上記の記事の内容までできていることが前提となります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"デスクトップ内を移動させる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%82%B9%E3%82%AF%E3%83%88%E3%83%83%E3%83%97%E5%86%85%E3%82%92%E7%A7%BB%E5%8B%95%E3%81%95%E3%81%9B%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデスクトップ内を移動させる\u003c/h1\u003e\n\n\u003cp\u003e表示したモデルをデスクトップ内をマウスで自由に移動させたいですよね。\u003cbr\u003e\n移動させようと思うと少し面倒かもしれません。\u003cbr\u003e\nというのもマウスの座標はスクリーン座標、モデルはワールド座標を使用しており、これらの座標を合わせてあげる必要があります。\u003cbr\u003e\nワールド座標、スクリーン座標について記述するとそれだけで長くなるのと私も完璧に理解しているわけではないので私が勉強しているリンク先を載せておきます\u003cbr\u003e\n\u003ca href=\"https://yttm-work.jp/gmpg/gmpg_0002.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e座標変換\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://www.slideshare.net/AimingStudy/20130708-aimosaka-instudyyasui\" rel=\"nofollow noopener\" target=\"_blank\"\u003eモデルの描画について\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e・マウスポインタがモデル上にあるかの判定\u003cbr\u003e\nまずは左クリックした際にマウスポインタがモデル上にあるかの判定です。\u003cbr\u003e\n考え方としては\u003cstrong\u003eマウスを左クリックした際に線分を飛ばし、それがモデルに当たればマウスポインタはモデル上にある\u003c/strong\u003eと判定します。\u003cbr\u003e\nその際に線分の始点、終点はワールド座標へ変換します。\u003cbr\u003e\nコードにすると下記のような感じです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eMouseX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMouseY\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// マウスカーソルの座標を取得\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eGetMousePoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eMouseX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eMouseY\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// マウスボタンの入力状態を更新\u003c/span\u003e\n\u003cspan class=\"n\"\u003ePrevInput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNowInput\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eNowInput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetMouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eEdgeInput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNowInput\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e~\u003c/span\u003e\u003cspan class=\"n\"\u003ePrevInput\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 既にモデルを掴んでいるかどうかで処理を分岐\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eCatch\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"err\"\u003e　　　　\u003c/span\u003e\u003cspan class=\"c1\"\u003e// 掴んでいない場合\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 左クリックされたらモデルをクリックしたかを調べる\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eEdgeInput\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eMOUSE_INPUT_1\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVECTOR\u003c/span\u003e \u003cspan class=\"n\"\u003eScreenPos1\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVECTOR\u003c/span\u003e \u003cspan class=\"n\"\u003eScreenPos2\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVECTOR\u003c/span\u003e \u003cspan class=\"n\"\u003eWorldPos1\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVECTOR\u003c/span\u003e \u003cspan class=\"n\"\u003eWorldPos2\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// モデルとの当たり判定用の線分の２座標を作成\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eScreenPos1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eMouseX\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eScreenPos1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eMouseY\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eScreenPos1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.0f\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eScreenPos2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eMouseX\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eScreenPos2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eMouseY\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eScreenPos2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1.0f\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eWorldPos1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eConvScreenPosToWorldPos\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eScreenPos1\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWorldPos2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eConvScreenPosToWorldPos\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eScreenPos2\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// モデルの当たり判定情報を更新\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eMV1RefreshCollInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eModelHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// モデルと線分の当たり判定\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMV1_COLL_RESULT_POLY\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eMV1CollCheck_Line\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eModelHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eWorldPos1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eWorldPos2\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 当たっていたら掴み状態にする\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHitFlag\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 掴んでいるかどうかのフラグを立てる\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCatch\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 掴んだときのスクリーン座標を保存\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCatchMouseX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMouseX\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCatchMouseY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMouseY\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 掴んだときのモデルのワールド座標を保存\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCatch3DModelPosition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eMV1GetPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eModelHandle\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 掴んだときのモデルと線分が当たった座標を保存( 座標をスクリーン座標に変換したものも保存しておく )\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCatch3DHitPosition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHitPosition\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCatch2DHitPosition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eConvWorldPosToScreenPos\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eCatch3DHitPosition\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e抜粋しているので変なところもありますがこんな感じです。\u003cbr\u003e\nEdgeInputは前回のフレームでは押されていなくて今回のフレームでは押されているボタンのみの押下状態を格納しております。\u003cbr\u003e\n何もないところをクリックしてからオブジェクト上にマウスを動かした際にクリックしたと判定されるとまずいからです。\u003c/p\u003e\n\n\u003cp\u003e線分の始点、終点の座標をそれぞれConvScreenPosToWorldPos関数でワールド座標に変換しています。\u003cbr\u003e\nMV1CollCheck_Lineで線分とモデルの当たり判定をしています。\u003c/p\u003e\n\n\u003cp\u003e・モデルの移動\u003cbr\u003e\n次にマウスの移動に合わせてモデルを移動させる処理です。\u003cbr\u003e\n処理としては\u003cbr\u003e\nモデルをクリックしたときの座標を保存しておき、左クリックが離されるまでその座標との差分で計算する。\u003cbr\u003e\nモデルの移動値にはマウス座標の移動分をそのままモデルの移動分とするのではなく、マウスがクリックした３Ｄ座標にマウス座標の移動分を加味した３Ｄ座標の差分をモデルの移動値とする。\u003cbr\u003e\n*マウスでクリックしたスクリーン座標とモデルの３Ｄ座標をスクリーン座標化したものが離れていればいるほどマウスカーソルを移動した際の誤差が大きくなるため\u003c/p\u003e\n\n\u003cp\u003eコードは下記のようになります\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e// 掴んでいる場合\n\n// マウスの左クリックが離されていたら掴み状態を解除\nif( ( NowInput \u0026amp; MOUSE_INPUT_1 ) == 0 )\n{\n    Catch = 0 ;\n}\nelse\n{\n    // 掴み状態が継続していたらマウスカーソルの移動に合わせてモデルも移動\n\n    float MoveX, MoveY ;\n    VECTOR NowCatch2DHitPosition ;\n    VECTOR NowCatch3DHitPosition ;\n    VECTOR Now3DModelPosition ;\n\n    // 掴んだときのマウス座標から現在のマウス座標までの移動分を算出\n    MoveX = ( float )( MouseX - CatchMouseX ) ;\n    MoveY = ( float )( MouseY - CatchMouseY ) ;\n\n    // 掴んだときのモデルと線分が当たった座標をスクリーン座標に変換したものにマウスの移動分を足す\n    NowCatch2DHitPosition.x = Catch2DHitPosition.x + MoveX ;\n    NowCatch2DHitPosition.y = Catch2DHitPosition.y + MoveY ;\n    NowCatch2DHitPosition.z = Catch2DHitPosition.z ;\n\n    // 掴んだときのモデルと線分が当たった座標をスクリーン座標に変換したものにマウスの移動分を足した座標をワールド座標に変換\n    NowCatch3DHitPosition = ConvScreenPosToWorldPos( NowCatch2DHitPosition ) ;\n\n    // 掴んだときのモデルのワールド座標に『掴んだときのモデルと線分が当たった座標にマウスの移動分を足した座標をワールド座標に\n    // 変換した座標』と、『掴んだときのモデルと線分が当たった座標』との差分を加算\n    Now3DModelPosition.x = Catch3DModelPosition.x + NowCatch3DHitPosition.x - Catch3DHitPosition.x ;\n    Now3DModelPosition.y = Catch3DModelPosition.y + NowCatch3DHitPosition.y - Catch3DHitPosition.y ;\n    Now3DModelPosition.z = Catch3DModelPosition.z + NowCatch3DHitPosition.z - Catch3DHitPosition.z ;\n\n    // ↑の計算で求まった新しい座標をモデルの座標としてセット\n    MV1SetPosition( ModelHandle, Now3DModelPosition ) ;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e一度スクリーン座標でマウスの移動値を計算しておき、その移動値をモデルと線分が当たった時のスクリーン座標に足し、それをワールド座標に変換します。\u003cbr\u003e\nそしてクリック時のモデルのワールド座標にマウスがクリックした３Ｄ座標にマウス座標の移動分を加味した３Ｄ座標の差分をモデルの移動値を加算しています。\u003cbr\u003e\n移動値には掴んだときのモデルと線分が当たった座標分も含まれてしまっているのでこちらを引いておきます。引かないとクリック時にモデルの原点がクリックした座標に飛んで行ってしまうと思います。\u003c/p\u003e\n\n\u003cp\u003e全体のコードです\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eint MouseX, MouseY ;\n\n// マウスカーソルの座標を取得\nGetMousePoint( \u0026amp;MouseX, \u0026amp;MouseY ) ;\n\n// マウスボタンの入力状態を更新\nPrevInput = NowInput ;\nNowInput = GetMouseInput() ;\nEdgeInput = NowInput \u0026amp; ~PrevInput ;\n\n// 既にモデルを掴んでいるかどうかで処理を分岐\nif( Catch == 0 )\n{\n        // 掴んでいない場合\n\n    // 左クリックされたらモデルをクリックしたかを調べる\n    if( EdgeInput \u0026amp; MOUSE_INPUT_1 )\n    {\n        VECTOR ScreenPos1 ;\n        VECTOR ScreenPos2 ;\n        VECTOR WorldPos1 ;\n        VECTOR WorldPos2 ;\n\n        // モデルとの当たり判定用の線分の２座標を作成\n        ScreenPos1.x = ( float )MouseX ;\n        ScreenPos1.y = ( float )MouseY ;\n        ScreenPos1.z = 0.0f ;\n\n        ScreenPos2.x = ( float )MouseX ;\n        ScreenPos2.y = ( float )MouseY ;\n        ScreenPos2.z = 1.0f ;\n\n            WorldPos1 = ConvScreenPosToWorldPos( ScreenPos1 ) ;\n        WorldPos2 = ConvScreenPosToWorldPos( ScreenPos2 ) ;\n\n        // モデルの当たり判定情報を更新\n        MV1RefreshCollInfo( ModelHandle, -1 ) ;\n\n        // モデルと線分の当たり判定\n        MV1_COLL_RESULT_POLY Result = MV1CollCheck_Line( ModelHandle, -1, WorldPos1, WorldPos2 ) ;\n\n        // 当たっていたら掴み状態にする\n        if( Result.HitFlag )\n        {\n            // 掴んでいるかどうかのフラグを立てる\n            Catch = 1 ;\n\n            // 掴んだときのスクリーン座標を保存\n            CatchMouseX = MouseX ;\n            CatchMouseY = MouseY ;\n\n            // 掴んだときのモデルのワールド座標を保存\n            Catch3DModelPosition = MV1GetPosition( ModelHandle ) ;\n\n            // 掴んだときのモデルと線分が当たった座標を保存( 座標をスクリーン座標に変換したものも保存しておく )\n            Catch3DHitPosition = Result.HitPosition ;\n            Catch2DHitPosition = ConvWorldPosToScreenPos( Catch3DHitPosition ) ;\n        }\n    }\n}\nelse\n{\n    // 掴んでいる場合\n\n    // マウスの左クリックが離されていたら掴み状態を解除\n    if( ( NowInput \u0026amp; MOUSE_INPUT_1 ) == 0 )\n    {\n        Catch = 0 ;\n    }\n    else\n    {\n        // 掴み状態が継続していたらマウスカーソルの移動に合わせてモデルも移動\n\n        float MoveX, MoveY ;\n        VECTOR NowCatch2DHitPosition ;\n        VECTOR NowCatch3DHitPosition ;\n        VECTOR Now3DModelPosition ;\n\n        // 掴んだときのマウス座標から現在のマウス座標までの移動分を算出\n        MoveX = ( float )( MouseX - CatchMouseX ) ;\n        MoveY = ( float )( MouseY - CatchMouseY ) ;\n\n        // 掴んだときのモデルと線分が当たった座標をスクリーン座標に変換したものにマウスの移動分を足す\n        NowCatch2DHitPosition.x = Catch2DHitPosition.x + MoveX ;\n        NowCatch2DHitPosition.y = Catch2DHitPosition.y + MoveY ;\n        NowCatch2DHitPosition.z = Catch2DHitPosition.z ;\n\n        // 掴んだときのモデルと線分が当たった座標をスクリーン座標に変換したものにマウスの移動分を足した座標をワールド座標に変換\n        NowCatch3DHitPosition = ConvScreenPosToWorldPos( NowCatch2DHitPosition ) ;\n\n        // 掴んだときのモデルのワールド座標に『掴んだときのモデルと線分が当たった座標にマウスの移動分を足した座標をワールド座標に\n        // 変換した座標』と、『掴んだときのモデルと線分が当たった座標』との差分を加算\n        Now3DModelPosition.x = Catch3DModelPosition.x + NowCatch3DHitPosition.x - Catch3DHitPosition.x ;\n        Now3DModelPosition.y = Catch3DModelPosition.y + NowCatch3DHitPosition.y - Catch3DHitPosition.y ;\n        Now3DModelPosition.z = Catch3DModelPosition.z + NowCatch3DHitPosition.z - Catch3DHitPosition.z ;\n\n        // ↑の計算で求まった新しい座標をモデルの座標としてセット\n        MV1SetPosition( ModelHandle, Now3DModelPosition ) ;\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e分かりにくいところもあると思いますが参考になったら幸いです。\u003cbr\u003e\n変数の定義とかの部分は省略しています。\u003cbr\u003e\n私はこれを関数化して使用しています。\u003cbr\u003e\n個人的には3Dの当たり判定、座標変換の勉強にはなったと思いました。\u003c/p\u003e\n\n\u003cp\u003e次回はホイールの動きに合わせてのモデルの拡大縮小を書こうと思います。\u003c/p\u003e\n","createdAt":"2018-07-28T08:51:21Z","elapsedYearsFromLastModifiedAt":3,"encryptedId":"rM1SNYNRoHoQcUYpCshzVOuZKvaid+Jh--qufxMFVzNGGBLD/E--tR5gtYetdLwmNPK4YePHWw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-07-30T04:28:22Z","likesCount":5,"linkUrl":"https://qiita.com/fumittu/items/b22ad70c36d20765c4b6","organization":null,"originalId":672767,"stockedCount":4,"title":"デスクトップマスコットを作ってみた","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%82%B9%E3%82%AF%E3%83%88%E3%83%83%E3%83%97%E5%86%85%E3%82%92%E7%A7%BB%E5%8B%95%E3%81%95%E3%81%9B%E3%82%8B\"\u003eデスクトップ内を移動させる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":1423,"uuid":"b22ad70c36d20765c4b6","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"ZXqJb9jllHdeEE4I4YzlU9rY0CMP--g7n6yRYa5AeJqqkz--lfOPCxNpsBmAbZZFvEiLGw==","originalId":252878,"description":"ゲーム会社でエンジニアしてます。まだまだ未熟者ですが精進していきたいです。","facebookUrl":null,"githubUrl":"https://github.com/fumittu","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/252878/profile-images/1539438492","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F252878%2Fprofile-images%2F1539438492?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=0c2d779e643940b5d8a06fde19ccfb76","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F252878%2Fprofile-images%2F1539438492?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=6c213055787b92763eefeb90da612823","urlName":"fumittu","websiteUrl":"","twitterUrl":"https://twitter.com/fumittu","twitterUrlName":"fumittu","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"DXライブラリ","urlName":"dx%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

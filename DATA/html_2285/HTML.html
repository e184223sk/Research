<!DOCTYPE html><html><head><meta charset="utf-8" /><title>Google.Protobuf.Reflectionを利用してC#でProtocol Buffersを汎用的に解析する話 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/jukey17/items/8239f501a59b14caf5ae" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="sBWRVjGRBkMaUKnV1l7se5/XfY728zDUA1gVo6lXFzc1nwAnc0/s7lk+35Eu3OAZqBpKhOmmQXSUEH/20b4M/g==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@_jukey17" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="Google.Protobuf.Reflectionを利用してC#でProtocol Buffersを汎用的に解析する話 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1SMjl2WjJ4bExsQnliM1J2WW5WbUxsSmxabXhsWTNScGIyN2pncExsaUtubmxLampnWmZqZ2FaREktT0JwMUJ5YjNSdlkyOXNJRUoxWm1abGNuUGpncExtc1k3bmxLam5tb1RqZ2F2b3A2UG1ucERqZ1puamdvdm9xYkUmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NzQ2YTg0MTdkOTc0YTI3YmZjMjNmZTNiNDA2NDc1YTA&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3AxYTJWNU1UYyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTY1MTQzNTEyYjM2YjZjZWQxYWM5MmE3MjdiMzYwNzQx&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=4d5acafe3fcc63267ced5bc3d8ab3a87"><meta property="og:description" content="この記事は DeNA Advent Calendar 2019 の12/9(月)の記事です。


はじめに

この記事ではC#でProtocol Buffers(以下、protobuf)の中身を解析していくための機能について紹介します..."><meta content="https://qiita.com/jukey17/items/8239f501a59b14caf5ae" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Unity,ProtocolBuffers" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds ne2zqn k008qs 1lbjcyg cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}@media (max-width:770px){.css-ne2zqn{margin-top:4px;}}.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-1lbjcyg{box-shadow:0 0 0 1px rgba(0,0,0,0.12) inset;color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:180%;padding:0px 4px;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-78aea8ff-5182-4052-ae4b-dffb9e992326"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fjukey17%2Fitems%2F8239f501a59b14caf5ae">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fjukey17%2Fitems%2F8239f501a59b14caf5ae">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-78aea8ff-5182-4052-ae4b-dffb9e992326">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-12-03T21:36:10.000+09:00","dateModified":"2019-12-09T07:01:05.000+09:00","headline":"Google.Protobuf.Reflectionを利用してC#でProtocol Buffersを汎用的に解析する話","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1SMjl2WjJ4bExsQnliM1J2WW5WbUxsSmxabXhsWTNScGIyN2pncExsaUtubmxLampnWmZqZ2FaREktT0JwMUJ5YjNSdlkyOXNJRUoxWm1abGNuUGpncExtc1k3bmxLam5tb1RqZ2F2b3A2UG1ucERqZ1puamdvdm9xYkUmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NzQ2YTg0MTdkOTc0YTI3YmZjMjNmZTNiNDA2NDc1YTA\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3AxYTJWNU1UYyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTY1MTQzNTEyYjM2YjZjZWQxYWM5MmE3MjdiMzYwNzQx\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=4d5acafe3fcc63267ced5bc3d8ab3a87","mainEntityOfPage":"https://qiita.com/jukey17/items/8239f501a59b14caf5ae","author":{"@type":"Person","address":"Japan","email":null,"identifier":"jukey17","name":"jukey17","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146374%2Fprofile-images%2F1573189181?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=f0ba2504fee4992e07a25a61c4a36f28","url":"https://qiita.com/jukey17","description":"Game Engineer\r\nUnity C#","memberOf":[{"@type":"Organization","address":"東京都渋谷区渋谷二丁目24番12号 渋谷スクランブルスクエア40F","legalName":"株式会社ディー・エヌ・エー","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/2d269c3551c6ad1f3e5bc4be0b507dcb5ab31318/original.jpg?1630536428","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/77fe0bc145892664d307e63dcfbc7a381345ca47/original.jpg?1539161148","identifier":"dena_coltd","description":"We delight people beyond their wildest dreams."}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"jukey17","type":"items","id":"8239f501a59b14caf5ae"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"jukey17","type":"items","id":"8239f501a59b14caf5ae"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"jukey17","type":"items","id":"8239f501a59b14caf5ae"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/jukey17/items/8239f501a59b14caf5ae","location":"/jukey17/items/8239f501a59b14caf5ae","scheme":"https","host":"qiita.com","port":null,"pathname":"/jukey17/items/8239f501a59b14caf5ae","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"Op5SQ8msLHwbBAndKKeJ5RmLiBts9NFXCbvz/hxIQay/FMMyi3LG0Vhqf5nQJYWHLka/EXOhoPee85mrZKFaZQ==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-0c189f2a-2f70-4ae3-925a-c485f379424e"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/jukey17/items/8239f501a59b14caf5ae/likers" class="css-1iupg5d">10</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">7</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/8239f501a59b14caf5ae/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/jukey17/items/8239f501a59b14caf5ae/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/jukey17/items/8239f501a59b14caf5ae/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/jukey17/items/8239f501a59b14caf5ae/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/jukey17/items/8239f501a59b14caf5ae.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><a href="/organizations/dena_coltd"><img src="https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/77fe0bc145892664d307e63dcfbc7a381345ca47/original.jpg?1539161148" class="it-AdcalRibbon_orgImage"/></a><span><a href="/advent-calendar/2019/dena" class="it-AdcalRibbon_title">DeNA <!-- --> Advent Calendar<!-- --> <!-- -->2019</a>Day 9</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/jukey17"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/146374/profile-images/1573189181" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/jukey17" class="css-10ougpm">@<!-- -->jukey17</a><a href="/organizations/dena_coltd" class="css-10ougpm">(<!-- -->株式会社ディー・エヌ・エー<!-- -->)</a><div class="css-1ay9vb9"><span><meta content="2019-12-03T12:36:10Z"/><time dateTime="2019-12-08T22:01:05Z" class="css-m19uds">updated at 2019-12-08</time></span></div></div></div><div class="css-ne2zqn"><div class="css-k008qs"><div class="css-1lbjcyg">Organization</div></div></div></div></div><h1 class="css-cgzq40">Google.Protobuf.Reflectionを利用してC#でProtocol Buffersを汎用的に解析する話</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/protocolbuffers" class="css-4czcte">ProtocolBuffers</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>この記事は <a href="https://qiita.com/advent-calendar/2019/dena">DeNA Advent Calendar 2019</a> の12/9(月)の記事です。</p>

<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>この記事ではC#でProtocol Buffers(以下、protobuf)の中身を解析していくための機能について紹介します</p>

<p>※本題に入るまで少し前置きがあるので、そういうのは飛ばしたいという方は<a href="#%E5%90%84%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%94%E3%81%A8%E3%81%AB%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8C%E5%A4%A7%E5%A4%89">こちらの本編</a>へ直接どうぞ</p>

<h2>
<span id="経緯" class="fragment"></span><a href="#%E7%B5%8C%E7%B7%AF"><i class="fa fa-link"></i></a>経緯</h2>

<p>普段はゲームのクライアントエンジニアとしてUnityによるゲーム開発の仕事をしている人間なのですが、とある案件でUnityでprotobufを扱いたいというニーズが発生し、C#でゴリゴリprotobufのデータを弄ることになりました</p>

<p>その際に調べながら実装を進めていたところ「C#でprotobufを扱う内容ってあまり深堀りされていないなぁ」と感じ、今回の記事公開に至りました</p>

<h2>
<span id="ターゲット" class="fragment"></span><a href="#%E3%82%BF%E3%83%BC%E3%82%B2%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>ターゲット</h2>

<p>protobufがどういったものなのかを知っている前提で話を進めていきます</p>

<p><strong>「C#(Unity)でゴリゴリにprotobufを扱いたいんじゃ〜」という人がドンピシャなメインターゲット</strong>ですが、<del>中々に稀有な存在だと思われるので</del>、実際にそういう人ではなくても「そういうこともできるんだ」と思ってもらえたら幸いです</p>

<p>また、今回取り扱うprotobufは<strong>proto3</strong>のバージョンを対象としています</p>

<p>それぞれに関連する用語の詳細な解説は省いていきますので予めご了承ください</p>

<h2>
<span id="得られるもの" class="fragment"></span><a href="#%E5%BE%97%E3%82%89%E3%82%8C%E3%82%8B%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>得られるもの</h2>

<p>今まであまり語られることがなかった<code>Google.Protobuf.Reflection</code>の機能について学ぶことができます</p>

<p>UnityのEditor拡張を使って直接protobufのデータを弄りたいというのが具体的な要件でしたが、Editor拡張の部分はとくに目新しいことはしていないため、今回は<code>Google.Protobuf.Reflection</code>を使ってprotobufのデータを汎用的に読み書きする部分(非Unity依存・PureなC#コード)をメインに解説していきます</p>

<h1>
<span id="cでprotobufを扱う最小サンプル" class="fragment"></span><a href="#c%E3%81%A7protobuf%E3%82%92%E6%89%B1%E3%81%86%E6%9C%80%E5%B0%8F%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB"><i class="fa fa-link"></i></a>C#でprotobufを扱う最小サンプル</h1>

<p><a href="https://developers.google.com/protocol-buffers/docs/csharptutorial" class="autolink" rel="nofollow noopener" target="_blank">https://developers.google.com/protocol-buffers/docs/csharptutorial</a><br>
公式のチュートリアルにサンプルコードが載っています</p>

<h2>
<span id="ロード" class="fragment"></span><a href="#%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>ロード</h2>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">Person</span> <span class="n">john</span><span class="p">;</span>
<span class="c1">// john.datというファイルをロードし</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">input</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="nf">OpenRead</span><span class="p">(</span><span class="s">"john.dat"</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">// インスタンスに内容を格納する</span>
    <span class="n">john</span> <span class="p">=</span> <span class="n">Person</span><span class="p">.</span><span class="n">Parser</span><span class="p">.</span><span class="nf">ParseFrom</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="セーブ" class="fragment"></span><a href="#%E3%82%BB%E3%83%BC%E3%83%96"><i class="fa fa-link"></i></a>セーブ</h2>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// johnという変数名のインスタンスを予め用意する</span>
<span class="n">Person</span> <span class="n">john</span> <span class="p">=</span> <span class="p">...;</span>
<span class="c1">// john.datファイルを新たに作成し</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s">"john.dat"</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">// johnの内容をファイルに書き出す</span>
    <span class="n">john</span><span class="p">.</span><span class="nf">WriteTo</span><span class="p">(</span><span class="n">output</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これらは抜粋ですが、全体のコードを確認したい場合は以下のリンクから辿ることができます<br>
<a href="https://github.com/protocolbuffers/protobuf/tree/master/csharp/src/AddressBook" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/protocolbuffers/protobuf/tree/master/csharp/src/AddressBook</a></p>

<p><strong><del>このようにして各スキーマごとにprotobufのデータをロードして、プロダクトコードでゴリゴリにデータ弄ってそれをまたセーブをすればOK！</del></strong></p>

<h1>
<span id="各スキーマごとにメンテナンスするのが大変" class="fragment"></span><a href="#%E5%90%84%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%94%E3%81%A8%E3%81%AB%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8C%E5%A4%A7%E5%A4%89"><i class="fa fa-link"></i></a>各スキーマごとにメンテナンスするのが大変！</h1>

<p><strong>はい、ここからが本題です</strong></p>

<p>スキーマ定義が少ないうちは個別にゴリゴリ実装をしていってもそこまで問題はないのですが、ガッツリ使い込んでスキーマ定義が増えていくと<strong>そのスキーマ定義に依存した実装のメンテナンスが非常に大変になってきます</strong></p>

<p>新しくスキーマの定義を増やしたり、スキーマの内容を変更したりするたびにメンテナンスをすることになるので、<strong>なるべく依存するコードは最低限に留めて汎用的に取り扱えるような実装にしたいです</strong></p>

<p>今回の要件では、UnityEditor上からパラメータの調整をできるようにしたいというものがあり、<strong>スキーマごとに入力エディタを作るのは現実的ではありませんでした</strong></p>

<h2>
<span id="googleprotobufreflection" class="fragment"></span><a href="#googleprotobufreflection"><i class="fa fa-link"></i></a><code>Google.Protobuf.Reflection</code>
</h2>

<p>ここで登場するのが<code>Google.Protobuf.Reflection</code>のnamespace下にある機能です</p>

<p>protobufがスキーマ定義に対応して自動生成してくれるC#コードは、スキーマ定義ごとに<code>Google.Protobuf.IMessage</code>を継承したクラスになっています<br>
(以下、スキーマ定義に対応したprotobufが自動生成するC#クラスをメッセージと呼びます)</p>

<p><code>Google.Protobuf.IMessage</code>の定義に着目すると<strong><code>Google.Protobuf.Reflection.MessageDescriptor Descriptor { get; }</code> というプロパティ</strong>が存在します</p>

<p>この<code>Google.Protobuf.Reflection</code>にある機能を使うことで、メッセージの具体的な型に依存せずにそのメッセージの中身を調べることができます<br>
<strong>※要するにprotobufの仕様に限定させたC#のReflection機能のようなものです</strong></p>

<p>これを使えば<strong>メッセージの具象型に依存した実装をある程度省略することができそう</strong>です</p>

<h1>
<span id="メッセージを解析する" class="fragment"></span><a href="#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>メッセージを解析する</h1>

<p>ではどのようにして<code>Google.Protobuf.Reflection</code>の機能を使っていくのか<br>
protobufはメッセージ単位でデータを扱うので、メッセージから掘り下げていきましょう</p>

<p>下記のようなスキーマ定義を例にどのような内容が取れるのかを解説していきます</p>

<div class="code-frame" data-lang="protobuf">
<div class="code-lang"><span class="bold">SampleMessage.proto</span></div>
<div class="highlight"><pre class="with-code"><code><span class="na">syntax</span> <span class="o">=</span> <span class="s">"proto3"</span><span class="p">;</span>
<span class="kn">package</span> <span class="nn">Sample</span><span class="p">;</span>

<span class="k">option</span> <span class="na">csharp_namespace</span> <span class="o">=</span> <span class="s">"Sample.Messages"</span><span class="p">;</span>

<span class="c1">// 列挙型の宣言(外側)</span>
<span class="kd">enum</span> <span class="n">SampleEnum</span> <span class="p">{</span>
    <span class="na">Hoge</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="na">Fuga</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="na">Piyo</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// メッセージの宣言(外側)</span>
<span class="kd">message</span> <span class="nc">ExternalMessage</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="na">float_field</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// メッセージの宣言</span>
<span class="kd">message</span> <span class="nc">SampleMessage</span> <span class="p">{</span>
    <span class="c1">// フィールドの定義(Scalar Value Types)</span>
    <span class="kt">int32</span> <span class="na">int_field</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c1">// フィールドの定義(Enum Type)</span>
    <span class="n">SampleEnum</span> <span class="na">enum_field</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="c1">// フィールドの定義(Message Type)</span>
    <span class="n">InternalMessage</span> <span class="na">message_field</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="c1">// フィールドの定義(Repeated Type)</span>
    <span class="k">repeated</span> <span class="kt">string</span> <span class="na">repeated_field</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="c1">// フィールドの定義(Map Type)</span>
    <span class="n">map</span><span class="o">&lt;</span><span class="kt">int32</span><span class="p">,</span> <span class="kt">string</span><span class="err">&gt;</span> <span class="na">map_field</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="c1">// Oneof</span>
    <span class="k">oneof</span> <span class="n">oneof_field</span> <span class="p">{</span>
        <span class="kt">string</span> <span class="na">oneof_string</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
        <span class="kt">uint32</span> <span class="na">oneof_uint</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
        <span class="n">ExternalMessage</span> <span class="na">oneof_message</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 列挙型の宣言(入れ子)</span>
    <span class="kd">enum</span> <span class="n">InternalEnum</span> <span class="p">{</span>
        <span class="na">First</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="na">Second</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="na">Third</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// メッセージの宣言（入れ子）</span>
    <span class="kd">message</span> <span class="nc">InternalMessage</span> <span class="p">{</span>
        <span class="kt">bool</span> <span class="na">bool_field</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="messagedescriptor" class="fragment"></span><a href="#messagedescriptor"><i class="fa fa-link"></i></a><code>MessageDescriptor</code>
</h2>

<p>先程も紹介したように、<code>IMessage</code>には <code>MessageDescriptor Descriptor { get; }</code> というプロパティが定義されています<br>
ここからメッセージの内容を解析していくことができます<br>
メッセージ内に定義されている内容が整理された状態でこの<code>MessageDescriptor</code>に詰まっています</p>

<p>以下に今回のケースで利用するものを列挙します</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">IMessage</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SampleMessage</span><span class="p">();</span> <span class="c1">// データの用意は省略</span>
<span class="n">MessageDescriptor</span> <span class="n">descriptor</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">;</span>

<span class="c1">// メッセージの名前 SampleMessage</span>
<span class="n">descriptor</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>

<span class="c1">// パッケージ名を含めた名前 Sample.SampleMessage</span>
<span class="n">descriptor</span><span class="p">.</span><span class="n">FullName</span><span class="p">;</span>

<span class="c1">// C#上でのメッセージの型情報 typeof(Sample.Messages.SampleMessage)</span>
<span class="n">descriptor</span><span class="p">.</span><span class="n">ClrType</span><span class="p">;</span>

<span class="c1">// 親のメッセージの情報 SampleMessageは入れ子に宣言されていないのでnull</span>
<span class="n">descriptor</span><span class="p">.</span><span class="n">ContainingType</span><span class="p">;</span>

<span class="c1">// メッセージ内に定義されているEnum全て</span>
<span class="n">descriptor</span><span class="p">.</span><span class="n">EnumTypes</span><span class="p">;</span>

<span class="c1">// メッセージ内に定義されているメッセージ全て</span>
<span class="n">descriptor</span><span class="p">.</span><span class="n">NestedTypes</span><span class="p">;</span>

<span class="c1">// メッセージ内に定義されているフィールド全て ※後述で解説</span>
<span class="n">descriptor</span><span class="p">.</span><span class="n">Fields</span><span class="p">;</span>
<span class="c1">// FindFieldByName/FindFieldByNumberメソッドで任意のフィールドを取得できる</span>
<span class="n">FieldDescriptor</span> <span class="n">field1</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="nf">FindFieldByName</span><span class="p">(</span><span class="s">"int_field"</span><span class="p">);</span>
<span class="n">FieldDescriptor</span> <span class="n">field2</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="nf">FindFieldByNumber</span><span class="p">(</span><span class="m">2</span><span class="p">);</span>
<span class="c1">// InDeclarationOrder/InFieldNumberOrderメソッドで中身を列挙できる</span>
<span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">fieldDescriptor</span> <span class="k">in</span> <span class="n">descriptor</span><span class="p">.</span><span class="n">Fields</span><span class="p">.</span><span class="nf">InDeclarationOrder</span><span class="p">())</span>
<span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">fieldDescriptor</span> <span class="k">in</span> <span class="n">descriptor</span><span class="p">.</span><span class="n">Fields</span><span class="p">.</span><span class="nf">InFieldNumberOrder</span><span class="p">())</span>

<span class="c1">// メッセージ内に定義されているOneof全て ※後述で解説</span>
<span class="n">descriptor</span><span class="p">.</span><span class="n">Oneofs</span><span class="p">;</span>
</code></pre></div></div>

<h1>
<span id="enumを解析する" class="fragment"></span><a href="#enum%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Enumを解析する</h1>

<p>Enumは宣言されている定数の情報がメインになるため、今回の要件では解析することは必須ではありません<br>
一応どのような情報が入っているか確認しましょう</p>

<h2>
<span id="enumdescriptor" class="fragment"></span><a href="#enumdescriptor"><i class="fa fa-link"></i></a><code>EnumDescriptor</code>
</h2>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// SampleMessage内に宣言されているInternalEnumを取り出す</span>
<span class="n">IMessage</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SampleMessage</span><span class="p">();</span> <span class="c1">// データの用意は省略</span>
<span class="n">EnumDescriptor</span> <span class="n">descriptor</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">EnumTypes</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>

<span class="c1">// Enumの名前 InternalEnum</span>
<span class="n">descriptor</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>

<span class="c1">// パッケージ名を含めた名前 Sample.SampleMessage.InternalEnum</span>
<span class="n">descriptor</span><span class="p">.</span><span class="n">FullName</span><span class="p">;</span>

<span class="c1">// C#上でのEnumの型情報 typeof(Sample.Messages.SampleMessage.Types.InternalEnum)</span>
<span class="n">descriptor</span><span class="p">.</span><span class="n">ClrType</span><span class="p">;</span>

<span class="c1">// 親のメッセージの情報 SampleMessageの入れ子になっているのでSampleMessageのMessageDescriptorが入っている</span>
<span class="n">descriptor</span><span class="p">.</span><span class="n">ContainingType</span><span class="p">;</span>

<span class="c1">// 定義されている定数全て(EnumValueDescriptor)</span>
<span class="n">descriptor</span><span class="p">.</span><span class="n">Values</span><span class="p">;</span>
</code></pre></div></div>

<h2>
<span id="enumvaluedescriptor" class="fragment"></span><a href="#enumvaluedescriptor"><i class="fa fa-link"></i></a><code>EnumValueDescriptor</code>
</h2>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// SampleMessage.protoに宣言されているSampleEnumを取り出す</span>
<span class="c1">// ※SampleMessageReflectionクラスのDescriptorプロパティからSampleMessage.protoファイルのFileDescriptorが取得できる</span>
<span class="n">EnumDescriptor</span> <span class="n">enumDescriptor</span> <span class="p">=</span> <span class="n">SampleMessageReflection</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="n">EnumTypes</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>

<span class="c1">// SampleEnumの2番目に定義されている定数を取り出す</span>
<span class="n">EnumValueDescriptor</span> <span class="n">enumValueDescriptor</span> <span class="p">=</span> <span class="n">enumDescriptor</span><span class="p">.</span><span class="n">Values</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>

<span class="c1">//  定数の名前 Fuga</span>
<span class="n">enumValueDescriptor</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>

<span class="c1">// パッケージ名を含めた名前 Sample.SampleEnum.Fuga</span>
<span class="n">descriptor</span><span class="p">.</span><span class="n">FullName</span><span class="p">;</span>

<span class="c1">// 定数の宣言順序 1 (0 origin)</span>
<span class="n">enumValueDescriptor</span><span class="p">.</span><span class="n">Index</span><span class="p">;</span>

<span class="c1">// 定数の値 10</span>
<span class="n">enumValueDescriptor</span><span class="p">.</span><span class="n">Number</span><span class="p">;</span>

</code></pre></div></div>

<h1>
<span id="フィールドを解析する" class="fragment"></span><a href="#%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>フィールドを解析する</h1>

<p>繰り返しになりますが、今回の要件ではメッセージの型に依存せずに中身を読み書きしたいので、<strong>実際の値が入っているフィールドの中身が最重要です</strong><br>
詳しく掘り下げていきましょう</p>

<p>まず初めに、protobufのフィールドには大きく分類すると以下の種類が存在します</p>

<ul>
<li>Scalar Value Types</li>
<li>Enum</li>
<li>Message</li>
<li>Repeated</li>
<li>Map</li>
</ul>

<p>Oneofと呼ばれるものも存在しますが、これは<code>Google.Protobuf.Reflection</code>では厳密にはフィールドという扱いではないので<a href="#Oneof%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B">別枠で解説します</a><br>
1つずつ見ていきたいところですがまずはどのフィールドでも共通の内容を見ていきます</p>

<h2>
<span id="fielddescriptor" class="fragment"></span><a href="#fielddescriptor"><i class="fa fa-link"></i></a><code>FieldDescriptor</code>
</h2>

<p>フィールドの情報は <code>FieldDescriptor</code>で知ることができます<br>
この中身を調べることによって<strong>対象のフィールドが前述のどの種別に値するのかを判断することができます</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">IMessage</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SampleMessage</span><span class="p">();</span> <span class="c1">// データの用意は省略</span>
<span class="n">FieldDescriptor</span> <span class="n">enumField</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="nf">FindFieldByName</span><span class="p">(</span><span class="s">"enum_field"</span><span class="p">);</span>
<span class="n">FieldDescriptor</span> <span class="n">messageField</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="nf">FindFieldByName</span><span class="p">(</span><span class="s">"message_field"</span><span class="p">);</span>
<span class="n">FieldDescriptor</span> <span class="n">boolField</span> <span class="p">=</span> <span class="n">messageField</span><span class="p">.</span><span class="n">MessageType</span><span class="p">.</span><span class="nf">FindFieldByName</span><span class="p">(</span><span class="s">"bool_field"</span><span class="p">);</span>
<span class="n">FieldDescriptor</span> <span class="n">repeatedField</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="nf">FindFieldByName</span><span class="p">(</span><span class="s">"repeated_field"</span><span class="p">);</span>
<span class="n">FieldDescriptor</span> <span class="n">mapField</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="nf">FindFieldByName</span><span class="p">(</span><span class="s">"map_field"</span><span class="p">);</span>

<span class="c1">// フィールドの名前 ※C#上のプロパティ名ではなくprotoファイル内で宣言した名前</span>
<span class="n">enumField</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>     <span class="c1">// enum_field</span>
<span class="n">messageField</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>  <span class="c1">// message_field</span>
<span class="n">boolField</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>     <span class="c1">// bool_field</span>
<span class="n">repeatedField</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span> <span class="c1">// repeated_field</span>
<span class="n">mapField</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>      <span class="c1">// map_field</span>

<span class="c1">// パッケージ名を含めた名前</span>
<span class="n">enumField</span><span class="p">.</span><span class="n">FullName</span><span class="p">;</span>     <span class="c1">// Sample.SampleMessage.enum_field</span>
<span class="n">messageField</span><span class="p">.</span><span class="n">FullName</span><span class="p">;</span>  <span class="c1">// Sample.SampleMessage.message_field</span>
<span class="n">boolField</span><span class="p">.</span><span class="n">FullName</span><span class="p">;</span>     <span class="c1">// Sample.SampleMessage.InternalMessage.bool_field</span>
<span class="n">repeatedField</span><span class="p">.</span><span class="n">FullName</span><span class="p">;</span> <span class="c1">// Sample.SampleMessage.repeated_field</span>
<span class="n">mapField</span><span class="p">.</span><span class="n">FullName</span><span class="p">;</span>      <span class="c1">// Sample.SampleMessage.map_field</span>

<span class="c1">// フィールドの種別</span>
<span class="n">enumField</span><span class="p">.</span><span class="n">FieldType</span><span class="p">;</span>     <span class="c1">// FieldType.Enum</span>
<span class="n">messageField</span><span class="p">.</span><span class="n">FieldType</span><span class="p">;</span>  <span class="c1">// FieldType.Message</span>
<span class="n">boolField</span><span class="p">.</span><span class="n">FieldType</span><span class="p">;</span>     <span class="c1">// FieldType.Bool</span>
<span class="n">repeatedField</span><span class="p">.</span><span class="n">FieldType</span><span class="p">;</span> <span class="c1">// FieldType.String ※repeated stringで宣言されているのでString扱い</span>
<span class="n">mapField</span><span class="p">.</span><span class="n">FieldType</span><span class="p">;</span>      <span class="c1">// FieldType.Message ※map&lt;,&gt;で宣言されているのでMessage扱い</span>

<span class="c1">// protoファイル内でフィールド宣言時に設定した数値</span>
<span class="n">enumField</span><span class="p">.</span><span class="n">FieldNumber</span><span class="p">;</span>     <span class="c1">// 2</span>
<span class="n">messageField</span><span class="p">.</span><span class="n">FieldNumber</span><span class="p">;</span>  <span class="c1">// 3</span>
<span class="n">boolField</span><span class="p">.</span><span class="n">FieldNumber</span><span class="p">;</span>     <span class="c1">// 1</span>
<span class="n">repeatedField</span><span class="p">.</span><span class="n">FieldNumber</span><span class="p">;</span> <span class="c1">// 4</span>
<span class="n">mapField</span><span class="p">.</span><span class="n">FieldNumber</span><span class="p">;</span>      <span class="c1">// 5</span>

<span class="c1">// FieldTypeがMessageだった場合にMessageDescriptorが入っている</span>
<span class="n">enumField</span><span class="p">.</span><span class="n">MessageType</span><span class="p">;</span>     <span class="c1">// null</span>
<span class="n">messageField</span><span class="p">.</span><span class="n">MessageType</span><span class="p">;</span>  <span class="c1">// InternalMessageのMessageDescriptor</span>
<span class="n">boolField</span><span class="p">.</span><span class="n">MessageType</span><span class="p">;</span>     <span class="c1">// null</span>
<span class="n">repeatedField</span><span class="p">.</span><span class="n">MessageType</span><span class="p">;</span> <span class="c1">// null</span>
<span class="n">mapField</span><span class="p">.</span><span class="n">MessageType</span><span class="p">;</span>      <span class="c1">// MapFieldEntryのMessageDescriptor ※後述で解説</span>

<span class="c1">// FieldTypeがEnumだった場合にEnumDescriptorが入っている</span>
<span class="n">enumField</span><span class="p">.</span><span class="n">EnumType</span><span class="p">;</span>     <span class="c1">// SampleEnumのEnumDescriptor</span>
<span class="n">messageField</span><span class="p">.</span><span class="n">EnumType</span><span class="p">;</span>  <span class="c1">// null</span>
<span class="n">boolField</span><span class="p">.</span><span class="n">EnumType</span><span class="p">;</span>     <span class="c1">// null</span>
<span class="n">repeatedField</span><span class="p">.</span><span class="n">EnumType</span><span class="p">;</span> <span class="c1">// null</span>
<span class="n">mapField</span><span class="p">.</span><span class="n">EnumType</span><span class="p">;</span>      <span class="c1">// null</span>

<span class="c1">// 親のメッセージの情報</span>
<span class="n">enumField</span><span class="p">.</span><span class="n">ContainingType</span><span class="p">;</span>     <span class="c1">// SampleMessageのMessageDescriptor</span>
<span class="n">messageField</span><span class="p">.</span><span class="n">ContainingType</span><span class="p">;</span>  <span class="c1">// SampleMessageのMessageDescriptor</span>
<span class="n">boolField</span><span class="p">.</span><span class="n">ContainingType</span><span class="p">;</span>     <span class="c1">// InternalMessageのMessageDescriptor(messageField.MessageTypeと同じ)</span>
<span class="n">repeatedField</span><span class="p">.</span><span class="n">ContainingType</span><span class="p">;</span> <span class="c1">// SampleMessageのMessageDescriptor</span>
<span class="n">mapField</span><span class="p">.</span><span class="n">ContainingType</span><span class="p">;</span>      <span class="c1">// SampleMessageのMessageDescriptor</span>

<span class="c1">//　Oneofに含まれている場合Oneofの情報が入る ※後述で解説</span>
<span class="n">enumField</span><span class="p">.</span><span class="n">ContainingOneof</span><span class="p">;</span>     <span class="c1">// null</span>
<span class="n">messageField</span><span class="p">.</span><span class="n">ContainingOneof</span><span class="p">;</span>  <span class="c1">// null</span>
<span class="n">boolField</span><span class="p">.</span><span class="n">ContainingOneof</span><span class="p">;</span>     <span class="c1">// null</span>
<span class="n">repeatedField</span><span class="p">.</span><span class="n">ContainingOneof</span><span class="p">;</span> <span class="c1">// null</span>
<span class="n">mapField</span><span class="p">.</span><span class="n">ContainingOneof</span><span class="p">;</span>      <span class="c1">// null</span>

<span class="c1">// Repeated属性がある場合にtrueになる</span>
<span class="n">enumField</span><span class="p">.</span><span class="n">IsRepeated</span><span class="p">;</span>     <span class="c1">// false</span>
<span class="n">messageField</span><span class="p">.</span><span class="n">IsRepeated</span><span class="p">;</span>  <span class="c1">// false</span>
<span class="n">boolField</span><span class="p">.</span><span class="n">IsRepeated</span><span class="p">;</span>     <span class="c1">// false</span>
<span class="n">repeatedField</span><span class="p">.</span><span class="n">IsRepeated</span><span class="p">;</span> <span class="c1">// true</span>
<span class="n">mapField</span><span class="p">.</span><span class="n">IsRepeated</span><span class="p">;</span>      <span class="c1">// true</span>

<span class="c1">// Map属性がある場合にtrueになる</span>
<span class="n">enumField</span><span class="p">.</span><span class="n">IsRepeated</span><span class="p">;</span>     <span class="c1">// false</span>
<span class="n">messageField</span><span class="p">.</span><span class="n">IsRepeated</span><span class="p">;</span>  <span class="c1">// false</span>
<span class="n">boolField</span><span class="p">.</span><span class="n">IsRepeated</span><span class="p">;</span>     <span class="c1">// false</span>
<span class="n">repeatedField</span><span class="p">.</span><span class="n">IsRepeated</span><span class="p">;</span> <span class="c1">// false</span>
<span class="n">mapField</span><span class="p">.</span><span class="n">IsRepeated</span><span class="p">;</span>      <span class="c1">// true</span>

<span class="c1">// 実体にアクセスするためのラッパークラス ※後述で解説</span>
<span class="n">enumField</span><span class="p">.</span><span class="n">Accessor</span><span class="p">;</span>     <span class="c1">// SingleFieldAccessor</span>
<span class="n">messageField</span><span class="p">.</span><span class="n">Accessor</span><span class="p">;</span>  <span class="c1">// SingleFieldAccessor</span>
<span class="n">boolField</span><span class="p">.</span><span class="n">Accessor</span><span class="p">;</span>     <span class="c1">// SingleFieldAccessor</span>
<span class="n">repeatedField</span><span class="p">.</span><span class="n">Accessor</span><span class="p">;</span> <span class="c1">// RepeatedFieldAccessor</span>
<span class="n">mapField</span><span class="p">.</span><span class="n">Accessor</span><span class="p">;</span>      <span class="c1">// MapFieldAccessor</span>
</code></pre></div></div>

<p>フィールドの種別を判断するために必要な情報が分かったのでそれぞれ具体的な種別ごとに掘り下げていきましょう</p>

<h2>
<span id="scalar-value-types" class="fragment"></span><a href="#scalar-value-types"><i class="fa fa-link"></i></a>Scalar Value Types</h2>

<p>Scalar Value Typesにどのようなものが含まれるのかは下記の公式ドキュメントにまとまっています<br>
<a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" class="autolink" rel="nofollow noopener" target="_blank">https://developers.google.com/protocol-buffers/docs/proto3#scalar</a></p>

<ul>
<li><code>double</code></li>
<li><code>float</code></li>
<li><code>int32</code></li>
<li><code>int64</code></li>
<li><code>uint32</code></li>
<li><code>uint64</code></li>
<li><code>sint32</code></li>
<li><code>sint64</code></li>
<li><code>fixed32</code></li>
<li><code>fixed64</code></li>
<li><code>sfixed32</code></li>
<li><code>sfixed64</code></li>
<li><code>bool</code></li>
<li><code>string</code></li>
<li><code>bytes</code></li>
</ul>

<p>また、これらは前述で紹介した<strong><code>FieldDescriptor.FieldType</code>で判断することができます</strong></p>

<p>実体にアクセスするためには<code>FieldDescriptor.Accessor</code>を使います<br>
Scalar Value TypesなFieldTypeの場合、<code>SingleFieldAccessor</code>が使われており、<code>GetValue()</code>/<code>SetValue()</code>メソッドで値の読み書きができます</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SampleMessage</span> <span class="p">{</span> <span class="n">IntField</span> <span class="p">=</span> <span class="m">10</span> <span class="p">};</span>
<span class="kt">var</span> <span class="n">field</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="nf">FindFieldByName</span><span class="p">(</span><span class="s">"int_field"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">intFieldValue</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">field</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">message</span><span class="p">);</span> <span class="c1">// 中身は10</span>
<span class="n">field</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="m">20</span><span class="p">);</span>
<span class="n">message</span><span class="p">.</span><span class="n">IntField</span><span class="p">;</span> <span class="c1">// 中身は20</span>
</code></pre></div></div>

<h3>
<span id="unity-appendix" class="fragment"></span><a href="#unity-appendix"><i class="fa fa-link"></i></a>unity appendix</h3>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// 宣言などは省略しています</span>
<span class="kt">var</span> <span class="n">fieldValue</span> <span class="p">=</span> <span class="n">fieldDescriptor</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">parentMessage</span><span class="p">);</span>
<span class="k">switch</span><span class="p">(</span><span class="n">fieldDescriptor</span><span class="p">.</span><span class="n">FieldType</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">case</span> <span class="n">FieldType</span><span class="p">.</span><span class="n">Float</span><span class="p">:</span>
        <span class="n">fieldValue</span> <span class="p">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">FloatField</span><span class="p">(</span><span class="n">fieldDescriptor</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">fieldValue</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">FieldType</span><span class="p">.</span><span class="n">Int64</span><span class="p">:</span>
    <span class="k">case</span> <span class="n">FieldType</span><span class="p">.</span><span class="n">SInt64</span><span class="p">:</span>
    <span class="k">case</span> <span class="n">FieldType</span><span class="p">.</span><span class="n">SFixed64</span><span class="p">:</span>
        <span class="n">fieldValue</span> <span class="p">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">LongField</span><span class="p">(</span><span class="n">fieldDescriptor</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span> <span class="n">fieldValue</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="c1">// それ以外のFieldTypeも同様にTypeごとに実装する...</span>
<span class="p">}</span>

<span class="n">fieldDescriptor</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="n">parentMessage</span><span class="p">,</span> <span class="n">fieldValue</span><span class="p">);</span>
</code></pre></div></div>

<h2>
<span id="enum" class="fragment"></span><a href="#enum"><i class="fa fa-link"></i></a>Enum</h2>

<p>Enumの場合も<code>SingleFieldAccessor</code>が使われているため、Scalar Value Typesと同じ方法で値の読み書きができます</p>

<h3>
<span id="unity-appendix-1" class="fragment"></span><a href="#unity-appendix-1"><i class="fa fa-link"></i></a>unity appendix</h3>

<p>ここで取り出した値は<code>System.Enum</code>型として扱うことができるので、今回の要件のようなUnityEditorで取り扱う際には下記のようにして標準のEditor拡張コードに組み込む事ができます</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">enumValue</span> <span class="p">=</span> <span class="p">(</span><span class="n">Enum</span><span class="p">)</span><span class="n">enumField</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">parentMessage</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">updatedValue</span> <span class="p">=</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">EnumPopup</span><span class="p">(</span><span class="s">"Enum"</span><span class="p">,</span> <span class="n">enumValue</span><span class="p">);</span>
<span class="n">enumField</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="n">parentMessage</span><span class="p">,</span> <span class="n">updatedValue</span><span class="p">);</span>
</code></pre></div></div>

<h2>
<span id="message" class="fragment"></span><a href="#message"><i class="fa fa-link"></i></a>Message</h2>

<p>Messageの場合も前述の2種同様<code>SingleFieldAccessor</code>が使われています<br>
<code>IMessage</code>を継承したメッセージクラスが格納されているため、<code>IMeesage</code>にキャストした上で更にDescriptorで掘り下げることによって更に中身を1つずつ操作することが可能です</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">childMessage</span> <span class="p">=</span> <span class="p">(</span><span class="n">IMessage</span><span class="p">)</span><span class="n">messageField</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">parentMessage</span><span class="p">);</span>
<span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">field</span> <span class="k">in</span> <span class="n">childMessage</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="n">Fields</span><span class="p">.</span><span class="nf">InDeclarationOrder</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">// 実際にはFieldTypeごとに処理をしていく</span>
    <span class="kt">var</span> <span class="n">fieldValue</span> <span class="p">=</span> <span class="n">field</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">childMessage</span><span class="p">);</span>
    <span class="c1">// modify ...</span>
    <span class="n">field</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="n">childMessage</span><span class="p">,</span> <span class="n">fieldValue</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>protobufは任意でメッセージの入れ子を連続させて定義することができる仕様になっているので汎用的に対応するためには<strong>メッセージに対する処理は再帰的に行う必要があります</strong></p>

<h2>
<span id="repeated" class="fragment"></span><a href="#repeated"><i class="fa fa-link"></i></a>Repeated</h2>

<p><code>FieldDescriptor.IsRepeated</code>が<code>true</code>だった場合、そのフィールドはRepeated属性があることになります<br>
Repeated属性のフィールドは<code>RepeatedFieldAccessor</code>が使われますが、これは<a href="https://github.com/protocolbuffers/protobuf/blob/master/csharp/src/Google.Protobuf/Reflection/RepeatedFieldAccessor.cs#L59" rel="nofollow noopener" target="_blank"><code>SetValue()</code>に対応していません</a><br>
値を書き換えるには少し工夫が必要になります</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">if</span> <span class="p">(</span><span class="n">repeatedField</span><span class="p">.</span><span class="n">IsRepeated</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 実際はRepeatedField&lt;T&gt;型になっているがIListを実装しているためキャストが可能</span>
    <span class="kt">var</span> <span class="n">repeatedValue</span> <span class="p">=</span> <span class="p">(</span><span class="n">IList</span><span class="p">)</span><span class="n">repeatedField</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">parentMessage</span><span class="p">);</span>
    <span class="c1">// IList的な扱いができる ※ただし要素はobject型</span>
    <span class="kt">var</span> <span class="n">element0</span> <span class="p">=</span> <span class="n">repeatedValue</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
    <span class="n">repeatedValue</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">addValue</span><span class="p">);</span>
    <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">element</span> <span class="k">in</span> <span class="n">repeatedValue</span><span class="p">)</span>

    <span class="c1">// 要素の型はFieldTypeで取得できる ※通常のフィールドにrepeated属性が付いているという扱い</span>
    <span class="kt">var</span> <span class="n">elementType</span> <span class="p">=</span> <span class="n">repeatedField</span><span class="p">.</span><span class="n">FieldType</span><span class="p">;</span>
    <span class="c1">// メッセージだった場合は更にMessageTypeを掘り下げることで具体的な型が判別できる</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">elementType</span> <span class="p">==</span> <span class="n">FieldType</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">messageType</span> <span class="p">=</span> <span class="n">repeatedField</span><span class="p">.</span><span class="n">MessageType</span><span class="p">.</span><span class="n">ClrType</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Enumの場合も同様</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">elementType</span> <span class="p">==</span> <span class="n">FieldType</span><span class="p">.</span><span class="n">Enum</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">enumType</span> <span class="p">=</span> <span class="n">repeatedField</span><span class="p">.</span><span class="n">EnumType</span><span class="p">.</span><span class="n">ClrType</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 要素の具体的な型が判別できるのであればRepeatedField&lt;T&gt;にもキャスト可能</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">elementType</span> <span class="p">==</span> <span class="n">FieldType</span><span class="p">.</span><span class="n">Int32</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">repeatedIntValue</span> <span class="p">=</span> <span class="p">(</span><span class="n">RepeatedField</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;)</span><span class="n">repeatedField</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">parentMessage</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>このようにして取得した<code>IList</code>や<code>RepeatedField&lt;T&gt;</code>のインスタンスに対して<code>Add（）</code>や<code>Remove()</code>などをしてあげることでRepeatedなフィールドの中身も書き換えることが可能になります</p>

<h3>
<span id="unity-appendix-2" class="fragment"></span><a href="#unity-appendix-2"><i class="fa fa-link"></i></a>unity appendix</h3>

<p><code>IList</code>を継承しているので<strong><code>UnityEditorInternal.ReorderableList</code>をそのまま使うことができます(結構便利です</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">repeatedValue</span> <span class="p">=</span> <span class="p">(</span><span class="n">IList</span><span class="p">)</span><span class="n">fieldDescriptor</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">parentMessage</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">elementType</span> <span class="p">=</span> <span class="nf">GetSystemType</span><span class="p">(</span><span class="n">fieldDescriptor</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">reorderableList</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ReorderableList</span><span class="p">(</span><span class="n">repeatedValue</span><span class="p">,</span> <span class="n">elementType</span><span class="p">);</span>

<span class="p">...</span>

<span class="n">Type</span> <span class="nf">GetSystemType</span><span class="p">(</span><span class="n">FieldDescriptor</span> <span class="n">descriptor</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">switch</span><span class="p">(</span><span class="n">descriptor</span><span class="p">.</span><span class="n">FieldType</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">case</span> <span class="n">FieldType</span><span class="p">.</span><span class="n">Message</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">descriptor</span><span class="p">.</span><span class="n">MessageType</span><span class="p">.</span><span class="n">ClrType</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">FieldType</span><span class="p">.</span><span class="n">Enum</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">descriptor</span><span class="p">.</span><span class="n">EnumType</span><span class="p">.</span><span class="n">ClrType</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">FieldType</span><span class="p">.</span><span class="n">String</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">);</span>
        <span class="c1">// ScalarValueTypesはFieldTypeに合わせて直接typeofする </span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="map" class="fragment"></span><a href="#map"><i class="fa fa-link"></i></a>Map</h2>

<p>実は<code>map&lt;key,value&gt;</code>として宣言したものもRepeatedなフィールドとして扱われます<br>
<strong>内部的には<code>MapFieldEntry</code>なメッセージ型にRepeated属性を付けているという扱い</strong>になっているのです<br>
<a href="https://developers.google.com/protocol-buffers/docs/proto3#maps" class="autolink" rel="nofollow noopener" target="_blank">https://developers.google.com/protocol-buffers/docs/proto3#maps</a></p>

<p>なので、フィールドごとに処理を分岐させる場合はRepeatedなフィールドよりも前にMapかどうかを判断する必要があります</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>
<span class="c1">// フィールドに対する何かしらの処理を行う関数</span>
<span class="k">void</span> <span class="nf">ProccessField</span><span class="p">(</span><span class="n">FieldDescriptor</span> <span class="n">field</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">IsMap</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Mapの処理</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">IsRepeated</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Repeatedの処理</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// SingleFieldAccessorに対応した処理</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Mapなフィールドには<code>MapFieldAccessor</code>が使われますが、これも<code>RepeatedFieldAccessor</code>と同様に<a href="https://github.com/protocolbuffers/protobuf/blob/master/csharp/src/Google.Protobuf/Reflection/MapFieldAccessor.cs#L59" rel="nofollow noopener" target="_blank"><code>SetValue()</code>に対応していません</a><br>
自分で中身を掘り下げていく必要があります</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">if</span> <span class="p">(</span><span class="n">mapField</span><span class="p">.</span><span class="n">IsMap</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 実際はMapField&lt;TKey, TValue&gt;型になっているがIDictionaryを実装しているためキャストが可能</span>
    <span class="kt">var</span> <span class="n">mapValue</span> <span class="p">=</span> <span class="p">(</span><span class="n">IDictionary</span><span class="p">)</span><span class="n">mapValue</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">parentMessage</span><span class="p">);</span>
    <span class="c1">// IDictionary的な扱いができる ※ただしkeyもvalueもobject型</span>
    <span class="n">mapValue</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">addKey</span><span class="p">,</span> <span class="n">addValue</span><span class="p">);</span>
    <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">kvp</span> <span class="k">in</span> <span class="n">mapValue</span><span class="p">)</span>

    <span class="c1">// keyとvalueの型はMapFieldEntryからそれぞれのFieldDescriptorを掘り起こす必要がある</span>
    <span class="kt">var</span> <span class="n">mapFieldEntry</span> <span class="p">=</span> <span class="n">mapField</span><span class="p">.</span><span class="n">MessageType</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">keyField</span> <span class="p">=</span> <span class="n">mapFieldEntry</span><span class="p">.</span><span class="nf">FindFieldByName</span><span class="p">(</span><span class="s">"key"</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">valueField</span> <span class="p">=</span> <span class="n">mapFieldEntry</span><span class="p">.</span><span class="nf">FindFieldByName</span><span class="p">(</span><span class="s">"value"</span><span class="p">);</span>
    <span class="c1">// … ここから更にFieldType, MessageType, EnumTypeを見て最終的に判断する</span>
<span class="p">}</span>
</code></pre></div></div>

<p><a href="https://developers.google.com/protocol-buffers/docs/reference/proto3-spec#map_field" rel="nofollow noopener" target="_blank">Mapの仕様</a>としてはkeyに設定できる型が<code>int32</code>,<code>int64</code>, <code>sint32</code>,<code>sint64</code>, <code>uint32</code>,<code>uint64</code>, <code>fixed32</code>,<code>fixed64</code>, <code>sfixed32</code>,<code>sfixed64</code>, <code>bool</code>,<code>string</code>に限定されてはいるものの、真面目に<code>IDictinary&lt;TKey, TValue&gt;</code>の形式にキャストしようとするとかなり骨が折れます</p>

<p>扱うデータの仕様によってはMapの解析は対象外としてしまうのもアリでしょう</p>

<h1>
<span id="oneofを解析する" class="fragment"></span><a href="#oneof%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Oneofを解析する</h1>

<p>フィールドの種別の話で<strong>Oneofは<code>Google.Protobuf.Reflection</code>では厳密にはフィールドの扱いになっていない</strong>と話しました<br>
これは、Oneofの定義に対しては専用の<code>OneofDescriptor</code>が存在し、そのOneof内で宣言されているフィールドに対してそれぞれ<code>FieldDescriptor</code>が存在しているという仕様になっているためです</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">IMessage</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SampleMessage</span><span class="p">();</span> <span class="c1">// データの用意は省略</span>
<span class="c1">// 名前を指定してDescriptorを取得する</span>
<span class="n">OneofDescriptor</span> <span class="n">oneofField</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="n">FindDescriptor</span><span class="p">&lt;</span><span class="n">OneofDescriptor</span><span class="p">&gt;(</span><span class="s">"oneof_field"</span><span class="p">);</span>
<span class="c1">// 全てのOneofを列挙する</span>
<span class="nf">foreatch</span> <span class="p">(</span><span class="kt">var</span> <span class="n">oneofDescriptor</span> <span class="k">in</span> <span class="n">message</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="n">Oneofs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// そのOneofに宣言されているフィールドを列挙する</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">field</span> <span class="k">in</span> <span class="n">oneofDescriptor</span><span class="p">.</span><span class="n">Fields</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// フィールド個別の処理...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="oneofdescriptor" class="fragment"></span><a href="#oneofdescriptor"><i class="fa fa-link"></i></a><code>OneofDescriptor</code>
</h2>

<p>このようにOneofには専用の<code>OneofDescriptor</code>が用意されていますが、値を読み書きする方法は少し特殊です</p>

<p>C#上ではOneof内に宣言されているフィールドに対応したプロパティに対して値を設定することで内部的にOneofの仕様に沿った状態で値を更新してくれるようになっています<br>
また、各フィールドに対応したプロパティへは<code>FieldDescriptor</code>からアクセス可能になっています</p>

<p>これにより、<strong>新しくOneofとして扱いたいフィールドに対して値を設定することでOneofとしての値も書き換わったことになります</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// SampleMessage.oneof_fieldの場合</span>
<span class="n">IMessage</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SampleMessage</span><span class="p">();</span>
<span class="n">OneofDescriptor</span> <span class="n">oneofField</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="n">FindDescriptor</span><span class="p">&lt;</span><span class="n">OneofDescriptor</span><span class="p">&gt;(</span><span class="s">"oneof_field"</span><span class="p">);</span>

<span class="c1">// 現在のOneofの値を取得する</span>
<span class="kt">var</span> <span class="n">currentOneof</span> <span class="p">=</span> <span class="n">oneofField</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">GetCaseFieldDescriptor</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">currentOneofValue</span> <span class="p">=</span> <span class="n">currentOneof</span><span class="p">.</span><span class="n">Accsessor</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>

<span class="c1">// 新しくOneofの値にexternal_messageを設定する ※MessageDescriptorからもOneofに属しているフィールドが取得できる</span>
<span class="kt">var</span> <span class="n">externalMessageField</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="nf">FindFieldByName</span><span class="p">(</span><span class="s">"external_message"</span><span class="p">);</span>
<span class="n">externalMessageField</span><span class="p">.</span><span class="n">Accessor</span><span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ExternalMessage</span><span class="p">());</span>
</code></pre></div></div>

<h2>
<span id="注意点" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>注意点</h2>

<p><code>OneofDescriptor</code>の項目で紹介したコードにもある通り、<strong>Oneofの中に定義したフィールドはそのOneofを定義したメッセージのフィールドとしても扱われている</strong>ため、<code>MessageDescriptor.Fields</code>と<code>OneofDescriptor.Fields</code>のどちらにも存在していることになります<br>
下記のようにして<code>ContainingOneof</code>をチェックすることで処理の重複を防ぎましょう</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// メッセージに対する何かしらの処理を行う関数</span>
<span class="k">void</span> <span class="nf">ProcessMessage</span><span class="p">(</span><span class="n">IMessage</span> <span class="n">message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// フィールドの処理</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">field</span> <span class="k">in</span> <span class="n">message</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="n">Fields</span><span class="p">.</span><span class="nf">InDeclarationOrder</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">ContainingOneof</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Oneofに含まれない通常のフィールドの処理</span>
    <span class="p">}</span>

    <span class="c1">// Oneofの処理</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">oneof</span> <span class="k">in</span> <span class="n">message</span><span class="p">.</span><span class="n">Descriptor</span><span class="p">.</span><span class="n">Oneofs</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">field</span> <span class="k">in</span> <span class="n">oneof</span><span class="p">.</span><span class="n">Fields</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Oneofに含まれるフィールドの処理</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h1>
<span id="さいごに" class="fragment"></span><a href="#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB"><i class="fa fa-link"></i></a>さいごに</h1>

<p><code>Google.Protobuf.Reflection</code>を使ってメッセージの基本的な中身を掘り下げるコードをズラーッと紹介しました</p>

<p>今回紹介した以外にもまだReservedやOptionsなど、応用的な使い方がたくさん残っていますので、今後も別途それらの機能についても掘り下げていきたいと思います</p>

<p>最後まで読んでいただきありがとうございました</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fjukey17%2Fitems%2F8239f501a59b14caf5ae&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fjukey17%2Fitems%2F8239f501a59b14caf5ae&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/jukey17/items/8239f501a59b14caf5ae/likers" class="css-1iupg5d">10</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">7</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/8239f501a59b14caf5ae/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/jukey17/items/8239f501a59b14caf5ae/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/jukey17/items/8239f501a59b14caf5ae/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/jukey17/items/8239f501a59b14caf5ae/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/jukey17/items/8239f501a59b14caf5ae.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-0c189f2a-2f70-4ae3-925a-c485f379424e">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-5482e54c-bd42-4b96-b033-f3ee5c63d73d"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-5482e54c-bd42-4b96-b033-f3ee5c63d73d">{}</script>
      
<div id="LoginModal-react-component-0b6846ba-7a24-40d4-a039-2d746bbafc6e"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-0b6846ba-7a24-40d4-a039-2d746bbafc6e">{}</script>
      
<div id="StockModal-react-component-85e1d01a-cbd0-406f-b424-f68d2e1bd952"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-85e1d01a-cbd0-406f-b424-f68d2e1bd952">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;oS+X+3p7TETMQZOMnbvRq8B0rMDlxrg1w2IzzczQ+9YkpQaKOKWm6Y8v5chlOd3J97mbyvqTyZVUKlmYtDngHw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003eこの記事は \u003ca href=\"https://qiita.com/advent-calendar/2019/dena\"\u003eDeNA Advent Calendar 2019\u003c/a\u003e の12/9(月)の記事です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eこの記事ではC#でProtocol Buffers(以下、protobuf)の中身を解析していくための機能について紹介します\u003c/p\u003e\n\n\u003cp\u003e※本題に入るまで少し前置きがあるので、そういうのは飛ばしたいという方は\u003ca href=\"#%E5%90%84%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%94%E3%81%A8%E3%81%AB%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8C%E5%A4%A7%E5%A4%89\"\u003eこちらの本編\u003c/a\u003eへ直接どうぞ\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"経緯\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%8C%E7%B7%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e経緯\u003c/h2\u003e\n\n\u003cp\u003e普段はゲームのクライアントエンジニアとしてUnityによるゲーム開発の仕事をしている人間なのですが、とある案件でUnityでprotobufを扱いたいというニーズが発生し、C#でゴリゴリprotobufのデータを弄ることになりました\u003c/p\u003e\n\n\u003cp\u003eその際に調べながら実装を進めていたところ「C#でprotobufを扱う内容ってあまり深堀りされていないなぁ」と感じ、今回の記事公開に至りました\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ターゲット\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BF%E3%83%BC%E3%82%B2%E3%83%83%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eターゲット\u003c/h2\u003e\n\n\u003cp\u003eprotobufがどういったものなのかを知っている前提で話を進めていきます\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e「C#(Unity)でゴリゴリにprotobufを扱いたいんじゃ〜」という人がドンピシャなメインターゲット\u003c/strong\u003eですが、\u003cdel\u003e中々に稀有な存在だと思われるので\u003c/del\u003e、実際にそういう人ではなくても「そういうこともできるんだ」と思ってもらえたら幸いです\u003c/p\u003e\n\n\u003cp\u003eまた、今回取り扱うprotobufは\u003cstrong\u003eproto3\u003c/strong\u003eのバージョンを対象としています\u003c/p\u003e\n\n\u003cp\u003eそれぞれに関連する用語の詳細な解説は省いていきますので予めご了承ください\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"得られるもの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BE%97%E3%82%89%E3%82%8C%E3%82%8B%E3%82%82%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e得られるもの\u003c/h2\u003e\n\n\u003cp\u003e今まであまり語られることがなかった\u003ccode\u003eGoogle.Protobuf.Reflection\u003c/code\u003eの機能について学ぶことができます\u003c/p\u003e\n\n\u003cp\u003eUnityのEditor拡張を使って直接protobufのデータを弄りたいというのが具体的な要件でしたが、Editor拡張の部分はとくに目新しいことはしていないため、今回は\u003ccode\u003eGoogle.Protobuf.Reflection\u003c/code\u003eを使ってprotobufのデータを汎用的に読み書きする部分(非Unity依存・PureなC#コード)をメインに解説していきます\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"cでprotobufを扱う最小サンプル\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E3%81%A7protobuf%E3%82%92%E6%89%B1%E3%81%86%E6%9C%80%E5%B0%8F%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC#でprotobufを扱う最小サンプル\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://developers.google.com/protocol-buffers/docs/csharptutorial\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://developers.google.com/protocol-buffers/docs/csharptutorial\u003c/a\u003e\u003cbr\u003e\n公式のチュートリアルにサンプルコードが載っています\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ロード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AD%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eロード\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ePerson\u003c/span\u003e \u003cspan class=\"n\"\u003ejohn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// john.datというファイルをロードし\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpenRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"john.dat\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// インスタンスに内容を格納する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ejohn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePerson\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParseFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"セーブ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BB%E3%83%BC%E3%83%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eセーブ\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// johnという変数名のインスタンスを予め用意する\u003c/span\u003e\n\u003cspan class=\"n\"\u003ePerson\u003c/span\u003e \u003cspan class=\"n\"\u003ejohn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e...;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// john.datファイルを新たに作成し\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"john.dat\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// johnの内容をファイルに書き出す\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ejohn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれらは抜粋ですが、全体のコードを確認したい場合は以下のリンクから辿ることができます\u003cbr\u003e\n\u003ca href=\"https://github.com/protocolbuffers/protobuf/tree/master/csharp/src/AddressBook\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/protocolbuffers/protobuf/tree/master/csharp/src/AddressBook\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003cdel\u003eこのようにして各スキーマごとにprotobufのデータをロードして、プロダクトコードでゴリゴリにデータ弄ってそれをまたセーブをすればOK！\u003c/del\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"各スキーマごとにメンテナンスするのが大変\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%90%84%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%94%E3%81%A8%E3%81%AB%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8C%E5%A4%A7%E5%A4%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e各スキーマごとにメンテナンスするのが大変！\u003c/h1\u003e\n\n\u003cp\u003e\u003cstrong\u003eはい、ここからが本題です\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eスキーマ定義が少ないうちは個別にゴリゴリ実装をしていってもそこまで問題はないのですが、ガッツリ使い込んでスキーマ定義が増えていくと\u003cstrong\u003eそのスキーマ定義に依存した実装のメンテナンスが非常に大変になってきます\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e新しくスキーマの定義を増やしたり、スキーマの内容を変更したりするたびにメンテナンスをすることになるので、\u003cstrong\u003eなるべく依存するコードは最低限に留めて汎用的に取り扱えるような実装にしたいです\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e今回の要件では、UnityEditor上からパラメータの調整をできるようにしたいというものがあり、\u003cstrong\u003eスキーマごとに入力エディタを作るのは現実的ではありませんでした\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"googleprotobufreflection\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#googleprotobufreflection\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eGoogle.Protobuf.Reflection\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eここで登場するのが\u003ccode\u003eGoogle.Protobuf.Reflection\u003c/code\u003eのnamespace下にある機能です\u003c/p\u003e\n\n\u003cp\u003eprotobufがスキーマ定義に対応して自動生成してくれるC#コードは、スキーマ定義ごとに\u003ccode\u003eGoogle.Protobuf.IMessage\u003c/code\u003eを継承したクラスになっています\u003cbr\u003e\n(以下、スキーマ定義に対応したprotobufが自動生成するC#クラスをメッセージと呼びます)\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eGoogle.Protobuf.IMessage\u003c/code\u003eの定義に着目すると\u003cstrong\u003e\u003ccode\u003eGoogle.Protobuf.Reflection.MessageDescriptor Descriptor { get; }\u003c/code\u003e というプロパティ\u003c/strong\u003eが存在します\u003c/p\u003e\n\n\u003cp\u003eこの\u003ccode\u003eGoogle.Protobuf.Reflection\u003c/code\u003eにある機能を使うことで、メッセージの具体的な型に依存せずにそのメッセージの中身を調べることができます\u003cbr\u003e\n\u003cstrong\u003e※要するにprotobufの仕様に限定させたC#のReflection機能のようなものです\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eこれを使えば\u003cstrong\u003eメッセージの具象型に依存した実装をある程度省略することができそう\u003c/strong\u003eです\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"メッセージを解析する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメッセージを解析する\u003c/h1\u003e\n\n\u003cp\u003eではどのようにして\u003ccode\u003eGoogle.Protobuf.Reflection\u003c/code\u003eの機能を使っていくのか\u003cbr\u003e\nprotobufはメッセージ単位でデータを扱うので、メッセージから掘り下げていきましょう\u003c/p\u003e\n\n\u003cp\u003e下記のようなスキーマ定義を例にどのような内容が取れるのかを解説していきます\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"protobuf\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSampleMessage.proto\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003esyntax\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"proto3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kn\"\u003epackage\u003c/span\u003e \u003cspan class=\"nn\"\u003eSample\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eoption\u003c/span\u003e \u003cspan class=\"na\"\u003ecsharp_namespace\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Sample.Messages\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 列挙型の宣言(外側)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eSampleEnum\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eHoge\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eFuga\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ePiyo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// メッセージの宣言(外側)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003emessage\u003c/span\u003e \u003cspan class=\"nc\"\u003eExternalMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"na\"\u003efloat_field\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// メッセージの宣言\u003c/span\u003e\n\u003cspan class=\"kd\"\u003emessage\u003c/span\u003e \u003cspan class=\"nc\"\u003eSampleMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// フィールドの定義(Scalar Value Types)\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint32\u003c/span\u003e \u003cspan class=\"na\"\u003eint_field\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// フィールドの定義(Enum Type)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSampleEnum\u003c/span\u003e \u003cspan class=\"na\"\u003eenum_field\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// フィールドの定義(Message Type)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eInternalMessage\u003c/span\u003e \u003cspan class=\"na\"\u003emessage_field\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// フィールドの定義(Repeated Type)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003erepeated\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"na\"\u003erepeated_field\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// フィールドの定義(Map Type)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint32\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"na\"\u003emap_field\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// Oneof\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eoneof\u003c/span\u003e \u003cspan class=\"n\"\u003eoneof_field\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"na\"\u003eoneof_string\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003euint32\u003c/span\u003e \u003cspan class=\"na\"\u003eoneof_uint\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e12\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eExternalMessage\u003c/span\u003e \u003cspan class=\"na\"\u003eoneof_message\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e13\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 列挙型の宣言(入れ子)\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eInternalEnum\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eFirst\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eSecond\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eThird\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// メッセージの宣言（入れ子）\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003emessage\u003c/span\u003e \u003cspan class=\"nc\"\u003eInternalMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"na\"\u003ebool_field\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"messagedescriptor\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#messagedescriptor\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eMessageDescriptor\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e先程も紹介したように、\u003ccode\u003eIMessage\u003c/code\u003eには \u003ccode\u003eMessageDescriptor Descriptor { get; }\u003c/code\u003e というプロパティが定義されています\u003cbr\u003e\nここからメッセージの内容を解析していくことができます\u003cbr\u003e\nメッセージ内に定義されている内容が整理された状態でこの\u003ccode\u003eMessageDescriptor\u003c/code\u003eに詰まっています\u003c/p\u003e\n\n\u003cp\u003e以下に今回のケースで利用するものを列挙します\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIMessage\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSampleMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// データの用意は省略\u003c/span\u003e\n\u003cspan class=\"n\"\u003eMessageDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// メッセージの名前 SampleMessage\u003c/span\u003e\n\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// パッケージ名を含めた名前 Sample.SampleMessage\u003c/span\u003e\n\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// C#上でのメッセージの型情報 typeof(Sample.Messages.SampleMessage)\u003c/span\u003e\n\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClrType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 親のメッセージの情報 SampleMessageは入れ子に宣言されていないのでnull\u003c/span\u003e\n\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainingType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// メッセージ内に定義されているEnum全て\u003c/span\u003e\n\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// メッセージ内に定義されているメッセージ全て\u003c/span\u003e\n\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNestedTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// メッセージ内に定義されているフィールド全て ※後述で解説\u003c/span\u003e\n\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFields\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// FindFieldByName/FindFieldByNumberメソッドで任意のフィールドを取得できる\u003c/span\u003e\n\u003cspan class=\"n\"\u003eFieldDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003efield1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindFieldByName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"int_field\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eFieldDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003efield2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindFieldByNumber\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// InDeclarationOrder/InFieldNumberOrderメソッドで中身を列挙できる\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efieldDescriptor\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFields\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInDeclarationOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efieldDescriptor\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFields\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInFieldNumberOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// メッセージ内に定義されているOneof全て ※後述で解説\u003c/span\u003e\n\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOneofs\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"enumを解析する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#enum%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEnumを解析する\u003c/h1\u003e\n\n\u003cp\u003eEnumは宣言されている定数の情報がメインになるため、今回の要件では解析することは必須ではありません\u003cbr\u003e\n一応どのような情報が入っているか確認しましょう\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"enumdescriptor\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#enumdescriptor\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eEnumDescriptor\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// SampleMessage内に宣言されているInternalEnumを取り出す\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIMessage\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSampleMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// データの用意は省略\u003c/span\u003e\n\u003cspan class=\"n\"\u003eEnumDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Enumの名前 InternalEnum\u003c/span\u003e\n\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// パッケージ名を含めた名前 Sample.SampleMessage.InternalEnum\u003c/span\u003e\n\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// C#上でのEnumの型情報 typeof(Sample.Messages.SampleMessage.Types.InternalEnum)\u003c/span\u003e\n\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClrType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 親のメッセージの情報 SampleMessageの入れ子になっているのでSampleMessageのMessageDescriptorが入っている\u003c/span\u003e\n\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainingType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 定義されている定数全て(EnumValueDescriptor)\u003c/span\u003e\n\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValues\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"enumvaluedescriptor\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#enumvaluedescriptor\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eEnumValueDescriptor\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// SampleMessage.protoに宣言されているSampleEnumを取り出す\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// ※SampleMessageReflectionクラスのDescriptorプロパティからSampleMessage.protoファイルのFileDescriptorが取得できる\u003c/span\u003e\n\u003cspan class=\"n\"\u003eEnumDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003eenumDescriptor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSampleMessageReflection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// SampleEnumの2番目に定義されている定数を取り出す\u003c/span\u003e\n\u003cspan class=\"n\"\u003eEnumValueDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003eenumValueDescriptor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eenumDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//  定数の名前 Fuga\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumValueDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// パッケージ名を含めた名前 Sample.SampleEnum.Fuga\u003c/span\u003e\n\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 定数の宣言順序 1 (0 origin)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumValueDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 定数の値 10\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumValueDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"フィールドを解析する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eフィールドを解析する\u003c/h1\u003e\n\n\u003cp\u003e繰り返しになりますが、今回の要件ではメッセージの型に依存せずに中身を読み書きしたいので、\u003cstrong\u003e実際の値が入っているフィールドの中身が最重要です\u003c/strong\u003e\u003cbr\u003e\n詳しく掘り下げていきましょう\u003c/p\u003e\n\n\u003cp\u003eまず初めに、protobufのフィールドには大きく分類すると以下の種類が存在します\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eScalar Value Types\u003c/li\u003e\n\u003cli\u003eEnum\u003c/li\u003e\n\u003cli\u003eMessage\u003c/li\u003e\n\u003cli\u003eRepeated\u003c/li\u003e\n\u003cli\u003eMap\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eOneofと呼ばれるものも存在しますが、これは\u003ccode\u003eGoogle.Protobuf.Reflection\u003c/code\u003eでは厳密にはフィールドという扱いではないので\u003ca href=\"#Oneof%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\"\u003e別枠で解説します\u003c/a\u003e\u003cbr\u003e\n1つずつ見ていきたいところですがまずはどのフィールドでも共通の内容を見ていきます\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"fielddescriptor\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#fielddescriptor\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eFieldDescriptor\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eフィールドの情報は \u003ccode\u003eFieldDescriptor\u003c/code\u003eで知ることができます\u003cbr\u003e\nこの中身を調べることによって\u003cstrong\u003e対象のフィールドが前述のどの種別に値するのかを判断することができます\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIMessage\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSampleMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// データの用意は省略\u003c/span\u003e\n\u003cspan class=\"n\"\u003eFieldDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003eenumField\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindFieldByName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"enum_field\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eFieldDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003emessageField\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindFieldByName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"message_field\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eFieldDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003eboolField\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessageField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindFieldByName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"bool_field\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eFieldDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindFieldByName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"repeated_field\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eFieldDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003emapField\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindFieldByName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"map_field\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// フィールドの名前 ※C#上のプロパティ名ではなくprotoファイル内で宣言した名前\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// enum_field\u003c/span\u003e\n\u003cspan class=\"n\"\u003emessageField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// message_field\u003c/span\u003e\n\u003cspan class=\"n\"\u003eboolField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// bool_field\u003c/span\u003e\n\u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// repeated_field\u003c/span\u003e\n\u003cspan class=\"n\"\u003emapField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// map_field\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// パッケージ名を含めた名前\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// Sample.SampleMessage.enum_field\u003c/span\u003e\n\u003cspan class=\"n\"\u003emessageField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// Sample.SampleMessage.message_field\u003c/span\u003e\n\u003cspan class=\"n\"\u003eboolField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// Sample.SampleMessage.InternalMessage.bool_field\u003c/span\u003e\n\u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Sample.SampleMessage.repeated_field\u003c/span\u003e\n\u003cspan class=\"n\"\u003emapField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// Sample.SampleMessage.map_field\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// フィールドの種別\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// FieldType.Enum\u003c/span\u003e\n\u003cspan class=\"n\"\u003emessageField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// FieldType.Message\u003c/span\u003e\n\u003cspan class=\"n\"\u003eboolField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// FieldType.Bool\u003c/span\u003e\n\u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// FieldType.String ※repeated stringで宣言されているのでString扱い\u003c/span\u003e\n\u003cspan class=\"n\"\u003emapField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// FieldType.Message ※map\u0026lt;,\u0026gt;で宣言されているのでMessage扱い\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// protoファイル内でフィールド宣言時に設定した数値\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldNumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// 2\u003c/span\u003e\n\u003cspan class=\"n\"\u003emessageField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldNumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// 3\u003c/span\u003e\n\u003cspan class=\"n\"\u003eboolField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldNumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// 1\u003c/span\u003e\n\u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldNumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 4\u003c/span\u003e\n\u003cspan class=\"n\"\u003emapField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldNumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// 5\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// FieldTypeがMessageだった場合にMessageDescriptorが入っている\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// null\u003c/span\u003e\n\u003cspan class=\"n\"\u003emessageField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// InternalMessageのMessageDescriptor\u003c/span\u003e\n\u003cspan class=\"n\"\u003eboolField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// null\u003c/span\u003e\n\u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// null\u003c/span\u003e\n\u003cspan class=\"n\"\u003emapField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// MapFieldEntryのMessageDescriptor ※後述で解説\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// FieldTypeがEnumだった場合にEnumDescriptorが入っている\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// SampleEnumのEnumDescriptor\u003c/span\u003e\n\u003cspan class=\"n\"\u003emessageField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// null\u003c/span\u003e\n\u003cspan class=\"n\"\u003eboolField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// null\u003c/span\u003e\n\u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// null\u003c/span\u003e\n\u003cspan class=\"n\"\u003emapField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// null\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 親のメッセージの情報\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainingType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// SampleMessageのMessageDescriptor\u003c/span\u003e\n\u003cspan class=\"n\"\u003emessageField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainingType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// SampleMessageのMessageDescriptor\u003c/span\u003e\n\u003cspan class=\"n\"\u003eboolField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainingType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// InternalMessageのMessageDescriptor(messageField.MessageTypeと同じ)\u003c/span\u003e\n\u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainingType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// SampleMessageのMessageDescriptor\u003c/span\u003e\n\u003cspan class=\"n\"\u003emapField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainingType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// SampleMessageのMessageDescriptor\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//　Oneofに含まれている場合Oneofの情報が入る ※後述で解説\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainingOneof\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// null\u003c/span\u003e\n\u003cspan class=\"n\"\u003emessageField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainingOneof\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// null\u003c/span\u003e\n\u003cspan class=\"n\"\u003eboolField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainingOneof\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// null\u003c/span\u003e\n\u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainingOneof\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// null\u003c/span\u003e\n\u003cspan class=\"n\"\u003emapField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainingOneof\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// null\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Repeated属性がある場合にtrueになる\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsRepeated\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003cspan class=\"n\"\u003emessageField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsRepeated\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003cspan class=\"n\"\u003eboolField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsRepeated\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsRepeated\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\u003cspan class=\"n\"\u003emapField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsRepeated\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Map属性がある場合にtrueになる\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsRepeated\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003cspan class=\"n\"\u003emessageField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsRepeated\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003cspan class=\"n\"\u003eboolField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsRepeated\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsRepeated\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003cspan class=\"n\"\u003emapField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsRepeated\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 実体にアクセスするためのラッパークラス ※後述で解説\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// SingleFieldAccessor\u003c/span\u003e\n\u003cspan class=\"n\"\u003emessageField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// SingleFieldAccessor\u003c/span\u003e\n\u003cspan class=\"n\"\u003eboolField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// SingleFieldAccessor\u003c/span\u003e\n\u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// RepeatedFieldAccessor\u003c/span\u003e\n\u003cspan class=\"n\"\u003emapField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// MapFieldAccessor\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eフィールドの種別を判断するために必要な情報が分かったのでそれぞれ具体的な種別ごとに掘り下げていきましょう\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"scalar-value-types\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#scalar-value-types\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eScalar Value Types\u003c/h2\u003e\n\n\u003cp\u003eScalar Value Typesにどのようなものが含まれるのかは下記の公式ドキュメントにまとまっています\u003cbr\u003e\n\u003ca href=\"https://developers.google.com/protocol-buffers/docs/proto3#scalar\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://developers.google.com/protocol-buffers/docs/proto3#scalar\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003edouble\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003efloat\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eint32\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eint64\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003euint32\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003euint64\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esint32\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esint64\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003efixed32\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003efixed64\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esfixed32\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esfixed64\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ebool\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003estring\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ebytes\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eまた、これらは前述で紹介した\u003cstrong\u003e\u003ccode\u003eFieldDescriptor.FieldType\u003c/code\u003eで判断することができます\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e実体にアクセスするためには\u003ccode\u003eFieldDescriptor.Accessor\u003c/code\u003eを使います\u003cbr\u003e\nScalar Value TypesなFieldTypeの場合、\u003ccode\u003eSingleFieldAccessor\u003c/code\u003eが使われており、\u003ccode\u003eGetValue()\u003c/code\u003e/\u003ccode\u003eSetValue()\u003c/code\u003eメソッドで値の読み書きができます\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSampleMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eIntField\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efield\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindFieldByName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"int_field\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eintFieldValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 中身は10\u003c/span\u003e\n\u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIntField\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 中身は20\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"unity-appendix\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unity-appendix\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eunity appendix\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 宣言などは省略しています\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efieldValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efieldDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparentMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eswitch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efieldDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003efieldValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eEditorGUILayout\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFloatField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efieldDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003efieldValue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInt64\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSInt64\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSFixed64\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003efieldValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eEditorGUILayout\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLongField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efieldDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003efieldValue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// それ以外のFieldTypeも同様にTypeごとに実装する...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003efieldDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparentMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efieldValue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"enum\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#enum\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEnum\u003c/h2\u003e\n\n\u003cp\u003eEnumの場合も\u003ccode\u003eSingleFieldAccessor\u003c/code\u003eが使われているため、Scalar Value Typesと同じ方法で値の読み書きができます\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"unity-appendix-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unity-appendix-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eunity appendix\u003c/h3\u003e\n\n\u003cp\u003eここで取り出した値は\u003ccode\u003eSystem.Enum\u003c/code\u003e型として扱うことができるので、今回の要件のようなUnityEditorで取り扱う際には下記のようにして標準のEditor拡張コードに組み込む事ができます\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eenumValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEnum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eenumField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparentMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eupdatedValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEditorGUILayout\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEnumPopup\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Enum\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eenumValue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenumField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparentMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eupdatedValue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"message\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#message\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMessage\u003c/h2\u003e\n\n\u003cp\u003eMessageの場合も前述の2種同様\u003ccode\u003eSingleFieldAccessor\u003c/code\u003eが使われています\u003cbr\u003e\n\u003ccode\u003eIMessage\u003c/code\u003eを継承したメッセージクラスが格納されているため、\u003ccode\u003eIMeesage\u003c/code\u003eにキャストした上で更にDescriptorで掘り下げることによって更に中身を1つずつ操作することが可能です\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003echildMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003emessageField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparentMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efield\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003echildMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFields\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInDeclarationOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 実際にはFieldTypeごとに処理をしていく\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efieldValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003echildMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// modify ...\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003echildMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efieldValue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eprotobufは任意でメッセージの入れ子を連続させて定義することができる仕様になっているので汎用的に対応するためには\u003cstrong\u003eメッセージに対する処理は再帰的に行う必要があります\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"repeated\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#repeated\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRepeated\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eFieldDescriptor.IsRepeated\u003c/code\u003eが\u003ccode\u003etrue\u003c/code\u003eだった場合、そのフィールドはRepeated属性があることになります\u003cbr\u003e\nRepeated属性のフィールドは\u003ccode\u003eRepeatedFieldAccessor\u003c/code\u003eが使われますが、これは\u003ca href=\"https://github.com/protocolbuffers/protobuf/blob/master/csharp/src/Google.Protobuf/Reflection/RepeatedFieldAccessor.cs#L59\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eSetValue()\u003c/code\u003eに対応していません\u003c/a\u003e\u003cbr\u003e\n値を書き換えるには少し工夫が必要になります\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsRepeated\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 実際はRepeatedField\u0026lt;T\u0026gt;型になっているがIListを実装しているためキャストが可能\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003erepeatedValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparentMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// IList的な扱いができる ※ただし要素はobject型\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eelement0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erepeatedValue\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003erepeatedValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaddValue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eelement\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003erepeatedValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 要素の型はFieldTypeで取得できる ※通常のフィールドにrepeated属性が付いているという扱い\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eelementType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// メッセージだった場合は更にMessageTypeを掘り下げることで具体的な型が判別できる\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eelementType\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emessageType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClrType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// Enumの場合も同様\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eelementType\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eenumType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClrType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 要素の具体的な型が判別できるのであればRepeatedField\u0026lt;T\u0026gt;にもキャスト可能\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eelementType\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003erepeatedIntValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;)\u003c/span\u003e\u003cspan class=\"n\"\u003erepeatedField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparentMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのようにして取得した\u003ccode\u003eIList\u003c/code\u003eや\u003ccode\u003eRepeatedField\u0026lt;T\u0026gt;\u003c/code\u003eのインスタンスに対して\u003ccode\u003eAdd（）\u003c/code\u003eや\u003ccode\u003eRemove()\u003c/code\u003eなどをしてあげることでRepeatedなフィールドの中身も書き換えることが可能になります\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"unity-appendix-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unity-appendix-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eunity appendix\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eIList\u003c/code\u003eを継承しているので\u003cstrong\u003e\u003ccode\u003eUnityEditorInternal.ReorderableList\u003c/code\u003eをそのまま使うことができます(結構便利です\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003erepeatedValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003efieldDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparentMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eelementType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetSystemType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efieldDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereorderableList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eReorderableList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erepeatedValue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eelementType\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetSystemType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClrType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnum\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClrType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eFieldType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ScalarValueTypesはFieldTypeに合わせて直接typeofする \u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"map\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#map\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMap\u003c/h2\u003e\n\n\u003cp\u003e実は\u003ccode\u003emap\u0026lt;key,value\u0026gt;\u003c/code\u003eとして宣言したものもRepeatedなフィールドとして扱われます\u003cbr\u003e\n\u003cstrong\u003e内部的には\u003ccode\u003eMapFieldEntry\u003c/code\u003eなメッセージ型にRepeated属性を付けているという扱い\u003c/strong\u003eになっているのです\u003cbr\u003e\n\u003ca href=\"https://developers.google.com/protocol-buffers/docs/proto3#maps\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://developers.google.com/protocol-buffers/docs/proto3#maps\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eなので、フィールドごとに処理を分岐させる場合はRepeatedなフィールドよりも前にMapかどうかを判断する必要があります\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"c1\"\u003e// フィールドに対する何かしらの処理を行う関数\u003c/span\u003e\n\u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eProccessField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFieldDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsMap\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// Mapの処理\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsRepeated\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// Repeatedの処理\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// SingleFieldAccessorに対応した処理\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eMapなフィールドには\u003ccode\u003eMapFieldAccessor\u003c/code\u003eが使われますが、これも\u003ccode\u003eRepeatedFieldAccessor\u003c/code\u003eと同様に\u003ca href=\"https://github.com/protocolbuffers/protobuf/blob/master/csharp/src/Google.Protobuf/Reflection/MapFieldAccessor.cs#L59\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eSetValue()\u003c/code\u003eに対応していません\u003c/a\u003e\u003cbr\u003e\n自分で中身を掘り下げていく必要があります\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emapField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsMap\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 実際はMapField\u0026lt;TKey, TValue\u0026gt;型になっているがIDictionaryを実装しているためキャストが可能\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emapValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003emapValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparentMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// IDictionary的な扱いができる ※ただしkeyもvalueもobject型\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emapValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaddKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eaddValue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ekvp\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003emapValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// keyとvalueの型はMapFieldEntryからそれぞれのFieldDescriptorを掘り起こす必要がある\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emapFieldEntry\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emapField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyField\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emapFieldEntry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindFieldByName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"key\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003evalueField\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emapFieldEntry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindFieldByName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"value\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// … ここから更にFieldType, MessageType, EnumTypeを見て最終的に判断する\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://developers.google.com/protocol-buffers/docs/reference/proto3-spec#map_field\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMapの仕様\u003c/a\u003eとしてはkeyに設定できる型が\u003ccode\u003eint32\u003c/code\u003e,\u003ccode\u003eint64\u003c/code\u003e, \u003ccode\u003esint32\u003c/code\u003e,\u003ccode\u003esint64\u003c/code\u003e, \u003ccode\u003euint32\u003c/code\u003e,\u003ccode\u003euint64\u003c/code\u003e, \u003ccode\u003efixed32\u003c/code\u003e,\u003ccode\u003efixed64\u003c/code\u003e, \u003ccode\u003esfixed32\u003c/code\u003e,\u003ccode\u003esfixed64\u003c/code\u003e, \u003ccode\u003ebool\u003c/code\u003e,\u003ccode\u003estring\u003c/code\u003eに限定されてはいるものの、真面目に\u003ccode\u003eIDictinary\u0026lt;TKey, TValue\u0026gt;\u003c/code\u003eの形式にキャストしようとするとかなり骨が折れます\u003c/p\u003e\n\n\u003cp\u003e扱うデータの仕様によってはMapの解析は対象外としてしまうのもアリでしょう\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"oneofを解析する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#oneof%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eOneofを解析する\u003c/h1\u003e\n\n\u003cp\u003eフィールドの種別の話で\u003cstrong\u003eOneofは\u003ccode\u003eGoogle.Protobuf.Reflection\u003c/code\u003eでは厳密にはフィールドの扱いになっていない\u003c/strong\u003eと話しました\u003cbr\u003e\nこれは、Oneofの定義に対しては専用の\u003ccode\u003eOneofDescriptor\u003c/code\u003eが存在し、そのOneof内で宣言されているフィールドに対してそれぞれ\u003ccode\u003eFieldDescriptor\u003c/code\u003eが存在しているという仕様になっているためです\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIMessage\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSampleMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// データの用意は省略\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 名前を指定してDescriptorを取得する\u003c/span\u003e\n\u003cspan class=\"n\"\u003eOneofDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003eoneofField\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFindDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOneofDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"oneof_field\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 全てのOneofを列挙する\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eforeatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eoneofDescriptor\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOneofs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// そのOneofに宣言されているフィールドを列挙する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efield\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eoneofDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFields\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// フィールド個別の処理...\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"oneofdescriptor\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#oneofdescriptor\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eOneofDescriptor\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eこのようにOneofには専用の\u003ccode\u003eOneofDescriptor\u003c/code\u003eが用意されていますが、値を読み書きする方法は少し特殊です\u003c/p\u003e\n\n\u003cp\u003eC#上ではOneof内に宣言されているフィールドに対応したプロパティに対して値を設定することで内部的にOneofの仕様に沿った状態で値を更新してくれるようになっています\u003cbr\u003e\nまた、各フィールドに対応したプロパティへは\u003ccode\u003eFieldDescriptor\u003c/code\u003eからアクセス可能になっています\u003c/p\u003e\n\n\u003cp\u003eこれにより、\u003cstrong\u003e新しくOneofとして扱いたいフィールドに対して値を設定することでOneofとしての値も書き換わったことになります\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// SampleMessage.oneof_fieldの場合\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIMessage\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSampleMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eOneofDescriptor\u003c/span\u003e \u003cspan class=\"n\"\u003eoneofField\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFindDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOneofDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"oneof_field\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 現在のOneofの値を取得する\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentOneof\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eoneofField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCaseFieldDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentOneofValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentOneof\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccsessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 新しくOneofの値にexternal_messageを設定する ※MessageDescriptorからもOneofに属しているフィールドが取得できる\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eexternalMessageField\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindFieldByName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"external_message\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eexternalMessageField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eExternalMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"注意点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e注意点\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eOneofDescriptor\u003c/code\u003eの項目で紹介したコードにもある通り、\u003cstrong\u003eOneofの中に定義したフィールドはそのOneofを定義したメッセージのフィールドとしても扱われている\u003c/strong\u003eため、\u003ccode\u003eMessageDescriptor.Fields\u003c/code\u003eと\u003ccode\u003eOneofDescriptor.Fields\u003c/code\u003eのどちらにも存在していることになります\u003cbr\u003e\n下記のようにして\u003ccode\u003eContainingOneof\u003c/code\u003eをチェックすることで処理の重複を防ぎましょう\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// メッセージに対する何かしらの処理を行う関数\u003c/span\u003e\n\u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eProcessMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIMessage\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// フィールドの処理\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efield\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFields\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInDeclarationOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainingOneof\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// Oneofに含まれない通常のフィールドの処理\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Oneofの処理\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eoneof\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOneofs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efield\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eoneof\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFields\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Oneofに含まれるフィールドの処理\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"さいごに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eさいごに\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003eGoogle.Protobuf.Reflection\u003c/code\u003eを使ってメッセージの基本的な中身を掘り下げるコードをズラーッと紹介しました\u003c/p\u003e\n\n\u003cp\u003e今回紹介した以外にもまだReservedやOptionsなど、応用的な使い方がたくさん残っていますので、今後も別途それらの機能についても掘り下げていきたいと思います\u003c/p\u003e\n\n\u003cp\u003e最後まで読んでいただきありがとうございました\u003c/p\u003e\n","createdAt":"2019-12-03T12:36:10Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"wgw8+tc1Sdhx7Qg1rfjgfM93bo1akIFs1Q==--1AhWgyHEp7DqIj2l--QfbScZF/hv15hu0v2UIDWg==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2019-12-08T22:01:05Z","likesCount":10,"linkUrl":"https://qiita.com/jukey17/items/8239f501a59b14caf5ae","organization":{"description":"We delight people beyond their wildest dreams.","encryptedId":"y1dvDPjl7rkfBcw0Yvk/Fgb7CXdyapLs57A=--7Ff32NLqQXaHz/oa--/bHEKM4S5JuDDZ8ozI842w==","isBetaReleaseEnabled":true,"isFollowableByViewer":true,"isFollowedByViewer":false,"logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/77fe0bc145892664d307e63dcfbc7a381345ca47/original.jpg?1539161148","name":"株式会社ディー・エヌ・エー","url":"https://dena.com/jp/","urlName":"dena_coltd"},"originalId":1097626,"stockedCount":7,"title":"Google.Protobuf.Reflectionを利用してC#でProtocol Buffersを汎用的に解析する話","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B5%8C%E7%B7%AF\"\u003e経緯\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%BF%E3%83%BC%E3%82%B2%E3%83%83%E3%83%88\"\u003eターゲット\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BE%97%E3%82%89%E3%82%8C%E3%82%8B%E3%82%82%E3%81%AE\"\u003e得られるもの\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#c%E3%81%A7protobuf%E3%82%92%E6%89%B1%E3%81%86%E6%9C%80%E5%B0%8F%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB\"\u003eC#でprotobufを扱う最小サンプル\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AD%E3%83%BC%E3%83%89\"\u003eロード\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%BB%E3%83%BC%E3%83%96\"\u003eセーブ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%90%84%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%94%E3%81%A8%E3%81%AB%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8C%E5%A4%A7%E5%A4%89\"\u003e各スキーマごとにメンテナンスするのが大変！\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#googleprotobufreflection\"\u003eGoogle.Protobuf.Reflection\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\"\u003eメッセージを解析する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#messagedescriptor\"\u003eMessageDescriptor\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#enum%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\"\u003eEnumを解析する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#enumdescriptor\"\u003eEnumDescriptor\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#enumvaluedescriptor\"\u003eEnumValueDescriptor\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\"\u003eフィールドを解析する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#fielddescriptor\"\u003eFieldDescriptor\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#scalar-value-types\"\u003eScalar Value Types\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#unity-appendix\"\u003eunity appendix\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#enum\"\u003eEnum\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#unity-appendix-1\"\u003eunity appendix\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#message\"\u003eMessage\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#repeated\"\u003eRepeated\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#unity-appendix-2\"\u003eunity appendix\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#map\"\u003eMap\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#oneof%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\"\u003eOneofを解析する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#oneofdescriptor\"\u003eOneofDescriptor\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e注意点\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\"\u003eさいごに\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":3341,"uuid":"8239f501a59b14caf5ae","banReason":null,"adventCalendarItem":{"day":9,"calendar":{"name":"DeNA ","urlName":"dena","year":2019,"organization":{"logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/77fe0bc145892664d307e63dcfbc7a381345ca47/original.jpg?1539161148","urlName":"dena_coltd"}}},"author":{"encryptedId":"BI4iHEJt6jdzWTQ9mjnHu2O++GfR--tyJSq0suEfmo08Xn--YZUftCGkCJMN64SstH4RqA==","originalId":146374,"description":"Game Engineer\r\nUnity C#","facebookUrl":null,"githubUrl":"https://github.com/jukey17","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/146374/profile-images/1573189181","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146374%2Fprofile-images%2F1573189181?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=ab47c82349789ada7b15f7c6a70d7727","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146374%2Fprofile-images%2F1573189181?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=f0ba2504fee4992e07a25a61c4a36f28","urlName":"jukey17","websiteUrl":"","twitterUrl":"https://twitter.com/_jukey17","twitterUrlName":"_jukey17","revealedOrganizations":{"edges":[{"node":{"encryptedId":"je91XWxiN2eU/3xvBeTk9wim1qj4D2ydiFw=--QGyeS597YvRqH1Tz--fG2gB0dAsFlZTtPH3N/elw==","isBetaReleaseEnabled":true,"isFollowableByViewer":true,"isFollowedByViewer":false,"name":"株式会社ディー・エヌ・エー","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/77fe0bc145892664d307e63dcfbc7a381345ca47/original.jpg?1539161148","urlName":"dena_coltd","description":"We delight people beyond their wildest dreams.","url":"https://dena.com/jp/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Unity","urlName":"unity"},{"name":"ProtocolBuffers","urlName":"protocolbuffers"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

More than 3 years have passed since last update.街を探索して住人と会話する場面をUnityで実装してみました。会話機能自体は、「宴」など簡単に実装できるソフトがあるらしいですが、今回はスクリプトだけで実装してみます。
全体の流れとしては1.住人の設置
2.住人の喋る内容を設定するスクリプト
3.テキストを表示するスクリプト
4.プレイヤーが一定範囲内に入ったら会話できるサインを表すオブジェクトの表示設定の順番で説明していきたいと思います。
ちなみに完成イメージはこんな感じです。今回はこの画像の中の、Aボタンと水色のテキストウィンドウの機能について説明します。〜完成イメージ〜
まずは街の住人とプレイヤーを設置します。
プレイヤーの移動や配置などは割愛しますが、今回は住人とプレイヤーの両方にColliderをつけましょう。そして、住人側のColliderにはisTriggerにチェックを入れます。参考までに、プレイヤーと住人のColliderの適用範囲の画像を載せます。適用範囲とは、要するに会話可能範囲です。加えて、プレイヤーにはRigidBodyと"player"と言う名前でタグをつけておきましょう。〜プレイヤー〜
〜プレイヤーの一部インスペクタービュー〜
〜住人〜
今回はプレイヤーと住人はリンク先の素材を使いました。ここは自由に変更してください。下のCharacterScriptを作成して、住人につけます。
前述したようにプレイヤーにはあらかじめ、playerという名前でタグをつけて起きましょう。スクリプトの説明をします。
プレイヤーが住人のCollider範囲=会話可能な範囲内に入ったら、Aflagflagをtrueにし、iventScriptに、セリフの内容とAflagflagの結果を送ります。そして、プレイヤーに会話が可能だと知らせるために用意したheartというオブジェクトを住人の頭上に表示します(iventScriptについてはこの後に説明します)
プレイヤーが会話可能な範囲外に出たら、Aflagflagをfalseにし、heartを消します。
先ほど用意した住人にこのスクリプトをアタッチして見ましょう。そうすると、住人のインスペクタービューにCharacterScriptが表示されます。ここのScenariosの部分でシナリオの長さ(Size)と喋る内容を設定できます。
HeartIconとIventControllerについてはこの後説明しますので、完成したら忘れずにここにアタッチしておきましょう。〜住人のインスペクタービュー〜
次にIventScriptについて説明します。今回は、プレイヤーが住人に近づいて、ボタンを押したら会話をするように実装します。
そのため、Canvasにあらかじめそれ用のボタン（ここではAボタン）を用意し、AButtonメソッドをClickの部分にアタッチしてください。
そうすると、プレイヤーが会話可能な範囲内にいて、かつ、ボタンを押したら会話イベントが発生する仕組みになります。
また、空のゲームオブジェクトを用意して、名前をIventControllerとします。そして、そこにIventScriptをアタッチしましょう。〜ボタンを用意（今回はAボタンだけ！）〜
〜会話をするためのボタン(Aボタン)のインスペクタービュー〜
〜IventController(空のゲームオブジェクト)のインスペクタービュー〜
次に、住人の話す内容を表示するためのTextControllerスクリプトを用意します。このスクリプトはこちらのサイト様のを参考にしました。ヒエラルキービューに空のゲームオブジェクトを用意して、名前をTextControllerとし、このスクリプトをアタッチしましょう。〜TextController(空のゲームオブジェクト)のインスペクタービュー〜
そして、Canvas内にテキストウィンドウとなるPanelとセリフを表示する用のTextを作成します。TextはPanelの子オブジェクトにしましょう。以下の画像を参考にして見てください。〜Canvas内にPanelとTextを用意〜
〜Panelのインスペクタービュー〜
〜Textのインスペクタービュー〜
上記のパネルや文字のスタイルはあくまで参考程度なのでお好きな形に変えてください。作ったPanelとTextはTextControllerのインスペクタービューにアタッチしましょう。
また、前述したIventControllerとボタンのOnClickの部分にTextCOntrollerをアタッチしましょう。ここまでで会話機能は成立しますが、今の状態だとどのタイミングで会話可能なのかが分かりません。なので次は、プレイヤーが会話可能な範囲に入ったら、住人の頭上にハートのオブジェクトを表示して、ボタンを押したら会話が可能だと知らせるようにしましょう。ここまでくれば後は簡単です。
オブジェクトはなんでも良いです。私は、カプセルを二つくっつけたハート?のオブジェクトを用意しました。〜ハートのオブジェクト〜
〜こんな感じ〜
CharacterScriptの様々な部分でpublic GameObject heartやheart.SetActive (true)といった表記を目にしたと思います。CharacterScriptにハートのオブジェクトを住民の頭上に表示するための命令は書いてあるので、後はそのCharacterScriptをつけた住人のインスペクタービューにこのHeartIconオブジェクトをアタッチするだけです。説明は以上です。お疲れ様でした！



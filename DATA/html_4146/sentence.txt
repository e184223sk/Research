More than 1 year has passed since last update.パフォーマンスチューニングのために、頻繁に実行される可能性のある同期メソッドを、Producer-Consumerパターンのようなものに置き換えました。
使用先がそもそもシンプルな動作で十分だったため、必要最低限の実装ですが参考になれば幸いです。BlockingCollectionは通常Queueの動作をするので、この先Queueと表現します。
Queueに入れるItemはDo()だけを備えたシンプルなクラスです。主にQueueItemを追加するAddメソッドとQueueの中身を取り出して実行するタスク（Processメソッド）を走らせるStartメソッドがあります。
ProcessメソッドはStopメソッドでCancellationTokenを使ってCancelされます。
また、ManualResetEventを使い、Queueが空の間は止まるようになっています。QueueにQueueItemを詰めるProducerですが、今回はいつ何を詰めるかという部分はこのクラスを所有するクラスに任せます。
同様にConsumerをいつStartするかというのもProducerを所有するクラスに任せるため、Producerを通してカプセル化しました。本家のProducer-Consumerパターンというものを熟知していないこともありますが、あくまで今回実際に使ったユースケースに合わせて作ったものです。
全く同じものですがGitHubにもUploadしてあります。



Revitでアドイン開発をする際、ダイアログに入力した値を保持しておきたいがやり方が分からない、というときの手順です。
調べるとProperties.Settings.Defaultなど色々出てきたのですが、これは「拡張ストレージ」というやつにXML形式で読み書きするのが便利だそうです。
「拡張ストレージ」については調べても上級者向けの解説しかなかったため、次に使うときのために使い方のメモを残します。
使い方のメモなので、詳しい定義や意味までは追いません。
問題がある場合はコメントください。OS: Windows8.1
Revit: 2019.2ここはおのおの楽な方法でデータを作成します。
XML形式でといっても保存時には文字列型にToString()するため、XML形式には限りません。
XMLが楽だと思われますが、他の形式の方が使いやすいという方は別の方法で文字列作成していいと思います。拡張ストレージに保存するにはTransactionを開始する必要があります。（読み込み時には不要です）
TransactionはDocumentから取得することができ、DocumentはApplicationから取得することができます。→参考
以下参考サイトのDocument取得部分のコピペ。拡張ストレージへ保存する際のトランザクションの開始と終了の流れは以下の形になります。
/* ここで書き込み実行 */の部分で書き込み処理を行います（後述）。見辛いので書き込みは関数にした方が良いと思います。
エラー表示の部分は必要に応じてエラーを表示したりログに出力したりしてください。読み書きにあたっての公式のDocはここ。
参考URLはここ等。書込みにあたっての大まかな流れは以下です。
1. SchemaBuilder を宣言する。（ある場合4へ）
2. SchemaBuilder に権限とスキーマ名を設定する。
3. SchemaBuilder にフィールド名を追加する。
4. Schema を取得。
4. docの持つProjectInformationに対して、このSchemaでEntityを取得する（無い場合作成）
5. Entityに登録したいXMLを文字列型としてセットする。
6. ProjectInformationに5のEntityをセットする。これで、ダイアログのOKボタンを押した時にこれが実行されるようにすればOKです。読み込みの方はいたってシンプルで、
1. Schema を取得
2. あればProjectInformationに対してSchemaの中のフィールド名からEntityをゲット
です。ここではジェネリッククラスTを使います。
引数のElementはdoc.ProjectInformation、strGUIDは書き込み時の「適当なGUI」、strFieldNameは「適当なフィールド名」にそれぞれ読み替えてください。処理としてはこれだけです。
stringで保存したので、呼び出すときは以下のように&lt;string&gt;とします。これで、ダイアログを開くときに読み込んだstrXMLdataを反映させていけばOKです。Revit関係はググっても英語のページばかりだなあと思いました。



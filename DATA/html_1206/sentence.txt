More than 1 year has passed since last update.こんにちは。Daddy's Officeの市川です。私が10年以上開発を続けているWindowsPCを監視カメラシステムにする「LiveCapture3」。
先日、このソフトにOCR機能を追加して、カメラ映像内の数値を検出できるようにしました。
（この機能により、サーマルカメラを使用した自動温度計測＆通知システムの構築が可能です）「LiveCapture3」のコア機能はC++で実装しているので、C++でOCR機能を実装する必要がありました。
C++でのOCRといえば、「Tesseract」が有名ですが、今回は画像内の数値のみ検出すればよく、そこまで大掛かりにしたくありませんでした。そこでWindowsのAPIを調べたところ、ありました！
Windows.Media.Ocrしかし、よくよく見てみると、これはWinRTっぽい感じ。
つまり、UWPアプリやストアアプリであれば使えるのですが、デスクトップアプリから使うにはちょっと細工が必要そうです。ということでという２段階で実装しました。言語としてはどちらもC#なので、参照を追加できれば基本はOKです。まず、.NetFrameworkのクラスライブラリとしてプロジェクトを生成します。OCRを使用する為には、下記のUWPライブラリが必要です。これらを使えるようにするために、プロジェクトの参照で、直接ライブラリを追加します。
追加するのは下記の２つです。これで、準備はできました。OCRエンジンの使い方は非常に簡単で、画像を渡すと認識結果の文字列が返却されるというものです。ただ、面倒くさいのがというところを解決しないといけません。色々調べた結果、以下に素晴らしい説明がありました！Microsoft OCR をデスクトップのWFPアプリで動かす方法参照追加の方法がちょっと違いますが、実装コードはこのまま行けました！これは、以前私が投稿した下記のやり方で行います。既存のC++ネイティブプロジェクトでC#マネージドコードを使うこれで、Native C++からWinRT用のOCR APIをコールしてOCR機能を実現することができました！ソースコード一式(VisualStudio2019)はこちらに置いておきます。ソースコード一式Microsoft OCR をデスクトップのWFPアプリで動かす方法
既存のC++ネイティブプロジェクトでC#マネージドコードを使う



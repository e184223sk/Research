More than 1 year has passed since last update.gRPC 1.16.0 で、Channel クラスに TryWaitForStateChangedAsync メソッドが追加されました。これを機に、チャネルの状態と自動再接続についてまとめてみます。チャネルの状態は次の 5 つで表され、C# gRPC では Grpc.Core.ChannelState 列挙体として定義されています。参考）gRPC の公式サイト
【GitHub】gRPC Connectivity Semantics and APIGrpc.Core.Channel クラスの接続に関するプロパティとメソッドです。チャネルの状態を監視し、状態が変更されたときに処理を行う例です。
TryWaitForStateChangedAsync メソッドが true を返したときに状態が変更されたと見なしています。メソッド呼び出し前後の状態は敢えて比較していません。後で触れます。(1) 接続または RPC 処理を実行。
(2) サーバーアプリケーションを終了。
(3) サーバーアプリケーションを終了させたままの状態で接続または RPC 処理を実行。
(11) サーバーアプリケーションを再起動。しばらくすると自動的に接続される。
(12) サーバーアプリケーションを終了。
(13) サーバーアプリケーションを終了させたままの状態で接続または RPC 処理を実行。
(17) サーバーアプリケーションを再起動。しばらくすると自動的に接続される。
(18) サーバーアプリケーションを終了。
(19) サーバーアプリケーションを終了させたままの状態で接続または RPC 処理を実行。
(31) シャットダウンを実行。



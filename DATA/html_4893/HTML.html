<!DOCTYPE html><html><head><meta charset="utf-8" /><title>【UniRx】Cold→Hot変換の代表、「Publishオペレータ」を完全に理解する - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/yutorisan/items/68bd68bbffe3c4f3ba32" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="TNnYOkDgIk+XZg54V3Q+4Ey4VQLd3g+H3k5IrKMwuagA7yx8v9ZjLWIV2f+ZFNHITZtwIrluSEW71nlK3xsQ+Q==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@yutorisan19" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="【UniRx】Cold→Hot変換の代表、「Publishオペレータ」を完全に理解する - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRVlc1cFVuampnSkZEYjJ4azRvYVNTRzkwNWFTSjVvLWI0NEd1NUx1ajZLR280NENCNDRDTVVIVmliR2x6YU9PQ3F1T0RtdU9Eck9PRHZPT0N2LU9BamVPQ2t1V3VqT1dGcU9PQnEtZVFodWluby1PQm1lT0NpdyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz0xOTYyZTA0NTllZWNiMDllMzI0MDYyZDkyYTU2YmRiYg&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGwxZEc5eWFYTmhiZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTgxODZjNmQyOWMyMjMwNjA0NDYxZjBhZTI0ODQ3YzI4&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=d751d59da622c99a6dcae6527c71f0c6"><meta property="og:description" content="

はじめに

ReactiveExtensions（以下Rx）の鬼門はHot-Coldの概念とHot変換だと思います。


Hot変換が必要なのはストリームを枝分かれさせたいときである…
Hot変換するにはPublish()してCo..."><meta content="https://qiita.com/yutorisan/items/68bd68bbffe3c4f3ba32" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Unity,ReactiveExtensions,UniRx" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-0bac8bcb-1b86-419a-a620-dfbd663bf58b"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fyutorisan%2Fitems%2F68bd68bbffe3c4f3ba32">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fyutorisan%2Fitems%2F68bd68bbffe3c4f3ba32">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-0bac8bcb-1b86-419a-a620-dfbd663bf58b">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2021-04-02T02:46:34.000+09:00","dateModified":"2021-04-02T02:46:34.000+09:00","headline":"【UniRx】Cold→Hot変換の代表、「Publishオペレータ」を完全に理解する","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRVlc1cFVuampnSkZEYjJ4azRvYVNTRzkwNWFTSjVvLWI0NEd1NUx1ajZLR280NENCNDRDTVVIVmliR2x6YU9PQ3F1T0RtdU9Eck9PRHZPT0N2LU9BamVPQ2t1V3VqT1dGcU9PQnEtZVFodWluby1PQm1lT0NpdyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz0xOTYyZTA0NTllZWNiMDllMzI0MDYyZDkyYTU2YmRiYg\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGwxZEc5eWFYTmhiZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTgxODZjNmQyOWMyMjMwNjA0NDYxZjBhZTI0ODQ3YzI4\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=d751d59da622c99a6dcae6527c71f0c6","mainEntityOfPage":"https://qiita.com/yutorisan/items/68bd68bbffe3c4f3ba32","author":{"@type":"Person","address":"","email":null,"identifier":"yutorisan","name":"yutorisan","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F1274400166120812544%2FDAWcpHec_bigger.jpg?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=754be610f489085be0fdfc48de5585a9","url":"https://qiita.com/yutorisan","description":"C#が好きです","memberOf":[{"@type":"Organization","address":"オンライン@Slack","legalName":"Unityゲーム開発者ギルド","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/5e3ba3bb442371003e6b5d4618ef627b9b478357/original.jpg?1570216541","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","identifier":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita&amp;utm_medium=header-banner">プロダクト全体の「エコシステム」を考えるユーザベースの開発手法とは？</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yutorisan","type":"items","id":"68bd68bbffe3c4f3ba32"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"プロダクト全体の「エコシステム」を考えるユーザベースの開発手法とは？","url":"https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yutorisan","type":"items","id":"68bd68bbffe3c4f3ba32"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"プロダクト全体の「エコシステム」を考えるユーザベースの開発手法とは？","url":"https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yutorisan","type":"items","id":"68bd68bbffe3c4f3ba32"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"プロダクト全体の「エコシステム」を考えるユーザベースの開発手法とは？","url":"https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/yutorisan/items/68bd68bbffe3c4f3ba32","location":"/yutorisan/items/68bd68bbffe3c4f3ba32","scheme":"https","host":"qiita.com","port":null,"pathname":"/yutorisan/items/68bd68bbffe3c4f3ba32","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"S1Iikx4wLHD/CD06ZxprL0eJf51NuzBQ8ibzV3ZMhREHZNbV4QZtEgp76r2peoQHRqpavSkLd5KXvsKxCmcsQA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-27557d0f-4e49-4c59-9498-86f2929f9ade"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yutorisan/items/68bd68bbffe3c4f3ba32/likers" class="css-1iupg5d">7</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">6</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/68bd68bbffe3c4f3ba32/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yutorisan/items/68bd68bbffe3c4f3ba32/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yutorisan/items/68bd68bbffe3c4f3ba32/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yutorisan/items/68bd68bbffe3c4f3ba32/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yutorisan/items/68bd68bbffe3c4f3ba32.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/yutorisan"><img class="css-100alwu eyfquo10" src="https://pbs.twimg.com/profile_images/1274400166120812544/DAWcpHec_bigger.jpg" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/yutorisan" class="css-10ougpm">@<!-- -->yutorisan</a><div class="css-1ay9vb9"><time dateTime="2021-04-01T17:46:34Z" class="css-m19uds">posted at 2021-04-01</time></div></div></div></div></div><h1 class="css-cgzq40">【UniRx】Cold→Hot変換の代表、「Publishオペレータ」を完全に理解する</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/reactiveextensions" class="css-4czcte">ReactiveExtensions</a><a href="/tags/unirx" class="css-4czcte">UniRx</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>ReactiveExtensions（以下Rx）の鬼門はHot-Coldの概念とHot変換だと思います。</p>

<ul>
<li>Hot変換が必要なのはストリームを枝分かれさせたいときである…</li>
<li>Hot変換するには<code>Publish()</code>して<code>Connect()</code>すれば良い…</li>
</ul>

<p>等々はいろいろな記事で紹介されていますが、では<code>Publish()</code>すると裏で一体何が起こるのか？<code>Connect()</code>すると何が起こる？というのは、あまり詳しく解説されている記事が少ない印象です。</p>

<p>そこで、本記事ではRxの鬼門<code>Publish()</code>メソッドを「とりあえず」で使うのを卒業し、何が行われているかを「完全に理解」できるように解説していきます。</p>

<h1>
<span id="前提知識hotとcold" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90%E7%9F%A5%E8%AD%98hot%E3%81%A8cold"><i class="fa fa-link"></i></a>[前提知識]HotとCold</h1>

<p>まずは前提となるHotとColdの知識が必要です。<br>
別記事で書きましたので、もしHotColdの知識が曖昧な方はご覧ください。<br>
<code>Subject&lt;T&gt;</code>クラスの役割とHotColdとの関係性についても解説しています。</p>

<p><qiita-embed-ogp src="https://qiita.com/yutorisan/items/844eaeab392abf03ce80"></qiita-embed-ogp></p>

<p>↑の記事の内容を要約すると次の３つに言及しています。</p>

<h3>
<span id="1subjecttクラスの特徴について" class="fragment"></span><a href="#1subjectt%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E7%89%B9%E5%BE%B4%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>1.<code>Subject&lt;T&gt;</code>クラスの特徴について</h3>

<p><code>Subject&lt;T&gt;</code>クラスは<strong>1つのObservableシーケンスを複数の購読者に対してマルチキャストする機能</strong>を持つ。</p>

<p><a href="https://camo.qiitausercontent.com/a52d9520bea34775f3e802aeb593df14c5a70457/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f33616131343639622d666536322d393064342d393762372d3338613834366263326466372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F3aa1469b-fe62-90d4-97b7-38a846bc2df7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e1c4642b96cf607a863dc9b7f566b858" alt="Subjectの役割_OnNext.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/3aa1469b-fe62-90d4-97b7-38a846bc2df7.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F3aa1469b-fe62-90d4-97b7-38a846bc2df7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=060653ffea1a44347bcae617fdf3d10f 1x" loading="lazy"></a></p>

<h3>
<span id="2hotなiobservableとcoldなiobservableの違いについて" class="fragment"></span><a href="#2hot%E3%81%AAiobservable%E3%81%A8cold%E3%81%AAiobservable%E3%81%AE%E9%81%95%E3%81%84%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>2.Hotな<code>IObservable</code>とColdな<code>IObservable</code>の違いについて</h3>

<p>Hotな<code>IObservable</code>とは、<strong><code>Subject&lt;T&gt;</code>クラスから出ている<code>IObservable</code></strong>のことを指す。</p>

<p><a href="https://camo.qiitausercontent.com/a66378c060716772d099e413721ab10d56231df4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f61633331353263662d666466662d316135642d613461662d3364616237346331326236662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Fac3152cf-fdff-1a5d-a4af-3dab74c12b6f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=72a2486c959ffc5ae71f5e51143055c8" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/ac3152cf-fdff-1a5d-a4af-3dab74c12b6f.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Fac3152cf-fdff-1a5d-a4af-3dab74c12b6f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=06ef2df56352ef4c3a5283272224e449 1x" loading="lazy"></a></p>

<p>実体は<code>Subject&lt;T&gt;</code>クラスなので、複数の購読者に対してObservableシーケンスをマルチキャストできるという特徴を持つ。</p>

<p>対して、<strong>それ以外の（<code>Subject</code>以外から出ているような）<code>IObservable</code>はCold</strong>と呼ばれる。<br>
UniRxのオペレータから出てくる<code>IObservable</code>はほぼColdである。</p>

<h3>
<span id="3observableソースについて" class="fragment"></span><a href="#3observable%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>3.Observableソースについて</h3>

<p>Observableソースとは、Observableシーケンスに流れてくる<strong>値の発生源</strong>のこと。これにもHotとColdがある。</p>

<p>HotなObservableソースは、何回<code>Subscribe</code>されてもObservableシーケンスは１つ。<code>Subscribe</code>した時点以降の通知が届くようになる。<br>
<strong><code>Subject</code>がObservableソースの場合は、HotなObservableソース</strong>となる。</p>

<p><a href="https://camo.qiitausercontent.com/8dbb36de886264411817b56e5b9b4ef226becc21/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f34373137653561362d356532622d643462662d626232322d6664613630396533306166352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4717e5a6-5e2b-d4bf-bb22-fda609e30af5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e67aefee4827d511ac9211965dad47df" alt="Hot Observableソース.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/4717e5a6-5e2b-d4bf-bb22-fda609e30af5.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4717e5a6-5e2b-d4bf-bb22-fda609e30af5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3192b43fcda62fcc54501c5ebdf93b80 1x" loading="lazy"></a></p>

<p>対してColdなObservableソースの場合、<code>Subscribe</code>されたらその都度専用のObservableシーケンスが生成される。<br>
専用のObservableシーケンスなので、いつ<code>Subscribe</code>してもすべての通知が届く。<br>
主に<strong>ファクトリメソッド等から生成される場合、ColdなObservableソース</strong>となる。</p>

<p><a href="https://camo.qiitausercontent.com/59d60a6e13aacd16a8e5dcc550461ad64216a08d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f66306330366534382d613033312d333764352d616135342d3936663264646263663337652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Ff0c06e48-a031-37d5-aa54-96f2ddbcf37e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=21822ca97dac523010df51a14a2c7d14" alt="Cold Observableソース.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/f0c06e48-a031-37d5-aa54-96f2ddbcf37e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Ff0c06e48-a031-37d5-aa54-96f2ddbcf37e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b4e78831d2419e5cc0896f9b5dbd3cfe 1x" loading="lazy"></a></p>

<p>これらの内容を踏まえた上で、<code>Publish</code>オペレータについて解説していきます。</p>

<h1>
<span id="coldhot変換するにはどうすればよいのか" class="fragment"></span><a href="#coldhot%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B%E3%81%AB%E3%81%AF%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>Cold→Hot変換するにはどうすればよいのか</h1>

<p>前述したHot, Coldの定義と、<code>Subject&lt;T&gt;</code>クラスの特徴を踏まえて、<strong>Cold</strong>な<code>IObservable</code>を<strong>Hot</strong>な<code>IObservable</code>に変換するにはどうすれば良いのかを考えます。<br>
要は、<strong><code>Subject</code>クラスから出ている<code>IObservable</code>ならば確実にHot</strong>なのですから、「<strong>ColdなObservableを<code>Subject</code>クラスから再発信すれば良いのではないか</strong>」と考えることができます。</p>

<p>具体的には、次の手順を踏みます。</p>

<h3>
<span id="1subjecttクラスを用意します" class="fragment"></span><a href="#1subjectt%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E7%94%A8%E6%84%8F%E3%81%97%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>1.<code>Subject&lt;T&gt;</code>クラスを用意します。</h3>

<p><a href="https://camo.qiitausercontent.com/700f24858d025d3b5f31b8a411ee65df7224a168/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f30383837346563662d643766612d663661622d663939342d6563353862353166326564302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F08874ecf-d7fa-f6ab-f994-ec58b51f2ed0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=464ba39dbea83404b47e34ef1aa9e455" alt="Subjectクラス.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/08874ecf-d7fa-f6ab-f994-ec58b51f2ed0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F08874ecf-d7fa-f6ab-f994-ec58b51f2ed0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4148a269049b78958c24bf8cdbddcb53 1x" loading="lazy"></a></p>

<h3>
<span id="2-subjecttはhot変換したいcoldなiobservabletを代表して1回だけsubscribeします" class="fragment"></span><a href="#2-subjectt%E3%81%AFhot%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%9F%E3%81%84cold%E3%81%AAiobservablet%E3%82%92%E4%BB%A3%E8%A1%A8%E3%81%97%E3%81%A61%E5%9B%9E%E3%81%A0%E3%81%91subscribe%E3%81%97%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>2. <code>Subject&lt;T&gt;</code>は、Hot変換したいColdな<code>IObservable&lt;T&gt;</code>を代表して1回だけ<code>Subscribe</code>します。</h3>

<p><a href="https://camo.qiitausercontent.com/2a62600cf20b301c3642a7b11bee6a85bcdc8cd5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f37623939396161632d613761612d653733332d623131632d6236396466623136383139642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F7b999aac-a7aa-e733-b11c-b69dfb16819d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=636842686ff64e335e5397c46fea0864" alt="2.ColdをSubscribe.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/7b999aac-a7aa-e733-b11c-b69dfb16819d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F7b999aac-a7aa-e733-b11c-b69dfb16819d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4d5c0d4f313bd556676634aa4ba8c01d 1x" loading="lazy"></a></p>

<h3>
<span id="3-subscribeするとsubjecttに対してcoldなiobservabletから通知が流れてきます" class="fragment"></span><a href="#3-subscribe%E3%81%99%E3%82%8B%E3%81%A8subjectt%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6cold%E3%81%AAiobservablet%E3%81%8B%E3%82%89%E9%80%9A%E7%9F%A5%E3%81%8C%E6%B5%81%E3%82%8C%E3%81%A6%E3%81%8D%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>3. <code>Subscribe</code>すると、<code>Subject&lt;T&gt;</code>に対してColdな<code>IObservable&lt;T&gt;</code>から通知が流れてきます。</h3>

<p><a href="https://camo.qiitausercontent.com/de47542396255ad9548526db3c46cde4cc3689a9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f34343163616262352d663936612d626561302d343564622d3462326535633634393862392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F441cabb5-f96a-bea0-45db-4b2e5c6498b9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0368245ec644cef18c748e5c7238b628" alt="3.通知が流れてくる.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/441cabb5-f96a-bea0-45db-4b2e5c6498b9.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F441cabb5-f96a-bea0-45db-4b2e5c6498b9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ac5370d2e8079c450c3f850b6ff104bb 1x" loading="lazy"></a></p>

<h3>
<span id="4-subjecttクラスのiobservabletを外部に公開します" class="fragment"></span><a href="#4-subjectt%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AEiobservablet%E3%82%92%E5%A4%96%E9%83%A8%E3%81%AB%E5%85%AC%E9%96%8B%E3%81%97%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>4. <code>Subject&lt;T&gt;</code>クラスの<code>IObservable&lt;T&gt;</code>を外部に公開します。</h3>

<p><strong><code>Subject&lt;T&gt;</code>クラスから出ている<code>IObservable&lt;T&gt;</code>はHotな<code>IObservable&lt;T&gt;</code></strong>なので、Hot変換が完了しました。</p>

<p><a href="https://camo.qiitausercontent.com/a3570ac51f62f5fe5ebf92afaddbf976383df45e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f36373564363163642d363064622d643134622d313134612d3737313338386632633236322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F675d61cd-60db-d14b-114a-771388f2c262.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7ec988d9a55ce32df481435318137619" alt="4.Hot変換完了.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/675d61cd-60db-d14b-114a-771388f2c262.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F675d61cd-60db-d14b-114a-771388f2c262.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9a0728d7cd286ca404f69d81fde999e5 1x" loading="lazy"></a></p>

<p><code>Subject&lt;T&gt;</code>クラスを使うことで、無事にHot変換を行うことができました。</p>

<h1>
<span id="publishすると何が起こる" class="fragment"></span><a href="#publish%E3%81%99%E3%82%8B%E3%81%A8%E4%BD%95%E3%81%8C%E8%B5%B7%E3%81%93%E3%82%8B"><i class="fa fa-link"></i></a><code>Publish</code>すると何が起こる</h1>

<p>Hot変換する手順は上記の通り。じゃあ<code>Publish</code>オペレータは上記のことをやっているんだね！と思ったら、実はそうではありません。なんと、<strong><code>Publish</code>オペレータだけではObservableシーケンスに対してなんの影響も一切与えません</strong>。つまり、<code>Publish</code>オペレータをつけただけでは、Hot変換もまだ完了しないのです。</p>

<p>じゃあ<code>Publish</code>オペレータは何をしているのか？というと、いつでもHot変換ができるような<strong>「準備」</strong>をしています。</p>

<h2>
<span id="publishは準備するだけ" class="fragment"></span><a href="#publish%E3%81%AF%E6%BA%96%E5%82%99%E3%81%99%E3%82%8B%E3%81%A0%E3%81%91"><i class="fa fa-link"></i></a><code>Publish</code>は「準備」するだけ</h2>

<p><code>Publish</code>オペレータが実際に行っている処理は、次に示す「準備」のみに留まります。</p>

<ul>
<li><strong>Hot変換用の<code>Subject&lt;T&gt;</code>クラスを用意する。</strong></li>
<li><strong>Hot変換したい元となるColdな<code>IObservable</code>を用意する。</strong></li>
</ul>

<p>用意しているだけで、<strong>実際に<code>Subject&lt;T&gt;</code>や<code>IObservable&lt;T&gt;</code>に対して何らかの操作をしているわけではない</strong>ことがポイントです。</p>

<h2>
<span id="準備したものに対する操作は次の工程に委託する" class="fragment"></span><a href="#%E6%BA%96%E5%82%99%E3%81%97%E3%81%9F%E3%82%82%E3%81%AE%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E6%93%8D%E4%BD%9C%E3%81%AF%E6%AC%A1%E3%81%AE%E5%B7%A5%E7%A8%8B%E3%81%AB%E5%A7%94%E8%A8%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>準備したものに対する「操作」は次の工程に委託する</h2>

<p>実際にHot変換が完了するには、あと残り2つの操作を行うことが必要です。</p>

<ol>
<li>
<code>Subject&lt;T&gt;</code>に変換元のColdな<code>IObservable</code>を<code>Subscribe</code>させる</li>
<li>
<code>Subject&lt;T&gt;</code>クラスの<code>IObservable&lt;T&gt;</code>を<code>Subscribe</code>する（←<strong>Hot Observableに変換完了</strong>）</li>
</ol>

<p>これら2つの操作が完了したとき、はじめてHot変換が完了したことになります。<br>
しかし、これらの操作は<code>Publish</code>内では行われず、次の工程に委託されます。具体的には、<strong><code>Publish</code>オペレータの戻り値として、これら2つの操作のみが可能なインターフェイス返す</strong>ことで、次の工程への委託を実現します。<br>
そのインターフェイスこそが、<strong><code>IConnectableObservable&lt;T&gt;</code>インターフェイス</strong>です。</p>

<h2>
<span id="iconnectableobservabletインターフェイス" class="fragment"></span><a href="#iconnectableobservablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9"><i class="fa fa-link"></i></a><code>IConnectableObservable&lt;T&gt;</code>インターフェイス</h2>

<p><code>IConnectableObservable&lt;T&gt;</code>インターフェイスとは、その名の通り<strong><code>Connect</code>ができる<code>IObservable&lt;T&gt;</code>インターフェイス</strong>です。<br>
定義もまんま、<code>Connect</code>ができるようになった<code>IObservable&lt;T&gt;</code>です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IConnectableObservable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="n">IDisposable</span> <span class="nf">Connect</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>つまり、<code>IConnectableObservable&lt;T&gt;</code>インターフェイスは<code>Connect</code>と<code>Subscribe</code>のみができるインターフェイスということになります。</p>

<p>そして、前項で説明したHot変換に必要な2つの操作が、それぞれ<code>Connect</code>と<code>Subscribe</code>に割り当てられています。<br>
それぞれのメソッドを呼び出すことで、各操作が完了してHot変換が完了することになります。</p>

<table>
<thead>
<tr>
<th style="text-align: center">メソッド名</th>
<th style="text-align: left">割り当てられた操作</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center"><code>Connect</code></td>
<td style="text-align: left">
<code>Publish</code>が用意した内部の<code>Subject&lt;T&gt;</code>に、変換元のColdな<code>IObservable</code>を<code>Subscribe</code>させる</td>
</tr>
<tr>
<td style="text-align: center"><code>Subscribe</code></td>
<td style="text-align: left">
<code>IObservable&lt;T&gt;</code>として公開された<code>Subject&lt;T&gt;</code>を<code>Subscribe</code>する</td>
</tr>
</tbody>
</table>

<p>図で表すと次のようになります。</p>

<p><a href="https://camo.qiitausercontent.com/ad860cdeb47fb05f40b3b3ab8b7b8f88ce9d513c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f34383836626235622d656134642d326164382d306466612d3261666561653166643833342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4886bb5b-ea4d-2ad8-0dfa-2afeae1fd834.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=45e676540d5dd98ce2baa6616c963025" alt="ConnectableObservable.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/4886bb5b-ea4d-2ad8-0dfa-2afeae1fd834.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4886bb5b-ea4d-2ad8-0dfa-2afeae1fd834.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b89279b102ffb3ce47bdd71a0dca8a50 1x" loading="lazy"></a></p>

<p>次項から更に詳しく解説していきます。</p>

<h1>
<span id="iconnectableobservabletインターフェイス-1" class="fragment"></span><a href="#iconnectableobservablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9-1"><i class="fa fa-link"></i></a><code>IConnectableObservable&lt;T&gt;</code>インターフェイス</h1>

<p><code>Publish</code>オペレータの戻り値は<code>IConnectableObservable&lt;T&gt;</code>インターフェイスであるということ、そして<code>IConnectableObservable&lt;T&gt;</code>インターフェイスは<code>Connect</code>と<code>Subscribe</code>の2つの操作が可能であることを説明しました。<br>
まだピンとこないと思うので、まずはいくつかのHot変換の実例に則って<code>IConnectableObservable&lt;T&gt;</code>インターフェイスの使い方を説明します。</p>

<h2>
<span id="iconnectableobservabletの使い方" class="fragment"></span><a href="#iconnectableobservablet%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a><code>IConnectableObservable&lt;T&gt;</code>の使い方</h2>

<h3>
<span id="例１いくつかのオペレータを追加したiobservableをhot変換して使い回したい" class="fragment"></span><a href="#%E4%BE%8B%EF%BC%91%E3%81%84%E3%81%8F%E3%81%A4%E3%81%8B%E3%81%AE%E3%82%AA%E3%83%9A%E3%83%AC%E3%83%BC%E3%82%BF%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%9Fiobservable%E3%82%92hot%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%A6%E4%BD%BF%E3%81%84%E5%9B%9E%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>例１：いくつかのオペレータを追加した<code>IObservable</code>をHot変換して使い回したい</h3>

<p>オペレータはColdなので複数回<code>Subscribe</code>されると無駄な処理が走ることになります。<br>
それを防ぐためにHot変換を行う例です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">//Observableソースを作る</span>
<span class="n">Subject</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">subject</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Subject</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>

<span class="c1">//Subjectからのint型の通知に対して何らかのオペレータを追加</span>
<span class="c1">//このまま複数回Subscribeされるとオペレータが重複生成されて無駄な処理が走る</span>
<span class="n">IObservable</span><span class="p">&lt;</span><span class="n">TimeSpan</span><span class="p">&gt;</span> <span class="n">sourceColdObservable</span> <span class="p">=</span>
    <span class="n">subject</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="s">が通知されました"</span><span class="p">))</span> <span class="c1">//Hot変換されていることを確認するためのログ</span>
           <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
           <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromSeconds</span><span class="p">(</span><span class="n">n</span><span class="p">));</span>

<span class="c1">//ColdなIObservale「sourceColdObservable」をHot変換する準備をする</span>
<span class="n">IConnectableObservable</span><span class="p">&lt;</span><span class="n">TimeSpan</span><span class="p">&gt;</span> <span class="n">connectableObservable</span> <span class="p">=</span>
    <span class="n">sourceColdObservable</span><span class="p">.</span><span class="nf">Publish</span><span class="p">();</span>

<span class="c1">//Publish内部のSubjectにsourceColdObservableをSubscribeさせる</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Connect</span><span class="p">();</span>

<span class="c1">//Publish内部のSubject(つまりHotなIObservable)をSubscribeする</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">time</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"購読者1:</span><span class="p">{</span><span class="n">time</span><span class="p">}</span><span class="s">"</span><span class="p">));</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">time</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"購読者2:</span><span class="p">{</span><span class="n">time</span><span class="p">}</span><span class="s">"</span><span class="p">));</span>

<span class="n">subject</span><span class="p">.</span><span class="nf">OnNext</span><span class="p">(</span><span class="m">30</span><span class="p">);</span>
<span class="n">subject</span><span class="p">.</span><span class="nf">OnNext</span><span class="p">(</span><span class="m">60</span><span class="p">);</span>
<span class="n">subject</span><span class="p">.</span><span class="nf">OnNext</span><span class="p">(-</span><span class="m">20</span><span class="p">);</span>
<span class="n">subject</span><span class="p">.</span><span class="nf">OnNext</span><span class="p">(</span><span class="m">90</span><span class="p">);</span>
</code></pre></div></div>

<h3>
<span id="結果" class="fragment"></span><a href="#%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>結果</h3>

<p>複数回<code>Subscribe</code>しても<code>Do</code>オペレータは<code>OnNext</code>の分だけ通過してることがわかるので、Hot変換が成功していることがわかります。</p>

<p><a href="https://camo.qiitausercontent.com/d92a321aec54c588a7c6f22a007fe66c8a0314c2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f61653066656634632d656163302d643366382d353363322d3236323462333430336333392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Fae0fef4c-eac0-d3f8-53c2-2624b3403c39.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=add87b45a0fe03780745a18568e07f14" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/ae0fef4c-eac0-d3f8-53c2-2624b3403c39.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Fae0fef4c-eac0-d3f8-53c2-2624b3403c39.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=76048643cc122edd8d2bc9838f474d94 1x" loading="lazy"></a></p>

<h4>
<span id="hot変換しないと" class="fragment"></span><a href="#hot%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%AA%E3%81%84%E3%81%A8"><i class="fa fa-link"></i></a>Hot変換しないと…</h4>

<p>ちなみにHot変換しないとこんな感じになります。<br>
<code>Do</code>オペレータが<code>Subscribe</code>の数だけ呼ばれていることからも分かる通り、オペレータ処理が重複実行されてしまっています。</p>

<p><a href="https://camo.qiitausercontent.com/65a1d769ec27b801455cc1407ff34173465f618b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f34343337613562642d323263392d393333632d336163662d3634373839333431356566392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4437a5bd-22c9-933c-3acf-647893415ef9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5e4d79790bebd01309ef5bdd187cf532" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/4437a5bd-22c9-933c-3acf-647893415ef9.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4437a5bd-22c9-933c-3acf-647893415ef9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=84e80b9f78e8482d41fec74abbdfe8ca 1x" loading="lazy"></a></p>

<h3>
<span id="例２ファクトリメソッドから生成されたobservableシーケンスを使い回したい" class="fragment"></span><a href="#%E4%BE%8B%EF%BC%92%E3%83%95%E3%82%A1%E3%82%AF%E3%83%88%E3%83%AA%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%8B%E3%82%89%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%81%9Fobservable%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9%E3%82%92%E4%BD%BF%E3%81%84%E5%9B%9E%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>例２：ファクトリメソッドから生成されたObservableシーケンスを使い回したい</h3>

<p>ファクトリメソッドから生成された<code>IObservable</code>は基本的にColdなので、<code>Subscribe</code>するたびに新しいObservableシーケンスが生成されます。<br>
１つのObservableシーケンスを複数回<code>Subscribe</code>して使い回したいためにHot変換を行う例です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">//1秒毎にインクリメントする値を発行するColdなObservableソース</span>
<span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">long</span><span class="p">&gt;</span> <span class="n">observableTimer</span> <span class="p">=</span> <span class="n">Observable</span><span class="p">.</span><span class="nf">Interval</span><span class="p">(</span><span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromSeconds</span><span class="p">(</span><span class="m">1</span><span class="p">));</span>

<span class="c1">//Hot変換の準備をする</span>
<span class="n">IConnectableObservable</span><span class="p">&lt;</span><span class="kt">long</span><span class="p">&gt;</span> <span class="n">connectableObservable</span> <span class="p">=</span>
    <span class="n">observableTimer</span><span class="p">.</span><span class="nf">Publish</span><span class="p">();</span>

<span class="c1">//Publish内でobservableTimerをSubscribe</span>
<span class="c1">//→Observableシーケンスが生成され、タイマーが開始される</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Connect</span><span class="p">();</span>

<span class="c1">//Publish内のSubjectをSubscribe</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">l</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"最初からの購読者【</span><span class="p">{</span><span class="n">l</span><span class="p">}</span><span class="s">】"</span><span class="p">));</span>
<span class="c1">//2.5秒後にもう一度Publish内のSubjectをSubscribe</span>
<span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">2500</span><span class="p">);</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">l</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"2.5秒遅れの購読者【</span><span class="p">{</span><span class="n">l</span><span class="p">}</span><span class="s">】"</span><span class="p">));</span>
</code></pre></div></div>

<h4>
<span id="結果-1" class="fragment"></span><a href="#%E7%B5%90%E6%9E%9C-1"><i class="fa fa-link"></i></a>結果</h4>

<p>Hot変換することで、「最初からの購読者」、「2.5秒遅れの購読者」に対して、同一の値が発行されていることが分かります。したがって、1つのObservableシーケンスを共有できていることがわかります。</p>

<p><a href="https://camo.qiitausercontent.com/ab7c0522890f65822050a9a34820ab112c75e666/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f33373237346362302d633233382d613033322d363061312d6632393936633534613532332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F37274cb0-c238-a032-60a1-f2996c54a523.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c493356c9d6e91ce0cea947a7a665946" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/37274cb0-c238-a032-60a1-f2996c54a523.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F37274cb0-c238-a032-60a1-f2996c54a523.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=dffcbb92b6c27174222caef0466e24a5 1x" loading="lazy"></a></p>

<h4>
<span id="hot変換しないと-1" class="fragment"></span><a href="#hot%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%AA%E3%81%84%E3%81%A8-1"><i class="fa fa-link"></i></a>Hot変換しないと…</h4>

<p>Hot変換しないと、「2.5秒遅れの購読者」に対しては新しく0から値が発行されていることがわかります。つまり、それぞれObservableシーケンスが別個に生成されているということになります。</p>

<p><a href="https://camo.qiitausercontent.com/0f07400a2648f4416dafc953c951f027a33c6b97/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f39326363396237322d383832352d343963642d323562342d6162636466333835326435332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F92cc9b72-8825-49cd-25b4-abcdf3852d53.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=774dd19a0541c13c4d4067b39b1ef418" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/92cc9b72-8825-49cd-25b4-abcdf3852d53.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F92cc9b72-8825-49cd-25b4-abcdf3852d53.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d908d70d23202d31f0b3b63e98f4564f 1x" loading="lazy"></a></p>

<h2>
<span id="なぜconnectが必要なのか" class="fragment"></span><a href="#%E3%81%AA%E3%81%9Cconnect%E3%81%8C%E5%BF%85%E8%A6%81%E3%81%AA%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>なぜ<code>Connect</code>が必要なのか</h2>

<p>ところで、上記の2例ではどちらも</p>

<ol>
<li>Cold Observableを<code>Publish</code>
</li>
<li>出てきた<code>IConnectableObservable&lt;T&gt;</code>を<code>Connect</code>
</li>
<li>
<code>IConnectableObservable&lt;T&gt;</code>を好きなだけ<code>Subscribe</code>
</li>
</ol>

<p>の順に操作しています。<br>
であれば、<strong><code>Connect</code>の存在意義とは一体何なのか？</strong><code>Publish</code>して<code>Connect</code>するのなら、<code>Publish</code>内で自動的にやっておいてくれれば良いのではないか？と思うかもしれません。<br>
ところが、<code>Connect</code>を呼び出すタイミングには重要な意味があって、場合によっては<strong><code>Connect</code>の呼び出すタイミングによって実行結果がまったく変わってくる</strong>ことがあります。</p>

<p>例えば、以下のような例では、<code>Connect</code>を呼び出すタイミングが非常に重要になります。<br>
①〜④のうち、どこで<code>Connect()</code>を呼び出すべきでしょうか？</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">//1~10までの値を発行するColdなObservableソース</span>
<span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">observableRange</span> <span class="p">=</span> <span class="n">Observable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">);</span>

<span class="n">IConnectableObservable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">connectableObservable</span> <span class="p">=</span>
    <span class="n">observableRange</span><span class="p">.</span><span class="nf">Publish</span><span class="p">();</span>

<span class="c1">//①ここでConnect()?</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"1個めのSubscribe：</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
<span class="c1">//②ここでConnect()?</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"2個めのSubscribe：</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="s">"</span><span class="p">));</span>
<span class="c1">//③ここでConnect()?</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"3個めのSubscribe：</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="s">"</span><span class="p">));</span>
<span class="c1">//④ここでConnect()?</span>
</code></pre></div></div>

<p>↓<br>
↓<br>
↓<br>
↓</p>

<p>答えは、3つの<code>Subscribe</code>にすべて値を通知させるためには、<strong>④の位置</strong>で<code>Connect()</code>を呼び出す必要があります。</p>

<p><code>Connect()</code>の効果は「<strong><code>Publish</code>内の<code>Subject&lt;T&gt;</code>に、変換元のColdなIObservableを<code>Subscribe</code>させる</strong>」でした。<br>
この場合、「変換元のColdな<code>IObservable</code>」とは<code>Observable.Range</code>ですので、<strong><code>Subscribe</code>した瞬間に1~10までの値が即座に流れてきてしまいます</strong>。</p>

<p>したがって、例えば①の位置で<code>Connect()</code>を呼び出すと、<strong>誰も<code>Subject</code>を<code>Subscribe</code>しないまま1~10の値が流れてきてすぐに<code>OnCompleted</code>する</strong>ので、結果として<strong><code>Observable.Range</code>が発行した値は虚無に消えます</strong>。<br>
<code>OnCompleted</code>したあとに3回<code>Subscribe</code>していますが、もはやなんの値も流れてこないので、値がまったく通知されてこないことになってしまいます。</p>

<p>②や③で<code>Connect()</code>した場合は、<code>Connect()</code>以前に<code>Subscribe</code>していた購読先には値が届きますが、<code>Connect()</code>以降に<code>Subscribe</code>した購読先には値は届きません。</p>

<p>④で<code>Connect()</code>すれば、きちんとすべての購読先が<code>Subscribe</code>を完了させ、準備万端な状態で<code>Observable.Range</code>を<code>Subscribe</code>するので、すべての購読先に対して<code>Observable.Range</code>の発行値をマルチキャストすることができます。</p>

<p>このように、ファクトリメソッドなどのColdなObservableソースをHot変換する場合は、<code>Connect()</code>を呼ぶタイミングが非常に重要になることが分かります。</p>

<h3>
<span id="connectのタイミングに左右されない場合" class="fragment"></span><a href="#connect%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%AB%E5%B7%A6%E5%8F%B3%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a><code>Connect</code>のタイミングに左右されない場合</h3>

<p>対して、<code>Connect()</code>を呼ぶタイミングが重要ではない場合もあります。それは、<strong>ObservableソースがHot</strong>である場合です。<br>
ObservableソースがHotとは、<strong><code>Subject</code>から値が生成されている場合</strong>を指します。</p>

<p>先ほどの例の<code>Observable.Range</code>ファクトリメソッドの場合は、<strong><code>Subscribe</code>したタイミングで、値が生成されて発行されていく</strong>のでした。つまり、「<strong>購読側で値の発行タイミングを制御できている</strong>」と言えます。<br>
これに対して<code>Subject</code>から値が生成されているということは、値の発行タイミングが<code>OnNext</code>が呼ばれるタイミングに委ねられることになります。つまり、「<strong>購読側では値が発行されるタイミングを制御することができない</strong>」、と言えます。</p>

<p>値の発行タイミングが制御できるのであれば、値の発行開始を示す<code>Connect()</code>呼び出しのタイミングは前述の通り非常に重要になりますが、<code>Subject</code>のように<strong>値の発行タイミングが制御できないのであれば、もはや<code>Connect()</code>の呼び出すタイミングはいつでも良い</strong>です。いつ<code>Subscribe</code>しようが、値が流れてくるタイミングはこちらでは制御できないためです。</p>

<p>例えば、次のような例で考えてみます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">SubjectProvider</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">Subject</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">subject</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Subject</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>

    <span class="c1">//中略</span>
    <span class="c1">//Subjectに対して何らかのタイミングでOnNextにより値を発行している</span>

    <span class="c1">//SubjectをIObservableとして公開している</span>
    <span class="k">public</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">Observable</span> <span class="p">=&gt;</span> <span class="n">subject</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">SubjectSubscriber</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">SubjectProvider</span> <span class="n">subjectProvider</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SubjectProvider</span><span class="p">();</span>

    <span class="k">public</span> <span class="nf">SubjectSubscriber</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//外部が公開しているSubjectに対してオペレータをつけてHot変換</span>
        <span class="n">IConnectableObservable</span><span class="p">&lt;</span><span class="n">TimeSpan</span><span class="p">&gt;</span> <span class="n">connectableObservable</span> <span class="p">=</span>
            <span class="n">subjectProvider</span><span class="p">.</span><span class="n">Observable</span>
                           <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                           <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromSeconds</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                           <span class="p">.</span><span class="nf">Publish</span><span class="p">();</span>
        <span class="c1">//どこでConnectしよう？</span>
        <span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">time</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">time</span><span class="p">));</span>
        <span class="c1">//どこでConnectしよう？</span>
        <span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">time</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">time</span><span class="p">));</span>
        <span class="c1">//どこでConnectしよう？</span>
        <span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">time</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">time</span><span class="p">));</span>
        <span class="c1">//どこでConnectしよう？</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code>SubjectSubscriber</code>は、外部が公開している<code>Subject</code>を取得してHot変換をかけています。どこで<code>Connect</code>しようか迷っているようですが、この場合はどこで<code>Connect</code>しても結果は変わりません。<br>
Observableソースが<code>Subject</code>の場合、いつ<code>Subscribe</code>しようが単一のObservableシーケンスを<code>Subscribe</code>することになるので、<code>Subscribe</code>のタイミングによって結果が左右されることがないのです。</p>

<p>ただ、もちろん<code>Subscribe</code>のタイミングが大幅に遅れると、それまで発行された値は通知されなくなるので、例えば以下のようにするのは問題です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">IConnectableObservable</span><span class="p">&lt;</span><span class="n">TimeSpan</span><span class="p">&gt;</span> <span class="n">connectableObservable</span> <span class="p">=</span>
    <span class="n">subjectProvider</span><span class="p">.</span><span class="n">Observable</span>
                   <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                   <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromSeconds</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                   <span class="p">.</span><span class="nf">Publish</span><span class="p">();</span>

<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">time</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">time</span><span class="p">));</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">time</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">time</span><span class="p">));</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">time</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">time</span><span class="p">));</span>

<span class="c1">//10秒経ってからソースSubjectをSubscribe</span>
<span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">10000</span><span class="p">);</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Connect</span><span class="p">();</span>
</code></pre></div></div>

<p>このようにすると、<code>connectableObservable</code>を<code>Subscribe</code>してから10秒間に発行された値は購読先にマルチキャストされなくなってしまうため、このような極端な例はNGとなります。</p>

<p>逆に、早く<code>Connect</code>する分にはまったく問題がありませんので、ObservableソースがHotであると分かっている場合は、<code>IConnectableObservable&lt;T&gt;</code>を即<code>Connect</code>してしまっても問題ないでしょう。</p>

<h2>
<span id="connectの戻り値のidisposableとは何なのか" class="fragment"></span><a href="#connect%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%81%AEidisposable%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%AA%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a><code>Connect</code>の戻り値の<code>IDisposable</code>とは何なのか</h2>

<p>ところで、<code>Connect()</code>の戻り値は<code>IDisposable</code>となっています。果たしてこの<code>IDisposable</code>は、<code>Subscribe</code>の戻り値の<code>IDisposable</code>と何が違うのでしょうか？前に掲載した図をもう一度見てみると、違いはすぐに分かると思います。</p>

<p><a href="https://camo.qiitausercontent.com/ad860cdeb47fb05f40b3b3ab8b7b8f88ce9d513c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f34383836626235622d656134642d326164382d306466612d3261666561653166643833342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4886bb5b-ea4d-2ad8-0dfa-2afeae1fd834.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=45e676540d5dd98ce2baa6616c963025" alt="ConnectableObservable.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/4886bb5b-ea4d-2ad8-0dfa-2afeae1fd834.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4886bb5b-ea4d-2ad8-0dfa-2afeae1fd834.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b89279b102ffb3ce47bdd71a0dca8a50 1x" loading="lazy"></a></p>

<p>この図を見ると、<strong><code>Connect</code>も<code>Subscribe</code>もどちらもやっていることは「<code>Subscribe</code>」</strong>ですね。</p>

<p>したがって、<code>Connect</code>の戻り値の<code>IDisposable</code>とは、<strong><code>Subject</code>が変換元の<code>IObservable</code>を<code>Subscribe</code>したときに出てきた<code>IDisposable</code>のことである</strong>ということがわかります。<br>
<code>IConnectableObservable</code>の<code>Subscribe</code>の戻り値の<code>IDisposable</code>を<code>Dispose</code>すると、<code>Subject</code>への購読が<code>Dispose</code>されるのと同様に、<strong><code>Connect</code>の戻り値の<code>IDisposable</code>を<code>Dispose</code>すると、ソースとなるColdな<code>IObservable</code>への購読が<code>Dispose</code>される</strong>ということになります。</p>

<h3>
<span id="connectまたはsubscribeをdisposeしたときの挙動の違い" class="fragment"></span><a href="#connect%E3%81%BE%E3%81%9F%E3%81%AFsubscribe%E3%82%92dispose%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AE%E6%8C%99%E5%8B%95%E3%81%AE%E9%81%95%E3%81%84"><i class="fa fa-link"></i></a><code>Connect</code>または<code>Subscribe</code>を<code>Dispose</code>したときの挙動の違い</h3>

<p>ではどちらを<code>Dispose</code>すべきなのか。</p>

<p>まず前提として、<strong>ただ単に<code>Dispose</code>したいだけ、購読を解除したいだけならば、どちらを<code>Dispose</code>しても挙動は変わりません。</strong><br>
<code>Subscribe</code>のほうを<code>Dispose</code>すれば<code>Subject</code>自体への購読が直接解除されるし、<code>Connect</code>のほうを<code>Dispose</code>すれば、<code>Subject</code>に入ってくるソースからの通知が遮断されるので、結果的に通知が来なくなります。</p>

<p>挙動が変わってくるのは、<strong><code>Connect</code>を<code>Dispose</code>したあとに、再び<code>Connect</code>（再接続）</strong>するような場合です。そして、これに関しても、<strong>ソースとなるColdな<code>IObservable</code>のObservableソースがColdなのかHotなのかで挙動が随分変わってきます</strong>。</p>

<p>もし、<strong>ObservableソースがHot</strong>、つまり<code>Subject</code>から値が生成されているならば、何度「切断/再接続」を行ったとしても、ただ単に接続されている場合は値が飛んでくる、切断した場合は値が飛んでこない、それだけの違いになります。<br>
しかし、<strong>ObservableソースがCold</strong>、つまりファクトリメソッドなどから値が生成されている場合は、<strong>「切断/再接続」をするたびに、新しいObservableソースが生成される</strong>ことになります。</p>

<p>例えば、以下の例を見てください。<br>
<code>Observable.Interval</code>を<code>Publish</code>して<code>Connect</code>したあと、3秒後に切断/再接続を行う例です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">long</span><span class="p">&gt;</span> <span class="n">observableInterval</span> <span class="p">=</span> <span class="n">Observable</span><span class="p">.</span><span class="nf">Interval</span><span class="p">(</span><span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromSeconds</span><span class="p">(</span><span class="m">1</span><span class="p">));</span>

<span class="n">IConnectableObservable</span><span class="p">&lt;</span><span class="kt">long</span><span class="p">&gt;</span> <span class="n">connectableObservable</span> <span class="p">=</span>
    <span class="n">observableInterval</span><span class="p">.</span><span class="nf">Publish</span><span class="p">();</span>

<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"1個めのSubscribe：</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="s">"</span><span class="p">));</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"2個めのSubscribe：</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="s">"</span><span class="p">));</span>

<span class="c1">//Observale.Intervalに接続する</span>
<span class="n">IDisposable</span> <span class="n">connection</span> <span class="p">=</span> <span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Connect</span><span class="p">();</span>

<span class="c1">//3秒経ったら切断して再接続する</span>
<span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">3000</span><span class="p">);</span>
<span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"3秒経ったので切断/再接続"</span><span class="p">);</span>
<span class="n">connection</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Connect</span><span class="p">();</span>
</code></pre></div></div>

<p>実行結果は次のようになります。</p>

<p><a href="https://camo.qiitausercontent.com/8d2dd154c174de85fe684d75b7f19b28bc7437cb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f66313836323839392d333031322d326636302d306439312d3161366663326663356664322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Ff1862899-3012-2f60-0d91-1a6fc2fc5fd2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d31a07dee09a744d841f00d9673d74bf" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/f1862899-3012-2f60-0d91-1a6fc2fc5fd2.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Ff1862899-3012-2f60-0d91-1a6fc2fc5fd2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=22948528ade4b3e58668581556452eac 1x" loading="lazy"></a></p>

<p>3秒経って「切断」を行うと、それまでのObservableシーケンスは破棄されます。そして、<strong>「再接続」を行うと、また新しいObservableシーケンスが生成される</strong>ため、インクリメントが0に戻っていることがわかります。</p>

<p>次の例のように、Observableソース自体をHot化しておけば、「切断/再接続」を行ってもObservableシーケンスは破棄されず、再接続しても途中から始まります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>
<span class="n">IConnectableObservable</span><span class="p">&lt;</span><span class="kt">long</span><span class="p">&gt;</span> <span class="n">connectableInterval</span> <span class="p">=</span>
    <span class="n">Observable</span><span class="p">.</span><span class="nf">Interval</span><span class="p">(</span><span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromSeconds</span><span class="p">(</span><span class="m">1</span><span class="p">))</span>
              <span class="p">.</span><span class="nf">Publish</span><span class="p">();</span>
<span class="n">connectableInterval</span><span class="p">.</span><span class="nf">Connect</span><span class="p">();</span> <span class="c1">//Observable.Interval自体をHot化（ObservableソースがHot化する）</span>

<span class="n">IConnectableObservable</span><span class="p">&lt;</span><span class="kt">long</span><span class="p">&gt;</span> <span class="n">connectableObservable</span> <span class="p">=</span>
    <span class="n">connectableInterval</span><span class="p">.</span><span class="nf">Publish</span><span class="p">();</span>

<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"1個めのSubscribe：</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="s">"</span><span class="p">));</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"2個めのSubscribe：</span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="s">"</span><span class="p">));</span>

<span class="c1">//Observale.IntervalをHot化したものに接続する</span>
<span class="n">IDisposable</span> <span class="n">connection</span> <span class="p">=</span> <span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Connect</span><span class="p">();</span>

<span class="c1">//3秒経ったら切断して再接続する</span>
<span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">3000</span><span class="p">);</span>
<span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"3秒経ったので切断/再接続"</span><span class="p">);</span>
<span class="n">connection</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
<span class="n">connectableObservable</span><span class="p">.</span><span class="nf">Connect</span><span class="p">();</span>
</code></pre></div></div>

<p><a href="https://camo.qiitausercontent.com/4ff0f70efd42feba076b595f24f703ec7684f4f2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f34383766363335372d356164342d646466342d306639652d6530326438373965353761312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F487f6357-5ad4-ddf4-0f9e-e02d879e57a1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f16e9bdf5dd1d526c42d24199d354f5b" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/487f6357-5ad4-ddf4-0f9e-e02d879e57a1.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F487f6357-5ad4-ddf4-0f9e-e02d879e57a1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6a2d69f99d4f40e7f8b176590735b22a 1x" loading="lazy"></a></p>

<h3>
<span id="挙動まとめ" class="fragment"></span><a href="#%E6%8C%99%E5%8B%95%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>挙動まとめ</h3>

<p><code>Connect</code>の<code>IDisposable</code>と<code>Subscribe</code>の<code>IDisposable</code>、それぞれの挙動をまとめると次のようになります。</p>

<table>
<thead>
<tr>
<th>Obsevableソース</th>
<th>
<code>Connect</code>を<code>Dispose</code>
</th>
<th>
<code>Subscribe</code>を<code>Dispose</code>
</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Hot</strong></td>
<td>通知が来なくなる<br><strong>再接続すると、そのタイミングからまた通知が再開される</strong>
</td>
<td>通知が来なくなる</td>
</tr>
<tr>
<td><strong>Cold</strong></td>
<td>通知が来なくなる<br><strong>再接続すると、新しいObservableシーケンスが生成されるので最初から値が発行される</strong>
</td>
<td>通知が来なくなる</td>
</tr>
</tbody>
</table>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>長くなってしまいましたがまとめると次のようになります。</p>

<ul>
<li>Hot変換とは、Observableシーケンスを<code>Subject</code>が代表して購読し、そこから再配信することである</li>
<li>
<code>Publish</code>オペレータはHot変換の準備をしているだけ。<code>Publish</code>をつけただけでは、Observableシーケンスになんの影響も与えない</li>
<li>ObservableソースがHotかColdかによって<code>Connect</code>すべきタイミングが異なる</li>
<li>切断/再接続時の挙動もObservableソースのHotColdによって異なるので注意</li>
</ul>

<p>自分の中で<code>Publish</code>の理解が曖昧だったので記事にまとめましたがだいぶしっかりした知識になった気がします。<br>
あと基本、外部に<code>IObservable</code>を公開するときはHot変換して公開したほうが良さそうな気がします。外部からはこの<code>IObservable</code>がHotかColdか、はたまたObservableソースがColdなのかHotなのかなんてわかりませんから。外部に公開するときはHot、これを徹底しておけばハマる確率がかなり減らせるのではないかと思いました。もちろん意図的にColdで公開したい！って場合は、わかるようにしておけばそれはそれで良いと思いますけどね。</p>

<p>では、最後までありがとうございました！<br>
ご意見ご指摘等ありましたらコメントお願いします！</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fyutorisan%2Fitems%2F68bd68bbffe3c4f3ba32&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fyutorisan%2Fitems%2F68bd68bbffe3c4f3ba32&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yutorisan/items/68bd68bbffe3c4f3ba32/likers" class="css-1iupg5d">7</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">6</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/68bd68bbffe3c4f3ba32/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yutorisan/items/68bd68bbffe3c4f3ba32/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yutorisan/items/68bd68bbffe3c4f3ba32/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yutorisan/items/68bd68bbffe3c4f3ba32/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yutorisan/items/68bd68bbffe3c4f3ba32.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-27557d0f-4e49-4c59-9498-86f2929f9ade">{"authorAnalyticsTrackingId":"UA-135447292-3","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-f43e6647-0dfa-4ba5-ad1b-5b7ade1acf82"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-f43e6647-0dfa-4ba5-ad1b-5b7ade1acf82">{}</script>
      
<div id="LoginModal-react-component-6c1e3343-6b71-4e93-9c3a-6db8ea84bb0b"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-6c1e3343-6b71-4e93-9c3a-6db8ea84bb0b">{}</script>
      
<div id="StockModal-react-component-057cb216-9715-4e20-a521-869152618a73"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-057cb216-9715-4e20-a521-869152618a73">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;B8qoT/HxJXzR4MPACwokbqXgtux5tUAmV2/qSWA5kEpL/FwJDsdkHiSTFEfFastGpMOTzB0FB+Qy99uvHBI5Gw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eReactiveExtensions（以下Rx）の鬼門はHot-Coldの概念とHot変換だと思います。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eHot変換が必要なのはストリームを枝分かれさせたいときである…\u003c/li\u003e\n\u003cli\u003eHot変換するには\u003ccode\u003ePublish()\u003c/code\u003eして\u003ccode\u003eConnect()\u003c/code\u003eすれば良い…\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e等々はいろいろな記事で紹介されていますが、では\u003ccode\u003ePublish()\u003c/code\u003eすると裏で一体何が起こるのか？\u003ccode\u003eConnect()\u003c/code\u003eすると何が起こる？というのは、あまり詳しく解説されている記事が少ない印象です。\u003c/p\u003e\n\n\u003cp\u003eそこで、本記事ではRxの鬼門\u003ccode\u003ePublish()\u003c/code\u003eメソッドを「とりあえず」で使うのを卒業し、何が行われているかを「完全に理解」できるように解説していきます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"前提知識hotとcold\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E6%8F%90%E7%9F%A5%E8%AD%98hot%E3%81%A8cold\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e[前提知識]HotとCold\u003c/h1\u003e\n\n\u003cp\u003eまずは前提となるHotとColdの知識が必要です。\u003cbr\u003e\n別記事で書きましたので、もしHotColdの知識が曖昧な方はご覧ください。\u003cbr\u003e\n\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスの役割とHotColdとの関係性についても解説しています。\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/yutorisan/items/844eaeab392abf03ce80\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003e↑の記事の内容を要約すると次の３つに言及しています。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"1subjecttクラスの特徴について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1subjectt%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E7%89%B9%E5%BE%B4%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1.\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスの特徴について\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスは\u003cstrong\u003e1つのObservableシーケンスを複数の購読者に対してマルチキャストする機能\u003c/strong\u003eを持つ。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/a52d9520bea34775f3e802aeb593df14c5a70457/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f33616131343639622d666536322d393064342d393762372d3338613834366263326466372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F3aa1469b-fe62-90d4-97b7-38a846bc2df7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e1c4642b96cf607a863dc9b7f566b858\" alt=\"Subjectの役割_OnNext.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/3aa1469b-fe62-90d4-97b7-38a846bc2df7.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F3aa1469b-fe62-90d4-97b7-38a846bc2df7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=060653ffea1a44347bcae617fdf3d10f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"2hotなiobservableとcoldなiobservableの違いについて\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2hot%E3%81%AAiobservable%E3%81%A8cold%E3%81%AAiobservable%E3%81%AE%E9%81%95%E3%81%84%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.Hotな\u003ccode\u003eIObservable\u003c/code\u003eとColdな\u003ccode\u003eIObservable\u003c/code\u003eの違いについて\u003c/h3\u003e\n\n\u003cp\u003eHotな\u003ccode\u003eIObservable\u003c/code\u003eとは、\u003cstrong\u003e\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスから出ている\u003ccode\u003eIObservable\u003c/code\u003e\u003c/strong\u003eのことを指す。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/a66378c060716772d099e413721ab10d56231df4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f61633331353263662d666466662d316135642d613461662d3364616237346331326236662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Fac3152cf-fdff-1a5d-a4af-3dab74c12b6f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=72a2486c959ffc5ae71f5e51143055c8\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/ac3152cf-fdff-1a5d-a4af-3dab74c12b6f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Fac3152cf-fdff-1a5d-a4af-3dab74c12b6f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=06ef2df56352ef4c3a5283272224e449 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e実体は\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスなので、複数の購読者に対してObservableシーケンスをマルチキャストできるという特徴を持つ。\u003c/p\u003e\n\n\u003cp\u003e対して、\u003cstrong\u003eそれ以外の（\u003ccode\u003eSubject\u003c/code\u003e以外から出ているような）\u003ccode\u003eIObservable\u003c/code\u003eはCold\u003c/strong\u003eと呼ばれる。\u003cbr\u003e\nUniRxのオペレータから出てくる\u003ccode\u003eIObservable\u003c/code\u003eはほぼColdである。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"3observableソースについて\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3observable%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.Observableソースについて\u003c/h3\u003e\n\n\u003cp\u003eObservableソースとは、Observableシーケンスに流れてくる\u003cstrong\u003e値の発生源\u003c/strong\u003eのこと。これにもHotとColdがある。\u003c/p\u003e\n\n\u003cp\u003eHotなObservableソースは、何回\u003ccode\u003eSubscribe\u003c/code\u003eされてもObservableシーケンスは１つ。\u003ccode\u003eSubscribe\u003c/code\u003eした時点以降の通知が届くようになる。\u003cbr\u003e\n\u003cstrong\u003e\u003ccode\u003eSubject\u003c/code\u003eがObservableソースの場合は、HotなObservableソース\u003c/strong\u003eとなる。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/8dbb36de886264411817b56e5b9b4ef226becc21/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f34373137653561362d356532622d643462662d626232322d6664613630396533306166352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4717e5a6-5e2b-d4bf-bb22-fda609e30af5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e67aefee4827d511ac9211965dad47df\" alt=\"Hot Observableソース.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/4717e5a6-5e2b-d4bf-bb22-fda609e30af5.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4717e5a6-5e2b-d4bf-bb22-fda609e30af5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3192b43fcda62fcc54501c5ebdf93b80 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e対してColdなObservableソースの場合、\u003ccode\u003eSubscribe\u003c/code\u003eされたらその都度専用のObservableシーケンスが生成される。\u003cbr\u003e\n専用のObservableシーケンスなので、いつ\u003ccode\u003eSubscribe\u003c/code\u003eしてもすべての通知が届く。\u003cbr\u003e\n主に\u003cstrong\u003eファクトリメソッド等から生成される場合、ColdなObservableソース\u003c/strong\u003eとなる。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/59d60a6e13aacd16a8e5dcc550461ad64216a08d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f66306330366534382d613033312d333764352d616135342d3936663264646263663337652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Ff0c06e48-a031-37d5-aa54-96f2ddbcf37e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=21822ca97dac523010df51a14a2c7d14\" alt=\"Cold Observableソース.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/f0c06e48-a031-37d5-aa54-96f2ddbcf37e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Ff0c06e48-a031-37d5-aa54-96f2ddbcf37e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b4e78831d2419e5cc0896f9b5dbd3cfe 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれらの内容を踏まえた上で、\u003ccode\u003ePublish\u003c/code\u003eオペレータについて解説していきます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"coldhot変換するにはどうすればよいのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#coldhot%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B%E3%81%AB%E3%81%AF%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCold→Hot変換するにはどうすればよいのか\u003c/h1\u003e\n\n\u003cp\u003e前述したHot, Coldの定義と、\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスの特徴を踏まえて、\u003cstrong\u003eCold\u003c/strong\u003eな\u003ccode\u003eIObservable\u003c/code\u003eを\u003cstrong\u003eHot\u003c/strong\u003eな\u003ccode\u003eIObservable\u003c/code\u003eに変換するにはどうすれば良いのかを考えます。\u003cbr\u003e\n要は、\u003cstrong\u003e\u003ccode\u003eSubject\u003c/code\u003eクラスから出ている\u003ccode\u003eIObservable\u003c/code\u003eならば確実にHot\u003c/strong\u003eなのですから、「\u003cstrong\u003eColdなObservableを\u003ccode\u003eSubject\u003c/code\u003eクラスから再発信すれば良いのではないか\u003c/strong\u003e」と考えることができます。\u003c/p\u003e\n\n\u003cp\u003e具体的には、次の手順を踏みます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"1subjecttクラスを用意します\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1subjectt%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E7%94%A8%E6%84%8F%E3%81%97%E3%81%BE%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1.\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスを用意します。\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/700f24858d025d3b5f31b8a411ee65df7224a168/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f30383837346563662d643766612d663661622d663939342d6563353862353166326564302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F08874ecf-d7fa-f6ab-f994-ec58b51f2ed0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=464ba39dbea83404b47e34ef1aa9e455\" alt=\"Subjectクラス.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/08874ecf-d7fa-f6ab-f994-ec58b51f2ed0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F08874ecf-d7fa-f6ab-f994-ec58b51f2ed0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4148a269049b78958c24bf8cdbddcb53 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"2-subjecttはhot変換したいcoldなiobservabletを代表して1回だけsubscribeします\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-subjectt%E3%81%AFhot%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%9F%E3%81%84cold%E3%81%AAiobservablet%E3%82%92%E4%BB%A3%E8%A1%A8%E3%81%97%E3%81%A61%E5%9B%9E%E3%81%A0%E3%81%91subscribe%E3%81%97%E3%81%BE%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. \u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eは、Hot変換したいColdな\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eを代表して1回だけ\u003ccode\u003eSubscribe\u003c/code\u003eします。\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/2a62600cf20b301c3642a7b11bee6a85bcdc8cd5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f37623939396161632d613761612d653733332d623131632d6236396466623136383139642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F7b999aac-a7aa-e733-b11c-b69dfb16819d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=636842686ff64e335e5397c46fea0864\" alt=\"2.ColdをSubscribe.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/7b999aac-a7aa-e733-b11c-b69dfb16819d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F7b999aac-a7aa-e733-b11c-b69dfb16819d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4d5c0d4f313bd556676634aa4ba8c01d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"3-subscribeするとsubjecttに対してcoldなiobservabletから通知が流れてきます\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-subscribe%E3%81%99%E3%82%8B%E3%81%A8subjectt%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6cold%E3%81%AAiobservablet%E3%81%8B%E3%82%89%E9%80%9A%E7%9F%A5%E3%81%8C%E6%B5%81%E3%82%8C%E3%81%A6%E3%81%8D%E3%81%BE%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. \u003ccode\u003eSubscribe\u003c/code\u003eすると、\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eに対してColdな\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eから通知が流れてきます。\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/de47542396255ad9548526db3c46cde4cc3689a9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f34343163616262352d663936612d626561302d343564622d3462326535633634393862392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F441cabb5-f96a-bea0-45db-4b2e5c6498b9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0368245ec644cef18c748e5c7238b628\" alt=\"3.通知が流れてくる.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/441cabb5-f96a-bea0-45db-4b2e5c6498b9.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F441cabb5-f96a-bea0-45db-4b2e5c6498b9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ac5370d2e8079c450c3f850b6ff104bb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"4-subjecttクラスのiobservabletを外部に公開します\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-subjectt%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AEiobservablet%E3%82%92%E5%A4%96%E9%83%A8%E3%81%AB%E5%85%AC%E9%96%8B%E3%81%97%E3%81%BE%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4. \u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスの\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eを外部に公開します。\u003c/h3\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスから出ている\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eはHotな\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/strong\u003eなので、Hot変換が完了しました。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/a3570ac51f62f5fe5ebf92afaddbf976383df45e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f36373564363163642d363064622d643134622d313134612d3737313338386632633236322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F675d61cd-60db-d14b-114a-771388f2c262.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7ec988d9a55ce32df481435318137619\" alt=\"4.Hot変換完了.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/675d61cd-60db-d14b-114a-771388f2c262.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F675d61cd-60db-d14b-114a-771388f2c262.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9a0728d7cd286ca404f69d81fde999e5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスを使うことで、無事にHot変換を行うことができました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"publishすると何が起こる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#publish%E3%81%99%E3%82%8B%E3%81%A8%E4%BD%95%E3%81%8C%E8%B5%B7%E3%81%93%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003ePublish\u003c/code\u003eすると何が起こる\u003c/h1\u003e\n\n\u003cp\u003eHot変換する手順は上記の通り。じゃあ\u003ccode\u003ePublish\u003c/code\u003eオペレータは上記のことをやっているんだね！と思ったら、実はそうではありません。なんと、\u003cstrong\u003e\u003ccode\u003ePublish\u003c/code\u003eオペレータだけではObservableシーケンスに対してなんの影響も一切与えません\u003c/strong\u003e。つまり、\u003ccode\u003ePublish\u003c/code\u003eオペレータをつけただけでは、Hot変換もまだ完了しないのです。\u003c/p\u003e\n\n\u003cp\u003eじゃあ\u003ccode\u003ePublish\u003c/code\u003eオペレータは何をしているのか？というと、いつでもHot変換ができるような\u003cstrong\u003e「準備」\u003c/strong\u003eをしています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"publishは準備するだけ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#publish%E3%81%AF%E6%BA%96%E5%82%99%E3%81%99%E3%82%8B%E3%81%A0%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003ePublish\u003c/code\u003eは「準備」するだけ\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003ePublish\u003c/code\u003eオペレータが実際に行っている処理は、次に示す「準備」のみに留まります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eHot変換用の\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスを用意する。\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eHot変換したい元となるColdな\u003ccode\u003eIObservable\u003c/code\u003eを用意する。\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e用意しているだけで、\u003cstrong\u003e実際に\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eや\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eに対して何らかの操作をしているわけではない\u003c/strong\u003eことがポイントです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"準備したものに対する操作は次の工程に委託する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%BA%96%E5%82%99%E3%81%97%E3%81%9F%E3%82%82%E3%81%AE%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E6%93%8D%E4%BD%9C%E3%81%AF%E6%AC%A1%E3%81%AE%E5%B7%A5%E7%A8%8B%E3%81%AB%E5%A7%94%E8%A8%97%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e準備したものに対する「操作」は次の工程に委託する\u003c/h2\u003e\n\n\u003cp\u003e実際にHot変換が完了するには、あと残り2つの操作を行うことが必要です。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eに変換元のColdな\u003ccode\u003eIObservable\u003c/code\u003eを\u003ccode\u003eSubscribe\u003c/code\u003eさせる\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスの\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eを\u003ccode\u003eSubscribe\u003c/code\u003eする（←\u003cstrong\u003eHot Observableに変換完了\u003c/strong\u003e）\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eこれら2つの操作が完了したとき、はじめてHot変換が完了したことになります。\u003cbr\u003e\nしかし、これらの操作は\u003ccode\u003ePublish\u003c/code\u003e内では行われず、次の工程に委託されます。具体的には、\u003cstrong\u003e\u003ccode\u003ePublish\u003c/code\u003eオペレータの戻り値として、これら2つの操作のみが可能なインターフェイス返す\u003c/strong\u003eことで、次の工程への委託を実現します。\u003cbr\u003e\nそのインターフェイスこそが、\u003cstrong\u003e\u003ccode\u003eIConnectableObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイス\u003c/strong\u003eです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"iconnectableobservabletインターフェイス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#iconnectableobservablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eIConnectableObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイス\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eIConnectableObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスとは、その名の通り\u003cstrong\u003e\u003ccode\u003eConnect\u003c/code\u003eができる\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイス\u003c/strong\u003eです。\u003cbr\u003e\n定義もまんま、\u003ccode\u003eConnect\u003c/code\u003eができるようになった\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIConnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e \u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eつまり、\u003ccode\u003eIConnectableObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスは\u003ccode\u003eConnect\u003c/code\u003eと\u003ccode\u003eSubscribe\u003c/code\u003eのみができるインターフェイスということになります。\u003c/p\u003e\n\n\u003cp\u003eそして、前項で説明したHot変換に必要な2つの操作が、それぞれ\u003ccode\u003eConnect\u003c/code\u003eと\u003ccode\u003eSubscribe\u003c/code\u003eに割り当てられています。\u003cbr\u003e\nそれぞれのメソッドを呼び出すことで、各操作が完了してHot変換が完了することになります。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003eメソッド名\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e割り当てられた操作\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003ccode\u003eConnect\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\n\u003ccode\u003ePublish\u003c/code\u003eが用意した内部の\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eに、変換元のColdな\u003ccode\u003eIObservable\u003c/code\u003eを\u003ccode\u003eSubscribe\u003c/code\u003eさせる\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003ccode\u003eSubscribe\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\n\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eとして公開された\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eを\u003ccode\u003eSubscribe\u003c/code\u003eする\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e図で表すと次のようになります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ad860cdeb47fb05f40b3b3ab8b7b8f88ce9d513c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f34383836626235622d656134642d326164382d306466612d3261666561653166643833342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4886bb5b-ea4d-2ad8-0dfa-2afeae1fd834.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=45e676540d5dd98ce2baa6616c963025\" alt=\"ConnectableObservable.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/4886bb5b-ea4d-2ad8-0dfa-2afeae1fd834.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4886bb5b-ea4d-2ad8-0dfa-2afeae1fd834.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b89279b102ffb3ce47bdd71a0dca8a50 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e次項から更に詳しく解説していきます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"iconnectableobservabletインターフェイス-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#iconnectableobservablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eIConnectableObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイス\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003ePublish\u003c/code\u003eオペレータの戻り値は\u003ccode\u003eIConnectableObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスであるということ、そして\u003ccode\u003eIConnectableObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスは\u003ccode\u003eConnect\u003c/code\u003eと\u003ccode\u003eSubscribe\u003c/code\u003eの2つの操作が可能であることを説明しました。\u003cbr\u003e\nまだピンとこないと思うので、まずはいくつかのHot変換の実例に則って\u003ccode\u003eIConnectableObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスの使い方を説明します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"iconnectableobservabletの使い方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#iconnectableobservablet%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eIConnectableObservable\u0026lt;T\u0026gt;\u003c/code\u003eの使い方\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"例１いくつかのオペレータを追加したiobservableをhot変換して使い回したい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BE%8B%EF%BC%91%E3%81%84%E3%81%8F%E3%81%A4%E3%81%8B%E3%81%AE%E3%82%AA%E3%83%9A%E3%83%AC%E3%83%BC%E3%82%BF%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%9Fiobservable%E3%82%92hot%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%A6%E4%BD%BF%E3%81%84%E5%9B%9E%E3%81%97%E3%81%9F%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e例１：いくつかのオペレータを追加した\u003ccode\u003eIObservable\u003c/code\u003eをHot変換して使い回したい\u003c/h3\u003e\n\n\u003cp\u003eオペレータはColdなので複数回\u003ccode\u003eSubscribe\u003c/code\u003eされると無駄な処理が走ることになります。\u003cbr\u003e\nそれを防ぐためにHot変換を行う例です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//Observableソースを作る\u003c/span\u003e\n\u003cspan class=\"n\"\u003eSubject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esubject\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSubject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//Subjectからのint型の通知に対して何らかのオペレータを追加\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//このまま複数回Subscribeされるとオペレータが重複生成されて無駄な処理が走る\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esourceColdObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eが通知されました\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e//Hot変換されていることを確認するためのログ\u003c/span\u003e\n           \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromSeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//ColdなIObservale「sourceColdObservable」をHot変換する準備をする\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIConnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esourceColdObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePublish\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//Publish内部のSubjectにsourceColdObservableをSubscribeさせる\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//Publish内部のSubject(つまりHotなIObservable)をSubscribeする\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"購読者1:\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"購読者2:\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e30\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e60\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(-\u003c/span\u003e\u003cspan class=\"m\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e90\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結果\u003c/h3\u003e\n\n\u003cp\u003e複数回\u003ccode\u003eSubscribe\u003c/code\u003eしても\u003ccode\u003eDo\u003c/code\u003eオペレータは\u003ccode\u003eOnNext\u003c/code\u003eの分だけ通過してることがわかるので、Hot変換が成功していることがわかります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/d92a321aec54c588a7c6f22a007fe66c8a0314c2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f61653066656634632d656163302d643366382d353363322d3236323462333430336333392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Fae0fef4c-eac0-d3f8-53c2-2624b3403c39.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=add87b45a0fe03780745a18568e07f14\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/ae0fef4c-eac0-d3f8-53c2-2624b3403c39.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Fae0fef4c-eac0-d3f8-53c2-2624b3403c39.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=76048643cc122edd8d2bc9838f474d94 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"hot変換しないと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#hot%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%AA%E3%81%84%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHot変換しないと…\u003c/h4\u003e\n\n\u003cp\u003eちなみにHot変換しないとこんな感じになります。\u003cbr\u003e\n\u003ccode\u003eDo\u003c/code\u003eオペレータが\u003ccode\u003eSubscribe\u003c/code\u003eの数だけ呼ばれていることからも分かる通り、オペレータ処理が重複実行されてしまっています。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/65a1d769ec27b801455cc1407ff34173465f618b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f34343337613562642d323263392d393333632d336163662d3634373839333431356566392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4437a5bd-22c9-933c-3acf-647893415ef9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5e4d79790bebd01309ef5bdd187cf532\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/4437a5bd-22c9-933c-3acf-647893415ef9.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4437a5bd-22c9-933c-3acf-647893415ef9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=84e80b9f78e8482d41fec74abbdfe8ca 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"例２ファクトリメソッドから生成されたobservableシーケンスを使い回したい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BE%8B%EF%BC%92%E3%83%95%E3%82%A1%E3%82%AF%E3%83%88%E3%83%AA%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%8B%E3%82%89%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%81%9Fobservable%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9%E3%82%92%E4%BD%BF%E3%81%84%E5%9B%9E%E3%81%97%E3%81%9F%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e例２：ファクトリメソッドから生成されたObservableシーケンスを使い回したい\u003c/h3\u003e\n\n\u003cp\u003eファクトリメソッドから生成された\u003ccode\u003eIObservable\u003c/code\u003eは基本的にColdなので、\u003ccode\u003eSubscribe\u003c/code\u003eするたびに新しいObservableシーケンスが生成されます。\u003cbr\u003e\n１つのObservableシーケンスを複数回\u003ccode\u003eSubscribe\u003c/code\u003eして使い回したいためにHot変換を行う例です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//1秒毎にインクリメントする値を発行するColdなObservableソース\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobservableTimer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInterval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromSeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//Hot変換の準備をする\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIConnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eobservableTimer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePublish\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//Publish内でobservableTimerをSubscribe\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//→Observableシーケンスが生成され、タイマーが開始される\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//Publish内のSubjectをSubscribe\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003el\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"最初からの購読者【\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e】\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//2.5秒後にもう一度Publish内のSubjectをSubscribe\u003c/span\u003e\n\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2500\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003el\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"2.5秒遅れの購読者【\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e】\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"結果-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E6%9E%9C-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結果\u003c/h4\u003e\n\n\u003cp\u003eHot変換することで、「最初からの購読者」、「2.5秒遅れの購読者」に対して、同一の値が発行されていることが分かります。したがって、1つのObservableシーケンスを共有できていることがわかります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ab7c0522890f65822050a9a34820ab112c75e666/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f33373237346362302d633233382d613033322d363061312d6632393936633534613532332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F37274cb0-c238-a032-60a1-f2996c54a523.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c493356c9d6e91ce0cea947a7a665946\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/37274cb0-c238-a032-60a1-f2996c54a523.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F37274cb0-c238-a032-60a1-f2996c54a523.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=dffcbb92b6c27174222caef0466e24a5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"hot変換しないと-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#hot%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%AA%E3%81%84%E3%81%A8-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHot変換しないと…\u003c/h4\u003e\n\n\u003cp\u003eHot変換しないと、「2.5秒遅れの購読者」に対しては新しく0から値が発行されていることがわかります。つまり、それぞれObservableシーケンスが別個に生成されているということになります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/0f07400a2648f4416dafc953c951f027a33c6b97/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f39326363396237322d383832352d343963642d323562342d6162636466333835326435332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F92cc9b72-8825-49cd-25b4-abcdf3852d53.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=774dd19a0541c13c4d4067b39b1ef418\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/92cc9b72-8825-49cd-25b4-abcdf3852d53.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F92cc9b72-8825-49cd-25b4-abcdf3852d53.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d908d70d23202d31f0b3b63e98f4564f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"なぜconnectが必要なのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AA%E3%81%9Cconnect%E3%81%8C%E5%BF%85%E8%A6%81%E3%81%AA%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eなぜ\u003ccode\u003eConnect\u003c/code\u003eが必要なのか\u003c/h2\u003e\n\n\u003cp\u003eところで、上記の2例ではどちらも\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eCold Observableを\u003ccode\u003ePublish\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e出てきた\u003ccode\u003eIConnectableObservable\u0026lt;T\u0026gt;\u003c/code\u003eを\u003ccode\u003eConnect\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eIConnectableObservable\u0026lt;T\u0026gt;\u003c/code\u003eを好きなだけ\u003ccode\u003eSubscribe\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eの順に操作しています。\u003cbr\u003e\nであれば、\u003cstrong\u003e\u003ccode\u003eConnect\u003c/code\u003eの存在意義とは一体何なのか？\u003c/strong\u003e\u003ccode\u003ePublish\u003c/code\u003eして\u003ccode\u003eConnect\u003c/code\u003eするのなら、\u003ccode\u003ePublish\u003c/code\u003e内で自動的にやっておいてくれれば良いのではないか？と思うかもしれません。\u003cbr\u003e\nところが、\u003ccode\u003eConnect\u003c/code\u003eを呼び出すタイミングには重要な意味があって、場合によっては\u003cstrong\u003e\u003ccode\u003eConnect\u003c/code\u003eの呼び出すタイミングによって実行結果がまったく変わってくる\u003c/strong\u003eことがあります。\u003c/p\u003e\n\n\u003cp\u003e例えば、以下のような例では、\u003ccode\u003eConnect\u003c/code\u003eを呼び出すタイミングが非常に重要になります。\u003cbr\u003e\n①〜④のうち、どこで\u003ccode\u003eConnect()\u003c/code\u003eを呼び出すべきでしょうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//1~10までの値を発行するColdなObservableソース\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobservableRange\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eIConnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eobservableRange\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePublish\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//①ここでConnect()?\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"1個めのSubscribe：\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//②ここでConnect()?\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"2個めのSubscribe：\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//③ここでConnect()?\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"3個めのSubscribe：\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//④ここでConnect()?\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e↓\u003cbr\u003e\n↓\u003cbr\u003e\n↓\u003cbr\u003e\n↓\u003c/p\u003e\n\n\u003cp\u003e答えは、3つの\u003ccode\u003eSubscribe\u003c/code\u003eにすべて値を通知させるためには、\u003cstrong\u003e④の位置\u003c/strong\u003eで\u003ccode\u003eConnect()\u003c/code\u003eを呼び出す必要があります。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eConnect()\u003c/code\u003eの効果は「\u003cstrong\u003e\u003ccode\u003ePublish\u003c/code\u003e内の\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eに、変換元のColdなIObservableを\u003ccode\u003eSubscribe\u003c/code\u003eさせる\u003c/strong\u003e」でした。\u003cbr\u003e\nこの場合、「変換元のColdな\u003ccode\u003eIObservable\u003c/code\u003e」とは\u003ccode\u003eObservable.Range\u003c/code\u003eですので、\u003cstrong\u003e\u003ccode\u003eSubscribe\u003c/code\u003eした瞬間に1~10までの値が即座に流れてきてしまいます\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003eしたがって、例えば①の位置で\u003ccode\u003eConnect()\u003c/code\u003eを呼び出すと、\u003cstrong\u003e誰も\u003ccode\u003eSubject\u003c/code\u003eを\u003ccode\u003eSubscribe\u003c/code\u003eしないまま1~10の値が流れてきてすぐに\u003ccode\u003eOnCompleted\u003c/code\u003eする\u003c/strong\u003eので、結果として\u003cstrong\u003e\u003ccode\u003eObservable.Range\u003c/code\u003eが発行した値は虚無に消えます\u003c/strong\u003e。\u003cbr\u003e\n\u003ccode\u003eOnCompleted\u003c/code\u003eしたあとに3回\u003ccode\u003eSubscribe\u003c/code\u003eしていますが、もはやなんの値も流れてこないので、値がまったく通知されてこないことになってしまいます。\u003c/p\u003e\n\n\u003cp\u003e②や③で\u003ccode\u003eConnect()\u003c/code\u003eした場合は、\u003ccode\u003eConnect()\u003c/code\u003e以前に\u003ccode\u003eSubscribe\u003c/code\u003eしていた購読先には値が届きますが、\u003ccode\u003eConnect()\u003c/code\u003e以降に\u003ccode\u003eSubscribe\u003c/code\u003eした購読先には値は届きません。\u003c/p\u003e\n\n\u003cp\u003e④で\u003ccode\u003eConnect()\u003c/code\u003eすれば、きちんとすべての購読先が\u003ccode\u003eSubscribe\u003c/code\u003eを完了させ、準備万端な状態で\u003ccode\u003eObservable.Range\u003c/code\u003eを\u003ccode\u003eSubscribe\u003c/code\u003eするので、すべての購読先に対して\u003ccode\u003eObservable.Range\u003c/code\u003eの発行値をマルチキャストすることができます。\u003c/p\u003e\n\n\u003cp\u003eこのように、ファクトリメソッドなどのColdなObservableソースをHot変換する場合は、\u003ccode\u003eConnect()\u003c/code\u003eを呼ぶタイミングが非常に重要になることが分かります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"connectのタイミングに左右されない場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#connect%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%AB%E5%B7%A6%E5%8F%B3%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eConnect\u003c/code\u003eのタイミングに左右されない場合\u003c/h3\u003e\n\n\u003cp\u003e対して、\u003ccode\u003eConnect()\u003c/code\u003eを呼ぶタイミングが重要ではない場合もあります。それは、\u003cstrong\u003eObservableソースがHot\u003c/strong\u003eである場合です。\u003cbr\u003e\nObservableソースがHotとは、\u003cstrong\u003e\u003ccode\u003eSubject\u003c/code\u003eから値が生成されている場合\u003c/strong\u003eを指します。\u003c/p\u003e\n\n\u003cp\u003e先ほどの例の\u003ccode\u003eObservable.Range\u003c/code\u003eファクトリメソッドの場合は、\u003cstrong\u003e\u003ccode\u003eSubscribe\u003c/code\u003eしたタイミングで、値が生成されて発行されていく\u003c/strong\u003eのでした。つまり、「\u003cstrong\u003e購読側で値の発行タイミングを制御できている\u003c/strong\u003e」と言えます。\u003cbr\u003e\nこれに対して\u003ccode\u003eSubject\u003c/code\u003eから値が生成されているということは、値の発行タイミングが\u003ccode\u003eOnNext\u003c/code\u003eが呼ばれるタイミングに委ねられることになります。つまり、「\u003cstrong\u003e購読側では値が発行されるタイミングを制御することができない\u003c/strong\u003e」、と言えます。\u003c/p\u003e\n\n\u003cp\u003e値の発行タイミングが制御できるのであれば、値の発行開始を示す\u003ccode\u003eConnect()\u003c/code\u003e呼び出しのタイミングは前述の通り非常に重要になりますが、\u003ccode\u003eSubject\u003c/code\u003eのように\u003cstrong\u003e値の発行タイミングが制御できないのであれば、もはや\u003ccode\u003eConnect()\u003c/code\u003eの呼び出すタイミングはいつでも良い\u003c/strong\u003eです。いつ\u003ccode\u003eSubscribe\u003c/code\u003eしようが、値が流れてくるタイミングはこちらでは制御できないためです。\u003c/p\u003e\n\n\u003cp\u003e例えば、次のような例で考えてみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSubjectProvider\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eSubject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esubject\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSubject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//中略\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//Subjectに対して何らかのタイミングでOnNextにより値を発行している\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//SubjectをIObservableとして公開している\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSubjectSubscriber\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eSubjectProvider\u003c/span\u003e \u003cspan class=\"n\"\u003esubjectProvider\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSubjectProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSubjectSubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//外部が公開しているSubjectに対してオペレータをつけてHot変換\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eIConnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esubjectProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eObservable\u003c/span\u003e\n                           \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                           \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromSeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                           \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePublish\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//どこでConnectしよう？\u003c/span\u003e\n        \u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//どこでConnectしよう？\u003c/span\u003e\n        \u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//どこでConnectしよう？\u003c/span\u003e\n        \u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//どこでConnectしよう？\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eSubjectSubscriber\u003c/code\u003eは、外部が公開している\u003ccode\u003eSubject\u003c/code\u003eを取得してHot変換をかけています。どこで\u003ccode\u003eConnect\u003c/code\u003eしようか迷っているようですが、この場合はどこで\u003ccode\u003eConnect\u003c/code\u003eしても結果は変わりません。\u003cbr\u003e\nObservableソースが\u003ccode\u003eSubject\u003c/code\u003eの場合、いつ\u003ccode\u003eSubscribe\u003c/code\u003eしようが単一のObservableシーケンスを\u003ccode\u003eSubscribe\u003c/code\u003eすることになるので、\u003ccode\u003eSubscribe\u003c/code\u003eのタイミングによって結果が左右されることがないのです。\u003c/p\u003e\n\n\u003cp\u003eただ、もちろん\u003ccode\u003eSubscribe\u003c/code\u003eのタイミングが大幅に遅れると、それまで発行された値は通知されなくなるので、例えば以下のようにするのは問題です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIConnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esubjectProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eObservable\u003c/span\u003e\n                   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromSeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePublish\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//10秒経ってからソースSubjectをSubscribe\u003c/span\u003e\n\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e10000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのようにすると、\u003ccode\u003econnectableObservable\u003c/code\u003eを\u003ccode\u003eSubscribe\u003c/code\u003eしてから10秒間に発行された値は購読先にマルチキャストされなくなってしまうため、このような極端な例はNGとなります。\u003c/p\u003e\n\n\u003cp\u003e逆に、早く\u003ccode\u003eConnect\u003c/code\u003eする分にはまったく問題がありませんので、ObservableソースがHotであると分かっている場合は、\u003ccode\u003eIConnectableObservable\u0026lt;T\u0026gt;\u003c/code\u003eを即\u003ccode\u003eConnect\u003c/code\u003eしてしまっても問題ないでしょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"connectの戻り値のidisposableとは何なのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#connect%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%81%AEidisposable%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%AA%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eConnect\u003c/code\u003eの戻り値の\u003ccode\u003eIDisposable\u003c/code\u003eとは何なのか\u003c/h2\u003e\n\n\u003cp\u003eところで、\u003ccode\u003eConnect()\u003c/code\u003eの戻り値は\u003ccode\u003eIDisposable\u003c/code\u003eとなっています。果たしてこの\u003ccode\u003eIDisposable\u003c/code\u003eは、\u003ccode\u003eSubscribe\u003c/code\u003eの戻り値の\u003ccode\u003eIDisposable\u003c/code\u003eと何が違うのでしょうか？前に掲載した図をもう一度見てみると、違いはすぐに分かると思います。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ad860cdeb47fb05f40b3b3ab8b7b8f88ce9d513c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f34383836626235622d656134642d326164382d306466612d3261666561653166643833342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4886bb5b-ea4d-2ad8-0dfa-2afeae1fd834.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=45e676540d5dd98ce2baa6616c963025\" alt=\"ConnectableObservable.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/4886bb5b-ea4d-2ad8-0dfa-2afeae1fd834.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F4886bb5b-ea4d-2ad8-0dfa-2afeae1fd834.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b89279b102ffb3ce47bdd71a0dca8a50 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこの図を見ると、\u003cstrong\u003e\u003ccode\u003eConnect\u003c/code\u003eも\u003ccode\u003eSubscribe\u003c/code\u003eもどちらもやっていることは「\u003ccode\u003eSubscribe\u003c/code\u003e」\u003c/strong\u003eですね。\u003c/p\u003e\n\n\u003cp\u003eしたがって、\u003ccode\u003eConnect\u003c/code\u003eの戻り値の\u003ccode\u003eIDisposable\u003c/code\u003eとは、\u003cstrong\u003e\u003ccode\u003eSubject\u003c/code\u003eが変換元の\u003ccode\u003eIObservable\u003c/code\u003eを\u003ccode\u003eSubscribe\u003c/code\u003eしたときに出てきた\u003ccode\u003eIDisposable\u003c/code\u003eのことである\u003c/strong\u003eということがわかります。\u003cbr\u003e\n\u003ccode\u003eIConnectableObservable\u003c/code\u003eの\u003ccode\u003eSubscribe\u003c/code\u003eの戻り値の\u003ccode\u003eIDisposable\u003c/code\u003eを\u003ccode\u003eDispose\u003c/code\u003eすると、\u003ccode\u003eSubject\u003c/code\u003eへの購読が\u003ccode\u003eDispose\u003c/code\u003eされるのと同様に、\u003cstrong\u003e\u003ccode\u003eConnect\u003c/code\u003eの戻り値の\u003ccode\u003eIDisposable\u003c/code\u003eを\u003ccode\u003eDispose\u003c/code\u003eすると、ソースとなるColdな\u003ccode\u003eIObservable\u003c/code\u003eへの購読が\u003ccode\u003eDispose\u003c/code\u003eされる\u003c/strong\u003eということになります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"connectまたはsubscribeをdisposeしたときの挙動の違い\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#connect%E3%81%BE%E3%81%9F%E3%81%AFsubscribe%E3%82%92dispose%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AE%E6%8C%99%E5%8B%95%E3%81%AE%E9%81%95%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eConnect\u003c/code\u003eまたは\u003ccode\u003eSubscribe\u003c/code\u003eを\u003ccode\u003eDispose\u003c/code\u003eしたときの挙動の違い\u003c/h3\u003e\n\n\u003cp\u003eではどちらを\u003ccode\u003eDispose\u003c/code\u003eすべきなのか。\u003c/p\u003e\n\n\u003cp\u003eまず前提として、\u003cstrong\u003eただ単に\u003ccode\u003eDispose\u003c/code\u003eしたいだけ、購読を解除したいだけならば、どちらを\u003ccode\u003eDispose\u003c/code\u003eしても挙動は変わりません。\u003c/strong\u003e\u003cbr\u003e\n\u003ccode\u003eSubscribe\u003c/code\u003eのほうを\u003ccode\u003eDispose\u003c/code\u003eすれば\u003ccode\u003eSubject\u003c/code\u003e自体への購読が直接解除されるし、\u003ccode\u003eConnect\u003c/code\u003eのほうを\u003ccode\u003eDispose\u003c/code\u003eすれば、\u003ccode\u003eSubject\u003c/code\u003eに入ってくるソースからの通知が遮断されるので、結果的に通知が来なくなります。\u003c/p\u003e\n\n\u003cp\u003e挙動が変わってくるのは、\u003cstrong\u003e\u003ccode\u003eConnect\u003c/code\u003eを\u003ccode\u003eDispose\u003c/code\u003eしたあとに、再び\u003ccode\u003eConnect\u003c/code\u003e（再接続）\u003c/strong\u003eするような場合です。そして、これに関しても、\u003cstrong\u003eソースとなるColdな\u003ccode\u003eIObservable\u003c/code\u003eのObservableソースがColdなのかHotなのかで挙動が随分変わってきます\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003eもし、\u003cstrong\u003eObservableソースがHot\u003c/strong\u003e、つまり\u003ccode\u003eSubject\u003c/code\u003eから値が生成されているならば、何度「切断/再接続」を行ったとしても、ただ単に接続されている場合は値が飛んでくる、切断した場合は値が飛んでこない、それだけの違いになります。\u003cbr\u003e\nしかし、\u003cstrong\u003eObservableソースがCold\u003c/strong\u003e、つまりファクトリメソッドなどから値が生成されている場合は、\u003cstrong\u003e「切断/再接続」をするたびに、新しいObservableソースが生成される\u003c/strong\u003eことになります。\u003c/p\u003e\n\n\u003cp\u003e例えば、以下の例を見てください。\u003cbr\u003e\n\u003ccode\u003eObservable.Interval\u003c/code\u003eを\u003ccode\u003ePublish\u003c/code\u003eして\u003ccode\u003eConnect\u003c/code\u003eしたあと、3秒後に切断/再接続を行う例です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobservableInterval\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInterval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromSeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eIConnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eobservableInterval\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePublish\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"1個めのSubscribe：\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"2個めのSubscribe：\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//Observale.Intervalに接続する\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e \u003cspan class=\"n\"\u003econnection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//3秒経ったら切断して再接続する\u003c/span\u003e\n\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e3000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"3秒経ったので切断/再接続\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e実行結果は次のようになります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/8d2dd154c174de85fe684d75b7f19b28bc7437cb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f66313836323839392d333031322d326636302d306439312d3161366663326663356664322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Ff1862899-3012-2f60-0d91-1a6fc2fc5fd2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d31a07dee09a744d841f00d9673d74bf\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/f1862899-3012-2f60-0d91-1a6fc2fc5fd2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Ff1862899-3012-2f60-0d91-1a6fc2fc5fd2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=22948528ade4b3e58668581556452eac 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e3秒経って「切断」を行うと、それまでのObservableシーケンスは破棄されます。そして、\u003cstrong\u003e「再接続」を行うと、また新しいObservableシーケンスが生成される\u003c/strong\u003eため、インクリメントが0に戻っていることがわかります。\u003c/p\u003e\n\n\u003cp\u003e次の例のように、Observableソース自体をHot化しておけば、「切断/再接続」を行ってもObservableシーケンスは破棄されず、再接続しても途中から始まります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"n\"\u003eIConnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003econnectableInterval\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInterval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromSeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePublish\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableInterval\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e//Observable.Interval自体をHot化（ObservableソースがHot化する）\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eIConnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"n\"\u003econnectableInterval\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePublish\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"1個めのSubscribe：\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"2個めのSubscribe：\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//Observale.IntervalをHot化したものに接続する\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e \u003cspan class=\"n\"\u003econnection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//3秒経ったら切断して再接続する\u003c/span\u003e\n\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e3000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"3秒経ったので切断/再接続\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/4ff0f70efd42feba076b595f24f703ec7684f4f2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f34383766363335372d356164342d646466342d306639652d6530326438373965353761312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F487f6357-5ad4-ddf4-0f9e-e02d879e57a1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f16e9bdf5dd1d526c42d24199d354f5b\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/487f6357-5ad4-ddf4-0f9e-e02d879e57a1.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F487f6357-5ad4-ddf4-0f9e-e02d879e57a1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6a2d69f99d4f40e7f8b176590735b22a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"挙動まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8C%99%E5%8B%95%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e挙動まとめ\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eConnect\u003c/code\u003eの\u003ccode\u003eIDisposable\u003c/code\u003eと\u003ccode\u003eSubscribe\u003c/code\u003eの\u003ccode\u003eIDisposable\u003c/code\u003e、それぞれの挙動をまとめると次のようになります。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eObsevableソース\u003c/th\u003e\n\u003cth\u003e\n\u003ccode\u003eConnect\u003c/code\u003eを\u003ccode\u003eDispose\u003c/code\u003e\n\u003c/th\u003e\n\u003cth\u003e\n\u003ccode\u003eSubscribe\u003c/code\u003eを\u003ccode\u003eDispose\u003c/code\u003e\n\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eHot\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e通知が来なくなる\u003cbr\u003e\u003cstrong\u003e再接続すると、そのタイミングからまた通知が再開される\u003c/strong\u003e\n\u003c/td\u003e\n\u003ctd\u003e通知が来なくなる\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eCold\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e通知が来なくなる\u003cbr\u003e\u003cstrong\u003e再接続すると、新しいObservableシーケンスが生成されるので最初から値が発行される\u003c/strong\u003e\n\u003c/td\u003e\n\u003ctd\u003e通知が来なくなる\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003e長くなってしまいましたがまとめると次のようになります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eHot変換とは、Observableシーケンスを\u003ccode\u003eSubject\u003c/code\u003eが代表して購読し、そこから再配信することである\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ePublish\u003c/code\u003eオペレータはHot変換の準備をしているだけ。\u003ccode\u003ePublish\u003c/code\u003eをつけただけでは、Observableシーケンスになんの影響も与えない\u003c/li\u003e\n\u003cli\u003eObservableソースがHotかColdかによって\u003ccode\u003eConnect\u003c/code\u003eすべきタイミングが異なる\u003c/li\u003e\n\u003cli\u003e切断/再接続時の挙動もObservableソースのHotColdによって異なるので注意\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e自分の中で\u003ccode\u003ePublish\u003c/code\u003eの理解が曖昧だったので記事にまとめましたがだいぶしっかりした知識になった気がします。\u003cbr\u003e\nあと基本、外部に\u003ccode\u003eIObservable\u003c/code\u003eを公開するときはHot変換して公開したほうが良さそうな気がします。外部からはこの\u003ccode\u003eIObservable\u003c/code\u003eがHotかColdか、はたまたObservableソースがColdなのかHotなのかなんてわかりませんから。外部に公開するときはHot、これを徹底しておけばハマる確率がかなり減らせるのではないかと思いました。もちろん意図的にColdで公開したい！って場合は、わかるようにしておけばそれはそれで良いと思いますけどね。\u003c/p\u003e\n\n\u003cp\u003eでは、最後までありがとうございました！\u003cbr\u003e\nご意見ご指摘等ありましたらコメントお願いします！\u003c/p\u003e\n","createdAt":"2021-04-01T17:46:34Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"NXMRiLy3weM33thLKFU7RAnwYCisaM2qkQ==--4E+odinxqAUzBIC8--ktrElvF4DrU/oFZQg+m7JQ==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":false,"lastModifiedAt":"2021-04-01T17:46:34Z","likesCount":7,"linkUrl":"https://qiita.com/yutorisan/items/68bd68bbffe3c4f3ba32","organization":null,"originalId":1415345,"stockedCount":6,"title":"【UniRx】Cold→Hot変換の代表、「Publishオペレータ」を完全に理解する","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%89%8D%E6%8F%90%E7%9F%A5%E8%AD%98hot%E3%81%A8cold\"\u003e[前提知識]HotとCold\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1subjectt%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E7%89%B9%E5%BE%B4%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e1.Subject\u0026lt;T\u0026gt;クラスの特徴について\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2hot%E3%81%AAiobservable%E3%81%A8cold%E3%81%AAiobservable%E3%81%AE%E9%81%95%E3%81%84%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e2.HotなIObservableとColdなIObservableの違いについて\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3observable%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e3.Observableソースについて\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cli\u003e\n\u003ca href=\"#coldhot%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B%E3%81%AB%E3%81%AF%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%AE%E3%81%8B\"\u003eCold→Hot変換するにはどうすればよいのか\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1subjectt%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E7%94%A8%E6%84%8F%E3%81%97%E3%81%BE%E3%81%99\"\u003e1.Subject\u0026lt;T\u0026gt;クラスを用意します。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-subjectt%E3%81%AFhot%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%9F%E3%81%84cold%E3%81%AAiobservablet%E3%82%92%E4%BB%A3%E8%A1%A8%E3%81%97%E3%81%A61%E5%9B%9E%E3%81%A0%E3%81%91subscribe%E3%81%97%E3%81%BE%E3%81%99\"\u003e2. Subject\u0026lt;T\u0026gt;は、Hot変換したいColdなIObservable\u0026lt;T\u0026gt;を代表して1回だけSubscribeします。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3-subscribe%E3%81%99%E3%82%8B%E3%81%A8subjectt%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6cold%E3%81%AAiobservablet%E3%81%8B%E3%82%89%E9%80%9A%E7%9F%A5%E3%81%8C%E6%B5%81%E3%82%8C%E3%81%A6%E3%81%8D%E3%81%BE%E3%81%99\"\u003e3. Subscribeすると、Subject\u0026lt;T\u0026gt;に対してColdなIObservable\u0026lt;T\u0026gt;から通知が流れてきます。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4-subjectt%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AEiobservablet%E3%82%92%E5%A4%96%E9%83%A8%E3%81%AB%E5%85%AC%E9%96%8B%E3%81%97%E3%81%BE%E3%81%99\"\u003e4. Subject\u0026lt;T\u0026gt;クラスのIObservable\u0026lt;T\u0026gt;を外部に公開します。\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#publish%E3%81%99%E3%82%8B%E3%81%A8%E4%BD%95%E3%81%8C%E8%B5%B7%E3%81%93%E3%82%8B\"\u003ePublishすると何が起こる\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#publish%E3%81%AF%E6%BA%96%E5%82%99%E3%81%99%E3%82%8B%E3%81%A0%E3%81%91\"\u003ePublishは「準備」するだけ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%BA%96%E5%82%99%E3%81%97%E3%81%9F%E3%82%82%E3%81%AE%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E6%93%8D%E4%BD%9C%E3%81%AF%E6%AC%A1%E3%81%AE%E5%B7%A5%E7%A8%8B%E3%81%AB%E5%A7%94%E8%A8%97%E3%81%99%E3%82%8B\"\u003e準備したものに対する「操作」は次の工程に委託する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#iconnectableobservablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9\"\u003eIConnectableObservable\u0026lt;T\u0026gt;インターフェイス\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#iconnectableobservablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9-1\"\u003eIConnectableObservable\u0026lt;T\u0026gt;インターフェイス\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#iconnectableobservablet%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9\"\u003eIConnectableObservable\u0026lt;T\u0026gt;の使い方\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BE%8B%EF%BC%91%E3%81%84%E3%81%8F%E3%81%A4%E3%81%8B%E3%81%AE%E3%82%AA%E3%83%9A%E3%83%AC%E3%83%BC%E3%82%BF%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%9Fiobservable%E3%82%92hot%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%A6%E4%BD%BF%E3%81%84%E5%9B%9E%E3%81%97%E3%81%9F%E3%81%84\"\u003e例１：いくつかのオペレータを追加したIObservableをHot変換して使い回したい\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B5%90%E6%9E%9C\"\u003e結果\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#hot%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%AA%E3%81%84%E3%81%A8\"\u003eHot変換しないと…\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BE%8B%EF%BC%92%E3%83%95%E3%82%A1%E3%82%AF%E3%83%88%E3%83%AA%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%8B%E3%82%89%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%81%9Fobservable%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9%E3%82%92%E4%BD%BF%E3%81%84%E5%9B%9E%E3%81%97%E3%81%9F%E3%81%84\"\u003e例２：ファクトリメソッドから生成されたObservableシーケンスを使い回したい\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B5%90%E6%9E%9C-1\"\u003e結果\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#hot%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%AA%E3%81%84%E3%81%A8-1\"\u003eHot変換しないと…\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AA%E3%81%9Cconnect%E3%81%8C%E5%BF%85%E8%A6%81%E3%81%AA%E3%81%AE%E3%81%8B\"\u003eなぜConnectが必要なのか\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#connect%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%AB%E5%B7%A6%E5%8F%B3%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88\"\u003eConnectのタイミングに左右されない場合\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#connect%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%81%AEidisposable%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%AA%E3%81%AE%E3%81%8B\"\u003eConnectの戻り値のIDisposableとは何なのか\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#connect%E3%81%BE%E3%81%9F%E3%81%AFsubscribe%E3%82%92dispose%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AE%E6%8C%99%E5%8B%95%E3%81%AE%E9%81%95%E3%81%84\"\u003eConnectまたはSubscribeをDisposeしたときの挙動の違い\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%8C%99%E5%8B%95%E3%81%BE%E3%81%A8%E3%82%81\"\u003e挙動まとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\n","totalPv":2029,"uuid":"68bd68bbffe3c4f3ba32","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"KkGSRbI7cjaMXKOhUk+Hf071+zMQ--VpokBxHi0vfHPMZq--W++3J1ImjO8r4TYL9VrT8w==","originalId":697830,"description":"C#が好きです","facebookUrl":null,"githubUrl":"https://github.com/yutorisan","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://pbs.twimg.com/profile_images/1274400166120812544/DAWcpHec_bigger.jpg","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F1274400166120812544%2FDAWcpHec_bigger.jpg?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=b517115d0e848c54aa4fe1fc93bfa0ff","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F1274400166120812544%2FDAWcpHec_bigger.jpg?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=754be610f489085be0fdfc48de5585a9","urlName":"yutorisan","websiteUrl":"","twitterUrl":"https://twitter.com/yutorisan19","twitterUrlName":"yutorisan19","revealedOrganizations":{"edges":[{"node":{"encryptedId":"hU+IwuJpQAidZ66nI1DUIZQZex5+b5m0f38=--XEpGv7KT+5+O2qvw--QFNXOZcvxYDGH1DNfQD+Uw==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"Unityゲーム開発者ギルド","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","urlName":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。","url":"https://unity-game-dev-guild.github.io/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Unity","urlName":"unity"},{"name":"ReactiveExtensions","urlName":"reactiveextensions"},{"name":"UniRx","urlName":"unirx"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

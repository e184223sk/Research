More than 3 years have passed since last update.この記事はTerrariaでのMod開発でのイメージデータの操作について、pngやgifでの出力や、加工して出力する方法について説明します。
なお、TerrariaはXNAを利用しているようですが、これまでxnaには触れた事すらないので、手探りで行ったものなので、無駄な事や間違いがあるかもしれませんので、ご注意ください。
とにかくやってみたらできたというレベルです。GIFについてはGIFアニメーションを出力するため、NGifというオープンソースを利用しています。
CodeProjectに登録されていますので、利用にはサインインが必要です。アイテムのイメージデータはxnaのTexture2Dで管理されています。
次のように定義されています。Texture2Dにはpngファイルで保存するメソッドがあるため、pngで保存するなら、次のようにするだけです。itemType はint型の任意の値です。
TerrariaではアイテムにIDが振られていますが、このIDはItemクラスでtypeというプロパティです。
たとえば、typeが1のアイテムは"Iron Pickaxe"です。
個人的にはややこしい名称です。
次のように定義されています。普通に System.Drawing.Image と System.Drawing.Graphics を使う方法です。
ゲーム内だけで操作するならXNAの作法に合せればいいのでしょうが、この辺が詳しくないです。っといった感じです。
実際には、共通的な部分はメソッドにしていたり、背景に合成する際は、中心に配置されるようにポジションなどの調整を行いますが、その辺はよくあるコードなので、とりあえずここでは省略しました。Terrariaでは、NPCのイメージは Main.npcTexture 配列にあります。
ただし、アイテムの時と違って、 Main.instance.LoadNPC(int i)を呼び出す必要があるみたいです。Main.npcTexture[npcType] で得られるイメージのフレーム分割数は Main.npcFrameCount[npcType] で得られます。
通常は縦に並んでいますが、一部は縦横にならんでいますので、これではうまくいきませんが、現在その場合のフレームの取得方法をわかっていません。
現時点では、対象となるNPCは 4/579 です。おそらく1.3.4で追加された、Old One's Armyの一部の敵のみのようです。透過についてはこのコードには記載しませんでした。
今現在実際にやっている方法は、一旦特定の色で塗りつぶして、透過色の指定をするような形をとっています。もう少しちゃんとした方法がわかったら修正したいと思います。まったくもって、綺麗な内容ではないですが、とりあえずまとめるだけまとめておこうと思って記載した次第です。
今後知識が深まった際や、余力ができたら、コードを整理して、実際にTerrariaでMod開発をしてみようという人が参考に出来るような内容にしたいと考えています。以上



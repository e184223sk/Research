More than 1 year has passed since last update.UnityでポケモンGOのような位置ゲーを作るために必要な要素をまとめて、
なにができるのか、実装しながら確認していきます。ここでは開発はUnityで行い、Android/iOSで動くものを想定します。
※ただしiOSの開発環境がないので、Androidのみで検証していきます端末の現在位置を取得する機能です。
端末のGPSから情報を拾えれば可能なのではないかと思います。以下にまとめがあるのでこれは問題なさそう。
[Unity] Android/iOSで位置情報を取得する地図がない位置ゲー、というのも考えられますが、とりあえず普通は地図を何らかの形で使うでしょう。
地図は1から作るわけにはいかないので、何らかのAPI的なサービスを使用する必要があるでしょう。緯度経度から住所を検索する機能。
必須ではありませんが、国取りゲーのように住所を絡めるなら必要です。
住所から緯度経度であれば、住所と緯度経度を紐づけたDBがあれば取得できますが、
逆はそうはいきません。たとえば、ある緯度経度が「何県何市にあたるのか」を検索するためには、
市の形状に点が含まれるか、というGIS的演算が必要になります。
つまり、「ある面にある点が含まれているか」という計算です。GIS的には「ジオメトリ演算」と呼ばれるものです。手始めに、現在地の取得は前述の記事にある通りだと思うので、逆ジオコーディングで市区町村名を
表示するところまでやってみたいと思います。前述のリンクの実装方法ほぼそのままです。今回使用するAPIは以下です。
https://www.finds.jp/rgeocode/index.html.ja
パラメータに経緯度を渡し、住所コードや文字列を取得することができます。
上記を使用するクラスを実装しました。
大字以下も取得できるようですが、とりあえずテストなので市区町村までを取得するようにしています。最後に、取得した経緯度、住所文字列の情報を表示するUI周りの処理を実装します。
GetComponentメソッドで別スクリプトの処理を呼び出しているので、
3つのスクリプトは同じオブジェクトにアタッチする必要があります。
Test Mapというのは地図表示用に作っているものですのでとりあえず無視してください。
Findで名称検索してオブジェクトを検出しているため、「LonLatInfo」という名前にする必要があります。
もちろん、テキスト設定側のスクリプトでテキストコンポーネントを直接アタッチできる形にしてもかまいません。
（というか、そのほうがいいです。このくらいの規模感だと問題になりにくいですが、ヒエラルキーが肥大化した際はFind処理が重くなるので）Androidビルドをして、実機を確認します。
東京都文京区某所に実際に実機を持っていってアプリを起動しました。
今回はAndroid端末でしか試していませんが、位置情報の取得のような実装を端末に異存せずに
シンプルに実装できるのはUnityの強みなのかなと感じました。
逆ジオコーディングもシンプルなAPIが多数提供されているので、こういった開発もやりやすくなっているなぁと。位置情報の取得は位置ゲーの基本ですが、これだけでは味気ないので
位置情報に基づいた地図の表示をやっていきたいと思います。



<!DOCTYPE html><html><head><meta charset="utf-8" /><title>AzureFunctionsでCosmosDBのクエリ検索restサービスと監視 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/tstakano-yj/items/799e18cd209cf5a93ef7" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="ZZC3ea1Eh6aVJTA4qjB3fbOl9HN8THvghtFSEU2l/2lPulk0KSKjoroVH4WinUTUVhe3QmRxAjIYoDcOqOfbvA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="AzureFunctionsでCosmosDBのクエリ検索restサービスと監視 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1RWHAxY21WR2RXNWpkR2x2Ym5QamdhZERiM050YjNORVF1T0JydU9Dci1PQ3FPT0RxdWFrbk9lMG9uSmxjM1RqZ3JYamc3empnNVBqZ3Juamdham5tNlBvcHBZJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTVjNGFhYWY4NzMyYzllNjU1ZjkzNWQ4MjY1YmUxNzdl&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJ6ZEdGcllXNXZMWGxxJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9ZjQzODE5YjAyYjEzYWQzOWE0MWI3MGYwYzYyMzkzZjI&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=04411bae5fa9e12d6d46b5577027f447"><meta property="og:description" content="GYAOのtsです。
我々のチームは、オールパブリッククラウドで、Microservice Architectureを採用した次期バックエンドを設計中です。


経緯

チームが変わったりやなんやらで前回の投稿　から結構時間が空いてし..."><meta content="https://qiita.com/tstakano-yj/items/799e18cd209cf5a93ef7" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Azure,DocumentDB,AzureFunctions,CosmosDB" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-02f474a2-8d32-47ee-9cc2-48670f1d17ca"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Ftstakano-yj%2Fitems%2F799e18cd209cf5a93ef7">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Ftstakano-yj%2Fitems%2F799e18cd209cf5a93ef7">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-02f474a2-8d32-47ee-9cc2-48670f1d17ca">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-06-29T17:10:10.000+09:00","dateModified":"2017-07-14T13:55:26.000+09:00","headline":"AzureFunctionsでCosmosDBのクエリ検索restサービスと監視","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1RWHAxY21WR2RXNWpkR2x2Ym5QamdhZERiM050YjNORVF1T0JydU9Dci1PQ3FPT0RxdWFrbk9lMG9uSmxjM1RqZ3JYamc3empnNVBqZ3Juamdham5tNlBvcHBZJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTVjNGFhYWY4NzMyYzllNjU1ZjkzNWQ4MjY1YmUxNzdl\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJ6ZEdGcllXNXZMWGxxJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9ZjQzODE5YjAyYjEzYWQzOWE0MWI3MGYwYzYyMzkzZjI\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=04411bae5fa9e12d6d46b5577027f447","mainEntityOfPage":"https://qiita.com/tstakano-yj/items/799e18cd209cf5a93ef7","author":{"@type":"Person","address":"Tokyo,Japan","email":"tstakano@gyao.co.jp","identifier":"tstakano-yj","name":"tstakano-yj","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Fprofile-images%2F1486731894?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=30a949e5279d6a03c1dea08df54f43a7","url":"https://qiita.com/tstakano-yj","description":"GYAOのバックエンドエンジニアです。","memberOf":[{"@type":"Organization","address":"東京都港区","legalName":"株式会社GYAO","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/6a39cc1d2e21a3c80cf7c9ca525a00ce082032f5/original.jpg?1457576296","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/c2731aea9334c26b9b1f1c406c8a80089e947c53/original.jpg?1457576296","identifier":"gyao","description":"GYAOは、ヤフーグループのエンターテインメントカンパニーとして、GYAO!サービスを運営しています。"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tstakano-yj","type":"items","id":"799e18cd209cf5a93ef7"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tstakano-yj","type":"items","id":"799e18cd209cf5a93ef7"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tstakano-yj","type":"items","id":"799e18cd209cf5a93ef7"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/tstakano-yj/items/799e18cd209cf5a93ef7","location":"/tstakano-yj/items/799e18cd209cf5a93ef7","scheme":"https","host":"qiita.com","port":null,"pathname":"/tstakano-yj/items/799e18cd209cf5a93ef7","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"FsL0YHc+l+O2hpqG+39DrWJO6XJe0xHceIe4F0tlrqU86Bot81iz55m2tTvz0nAEh/yqQ0buaA7m9t0IrieKcA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-9f24acd9-07ae-4a9d-99ac-b3b4dc1d0e21"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tstakano-yj/items/799e18cd209cf5a93ef7/likers" class="css-1iupg5d">3</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">6</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/799e18cd209cf5a93ef7/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tstakano-yj/items/799e18cd209cf5a93ef7/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tstakano-yj/items/799e18cd209cf5a93ef7/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tstakano-yj/items/799e18cd209cf5a93ef7/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tstakano-yj/items/799e18cd209cf5a93ef7.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/tstakano-yj"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/114329/profile-images/1486731894" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/tstakano-yj" class="css-10ougpm">@<!-- -->tstakano-yj</a><div class="css-1ay9vb9"><span><meta content="2017-06-29T08:10:10Z"/><time dateTime="2017-07-14T04:55:26Z" class="css-m19uds">updated at 2017-07-14</time></span></div></div></div></div></div><h1 class="css-cgzq40">AzureFunctionsでCosmosDBのクエリ検索restサービスと監視</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/azure" class="css-4czcte">Azure</a><a href="/tags/documentdb" class="css-4czcte">DocumentDB</a><a href="/tags/azurefunctions" class="css-4czcte">AzureFunctions</a><a href="/tags/cosmosdb" class="css-4czcte">CosmosDB</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>GYAOのtsです。<br>
我々のチームは、オールパブリッククラウドで、<a href="http://microservices.io/patterns/microservices.html" rel="nofollow noopener" target="_blank">Microservice Architecture</a>を採用した次期バックエンドを設計中です。</p>

<h1>
<span id="経緯" class="fragment"></span><a href="#%E7%B5%8C%E7%B7%AF"><i class="fa fa-link"></i></a>経緯</h1>

<p>チームが変わったりやなんやらで<a href="http://qiita.com/tstakano-yj/items/a575913c1beb5d315737" id="reference-d0982cf8c66efe377151">前回の投稿</a>　から結構時間が空いてしまった。<br>
引き続き我々のチームは戦陣切ってクラウド化を推進していこうと思う。<br>
（なんでもクラウドにすればいいという意味ではなく、自由度を高め、視野を広げ、普通の力をつけようという意味で）</p>

<p>今回はfunctionを軸に構築する。<br>
全ての主要クラウドベンダーから出ているサーバーレスアーキテクチャという代物だが、流行ってますね。<br>
先日Azureの方とお話しましたが、pushされていらっしゃいました。Azureとしても力を入れていく領域なのかなと個人的には感じている。<br>
というのも、使い始めた頃よりだいぶ進化していて、認証やらswaggerドキュメントの生成やら細かい便利そうな機能が追加されていてmicro serviceのIFを作ってくださいと言わんばかりな形になってきているので、我々もそれに乗っかろうかなと。「LogicAppsでもFunctionでも実装できない複雑なビジネスロジックがあった場合のみコンテナでrestを作ってそれをFunctionsやLogicAppsから呼ぶ」みたいなスタンスでいくとシンプルかなと。</p>

<h1>
<span id="作ってみる" class="fragment"></span><a href="#%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>作ってみる</h1>

<h2>
<span id="実現したいこと" class="fragment"></span><a href="#%E5%AE%9F%E7%8F%BE%E3%81%97%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>実現したいこと</h2>

<p>今回はCosmosDBに以下の形で入った複数のドキュメントをクエリ検索するrestサービスを作成する。</p>

<div class="code-frame" data-lang="json">
<div class="code-lang"><span class="bold">riceさんが複数のオブジェクト（コンテンツ）を持っている</span></div>
<div class="highlight"><pre class="with-code"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"contents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A00001"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="mi">1497845466</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"C00001"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="mi">1497845586</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"D00001"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="mi">1497845686</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rice"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"pkey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
</div>

<div class="code-frame" data-lang="json">
<div class="code-lang"><span class="bold">okawariさんが別の複数のオブジェクト（コンテンツ）を持っている</span></div>
<div class="highlight"><pre class="with-code"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"contents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A00001"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="mi">1497661986</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B00001"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="mi">1497663986</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"F00001"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="mi">1497671986</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"okawari"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"pkey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
</div>

<p>上記をidで検索して、「該当のコンテンツを保有しているのは誰か」を検索する。<br>
クエリは下記の通り</p>

<div class="code-frame" data-lang="sql">
<div class="code-lang"><span class="bold"> CosmosDBクエリ</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">SELECT</span> <span class="n">d</span><span class="p">.</span><span class="n">id</span> <span class="k">FROM</span> <span class="n">docs</span> <span class="n">d</span> <span class="k">JOIN</span> <span class="k">c</span> <span class="k">IN</span> <span class="n">d</span><span class="p">.</span><span class="n">contents</span> <span class="k">WHERE</span> <span class="k">c</span><span class="p">.</span><span class="n">id</span> <span class="k">in</span><span class="p">(</span><span class="err">{</span><span class="n">contentsId</span><span class="err">}</span><span class="p">)</span>
</code></pre></div>
</div>

<p>ちなみにクエリの構築は<a href="https://www.documentdb.com/sql/demo" rel="nofollow noopener" target="_blank">こちら</a>を使うと便利です。</p>

<h2>
<span id="azurefunctionsの構築" class="fragment"></span><a href="#azurefunctions%E3%81%AE%E6%A7%8B%E7%AF%89"><i class="fa fa-link"></i></a>AzureFunctionsの構築</h2>

<p>様々実装方法はあると思うが、今回はC#で構築。<br>
まずはリソースの作成。<br>
<a href="https://camo.qiitausercontent.com/f7c49c6cb5533819258c5e9ed9c612460887879c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f32633930383639322d313833622d663137332d376465632d3030333031366536376465332e706e67" target="_blank" rel="nofollow noopener"><img width="327" alt="スクリーンショット 2017-06-29 13.01.57.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F2c908692-183b-f173-7dec-003016e67de3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d54619ec71c03c403b27c82daf6be6ab" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114329/2c908692-183b-f173-7dec-003016e67de3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F2c908692-183b-f173-7dec-003016e67de3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2ee4f9b0f5f2b0a568280555b1a52a89 1x" loading="lazy"></a><br>
気をつけるのは、ApplicationInsightsをonにすること（後々監視でlogを拾えるようにするため）。</p>

<p>次は関数の作成だが、テンプレートでC#のHttp triggerがあると思うので、それを使用する。<br>
関数名は下記のようにしてみた。まずは基本的な挙動の設定をしないといけないので、「統合」画面に行く。<br>
<a href="https://camo.qiitausercontent.com/a5c2b7ec2caa6aff0474bd5b96c16eccb088bfa0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f38373465353937352d323034382d663465382d393330352d6534336539396661343265372e706e67" target="_blank" rel="nofollow noopener"><img width="239" alt="スクリーンショット 2017-06-29 13.42.24.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F874e5975-2048-f4e8-9305-e43e99fa42e7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0d8eabf5c9097b4139c8fd7d54bbce5b" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114329/874e5975-2048-f4e8-9305-e43e99fa42e7.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F874e5975-2048-f4e8-9305-e43e99fa42e7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8cbc214e869971f98695766798fab3ff 1x" loading="lazy"></a></p>

<p>AzureFunctionsはトリガ、入力、出力の基本項目をまず設定する。その基本項目の設定でコードとのバインドを作成し、それが関数の構築画面で使えるという流れ。<br>
入力はトリガ以外の入力があれば設定（今回の場合はCosmosDBから検索結果の入力があるので設定）する。</p>

<p>今回のトリガ、入力、出力は下記の通り。<br>
<a href="https://camo.qiitausercontent.com/f0ba1742636a28f915048ff02eb55ab82f99e94f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f36616364353039632d633237352d386339652d633534302d3838333436616564346365342e706e67" target="_blank" rel="nofollow noopener"><img width="1099" alt="スクリーンショット 2017-06-29 13.41.51.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F6acd509c-c275-8c9e-c540-88346aed4ce4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d3f00671a4d2df852879c72f10f22b4f" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114329/6acd509c-c275-8c9e-c540-88346aed4ce4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F6acd509c-c275-8c9e-c540-88346aed4ce4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2d91d6382649b7fc76bdff4b135ccf07 1x" loading="lazy"></a><br>
各項目を説明していく。</p>

<h3>
<span id="トリガhttp" class="fragment"></span><a href="#%E3%83%88%E3%83%AA%E3%82%AChttp"><i class="fa fa-link"></i></a>トリガ（HTTP）</h3>

<p><a href="https://camo.qiitausercontent.com/d4ca9d115f57c4ea66840eaaef9e528084633df2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f36303632616339392d323236382d643739612d306136352d3834336535356336643863302e706e67" target="_blank" rel="nofollow noopener"><img width="994" alt="スクリーンショット 2017-06-29 14.20.06.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F6062ac99-2268-d79a-0a65-843e55c6d8c0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=38489ef8147a7607c1eff2f973493de2" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114329/6062ac99-2268-d79a-0a65-843e55c6d8c0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F6062ac99-2268-d79a-0a65-843e55c6d8c0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ceeeed55906131b8d45606a5ac58841a 1x" loading="lazy"></a></p>

<p>オフィシャルドキュメントは<a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-bindings-http-webhook" rel="nofollow noopener" target="_blank">こちら</a></p>

<ul>
<li>この関数はGETのみで使用するために、HTTPメソッドはGETに絞っておく。</li>
<li>認証をFunctionレベルでかけたいので、認証レベルはFunction。</li>
<li><strong>要求inputパラメータ名が関数の作成画面で使用する同名のパラメータとバインドされる。</strong></li>
<li>*<em>ルートテンプレートで、先程のcontentsIdのパラメータを指定できる。そうすると、関数の引数で受け取れる。 *</em>
</li>
</ul>

<h3>
<span id="入力azure-documentdb" class="fragment"></span><a href="#%E5%85%A5%E5%8A%9Bazure-documentdb"><i class="fa fa-link"></i></a>入力（Azure DocumentDB）</h3>

<p>CosmosDBに名前が変わったはずだけど、ここはまだみたい。<br>
<a href="https://camo.qiitausercontent.com/ad535176d0173a6e613e885f0da3a20972893fcf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f64396237363966352d396630622d316330662d636431382d3665656464376264363966302e706e67" target="_blank" rel="nofollow noopener"><img width="908" alt="スクリーンショット 2017-06-29 14.46.57.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Fd9b769f5-9f0b-1c0f-cd18-6eedd7bd69f0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=26057830747d7501816648e7a8f3e2c6" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114329/d9b769f5-9f0b-1c0f-cd18-6eedd7bd69f0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Fd9b769f5-9f0b-1c0f-cd18-6eedd7bd69f0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8d304f64588bc1940657e424ed3085b2 1x" loading="lazy"></a><br>
オフィシャルドキュメントは<a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-bindings-documentdb" rel="nofollow noopener" target="_blank">こちら</a></p>

<ul>
<li>ドキュメントパラメータ名が、関数画面の同名変数にバインドされます。</li>
<li>SQLクエリに下記のように記載</li>
</ul>

<div class="code-frame" data-lang="sql">
<div class="code-lang"><span class="bold"> CosmosDBクエリ</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">SELECT</span> <span class="n">d</span><span class="p">.</span><span class="n">id</span> <span class="k">FROM</span> <span class="n">docs</span> <span class="n">d</span> <span class="k">JOIN</span> <span class="k">c</span> <span class="k">IN</span> <span class="n">d</span><span class="p">.</span><span class="n">contents</span> <span class="k">WHERE</span> <span class="k">c</span><span class="p">.</span><span class="n">id</span> <span class="k">in</span><span class="p">(</span><span class="err">{</span><span class="n">contentsId</span><span class="err">}</span><span class="p">)</span>
</code></pre></div>
</div>

<h3>
<span id="出力http" class="fragment"></span><a href="#%E5%87%BA%E5%8A%9Bhttp"><i class="fa fa-link"></i></a>出力（HTTP）</h3>

<p><a href="https://camo.qiitausercontent.com/81b58702b000aeb94be72aa9af86794f87bcfb11/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f61383230313137322d646362362d363761622d663836302d3536333161326365346332392e706e67" target="_blank" rel="nofollow noopener"><img width="362" alt="スクリーンショット 2017-06-29 15.10.09.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Fa8201172-dcb6-67ab-f860-5631a2ce4c29.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=75df60d21863324aa106739897a71ed8" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114329/a8201172-dcb6-67ab-f860-5631a2ce4c29.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Fa8201172-dcb6-67ab-f860-5631a2ce4c29.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3893f8db7d3c9f8f514d0159e7b90407 1x" loading="lazy"></a></p>

<p>関数の戻り値をそのまま使用する。</p>

<p>以上で基本設定は終わり。次に関数の構築画面にいって、ここで定義したバインドを使用して関数を作っていく。<br>
<a href="https://camo.qiitausercontent.com/95f3016f02d38e39ccabe5eb813b57815e3d008b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f66613134636332342d363232362d396534302d396138352d3061356465663261376334372e706e67" target="_blank" rel="nofollow noopener"><img width="242" alt="スクリーンショット 2017-06-29 15.13.46.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Ffa14cc24-6226-9e40-9a85-0a5def2a7c47.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8a5c5d995c081addd10c07fb9f837bb1" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114329/fa14cc24-6226-9e40-9a85-0a5def2a7c47.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Ffa14cc24-6226-9e40-9a85-0a5def2a7c47.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=721df3c3e123e3e501b9421d5262394a 1x" loading="lazy"></a></p>

<p>関数は下記の通り。超簡素。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">lookupByContentsId</span></div>
<div class="highlight"><pre class="with-code"><code><span class="err">#</span><span class="n">r</span> <span class="s">"Newtonsoft.Json"</span>

<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Input</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">contentsId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">static</span> <span class="n">HttpResponseMessage</span> <span class="nf">Run</span><span class="p">(</span><span class="n">Input</span> <span class="n">input</span><span class="p">,</span> <span class="n">HttpRequestMessage</span> <span class="n">req</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">dynamic</span><span class="p">&gt;</span> <span class="n">inputDocument</span><span class="p">,</span> <span class="n">TraceWriter</span> <span class="n">log</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">log</span><span class="p">.</span><span class="nf">Info</span><span class="p">(</span><span class="s">"invoked."</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">inputDocument</span><span class="p">.</span><span class="nf">Count</span><span class="p">()</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">inputDocument</span><span class="p">);</span>
        <span class="n">log</span><span class="p">.</span><span class="nf">Info</span><span class="p">(</span><span class="s">$"Document: </span><span class="p">{</span><span class="n">response</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">req</span><span class="p">.</span><span class="nf">CreateResponse</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">OK</span><span class="p">,</span> <span class="s">$"</span><span class="p">{</span><span class="n">response</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">req</span><span class="p">.</span><span class="nf">CreateResponse</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">NotFound</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>引数をみてみると、先程定義した名前と同名で定義してあると思う。各引数に関して説明をしていく。</p>

<ul>
<li>input

<ul>
<li>トリガのHttpをバインドしたバインド先。通常はHttpRequestMessageオブジェクトにバインドするが、今回は、リクエストの中にcontentsIdが入っていて、それを直にCosmosDBへのクエリのパラメータとして使用するため、こういう形となった。詳細は<a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-bindings-documentdb" rel="nofollow noopener" target="_blank">オフィシャル</a>を参照。</li>
<li>関数の外でInputクラス（POCO）をこさえると、そこにパラメータがバインドされる。CosmosDBを「入力」に使用する場合はこうする模様。Queueのpayloadのjsonをバインドするのがオフィシャルの例に乗っているが、今回はトリガのルートテンプレートで設定したcontentsIdをバインドした。（できた。）</li>
</ul>
</li>
<li>req

<ul>
<li>HttpRequestMessageオブジェクトは上述のように、通常Httpトリガのパラメータバインド先。今回はバインドしないので、コンパイルは通るが、実行時にエラーになる（AzureFunctionsはバインドのないパラメータを引数に取ると実行時エラーとなる）はずだが、ならない。そりゃHttpリクエストだからな。。。特別なんでしょう。ちなみに、レスポンス（HttpResponseMessage）の生成器にもなっているのでないと困る。</li>
</ul>
</li>
<li>inputDocument

<ul>
<li>CosmosDBの検索結果が格納される。つまり、この関数が呼ばれる前に前述のPOCOを使用したCosmosDBの検索が行われている形となる。</li>
<li>今回はクエリを使用して複数ドキュメントを取得するので、typeはIEnumerable&lt;dynamic&gt;</li>
<li>ドキュメントが複数返ってくるのでJson.NETを使用して、jsonオブジェクト（リスト）を取得する。</li>
</ul>
</li>
<li>log

<ul>
<li>Logger。これを使って出力するものを、あとでApplicationInsightsで拾えるように設定します。</li>
</ul>
</li>
</ul>

<h2>
<span id="test" class="fragment"></span><a href="#test"><i class="fa fa-link"></i></a>test</h2>

<p>実行してみる。<br>
<a href="https://camo.qiitausercontent.com/f106b5441ca785a50fc140518102a1e58d133dd5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f37646336326561302d393638632d353264342d323433652d3265396434333638613437352e706e67" target="_blank" rel="nofollow noopener"><img width="381" alt="スクリーンショット 2017-06-29 16.03.52.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F7dc62ea0-968c-52d4-243e-2e9d4368a475.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1ff283d6218aca85695e48ca4dc8e13b" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114329/7dc62ea0-968c-52d4-243e-2e9d4368a475.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F7dc62ea0-968c-52d4-243e-2e9d4368a475.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7d6e94f3ac30a0d031e67e989f0554f9 1x" loading="lazy"></a><br>
おかわりさんが引っかかった。</p>

<h2>
<span id="swaggerドキュメント書いてみる" class="fragment"></span><a href="#swagger%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>Swaggerドキュメント書いてみる</h2>

<p>API Definition（現在はpreview）からGenerate API Definition Templateを押すと、<br>
<a href="https://camo.qiitausercontent.com/d6b403d3929085131286910f4f03b473823df596/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f34333032616339642d646638342d666366652d343861342d6162396465633964653832352e706e67" target="_blank" rel="nofollow noopener"><img width="1051" alt="スクリーンショット 2017-06-29 16.14.15.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F4302ac9d-df84-fcfe-48a4-ab9dec9de825.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=227b671e4fa05c07ef46cc9562d70bc4" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114329/4302ac9d-df84-fcfe-48a4-ab9dec9de825.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F4302ac9d-df84-fcfe-48a4-ab9dec9de825.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=61d4af5eed5c90a47a8a8f0f064a97c1 1x" loading="lazy"></a></p>

<p>contentsIdとかも含め情報を読み取って雛形を作成してくれる。なんて便利。<br>
プロトタイプを作成して、同時にドキュメント作成、ある程度固まったらステークホルダにドキュメント渡す<br>
みたいなスムーズなコミュニケーションがとれる。</p>

<h2>
<span id="logの監視" class="fragment"></span><a href="#log%E3%81%AE%E7%9B%A3%E8%A6%96"><i class="fa fa-link"></i></a>Logの監視</h2>

<p>ApplicationInsightsを使用して、logを一元管理していきたいと思う。<br>
最初にApplicationInsightsをonにしたので、あとは下記を行って、紐付けていく。</p>

<ol>
<li>ApplicationInsightsのプロパティ、のインストルメンテーションキーを取得する。
<a href="https://camo.qiitausercontent.com/6f1103efc85051dfce770a5091c90b1774b888e3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f33386238643436372d353362372d343832352d383336302d6161666335613964643866312e706e67" target="_blank" rel="nofollow noopener"><img width="597" alt="スクリーンショット 2017-06-29 16.53.05.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F38b8d467-53b7-4825-8360-aafc5a9dd8f1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=009c9688d5db9a54334a85158e60f2d0" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114329/38b8d467-53b7-4825-8360-aafc5a9dd8f1.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F38b8d467-53b7-4825-8360-aafc5a9dd8f1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ae88602cbf03c40f5d0649d6c205b5f2 1x" loading="lazy"></a>
</li>
<li>Functionsのアプリケーション設定でAPPINSIGHTS_INSTRUMENTATIONKEYというkeyで上記で取得した鍵を入力する。
<a href="https://camo.qiitausercontent.com/eaf120e03ae5b11f81d64f4f65cd3515437f212c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f37666131366132372d326464312d646632392d323865332d6665366133663333306135392e706e67" target="_blank" rel="nofollow noopener"><img width="496" alt="スクリーンショット 2017-06-29 16.58.23.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F7fa16a27-2dd1-df29-28e3-fe6a3f330a59.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=da9a7eb35a5539a152f001ec349a2b24" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114329/7fa16a27-2dd1-df29-28e3-fe6a3f330a59.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F7fa16a27-2dd1-df29-28e3-fe6a3f330a59.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9b32e8157d552a495ef7f7e1ad615f81 1x" loading="lazy"></a>
<a href="https://camo.qiitausercontent.com/ea98001a62c13422f48156c556ac5b531c748f1b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f66333232383061392d353830372d343266352d353664332d3465323764313462363138392e706e67" target="_blank" rel="nofollow noopener"><img width="556" alt="スクリーンショット 2017-06-29 17.06.00.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Ff32280a9-5807-42f5-56d3-4e27d14b6189.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=efa1a7483b1b7227e5774e41debb6c42" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114329/f32280a9-5807-42f5-56d3-4e27d14b6189.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Ff32280a9-5807-42f5-56d3-4e27d14b6189.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8e0da0749d27759501ce73eff5862bbb 1x" loading="lazy"></a>
</li>
<li>ApplicationInsightsでログの状況を閲覧することができる。
<a href="https://camo.qiitausercontent.com/bb58912ef33d7e0f9bea36706659178f42dd1e3e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f61613739303535322d363664382d376366352d366433642d3836326337313361303862352e706e67" target="_blank" rel="nofollow noopener"><img width="826" alt="スクリーンショット 2017-06-29 17.07.35.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Faa790552-66d8-7cf5-6d3d-862c713a08b5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=733b7847203b3c1a176195e48e704588" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114329/aa790552-66d8-7cf5-6d3d-862c713a08b5.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Faa790552-66d8-7cf5-6d3d-862c713a08b5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=cdd43c687edb5124f1ddaa0a644f8c87 1x" loading="lazy"></a>
</li>
</ol>

<h1>
<span id="所感" class="fragment"></span><a href="#%E6%89%80%E6%84%9F"><i class="fa fa-link"></i></a>所感</h1>

<p>日に日にパワーアップするAzureFunctionsをいじってて普通に楽しい。エンジニアがクリエイティブな部分に集中できるように痒いところに手が届いてきた気がします。ドキュメントが若干読みにくいのと、リソース横断的なusageドキュメントが少ない印象のAzureですが、紐解いていくこと自体も楽しいのでよしとします。</p>

<p>今回の体験を経て、全体的にこんな感じにしようと思いました。チームメンバーの了承を得たらこれで行きます。<br>
<a href="https://camo.qiitausercontent.com/350dac6f95a8f1c127c842af4a1817802ef90ccc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f31633231666666632d643830622d663636662d653564642d6334613833313139343362332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F1c21fffc-d80b-f66f-e5dd-c4a8311943b3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5f95377b1a321c3af8214d735ac8bdf6" alt="zeoliteLatestDiagram (1).png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114329/1c21fffc-d80b-f66f-e5dd-c4a8311943b3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F1c21fffc-d80b-f66f-e5dd-c4a8311943b3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1d5ecc56c6525bc48a44d7c94cb06048 1x" loading="lazy"></a></p>

<h1>
<span id="次回" class="fragment"></span><a href="#%E6%AC%A1%E5%9B%9E"><i class="fa fa-link"></i></a>次回</h1>

<p>Eventhubに関して書いていこうと思います。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Ftstakano-yj%2Fitems%2F799e18cd209cf5a93ef7&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Ftstakano-yj%2Fitems%2F799e18cd209cf5a93ef7&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tstakano-yj/items/799e18cd209cf5a93ef7/likers" class="css-1iupg5d">3</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">6</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/799e18cd209cf5a93ef7/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tstakano-yj/items/799e18cd209cf5a93ef7/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tstakano-yj/items/799e18cd209cf5a93ef7/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tstakano-yj/items/799e18cd209cf5a93ef7/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tstakano-yj/items/799e18cd209cf5a93ef7.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-9f24acd9-07ae-4a9d-99ac-b3b4dc1d0e21">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-f3bf91f0-b352-44ad-98bc-8990617dbce7"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-f3bf91f0-b352-44ad-98bc-8990617dbce7">{}</script>
      
<div id="LoginModal-react-component-29aecd62-fadb-4ab6-ab4b-a066aaeade19"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-29aecd62-fadb-4ab6-ab4b-a066aaeade19">{}</script>
      
<div id="StockModal-react-component-a997fc8a-3eee-4cc9-91bb-2beee0d5859e"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-a997fc8a-3eee-4cc9-91bb-2beee0d5859e">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;MmZGQdBmaPwRPUAAx3CP7+Egy3K7dVnxrkMUHXQi6L8YTKgMVABM+D4Nb73P3bxGBJKIQ6NIICMwMnECkWDMag==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003eGYAOのtsです。\u003cbr\u003e\n我々のチームは、オールパブリッククラウドで、\u003ca href=\"http://microservices.io/patterns/microservices.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMicroservice Architecture\u003c/a\u003eを採用した次期バックエンドを設計中です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"経緯\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%8C%E7%B7%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e経緯\u003c/h1\u003e\n\n\u003cp\u003eチームが変わったりやなんやらで\u003ca href=\"http://qiita.com/tstakano-yj/items/a575913c1beb5d315737\" id=\"reference-d0982cf8c66efe377151\"\u003e前回の投稿\u003c/a\u003e　から結構時間が空いてしまった。\u003cbr\u003e\n引き続き我々のチームは戦陣切ってクラウド化を推進していこうと思う。\u003cbr\u003e\n（なんでもクラウドにすればいいという意味ではなく、自由度を高め、視野を広げ、普通の力をつけようという意味で）\u003c/p\u003e\n\n\u003cp\u003e今回はfunctionを軸に構築する。\u003cbr\u003e\n全ての主要クラウドベンダーから出ているサーバーレスアーキテクチャという代物だが、流行ってますね。\u003cbr\u003e\n先日Azureの方とお話しましたが、pushされていらっしゃいました。Azureとしても力を入れていく領域なのかなと個人的には感じている。\u003cbr\u003e\nというのも、使い始めた頃よりだいぶ進化していて、認証やらswaggerドキュメントの生成やら細かい便利そうな機能が追加されていてmicro serviceのIFを作ってくださいと言わんばかりな形になってきているので、我々もそれに乗っかろうかなと。「LogicAppsでもFunctionでも実装できない複雑なビジネスロジックがあった場合のみコンテナでrestを作ってそれをFunctionsやLogicAppsから呼ぶ」みたいなスタンスでいくとシンプルかなと。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"作ってみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e作ってみる\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"実現したいこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E7%8F%BE%E3%81%97%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実現したいこと\u003c/h2\u003e\n\n\u003cp\u003e今回はCosmosDBに以下の形で入った複数のドキュメントをクエリ検索するrestサービスを作成する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ericeさんが複数のオブジェクト（コンテンツ）を持っている\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"contents\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"A00001\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"time\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1497845466\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"C00001\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"time\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1497845586\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"D00001\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"time\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1497845686\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"rice\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"pkey\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"4\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eokawariさんが別の複数のオブジェクト（コンテンツ）を持っている\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"contents\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"A00001\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"time\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1497661986\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"B00001\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"time\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1497663986\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"F00001\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"time\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1497671986\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"okawari\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"pkey\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"4\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e上記をidで検索して、「該当のコンテンツを保有しているのは誰か」を検索する。\u003cbr\u003e\nクエリは下記の通り\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"sql\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e CosmosDBクエリ\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003edocs\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"k\"\u003eJOIN\u003c/span\u003e \u003cspan class=\"k\"\u003ec\u003c/span\u003e \u003cspan class=\"k\"\u003eIN\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtents\u003c/span\u003e \u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"k\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003econtentsId\u003c/span\u003e\u003cspan class=\"err\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eちなみにクエリの構築は\u003ca href=\"https://www.documentdb.com/sql/demo\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003eを使うと便利です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"azurefunctionsの構築\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#azurefunctions%E3%81%AE%E6%A7%8B%E7%AF%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAzureFunctionsの構築\u003c/h2\u003e\n\n\u003cp\u003e様々実装方法はあると思うが、今回はC#で構築。\u003cbr\u003e\nまずはリソースの作成。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f7c49c6cb5533819258c5e9ed9c612460887879c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f32633930383639322d313833622d663137332d376465632d3030333031366536376465332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"327\" alt=\"スクリーンショット 2017-06-29 13.01.57.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F2c908692-183b-f173-7dec-003016e67de3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d54619ec71c03c403b27c82daf6be6ab\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/114329/2c908692-183b-f173-7dec-003016e67de3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F2c908692-183b-f173-7dec-003016e67de3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2ee4f9b0f5f2b0a568280555b1a52a89 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n気をつけるのは、ApplicationInsightsをonにすること（後々監視でlogを拾えるようにするため）。\u003c/p\u003e\n\n\u003cp\u003e次は関数の作成だが、テンプレートでC#のHttp triggerがあると思うので、それを使用する。\u003cbr\u003e\n関数名は下記のようにしてみた。まずは基本的な挙動の設定をしないといけないので、「統合」画面に行く。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/a5c2b7ec2caa6aff0474bd5b96c16eccb088bfa0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f38373465353937352d323034382d663465382d393330352d6534336539396661343265372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"239\" alt=\"スクリーンショット 2017-06-29 13.42.24.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F874e5975-2048-f4e8-9305-e43e99fa42e7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0d8eabf5c9097b4139c8fd7d54bbce5b\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/114329/874e5975-2048-f4e8-9305-e43e99fa42e7.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F874e5975-2048-f4e8-9305-e43e99fa42e7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8cbc214e869971f98695766798fab3ff 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAzureFunctionsはトリガ、入力、出力の基本項目をまず設定する。その基本項目の設定でコードとのバインドを作成し、それが関数の構築画面で使えるという流れ。\u003cbr\u003e\n入力はトリガ以外の入力があれば設定（今回の場合はCosmosDBから検索結果の入力があるので設定）する。\u003c/p\u003e\n\n\u003cp\u003e今回のトリガ、入力、出力は下記の通り。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f0ba1742636a28f915048ff02eb55ab82f99e94f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f36616364353039632d633237352d386339652d633534302d3838333436616564346365342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"1099\" alt=\"スクリーンショット 2017-06-29 13.41.51.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F6acd509c-c275-8c9e-c540-88346aed4ce4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d3f00671a4d2df852879c72f10f22b4f\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/114329/6acd509c-c275-8c9e-c540-88346aed4ce4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F6acd509c-c275-8c9e-c540-88346aed4ce4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2d91d6382649b7fc76bdff4b135ccf07 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n各項目を説明していく。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"トリガhttp\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%88%E3%83%AA%E3%82%AChttp\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eトリガ（HTTP）\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/d4ca9d115f57c4ea66840eaaef9e528084633df2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f36303632616339392d323236382d643739612d306136352d3834336535356336643863302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"994\" alt=\"スクリーンショット 2017-06-29 14.20.06.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F6062ac99-2268-d79a-0a65-843e55c6d8c0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=38489ef8147a7607c1eff2f973493de2\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/114329/6062ac99-2268-d79a-0a65-843e55c6d8c0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F6062ac99-2268-d79a-0a65-843e55c6d8c0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ceeeed55906131b8d45606a5ac58841a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eオフィシャルドキュメントは\u003ca href=\"https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-bindings-http-webhook\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eこの関数はGETのみで使用するために、HTTPメソッドはGETに絞っておく。\u003c/li\u003e\n\u003cli\u003e認証をFunctionレベルでかけたいので、認証レベルはFunction。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e要求inputパラメータ名が関数の作成画面で使用する同名のパラメータとバインドされる。\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e*\u003cem\u003eルートテンプレートで、先程のcontentsIdのパラメータを指定できる。そうすると、関数の引数で受け取れる。 *\u003c/em\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"入力azure-documentdb\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%A5%E5%8A%9Bazure-documentdb\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e入力（Azure DocumentDB）\u003c/h3\u003e\n\n\u003cp\u003eCosmosDBに名前が変わったはずだけど、ここはまだみたい。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ad535176d0173a6e613e885f0da3a20972893fcf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f64396237363966352d396630622d316330662d636431382d3665656464376264363966302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"908\" alt=\"スクリーンショット 2017-06-29 14.46.57.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Fd9b769f5-9f0b-1c0f-cd18-6eedd7bd69f0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=26057830747d7501816648e7a8f3e2c6\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/114329/d9b769f5-9f0b-1c0f-cd18-6eedd7bd69f0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Fd9b769f5-9f0b-1c0f-cd18-6eedd7bd69f0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8d304f64588bc1940657e424ed3085b2 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nオフィシャルドキュメントは\u003ca href=\"https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-bindings-documentdb\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eドキュメントパラメータ名が、関数画面の同名変数にバインドされます。\u003c/li\u003e\n\u003cli\u003eSQLクエリに下記のように記載\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"sql\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e CosmosDBクエリ\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003edocs\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"k\"\u003eJOIN\u003c/span\u003e \u003cspan class=\"k\"\u003ec\u003c/span\u003e \u003cspan class=\"k\"\u003eIN\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtents\u003c/span\u003e \u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"k\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003econtentsId\u003c/span\u003e\u003cspan class=\"err\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"出力http\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%87%BA%E5%8A%9Bhttp\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e出力（HTTP）\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/81b58702b000aeb94be72aa9af86794f87bcfb11/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f61383230313137322d646362362d363761622d663836302d3536333161326365346332392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"362\" alt=\"スクリーンショット 2017-06-29 15.10.09.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Fa8201172-dcb6-67ab-f860-5631a2ce4c29.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=75df60d21863324aa106739897a71ed8\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/114329/a8201172-dcb6-67ab-f860-5631a2ce4c29.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Fa8201172-dcb6-67ab-f860-5631a2ce4c29.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3893f8db7d3c9f8f514d0159e7b90407 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e関数の戻り値をそのまま使用する。\u003c/p\u003e\n\n\u003cp\u003e以上で基本設定は終わり。次に関数の構築画面にいって、ここで定義したバインドを使用して関数を作っていく。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/95f3016f02d38e39ccabe5eb813b57815e3d008b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f66613134636332342d363232362d396534302d396138352d3061356465663261376334372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"242\" alt=\"スクリーンショット 2017-06-29 15.13.46.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Ffa14cc24-6226-9e40-9a85-0a5def2a7c47.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8a5c5d995c081addd10c07fb9f837bb1\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/114329/fa14cc24-6226-9e40-9a85-0a5def2a7c47.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Ffa14cc24-6226-9e40-9a85-0a5def2a7c47.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=721df3c3e123e3e501b9421d5262394a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e関数は下記の通り。超簡素。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003elookupByContentsId\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Newtonsoft.Json\"\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Net\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eNewtonsoft.Json\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eInput\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003econtentsId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eHttpResponseMessage\u003c/span\u003e \u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInput\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eHttpRequestMessage\u003c/span\u003e \u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003edynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003einputDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTraceWriter\u003c/span\u003e \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"invoked.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einputDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eJsonConvert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSerializeObject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einputDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"Document: \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHttpStatusCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOK\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHttpStatusCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotFound\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e引数をみてみると、先程定義した名前と同名で定義してあると思う。各引数に関して説明をしていく。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003einput\n\n\u003cul\u003e\n\u003cli\u003eトリガのHttpをバインドしたバインド先。通常はHttpRequestMessageオブジェクトにバインドするが、今回は、リクエストの中にcontentsIdが入っていて、それを直にCosmosDBへのクエリのパラメータとして使用するため、こういう形となった。詳細は\u003ca href=\"https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-bindings-documentdb\" rel=\"nofollow noopener\" target=\"_blank\"\u003eオフィシャル\u003c/a\u003eを参照。\u003c/li\u003e\n\u003cli\u003e関数の外でInputクラス（POCO）をこさえると、そこにパラメータがバインドされる。CosmosDBを「入力」に使用する場合はこうする模様。Queueのpayloadのjsonをバインドするのがオフィシャルの例に乗っているが、今回はトリガのルートテンプレートで設定したcontentsIdをバインドした。（できた。）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ereq\n\n\u003cul\u003e\n\u003cli\u003eHttpRequestMessageオブジェクトは上述のように、通常Httpトリガのパラメータバインド先。今回はバインドしないので、コンパイルは通るが、実行時にエラーになる（AzureFunctionsはバインドのないパラメータを引数に取ると実行時エラーとなる）はずだが、ならない。そりゃHttpリクエストだからな。。。特別なんでしょう。ちなみに、レスポンス（HttpResponseMessage）の生成器にもなっているのでないと困る。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003einputDocument\n\n\u003cul\u003e\n\u003cli\u003eCosmosDBの検索結果が格納される。つまり、この関数が呼ばれる前に前述のPOCOを使用したCosmosDBの検索が行われている形となる。\u003c/li\u003e\n\u003cli\u003e今回はクエリを使用して複数ドキュメントを取得するので、typeはIEnumerable\u0026lt;dynamic\u0026gt;\u003c/li\u003e\n\u003cli\u003eドキュメントが複数返ってくるのでJson.NETを使用して、jsonオブジェクト（リスト）を取得する。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003elog\n\n\u003cul\u003e\n\u003cli\u003eLogger。これを使って出力するものを、あとでApplicationInsightsで拾えるように設定します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"test\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#test\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003etest\u003c/h2\u003e\n\n\u003cp\u003e実行してみる。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f106b5441ca785a50fc140518102a1e58d133dd5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f37646336326561302d393638632d353264342d323433652d3265396434333638613437352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"381\" alt=\"スクリーンショット 2017-06-29 16.03.52.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F7dc62ea0-968c-52d4-243e-2e9d4368a475.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1ff283d6218aca85695e48ca4dc8e13b\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/114329/7dc62ea0-968c-52d4-243e-2e9d4368a475.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F7dc62ea0-968c-52d4-243e-2e9d4368a475.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7d6e94f3ac30a0d031e67e989f0554f9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nおかわりさんが引っかかった。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"swaggerドキュメント書いてみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#swagger%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSwaggerドキュメント書いてみる\u003c/h2\u003e\n\n\u003cp\u003eAPI Definition（現在はpreview）からGenerate API Definition Templateを押すと、\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/d6b403d3929085131286910f4f03b473823df596/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f34333032616339642d646638342d666366652d343861342d6162396465633964653832352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"1051\" alt=\"スクリーンショット 2017-06-29 16.14.15.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F4302ac9d-df84-fcfe-48a4-ab9dec9de825.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=227b671e4fa05c07ef46cc9562d70bc4\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/114329/4302ac9d-df84-fcfe-48a4-ab9dec9de825.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F4302ac9d-df84-fcfe-48a4-ab9dec9de825.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=61d4af5eed5c90a47a8a8f0f064a97c1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003econtentsIdとかも含め情報を読み取って雛形を作成してくれる。なんて便利。\u003cbr\u003e\nプロトタイプを作成して、同時にドキュメント作成、ある程度固まったらステークホルダにドキュメント渡す\u003cbr\u003e\nみたいなスムーズなコミュニケーションがとれる。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"logの監視\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#log%E3%81%AE%E7%9B%A3%E8%A6%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLogの監視\u003c/h2\u003e\n\n\u003cp\u003eApplicationInsightsを使用して、logを一元管理していきたいと思う。\u003cbr\u003e\n最初にApplicationInsightsをonにしたので、あとは下記を行って、紐付けていく。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eApplicationInsightsのプロパティ、のインストルメンテーションキーを取得する。\n\u003ca href=\"https://camo.qiitausercontent.com/6f1103efc85051dfce770a5091c90b1774b888e3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f33386238643436372d353362372d343832352d383336302d6161666335613964643866312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"597\" alt=\"スクリーンショット 2017-06-29 16.53.05.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F38b8d467-53b7-4825-8360-aafc5a9dd8f1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=009c9688d5db9a54334a85158e60f2d0\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/114329/38b8d467-53b7-4825-8360-aafc5a9dd8f1.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F38b8d467-53b7-4825-8360-aafc5a9dd8f1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ae88602cbf03c40f5d0649d6c205b5f2 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eFunctionsのアプリケーション設定でAPPINSIGHTS_INSTRUMENTATIONKEYというkeyで上記で取得した鍵を入力する。\n\u003ca href=\"https://camo.qiitausercontent.com/eaf120e03ae5b11f81d64f4f65cd3515437f212c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f37666131366132372d326464312d646632392d323865332d6665366133663333306135392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"496\" alt=\"スクリーンショット 2017-06-29 16.58.23.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F7fa16a27-2dd1-df29-28e3-fe6a3f330a59.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=da9a7eb35a5539a152f001ec349a2b24\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/114329/7fa16a27-2dd1-df29-28e3-fe6a3f330a59.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F7fa16a27-2dd1-df29-28e3-fe6a3f330a59.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9b32e8157d552a495ef7f7e1ad615f81 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ea98001a62c13422f48156c556ac5b531c748f1b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f66333232383061392d353830372d343266352d353664332d3465323764313462363138392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"556\" alt=\"スクリーンショット 2017-06-29 17.06.00.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Ff32280a9-5807-42f5-56d3-4e27d14b6189.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=efa1a7483b1b7227e5774e41debb6c42\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/114329/f32280a9-5807-42f5-56d3-4e27d14b6189.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Ff32280a9-5807-42f5-56d3-4e27d14b6189.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8e0da0749d27759501ce73eff5862bbb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eApplicationInsightsでログの状況を閲覧することができる。\n\u003ca href=\"https://camo.qiitausercontent.com/bb58912ef33d7e0f9bea36706659178f42dd1e3e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f61613739303535322d363664382d376366352d366433642d3836326337313361303862352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"826\" alt=\"スクリーンショット 2017-06-29 17.07.35.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Faa790552-66d8-7cf5-6d3d-862c713a08b5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=733b7847203b3c1a176195e48e704588\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/114329/aa790552-66d8-7cf5-6d3d-862c713a08b5.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Faa790552-66d8-7cf5-6d3d-862c713a08b5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cdd43c687edb5124f1ddaa0a644f8c87 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"所感\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%89%80%E6%84%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e所感\u003c/h1\u003e\n\n\u003cp\u003e日に日にパワーアップするAzureFunctionsをいじってて普通に楽しい。エンジニアがクリエイティブな部分に集中できるように痒いところに手が届いてきた気がします。ドキュメントが若干読みにくいのと、リソース横断的なusageドキュメントが少ない印象のAzureですが、紐解いていくこと自体も楽しいのでよしとします。\u003c/p\u003e\n\n\u003cp\u003e今回の体験を経て、全体的にこんな感じにしようと思いました。チームメンバーの了承を得たらこれで行きます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/350dac6f95a8f1c127c842af4a1817802ef90ccc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343332392f31633231666666632d643830622d663636662d653564642d6334613833313139343362332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F1c21fffc-d80b-f66f-e5dd-c4a8311943b3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5f95377b1a321c3af8214d735ac8bdf6\" alt=\"zeoliteLatestDiagram (1).png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/114329/1c21fffc-d80b-f66f-e5dd-c4a8311943b3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2F1c21fffc-d80b-f66f-e5dd-c4a8311943b3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1d5ecc56c6525bc48a44d7c94cb06048 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"次回\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AC%A1%E5%9B%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e次回\u003c/h1\u003e\n\n\u003cp\u003eEventhubに関して書いていこうと思います。\u003c/p\u003e\n","createdAt":"2017-06-29T08:10:10Z","elapsedYearsFromLastModifiedAt":4,"encryptedId":"gB7iZ+XWnDNIQaxtrfSVnSqbKfR7P94I--dpLGecx6a7Q9gryq--rpLOvRY1749D66YAZUErrA==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2017-07-14T04:55:26Z","likesCount":3,"linkUrl":"https://qiita.com/tstakano-yj/items/799e18cd209cf5a93ef7","organization":null,"originalId":505007,"stockedCount":6,"title":"AzureFunctionsでCosmosDBのクエリ検索restサービスと監視","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B5%8C%E7%B7%AF\"\u003e経緯\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e作ってみる\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E7%8F%BE%E3%81%97%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e実現したいこと\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#azurefunctions%E3%81%AE%E6%A7%8B%E7%AF%89\"\u003eAzureFunctionsの構築\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%88%E3%83%AA%E3%82%AChttp\"\u003eトリガ（HTTP）\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%85%A5%E5%8A%9Bazure-documentdb\"\u003e入力（Azure DocumentDB）\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%87%BA%E5%8A%9Bhttp\"\u003e出力（HTTP）\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#test\"\u003etest\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#swagger%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B\"\u003eSwaggerドキュメント書いてみる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#log%E3%81%AE%E7%9B%A3%E8%A6%96\"\u003eLogの監視\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%89%80%E6%84%9F\"\u003e所感\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%AC%A1%E5%9B%9E\"\u003e次回\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":2082,"uuid":"799e18cd209cf5a93ef7","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"jTIjNC96n9RZFz1hwT68zgDdV3RQ--Jolo8/rdjkDY7J+W--npxNlKq+81CCE66t/r3qCQ==","originalId":114329,"description":"GYAOのバックエンドエンジニアです。","facebookUrl":"https://facebook.com/100014955870666","githubUrl":"https://github.com/tstakano-yj","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":"https://www.linkedin.com/in/tsuneyuki-takano","name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/114329/profile-images/1486731894","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Fprofile-images%2F1486731894?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=ccde55ddde5cd4539d99a5acc43f1492","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114329%2Fprofile-images%2F1486731894?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=30a949e5279d6a03c1dea08df54f43a7","urlName":"tstakano-yj","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[{"node":{"encryptedId":"eE5DiQQh8nx+o9Oa9xfNuMRY+V1M/epr11w=--gCokPqZNWcjhdHH+--h4alw34Sa+/fOiW8R1QTBQ==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"株式会社GYAO","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/c2731aea9334c26b9b1f1c406c8a80089e947c53/original.jpg?1457576296","urlName":"gyao","description":"GYAOは、ヤフーグループのエンターテインメントカンパニーとして、GYAO!サービスを運営しています。","url":"http://www.gyao.co.jp/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Azure","urlName":"azure"},{"name":"DocumentDB","urlName":"documentdb"},{"name":"AzureFunctions","urlName":"azurefunctions"},{"name":"CosmosDB","urlName":"cosmosdb"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

<!DOCTYPE html><html><head><meta charset="utf-8" /><title>マウスジェスチャツールの作り方 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/rubyu/items/88b9f93b39951252a0c1" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="TDO0/aLJQTqnbI09Bq1j2kDUV0xAWgSNkQvQkRP6gQlkvhIlWTVMJE17GSZPHTbo8MG+YYUa8M5OlzQuPwRUyA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@ruby_U" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="マウスジェスチャツールの作り方 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NE9lNDRLbTQ0SzU0NEs0NDRLbjQ0SzU0NE9CNDRPajQ0T0U0NE84NDRPcjQ0R3U1TDJjNDRLSzVwYTUmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NTg1YTg4YjJlNjMyOWM1ZjU1ZTNjYjVjZDY5NTE3Njc&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSEoxWW5sMSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTRlNjBkNTAwZjg0YjcxYjQ5NGJlY2M1OTQxODExNjBh&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=95f34658608f51d70bfc360314cc9dfb"><meta property="og:description" content="かざぐるマウスからの乗り換え先を探してたのですが、要求条件を満たすものがなかったのでフルスクラッチで書きました。現時点(バージョン2.2)で僕が使うには不満のないデキになったので、紹介がてら、忘れないうちに開発のメモやポイントなどを書..."><meta content="https://qiita.com/rubyu/items/88b9f93b39951252a0c1" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="Windows,C#,Roslyn" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-3635bd73-12f1-4c1d-839f-e69a18494f96"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Frubyu%2Fitems%2F88b9f93b39951252a0c1">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Frubyu%2Fitems%2F88b9f93b39951252a0c1">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-3635bd73-12f1-4c1d-839f-e69a18494f96">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/windows","name":"Windows"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2016-10-21T07:25:26.000+09:00","dateModified":"2020-09-06T11:53:40.000+09:00","headline":"マウスジェスチャツールの作り方","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NE9lNDRLbTQ0SzU0NEs0NDRLbjQ0SzU0NE9CNDRPajQ0T0U0NE84NDRPcjQ0R3U1TDJjNDRLSzVwYTUmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NTg1YTg4YjJlNjMyOWM1ZjU1ZTNjYjVjZDY5NTE3Njc\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSEoxWW5sMSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTRlNjBkNTAwZjg0YjcxYjQ5NGJlY2M1OTQxODExNjBh\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=95f34658608f51d70bfc360314cc9dfb","mainEntityOfPage":"https://qiita.com/rubyu/items/88b9f93b39951252a0c1","author":{"@type":"Person","address":null,"email":null,"identifier":"rubyu","name":"rubyu","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2Fprofile-images%2F1473690845?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=bea11152503f24d802eee2e0fc9db59d","url":"https://qiita.com/rubyu","description":null,"memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"rubyu","type":"items","id":"88b9f93b39951252a0c1"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"rubyu","type":"items","id":"88b9f93b39951252a0c1"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"rubyu","type":"items","id":"88b9f93b39951252a0c1"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/rubyu/items/88b9f93b39951252a0c1","location":"/rubyu/items/88b9f93b39951252a0c1","scheme":"https","host":"qiita.com","port":null,"pathname":"/rubyu/items/88b9f93b39951252a0c1","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"qhybwWzuaqdpmckX0yifS+TjEf5GMR/ON14DqqinL+6CkT0ZlxJnuYOOXQyamMp5VPb404Nx643owucVhFn6Lw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-8ec7c065-f456-4def-a09c-39485f2e00b3"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/rubyu/items/88b9f93b39951252a0c1/likers" class="css-1iupg5d">60</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">69</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/88b9f93b39951252a0c1/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/rubyu/items/88b9f93b39951252a0c1/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/rubyu/items/88b9f93b39951252a0c1/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/rubyu/items/88b9f93b39951252a0c1/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/rubyu/items/88b9f93b39951252a0c1.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/rubyu"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/47014/profile-images/1473690845" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/rubyu" class="css-10ougpm">@<!-- -->rubyu</a><div class="css-1ay9vb9"><span><meta content="2016-10-20T22:25:26Z"/><time dateTime="2020-09-06T02:53:40Z" class="css-m19uds">updated at 2020-09-06</time></span></div></div></div></div></div><h1 class="css-cgzq40">マウスジェスチャツールの作り方</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/windows" class="css-4czcte">Windows</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/roslyn" class="css-4czcte">Roslyn</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>かざぐるマウスからの乗り換え先を探してたのですが、要求条件を満たすものがなかったのでフルスクラッチで書きました。現時点(バージョン2.2)で僕が使うには不満のないデキになったので、紹介がてら、忘れないうちに開発のメモやポイントなどを書き綴ろうと思います。</p>

<p>なお、C#で何かを書くのはこれが数回目で、かつ最新の文法書を通読したことがなく、逆引きでつまみ食い学習したため、C#的にはアレだったりするかもしれません。なにか変なところがあったら遠慮なくﾏｻｶﾘください。</p>

<h3>
<span id="作ったツールの紹介" class="fragment"></span><a href="#%E4%BD%9C%E3%81%A3%E3%81%9F%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E7%B4%B9%E4%BB%8B"><i class="fa fa-link"></i></a>作ったツールの紹介</h3>

<p>名前はCreviceAppで、2016年5月の第2週から6月の終わりまでを使って書きました。その後はドッグフーディングして、バグを見つけるたびに潰しています。</p>

<h4>
<span id="必須要件" class="fragment"></span><a href="#%E5%BF%85%E9%A0%88%E8%A6%81%E4%BB%B6"><i class="fa fa-link"></i></a>必須要件</h4>

<ul>
<li>Windows 7 以降</li>
<li>.Net Framework 4.6 以上</li>
</ul>

<h4>
<span id="特徴" class="fragment"></span><a href="#%E7%89%B9%E5%BE%B4"><i class="fa fa-link"></i></a>特徴</h4>

<p>信頼できるツールとして設計しました。取りこぼしなどがなく、高速で、イライラしません。<br>
他のマウスジェスチャツールで標準的なものでも、僕が使わないであろう機能（GUIでの設定、ジェスチャ軌跡の描写機能など）はバッサリ切っています。<br>
設定をC#スクリプト(csxファイル)として記述できるので、WindowsAPIを叩いたり、DLLをロードしたり、何でもできます。<br>
ジェスチャとしてはストロークジェスチャ、ロッカージェスチャに対応します。<br>
単純にボタンのクリックにアクションを割り当てたり、<code>押下</code>, <code>開放</code>に直接フックを掛けることもできます。<br>
オープンソース。MITライセンスです。<br>
コア部分は2000行ほどとコンパクトなので、改造したりするのも簡単なのではと思います。</p>

<h4>
<span id="導入方法" class="fragment"></span><a href="#%E5%B0%8E%E5%85%A5%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>導入方法</h4>

<p>zipファイルを適当な位置に解凍して、<code>CreviceApp.exe</code>を実行してください。<br>
起動すると、自動的にデフォルトの設定ファイルが作られ、いくつかのジェスチャ定義が読み込まれます。デフォルトの設定ファイルには、ブラウザに対するジェスチャが一通り定義されています。</p>

<p><a href="https://camo.qiitausercontent.com/a80c217f7a2d7e710b90a148959e96664b5af375/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34373031342f39396662373164312d636662652d333730312d333832332d3566356232343837663235342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2F99fb71d1-cfbe-3701-3823-5f5b2487f254.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a76d13b2faa017273e05696f7c2651a1" alt="SnapCrab_新しい通知_2016-10-22_10-41-0_No-00.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/47014/99fb71d1-cfbe-3701-3823-5f5b2487f254.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2F99fb71d1-cfbe-3701-3823-5f5b2487f254.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6e71badca0e177e2604aff1086681dce 1x" loading="lazy"></a></p>

<p>タスクトレイにアイコンが出るので、それをクリックするとウィンドウが開きます。<br>
<a href="https://camo.qiitausercontent.com/6976dc69dbf02c55b59fe8b4dfbe4d226ccc191a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34373031342f66653933363563392d333230632d633563362d323761632d3833356132303334343935662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2Ffe9365c9-320c-c5c6-27ac-835a2034495f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=307d68a586653820963af42cdb1059e9" alt="SnapCrab_NoName_2016-10-22_10-41-33_No-00.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/47014/fe9365c9-320c-c5c6-27ac-835a2034495f.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2Ffe9365c9-320c-c5c6-27ac-835a2034495f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f3de600940b3c54038f91553c31dee71 1x" loading="lazy"></a></p>

<p><a href="https://camo.qiitausercontent.com/593874a98c50c2e3b11d494ff9ea3cfc35fce561/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34373031342f32336638616235352d383835322d356262372d363164352d3733616134323333663463642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2F23f8ab55-8852-5bb7-61d5-73aa4233f4cd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=43c5fdbb8e3ad43220e8d41763adf4bf" alt="SnapCrab_CreviceApp_2016-10-21_5-48-59_No-00.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/47014/23f8ab55-8852-5bb7-61d5-73aa4233f4cd.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2F23f8ab55-8852-5bb7-61d5-73aa4233f4cd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=30d23d707daf867af08f4a7f7105bbf3 1x" loading="lazy"></a></p>

<p>「Open user directory」をクリックすると、エクスプローラーが<code>%APPDATA%\Crevice\CreviceApp</code>を開きます。</p>

<p><code>default.csx</code>が設定ファイルなので、後はそれを自由に書き換えて、アプリを再起動するだけです。Enjoy!</p>

<h4>
<span id="設定dslの文法" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9Adsl%E3%81%AE%E6%96%87%E6%B3%95"><i class="fa fa-link"></i></a>設定DSLの文法</h4>

<p>まずジェスチャを定義するには<code>@when</code>から始めます。フォアグラウンドアプリがChromeなときだけ発動するジェスチャを定義していきます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">Chrome</span> <span class="p">=</span> <span class="nf">@when</span><span class="p">((</span><span class="n">ctx</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">ctx</span><span class="p">.</span><span class="n">ForegroundWindow</span><span class="p">.</span><span class="n">ModuleName</span> <span class="p">==</span> <span class="s">"chrome.exe"</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div>

<p>続いて、<code>@on</code>, <code>@if</code>, <code>@do</code>で一つのジェスチャが定義できます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">Chrome</span><span class="p">.</span>
<span class="nf">@on</span><span class="p">(</span><span class="n">RightButton</span><span class="p">).</span>
<span class="nf">@if</span><span class="p">(</span><span class="n">MoveDown</span><span class="p">,</span> <span class="n">MoveRight</span><span class="p">).</span>
<span class="nf">@do</span><span class="p">((</span><span class="n">ctx</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">SendInput</span><span class="p">.</span><span class="nf">Multiple</span><span class="p">().</span>
    <span class="nf">ExtendedKeyDown</span><span class="p">(</span><span class="n">VK_CONTROL</span><span class="p">).</span>
    <span class="nf">KeyDown</span><span class="p">(</span><span class="n">VK_W</span><span class="p">).</span>
    <span class="nf">KeyUp</span><span class="p">(</span><span class="n">VK_W</span><span class="p">).</span>
    <span class="nf">ExtendedKeyUp</span><span class="p">(</span><span class="n">VK_CONTROL</span><span class="p">).</span>
    <span class="nf">Send</span><span class="p">();</span> <span class="c1">// Close tab</span>
<span class="p">});</span>
</code></pre></div></div>

<p><code>RightButton</code>からのストロークジェスチャ<code>↓→</code>を定義しました。ここで発動するアクションは<code>タブを閉じる</code>になります。</p>

<p>同様に<code>@on</code>, <code>@if</code>, <code>@do</code>を使って今度は<code>RightButton + WheelDown</code>, <code>RightButton + WheelUp</code>に<code>タブの切り替え</code>を割り当てます。これらはロッカージェスチャです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">Chrome</span><span class="p">.</span>
<span class="nf">@on</span><span class="p">(</span><span class="n">RightButton</span><span class="p">).</span>
<span class="nf">@if</span><span class="p">(</span><span class="n">WheelDown</span><span class="p">).</span>
<span class="nf">@do</span><span class="p">((</span><span class="n">ctx</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">SendInput</span><span class="p">.</span><span class="nf">Multiple</span><span class="p">().</span>
    <span class="nf">ExtendedKeyDown</span><span class="p">(</span><span class="n">VK_CONTROL</span><span class="p">).</span>
    <span class="nf">ExtendedKeyDown</span><span class="p">(</span><span class="n">VK_TAB</span><span class="p">).</span>
    <span class="nf">ExtendedKeyUp</span><span class="p">(</span><span class="n">VK_TAB</span><span class="p">).</span>
    <span class="nf">ExtendedKeyUp</span><span class="p">(</span><span class="n">VK_CONTROL</span><span class="p">).</span>
    <span class="nf">Send</span><span class="p">();</span> <span class="c1">// Next tab</span>
<span class="p">});</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">Chrome</span><span class="p">.</span>
<span class="nf">@on</span><span class="p">(</span><span class="n">RightButton</span><span class="p">).</span>
<span class="nf">@if</span><span class="p">(</span><span class="n">WheelUp</span><span class="p">).</span>
<span class="nf">@do</span><span class="p">((</span><span class="n">ctx</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">SendInput</span><span class="p">.</span><span class="nf">Multiple</span><span class="p">().</span>
    <span class="nf">ExtendedKeyDown</span><span class="p">(</span><span class="n">VK_CONTROL</span><span class="p">).</span>
    <span class="nf">ExtendedKeyDown</span><span class="p">(</span><span class="n">VK_SHIFT</span><span class="p">).</span>
    <span class="nf">ExtendedKeyDown</span><span class="p">(</span><span class="n">VK_TAB</span><span class="p">).</span>
    <span class="nf">ExtendedKeyUp</span><span class="p">(</span><span class="n">VK_TAB</span><span class="p">).</span>
    <span class="nf">ExtendedKeyUp</span><span class="p">(</span><span class="n">VK_SHIFT</span><span class="p">).</span>
    <span class="nf">ExtendedKeyUp</span><span class="p">(</span><span class="n">VK_CONTROL</span><span class="p">).</span>
    <span class="nf">Send</span><span class="p">();</span> <span class="c1">// Previous tab</span>
<span class="p">});</span>
</code></pre></div></div>

<p>さてChromeはとりあえず置いておいて、コンテキストなしで<code>X1Button</code>にアクションを割り当ててみます。この<code>@when</code>は常に<code>true</code>を返すので、ジェスチャはいつでも発動します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">Whenever</span> <span class="p">=</span> <span class="nf">@when</span><span class="p">((</span><span class="n">ctx</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">Whenever</span><span class="p">.</span>
<span class="nf">@if</span><span class="p">(</span><span class="n">X1Button</span><span class="p">).</span>
<span class="nf">@do</span><span class="p">((</span><span class="n">ctx</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">SendInput</span><span class="p">.</span><span class="nf">Multiple</span><span class="p">().</span>
    <span class="nf">ExtendedKeyDown</span><span class="p">(</span><span class="n">VK_MENU</span><span class="p">).</span>
    <span class="nf">ExtendedKeyDown</span><span class="p">(</span><span class="n">VK_TAB</span><span class="p">).</span>
    <span class="nf">ExtendedKeyUp</span><span class="p">(</span><span class="n">VK_TAB</span><span class="p">).</span>
    <span class="nf">ExtendedKeyUp</span><span class="p">(</span><span class="n">VK_MENU</span><span class="p">).</span>
    <span class="nf">Send</span><span class="p">();</span> <span class="c1">// Sending Alt+Tab; this will work fine except on Window 8</span>
<span class="p">});</span>
</code></pre></div></div>

<p>割り当てられたアクションは<code>Alt + Tab</code>です。よく使いますよね。ここで<code>@on</code>が指定されていないことに注意してください。つまり<code>X1Button</code>に直接アクションを割り当てたことになります。</p>

<p>続いて、同様にコンテキストなしで、今度は<code>X2Button</code>のDown/Upにアクションを割り当てます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">Whenever</span><span class="p">.</span>
<span class="nf">@if</span><span class="p">(</span><span class="n">X2Button</span><span class="p">).</span>
<span class="nf">@before</span><span class="p">((</span><span class="n">ctx</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">SendInput</span><span class="p">.</span><span class="nf">ExtendedKeyDown</span><span class="p">(</span><span class="n">VK_CONTROL</span><span class="p">);</span> <span class="c1">// Ctrl Down</span>
<span class="p">}).</span>
<span class="nf">@after</span><span class="p">((</span><span class="n">ctx</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">SendInput</span><span class="p">.</span><span class="nf">ExtendedKeyUp</span><span class="p">(</span><span class="n">VK_CONTROL</span><span class="p">);</span> <span class="c1">// Ctrl Up</span>
<span class="p">});</span>
</code></pre></div></div>

<p>これで<code>X2Button</code>を<code>Ctrlキー</code>として使用することができます。</p>

<p><code>@before</code>, <code>@after</code>はちょっと微妙な表現ですが、両者の間に<code>@do</code>を挟むことができるので、<code>@do</code>の前と後ということです。この<code>@before</code>と<code>@after</code>が使えるのは、<code>@if</code>が<code>LeftButton</code>, <code>MiddleButton</code>, <code>RightButton</code>, <code>X1Button</code>, <code>X2Button</code>のいずれかを引数に取るときだけであることに注意してください。<code>@if</code>が<code>WheelDown</code>, <code>WheelUp</code>, <code>WheelLeft</code>, <code>WheelRight</code>を引数に取るときは<code>@do</code>のみが指定可能です。</p>

<h4>
<span id="状態を持つ設定の例" class="fragment"></span><a href="#%E7%8A%B6%E6%85%8B%E3%82%92%E6%8C%81%E3%81%A4%E8%A8%AD%E5%AE%9A%E3%81%AE%E4%BE%8B"><i class="fa fa-link"></i></a>状態を持つ設定の例</h4>

<p>あるところに懐ゲーマニアがいました。彼は懐ゲーを愛し、毎日のようにプレイしていましたが、たったひとつだけ許せないことがありました。それはホイールコロコロでテキストを読み進められないゲームがあることでした。ホイールをクリックに変換してくれるようなツールもありますが、ゲームによっていちいちツールを設定し直すのが面倒なのでした。そこでCreviceAppです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">Wheel2Click</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">Whenever</span> <span class="p">=</span> <span class="nf">@when</span><span class="p">((</span><span class="n">ctx</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="p">});</span>

<span class="n">Whenever</span><span class="p">.</span>
<span class="nf">@on</span><span class="p">(</span><span class="n">RightButton</span><span class="p">).</span>
<span class="nf">@if</span><span class="p">(</span><span class="n">LeftButton</span><span class="p">).</span>
<span class="nf">@do</span><span class="p">((</span><span class="n">ctx</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">Wheel2Click</span> <span class="p">=</span> <span class="p">!</span><span class="n">Wheel2Click</span><span class="p">;</span>
    <span class="nf">Tooltip</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"Wheel2Click {0}"</span><span class="p">,</span> <span class="n">Wheel2Click</span> <span class="p">?</span> <span class="s">"enabled"</span> <span class="p">:</span> <span class="s">"disabled"</span><span class="p">));</span>
<span class="p">});</span>

<span class="n">Whenever</span><span class="p">.</span>
<span class="nf">@if</span><span class="p">(</span><span class="n">WheelDown</span><span class="p">).</span>
<span class="nf">@do</span><span class="p">((</span><span class="n">ctx</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Wheel2Click</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SendInput</span><span class="p">.</span><span class="nf">LeftClick</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">SendInput</span><span class="p">.</span><span class="nf">WheelDown</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p><code>RightButton + LeftButton</code>で機能のオンオフを切り替えることができます。ここで、設定中のグローバルな値である<code>Wheel2Click</code>は、CreviceAppの起動から終了までの間を通じて保持されます。</p>

<h4>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h4>

<p>以上が簡単な説明になります。詳細な説明は適当な英語で<a href="https://github.com/rubyu/CreviceApp" rel="nofollow noopener" target="_blank">プロジェクトページ</a>に書いています。<a href="https://github.com/rubyu/CreviceApp#executioncontext" rel="nofollow noopener" target="_blank"><code>@when</code>での他のコンテキストの指定</a>、<a href="https://github.com/rubyu/CreviceApp#config" rel="nofollow noopener" target="_blank"><code>Config</code>でのパラメータの設定</a>、<a href="https://github.com/rubyu/CreviceApp#windowinfo" rel="nofollow noopener" target="_blank"><code>WindowInfo</code></a>, <a href="https://github.com/rubyu/CreviceApp#sendinput" rel="nofollow noopener" target="_blank"><code>SendInput</code></a>, <a href="https://github.com/rubyu/CreviceApp#window" rel="nofollow noopener" target="_blank"><code>Window</code></a>, <a href="https://github.com/rubyu/CreviceApp#tooltipstring-text" rel="nofollow noopener" target="_blank"><code>Tooltip</code></a>, <a href="https://github.com/rubyu/CreviceApp#baloonstring-text" rel="nofollow noopener" target="_blank"><code>Baloon</code></a>などのAPIなど、ここでは割愛した内容を含んでいます。</p>

<p>最新のリリースは<a href="https://github.com/rubyu/CreviceApp/releases" rel="nofollow noopener" target="_blank">2.2.153</a>です。よかったら使ってみてください。</p>

<p><a href="https://github.com/rubyu/CreviceApp" rel="nofollow noopener" target="_blank">rubyu/CreviceApp</a><br>
<a href="https://github.com/rubyu/CreviceApp/releases" rel="nofollow noopener" target="_blank">Releases · rubyu/CreviceApp</a></p>

<h3>
<span id="マウスジェスチャツールの作り方" class="fragment"></span><a href="#%E3%83%9E%E3%82%A6%E3%82%B9%E3%82%B8%E3%82%A7%E3%82%B9%E3%83%81%E3%83%A3%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9"><i class="fa fa-link"></i></a>マウスジェスチャツールの作り方</h3>

<h4>
<span id="基本的な仕組み" class="fragment"></span><a href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BB%95%E7%B5%84%E3%81%BF"><i class="fa fa-link"></i></a>基本的な仕組み</h4>

<p>マウスジェスチャツールはマウス入力にフックを掛けて、飛んでくるマウスメッセージを解釈し、必要であれば何らかのアクションを実行し、最後にマウスメッセージに対する返答「よし通れ！」「通さぬぞ！」のどちらかを返します。このとき通過を許可されたマウスメッセージは、他のフックがあれば同様にその審査も経て、最終的にはアプリケーションに到達します。通過を拒否されたマウスメッセージは破棄され、他のフックやアプリケーションに渡ることはありません。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">SetLastError</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="n">IntPtr</span> <span class="nf">SetWindowsHookEx</span><span class="p">(</span><span class="kt">int</span> <span class="n">idHook</span><span class="p">,</span> <span class="n">SystemCallback</span> <span class="n">callback</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">hInstance</span><span class="p">,</span> <span class="kt">int</span> <span class="n">threadId</span><span class="p">);</span>
<span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">SetLastError</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">bool</span> <span class="nf">UnhookWindowsHookEx</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hook</span><span class="p">);</span>
<span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">)]</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="n">IntPtr</span> <span class="nf">CallNextHookEx</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">idHook</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nCode</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">lParam</span><span class="p">);</span>
<span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"kernel32.dll"</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="n">IntPtr</span> <span class="nf">GetModuleHandle</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">);</span>

<span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">HC_ACTION</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">WH_MOUSE_LL</span> <span class="p">=</span> <span class="m">14</span><span class="p">;</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">IntPtr</span> <span class="n">LRESULTCancel</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">IntPtr</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>

<span class="k">private</span> <span class="n">IntPtr</span> <span class="n">hHook</span> <span class="p">=</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">;</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">SetHook</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">hInstance</span> <span class="p">=</span> <span class="nf">GetModuleHandle</span><span class="p">(</span><span class="n">Process</span><span class="p">.</span><span class="nf">GetCurrentProcess</span><span class="p">().</span><span class="n">MainModule</span><span class="p">.</span><span class="n">ModuleName</span><span class="p">);</span>
    <span class="n">hHook</span> <span class="p">=</span> <span class="nf">SetWindowsHookEx</span><span class="p">(</span><span class="n">WH_MOUSE_LL</span><span class="p">,</span> <span class="n">Callback</span><span class="p">,</span> <span class="n">hInstance</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">Unhook</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">UnhookWindowsHookEx</span><span class="p">(</span><span class="n">hHook</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="n">IntPtr</span> <span class="nf">Callback</span><span class="p">(</span><span class="kt">int</span> <span class="n">nCode</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">lParam</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nCode</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 何か処理をする</span>
        <span class="k">if</span> <span class="p">(</span><span class="err">よし通れ！</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">CallNextHookEx</span><span class="p">(</span><span class="n">hHook</span><span class="p">,</span> <span class="n">nCode</span><span class="p">,</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">lParam</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="err">通さぬぞ！</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">LRESULTCancel</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nf">CallNextHookEx</span><span class="p">(</span><span class="n">hHook</span><span class="p">,</span> <span class="n">nCode</span><span class="p">,</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">lParam</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>エラー処理などは省いていますが、非常に簡単ですね。あとはアプリケーションの起動時に<code>SetHook()</code>し、終了時に<code>Unhook()</code>すれば、マウスジェスチャツールの骨組みはできあがりです。</p>

<p><code>SetHook()</code>した後にマウスメッセージが発生するたび、<code>Callback()</code>が呼ばれます。ここにキモとなるロジックを書き加えていくことになります。</p>

<p>注意: 後述しますが、<a href="http://qiita.com/rubyu/items/88b9f93b39951252a0c1#%E3%81%86%E3%81%BE%E3%81%8F%E3%83%95%E3%83%83%E3%82%AF%E3%81%8C%E3%81%8B%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84-1"><code>WH_MOUSE_LL</code>などのグローバルフックを掛ける場合、<code>SetWindowsHookEx()</code>をコールしたスレッドがメッセージループを持っていなければなりません。</a></p>

<p>参考:<br>
<a href="https://msdn.microsoft.com/ja-jp/library/cc430103.aspx?f=255&amp;MSPPError=-2147217396" rel="nofollow noopener" target="_blank">SetWindowsHookEx 関数</a><br>
<a href="https://msdn.microsoft.com/ja-jp/library/cc429591.aspx" rel="nofollow noopener" target="_blank">CallNextHookEx 関数</a><br>
<a href="https://msdn.microsoft.com/ja-jp/library/cc430021.aspx" rel="nofollow noopener" target="_blank">LowLevelMouseProc 関数</a></p>

<h4>
<span id="tips" class="fragment"></span><a href="#tips"><i class="fa fa-link"></i></a>Tips</h4>

<h5>
<span id="メッセージの送信" class="fragment"></span><a href="#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE%E9%80%81%E4%BF%A1"><i class="fa fa-link"></i></a>メッセージの送信</h5>

<p>例えば、右クリックから開始されたジェスチャがタイムアウトでキャンセルとなった場合、この<code>RightButtonDown</code>をマウスジェスチャツールから送信する必要があります。いろいろな方法がありますが、<code>mouse_event</code>には後述する問題があるため、<code>SendInput</code>を使うのが無難ではないかと思います。</p>

<h6>
<span id="sendinput" class="fragment"></span><a href="#sendinput"><i class="fa fa-link"></i></a>SendInput</h6>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">SetLastError</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">uint</span> <span class="nf">SendInput</span><span class="p">(</span><span class="kt">uint</span> <span class="n">nInputs</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">[]</span> <span class="n">pInputs</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cbSize</span><span class="p">);</span>

<span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
<span class="k">protected</span> <span class="k">struct</span> <span class="nc">INPUT</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">type</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">MOUSEINPUT</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
<span class="k">protected</span> <span class="k">struct</span> <span class="nc">WHEELDELTA</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">delta</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
<span class="k">protected</span> <span class="k">struct</span> <span class="nc">XBUTTON</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">type</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Explicit</span><span class="p">)]</span>
<span class="k">protected</span> <span class="k">struct</span> <span class="nc">MOUSEDATA</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">FieldOffset</span><span class="p">(</span><span class="m">0</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">WHEELDELTA</span> <span class="n">asWheelDelta</span><span class="p">;</span>
    <span class="p">[</span><span class="nf">FieldOffset</span><span class="p">(</span><span class="m">0</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">XBUTTON</span> <span class="n">asXButton</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
<span class="k">protected</span> <span class="k">struct</span> <span class="nc">MOUSEINPUT</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">dx</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">dy</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">MOUSEDATA</span> <span class="n">mouseData</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">uint</span> <span class="n">dwFlags</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">uint</span> <span class="n">time</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">UIntPtr</span> <span class="n">dwExtraInfo</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// https://msdn.microsoft.com/ja-jp/library/windows/desktop/ms646273(v=vs.85).aspx</span>
<span class="p">[</span><span class="n">Flags</span><span class="p">]</span>
<span class="k">private</span> <span class="k">enum</span> <span class="n">XButtonType</span>
<span class="p">{</span>
    <span class="n">XBUTTON1</span> <span class="p">=</span> <span class="m">0x01</span><span class="p">,</span>
    <span class="n">XBUTTON2</span> <span class="p">=</span> <span class="m">0x02</span>
<span class="p">}</span>

<span class="c1">// https://msdn.microsoft.com/ja-jp/library/windows/desktop/ms646270(v=vs.85).aspx</span>
<span class="p">[</span><span class="n">Flags</span><span class="p">]</span>
<span class="k">private</span> <span class="k">enum</span> <span class="n">InputType</span>
<span class="p">{</span>
    <span class="n">INPUT_MOUSE</span>    <span class="p">=</span> <span class="m">0x0</span><span class="p">,</span>
    <span class="n">INPUT_KEYBOARD</span> <span class="p">=</span> <span class="m">0x1</span><span class="p">,</span>
    <span class="n">INPUT_HARDWARE</span> <span class="p">=</span> <span class="m">0x2</span>
<span class="p">}</span>

<span class="c1">// https://msdn.microsoft.com/ja-jp/library/windows/desktop/ms646260(v=vs.85).aspx</span>
<span class="p">[</span><span class="n">Flags</span><span class="p">]</span>
<span class="k">private</span> <span class="k">enum</span> <span class="n">MouseEventType</span> 
<span class="p">{</span>
    <span class="n">MOUSEEVENTF_MOVE</span>       <span class="p">=</span> <span class="m">0x0001</span><span class="p">,</span>
    <span class="n">MOUSEEVENTF_LEFTDOWN</span>   <span class="p">=</span> <span class="m">0x0002</span><span class="p">,</span>
    <span class="n">MOUSEEVENTF_LEFTUP</span>     <span class="p">=</span> <span class="m">0x0004</span><span class="p">,</span>
    <span class="n">MOUSEEVENTF_RIGHTDOWN</span>  <span class="p">=</span> <span class="m">0x0008</span><span class="p">,</span>
    <span class="n">MOUSEEVENTF_RIGHTUP</span>    <span class="p">=</span> <span class="m">0x0010</span><span class="p">,</span>
    <span class="n">MOUSEEVENTF_MIDDLEDOWN</span> <span class="p">=</span> <span class="m">0x0020</span><span class="p">,</span>
    <span class="n">MOUSEEVENTF_MIDDLEUP</span>   <span class="p">=</span> <span class="m">0x0040</span><span class="p">,</span>
    <span class="n">MOUSEEVENTF_XDOWN</span>      <span class="p">=</span> <span class="m">0x0080</span><span class="p">,</span>
    <span class="n">MOUSEEVENTF_XUP</span>        <span class="p">=</span> <span class="m">0x0100</span><span class="p">,</span>
    <span class="n">MOUSEEVENTF_WHEEL</span>      <span class="p">=</span> <span class="m">0x0800</span><span class="p">,</span>
    <span class="n">MOUSEEVENTF_HWHEEL</span>     <span class="p">=</span> <span class="m">0x1000</span><span class="p">,</span>
    <span class="n">MOUSEEVENTF_ABSOLUTE</span>   <span class="p">=</span> <span class="m">0x8000</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">WHEEL_DELTA</span> <span class="p">=</span> <span class="m">120</span><span class="p">;</span>

<span class="k">protected</span> <span class="k">void</span> <span class="nf">Send</span><span class="p">(</span><span class="n">INPUT</span> <span class="n">input</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">messages</span> <span class="p">=</span> <span class="k">new</span> <span class="n">INPUT</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>
    <span class="n">messages</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="n">input</span><span class="p">;</span>
    <span class="nf">SendInput</span><span class="p">((</span><span class="kt">uint</span><span class="p">)</span><span class="n">messages</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="n">messages</span><span class="p">,</span> <span class="n">Marshal</span><span class="p">.</span><span class="nf">SizeOf</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="m">0</span><span class="p">]));</span>
<span class="p">}</span>

<span class="k">protected</span> <span class="n">INPUT</span> <span class="nf">ToInput</span><span class="p">(</span><span class="n">MOUSEINPUT</span> <span class="n">mouseInput</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">input</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">INPUT</span><span class="p">();</span>
    <span class="n">input</span><span class="p">.</span><span class="n">type</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">InputType</span><span class="p">.</span><span class="n">INPUT_MOUSE</span><span class="p">;</span>
    <span class="n">input</span><span class="p">.</span><span class="n">data</span> <span class="p">=</span> <span class="n">mouseInput</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">input</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">private</span> <span class="n">MOUSEINPUT</span> <span class="nf">GetMouseInput</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">mouseInput</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MOUSEINPUT</span><span class="p">();</span>
    <span class="n">mouseInput</span><span class="p">.</span><span class="n">time</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">mouseInput</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">protected</span> <span class="n">MOUSEINPUT</span> <span class="nf">MouseLeftDownEvent</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">mouseInput</span> <span class="p">=</span> <span class="nf">GetMouseInput</span><span class="p">();</span>
    <span class="n">mouseInput</span><span class="p">.</span><span class="n">dwFlags</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">MouseEventType</span><span class="p">.</span><span class="n">MOUSEEVENTF_LEFTDOWN</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">mouseInput</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">protected</span> <span class="n">MOUSEINPUT</span> <span class="nf">MouseLeftUpEvent</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">mouseInput</span> <span class="p">=</span> <span class="nf">GetMouseInput</span><span class="p">();</span>
    <span class="n">mouseInput</span><span class="p">.</span><span class="n">dwFlags</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">MouseEventType</span><span class="p">.</span><span class="n">MOUSEEVENTF_LEFTUP</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">mouseInput</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">protected</span> <span class="n">MOUSEINPUT</span> <span class="nf">MouseRightDownEvent</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">mouseInput</span> <span class="p">=</span> <span class="nf">GetMouseInput</span><span class="p">();</span>
    <span class="n">mouseInput</span><span class="p">.</span><span class="n">dwFlags</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">MouseEventType</span><span class="p">.</span><span class="n">MOUSEEVENTF_RIGHTDOWN</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">mouseInput</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">protected</span> <span class="n">MOUSEINPUT</span> <span class="nf">MouseRightUpEvent</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">mouseInput</span> <span class="p">=</span> <span class="nf">GetMouseInput</span><span class="p">();</span>
    <span class="n">mouseInput</span><span class="p">.</span><span class="n">dwFlags</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">MouseEventType</span><span class="p">.</span><span class="n">MOUSEEVENTF_RIGHTUP</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">mouseInput</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="nf">Send</span><span class="p">(</span><span class="nf">ToInput</span><span class="p">(</span><span class="nf">MouseRightDownEvent</span><span class="p">()));</span>
</code></pre></div></div>

<p>実装例: <a href="https://github.com/rubyu/CreviceApp/blob/2.0/CreviceApp/WinAPI.SendInput.cs" rel="nofollow noopener" target="_blank">CreviceApp/WinAPI.SendInput.cs at 2.0 · rubyu/CreviceApp</a></p>

<p>リンク先の実装例では、キーボードメッセージ、及び複数個のメッセージの送信にも対応しています。<code>keybd_event</code>, <code>mouse_event</code>には複数個のメッセージを、他の入力に妨げられることなく連続したものとして送信する機能がないため、<code>SendInput</code>をオススメします。</p>

<p>注意: 後述しますが、<a href="http://qiita.com/rubyu/items/88b9f93b39951252a0c1#%E7%89%B9%E5%AE%9A%E3%81%AE%E6%9D%A1%E4%BB%B6%E4%B8%8B%E3%81%A7%E3%83%95%E3%83%AA%E3%83%BC%E3%82%BA%E3%81%99%E3%82%8B"><code>SetWindowsHookEx()</code>でグローバルフックをセットしたスレッドと同一のスレッドからマウスメッセージを送信すると、特定の環境で問題が発生します。</a>このような場合は別スレッドからマウスメッセージを送信するようにしてください。</p>

<p>参考:<br>
<a href="https://msdn.microsoft.com/ja-jp/library/cc411004.aspx" rel="nofollow noopener" target="_blank">SendInput 関数</a><br>
<a href="https://msdn.microsoft.com/ja-jp/library/ms646270.aspx" rel="nofollow noopener" target="_blank">INPUT structure (Windows)</a><br>
<a href="https://msdn.microsoft.com/ja-jp/library/ms646273.aspx" rel="nofollow noopener" target="_blank">MOUSEINPUT structure (Windows)</a></p>

<h6>
<span id="その他のapi" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AEapi"><i class="fa fa-link"></i></a>その他のAPI</h6>

<p>その他のAPIとして、定番どころでは<code>SendMessage</code>, <code>PostMessage</code>などがあります。マウスジェスチャツール本体では使用しなくても、ユーザーアクションから呼び出せると便利でしょう。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">long</span> <span class="nf">SendMessage</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hWnd</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">Msg</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">wParam</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">lParam</span><span class="p">);</span>

<span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">SetLastError</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">extern</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">PostMessage</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hWnd</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">Msg</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">wParam</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">lParam</span><span class="p">);</span>
</code></pre></div></div>

<p>ウィンドウハンドルが絡むので、CreviceAppではカプセル化して簡単に扱えるようにしました。ざっくりとしたコードは以下のようなものです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Window</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">WindowInfo</span> <span class="nf">From</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hWnd</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Point</span> <span class="nf">GetCursorPos</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Point</span> <span class="nf">GetPhysicalCursorPos</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">WindowInfo</span> <span class="nf">GetForegroundWindow</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">WindowInfo</span> <span class="nf">GetPointedWindow</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">WindowInfo</span> <span class="nf">WindowFromPoint</span><span class="p">(</span><span class="n">Point</span> <span class="n">point</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">WindowInfo</span> <span class="nf">FindWindow</span><span class="p">(</span><span class="kt">string</span> <span class="n">lpClassName</span><span class="p">,</span> <span class="kt">string</span> <span class="n">lpWindowName</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">WindowInfo</span><span class="p">&gt;</span> <span class="nf">GetTopLevelWindows</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">WindowInfo</span><span class="p">&gt;</span> <span class="nf">GetThreadWindows</span><span class="p">(</span><span class="kt">uint</span> <span class="n">threadId</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">WindowInfo</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">IntPtr</span> <span class="n">WindowHandle</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">ThreadId</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">ProcessId</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">IntPtr</span> <span class="n">WindowId</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Text</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">ClassName</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">WindowInfo</span> <span class="n">Parent</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">ModulePath</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">ModuleName</span><span class="p">;</span>
    <span class="p">...</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">BringWindowToTop</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">long</span> <span class="nf">SendMessage</span><span class="p">(</span><span class="kt">uint</span> <span class="n">Msg</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">wParam</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">lParam</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">PostMessage</span><span class="p">(</span><span class="kt">uint</span> <span class="n">Msg</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">wParam</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">lParam</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">WindowInfo</span> <span class="nf">FindWindowEx</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hwndChildAfter</span><span class="p">,</span> <span class="kt">string</span> <span class="n">lpszClass</span><span class="p">,</span> <span class="kt">string</span> <span class="n">lpszWindow</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">WindowInfo</span> <span class="nf">FindWindowEx</span><span class="p">(</span><span class="kt">string</span> <span class="n">lpszClass</span><span class="p">,</span> <span class="kt">string</span> <span class="n">lpszWindow</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">WindowInfo</span><span class="p">&gt;</span> <span class="nf">GetChildWindows</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">WindowInfo</span><span class="p">&gt;</span> <span class="nf">GetPointedDescendantWindows</span><span class="p">(</span><span class="n">Point</span> <span class="n">point</span><span class="p">,</span> <span class="n">Window</span><span class="p">.</span><span class="n">WindowFromPointFlags</span> <span class="n">flags</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">WindowInfo</span><span class="p">&gt;</span> <span class="nf">GetPointedDescendantWindows</span><span class="p">(</span><span class="n">Point</span> <span class="n">point</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">ForegroundWindowInfo</span> <span class="p">:</span> <span class="n">WindowInfo</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">new</span> <span class="k">class</span> <span class="nc">NativeMethods</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="n">IntPtr</span> <span class="nf">GetForegroundWindow</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nf">ForegroundWindowInfo</span><span class="p">()</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">NativeMethods</span><span class="p">.</span><span class="nf">GetForegroundWindow</span><span class="p">())</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">PointedWindowInfo</span> <span class="p">:</span> <span class="n">WindowInfo</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">new</span> <span class="k">class</span> <span class="nc">NativeMethods</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="n">IntPtr</span> <span class="nf">WindowFromPhysicalPoint</span><span class="p">(</span><span class="n">Point</span> <span class="n">point</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nf">PointedWindowInfo</span><span class="p">(</span><span class="n">Point</span> <span class="n">point</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">NativeMethods</span><span class="p">.</span><span class="nf">WindowFromPhysicalPoint</span><span class="p">(</span><span class="n">point</span><span class="p">))</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>実装例: <a href="https://github.com/rubyu/CreviceApp/blob/2.0/CreviceApp/WinAPI.Window.cs" rel="nofollow noopener" target="_blank">CreviceApp/WinAPI.Window.cs at 2.0 · rubyu/CreviceApp</a></p>

<h5>
<span id="勝手taskscheduler" class="fragment"></span><a href="#%E5%8B%9D%E6%89%8Btaskscheduler"><i class="fa fa-link"></i></a>勝手TaskScheduler</h5>

<p>ユーザーアクションだけを隔離して、かつ実行順序を保証するために単一のスレッドで実行したいようなシーンでは、勝手TaskSchedulerを書くのがよさそうでした。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// http://www.codeguru.com/csharp/article.php/c18931/Understanding-the-NET-Task-Parallel-Library-TaskScheduler.htm</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">SingleThreadScheduler</span> <span class="p">:</span> <span class="n">TaskScheduler</span><span class="p">,</span> <span class="n">IDisposable</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">BlockingCollection</span><span class="p">&lt;</span><span class="n">Task</span><span class="p">&gt;</span> <span class="n">tasks</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BlockingCollection</span><span class="p">&lt;</span><span class="n">Task</span><span class="p">&gt;();</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Thread</span> <span class="n">thread</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">SingleThreadScheduler</span><span class="p">()</span> <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="n">ThreadPriority</span><span class="p">.</span><span class="n">Normal</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">SingleThreadScheduler</span><span class="p">(</span><span class="n">ThreadPriority</span> <span class="n">priority</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">thread</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Thread</span><span class="p">(</span><span class="k">new</span> <span class="nf">ThreadStart</span><span class="p">(</span><span class="n">Main</span><span class="p">));</span>
        <span class="k">this</span><span class="p">.</span><span class="n">thread</span><span class="p">.</span><span class="n">Priority</span> <span class="p">=</span> <span class="n">priority</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">thread</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="s">"SingleThreadScheduler was started; Thread ID: 0x{0:X}"</span><span class="p">,</span> <span class="n">Thread</span><span class="p">.</span><span class="n">CurrentThread</span><span class="p">.</span><span class="n">ManagedThreadId</span><span class="p">);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">t</span> <span class="k">in</span> <span class="n">tasks</span><span class="p">.</span><span class="nf">GetConsumingEnumerable</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="nf">TryExecuteTask</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Task</span><span class="p">&gt;</span> <span class="nf">GetScheduledTasks</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">tasks</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">QueueTask</span><span class="p">(</span><span class="n">Task</span> <span class="n">task</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">tasks</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">task</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">TryExecuteTaskInline</span><span class="p">(</span><span class="n">Task</span> <span class="n">task</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">taskWasPreviouslyQueued</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">GC</span><span class="p">.</span><span class="nf">SuppressFinalize</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="n">tasks</span><span class="p">.</span><span class="nf">CompleteAdding</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="p">~</span><span class="nf">SingleThreadScheduler</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">Dispose</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h5>
<span id="ツールチップを任意の位置に表示する" class="fragment"></span><a href="#%E3%83%84%E3%83%BC%E3%83%AB%E3%83%81%E3%83%83%E3%83%97%E3%82%92%E4%BB%BB%E6%84%8F%E3%81%AE%E4%BD%8D%E7%BD%AE%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ツールチップを任意の位置に表示する</h5>

<p>バルーンメッセージやトーストで通知するのは大仰だというときに、任意の場所にツールチップを表示できるとよいのですが、スマートにやる方法にはたどり着けませんでした。とりあえず以下のように力技でどうにかしました。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">TooltipNotifier</span> <span class="p">:</span> <span class="n">IDisposable</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">Absolute</span> <span class="p">=</span> <span class="m">0x0002</span><span class="p">;</span>

    <span class="k">private</span> <span class="n">IWin32Window</span> <span class="n">win</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">MethodInfo</span> <span class="n">SetTool</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">MethodInfo</span> <span class="n">SetTrackPosition</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">MethodInfo</span> <span class="n">StartTimer</span><span class="p">;</span>

    <span class="k">private</span> <span class="n">ToolTip</span> <span class="n">tooltip</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ToolTip</span><span class="p">();</span>

    <span class="k">public</span> <span class="nf">TooltipNotifier</span><span class="p">(</span><span class="n">IWin32Window</span> <span class="n">win</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">win</span> <span class="p">=</span> <span class="n">win</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">SetTool</span> <span class="p">=</span> <span class="n">tooltip</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="nf">GetMethod</span><span class="p">(</span><span class="s">"SetTool"</span><span class="p">,</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="n">SetTrackPosition</span> <span class="p">=</span> <span class="n">tooltip</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="nf">GetMethod</span><span class="p">(</span><span class="s">"SetTrackPosition"</span><span class="p">,</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="n">StartTimer</span> <span class="p">=</span> <span class="n">tooltip</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="nf">GetMethod</span><span class="p">(</span><span class="s">"StartTimer"</span><span class="p">,</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Show</span><span class="p">(</span><span class="kt">string</span> <span class="n">text</span><span class="p">,</span> <span class="n">Point</span> <span class="n">point</span><span class="p">,</span> <span class="kt">int</span> <span class="n">duration</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SetTrackPosition</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">(</span><span class="n">tooltip</span><span class="p">,</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[]</span> <span class="p">{</span> <span class="n">point</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">Y</span> <span class="p">});</span>
        <span class="n">SetTool</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">(</span><span class="n">tooltip</span><span class="p">,</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[]</span> <span class="p">{</span> <span class="n">win</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">Absolute</span><span class="p">,</span> <span class="n">point</span> <span class="p">});</span>
        <span class="n">StartTimer</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">(</span><span class="n">tooltip</span><span class="p">,</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[]</span> <span class="p">{</span> <span class="n">win</span><span class="p">,</span> <span class="n">duration</span> <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">GC</span><span class="p">.</span><span class="nf">SuppressFinalize</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="n">tooltip</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="p">~</span><span class="nf">TooltipNotifier</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">Dispose</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>なお、座標についてはある程度、Windows側でよしなにやってくれます。例えば1920x1080のディスプレイ環境で<code>TT.Show("どや！", 1920, 1080);</code>としても、ツールチップはタスクバー上には表示されず、タスクバーを除いたエリアの右下隅にフィットするように表示されます。</p>

<h4>
<span id="複雑さとの戦い" class="fragment"></span><a href="#%E8%A4%87%E9%9B%91%E3%81%95%E3%81%A8%E3%81%AE%E6%88%A6%E3%81%84"><i class="fa fa-link"></i></a>複雑さとの戦い</h4>

<h5>
<span id="コアロジックのfsm化" class="fragment"></span><a href="#%E3%82%B3%E3%82%A2%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E3%81%AEfsm%E5%8C%96"><i class="fa fa-link"></i></a>コアロジックのFSM化</h5>

<p>マウスジェスチャには様々な種類があります。ボタンを押したままマウスを動かすストロークジェスチャ、あるボタンを押したまま他のボタンを押すロッカージェスチャ、あるいは単にあるボタンを押すという動作もジェスチャとして扱いたいかもしれません。それらの全てをフラグで管理していたのでは大変ですし、とても保守できる気がしません。何かスマートな解決策が必要です。</p>

<p>そこで同時に押すボタンは2つまでとして、</p>

<ol>
<li>初期状態: 何もボタンは押されていない</li>
<li>1つめのボタンが押されている</li>
<li>2つめのボタンが押されている</li>
</ol>

<p>という3つの状態を考えれば、これらは明らかに有限で、その遷移も明白なように見えます。有限状態マシンで実装するのがよさそうです。この2番目の状態を、「ジェスチャを開始したボタンを復元できるかどうか」でさらに2つに分けて、次のような合計4つの状態を考えました。</p>

<ol>
<li>初期状態: 何もボタンは押されていない</li>
<li>1つめのボタンが押されている (ジェスチャ開始ボタンは復元できる)</li>
<li>1つめのボタンが押されている (ジェスチャ開始ボタンは復元できない)</li>
<li>2つめのボタンが押されている</li>
</ol>

<p>実装としては次のようなものです。なお、<code>シングルアクションボタン</code>は<code>WheelUp</code>, <code>WheelDown</code>, <code>WheelLeft</code>, <code>WheelRight</code>のいずれか、<code>ダブルアクションボタン</code>は<code>Left</code>, <code>Middle</code>, <code>Right</code>, <code>X1</code>, <code>X2</code>のいずれかです。後者にはボタンの押下と開放に対応した、<code>セット</code>と<code>リリース</code>の2種があるとします。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">res</span> <span class="p">=</span> <span class="n">State</span><span class="p">.</span><span class="nf">Input</span><span class="p">(</span><span class="n">evnt</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>   
<span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="nf">GetType</span><span class="p">()</span> <span class="p">!=</span> <span class="n">res</span><span class="p">.</span><span class="n">NextState</span><span class="p">.</span><span class="nf">GetType</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="s">"The state of GestureMachine was changed: {0} -&gt; {1}"</span><span class="p">,</span> <span class="n">State</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">NextState</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">State</span> <span class="p">=</span> <span class="n">res</span><span class="p">.</span><span class="n">NextState</span><span class="p">;</span>
<span class="k">return</span> <span class="n">res</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">IsConsumed</span><span class="p">;</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IState</span>
<span class="p">{</span>
    <span class="n">Result</span> <span class="nf">Input</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">IEvent</span> <span class="n">evnt</span><span class="p">,</span> <span class="n">Point</span> <span class="n">point</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">State</span> <span class="p">:</span> <span class="n">IState</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">virtual</span> <span class="n">Result</span> <span class="nf">Input</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">IEvent</span> <span class="n">evnt</span><span class="p">,</span> <span class="n">Point</span> <span class="n">point</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Result</span><span class="p">.</span><span class="nf">EventIsRemained</span><span class="p">(</span><span class="n">nextState</span><span class="p">:</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">State0</span> <span class="p">:</span> <span class="n">State</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">Result</span> <span class="nf">Input</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">IEvent</span> <span class="n">evnt</span><span class="p">,</span> <span class="n">Point</span> <span class="n">point</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="err">シングルアクションボタン</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="err">ジェスチャが存在する</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// ユーザーアクションの実行</span>
                <span class="k">return</span> <span class="n">Result</span><span class="p">.</span><span class="nf">EventIsConsumed</span><span class="p">(</span><span class="n">nextState</span><span class="p">:</span> <span class="k">this</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="err">ダブルアクションボタンのセット</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="err">ジェスチャが存在する</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">Result</span><span class="p">.</span><span class="nf">EventIsConsumed</span><span class="p">(</span><span class="n">nextState</span><span class="p">:</span> <span class="k">new</span> <span class="nf">State1</span><span class="p">(...));</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">base</span><span class="p">.</span><span class="nf">Input</span><span class="p">(</span><span class="n">evnt</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">State1</span> <span class="p">:</span> <span class="n">State</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">Result</span> <span class="nf">Input</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">IEvent</span> <span class="n">evnt</span><span class="p">,</span> <span class="n">Point</span> <span class="n">point</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ストロークの監視クラスにpointを渡す</span>

        <span class="k">if</span> <span class="p">(</span><span class="err">シングルアクションボタン</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="err">ジェスチャが存在する</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// ユーザーアクションの実行</span>
                <span class="k">return</span> <span class="n">Result</span><span class="p">.</span><span class="nf">EventIsConsumed</span><span class="p">(</span><span class="n">nextState</span><span class="p">:</span> <span class="k">new</span> <span class="nf">State2</span><span class="p">(...));</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="err">ダブルアクションボタンのセット</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="err">ジェスチャが存在する</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">Result</span><span class="p">.</span><span class="nf">EventIsConsumed</span><span class="p">(</span><span class="n">nextState</span><span class="p">:</span> <span class="k">new</span> <span class="nf">State3</span><span class="p">(...));</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="err">ダブルアクションボタンのリリース</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="err">入力が</span><span class="m">1</span><span class="err">番目に押されたボタンのペアなら</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="err">ストロークの入力がある</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="err">ジェスチャが存在する</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="c1">// ユーザーアクションの実行</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="err">ジェスチャが存在する</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="c1">// ユーザーアクションの実行</span>
                    <span class="p">}</span>
                    <span class="k">else</span>
                    <span class="p">{</span>
                        <span class="c1">// 1番目に押されたボタンのクリックを復元する</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">Result</span><span class="p">.</span><span class="nf">EventIsConsumed</span><span class="p">(</span><span class="n">nextState</span><span class="p">:</span> <span class="n">S0</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">base</span><span class="p">.</span><span class="nf">Input</span><span class="p">(</span><span class="n">evnt</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">State2</span> <span class="p">:</span> <span class="n">State</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">Result</span> <span class="nf">Input</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">IEvent</span> <span class="n">evnt</span><span class="p">,</span> <span class="n">Point</span> <span class="n">point</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ストロークの監視クラスにpointを渡す</span>

        <span class="k">if</span> <span class="p">(</span><span class="err">シングルアクションボタン</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="err">ジェスチャが存在する</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// ユーザーアクションの実行</span>
                <span class="k">return</span> <span class="n">Result</span><span class="p">.</span><span class="nf">EventIsConsumed</span><span class="p">(</span><span class="n">nextState</span><span class="p">:</span> <span class="k">new</span> <span class="nf">State2</span><span class="p">(...));</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="err">ダブルアクションボタンのセット</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="err">ジェスチャが存在する</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">Result</span><span class="p">.</span><span class="nf">EventIsConsumed</span><span class="p">(</span><span class="n">nextState</span><span class="p">:</span> <span class="k">new</span> <span class="nf">State3</span><span class="p">(...));</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="err">ダブルアクションボタンのリリース</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="err">入力が</span><span class="m">1</span><span class="err">番目に押されたボタンのペアなら</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="err">ストロークの入力がある</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="err">ジェスチャが存在する</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="c1">// ユーザーアクションの実行</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">Result</span><span class="p">.</span><span class="nf">EventIsConsumed</span><span class="p">(</span><span class="n">nextState</span><span class="p">:</span> <span class="n">S0</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">base</span><span class="p">.</span><span class="nf">Input</span><span class="p">(</span><span class="n">evnt</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">State3</span> <span class="p">:</span> <span class="n">State</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">Result</span> <span class="nf">Input</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">IEvent</span> <span class="n">evnt</span><span class="p">,</span> <span class="n">Point</span> <span class="n">point</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="err">ダブルアクションボタンのリリース</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="err">入力が</span><span class="m">2</span><span class="err">番目に押されたボタンのペアなら</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// ユーザーアクションの実行</span>
                <span class="k">return</span> <span class="n">Result</span><span class="p">.</span><span class="nf">EventIsConsumed</span><span class="p">(</span><span class="n">nextState</span><span class="p">:</span> <span class="n">S2</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="err">入力が</span><span class="m">1</span><span class="err">番目に押されたボタンのペアなら</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// 2番目に押されたボタンを「次回は無視する」リストに入れる</span>
                <span class="k">return</span> <span class="n">Result</span><span class="p">.</span><span class="nf">EventIsConsumed</span><span class="p">(</span><span class="n">nextState</span><span class="p">:</span> <span class="n">S0</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">base</span><span class="p">.</span><span class="nf">Input</span><span class="p">(</span><span class="n">evnt</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>どうでしょうか、状態ごとに分けて考えると、それほど難しくないと思います。全ての遷移を書き出して、それに対応するコードとテストを書いていくと安心です。</p>

<p>遷移の例: <a href="https://github.com/rubyu/CreviceApp/blob/2.0/CreviceApp/Core.FSM.Transition.cs" rel="nofollow noopener" target="_blank">CreviceApp/Core.FSM.Transition.cs at 2.0 · rubyu/CreviceApp</a></p>

<h5>
<span id="guiでの設定を諦めるroslynのススメ" class="fragment"></span><a href="#gui%E3%81%A7%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E8%AB%A6%E3%82%81%E3%82%8Broslyn%E3%81%AE%E3%82%B9%E3%82%B9%E3%83%A1"><i class="fa fa-link"></i></a>GUIでの設定を諦める（Roslynのススメ）</h5>

<p>多岐にわたるマウスジェスチャツールの用途を網羅するような、万能な設定をGUIで作り込むには途方もない時間がかかりそうです。CreviceAppの場合、1人しか使う予定がないマウスジェスチャツールのために膨大な人月をつぎ込むのは明らかに誤りでした。ここはスッパリとGUIを切り捨てて、テキストベースで設定を行えるようにしましょう。もちろん、テキストベースといっても、独自のスクリプトを作り込んだりするのも明らかに時間の無駄です。ちょうどMicrosoft Roslynの安定版がリリースされた頃だったので、これをマウスジェスチャツールに組み込みました。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Core</span><span class="p">.</span><span class="n">GestureDefinition</span><span class="p">&gt;</span> <span class="nf">EvaluateUserScriptAsync</span><span class="p">(</span><span class="n">Core</span><span class="p">.</span><span class="n">UserScriptExecutionContext</span> <span class="n">ctx</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">script</span> <span class="p">=</span> <span class="n">CSharpScript</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span>
        <span class="nf">GetDefaultUserScript</span><span class="p">(),</span>
        <span class="n">ScriptOptions</span><span class="p">.</span><span class="n">Default</span>
            <span class="p">.</span><span class="nf">WithSourceResolver</span><span class="p">(</span><span class="n">ScriptSourceResolver</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">WithBaseDirectory</span><span class="p">(</span><span class="n">UserDirectory</span><span class="p">))</span>
            <span class="p">.</span><span class="nf">WithMetadataResolver</span><span class="p">(</span><span class="n">ScriptMetadataResolver</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">WithBaseDirectory</span><span class="p">(</span><span class="n">UserDirectory</span><span class="p">))</span>
            <span class="p">.</span><span class="nf">WithReferences</span><span class="p">(</span><span class="s">"microlib"</span><span class="p">)</span>                   <span class="c1">// microlib.dll</span>
            <span class="p">.</span><span class="nf">WithReferences</span><span class="p">(</span><span class="s">"System"</span><span class="p">)</span>                     <span class="c1">// System.dll</span>
            <span class="p">.</span><span class="nf">WithReferences</span><span class="p">(</span><span class="s">"System.Core"</span><span class="p">)</span>                <span class="c1">// System.Core.dll</span>
            <span class="p">.</span><span class="nf">WithReferences</span><span class="p">(</span><span class="s">"Microsoft.CSharp"</span><span class="p">)</span>           <span class="c1">// Microsoft.CSharp.dll</span>
            <span class="p">.</span><span class="nf">WithReferences</span><span class="p">(</span><span class="n">Assembly</span><span class="p">.</span><span class="nf">GetEntryAssembly</span><span class="p">()),</span> <span class="c1">// CreviceApp.exe</span>
        <span class="n">globalsType</span><span class="p">:</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Core</span><span class="p">.</span><span class="n">UserScriptExecutionContext</span><span class="p">));</span>
    <span class="n">script</span><span class="p">.</span><span class="nf">Compile</span><span class="p">();</span>
    <span class="n">script</span><span class="p">.</span><span class="nf">RunAsync</span><span class="p">(</span><span class="n">ctx</span><span class="p">).</span><span class="nf">Wait</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">ctx</span><span class="p">.</span><span class="nf">GetGestureDefinition</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">protected</span> <span class="k">void</span> <span class="nf">InitializeGestureMachine</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">ctx</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Core</span><span class="p">.</span><span class="nf">UserScriptExecutionContext</span><span class="p">(</span><span class="n">Global</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">gestureDef</span> <span class="p">=</span> <span class="nf">EvaluateUserScriptAsync</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="n">GestureMachine</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Core</span><span class="p">.</span><span class="n">FSM</span><span class="p">.</span><span class="nf">GestureMachine</span><span class="p">(</span><span class="n">Global</span><span class="p">.</span><span class="n">UserConfig</span><span class="p">,</span> <span class="n">gestureDef</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>たったこれだけのコードで、csxファイルをコンパイルして実行できます。後は設定を表現するDSLを定義して、コードに書き下していけばいいだけです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>WHEN                  ::= @when(WHEN_FUNC)           ( ON | IF_A | IF_B )

ON                    ::= @on(DOUBLE_TRIGGER_BUTTON) ( IF_A | IF_B | IF_C )

IF_A                  ::= @if(DOUBLE_TRIGGER_BUTTON) [ BEFORE ] DO [ AFTER ]

IF_B                  ::= @if(SINGLE_TRIGGER_BUTTON)   DO

IF_C                  ::= @if(MOVE *)                  DO

BEFORE                ::= @before(BEFORE_FUNC)

DO                    ::= @do(DO_FUNC) 

AFTER                 ::= @after(AFTER_FUNC)

DOUBLE_TRIGGER_BUTTON ::= L | M | R | X1 | X2

SINGLE_TRIGGER_BUTTON ::= W_UP | W_DOWN | W_LEFT | W_RIGHT

MOVE                  ::= MOVE_UP | MOVE_DOWN | MOVE_LEFT | MOVE_RIGHT

WHEN_FUNC             ::= delegate bool

BEFORE_FUNC           ::= delegate void

DO_FUNC               ::= delegate void

AFTER_FUNC            ::= delegate void
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Def</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">delegate</span> <span class="kt">bool</span> <span class="nf">WhenFunc</span><span class="p">(</span><span class="n">Core</span><span class="p">.</span><span class="n">UserActionExecutionContext</span> <span class="n">ctx</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">BeforeFunc</span><span class="p">(</span><span class="n">Core</span><span class="p">.</span><span class="n">UserActionExecutionContext</span> <span class="n">ctx</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">DoFunc</span><span class="p">(</span><span class="n">Core</span><span class="p">.</span><span class="n">UserActionExecutionContext</span> <span class="n">ctx</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">AfterFunc</span><span class="p">(</span><span class="n">Core</span><span class="p">.</span><span class="n">UserActionExecutionContext</span> <span class="n">ctx</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">interface</span> <span class="nc">Button</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">AcceptableInOnClause</span> <span class="p">:</span> <span class="n">Button</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">AcceptableInIfButtonClause</span> <span class="p">:</span> <span class="n">Button</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">AcceptableInIfSingleTriggerButtonClause</span> <span class="p">:</span> <span class="n">AcceptableInIfButtonClause</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">AcceptableInIfDoubleTriggerButtonClause</span> <span class="p">:</span> <span class="n">AcceptableInIfButtonClause</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">LeftButton</span>   <span class="p">:</span> <span class="n">AcceptableInOnClause</span><span class="p">,</span> <span class="n">AcceptableInIfDoubleTriggerButtonClause</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MiddleButton</span> <span class="p">:</span> <span class="n">AcceptableInOnClause</span><span class="p">,</span> <span class="n">AcceptableInIfDoubleTriggerButtonClause</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">RightButton</span>  <span class="p">:</span> <span class="n">AcceptableInOnClause</span><span class="p">,</span> <span class="n">AcceptableInIfDoubleTriggerButtonClause</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">WheelUp</span>      <span class="p">:</span>                       <span class="n">AcceptableInIfSingleTriggerButtonClause</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">WheelDown</span>    <span class="p">:</span>                       <span class="n">AcceptableInIfSingleTriggerButtonClause</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">WheelLeft</span>    <span class="p">:</span>                       <span class="n">AcceptableInIfSingleTriggerButtonClause</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">WheelRight</span>   <span class="p">:</span>                       <span class="n">AcceptableInIfSingleTriggerButtonClause</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">X1Button</span>     <span class="p">:</span> <span class="n">AcceptableInOnClause</span><span class="p">,</span> <span class="n">AcceptableInIfDoubleTriggerButtonClause</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">X2Button</span>     <span class="p">:</span> <span class="n">AcceptableInOnClause</span><span class="p">,</span> <span class="n">AcceptableInIfDoubleTriggerButtonClause</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">interface</span> <span class="nc">Move</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">AcceptableInIfStrokeClause</span> <span class="p">:</span> <span class="n">Move</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MoveUp</span>    <span class="p">:</span> <span class="n">AcceptableInIfStrokeClause</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MoveDown</span>  <span class="p">:</span> <span class="n">AcceptableInIfStrokeClause</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MoveLeft</span>  <span class="p">:</span> <span class="n">AcceptableInIfStrokeClause</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MoveRight</span> <span class="p">:</span> <span class="n">AcceptableInIfStrokeClause</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">ConstantSingleton</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">static</span> <span class="n">ConstantSingleton</span> <span class="n">singleton</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConstantSingleton</span><span class="p">();</span>

        <span class="k">public</span> <span class="k">readonly</span> <span class="n">LeftButton</span>   <span class="n">LeftButton</span>      <span class="p">=</span> <span class="k">new</span> <span class="nf">LeftButton</span><span class="p">();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">MiddleButton</span> <span class="n">MiddleButton</span>    <span class="p">=</span> <span class="k">new</span> <span class="nf">MiddleButton</span><span class="p">();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">RightButton</span>  <span class="n">RightButton</span>     <span class="p">=</span> <span class="k">new</span> <span class="nf">RightButton</span><span class="p">();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">WheelDown</span>    <span class="n">WheelDown</span>       <span class="p">=</span> <span class="k">new</span> <span class="nf">WheelDown</span><span class="p">();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">WheelUp</span>      <span class="n">WheelUp</span>         <span class="p">=</span> <span class="k">new</span> <span class="nf">WheelUp</span><span class="p">();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">WheelLeft</span>    <span class="n">WheelLeft</span>       <span class="p">=</span> <span class="k">new</span> <span class="nf">WheelLeft</span><span class="p">();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">WheelRight</span>   <span class="n">WheelRight</span>      <span class="p">=</span> <span class="k">new</span> <span class="nf">WheelRight</span><span class="p">();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">X1Button</span>     <span class="n">X1Button</span>        <span class="p">=</span> <span class="k">new</span> <span class="nf">X1Button</span><span class="p">();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">X2Button</span>     <span class="n">X2Button</span>        <span class="p">=</span> <span class="k">new</span> <span class="nf">X2Button</span><span class="p">();</span>

        <span class="k">public</span> <span class="k">readonly</span> <span class="n">MoveUp</span>    <span class="n">MoveUp</span>    <span class="p">=</span> <span class="k">new</span> <span class="nf">MoveUp</span><span class="p">();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">MoveDown</span>  <span class="n">MoveDown</span>  <span class="p">=</span> <span class="k">new</span> <span class="nf">MoveDown</span><span class="p">();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">MoveLeft</span>  <span class="n">MoveLeft</span>  <span class="p">=</span> <span class="k">new</span> <span class="nf">MoveLeft</span><span class="p">();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">MoveRight</span> <span class="n">MoveRight</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MoveRight</span><span class="p">();</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">ConstantSingleton</span> <span class="nf">GetInstance</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">singleton</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="n">ConstantSingleton</span> <span class="n">Constant</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ConstantSingleton</span><span class="p">.</span><span class="nf">GetInstance</span><span class="p">();</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Root</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">WhenElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">whenElements</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">WhenElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;();</span>

    <span class="k">public</span> <span class="n">WhenElement</span> <span class="nf">@when</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">WhenFunc</span> <span class="n">func</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">WhenElement</span><span class="p">(</span><span class="n">whenElements</span><span class="p">,</span> <span class="n">func</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">WhenElement</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Value</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IfSingleTriggerButtonElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">ifSingleTriggerButtonElements</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IfSingleTriggerButtonElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IfDoubleTriggerButtonElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">ifDoubleTriggerButtonElements</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IfDoubleTriggerButtonElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">OnElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">onElements</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">OnElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">Def</span><span class="p">.</span><span class="n">WhenFunc</span> <span class="n">func</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">Value</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">WhenFunc</span> <span class="n">func</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">func</span> <span class="p">=</span> <span class="n">func</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Value</span> <span class="k">value</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">WhenElement</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">parent</span><span class="p">,</span> <span class="n">Def</span><span class="p">.</span><span class="n">WhenFunc</span> <span class="n">func</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="k">value</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Value</span><span class="p">(</span><span class="n">func</span><span class="p">);</span>
        <span class="n">parent</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="k">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">OnElement</span> <span class="nf">@on</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInOnClause</span> <span class="n">button</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">OnElement</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">onElements</span><span class="p">,</span> <span class="n">button</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IfSingleTriggerButtonElement</span> <span class="nf">@if</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInIfSingleTriggerButtonClause</span> <span class="n">button</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">IfSingleTriggerButtonElement</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">ifSingleTriggerButtonElements</span><span class="p">,</span> <span class="n">button</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IfDoubleTriggerButtonElement</span> <span class="nf">@if</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInIfDoubleTriggerButtonClause</span> <span class="n">button</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">IfDoubleTriggerButtonElement</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">ifDoubleTriggerButtonElements</span><span class="p">,</span> <span class="n">button</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">OnElement</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Value</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IfSingleTriggerButtonElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">ifSingleTriggerButtonElements</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IfSingleTriggerButtonElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IfDoubleTriggerButtonElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">ifDoubleTriggerButtonElements</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IfDoubleTriggerButtonElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IfStrokeElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">ifStrokeElements</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IfStrokeElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInOnClause</span> <span class="n">button</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">Value</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInOnClause</span> <span class="n">button</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">button</span> <span class="p">=</span> <span class="n">button</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Value</span> <span class="k">value</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">OnElement</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">parent</span><span class="p">,</span> <span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInOnClause</span> <span class="n">button</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="k">value</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Value</span><span class="p">(</span><span class="n">button</span><span class="p">);</span>
        <span class="n">parent</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="k">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IfSingleTriggerButtonElement</span> <span class="nf">@if</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInIfSingleTriggerButtonClause</span> <span class="n">button</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">IfSingleTriggerButtonElement</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">ifSingleTriggerButtonElements</span><span class="p">,</span> <span class="n">button</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IfDoubleTriggerButtonElement</span> <span class="nf">@if</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInIfDoubleTriggerButtonClause</span> <span class="n">button</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">IfDoubleTriggerButtonElement</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">ifDoubleTriggerButtonElements</span><span class="p">,</span> <span class="n">button</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IfStrokeElement</span> <span class="nf">@if</span><span class="p">(</span><span class="k">params</span> <span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInIfStrokeClause</span><span class="p">[]</span> <span class="n">moves</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">IfStrokeElement</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">ifStrokeElements</span><span class="p">,</span> <span class="n">moves</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">IfStrokeElement</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Value</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SingleTriggerDoElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">doElements</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SingleTriggerDoElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;();</span>

        <span class="k">public</span> <span class="k">readonly</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInIfStrokeClause</span><span class="p">&gt;</span> <span class="n">moves</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">Value</span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInIfStrokeClause</span><span class="p">&gt;</span> <span class="n">moves</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">moves</span> <span class="p">=</span> <span class="n">moves</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Value</span> <span class="k">value</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">IfStrokeElement</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">parent</span><span class="p">,</span> <span class="k">params</span> <span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInIfStrokeClause</span><span class="p">[]</span> <span class="n">moves</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="k">value</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Value</span><span class="p">(</span><span class="n">moves</span><span class="p">);</span>
        <span class="n">parent</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="k">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">SingleTriggerDoElement</span> <span class="nf">@do</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">DoFunc</span> <span class="n">func</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">SingleTriggerDoElement</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">doElements</span><span class="p">,</span> <span class="n">func</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">IfSingleTriggerButtonElement</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Value</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SingleTriggerDoElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">doElements</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SingleTriggerDoElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;();</span>

        <span class="k">public</span> <span class="k">readonly</span> <span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInIfSingleTriggerButtonClause</span> <span class="n">button</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">Value</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInIfSingleTriggerButtonClause</span> <span class="n">button</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">button</span> <span class="p">=</span> <span class="n">button</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Value</span> <span class="k">value</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">IfSingleTriggerButtonElement</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">parent</span><span class="p">,</span> <span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInIfSingleTriggerButtonClause</span> <span class="n">button</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="k">value</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Value</span><span class="p">(</span><span class="n">button</span><span class="p">);</span>
        <span class="n">parent</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="k">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">SingleTriggerDoElement</span> <span class="nf">@do</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">DoFunc</span> <span class="n">func</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">SingleTriggerDoElement</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">doElements</span><span class="p">,</span> <span class="n">func</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">SingleTriggerDoElement</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Value</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">Def</span><span class="p">.</span><span class="n">DoFunc</span> <span class="n">func</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">Value</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">DoFunc</span> <span class="n">func</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">func</span> <span class="p">=</span> <span class="n">func</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nf">SingleTriggerDoElement</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">parent</span><span class="p">,</span> <span class="n">Def</span><span class="p">.</span><span class="n">DoFunc</span> <span class="n">func</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">parent</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Value</span><span class="p">(</span><span class="n">func</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">IfDoubleTriggerButtonElement</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Value</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DoubleTriggerBeforeElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">beforeElements</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DoubleTriggerBeforeElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DoubleTriggerDoElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">doElements</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DoubleTriggerDoElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;();</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DoubleTriggerAfterElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">afterElements</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DoubleTriggerAfterElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;();</span>

        <span class="k">public</span> <span class="k">readonly</span> <span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInIfDoubleTriggerButtonClause</span> <span class="n">button</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">Value</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInIfDoubleTriggerButtonClause</span> <span class="n">button</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">button</span> <span class="p">=</span> <span class="n">button</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Value</span> <span class="k">value</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">IfDoubleTriggerButtonElement</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">parent</span><span class="p">,</span> <span class="n">Def</span><span class="p">.</span><span class="n">AcceptableInIfDoubleTriggerButtonClause</span> <span class="n">button</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="k">value</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Value</span><span class="p">(</span><span class="n">button</span><span class="p">);</span>
        <span class="n">parent</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="k">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">DoubleTriggerBeforeElement</span> <span class="nf">@before</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">BeforeFunc</span> <span class="n">func</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">DoubleTriggerBeforeElement</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">beforeElements</span><span class="p">,</span> <span class="k">value</span><span class="p">.</span><span class="n">doElements</span><span class="p">,</span> <span class="k">value</span><span class="p">.</span><span class="n">afterElements</span><span class="p">,</span> <span class="n">func</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">DoubleTriggerDoElement</span> <span class="nf">@do</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">DoFunc</span> <span class="n">func</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">DoubleTriggerDoElement</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">doElements</span><span class="p">,</span> <span class="k">value</span><span class="p">.</span><span class="n">afterElements</span><span class="p">,</span> <span class="n">func</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">DoubleTriggerAfterElement</span> <span class="nf">@after</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">AfterFunc</span> <span class="n">func</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">DoubleTriggerAfterElement</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">afterElements</span><span class="p">,</span> <span class="n">func</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">DoubleTriggerBeforeElement</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Value</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">Def</span><span class="p">.</span><span class="n">BeforeFunc</span> <span class="n">func</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">Value</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">BeforeFunc</span> <span class="n">func</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">func</span> <span class="p">=</span> <span class="n">func</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DoubleTriggerDoElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">doParent</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DoubleTriggerAfterElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">afterParent</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">DoubleTriggerBeforeElement</span><span class="p">(</span>
        <span class="n">List</span><span class="p">&lt;</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">parentA</span><span class="p">,</span> 
        <span class="n">List</span><span class="p">&lt;</span><span class="n">DoubleTriggerDoElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">parentB</span><span class="p">,</span>
        <span class="n">List</span><span class="p">&lt;</span><span class="n">DoubleTriggerAfterElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">parentC</span><span class="p">,</span>
        <span class="n">Def</span><span class="p">.</span><span class="n">BeforeFunc</span> <span class="n">func</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">parentA</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Value</span><span class="p">(</span><span class="n">func</span><span class="p">));</span>
        <span class="n">doParent</span> <span class="p">=</span> <span class="n">parentB</span><span class="p">;</span>
        <span class="n">afterParent</span> <span class="p">=</span> <span class="n">parentC</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">DoubleTriggerDoElement</span> <span class="nf">@do</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">DoFunc</span> <span class="n">func</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">DoubleTriggerDoElement</span><span class="p">(</span><span class="n">doParent</span><span class="p">,</span> <span class="n">afterParent</span><span class="p">,</span> <span class="n">func</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">DoubleTriggerAfterElement</span> <span class="nf">@after</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">AfterFunc</span> <span class="n">func</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">DoubleTriggerAfterElement</span><span class="p">(</span><span class="n">afterParent</span><span class="p">,</span> <span class="n">func</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">DoubleTriggerDoElement</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Value</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">Def</span><span class="p">.</span><span class="n">DoFunc</span> <span class="n">func</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">Value</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">DoFunc</span> <span class="n">func</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">func</span> <span class="p">=</span> <span class="n">func</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DoubleTriggerAfterElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">afterParent</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">DoubleTriggerDoElement</span><span class="p">(</span>
        <span class="n">List</span><span class="p">&lt;</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">parentA</span><span class="p">,</span> 
        <span class="n">List</span><span class="p">&lt;</span><span class="n">DoubleTriggerAfterElement</span><span class="p">.</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">parentB</span><span class="p">,</span> 
        <span class="n">Def</span><span class="p">.</span><span class="n">DoFunc</span> <span class="n">func</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">parentA</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Value</span><span class="p">(</span><span class="n">func</span><span class="p">));</span>
        <span class="n">afterParent</span> <span class="p">=</span> <span class="n">parentB</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">DoubleTriggerAfterElement</span> <span class="nf">@after</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">AfterFunc</span> <span class="n">func</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">DoubleTriggerAfterElement</span><span class="p">(</span><span class="n">afterParent</span><span class="p">,</span> <span class="n">func</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">DoubleTriggerAfterElement</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Value</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="n">Def</span><span class="p">.</span><span class="n">AfterFunc</span> <span class="n">func</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">Value</span><span class="p">(</span><span class="n">Def</span><span class="p">.</span><span class="n">AfterFunc</span> <span class="n">func</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">func</span> <span class="p">=</span> <span class="n">func</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nf">DoubleTriggerAfterElement</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Value</span><span class="p">&gt;</span> <span class="n">parent</span><span class="p">,</span> <span class="n">Def</span><span class="p">.</span><span class="n">AfterFunc</span> <span class="n">func</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">parent</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Value</span><span class="p">(</span><span class="n">func</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>あとはこの<code>@when</code>から始まるDSLで記述された設定を、扱いやすいようにパースしていけばいいでしょう。</p>

<p>パーサの実装例: <a href="https://github.com/rubyu/CreviceApp/blob/2.0/CreviceApp/Core.DSLTreeParser.cs" rel="nofollow noopener" target="_blank">CreviceApp/Core.DSLTreeParser.cs at 2.0 · rubyu/CreviceApp</a></p>

<h4>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h4>

<p>ここまで簡単にマウスジェスチャツールの作り方を解説してきました。要するに、</p>

<ul>
<li>フックを掛ける</li>
<li>コールバック関数にマウスメッセージが渡される</li>
<li>コールバック関数内でジェスチャに関する処理を行う</li>
<li>マウスメッセージを通すか通さないかを結果として返す</li>
</ul>

<p>これだけです。ここまで読んでくれたあなたなら、きっとマウスジェスチャツールを実装できます。</p>

<p>そしていざ、マウスジェスチャツールを実装するときに注意してほしいことがあります。それは<strong>レイテンシ</strong>です。与えられたマウスメッセージは可能な限り迅速に処理しなければなりません。コールバック関数内でマウスメッセージを処理している間の時間が、ラグとしてユーザーのエクスペリエンスに影響を与えます。また、後述しますが、あまりにもラグが酷いと、フックがシステムによって外されてしまうこともあり得ます。<strong>低レイテンシ</strong>を心がけてください。<br>
CreviceAppが行っている低レイテンシのための対策としては、</p>

<ul>
<li>ユーザーアクションは別スレッドで行う</li>
<li>カーソルの移動メッセージはある程度処理を間引く</li>
<li>カーソルの移動メッセージからジェスチャのストロークへの変換は別スレッドで行う</li>
</ul>

<p>などがあります。</p>

<h4>
<span id="トラブルシューティング" class="fragment"></span><a href="#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>トラブルシューティング</h4>

<h5>
<span id="うまくフックがかからない-1" class="fragment"></span><a href="#%E3%81%86%E3%81%BE%E3%81%8F%E3%83%95%E3%83%83%E3%82%AF%E3%81%8C%E3%81%8B%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84-1"><i class="fa fa-link"></i></a>うまくフックがかからない (1)</h5>

<p><code>SetWindowsHookEx()</code>をコールしたスレッドはメッセージループを持っていますか？ </p>

<p><a href="http://stackoverflow.com/questions/7458807/why-must-setwindowshookex-be-used-with-a-windows-message-queue" rel="nofollow noopener" target="_blank">c++ - Why must SetWindowsHookEx be used with a windows message queue - Stack Overflow</a></p>

<h5>
<span id="うまくフックがかからない-2" class="fragment"></span><a href="#%E3%81%86%E3%81%BE%E3%81%8F%E3%83%95%E3%83%83%E3%82%AF%E3%81%8C%E3%81%8B%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84-2"><i class="fa fa-link"></i></a>うまくフックがかからない (2)</h5>

<p>もしかして<code>WH_MOUSE</code>でフックを掛けようとしていませんか？ C#でやるにはかなり茨の道だと思われますので、必要がなければ<code>WH_MOUSE_LL</code>を使ったほうがいいような気がします。</p>

<h5>
<span id="うまくフックがかからない-3" class="fragment"></span><a href="#%E3%81%86%E3%81%BE%E3%81%8F%E3%83%95%E3%83%83%E3%82%AF%E3%81%8C%E3%81%8B%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84-3"><i class="fa fa-link"></i></a>うまくフックがかからない (3)</h5>

<p><a href="http://final.hateblo.jp/entry/2016/08/07/185340" rel="nofollow noopener" target="_blank">C#でWin32 API(グローバルフック等)を使用してデバッグすると「指定されたモジュールが見つかりません」と表示されたとき。 - Code for final</a></p>

<blockquote>
<p>「Visual Studio ホスティング プロセスを有効にする」チェックをはずすと普通に動いた。</p>
</blockquote>

<h5>
<span id="フックは動作するがしばらくするとエラーで終了してしまう" class="fragment"></span><a href="#%E3%83%95%E3%83%83%E3%82%AF%E3%81%AF%E5%8B%95%E4%BD%9C%E3%81%99%E3%82%8B%E3%81%8C%E3%81%97%E3%81%B0%E3%82%89%E3%81%8F%E3%81%99%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%A7%E7%B5%82%E4%BA%86%E3%81%97%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86"><i class="fa fa-link"></i></a>フックは動作するが、しばらくするとエラーで終了してしまう</h5>

<p>恐らくCallback関数がGCに回収されてしまうことが原因です。前述のコードに以下の修正を加えてください。具体的には、delegateとして変数に保持していれば大丈夫です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">delegate</span> <span class="n">IntPtr</span> <span class="nf">MouseCallback</span><span class="p">(</span><span class="kt">int</span> <span class="n">nCode</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">lParam</span><span class="p">);</span>
<span class="k">private</span> <span class="k">readonly</span> <span class="n">MouseCallback</span> <span class="n">mouseCallback</span><span class="p">;</span>

<span class="k">public</span> <span class="err">コンストラクタ</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">mouseCallback</span> <span class="p">=</span> <span class="n">Callback</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">SetHook</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">hInstance</span> <span class="p">=</span> <span class="nf">GetModuleHandle</span><span class="p">(</span><span class="n">Process</span><span class="p">.</span><span class="nf">GetCurrentProcess</span><span class="p">().</span><span class="n">MainModule</span><span class="p">.</span><span class="n">ModuleName</span><span class="p">);</span>
    <span class="n">hHook</span> <span class="p">=</span> <span class="nf">SetWindowsHookEx</span><span class="p">(</span><span class="n">WH_MOUSE_LL</span><span class="p">,</span> <span class="n">mouseCallback</span><span class="p">,</span> <span class="n">hInstance</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h5>
<span id="フックは動作するが勝手に無効になることがある" class="fragment"></span><a href="#%E3%83%95%E3%83%83%E3%82%AF%E3%81%AF%E5%8B%95%E4%BD%9C%E3%81%99%E3%82%8B%E3%81%8C%E5%8B%9D%E6%89%8B%E3%81%AB%E7%84%A1%E5%8A%B9%E3%81%AB%E3%81%AA%E3%82%8B%E3%81%93%E3%81%A8%E3%81%8C%E3%81%82%E3%82%8B"><i class="fa fa-link"></i></a>フックは動作するが、勝手に無効になることがある</h5>

<p>もしかして、ロジックの実行に時間がかかりすぎたりしていませんか？</p>

<p><a href="https://blogs.msdn.microsoft.com/alejacma/2010/10/14/global-hooks-getting-lost-on-windows-7/" rel="nofollow noopener" target="_blank">Global hooks getting lost on Windows 7 – Decrypt my World</a></p>

<h5>
<span id="マウスメッセージがフックから漏れる" class="fragment"></span><a href="#%E3%83%9E%E3%82%A6%E3%82%B9%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%8C%E3%83%95%E3%83%83%E3%82%AF%E3%81%8B%E3%82%89%E6%BC%8F%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>マウスメッセージがフックから漏れる</h5>

<p>マウス入力をフックして、マウスメッセージを解釈し、何らかのアクションを実行する。…あれ？ 例えば右クリックから開始されたジェスチャがキャンセルされたとき、右クリックをマウスジェスチャツールが復元するとします。マウスジェスチャツールが送信したマウスメッセージはフックを経由して、またマウスジェスチャツールに戻ってきてしまいます…。</p>

<p>この問題に対する簡単な対処の仕方は次のようなものです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// 既にフックが実行されているとして</span>
<span class="nf">Unhook</span><span class="p">();</span>
<span class="nf">RestoreClickEvent</span><span class="p">();</span>
<span class="nf">SetHook</span><span class="p">();</span>
</code></pre></div></div>

<p>しかしこの実装には問題があります。マウスジェスチャツールが復元したマウスメッセージは期待通りにフックを通過しますが、フックを一時的に解除しているため、その間にマウスから発生したメッセージもフックを通過してしまいます。マウスジェスチャツールによくある<strong>漏れ</strong>というのがこれです。この実装では結果的にユーザーのマウス入力を意図通りに解釈できず、ツールの信頼性は損なわれます。</p>

<p>よりよい対処は、マウスジェスチャツールが発行したマウスメッセージには署名を埋め込むというものです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">mouseInput</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MOUSEINPUT</span><span class="p">();</span>
<span class="c1">// Set the CreviceApp signature to the mouse event.</span>
<span class="n">mouseInput</span><span class="p">.</span><span class="n">dwExtraInfo</span> <span class="p">=</span> <span class="n">MOUSEEVENTF_CREVICE_APP</span><span class="p">;</span>
</code></pre></div></div>

<p>例えばペンデバイスからの入力かどうかは、<code>dwExtraInfo</code>を<code>0xFFFFFF00</code>でマスクした後に<code>0xFF515700</code>と比較することで確認できます。<br>
参考: <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms703320(v=vs.85).aspx" rel="nofollow noopener" target="_blank">System Events and Mouse Messages (Windows)</a></p>

<p>署名を埋め込むことにすれば、あとはマウスメッセージの署名を比較して、フィルタリングをするだけです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="kt">bool</span> <span class="n">fromCreviceApp</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="n">dwExtraInfo</span> <span class="p">==</span> <span class="n">MOUSEEVENTF_CREVICE_APP</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="n">WindowsHook</span><span class="p">.</span><span class="n">Result</span> <span class="nf">MouseProc</span><span class="p">(</span><span class="n">LowLevelMouseHook</span><span class="p">.</span><span class="n">Event</span> <span class="n">evnt</span><span class="p">,</span> <span class="n">LowLevelMouseHook</span><span class="p">.</span><span class="n">MSLLHOOKSTRUCT</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">fromCreviceApp</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">WindowsHook</span><span class="p">.</span><span class="n">Result</span><span class="p">.</span><span class="n">Transfer</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>

<h5>
<span id="特定の条件下でフリーズする" class="fragment"></span><a href="#%E7%89%B9%E5%AE%9A%E3%81%AE%E6%9D%A1%E4%BB%B6%E4%B8%8B%E3%81%A7%E3%83%95%E3%83%AA%E3%83%BC%E3%82%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>特定の条件下でフリーズする</h5>

<p>マウス入力にフックを掛けつつ、同時にマウスメッセージを送信すると、特定の環境で問題が発生することがあります。具体的にはWindows10環境で、ユニバーサルアプリが動いてるときのみ、何秒間か、アプリケーションがフリーズするというものです。調べると、StrokesPlusで似たような現象が過去に生じていたようです。</p>

<p><a href="http://www.strokesplus.com/forum/topic/1042/resolved-windows-10-locked-up-when-right-click" rel="nofollow noopener" target="_blank">StrokesPlus Forum - Free Mouse Gesture Utility for Windows XP/Vista/7/8</a></p>

<p>この問題は別スレッドからマウスメッセージを送信することで解決します。</p>

<h5>
<span id="特定の条件下でテストが失敗する" class="fragment"></span><a href="#%E7%89%B9%E5%AE%9A%E3%81%AE%E6%9D%A1%E4%BB%B6%E4%B8%8B%E3%81%A7%E3%83%86%E3%82%B9%E3%83%88%E3%81%8C%E5%A4%B1%E6%95%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>特定の条件下でテストが失敗する</h5>

<p>その条件というのはWindows10でユニバーサルアプリが動作しているとき…。はい、お察しの通り前述の問題です。同様の対策をとるか、あるいはWindows10のユニバーサルアプリを全部終了させてからテストを実行してください。</p>

<p>こんな通知ですら、この問題が発生するんです…。つらい。<br>
<a href="https://camo.qiitausercontent.com/48ed6fc3b7a6e4af1a44c9c732b00647faa6dd6d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34373031342f34663836336661332d623636312d666265382d326363392d3034656331346534313135362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2F4f863fa3-b661-fbe8-2cc9-04ec14e41156.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=49aadeebd334cf07ef3d43cbe00c2b9b" alt="SnapCrab_新しい通知_2016-10-21_20-53-38_No-00.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/47014/4f863fa3-b661-fbe8-2cc9-04ec14e41156.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2F4f863fa3-b661-fbe8-2cc9-04ec14e41156.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=50067902bd84f6dcfc8fdd2179deac15 1x" loading="lazy"></a></p>

<h5>
<span id="高解像度環境で誤ったカーソルの位置にスケーリングされる" class="fragment"></span><a href="#%E9%AB%98%E8%A7%A3%E5%83%8F%E5%BA%A6%E7%92%B0%E5%A2%83%E3%81%A7%E8%AA%A4%E3%81%A3%E3%81%9F%E3%82%AB%E3%83%BC%E3%82%BD%E3%83%AB%E3%81%AE%E4%BD%8D%E7%BD%AE%E3%81%AB%E3%82%B9%E3%82%B1%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%95%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>高解像度環境で誤ったカーソルの位置にスケーリングされる</h5>

<p>Windowsは、ある程度自動的に、アプリケーションの表示をディスプレイのDPIに合わせてスケーリングしてくれます。ただし、アプリケーションの認識するカーソル位置までスケーリングされてしまうと、マウスジェスチャツールの動作は正常なものではなくなってしまいます。自動的にディスプレイのDPIにアプリケーションの表示を追随させつつ、正しいカーソル位置を取得するには…という問題は以前は難しいものだったのですが、Windows 10 Creators Update（バージョン1703、ビルド15063）から新しくPerMonitorV2が追加され、多くのアプリケーションで簡単に解決できるようになりました。</p>

<p>WindowsのHigh DPI及びPer-Monitor DPIに対応するにはアプリケーションのマニュフェストに以下のような記述が必要になります。</p>

<div class="code-frame" data-lang="xml"><div class="highlight"><pre class="with-code"><code>﻿<span class="nt">&lt;assembly</span> <span class="na">xmlns=</span><span class="s">"urn:schemas-microsoft-com:asm.v1"</span>
    <span class="na">manifestVersion=</span><span class="s">"1.0"</span>
    <span class="na">xmlns:asmv3=</span><span class="s">"urn:schemas-microsoft-com:asm.v3"</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;asmv3:application&gt;</span>
    <span class="nt">&lt;asmv3:windowsSettings</span> <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/SMI/2005/WindowsSettings"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;dpiAware&gt;</span>
        true/PM
      <span class="nt">&lt;/dpiAware&gt;</span>
      <span class="nt">&lt;dpiAwareness</span> <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/SMI/2016/WindowsSettings"</span><span class="nt">&gt;</span>
        PerMonitorV2, PerMonitor
      <span class="nt">&lt;/dpiAwareness&gt;</span>
    <span class="nt">&lt;/asmv3:windowsSettings&gt;</span>
  <span class="nt">&lt;/asmv3:application&gt;</span>
<span class="nt">&lt;/assembly&gt;</span>
</code></pre></div></div>

<p>なお、上記の設定で、カーソル位置のスケーリングは無効になり、正しいものを取得できるようになりますが、2種のPer-Monitor API（PerMonitor, PerMonitorV2）が追加された前後、つまりWindows 8.1以前、Windows 10 CU以前、Windows 10 CU以降でそれぞれアプリケーションの表示スケーリングは異なります。そう、異なるのです…。CreviceAppではHigh DPI環境の人はWindows 10 CU以降を推奨しますよーということでお茶を濁します。</p>

<h5>
<span id="chromium-edgeで右クリックが効かなくなる" class="fragment"></span><a href="#chromium-edge%E3%81%A7%E5%8F%B3%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E3%81%8C%E5%8A%B9%E3%81%8B%E3%81%AA%E3%81%8F%E3%81%AA%E3%82%8B"><i class="fa fa-link"></i></a>Chromium Edgeで右クリックが効かなくなる</h5>

<p>dwExtraInfoに0xFFFFFF00のような雑なパターンを与えるとその他のブラウザでは正常に動作するが、Chromium Edgeだけで右クリックが効かなくなる不具合が生じます。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Frubyu%2Fitems%2F88b9f93b39951252a0c1&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Frubyu%2Fitems%2F88b9f93b39951252a0c1&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/rubyu/items/88b9f93b39951252a0c1/likers" class="css-1iupg5d">60</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">69</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/88b9f93b39951252a0c1/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/rubyu/items/88b9f93b39951252a0c1/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/rubyu/items/88b9f93b39951252a0c1/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/rubyu/items/88b9f93b39951252a0c1/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/rubyu/items/88b9f93b39951252a0c1.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-8ec7c065-f456-4def-a09c-39485f2e00b3">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-3400cc4f-67f0-41a0-ab2b-4e1450845df6"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-3400cc4f-67f0-41a0-ab2b-4e1450845df6">{}</script>
      
<div id="LoginModal-react-component-f1bdc143-5e24-44df-9de9-37daf148aea4"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-f1bdc143-5e24-44df-9de9-37daf148aea4">{}</script>
      
<div id="StockModal-react-component-25db1e7f-04fe-4d4c-b43d-d4f38f231479"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-25db1e7f-04fe-4d4c-b43d-d4f38f231479">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;e1PNHVYlGTJsCXy/h3RDzDKAaTlOAii3lU750tj82m9T3mvFrdkULIYe6KTOxBb+gpWAFItC3PRK0h1t9AIPrg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003eかざぐるマウスからの乗り換え先を探してたのですが、要求条件を満たすものがなかったのでフルスクラッチで書きました。現時点(バージョン2.2)で僕が使うには不満のないデキになったので、紹介がてら、忘れないうちに開発のメモやポイントなどを書き綴ろうと思います。\u003c/p\u003e\n\n\u003cp\u003eなお、C#で何かを書くのはこれが数回目で、かつ最新の文法書を通読したことがなく、逆引きでつまみ食い学習したため、C#的にはアレだったりするかもしれません。なにか変なところがあったら遠慮なくﾏｻｶﾘください。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"作ったツールの紹介\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%9C%E3%81%A3%E3%81%9F%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E7%B4%B9%E4%BB%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e作ったツールの紹介\u003c/h3\u003e\n\n\u003cp\u003e名前はCreviceAppで、2016年5月の第2週から6月の終わりまでを使って書きました。その後はドッグフーディングして、バグを見つけるたびに潰しています。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"必須要件\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%85%E9%A0%88%E8%A6%81%E4%BB%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e必須要件\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003eWindows 7 以降\u003c/li\u003e\n\u003cli\u003e.Net Framework 4.6 以上\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"特徴\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%89%B9%E5%BE%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e特徴\u003c/h4\u003e\n\n\u003cp\u003e信頼できるツールとして設計しました。取りこぼしなどがなく、高速で、イライラしません。\u003cbr\u003e\n他のマウスジェスチャツールで標準的なものでも、僕が使わないであろう機能（GUIでの設定、ジェスチャ軌跡の描写機能など）はバッサリ切っています。\u003cbr\u003e\n設定をC#スクリプト(csxファイル)として記述できるので、WindowsAPIを叩いたり、DLLをロードしたり、何でもできます。\u003cbr\u003e\nジェスチャとしてはストロークジェスチャ、ロッカージェスチャに対応します。\u003cbr\u003e\n単純にボタンのクリックにアクションを割り当てたり、\u003ccode\u003e押下\u003c/code\u003e, \u003ccode\u003e開放\u003c/code\u003eに直接フックを掛けることもできます。\u003cbr\u003e\nオープンソース。MITライセンスです。\u003cbr\u003e\nコア部分は2000行ほどとコンパクトなので、改造したりするのも簡単なのではと思います。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"導入方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%B0%8E%E5%85%A5%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e導入方法\u003c/h4\u003e\n\n\u003cp\u003ezipファイルを適当な位置に解凍して、\u003ccode\u003eCreviceApp.exe\u003c/code\u003eを実行してください。\u003cbr\u003e\n起動すると、自動的にデフォルトの設定ファイルが作られ、いくつかのジェスチャ定義が読み込まれます。デフォルトの設定ファイルには、ブラウザに対するジェスチャが一通り定義されています。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/a80c217f7a2d7e710b90a148959e96664b5af375/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34373031342f39396662373164312d636662652d333730312d333832332d3566356232343837663235342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2F99fb71d1-cfbe-3701-3823-5f5b2487f254.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a76d13b2faa017273e05696f7c2651a1\" alt=\"SnapCrab_新しい通知_2016-10-22_10-41-0_No-00.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/47014/99fb71d1-cfbe-3701-3823-5f5b2487f254.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2F99fb71d1-cfbe-3701-3823-5f5b2487f254.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6e71badca0e177e2604aff1086681dce 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eタスクトレイにアイコンが出るので、それをクリックするとウィンドウが開きます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6976dc69dbf02c55b59fe8b4dfbe4d226ccc191a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34373031342f66653933363563392d333230632d633563362d323761632d3833356132303334343935662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2Ffe9365c9-320c-c5c6-27ac-835a2034495f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=307d68a586653820963af42cdb1059e9\" alt=\"SnapCrab_NoName_2016-10-22_10-41-33_No-00.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/47014/fe9365c9-320c-c5c6-27ac-835a2034495f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2Ffe9365c9-320c-c5c6-27ac-835a2034495f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f3de600940b3c54038f91553c31dee71 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/593874a98c50c2e3b11d494ff9ea3cfc35fce561/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34373031342f32336638616235352d383835322d356262372d363164352d3733616134323333663463642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2F23f8ab55-8852-5bb7-61d5-73aa4233f4cd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=43c5fdbb8e3ad43220e8d41763adf4bf\" alt=\"SnapCrab_CreviceApp_2016-10-21_5-48-59_No-00.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/47014/23f8ab55-8852-5bb7-61d5-73aa4233f4cd.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2F23f8ab55-8852-5bb7-61d5-73aa4233f4cd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=30d23d707daf867af08f4a7f7105bbf3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e「Open user directory」をクリックすると、エクスプローラーが\u003ccode\u003e%APPDATA%\\Crevice\\CreviceApp\u003c/code\u003eを開きます。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003edefault.csx\u003c/code\u003eが設定ファイルなので、後はそれを自由に書き換えて、アプリを再起動するだけです。Enjoy!\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"設定dslの文法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%AD%E5%AE%9Adsl%E3%81%AE%E6%96%87%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e設定DSLの文法\u003c/h4\u003e\n\n\u003cp\u003eまずジェスチャを定義するには\u003ccode\u003e@when\u003c/code\u003eから始めます。フォアグラウンドアプリがChromeなときだけ発動するジェスチャを定義していきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eChrome\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003e@when\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eForegroundWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eModuleName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"chrome.exe\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e続いて、\u003ccode\u003e@on\u003c/code\u003e, \u003ccode\u003e@if\u003c/code\u003e, \u003ccode\u003e@do\u003c/code\u003eで一つのジェスチャが定義できます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eChrome\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@on\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRightButton\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMoveDown\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMoveRight\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@do\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSendInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMultiple\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_CONTROL\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_W\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eKeyUp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_W\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyUp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_CONTROL\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSend\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Close tab\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eRightButton\u003c/code\u003eからのストロークジェスチャ\u003ccode\u003e↓→\u003c/code\u003eを定義しました。ここで発動するアクションは\u003ccode\u003eタブを閉じる\u003c/code\u003eになります。\u003c/p\u003e\n\n\u003cp\u003e同様に\u003ccode\u003e@on\u003c/code\u003e, \u003ccode\u003e@if\u003c/code\u003e, \u003ccode\u003e@do\u003c/code\u003eを使って今度は\u003ccode\u003eRightButton + WheelDown\u003c/code\u003e, \u003ccode\u003eRightButton + WheelUp\u003c/code\u003eに\u003ccode\u003eタブの切り替え\u003c/code\u003eを割り当てます。これらはロッカージェスチャです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eChrome\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@on\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRightButton\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWheelDown\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@do\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSendInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMultiple\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_CONTROL\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_TAB\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyUp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_TAB\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyUp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_CONTROL\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSend\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Next tab\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eChrome\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@on\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRightButton\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWheelUp\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@do\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSendInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMultiple\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_CONTROL\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_SHIFT\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_TAB\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyUp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_TAB\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyUp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_SHIFT\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyUp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_CONTROL\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSend\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Previous tab\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eさてChromeはとりあえず置いておいて、コンテキストなしで\u003ccode\u003eX1Button\u003c/code\u003eにアクションを割り当ててみます。この\u003ccode\u003e@when\u003c/code\u003eは常に\u003ccode\u003etrue\u003c/code\u003eを返すので、ジェスチャはいつでも発動します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eWhenever\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003e@when\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eWhenever\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eX1Button\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@do\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSendInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMultiple\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_MENU\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_TAB\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyUp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_TAB\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eExtendedKeyUp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_MENU\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSend\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Sending Alt+Tab; this will work fine except on Window 8\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e割り当てられたアクションは\u003ccode\u003eAlt + Tab\u003c/code\u003eです。よく使いますよね。ここで\u003ccode\u003e@on\u003c/code\u003eが指定されていないことに注意してください。つまり\u003ccode\u003eX1Button\u003c/code\u003eに直接アクションを割り当てたことになります。\u003c/p\u003e\n\n\u003cp\u003e続いて、同様にコンテキストなしで、今度は\u003ccode\u003eX2Button\u003c/code\u003eのDown/Upにアクションを割り当てます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eWhenever\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eX2Button\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@before\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSendInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExtendedKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_CONTROL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Ctrl Down\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}).\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@after\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSendInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExtendedKeyUp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVK_CONTROL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Ctrl Up\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれで\u003ccode\u003eX2Button\u003c/code\u003eを\u003ccode\u003eCtrlキー\u003c/code\u003eとして使用することができます。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e@before\u003c/code\u003e, \u003ccode\u003e@after\u003c/code\u003eはちょっと微妙な表現ですが、両者の間に\u003ccode\u003e@do\u003c/code\u003eを挟むことができるので、\u003ccode\u003e@do\u003c/code\u003eの前と後ということです。この\u003ccode\u003e@before\u003c/code\u003eと\u003ccode\u003e@after\u003c/code\u003eが使えるのは、\u003ccode\u003e@if\u003c/code\u003eが\u003ccode\u003eLeftButton\u003c/code\u003e, \u003ccode\u003eMiddleButton\u003c/code\u003e, \u003ccode\u003eRightButton\u003c/code\u003e, \u003ccode\u003eX1Button\u003c/code\u003e, \u003ccode\u003eX2Button\u003c/code\u003eのいずれかを引数に取るときだけであることに注意してください。\u003ccode\u003e@if\u003c/code\u003eが\u003ccode\u003eWheelDown\u003c/code\u003e, \u003ccode\u003eWheelUp\u003c/code\u003e, \u003ccode\u003eWheelLeft\u003c/code\u003e, \u003ccode\u003eWheelRight\u003c/code\u003eを引数に取るときは\u003ccode\u003e@do\u003c/code\u003eのみが指定可能です。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"状態を持つ設定の例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%8A%B6%E6%85%8B%E3%82%92%E6%8C%81%E3%81%A4%E8%A8%AD%E5%AE%9A%E3%81%AE%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e状態を持つ設定の例\u003c/h4\u003e\n\n\u003cp\u003eあるところに懐ゲーマニアがいました。彼は懐ゲーを愛し、毎日のようにプレイしていましたが、たったひとつだけ許せないことがありました。それはホイールコロコロでテキストを読み進められないゲームがあることでした。ホイールをクリックに変換してくれるようなツールもありますが、ゲームによっていちいちツールを設定し直すのが面倒なのでした。そこでCreviceAppです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eWheel2Click\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eWhenever\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003e@when\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eWhenever\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@on\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRightButton\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLeftButton\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@do\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWheel2Click\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003eWheel2Click\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eTooltip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Wheel2Click {0}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eWheel2Click\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\"enabled\"\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"disabled\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eWhenever\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWheelDown\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\n\u003cspan class=\"nf\"\u003e@do\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWheel2Click\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSendInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLeftClick\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSendInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWheelDown\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eRightButton + LeftButton\u003c/code\u003eで機能のオンオフを切り替えることができます。ここで、設定中のグローバルな値である\u003ccode\u003eWheel2Click\u003c/code\u003eは、CreviceAppの起動から終了までの間を通じて保持されます。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h4\u003e\n\n\u003cp\u003e以上が簡単な説明になります。詳細な説明は適当な英語で\u003ca href=\"https://github.com/rubyu/CreviceApp\" rel=\"nofollow noopener\" target=\"_blank\"\u003eプロジェクトページ\u003c/a\u003eに書いています。\u003ca href=\"https://github.com/rubyu/CreviceApp#executioncontext\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003e@when\u003c/code\u003eでの他のコンテキストの指定\u003c/a\u003e、\u003ca href=\"https://github.com/rubyu/CreviceApp#config\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eConfig\u003c/code\u003eでのパラメータの設定\u003c/a\u003e、\u003ca href=\"https://github.com/rubyu/CreviceApp#windowinfo\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eWindowInfo\u003c/code\u003e\u003c/a\u003e, \u003ca href=\"https://github.com/rubyu/CreviceApp#sendinput\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eSendInput\u003c/code\u003e\u003c/a\u003e, \u003ca href=\"https://github.com/rubyu/CreviceApp#window\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eWindow\u003c/code\u003e\u003c/a\u003e, \u003ca href=\"https://github.com/rubyu/CreviceApp#tooltipstring-text\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eTooltip\u003c/code\u003e\u003c/a\u003e, \u003ca href=\"https://github.com/rubyu/CreviceApp#baloonstring-text\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eBaloon\u003c/code\u003e\u003c/a\u003eなどのAPIなど、ここでは割愛した内容を含んでいます。\u003c/p\u003e\n\n\u003cp\u003e最新のリリースは\u003ca href=\"https://github.com/rubyu/CreviceApp/releases\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2.2.153\u003c/a\u003eです。よかったら使ってみてください。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/rubyu/CreviceApp\" rel=\"nofollow noopener\" target=\"_blank\"\u003erubyu/CreviceApp\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/rubyu/CreviceApp/releases\" rel=\"nofollow noopener\" target=\"_blank\"\u003eReleases · rubyu/CreviceApp\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"マウスジェスチャツールの作り方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9E%E3%82%A6%E3%82%B9%E3%82%B8%E3%82%A7%E3%82%B9%E3%83%81%E3%83%A3%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eマウスジェスチャツールの作り方\u003c/h3\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"基本的な仕組み\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BB%95%E7%B5%84%E3%81%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e基本的な仕組み\u003c/h4\u003e\n\n\u003cp\u003eマウスジェスチャツールはマウス入力にフックを掛けて、飛んでくるマウスメッセージを解釈し、必要であれば何らかのアクションを実行し、最後にマウスメッセージに対する返答「よし通れ！」「通さぬぞ！」のどちらかを返します。このとき通過を許可されたマウスメッセージは、他のフックがあれば同様にその審査も経て、最終的にはアプリケーションに到達します。通過を拒否されたマウスメッセージは破棄され、他のフックやアプリケーションに渡ることはありません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"user32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSetLastError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetWindowsHookEx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eidHook\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSystemCallback\u003c/span\u003e \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ethreadId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"user32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSetLastError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eUnhookWindowsHookEx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehook\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"user32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"nf\"\u003eCallNextHookEx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003eidHook\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ewParam\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003elParam\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"kernel32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetModuleHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eHC_ACTION\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eWH_MOUSE_LL\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e14\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003eLRESULTCancel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eIntPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehHook\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eZero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetHook\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ehInstance\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetModuleHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eProcess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCurrentProcess\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eMainModule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eModuleName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehHook\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetWindowsHookEx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWH_MOUSE_LL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUnhook\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eUnhookWindowsHookEx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehHook\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"nf\"\u003eCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ewParam\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003elParam\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enCode\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 何か処理をする\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eよし通れ！\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eCallNextHookEx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehHook\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewParam\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elParam\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003e通さぬぞ！\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eLRESULTCancel\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eCallNextHookEx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehHook\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewParam\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elParam\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eエラー処理などは省いていますが、非常に簡単ですね。あとはアプリケーションの起動時に\u003ccode\u003eSetHook()\u003c/code\u003eし、終了時に\u003ccode\u003eUnhook()\u003c/code\u003eすれば、マウスジェスチャツールの骨組みはできあがりです。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eSetHook()\u003c/code\u003eした後にマウスメッセージが発生するたび、\u003ccode\u003eCallback()\u003c/code\u003eが呼ばれます。ここにキモとなるロジックを書き加えていくことになります。\u003c/p\u003e\n\n\u003cp\u003e注意: 後述しますが、\u003ca href=\"http://qiita.com/rubyu/items/88b9f93b39951252a0c1#%E3%81%86%E3%81%BE%E3%81%8F%E3%83%95%E3%83%83%E3%82%AF%E3%81%8C%E3%81%8B%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84-1\"\u003e\u003ccode\u003eWH_MOUSE_LL\u003c/code\u003eなどのグローバルフックを掛ける場合、\u003ccode\u003eSetWindowsHookEx()\u003c/code\u003eをコールしたスレッドがメッセージループを持っていなければなりません。\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e参考:\u003cbr\u003e\n\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/cc430103.aspx?f=255\u0026amp;MSPPError=-2147217396\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSetWindowsHookEx 関数\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/cc429591.aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCallNextHookEx 関数\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/cc430021.aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eLowLevelMouseProc 関数\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"tips\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tips\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTips\u003c/h4\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"メッセージの送信\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE%E9%80%81%E4%BF%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメッセージの送信\u003c/h5\u003e\n\n\u003cp\u003e例えば、右クリックから開始されたジェスチャがタイムアウトでキャンセルとなった場合、この\u003ccode\u003eRightButtonDown\u003c/code\u003eをマウスジェスチャツールから送信する必要があります。いろいろな方法がありますが、\u003ccode\u003emouse_event\u003c/code\u003eには後述する問題があるため、\u003ccode\u003eSendInput\u003c/code\u003eを使うのが無難ではないかと思います。\u003c/p\u003e\n\n\u003ch6\u003e\n\u003cspan id=\"sendinput\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sendinput\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSendInput\u003c/h6\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"user32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSetLastError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003enInputs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eINPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003epInputs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecbSize\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eStructLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLayoutKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSequential\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eINPUT\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eMOUSEINPUT\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eStructLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLayoutKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSequential\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eWHEELDELTA\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003edelta\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eStructLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLayoutKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSequential\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eXBUTTON\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eStructLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLayoutKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExplicit\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eMOUSEDATA\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eFieldOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eWHEELDELTA\u003c/span\u003e \u003cspan class=\"n\"\u003easWheelDelta\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eFieldOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eXBUTTON\u003c/span\u003e \u003cspan class=\"n\"\u003easXButton\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eStructLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLayoutKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSequential\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eMOUSEINPUT\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003edx\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003edy\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eMOUSEDATA\u003c/span\u003e \u003cspan class=\"n\"\u003emouseData\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003edwFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eUIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003edwExtraInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// https://msdn.microsoft.com/ja-jp/library/windows/desktop/ms646273(v=vs.85).aspx\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eXButtonType\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eXBUTTON1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x01\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eXBUTTON2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x02\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// https://msdn.microsoft.com/ja-jp/library/windows/desktop/ms646270(v=vs.85).aspx\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eInputType\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eINPUT_MOUSE\u003c/span\u003e    \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eINPUT_KEYBOARD\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eINPUT_HARDWARE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x2\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// https://msdn.microsoft.com/ja-jp/library/windows/desktop/ms646260(v=vs.85).aspx\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eMouseEventType\u003c/span\u003e \n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMOUSEEVENTF_MOVE\u003c/span\u003e       \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0001\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMOUSEEVENTF_LEFTDOWN\u003c/span\u003e   \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0002\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMOUSEEVENTF_LEFTUP\u003c/span\u003e     \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0004\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMOUSEEVENTF_RIGHTDOWN\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0008\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMOUSEEVENTF_RIGHTUP\u003c/span\u003e    \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0010\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMOUSEEVENTF_MIDDLEDOWN\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0020\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMOUSEEVENTF_MIDDLEUP\u003c/span\u003e   \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0040\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMOUSEEVENTF_XDOWN\u003c/span\u003e      \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0080\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMOUSEEVENTF_XUP\u003c/span\u003e        \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMOUSEEVENTF_WHEEL\u003c/span\u003e      \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0800\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMOUSEEVENTF_HWHEEL\u003c/span\u003e     \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMOUSEEVENTF_ABSOLUTE\u003c/span\u003e   \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x8000\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eWHEEL_DELTA\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e120\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eINPUT\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emessages\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eINPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSendInput\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMarshal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSizeOf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"n\"\u003eINPUT\u003c/span\u003e \u003cspan class=\"nf\"\u003eToInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMOUSEINPUT\u003c/span\u003e \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eINPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eInputType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eINPUT_MOUSE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eMOUSEINPUT\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetMouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMOUSEINPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"n\"\u003eMOUSEINPUT\u003c/span\u003e \u003cspan class=\"nf\"\u003eMouseLeftDownEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetMouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edwFlags\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eMouseEventType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMOUSEEVENTF_LEFTDOWN\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"n\"\u003eMOUSEINPUT\u003c/span\u003e \u003cspan class=\"nf\"\u003eMouseLeftUpEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetMouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edwFlags\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eMouseEventType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMOUSEEVENTF_LEFTUP\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"n\"\u003eMOUSEINPUT\u003c/span\u003e \u003cspan class=\"nf\"\u003eMouseRightDownEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetMouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edwFlags\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eMouseEventType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMOUSEEVENTF_RIGHTDOWN\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"n\"\u003eMOUSEINPUT\u003c/span\u003e \u003cspan class=\"nf\"\u003eMouseRightUpEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetMouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edwFlags\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eMouseEventType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMOUSEEVENTF_RIGHTUP\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nf\"\u003eSend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eToInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eMouseRightDownEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e()));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e実装例: \u003ca href=\"https://github.com/rubyu/CreviceApp/blob/2.0/CreviceApp/WinAPI.SendInput.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCreviceApp/WinAPI.SendInput.cs at 2.0 · rubyu/CreviceApp\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eリンク先の実装例では、キーボードメッセージ、及び複数個のメッセージの送信にも対応しています。\u003ccode\u003ekeybd_event\u003c/code\u003e, \u003ccode\u003emouse_event\u003c/code\u003eには複数個のメッセージを、他の入力に妨げられることなく連続したものとして送信する機能がないため、\u003ccode\u003eSendInput\u003c/code\u003eをオススメします。\u003c/p\u003e\n\n\u003cp\u003e注意: 後述しますが、\u003ca href=\"http://qiita.com/rubyu/items/88b9f93b39951252a0c1#%E7%89%B9%E5%AE%9A%E3%81%AE%E6%9D%A1%E4%BB%B6%E4%B8%8B%E3%81%A7%E3%83%95%E3%83%AA%E3%83%BC%E3%82%BA%E3%81%99%E3%82%8B\"\u003e\u003ccode\u003eSetWindowsHookEx()\u003c/code\u003eでグローバルフックをセットしたスレッドと同一のスレッドからマウスメッセージを送信すると、特定の環境で問題が発生します。\u003c/a\u003eこのような場合は別スレッドからマウスメッセージを送信するようにしてください。\u003c/p\u003e\n\n\u003cp\u003e参考:\u003cbr\u003e\n\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/cc411004.aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSendInput 関数\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/ms646270.aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eINPUT structure (Windows)\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/ms646273.aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMOUSEINPUT structure (Windows)\u003c/a\u003e\u003c/p\u003e\n\n\u003ch6\u003e\n\u003cspan id=\"その他のapi\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AEapi\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他のAPI\u003c/h6\u003e\n\n\u003cp\u003eその他のAPIとして、定番どころでは\u003ccode\u003eSendMessage\u003c/code\u003e, \u003ccode\u003ePostMessage\u003c/code\u003eなどがあります。マウスジェスチャツール本体では使用しなくても、ユーザーアクションから呼び出せると便利でしょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"user32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehWnd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ewParam\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003elParam\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"user32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSetLastError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003ePostMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehWnd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ewParam\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003elParam\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eウィンドウハンドルが絡むので、CreviceAppではカプセル化して簡単に扱えるようにしました。ざっくりとしたコードは以下のようなものです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eWindow\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e \u003cspan class=\"nf\"\u003eFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehWnd\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetCursorPos\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetPhysicalCursorPos\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetForegroundWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetPointedWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e \u003cspan class=\"nf\"\u003eWindowFromPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e \u003cspan class=\"nf\"\u003eFindWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003elpClassName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003elpWindowName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetTopLevelWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetThreadWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ethreadId\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eWindowInfo\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eThreadId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eProcessId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eClassName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e \u003cspan class=\"n\"\u003eParent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eModulePath\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eModuleName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eBringWindowToTop\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ewParam\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003elParam\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003ePostMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ewParam\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003elParam\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e \u003cspan class=\"nf\"\u003eFindWindowEx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehwndChildAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003elpszClass\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003elpszWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e \u003cspan class=\"nf\"\u003eFindWindowEx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003elpszClass\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003elpszWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChildWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetPointedDescendantWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWindowFromPointFlags\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetPointedDescendantWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eForegroundWindowInfo\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNativeMethods\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"user32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetForegroundWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eForegroundWindowInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNativeMethods\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetForegroundWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ePointedWindowInfo\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowInfo\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNativeMethods\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"user32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"nf\"\u003eWindowFromPhysicalPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003ePointedWindowInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNativeMethods\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWindowFromPhysicalPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e実装例: \u003ca href=\"https://github.com/rubyu/CreviceApp/blob/2.0/CreviceApp/WinAPI.Window.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCreviceApp/WinAPI.Window.cs at 2.0 · rubyu/CreviceApp\u003c/a\u003e\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"勝手taskscheduler\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8B%9D%E6%89%8Btaskscheduler\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e勝手TaskScheduler\u003c/h5\u003e\n\n\u003cp\u003eユーザーアクションだけを隔離して、かつ実行順序を保証するために単一のスレッドで実行したいようなシーンでは、勝手TaskSchedulerを書くのがよさそうでした。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// http://www.codeguru.com/csharp/article.php/c18931/Understanding-the-NET-Task-Parallel-Library-TaskScheduler.htm\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSingleThreadScheduler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eTaskScheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eBlockingCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003etasks\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eBlockingCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eThread\u003c/span\u003e \u003cspan class=\"n\"\u003ethread\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSingleThreadScheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eThreadPriority\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNormal\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSingleThreadScheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eThreadPriority\u003c/span\u003e \u003cspan class=\"n\"\u003epriority\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ethread\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eThreadStart\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ethread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePriority\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epriority\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ethread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SingleThreadScheduler was started; Thread ID: 0x{0:X}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eManagedThreadId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetConsumingEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eTryExecuteTask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetScheduledTasks\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eQueueTask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eTryExecuteTaskInline\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003etaskWasPreviouslyQueued\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eGC\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSuppressFinalize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCompleteAdding\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e~\u003c/span\u003e\u003cspan class=\"nf\"\u003eSingleThreadScheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"ツールチップを任意の位置に表示する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%84%E3%83%BC%E3%83%AB%E3%83%81%E3%83%83%E3%83%97%E3%82%92%E4%BB%BB%E6%84%8F%E3%81%AE%E4%BD%8D%E7%BD%AE%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eツールチップを任意の位置に表示する\u003c/h5\u003e\n\n\u003cp\u003eバルーンメッセージやトーストで通知するのは大仰だというときに、任意の場所にツールチップを表示できるとよいのですが、スマートにやる方法にはたどり着けませんでした。とりあえず以下のように力技でどうにかしました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTooltipNotifier\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eAbsolute\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0002\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIWin32Window\u003c/span\u003e \u003cspan class=\"n\"\u003ewin\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodInfo\u003c/span\u003e \u003cspan class=\"n\"\u003eSetTool\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodInfo\u003c/span\u003e \u003cspan class=\"n\"\u003eSetTrackPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodInfo\u003c/span\u003e \u003cspan class=\"n\"\u003eStartTimer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eToolTip\u003c/span\u003e \u003cspan class=\"n\"\u003etooltip\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eToolTip\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eTooltipNotifier\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWin32Window\u003c/span\u003e \u003cspan class=\"n\"\u003ewin\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewin\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ewin\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSetTool\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etooltip\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SetTool\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNonPublic\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSetTrackPosition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etooltip\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SetTrackPosition\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNonPublic\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStartTimer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etooltip\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"StartTimer\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNonPublic\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eduration\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSetTrackPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etooltip\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eY\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSetTool\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etooltip\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ewin\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAbsolute\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eStartTimer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etooltip\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ewin\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eduration\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eGC\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSuppressFinalize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etooltip\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e~\u003c/span\u003e\u003cspan class=\"nf\"\u003eTooltipNotifier\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなお、座標についてはある程度、Windows側でよしなにやってくれます。例えば1920x1080のディスプレイ環境で\u003ccode\u003eTT.Show(\"どや！\", 1920, 1080);\u003c/code\u003eとしても、ツールチップはタスクバー上には表示されず、タスクバーを除いたエリアの右下隅にフィットするように表示されます。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"複雑さとの戦い\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A4%87%E9%9B%91%E3%81%95%E3%81%A8%E3%81%AE%E6%88%A6%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e複雑さとの戦い\u003c/h4\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"コアロジックのfsm化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%82%A2%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E3%81%AEfsm%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコアロジックのFSM化\u003c/h5\u003e\n\n\u003cp\u003eマウスジェスチャには様々な種類があります。ボタンを押したままマウスを動かすストロークジェスチャ、あるボタンを押したまま他のボタンを押すロッカージェスチャ、あるいは単にあるボタンを押すという動作もジェスチャとして扱いたいかもしれません。それらの全てをフラグで管理していたのでは大変ですし、とても保守できる気がしません。何かスマートな解決策が必要です。\u003c/p\u003e\n\n\u003cp\u003eそこで同時に押すボタンは2つまでとして、\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e初期状態: 何もボタンは押されていない\u003c/li\u003e\n\u003cli\u003e1つめのボタンが押されている\u003c/li\u003e\n\u003cli\u003e2つめのボタンが押されている\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eという3つの状態を考えれば、これらは明らかに有限で、その遷移も明白なように見えます。有限状態マシンで実装するのがよさそうです。この2番目の状態を、「ジェスチャを開始したボタンを復元できるかどうか」でさらに2つに分けて、次のような合計4つの状態を考えました。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e初期状態: 何もボタンは押されていない\u003c/li\u003e\n\u003cli\u003e1つめのボタンが押されている (ジェスチャ開始ボタンは復元できる)\u003c/li\u003e\n\u003cli\u003e1つめのボタンが押されている (ジェスチャ開始ボタンは復元できない)\u003c/li\u003e\n\u003cli\u003e2つめのボタンが押されている\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e実装としては次のようなものです。なお、\u003ccode\u003eシングルアクションボタン\u003c/code\u003eは\u003ccode\u003eWheelUp\u003c/code\u003e, \u003ccode\u003eWheelDown\u003c/code\u003e, \u003ccode\u003eWheelLeft\u003c/code\u003e, \u003ccode\u003eWheelRight\u003c/code\u003eのいずれか、\u003ccode\u003eダブルアクションボタン\u003c/code\u003eは\u003ccode\u003eLeft\u003c/code\u003e, \u003ccode\u003eMiddle\u003c/code\u003e, \u003ccode\u003eRight\u003c/code\u003e, \u003ccode\u003eX1\u003c/code\u003e, \u003ccode\u003eX2\u003c/code\u003eのいずれかです。後者にはボタンの押下と開放に対応した、\u003ccode\u003eセット\u003c/code\u003eと\u003ccode\u003eリリース\u003c/code\u003eの2種があるとします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eevnt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e   \n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNextState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"The state of GestureMachine was changed: {0} -\u0026gt; {1}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNextState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"n\"\u003eState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNextState\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsConsumed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIState\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eResult\u003c/span\u003e \u003cspan class=\"nf\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEvent\u003c/span\u003e \u003cspan class=\"n\"\u003eevnt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eState\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIState\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e \u003cspan class=\"nf\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEvent\u003c/span\u003e \u003cspan class=\"n\"\u003eevnt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventIsRemained\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enextState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eState0\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eState\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e \u003cspan class=\"nf\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEvent\u003c/span\u003e \u003cspan class=\"n\"\u003eevnt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eシングルアクションボタン\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eジェスチャが存在する\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// ユーザーアクションの実行\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventIsConsumed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enextState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eダブルアクションボタンのセット\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eジェスチャが存在する\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventIsConsumed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enextState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eState1\u003c/span\u003e\u003cspan class=\"p\"\u003e(...));\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eevnt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eState1\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eState\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e \u003cspan class=\"nf\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEvent\u003c/span\u003e \u003cspan class=\"n\"\u003eevnt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ストロークの監視クラスにpointを渡す\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eシングルアクションボタン\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eジェスチャが存在する\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// ユーザーアクションの実行\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventIsConsumed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enextState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eState2\u003c/span\u003e\u003cspan class=\"p\"\u003e(...));\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eダブルアクションボタンのセット\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eジェスチャが存在する\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventIsConsumed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enextState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eState3\u003c/span\u003e\u003cspan class=\"p\"\u003e(...));\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eダブルアクションボタンのリリース\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003e入力が\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"err\"\u003e番目に押されたボタンのペアなら\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eストロークの入力がある\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eジェスチャが存在する\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// ユーザーアクションの実行\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eジェスチャが存在する\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// ユーザーアクションの実行\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// 1番目に押されたボタンのクリックを復元する\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventIsConsumed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enextState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eS0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eevnt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eState2\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eState\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e \u003cspan class=\"nf\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEvent\u003c/span\u003e \u003cspan class=\"n\"\u003eevnt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ストロークの監視クラスにpointを渡す\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eシングルアクションボタン\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eジェスチャが存在する\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// ユーザーアクションの実行\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventIsConsumed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enextState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eState2\u003c/span\u003e\u003cspan class=\"p\"\u003e(...));\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eダブルアクションボタンのセット\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eジェスチャが存在する\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventIsConsumed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enextState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eState3\u003c/span\u003e\u003cspan class=\"p\"\u003e(...));\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eダブルアクションボタンのリリース\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003e入力が\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"err\"\u003e番目に押されたボタンのペアなら\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eストロークの入力がある\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eジェスチャが存在する\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// ユーザーアクションの実行\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventIsConsumed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enextState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eS0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eevnt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eState3\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eState\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e \u003cspan class=\"nf\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEvent\u003c/span\u003e \u003cspan class=\"n\"\u003eevnt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eダブルアクションボタンのリリース\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003e入力が\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"err\"\u003e番目に押されたボタンのペアなら\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// ユーザーアクションの実行\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventIsConsumed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enextState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eS2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003e入力が\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"err\"\u003e番目に押されたボタンのペアなら\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 2番目に押されたボタンを「次回は無視する」リストに入れる\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEventIsConsumed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enextState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eS0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eevnt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eどうでしょうか、状態ごとに分けて考えると、それほど難しくないと思います。全ての遷移を書き出して、それに対応するコードとテストを書いていくと安心です。\u003c/p\u003e\n\n\u003cp\u003e遷移の例: \u003ca href=\"https://github.com/rubyu/CreviceApp/blob/2.0/CreviceApp/Core.FSM.Transition.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCreviceApp/Core.FSM.Transition.cs at 2.0 · rubyu/CreviceApp\u003c/a\u003e\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"guiでの設定を諦めるroslynのススメ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gui%E3%81%A7%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E8%AB%A6%E3%82%81%E3%82%8Broslyn%E3%81%AE%E3%82%B9%E3%82%B9%E3%83%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGUIでの設定を諦める（Roslynのススメ）\u003c/h5\u003e\n\n\u003cp\u003e多岐にわたるマウスジェスチャツールの用途を網羅するような、万能な設定をGUIで作り込むには途方もない時間がかかりそうです。CreviceAppの場合、1人しか使う予定がないマウスジェスチャツールのために膨大な人月をつぎ込むのは明らかに誤りでした。ここはスッパリとGUIを切り捨てて、テキストベースで設定を行えるようにしましょう。もちろん、テキストベースといっても、独自のスクリプトを作り込んだりするのも明らかに時間の無駄です。ちょうどMicrosoft Roslynの安定版がリリースされた頃だったので、これをマウスジェスチャツールに組み込みました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGestureDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eEvaluateUserScriptAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserScriptExecutionContext\u003c/span\u003e \u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003escript\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCSharpScript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eGetDefaultUserScript\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithSourceResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eScriptSourceResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithBaseDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUserDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithMetadataResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eScriptMetadataResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithBaseDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUserDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"microlib\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e                   \u003cspan class=\"c1\"\u003e// microlib.dll\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"System\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e                     \u003cspan class=\"c1\"\u003e// System.dll\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"System.Core\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e                \u003cspan class=\"c1\"\u003e// System.Core.dll\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Microsoft.CSharp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e           \u003cspan class=\"c1\"\u003e// Microsoft.CSharp.dll\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEntryAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e()),\u003c/span\u003e \u003cspan class=\"c1\"\u003e// CreviceApp.exe\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eglobalsType\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserScriptExecutionContext\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"n\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCompile\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eWait\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetGestureDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInitializeGestureMachine\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ectx\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eCore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUserScriptExecutionContext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eGlobal\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003egestureDef\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eEvaluateUserScriptAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGestureMachine\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eCore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFSM\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGestureMachine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eGlobal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003egestureDef\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eたったこれだけのコードで、csxファイルをコンパイルして実行できます。後は設定を表現するDSLを定義して、コードに書き下していけばいいだけです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eWHEN                  ::= @when(WHEN_FUNC)           ( ON | IF_A | IF_B )\n\nON                    ::= @on(DOUBLE_TRIGGER_BUTTON) ( IF_A | IF_B | IF_C )\n\nIF_A                  ::= @if(DOUBLE_TRIGGER_BUTTON) [ BEFORE ] DO [ AFTER ]\n\nIF_B                  ::= @if(SINGLE_TRIGGER_BUTTON)   DO\n\nIF_C                  ::= @if(MOVE *)                  DO\n\nBEFORE                ::= @before(BEFORE_FUNC)\n\nDO                    ::= @do(DO_FUNC) \n\nAFTER                 ::= @after(AFTER_FUNC)\n\nDOUBLE_TRIGGER_BUTTON ::= L | M | R | X1 | X2\n\nSINGLE_TRIGGER_BUTTON ::= W_UP | W_DOWN | W_LEFT | W_RIGHT\n\nMOVE                  ::= MOVE_UP | MOVE_DOWN | MOVE_LEFT | MOVE_RIGHT\n\nWHEN_FUNC             ::= delegate bool\n\nBEFORE_FUNC           ::= delegate void\n\nDO_FUNC               ::= delegate void\n\nAFTER_FUNC            ::= delegate void\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDef\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003edelegate\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eWhenFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserActionExecutionContext\u003c/span\u003e \u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003edelegate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eBeforeFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserActionExecutionContext\u003c/span\u003e \u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003edelegate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserActionExecutionContext\u003c/span\u003e \u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003edelegate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAfterFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserActionExecutionContext\u003c/span\u003e \u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eButton\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eAcceptableInOnClause\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eButton\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eAcceptableInIfButtonClause\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eButton\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eAcceptableInIfSingleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInIfButtonClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eAcceptableInIfDoubleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInIfButtonClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLeftButton\u003c/span\u003e   \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInOnClause\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInIfDoubleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMiddleButton\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInOnClause\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInIfDoubleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eRightButton\u003c/span\u003e  \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInOnClause\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInIfDoubleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eWheelUp\u003c/span\u003e      \u003cspan class=\"p\"\u003e:\u003c/span\u003e                       \u003cspan class=\"n\"\u003eAcceptableInIfSingleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eWheelDown\u003c/span\u003e    \u003cspan class=\"p\"\u003e:\u003c/span\u003e                       \u003cspan class=\"n\"\u003eAcceptableInIfSingleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eWheelLeft\u003c/span\u003e    \u003cspan class=\"p\"\u003e:\u003c/span\u003e                       \u003cspan class=\"n\"\u003eAcceptableInIfSingleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eWheelRight\u003c/span\u003e   \u003cspan class=\"p\"\u003e:\u003c/span\u003e                       \u003cspan class=\"n\"\u003eAcceptableInIfSingleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eX1Button\u003c/span\u003e     \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInOnClause\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInIfDoubleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eX2Button\u003c/span\u003e     \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInOnClause\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInIfDoubleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eMove\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eAcceptableInIfStrokeClause\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMove\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMoveUp\u003c/span\u003e    \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInIfStrokeClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMoveDown\u003c/span\u003e  \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInIfStrokeClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMoveLeft\u003c/span\u003e  \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInIfStrokeClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMoveRight\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAcceptableInIfStrokeClause\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eConstantSingleton\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConstantSingleton\u003c/span\u003e \u003cspan class=\"n\"\u003esingleton\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eConstantSingleton\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eLeftButton\u003c/span\u003e   \u003cspan class=\"n\"\u003eLeftButton\u003c/span\u003e      \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeftButton\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eMiddleButton\u003c/span\u003e \u003cspan class=\"n\"\u003eMiddleButton\u003c/span\u003e    \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMiddleButton\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eRightButton\u003c/span\u003e  \u003cspan class=\"n\"\u003eRightButton\u003c/span\u003e     \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRightButton\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eWheelDown\u003c/span\u003e    \u003cspan class=\"n\"\u003eWheelDown\u003c/span\u003e       \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWheelDown\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eWheelUp\u003c/span\u003e      \u003cspan class=\"n\"\u003eWheelUp\u003c/span\u003e         \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWheelUp\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eWheelLeft\u003c/span\u003e    \u003cspan class=\"n\"\u003eWheelLeft\u003c/span\u003e       \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWheelLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eWheelRight\u003c/span\u003e   \u003cspan class=\"n\"\u003eWheelRight\u003c/span\u003e      \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWheelRight\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eX1Button\u003c/span\u003e     \u003cspan class=\"n\"\u003eX1Button\u003c/span\u003e        \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eX1Button\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eX2Button\u003c/span\u003e     \u003cspan class=\"n\"\u003eX2Button\u003c/span\u003e        \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eX2Button\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eMoveUp\u003c/span\u003e    \u003cspan class=\"n\"\u003eMoveUp\u003c/span\u003e    \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveUp\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eMoveDown\u003c/span\u003e  \u003cspan class=\"n\"\u003eMoveDown\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveDown\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eMoveLeft\u003c/span\u003e  \u003cspan class=\"n\"\u003eMoveLeft\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eMoveRight\u003c/span\u003e \u003cspan class=\"n\"\u003eMoveRight\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveRight\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConstantSingleton\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esingleton\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConstantSingleton\u003c/span\u003e \u003cspan class=\"n\"\u003eConstant\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eConstantSingleton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eRoot\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eWhenElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ewhenElements\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eWhenElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eWhenElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@when\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhenFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWhenElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewhenElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eWhenElement\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eValue\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIfSingleTriggerButtonElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eifSingleTriggerButtonElements\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIfSingleTriggerButtonElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIfDoubleTriggerButtonElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eifDoubleTriggerButtonElements\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIfDoubleTriggerButtonElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOnElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eonElements\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOnElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhenFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhenFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eWhenElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhenFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eOnElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@on\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInOnClause\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eonElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIfSingleTriggerButtonElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInIfSingleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eIfSingleTriggerButtonElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eifSingleTriggerButtonElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIfDoubleTriggerButtonElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInIfDoubleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eIfDoubleTriggerButtonElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eifDoubleTriggerButtonElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eOnElement\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eValue\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIfSingleTriggerButtonElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eifSingleTriggerButtonElements\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIfSingleTriggerButtonElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIfDoubleTriggerButtonElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eifDoubleTriggerButtonElements\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIfDoubleTriggerButtonElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIfStrokeElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eifStrokeElements\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIfStrokeElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInOnClause\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInOnClause\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebutton\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInOnClause\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIfSingleTriggerButtonElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInIfSingleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eIfSingleTriggerButtonElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eifSingleTriggerButtonElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIfDoubleTriggerButtonElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInIfDoubleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eIfDoubleTriggerButtonElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eifDoubleTriggerButtonElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIfStrokeElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eparams\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInIfStrokeClause\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003emoves\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eIfStrokeElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eifStrokeElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emoves\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eIfStrokeElement\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eValue\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSingleTriggerDoElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003edoElements\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSingleTriggerDoElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInIfStrokeClause\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003emoves\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInIfStrokeClause\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003emoves\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emoves\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emoves\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eIfStrokeElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eparams\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInIfStrokeClause\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003emoves\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emoves\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eSingleTriggerDoElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@do\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDoFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSingleTriggerDoElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edoElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eIfSingleTriggerButtonElement\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eValue\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSingleTriggerDoElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003edoElements\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSingleTriggerDoElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInIfSingleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInIfSingleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebutton\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eIfSingleTriggerButtonElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInIfSingleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eSingleTriggerDoElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@do\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDoFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSingleTriggerDoElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edoElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSingleTriggerDoElement\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eValue\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDoFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDoFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSingleTriggerDoElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDoFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eIfDoubleTriggerButtonElement\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eValue\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDoubleTriggerBeforeElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebeforeElements\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDoubleTriggerBeforeElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDoubleTriggerDoElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003edoElements\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDoubleTriggerDoElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDoubleTriggerAfterElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eafterElements\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDoubleTriggerAfterElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInIfDoubleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInIfDoubleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebutton\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eIfDoubleTriggerButtonElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptableInIfDoubleTriggerButtonClause\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDoubleTriggerBeforeElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@before\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBeforeFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoubleTriggerBeforeElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebeforeElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edoElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eafterElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDoubleTriggerDoElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@do\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDoFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoubleTriggerDoElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edoElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eafterElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDoubleTriggerAfterElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@after\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAfterFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoubleTriggerAfterElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eafterElements\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoubleTriggerBeforeElement\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eValue\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBeforeFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBeforeFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDoubleTriggerDoElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003edoParent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDoubleTriggerAfterElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eafterParent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoubleTriggerBeforeElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparentA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n        \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDoubleTriggerDoElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparentB\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDoubleTriggerAfterElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparentC\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBeforeFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eparentA\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edoParent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eparentB\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eafterParent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eparentC\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDoubleTriggerDoElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@do\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDoFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoubleTriggerDoElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edoParent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eafterParent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDoubleTriggerAfterElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@after\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAfterFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoubleTriggerAfterElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eafterParent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoubleTriggerDoElement\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eValue\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDoFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDoFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDoubleTriggerAfterElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eafterParent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoubleTriggerDoElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparentA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n        \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDoubleTriggerAfterElement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparentB\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n        \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDoFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eparentA\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eafterParent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eparentB\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDoubleTriggerAfterElement\u003c/span\u003e \u003cspan class=\"nf\"\u003e@after\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAfterFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoubleTriggerAfterElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eafterParent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoubleTriggerAfterElement\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eValue\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAfterFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAfterFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoubleTriggerAfterElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAfterFunc\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eあとはこの\u003ccode\u003e@when\u003c/code\u003eから始まるDSLで記述された設定を、扱いやすいようにパースしていけばいいでしょう。\u003c/p\u003e\n\n\u003cp\u003eパーサの実装例: \u003ca href=\"https://github.com/rubyu/CreviceApp/blob/2.0/CreviceApp/Core.DSLTreeParser.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCreviceApp/Core.DSLTreeParser.cs at 2.0 · rubyu/CreviceApp\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h4\u003e\n\n\u003cp\u003eここまで簡単にマウスジェスチャツールの作り方を解説してきました。要するに、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eフックを掛ける\u003c/li\u003e\n\u003cli\u003eコールバック関数にマウスメッセージが渡される\u003c/li\u003e\n\u003cli\u003eコールバック関数内でジェスチャに関する処理を行う\u003c/li\u003e\n\u003cli\u003eマウスメッセージを通すか通さないかを結果として返す\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこれだけです。ここまで読んでくれたあなたなら、きっとマウスジェスチャツールを実装できます。\u003c/p\u003e\n\n\u003cp\u003eそしていざ、マウスジェスチャツールを実装するときに注意してほしいことがあります。それは\u003cstrong\u003eレイテンシ\u003c/strong\u003eです。与えられたマウスメッセージは可能な限り迅速に処理しなければなりません。コールバック関数内でマウスメッセージを処理している間の時間が、ラグとしてユーザーのエクスペリエンスに影響を与えます。また、後述しますが、あまりにもラグが酷いと、フックがシステムによって外されてしまうこともあり得ます。\u003cstrong\u003e低レイテンシ\u003c/strong\u003eを心がけてください。\u003cbr\u003e\nCreviceAppが行っている低レイテンシのための対策としては、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eユーザーアクションは別スレッドで行う\u003c/li\u003e\n\u003cli\u003eカーソルの移動メッセージはある程度処理を間引く\u003c/li\u003e\n\u003cli\u003eカーソルの移動メッセージからジェスチャのストロークへの変換は別スレッドで行う\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eなどがあります。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"トラブルシューティング\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eトラブルシューティング\u003c/h4\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"うまくフックがかからない-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%86%E3%81%BE%E3%81%8F%E3%83%95%E3%83%83%E3%82%AF%E3%81%8C%E3%81%8B%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eうまくフックがかからない (1)\u003c/h5\u003e\n\n\u003cp\u003e\u003ccode\u003eSetWindowsHookEx()\u003c/code\u003eをコールしたスレッドはメッセージループを持っていますか？ \u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://stackoverflow.com/questions/7458807/why-must-setwindowshookex-be-used-with-a-windows-message-queue\" rel=\"nofollow noopener\" target=\"_blank\"\u003ec++ - Why must SetWindowsHookEx be used with a windows message queue - Stack Overflow\u003c/a\u003e\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"うまくフックがかからない-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%86%E3%81%BE%E3%81%8F%E3%83%95%E3%83%83%E3%82%AF%E3%81%8C%E3%81%8B%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eうまくフックがかからない (2)\u003c/h5\u003e\n\n\u003cp\u003eもしかして\u003ccode\u003eWH_MOUSE\u003c/code\u003eでフックを掛けようとしていませんか？ C#でやるにはかなり茨の道だと思われますので、必要がなければ\u003ccode\u003eWH_MOUSE_LL\u003c/code\u003eを使ったほうがいいような気がします。\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"うまくフックがかからない-3\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%86%E3%81%BE%E3%81%8F%E3%83%95%E3%83%83%E3%82%AF%E3%81%8C%E3%81%8B%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84-3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eうまくフックがかからない (3)\u003c/h5\u003e\n\n\u003cp\u003e\u003ca href=\"http://final.hateblo.jp/entry/2016/08/07/185340\" rel=\"nofollow noopener\" target=\"_blank\"\u003eC#でWin32 API(グローバルフック等)を使用してデバッグすると「指定されたモジュールが見つかりません」と表示されたとき。 - Code for final\u003c/a\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e「Visual Studio ホスティング プロセスを有効にする」チェックをはずすと普通に動いた。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"フックは動作するがしばらくするとエラーで終了してしまう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%83%83%E3%82%AF%E3%81%AF%E5%8B%95%E4%BD%9C%E3%81%99%E3%82%8B%E3%81%8C%E3%81%97%E3%81%B0%E3%82%89%E3%81%8F%E3%81%99%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%A7%E7%B5%82%E4%BA%86%E3%81%97%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eフックは動作するが、しばらくするとエラーで終了してしまう\u003c/h5\u003e\n\n\u003cp\u003e恐らくCallback関数がGCに回収されてしまうことが原因です。前述のコードに以下の修正を加えてください。具体的には、delegateとして変数に保持していれば大丈夫です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003edelegate\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"nf\"\u003eMouseCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ewParam\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003elParam\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eMouseCallback\u003c/span\u003e \u003cspan class=\"n\"\u003emouseCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"err\"\u003eコンストラクタ\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emouseCallback\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetHook\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ehInstance\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetModuleHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eProcess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCurrentProcess\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eMainModule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eModuleName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehHook\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetWindowsHookEx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWH_MOUSE_LL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emouseCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"フックは動作するが勝手に無効になることがある\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%83%83%E3%82%AF%E3%81%AF%E5%8B%95%E4%BD%9C%E3%81%99%E3%82%8B%E3%81%8C%E5%8B%9D%E6%89%8B%E3%81%AB%E7%84%A1%E5%8A%B9%E3%81%AB%E3%81%AA%E3%82%8B%E3%81%93%E3%81%A8%E3%81%8C%E3%81%82%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eフックは動作するが、勝手に無効になることがある\u003c/h5\u003e\n\n\u003cp\u003eもしかして、ロジックの実行に時間がかかりすぎたりしていませんか？\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://blogs.msdn.microsoft.com/alejacma/2010/10/14/global-hooks-getting-lost-on-windows-7/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGlobal hooks getting lost on Windows 7 – Decrypt my World\u003c/a\u003e\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"マウスメッセージがフックから漏れる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9E%E3%82%A6%E3%82%B9%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%8C%E3%83%95%E3%83%83%E3%82%AF%E3%81%8B%E3%82%89%E6%BC%8F%E3%82%8C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eマウスメッセージがフックから漏れる\u003c/h5\u003e\n\n\u003cp\u003eマウス入力をフックして、マウスメッセージを解釈し、何らかのアクションを実行する。…あれ？ 例えば右クリックから開始されたジェスチャがキャンセルされたとき、右クリックをマウスジェスチャツールが復元するとします。マウスジェスチャツールが送信したマウスメッセージはフックを経由して、またマウスジェスチャツールに戻ってきてしまいます…。\u003c/p\u003e\n\n\u003cp\u003eこの問題に対する簡単な対処の仕方は次のようなものです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 既にフックが実行されているとして\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eUnhook\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eRestoreClickEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eSetHook\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eしかしこの実装には問題があります。マウスジェスチャツールが復元したマウスメッセージは期待通りにフックを通過しますが、フックを一時的に解除しているため、その間にマウスから発生したメッセージもフックを通過してしまいます。マウスジェスチャツールによくある\u003cstrong\u003e漏れ\u003c/strong\u003eというのがこれです。この実装では結果的にユーザーのマウス入力を意図通りに解釈できず、ツールの信頼性は損なわれます。\u003c/p\u003e\n\n\u003cp\u003eよりよい対処は、マウスジェスチャツールが発行したマウスメッセージには署名を埋め込むというものです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMOUSEINPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Set the CreviceApp signature to the mouse event.\u003c/span\u003e\n\u003cspan class=\"n\"\u003emouseInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edwExtraInfo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMOUSEEVENTF_CREVICE_APP\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e例えばペンデバイスからの入力かどうかは、\u003ccode\u003edwExtraInfo\u003c/code\u003eを\u003ccode\u003e0xFFFFFF00\u003c/code\u003eでマスクした後に\u003ccode\u003e0xFF515700\u003c/code\u003eと比較することで確認できます。\u003cbr\u003e\n参考: \u003ca href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms703320(v=vs.85).aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSystem Events and Mouse Messages (Windows)\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e署名を埋め込むことにすれば、あとはマウスメッセージの署名を比較して、フィルタリングをするだけです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003efromCreviceApp\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003edwExtraInfo\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eMOUSEEVENTF_CREVICE_APP\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowsHook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResult\u003c/span\u003e \u003cspan class=\"nf\"\u003eMouseProc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLowLevelMouseHook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEvent\u003c/span\u003e \u003cspan class=\"n\"\u003eevnt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLowLevelMouseHook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMSLLHOOKSTRUCT\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efromCreviceApp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowsHook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTransfer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"特定の条件下でフリーズする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%89%B9%E5%AE%9A%E3%81%AE%E6%9D%A1%E4%BB%B6%E4%B8%8B%E3%81%A7%E3%83%95%E3%83%AA%E3%83%BC%E3%82%BA%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e特定の条件下でフリーズする\u003c/h5\u003e\n\n\u003cp\u003eマウス入力にフックを掛けつつ、同時にマウスメッセージを送信すると、特定の環境で問題が発生することがあります。具体的にはWindows10環境で、ユニバーサルアプリが動いてるときのみ、何秒間か、アプリケーションがフリーズするというものです。調べると、StrokesPlusで似たような現象が過去に生じていたようです。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://www.strokesplus.com/forum/topic/1042/resolved-windows-10-locked-up-when-right-click\" rel=\"nofollow noopener\" target=\"_blank\"\u003eStrokesPlus Forum - Free Mouse Gesture Utility for Windows XP/Vista/7/8\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこの問題は別スレッドからマウスメッセージを送信することで解決します。\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"特定の条件下でテストが失敗する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%89%B9%E5%AE%9A%E3%81%AE%E6%9D%A1%E4%BB%B6%E4%B8%8B%E3%81%A7%E3%83%86%E3%82%B9%E3%83%88%E3%81%8C%E5%A4%B1%E6%95%97%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e特定の条件下でテストが失敗する\u003c/h5\u003e\n\n\u003cp\u003eその条件というのはWindows10でユニバーサルアプリが動作しているとき…。はい、お察しの通り前述の問題です。同様の対策をとるか、あるいはWindows10のユニバーサルアプリを全部終了させてからテストを実行してください。\u003c/p\u003e\n\n\u003cp\u003eこんな通知ですら、この問題が発生するんです…。つらい。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/48ed6fc3b7a6e4af1a44c9c732b00647faa6dd6d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34373031342f34663836336661332d623636312d666265382d326363392d3034656331346534313135362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2F4f863fa3-b661-fbe8-2cc9-04ec14e41156.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=49aadeebd334cf07ef3d43cbe00c2b9b\" alt=\"SnapCrab_新しい通知_2016-10-21_20-53-38_No-00.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/47014/4f863fa3-b661-fbe8-2cc9-04ec14e41156.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2F4f863fa3-b661-fbe8-2cc9-04ec14e41156.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=50067902bd84f6dcfc8fdd2179deac15 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"高解像度環境で誤ったカーソルの位置にスケーリングされる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%AB%98%E8%A7%A3%E5%83%8F%E5%BA%A6%E7%92%B0%E5%A2%83%E3%81%A7%E8%AA%A4%E3%81%A3%E3%81%9F%E3%82%AB%E3%83%BC%E3%82%BD%E3%83%AB%E3%81%AE%E4%BD%8D%E7%BD%AE%E3%81%AB%E3%82%B9%E3%82%B1%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%95%E3%82%8C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e高解像度環境で誤ったカーソルの位置にスケーリングされる\u003c/h5\u003e\n\n\u003cp\u003eWindowsは、ある程度自動的に、アプリケーションの表示をディスプレイのDPIに合わせてスケーリングしてくれます。ただし、アプリケーションの認識するカーソル位置までスケーリングされてしまうと、マウスジェスチャツールの動作は正常なものではなくなってしまいます。自動的にディスプレイのDPIにアプリケーションの表示を追随させつつ、正しいカーソル位置を取得するには…という問題は以前は難しいものだったのですが、Windows 10 Creators Update（バージョン1703、ビルド15063）から新しくPerMonitorV2が追加され、多くのアプリケーションで簡単に解決できるようになりました。\u003c/p\u003e\n\n\u003cp\u003eWindowsのHigh DPI及びPer-Monitor DPIに対応するにはアプリケーションのマニュフェストに以下のような記述が必要になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e﻿\u003cspan class=\"nt\"\u003e\u0026lt;assembly\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"urn:schemas-microsoft-com:asm.v1\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emanifestVersion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"1.0\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:asmv3=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"urn:schemas-microsoft-com:asm.v3\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;asmv3:application\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;asmv3:windowsSettings\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/SMI/2005/WindowsSettings\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;dpiAware\u0026gt;\u003c/span\u003e\n        true/PM\n      \u003cspan class=\"nt\"\u003e\u0026lt;/dpiAware\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;dpiAwareness\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/SMI/2016/WindowsSettings\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        PerMonitorV2, PerMonitor\n      \u003cspan class=\"nt\"\u003e\u0026lt;/dpiAwareness\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/asmv3:windowsSettings\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/asmv3:application\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/assembly\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなお、上記の設定で、カーソル位置のスケーリングは無効になり、正しいものを取得できるようになりますが、2種のPer-Monitor API（PerMonitor, PerMonitorV2）が追加された前後、つまりWindows 8.1以前、Windows 10 CU以前、Windows 10 CU以降でそれぞれアプリケーションの表示スケーリングは異なります。そう、異なるのです…。CreviceAppではHigh DPI環境の人はWindows 10 CU以降を推奨しますよーということでお茶を濁します。\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"chromium-edgeで右クリックが効かなくなる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#chromium-edge%E3%81%A7%E5%8F%B3%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E3%81%8C%E5%8A%B9%E3%81%8B%E3%81%AA%E3%81%8F%E3%81%AA%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eChromium Edgeで右クリックが効かなくなる\u003c/h5\u003e\n\n\u003cp\u003edwExtraInfoに0xFFFFFF00のような雑なパターンを与えるとその他のブラウザでは正常に動作するが、Chromium Edgeだけで右クリックが効かなくなる不具合が生じます。\u003c/p\u003e\n","createdAt":"2016-10-20T22:25:26Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"lLFNYi3LKJjlaCxqMQKqniC5RatzIOpZ--0l0tjhuLUle1fE1I--GaDXlZBaCXnzQnMEjytw5g==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-09-06T02:53:40Z","likesCount":60,"linkUrl":"https://qiita.com/rubyu/items/88b9f93b39951252a0c1","organization":null,"originalId":432002,"stockedCount":69,"title":"マウスジェスチャツールの作り方","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%9C%E3%81%A3%E3%81%9F%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E7%B4%B9%E4%BB%8B\"\u003e作ったツールの紹介\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BF%85%E9%A0%88%E8%A6%81%E4%BB%B6\"\u003e必須要件\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%89%B9%E5%BE%B4\"\u003e特徴\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%B0%8E%E5%85%A5%E6%96%B9%E6%B3%95\"\u003e導入方法\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A8%AD%E5%AE%9Adsl%E3%81%AE%E6%96%87%E6%B3%95\"\u003e設定DSLの文法\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%8A%B6%E6%85%8B%E3%82%92%E6%8C%81%E3%81%A4%E8%A8%AD%E5%AE%9A%E3%81%AE%E4%BE%8B\"\u003e状態を持つ設定の例\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003eおわりに\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9E%E3%82%A6%E3%82%B9%E3%82%B8%E3%82%A7%E3%82%B9%E3%83%81%E3%83%A3%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9\"\u003eマウスジェスチャツールの作り方\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BB%95%E7%B5%84%E3%81%BF\"\u003e基本的な仕組み\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#tips\"\u003eTips\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE%E9%80%81%E4%BF%A1\"\u003eメッセージの送信\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#sendinput\"\u003eSendInput\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AEapi\"\u003eその他のAPI\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8B%9D%E6%89%8Btaskscheduler\"\u003e勝手TaskScheduler\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%84%E3%83%BC%E3%83%AB%E3%83%81%E3%83%83%E3%83%97%E3%82%92%E4%BB%BB%E6%84%8F%E3%81%AE%E4%BD%8D%E7%BD%AE%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B\"\u003eツールチップを任意の位置に表示する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A4%87%E9%9B%91%E3%81%95%E3%81%A8%E3%81%AE%E6%88%A6%E3%81%84\"\u003e複雑さとの戦い\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%82%A2%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E3%81%AEfsm%E5%8C%96\"\u003eコアロジックのFSM化\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#gui%E3%81%A7%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E8%AB%A6%E3%82%81%E3%82%8Broslyn%E3%81%AE%E3%82%B9%E3%82%B9%E3%83%A1\"\u003eGUIでの設定を諦める（Roslynのススメ）\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\"\u003eトラブルシューティング\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%86%E3%81%BE%E3%81%8F%E3%83%95%E3%83%83%E3%82%AF%E3%81%8C%E3%81%8B%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84-1\"\u003eうまくフックがかからない (1)\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%86%E3%81%BE%E3%81%8F%E3%83%95%E3%83%83%E3%82%AF%E3%81%8C%E3%81%8B%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84-2\"\u003eうまくフックがかからない (2)\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%86%E3%81%BE%E3%81%8F%E3%83%95%E3%83%83%E3%82%AF%E3%81%8C%E3%81%8B%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84-3\"\u003eうまくフックがかからない (3)\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%95%E3%83%83%E3%82%AF%E3%81%AF%E5%8B%95%E4%BD%9C%E3%81%99%E3%82%8B%E3%81%8C%E3%81%97%E3%81%B0%E3%82%89%E3%81%8F%E3%81%99%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%A7%E7%B5%82%E4%BA%86%E3%81%97%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86\"\u003eフックは動作するが、しばらくするとエラーで終了してしまう\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%95%E3%83%83%E3%82%AF%E3%81%AF%E5%8B%95%E4%BD%9C%E3%81%99%E3%82%8B%E3%81%8C%E5%8B%9D%E6%89%8B%E3%81%AB%E7%84%A1%E5%8A%B9%E3%81%AB%E3%81%AA%E3%82%8B%E3%81%93%E3%81%A8%E3%81%8C%E3%81%82%E3%82%8B\"\u003eフックは動作するが、勝手に無効になることがある\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9E%E3%82%A6%E3%82%B9%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%8C%E3%83%95%E3%83%83%E3%82%AF%E3%81%8B%E3%82%89%E6%BC%8F%E3%82%8C%E3%82%8B\"\u003eマウスメッセージがフックから漏れる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%89%B9%E5%AE%9A%E3%81%AE%E6%9D%A1%E4%BB%B6%E4%B8%8B%E3%81%A7%E3%83%95%E3%83%AA%E3%83%BC%E3%82%BA%E3%81%99%E3%82%8B\"\u003e特定の条件下でフリーズする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%89%B9%E5%AE%9A%E3%81%AE%E6%9D%A1%E4%BB%B6%E4%B8%8B%E3%81%A7%E3%83%86%E3%82%B9%E3%83%88%E3%81%8C%E5%A4%B1%E6%95%97%E3%81%99%E3%82%8B\"\u003e特定の条件下でテストが失敗する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%AB%98%E8%A7%A3%E5%83%8F%E5%BA%A6%E7%92%B0%E5%A2%83%E3%81%A7%E8%AA%A4%E3%81%A3%E3%81%9F%E3%82%AB%E3%83%BC%E3%82%BD%E3%83%AB%E3%81%AE%E4%BD%8D%E7%BD%AE%E3%81%AB%E3%82%B9%E3%82%B1%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%95%E3%82%8C%E3%82%8B\"\u003e高解像度環境で誤ったカーソルの位置にスケーリングされる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#chromium-edge%E3%81%A7%E5%8F%B3%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E3%81%8C%E5%8A%B9%E3%81%8B%E3%81%AA%E3%81%8F%E3%81%AA%E3%82%8B\"\u003eChromium Edgeで右クリックが効かなくなる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":13854,"uuid":"88b9f93b39951252a0c1","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"NXv7Z7DM6sJOBa5z3OuU63Np9v0=--3O5iGBexgoXf8m+M--DYtH11jPCMNGnW4DBYL/oA==","originalId":47014,"description":"","facebookUrl":null,"githubUrl":"https://github.com/rubyu","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/47014/profile-images/1473690845","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2Fprofile-images%2F1473690845?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=bd93eb5a66846ac65bcd1e79dbfbdd9a","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47014%2Fprofile-images%2F1473690845?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=bea11152503f24d802eee2e0fc9db59d","urlName":"rubyu","websiteUrl":null,"twitterUrl":"https://twitter.com/ruby_U","twitterUrlName":"ruby_U","revealedOrganizations":{"edges":[]}},"tags":[{"name":"Windows","urlName":"windows"},{"name":"C#","urlName":"csharp"},{"name":"Roslyn","urlName":"roslyn"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

More than 3 years have passed since last update.　ECHONET Liteのコントローラの制御関連のプログラムをC#で書きたかったのですが、ネット検索してもあまりヒットしなかったので自作しました。
　サンプルコードはGithubのechonetlitecsリポジトリに置いています。
　「一覧の取得」ボタンを押すとLAN内のECHONET Liteノード一覧を取得します。ノードが取得できると、下のノード欄に1つ目に取得したノードコードがセットされます。次の欄にインスタンス番号がセットされます。
　「オン」「オフ」ボタンは、スイッチのオンオフを行うボタンです。図の一覧に表示されている0290は一般照明のノードコードですので「オン」「オフ」ボタンを押すと、照明を点けたり消したりできます。一覧の取得はUDPマルチキャストすることによって、ノードからの返信を取得します。
ポートは3610、アドレスは224.0.23.0 です。とりあえず、PortとMulticastAddressを設定しています。　UDPマルチキャストするとノードの返信はUDPユニキャストで返ってきます。なので、UDPマルチキャストを送信した後にUDPユニキャストで受信します。プログラムは以下です(エラー処理は省いています)。　これで、recvBytes[]にノード一覧のフレームデータが入っています。ノードのIPアドレスは remoteEP.Address に入っています。
　listにノードデータを追加しています。ECHONET Liteとは直接関係ないですが、マルチキャストの際に自身のローカルIPアドレスを付加しておかないとUDPユニキャストが返って来ないようです。ローカルIPアドレスのプロパティを追加しました。フォームのソースコードの方に自身のローカルIPアドレスを取得するメソッドも入れています。ECHONET Liteのコントロールサンプルとして、スイッチのオンオフサンプルコードを付けています。スイッチのオンオフ用フレームをUDPユニキャストで送信するだけです。　 SwitchSet()は、スイッチ用のフレーム生成するメソッドです。プロパティ番号0x80がスイッチのオンオフプロパティです。　簡単ですが、こんな感じでC#から制御できるようになりました。



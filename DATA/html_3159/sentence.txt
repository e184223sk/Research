More than 1 year has passed since last update.今までViveしか触ったことがなかったため、
OculusTouchコントローラーで人差し指と親指が動かせると知った時には感動しました。しかし、過去にViveで遊んできたコンテンツ、作成してきたコンテンツの中で
「ここで人差し指とか親指が動かせたらな～」と思ったことは さほどありませんでした。実際にOculusQuestで開発を進めていると、
指が動くとかえって邪魔になるという場面にすら遭遇しました。なので、開発に応じて簡単に指の動きの制限を切り替えられる機能は無いのか？　と思い調べました。着地点は下記実装です。
①コブシを握る
②握ったコブシを開く
③必要に応じて指を動かせるようにするHandクラスの中に指のアニメーションのオンオフ切り替え機能がありました。
PrefabはOculus-SampleFramework-Core-CustomHands-CustomHandLeft(Right)にあります。
Inspectorはこんな感じです。この中で今回のアニメーションの切り替えに関係しているプロパティがあります。
Handの中のDefault Grab Poseです。
初期状態ではPrefabの中のHandPoseDefaultPfがアタッチされています。
HandPoseDefaultPfのInspectorはこうです。

このAllow Pointing、Allow Thumbs Upが人差し指、親指の制御を担っています。
今回は使いませんが、Pose IDも便利な機能を持っていて、物に応じてつかんだ時のポーズを設定できます。少しHandメソッドの中を見ていきます。下記の箇所で掴んだ物に応じたアニメーション制御を可能にしています。
掴んだ物にHandPoseをアタッチしてPose Idを設定することで可能です。今回の目的は、
①コブシを握る
②握ったコブシを開く
③必要に応じて指を動かせるようにする
だけに制限することなので使いませんが非常に便利かと思います。修正する箇所は下記のcanPointとcanThumbsUpです。短絡評価1を使用しているのでややこしくみえますが、
改良前のコード(コメントアウトしてある箇所)は、先にgrabbing(物をつかんでいるか)の評価を行っているので、
canPointとcanThumbsUpのTrue、Falseに関わらず指が動いてしまいます。
つまり、改良前のコード(コメントアウトしてある箇所)は物をつかんだ時に指が動くかどうかのみを制限しているということです。改良後のコードでは根本的に指を動かすことを制限するために、判定を逆にしています。
これにより、
①コブシを握る
②握ったコブシを開く
③必要に応じて指を動かせるようにする
という制限を与える事が可能になりました。制限を加えることができましたが、まだ厳密には制限しきれていません。
画像のように、つまむ動作に関しては反映されてしまいます。
これはアニメーターの設定がゴリゴリになっていることが原因です。
ほとんど使わないのでこうします。
右手がアニメーションを整理する前、左手が整理した後です。
見ても何も伝わらないと思いますのでアニメーターの設定変更と最後のコードのコピペをして試してみてほしいです。
いらないと思ったものはガンガン削除しました。
一応、別のScriptとして作成しました。なんかOculusの権利関係ややこしそうなので、
コピーライティング書いときます。参考リンク ↩



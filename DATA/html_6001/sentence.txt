More than 3 years have passed since last update.　「なんか機械学習で遊びてーなー」と思いまして。機械学習フレームワークに食わせる前処理として、動画から画像を取り出す処理が必要になったので調べたのをまとめました。　ソースコード全文はGistに上げてます。とりあえずコレを使えればどうにかなると思う。　一々ローカルストレージに保存したくないなーってときに使う。パイプで流したバイナリデータの取得周りで結構ハマりました。　画像1枚を取り出すときのやつをガリガリ回すだけ。fpsじゃなくてintervalで時間間隔指定してるのは、手元で作業する際に「5秒毎に1枚欲しい」「1分ごとに1枚欲しい」といった要望が多かったため。　これも画像1枚を取り出すときのやつを並列でガリガリ回すだけ。Task.WhenAllで全ての抽出処理が終わるのをガッツリ待っているため、抽出対象の画像数が多い、画像サイズが大きいとメモリがパンパンになるので注意。　わざわざ並列でゴリゴリ回さなくても、ffmpegにあるrオプションを使うことでfps指定して画像を取得することが出来ます。簡単！なのですが、手元での処理では先述の2つより3倍くらい遅かったです(20分程度の動画から5秒ごとに画像抽出する場合)。パラメータ変えたり具体的なベンチマークとったりしてませんが、結構な差が出たので目的に応じて処理方法を変える必要があるかもしれません。　以上です。ffmpegはオプション変えることでいろんな処理できて面白いですね！ffmpegは使用するオプションの有無だけでなく、オプションの順番を変えることでも処理速度にも大きな差が出てきます。最適なオプションを最適な順番で使えるようになりたいものです。　(並列処理周りの記述方法、実はあまり自信がありません。なんかおかしいぞ！もっと効率よくできるぞ！といったアドバイスあったらぜひ教えてほしいです。)



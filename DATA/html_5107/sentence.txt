More than 1 year has passed since last update.今までソーシャルゲームにいくら課金したか覚えていますか？
1カ月くらいなら覚えておくことができますが、今まで累計でいくら課金したかを覚えておくことは無理だと思います。
そこで今回は累計課金額を調査してみました。課金した情報はどこから収集できるでしょうか。
アプリの中に課金額の表示があるものもありますが、アプリ内から見れたところですべて足していくのは面倒ですしそもそもない場合はどうしようもありません。
今回は課金した際に届くメールから情報を収集することにしました。
iPhoneの場合、AppStoreで課金すると必ずAppleからの領収書がメールで届きます。
それをパースしてやれば目的を達成することができそうです。
(Androidの場合は申し訳ありませんがよくわかりません。)メールをパースしてプログラムから扱うためにまずはメールのデータをローカルにエクスポートする必要があります。
エクスポート方法については色々あると思いますが、私は登録にyahooメールを使用しているので以下のサイトを参考にしました。Yahoo!メールをテキストファイル形式でバックアップする方法(Thunderbird利用)ImportExportTools を使用してエクスポートしたメールは結構カオスな感じになってます。
一部を抜粋すると以下のようになっていました。(一部データを改変しています。)上記の例は 拡張少女系トライナリー に 9800 円課金したときのものですが、ここから情報を取り出すのはそこそこ大変です。
あまり形が整ってないうえに同時に課金した場合や時期によって形がそこそこ変わるからです。
今回は以下の戦略でパースすることにしました。上の文章を見てもよくわからないと思いますので実際に書いたコードを以下に掲載します。これで行けると思ったのですが、明らかに課金した額以上が表示されてしまいました。
エクスポートしたメールをよく見てみるとなぜかメールの前半部分と後半部分で同じ内容が入っていることがわかりました。
なぜこうなっているのかはよくわからないのですが、仕方がないのでどうにかしてトリミングできないか考えたところ
中間付近にプライバシーポリシーという単語が入っていたのでその部分まででパースを終了するように改良しました。
最終的には以下のコードになりました。前に手動で調べたときから比べて大体予想通りの増え方をしているのでたぶん成功していると思います。課金額を調べるのがなかなか面倒だったのでこれからは半自動で計算できるので楽になります。
メールからは課金した日もとれるのでそれを使用してグラフ化するというのも面白いと思います。
もっと楽な方法があれば教えてください。



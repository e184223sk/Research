<!DOCTYPE html><html><head><meta charset="utf-8" /><title>生演奏×オーディオリアクティブ、人数無制限のVRライブシステムを作ってライブしたときのシステム構成と実装 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/memex_pibo/items/3fbfcd627e5e7c7f2061" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="Ork8O3FIzLPxBCO9/2y10n15suaM7gTI0X1THyGrG03YUJwPqBJD7GYYHKsqXjG72nFzon0eAq00SfLnGMtKNQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@memex_pibo" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="生演奏×オーディオリアクティブ、人数無制限のVRライブシステムを作ってライブしたときのシステム構成と実装 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND01NVNmNXJ5VTVhV1B3NWZqZ3Fyamc3empnNGZqZ3FQamdxcmpnNnJqZ3FMamdxX2pnNGJqZ3FQamc1YmpnSUhrdXJybWxiRG5oS0hsaUxicG1aRGpnYTVXVXVPRHFlT0NwT09EbHVPQ3QtT0N1ZU9EaHVPRG9PT0NrdVM5bk9PQm8tT0JwdU9EcWVPQ3BPT0RsdU9CbC1PQm4tT0JxT09CamVPQnJ1T0N0LU9DdWVPRGh1T0RvT2FuaS1hSWtPT0JxT1d1bi1pamhRJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTU3NmNjNGEyMDRmNmJmZmQwYmVjOGM2ZjRiNmM1ZWVm&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzFsYldWNFgzQnBZbTgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1kZWYwZTQ2YTQ3NzEwMjNiYzBkYjUyMTQ3YjgyMDAyZQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=02977219451e99ea240bb2b0e1a86fd4"><meta property="og:description" content="

はじめに



ぴぼ(@memex_pibo)と申します。
「memex」というVR空間で活動する2人組音楽ユニットをしています。
5月末ごろ、「Omnipresence Live」というVRライブシステムを作って「#解釈不一致」..."><meta content="https://qiita.com/memex_pibo/items/3fbfcd627e5e7c7f2061" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Unity,Max-MSP,Shader,VR" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-a1ad2c5a-485b-468f-b8cb-d5a013cf08a8"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fmemex_pibo%2Fitems%2F3fbfcd627e5e7c7f2061">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fmemex_pibo%2Fitems%2F3fbfcd627e5e7c7f2061">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-a1ad2c5a-485b-468f-b8cb-d5a013cf08a8">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-07-12T23:48:44.000+09:00","dateModified":"2020-07-17T21:01:57.000+09:00","headline":"生演奏×オーディオリアクティブ、人数無制限のVRライブシステムを作ってライブしたときのシステム構成と実装","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND01NVNmNXJ5VTVhV1B3NWZqZ3Fyamc3empnNGZqZ3FQamdxcmpnNnJqZ3FMamdxX2pnNGJqZ3FQamc1YmpnSUhrdXJybWxiRG5oS0hsaUxicG1aRGpnYTVXVXVPRHFlT0NwT09EbHVPQ3QtT0N1ZU9EaHVPRG9PT0NrdVM5bk9PQm8tT0JwdU9EcWVPQ3BPT0RsdU9CbC1PQm4tT0JxT09CamVPQnJ1T0N0LU9DdWVPRGh1T0RvT2FuaS1hSWtPT0JxT1d1bi1pamhRJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTU3NmNjNGEyMDRmNmJmZmQwYmVjOGM2ZjRiNmM1ZWVm\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzFsYldWNFgzQnBZbTgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1kZWYwZTQ2YTQ3NzEwMjNiYzBkYjUyMTQ3YjgyMDAyZQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=02977219451e99ea240bb2b0e1a86fd4","mainEntityOfPage":"https://qiita.com/memex_pibo/items/3fbfcd627e5e7c7f2061","author":{"@type":"Person","address":"","email":null,"identifier":"memex_pibo","name":"memex_pibo","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fprofile-images%2F1594987942?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=cfc50bbf0a93fdf9532da200af717d7b","url":"https://qiita.com/memex_pibo","description":"https://twitter.com/memex_pibo","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita&amp;utm_medium=header-banner">グループ会社出納業務の証票処理を70％自動化。日立のAI-OCR技術とは？</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"memex_pibo","type":"items","id":"3fbfcd627e5e7c7f2061"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"グループ会社出納業務の証票処理を70％自動化。日立のAI-OCR技術とは？","url":"https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"memex_pibo","type":"items","id":"3fbfcd627e5e7c7f2061"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"グループ会社出納業務の証票処理を70％自動化。日立のAI-OCR技術とは？","url":"https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"memex_pibo","type":"items","id":"3fbfcd627e5e7c7f2061"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"グループ会社出納業務の証票処理を70％自動化。日立のAI-OCR技術とは？","url":"https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/memex_pibo/items/3fbfcd627e5e7c7f2061","location":"/memex_pibo/items/3fbfcd627e5e7c7f2061","scheme":"https","host":"qiita.com","port":null,"pathname":"/memex_pibo/items/3fbfcd627e5e7c7f2061","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"FDz6/Ob1Cp3CVCjzSFKaPRQAJhAgyFoF4uGuu5911cn21VrIP6+FwlVIF+WdYB5UswjnVNE4XGAH1Q9DphWEsQ==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-10c692f3-1171-4383-80ab-d56b7721d05e"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/memex_pibo/items/3fbfcd627e5e7c7f2061/likers" class="css-1iupg5d">282</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">210</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3fbfcd627e5e7c7f2061/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/memex_pibo/items/3fbfcd627e5e7c7f2061/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/memex_pibo/items/3fbfcd627e5e7c7f2061/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/memex_pibo/items/3fbfcd627e5e7c7f2061/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/memex_pibo/items/3fbfcd627e5e7c7f2061.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/memex_pibo"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/profile-images/1594987942" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/memex_pibo" class="css-10ougpm">@<!-- -->memex_pibo</a><div class="css-1ay9vb9"><span><meta content="2020-07-12T14:48:44Z"/><time dateTime="2020-07-17T12:01:57Z" class="css-m19uds">updated at 2020-07-17</time></span></div></div></div></div></div><h1 class="css-cgzq40">生演奏×オーディオリアクティブ、人数無制限のVRライブシステムを作ってライブしたときのシステム構成と実装</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/max-msp" class="css-4czcte">Max-MSP</a><a href="/tags/shader" class="css-4czcte">Shader</a><a href="/tags/vr" class="css-4czcte">VR</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p><a href="https://camo.qiitausercontent.com/7f6392af8edefac56a69dc994e622911904509e0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f66376130626230632d393666622d343164392d383134382d3861356537316137323935322e676966" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Ff7a0bb0c-96fb-41d9-8148-8a5e71a72952.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=271cb42496b742f3ba543586aed9cf4d" alt="phantom.gif" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/f7a0bb0c-96fb-41d9-8148-8a5e71a72952.gif" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Ff7a0bb0c-96fb-41d9-8148-8a5e71a72952.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0e63389fa8187511692946de03cd0bba 1x" loading="lazy"></a></p>

<p>ぴぼ(<a href="https://twitter.com/memex_pibo" rel="nofollow noopener" target="_blank">@memex_pibo</a>)と申します。<br>
「<a href="http://meme-x.jp/" rel="nofollow noopener" target="_blank">memex</a>」というVR空間で活動する2人組音楽ユニットをしています。<br>
5月末ごろ、「Omnipresence Live」というVRライブシステムを作って「#解釈不一致」というタイトルのライブをしました。<br>
生演奏に対してオーディオリアクティブな空間演出が行われて、かつ人数制限の無いライブという、類例の少ないVRライブになったと思います。<br>
このエントリでは、その実装や運用を解説します。</p>

<h2>
<span id="アーカイブ" class="fragment"></span><a href="#%E3%82%A2%E3%83%BC%E3%82%AB%E3%82%A4%E3%83%96"><i class="fa fa-link"></i></a>アーカイブ</h2>

<p>「#解釈不一致」の空間アーカイブはVRChatのワールドとして公開してあります。<br>
こちらから体験いただけます。所要時間は50分程度です。<br>
<a href="https://vrchat.com/home/world/wrld_21a48553-fd25-40d0-8ff0-b4402b36172a" class="autolink" rel="nofollow noopener" target="_blank">https://vrchat.com/home/world/wrld_21a48553-fd25-40d0-8ff0-b4402b36172a</a></p>

<p>また、YouTube上に360°ステレオ映像のアーカイブを用意しております。<br>
<a href="https://youtu.be/CIahS2Z1_Ds" class="autolink" rel="nofollow noopener" target="_blank">https://youtu.be/CIahS2Z1_Ds</a></p>

<p>ご覧いただいた方が理解しやすいと思いますので、是非一度観て頂きたいです。</p>

<h2>
<span id="システム図" class="fragment"></span><a href="#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E5%9B%B3"><i class="fa fa-link"></i></a>システム図</h2>

<p>「#解釈不一致」を行った際のシステム図です。<br>
遠隔地にいるmemexの2人がネット越しに音声とモーションを共有し、それを一度映像に変換してからVRChatのワールドに配信するという形になっています。<br>
<a href="https://camo.qiitausercontent.com/4127bdc1e23772926d8b313fead5d1a76e07dcaf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f63643039396466322d313237612d363734392d383664642d3739613166356266656436612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fcd099df2-127a-6749-86dd-79a1f5bfed6a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1322548da29b4d19ba7ccebf076a4a7a" alt="fuitch (3).png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/cd099df2-127a-6749-86dd-79a1f5bfed6a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fcd099df2-127a-6749-86dd-79a1f5bfed6a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=33636d38cb14b94e0a6a13178da69993 1x" loading="lazy"></a></p>

<h2>
<span id="解説の流れ" class="fragment"></span><a href="#%E8%A7%A3%E8%AA%AC%E3%81%AE%E6%B5%81%E3%82%8C"><i class="fa fa-link"></i></a>解説の流れ</h2>

<p>まずライブを実現する技術のコアとなる「Omnipresence Live」の実装について解説し、さらにその具体的な運用として「#解釈不一致」の事例を紹介します。</p>

<h3>
<span id="omnipresence-liveの解説トピック" class="fragment"></span><a href="#omnipresence-live%E3%81%AE%E8%A7%A3%E8%AA%AC%E3%83%88%E3%83%94%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>「Omnipresence Live」の解説トピック</h3>

<ul>
<li>オーディオの音量をOSCに変換する</li>
<li>MIDI信号をOSCに変換する</li>
<li>OSCの値をUnityで受けてRenderTextureに書き込む</li>
<li>映像として情報を送信したい時の映像エンコード対策</li>
<li>アバターの頂点アニメーションテクスチャをリアルタイムに映像化する</li>
<li>頂点情報が埋め込まれたテクスチャからアバターのモーションを再構成する</li>
<li>Quaternionを用いてShaderのみでオブジェクトの回転を表現する</li>
</ul>

<h3>
<span id="解釈不一致の解説トピック" class="fragment"></span><a href="#%E8%A7%A3%E9%87%88%E4%B8%8D%E4%B8%80%E8%87%B4%E3%81%AE%E8%A7%A3%E8%AA%AC%E3%83%88%E3%83%94%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>「#解釈不一致」の解説トピック</h3>

<ul>
<li>生歌とギターの生演奏による遠隔セッション</li>
<li>楽曲を構成するトラック毎に反応するパラオーディオリアクティブな空間演出</li>
<li>生演奏を含む音楽の特定のタイミングで発火する演出イベント管理</li>
<li>遠隔モーションキャプチャ</li>
<li>ギターの生演奏とギターモーション収録の両立</li>
<li>ツイートのVR空間へのリアルタイム表示</li>
<li>遠隔モーション収録時の返しモニタ</li>
<li>AWSによる専用映像ストリーミングサーバ構築</li>
<li>VRChatへのOmnipresence Liveリコンストラクタの実装</li>
<li>VRChat上での空間編集機能</li>
</ul>

<h1>
<span id="omnipresence-live-の実装" class="fragment"></span><a href="#omnipresence-live-%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>Omnipresence Live の実装</h1>

<h2>
<span id="omnipresence-live-とは" class="fragment"></span><a href="#omnipresence-live-%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>Omnipresence Live とは</h2>

<p>VRライブを構成する要素である<strong>アバターのモーション・演出・音声</strong>の情報を全て映像に変換して配信し、配信された映像を受け取ってVRライブを再構成するシステムです。</p>

<h3>
<span id="特徴" class="fragment"></span><a href="#%E7%89%B9%E5%BE%B4"><i class="fa fa-link"></i></a>特徴</h3>

<ul>
<li>参加人数の制限が無い

<ul>
<li>ただし観客が観客全員を視認できるわけではない</li>
</ul>
</li>
<li>生歌・生演奏が可能</li>
<li>生モーション収録が可能</li>
<li>パラオーディオリアクティブ（楽曲の各トラックに演出が反応する）な空間演出が可能</li>
</ul>

<h3>
<span id="解決する課題" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E3%81%99%E3%82%8B%E8%AA%B2%E9%A1%8C"><i class="fa fa-link"></i></a>解決する課題</h3>

<p>生演奏にタイミングが合ったオーディオリアクティブな空間演出のあるVRライブをする方法が（作らないと）ないこと<br>
純粋に解決するなら音声とタイムコードを共有したモーション・演出を配信できるサーバーと対応したクライアントを作る必要がありそうです。</p>

<h3>
<span id="手法" class="fragment"></span><a href="#%E6%89%8B%E6%B3%95"><i class="fa fa-link"></i></a>手法</h3>

<p>モーション・演出の情報を映像に変換することで音声とタイミングが一致した状態でモーション・演出を配信する</p>

<h3>
<span id="仕組み" class="fragment"></span><a href="#%E4%BB%95%E7%B5%84%E3%81%BF"><i class="fa fa-link"></i></a>仕組み</h3>

<p>次の2つのシステムに分けられます。<br>
<strong>イベントビジュアライザ</strong>：アバターのモーションとVR空間演出のパラメータを毎フレーム画像として書き出す<br>
<strong>リコンストラクタ</strong>：イベントビジュアライザが生成した画像からアバターの動きとVR空間演出を再構成する</p>

<h2>
<span id="イベントビジュアライザ" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6"><i class="fa fa-link"></i></a>イベントビジュアライザ</h2>

<p>イベントビジュアライザは、毎フレームアバターのモーション・空間の演出情報を下のような画像にします。</p>

<p><a href="https://camo.qiitausercontent.com/48c81d4385306f611162af9a09898cf842a0adba/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f31356162636131342d366262332d616439392d666266382d3164313232656163633664632e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F15abca14-6bb3-ad99-fbf8-1d122eacc6dc.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f7ca241933bdfd5ba360ed3241373505" alt="InkedOmnipresenceLiveテクスチャ - コピー_LI.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/15abca14-6bb3-ad99-fbf8-1d122eacc6dc.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F15abca14-6bb3-ad99-fbf8-1d122eacc6dc.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f4745750e16eddb27ba3e42fcedead4c 1x" loading="lazy"></a></p>

<p>水色で囲われている部分が演出情報、緑色で囲われている部分がモーション情報です。</p>

<h3>
<span id="イベントビジュアライザシステム構成" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E6%A7%8B%E6%88%90"><i class="fa fa-link"></i></a>イベントビジュアライザ・システム構成</h3>

<ul>
<li>Ableton Live Suite

<ul>
<li>概要

<ul>
<li>DAW（作曲などに用いるソフト）</li>
</ul>
</li>
<li>役割

<ul>
<li>ライブのタイムライン管理</li>
<li>Max for Liveへの橋渡し</li>
<li>ライブ音声の処理</li>
</ul>
</li>
</ul>
</li>
<li>Max for Live

<ul>
<li>概要

<ul>
<li>Ableton Liveの各トラック上でMAX/MSP（ビジュアルプログラミング環境）を走らせられるプラグイン</li>
</ul>
</li>
<li>役割

<ul>
<li>ライブの音声の各トラック（歌、ギター、ドラムのキック、ドラムのスネアなど）の音量をOSCで送信する</li>
<li>MIDI信号をOSCで送信する</li>
</ul>
</li>
</ul>
</li>
<li>Unity（演出信号ビジュアライザ）

<ul>
<li>役割

<ul>
<li>OSCで受け取った音量・MIDI信号を1920px × 1080pxのテクスチャに書き込む</li>
</ul>
</li>
</ul>
</li>
<li>Unity（頂点ビジュアライザ）

<ul>
<li>役割

<ul>
<li>VRMアバターの頂点の位置情報を一つずつ1920px × 1080pxのテクスチャに書き込む</li>
</ul>
</li>
</ul>
</li>
<li>Unity（位置・姿勢ビジュアライザ）

<ul>
<li>役割

<ul>
<li>任意のオブジェクトのTransformを1920px × 1080pxのテクスチャに書き込む</li>
</ul>
</li>
</ul>
</li>
</ul>

<h3>
<span id="ableton-live-suite" class="fragment"></span><a href="#ableton-live-suite"><i class="fa fa-link"></i></a>Ableton Live Suite</h3>

<p><a href="https://camo.qiitausercontent.com/ea13820baa9e1f9f1d48e5dfb44e6945d9c04a76/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f35353332326237302d393831342d386363322d343664342d6234653638343136646564612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F55322b70-9814-8cc2-46d4-b4e68416deda.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ad6d02ac455061a5b26d13217e3d3e3d" alt="live2.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/55322b70-9814-8cc2-46d4-b4e68416deda.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F55322b70-9814-8cc2-46d4-b4e68416deda.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=237d7e3b2386e05f95ff4cfed1ae26b1 1x" loading="lazy"></a></p>

<p>音声をMax for Liveに送ります。<br>
オーディオリアクティブトラック、生歌トラック、生ギタートラックにそれぞれ後述する紫色のMax for Liveプラグインを挿すことでそれぞれのパートの音量・ピッチを個別にOSCに変換します。</p>

<h3>
<span id="max-for-liveプラグイン" class="fragment"></span><a href="#max-for-live%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3"><i class="fa fa-link"></i></a>Max For Liveプラグイン</h3>

<p><a href="https://camo.qiitausercontent.com/4a07db2fc47943d63e8e46970485580be84ed134/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f63393566656662632d366535322d626362342d343031642d6461363138616230306461622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fc95fefbc-6e52-bcb4-401d-da618ab00dab.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2df51aeff3f291cfaf76d5b01e87d3b7" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/c95fefbc-6e52-bcb4-401d-da618ab00dab.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fc95fefbc-6e52-bcb4-401d-da618ab00dab.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3cf9bb0dc8c4b37e260c7b9cede4ffb6 1x" loading="lazy"></a></p>

<p>Max for Liveとは、Ableton Liveと連携可能な音声信号をすごく簡単に扱えるビジュアルプログラミング環境です。<br>
Ableton Live Suiteの各トラックの音声の音量・ピッチ（音階）を算出してOSCで送信します。</p>

<h3>
<span id="unity演出信号ビジュアライザ" class="fragment"></span><a href="#unity%E6%BC%94%E5%87%BA%E4%BF%A1%E5%8F%B7%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6"><i class="fa fa-link"></i></a>Unity（演出信号ビジュアライザ）</h3>

<p><a href="https://camo.qiitausercontent.com/bae78976cfdc7e6ae6effa2986e2824b2f2d224e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f65343162316134632d393161622d653562352d373537332d6336353332613861616433382e676966" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe41b1a4c-91ab-e5b5-7573-c6532a8aad38.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=db5659094644d063b3c24b211e546a38" alt="audioEventVZoom.gif" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/e41b1a4c-91ab-e5b5-7573-c6532a8aad38.gif" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe41b1a4c-91ab-e5b5-7573-c6532a8aad38.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f978a7b309ed89ba8465d5db6bfe6cc6 1x" loading="lazy"></a></p>

<p>音量・ピッチ・曲の展開に合わせた演出信号をテクスチャに変換します。<br>
Max for Liveが出すOSC信号を受け取って画像化します。<br>
OSCの受信には <a href="https://github.com/hecomi/uOSC" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/hecomi/uOSC</a> を利用しています。</p>

<p>精度の要らない値となるべく精度が欲しい値で少し異なるアプローチを取ります。</p>

<h4>
<span id="精度の要らない値" class="fragment"></span><a href="#%E7%B2%BE%E5%BA%A6%E3%81%AE%E8%A6%81%E3%82%89%E3%81%AA%E3%81%84%E5%80%A4"><i class="fa fa-link"></i></a>精度の要らない値</h4>

<p><strong>音量の大小のようなざっくりとした値を色の明るさというざっくりとした値に変換します。</strong><br>
具体的には8bit以下（0~255）の精度でいい場合にはこの方法を用います。</p>

<p>下記の <code>OSCVolumeAndPitchVisualizer.cs</code> をアタッチしたGameObjectを、OSCを送信するトラック分用意しています。<br>
<a href="https://camo.qiitausercontent.com/23018fa43d88c67d63efb7a7ff9b68bd54b8fcb0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f35323461303636322d363930362d613433382d326563392d6266363833616435613639622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F524a0662-6906-a438-2ec9-bf683ad5a69b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d2c5c48a677574dee407cc2d6bd096b9" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/524a0662-6906-a438-2ec9-bf683ad5a69b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F524a0662-6906-a438-2ec9-bf683ad5a69b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=366c1e41fa8a3f36266dd6413294a8db 1x" loading="lazy"></a></p>

<p><code>OSCVolumeAndPitchVisualizer.cs</code> はトラック毎に定めたテクスチャの座標に、トラックの音声を元にした色を書き込みます。<br>
- 音量 = 輝度（HSVのV）<br>
- ピッチ = 色相（HSVのH）</p>

<p>わざわざ色を書き込むのにスレッド数1のコンピュートシェーダを呼んでいますが <code>Texture2D.SetPixels()</code> でよいと思います。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">OSCVolumeAndPitchVisualizer.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">/// 簡略化しています</span>

<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">uOSC</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">OSCVolumeAndPitchVisualizer</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="c1">/// 0~1のfloat値を0~255のモノクロ値でピクセルに書き込むコンピュートシェーダ</span>
    <span class="k">public</span> <span class="n">ComputeShader</span> <span class="n">NormalizedRGBValueTo64pxRGBBrightness</span><span class="p">;</span>
    <span class="c1">/// 書き込むピクセル位置</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">;</span>
    <span class="c1">/// 書き込むテクスチャ</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span>
    <span class="k">private</span> <span class="n">RenderTexture</span> <span class="n">output</span><span class="p">;</span>
    <span class="c1">/// OSCの受信サーバー</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">uOscServer</span> <span class="n">server</span><span class="p">;</span>
    <span class="c1">/// 受け取るOSCアドレス</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="kt">string</span> <span class="n">address</span><span class="p">;</span>
    <span class="c1">/// volume: 0~1</span>
    <span class="c1">/// pitch: 0=A（ラ）で0~11の整数</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="kt">float</span> <span class="n">volume</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">pitch</span> <span class="p">=</span> <span class="p">-</span><span class="m">2</span><span class="p">;</span>
    <span class="c1">/// hsv（色）値: 0=1</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="kt">float</span> <span class="n">h</span><span class="p">,</span> <span class="n">s</span> <span class="p">=</span> <span class="m">1.0f</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>

    <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">server</span><span class="p">.</span><span class="n">onDataReceived</span><span class="p">.</span><span class="nf">AddListener</span><span class="p">(</span><span class="n">OnDataReceived</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">void</span> <span class="nf">OnDataReceived</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">address</span> <span class="p">==</span> <span class="p">(</span><span class="n">address</span> <span class="p">+</span> <span class="s">"/volume"</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="kt">float</span><span class="p">.</span><span class="nf">TryParse</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">values</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="nf">GetString</span><span class="p">(),</span> <span class="k">out</span> <span class="n">volume</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">address</span> <span class="p">==</span> <span class="p">(</span><span class="n">address</span> <span class="p">+</span> <span class="s">"/pitch"</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// 0 = A, 1 = A# で0~11まで　検出できなかった場合-1が返ってくる</span>
            <span class="kt">float</span><span class="p">.</span><span class="nf">TryParse</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">values</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="nf">GetString</span><span class="p">(),</span> <span class="k">out</span> <span class="n">pitch</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">dt</span> <span class="p">=</span> <span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span><span class="p">;</span>

        <span class="c1">/// 音量をそのまま明度に</span>
        <span class="n">v</span> <span class="p">=</span> <span class="n">volume</span><span class="p">;</span>
        <span class="c1">/// ピッチを色相に（実際にはカクカク変わらないようにLerpAngleで補完処理をかけました）</span>
        <span class="n">h</span> <span class="p">=</span> <span class="n">pitch</span> <span class="p">/</span> <span class="m">12.0f</span><span class="p">;</span>

        <span class="c1">/// HSVカラーをRGBに変換</span>
        <span class="kt">var</span> <span class="n">rgb</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="nf">HSVToRGB</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span> <span class="p">*</span> <span class="n">v</span><span class="p">);</span>

        <span class="nf">SetBlockRGB</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">rgb</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 指定したブロック（8px × 8px）を指定した色で塗る</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="c1">/// &lt;param name="rowInMethod"&gt;ブロックの行&lt;/param&gt;</span>
    <span class="c1">/// &lt;param name="columnInMethod"&gt;ブロックの列&lt;/param&gt;</span>
    <span class="c1">/// &lt;param name="rgbInMethod"&gt;色&lt;/param&gt;</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">SetBlockRGB</span><span class="p">(</span><span class="kt">int</span> <span class="n">rowInMethod</span><span class="p">,</span> <span class="kt">int</span> <span class="n">columnInMethod</span><span class="p">,</span> <span class="n">Color</span> <span class="n">rgbInMethod</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 呼びたいカーネル（処理）を決める</span>
        <span class="kt">var</span> <span class="n">kernel</span> <span class="p">=</span> <span class="n">NormalizedRGBValueTo64pxRGBBrightness</span><span class="p">.</span><span class="nf">FindKernel</span><span class="p">(</span><span class="s">"CSMain"</span><span class="p">);</span>

        <span class="c1">// 必要なデータやら参照やらを渡す</span>
        <span class="n">NormalizedRGBValueTo64pxRGBBrightness</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="s">"row"</span><span class="p">,</span> <span class="n">rowInMethod</span><span class="p">);</span>
        <span class="n">NormalizedRGBValueTo64pxRGBBrightness</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="s">"column"</span><span class="p">,</span> <span class="n">columnInMethod</span><span class="p">);</span>
        <span class="n">NormalizedRGBValueTo64pxRGBBrightness</span><span class="p">.</span><span class="nf">SetFloat</span><span class="p">(</span><span class="s">"normalizedRed"</span><span class="p">,</span> <span class="n">rgbInMethod</span><span class="p">.</span><span class="n">r</span><span class="p">);</span>
        <span class="n">NormalizedRGBValueTo64pxRGBBrightness</span><span class="p">.</span><span class="nf">SetFloat</span><span class="p">(</span><span class="s">"normalizedGreen"</span><span class="p">,</span> <span class="n">rgbInMethod</span><span class="p">.</span><span class="n">g</span><span class="p">);</span>
        <span class="n">NormalizedRGBValueTo64pxRGBBrightness</span><span class="p">.</span><span class="nf">SetFloat</span><span class="p">(</span><span class="s">"normalizedBlue"</span><span class="p">,</span> <span class="n">rgbInMethod</span><span class="p">.</span><span class="n">b</span><span class="p">);</span>
        <span class="n">NormalizedRGBValueTo64pxRGBBrightness</span><span class="p">.</span><span class="nf">SetTexture</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="s">"OutPosition"</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>

        <span class="c1">// コンピュートシェーダを実行する</span>
        <span class="n">NormalizedRGBValueTo64pxRGBBrightness</span><span class="p">.</span><span class="nf">Dispatch</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="c">
<div class="code-lang"><span class="bold">Normalized8bitRGBValueTo64pxRGB.c</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// csから渡される値</span>
<span class="n">RWTexture2D</span><span class="o">&lt;</span><span class="n">float4</span><span class="o">&gt;</span> <span class="n">OutPosition</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">row</span><span class="p">,</span><span class="n">column</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">normalizedRed</span><span class="p">,</span> <span class="n">normalizedGreen</span><span class="p">,</span> <span class="n">normalizedBlue</span><span class="p">;</span>

<span class="p">[</span><span class="n">numthreads</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="kt">void</span> <span class="nf">CSMain</span> <span class="p">(</span><span class="n">uint3</span> <span class="n">id</span> <span class="o">:</span> <span class="n">SV_DispatchThreadID</span><span class="p">)</span>
<span class="p">{</span>   
    <span class="k">for</span><span class="p">(</span><span class="n">uint</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="n">uint</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span><span class="p">){</span>
            <span class="n">OutPosition</span><span class="p">[</span><span class="n">uint2</span><span class="p">((</span><span class="n">row</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">y</span><span class="p">)]</span> 
            <span class="o">=</span> <span class="n">float4</span><span class="p">(</span><span class="n">normalizedRed</span><span class="p">,</span> <span class="n">normalizedBlue</span><span class="p">,</span> <span class="n">normalizedGreen</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h4>
<span id="なるべく精度が欲しい値" class="fragment"></span><a href="#%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E7%B2%BE%E5%BA%A6%E3%81%8C%E6%AC%B2%E3%81%97%E3%81%84%E5%80%A4"><i class="fa fa-link"></i></a>なるべく精度が欲しい値</h4>

<h5>
<span id="情報量の限界" class="fragment"></span><a href="#%E6%83%85%E5%A0%B1%E9%87%8F%E3%81%AE%E9%99%90%E7%95%8C"><i class="fa fa-link"></i></a>情報量の限界</h5>

<p>たとえばオブジェクトのx座標を8bit=0~255の値を用いて100=1mとして表現すると、2.56mの距離を1cmずつしか動かせないことになります。<br>
ほかにも、25秒かけてゆっくりフェードさせたいといった場面で8bitしか表現できないと1秒につき値を約10回しか更新できず、カクカクした見た目になります。（実際にはエンコードでさらにカクカクになります）</p>

<p>もっと精度が欲しい場合は、<strong>エンコード</strong>で情報が削がれないように気を使って値をピクセルに書き込む必要があります。</p>

<h5>
<span id="映像エンコード問題" class="fragment"></span><a href="#%E6%98%A0%E5%83%8F%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E5%95%8F%E9%A1%8C"><i class="fa fa-link"></i></a>映像エンコード問題</h5>

<p>パラメータを画像に変換・映像として配信し、受信した映像からパラメータを復元するにあたって問題となるのが映像の<strong>エンコード</strong>です。<br>
人間が気付きにくい形で色のデータ量を圧縮することで配信・受信の通信を楽にしてくれる処理です。<br>
が、これが正確な値を送りたい時の足枷となります。</p>

<p>一般的に、デジタルな色は赤、緑、青の3色の度合い＝RGB値で表現されています。<br>
画像・映像データにおいては、1ピクセルは赤、緑、青それぞれ0~255の2^8=8bitの合計24bitで表すことが多いです。</p>

<p>仮に1ピクセル24bitの色を1920px × 1080pxの画素数、30fpsの非圧縮映像にすると1秒当たりに必要なbit数は<br>
<code>24*1920*1080*30 / 1024^2 ≒ 1423Mbps</code> になります（値がでかすぎて計算が合ってるか不安になります）<br>
が、一般的な映像ストリーミングサイト<sup id="fnref1"><a href="#fn1" title="ライブ エンコーダの設定、ビットレート、解像度を選択する - YouTube ヘルプ https://support.google.com/youtube/answer/2853702?hl=ja">1</a></sup>において1920px × 1080pxの映像は3~6Mbpsでやりとりされています。<br>
エンコーダが頑張って圧縮してくれているおかげですね。</p>

<h5>
<span id="エンコード対策ブロックと明るさ8bit" class="fragment"></span><a href="#%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E5%AF%BE%E7%AD%96%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%81%A8%E6%98%8E%E3%82%8B%E3%81%958bit"><i class="fa fa-link"></i></a>エンコード対策：ブロックと明るさ8bit</h5>

<p>エンコードに対してある程度頑健な情報の送り方として、試行錯誤した結果下記の方法を取りました。（H.264エンコードの仕様をちゃんと読めばもっといい方法はあると思いますが……）<br>
- なるべく<code>4px × 4px</code>、<code>8px × 8px</code>のような<strong>ブロック</strong>に1つの情報をまとめて書き込む<br>
- 色は使わずに明るさだけ、つまり0~255の8bitで値を表現する</p>

<h5>
<span id="8bitより大きい情報を2つの色に分割して埋め込む-棄却案" class="fragment"></span><a href="#8bit%E3%82%88%E3%82%8A%E5%A4%A7%E3%81%8D%E3%81%84%E6%83%85%E5%A0%B1%E3%82%922%E3%81%A4%E3%81%AE%E8%89%B2%E3%81%AB%E5%88%86%E5%89%B2%E3%81%97%E3%81%A6%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80-%E6%A3%84%E5%8D%B4%E6%A1%88"><i class="fa fa-link"></i></a>8bitより大きい情報を2つの色に分割して埋め込む: 棄却案</h5>

<p>8bitより大きい値を扱いたい場合は2ブロック以上を使って1つの値を表現することになります。が……<br>
8bit=255段階の明るさすらもエンコードのためにノイズが混じった値になります。</p>

<p>16bit値を表現するため、はじめは2ブロックを使って1つめのブロックに前半8bit、2つめのブロックに後半8bit、のように分割することを試みました。<br>
が、誤差が非常に大きくなってしまいました。</p>

<p>たとえば下記のような送りたい値 <code>21,855</code> があったとします。<br>
<a href="https://camo.qiitausercontent.com/d0b1cb920a91d8c235d70768408081b612395471/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f39343935356163342d633331312d633036342d306236382d3463393363626263613663642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F94955ac4-c311-c064-0b68-4c93cbbca6cd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a726af072a50ee2f520f6f30655ecdfd" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/94955ac4-c311-c064-0b68-4c93cbbca6cd.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F94955ac4-c311-c064-0b68-4c93cbbca6cd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f676f23853aa4dbb0d447b65134ce710 1x" loading="lazy"></a></p>

<p>このとき、エンコードによってブロック1の値が<code>3</code>だけ変わってしまったとすると、結果は<code>21,087</code>になります。<br>
ブロック1の値が<code>85</code>から<code>82</code>、わずか<code>3/255</code>が変わっただけですが、2ブロックの合計としては<code>3*256=768</code>変わることになります。<br>
<a href="https://camo.qiitausercontent.com/87dd4ee7dcabda8c9bf4bb242358aed716d5e8d7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f39396461636630622d393833612d326439382d633333302d6134396533633035306537332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F99dacf0b-983a-2d98-c330-a49e3c050e73.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c892bf42a9bdbc059ca9dd95e0d87030" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/99dacf0b-983a-2d98-c330-a49e3c050e73.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F99dacf0b-983a-2d98-c330-a49e3c050e73.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=eec79922e018ff392ed2ed11ef6147ee 1x" loading="lazy"></a></p>

<p>オブジェクトのx座標をこの2ブロックが保持する16bit=0~65535の値を用いて10000=1mとして表現した場合を考えると、エンコードによる1ブロックの明るさ<code>3</code>の誤差で簡単に<strong>約8cm</strong>ズレてしまうことになります。</p>

<h5>
<span id="8bitより大きい情報を2つの色に分割して埋め込む-採用案" class="fragment"></span><a href="#8bit%E3%82%88%E3%82%8A%E5%A4%A7%E3%81%8D%E3%81%84%E6%83%85%E5%A0%B1%E3%82%922%E3%81%A4%E3%81%AE%E8%89%B2%E3%81%AB%E5%88%86%E5%89%B2%E3%81%97%E3%81%A6%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80-%E6%8E%A1%E7%94%A8%E6%A1%88"><i class="fa fa-link"></i></a>8bitより大きい情報を2つの色に分割して埋め込む: 採用案</h5>

<p>そこで、2ブロックに交互に1bitずつ担当させるという方法を取ります。<code>21,855</code>はこのように表せます。<br>
<a href="https://camo.qiitausercontent.com/7057ee724be6bacb6bc23459fe22401fc2a2029d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f63663037353530392d363961612d623563332d663131372d6436313365393939343733342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fcf075509-69aa-b5c3-f117-d613e9994734.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=686bc76caa20df28b10c20675a3d65d3" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/cf075509-69aa-b5c3-f117-d613e9994734.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fcf075509-69aa-b5c3-f117-d613e9994734.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=01d1b9455303039006a39c7aaf5ca44e 1x" loading="lazy"></a><br>
ブロック1の値が<code>3</code>変わって<code>3</code>から<code>6</code>になりましたが、値は<code>21,885</code>で、誤差が<code>30</code>で済みました。10000=1mなら<strong>3mm</strong>ですね。<br>
<a href="https://camo.qiitausercontent.com/519285c6e7c7b1ac044b0fdf76460c599cb07da9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f32633935633531342d353863612d343265612d643337312d3233353936346436373361612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F2c95c514-58ca-42ea-d371-235964d673aa.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=24832f44d55641ac6cbdd6c0028d9ab1" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/2c95c514-58ca-42ea-d371-235964d673aa.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F2c95c514-58ca-42ea-d371-235964d673aa.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ea7112ba32d8e50beb56c875cb609e79 1x" loading="lazy"></a></p>

<h5>
<span id="実装" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>実装</h5>

<p>実装はこんな感じです。（単なるビット演算です）<br>
（本当は拡張子は.compute ですがQiitaでハイライトされなくて読みにくいので.cとしています　以下同様）</p>

<div class="code-frame" data-lang="c">
<div class="code-lang"><span class="bold">Writer8x16px16bitUnsignedInt.c</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// csから渡される値</span>
<span class="n">RWTexture2D</span><span class="o">&lt;</span><span class="n">float4</span><span class="o">&gt;</span> <span class="n">OutPosition</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">val</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">row</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">column</span><span class="p">;</span>

<span class="n">float4</span> <span class="nf">oddBitOfUintTo8bitBrightness</span><span class="p">(</span><span class="n">uint</span> <span class="n">posMillimeter</span><span class="p">){</span>
    <span class="c1">// 0bo-p-q-r-s-t-u-v- -&gt; 0b00000000opqrstuv にする</span>
    <span class="n">uint</span> <span class="n">goal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span>     <span class="mi">2</span><span class="p">)</span> <span class="o">==</span>     <span class="mi">2</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span>     <span class="mi">8</span><span class="p">)</span> <span class="o">==</span>     <span class="mi">8</span> <span class="o">?</span> <span class="n">goal</span> <span class="o">|</span> <span class="mi">2</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span>    <span class="mi">32</span><span class="p">)</span> <span class="o">==</span>    <span class="mi">32</span> <span class="o">?</span> <span class="n">goal</span> <span class="o">|</span> <span class="mi">4</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span>   <span class="mi">128</span><span class="p">)</span> <span class="o">==</span>   <span class="mi">128</span> <span class="o">?</span> <span class="n">goal</span> <span class="o">|</span> <span class="mi">8</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span>   <span class="mi">512</span><span class="p">)</span> <span class="o">==</span>   <span class="mi">512</span> <span class="o">?</span> <span class="n">goal</span> <span class="o">|</span> <span class="mi">16</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span>  <span class="mi">2048</span><span class="p">)</span> <span class="o">==</span>  <span class="mi">2048</span> <span class="o">?</span> <span class="n">goal</span> <span class="o">|</span> <span class="mi">32</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span>  <span class="mi">8192</span><span class="p">)</span> <span class="o">==</span>  <span class="mi">8192</span> <span class="o">?</span> <span class="n">goal</span> <span class="o">|</span> <span class="mi">64</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span> <span class="mi">32768</span><span class="p">)</span> <span class="o">==</span> <span class="mi">32768</span> <span class="o">?</span> <span class="n">goal</span> <span class="o">|</span> <span class="mi">128</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>

    <span class="k">return</span>  <span class="n">float4</span><span class="p">(</span>
        <span class="n">goal</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span>
        <span class="n">goal</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span>
        <span class="n">goal</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">float4</span> <span class="nf">evenBitOfUintTo8bitBrightness</span><span class="p">(</span><span class="n">uint</span> <span class="n">posMillimeter</span><span class="p">){</span>
    <span class="c1">// 0b-o-p-q-r-s-t-u-v -&gt; 0b00000000opqrstuv にする</span>
    <span class="n">uint</span> <span class="n">goal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span>     <span class="mi">1</span><span class="p">)</span> <span class="o">==</span>     <span class="mi">1</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span>     <span class="mi">4</span><span class="p">)</span> <span class="o">==</span>     <span class="mi">4</span> <span class="o">?</span> <span class="n">goal</span> <span class="o">|</span> <span class="mi">2</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span>    <span class="mi">16</span><span class="p">)</span> <span class="o">==</span>    <span class="mi">16</span> <span class="o">?</span> <span class="n">goal</span> <span class="o">|</span> <span class="mi">4</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span>    <span class="mi">64</span><span class="p">)</span> <span class="o">==</span>    <span class="mi">64</span> <span class="o">?</span> <span class="n">goal</span> <span class="o">|</span> <span class="mi">8</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span>   <span class="mi">256</span><span class="p">)</span> <span class="o">==</span>   <span class="mi">256</span> <span class="o">?</span> <span class="n">goal</span> <span class="o">|</span> <span class="mi">16</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span>  <span class="mi">1024</span><span class="p">)</span> <span class="o">==</span>  <span class="mi">1024</span> <span class="o">?</span> <span class="n">goal</span> <span class="o">|</span> <span class="mi">32</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span>  <span class="mi">4096</span><span class="p">)</span> <span class="o">==</span>  <span class="mi">4096</span> <span class="o">?</span> <span class="n">goal</span> <span class="o">|</span> <span class="mi">64</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="p">(</span><span class="n">posMillimeter</span> <span class="o">&amp;</span> <span class="mi">16384</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16384</span> <span class="o">?</span> <span class="n">goal</span> <span class="o">|</span> <span class="mi">128</span> <span class="o">:</span> <span class="n">goal</span><span class="p">;</span>

    <span class="k">return</span>  <span class="n">float4</span><span class="p">(</span>
        <span class="n">goal</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span>
        <span class="n">goal</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span>
        <span class="n">goal</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">[</span><span class="n">numthreads</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="kt">void</span> <span class="nf">CSMainFHD</span> <span class="p">(</span><span class="n">uint3</span> <span class="n">id</span> <span class="o">:</span> <span class="n">SV_DispatchThreadID</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">uint</span> <span class="n">uintValue</span> <span class="o">=</span> <span class="n">val</span> <span class="o">*</span> <span class="mi">65535</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="n">uint</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="n">uint</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span><span class="p">){</span>
            <span class="n">OutPosition</span><span class="p">[</span><span class="n">uint2</span><span class="p">((</span><span class="n">row</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">y</span><span class="p">)]</span> <span class="o">=</span>  <span class="n">oddBitOfUintTo8bitBrightness</span><span class="p">(</span><span class="n">uintValue</span><span class="p">);</span>
            <span class="n">OutPosition</span><span class="p">[</span><span class="n">uint2</span><span class="p">((</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">y</span><span class="p">)]</span> <span class="o">=</span> <span class="n">evenBitOfUintTo8bitBrightness</span><span class="p">(</span><span class="n">uintValue</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h3>
<span id="unity頂点ビジュアライザ" class="fragment"></span><a href="#unity%E9%A0%82%E7%82%B9%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6"><i class="fa fa-link"></i></a>Unity（頂点ビジュアライザ）</h3>

<h4>
<span id="頂点アニメーション" class="fragment"></span><a href="#%E9%A0%82%E7%82%B9%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>頂点アニメーション</h4>

<p>アバターの頂点群の位置情報を1頂点ずつ先述の方法でテクスチャに書き込みます。<br>
Vertex Animation Textureと呼ばれる、アニメーションの各キーフレームにおける頂点位置をテクスチャに書き込んで再構成する手法を映像で行う形です。<br>
実装にあたり、sugi-cho様のリポジトリ「Animation-Texture-Baker」を多大に参考にしました。<br>
<a href="https://github.com/sugi-cho/Animation-Texture-Baker" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/sugi-cho/Animation-Texture-Baker</a></p>

<h4>
<span id="制約" class="fragment"></span><a href="#%E5%88%B6%E7%B4%84"><i class="fa fa-link"></i></a>制約</h4>

<p>Unityにおいて頂点の位置情報は32bit floatで表現されていますが、先述の理由からその精度を保証することは難しいため、範囲制限を設けることで16bit値で表現しています。</p>

<p>具体的には下記のような形で表現しました。<br>
- 頂点位置は-3.2767m ~ 3.2767mの範囲のみを動けるものとする<br>
    - この範囲を超えた頂点は描画されなくなる<br>
- 位置の値に3.2767mのオフセットを加え、unsigned intの16bit値 <code>0~65535</code> で位置を表現する</p>

<h4>
<span id="出力イメージ" class="fragment"></span><a href="#%E5%87%BA%E5%8A%9B%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>出力イメージ</h4>

<p>下図テクスチャの一番下の白い横長のかたまりがアバター1体分の頂点情報です。<br>
<a href="https://camo.qiitausercontent.com/04c976111900c7df6ba7d3093c962a732c07e5dc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f31326337633539652d393834612d613635622d373934382d3764333739643762623737322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F12c7c59e-984a-a65b-7948-7d379d7bb772.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=764ddf68d7cdbd6f3ce8e7866685b146" alt="ピックアップ点.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/12c7c59e-984a-a65b-7948-7d379d7bb772.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F12c7c59e-984a-a65b-7948-7d379d7bb772.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a2e69070d1420272d19af61e38ede25c 1x" loading="lazy"></a></p>

<p>頂点情報を描画している1部分（左下緑色の四角領域）をクローズアップするとこのようになっています。<br>
<a href="https://camo.qiitausercontent.com/aa202d066908f677f33b996a89d58825528d36a1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f65316165636664302d333232612d646236622d363033302d3635396430663861373432622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe1aecfd0-322a-db6b-6030-659d0f8a742b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b19b0f62feced5181634e23d76854afc" alt="OmnipresenceLiveテクスチャCloseUp.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/e1aecfd0-322a-db6b-6030-659d0f8a742b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe1aecfd0-322a-db6b-6030-659d0f8a742b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b51ad74908d380c2cc73654d9afaec19 1x" loading="lazy"></a></p>

<p>1頂点につきx,y,z座標をそれぞれ4px × 4pxのブロック2つに書き込んでいます。</p>

<h4>
<span id="実装-1" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85-1"><i class="fa fa-link"></i></a>実装</h4>

<p>実装はこんな感じです。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">RealtimeVertexBaker16bitUnsignedInt.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
<span class="k">public</span> <span class="k">class</span> <span class="nc">RealtimeVertexBaker16bitUnsignedInt</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">ComputeShader</span> <span class="n">infoTexGen</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">Material</span> <span class="n">material</span><span class="p">;</span>

    <span class="c1">// テクスチャのどの位置に書き込むかというオフセット</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">columnOffset</span><span class="p">=</span><span class="m">0</span><span class="p">;</span>

    <span class="k">private</span> <span class="n">SkinnedMeshRenderer</span> <span class="n">_skin</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">vertexCount</span><span class="p">;</span>

    <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">TEX_WIDTH</span> <span class="p">=</span> <span class="m">1920</span><span class="p">,</span> <span class="n">TEX_HEIGHT</span> <span class="p">=</span> <span class="m">1080</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span>
    <span class="k">private</span> <span class="n">RenderTexture</span> <span class="n">pRt</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">Mesh</span> <span class="n">mesh</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;</span> <span class="n">posList</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">ComputeBuffer</span> <span class="n">posBuffer</span><span class="p">;</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// アバターのSkinned Mesh Rendererを取得する</span>
        <span class="n">_skin</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">SkinnedMeshRenderer</span><span class="p">&gt;();</span>
        <span class="n">vertexCount</span> <span class="p">=</span> <span class="n">_skin</span><span class="p">.</span><span class="n">sharedMesh</span><span class="p">.</span><span class="n">vertexCount</span><span class="p">;</span>

        <span class="n">mesh</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mesh</span><span class="p">();</span>

        <span class="c1">// レンダーテクスチャを書き込み可能にする</span>
        <span class="n">pRt</span><span class="p">.</span><span class="n">enableRandomWrite</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// SkinnedMeshRenderから現在のフレームのmeshを作る</span>
         <span class="n">_skin</span><span class="p">.</span><span class="nf">BakeMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">);</span>
        <span class="c1">// コンピュートシェーダーに値を渡す入れ物をつくる</span>
        <span class="c1">// C言語の動的メモリ確保みたいな感じで、頂点数 * Vector3のサイズのバッファをつくる</span>
        <span class="n">posBuffer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ComputeBuffer</span><span class="p">(</span><span class="n">vertexCount</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">InteropServices</span><span class="p">.</span><span class="n">Marshal</span><span class="p">.</span><span class="nf">SizeOf</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Vector3</span><span class="p">)));</span>

        <span class="c1">// meshの頂点位置情報をセットする</span>
        <span class="n">posBuffer</span><span class="p">.</span><span class="nf">SetData</span><span class="p">(</span><span class="n">mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">);</span>

        <span class="kt">var</span> <span class="n">kernel</span> <span class="p">=</span> <span class="n">infoTexGen</span><span class="p">.</span><span class="nf">FindKernel</span><span class="p">(</span><span class="s">"CSMainFHD"</span><span class="p">);</span>

        <span class="c1">// 必要なデータや参照を渡す</span>
        <span class="n">infoTexGen</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="s">"VertCount"</span><span class="p">,</span> <span class="n">vertexCount</span><span class="p">);</span>
        <span class="n">infoTexGen</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="s">"ColumnOffset"</span><span class="p">,</span> <span class="n">columnOffset</span><span class="p">);</span>
        <span class="n">infoTexGen</span><span class="p">.</span><span class="nf">SetBuffer</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="s">"Pos"</span><span class="p">,</span> <span class="n">posBuffer</span><span class="p">);</span>
        <span class="n">infoTexGen</span><span class="p">.</span><span class="nf">SetTexture</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="s">"OutPosition"</span><span class="p">,</span> <span class="n">pRt</span><span class="p">);</span>

        <span class="c1">// コンピュートシェーダを実行する</span>
        <span class="c1">// 引数はスレッド数</span>
        <span class="c1">// スレッド数は 頂点数 * 1 * 1</span>
        <span class="n">infoTexGen</span><span class="p">.</span><span class="nf">Dispatch</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">vertexCount</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>

        <span class="n">posBuffer</span><span class="p">.</span><span class="nf">Release</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="c">
<div class="code-lang"><span class="bold">VertexWriter16bitUnsignedIntFHD.c</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// csから渡される値</span>
<span class="n">RWTexture2D</span><span class="o">&lt;</span><span class="n">float4</span><span class="o">&gt;</span> <span class="n">OutPosition</span><span class="p">;</span>
<span class="n">StructuredBuffer</span><span class="o">&lt;</span><span class="n">float3</span><span class="o">&gt;</span> <span class="n">Pos</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">VertCount</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">ColumnOffset</span><span class="p">;</span>

<span class="p">[</span><span class="n">numthreads</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="kt">void</span> <span class="nf">CSMainFHD</span> <span class="p">(</span><span class="n">uint3</span> <span class="n">id</span> <span class="o">:</span> <span class="n">SV_DispatchThreadID</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// </span>
    <span class="c1">// id.xはそのまま頂点ID</span>
    <span class="c1">// row = id.x % (TEX_WIDTH / 4) // 4はcolumnあたりのx方向の画素数</span>
    <span class="c1">// column = id.x / (TEX_WIDTH / 4)</span>

    <span class="n">uint</span> <span class="n">index</span> <span class="o">=</span> <span class="n">id</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">float3</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">Pos</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>

    <span class="kt">int</span> <span class="n">TEX_WIDTH</span> <span class="o">=</span> <span class="mi">1920</span><span class="p">;</span>
    <span class="n">uint</span> <span class="n">row</span> <span class="o">=</span> <span class="n">index</span> <span class="o">%</span> <span class="p">(</span><span class="n">TEX_WIDTH</span> <span class="o">/</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">uint</span> <span class="n">column</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">TEX_WIDTH</span><span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">ColumnOffset</span><span class="p">;</span>

    <span class="n">uint</span> <span class="n">posXMillimeter</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">3</span><span class="p">.</span><span class="mi">2767</span><span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">;</span>
    <span class="n">uint</span> <span class="n">posYMillimeter</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">3</span><span class="p">.</span><span class="mi">2767</span><span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">;</span>
    <span class="n">uint</span> <span class="n">posZMillimeter</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">z</span> <span class="o">+</span> <span class="mi">3</span><span class="p">.</span><span class="mi">2767</span><span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">;</span>

    <span class="c1">//pos.x1</span>
    <span class="n">OutPosition</span><span class="p">[</span><span class="n">uint2</span><span class="p">(</span><span class="n">row</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">column</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">oddBitOfUintTo8bitBrightness</span><span class="p">(</span><span class="n">posXMillimeter</span><span class="p">);</span>
    <span class="n">OutPosition</span><span class="p">[</span><span class="n">uint2</span><span class="p">(</span><span class="n">row</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">column</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">oddBitOfUintTo8bitBrightness</span><span class="p">(</span><span class="n">posXMillimeter</span><span class="p">);</span>
    <span class="n">OutPosition</span><span class="p">[</span><span class="n">uint2</span><span class="p">(</span><span class="n">row</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">oddBitOfUintTo8bitBrightness</span><span class="p">(</span><span class="n">posXMillimeter</span><span class="p">);</span>
    <span class="n">OutPosition</span><span class="p">[</span><span class="n">uint2</span><span class="p">(</span><span class="n">row</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">oddBitOfUintTo8bitBrightness</span><span class="p">(</span><span class="n">posXMillimeter</span><span class="p">);</span>

    <span class="c1">//pos.x2</span>
    <span class="n">OutPosition</span><span class="p">[</span><span class="n">uint2</span><span class="p">(</span><span class="n">row</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">column</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">evenBitOfUintTo8bitBrightness</span><span class="p">(</span><span class="n">posXMillimeter</span><span class="p">);</span>
    <span class="n">OutPosition</span><span class="p">[</span><span class="n">uint2</span><span class="p">(</span><span class="n">row</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">column</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">evenBitOfUintTo8bitBrightness</span><span class="p">(</span><span class="n">posXMillimeter</span><span class="p">);</span>
    <span class="n">OutPosition</span><span class="p">[</span><span class="n">uint2</span><span class="p">(</span><span class="n">row</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">column</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">evenBitOfUintTo8bitBrightness</span><span class="p">(</span><span class="n">posXMillimeter</span><span class="p">);</span>
    <span class="n">OutPosition</span><span class="p">[</span><span class="n">uint2</span><span class="p">(</span><span class="n">row</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">column</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">evenBitOfUintTo8bitBrightness</span><span class="p">(</span><span class="n">posXMillimeter</span><span class="p">);</span>

    <span class="c1">//pos.y1</span>
    <span class="c1">//省略</span>
    <span class="c1">//pos.y2</span>
    <span class="c1">//省略</span>
    <span class="c1">//pos.z1</span>
    <span class="c1">//省略</span>
    <span class="c1">//pos.z2</span>
    <span class="c1">//省略    </span>
<span class="p">}</span>
</code></pre></div>
</div>

<h3>
<span id="unity位置姿勢ビジュアライザ" class="fragment"></span><a href="#unity%E4%BD%8D%E7%BD%AE%E5%A7%BF%E5%8B%A2%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6"><i class="fa fa-link"></i></a>Unity（位置・姿勢ビジュアライザ）</h3>

<p>Skinned Mesh Rendererがついたオブジェクトは頂点位置を書き込みましたが、そうでない形が変わらないオブジェクトは単にオブジェクトのPositionとRotationを書き込みます。<br>
RotationはQuaternionのx,y,z,wがそれぞれ <code>-1 ~ 1</code> の範囲で表現されているので、<code>0 ~ 1</code>の範囲に正規化して8bit値で書き込みます。</p>

<h2>
<span id="リコンストラクタ" class="fragment"></span><a href="#%E3%83%AA%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF"><i class="fa fa-link"></i></a>リコンストラクタ</h2>

<p>イベントビジュアライザが生成した画像から演出・モーションを再構成します。<br>
リコンストラクタをVRChatに実装するため全てシェーダーで記述していますが、特別GPUに頼らなくてもいい場面に関してはC#で <code>RenderTexture.ReadPixels()</code> を使う方が素直だと思います。</p>

<p>演出は任意のシェーダーパラメータを操作する形で表現します。<br>
モーションは<strong>頂点情報をテクスチャに書き込んだモデルと同じモデル</strong>にアタッチしたシェーダーの頂点シェーダーで画像から頂点位置を復元します。</p>

<h3>
<span id="演出の再構成" class="fragment"></span><a href="#%E6%BC%94%E5%87%BA%E3%81%AE%E5%86%8D%E6%A7%8B%E6%88%90"><i class="fa fa-link"></i></a>演出の再構成</h3>

<p>画像の特定のピクセルの色を呼んでシェーダーのパラメータを任意に操作するものです。</p>

<p>エンコード済みの動画から色を読むときは8px × 8px の四角形領域の外枠を捨てて 6px × 6pxの中心を読むと誤差が気持ち減ったような気がするのでそうしています。</p>

<div class="code-frame" data-lang="c">
<div class="code-lang"><span class="bold">ReadBlock.c</span></div>
<div class="highlight"><pre class="with-code"><code>    <span class="kt">float</span> <span class="n">texelSizeX</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">1920</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">texelSizeY</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">1080</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>

    <span class="n">float4</span> <span class="n">color</span> <span class="o">=</span> <span class="n">float4</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

    <span class="c1">// value1 rowとcolumnで指定された8*8正方形の1ブロックを読む</span>
    <span class="c1">// 中心6*6を読んでとりあえず合計する</span>
    <span class="k">for</span><span class="p">(</span><span class="n">uint</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="n">uint</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span><span class="p">){</span>
            <span class="n">float2</span> <span class="n">address</span> <span class="o">=</span> <span class="n">float2</span><span class="p">(</span>
            <span class="c1">// 8pxで1ブロックなのでrow*8, ブロック内の外周は捨てる方が精度が高いと思われる</span>
                <span class="p">(</span> <span class="p">(</span><span class="n">_row</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="p">)</span> <span class="o">*</span> <span class="n">texelSizeX</span><span class="p">,</span>
                <span class="p">(</span> <span class="p">(</span><span class="n">_column</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">y</span> <span class="p">)</span> <span class="o">*</span> <span class="n">texelSizeY</span> <span class="p">);</span>
            <span class="n">color</span> <span class="o">+=</span> <span class="n">tex2Dlod</span><span class="p">(</span><span class="n">_valueTex</span><span class="p">,</span> <span class="n">float4</span><span class="p">(</span><span class="n">address</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">address</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 合計を36で割って平均化する</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">color</span> <span class="o">/</span> <span class="mi">36</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

</code></pre></div>
</div>

<p>2ブロックから16bit値を読みたい時は下記のようなコードを用いました（単にビット演算です）</p>

<div class="code-frame" data-lang="c">
<div class="code-lang"><span class="bold">Unpack.c</span></div>
<div class="highlight"><pre class="with-code"><code>
<span class="kt">float</span> <span class="nf">unpackUintFromDoubleFloat4</span><span class="p">(</span><span class="n">float4</span> <span class="n">oneSecond</span><span class="p">,</span> <span class="n">float4</span> <span class="n">twoSecond</span><span class="p">){</span>
    <span class="c1">// 8bitの値 oneSecond = 0bxxxxxxxx と twoSecond = 0byyyyyyyy を合わせて 16bit goal = 0bxyxyxyxyxyxyxyxy にする</span>
    <span class="n">uint4</span> <span class="n">oS</span> <span class="o">=</span> <span class="n">uint4</span><span class="p">(</span><span class="n">oneSecond</span> <span class="o">*</span> <span class="mi">255</span><span class="p">.</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">);</span>
    <span class="n">uint4</span> <span class="n">tS</span> <span class="o">=</span> <span class="n">uint4</span><span class="p">(</span><span class="n">twoSecond</span> <span class="o">*</span> <span class="mi">255</span><span class="p">.</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">);</span>

    <span class="n">uint</span> <span class="n">firstGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">oS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">firstGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">oS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">?</span> <span class="n">firstGoal</span> <span class="o">|</span> <span class="mi">8</span> <span class="o">:</span> <span class="n">firstGoal</span><span class="p">;</span>
    <span class="n">firstGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">oS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">?</span> <span class="n">firstGoal</span> <span class="o">|</span> <span class="mi">32</span> <span class="o">:</span> <span class="n">firstGoal</span><span class="p">;</span>
    <span class="n">firstGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">oS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span> <span class="o">?</span> <span class="n">firstGoal</span> <span class="o">|</span> <span class="mi">128</span> <span class="o">:</span> <span class="n">firstGoal</span><span class="p">;</span>
    <span class="n">firstGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">oS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span> <span class="o">?</span> <span class="n">firstGoal</span> <span class="o">|</span> <span class="mi">512</span> <span class="o">:</span> <span class="n">firstGoal</span><span class="p">;</span>
    <span class="n">firstGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">oS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">==</span> <span class="mi">32</span> <span class="o">?</span> <span class="n">firstGoal</span> <span class="o">|</span> <span class="mi">2048</span> <span class="o">:</span> <span class="n">firstGoal</span><span class="p">;</span>
    <span class="n">firstGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">oS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">64</span><span class="p">)</span> <span class="o">==</span> <span class="mi">64</span> <span class="o">?</span> <span class="n">firstGoal</span> <span class="o">|</span> <span class="mi">8192</span> <span class="o">:</span> <span class="n">firstGoal</span><span class="p">;</span>
    <span class="n">firstGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">oS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">128</span><span class="p">)</span> <span class="o">==</span> <span class="mi">128</span> <span class="o">?</span> <span class="n">firstGoal</span> <span class="o">|</span> <span class="mi">32768</span> <span class="o">:</span> <span class="n">firstGoal</span><span class="p">;</span>

    <span class="n">uint</span> <span class="n">secondGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">tS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">secondGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">tS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">?</span> <span class="n">secondGoal</span> <span class="o">|</span> <span class="mi">4</span> <span class="o">:</span> <span class="n">secondGoal</span><span class="p">;</span>
    <span class="n">secondGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">tS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">?</span> <span class="n">secondGoal</span> <span class="o">|</span> <span class="mi">16</span> <span class="o">:</span> <span class="n">secondGoal</span><span class="p">;</span>
    <span class="n">secondGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">tS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span> <span class="o">?</span> <span class="n">secondGoal</span> <span class="o">|</span> <span class="mi">64</span> <span class="o">:</span> <span class="n">secondGoal</span><span class="p">;</span>
    <span class="n">secondGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">tS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span> <span class="o">?</span> <span class="n">secondGoal</span> <span class="o">|</span> <span class="mi">256</span> <span class="o">:</span> <span class="n">secondGoal</span><span class="p">;</span>
    <span class="n">secondGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">tS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">==</span> <span class="mi">32</span> <span class="o">?</span> <span class="n">secondGoal</span> <span class="o">|</span> <span class="mi">1024</span> <span class="o">:</span> <span class="n">secondGoal</span><span class="p">;</span>
    <span class="n">secondGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">tS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">64</span><span class="p">)</span> <span class="o">==</span> <span class="mi">64</span> <span class="o">?</span> <span class="n">secondGoal</span> <span class="o">|</span> <span class="mi">4096</span> <span class="o">:</span> <span class="n">secondGoal</span><span class="p">;</span>
    <span class="n">secondGoal</span> <span class="o">=</span> <span class="p">(</span><span class="n">tS</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">128</span><span class="p">)</span> <span class="o">==</span> <span class="mi">128</span> <span class="o">?</span> <span class="n">secondGoal</span> <span class="o">|</span> <span class="mi">16384</span> <span class="o">:</span> <span class="n">secondGoal</span><span class="p">;</span>

    <span class="n">uint</span> <span class="n">goal</span> <span class="o">=</span> <span class="n">firstGoal</span> <span class="o">|</span> <span class="n">secondGoal</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">value</span> <span class="o">=</span> <span class="n">goal</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>読んだ色の色相値を使ってオブジェクトを円周上に動かす演出例です。</p>

<div class="code-frame" data-lang="c">
<div class="code-lang"><span class="bold">vert.c</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// vertシェーダ内</span>

<span class="c1">//------RGB to HSV -------</span>
<span class="n">float3</span> <span class="n">hsv</span> <span class="o">=</span> <span class="n">rgb2hsv</span><span class="p">(</span><span class="n">color</span><span class="p">);</span>
<span class="c1">//------------------------</span>

<span class="kt">float</span> <span class="n">rad</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">hsv</span><span class="p">.</span><span class="n">x</span><span class="o">*</span><span class="mi">360</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">cos</span><span class="p">(</span><span class="n">rad</span><span class="p">);</span>
<span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">rad</span><span class="p">);</span>

<span class="c1">//------------------------</span>

<span class="n">v2f</span> <span class="n">o</span><span class="p">;</span>
<span class="n">o</span><span class="p">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="n">UnityObjectToClipPos</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
<span class="n">o</span><span class="p">.</span><span class="n">uv</span> <span class="o">=</span> <span class="n">TRANSFORM_TEX</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_MainTex</span><span class="p">);</span>
<span class="n">UNITY_TRANSFER_FOG</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">o</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
<span class="k">return</span> <span class="n">o</span><span class="p">;</span>
</code></pre></div>
</div>

<h3>
<span id="モーションの再構成" class="fragment"></span><a href="#%E3%83%A2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%86%8D%E6%A7%8B%E6%88%90"><i class="fa fa-link"></i></a>モーションの再構成</h3>

<p>各頂点の位置をテクスチャから読んだ位置に差し替えます</p>

<div class="code-frame" data-lang="c">
<div class="code-lang"><span class="bold">vert.c</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">appdata</span> <span class="nf">vert</span> <span class="p">(</span><span class="n">appdata</span> <span class="n">v</span><span class="p">,</span> <span class="n">uint</span> <span class="n">vid</span> <span class="o">:</span> <span class="n">SV_VertexID</span><span class="p">)</span>
<span class="p">{</span>

        <span class="c1">// テクスチャから値を取ってくるところは演出と同じため省略</span>
        <span class="c1">// 16bitの0~65536の値を-3.2767m ~ 3.2767mの元の位置情報に直す</span>
    <span class="kt">float</span> <span class="n">posX</span> <span class="o">=</span> <span class="n">unpackUintFromDoubleFloat4</span><span class="p">(</span><span class="n">oneSecondPosX</span><span class="p">,</span> <span class="n">twoSecondPosX</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span> <span class="o">-</span> <span class="mi">3</span><span class="p">.</span><span class="mi">2767</span><span class="n">f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">posY</span> <span class="o">=</span> <span class="n">unpackUintFromDoubleFloat4</span><span class="p">(</span><span class="n">oneSecondPosY</span><span class="p">,</span> <span class="n">twoSecondPosY</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span> <span class="o">-</span> <span class="mi">3</span><span class="p">.</span><span class="mi">2767</span><span class="n">f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">posZ</span> <span class="o">=</span> <span class="n">unpackUintFromDoubleFloat4</span><span class="p">(</span><span class="n">oneSecondPosZ</span><span class="p">,</span> <span class="n">twoSecondPosZ</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span> <span class="o">-</span> <span class="mi">3</span><span class="p">.</span><span class="mi">2767</span><span class="p">;</span>

    <span class="n">float3</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">float3</span><span class="p">(</span><span class="n">posX</span><span class="p">,</span> <span class="n">posY</span><span class="p">,</span> <span class="n">posZ</span><span class="p">);</span>

    <span class="n">appdata</span> <span class="n">o</span><span class="p">;</span>
    <span class="n">o</span><span class="p">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">;</span>

        <span class="c1">// 頂点位置をテクスチャから読み込んだものに差し替える</span>
    <span class="n">o</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">xyz</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">o</span><span class="p">.</span><span class="n">uv</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h4>
<span id="エンコードノイズの弊害" class="fragment"></span><a href="#%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E3%83%8E%E3%82%A4%E3%82%BA%E3%81%AE%E5%BC%8A%E5%AE%B3"><i class="fa fa-link"></i></a>エンコードノイズの弊害</h4>

<p>エンコードによる劣化がなければ上記コードだけで綺麗に復元できます。<br>
<a href="https://camo.qiitausercontent.com/4b8f0aa6646eb1e460f4917279981c446f836d4e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f30346235393965622d623761392d366330662d616131352d3737666163636239643035302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F04b599eb-b7a9-6c0f-aa15-77faccb9d050.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c486ab716aadf0034622a2f952aba77a" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/04b599eb-b7a9-6c0f-aa15-77faccb9d050.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F04b599eb-b7a9-6c0f-aa15-77faccb9d050.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=dabce9abe0fa4df4e7ce0d8f847ba0e2 1x" loading="lazy"></a><br>
（左がテクスチャから復元したメッシュ、右が元のアバター）</p>

<p>が、実際にはエンコードによって情報が激しく劣化するので、エンコード済み映像をそのまま読むとこんな感じになります。<br>
<a href="https://camo.qiitausercontent.com/5ba55f339149f4a460a1fbf5a2815afe4e926234/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f37646162653336372d333666302d646630372d363931652d3337616539623366346130362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F7dabe367-36f0-df07-691e-37ae9b3f4a06.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b4ccb693dcf84e870219872696fbef36" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/7dabe367-36f0-df07-691e-37ae9b3f4a06.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F7dabe367-36f0-df07-691e-37ae9b3f4a06.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=78ee21370c30558411749f5916101325 1x" loading="lazy"></a></p>

<p>いくつかの頂点位置が吹き飛んだ値になってしまったためにその頂点を含むポリゴンが全体を覆い隠すサイズになってしまっています。<br>
すべての頂点位置がおかしくなっているのではなく、中にはいくらか正常なポリゴンも存在します</p>

<h4>
<span id="エンコードノイズ対策" class="fragment"></span><a href="#%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E3%83%8E%E3%82%A4%E3%82%BA%E5%AF%BE%E7%AD%96"><i class="fa fa-link"></i></a>エンコードノイズ対策</h4>

<p>そのため、明らかに外れ値な値をジオメトリシェーダでフィルタリングします。（あまりいい解決方法ではないですが……）<br>
下記の3条件でフィルタリングしました。</p>

<ol>
<li>ポリゴン内の辺の比が極端に異なる</li>
<li>頂点間の距離が離れすぎている</li>
<li>頂点が使わなさそうな位置にいる</li>
</ol>

<p>実際のコードが以下になります（値を直書きするのはやめましょう……）</p>

<div class="code-frame" data-lang="c">
<div class="code-lang"><span class="bold">Filter.c</span></div>
<div class="highlight"><pre class="with-code"><code><span class="p">[</span><span class="n">maxvertexcount</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="kt">void</span> <span class="nf">geom</span><span class="p">(</span><span class="n">triangle</span> <span class="n">appdata</span> <span class="n">IN</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">inout</span> <span class="n">TriangleStream</span><span class="o">&lt;</span><span class="n">g2f</span><span class="o">&gt;</span> <span class="n">triStream</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// このポリゴンを省くか？のフラグ</span>
    <span class="n">bool</span> <span class="n">isBug</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

        <span class="c1">// 今見ている三角ポリゴンの各辺の長さを取得します</span>
    <span class="kt">float</span> <span class="n">sideLength0to1</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">IN</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">vertex</span> <span class="o">-</span> <span class="n">IN</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">vertex</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">sideLength1to2</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">IN</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">vertex</span> <span class="o">-</span> <span class="n">IN</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">vertex</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">sideLength2to0</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">IN</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">vertex</span> <span class="o">-</span> <span class="n">IN</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">vertex</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">rateThreshold</span> <span class="o">=</span> <span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
    <span class="c1">// フィルター：辺の比がおかしかったら消す</span>
    <span class="n">isBug</span> <span class="o">=</span>
        <span class="n">sideLength0to1</span> <span class="o">&gt;</span> <span class="n">sideLength1to2</span> <span class="o">*</span> <span class="n">rateThreshold</span> <span class="o">||</span>
        <span class="n">sideLength1to2</span> <span class="o">&gt;</span> <span class="n">sideLength2to0</span> <span class="o">*</span> <span class="n">rateThreshold</span> <span class="o">||</span>
        <span class="n">sideLength2to0</span> <span class="o">&gt;</span> <span class="n">sideLength0to1</span> <span class="o">*</span> <span class="n">rateThreshold</span>
        <span class="o">?</span> <span class="nb">true</span> <span class="o">:</span> <span class="n">isBug</span><span class="p">;</span>

    <span class="c1">// フィルター：ある頂点間の距離がx[m]以上あったら</span>
    <span class="kt">float</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
    <span class="n">isBug</span> <span class="o">=</span>
        <span class="n">sideLength0to1</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="o">||</span>
        <span class="n">sideLength1to2</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="o">||</span>
        <span class="n">sideLength2to0</span> <span class="o">&gt;</span> <span class="n">threshold</span>
        <span class="o">?</span> <span class="nb">true</span> <span class="o">:</span> <span class="n">isBug</span><span class="p">;</span>

    <span class="c1">// フィルター：頂点が範囲外なら</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">appdata</span> <span class="n">v</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">isBug</span> <span class="o">=</span> 
        <span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">||</span>
        <span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">.</span><span class="mi">0</span> <span class="o">||</span>
        <span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">||</span>
        <span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">||</span>
        <span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">||</span>
        <span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">z</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span>
        <span class="o">?</span> <span class="nb">true</span> <span class="o">:</span> <span class="n">isBug</span><span class="p">;</span>

    <span class="p">}</span>

    <span class="p">[</span><span class="n">unroll</span><span class="p">]</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 頂点シェーダからもらった3頂点それぞれを射影変換して通常のレンダリングと同様にポリゴン位置を決める</span>
        <span class="n">appdata</span> <span class="n">v</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">g2f</span> <span class="n">o</span><span class="p">;</span>
                <span class="c1">// isBugフラグがあれば頂点位置を原点に飛ばす（discardでよさそう）</span>
        <span class="n">o</span><span class="p">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="n">isBug</span> <span class="o">?</span> <span class="n">float4</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">UnityObjectToClipPos</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
        <span class="n">o</span><span class="p">.</span><span class="n">uv</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">;</span>
        <span class="n">o</span><span class="p">.</span><span class="n">normal</span> <span class="o">=</span> <span class="n">UnityObjectToWorldNormal</span><span class="p">(</span><span class="n">normal</span><span class="p">);</span>
        <span class="n">triStream</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span><span class="n">o</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>フィルタリングした結果多少は原型をとどめた形になりました。<br>
<a href="https://camo.qiitausercontent.com/656d444ee3e3778e105b0e2800c19090d4b15623/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f65363135313034362d333938382d353534362d643636312d3336383864373934663439622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe6151046-3988-5546-d661-3688d794f49b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ddd342c6bad91bbcd1b5fb96f7989130" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/e6151046-3988-5546-d661-3688d794f49b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe6151046-3988-5546-d661-3688d794f49b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=541fb4ad94d4e681998acf7f75576f0c 1x" loading="lazy"></a></p>

<h3>
<span id="位置姿勢の再構成" class="fragment"></span><a href="#%E4%BD%8D%E7%BD%AE%E5%A7%BF%E5%8B%A2%E3%81%AE%E5%86%8D%E6%A7%8B%E6%88%90"><i class="fa fa-link"></i></a>位置・姿勢の再構成</h3>

<p>Skinned Mesh Rendererでないオブジェクトの位置・姿勢を再構成する際はこちらを用います。<br>
Shader内で画像から読んだQuaternion値を用いてオブジェクトを回転させます。<br>
オブジェクトのローカル座標系における原点から各頂点までのベクトルをそれぞれQuaternionで回転させることでオブジェクトの回転を表現します。</p>

<div class="code-frame" data-lang="c">
<div class="code-lang"><span class="bold">rotateWithQuaternion.c</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">float4</span> <span class="nf">quatenionAxQuaternionB</span><span class="p">(</span><span class="n">float4</span> <span class="n">qa</span><span class="p">,</span> <span class="n">float4</span> <span class="n">qb</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">float4</span><span class="p">(</span>
        <span class="n">qa</span><span class="p">.</span><span class="n">w</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">qa</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">w</span> <span class="o">+</span> <span class="n">qa</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">qa</span><span class="p">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
        <span class="n">qa</span><span class="p">.</span><span class="n">w</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">qa</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">qa</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">w</span> <span class="o">+</span> <span class="n">qa</span><span class="p">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
        <span class="n">qa</span><span class="p">.</span><span class="n">w</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">qa</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">qa</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">qa</span><span class="p">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">w</span><span class="p">,</span>
        <span class="n">qa</span><span class="p">.</span><span class="n">w</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">w</span> <span class="o">-</span> <span class="n">qa</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">qa</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">qa</span><span class="p">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">qb</span><span class="p">.</span><span class="n">z</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="n">v2f</span> <span class="nf">vert</span> <span class="p">(</span><span class="n">appdata</span> <span class="n">v</span><span class="p">,</span> <span class="n">uint</span> <span class="n">vid</span> <span class="o">:</span> <span class="n">SV_VertexID</span><span class="p">)</span>
<span class="p">{</span>
        <span class="c1">// -----------省略-------------</span>

    <span class="n">float4</span> <span class="n">quaternion</span> <span class="o">=</span> <span class="n">float4</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span><span class="n">qy</span><span class="p">,</span><span class="n">qz</span><span class="p">,</span> <span class="n">qw</span><span class="p">);</span>
    <span class="n">float4</span> <span class="n">conjugateQ</span> <span class="o">=</span> <span class="n">float4</span><span class="p">(</span><span class="o">-</span><span class="n">qx</span><span class="p">,</span> <span class="o">-</span><span class="n">qy</span><span class="p">,</span> <span class="o">-</span><span class="n">qz</span><span class="p">,</span> <span class="n">qw</span><span class="p">);</span> <span class="c1">// 共役</span>
    <span class="n">float4</span> <span class="n">vertAsQ</span> <span class="o">=</span> <span class="n">float4</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="n">float4</span> <span class="n">rotatedPos</span> <span class="o">=</span> <span class="n">quatenionAxQuaternionB</span><span class="p">(</span><span class="n">quatenionAxQuaternionB</span><span class="p">(</span><span class="n">quaternion</span><span class="p">,</span> <span class="n">vertAsQ</span><span class="p">),</span> <span class="n">conjugateQ</span><span class="p">);</span>

    <span class="n">v2f</span> <span class="n">o</span><span class="p">;</span>
    <span class="n">o</span><span class="p">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="n">UnityObjectToClipPos</span><span class="p">(</span><span class="n">rotatedPos</span><span class="p">);</span>
    <span class="n">o</span><span class="p">.</span><span class="n">uv</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h1>
<span id="解釈不一致-の運用" class="fragment"></span><a href="#%E8%A7%A3%E9%87%88%E4%B8%8D%E4%B8%80%E8%87%B4-%E3%81%AE%E9%81%8B%E7%94%A8"><i class="fa fa-link"></i></a>#解釈不一致 の運用</h1>

<p>ここからは、Omnipresence Liveを用いてどのようにライブ「#解釈不一致」を運用したかについて記載します。</p>

<ul>
<li>概要

<ul>
<li>筆者の所属する2人組アーティスト「memex」のVRライブ

<ul>
<li>制作チーム：

<ul>
<li>memex

<ul>
<li>アラン(<a href="https://twitter.com/memex_aran" rel="nofollow noopener" target="_blank">@memex_aran</a>)：ボーカル</li>
<li>ぴぼ（筆者）(<a href="https://twitter.com/memex_pibo" rel="nofollow noopener" target="_blank">@memex_pibo</a>)：ギター</li>
</ul>
</li>
<li>ワールド・エフェクトデザイン

<ul>
<li>Mikipom（<a href="https://twitter.com/cakemas0227" rel="nofollow noopener" target="_blank">@cakemas0227</a>）</li>
</ul>
</li>
</ul>
</li>
<li>2人は遠隔地の自宅からリアルタイムでセッション</li>
<li>演奏しながらモーションキャプチャも行う</li>
</ul>
</li>
<li>VRChatの複数インスタンスで同時にmemexのライブが行われる

<ul>
<li>インスタンスとは空間の単位。通常、ユーザーは同時に1つのインスタンスにしか参加できない。1インスタンスに入れる人数には制限（多くて60くらい）があるので、複数インスタンスで参加可能＝人数制限がないということ。</li>
</ul>
</li>
</ul>
</li>
</ul>

<h2>
<span id="解釈不一致の解説トピック-1" class="fragment"></span><a href="#%E8%A7%A3%E9%87%88%E4%B8%8D%E4%B8%80%E8%87%B4%E3%81%AE%E8%A7%A3%E8%AA%AC%E3%83%88%E3%83%94%E3%83%83%E3%82%AF-1"><i class="fa fa-link"></i></a>「#解釈不一致」の解説トピック</h2>

<ul>
<li>生歌とギターの生演奏による遠隔セッション</li>
<li>楽曲を構成するトラック毎に反応するパラオーディオリアクティブな空間演出</li>
<li>生演奏を含む音楽の特定のタイミングで発火する演出イベント管理</li>
<li>遠隔モーションキャプチャ</li>
<li>ギターの生演奏とギターモーション収録の両立</li>
<li>ツイートのVR空間へのリアルタイム表示</li>
<li>遠隔モーション収録時の返しモニタ</li>
<li>AWSによる専用映像ストリーミングサーバ構築</li>
<li>VRChatへのOmnipresence Liveリコンストラクタの実装</li>
<li>VRChat上での空間編集機能</li>
</ul>

<h2>
<span id="システム構成図" class="fragment"></span><a href="#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E6%A7%8B%E6%88%90%E5%9B%B3"><i class="fa fa-link"></i></a>システム構成図</h2>

<p><a href="https://camo.qiitausercontent.com/d0245a0a445e1bc45e8316e3d87c3e03bdea9844/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f36313561333238372d316131652d383662362d623132612d3864643461393038306635382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F615a3287-1a1e-86b6-b12a-8dd4a9080f58.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=aa4d95c9fd54b8d944897c813f1935f1" alt="fuitch (3).png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/615a3287-1a1e-86b6-b12a-8dd4a9080f58.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F615a3287-1a1e-86b6-b12a-8dd4a9080f58.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=fbe09f091f25a443bfb30f176b9fa8dd 1x" loading="lazy"></a></p>

<h2>
<span id="配信音声について" class="fragment"></span><a href="#%E9%85%8D%E4%BF%A1%E9%9F%B3%E5%A3%B0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>配信音声について</h2>

<p><a href="https://camo.qiitausercontent.com/845a1c8b950d660c5481ebead1abb56868d919c9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f31656331663830342d383437352d333763362d323563362d6261653137633831336163392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F1ec1f804-8475-37c6-25c6-bae17c813ac9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=726a9dfc0a8250f5e46739c0d22ce7ea" alt="audio.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/1ec1f804-8475-37c6-25c6-bae17c813ac9.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F1ec1f804-8475-37c6-25c6-bae17c813ac9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=db32179f6079fd6587edae06ed9bb24a 1x" loading="lazy"></a></p>

<p>遠隔地の演奏者と低遅延でセッションできる<a href="https://www.netduetto.net/" rel="nofollow noopener" target="_blank">NETDUETTO</a>を使って遠隔セッションした音声を配信しました。<br>
ギタリスト側のDAWで伴奏を流しながらギターを演奏し、その音声をNETDUETTOでボーカル側に送ります。<br>
ボーカル側はその伴奏とギターを聴きながら歌い、その音声をNETDUETTOでギタリスト側に送ります。<br>
NETDUETTOはセッションのミックス結果を仮想オーディオ入力デバイスとして出力できる機能があり、これを用いて配信ソフトウェアである<a href="https://obsproject.com/ja" rel="nofollow noopener" target="_blank">OBS Studio</a>に入力します。</p>

<h2>
<span id="オーディオリアクティブ演出" class="fragment"></span><a href="#%E3%82%AA%E3%83%BC%E3%83%87%E3%82%A3%E3%82%AA%E3%83%AA%E3%82%A2%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E6%BC%94%E5%87%BA"><i class="fa fa-link"></i></a>オーディオリアクティブ演出</h2>

<p>下の映像は、ドラムのキック2回→ドラムのスネア→ギターという順序で音が鳴った時の空間演出です。<br>
<a href="https://camo.qiitausercontent.com/03e5e859308339e7935066945600a407774255e9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f34303032336266302d346435652d373761322d626131352d3732396363376265306631362e676966" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F40023bf0-4d5e-77a2-ba15-729cc7be0f16.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b1d82aab9ce159816930ad6e4a95d37e" alt="audioreactive.gif" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/40023bf0-4d5e-77a2-ba15-729cc7be0f16.gif" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F40023bf0-4d5e-77a2-ba15-729cc7be0f16.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=aa33907383ee0ec867361ce9049387fe 1x" loading="lazy"></a></p>

<p>このような楽曲を構成する各パートの音に反応する演出を作るために、先述のイベントビジュアライザを用いて各パートの音量を色の明るさで表現して映像として配信しました。<br>
<a href="https://camo.qiitausercontent.com/bae78976cfdc7e6ae6effa2986e2824b2f2d224e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f65343162316134632d393161622d653562352d373537332d6336353332613861616433382e676966" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe41b1a4c-91ab-e5b5-7573-c6532a8aad38.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=db5659094644d063b3c24b211e546a38" alt="audioEventVZoom.gif" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/e41b1a4c-91ab-e5b5-7573-c6532a8aad38.gif" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe41b1a4c-91ab-e5b5-7573-c6532a8aad38.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f978a7b309ed89ba8465d5db6bfe6cc6 1x" loading="lazy"></a><br>
左から順に下記トラックに反応しています。<br>
1. キック<br>
2. スネア<br>
3. ハット<br>
4. ギター（生演奏）：ピッチ含む<br>
5. ベース：ピッチ含む<br>
6. 曲毎に任意に差し替える目立つ音<br>
7. 曲毎に任意に差し替える目立たない音<br>
8. ボーカル（生歌）：ピッチ含む<br>
9. ハモリ・コーラス</p>

<p>なお、上から順に下記用途で4種類の出力をしています。<br>
1. 音量の値そのまま<br>
2. 音量の値を使い、減衰はゆるやかにしたもの<br>
3. 音量の値が累積されていくもの（音を鳴らす度に明るくなって最大になると黒からやりなおし）<br>
4. ピッチを取得しやすいよう輝度最大で固定して表示したもの</p>

<p>予め送信するトラック数と役割を定めておくことで、ワールド・エフェクトをデザインして頂いたMikipomさんとのやりとりが円滑になるようにしました。</p>

<h3>
<span id="前提" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>前提</h3>

<p>各パートに反応する演出を作るためには、各パートがバラバラになったパラデータが必要になります。<br>
今回は自分達の楽曲のため各パートの音源を簡単に用意できましたが、そうでない場合も<code>iZotope RX7</code>といったツールを用いることである程度パートを分離した音声を用意できると思います。</p>

<h3>
<span id="ルーティング" class="fragment"></span><a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>ルーティング</h3>

<p><a href="https://camo.qiitausercontent.com/fe638ea826216b7d6559b4fef76c3e85a37ef8c1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f36353864616236372d343230632d646564382d636363612d6434343139356339386433342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F658dab67-420c-ded8-ccca-d44195c98d34.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=151d720c54d34786d6228c876fdb1652" alt="audioOSC.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/658dab67-420c-ded8-ccca-d44195c98d34.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F658dab67-420c-ded8-ccca-d44195c98d34.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c6678fbaf652d669d223b5c22ccabc70 1x" loading="lazy"></a><br>
NETDUETTOのVSTプラグインでは各演奏者の音声をバラバラに出力する機能があるため、これを用いて遠隔地のボーカルトラック単体を抜き出しています。</p>

<h3>
<span id="ableton-live上での設定" class="fragment"></span><a href="#ableton-live%E4%B8%8A%E3%81%A7%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>Ableton Live上での設定</h3>

<p>Ableton Live Suiteの各トラックに、音は出力されない状態で各パートの音声を読み込みます。<br>
音が出力されるのは、別途用意した各パートが混ざった伴奏音声、リアルタイムに入力する歌とギターのトラックのみです。<br>
それぞれのトラックに音量をOSCに変換して送信するMax for Liveプラグインを挿すことで、それぞれのトラックから音量の値がOSCで送信されます。<br>
<a href="https://camo.qiitausercontent.com/f3e3111976747d3d2ef14455229572fb436ad213/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f31383965326634312d313138302d306565342d623131312d3665323234356561333866352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F189e2f41-1180-0ee4-b111-6e2245ea38f5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d0faa1f57cc37b777570437057710613" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/189e2f41-1180-0ee4-b111-6e2245ea38f5.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F189e2f41-1180-0ee4-b111-6e2245ea38f5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=64ab9ac4d7eace08dd26e5f387864e40 1x" loading="lazy"></a></p>

<h2>
<span id="演出イベントの管理" class="fragment"></span><a href="#%E6%BC%94%E5%87%BA%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E7%AE%A1%E7%90%86"><i class="fa fa-link"></i></a>演出イベントの管理</h2>

<p>下の映像は、ライブの開始SEが終了して1曲目のイントロが始まり、ワールドそのものが出現する演出です。<br>
<a href="https://camo.qiitausercontent.com/7f6392af8edefac56a69dc994e622911904509e0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f66376130626230632d393666622d343164392d383134382d3861356537316137323935322e676966" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Ff7a0bb0c-96fb-41d9-8148-8a5e71a72952.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=271cb42496b742f3ba543586aed9cf4d" alt="phantom.gif" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/f7a0bb0c-96fb-41d9-8148-8a5e71a72952.gif" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Ff7a0bb0c-96fb-41d9-8148-8a5e71a72952.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0e63389fa8187511692946de03cd0bba 1x" loading="lazy"></a></p>

<p>このように、オーディオリアクティブな要素とは別に、曲中の特定のタイミングに合わせて演出を行うために、Ableton Liveのタイムライン上に演出イベントのトリガーを配置しました。<br>
トリガーはMIDI Note・MIDI Pitch BendをOSCに変換し、OSCをイベントビジュアライザで映像に載せることで演出イベントを発火させます。</p>

<h3>
<span id="制作から実際に再生されるまでの流れ" class="fragment"></span><a href="#%E5%88%B6%E4%BD%9C%E3%81%8B%E3%82%89%E5%AE%9F%E9%9A%9B%E3%81%AB%E5%86%8D%E7%94%9F%E3%81%95%E3%82%8C%E3%82%8B%E3%81%BE%E3%81%A7%E3%81%AE%E6%B5%81%E3%82%8C"><i class="fa fa-link"></i></a>制作から実際に再生されるまでの流れ</h3>

<ol>
<li>デザイン担当のMikipomさんが演出要素をShader Onlyで作る</li>
<li>デザイン担当のMikipomさんがUnityのTimelineで曲に合わせてシェーダパラメータを操作したデモを作る</li>
<li>Timelineを元にどのタイミングでどのパラメータをどの値に動かしたいかという進行表を作る

<ol>
<li>パラメータは<code>0~1</code>の範囲で表現できるようにしておく</li>
</ol>
</li>
<li>動かしたいパラメータをそれぞれMIDI Note Num（ドレミファソラシド…）に割り当てる</li>
<li>進行表を元に筆者がAbleton Live上にパラメータを操作するためのMIDI Noteを配置していく</li>
<li>それぞれのMIDI Note上でMIDI Pitch Bendを用いて0~1のパラメータを表現する</li>
<li>OSCでMIDI Note NumとPitch Bendを送信する</li>
<li>イベントビジュアライザを用いてパラメータをそれぞれ異なるピクセル上に色で表す</li>
<li>ワールドに配置されたシェーダー側で特定のピクセルの色を読んで演出を再生する</li>
</ol>

<h3>
<span id="進行表" class="fragment"></span><a href="#%E9%80%B2%E8%A1%8C%E8%A1%A8"><i class="fa fa-link"></i></a>進行表</h3>

<p>いつ、どのマテリアルのどのパラメータをどこまで動かすかという進行表です。<br>
<a href="https://camo.qiitausercontent.com/68b259174fa13258c9556506878d4b9940a06448/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f38613439303962382d376631612d383934332d343866302d3437373738346231396566352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F8a4909b8-7f1a-8943-48f0-477784b19ef5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c482fad00cc2a2e2e2af0151412e6c0d" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/8a4909b8-7f1a-8943-48f0-477784b19ef5.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F8a4909b8-7f1a-8943-48f0-477784b19ef5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=53b6341c71436079847cfd80ce1fe3d8 1x" loading="lazy"></a></p>

<h3>
<span id="演出イベント管理" class="fragment"></span><a href="#%E6%BC%94%E5%87%BA%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E7%AE%A1%E7%90%86"><i class="fa fa-link"></i></a>演出イベント管理</h3>

<p>動かしたいパラメータの数だけトラックを用意しました。<br>
曲の特定のタイミングに合わせてMIDI Noteが配置されています。<br>
<a href="https://camo.qiitausercontent.com/2411c9688069298e84d4ff3a80d6b7d50e968eb2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f35383962636162372d356466622d653661612d666163622d6133626637323065353835312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F589bcab7-5dfb-e6aa-facb-a3bf720e5851.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=133eceb4e50a1e2286da820cd75b6664" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/589bcab7-5dfb-e6aa-facb-a3bf720e5851.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F589bcab7-5dfb-e6aa-facb-a3bf720e5851.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=cec4f9fb1aa0720cce881d92f812b0eb 1x" loading="lazy"></a></p>

<h3>
<span id="演出制御用midi-note" class="fragment"></span><a href="#%E6%BC%94%E5%87%BA%E5%88%B6%E5%BE%A1%E7%94%A8midi-note"><i class="fa fa-link"></i></a>演出制御用MIDI Note</h3>

<p>あるオブジェクトの幅を表すパラメータを0から1まで動かすMIDI Noteです。<br>
<a href="https://camo.qiitausercontent.com/29775aeddb7e502ac6e37c20394434d522c8cf21/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f39393466626639352d656534632d323461322d653735382d6337343030346138393632632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F994fbf95-ee4c-24a2-e758-c74004a8962c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=86615e015c40311086b6d357f60da8fd" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/994fbf95-ee4c-24a2-e758-c74004a8962c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F994fbf95-ee4c-24a2-e758-c74004a8962c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9ee67037fde95449653426b6c0fe4381 1x" loading="lazy"></a></p>

<p>Notesの欄に記載されている音階がマテリアルのパラメータに対応しています。<br>
例えば: <br>
- ラ：アーティストを表示するか否かのフラグ<br>
- シ：ワールド全体の色相<br>
- ド：床の高さ</p>

<h2>
<span id="モーション収録" class="fragment"></span><a href="#%E3%83%A2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E5%8F%8E%E9%8C%B2"><i class="fa fa-link"></i></a>モーション収録</h2>

<h3>
<span id="ボーカルモーションの遠隔収録" class="fragment"></span><a href="#%E3%83%9C%E3%83%BC%E3%82%AB%E3%83%AB%E3%83%A2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E9%81%A0%E9%9A%94%E5%8F%8E%E9%8C%B2"><i class="fa fa-link"></i></a>ボーカルモーションの遠隔収録</h3>

<p>ボーカルのモーション収録は<a href="https://sh-akira.github.io/VirtualMotionCapture/" rel="nofollow noopener" target="_blank">バーチャルモーションキャプチャー</a>と<a href="https://github.com/gpsnmeajp/EasyVirtualMotionCaptureForUnity" rel="nofollow noopener" target="_blank">EVMC4U</a>を用いて行いました。<br>
バーチャルモーションキャプチャーは、SteamVR対応デバイスを用いて簡単にVRMモデルのモーションキャプチャを行い、さらにそのモーションをOSCで送信することができるソフトウェアです。<br>
EVMC4Uは、バーチャルモーションキャプチャーから送られてきたモーション情報をUnity上のVRMモデルにリアルタイムに適用できるスクリプト群です。<br>
トラッキングデバイスはHTC VIVE CEとVIVE Trackerを用いました。<br>
ボーカルPCからバーチャルモーションキャプチャーでモーションをOSCで筆者宅ネットワークのグローバルIPに向けて送信し、筆者PCのEVMC4Uで受け取ります。<br>
この方法を用いると、NETDUETTOの音声と殆どズレのないモーションを再生することができます。</p>

<h3>
<span id="ギターを生演奏しながらギターモーションを収録する" class="fragment"></span><a href="#%E3%82%AE%E3%82%BF%E3%83%BC%E3%82%92%E7%94%9F%E6%BC%94%E5%A5%8F%E3%81%97%E3%81%AA%E3%81%8C%E3%82%89%E3%82%AE%E3%82%BF%E3%83%BC%E3%83%A2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E5%8F%8E%E9%8C%B2%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ギターを生演奏しながらギターモーションを収録する</h3>

<p>M5StickCをギター側、右手側で2つとiPhone11を用いて、ギターの演奏を簡易的にトラッキングします。<br>
M5StickCはディスプレイがついた、加速度センサやWi-Fi接続機能など多くの機能を持つ小型で低価格なマイコンです。<br>
M5StickCでセンシングした値をWi-Fi経由でPCに飛ばすことでアバターのモーションを表現しました。</p>

<p>画像左がギター側、画像右側が右手側のM5StickCです。<br>
<a href="https://camo.qiitausercontent.com/e4d86ebb8c265f378280fd45642c4fdf8f199e39/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f66323561633462352d333262632d306565642d643732392d6138333535323163616234362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Ff25ac4b5-32bc-0eed-d729-a835521cab46.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3da2854350687a964cf017d033759410" alt="guitarTracking2.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/f25ac4b5-32bc-0eed-d729-a835521cab46.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Ff25ac4b5-32bc-0eed-d729-a835521cab46.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9f797ff6bc9f8089abba1ce64d768e84 1x" loading="lazy"></a></p>

<p><a href="https://camo.qiitausercontent.com/6959098eef7fbccbfbe69f2f97f9c1499e6fa00b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f64386432386364302d643464352d313332322d636530362d3737326134383666633165642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fd8d28cd0-d4d5-1322-ce06-772a486fc1ed.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=128e7b978a7e7ffe55eee27ccf18ae1b" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/d8d28cd0-d4d5-1322-ce06-772a486fc1ed.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fd8d28cd0-d4d5-1322-ce06-772a486fc1ed.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2fa8a52437026236e399c5abc8e74a0f 1x" loading="lazy"></a><a href="https://camo.qiitausercontent.com/ca089ca09f2ad93ccc6c9307e4a45ef70d3c135c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f65636233383934322d303733642d353239632d366266332d3533396430333536616462312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fecb38942-073d-529c-6bf3-539d0356adb1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f0169d31558f39846619e7aaaa6b3502" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/ecb38942-073d-529c-6bf3-539d0356adb1.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fecb38942-073d-529c-6bf3-539d0356adb1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2219399ba381d3c7ea7d1cfc3a459ef6 1x" loading="lazy"></a><br>
画像左はローフレットを押さえて右下の方向を見ている筆者、画像右はハイフレットを押さえて左上の方向を見ている筆者です。</p>

<p>これは過去にアコースティックカバー生放送を行った時に制作したものです。<br>
実際の動きは下記放送アーカイブからご覧いただけます。<br>
<a href="https://www.youtube.com/watch?v=ijs-0veMe48&amp;feature=youtu.be&amp;t=2751" rel="nofollow noopener" target="_blank">【memex】アコースティック歌生放送！ #めめなま 【3000人記念】 - YouTube</a></p>

<h3>
<span id="ギター側" class="fragment"></span><a href="#%E3%82%AE%E3%82%BF%E3%83%BC%E5%81%B4"><i class="fa fa-link"></i></a>ギター側</h3>

<h4>
<span id="フレット" class="fragment"></span><a href="#%E3%83%95%E3%83%AC%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>フレット</h4>

<p>ギターの指板における左手の位置と、ギターの姿勢をセンシングします。<br>
左手の位置は超音波センサ（HC-SR04）、ギターの姿勢はM5StickC内蔵の加速度センサでセンシングしました。</p>

<p>超音波センサは超音波を発しそれが対象にぶつかってから帰ってくるまでの時間を音速で割ることで対象との距離を求めることができるセンサです。<br>
これをギターのヘッド裏に取り付けることで左手の位置をざっくりと計測します。<br>
実際にギターを弾いてみるとわかりますが、抑えるポジションによっては手首はネックの真裏の高さにないこともあり、正確にトラッキングすることはできません。左手が動いていることがわかるくらいではあります。<br>
また、上記画像からわかるように筆者のアバターの手は抽象化されているので、指のあるアバターではさらに別の対策が必要になると思われます。</p>

<p><a href="https://camo.qiitausercontent.com/3494c69a42e35ccfd89def4054a1c158318a0c0f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f35663138353764312d393539332d346339372d316664632d3036366562383464323366612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F5f1857d1-9593-4c97-1fdc-066eb84d23fa.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=eef3d7b981feb20da0a670231ba0f7b1" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/5f1857d1-9593-4c97-1fdc-066eb84d23fa.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F5f1857d1-9593-4c97-1fdc-066eb84d23fa.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=79dfddb830e2266127c2a3ebba261d62 1x" loading="lazy"></a><br>
FinalIKを用いてアバターの手の位置をギターの指板上に固定して動かしています。<br>
FinalIKは逆運動学を用いてアバターの手などを自然に目標の位置に到達させることができるアセットです。</p>

<p>画像の手前にある二つの白いSphereが、それぞれ「1Fを押さえているときにアバターの左手があってほしい位置」「12Fを押さえているときにアバターの左手があってほしい位置」です。<br>
左手は、2つのSphereを結んだ直線上を超音波センサの距離値に応じて移動しています。</p>

<p>実装はこのようになっています。</p>

<div class="code-frame" data-lang="c">
<div class="code-lang"><span class="bold">ultrasonicAndIMUWifi.c</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cp">#include &lt;M5StickC.h&gt;
#include &lt;WiFi.h&gt;
#include &lt;WiFiUDP.h&gt;
#include &lt;OSCMessage.h&gt;
</span>
<span class="cm">/**
 * WiFiアクセス用
 */</span>
<span class="k">const</span> <span class="kt">char</span> <span class="n">ssid</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"[お使いのルーターのSSID]"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="n">pass</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"[パスワード]"</span><span class="p">;</span>
<span class="k">static</span> <span class="n">WiFiUDP</span> <span class="n">wifiUdp</span><span class="p">;</span> 
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">kRemoteIpadr</span> <span class="o">=</span> <span class="s">"[受け取りたいPCのプライベートIP]"</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">kRmoteUdpPort</span> <span class="o">=</span> <span class="mi">8001</span><span class="p">;</span> <span class="c1">//送信先のポート</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">kLocalPort</span> <span class="o">=</span> <span class="mi">7000</span><span class="p">;</span>  <span class="c1">//自身のポート</span>
<span class="n">boolean</span> <span class="n">connected</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

<span class="cm">/**
 * HCSR-04用
 */</span>
  <span class="kt">int</span> <span class="n">Trig</span> <span class="o">=</span> <span class="mi">26</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">Echo</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">Duration</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">Distance</span><span class="p">;</span>

<span class="cm">/**
 * IMU用
 */</span>
<span class="kt">float</span> <span class="n">pitch</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">F</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">roll</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">F</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">yaw</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">F</span><span class="p">;</span>

<span class="kt">float</span> <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cm">/**
 * Setup
 */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">WiFi_setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">WiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">ssid</span><span class="p">,</span> <span class="n">pass</span><span class="p">);</span>
  <span class="k">while</span><span class="p">(</span> <span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span> <span class="o">!=</span> <span class="n">WL_CONNECTED</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>  
  <span class="p">}</span>  
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">Serial_setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">""</span><span class="p">);</span> <span class="c1">// to separate line  </span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">Hcsr04_setup</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">Trig</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">Echo</span><span class="p">,</span><span class="n">INPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Hcsr04_setup</span><span class="p">();</span>
  <span class="n">Serial_setup</span><span class="p">();</span>
  <span class="n">WiFi_setup</span><span class="p">();</span>
  <span class="n">M5</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="n">M5</span><span class="p">.</span><span class="n">IMU</span><span class="p">.</span><span class="n">Init</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="cm">/**
   * 距離計測
   */</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">Trig</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
  <span class="n">delayMicroseconds</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">Trig</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>
  <span class="n">delayMicroseconds</span><span class="p">(</span><span class="mi">11</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">Trig</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
  <span class="n">Duration</span> <span class="o">=</span> <span class="n">pulseIn</span><span class="p">(</span><span class="n">Echo</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Duration</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Distance</span> <span class="o">=</span> <span class="n">Duration</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
    <span class="n">Distance</span> <span class="o">=</span> <span class="n">Distance</span><span class="o">*</span><span class="mi">340</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="mi">1000000</span><span class="p">;</span> <span class="c1">// ultrasonic speed is 340m/s = 34000cm/s = 0.034cm/us </span>

    <span class="n">OSCMessage</span> <span class="n">msgDistance</span><span class="p">(</span><span class="s">"/leftHand/distance"</span><span class="p">);</span>
    <span class="n">msgDistance</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Distance</span><span class="p">);</span>
    <span class="n">wifiUdp</span><span class="p">.</span><span class="n">beginPacket</span><span class="p">(</span><span class="n">kRemoteIpadr</span><span class="p">,</span> <span class="n">kRmoteUdpPort</span><span class="p">);</span>
    <span class="n">msgDistance</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">wifiUdp</span><span class="p">);</span>
    <span class="n">wifiUdp</span><span class="p">.</span><span class="n">endPacket</span><span class="p">();</span>  
  <span class="p">}</span>

 <span class="cm">/**
  * IMU計測
  */</span>
  <span class="n">M5</span><span class="p">.</span><span class="n">IMU</span><span class="p">.</span><span class="n">getAhrsData</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pitch</span><span class="p">,</span><span class="o">&amp;</span><span class="n">roll</span><span class="p">,</span><span class="o">&amp;</span><span class="n">yaw</span><span class="p">);</span>
  <span class="n">M5</span><span class="p">.</span><span class="n">IMU</span><span class="p">.</span><span class="n">getTempData</span><span class="p">(</span><span class="o">&amp;</span><span class="n">temp</span><span class="p">);</span>

  <span class="cm">/**
   * OSCSend
   */</span>
  <span class="n">OSCMessage</span> <span class="n">msgPitch</span><span class="p">(</span><span class="s">"/guitar/pitch"</span><span class="p">);</span>
  <span class="n">msgPitch</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">pitch</span><span class="p">);</span>
  <span class="n">OSCMessage</span> <span class="n">msgRoll</span><span class="p">(</span><span class="s">"/guitar/roll"</span><span class="p">);</span>
  <span class="n">msgRoll</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">roll</span><span class="p">);</span>
  <span class="n">OSCMessage</span> <span class="n">msgYaw</span><span class="p">(</span><span class="s">"/guitar/yaw"</span><span class="p">);</span>
  <span class="n">msgYaw</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">yaw</span><span class="p">);</span>


  <span class="n">wifiUdp</span><span class="p">.</span><span class="n">beginPacket</span><span class="p">(</span><span class="n">kRemoteIpadr</span><span class="p">,</span> <span class="n">kRmoteUdpPort</span><span class="p">);</span>
  <span class="n">msgPitch</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">wifiUdp</span><span class="p">);</span>
  <span class="n">wifiUdp</span><span class="p">.</span><span class="n">endPacket</span><span class="p">();</span>  

  <span class="n">wifiUdp</span><span class="p">.</span><span class="n">beginPacket</span><span class="p">(</span><span class="n">kRemoteIpadr</span><span class="p">,</span> <span class="n">kRmoteUdpPort</span><span class="p">);</span>
  <span class="n">msgRoll</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">wifiUdp</span><span class="p">);</span>
  <span class="n">wifiUdp</span><span class="p">.</span><span class="n">endPacket</span><span class="p">();</span>  

  <span class="n">wifiUdp</span><span class="p">.</span><span class="n">beginPacket</span><span class="p">(</span><span class="n">kRemoteIpadr</span><span class="p">,</span> <span class="n">kRmoteUdpPort</span><span class="p">);</span>
  <span class="n">msgYaw</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">wifiUdp</span><span class="p">);</span>
  <span class="n">wifiUdp</span><span class="p">.</span><span class="n">endPacket</span><span class="p">();</span>  

  <span class="n">delay</span><span class="p">(</span><span class="mi">33</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h4>
<span id="ギター姿勢" class="fragment"></span><a href="#%E3%82%AE%E3%82%BF%E3%83%BC%E5%A7%BF%E5%8B%A2"><i class="fa fa-link"></i></a>ギター姿勢</h4>

<p>M5StickCの加速度センサを用いて、ギターの姿勢を特定の軸に限って表現します。<br>
<a href="https://camo.qiitausercontent.com/d36b0e143ea9bcb84bd10610b84459bd0b9e7886/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f61353537633239312d323135632d323064622d366632322d3734346339646333316666642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fa557c291-215c-20db-6f22-744c9dc31ffd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0162d55283f311ada527275a6c340aeb" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/a557c291-215c-20db-6f22-744c9dc31ffd.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fa557c291-215c-20db-6f22-744c9dc31ffd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b16a9f4ef53358bc8869e33078439829 1x" loading="lazy"></a><a href="https://camo.qiitausercontent.com/19e00b3ad6105c3ae851ee9993ce6cb9f10377e3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f61623130663133392d363537382d343664342d303934332d3665623165616332633732302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fab10f139-6578-46d4-0943-6eb1eac2c720.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=235345fff27afb33eb368508a148c0f7" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/ab10f139-6578-46d4-0943-6eb1eac2c720.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fab10f139-6578-46d4-0943-6eb1eac2c720.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=cf2b2b2f9df8e900fe18cc0e59bc16cb 1x" loading="lazy"></a></p>

<p>加速度センサはスマートフォンの縦持ち、横持ちなどを判定する際に使われているセンサーで、デバイスの姿勢をある程度正確に計測することができます。（重力が影響しない軸の回転が計測できません）<br>
ギターが地面に対してどの程度垂直かもしくは平行か、を角度で計測して、ギターのrotationに適用しています。</p>

<h3>
<span id="右手側" class="fragment"></span><a href="#%E5%8F%B3%E6%89%8B%E5%81%B4"><i class="fa fa-link"></i></a>右手側</h3>

<p>M5StickCの加速度センサを用いて、ギターをピッキングする動きを表現します。<br>
仕組みはギター姿勢と同じです。<br>
FinalIKでアバターの右手をギターのピックアップ上に配置し、rotationだけを操作しています。</p>

<h3>
<span id="頭" class="fragment"></span><a href="#%E9%A0%AD"><i class="fa fa-link"></i></a>頭</h3>

<p>iPhone 11に搭載されているFaceTrackingを使ってアバターの頭と腰を動かしています。<br>
iPhoneアプリ「ZIG SIM Pro」を用いてFaceTrackingのパラメータをOSCでPCに送信しています。<br>
ZIG-Project <a href="https://zig-project.com/" class="autolink" rel="nofollow noopener" target="_blank">https://zig-project.com/</a> </p>

<p>FaceTrackingのパラメータから顔の姿勢をあらわす<code>facerotation</code>を抜き出しアバターのHeadボーン、Spineボーンに適用しています。<br>
首から下が固定されていて頭だけ動いているのが若干不自然だったので腰も同時に動かしています。</p>

<p>実装はこんな感じです。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">OSCHeadAndSpineRotator.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">OSCHeadAndSpineRotator</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">yaw</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">string</span> <span class="n">uuid</span> <span class="p">=</span> <span class="s">"[ZIG SIM内で確認できるデバイスID]"</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">Animator</span> <span class="n">animator</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">Transform</span> <span class="n">head</span><span class="p">,</span> <span class="n">spine</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">Quaternion</span> <span class="n">initalRotationl</span><span class="p">,</span> <span class="n">headInitialLocalRotation</span><span class="p">,</span> <span class="n">spineInitialLocalRotation</span><span class="p">,</span> <span class="n">preHeadLocalRotation</span><span class="p">,</span> <span class="n">preSpineLocalRotation</span><span class="p">;</span>

    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">Vector3</span> <span class="n">eularRotationOffset</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="kt">float</span> <span class="n">slerpRate</span> <span class="p">=</span> <span class="m">10f</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">uOscServer</span> <span class="n">server</span><span class="p">;</span>

    <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">server</span><span class="p">.</span><span class="n">onDataReceived</span><span class="p">.</span><span class="nf">AddListener</span><span class="p">(</span><span class="n">OnDataReceived</span><span class="p">);</span>
        <span class="n">animator</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Animator</span><span class="p">&gt;();</span>
        <span class="n">head</span> <span class="p">=</span> <span class="n">animator</span><span class="p">.</span><span class="nf">GetBoneTransform</span><span class="p">(</span><span class="n">HumanBodyBones</span><span class="p">.</span><span class="n">Head</span><span class="p">);</span>
        <span class="n">spine</span> <span class="p">=</span> <span class="n">animator</span><span class="p">.</span><span class="nf">GetBoneTransform</span><span class="p">(</span><span class="n">HumanBodyBones</span><span class="p">.</span><span class="n">Spine</span><span class="p">);</span>
        <span class="n">headInitialLocalRotation</span> <span class="p">=</span> <span class="n">head</span><span class="p">.</span><span class="n">localRotation</span><span class="p">;</span>
        <span class="n">spineInitialLocalRotation</span> <span class="p">=</span> <span class="n">spine</span><span class="p">.</span><span class="n">localRotation</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">void</span> <span class="nf">OnDataReceived</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">address</span> <span class="p">==</span> <span class="s">"/ZIGSIM/"</span> <span class="p">+</span> <span class="n">uuid</span> <span class="p">+</span> <span class="s">"/facerotation"</span><span class="p">)</span>
        <span class="p">{</span>

            <span class="n">Quaternion</span> <span class="n">q</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Quaternion</span><span class="p">(</span>
                <span class="kt">float</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">values</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="nf">GetString</span><span class="p">()),</span>
                <span class="kt">float</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">values</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="nf">GetString</span><span class="p">()),</span>
                <span class="kt">float</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">values</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="nf">GetString</span><span class="p">()),</span>
                <span class="kt">float</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">values</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="nf">GetString</span><span class="p">())</span>
                <span class="p">);</span>

            <span class="kt">var</span> <span class="n">thisFrameHeadLocalRotation</span> <span class="p">=</span> <span class="n">Quaternion</span><span class="p">.</span><span class="nf">Slerp</span><span class="p">(</span><span class="n">preHeadLocalRotation</span><span class="p">,</span> <span class="n">headInitialLocalRotation</span> <span class="p">*</span> <span class="n">q</span> <span class="p">*</span> <span class="n">Quaternion</span><span class="p">.</span><span class="nf">Euler</span><span class="p">(</span><span class="n">eularRotationOffset</span><span class="p">),</span> <span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span> <span class="p">*</span> <span class="n">slerpRate</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">thisFrameSpineLocalRotation</span> <span class="p">=</span> <span class="n">Quaternion</span><span class="p">.</span><span class="nf">Slerp</span><span class="p">(</span><span class="n">preSpineLocalRotation</span><span class="p">,</span> <span class="n">spineInitialLocalRotation</span> <span class="p">*</span> <span class="n">q</span> <span class="p">*</span> <span class="n">Quaternion</span><span class="p">.</span><span class="nf">Euler</span><span class="p">(</span><span class="n">eularRotationOffset</span><span class="p">),</span> <span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span> <span class="p">*</span> <span class="n">slerpRate</span><span class="p">);</span>

            <span class="c1">// 取得した回転の8割くらい頭を回転させ、4割くらい腰を回転させます（この値は好み）</span>
            <span class="n">head</span><span class="p">.</span><span class="n">localRotation</span> <span class="p">=</span> <span class="n">Quaternion</span><span class="p">.</span><span class="nf">Lerp</span><span class="p">(</span><span class="n">headInitialLocalRotation</span><span class="p">,</span> <span class="n">thisFrameHeadLocalRotation</span><span class="p">,</span> <span class="m">0.8f</span><span class="p">);</span>
            <span class="n">spine</span><span class="p">.</span><span class="n">localRotation</span> <span class="p">=</span> <span class="n">Quaternion</span><span class="p">.</span><span class="nf">Lerp</span><span class="p">(</span><span class="n">spineInitialLocalRotation</span><span class="p">,</span> <span class="n">thisFrameSpineLocalRotation</span><span class="p">,</span> <span class="m">0.4f</span><span class="p">);</span>

            <span class="n">preHeadLocalRotation</span> <span class="p">=</span> <span class="n">thisFrameHeadLocalRotation</span><span class="p">;</span>
            <span class="n">preSpineLocalRotation</span> <span class="p">=</span> <span class="n">thisFrameSpineLocalRotation</span><span class="p">;</span>

        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="vr空間へのツイートのリアルタイム表示" class="fragment"></span><a href="#vr%E7%A9%BA%E9%96%93%E3%81%B8%E3%81%AE%E3%83%84%E3%82%A4%E3%83%BC%E3%83%88%E3%81%AE%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E8%A1%A8%E7%A4%BA"><i class="fa fa-link"></i></a>VR空間へのツイートのリアルタイム表示</h2>

<p>配信映像に直接ツイート本文を載せ、リコンストラクタ側でその画像に透過処理をかけて空間に画像として表示しています。</p>

<p><a href="https://camo.qiitausercontent.com/88f35a2bba6c69f1371af66826ce635e885ebb29/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f61373639303765372d383138642d326464362d656439382d6266636331386533363834332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fa76907e7-818d-2dd6-ed98-bfcc18e36843.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2ee49e85778a057599429748152807a0" alt="VRChat_1920x1080_2020-05-30_14-52-00.522.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/a76907e7-818d-2dd6-ed98-bfcc18e36843.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fa76907e7-818d-2dd6-ed98-bfcc18e36843.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c8f1aca2016312ae614e62608b54eeb7 1x" loading="lazy"></a></p>

<p>UnityでTwitter APIを利用するためのTwityというライブラリを用いてハッシュタグツイートを約10秒間隔で更新しました。<br>
GitHub - toofusan/Twity: Twitter API Client for Unity C# (ex-name: twitter-for-unity) <a href="https://github.com/toofusan/Twity" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/toofusan/Twity</a> <br>
テキストはディスプレイに直接Canvasで表示しています。</p>

<p><a href="https://camo.qiitausercontent.com/8d55fdff72a22b9ed60093b227e432aba70b4c00/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f37323063333663342d643430612d646266622d616239642d6639366561353539346165622e676966" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F720c36c4-d40a-dbfb-ab9d-f96ea5594aeb.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0aec6e0c0b69cdf256f5b46fadfae157" alt="tweet150.gif" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/720c36c4-d40a-dbfb-ab9d-f96ea5594aeb.gif" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F720c36c4-d40a-dbfb-ab9d-f96ea5594aeb.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=bcc39649063c108edfe58f1327672f0c 1x" loading="lazy"></a></p>

<p>出現アニメーションはリコンストラクタ側でつけることもできますが、リコンストラクタ側に状態を持たせたくなかったので、配信映像に載せる前の段階でアニメーションをつけました。<br>
文字アニメーションにはText Juicerというプラグインを用いました。<br>
GitHub - badawe/Text-Juicer: Simple tool to create awesome text animations <a href="https://github.com/badawe/Text-Juicer" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/badawe/Text-Juicer</a> </p>

<h2>
<span id="返しモニタ" class="fragment"></span><a href="#%E8%BF%94%E3%81%97%E3%83%A2%E3%83%8B%E3%82%BF"><i class="fa fa-link"></i></a>返しモニタ</h2>

<p>アバターの姿とUnityのコンソール出力を確認できる返しモニタを用意します。<br>
主に下記2点の目的で返しモニタが必要でした。<br>
- 意図通りのモーションが反映されているか確認するため<br>
- ライブのMC時間にツイートを読み上げるため</p>

<p>Unityのマルチディスプレイ機能を用いて、配信用テクスチャを表示するウィンドウと別のウィンドウとして画面に表示します。<br>
<a href="https://camo.qiitausercontent.com/8b64c765c9d982c3df6eba2446b54a481a6d0c05/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f36656336306465392d336535342d353638372d663635312d3438366637373765343364342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F6ec60de9-3e54-5687-f651-486f777e43d4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3136397ad67efe7302f02ca522a9aa4b" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/6ec60de9-3e54-5687-f651-486f777e43d4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F6ec60de9-3e54-5687-f651-486f777e43d4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f6202969f5565138964cc307a1141dae 1x" loading="lazy"></a></p>

<p>ライブ中自分達のアバターのモーションがどのようになっているか、またどんなツイートが観客側に表示されているかを一目で確認できるように、アバター表示に重ねてコンソール出力をCanvasに表示しています。</p>

<p>コンソール出力を表示する実装はこちらの記事を参考にしました。<br>
【Unity】ゲーム画面にDebug.Logを出したい！ - うら干物書き <a href="https://www.urablog.xyz/entry/2017/04/25/195351" class="autolink" rel="nofollow noopener" target="_blank">https://www.urablog.xyz/entry/2017/04/25/195351</a> </p>

<p>返しモニタウィンドウをボーカルのPCにDiscordの画面共有で送ることで、同じ返しモニタを共有できるようにしています。</p>

<h2>
<span id="hlsサーバー" class="fragment"></span><a href="#hls%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC"><i class="fa fa-link"></i></a>HLSサーバー</h2>

<p>諸々の事情を考慮して映像はAWSで構築した専用のストリーミングサーバーから配信しました。<br>
構成は下記の通りです。</p>

<p><a href="https://camo.qiitausercontent.com/a40dbbe14b625b071c91228e10a02cc624925b6d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f39366135376562302d323130622d613633372d363532382d6264343830393464366430612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F96a57eb0-210b-a637-6528-bd48094d6d0a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d21b1b52dcd2811bdd06ba68f34a4925" alt="aws.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/96a57eb0-210b-a637-6528-bd48094d6d0a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F96a57eb0-210b-a637-6528-bd48094d6d0a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4fb7c149a749c4acfd3e0ce4dae60d31 1x" loading="lazy"></a></p>

<p>下記記事を参考にして殆どその通りの手順で進め、4時間程度で動作確認までできました。（AWSすごい）<br>
OBSとAWS Elemental MediaLiveでライブ配信をしてみた | Developers.IO <a href="https://dev.classmethod.jp/articles/live-aws-elemental-medialive-with-obs/" class="autolink" rel="nofollow noopener" target="_blank">https://dev.classmethod.jp/articles/live-aws-elemental-medialive-with-obs/</a> <br>
MediaPackage で Amazon CloudFront を使用する - AWS Elemental MediaPackage <a href="https://docs.aws.amazon.com/ja_jp/mediapackage/latest/ug/cdns-cf.html" class="autolink" rel="nofollow noopener" target="_blank">https://docs.aws.amazon.com/ja_jp/mediapackage/latest/ug/cdns-cf.html</a> </p>

<h2>
<span id="vrchat上で再生可能にする" class="fragment"></span><a href="#vrchat%E4%B8%8A%E3%81%A7%E5%86%8D%E7%94%9F%E5%8F%AF%E8%83%BD%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>VRChat上で再生可能にする</h2>

<ol>
<li>リコンストラクタのシェーダで表現されたライブに必要なオブジェクトをワールドに配置する

<ul>
<li>アーティストのモデル、ステージ、GPUパーティクルなど</li>
</ul>
</li>
<li>VRChat SDKのコンポーネント<code>VRC_SyncVideoStream</code>を用いてCloudFrontで配信しているHLS映像のURLにアクセス</li>
<li>映像をワールド内に配置したカメラで撮影し1920 * 1080のRenderTextureに書き込む</li>
<li>各オブジェクトのマテリアルのテクスチャとして3のRenderTextureを指定する</li>
</ol>

<h2>
<span id="vrchat上で空間編集を可能にする" class="fragment"></span><a href="#vrchat%E4%B8%8A%E3%81%A7%E7%A9%BA%E9%96%93%E7%B7%A8%E9%9B%86%E3%82%92%E5%8F%AF%E8%83%BD%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>VRChat上で空間編集を可能にする</h2>

<p>下の映像のように、だいたいのオブジェクトを手で掴んで再配置できるようにしました。<br>
同じインスタンスにいる観客同士のみに反映されます。<br>
<a href="https://camo.qiitausercontent.com/5600054f49b984066650176647b0aa614df0900a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f61353238636432302d323165352d613430652d326563392d3735346335613336306135392e676966" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fa528cd20-21e5-a40e-2ec9-754c5a360a59.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=324b59edd956c53311501b803a10a222" alt="pickup.gif" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/a528cd20-21e5-a40e-2ec9-754c5a360a59.gif" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fa528cd20-21e5-a40e-2ec9-754c5a360a59.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e0ea5dd9d4302d74287fc9c881c3d740 1x" loading="lazy"></a><br>
- オブジェクトにVRChat SDKのコンポーネント<code>VRC_Pickup</code>をつける</p>

<h1>
<span id="大変だったこと" class="fragment"></span><a href="#%E5%A4%A7%E5%A4%89%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>大変だったこと</h1>

<p>解説は以上です。制作して大変だったことをメモしておきます。</p>

<h2>
<span id="シェーダーむずかしい" class="fragment"></span><a href="#%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%82%80%E3%81%9A%E3%81%8B%E3%81%97%E3%81%84"><i class="fa fa-link"></i></a>シェーダーむずかしい</h2>

<p>シェーダーでアニメーションさせるVATというものを使ったらモーションを画像で表現できるらしい、と聞いてシェーダーを調べ始めたものの、全然理解できなかった<br>
- これがなかったら1行も読めるようにならなかったと思う<br>
    - Unity Shader Programming Vol.01 (v.2.2.1)【PDF】 - XJINE's - BOOTH <a href="https://booth.pm/ja/items/931290" class="autolink" rel="nofollow noopener" target="_blank">https://booth.pm/ja/items/931290</a> <br>
- リファレンスがわからない<br>
    - 未だにどう調べたら欲しい情報にたどり着けるかわからない HLSL? CG?</p>

<h2>
<span id="つくっていることを秘密にしたい時だれにも聞けない" class="fragment"></span><a href="#%E3%81%A4%E3%81%8F%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E7%A7%98%E5%AF%86%E3%81%AB%E3%81%97%E3%81%9F%E3%81%84%E6%99%82%E3%81%A0%E3%82%8C%E3%81%AB%E3%82%82%E8%81%9E%E3%81%91%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>つくっていることを秘密にしたい時、だれにも聞けない</h2>

<p>12月くらいから制作していたのですが、人に聞けばおそらく一瞬で解決しそうなことで割と詰まってしまいました。<br>
何を作っているかを秘密にしたいときって情報収集の仕方が難しいですよね……</p>

<h2>
<span id="エンコードこわい" class="fragment"></span><a href="#%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E3%81%93%E3%82%8F%E3%81%84"><i class="fa fa-link"></i></a>エンコードこわい</h2>

<ul>
<li>H.264エンコードについて詳細に調べようと思ったけど挫折してしまった

<ul>
<li>種類がありすぎる　ドキュメントが長すぎる</li>
<li>ある程度ピクセルをブロックにまとめてやってるっぽいとか彩度は減衰しやすいっぽいという認識だけが残っています</li>
</ul>
</li>
</ul>

<h2>
<span id="unitycaptureのピクセルズレ" class="fragment"></span><a href="#unitycapture%E3%81%AE%E3%83%94%E3%82%AF%E3%82%BB%E3%83%AB%E3%82%BA%E3%83%AC"><i class="fa fa-link"></i></a>UnityCaptureのピクセルズレ？</h2>

<p>UnityCaptureでOBSに入力した画像は微妙にピクセルがズレていて、この用途では使えなかったのでビルドしてOBSのウィンドウキャプチャを使いました<br>
トラブル起きたら一発アウトで再起動が必要になるので、本当に怖かったです……</p>

<h2>
<span id="映像ストリーミングお金かかりすぎでは" class="fragment"></span><a href="#%E6%98%A0%E5%83%8F%E3%82%B9%E3%83%88%E3%83%AA%E3%83%BC%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%8A%E9%87%91%E3%81%8B%E3%81%8B%E3%82%8A%E3%81%99%E3%81%8E%E3%81%A7%E3%81%AF"><i class="fa fa-link"></i></a>映像ストリーミング、お金かかりすぎでは</h2>

<p></p><blockquote class="twitter-tweet">
<p><a href="https://twitter.com/hashtag/%E8%A7%A3%E9%87%88%E4%B8%8D%E4%B8%80%E8%87%B4?src=hash&amp;ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">#解釈不一致</a> 配信コスト、タイムラグが・・・（）<br>ま、まあライブハウスのノルマ2回分と考えれば余裕ですよ… <a href="https://t.co/SSzPBLcuks" rel="nofollow noopener" target="_blank">pic.twitter.com/SSzPBLcuks</a></p>— ぴぼ | memex Gt (@memex_pibo) <a href="https://twitter.com/memex_pibo/status/1266961458425782272?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">May 31, 2020</a>
</blockquote> <script async src="https://platform.twitter.com/widgets.js"></script>

<h2>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h2>

<p>遠くない将来、好きな姿で、オーディオリアクティブな演出が行われるライブ会場で、リアルタイムに遠隔地のメンバーとセッションするVRライブをいちユーザーが開催できて、それに観客が何人でも同時に参加できる未来が来てほしいなと思っています。<br>
2020年7月現在、生演奏しながら楽器演奏のモーションをキャプチャするのが難しいとか、音声と空間演出のタイムコードを合わせるのが難しいといった様々な課題があり、そういったVRライブを開催するのは容易ではありません。<br>
エンジニアとしての自分にとって「#解釈不一致」は、望むVRライブの未来を今いちユーザーとして利用可能な技術で実現する挑戦でした。<br>
いつか「昔はこんな面倒なことやらないとこういうライブできなかったんだな～」と言える未来が来ることを願っています。</p>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p>GitHub - sugi-cho/Animation-Texture-Baker <a href="https://github.com/sugi-cho/Animation-Texture-Baker" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/sugi-cho/Animation-Texture-Baker</a> <br>
Unityでスクリプトを使わずに流体を計算する – EL-EMENT blog <a href="http://el-ement.com/blog/2018/12/13/unity-fluid-with-shader/" class="autolink" rel="nofollow noopener" target="_blank">http://el-ement.com/blog/2018/12/13/unity-fluid-with-shader/</a><br>
ビット演算まとめ - Qiita <a href="https://qiita.com/qiita_kuru/items/3a6ab432ffb6ae506758" class="autolink" id="reference-28fdf5a4df738ea99fe4">https://qiita.com/qiita_kuru/items/3a6ab432ffb6ae506758</a></p>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>ライブ エンコーダの設定、ビットレート、解像度を選択する - YouTube ヘルプ <a href="https://support.google.com/youtube/answer/2853702?hl=ja" class="autolink" rel="nofollow noopener" target="_blank">https://support.google.com/youtube/answer/2853702?hl=ja</a> <a href="#fnref1">↩</a></p>
</li>

</ol>
</div>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fmemex_pibo%2Fitems%2F3fbfcd627e5e7c7f2061&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fmemex_pibo%2Fitems%2F3fbfcd627e5e7c7f2061&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/memex_pibo/items/3fbfcd627e5e7c7f2061/likers" class="css-1iupg5d">282</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">210</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3fbfcd627e5e7c7f2061/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/memex_pibo/items/3fbfcd627e5e7c7f2061/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/memex_pibo/items/3fbfcd627e5e7c7f2061/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/memex_pibo/items/3fbfcd627e5e7c7f2061/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/memex_pibo/items/3fbfcd627e5e7c7f2061.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-10c692f3-1171-4383-80ab-d56b7721d05e">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-ed862607-2930-45c1-ac39-5ac0eb1b6e3a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-ed862607-2930-45c1-ac39-5ac0eb1b6e3a">{}</script>
      
<div id="LoginModal-react-component-3f82002d-8283-41db-b7a2-b1702926fc68"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-3f82002d-8283-41db-b7a2-b1702926fc68">{}</script>
      
<div id="StockModal-react-component-c27e321e-73b8-45f7-a9b4-dcff267a6932"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-c27e321e-73b8-45f7-a9b4-dcff267a6932">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;JoAS5rFqOOIWytber9D3DtwxRIyFZaiaXgTLPsqvgNDEabLSaDC3vYHW6ch64nNnezmFyHSVrv+7MGrG88/RqA==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/7f6392af8edefac56a69dc994e622911904509e0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f66376130626230632d393666622d343164392d383134382d3861356537316137323935322e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Ff7a0bb0c-96fb-41d9-8148-8a5e71a72952.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=271cb42496b742f3ba543586aed9cf4d\" alt=\"phantom.gif\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/f7a0bb0c-96fb-41d9-8148-8a5e71a72952.gif\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Ff7a0bb0c-96fb-41d9-8148-8a5e71a72952.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0e63389fa8187511692946de03cd0bba 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eぴぼ(\u003ca href=\"https://twitter.com/memex_pibo\" rel=\"nofollow noopener\" target=\"_blank\"\u003e@memex_pibo\u003c/a\u003e)と申します。\u003cbr\u003e\n「\u003ca href=\"http://meme-x.jp/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ememex\u003c/a\u003e」というVR空間で活動する2人組音楽ユニットをしています。\u003cbr\u003e\n5月末ごろ、「Omnipresence Live」というVRライブシステムを作って「#解釈不一致」というタイトルのライブをしました。\u003cbr\u003e\n生演奏に対してオーディオリアクティブな空間演出が行われて、かつ人数制限の無いライブという、類例の少ないVRライブになったと思います。\u003cbr\u003e\nこのエントリでは、その実装や運用を解説します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"アーカイブ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%83%BC%E3%82%AB%E3%82%A4%E3%83%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアーカイブ\u003c/h2\u003e\n\n\u003cp\u003e「#解釈不一致」の空間アーカイブはVRChatのワールドとして公開してあります。\u003cbr\u003e\nこちらから体験いただけます。所要時間は50分程度です。\u003cbr\u003e\n\u003ca href=\"https://vrchat.com/home/world/wrld_21a48553-fd25-40d0-8ff0-b4402b36172a\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://vrchat.com/home/world/wrld_21a48553-fd25-40d0-8ff0-b4402b36172a\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eまた、YouTube上に360°ステレオ映像のアーカイブを用意しております。\u003cbr\u003e\n\u003ca href=\"https://youtu.be/CIahS2Z1_Ds\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://youtu.be/CIahS2Z1_Ds\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eご覧いただいた方が理解しやすいと思いますので、是非一度観て頂きたいです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"システム図\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E5%9B%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシステム図\u003c/h2\u003e\n\n\u003cp\u003e「#解釈不一致」を行った際のシステム図です。\u003cbr\u003e\n遠隔地にいるmemexの2人がネット越しに音声とモーションを共有し、それを一度映像に変換してからVRChatのワールドに配信するという形になっています。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/4127bdc1e23772926d8b313fead5d1a76e07dcaf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f63643039396466322d313237612d363734392d383664642d3739613166356266656436612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fcd099df2-127a-6749-86dd-79a1f5bfed6a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1322548da29b4d19ba7ccebf076a4a7a\" alt=\"fuitch (3).png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/cd099df2-127a-6749-86dd-79a1f5bfed6a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fcd099df2-127a-6749-86dd-79a1f5bfed6a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=33636d38cb14b94e0a6a13178da69993 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"解説の流れ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E8%AA%AC%E3%81%AE%E6%B5%81%E3%82%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解説の流れ\u003c/h2\u003e\n\n\u003cp\u003eまずライブを実現する技術のコアとなる「Omnipresence Live」の実装について解説し、さらにその具体的な運用として「#解釈不一致」の事例を紹介します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"omnipresence-liveの解説トピック\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#omnipresence-live%E3%81%AE%E8%A7%A3%E8%AA%AC%E3%83%88%E3%83%94%E3%83%83%E3%82%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「Omnipresence Live」の解説トピック\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eオーディオの音量をOSCに変換する\u003c/li\u003e\n\u003cli\u003eMIDI信号をOSCに変換する\u003c/li\u003e\n\u003cli\u003eOSCの値をUnityで受けてRenderTextureに書き込む\u003c/li\u003e\n\u003cli\u003e映像として情報を送信したい時の映像エンコード対策\u003c/li\u003e\n\u003cli\u003eアバターの頂点アニメーションテクスチャをリアルタイムに映像化する\u003c/li\u003e\n\u003cli\u003e頂点情報が埋め込まれたテクスチャからアバターのモーションを再構成する\u003c/li\u003e\n\u003cli\u003eQuaternionを用いてShaderのみでオブジェクトの回転を表現する\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"解釈不一致の解説トピック\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E9%87%88%E4%B8%8D%E4%B8%80%E8%87%B4%E3%81%AE%E8%A7%A3%E8%AA%AC%E3%83%88%E3%83%94%E3%83%83%E3%82%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「#解釈不一致」の解説トピック\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e生歌とギターの生演奏による遠隔セッション\u003c/li\u003e\n\u003cli\u003e楽曲を構成するトラック毎に反応するパラオーディオリアクティブな空間演出\u003c/li\u003e\n\u003cli\u003e生演奏を含む音楽の特定のタイミングで発火する演出イベント管理\u003c/li\u003e\n\u003cli\u003e遠隔モーションキャプチャ\u003c/li\u003e\n\u003cli\u003eギターの生演奏とギターモーション収録の両立\u003c/li\u003e\n\u003cli\u003eツイートのVR空間へのリアルタイム表示\u003c/li\u003e\n\u003cli\u003e遠隔モーション収録時の返しモニタ\u003c/li\u003e\n\u003cli\u003eAWSによる専用映像ストリーミングサーバ構築\u003c/li\u003e\n\u003cli\u003eVRChatへのOmnipresence Liveリコンストラクタの実装\u003c/li\u003e\n\u003cli\u003eVRChat上での空間編集機能\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"omnipresence-live-の実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#omnipresence-live-%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eOmnipresence Live の実装\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"omnipresence-live-とは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#omnipresence-live-%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eOmnipresence Live とは\u003c/h2\u003e\n\n\u003cp\u003eVRライブを構成する要素である\u003cstrong\u003eアバターのモーション・演出・音声\u003c/strong\u003eの情報を全て映像に変換して配信し、配信された映像を受け取ってVRライブを再構成するシステムです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"特徴\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%89%B9%E5%BE%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e特徴\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e参加人数の制限が無い\n\n\u003cul\u003e\n\u003cli\u003eただし観客が観客全員を視認できるわけではない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e生歌・生演奏が可能\u003c/li\u003e\n\u003cli\u003e生モーション収録が可能\u003c/li\u003e\n\u003cli\u003eパラオーディオリアクティブ（楽曲の各トラックに演出が反応する）な空間演出が可能\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"解決する課題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E6%B1%BA%E3%81%99%E3%82%8B%E8%AA%B2%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解決する課題\u003c/h3\u003e\n\n\u003cp\u003e生演奏にタイミングが合ったオーディオリアクティブな空間演出のあるVRライブをする方法が（作らないと）ないこと\u003cbr\u003e\n純粋に解決するなら音声とタイムコードを共有したモーション・演出を配信できるサーバーと対応したクライアントを作る必要がありそうです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"手法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%89%8B%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e手法\u003c/h3\u003e\n\n\u003cp\u003eモーション・演出の情報を映像に変換することで音声とタイミングが一致した状態でモーション・演出を配信する\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"仕組み\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%95%E7%B5%84%E3%81%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e仕組み\u003c/h3\u003e\n\n\u003cp\u003e次の2つのシステムに分けられます。\u003cbr\u003e\n\u003cstrong\u003eイベントビジュアライザ\u003c/strong\u003e：アバターのモーションとVR空間演出のパラメータを毎フレーム画像として書き出す\u003cbr\u003e\n\u003cstrong\u003eリコンストラクタ\u003c/strong\u003e：イベントビジュアライザが生成した画像からアバターの動きとVR空間演出を再構成する\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"イベントビジュアライザ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイベントビジュアライザ\u003c/h2\u003e\n\n\u003cp\u003eイベントビジュアライザは、毎フレームアバターのモーション・空間の演出情報を下のような画像にします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/48c81d4385306f611162af9a09898cf842a0adba/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f31356162636131342d366262332d616439392d666266382d3164313232656163633664632e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F15abca14-6bb3-ad99-fbf8-1d122eacc6dc.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f7ca241933bdfd5ba360ed3241373505\" alt=\"InkedOmnipresenceLiveテクスチャ - コピー_LI.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/15abca14-6bb3-ad99-fbf8-1d122eacc6dc.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F15abca14-6bb3-ad99-fbf8-1d122eacc6dc.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f4745750e16eddb27ba3e42fcedead4c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e水色で囲われている部分が演出情報、緑色で囲われている部分がモーション情報です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"イベントビジュアライザシステム構成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E6%A7%8B%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイベントビジュアライザ・システム構成\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eAbleton Live Suite\n\n\u003cul\u003e\n\u003cli\u003e概要\n\n\u003cul\u003e\n\u003cli\u003eDAW（作曲などに用いるソフト）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e役割\n\n\u003cul\u003e\n\u003cli\u003eライブのタイムライン管理\u003c/li\u003e\n\u003cli\u003eMax for Liveへの橋渡し\u003c/li\u003e\n\u003cli\u003eライブ音声の処理\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eMax for Live\n\n\u003cul\u003e\n\u003cli\u003e概要\n\n\u003cul\u003e\n\u003cli\u003eAbleton Liveの各トラック上でMAX/MSP（ビジュアルプログラミング環境）を走らせられるプラグイン\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e役割\n\n\u003cul\u003e\n\u003cli\u003eライブの音声の各トラック（歌、ギター、ドラムのキック、ドラムのスネアなど）の音量をOSCで送信する\u003c/li\u003e\n\u003cli\u003eMIDI信号をOSCで送信する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUnity（演出信号ビジュアライザ）\n\n\u003cul\u003e\n\u003cli\u003e役割\n\n\u003cul\u003e\n\u003cli\u003eOSCで受け取った音量・MIDI信号を1920px × 1080pxのテクスチャに書き込む\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUnity（頂点ビジュアライザ）\n\n\u003cul\u003e\n\u003cli\u003e役割\n\n\u003cul\u003e\n\u003cli\u003eVRMアバターの頂点の位置情報を一つずつ1920px × 1080pxのテクスチャに書き込む\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUnity（位置・姿勢ビジュアライザ）\n\n\u003cul\u003e\n\u003cli\u003e役割\n\n\u003cul\u003e\n\u003cli\u003e任意のオブジェクトのTransformを1920px × 1080pxのテクスチャに書き込む\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ableton-live-suite\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ableton-live-suite\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAbleton Live Suite\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ea13820baa9e1f9f1d48e5dfb44e6945d9c04a76/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f35353332326237302d393831342d386363322d343664342d6234653638343136646564612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F55322b70-9814-8cc2-46d4-b4e68416deda.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ad6d02ac455061a5b26d13217e3d3e3d\" alt=\"live2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/55322b70-9814-8cc2-46d4-b4e68416deda.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F55322b70-9814-8cc2-46d4-b4e68416deda.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=237d7e3b2386e05f95ff4cfed1ae26b1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e音声をMax for Liveに送ります。\u003cbr\u003e\nオーディオリアクティブトラック、生歌トラック、生ギタートラックにそれぞれ後述する紫色のMax for Liveプラグインを挿すことでそれぞれのパートの音量・ピッチを個別にOSCに変換します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"max-for-liveプラグイン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#max-for-live%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMax For Liveプラグイン\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/4a07db2fc47943d63e8e46970485580be84ed134/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f63393566656662632d366535322d626362342d343031642d6461363138616230306461622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fc95fefbc-6e52-bcb4-401d-da618ab00dab.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2df51aeff3f291cfaf76d5b01e87d3b7\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/c95fefbc-6e52-bcb4-401d-da618ab00dab.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fc95fefbc-6e52-bcb4-401d-da618ab00dab.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3cf9bb0dc8c4b37e260c7b9cede4ffb6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eMax for Liveとは、Ableton Liveと連携可能な音声信号をすごく簡単に扱えるビジュアルプログラミング環境です。\u003cbr\u003e\nAbleton Live Suiteの各トラックの音声の音量・ピッチ（音階）を算出してOSCで送信します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"unity演出信号ビジュアライザ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unity%E6%BC%94%E5%87%BA%E4%BF%A1%E5%8F%B7%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUnity（演出信号ビジュアライザ）\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/bae78976cfdc7e6ae6effa2986e2824b2f2d224e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f65343162316134632d393161622d653562352d373537332d6336353332613861616433382e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe41b1a4c-91ab-e5b5-7573-c6532a8aad38.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=db5659094644d063b3c24b211e546a38\" alt=\"audioEventVZoom.gif\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/e41b1a4c-91ab-e5b5-7573-c6532a8aad38.gif\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe41b1a4c-91ab-e5b5-7573-c6532a8aad38.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f978a7b309ed89ba8465d5db6bfe6cc6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e音量・ピッチ・曲の展開に合わせた演出信号をテクスチャに変換します。\u003cbr\u003e\nMax for Liveが出すOSC信号を受け取って画像化します。\u003cbr\u003e\nOSCの受信には \u003ca href=\"https://github.com/hecomi/uOSC\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/hecomi/uOSC\u003c/a\u003e を利用しています。\u003c/p\u003e\n\n\u003cp\u003e精度の要らない値となるべく精度が欲しい値で少し異なるアプローチを取ります。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"精度の要らない値\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B2%BE%E5%BA%A6%E3%81%AE%E8%A6%81%E3%82%89%E3%81%AA%E3%81%84%E5%80%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e精度の要らない値\u003c/h4\u003e\n\n\u003cp\u003e\u003cstrong\u003e音量の大小のようなざっくりとした値を色の明るさというざっくりとした値に変換します。\u003c/strong\u003e\u003cbr\u003e\n具体的には8bit以下（0~255）の精度でいい場合にはこの方法を用います。\u003c/p\u003e\n\n\u003cp\u003e下記の \u003ccode\u003eOSCVolumeAndPitchVisualizer.cs\u003c/code\u003e をアタッチしたGameObjectを、OSCを送信するトラック分用意しています。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/23018fa43d88c67d63efb7a7ff9b68bd54b8fcb0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f35323461303636322d363930362d613433382d326563392d6266363833616435613639622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F524a0662-6906-a438-2ec9-bf683ad5a69b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d2c5c48a677574dee407cc2d6bd096b9\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/524a0662-6906-a438-2ec9-bf683ad5a69b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F524a0662-6906-a438-2ec9-bf683ad5a69b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=366c1e41fa8a3f36266dd6413294a8db 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eOSCVolumeAndPitchVisualizer.cs\u003c/code\u003e はトラック毎に定めたテクスチャの座標に、トラックの音声を元にした色を書き込みます。\u003cbr\u003e\n- 音量 = 輝度（HSVのV）\u003cbr\u003e\n- ピッチ = 色相（HSVのH）\u003c/p\u003e\n\n\u003cp\u003eわざわざ色を書き込むのにスレッド数1のコンピュートシェーダを呼んでいますが \u003ccode\u003eTexture2D.SetPixels()\u003c/code\u003e でよいと思います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOSCVolumeAndPitchVisualizer.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e/// 簡略化しています\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003euOSC\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eOSCVolumeAndPitchVisualizer\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonoBehaviour\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 0~1のfloat値を0~255のモノクロ値でピクセルに書き込むコンピュートシェーダ\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eComputeShader\u003c/span\u003e \u003cspan class=\"n\"\u003eNormalizedRGBValueTo64pxRGBBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 書き込むピクセル位置\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 書き込むテクスチャ\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eRenderTexture\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// OSCの受信サーバー\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003euOscServer\u003c/span\u003e \u003cspan class=\"n\"\u003eserver\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 受け取るOSCアドレス\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eaddress\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// volume: 0~1\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// pitch: 0=A（ラ）で0~11の整数\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003evolume\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epitch\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// hsv（色）値: 0=1\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1.0f\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eserver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eonDataReceived\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOnDataReceived\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnDataReceived\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaddress\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaddress\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"/volume\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003evolume\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaddress\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaddress\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"/pitch\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 0 = A, 1 = A# で0~11まで　検出できなかった場合-1が返ってくる\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003epitch\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeltaTime\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// 音量をそのまま明度に\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evolume\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// ピッチを色相に（実際にはカクカク変わらないようにLerpAngleで補完処理をかけました）\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eh\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epitch\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e12.0f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// HSVカラーをRGBに変換\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ergb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eColor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eHSVToRGB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"nf\"\u003eSetBlockRGB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ergb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 指定したブロック（8px × 8px）を指定した色で塗る\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"rowInMethod\"\u0026gt;ブロックの行\u0026lt;/param\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"columnInMethod\"\u0026gt;ブロックの列\u0026lt;/param\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"rgbInMethod\"\u0026gt;色\u0026lt;/param\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetBlockRGB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003erowInMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumnInMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eColor\u003c/span\u003e \u003cspan class=\"n\"\u003ergbInMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 呼びたいカーネル（処理）を決める\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ekernel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNormalizedRGBValueTo64pxRGBBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindKernel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"CSMain\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 必要なデータやら参照やらを渡す\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eNormalizedRGBValueTo64pxRGBBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetInt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"row\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erowInMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eNormalizedRGBValueTo64pxRGBBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetInt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"column\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumnInMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eNormalizedRGBValueTo64pxRGBBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"normalizedRed\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ergbInMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eNormalizedRGBValueTo64pxRGBBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"normalizedGreen\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ergbInMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eNormalizedRGBValueTo64pxRGBBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"normalizedBlue\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ergbInMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eNormalizedRGBValueTo64pxRGBBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetTexture\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekernel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"OutPosition\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// コンピュートシェーダを実行する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eNormalizedRGBValueTo64pxRGBBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekernel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNormalized8bitRGBValueTo64pxRGB.c\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// csから渡される値\u003c/span\u003e\n\u003cspan class=\"n\"\u003eRWTexture2D\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efloat4\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eOutPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedRed\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedGreen\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedBlue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enumthreads\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCSMain\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euint3\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSV_DispatchThreadID\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e   \n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eOutPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003euint2\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \n            \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enormalizedRed\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedBlue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedGreen\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"なるべく精度が欲しい値\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E7%B2%BE%E5%BA%A6%E3%81%8C%E6%AC%B2%E3%81%97%E3%81%84%E5%80%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eなるべく精度が欲しい値\u003c/h4\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"情報量の限界\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%83%85%E5%A0%B1%E9%87%8F%E3%81%AE%E9%99%90%E7%95%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e情報量の限界\u003c/h5\u003e\n\n\u003cp\u003eたとえばオブジェクトのx座標を8bit=0~255の値を用いて100=1mとして表現すると、2.56mの距離を1cmずつしか動かせないことになります。\u003cbr\u003e\nほかにも、25秒かけてゆっくりフェードさせたいといった場面で8bitしか表現できないと1秒につき値を約10回しか更新できず、カクカクした見た目になります。（実際にはエンコードでさらにカクカクになります）\u003c/p\u003e\n\n\u003cp\u003eもっと精度が欲しい場合は、\u003cstrong\u003eエンコード\u003c/strong\u003eで情報が削がれないように気を使って値をピクセルに書き込む必要があります。\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"映像エンコード問題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%98%A0%E5%83%8F%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E5%95%8F%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e映像エンコード問題\u003c/h5\u003e\n\n\u003cp\u003eパラメータを画像に変換・映像として配信し、受信した映像からパラメータを復元するにあたって問題となるのが映像の\u003cstrong\u003eエンコード\u003c/strong\u003eです。\u003cbr\u003e\n人間が気付きにくい形で色のデータ量を圧縮することで配信・受信の通信を楽にしてくれる処理です。\u003cbr\u003e\nが、これが正確な値を送りたい時の足枷となります。\u003c/p\u003e\n\n\u003cp\u003e一般的に、デジタルな色は赤、緑、青の3色の度合い＝RGB値で表現されています。\u003cbr\u003e\n画像・映像データにおいては、1ピクセルは赤、緑、青それぞれ0~255の2^8=8bitの合計24bitで表すことが多いです。\u003c/p\u003e\n\n\u003cp\u003e仮に1ピクセル24bitの色を1920px × 1080pxの画素数、30fpsの非圧縮映像にすると1秒当たりに必要なbit数は\u003cbr\u003e\n\u003ccode\u003e24*1920*1080*30 / 1024^2 ≒ 1423Mbps\u003c/code\u003e になります（値がでかすぎて計算が合ってるか不安になります）\u003cbr\u003e\nが、一般的な映像ストリーミングサイト\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"ライブ エンコーダの設定、ビットレート、解像度を選択する - YouTube ヘルプ https://support.google.com/youtube/answer/2853702?hl=ja\"\u003e1\u003c/a\u003e\u003c/sup\u003eにおいて1920px × 1080pxの映像は3~6Mbpsでやりとりされています。\u003cbr\u003e\nエンコーダが頑張って圧縮してくれているおかげですね。\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"エンコード対策ブロックと明るさ8bit\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E5%AF%BE%E7%AD%96%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%81%A8%E6%98%8E%E3%82%8B%E3%81%958bit\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eエンコード対策：ブロックと明るさ8bit\u003c/h5\u003e\n\n\u003cp\u003eエンコードに対してある程度頑健な情報の送り方として、試行錯誤した結果下記の方法を取りました。（H.264エンコードの仕様をちゃんと読めばもっといい方法はあると思いますが……）\u003cbr\u003e\n- なるべく\u003ccode\u003e4px × 4px\u003c/code\u003e、\u003ccode\u003e8px × 8px\u003c/code\u003eのような\u003cstrong\u003eブロック\u003c/strong\u003eに1つの情報をまとめて書き込む\u003cbr\u003e\n- 色は使わずに明るさだけ、つまり0~255の8bitで値を表現する\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"8bitより大きい情報を2つの色に分割して埋め込む-棄却案\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#8bit%E3%82%88%E3%82%8A%E5%A4%A7%E3%81%8D%E3%81%84%E6%83%85%E5%A0%B1%E3%82%922%E3%81%A4%E3%81%AE%E8%89%B2%E3%81%AB%E5%88%86%E5%89%B2%E3%81%97%E3%81%A6%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80-%E6%A3%84%E5%8D%B4%E6%A1%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e8bitより大きい情報を2つの色に分割して埋め込む: 棄却案\u003c/h5\u003e\n\n\u003cp\u003e8bitより大きい値を扱いたい場合は2ブロック以上を使って1つの値を表現することになります。が……\u003cbr\u003e\n8bit=255段階の明るさすらもエンコードのためにノイズが混じった値になります。\u003c/p\u003e\n\n\u003cp\u003e16bit値を表現するため、はじめは2ブロックを使って1つめのブロックに前半8bit、2つめのブロックに後半8bit、のように分割することを試みました。\u003cbr\u003e\nが、誤差が非常に大きくなってしまいました。\u003c/p\u003e\n\n\u003cp\u003eたとえば下記のような送りたい値 \u003ccode\u003e21,855\u003c/code\u003e があったとします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/d0b1cb920a91d8c235d70768408081b612395471/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f39343935356163342d633331312d633036342d306236382d3463393363626263613663642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F94955ac4-c311-c064-0b68-4c93cbbca6cd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a726af072a50ee2f520f6f30655ecdfd\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/94955ac4-c311-c064-0b68-4c93cbbca6cd.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F94955ac4-c311-c064-0b68-4c93cbbca6cd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f676f23853aa4dbb0d447b65134ce710 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこのとき、エンコードによってブロック1の値が\u003ccode\u003e3\u003c/code\u003eだけ変わってしまったとすると、結果は\u003ccode\u003e21,087\u003c/code\u003eになります。\u003cbr\u003e\nブロック1の値が\u003ccode\u003e85\u003c/code\u003eから\u003ccode\u003e82\u003c/code\u003e、わずか\u003ccode\u003e3/255\u003c/code\u003eが変わっただけですが、2ブロックの合計としては\u003ccode\u003e3*256=768\u003c/code\u003e変わることになります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/87dd4ee7dcabda8c9bf4bb242358aed716d5e8d7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f39396461636630622d393833612d326439382d633333302d6134396533633035306537332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F99dacf0b-983a-2d98-c330-a49e3c050e73.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c892bf42a9bdbc059ca9dd95e0d87030\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/99dacf0b-983a-2d98-c330-a49e3c050e73.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F99dacf0b-983a-2d98-c330-a49e3c050e73.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=eec79922e018ff392ed2ed11ef6147ee 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eオブジェクトのx座標をこの2ブロックが保持する16bit=0~65535の値を用いて10000=1mとして表現した場合を考えると、エンコードによる1ブロックの明るさ\u003ccode\u003e3\u003c/code\u003eの誤差で簡単に\u003cstrong\u003e約8cm\u003c/strong\u003eズレてしまうことになります。\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"8bitより大きい情報を2つの色に分割して埋め込む-採用案\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#8bit%E3%82%88%E3%82%8A%E5%A4%A7%E3%81%8D%E3%81%84%E6%83%85%E5%A0%B1%E3%82%922%E3%81%A4%E3%81%AE%E8%89%B2%E3%81%AB%E5%88%86%E5%89%B2%E3%81%97%E3%81%A6%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80-%E6%8E%A1%E7%94%A8%E6%A1%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e8bitより大きい情報を2つの色に分割して埋め込む: 採用案\u003c/h5\u003e\n\n\u003cp\u003eそこで、2ブロックに交互に1bitずつ担当させるという方法を取ります。\u003ccode\u003e21,855\u003c/code\u003eはこのように表せます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/7057ee724be6bacb6bc23459fe22401fc2a2029d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f63663037353530392d363961612d623563332d663131372d6436313365393939343733342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fcf075509-69aa-b5c3-f117-d613e9994734.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=686bc76caa20df28b10c20675a3d65d3\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/cf075509-69aa-b5c3-f117-d613e9994734.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fcf075509-69aa-b5c3-f117-d613e9994734.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=01d1b9455303039006a39c7aaf5ca44e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nブロック1の値が\u003ccode\u003e3\u003c/code\u003e変わって\u003ccode\u003e3\u003c/code\u003eから\u003ccode\u003e6\u003c/code\u003eになりましたが、値は\u003ccode\u003e21,885\u003c/code\u003eで、誤差が\u003ccode\u003e30\u003c/code\u003eで済みました。10000=1mなら\u003cstrong\u003e3mm\u003c/strong\u003eですね。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/519285c6e7c7b1ac044b0fdf76460c599cb07da9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f32633935633531342d353863612d343265612d643337312d3233353936346436373361612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F2c95c514-58ca-42ea-d371-235964d673aa.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=24832f44d55641ac6cbdd6c0028d9ab1\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/2c95c514-58ca-42ea-d371-235964d673aa.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F2c95c514-58ca-42ea-d371-235964d673aa.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ea7112ba32d8e50beb56c875cb609e79 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装\u003c/h5\u003e\n\n\u003cp\u003e実装はこんな感じです。（単なるビット演算です）\u003cbr\u003e\n（本当は拡張子は.compute ですがQiitaでハイライトされなくて読みにくいので.cとしています　以下同様）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eWriter8x16px16bitUnsignedInt.c\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// csから渡される値\u003c/span\u003e\n\u003cspan class=\"n\"\u003eRWTexture2D\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efloat4\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eOutPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eval\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003efloat4\u003c/span\u003e \u003cspan class=\"nf\"\u003eoddBitOfUintTo8bitBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 0bo-p-q-r-s-t-u-v- -\u0026gt; 0b00000000opqrstuv にする\u003c/span\u003e\n    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e     \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e     \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e     \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e     \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e    \u003cspan class=\"mi\"\u003e32\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e    \u003cspan class=\"mi\"\u003e32\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e   \u003cspan class=\"mi\"\u003e128\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e   \u003cspan class=\"mi\"\u003e128\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e   \u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e   \u003cspan class=\"mi\"\u003e512\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e16\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e  \u003cspan class=\"mi\"\u003e2048\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e  \u003cspan class=\"mi\"\u003e2048\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e32\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e  \u003cspan class=\"mi\"\u003e8192\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e  \u003cspan class=\"mi\"\u003e8192\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e64\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e32768\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e32768\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e128\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e  \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mh\"\u003e0xff\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mh\"\u003e0xff\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mh\"\u003e0xff\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e255\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003efloat4\u003c/span\u003e \u003cspan class=\"nf\"\u003eevenBitOfUintTo8bitBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 0b-o-p-q-r-s-t-u-v -\u0026gt; 0b00000000opqrstuv にする\u003c/span\u003e\n    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e     \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e     \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e     \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e     \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e    \u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e    \u003cspan class=\"mi\"\u003e16\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e    \u003cspan class=\"mi\"\u003e64\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e    \u003cspan class=\"mi\"\u003e64\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e   \u003cspan class=\"mi\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e   \u003cspan class=\"mi\"\u003e256\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e16\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1024\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1024\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e32\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e  \u003cspan class=\"mi\"\u003e4096\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e  \u003cspan class=\"mi\"\u003e4096\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e64\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e16384\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e16384\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e128\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e  \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mh\"\u003e0xff\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mh\"\u003e0xff\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mh\"\u003e0xff\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e255\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enumthreads\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCSMainFHD\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euint3\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSV_DispatchThreadID\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003euintValue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e65535\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eOutPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003euint2\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e  \u003cspan class=\"n\"\u003eoddBitOfUintTo8bitBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euintValue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eOutPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003euint2\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eevenBitOfUintTo8bitBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euintValue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"unity頂点ビジュアライザ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unity%E9%A0%82%E7%82%B9%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUnity（頂点ビジュアライザ）\u003c/h3\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"頂点アニメーション\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%A0%82%E7%82%B9%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e頂点アニメーション\u003c/h4\u003e\n\n\u003cp\u003eアバターの頂点群の位置情報を1頂点ずつ先述の方法でテクスチャに書き込みます。\u003cbr\u003e\nVertex Animation Textureと呼ばれる、アニメーションの各キーフレームにおける頂点位置をテクスチャに書き込んで再構成する手法を映像で行う形です。\u003cbr\u003e\n実装にあたり、sugi-cho様のリポジトリ「Animation-Texture-Baker」を多大に参考にしました。\u003cbr\u003e\n\u003ca href=\"https://github.com/sugi-cho/Animation-Texture-Baker\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/sugi-cho/Animation-Texture-Baker\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"制約\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%B6%E7%B4%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e制約\u003c/h4\u003e\n\n\u003cp\u003eUnityにおいて頂点の位置情報は32bit floatで表現されていますが、先述の理由からその精度を保証することは難しいため、範囲制限を設けることで16bit値で表現しています。\u003c/p\u003e\n\n\u003cp\u003e具体的には下記のような形で表現しました。\u003cbr\u003e\n- 頂点位置は-3.2767m ~ 3.2767mの範囲のみを動けるものとする\u003cbr\u003e\n    - この範囲を超えた頂点は描画されなくなる\u003cbr\u003e\n- 位置の値に3.2767mのオフセットを加え、unsigned intの16bit値 \u003ccode\u003e0~65535\u003c/code\u003e で位置を表現する\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"出力イメージ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%87%BA%E5%8A%9B%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e出力イメージ\u003c/h4\u003e\n\n\u003cp\u003e下図テクスチャの一番下の白い横長のかたまりがアバター1体分の頂点情報です。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/04c976111900c7df6ba7d3093c962a732c07e5dc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f31326337633539652d393834612d613635622d373934382d3764333739643762623737322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F12c7c59e-984a-a65b-7948-7d379d7bb772.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=764ddf68d7cdbd6f3ce8e7866685b146\" alt=\"ピックアップ点.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/12c7c59e-984a-a65b-7948-7d379d7bb772.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F12c7c59e-984a-a65b-7948-7d379d7bb772.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a2e69070d1420272d19af61e38ede25c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e頂点情報を描画している1部分（左下緑色の四角領域）をクローズアップするとこのようになっています。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/aa202d066908f677f33b996a89d58825528d36a1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f65316165636664302d333232612d646236622d363033302d3635396430663861373432622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe1aecfd0-322a-db6b-6030-659d0f8a742b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b19b0f62feced5181634e23d76854afc\" alt=\"OmnipresenceLiveテクスチャCloseUp.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/e1aecfd0-322a-db6b-6030-659d0f8a742b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe1aecfd0-322a-db6b-6030-659d0f8a742b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b51ad74908d380c2cc73654d9afaec19 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e1頂点につきx,y,z座標をそれぞれ4px × 4pxのブロック2つに書き込んでいます。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"実装-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装\u003c/h4\u003e\n\n\u003cp\u003e実装はこんな感じです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eRealtimeVertexBaker16bitUnsignedInt.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eRealtimeVertexBaker16bitUnsignedInt\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonoBehaviour\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eComputeShader\u003c/span\u003e \u003cspan class=\"n\"\u003einfoTexGen\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e \u003cspan class=\"n\"\u003ematerial\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// テクスチャのどの位置に書き込むかというオフセット\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumnOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eSkinnedMeshRenderer\u003c/span\u003e \u003cspan class=\"n\"\u003e_skin\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003evertexCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eTEX_WIDTH\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1920\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTEX_HEIGHT\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1080\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eRenderTexture\u003c/span\u003e \u003cspan class=\"n\"\u003epRt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eMesh\u003c/span\u003e \u003cspan class=\"n\"\u003emesh\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eposList\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eComputeBuffer\u003c/span\u003e \u003cspan class=\"n\"\u003eposBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// アバターのSkinned Mesh Rendererを取得する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_skin\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSkinnedMeshRenderer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003evertexCount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_skin\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esharedMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertexCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003emesh\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// レンダーテクスチャを書き込み可能にする\u003c/span\u003e\n        \u003cspan class=\"n\"\u003epRt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eenableRandomWrite\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// SkinnedMeshRenderから現在のフレームのmeshを作る\u003c/span\u003e\n         \u003cspan class=\"n\"\u003e_skin\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBakeMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emesh\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// コンピュートシェーダーに値を渡す入れ物をつくる\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// C言語の動的メモリ確保みたいな感じで、頂点数 * Vector3のサイズのバッファをつくる\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eposBuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eComputeBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evertexCount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRuntime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInteropServices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMarshal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSizeOf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// meshの頂点位置情報をセットする\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eposBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emesh\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertices\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ekernel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einfoTexGen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindKernel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"CSMainFHD\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 必要なデータや参照を渡す\u003c/span\u003e\n        \u003cspan class=\"n\"\u003einfoTexGen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetInt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"VertCount\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evertexCount\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003einfoTexGen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetInt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ColumnOffset\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumnOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003einfoTexGen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekernel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Pos\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eposBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003einfoTexGen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetTexture\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekernel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"OutPosition\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epRt\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// コンピュートシェーダを実行する\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 引数はスレッド数\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// スレッド数は 頂点数 * 1 * 1\u003c/span\u003e\n        \u003cspan class=\"n\"\u003einfoTexGen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekernel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evertexCount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eposBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRelease\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eVertexWriter16bitUnsignedIntFHD.c\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// csから渡される値\u003c/span\u003e\n\u003cspan class=\"n\"\u003eRWTexture2D\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efloat4\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eOutPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eStructuredBuffer\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efloat3\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ePos\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eVertCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eColumnOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enumthreads\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCSMainFHD\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euint3\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSV_DispatchThreadID\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// \u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// id.xはそのまま頂点ID\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// row = id.x % (TEX_WIDTH / 4) // 4はcolumnあたりのx方向の画素数\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// column = id.x / (TEX_WIDTH / 4)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efloat3\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePos\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eTEX_WIDTH\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1920\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTEX_WIDTH\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTEX_WIDTH\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eColumnOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eposXMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e2767\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eposYMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e2767\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eposZMillimeter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e2767\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//pos.x1\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eOutPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003euint2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eoddBitOfUintTo8bitBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposXMillimeter\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eOutPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003euint2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eoddBitOfUintTo8bitBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposXMillimeter\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eOutPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003euint2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eoddBitOfUintTo8bitBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposXMillimeter\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eOutPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003euint2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eoddBitOfUintTo8bitBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposXMillimeter\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//pos.x2\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eOutPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003euint2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eevenBitOfUintTo8bitBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposXMillimeter\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eOutPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003euint2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eevenBitOfUintTo8bitBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposXMillimeter\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eOutPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003euint2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eevenBitOfUintTo8bitBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposXMillimeter\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eOutPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003euint2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eevenBitOfUintTo8bitBrightness\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposXMillimeter\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//pos.y1\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//省略\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//pos.y2\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//省略\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//pos.z1\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//省略\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//pos.z2\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//省略    \u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"unity位置姿勢ビジュアライザ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unity%E4%BD%8D%E7%BD%AE%E5%A7%BF%E5%8B%A2%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUnity（位置・姿勢ビジュアライザ）\u003c/h3\u003e\n\n\u003cp\u003eSkinned Mesh Rendererがついたオブジェクトは頂点位置を書き込みましたが、そうでない形が変わらないオブジェクトは単にオブジェクトのPositionとRotationを書き込みます。\u003cbr\u003e\nRotationはQuaternionのx,y,z,wがそれぞれ \u003ccode\u003e-1 ~ 1\u003c/code\u003e の範囲で表現されているので、\u003ccode\u003e0 ~ 1\u003c/code\u003eの範囲に正規化して8bit値で書き込みます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"リコンストラクタ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AA%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eリコンストラクタ\u003c/h2\u003e\n\n\u003cp\u003eイベントビジュアライザが生成した画像から演出・モーションを再構成します。\u003cbr\u003e\nリコンストラクタをVRChatに実装するため全てシェーダーで記述していますが、特別GPUに頼らなくてもいい場面に関してはC#で \u003ccode\u003eRenderTexture.ReadPixels()\u003c/code\u003e を使う方が素直だと思います。\u003c/p\u003e\n\n\u003cp\u003e演出は任意のシェーダーパラメータを操作する形で表現します。\u003cbr\u003e\nモーションは\u003cstrong\u003e頂点情報をテクスチャに書き込んだモデルと同じモデル\u003c/strong\u003eにアタッチしたシェーダーの頂点シェーダーで画像から頂点位置を復元します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"演出の再構成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%BC%94%E5%87%BA%E3%81%AE%E5%86%8D%E6%A7%8B%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e演出の再構成\u003c/h3\u003e\n\n\u003cp\u003e画像の特定のピクセルの色を呼んでシェーダーのパラメータを任意に操作するものです。\u003c/p\u003e\n\n\u003cp\u003eエンコード済みの動画から色を読むときは8px × 8px の四角形領域の外枠を捨てて 6px × 6pxの中心を読むと誤差が気持ち減ったような気がするのでそうしています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eReadBlock.c\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003etexelSizeX\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e1920\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003etexelSizeY\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e1080\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// value1 rowとcolumnで指定された8*8正方形の1ブロックを読む\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 中心6*6を読んでとりあえず合計する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efloat2\u003c/span\u003e \u003cspan class=\"n\"\u003eaddress\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efloat2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 8pxで1ブロックなのでrow*8, ブロック内の外周は捨てる方が精度が高いと思われる\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_row\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003etexelSizeX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_column\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003etexelSizeY\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecolor\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003etex2Dlod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_valueTex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaddress\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eaddress\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 合計を36で割って平均化する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecolor\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e36\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e2ブロックから16bit値を読みたい時は下記のようなコードを用いました（単にビット演算です）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eUnpack.c\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"nf\"\u003eunpackUintFromDoubleFloat4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efloat4\u003c/span\u003e \u003cspan class=\"n\"\u003eoneSecond\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e \u003cspan class=\"n\"\u003etwoSecond\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 8bitの値 oneSecond = 0bxxxxxxxx と twoSecond = 0byyyyyyyy を合わせて 16bit goal = 0bxyxyxyxyxyxyxyxy にする\u003c/span\u003e\n    \u003cspan class=\"n\"\u003euint4\u003c/span\u003e \u003cspan class=\"n\"\u003eoS\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003euint4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoneSecond\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e255\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003euint4\u003c/span\u003e \u003cspan class=\"n\"\u003etS\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003euint4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etwoSecond\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e255\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e32\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e128\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e16\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e512\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e32\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e32\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e2048\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e64\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e64\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e8192\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e128\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e128\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e32768\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e16\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e64\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e16\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e256\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e32\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e32\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e1024\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e64\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e64\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e4096\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e128\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e128\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e16384\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efirstGoal\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003esecondGoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egoal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e読んだ色の色相値を使ってオブジェクトを円周上に動かす演出例です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003evert.c\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// vertシェーダ内\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//------RGB to HSV -------\u003c/span\u003e\n\u003cspan class=\"n\"\u003efloat3\u003c/span\u003e \u003cspan class=\"n\"\u003ehsv\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ergb2hsv\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecolor\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//------------------------\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003erad\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eradians\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehsv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"mi\"\u003e360\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003ecos\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erad\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003esin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erad\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//------------------------\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003ev2f\u003c/span\u003e \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUnityObjectToClipPos\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTRANSFORM_TEX\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e_MainTex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eUNITY_TRANSFER_FOG\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"モーションの再構成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%86%8D%E6%A7%8B%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eモーションの再構成\u003c/h3\u003e\n\n\u003cp\u003e各頂点の位置をテクスチャから読んだ位置に差し替えます\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003evert.c\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eappdata\u003c/span\u003e \u003cspan class=\"nf\"\u003evert\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eappdata\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003evid\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSV_VertexID\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// テクスチャから値を取ってくるところは演出と同じため省略\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 16bitの0~65536の値を-3.2767m ~ 3.2767mの元の位置情報に直す\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eposX\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eunpackUintFromDoubleFloat4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoneSecondPosX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etwoSecondPosX\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e2767\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eposY\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eunpackUintFromDoubleFloat4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoneSecondPosY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etwoSecondPosY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e2767\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eposZ\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eunpackUintFromDoubleFloat4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoneSecondPosZ\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etwoSecondPosZ\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e2767\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003efloat3\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efloat3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eposY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eposZ\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eappdata\u003c/span\u003e \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 頂点位置をテクスチャから読み込んだものに差し替える\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003exyz\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"エンコードノイズの弊害\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E3%83%8E%E3%82%A4%E3%82%BA%E3%81%AE%E5%BC%8A%E5%AE%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eエンコードノイズの弊害\u003c/h4\u003e\n\n\u003cp\u003eエンコードによる劣化がなければ上記コードだけで綺麗に復元できます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/4b8f0aa6646eb1e460f4917279981c446f836d4e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f30346235393965622d623761392d366330662d616131352d3737666163636239643035302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F04b599eb-b7a9-6c0f-aa15-77faccb9d050.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c486ab716aadf0034622a2f952aba77a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/04b599eb-b7a9-6c0f-aa15-77faccb9d050.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F04b599eb-b7a9-6c0f-aa15-77faccb9d050.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=dabce9abe0fa4df4e7ce0d8f847ba0e2 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n（左がテクスチャから復元したメッシュ、右が元のアバター）\u003c/p\u003e\n\n\u003cp\u003eが、実際にはエンコードによって情報が激しく劣化するので、エンコード済み映像をそのまま読むとこんな感じになります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/5ba55f339149f4a460a1fbf5a2815afe4e926234/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f37646162653336372d333666302d646630372d363931652d3337616539623366346130362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F7dabe367-36f0-df07-691e-37ae9b3f4a06.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b4ccb693dcf84e870219872696fbef36\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/7dabe367-36f0-df07-691e-37ae9b3f4a06.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F7dabe367-36f0-df07-691e-37ae9b3f4a06.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=78ee21370c30558411749f5916101325 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eいくつかの頂点位置が吹き飛んだ値になってしまったためにその頂点を含むポリゴンが全体を覆い隠すサイズになってしまっています。\u003cbr\u003e\nすべての頂点位置がおかしくなっているのではなく、中にはいくらか正常なポリゴンも存在します\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"エンコードノイズ対策\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E3%83%8E%E3%82%A4%E3%82%BA%E5%AF%BE%E7%AD%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eエンコードノイズ対策\u003c/h4\u003e\n\n\u003cp\u003eそのため、明らかに外れ値な値をジオメトリシェーダでフィルタリングします。（あまりいい解決方法ではないですが……）\u003cbr\u003e\n下記の3条件でフィルタリングしました。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eポリゴン内の辺の比が極端に異なる\u003c/li\u003e\n\u003cli\u003e頂点間の距離が離れすぎている\u003c/li\u003e\n\u003cli\u003e頂点が使わなさそうな位置にいる\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e実際のコードが以下になります（値を直書きするのはやめましょう……）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eFilter.c\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003emaxvertexcount\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003egeom\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etriangle\u003c/span\u003e \u003cspan class=\"n\"\u003eappdata\u003c/span\u003e \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003einout\u003c/span\u003e \u003cspan class=\"n\"\u003eTriangleStream\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eg2f\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003etriStream\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// このポリゴンを省くか？のフラグ\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisBug\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 今見ている三角ポリゴンの各辺の長さを取得します\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003esideLength0to1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003esideLength1to2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003esideLength2to0\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003erateThreshold\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// フィルター：辺の比がおかしかったら消す\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eisBug\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esideLength0to1\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esideLength1to2\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003erateThreshold\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esideLength1to2\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esideLength2to0\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003erateThreshold\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esideLength2to0\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esideLength0to1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003erateThreshold\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eisBug\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// フィルター：ある頂点間の距離がx[m]以上あったら\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003ethreshold\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eisBug\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esideLength0to1\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ethreshold\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esideLength1to2\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ethreshold\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esideLength2to0\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ethreshold\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eisBug\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// フィルター：頂点が範囲外なら\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eappdata\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eisBug\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \n        \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eisBug\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eunroll\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 頂点シェーダからもらった3頂点それぞれを射影変換して通常のレンダリングと同様にポリゴン位置を決める\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eappdata\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eIN\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eg2f\u003c/span\u003e \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// isBugフラグがあれば頂点位置を原点に飛ばす（discardでよさそう）\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eisBug\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUnityObjectToClipPos\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUnityObjectToWorldNormal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etriStream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eフィルタリングした結果多少は原型をとどめた形になりました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/656d444ee3e3778e105b0e2800c19090d4b15623/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f65363135313034362d333938382d353534362d643636312d3336383864373934663439622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe6151046-3988-5546-d661-3688d794f49b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ddd342c6bad91bbcd1b5fb96f7989130\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/e6151046-3988-5546-d661-3688d794f49b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe6151046-3988-5546-d661-3688d794f49b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=541fb4ad94d4e681998acf7f75576f0c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"位置姿勢の再構成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%8D%E7%BD%AE%E5%A7%BF%E5%8B%A2%E3%81%AE%E5%86%8D%E6%A7%8B%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e位置・姿勢の再構成\u003c/h3\u003e\n\n\u003cp\u003eSkinned Mesh Rendererでないオブジェクトの位置・姿勢を再構成する際はこちらを用います。\u003cbr\u003e\nShader内で画像から読んだQuaternion値を用いてオブジェクトを回転させます。\u003cbr\u003e\nオブジェクトのローカル座標系における原点から各頂点までのベクトルをそれぞれQuaternionで回転させることでオブジェクトの回転を表現します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003erotateWithQuaternion.c\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003efloat4\u003c/span\u003e \u003cspan class=\"nf\"\u003equatenionAxQuaternionB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efloat4\u003c/span\u003e \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eqa\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eqb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003ev2f\u003c/span\u003e \u003cspan class=\"nf\"\u003evert\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eappdata\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003evid\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSV_VertexID\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// -----------省略-------------\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e \u003cspan class=\"n\"\u003equaternion\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eqx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eqy\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eqz\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eqw\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e \u003cspan class=\"n\"\u003econjugateQ\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eqx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eqy\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eqz\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eqw\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 共役\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e \u003cspan class=\"n\"\u003evertAsQ\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003efloat4\u003c/span\u003e \u003cspan class=\"n\"\u003erotatedPos\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003equatenionAxQuaternionB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003equatenionAxQuaternionB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003equaternion\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evertAsQ\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003econjugateQ\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ev2f\u003c/span\u003e \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUnityObjectToClipPos\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erotatedPos\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"解釈不一致-の運用\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E9%87%88%E4%B8%8D%E4%B8%80%E8%87%B4-%E3%81%AE%E9%81%8B%E7%94%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e#解釈不一致 の運用\u003c/h1\u003e\n\n\u003cp\u003eここからは、Omnipresence Liveを用いてどのようにライブ「#解釈不一致」を運用したかについて記載します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e概要\n\n\u003cul\u003e\n\u003cli\u003e筆者の所属する2人組アーティスト「memex」のVRライブ\n\n\u003cul\u003e\n\u003cli\u003e制作チーム：\n\n\u003cul\u003e\n\u003cli\u003ememex\n\n\u003cul\u003e\n\u003cli\u003eアラン(\u003ca href=\"https://twitter.com/memex_aran\" rel=\"nofollow noopener\" target=\"_blank\"\u003e@memex_aran\u003c/a\u003e)：ボーカル\u003c/li\u003e\n\u003cli\u003eぴぼ（筆者）(\u003ca href=\"https://twitter.com/memex_pibo\" rel=\"nofollow noopener\" target=\"_blank\"\u003e@memex_pibo\u003c/a\u003e)：ギター\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eワールド・エフェクトデザイン\n\n\u003cul\u003e\n\u003cli\u003eMikipom（\u003ca href=\"https://twitter.com/cakemas0227\" rel=\"nofollow noopener\" target=\"_blank\"\u003e@cakemas0227\u003c/a\u003e）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e2人は遠隔地の自宅からリアルタイムでセッション\u003c/li\u003e\n\u003cli\u003e演奏しながらモーションキャプチャも行う\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eVRChatの複数インスタンスで同時にmemexのライブが行われる\n\n\u003cul\u003e\n\u003cli\u003eインスタンスとは空間の単位。通常、ユーザーは同時に1つのインスタンスにしか参加できない。1インスタンスに入れる人数には制限（多くて60くらい）があるので、複数インスタンスで参加可能＝人数制限がないということ。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"解釈不一致の解説トピック-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E9%87%88%E4%B8%8D%E4%B8%80%E8%87%B4%E3%81%AE%E8%A7%A3%E8%AA%AC%E3%83%88%E3%83%94%E3%83%83%E3%82%AF-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「#解釈不一致」の解説トピック\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e生歌とギターの生演奏による遠隔セッション\u003c/li\u003e\n\u003cli\u003e楽曲を構成するトラック毎に反応するパラオーディオリアクティブな空間演出\u003c/li\u003e\n\u003cli\u003e生演奏を含む音楽の特定のタイミングで発火する演出イベント管理\u003c/li\u003e\n\u003cli\u003e遠隔モーションキャプチャ\u003c/li\u003e\n\u003cli\u003eギターの生演奏とギターモーション収録の両立\u003c/li\u003e\n\u003cli\u003eツイートのVR空間へのリアルタイム表示\u003c/li\u003e\n\u003cli\u003e遠隔モーション収録時の返しモニタ\u003c/li\u003e\n\u003cli\u003eAWSによる専用映像ストリーミングサーバ構築\u003c/li\u003e\n\u003cli\u003eVRChatへのOmnipresence Liveリコンストラクタの実装\u003c/li\u003e\n\u003cli\u003eVRChat上での空間編集機能\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"システム構成図\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E6%A7%8B%E6%88%90%E5%9B%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシステム構成図\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/d0245a0a445e1bc45e8316e3d87c3e03bdea9844/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f36313561333238372d316131652d383662362d623132612d3864643461393038306635382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F615a3287-1a1e-86b6-b12a-8dd4a9080f58.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=aa4d95c9fd54b8d944897c813f1935f1\" alt=\"fuitch (3).png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/615a3287-1a1e-86b6-b12a-8dd4a9080f58.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F615a3287-1a1e-86b6-b12a-8dd4a9080f58.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fbe09f091f25a443bfb30f176b9fa8dd 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"配信音声について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%85%8D%E4%BF%A1%E9%9F%B3%E5%A3%B0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e配信音声について\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/845a1c8b950d660c5481ebead1abb56868d919c9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f31656331663830342d383437352d333763362d323563362d6261653137633831336163392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F1ec1f804-8475-37c6-25c6-bae17c813ac9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=726a9dfc0a8250f5e46739c0d22ce7ea\" alt=\"audio.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/1ec1f804-8475-37c6-25c6-bae17c813ac9.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F1ec1f804-8475-37c6-25c6-bae17c813ac9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=db32179f6079fd6587edae06ed9bb24a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e遠隔地の演奏者と低遅延でセッションできる\u003ca href=\"https://www.netduetto.net/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNETDUETTO\u003c/a\u003eを使って遠隔セッションした音声を配信しました。\u003cbr\u003e\nギタリスト側のDAWで伴奏を流しながらギターを演奏し、その音声をNETDUETTOでボーカル側に送ります。\u003cbr\u003e\nボーカル側はその伴奏とギターを聴きながら歌い、その音声をNETDUETTOでギタリスト側に送ります。\u003cbr\u003e\nNETDUETTOはセッションのミックス結果を仮想オーディオ入力デバイスとして出力できる機能があり、これを用いて配信ソフトウェアである\u003ca href=\"https://obsproject.com/ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOBS Studio\u003c/a\u003eに入力します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"オーディオリアクティブ演出\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AA%E3%83%BC%E3%83%87%E3%82%A3%E3%82%AA%E3%83%AA%E3%82%A2%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E6%BC%94%E5%87%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eオーディオリアクティブ演出\u003c/h2\u003e\n\n\u003cp\u003e下の映像は、ドラムのキック2回→ドラムのスネア→ギターという順序で音が鳴った時の空間演出です。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/03e5e859308339e7935066945600a407774255e9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f34303032336266302d346435652d373761322d626131352d3732396363376265306631362e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F40023bf0-4d5e-77a2-ba15-729cc7be0f16.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b1d82aab9ce159816930ad6e4a95d37e\" alt=\"audioreactive.gif\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/40023bf0-4d5e-77a2-ba15-729cc7be0f16.gif\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F40023bf0-4d5e-77a2-ba15-729cc7be0f16.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=aa33907383ee0ec867361ce9049387fe 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこのような楽曲を構成する各パートの音に反応する演出を作るために、先述のイベントビジュアライザを用いて各パートの音量を色の明るさで表現して映像として配信しました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/bae78976cfdc7e6ae6effa2986e2824b2f2d224e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f65343162316134632d393161622d653562352d373537332d6336353332613861616433382e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe41b1a4c-91ab-e5b5-7573-c6532a8aad38.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=db5659094644d063b3c24b211e546a38\" alt=\"audioEventVZoom.gif\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/e41b1a4c-91ab-e5b5-7573-c6532a8aad38.gif\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fe41b1a4c-91ab-e5b5-7573-c6532a8aad38.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f978a7b309ed89ba8465d5db6bfe6cc6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n左から順に下記トラックに反応しています。\u003cbr\u003e\n1. キック\u003cbr\u003e\n2. スネア\u003cbr\u003e\n3. ハット\u003cbr\u003e\n4. ギター（生演奏）：ピッチ含む\u003cbr\u003e\n5. ベース：ピッチ含む\u003cbr\u003e\n6. 曲毎に任意に差し替える目立つ音\u003cbr\u003e\n7. 曲毎に任意に差し替える目立たない音\u003cbr\u003e\n8. ボーカル（生歌）：ピッチ含む\u003cbr\u003e\n9. ハモリ・コーラス\u003c/p\u003e\n\n\u003cp\u003eなお、上から順に下記用途で4種類の出力をしています。\u003cbr\u003e\n1. 音量の値そのまま\u003cbr\u003e\n2. 音量の値を使い、減衰はゆるやかにしたもの\u003cbr\u003e\n3. 音量の値が累積されていくもの（音を鳴らす度に明るくなって最大になると黒からやりなおし）\u003cbr\u003e\n4. ピッチを取得しやすいよう輝度最大で固定して表示したもの\u003c/p\u003e\n\n\u003cp\u003e予め送信するトラック数と役割を定めておくことで、ワールド・エフェクトをデザインして頂いたMikipomさんとのやりとりが円滑になるようにしました。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"前提\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E6%8F%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前提\u003c/h3\u003e\n\n\u003cp\u003e各パートに反応する演出を作るためには、各パートがバラバラになったパラデータが必要になります。\u003cbr\u003e\n今回は自分達の楽曲のため各パートの音源を簡単に用意できましたが、そうでない場合も\u003ccode\u003eiZotope RX7\u003c/code\u003eといったツールを用いることである程度パートを分離した音声を用意できると思います。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ルーティング\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eルーティング\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/fe638ea826216b7d6559b4fef76c3e85a37ef8c1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f36353864616236372d343230632d646564382d636363612d6434343139356339386433342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F658dab67-420c-ded8-ccca-d44195c98d34.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=151d720c54d34786d6228c876fdb1652\" alt=\"audioOSC.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/658dab67-420c-ded8-ccca-d44195c98d34.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F658dab67-420c-ded8-ccca-d44195c98d34.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c6678fbaf652d669d223b5c22ccabc70 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nNETDUETTOのVSTプラグインでは各演奏者の音声をバラバラに出力する機能があるため、これを用いて遠隔地のボーカルトラック単体を抜き出しています。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ableton-live上での設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ableton-live%E4%B8%8A%E3%81%A7%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAbleton Live上での設定\u003c/h3\u003e\n\n\u003cp\u003eAbleton Live Suiteの各トラックに、音は出力されない状態で各パートの音声を読み込みます。\u003cbr\u003e\n音が出力されるのは、別途用意した各パートが混ざった伴奏音声、リアルタイムに入力する歌とギターのトラックのみです。\u003cbr\u003e\nそれぞれのトラックに音量をOSCに変換して送信するMax for Liveプラグインを挿すことで、それぞれのトラックから音量の値がOSCで送信されます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f3e3111976747d3d2ef14455229572fb436ad213/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f31383965326634312d313138302d306565342d623131312d3665323234356561333866352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F189e2f41-1180-0ee4-b111-6e2245ea38f5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d0faa1f57cc37b777570437057710613\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/189e2f41-1180-0ee4-b111-6e2245ea38f5.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F189e2f41-1180-0ee4-b111-6e2245ea38f5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=64ab9ac4d7eace08dd26e5f387864e40 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"演出イベントの管理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%BC%94%E5%87%BA%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E7%AE%A1%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e演出イベントの管理\u003c/h2\u003e\n\n\u003cp\u003e下の映像は、ライブの開始SEが終了して1曲目のイントロが始まり、ワールドそのものが出現する演出です。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/7f6392af8edefac56a69dc994e622911904509e0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f66376130626230632d393666622d343164392d383134382d3861356537316137323935322e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Ff7a0bb0c-96fb-41d9-8148-8a5e71a72952.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=271cb42496b742f3ba543586aed9cf4d\" alt=\"phantom.gif\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/f7a0bb0c-96fb-41d9-8148-8a5e71a72952.gif\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Ff7a0bb0c-96fb-41d9-8148-8a5e71a72952.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0e63389fa8187511692946de03cd0bba 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこのように、オーディオリアクティブな要素とは別に、曲中の特定のタイミングに合わせて演出を行うために、Ableton Liveのタイムライン上に演出イベントのトリガーを配置しました。\u003cbr\u003e\nトリガーはMIDI Note・MIDI Pitch BendをOSCに変換し、OSCをイベントビジュアライザで映像に載せることで演出イベントを発火させます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"制作から実際に再生されるまでの流れ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%B6%E4%BD%9C%E3%81%8B%E3%82%89%E5%AE%9F%E9%9A%9B%E3%81%AB%E5%86%8D%E7%94%9F%E3%81%95%E3%82%8C%E3%82%8B%E3%81%BE%E3%81%A7%E3%81%AE%E6%B5%81%E3%82%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e制作から実際に再生されるまでの流れ\u003c/h3\u003e\n\n\u003col\u003e\n\u003cli\u003eデザイン担当のMikipomさんが演出要素をShader Onlyで作る\u003c/li\u003e\n\u003cli\u003eデザイン担当のMikipomさんがUnityのTimelineで曲に合わせてシェーダパラメータを操作したデモを作る\u003c/li\u003e\n\u003cli\u003eTimelineを元にどのタイミングでどのパラメータをどの値に動かしたいかという進行表を作る\n\n\u003col\u003e\n\u003cli\u003eパラメータは\u003ccode\u003e0~1\u003c/code\u003eの範囲で表現できるようにしておく\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e動かしたいパラメータをそれぞれMIDI Note Num（ドレミファソラシド…）に割り当てる\u003c/li\u003e\n\u003cli\u003e進行表を元に筆者がAbleton Live上にパラメータを操作するためのMIDI Noteを配置していく\u003c/li\u003e\n\u003cli\u003eそれぞれのMIDI Note上でMIDI Pitch Bendを用いて0~1のパラメータを表現する\u003c/li\u003e\n\u003cli\u003eOSCでMIDI Note NumとPitch Bendを送信する\u003c/li\u003e\n\u003cli\u003eイベントビジュアライザを用いてパラメータをそれぞれ異なるピクセル上に色で表す\u003c/li\u003e\n\u003cli\u003eワールドに配置されたシェーダー側で特定のピクセルの色を読んで演出を再生する\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"進行表\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%80%B2%E8%A1%8C%E8%A1%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e進行表\u003c/h3\u003e\n\n\u003cp\u003eいつ、どのマテリアルのどのパラメータをどこまで動かすかという進行表です。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/68b259174fa13258c9556506878d4b9940a06448/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f38613439303962382d376631612d383934332d343866302d3437373738346231396566352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F8a4909b8-7f1a-8943-48f0-477784b19ef5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c482fad00cc2a2e2e2af0151412e6c0d\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/8a4909b8-7f1a-8943-48f0-477784b19ef5.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F8a4909b8-7f1a-8943-48f0-477784b19ef5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=53b6341c71436079847cfd80ce1fe3d8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"演出イベント管理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%BC%94%E5%87%BA%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E7%AE%A1%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e演出イベント管理\u003c/h3\u003e\n\n\u003cp\u003e動かしたいパラメータの数だけトラックを用意しました。\u003cbr\u003e\n曲の特定のタイミングに合わせてMIDI Noteが配置されています。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/2411c9688069298e84d4ff3a80d6b7d50e968eb2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f35383962636162372d356466622d653661612d666163622d6133626637323065353835312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F589bcab7-5dfb-e6aa-facb-a3bf720e5851.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=133eceb4e50a1e2286da820cd75b6664\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/589bcab7-5dfb-e6aa-facb-a3bf720e5851.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F589bcab7-5dfb-e6aa-facb-a3bf720e5851.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cec4f9fb1aa0720cce881d92f812b0eb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"演出制御用midi-note\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%BC%94%E5%87%BA%E5%88%B6%E5%BE%A1%E7%94%A8midi-note\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e演出制御用MIDI Note\u003c/h3\u003e\n\n\u003cp\u003eあるオブジェクトの幅を表すパラメータを0から1まで動かすMIDI Noteです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/29775aeddb7e502ac6e37c20394434d522c8cf21/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f39393466626639352d656534632d323461322d653735382d6337343030346138393632632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F994fbf95-ee4c-24a2-e758-c74004a8962c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=86615e015c40311086b6d357f60da8fd\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/994fbf95-ee4c-24a2-e758-c74004a8962c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F994fbf95-ee4c-24a2-e758-c74004a8962c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9ee67037fde95449653426b6c0fe4381 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eNotesの欄に記載されている音階がマテリアルのパラメータに対応しています。\u003cbr\u003e\n例えば: \u003cbr\u003e\n- ラ：アーティストを表示するか否かのフラグ\u003cbr\u003e\n- シ：ワールド全体の色相\u003cbr\u003e\n- ド：床の高さ\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"モーション収録\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E5%8F%8E%E9%8C%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eモーション収録\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ボーカルモーションの遠隔収録\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9C%E3%83%BC%E3%82%AB%E3%83%AB%E3%83%A2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E9%81%A0%E9%9A%94%E5%8F%8E%E9%8C%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eボーカルモーションの遠隔収録\u003c/h3\u003e\n\n\u003cp\u003eボーカルのモーション収録は\u003ca href=\"https://sh-akira.github.io/VirtualMotionCapture/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eバーチャルモーションキャプチャー\u003c/a\u003eと\u003ca href=\"https://github.com/gpsnmeajp/EasyVirtualMotionCaptureForUnity\" rel=\"nofollow noopener\" target=\"_blank\"\u003eEVMC4U\u003c/a\u003eを用いて行いました。\u003cbr\u003e\nバーチャルモーションキャプチャーは、SteamVR対応デバイスを用いて簡単にVRMモデルのモーションキャプチャを行い、さらにそのモーションをOSCで送信することができるソフトウェアです。\u003cbr\u003e\nEVMC4Uは、バーチャルモーションキャプチャーから送られてきたモーション情報をUnity上のVRMモデルにリアルタイムに適用できるスクリプト群です。\u003cbr\u003e\nトラッキングデバイスはHTC VIVE CEとVIVE Trackerを用いました。\u003cbr\u003e\nボーカルPCからバーチャルモーションキャプチャーでモーションをOSCで筆者宅ネットワークのグローバルIPに向けて送信し、筆者PCのEVMC4Uで受け取ります。\u003cbr\u003e\nこの方法を用いると、NETDUETTOの音声と殆どズレのないモーションを再生することができます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ギターを生演奏しながらギターモーションを収録する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AE%E3%82%BF%E3%83%BC%E3%82%92%E7%94%9F%E6%BC%94%E5%A5%8F%E3%81%97%E3%81%AA%E3%81%8C%E3%82%89%E3%82%AE%E3%82%BF%E3%83%BC%E3%83%A2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E5%8F%8E%E9%8C%B2%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eギターを生演奏しながらギターモーションを収録する\u003c/h3\u003e\n\n\u003cp\u003eM5StickCをギター側、右手側で2つとiPhone11を用いて、ギターの演奏を簡易的にトラッキングします。\u003cbr\u003e\nM5StickCはディスプレイがついた、加速度センサやWi-Fi接続機能など多くの機能を持つ小型で低価格なマイコンです。\u003cbr\u003e\nM5StickCでセンシングした値をWi-Fi経由でPCに飛ばすことでアバターのモーションを表現しました。\u003c/p\u003e\n\n\u003cp\u003e画像左がギター側、画像右側が右手側のM5StickCです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e4d86ebb8c265f378280fd45642c4fdf8f199e39/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f66323561633462352d333262632d306565642d643732392d6138333535323163616234362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Ff25ac4b5-32bc-0eed-d729-a835521cab46.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3da2854350687a964cf017d033759410\" alt=\"guitarTracking2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/f25ac4b5-32bc-0eed-d729-a835521cab46.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Ff25ac4b5-32bc-0eed-d729-a835521cab46.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9f797ff6bc9f8089abba1ce64d768e84 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/6959098eef7fbccbfbe69f2f97f9c1499e6fa00b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f64386432386364302d643464352d313332322d636530362d3737326134383666633165642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fd8d28cd0-d4d5-1322-ce06-772a486fc1ed.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=128e7b978a7e7ffe55eee27ccf18ae1b\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/d8d28cd0-d4d5-1322-ce06-772a486fc1ed.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fd8d28cd0-d4d5-1322-ce06-772a486fc1ed.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2fa8a52437026236e399c5abc8e74a0f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003ca href=\"https://camo.qiitausercontent.com/ca089ca09f2ad93ccc6c9307e4a45ef70d3c135c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f65636233383934322d303733642d353239632d366266332d3533396430333536616462312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fecb38942-073d-529c-6bf3-539d0356adb1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f0169d31558f39846619e7aaaa6b3502\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/ecb38942-073d-529c-6bf3-539d0356adb1.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fecb38942-073d-529c-6bf3-539d0356adb1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2219399ba381d3c7ea7d1cfc3a459ef6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n画像左はローフレットを押さえて右下の方向を見ている筆者、画像右はハイフレットを押さえて左上の方向を見ている筆者です。\u003c/p\u003e\n\n\u003cp\u003eこれは過去にアコースティックカバー生放送を行った時に制作したものです。\u003cbr\u003e\n実際の動きは下記放送アーカイブからご覧いただけます。\u003cbr\u003e\n\u003ca href=\"https://www.youtube.com/watch?v=ijs-0veMe48\u0026amp;feature=youtu.be\u0026amp;t=2751\" rel=\"nofollow noopener\" target=\"_blank\"\u003e【memex】アコースティック歌生放送！ #めめなま 【3000人記念】 - YouTube\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ギター側\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AE%E3%82%BF%E3%83%BC%E5%81%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eギター側\u003c/h3\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"フレット\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%83%AC%E3%83%83%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eフレット\u003c/h4\u003e\n\n\u003cp\u003eギターの指板における左手の位置と、ギターの姿勢をセンシングします。\u003cbr\u003e\n左手の位置は超音波センサ（HC-SR04）、ギターの姿勢はM5StickC内蔵の加速度センサでセンシングしました。\u003c/p\u003e\n\n\u003cp\u003e超音波センサは超音波を発しそれが対象にぶつかってから帰ってくるまでの時間を音速で割ることで対象との距離を求めることができるセンサです。\u003cbr\u003e\nこれをギターのヘッド裏に取り付けることで左手の位置をざっくりと計測します。\u003cbr\u003e\n実際にギターを弾いてみるとわかりますが、抑えるポジションによっては手首はネックの真裏の高さにないこともあり、正確にトラッキングすることはできません。左手が動いていることがわかるくらいではあります。\u003cbr\u003e\nまた、上記画像からわかるように筆者のアバターの手は抽象化されているので、指のあるアバターではさらに別の対策が必要になると思われます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/3494c69a42e35ccfd89def4054a1c158318a0c0f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f35663138353764312d393539332d346339372d316664632d3036366562383464323366612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F5f1857d1-9593-4c97-1fdc-066eb84d23fa.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=eef3d7b981feb20da0a670231ba0f7b1\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/5f1857d1-9593-4c97-1fdc-066eb84d23fa.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F5f1857d1-9593-4c97-1fdc-066eb84d23fa.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=79dfddb830e2266127c2a3ebba261d62 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nFinalIKを用いてアバターの手の位置をギターの指板上に固定して動かしています。\u003cbr\u003e\nFinalIKは逆運動学を用いてアバターの手などを自然に目標の位置に到達させることができるアセットです。\u003c/p\u003e\n\n\u003cp\u003e画像の手前にある二つの白いSphereが、それぞれ「1Fを押さえているときにアバターの左手があってほしい位置」「12Fを押さえているときにアバターの左手があってほしい位置」です。\u003cbr\u003e\n左手は、2つのSphereを結んだ直線上を超音波センサの距離値に応じて移動しています。\u003c/p\u003e\n\n\u003cp\u003e実装はこのようになっています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eultrasonicAndIMUWifi.c\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#include \u0026lt;M5StickC.h\u0026gt;\n#include \u0026lt;WiFi.h\u0026gt;\n#include \u0026lt;WiFiUDP.h\u0026gt;\n#include \u0026lt;OSCMessage.h\u0026gt;\n\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e/**\n * WiFiアクセス用\n */\u003c/span\u003e\n\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003essid\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"[お使いのルーターのSSID]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003epass\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"[パスワード]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eWiFiUDP\u003c/span\u003e \u003cspan class=\"n\"\u003ewifiUdp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ekRemoteIpadr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"[受け取りたいPCのプライベートIP]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ekRmoteUdpPort\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e8001\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//送信先のポート\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ekLocalPort\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e7000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e//自身のポート\u003c/span\u003e\n\u003cspan class=\"n\"\u003eboolean\u003c/span\u003e \u003cspan class=\"n\"\u003econnected\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/**\n * HCSR-04用\n */\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eTrig\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e26\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eEcho\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e36\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eDuration\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/**\n * IMU用\n */\u003c/span\u003e\n\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003epitch\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"n\"\u003eF\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eroll\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"n\"\u003eF\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eyaw\u003c/span\u003e   \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"n\"\u003eF\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003etemp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/**\n * Setup\n */\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWiFi_setup\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eWiFi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003essid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epass\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eWiFi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eWL_CONNECTED\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e500\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e  \n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e  \n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSerial_setup\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eSerial\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e115200\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eSerial\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprintln\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// to separate line  \u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eHcsr04_setup\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epinMode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTrig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eOUTPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epinMode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEcho\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eINPUT\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003esetup\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eHcsr04_setup\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eSerial_setup\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eWiFi_setup\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eM5\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eM5\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIMU\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eloop\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/**\n   * 距離計測\n   */\u003c/span\u003e\n  \u003cspan class=\"n\"\u003edigitalWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTrig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eLOW\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003edelayMicroseconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003edigitalWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTrig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eHIGH\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003edelayMicroseconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003edigitalWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTrig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eLOW\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eDuration\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epulseIn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEcho\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eHIGH\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDuration\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDistance\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDuration\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDistance\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDistance\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"mi\"\u003e340\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mi\"\u003e1000000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ultrasonic speed is 340m/s = 34000cm/s = 0.034cm/us \u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eOSCMessage\u003c/span\u003e \u003cspan class=\"n\"\u003emsgDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"/leftHand/distance\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emsgDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ewifiUdp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebeginPacket\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekRemoteIpadr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekRmoteUdpPort\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emsgDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewifiUdp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ewifiUdp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendPacket\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n \u003cspan class=\"cm\"\u003e/**\n  * IMU計測\n  */\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eM5\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIMU\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetAhrsData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003epitch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eroll\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eyaw\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eM5\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIMU\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetTempData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003etemp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"cm\"\u003e/**\n   * OSCSend\n   */\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eOSCMessage\u003c/span\u003e \u003cspan class=\"n\"\u003emsgPitch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"/guitar/pitch\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003emsgPitch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epitch\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eOSCMessage\u003c/span\u003e \u003cspan class=\"n\"\u003emsgRoll\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"/guitar/roll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003emsgRoll\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroll\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eOSCMessage\u003c/span\u003e \u003cspan class=\"n\"\u003emsgYaw\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"/guitar/yaw\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003emsgYaw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eyaw\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\n  \u003cspan class=\"n\"\u003ewifiUdp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebeginPacket\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekRemoteIpadr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekRmoteUdpPort\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003emsgPitch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewifiUdp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ewifiUdp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendPacket\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \n\n  \u003cspan class=\"n\"\u003ewifiUdp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebeginPacket\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekRemoteIpadr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekRmoteUdpPort\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003emsgRoll\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewifiUdp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ewifiUdp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendPacket\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \n\n  \u003cspan class=\"n\"\u003ewifiUdp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebeginPacket\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekRemoteIpadr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekRmoteUdpPort\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003emsgYaw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewifiUdp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ewifiUdp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendPacket\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \n\n  \u003cspan class=\"n\"\u003edelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e33\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"ギター姿勢\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AE%E3%82%BF%E3%83%BC%E5%A7%BF%E5%8B%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eギター姿勢\u003c/h4\u003e\n\n\u003cp\u003eM5StickCの加速度センサを用いて、ギターの姿勢を特定の軸に限って表現します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/d36b0e143ea9bcb84bd10610b84459bd0b9e7886/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f61353537633239312d323135632d323064622d366632322d3734346339646333316666642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fa557c291-215c-20db-6f22-744c9dc31ffd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0162d55283f311ada527275a6c340aeb\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/a557c291-215c-20db-6f22-744c9dc31ffd.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fa557c291-215c-20db-6f22-744c9dc31ffd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b16a9f4ef53358bc8869e33078439829 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003ca href=\"https://camo.qiitausercontent.com/19e00b3ad6105c3ae851ee9993ce6cb9f10377e3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f61623130663133392d363537382d343664342d303934332d3665623165616332633732302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fab10f139-6578-46d4-0943-6eb1eac2c720.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=235345fff27afb33eb368508a148c0f7\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/ab10f139-6578-46d4-0943-6eb1eac2c720.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fab10f139-6578-46d4-0943-6eb1eac2c720.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cf2b2b2f9df8e900fe18cc0e59bc16cb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e加速度センサはスマートフォンの縦持ち、横持ちなどを判定する際に使われているセンサーで、デバイスの姿勢をある程度正確に計測することができます。（重力が影響しない軸の回転が計測できません）\u003cbr\u003e\nギターが地面に対してどの程度垂直かもしくは平行か、を角度で計測して、ギターのrotationに適用しています。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"右手側\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%B3%E6%89%8B%E5%81%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e右手側\u003c/h3\u003e\n\n\u003cp\u003eM5StickCの加速度センサを用いて、ギターをピッキングする動きを表現します。\u003cbr\u003e\n仕組みはギター姿勢と同じです。\u003cbr\u003e\nFinalIKでアバターの右手をギターのピックアップ上に配置し、rotationだけを操作しています。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"頭\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%A0%AD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e頭\u003c/h3\u003e\n\n\u003cp\u003eiPhone 11に搭載されているFaceTrackingを使ってアバターの頭と腰を動かしています。\u003cbr\u003e\niPhoneアプリ「ZIG SIM Pro」を用いてFaceTrackingのパラメータをOSCでPCに送信しています。\u003cbr\u003e\nZIG-Project \u003ca href=\"https://zig-project.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://zig-project.com/\u003c/a\u003e \u003c/p\u003e\n\n\u003cp\u003eFaceTrackingのパラメータから顔の姿勢をあらわす\u003ccode\u003efacerotation\u003c/code\u003eを抜き出しアバターのHeadボーン、Spineボーンに適用しています。\u003cbr\u003e\n首から下が固定されていて頭だけ動いているのが若干不自然だったので腰も同時に動かしています。\u003c/p\u003e\n\n\u003cp\u003e実装はこんな感じです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOSCHeadAndSpineRotator.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eOSCHeadAndSpineRotator\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonoBehaviour\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003epitch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eroll\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eyaw\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euuid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"[ZIG SIM内で確認できるデバイスID]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eAnimator\u003c/span\u003e \u003cspan class=\"n\"\u003eanimator\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eTransform\u003c/span\u003e \u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003espine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e \u003cspan class=\"n\"\u003einitalRotationl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eheadInitialLocalRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003espineInitialLocalRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epreHeadLocalRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epreSpineLocalRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003eeularRotationOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eslerpRate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e10f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003euOscServer\u003c/span\u003e \u003cspan class=\"n\"\u003eserver\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eserver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eonDataReceived\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOnDataReceived\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eanimator\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eAnimator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ehead\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eanimator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBoneTransform\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHumanBodyBones\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHead\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003espine\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eanimator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBoneTransform\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHumanBodyBones\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSpine\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eheadInitialLocalRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elocalRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003espineInitialLocalRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003espine\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elocalRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnDataReceived\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaddress\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"/ZIGSIM/\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003euuid\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"/facerotation\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e \u003cspan class=\"n\"\u003eq\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eQuaternion\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e()),\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e()),\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e()),\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ethisFrameHeadLocalRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSlerp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epreHeadLocalRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eheadInitialLocalRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eq\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEuler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eeularRotationOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeltaTime\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eslerpRate\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ethisFrameSpineLocalRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSlerp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epreSpineLocalRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003espineInitialLocalRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eq\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEuler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eeularRotationOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeltaTime\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eslerpRate\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 取得した回転の8割くらい頭を回転させ、4割くらい腰を回転させます（この値は好み）\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elocalRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLerp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eheadInitialLocalRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ethisFrameHeadLocalRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0.8f\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003espine\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elocalRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLerp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003espineInitialLocalRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ethisFrameSpineLocalRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0.4f\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003epreHeadLocalRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ethisFrameHeadLocalRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003epreSpineLocalRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ethisFrameSpineLocalRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"vr空間へのツイートのリアルタイム表示\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#vr%E7%A9%BA%E9%96%93%E3%81%B8%E3%81%AE%E3%83%84%E3%82%A4%E3%83%BC%E3%83%88%E3%81%AE%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E8%A1%A8%E7%A4%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVR空間へのツイートのリアルタイム表示\u003c/h2\u003e\n\n\u003cp\u003e配信映像に直接ツイート本文を載せ、リコンストラクタ側でその画像に透過処理をかけて空間に画像として表示しています。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/88f35a2bba6c69f1371af66826ce635e885ebb29/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f61373639303765372d383138642d326464362d656439382d6266636331386533363834332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fa76907e7-818d-2dd6-ed98-bfcc18e36843.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2ee49e85778a057599429748152807a0\" alt=\"VRChat_1920x1080_2020-05-30_14-52-00.522.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/a76907e7-818d-2dd6-ed98-bfcc18e36843.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fa76907e7-818d-2dd6-ed98-bfcc18e36843.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c8f1aca2016312ae614e62608b54eeb7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eUnityでTwitter APIを利用するためのTwityというライブラリを用いてハッシュタグツイートを約10秒間隔で更新しました。\u003cbr\u003e\nGitHub - toofusan/Twity: Twitter API Client for Unity C# (ex-name: twitter-for-unity) \u003ca href=\"https://github.com/toofusan/Twity\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/toofusan/Twity\u003c/a\u003e \u003cbr\u003e\nテキストはディスプレイに直接Canvasで表示しています。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/8d55fdff72a22b9ed60093b227e432aba70b4c00/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f37323063333663342d643430612d646266622d616239642d6639366561353539346165622e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F720c36c4-d40a-dbfb-ab9d-f96ea5594aeb.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0aec6e0c0b69cdf256f5b46fadfae157\" alt=\"tweet150.gif\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/720c36c4-d40a-dbfb-ab9d-f96ea5594aeb.gif\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F720c36c4-d40a-dbfb-ab9d-f96ea5594aeb.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bcc39649063c108edfe58f1327672f0c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e出現アニメーションはリコンストラクタ側でつけることもできますが、リコンストラクタ側に状態を持たせたくなかったので、配信映像に載せる前の段階でアニメーションをつけました。\u003cbr\u003e\n文字アニメーションにはText Juicerというプラグインを用いました。\u003cbr\u003e\nGitHub - badawe/Text-Juicer: Simple tool to create awesome text animations \u003ca href=\"https://github.com/badawe/Text-Juicer\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/badawe/Text-Juicer\u003c/a\u003e \u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"返しモニタ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%BF%94%E3%81%97%E3%83%A2%E3%83%8B%E3%82%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e返しモニタ\u003c/h2\u003e\n\n\u003cp\u003eアバターの姿とUnityのコンソール出力を確認できる返しモニタを用意します。\u003cbr\u003e\n主に下記2点の目的で返しモニタが必要でした。\u003cbr\u003e\n- 意図通りのモーションが反映されているか確認するため\u003cbr\u003e\n- ライブのMC時間にツイートを読み上げるため\u003c/p\u003e\n\n\u003cp\u003eUnityのマルチディスプレイ機能を用いて、配信用テクスチャを表示するウィンドウと別のウィンドウとして画面に表示します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/8b64c765c9d982c3df6eba2446b54a481a6d0c05/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f36656336306465392d336535342d353638372d663635312d3438366637373765343364342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F6ec60de9-3e54-5687-f651-486f777e43d4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3136397ad67efe7302f02ca522a9aa4b\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/6ec60de9-3e54-5687-f651-486f777e43d4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F6ec60de9-3e54-5687-f651-486f777e43d4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f6202969f5565138964cc307a1141dae 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eライブ中自分達のアバターのモーションがどのようになっているか、またどんなツイートが観客側に表示されているかを一目で確認できるように、アバター表示に重ねてコンソール出力をCanvasに表示しています。\u003c/p\u003e\n\n\u003cp\u003eコンソール出力を表示する実装はこちらの記事を参考にしました。\u003cbr\u003e\n【Unity】ゲーム画面にDebug.Logを出したい！ - うら干物書き \u003ca href=\"https://www.urablog.xyz/entry/2017/04/25/195351\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.urablog.xyz/entry/2017/04/25/195351\u003c/a\u003e \u003c/p\u003e\n\n\u003cp\u003e返しモニタウィンドウをボーカルのPCにDiscordの画面共有で送ることで、同じ返しモニタを共有できるようにしています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"hlsサーバー\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#hls%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHLSサーバー\u003c/h2\u003e\n\n\u003cp\u003e諸々の事情を考慮して映像はAWSで構築した専用のストリーミングサーバーから配信しました。\u003cbr\u003e\n構成は下記の通りです。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/a40dbbe14b625b071c91228e10a02cc624925b6d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f39366135376562302d323130622d613633372d363532382d6264343830393464366430612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F96a57eb0-210b-a637-6528-bd48094d6d0a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d21b1b52dcd2811bdd06ba68f34a4925\" alt=\"aws.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/96a57eb0-210b-a637-6528-bd48094d6d0a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2F96a57eb0-210b-a637-6528-bd48094d6d0a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4fb7c149a749c4acfd3e0ce4dae60d31 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e下記記事を参考にして殆どその通りの手順で進め、4時間程度で動作確認までできました。（AWSすごい）\u003cbr\u003e\nOBSとAWS Elemental MediaLiveでライブ配信をしてみた | Developers.IO \u003ca href=\"https://dev.classmethod.jp/articles/live-aws-elemental-medialive-with-obs/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://dev.classmethod.jp/articles/live-aws-elemental-medialive-with-obs/\u003c/a\u003e \u003cbr\u003e\nMediaPackage で Amazon CloudFront を使用する - AWS Elemental MediaPackage \u003ca href=\"https://docs.aws.amazon.com/ja_jp/mediapackage/latest/ug/cdns-cf.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.aws.amazon.com/ja_jp/mediapackage/latest/ug/cdns-cf.html\u003c/a\u003e \u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"vrchat上で再生可能にする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#vrchat%E4%B8%8A%E3%81%A7%E5%86%8D%E7%94%9F%E5%8F%AF%E8%83%BD%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVRChat上で再生可能にする\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eリコンストラクタのシェーダで表現されたライブに必要なオブジェクトをワールドに配置する\n\n\u003cul\u003e\n\u003cli\u003eアーティストのモデル、ステージ、GPUパーティクルなど\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eVRChat SDKのコンポーネント\u003ccode\u003eVRC_SyncVideoStream\u003c/code\u003eを用いてCloudFrontで配信しているHLS映像のURLにアクセス\u003c/li\u003e\n\u003cli\u003e映像をワールド内に配置したカメラで撮影し1920 * 1080のRenderTextureに書き込む\u003c/li\u003e\n\u003cli\u003e各オブジェクトのマテリアルのテクスチャとして3のRenderTextureを指定する\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"vrchat上で空間編集を可能にする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#vrchat%E4%B8%8A%E3%81%A7%E7%A9%BA%E9%96%93%E7%B7%A8%E9%9B%86%E3%82%92%E5%8F%AF%E8%83%BD%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVRChat上で空間編集を可能にする\u003c/h2\u003e\n\n\u003cp\u003e下の映像のように、だいたいのオブジェクトを手で掴んで再配置できるようにしました。\u003cbr\u003e\n同じインスタンスにいる観客同士のみに反映されます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/5600054f49b984066650176647b0aa614df0900a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3534363039332f61353238636432302d323165352d613430652d326563392d3735346335613336306135392e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fa528cd20-21e5-a40e-2ec9-754c5a360a59.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=324b59edd956c53311501b803a10a222\" alt=\"pickup.gif\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/a528cd20-21e5-a40e-2ec9-754c5a360a59.gif\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fa528cd20-21e5-a40e-2ec9-754c5a360a59.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e0ea5dd9d4302d74287fc9c881c3d740 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n- オブジェクトにVRChat SDKのコンポーネント\u003ccode\u003eVRC_Pickup\u003c/code\u003eをつける\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"大変だったこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%A4%A7%E5%A4%89%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e大変だったこと\u003c/h1\u003e\n\n\u003cp\u003e解説は以上です。制作して大変だったことをメモしておきます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"シェーダーむずかしい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%82%80%E3%81%9A%E3%81%8B%E3%81%97%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシェーダーむずかしい\u003c/h2\u003e\n\n\u003cp\u003eシェーダーでアニメーションさせるVATというものを使ったらモーションを画像で表現できるらしい、と聞いてシェーダーを調べ始めたものの、全然理解できなかった\u003cbr\u003e\n- これがなかったら1行も読めるようにならなかったと思う\u003cbr\u003e\n    - Unity Shader Programming Vol.01 (v.2.2.1)【PDF】 - XJINE's - BOOTH \u003ca href=\"https://booth.pm/ja/items/931290\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://booth.pm/ja/items/931290\u003c/a\u003e \u003cbr\u003e\n- リファレンスがわからない\u003cbr\u003e\n    - 未だにどう調べたら欲しい情報にたどり着けるかわからない HLSL? CG?\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"つくっていることを秘密にしたい時だれにも聞けない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A4%E3%81%8F%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E7%A7%98%E5%AF%86%E3%81%AB%E3%81%97%E3%81%9F%E3%81%84%E6%99%82%E3%81%A0%E3%82%8C%E3%81%AB%E3%82%82%E8%81%9E%E3%81%91%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eつくっていることを秘密にしたい時、だれにも聞けない\u003c/h2\u003e\n\n\u003cp\u003e12月くらいから制作していたのですが、人に聞けばおそらく一瞬で解決しそうなことで割と詰まってしまいました。\u003cbr\u003e\n何を作っているかを秘密にしたいときって情報収集の仕方が難しいですよね……\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"エンコードこわい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E3%81%93%E3%82%8F%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eエンコードこわい\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eH.264エンコードについて詳細に調べようと思ったけど挫折してしまった\n\n\u003cul\u003e\n\u003cli\u003e種類がありすぎる　ドキュメントが長すぎる\u003c/li\u003e\n\u003cli\u003eある程度ピクセルをブロックにまとめてやってるっぽいとか彩度は減衰しやすいっぽいという認識だけが残っています\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"unitycaptureのピクセルズレ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitycapture%E3%81%AE%E3%83%94%E3%82%AF%E3%82%BB%E3%83%AB%E3%82%BA%E3%83%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUnityCaptureのピクセルズレ？\u003c/h2\u003e\n\n\u003cp\u003eUnityCaptureでOBSに入力した画像は微妙にピクセルがズレていて、この用途では使えなかったのでビルドしてOBSのウィンドウキャプチャを使いました\u003cbr\u003e\nトラブル起きたら一発アウトで再起動が必要になるので、本当に怖かったです……\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"映像ストリーミングお金かかりすぎでは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%98%A0%E5%83%8F%E3%82%B9%E3%83%88%E3%83%AA%E3%83%BC%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%8A%E9%87%91%E3%81%8B%E3%81%8B%E3%82%8A%E3%81%99%E3%81%8E%E3%81%A7%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e映像ストリーミング、お金かかりすぎでは\u003c/h2\u003e\n\n\u003cp\u003e\u003c/p\u003e\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e\u003ca href=\"https://twitter.com/hashtag/%E8%A7%A3%E9%87%88%E4%B8%8D%E4%B8%80%E8%87%B4?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#解釈不一致\u003c/a\u003e 配信コスト、タイムラグが・・・（）\u003cbr\u003eま、まあライブハウスのノルマ2回分と考えれば余裕ですよ… \u003ca href=\"https://t.co/SSzPBLcuks\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/SSzPBLcuks\u003c/a\u003e\u003c/p\u003e— ぴぼ | memex Gt (@memex_pibo) \u003ca href=\"https://twitter.com/memex_pibo/status/1266961458425782272?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMay 31, 2020\u003c/a\u003e\n\u003c/blockquote\u003e \u003cscript async src=\"https://platform.twitter.com/widgets.js\"\u003e\u003c/script\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h2\u003e\n\n\u003cp\u003e遠くない将来、好きな姿で、オーディオリアクティブな演出が行われるライブ会場で、リアルタイムに遠隔地のメンバーとセッションするVRライブをいちユーザーが開催できて、それに観客が何人でも同時に参加できる未来が来てほしいなと思っています。\u003cbr\u003e\n2020年7月現在、生演奏しながら楽器演奏のモーションをキャプチャするのが難しいとか、音声と空間演出のタイムコードを合わせるのが難しいといった様々な課題があり、そういったVRライブを開催するのは容易ではありません。\u003cbr\u003e\nエンジニアとしての自分にとって「#解釈不一致」は、望むVRライブの未来を今いちユーザーとして利用可能な技術で実現する挑戦でした。\u003cbr\u003e\nいつか「昔はこんな面倒なことやらないとこういうライブできなかったんだな～」と言える未来が来ることを願っています。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cp\u003eGitHub - sugi-cho/Animation-Texture-Baker \u003ca href=\"https://github.com/sugi-cho/Animation-Texture-Baker\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/sugi-cho/Animation-Texture-Baker\u003c/a\u003e \u003cbr\u003e\nUnityでスクリプトを使わずに流体を計算する – EL-EMENT blog \u003ca href=\"http://el-ement.com/blog/2018/12/13/unity-fluid-with-shader/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://el-ement.com/blog/2018/12/13/unity-fluid-with-shader/\u003c/a\u003e\u003cbr\u003e\nビット演算まとめ - Qiita \u003ca href=\"https://qiita.com/qiita_kuru/items/3a6ab432ffb6ae506758\" class=\"autolink\" id=\"reference-28fdf5a4df738ea99fe4\"\u003ehttps://qiita.com/qiita_kuru/items/3a6ab432ffb6ae506758\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003eライブ エンコーダの設定、ビットレート、解像度を選択する - YouTube ヘルプ \u003ca href=\"https://support.google.com/youtube/answer/2853702?hl=ja\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://support.google.com/youtube/answer/2853702?hl=ja\u003c/a\u003e \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","createdAt":"2020-07-12T14:48:44Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"cl3cntL2T1BdFQf/v4eGUeQfWpk+gDoqxQ==--fHBFSP5CVpJYdwPJ--Zo46/yAYo3Z0Htc/gDdK+Q==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-07-17T12:01:57Z","likesCount":282,"linkUrl":"https://qiita.com/memex_pibo/items/3fbfcd627e5e7c7f2061","organization":null,"originalId":1263346,"stockedCount":210,"title":"生演奏×オーディオリアクティブ、人数無制限のVRライブシステムを作ってライブしたときのシステム構成と実装","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A2%E3%83%BC%E3%82%AB%E3%82%A4%E3%83%96\"\u003eアーカイブ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E5%9B%B3\"\u003eシステム図\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A7%A3%E8%AA%AC%E3%81%AE%E6%B5%81%E3%82%8C\"\u003e解説の流れ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#omnipresence-live%E3%81%AE%E8%A7%A3%E8%AA%AC%E3%83%88%E3%83%94%E3%83%83%E3%82%AF\"\u003e「Omnipresence Live」の解説トピック\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A7%A3%E9%87%88%E4%B8%8D%E4%B8%80%E8%87%B4%E3%81%AE%E8%A7%A3%E8%AA%AC%E3%83%88%E3%83%94%E3%83%83%E3%82%AF\"\u003e「#解釈不一致」の解説トピック\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#omnipresence-live-%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003eOmnipresence Live の実装\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#omnipresence-live-%E3%81%A8%E3%81%AF\"\u003eOmnipresence Live とは\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%89%B9%E5%BE%B4\"\u003e特徴\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A7%A3%E6%B1%BA%E3%81%99%E3%82%8B%E8%AA%B2%E9%A1%8C\"\u003e解決する課題\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%89%8B%E6%B3%95\"\u003e手法\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%95%E7%B5%84%E3%81%BF\"\u003e仕組み\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6\"\u003eイベントビジュアライザ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E6%A7%8B%E6%88%90\"\u003eイベントビジュアライザ・システム構成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ableton-live-suite\"\u003eAbleton Live Suite\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#max-for-live%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3\"\u003eMax For Liveプラグイン\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unity%E6%BC%94%E5%87%BA%E4%BF%A1%E5%8F%B7%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6\"\u003eUnity（演出信号ビジュアライザ）\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B2%BE%E5%BA%A6%E3%81%AE%E8%A6%81%E3%82%89%E3%81%AA%E3%81%84%E5%80%A4\"\u003e精度の要らない値\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E7%B2%BE%E5%BA%A6%E3%81%8C%E6%AC%B2%E3%81%97%E3%81%84%E5%80%A4\"\u003eなるべく精度が欲しい値\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%83%85%E5%A0%B1%E9%87%8F%E3%81%AE%E9%99%90%E7%95%8C\"\u003e情報量の限界\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%98%A0%E5%83%8F%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E5%95%8F%E9%A1%8C\"\u003e映像エンコード問題\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E5%AF%BE%E7%AD%96%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%81%A8%E6%98%8E%E3%82%8B%E3%81%958bit\"\u003eエンコード対策：ブロックと明るさ8bit\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#8bit%E3%82%88%E3%82%8A%E5%A4%A7%E3%81%8D%E3%81%84%E6%83%85%E5%A0%B1%E3%82%922%E3%81%A4%E3%81%AE%E8%89%B2%E3%81%AB%E5%88%86%E5%89%B2%E3%81%97%E3%81%A6%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80-%E6%A3%84%E5%8D%B4%E6%A1%88\"\u003e8bitより大きい情報を2つの色に分割して埋め込む: 棄却案\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#8bit%E3%82%88%E3%82%8A%E5%A4%A7%E3%81%8D%E3%81%84%E6%83%85%E5%A0%B1%E3%82%922%E3%81%A4%E3%81%AE%E8%89%B2%E3%81%AB%E5%88%86%E5%89%B2%E3%81%97%E3%81%A6%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80-%E6%8E%A1%E7%94%A8%E6%A1%88\"\u003e8bitより大きい情報を2つの色に分割して埋め込む: 採用案\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e実装\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unity%E9%A0%82%E7%82%B9%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6\"\u003eUnity（頂点ビジュアライザ）\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%A0%82%E7%82%B9%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e頂点アニメーション\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%88%B6%E7%B4%84\"\u003e制約\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%87%BA%E5%8A%9B%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8\"\u003e出力イメージ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85-1\"\u003e実装\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unity%E4%BD%8D%E7%BD%AE%E5%A7%BF%E5%8B%A2%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6\"\u003eUnity（位置・姿勢ビジュアライザ）\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AA%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF\"\u003eリコンストラクタ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%BC%94%E5%87%BA%E3%81%AE%E5%86%8D%E6%A7%8B%E6%88%90\"\u003e演出の再構成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%86%8D%E6%A7%8B%E6%88%90\"\u003eモーションの再構成\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E3%83%8E%E3%82%A4%E3%82%BA%E3%81%AE%E5%BC%8A%E5%AE%B3\"\u003eエンコードノイズの弊害\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E3%83%8E%E3%82%A4%E3%82%BA%E5%AF%BE%E7%AD%96\"\u003eエンコードノイズ対策\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%8D%E7%BD%AE%E5%A7%BF%E5%8B%A2%E3%81%AE%E5%86%8D%E6%A7%8B%E6%88%90\"\u003e位置・姿勢の再構成\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A7%A3%E9%87%88%E4%B8%8D%E4%B8%80%E8%87%B4-%E3%81%AE%E9%81%8B%E7%94%A8\"\u003e#解釈不一致 の運用\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A7%A3%E9%87%88%E4%B8%8D%E4%B8%80%E8%87%B4%E3%81%AE%E8%A7%A3%E8%AA%AC%E3%83%88%E3%83%94%E3%83%83%E3%82%AF-1\"\u003e「#解釈不一致」の解説トピック\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E6%A7%8B%E6%88%90%E5%9B%B3\"\u003eシステム構成図\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%85%8D%E4%BF%A1%E9%9F%B3%E5%A3%B0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e配信音声について\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AA%E3%83%BC%E3%83%87%E3%82%A3%E3%82%AA%E3%83%AA%E3%82%A2%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E6%BC%94%E5%87%BA\"\u003eオーディオリアクティブ演出\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%89%8D%E6%8F%90\"\u003e前提\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\"\u003eルーティング\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ableton-live%E4%B8%8A%E3%81%A7%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003eAbleton Live上での設定\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%BC%94%E5%87%BA%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E7%AE%A1%E7%90%86\"\u003e演出イベントの管理\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%88%B6%E4%BD%9C%E3%81%8B%E3%82%89%E5%AE%9F%E9%9A%9B%E3%81%AB%E5%86%8D%E7%94%9F%E3%81%95%E3%82%8C%E3%82%8B%E3%81%BE%E3%81%A7%E3%81%AE%E6%B5%81%E3%82%8C\"\u003e制作から実際に再生されるまでの流れ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%80%B2%E8%A1%8C%E8%A1%A8\"\u003e進行表\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%BC%94%E5%87%BA%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E7%AE%A1%E7%90%86\"\u003e演出イベント管理\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%BC%94%E5%87%BA%E5%88%B6%E5%BE%A1%E7%94%A8midi-note\"\u003e演出制御用MIDI Note\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E5%8F%8E%E9%8C%B2\"\u003eモーション収録\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9C%E3%83%BC%E3%82%AB%E3%83%AB%E3%83%A2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E9%81%A0%E9%9A%94%E5%8F%8E%E9%8C%B2\"\u003eボーカルモーションの遠隔収録\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AE%E3%82%BF%E3%83%BC%E3%82%92%E7%94%9F%E6%BC%94%E5%A5%8F%E3%81%97%E3%81%AA%E3%81%8C%E3%82%89%E3%82%AE%E3%82%BF%E3%83%BC%E3%83%A2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E5%8F%8E%E9%8C%B2%E3%81%99%E3%82%8B\"\u003eギターを生演奏しながらギターモーションを収録する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AE%E3%82%BF%E3%83%BC%E5%81%B4\"\u003eギター側\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%95%E3%83%AC%E3%83%83%E3%83%88\"\u003eフレット\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AE%E3%82%BF%E3%83%BC%E5%A7%BF%E5%8B%A2\"\u003eギター姿勢\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%B3%E6%89%8B%E5%81%B4\"\u003e右手側\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%A0%AD\"\u003e頭\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#vr%E7%A9%BA%E9%96%93%E3%81%B8%E3%81%AE%E3%83%84%E3%82%A4%E3%83%BC%E3%83%88%E3%81%AE%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E8%A1%A8%E7%A4%BA\"\u003eVR空間へのツイートのリアルタイム表示\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%BF%94%E3%81%97%E3%83%A2%E3%83%8B%E3%82%BF\"\u003e返しモニタ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#hls%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC\"\u003eHLSサーバー\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#vrchat%E4%B8%8A%E3%81%A7%E5%86%8D%E7%94%9F%E5%8F%AF%E8%83%BD%E3%81%AB%E3%81%99%E3%82%8B\"\u003eVRChat上で再生可能にする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#vrchat%E4%B8%8A%E3%81%A7%E7%A9%BA%E9%96%93%E7%B7%A8%E9%9B%86%E3%82%92%E5%8F%AF%E8%83%BD%E3%81%AB%E3%81%99%E3%82%8B\"\u003eVRChat上で空間編集を可能にする\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%A4%A7%E5%A4%89%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003e大変だったこと\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%82%80%E3%81%9A%E3%81%8B%E3%81%97%E3%81%84\"\u003eシェーダーむずかしい\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%A4%E3%81%8F%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E7%A7%98%E5%AF%86%E3%81%AB%E3%81%97%E3%81%9F%E3%81%84%E6%99%82%E3%81%A0%E3%82%8C%E3%81%AB%E3%82%82%E8%81%9E%E3%81%91%E3%81%AA%E3%81%84\"\u003eつくっていることを秘密にしたい時、だれにも聞けない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E3%81%93%E3%82%8F%E3%81%84\"\u003eエンコードこわい\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unitycapture%E3%81%AE%E3%83%94%E3%82%AF%E3%82%BB%E3%83%AB%E3%82%BA%E3%83%AC\"\u003eUnityCaptureのピクセルズレ？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%98%A0%E5%83%8F%E3%82%B9%E3%83%88%E3%83%AA%E3%83%BC%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%8A%E9%87%91%E3%81%8B%E3%81%8B%E3%82%8A%E3%81%99%E3%81%8E%E3%81%A7%E3%81%AF\"\u003e映像ストリーミング、お金かかりすぎでは\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003eおわりに\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e参考\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":15330,"uuid":"3fbfcd627e5e7c7f2061","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"FFOCJiXxxmEy8xCvlrk027uQ/GBC--0UQrzIKfC6e/bJWj--MV7Pzc0c+/1Izpn/78IwFQ==","originalId":546093,"description":"https://twitter.com/memex_pibo","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"pibo","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546093/profile-images/1594987942","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fprofile-images%2F1594987942?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=a3290003c08594c42e1635f961cfc50b","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F546093%2Fprofile-images%2F1594987942?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=cfc50bbf0a93fdf9532da200af717d7b","urlName":"memex_pibo","websiteUrl":"http://meme-x.jp/pibo","twitterUrl":"https://twitter.com/memex_pibo","twitterUrlName":"memex_pibo","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Unity","urlName":"unity"},{"name":"Max-MSP","urlName":"max-msp"},{"name":"Shader","urlName":"shader"},{"name":"VR","urlName":"vr"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

More than 3 years have passed since last update.遊戯王好きです。MTGやったことないけど好きです。麻雀とかも好きです。
でもどれも実際に作るのは難しそうなんで一人用の神経衰弱で我慢します。
我慢はしますが、どんどん拡張すると遊戯王とかMTGになる、そんな発展性のある神経衰弱を作りたいです。うーん、でも神経衰弱も実装するのは面倒くさいですね。
トランプ作らないといけないし、何より神経衰弱もルールが複雑です。
神経衰弱のルールを書き下すとこんな感じでしょうか。52枚のトランプ。♠♦♥♣の記号が書かれたカードがそれぞれ13枚。
さらにそれぞれのグループには1から13の数字がそれぞれ書かれている。なんと！適当に書いただけでも６つのルールがあるじゃないですか！これは面倒くさい！最初はもっともっと簡単なカードゲームがいいな。
よーし、じゃあカードゲームを成り立たせるのに最低限必要な概念だけを取り出してゲームを作るか。
例えばこんな感じのカードゲームはどうでしょうか。
カードです。カードにはルールが書かれています。
スタックです。ルールカードを積んだり取り出したり出来ます。
辞書です。何書いてもイイヨ。1.スタックからカードを一枚取り出して、カードに書かれたルールを実行する。
2.スタックが空になるまで1を繰り返す。
3.スタックが空になったらゲームを終了する。これなら自分でも実装できそうです。出来ました。なんて面白そうなゲームなんだろう。
さあさあ皆さん、ルールカードを作ってスタックに乗せて好きなだけ遊んでください。せっかくですからこれで神経衰弱でも作りましょう。
以下のルールカードがあれば神経衰弱が作れそうです。これでスタックに[開始]のカードを乗せれば、神経衰弱の出来上がりです。
トランプに書かれた数字とか記号とか、表とか裏とか、そもそもトランプとか、これらは単なる情報に過ぎません。だから全部辞書に書いて記録します。ルールカードは辞書に書き込んだり内容を参照出来るのでこのような複雑なゲームも実行できるわけです。まあ、神経衰弱なので全然複雑ではありませんけども。さて、ルールカードを頑張って作れるのなら、神経衰弱以外にも大富豪とか麻雀とか遊戯王とかいろいろ作れそうな気がします。
特に遊戯王、今でも新しいカードがどんどん発売されてますね。あのカードにもいろいろルールが書かれているのでなんかルールカードっぽいですね。となれば、新しいカードが出るたびにソースコードをコンパイルするのは面倒くさい。
だから、ルールカードの部分はスクリプトに任せましょう。C#スクリプトの使い方は以下のページなんかで解説されています。
C#スクリプト実行 - C# によるプログラミング入門 | ++C++; // 未確認飛行 C
csi.exeコマンド登場！ C#スクリプト（.csx）やREPLを動かそう - Build InsiderC#スクリプトを読み込むことでプログラムはそこに記述されたコードを実行することが出来ます。
ルールカードの記述は出来るだけ簡潔にしたいので、属性と静的メソッドでルールカードを表現することにします。
以下のCardMethodsクラスで[CardMethod(name)]が付与されたメソッドはnameという名前のルールカードのルールを表しています。以下はスクリプトを実行するコードと、読み込んだコードからRuleCardを生成するコードです。
CardMethod属性とリフレクションを使って必要なメソッドを取り出して、それをFuncに変換しています。
メソッドをFuncに変換できたら、あとはRuleCardインスタンスに代入するだけです。スクリプトからルールカードを生成出来たら、あとはスタックに積んで実行するだけですね。
さあついに神経衰弱の始まりです！（ ＾ω＾）つまんね！こんなところでしょうか。神経衰弱くらいなら簡単に実装できましたが、麻雀や遊戯王となると難しそうですね。
そして本格的にカードゲームを作るとなると、GUI、通信対戦、CPUの思考などゲームのルールとは別の方向での実装の難しさが存在します。だから私はここでぶん投げてふて寝します。
おわり。



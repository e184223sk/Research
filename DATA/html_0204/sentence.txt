アメリカ地質調査所（United States Geological Survey, USGS）から世界中の地震情報を取得します。
フィードの種類は ATOM や GeoJSON など複数の形式が用意されていますが、今回は GeoJSON Summary 形式のフィードを C# で処理します。
サンプルコードはC# 9の機能を使用して記述しています。過去1時間、過去24時間、過去1週間、過去30日間以内に発生した地震についてそれぞれ、顕著な地震、マグニチュード（以下M）4.5以上の地震、M2.5以上の地震、M1.0以上の地震、全ての地震情報のフィードが用意されています。取得したい内容に応じて適切なフィードを利用しましょう。
ここでは過去24時間以内のM4.5以上の地震について処理していきます。このフィードの URL は https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_day.geojson です。まずは、JSON を C# でデシリアライズするためのクラスを生成します。Visual Studio を使っている場合は JSON を全て選択してクリップボードにコピーした後、Visual Studio のメニューから「編集」、「形式を選択して貼り付け」、「JSON をクラスとして貼り付ける」を実行してクラスを生成するとよいでしょう。自動生成されたクラスやプロパティ名、型は必要に応じて修正してください。ここでは Rootobject クラスの名前を UsgsJson に変え、全プロパティの名前をアッパーキャメルケースに、set アクセサーを init アクセサーに変更しました。ちゃんと取得できたか確認するためにフィードのタイトルを取得してみました。ここまでのソースコードは次の通りです1。「USGS Magnitude 4.5+ Earthquakes, Past Day」という文字列が出力されれば成功です。続いて、地震情報を取り出していきます。
JSONデータを見ると features キーの中にそれぞれの地震情報が配列で格納されています。
さらに、その中に type、properties、geometry、id というキーが存在します。今回使うキーは properties と geometry です。まずは、properties のサブキーについてみていきます。
次の表は主な項目をピックアップしたものです。詳しいフォーマットについては USGS のページに記載されています。この中でも特筆すべき項目について解説します。日本の気象庁が発表する地震情報のように領域ごとに震央地名が設定されているのではなく、たいていは「○○の北 ○○km」のような表記です。最初の○○には代表的な都市名が入りますが、もう少し大雑把な地域でよい場合が多いです。そこで、海外の地震情報については Flinn-Engdahl Regions（F-E Regions） という境界の定義が使われることがあります。経緯度からF-E Regionsを取得し、日本語化する方法を後述します。ミリ秒の UNIX 時間から DateTimeOffset 型に変換するサンプルコードです。ToLocalTime() メソッドを使用して、プログラムが実行されているロケールのローカルタイムに変換しています。最大加速度や最大速度をもとに推定された震度で、震度階級には改正メルカリ震度階級（ローマ数字表記）が使われます。この値は、日本国内の地震情報で用いられる気象庁震度階級とは異なります。この API では自動処理を行いやすいように実数で値が格納されていますが、ローマ数字のほうが人間は見やすいです。震度階級に変換するメソッドのサンプルです。ほとんどの地震は null が格納されており、null の場合の処理が必要です。日本国内の地震情報で地震の規模を表現する際には気象庁マグニチュード（Mj）が用いられます。しかし、USGS の地震情報で用いられるマグニチュードは1種類に統一されておらず、マグニチュードの値を参照する際はマグニチュードの種類も参照する必要があります。代表的な値には 「mww （モーメントマグニチュード）」、「mb（実体波マグニチュード）」があり、取り得る値については USGS のページにまとめられています。自然地震だけなく、発破や核実験による地震もあります。それらを識別するにはこの値を使用します。取り得る値のリストをUSGSのサイト内で見つけられませんでしたが、これまでに確認できた値をまとめておきます。続いて geometry のサブキーをみていきます。coordinates キーに震源要素が格納されています。coordinates キーは配列になっており、「震源の経度」、「震源の緯度」、「震源の深さ」の順で格納されています。それでは実際に値を表示してみます。
このように表示されていれば成功です。先ほど震央位置を出力した際に「（都市名）の（方角） ○○km」のように表示されていました。今度は Flinn-Engdahl Regions（F-E Regions）という境界の定義に基づく地名を表示します。気象庁から発表される地震情報の一つに「遠地地震に関する情報」というものがありますが、実はこの情報の詳細震央地名は F-E Regions に基づいています。気象庁防災情報XMLのコード表に日本語の F-E Regions のリストがあるので、これを利用します。まず、気象庁のサイトから個別コード表をダウンロードし展開します。その中の「地震火山関連コード表.xls」ファイルを開きます。シートが複数ありますが、「43（AreaEpicenterDetailコード表）」が今回使用するリストです。データ部だけをコンマ区切りの CSV 形式で保存します。

保存したファイルをエディタで開いて、このように保存されていればOKです。4桁のコードが付番されていますが、千の位は不要なので削除して上書き保存します。ボックス選択に対応したエディタであれば Shift キー と Alt キー を押しながら範囲を選択すると楽です。
続いて、C# でコードを書いていきます。
実は USGS には経緯度を渡すと F-E Regions を返してくれる API があります。詳しくは USGS のページに記載されています。JSON 形式でデシリアライズをするためのクラスを定義します。続いて、日本語の震央地名を取得するメソッドを定義します1。JSON と CSV ファイルのコード番号同士を比較して、一致していれば CSV ファイルの日本語名を返します。先ほど作成した地震情報を取得するコードに組み込んで実行してみます。
このように表示されていれば成功です。例外処理は省略しています。 ↩



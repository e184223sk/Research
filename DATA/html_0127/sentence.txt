WPFでアプリケーションを作ることがありました
その際背景透過をする必要があり
WindowsStyleをNoneにする必要がありました
そのためタイトルバーを作る必要がありました
タイトルバーを作ってcavanにPreviewMouseLeftButtonDownの時にDragMoveを呼び出すだけで移動することはできます
しかし、そうする画面の上に移動して最大化した際にタスクバーが消えてしまいます
またタイトルバーをつかんで移動できなくなります解決法をいろいろネットで調べてみました
解決策としては以下のものが見つかりました一つ目の方法は機能が一部使えなくなりますのでよい方法ではありません
二つ目の方法はWin32APIを使うため簡単なソフトウェアを作る際に向いていませんし
IntPtrを使うのであまり好ましいとは言えませんこのようにネットに乗っている情報ではあまりいい方法に出会えなかったので
自分で考えた方法をここに記しますSystem.Windows.FormsとSystem.Drawingを参照へ追加する必要がありますC#コード通常ならDragMoveをPreviewMouseLeftButtonDownのイベントが呼び出されたときに呼び出すだけで問題ありません
しかし、これだと先ほども言いましたが
画面の上に移動して最大化した際にタスクバーが消えてしまったり
また最大化した後にタイトルバーをつかんで移動できなくなります
そのためDragMoveをラップします
ラップすることでもし最大化された場合はWindowState.Maximizedになりますので
WindowState.MaximizedになったらsizeChengeで最大化しなおします
なので一瞬小さくなりますがすぐに最大化されます
逆に最大化された状態からドラッグで小さくする処理は
sizeChengeを呼び出し小さくします
その際に元のマウスの位置を覚えておきサイズの変化の割合をとってそこからWindowの位置を変更しますこのように実装することでWin32APIを使わずに比較的理解しやすく実装することができます
タスクバーを消す必要がある場合はぜひ使ってみてください



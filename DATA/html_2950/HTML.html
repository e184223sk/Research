<!DOCTYPE html><html><head><meta charset="utf-8" /><title>ASP.NET Coreを始める前に知っておきたい19のこと - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/hydrangeas/items/b1f517130309c56eb0ec" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="v5caZCSZbiBqeLZAnwZ7CuFQJ04gm+b/OHlkfxf0ArQ5g6vHAZwrx77SXl2ebB6JhvaNrUB/8lzrBiyM1e1aGA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@hyd2501" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="ASP.NET Coreを始める前に知っておきたい19のこと - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1RVk5RTGs1RlZDQkRiM0psNDRLUzVhZUw0NEtCNDRLTDVZbU40NEdyNTUtbDQ0R2o0NEdtNDRHSzQ0R040NEdmNDRHRU1UbmpnYTdqZ1pQamdhZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz0xOTJmZmY0ZmEyNmEzYTJlZDUzZjcwNTZhZTE3ZDU5MQ&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR2g1WkhKaGJtZGxZWE0mdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz03OGJlMWU5NjI5YzU2ZmY3OGUzNGQxMjVkZDI0NjFlMA&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=e7dfbb81ea22be31de8f77b16481d2a3"><meta property="og:description" content="

概要

ASP.NET Coreを使って、画像をアップロードし、表示するウェブアプリケーションを作りました。ASP部分はAzure App Service(Web Apps)でホストし、ファイルはAzure Storage Blo..."><meta content="https://qiita.com/hydrangeas/items/b1f517130309c56eb0ec" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Azure,AzureStorage,ASP.NET_Core,EntityFramework_Core" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-9179f047-025d-41c7-b9b4-afb9a1306151"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fhydrangeas%2Fitems%2Fb1f517130309c56eb0ec">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fhydrangeas%2Fitems%2Fb1f517130309c56eb0ec">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-9179f047-025d-41c7-b9b4-afb9a1306151">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-08-14T18:34:39.000+09:00","dateModified":"2020-03-19T18:07:05.000+09:00","headline":"ASP.NET Coreを始める前に知っておきたい19のこと","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1RVk5RTGs1RlZDQkRiM0psNDRLUzVhZUw0NEtCNDRLTDVZbU40NEdyNTUtbDQ0R2o0NEdtNDRHSzQ0R040NEdmNDRHRU1UbmpnYTdqZ1pQamdhZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz0xOTJmZmY0ZmEyNmEzYTJlZDUzZjcwNTZhZTE3ZDU5MQ\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR2g1WkhKaGJtZGxZWE0mdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz03OGJlMWU5NjI5YzU2ZmY3OGUzNGQxMjVkZDI0NjFlMA\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=e7dfbb81ea22be31de8f77b16481d2a3","mainEntityOfPage":"https://qiita.com/hydrangeas/items/b1f517130309c56eb0ec","author":{"@type":"Person","address":"浜松","email":null,"identifier":"hydrangeas","name":"hydrangeas","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F7886%2Fprofile-images%2F1504182077?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=e67023dffe7cfa584f0f428208d8a3c7","url":"https://qiita.com/hydrangeas","description":"C#やらAzureやらMicrosoft系界隈を中心にお仕事してます。.NET Framework/.NET Coreによるデスクトップアプリケーション、ASP.NET Coreが中心です。副業/複業のお仕事も募集しております。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"hydrangeas","type":"items","id":"b1f517130309c56eb0ec"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"hydrangeas","type":"items","id":"b1f517130309c56eb0ec"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"hydrangeas","type":"items","id":"b1f517130309c56eb0ec"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/hydrangeas/items/b1f517130309c56eb0ec","location":"/hydrangeas/items/b1f517130309c56eb0ec","scheme":"https","host":"qiita.com","port":null,"pathname":"/hydrangeas/items/b1f517130309c56eb0ec","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"ncBc8yM/Zs2BKOiIvhPfTmz0GkPo6Z4y6Xuni2bvejIb1O1QBjojKlWCAJW/ebrNC1KwoIgNipE6BO94pPYing==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-ca0dee63-b2a3-4c3b-8936-b85d8e515bab"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/hydrangeas/items/b1f517130309c56eb0ec/likers" class="css-1iupg5d">40</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">59</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/b1f517130309c56eb0ec/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/hydrangeas/items/b1f517130309c56eb0ec/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/hydrangeas/items/b1f517130309c56eb0ec/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/hydrangeas/items/b1f517130309c56eb0ec/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/hydrangeas/items/b1f517130309c56eb0ec.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/hydrangeas"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/7886/profile-images/1504182077" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/hydrangeas" class="css-10ougpm">@<!-- -->hydrangeas</a><div class="css-1ay9vb9"><span><meta content="2019-08-14T09:34:39Z"/><time dateTime="2020-03-19T09:07:05Z" class="css-m19uds">updated at 2020-03-19</time></span></div></div></div></div></div><h1 class="css-cgzq40">ASP.NET Coreを始める前に知っておきたい19のこと</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/azure" class="css-4czcte">Azure</a><a href="/tags/azurestorage" class="css-4czcte">AzureStorage</a><a href="/tags/asp.net_core" class="css-4czcte">ASP.NET_Core</a><a href="/tags/entityframework_core" class="css-4czcte">EntityFramework_Core</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h1>

<p>ASP.NET Coreを使って、画像をアップロードし、表示するウェブアプリケーションを作りました。ASP部分はAzure App Service(Web Apps)でホストし、ファイルはAzure Storage Blobへアップロード、ファイルのメタ情報はAzure Websiteに無料で提供されているMySQL In Appに格納しました。</p>

<p>作るモノのイメージは結構はっきりしていたので、あまり時間もかからずできるだろうと思ったら、（やっぱり）意外といろんな所で <strong>学び</strong> があり、せっかくなので残しておきたいと思いました。</p>

<p>もう1点、今回は全てMicrosoftの技術なのですが、全てmacOS上で開発を行いました。どんな罠があるのかと怯えながら開発を進めていたのですが、驚くことにmacOSを使っていることによる不利益は1回も起きませんでした。すごい。ま、Visual Studio for Macを使っているので、結局は全てMicrosoftの手のひらで踊らされているだけなのですけどね・・。</p>

<p>私自身、まだまだ勉強中で理解できていないところも多々あります。是非、コメントなど反応をいただけると嬉しいです。</p>

<h1>
<span id="ことはじめ" class="fragment"></span><a href="#%E3%81%93%E3%81%A8%E3%81%AF%E3%81%98%E3%82%81"><i class="fa fa-link"></i></a>ことはじめ</h1>

<h2>
<span id="1-公式ドキュメントをよく読む" class="fragment"></span><a href="#1-%E5%85%AC%E5%BC%8F%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E3%82%88%E3%81%8F%E8%AA%AD%E3%82%80"><i class="fa fa-link"></i></a>(1) 公式ドキュメントをよく読む</h2>

<ul>
<li><a href="https://docs.microsoft.com/ja-jp/aspnet/core/" rel="nofollow noopener" target="_blank">ASP.NET Core の概要</a></li>
</ul>

<p>この辺りをよく読みます。チュートリアルも豊富なので、ソースコードを試しながら読んでもいいです。</p>

<p>どちらかといえば、流し読みでもいいので <strong>全部読む</strong> ことをお勧めします。ソースコードを書くことより全部読むことの方が大切です。</p>

<p>実際に小さなアプリケーションを作り始めてみると、「これどうやって実現するんだろう？」ってことのほとんどは、ドキュメントに書かれています。（私だけかもしれませんが、如何にちゃんと読んでなかったかが分かります・・）</p>

<h2>
<span id="2-書籍をよく読む" class="fragment"></span><a href="#2-%E6%9B%B8%E7%B1%8D%E3%82%92%E3%82%88%E3%81%8F%E8%AA%AD%E3%82%80"><i class="fa fa-link"></i></a>(2) 書籍をよく読む</h2>

<ul>
<li>
<a href="https://www.amazon.co.jp/dp/4822253805" rel="nofollow noopener" target="_blank">プログラミング ASP.NET Core - Microsoft Press</a>（日本での出版日：2019年5月27日 5200円+税）</li>
</ul>

<p>リンクを貼るためにAmazonをみて気づいたのですが、この本、税込で5600円もするんですね・・。私には非常に有用で、後悔はしませんでした。基本的なMVC、Razor、DI、Entity Framework CoreなどのO/RM、ASP.NET Identity、Ajax連携など、一通り網羅されています。</p>

<p>まだまだ理解しきれていないところも多いのですが、この１冊で大体は分かった気になれます。サンプルコードも、程よく実用的なサイズで理解しやすいです。</p>

<ul>
<li><a href="https://github.com/despos/progcore" rel="nofollow noopener" target="_blank">Programming ASP.NET Core - GitHub Repository</a></li>
</ul>

<h2>
<span id="3-先人に学ぶ" class="fragment"></span><a href="#3-%E5%85%88%E4%BA%BA%E3%81%AB%E5%AD%A6%E3%81%B6"><i class="fa fa-link"></i></a>(3) 先人に学ぶ</h2>

<p>Qiitaの先人の知恵を学びます。<code>ASP.NET Core</code>で検索して、今回の勉強に直接参考になったものを抜粋します。ASP.NET Coreというよりも、Visual Studio Codeに焦点を合わせていたり、gulpなどなどのツール類の話が中心のものは、あまり読んでいません。</p>

<ul>
<li><p><a href="https://qiita.com/ikuhanaRock/items/af103cec2b05281f0ce4" id="reference-e0b61cd7471d8c60b952">はじめてのASP.NET Core</a><br>
プロジェクト開始直後に何をしていいのか、なんとなく理解できるようになりました</p></li>
<li><p><a href="https://qiita.com/Nossa/items/d48fbe91ca470748a3d7" id="reference-6b12f23f0921a7195061">【C#】コードファーストで DB に 初期データ入れる</a><br>
この記事でEntity Framework Coreの使い方についての実装イメージが湧くようになりました</p></li>
</ul>

<h2>
<span id="4-visual-studio-for-mac-ではweb-appsデプロイ後のリモートデバッグができない" class="fragment"></span><a href="#4-visual-studio-for-mac-%E3%81%A7%E3%81%AFweb-apps%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E5%BE%8C%E3%81%AE%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>(4) Visual Studio for Mac ではWeb Appsデプロイ後のリモートデバッグができない</h2>

<p>私が知らないだけかもしれません。<code>ホーム &gt; App Service &gt; 構成 &gt; 全般設定</code>でリモートの設定が変更できるのですが、Visual Studio for Macの項目は無いようです。また、Visual Studioも2015/2017/2019での機能となっています（さすがに2012でAzureの機能開発はできないと思いますが・・）。</p>

<ul>
<li><a href="https://stackoverflow.com/questions/43991820" rel="nofollow noopener" target="_blank">Visual Studio for Mac azure remote debugging on Mac OS X</a></li>
</ul>

<p>回答は締め切られていないですが、同様に悩んでいる人もいるようです。</p>

<h2>
<span id="5-application-insights-は必ず設定しておく" class="fragment"></span><a href="#5-application-insights-%E3%81%AF%E5%BF%85%E3%81%9A%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%A6%E3%81%8A%E3%81%8F"><i class="fa fa-link"></i></a>(5) Application Insights は必ず設定しておく</h2>

<p>Visual Studio for Macでリモートデバッグができなかったので、各種本番環境での不具合は<code>printf</code>デバッグに頼るしかありませんでした。しかしながら、例外をApplication Insightsが捕捉してくれたので、ステップ実行ほどの利便性は無いものの、デバッグに役立てることができました。</p>

<p>基本的には開発環境（ローカル）でデバッグしていましたので、本番環境と異なる部分だけデプロイ後のデバッグが必要でした。今回の開発環境と本番環境の差異は以下の通りでした。</p>

<table>
<thead>
<tr>
<th style="text-align: left"></th>
<th style="text-align: center">開発環境</th>
<th style="text-align: center">本番環境</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">データベース</td>
<td style="text-align: center">SQLite</td>
<td style="text-align: center">MySQL In App</td>
</tr>
<tr>
<td style="text-align: left">ストレージ</td>
<td style="text-align: center">Azurite</td>
<td style="text-align: center">Azure Storage Blob</td>
</tr>
</tbody>
</table>

<h2>
<span id="6-デフォルトのデバッグ環境は-development-となる" class="fragment"></span><a href="#6-%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E7%92%B0%E5%A2%83%E3%81%AF-development-%E3%81%A8%E3%81%AA%E3%82%8B"><i class="fa fa-link"></i></a>(6) デフォルトのデバッグ環境は <code>Development</code> となる</h2>

<p>デバッグ環境では <code>#if DEBUG</code> なども使えますが、EnvironmentとしてはDevelopmentが設定されています。そのため、タグヘルパーを正しく設定していれば、以下のようなコードが有効になるわけです。</p>

<div class="code-frame" data-lang="html"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;environment</span> <span class="na">include=</span><span class="s">"Development"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span><span class="ni">&amp;lt;</span>environment include="Development"<span class="ni">&amp;gt;</span><span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/environment&gt;</span>
<span class="nt">&lt;environment</span> <span class="na">exclude=</span><span class="s">"Development"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span><span class="ni">&amp;lt;</span>environment exclude="Development"<span class="ni">&amp;gt;</span><span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/environment&gt;</span>
<span class="nt">&lt;environment</span> <span class="na">include=</span><span class="s">"Staging,Development,Staging_2"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="ni">&amp;lt;</span>environment include="Staging,Development,Staging_2"<span class="ni">&amp;gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/environment&gt;</span>
</code></pre></div></div>

<ul>
<li><a href="https://docs.microsoft.com/ja-jp/aspnet/core/fundamentals/environments" rel="nofollow noopener" target="_blank">ASP.NET Core で複数の環境を使用する</a></li>
</ul>

<p>この設定はプロジェクトのオプションから変更可能です。</p>

<p><a href="https://camo.qiitausercontent.com/643f2dd114c4bf99cc3f79b81ee275ec886205ee/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f373838362f30386637656437612d386238382d356338632d393862362d3132373161313333376565662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2F08f7ed7a-8b88-5c8c-98b6-1271a1337eef.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3a9ada96bc16bb308a10ca4b826f5d17" alt="Environmentの環境を切り替える" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7886/08f7ed7a-8b88-5c8c-98b6-1271a1337eef.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2F08f7ed7a-8b88-5c8c-98b6-1271a1337eef.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1c50084d65e08e065273d4aa1376a47c 1x" loading="lazy"></a></p>

<h2>
<span id="7-接続文字列はソースコードに書かない" class="fragment"></span><a href="#7-%E6%8E%A5%E7%B6%9A%E6%96%87%E5%AD%97%E5%88%97%E3%81%AF%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AB%E6%9B%B8%E3%81%8B%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>(7) 接続文字列はソースコードに書かない</h2>

<p>例えば、Azure Storage Blobの接続文字列が漏れてしまった場合、他人にデータをアップロードされたり、自分のデータがダウンロードされてしまう危険性があります。ウェブで公開するデータがダウンロードされるだけなら問題ありませんが、非常に大きなデータをアップロードされてしまうとクラウド死を迎えてしまいます。しかしながら、ソースコードをGitHubなどで公開しておきたいとも思うはずです。</p>

<p>そこで、<code>ホーム &gt; App Service &gt; 構成 &gt; アプリケーション設定 &gt; 接続文字列</code>に全て保存し、ソースコードには記述しないよう気をつけます。なお、開発環境（特にローカルPCのエミュレーション環境）については、漏洩してもアクセスできないと思われるので、（私は）そのまま書いてしまっています。</p>

<p><a href="https://camo.qiitausercontent.com/0e206f760e2435aa7ceae0150115ad74ff637df5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f373838362f32653639386437312d363437302d643532392d383065332d6462386430653362326339642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2F2e698d71-6470-d529-80e3-db8d0e3b2c9d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=85e352c3b295c2107a4a28bc12b5e6f0" alt="接続文字列の設定" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7886/2e698d71-6470-d529-80e3-db8d0e3b2c9d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2F2e698d71-6470-d529-80e3-db8d0e3b2c9d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e444a8dbb8aea11fb08473c486d72346 1x" loading="lazy"></a></p>

<p>こんな感じでアクセスして、接続文字列を取得します。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">Test.Controllers</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">StorageController</span> <span class="p">:</span> <span class="n">Controller</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IConfiguration</span> <span class="n">config</span><span class="p">;</span>
        <span class="k">public</span> <span class="nf">StorageController</span><span class="p">(</span><span class="n">IConfiguration</span> <span class="n">_config</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">config</span> <span class="p">=</span> <span class="n">_config</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Upload</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">connectionString</span> <span class="p">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">GetConnectionString</span><span class="p">(</span><span class="s">"MYSQL_ProductionServer"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="8-macos上でazure-storage-blobをエミュレートする場合はazuriteを使う" class="fragment"></span><a href="#8-macos%E4%B8%8A%E3%81%A7azure-storage-blob%E3%82%92%E3%82%A8%E3%83%9F%E3%83%A5%E3%83%AC%E3%83%BC%E3%83%88%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AFazurite%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>(8) macOS上でAzure Storage Blobをエミュレートする場合はAzuriteを使う</h2>

<ul>
<li><a href="https://qiita.com/miyake/items/83aac5524be91e3811ee#azurite" id="reference-eaf31970d5e6c07e0833">Azure Functions V2 を Mac+VSCode で動かすまでの手順 &gt; Azurite</a></li>
</ul>

<p>Azuriteを参考にさせていただきました。インストールは非常に簡単でした。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre class="with-code"><code>npm <span class="nb">install</span> <span class="nt">-g</span> azurite
</code></pre></div></div>

<p><code>/var/tmp/azurite</code>ディレクトリを作成し、起動用のディレクトリとしました。<br>
ただ、ここは起動のたびに削除されるので、永続的なストレージが必要なら別の場所がいいと思います。（参考先だと<code>~/azurite</code>になっていますね）</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre class="with-code"><code>azurite <span class="nt">-l</span> /var/tmp/azurite
</code></pre></div></div>

<h2>
<span id="9-macos上でデータベースを使うならsqliteが楽" class="fragment"></span><a href="#9-macos%E4%B8%8A%E3%81%A7%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E3%81%86%E3%81%AA%E3%82%89sqlite%E3%81%8C%E6%A5%BD"><i class="fa fa-link"></i></a>(9) macOS上でデータベースを使うならSQLiteが楽</h2>

<p>macOSには標準でSQLite3が入っているはずなので、開発環境でのデータベースはSQLite3を使うのが手っ取り早いはずです（たぶん）。</p>

<p>設定を以下のようにしておきます。<code>/var/tmp/JobDatabase.db</code>ファイルに保存されますが、上記の通り、<code>/var/tmp</code>が永続的なファイル保存場所では無いのでご注意ください。</p>

<div class="code-frame" data-lang="json">
<div class="code-lang"><span class="bold">appsettings.Development.json</span></div>
<div class="highlight"><pre class="with-code"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"ConnectionStrings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"JobDatabase"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Data Source=/var/tmp/JobDatabase.db"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
</div>

<p>SQLiteもMySQLと同じようにプロバイダとして <code>Microsoft.EntityFrameworkCore.Sqlite</code> をNuGetでインストールし、以下のようなコードを書くだけで、アクセスできるようになります。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">Test</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Startup</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IConfiguration</span> <span class="n">config</span><span class="p">;</span>
        <span class="k">public</span> <span class="nf">Startup</span><span class="p">(</span><span class="n">IHostingEnvironment</span> <span class="n">_env</span><span class="p">,</span> <span class="n">IConfiguration</span> <span class="n">_config</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">config</span> <span class="p">=</span> <span class="n">_config</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">JobDatabase</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">connectionString</span> <span class="p">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">GetConnectionString</span><span class="p">(</span><span class="s">"JobDatabase"</span><span class="p">);</span>
                <span class="n">options</span><span class="p">.</span><span class="nf">UseSqlite</span><span class="p">(</span><span class="n">connectionString</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="10-プロジェクトは空の状態から作る" class="fragment"></span><a href="#10-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AF%E7%A9%BA%E3%81%AE%E7%8A%B6%E6%85%8B%E3%81%8B%E3%82%89%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>(10) プロジェクトは空の状態から作る</h2>

<p>サンプルで用意されているプロジェクトは、今後大きくスケールする可能性があるか、スケールする可能性のない小さいものが多いようです。必死に理解しながら修正していると、勉強をしているのか、システムの改修案件に精をだしているのか分からなくなります。</p>

<p>空のプロジェクトから始め、MVCならView(Razor ビューエンジン)→Controller(クリックして発火)→Model(データ更新)→.. のように順を追って、少しずつ作り上げていく方が理解が早いです。</p>

<h2>
<span id="11-startupである必要はない" class="fragment"></span><a href="#11-startup%E3%81%A7%E3%81%82%E3%82%8B%E5%BF%85%E8%A6%81%E3%81%AF%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>(11) Startupである必要はない</h2>

<p>プログラムの開始は<code>Program.Main</code>です。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">host</span> <span class="p">=</span> <span class="nf">CreateWebHostBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">).</span><span class="nf">Build</span><span class="p">();</span>
    <span class="n">host</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">static</span> <span class="n">IWebHostBuilder</span> <span class="nf">CreateWebHostBuilder</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="n">WebHost</span><span class="p">.</span><span class="nf">CreateDefaultBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="p">.</span><span class="n">UseStartup</span><span class="p">&lt;</span><span class="n">Startup</span><span class="p">&gt;();</span>
</code></pre></div></div>

<p>ここで、<code>UseStartup&lt;Startup&gt;()</code> の部分を書き換えればよいのです。なんで Startup なんだろう・・？ではなく、なんでもよいがデフォルトは Startup になっている、ということでした。</p>

<h2>
<span id="12-_viewimportscshtml-に共通で使用するディレクティブを書く" class="fragment"></span><a href="#12-_viewimportscshtml-%E3%81%AB%E5%85%B1%E9%80%9A%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%82%92%E6%9B%B8%E3%81%8F"><i class="fa fa-link"></i></a>(12) <code>_ViewImports.cshtml</code> に共通で使用するディレクティブを書く</h2>

<p>タグヘルパーを使うには以下のようなコードが必要になります。各View（.cshtml）の先頭に書いてもいいのですが、同じものであればまとめることができます。<code>_ViewImports.cshtml</code>はファイル名そのものが意味を持っており、左記の機能を実現するために使われます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
</code></pre></div></div>

<p>なお、ちゃんとドキュメントを読んでいれば、書いてあります。</p>

<ul>
<li><a href="https://docs.microsoft.com/ja-jp/aspnet/core/mvc/views/layout?view=aspnetcore-2.2#importing-shared-directives" rel="nofollow noopener" target="_blank">ASP.NET Core ドキュメント &gt; Web アプリ &gt; レイアウト</a></li>
</ul>

<h2>
<span id="13-_viewstartcshtml-に共通で使用するレイアウトを書く" class="fragment"></span><a href="#13-_viewstartcshtml-%E3%81%AB%E5%85%B1%E9%80%9A%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%82%92%E6%9B%B8%E3%81%8F"><i class="fa fa-link"></i></a>(13) <code>_ViewStart.cshtml</code> に共通で使用するレイアウトを書く</h2>

<p>同じレイアウト（テンプレート）を使いまわしたいときは、先頭に以下のような設定をします。これにより、レイアウトとして、<code>_Layout.cshtml</code>を使用し、<code>@RenderBody</code>にView本体の記述が入ることになります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>@{
    Layout = "_Layout";
}
</code></pre></div></div>

<p>しかし、これを全部のViewに書くのはナンセンスです。<code>_ViewStart.cshtml</code>に書いておけば事足ります。ちなみにこれもドキュメントにきちんと書かれています。</p>

<ul>
<li><a href="https://docs.microsoft.com/ja-jp/aspnet/core/mvc/views/layout?view=aspnetcore-2.2#running-code-before-each-view" rel="nofollow noopener" target="_blank">ASP.NET Core ドキュメント &gt; Web アプリ &gt; 各ビューの前にコードを実行する</a></li>
</ul>

<h2>
<span id="14-ensurecreatedはmainで呼んでしまう" class="fragment"></span><a href="#14-ensurecreated%E3%81%AFmain%E3%81%A7%E5%91%BC%E3%82%93%E3%81%A7%E3%81%97%E3%81%BE%E3%81%86"><i class="fa fa-link"></i></a>(14) EnsureCreated()は<code>Main</code>で呼んでしまう</h2>

<p><code>EnsureCreated</code>（データベースが存在しない場合、スキーマを流し込んでくれます）を呼びたいです。<code>IServiceCollection.AddDbContext</code>の前に、です。そんな時にもサンプルがあるんです、公式ならね。</p>

<ul>
<li><a href="https://docs.microsoft.com/ja-jp/aspnet/core/data/ef-rp/intro?view=aspnetcore-2.2&amp;tabs=visual-studio#update-main" rel="nofollow noopener" target="_blank">ASP.NET Core ドキュメント &gt; データアクセス &gt; チュートリアル &gt; EF CoreとRazor Pages</a></li>
</ul>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">ContosoUniversity.Models</span><span class="p">;</span>                   <span class="c1">// SchoolContext</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNetCore</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Hosting</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.Extensions.DependencyInjection</span><span class="p">;</span>   <span class="c1">// CreateScope</span>
<span class="k">using</span> <span class="nn">Microsoft.Extensions.Logging</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ContosoUniversity</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">host</span> <span class="p">=</span> <span class="nf">CreateWebHostBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">).</span><span class="nf">Build</span><span class="p">();</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">scope</span> <span class="p">=</span> <span class="n">host</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">CreateScope</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">services</span> <span class="p">=</span> <span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">;</span>

                <span class="k">try</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="n">services</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">SchoolContext</span><span class="p">&gt;();</span>
                    <span class="n">context</span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="nf">EnsureCreated</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">logger</span> <span class="p">=</span> <span class="n">services</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">ILogger</span><span class="p">&lt;</span><span class="n">Program</span><span class="p">&gt;&gt;();</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">LogError</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">"An error occurred creating the DB."</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">host</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">IWebHostBuilder</span> <span class="nf">CreateWebHostBuilder</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="n">WebHost</span><span class="p">.</span><span class="nf">CreateDefaultBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
                <span class="p">.</span><span class="n">UseStartup</span><span class="p">&lt;</span><span class="n">Startup</span><span class="p">&gt;();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="15-開発目的ならazure-database-for-mysqlを契約しなくても良い" class="fragment"></span><a href="#15-%E9%96%8B%E7%99%BA%E7%9B%AE%E7%9A%84%E3%81%AA%E3%82%89azure-database-for-mysql%E3%82%92%E5%A5%91%E7%B4%84%E3%81%97%E3%81%AA%E3%81%8F%E3%81%A6%E3%82%82%E8%89%AF%E3%81%84"><i class="fa fa-link"></i></a>(15) 開発目的ならAzure Database for MySQLを契約しなくても良い</h2>

<p>Azure Database for MySQL を東日本リージョンで使用する場合、1時間あたり5.824円かかります。1ヶ月（Azureでの1ヶ月=730時間)では、4251円かかります。実験が終わったら止めればいいのですが、万が一止め忘れてしまったら・・。それにAzure App ServiceがFree版なのに、MySQLだけお金を取られるのも微妙です。</p>

<p>そんな時に便利なのが、MySQL In App です。こちらで設定できます。接続文字列も環境変数で提供される親切仕様。</p>

<p><a href="https://camo.qiitausercontent.com/a4fc5a8251b478f205fd57a2b6c2897dc411b32c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f373838362f65666563376337312d663066372d353038302d386363342d6231323037386131636561332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2Fefec7c71-f0f7-5080-8cc4-b12078a1cea3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c4a6f5de1da8492f14b99aed0e3b1965" alt="MySQL In App" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7886/efec7c71-f0f7-5080-8cc4-b12078a1cea3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2Fefec7c71-f0f7-5080-8cc4-b12078a1cea3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8d6913e17f657ae2ad75bcc5d4e6f8a4 1x" loading="lazy"></a></p>

<h2>
<span id="16-mysql-in-app-で用意される-mysqlconnstr_localdb-は間違っている" class="fragment"></span><a href="#16-mysql-in-app-%E3%81%A7%E7%94%A8%E6%84%8F%E3%81%95%E3%82%8C%E3%82%8B-mysqlconnstr_localdb-%E3%81%AF%E9%96%93%E9%81%95%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B"><i class="fa fa-link"></i></a>(16) MySQL In App で用意される <code>MYSQLCONNSTR_localdb</code> は間違っている</h2>

<p>接続文字列は正しく取得できていて、設定もされている（試しに違うサーバーの接続文字列を試すとうまくいく）のですけど、MySQL In Appだけは接続できない。諦めるか否か悩んでいたところ、一つのポストを見つけました。</p>

<ul>
<li><a href="https://social.msdn.microsoft.com/Forums/en-US/7e577b74-bbc8-41ea-a5e4-075b0eaa8622/" rel="nofollow noopener" target="_blank">ASP.NET Core MVC and MySql in App</a></li>
</ul>

<blockquote>
<p>I finally found the problem!!!<br>
Connection string that Azure give to me in env variable MYSQLCONNSTR_localdb is WRONG!!!</p>
</blockquote>

<p>嘘だよね・・。与えられた接続文字列ではアクセスできないよってことらしいのですが、バグを2年も放置するはずがないので、使い方が違うのかも。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>NG: Database=localdb;Data Source=127.0.0.1:PPPPP;User Id=azure;Password=XXXXX
OK: server=127.0.0.1;userid=azure;password=XXXXX;database=localdb;Port=PPPPP
</code></pre></div></div>

<p>というわけで、ポート番号とパスワード以外は固定だと思われるので、その部分だけ動的に変更して接続文字列を作るようにしました。ここでしか使わないのでベタ書きです。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">connectionString</span> <span class="p">=</span> <span class="n">Environment</span><span class="p">.</span><span class="nf">GetEnvironmentVariable</span><span class="p">(</span><span class="s">"MYSQLCONNSTR_localdb"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">dictionary</span> <span class="p">=</span> <span class="n">connectionString</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">';'</span><span class="p">)</span>
                                 <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">'='</span><span class="p">))</span>
                                 <span class="p">.</span><span class="nf">ToDictionary</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
<span class="n">connectionString</span> <span class="p">=</span> <span class="s">$"server=127.0.0.1;userid=azure;password=</span><span class="p">{</span><span class="n">dictionary</span><span class="p">[</span><span class="s">"Password"</span><span class="p">]}</span><span class="s">;database=localdb;Port=</span><span class="p">{</span><span class="n">dictionary</span><span class="p">[</span><span class="s">"Data Source"</span><span class="p">].</span><span class="nf">Split</span><span class="p">(</span><span class="sc">':'</span><span class="p">)[</span><span class="m">1</span><span class="p">]}</span><span class="s">"</span><span class="p">;</span>
<span class="n">options</span><span class="p">.</span><span class="nf">UseMySql</span><span class="p">(</span><span class="n">connectionString</span><span class="p">);</span>
</code></pre></div></div>

<h2>
<span id="17-mysqldataentityframeworkcore-ではなく-pomeloentityframeworkcoremysql-を使う" class="fragment"></span><a href="#17-mysqldataentityframeworkcore-%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8F-pomeloentityframeworkcoremysql-%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>(17) <code>MySql.Data.EntityFrameworkCore</code> ではなく <code>Pomelo.EntityFrameworkCore.Mysql</code> を使う</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>System.InvalidCastException: Unable to cast object of type System.Boolean to type System.Int16
</code></pre></div></div>

<p>エラーが出ました。スキーマもデータも見直したし、ステップ実行して、不正なデータが混入していないことも確認したんです。たぶん。どうやっても解決できなかったのですが、これまた一つのポストを見つけました。</p>

<ul>
<li><a href="https://stackoverflow.com/questions/56424727" rel="nofollow noopener" target="_blank">Entity Framework Core DbContext.SaveChanges throws System.InvalidCastException: Unable to cast object of type System.Boolean to type System.Int16</a></li>
</ul>

<blockquote>
<p>This is a bug in the MySQL EF.Core implementation: bug 93028.<br>
On other sites, people have reported fixing the issue by switching to Pomelo.EntityFrameworkCore.MySql.</p>
</blockquote>

<p>嘘だよね・・。というわけで、NuGetパッケージから <code>MySql.Data.EntityFrameworkCore</code> を削除し、<code>Pomelo.EntityFrameworkCore.Mysql</code> をインストールするだけでこの問題は解決しました。ちなみに、メソッド名が微妙に違っておりまして、<code>UseMySQL</code> から <code>UseMySql</code> になってました。プロバイダ違いを明確にするためなのか・・な？</p>

<h2>
<span id="18-azure-app-service-に設定されている環境変数などは-kudu-で見る" class="fragment"></span><a href="#18-azure-app-service-%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%AA%E3%81%A9%E3%81%AF-kudu-%E3%81%A7%E8%A6%8B%E3%82%8B"><i class="fa fa-link"></i></a>(18) Azure App Service に設定されている環境変数などは Kudu で見る</h2>

<p>上部メニューのEnvironmentから設定されている環境変数の一覧を見ることができます。また、<code>Debug Console &gt; CMD</code>ではVM内のファイルなども見ることができ、<code>/home/data/mysql/MYSQLCONNSTR_localdb.ini</code>にはMySQL In Appへの正しい接続文字列が格納されていたりします。</p>

<p><a href="https://camo.qiitausercontent.com/f6379a08cfbb49053a18d9f5dcb30be1db51df77/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f373838362f64326634326532372d613336662d366561632d356639372d6539396433626237373662622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2Fd2f42e27-a36f-6eac-5f97-e99d3bb776bb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=544766b23bc38000ee7f9378c129a0cc" alt="Kuduを起動する" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7886/d2f42e27-a36f-6eac-5f97-e99d3bb776bb.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2Fd2f42e27-a36f-6eac-5f97-e99d3bb776bb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c8d842f0a1b27ed99375f186a5bef0e5 1x" loading="lazy"></a></p>

<p><a href="https://camo.qiitausercontent.com/876169abfafdf93066d2a0ae6683a1057dbfcb76/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f373838362f64326230343934612d343564642d356630642d633438362d6564333264353264303232352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2Fd2b0494a-45dd-5f0d-c486-ed32d52d0225.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9a7923d4be20ceac051064344958564e" alt="環境変数を確認する" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7886/d2b0494a-45dd-5f0d-c486-ed32d52d0225.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2Fd2b0494a-45dd-5f0d-c486-ed32d52d0225.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5d0771bff286fd17eaf7ae3d2f269958 1x" loading="lazy"></a></p>

<h2>
<span id="19-mysql-in-app-のデータは-phpmyadmin-で確認する" class="fragment"></span><a href="#19-mysql-in-app-%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AF-phpmyadmin-%E3%81%A7%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>(19) MySQL In App のデータは phpMyAdmin で確認する</h2>

<p><code>ホーム &gt; App Service &gt; MySQL In App &gt; 管理</code>から phpMyAdmin にアクセスできます。</p>

<blockquote>
<p>An attempt was made to access a socket in a way forbidden by its access permissions.</p>
</blockquote>

<p>などのエラーが発生する場合、App Service自体がスリープになってしまっている可能性があります。MySQL In AppはApp ServiceのVM上でホストされているため、これがスリープしているとアクセスできません。（ちなみにInternal Server Errorなどにより、App Serviceが落ちてしまったり、起動できなかったりしても同じです）</p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>新しいことを学ぶのはとても楽しかったです。同時に、「やればできるだろう」と『やってみた』の差がいかに大きいかということも改めて実感しました。</p>

<p>今回は、初めてのことが多くて手が出せなかった分野も多くあります。ASP.NET Identityによる認証や、認可といったセキュリティ部分、ロギングや例外処理といったアプリケーションの運用のために必要不可欠な部分などです。</p>

<p>この記事が誰かのお役にたてば幸いです。<br>
ここまでお読みいただき、ありがとうございました。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fhydrangeas%2Fitems%2Fb1f517130309c56eb0ec&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fhydrangeas%2Fitems%2Fb1f517130309c56eb0ec&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/hydrangeas/items/b1f517130309c56eb0ec/likers" class="css-1iupg5d">40</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">59</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/b1f517130309c56eb0ec/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/hydrangeas/items/b1f517130309c56eb0ec/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/hydrangeas/items/b1f517130309c56eb0ec/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/hydrangeas/items/b1f517130309c56eb0ec/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/hydrangeas/items/b1f517130309c56eb0ec.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-ca0dee63-b2a3-4c3b-8936-b85d8e515bab">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-1e1167fd-98f7-40db-bff6-27412f57908e"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-1e1167fd-98f7-40db-bff6-27412f57908e">{}</script>
      
<div id="LoginModal-react-component-ea2c63e6-33ea-4413-a01f-d9c5bbf081e2"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-ea2c63e6-33ea-4413-a01f-d9c5bbf081e2">{}</script>
      
<div id="StockModal-react-component-15171e6a-7b06-4c11-b43b-a69750f1a078"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-15171e6a-7b06-4c11-b43b-a69750f1a078">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;s/CcaH1oLRfx2fzzVNRJreLx17Voe9OeR5WJSgzUVBM15C3LWG1o8CVzFO5VviwuhVd9Vgifxz2U6sG5zs0Mvw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h1\u003e\n\n\u003cp\u003eASP.NET Coreを使って、画像をアップロードし、表示するウェブアプリケーションを作りました。ASP部分はAzure App Service(Web Apps)でホストし、ファイルはAzure Storage Blobへアップロード、ファイルのメタ情報はAzure Websiteに無料で提供されているMySQL In Appに格納しました。\u003c/p\u003e\n\n\u003cp\u003e作るモノのイメージは結構はっきりしていたので、あまり時間もかからずできるだろうと思ったら、（やっぱり）意外といろんな所で \u003cstrong\u003e学び\u003c/strong\u003e があり、せっかくなので残しておきたいと思いました。\u003c/p\u003e\n\n\u003cp\u003eもう1点、今回は全てMicrosoftの技術なのですが、全てmacOS上で開発を行いました。どんな罠があるのかと怯えながら開発を進めていたのですが、驚くことにmacOSを使っていることによる不利益は1回も起きませんでした。すごい。ま、Visual Studio for Macを使っているので、結局は全てMicrosoftの手のひらで踊らされているだけなのですけどね・・。\u003c/p\u003e\n\n\u003cp\u003e私自身、まだまだ勉強中で理解できていないところも多々あります。是非、コメントなど反応をいただけると嬉しいです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ことはじめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%A8%E3%81%AF%E3%81%98%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eことはじめ\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-公式ドキュメントをよく読む\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E5%85%AC%E5%BC%8F%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E3%82%88%E3%81%8F%E8%AA%AD%E3%82%80\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(1) 公式ドキュメントをよく読む\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.microsoft.com/ja-jp/aspnet/core/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eASP.NET Core の概要\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこの辺りをよく読みます。チュートリアルも豊富なので、ソースコードを試しながら読んでもいいです。\u003c/p\u003e\n\n\u003cp\u003eどちらかといえば、流し読みでもいいので \u003cstrong\u003e全部読む\u003c/strong\u003e ことをお勧めします。ソースコードを書くことより全部読むことの方が大切です。\u003c/p\u003e\n\n\u003cp\u003e実際に小さなアプリケーションを作り始めてみると、「これどうやって実現するんだろう？」ってことのほとんどは、ドキュメントに書かれています。（私だけかもしれませんが、如何にちゃんと読んでなかったかが分かります・・）\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-書籍をよく読む\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-%E6%9B%B8%E7%B1%8D%E3%82%92%E3%82%88%E3%81%8F%E8%AA%AD%E3%82%80\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(2) 書籍をよく読む\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://www.amazon.co.jp/dp/4822253805\" rel=\"nofollow noopener\" target=\"_blank\"\u003eプログラミング ASP.NET Core - Microsoft Press\u003c/a\u003e（日本での出版日：2019年5月27日 5200円+税）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eリンクを貼るためにAmazonをみて気づいたのですが、この本、税込で5600円もするんですね・・。私には非常に有用で、後悔はしませんでした。基本的なMVC、Razor、DI、Entity Framework CoreなどのO/RM、ASP.NET Identity、Ajax連携など、一通り網羅されています。\u003c/p\u003e\n\n\u003cp\u003eまだまだ理解しきれていないところも多いのですが、この１冊で大体は分かった気になれます。サンプルコードも、程よく実用的なサイズで理解しやすいです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/despos/progcore\" rel=\"nofollow noopener\" target=\"_blank\"\u003eProgramming ASP.NET Core - GitHub Repository\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"3-先人に学ぶ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-%E5%85%88%E4%BA%BA%E3%81%AB%E5%AD%A6%E3%81%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(3) 先人に学ぶ\u003c/h2\u003e\n\n\u003cp\u003eQiitaの先人の知恵を学びます。\u003ccode\u003eASP.NET Core\u003c/code\u003eで検索して、今回の勉強に直接参考になったものを抜粋します。ASP.NET Coreというよりも、Visual Studio Codeに焦点を合わせていたり、gulpなどなどのツール類の話が中心のものは、あまり読んでいません。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://qiita.com/ikuhanaRock/items/af103cec2b05281f0ce4\" id=\"reference-e0b61cd7471d8c60b952\"\u003eはじめてのASP.NET Core\u003c/a\u003e\u003cbr\u003e\nプロジェクト開始直後に何をしていいのか、なんとなく理解できるようになりました\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://qiita.com/Nossa/items/d48fbe91ca470748a3d7\" id=\"reference-6b12f23f0921a7195061\"\u003e【C#】コードファーストで DB に 初期データ入れる\u003c/a\u003e\u003cbr\u003e\nこの記事でEntity Framework Coreの使い方についての実装イメージが湧くようになりました\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"4-visual-studio-for-mac-ではweb-appsデプロイ後のリモートデバッグができない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-visual-studio-for-mac-%E3%81%A7%E3%81%AFweb-apps%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E5%BE%8C%E3%81%AE%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(4) Visual Studio for Mac ではWeb Appsデプロイ後のリモートデバッグができない\u003c/h2\u003e\n\n\u003cp\u003e私が知らないだけかもしれません。\u003ccode\u003eホーム \u0026gt; App Service \u0026gt; 構成 \u0026gt; 全般設定\u003c/code\u003eでリモートの設定が変更できるのですが、Visual Studio for Macの項目は無いようです。また、Visual Studioも2015/2017/2019での機能となっています（さすがに2012でAzureの機能開発はできないと思いますが・・）。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/43991820\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVisual Studio for Mac azure remote debugging on Mac OS X\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e回答は締め切られていないですが、同様に悩んでいる人もいるようです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"5-application-insights-は必ず設定しておく\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-application-insights-%E3%81%AF%E5%BF%85%E3%81%9A%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%A6%E3%81%8A%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(5) Application Insights は必ず設定しておく\u003c/h2\u003e\n\n\u003cp\u003eVisual Studio for Macでリモートデバッグができなかったので、各種本番環境での不具合は\u003ccode\u003eprintf\u003c/code\u003eデバッグに頼るしかありませんでした。しかしながら、例外をApplication Insightsが捕捉してくれたので、ステップ実行ほどの利便性は無いものの、デバッグに役立てることができました。\u003c/p\u003e\n\n\u003cp\u003e基本的には開発環境（ローカル）でデバッグしていましたので、本番環境と異なる部分だけデプロイ後のデバッグが必要でした。今回の開発環境と本番環境の差異は以下の通りでした。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003e\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e開発環境\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e本番環境\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eデータベース\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003eSQLite\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003eMySQL In App\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eストレージ\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003eAzurite\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003eAzure Storage Blob\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"6-デフォルトのデバッグ環境は-development-となる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6-%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E7%92%B0%E5%A2%83%E3%81%AF-development-%E3%81%A8%E3%81%AA%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(6) デフォルトのデバッグ環境は \u003ccode\u003eDevelopment\u003c/code\u003e となる\u003c/h2\u003e\n\n\u003cp\u003eデバッグ環境では \u003ccode\u003e#if DEBUG\u003c/code\u003e なども使えますが、EnvironmentとしてはDevelopmentが設定されています。そのため、タグヘルパーを正しく設定していれば、以下のようなコードが有効になるわけです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;environment\u003c/span\u003e \u003cspan class=\"na\"\u003einclude=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Development\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;div\u0026gt;\u003c/span\u003e\u003cspan class=\"ni\"\u003e\u0026amp;lt;\u003c/span\u003eenvironment include=\"Development\"\u003cspan class=\"ni\"\u003e\u0026amp;gt;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/environment\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;environment\u003c/span\u003e \u003cspan class=\"na\"\u003eexclude=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Development\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;div\u0026gt;\u003c/span\u003e\u003cspan class=\"ni\"\u003e\u0026amp;lt;\u003c/span\u003eenvironment exclude=\"Development\"\u003cspan class=\"ni\"\u003e\u0026amp;gt;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/environment\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;environment\u003c/span\u003e \u003cspan class=\"na\"\u003einclude=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Staging,Development,Staging_2\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;div\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"ni\"\u003e\u0026amp;lt;\u003c/span\u003eenvironment include=\"Staging,Development,Staging_2\"\u003cspan class=\"ni\"\u003e\u0026amp;gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/environment\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.microsoft.com/ja-jp/aspnet/core/fundamentals/environments\" rel=\"nofollow noopener\" target=\"_blank\"\u003eASP.NET Core で複数の環境を使用する\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこの設定はプロジェクトのオプションから変更可能です。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/643f2dd114c4bf99cc3f79b81ee275ec886205ee/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f373838362f30386637656437612d386238382d356338632d393862362d3132373161313333376565662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2F08f7ed7a-8b88-5c8c-98b6-1271a1337eef.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3a9ada96bc16bb308a10ca4b826f5d17\" alt=\"Environmentの環境を切り替える\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7886/08f7ed7a-8b88-5c8c-98b6-1271a1337eef.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2F08f7ed7a-8b88-5c8c-98b6-1271a1337eef.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1c50084d65e08e065273d4aa1376a47c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"7-接続文字列はソースコードに書かない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#7-%E6%8E%A5%E7%B6%9A%E6%96%87%E5%AD%97%E5%88%97%E3%81%AF%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AB%E6%9B%B8%E3%81%8B%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(7) 接続文字列はソースコードに書かない\u003c/h2\u003e\n\n\u003cp\u003e例えば、Azure Storage Blobの接続文字列が漏れてしまった場合、他人にデータをアップロードされたり、自分のデータがダウンロードされてしまう危険性があります。ウェブで公開するデータがダウンロードされるだけなら問題ありませんが、非常に大きなデータをアップロードされてしまうとクラウド死を迎えてしまいます。しかしながら、ソースコードをGitHubなどで公開しておきたいとも思うはずです。\u003c/p\u003e\n\n\u003cp\u003eそこで、\u003ccode\u003eホーム \u0026gt; App Service \u0026gt; 構成 \u0026gt; アプリケーション設定 \u0026gt; 接続文字列\u003c/code\u003eに全て保存し、ソースコードには記述しないよう気をつけます。なお、開発環境（特にローカルPCのエミュレーション環境）については、漏洩してもアクセスできないと思われるので、（私は）そのまま書いてしまっています。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/0e206f760e2435aa7ceae0150115ad74ff637df5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f373838362f32653639386437312d363437302d643532392d383065332d6462386430653362326339642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2F2e698d71-6470-d529-80e3-db8d0e3b2c9d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=85e352c3b295c2107a4a28bc12b5e6f0\" alt=\"接続文字列の設定\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7886/2e698d71-6470-d529-80e3-db8d0e3b2c9d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2F2e698d71-6470-d529-80e3-db8d0e3b2c9d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e444a8dbb8aea11fb08473c486d72346 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこんな感じでアクセスして、接続文字列を取得します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eTest.Controllers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eStorageController\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eController\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eIConfiguration\u003c/span\u003e \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eStorageController\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIConfiguration\u003c/span\u003e \u003cspan class=\"n\"\u003e_config\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econfig\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_config\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpload\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econnectionString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetConnectionString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MYSQL_ProductionServer\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"8-macos上でazure-storage-blobをエミュレートする場合はazuriteを使う\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#8-macos%E4%B8%8A%E3%81%A7azure-storage-blob%E3%82%92%E3%82%A8%E3%83%9F%E3%83%A5%E3%83%AC%E3%83%BC%E3%83%88%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AFazurite%E3%82%92%E4%BD%BF%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(8) macOS上でAzure Storage Blobをエミュレートする場合はAzuriteを使う\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/miyake/items/83aac5524be91e3811ee#azurite\" id=\"reference-eaf31970d5e6c07e0833\"\u003eAzure Functions V2 を Mac+VSCode で動かすまでの手順 \u0026gt; Azurite\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAzuriteを参考にさせていただきました。インストールは非常に簡単でした。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003enpm \u003cspan class=\"nb\"\u003einstall\u003c/span\u003e \u003cspan class=\"nt\"\u003e-g\u003c/span\u003e azurite\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003e/var/tmp/azurite\u003c/code\u003eディレクトリを作成し、起動用のディレクトリとしました。\u003cbr\u003e\nただ、ここは起動のたびに削除されるので、永続的なストレージが必要なら別の場所がいいと思います。（参考先だと\u003ccode\u003e~/azurite\u003c/code\u003eになっていますね）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eazurite \u003cspan class=\"nt\"\u003e-l\u003c/span\u003e /var/tmp/azurite\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"9-macos上でデータベースを使うならsqliteが楽\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#9-macos%E4%B8%8A%E3%81%A7%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E3%81%86%E3%81%AA%E3%82%89sqlite%E3%81%8C%E6%A5%BD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(9) macOS上でデータベースを使うならSQLiteが楽\u003c/h2\u003e\n\n\u003cp\u003emacOSには標準でSQLite3が入っているはずなので、開発環境でのデータベースはSQLite3を使うのが手っ取り早いはずです（たぶん）。\u003c/p\u003e\n\n\u003cp\u003e設定を以下のようにしておきます。\u003ccode\u003e/var/tmp/JobDatabase.db\u003c/code\u003eファイルに保存されますが、上記の通り、\u003ccode\u003e/var/tmp\u003c/code\u003eが永続的なファイル保存場所では無いのでご注意ください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eappsettings.Development.json\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"ConnectionStrings\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"JobDatabase\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Data Source=/var/tmp/JobDatabase.db\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eSQLiteもMySQLと同じようにプロバイダとして \u003ccode\u003eMicrosoft.EntityFrameworkCore.Sqlite\u003c/code\u003e をNuGetでインストールし、以下のようなコードを書くだけで、アクセスできるようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eTest\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eStartup\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eIConfiguration\u003c/span\u003e \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eStartup\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIHostingEnvironment\u003c/span\u003e \u003cspan class=\"n\"\u003e_env\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIConfiguration\u003c/span\u003e \u003cspan class=\"n\"\u003e_config\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econfig\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_config\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eConfigureServices\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIServiceCollection\u003c/span\u003e \u003cspan class=\"n\"\u003eservices\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eservices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAddDbContext\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eJobDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eoptions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econnectionString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetConnectionString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"JobDatabase\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUseSqlite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econnectionString\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"10-プロジェクトは空の状態から作る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#10-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AF%E7%A9%BA%E3%81%AE%E7%8A%B6%E6%85%8B%E3%81%8B%E3%82%89%E4%BD%9C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(10) プロジェクトは空の状態から作る\u003c/h2\u003e\n\n\u003cp\u003eサンプルで用意されているプロジェクトは、今後大きくスケールする可能性があるか、スケールする可能性のない小さいものが多いようです。必死に理解しながら修正していると、勉強をしているのか、システムの改修案件に精をだしているのか分からなくなります。\u003c/p\u003e\n\n\u003cp\u003e空のプロジェクトから始め、MVCならView(Razor ビューエンジン)→Controller(クリックして発火)→Model(データ更新)→.. のように順を追って、少しずつ作り上げていく方が理解が早いです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"11-startupである必要はない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#11-startup%E3%81%A7%E3%81%82%E3%82%8B%E5%BF%85%E8%A6%81%E3%81%AF%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(11) Startupである必要はない\u003c/h2\u003e\n\n\u003cp\u003eプログラムの開始は\u003ccode\u003eProgram.Main\u003c/code\u003eです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateWebHostBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eBuild\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIWebHostBuilder\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateWebHostBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebHost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateDefaultBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUseStartup\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eStartup\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eここで、\u003ccode\u003eUseStartup\u0026lt;Startup\u0026gt;()\u003c/code\u003e の部分を書き換えればよいのです。なんで Startup なんだろう・・？ではなく、なんでもよいがデフォルトは Startup になっている、ということでした。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"12-_viewimportscshtml-に共通で使用するディレクティブを書く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#12-_viewimportscshtml-%E3%81%AB%E5%85%B1%E9%80%9A%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%82%92%E6%9B%B8%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(12) \u003ccode\u003e_ViewImports.cshtml\u003c/code\u003e に共通で使用するディレクティブを書く\u003c/h2\u003e\n\n\u003cp\u003eタグヘルパーを使うには以下のようなコードが必要になります。各View（.cshtml）の先頭に書いてもいいのですが、同じものであればまとめることができます。\u003ccode\u003e_ViewImports.cshtml\u003c/code\u003eはファイル名そのものが意味を持っており、左記の機能を実現するために使われます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなお、ちゃんとドキュメントを読んでいれば、書いてあります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.microsoft.com/ja-jp/aspnet/core/mvc/views/layout?view=aspnetcore-2.2#importing-shared-directives\" rel=\"nofollow noopener\" target=\"_blank\"\u003eASP.NET Core ドキュメント \u0026gt; Web アプリ \u0026gt; レイアウト\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"13-_viewstartcshtml-に共通で使用するレイアウトを書く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#13-_viewstartcshtml-%E3%81%AB%E5%85%B1%E9%80%9A%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%82%92%E6%9B%B8%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(13) \u003ccode\u003e_ViewStart.cshtml\u003c/code\u003e に共通で使用するレイアウトを書く\u003c/h2\u003e\n\n\u003cp\u003e同じレイアウト（テンプレート）を使いまわしたいときは、先頭に以下のような設定をします。これにより、レイアウトとして、\u003ccode\u003e_Layout.cshtml\u003c/code\u003eを使用し、\u003ccode\u003e@RenderBody\u003c/code\u003eにView本体の記述が入ることになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e@{\n    Layout = \"_Layout\";\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eしかし、これを全部のViewに書くのはナンセンスです。\u003ccode\u003e_ViewStart.cshtml\u003c/code\u003eに書いておけば事足ります。ちなみにこれもドキュメントにきちんと書かれています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.microsoft.com/ja-jp/aspnet/core/mvc/views/layout?view=aspnetcore-2.2#running-code-before-each-view\" rel=\"nofollow noopener\" target=\"_blank\"\u003eASP.NET Core ドキュメント \u0026gt; Web アプリ \u0026gt; 各ビューの前にコードを実行する\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"14-ensurecreatedはmainで呼んでしまう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#14-ensurecreated%E3%81%AFmain%E3%81%A7%E5%91%BC%E3%82%93%E3%81%A7%E3%81%97%E3%81%BE%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(14) EnsureCreated()は\u003ccode\u003eMain\u003c/code\u003eで呼んでしまう\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eEnsureCreated\u003c/code\u003e（データベースが存在しない場合、スキーマを流し込んでくれます）を呼びたいです。\u003ccode\u003eIServiceCollection.AddDbContext\u003c/code\u003eの前に、です。そんな時にもサンプルがあるんです、公式ならね。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.microsoft.com/ja-jp/aspnet/core/data/ef-rp/intro?view=aspnetcore-2.2\u0026amp;tabs=visual-studio#update-main\" rel=\"nofollow noopener\" target=\"_blank\"\u003eASP.NET Core ドキュメント \u0026gt; データアクセス \u0026gt; チュートリアル \u0026gt; EF CoreとRazor Pages\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eContosoUniversity.Models\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e                   \u003cspan class=\"c1\"\u003e// SchoolContext\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.AspNetCore\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.AspNetCore.Hosting\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.Extensions.DependencyInjection\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// CreateScope\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.Extensions.Logging\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eContosoUniversity\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateWebHostBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eBuild\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003escope\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eServices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateScope\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eservices\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eServiceProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eservices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetRequiredService\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSchoolContext\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEnsureCreated\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elogger\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eservices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetRequiredService\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eILogger\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eProgram\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;();\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLogError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"An error occurred creating the DB.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIWebHostBuilder\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateWebHostBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eWebHost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateDefaultBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUseStartup\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eStartup\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"15-開発目的ならazure-database-for-mysqlを契約しなくても良い\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#15-%E9%96%8B%E7%99%BA%E7%9B%AE%E7%9A%84%E3%81%AA%E3%82%89azure-database-for-mysql%E3%82%92%E5%A5%91%E7%B4%84%E3%81%97%E3%81%AA%E3%81%8F%E3%81%A6%E3%82%82%E8%89%AF%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(15) 開発目的ならAzure Database for MySQLを契約しなくても良い\u003c/h2\u003e\n\n\u003cp\u003eAzure Database for MySQL を東日本リージョンで使用する場合、1時間あたり5.824円かかります。1ヶ月（Azureでの1ヶ月=730時間)では、4251円かかります。実験が終わったら止めればいいのですが、万が一止め忘れてしまったら・・。それにAzure App ServiceがFree版なのに、MySQLだけお金を取られるのも微妙です。\u003c/p\u003e\n\n\u003cp\u003eそんな時に便利なのが、MySQL In App です。こちらで設定できます。接続文字列も環境変数で提供される親切仕様。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/a4fc5a8251b478f205fd57a2b6c2897dc411b32c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f373838362f65666563376337312d663066372d353038302d386363342d6231323037386131636561332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2Fefec7c71-f0f7-5080-8cc4-b12078a1cea3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c4a6f5de1da8492f14b99aed0e3b1965\" alt=\"MySQL In App\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7886/efec7c71-f0f7-5080-8cc4-b12078a1cea3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2Fefec7c71-f0f7-5080-8cc4-b12078a1cea3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8d6913e17f657ae2ad75bcc5d4e6f8a4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"16-mysql-in-app-で用意される-mysqlconnstr_localdb-は間違っている\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#16-mysql-in-app-%E3%81%A7%E7%94%A8%E6%84%8F%E3%81%95%E3%82%8C%E3%82%8B-mysqlconnstr_localdb-%E3%81%AF%E9%96%93%E9%81%95%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(16) MySQL In App で用意される \u003ccode\u003eMYSQLCONNSTR_localdb\u003c/code\u003e は間違っている\u003c/h2\u003e\n\n\u003cp\u003e接続文字列は正しく取得できていて、設定もされている（試しに違うサーバーの接続文字列を試すとうまくいく）のですけど、MySQL In Appだけは接続できない。諦めるか否か悩んでいたところ、一つのポストを見つけました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://social.msdn.microsoft.com/Forums/en-US/7e577b74-bbc8-41ea-a5e4-075b0eaa8622/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eASP.NET Core MVC and MySql in App\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eI finally found the problem!!!\u003cbr\u003e\nConnection string that Azure give to me in env variable MYSQLCONNSTR_localdb is WRONG!!!\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e嘘だよね・・。与えられた接続文字列ではアクセスできないよってことらしいのですが、バグを2年も放置するはずがないので、使い方が違うのかも。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eNG: Database=localdb;Data Source=127.0.0.1:PPPPP;User Id=azure;Password=XXXXX\nOK: server=127.0.0.1;userid=azure;password=XXXXX;database=localdb;Port=PPPPP\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eというわけで、ポート番号とパスワード以外は固定だと思われるので、その部分だけ動的に変更して接続文字列を作るようにしました。ここでしか使わないのでベタ書きです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econnectionString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEnvironmentVariable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MYSQLCONNSTR_localdb\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edictionary\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econnectionString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e';'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                                 \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'='\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                                 \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003cspan class=\"n\"\u003econnectionString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"server=127.0.0.1;userid=azure;password=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003edictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Password\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]}\u003c/span\u003e\u003cspan class=\"s\"\u003e;database=localdb;Port=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003edictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Data Source\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e':'\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUseMySql\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econnectionString\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"17-mysqldataentityframeworkcore-ではなく-pomeloentityframeworkcoremysql-を使う\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#17-mysqldataentityframeworkcore-%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8F-pomeloentityframeworkcoremysql-%E3%82%92%E4%BD%BF%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(17) \u003ccode\u003eMySql.Data.EntityFrameworkCore\u003c/code\u003e ではなく \u003ccode\u003ePomelo.EntityFrameworkCore.Mysql\u003c/code\u003e を使う\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eSystem.InvalidCastException: Unable to cast object of type System.Boolean to type System.Int16\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eエラーが出ました。スキーマもデータも見直したし、ステップ実行して、不正なデータが混入していないことも確認したんです。たぶん。どうやっても解決できなかったのですが、これまた一つのポストを見つけました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/56424727\" rel=\"nofollow noopener\" target=\"_blank\"\u003eEntity Framework Core DbContext.SaveChanges throws System.InvalidCastException: Unable to cast object of type System.Boolean to type System.Int16\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThis is a bug in the MySQL EF.Core implementation: bug 93028.\u003cbr\u003e\nOn other sites, people have reported fixing the issue by switching to Pomelo.EntityFrameworkCore.MySql.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e嘘だよね・・。というわけで、NuGetパッケージから \u003ccode\u003eMySql.Data.EntityFrameworkCore\u003c/code\u003e を削除し、\u003ccode\u003ePomelo.EntityFrameworkCore.Mysql\u003c/code\u003e をインストールするだけでこの問題は解決しました。ちなみに、メソッド名が微妙に違っておりまして、\u003ccode\u003eUseMySQL\u003c/code\u003e から \u003ccode\u003eUseMySql\u003c/code\u003e になってました。プロバイダ違いを明確にするためなのか・・な？\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"18-azure-app-service-に設定されている環境変数などは-kudu-で見る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#18-azure-app-service-%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%AA%E3%81%A9%E3%81%AF-kudu-%E3%81%A7%E8%A6%8B%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(18) Azure App Service に設定されている環境変数などは Kudu で見る\u003c/h2\u003e\n\n\u003cp\u003e上部メニューのEnvironmentから設定されている環境変数の一覧を見ることができます。また、\u003ccode\u003eDebug Console \u0026gt; CMD\u003c/code\u003eではVM内のファイルなども見ることができ、\u003ccode\u003e/home/data/mysql/MYSQLCONNSTR_localdb.ini\u003c/code\u003eにはMySQL In Appへの正しい接続文字列が格納されていたりします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/f6379a08cfbb49053a18d9f5dcb30be1db51df77/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f373838362f64326634326532372d613336662d366561632d356639372d6539396433626237373662622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2Fd2f42e27-a36f-6eac-5f97-e99d3bb776bb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=544766b23bc38000ee7f9378c129a0cc\" alt=\"Kuduを起動する\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7886/d2f42e27-a36f-6eac-5f97-e99d3bb776bb.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2Fd2f42e27-a36f-6eac-5f97-e99d3bb776bb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c8d842f0a1b27ed99375f186a5bef0e5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/876169abfafdf93066d2a0ae6683a1057dbfcb76/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f373838362f64326230343934612d343564642d356630642d633438362d6564333264353264303232352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2Fd2b0494a-45dd-5f0d-c486-ed32d52d0225.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9a7923d4be20ceac051064344958564e\" alt=\"環境変数を確認する\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7886/d2b0494a-45dd-5f0d-c486-ed32d52d0225.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F7886%2Fd2b0494a-45dd-5f0d-c486-ed32d52d0225.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5d0771bff286fd17eaf7ae3d2f269958 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"19-mysql-in-app-のデータは-phpmyadmin-で確認する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#19-mysql-in-app-%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AF-phpmyadmin-%E3%81%A7%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(19) MySQL In App のデータは phpMyAdmin で確認する\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eホーム \u0026gt; App Service \u0026gt; MySQL In App \u0026gt; 管理\u003c/code\u003eから phpMyAdmin にアクセスできます。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eAn attempt was made to access a socket in a way forbidden by its access permissions.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eなどのエラーが発生する場合、App Service自体がスリープになってしまっている可能性があります。MySQL In AppはApp ServiceのVM上でホストされているため、これがスリープしているとアクセスできません。（ちなみにInternal Server Errorなどにより、App Serviceが落ちてしまったり、起動できなかったりしても同じです）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003e新しいことを学ぶのはとても楽しかったです。同時に、「やればできるだろう」と『やってみた』の差がいかに大きいかということも改めて実感しました。\u003c/p\u003e\n\n\u003cp\u003e今回は、初めてのことが多くて手が出せなかった分野も多くあります。ASP.NET Identityによる認証や、認可といったセキュリティ部分、ロギングや例外処理といったアプリケーションの運用のために必要不可欠な部分などです。\u003c/p\u003e\n\n\u003cp\u003eこの記事が誰かのお役にたてば幸いです。\u003cbr\u003e\nここまでお読みいただき、ありがとうございました。\u003c/p\u003e\n","createdAt":"2019-08-14T09:34:39Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"ar0MScOtZUU8FABIjNhrA6fMqn22ZNAs--7eOO1yFFEJFPTjjI--hyoWPX3XqU+QUkTApMx94Q==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-03-19T09:07:05Z","likesCount":40,"linkUrl":"https://qiita.com/hydrangeas/items/b1f517130309c56eb0ec","organization":null,"originalId":999363,"stockedCount":59,"title":"ASP.NET Coreを始める前に知っておきたい19のこと","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%93%E3%81%A8%E3%81%AF%E3%81%98%E3%82%81\"\u003eことはじめ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1-%E5%85%AC%E5%BC%8F%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E3%82%88%E3%81%8F%E8%AA%AD%E3%82%80\"\u003e(1) 公式ドキュメントをよく読む\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-%E6%9B%B8%E7%B1%8D%E3%82%92%E3%82%88%E3%81%8F%E8%AA%AD%E3%82%80\"\u003e(2) 書籍をよく読む\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3-%E5%85%88%E4%BA%BA%E3%81%AB%E5%AD%A6%E3%81%B6\"\u003e(3) 先人に学ぶ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4-visual-studio-for-mac-%E3%81%A7%E3%81%AFweb-apps%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E5%BE%8C%E3%81%AE%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84\"\u003e(4) Visual Studio for Mac ではWeb Appsデプロイ後のリモートデバッグができない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#5-application-insights-%E3%81%AF%E5%BF%85%E3%81%9A%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%A6%E3%81%8A%E3%81%8F\"\u003e(5) Application Insights は必ず設定しておく\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#6-%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E7%92%B0%E5%A2%83%E3%81%AF-development-%E3%81%A8%E3%81%AA%E3%82%8B\"\u003e(6) デフォルトのデバッグ環境は Development となる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#7-%E6%8E%A5%E7%B6%9A%E6%96%87%E5%AD%97%E5%88%97%E3%81%AF%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AB%E6%9B%B8%E3%81%8B%E3%81%AA%E3%81%84\"\u003e(7) 接続文字列はソースコードに書かない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#8-macos%E4%B8%8A%E3%81%A7azure-storage-blob%E3%82%92%E3%82%A8%E3%83%9F%E3%83%A5%E3%83%AC%E3%83%BC%E3%83%88%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AFazurite%E3%82%92%E4%BD%BF%E3%81%86\"\u003e(8) macOS上でAzure Storage Blobをエミュレートする場合はAzuriteを使う\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#9-macos%E4%B8%8A%E3%81%A7%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E3%81%86%E3%81%AA%E3%82%89sqlite%E3%81%8C%E6%A5%BD\"\u003e(9) macOS上でデータベースを使うならSQLiteが楽\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#10-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AF%E7%A9%BA%E3%81%AE%E7%8A%B6%E6%85%8B%E3%81%8B%E3%82%89%E4%BD%9C%E3%82%8B\"\u003e(10) プロジェクトは空の状態から作る\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#11-startup%E3%81%A7%E3%81%82%E3%82%8B%E5%BF%85%E8%A6%81%E3%81%AF%E3%81%AA%E3%81%84\"\u003e(11) Startupである必要はない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#12-_viewimportscshtml-%E3%81%AB%E5%85%B1%E9%80%9A%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%82%92%E6%9B%B8%E3%81%8F\"\u003e(12) _ViewImports.cshtml に共通で使用するディレクティブを書く\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#13-_viewstartcshtml-%E3%81%AB%E5%85%B1%E9%80%9A%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%82%92%E6%9B%B8%E3%81%8F\"\u003e(13) _ViewStart.cshtml に共通で使用するレイアウトを書く\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#14-ensurecreated%E3%81%AFmain%E3%81%A7%E5%91%BC%E3%82%93%E3%81%A7%E3%81%97%E3%81%BE%E3%81%86\"\u003e(14) EnsureCreated()はMainで呼んでしまう\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#15-%E9%96%8B%E7%99%BA%E7%9B%AE%E7%9A%84%E3%81%AA%E3%82%89azure-database-for-mysql%E3%82%92%E5%A5%91%E7%B4%84%E3%81%97%E3%81%AA%E3%81%8F%E3%81%A6%E3%82%82%E8%89%AF%E3%81%84\"\u003e(15) 開発目的ならAzure Database for MySQLを契約しなくても良い\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#16-mysql-in-app-%E3%81%A7%E7%94%A8%E6%84%8F%E3%81%95%E3%82%8C%E3%82%8B-mysqlconnstr_localdb-%E3%81%AF%E9%96%93%E9%81%95%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B\"\u003e(16) MySQL In App で用意される MYSQLCONNSTR_localdb は間違っている\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#17-mysqldataentityframeworkcore-%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8F-pomeloentityframeworkcoremysql-%E3%82%92%E4%BD%BF%E3%81%86\"\u003e(17) MySql.Data.EntityFrameworkCore ではなく Pomelo.EntityFrameworkCore.Mysql を使う\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#18-azure-app-service-%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%AA%E3%81%A9%E3%81%AF-kudu-%E3%81%A7%E8%A6%8B%E3%82%8B\"\u003e(18) Azure App Service に設定されている環境変数などは Kudu で見る\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#19-mysql-in-app-%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AF-phpmyadmin-%E3%81%A7%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\"\u003e(19) MySQL In App のデータは phpMyAdmin で確認する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":9482,"uuid":"b1f517130309c56eb0ec","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"ofalBJy0j43nOMXwr5OSh+Ho4g==--3lReVBhsnDkoegJW--Et1OSLPOn0jNXKf9iKio5Q==","originalId":7886,"description":"C#やらAzureやらMicrosoft系界隈を中心にお仕事してます。.NET Framework/.NET Coreによるデスクトップアプリケーション、ASP.NET Coreが中心です。副業/複業のお仕事も募集しております。","facebookUrl":null,"githubUrl":"https://github.com/hydrangeas","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"Akira Otaka","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/7886/profile-images/1504182077","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F7886%2Fprofile-images%2F1504182077?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=c285abe816052ac5cc53150a966bd892","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F7886%2Fprofile-images%2F1504182077?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=e67023dffe7cfa584f0f428208d8a3c7","urlName":"hydrangeas","websiteUrl":"","twitterUrl":"https://twitter.com/hyd2501","twitterUrlName":"hyd2501","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Azure","urlName":"azure"},{"name":"AzureStorage","urlName":"azurestorage"},{"name":"ASP.NET_Core","urlName":"asp.net_core"},{"name":"EntityFramework_Core","urlName":"entityframework_core"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

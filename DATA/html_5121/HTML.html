<!DOCTYPE html><html><head><meta charset="utf-8" /><title>【.NET】ラベルプリンター印刷をExcelファイルからPDF変換して行う - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/yaju/items/cd54a0bf46b1bfec4a8f" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="wasrRLP4fyZtGWSxxnBOfRV6mn7h73I+n0MpyRez9xRAoCEhEUlSWVOWOFl2gSK+iS05bLtTtH3yE31qafdZ1g==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@yaju" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="【.NET】ラベルプリンター印刷をExcelファイルからPDF変換して行う - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRTGs1RlZPT0FrZU9EcWVPRG1lT0RxLU9EbC1PRHF1T0RzLU9Ddi1PRHZPV05zT1dJdC1PQ2trVjRZMlZzNDRPVjQ0S2g0NEtrNDRPcjQ0R0w0NEtKVUVSRzVhU0o1by1iNDRHWDQ0R202S0dNNDRHRyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1hMWNhMGI5MDI5NzRiZDdmNjZjZmZiMDE5MTNkZDFlMw&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGxoYW5VJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9Y2EyYzE1OTdmYTM5M2RhOTgyMzBiNjg4ZWRlNTZjN2U&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=9b9c9bd17fea0677f7890f1b05cdb1ce"><meta property="og:description" content="

はじめに

現在、サーバーリプレース作業をしている、その中でDelphi 5で作成されたラベルプリンター印刷用アプリケーションがある。※ちなみにDelphi 5は1999年に発売された。
数ヶ月前には、使用している別のラベルプリン..."><meta content="https://qiita.com/yaju/items/cd54a0bf46b1bfec4a8f" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,.NET,ASP.NET" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-20c6c428-cf6c-4daf-a727-03d65fd5bf30"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fyaju%2Fitems%2Fcd54a0bf46b1bfec4a8f">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fyaju%2Fitems%2Fcd54a0bf46b1bfec4a8f">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-20c6c428-cf6c-4daf-a727-03d65fd5bf30">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-05-20T01:39:37.000+09:00","dateModified":"2019-06-08T13:05:58.000+09:00","headline":"【.NET】ラベルプリンター印刷をExcelファイルからPDF変換して行う","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRTGs1RlZPT0FrZU9EcWVPRG1lT0RxLU9EbC1PRHF1T0RzLU9Ddi1PRHZPV05zT1dJdC1PQ2trVjRZMlZzNDRPVjQ0S2g0NEtrNDRPcjQ0R0w0NEtKVUVSRzVhU0o1by1iNDRHWDQ0R202S0dNNDRHRyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1hMWNhMGI5MDI5NzRiZDdmNjZjZmZiMDE5MTNkZDFlMw\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGxoYW5VJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9Y2EyYzE1OTdmYTM5M2RhOTgyMzBiNjg4ZWRlNTZjN2U\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=9b9c9bd17fea0677f7890f1b05cdb1ce","mainEntityOfPage":"https://qiita.com/yaju/items/cd54a0bf46b1bfec4a8f","author":{"@type":"Person","address":"Shizuoka,Japan","email":null,"identifier":"yaju","name":"yaju","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F14053%2Fprofile-images%2F1473683162?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=136b8707be81c2c47a1fbee1976f4e70","url":"https://qiita.com/yaju","description":"静岡県島田市在住ののシニアSE（元Microsoft MVP 2010-2012）がコンピューター、機械学習、Unity、数学について考える。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yaju","type":"items","id":"cd54a0bf46b1bfec4a8f"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yaju","type":"items","id":"cd54a0bf46b1bfec4a8f"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yaju","type":"items","id":"cd54a0bf46b1bfec4a8f"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/yaju/items/cd54a0bf46b1bfec4a8f","location":"/yaju/items/cd54a0bf46b1bfec4a8f","scheme":"https","host":"qiita.com","port":null,"pathname":"/yaju/items/cd54a0bf46b1bfec4a8f","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"Qgt/lV01mB2KzgOs9Cpb2dAT53CCUrLX/Xi8lO7zKDDDAHXw/4S1YrRBX0RE2zcaTEREYtjudJSQKOg3kLeG8g==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-04edb1d2-687d-49b1-b13d-86719b391476"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yaju/items/cd54a0bf46b1bfec4a8f/likers" class="css-1iupg5d">7</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">14</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/cd54a0bf46b1bfec4a8f/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yaju/items/cd54a0bf46b1bfec4a8f/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yaju/items/cd54a0bf46b1bfec4a8f/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yaju/items/cd54a0bf46b1bfec4a8f/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yaju/items/cd54a0bf46b1bfec4a8f.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/yaju"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/14053/profile-images/1473683162" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/yaju" class="css-10ougpm">@<!-- -->yaju</a><div class="css-1ay9vb9"><span><meta content="2018-05-19T16:39:37Z"/><time dateTime="2019-06-08T04:05:58Z" class="css-m19uds">updated at 2019-06-08</time></span></div></div></div></div></div><h1 class="css-cgzq40">【.NET】ラベルプリンター印刷をExcelファイルからPDF変換して行う</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/.net" class="css-4czcte">.NET</a><a href="/tags/asp.net" class="css-4czcte">ASP.NET</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>現在、サーバーリプレース作業をしている、その中でDelphi 5で作成されたラベルプリンター印刷用アプリケーションがある。※ちなみにDelphi 5は1999年に発売された。<br>
数ヶ月前には、使用している別のラベルプリンターを使用したいとのことで久しぶりにDelphi 5を起動して、新しいラベルフォーマットを追加した。</p>

<p>サーバーリプレースに伴いDelphi 5で開発されたアプリケーションは.NET系に変更していく予定である。</p>

<h1>
<span id="spireoffice" class="fragment"></span><a href="#spireoffice"><i class="fa fa-link"></i></a>Spire.Office</h1>

<p>ラベルフォーマットは、開発者以外でも変更や追加ができることを念頭にExcelで作成し、プレースホルダー文字列(実際の内容を後から挿入するために、とりあえず仮に確保した文字列)を埋め込む仕組みに変更した。</p>

<p>Excelの編集は以前、<a href="https://github.com/JanKallman/EPPlus" rel="nofollow noopener" target="_blank">EPPlus</a>というExcel操作ライブラリーを使用したことがあったので、これを使えばいいと当初は思った。<br>
しかし、EPPlusおよびClosedXMLでは印刷およびPDF出力が出来ないことが分かり、他のライブラリーを探したところ、中国の<a href="https://www.e-iceblue.com/" rel="nofollow noopener" target="_blank">E-iceblue社</a>が提供するofficeの.NETコンポーネントのSpire.Office があり、印刷およびPDF出力をサポートしていることが分かった。<br>
さらに機能制限がある無償版FreeSpire.Officeも提供している。</p>

<p>Spire.officeには、下記コンポーネントが含まれている。個別にダウンロードすることも出来る。</p>

<table>
<thead>
<tr>
<th style="text-align: left">コンポーネント</th>
<th style="text-align: left">内容</th>
<th style="text-align: left">無償版制限</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">Spire.Doc</td>
<td style="text-align: left">Word ファイルの作成・読み・書き・変換・印刷・エクスポート</td>
<td style="text-align: left">Wordファイルの編集は、500段落と25テーブルに制限されています。 \ PDFファイルの変換は最初の3ページのみ。</td>
</tr>
<tr>
<td style="text-align: left">Spire.DocViewer</td>
<td style="text-align: left">Word ファイルの表示・変換</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Spire.XLS</td>
<td style="text-align: left">Excel ファイルの新規作成・編集・変換</td>
<td style="text-align: left">Excelファイルの編集は、ブックごとに5シート、1シートあたり200行に制限されています。</td>
</tr>
<tr>
<td style="text-align: left">Spire.Presentation</td>
<td style="text-align: left">PowerPont ファイルの新規作成・編集・変換</td>
<td style="text-align: left">プレゼンテーションスライドが10枚に制限されています。</td>
</tr>
<tr>
<td style="text-align: left">Spire.PDF</td>
<td style="text-align: left">PDFドキュメントの作成・読み・書き・編集</td>
<td style="text-align: left">PDFファイルの編集は、10ページに制限されています。</td>
</tr>
<tr>
<td style="text-align: left">Spire.PDFViewer</td>
<td style="text-align: left">PDFドキュメントをストリーム、ファイル、バイト配列から読み込み</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Spire.DataExport</td>
<td style="text-align: left">Word/Excel/Access、html、PDF、DBF、SQLスクリプト、csv等の形式にデータをエクスポート</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Spire.Barcode</td>
<td style="text-align: left">バーコードの生成</td>
<td style="text-align: left"></td>
</tr>
</tbody>
</table>

<p>ラベルプリンター印刷用フォーマットに使用する分には機能制限は問題ない。<br>
NuGetからFreeSpire.officeを取得して使用する。</p>

<h1>
<span id="excelファイルからpdf変換" class="fragment"></span><a href="#excel%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8B%E3%82%89pdf%E5%A4%89%E6%8F%9B"><i class="fa fa-link"></i></a>ExcelファイルからPDF変換</h1>

<p>Spire.XLSを使用してExcelファイルを読み込み、セルに埋め込まれたプレースホルダー「@」文字列を書き換えてPDF出力する。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">Workbook</span> <span class="n">workbook</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Workbook</span><span class="p">();</span>
<span class="n">CellRange</span> <span class="n">cell</span> <span class="p">=</span> <span class="n">sheet</span><span class="p">.</span><span class="nf">FindString</span><span class="p">(</span><span class="s">"@PARTNO"</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">cell</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="n">cell</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="s">"1234567890"</span><span class="p">;</span> 
<span class="n">workbook</span><span class="p">.</span><span class="nf">LoadFromFile</span><span class="p">(</span><span class="s">"LBL00001.xlsx"</span><span class="p">);</span>
<span class="n">workbook</span><span class="p">.</span><span class="nf">SaveToFile</span><span class="p">(</span><span class="s">"LBL00001.pdf"</span><span class="p">,</span> <span class="n">Spire</span><span class="p">.</span><span class="n">Xls</span><span class="p">.</span><span class="n">FileFormat</span><span class="p">.</span><span class="n">PDF</span><span class="p">);</span>
</code></pre></div></div>

<h2>
<span id="用紙サイズ" class="fragment"></span><a href="#%E7%94%A8%E7%B4%99%E3%82%B5%E3%82%A4%E3%82%BA"><i class="fa fa-link"></i></a>用紙サイズ</h2>

<p>ラベルプリンターの用紙サイズ(例 55 x 40mm)とする場合、そのままだとExcelファイルのページレイアウトに用紙サイズが出てこない。よって、当初はB5サイズを指定して作成していた。<br>
しかし、B5サイズを縮小した状態でラベルプリンターで印刷されるので、文字が綺麗(現状のものと同レベル)に表示されないということを同僚に指摘され、見直しすることになった。</p>

<p>Excelファイルのページレイアウトに対象の用紙サイズを出すには、対象のラベルプリンター用ドライバーをインストールして、コントロール パネルのデバイスとプリンターにて対象のラベルプリンターを「通常使うプリンターに設定」する。<br>
これで位置や大きさのフォーマットし直して、PDF出力するとA4サイズのままとなってしまう。</p>

<p>ネットで調べて、「ConverterSetting.SheetFitToPage = true」を指定することで対象の用紙サイズでPDF出力されるようになった。</p>

<ul>
<li><a href="https://www.e-iceblue.com/forum/how-to-shrink-excel-content-to-fit-pdf-page-t6441.html" rel="nofollow noopener" target="_blank">How to shrink Excel content to fit PDF page?</a></li>
</ul>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">workbook</span><span class="p">.</span><span class="n">ConverterSetting</span><span class="p">.</span><span class="n">SheetFitToPage</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
<span class="n">workbook</span><span class="p">.</span><span class="nf">SaveToFile</span><span class="p">(</span><span class="s">"LBL00001.pdf"</span><span class="p">,</span> <span class="n">Spire</span><span class="p">.</span><span class="n">Xls</span><span class="p">.</span><span class="n">FileFormat</span><span class="p">.</span><span class="n">PDF</span><span class="p">);</span>
</code></pre></div></div>

<p>正しいExcelファイルが出来てしまえば、ラベルプリンターを「通常使うプリンターに設定」から外してもよい。修正する場合、ラベルプリンターを「通常使うプリンターに設定」にする必要がある。</p>

<h3>
<span id="pdfサイズ変更" class="fragment"></span><a href="#pdf%E3%82%B5%E3%82%A4%E3%82%BA%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>PDFサイズ変更</h3>

<p>もう一つの案として、Spire.PDFを使用してPDFの用紙サイズ(A4)をカスタムサイズ(例 55 x 40mm)にリサイズする。<br>
この方法ならラベルプリンターのドライバーを入れてない環境でも問題ない。</p>

<ul>
<li>
<a href="https://www.e-iceblue.com/forum/need-help-with-creating-pdf-file-with-custom-page-size-t6798.html" rel="nofollow noopener" target="_blank">Need Help with Creating PDF file with Custom Page Size</a>
<a href="https://www.e-iceblue.com/forum/resize-and-merge-a-pdf-document-t5538.html" rel="nofollow noopener" target="_blank">Resize and Merge a PDF Document</a>
</li>
<li><a href="https://www.e-iceblue.com/Tutorials/Spire.PDF/Spire.PDF-Program-Guide/Print/How-to-print-PDF-document-in-C.html" rel="nofollow noopener" target="_blank">Set Graphic Overlay in PDF File</a></li>
</ul>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">PdfDocument</span> <span class="n">doc</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PdfDocument</span><span class="p">();</span>
<span class="n">doc</span><span class="p">.</span><span class="nf">LoadFromFile</span><span class="p">(</span><span class="s">"LBL00001.pdf"</span><span class="p">);</span>

<span class="n">PdfDocument</span> <span class="n">newPdf</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PdfDocument</span><span class="p">();</span>
<span class="n">SizeF</span> <span class="n">size</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SizeF</span><span class="p">(</span><span class="m">55</span><span class="p">*</span><span class="m">3</span><span class="p">,</span> <span class="m">40</span><span class="p">*</span><span class="m">3</span><span class="p">);</span>
<span class="n">PdfPageBase</span> <span class="n">newPage</span> <span class="p">=</span> <span class="n">newPdf</span><span class="p">.</span><span class="n">Pages</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="k">new</span> <span class="nf">PdfMargins</span><span class="p">(</span><span class="m">0</span><span class="p">));</span>
<span class="n">PdfTemplate</span> <span class="n">template</span> <span class="p">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">Pages</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="nf">CreateTemplate</span><span class="p">();</span>
<span class="n">newPage</span><span class="p">.</span><span class="n">Canvas</span><span class="p">.</span><span class="nf">DrawTemplate</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">PointF</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
<span class="n">newPdf</span><span class="p">.</span><span class="nf">SaveToFile</span><span class="p">(</span><span class="s">"result.pdf"</span><span class="p">);</span>
</code></pre></div></div>

<p>※印刷は正常に出来る。</p>

<h1>
<span id="pdfファイルを印刷" class="fragment"></span><a href="#pdf%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E5%8D%B0%E5%88%B7"><i class="fa fa-link"></i></a>PDFファイルを印刷</h1>

<p>PDFファイルを印刷する。</p>

<ul>
<li><a href="https://www.e-iceblue.com/Tutorials/Spire.PDF/Spire.PDF-Program-Guide/Print/How-to-print-PDF-document-in-C.html" rel="nofollow noopener" target="_blank">How to print PDF document in C#</a></li>
<li><a href="https://www.e-iceblue.com/forum/how-to-print-pdf-file-number-of-times-t6201.html" rel="nofollow noopener" target="_blank">How to print PDF file number of times</a></li>
</ul>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">PdfDocument</span> <span class="n">pdf</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PdfDocument</span><span class="p">();</span>
<span class="n">pdf</span><span class="p">.</span><span class="nf">LoadFromFile</span><span class="p">(</span><span class="s">"LBL00001.pdf"</span><span class="p">);</span>
<span class="n">pdf</span><span class="p">.</span><span class="n">PrintSettings</span><span class="p">.</span><span class="n">PrinterName</span> <span class="p">=</span> <span class="n">printerName</span><span class="p">;</span> <span class="c1">//ラベルプリンター名</span>
<span class="n">pdf</span><span class="p">.</span><span class="n">PrintDocument</span><span class="p">.</span><span class="n">PrinterSettings</span><span class="p">.</span><span class="n">Copies</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="c1">//部数</span>
<span class="n">pdf</span><span class="p">.</span><span class="nf">Print</span><span class="p">();</span>  
</code></pre></div></div>

<p>【2018/05/24追記】<br>
使用しているラベルプリンターの標準サイズは68 x 58mm でプリンターのプロパティで用紙登録して55 x 40mm の印刷するように設定していた。<br>
この状態で印刷すると、横向き指定していないのに勝手に横向きになる上にラベル2枚分のサイズで表示されてしまう。<br>
Spire.PDFで、カスタムサイズを印刷する場合は「CustomHandleLandscape = true」を指定することで、横向きから縦向きにすることが出来る。※横向きの横向きは縦向きになる。</p>

<ul>
<li><a href="https://www.e-iceblue.com/forum/landscape-is-useless-t5502.html" rel="nofollow noopener" target="_blank">Landscape is useless</a></li>
</ul>

<p>これで向きの問題は解決したが、次はラベル2枚分のサイズになってしまう問題がある。プリンターのプロパティの用紙のコンボボックスには標準サイズが先頭に登録されていて、次に今回用の用紙が表示されている。もしかしたら、先頭の用紙サイズしか対応できないのかもと用紙編集で標準サイズを68 x 58mm から 55 x 40mm に変更してみたところ、ラベル1枚分のサイズで印刷されるようになった。</p>

<p>【2019/06/08追記】<br>
別のプリンターに対応することになりライブラリーのバージョンを上げたところ、「CustomHandleLandscape = true」とすると横向きに印刷されるようになったので、バグっぽいのが解消されたようです。</p>

<h2>
<span id="pdfサイズの大きさ" class="fragment"></span><a href="#pdf%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AE%E5%A4%A7%E3%81%8D%E3%81%95"><i class="fa fa-link"></i></a>PDFサイズの大きさ</h2>

<p>Spire.XLSでPDF変換するとラベルプリンターの標準サイズ(68 x 58mm)でPDFが作成されてしまう。用紙編集でサイズ変更しても変わらないので、内部の標準サイズが適用されてしまうのだろう。<br>
この状態で印刷すると、用紙サイズに合わせる設定だと少し小さめに印刷されてしまう、かといって実際のサイズの設定だと枠が消えて印刷されてしまう。</p>

<p>ExcelでPDFを生成すると正しいPDFサイズの大きさ(55 x 40mm)で作成される。そこで思いついたのが、下記サイトのようにPDFを重ね合わせる方法である。</p>

<ul>
<li><a href="https://www.e-iceblue.com/Tutorials/Spire.PDF/Spire.PDF-Program-Guide/Set-Graphic-Overlay-in-PDF-File.html" rel="nofollow noopener" target="_blank">Set Graphic Overlay in PDF File</a></li>
</ul>

<p>Excelで枠とラベルのみのPDFを生成、動的な値とQRコードはSpire.XLSのPDF生成し、透明度無しで重ね合わせると、正しいPDFサイズの大きさ(55 x 40mm)の最終結果のPDFが生成できる。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">//PDFのオーバーレイ処理</span>
<span class="n">PdfDocument</span> <span class="n">doc1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PdfDocument</span><span class="p">();</span>
<span class="n">doc1</span><span class="p">.</span><span class="nf">LoadFromFile</span><span class="p">(</span><span class="s">"LBL0001.pdf"</span><span class="p">);</span>

<span class="n">PdfDocument</span> <span class="n">doc2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PdfDocument</span><span class="p">();</span>
<span class="n">doc2</span><span class="p">.</span><span class="nf">LoadFromFile</span><span class="p">(</span><span class="s">"LBL0001_Base.pdf"</span><span class="p">));</span>

<span class="n">PdfTemplate</span> <span class="n">template</span> <span class="p">=</span> <span class="n">doc1</span><span class="p">.</span><span class="n">Pages</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="nf">CreateTemplate</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="n">PdfPageBase</span> <span class="n">page</span> <span class="k">in</span> <span class="n">doc2</span><span class="p">.</span><span class="n">Pages</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">page</span><span class="p">.</span><span class="n">Canvas</span><span class="p">.</span><span class="nf">DrawTemplate</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">PointF</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">doc2</span><span class="p">.</span><span class="nf">SaveToFile</span><span class="p">(</span><span class="s">"result.pdf"</span><span class="p">);</span>
<span class="n">doc1</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
<span class="n">doc2</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
</code></pre></div></div>

<p>これにより、想定したラベルが印刷できるようになった。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">PdfDocument</span> <span class="n">pdf</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PdfDocument</span><span class="p">();</span>
<span class="n">pdf</span><span class="p">.</span><span class="nf">LoadFromFile</span><span class="p">(</span><span class="s">"result.pdf"</span><span class="p">);</span>
<span class="n">pdf</span><span class="p">.</span><span class="n">PrintSettings</span><span class="p">.</span><span class="n">PrinterName</span> <span class="p">=</span> <span class="n">printerName</span><span class="p">;</span> <span class="c1">//ラベルプリンター名</span>
<span class="n">pdf</span><span class="p">.</span><span class="n">CustomHandleLandscape</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="c1">//印刷向き 横向き</span>
<span class="n">pdf</span><span class="p">.</span><span class="n">PageScaling</span> <span class="p">=</span> <span class="n">PdfPrintPageScaling</span><span class="p">.</span><span class="n">ActualSize</span><span class="p">;</span> <span class="c1">//実際の大きさ</span>
<span class="n">pdf</span><span class="p">.</span><span class="n">PrintDocument</span><span class="p">.</span><span class="n">PrinterSettings</span><span class="p">.</span><span class="n">Copies</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="c1">//部数</span>
<span class="n">pdf</span><span class="p">.</span><span class="nf">Print</span><span class="p">();</span>  
</code></pre></div></div>

<h2>
<span id="印字サイズ" class="fragment"></span><a href="#%E5%8D%B0%E5%AD%97%E3%82%B5%E3%82%A4%E3%82%BA"><i class="fa fa-link"></i></a>印字サイズ</h2>

<p>【2019/06/07追記】<br>
ブラザー P-touchで長さを変更したにもかかわらず、反映されないという現象が発生しました。テスト用にWinフォームにボタンのみ追加して試す分には、変更した長さでカットされるのですが、ASP.NETからだと初期の長さのまま。</p>

<p>PaperSizeを指定することで対応した。PaperSizeの指定はインチとなっている。<br>
最新版にSpire.PDFにしたら、これまでの記述が古い形式になってしまっていた。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">PdfDocument</span> <span class="n">pdf</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PdfDocument</span><span class="p">();</span>
<span class="n">pdf</span><span class="p">.</span><span class="nf">LoadFromFile</span><span class="p">(</span><span class="n">resultPath</span><span class="p">);</span>
<span class="n">pdf</span><span class="p">.</span><span class="n">PrintSettings</span><span class="p">.</span><span class="n">PrinterName</span> <span class="p">=</span> <span class="n">printerName</span><span class="p">;</span> <span class="c1">//ラベルプリンター名</span>
<span class="n">pdf</span><span class="p">.</span><span class="n">CustomHandleLandscape</span> <span class="p">=</span> <span class="n">isLandscape</span><span class="p">;</span> <span class="c1">//印刷向き 横向き</span>

<span class="k">if</span><span class="p">(</span><span class="n">paperSize</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//1インチ 25.4mm  例 24.0mm x 100/25.4 = 94  74.0mm x 100/25.4 = 291</span>
    <span class="n">PaperSize</span> <span class="n">paper</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PaperSize</span><span class="p">(</span><span class="s">"Custom"</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">paperSize</span><span class="p">.</span><span class="n">Width</span> <span class="p">*</span> <span class="m">100</span> <span class="p">/</span> <span class="m">25.4</span><span class="p">),</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">paperSize</span><span class="p">.</span><span class="n">Height</span> <span class="p">*</span> <span class="m">100</span> <span class="p">/</span> <span class="m">25.4</span><span class="p">));</span>
    <span class="n">paper</span><span class="p">.</span><span class="n">RawKind</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">PaperKind</span><span class="p">.</span><span class="n">Custom</span><span class="p">;</span>
    <span class="n">pdf</span><span class="p">.</span><span class="n">PrintSettings</span><span class="p">.</span><span class="n">PaperSize</span> <span class="p">=</span> <span class="n">paper</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">pdf</span><span class="p">.</span><span class="n">PrintSettings</span><span class="p">.</span><span class="nf">SelectSinglePageLayout</span><span class="p">(</span><span class="n">PdfSinglePageScalingMode</span><span class="p">.</span><span class="n">ActualSize</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span> <span class="c1">//実際の大きさ</span>
<span class="n">pdf</span><span class="p">.</span><span class="n">PrintDocument</span><span class="p">.</span><span class="n">PrinterSettings</span><span class="p">.</span><span class="n">Copies</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="c1">//部数</span>
<span class="n">pdf</span><span class="p">.</span><span class="nf">Print</span><span class="p">();</span>
</code></pre></div></div>

<h2>
<span id="小さい文字の印字" class="fragment"></span><a href="#%E5%B0%8F%E3%81%95%E3%81%84%E6%96%87%E5%AD%97%E3%81%AE%E5%8D%B0%E5%AD%97"><i class="fa fa-link"></i></a>小さい文字の印字</h2>

<p>MSゴシック 6ptの文字を印字すると、Acrobat Readerでは印字した場合は細い線を保ったまま綺麗な文字で印字されるが、Spire.PDFだと細い線が汚く印字される。もちろんその状態でも問題なく読めるので運用上は困ることはない。綺麗な状態を知っていると残念なところである。</p>

<p><a href="https://camo.qiitausercontent.com/7f56cc9b4c37ee66c6a6cf611f8cd6308d04401f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f31343035332f32636237646338662d393862302d646230372d653065632d3365633338653732646135362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F14053%2F2cb7dc8f-98b0-db07-e0ec-3ec38e72da56.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=80f95fe2441951ea860739c22df191f5" alt="品番.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/14053/2cb7dc8f-98b0-db07-e0ec-3ec38e72da56.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F14053%2F2cb7dc8f-98b0-db07-e0ec-3ec38e72da56.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=dd384ff5969d2320249a7f30e1978e23 1x" loading="lazy"></a><br>
上がAcrobat Readerによる印字、下がSpire.PDFによる印字</p>

<p>かといって、PDFの印刷部分をAcrobat Readerの呼び出しに切り替えるとしてもコマンドラインには部数の指定が無いわけです。<br>
それ以外のPDFの印刷として、「<a href="http://csdicom.blogspot.jp/2017/02/c-itextsharp-ghostscript.html" rel="nofollow noopener" target="_blank">C# と DICOM</a>」の記事を参考に <a href="https://github.com/jhabjan/Ghostscript.NET" rel="nofollow noopener" target="_blank">ghostscript.net</a>も試してみましたが、Spire.PDFと同じ印字状態でした。運用上は困ることはないので、ここは妥協します。</p>

<p>【2019/06/07追記】<br>
Acrobat ReaderはPDFの本家だけに小さいフォントでも印字はきれいです。何か仕組みが違うんですかね。<br>
そのため、PDFの印刷部分をAcrobat Readerに切り替えることも考えたのですが、ASP.NETからだとProcess.Startメソッドを呼べないんですね。権限を変更すれば実行可能かも知れませんが。</p>

<blockquote>
<p>Acrobat Reader/Adobe Reader をサーバーにインストールし、ネットワーク経由で使用する方法は原則的に禁止されています。<br>
<a href="https://helpx.adobe.com/jp/x-productkb/policy-pricing/cpsid_87204.html" rel="nofollow noopener" target="_blank">Acrobat Reader/Adobe Reader のサーバー利用について</a></p>
</blockquote>

<p>それよりも原則禁止されているってことで諦めました。<br>
フォントをMEIRYOなどに変更することで多少は改善されますので、それで対応します。</p>

<h2>
<span id="部数" class="fragment"></span><a href="#%E9%83%A8%E6%95%B0"><i class="fa fa-link"></i></a>部数</h2>

<p>PrintDocument.PrinterSettings.Copiesプロパティで部数を指定できるとあるので、3をセットして実行しても、1部しか印刷されない。</p>

<ul>
<li><a href="https://www.e-iceblue.com/forum/how-to-print-pdf-file-number-of-times-t6201.html" rel="nofollow noopener" target="_blank">How to print PDF file number of times</a></li>
</ul>

<p>よって、部数分繰り返して印刷する。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span> <span class="n">i</span><span class="p">&lt;</span><span class="m">3</span><span class="p">;</span> <span class="n">i</span><span class="p">++){</span>
    <span class="n">PdfDocument</span> <span class="n">pdf</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PdfDocument</span><span class="p">();</span>
    <span class="n">pdf</span><span class="p">.</span><span class="nf">LoadFromFile</span><span class="p">(</span><span class="s">"result.pdf"</span><span class="p">);</span>
    <span class="n">pdf</span><span class="p">.</span><span class="n">PrintSettings</span><span class="p">.</span><span class="n">PrinterName</span> <span class="p">=</span> <span class="n">printerName</span><span class="p">;</span> <span class="c1">//ラベルプリンター名</span>
    <span class="n">pdf</span><span class="p">.</span><span class="n">CustomHandleLandscape</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="c1">//印刷向き 横向き</span>
    <span class="n">pdf</span><span class="p">.</span><span class="n">PageScaling</span> <span class="p">=</span> <span class="n">PdfPrintPageScaling</span><span class="p">.</span><span class="n">ActualSize</span><span class="p">;</span> <span class="c1">//実際の大きさ</span>
    <span class="n">pdf</span><span class="p">.</span><span class="nf">Print</span><span class="p">();</span>
<span class="p">}</span>  
</code></pre></div></div>

<p>他の方法として、部数分のページ分複製したPDFを生成してから印刷する。<br>
この方法では無償版の制限でPDFの編集は10ページまでになっている。</p>

<ul>
<li><a href="https://www.e-iceblue.com/Tutorials/Spire.PDF/Spire.PDF-Program-Guide/Page-Setting/How-to-Duplicate-a-Page-within-a-PDF-Document-in-C-VB.NET.html" rel="nofollow noopener" target="_blank">How to Duplicate a Page within a PDF Document in C#, VB.NET</a></li>
</ul>

<h1>
<span id="qrコードのセット" class="fragment"></span><a href="#qr%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>QRコードのセット</h1>

<p>今回のラベルにはQRコードをセットする必要がある。<br>
Spire.officeには、Spire.BarcodeというQRコードを生成するライブラリーが提供されているのだが、<a href="https://www.keyence.co.jp/ss/products/autoid/codereader/basic2d_qr.jsp" rel="nofollow noopener" target="_blank">QRコードのバージョン</a>指定はサポートしていない。<br>
Spire.Barcodeでは、3つのパラメータ（QRCodeDataMode、QRCodeECL、テキストの長さ）に応じてカウントされるので、パラメータを変化させながらバージョンが異なるようになっている。</p>

<ul>
<li><a href="https://www.e-iceblue.com/forum/qr-code-settings-t6170.html" rel="nofollow noopener" target="_blank">QR Code Settings</a></li>
</ul>

<p>今回、移植元QRコード生成ライブラリーでバージョンを指定してQRコードを生成しているため、バージョンを設定できる<a href="https://github.com/codebude/QRCoder" rel="nofollow noopener" target="_blank">QRCoder</a>をNuGetから取得して使用した。</p>

<p>下記コードでバージョン5の誤り訂正レベルQを使用した場合、qrCode.GetGraphicの第一引数は、pixelsPerModuleで、 1 なら 45 x 45 pixel、20 なら 900 x 900 pixel で生成される。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="nf">CreateQRCode</span><span class="p">(</span><span class="s">"qrcode.png"</span><span class="p">,</span> <span class="s">"1234567890123"</span><span class="p">,</span> <span class="s">"Q"</span><span class="p">,</span> <span class="m">5</span><span class="p">);</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">CreateQRCode</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">,</span> <span class="kt">string</span> <span class="n">content</span><span class="p">,</span> <span class="kt">string</span> <span class="n">eccLevel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">version</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">QRCodeGenerator</span> <span class="n">qrGenerator</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">QRCodeGenerator</span><span class="p">();</span>

    <span class="n">QRCodeGenerator</span><span class="p">.</span><span class="n">ECCLevel</span> <span class="n">level</span> <span class="p">=</span> <span class="p">(</span><span class="n">QRCodeGenerator</span><span class="p">.</span><span class="n">ECCLevel</span><span class="p">)</span><span class="n">Enum</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">QRCodeGenerator</span><span class="p">.</span><span class="n">ECCLevel</span><span class="p">),</span> <span class="n">eccLevel</span><span class="p">);</span>
    <span class="n">QRCodeData</span> <span class="n">qrCodeData</span> <span class="p">=</span> <span class="n">qrGenerator</span><span class="p">.</span><span class="nf">CreateQrCode</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">requestedVersion</span><span class="p">:</span> <span class="n">version</span><span class="p">);</span>
    <span class="n">QRCode</span> <span class="n">qrCode</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">QRCode</span><span class="p">(</span><span class="n">qrCodeData</span><span class="p">);</span>
    <span class="k">using</span> <span class="p">(</span><span class="n">Bitmap</span> <span class="n">bitmap</span> <span class="p">=</span> <span class="n">qrCode</span><span class="p">.</span><span class="nf">GetGraphic</span><span class="p">(</span><span class="m">1</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">bitmap</span><span class="p">.</span><span class="nf">Save</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">ImageFormat</span><span class="p">.</span><span class="n">Png</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これもプレースホルダー文字列を使用して、QRコードを埋め込むようにしている。</p>

<ul>
<li><a href="https://www.e-iceblue.com/Tutorials/Spire.XLS/Spire.XLS-Program-Guide/Image/How-to-Align-a-Picture-within-a-Cell-in-C-VB.NET.html" rel="nofollow noopener" target="_blank">How to Align a Picture within a Cell in C#, VB.NET</a></li>
</ul>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span> <span class="n">picPath</span> <span class="p">=</span> <span class="s">"qrcode.png"";
</span><span class="n">CellRange</span> <span class="n">cell</span> <span class="p">=</span> <span class="n">sheet</span><span class="p">.</span><span class="nf">FindString</span><span class="p">(</span><span class="s">"@QRCODE"</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">range</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="n">ExcelPicture</span> <span class="n">picture</span> <span class="p">=</span> <span class="n">sheet</span><span class="p">.</span><span class="n">Pictures</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">cell</span><span class="p">.</span><span class="n">Row</span><span class="p">,</span> <span class="n">cell</span><span class="p">.</span><span class="n">Column</span><span class="p">,</span> <span class="n">picPath</span><span class="p">);</span>

<span class="n">picture</span><span class="p">.</span><span class="n">LeftColumnOffset</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
<span class="n">picture</span><span class="p">.</span><span class="n">TopRowOffset</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
</code></pre></div></div>

<h1>
<span id="aspnetでバックグラウンド印刷" class="fragment"></span><a href="#aspnet%E3%81%A7%E3%83%90%E3%83%83%E3%82%AF%E3%82%B0%E3%83%A9%E3%82%A6%E3%83%B3%E3%83%89%E5%8D%B0%E5%88%B7"><i class="fa fa-link"></i></a>ASP.NETでバックグラウンド印刷</h1>

<p>今回のラベルプリンターへの印刷処理は、ASP.NETのWebAPIで行っている。<br>
WebAPIを呼ぶ際にタイムアウトを4秒としており、印刷までの一連処理そのままだと4秒超えでタイムアウトしてしまう。</p>

<p>その解消方法をネットで「ASP.NET 重い処理」で検索したところ、下記サイトを見つけた。</p>

<ul>
<li><a href="http://beachside.hatenablog.com/entry/2016/01/30/163500" rel="nofollow noopener" target="_blank">ASP.NET MVC5 とかでバックグラウンド処理（ QueueBackgroundWorkItem 編）</a></li>
<li><a href="http://blog.shibayan.jp/entry/20140902/1409618887" rel="nofollow noopener" target="_blank">ASP.NET 4.5.2 で追加されたバックグラウンド処理 API を使って待つ必要のない非同期処理を丸投げする</a></li>
</ul>

<p>QueueBackgroundWorkItem はASP.NET 4.5.2 で追加されたバックグラウンド処理 APIで待つ必要のない非同期処理を行える。</p>

<p>印刷は待つ必要が無い処理なので、処理を呼び出すと印刷結果に関わらず処理を戻すので、これによりタイムアウトにならなくて済むようになった。</p>

<h2>
<span id="嵌ったこと" class="fragment"></span><a href="#%E5%B5%8C%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>嵌ったこと</h2>

<p>印刷処理が終わった後に、WebAPIを再度呼ぶと処理が遅くなる現象が発生した。当初、BINフォルダ内にPDFファイルを出力していたのだが、これが原因であった。</p>

<p>ASP.NETは仕組み上、BINフォルダ内のファイルの更新を検知すると、アプリケーションを再起動するようになっており、アプリケーションが再起動すると、初期状態になりASP.NETの呼出しに時間がかかってしまうのです。<br>
本来、BINフォルダにはDLLなど滅多に更新されないファイルのみを配置し、頻繁に更新される出力ファイル(PDF)は、別フォルダに作成する必要がありました。</p>

<p>また、QRコードの画像(qrcode.png)を削除しようとしたら、ASP.NETのw3wp.exeが使用中で削除できなかった(上書きも駄目)ため、出力フォルダ内のQRコードの画像やPDF出力のファイル名には日時を追加するようにして回避した。</p>

<p>【2018/05/24追記】<br>
印刷が終わったタイミングで、1日経過した出力したファイルを削除する仕組みを用意した。1日1回はIIS Resetする運用なので使用中状態は遅くてもそこで解除される。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="nf">DeleteByDays</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">DeleteByDays</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">,</span> <span class="kt">int</span> <span class="n">days</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">target</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="nf">AddDays</span><span class="p">(-</span><span class="n">days</span><span class="p">);</span>

    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">Directory</span><span class="p">.</span><span class="nf">GetFiles</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">f</span> <span class="p">=&gt;</span> <span class="n">File</span><span class="p">.</span><span class="nf">GetCreationTime</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">&lt;</span> <span class="n">target</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">ToList</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">ForEach</span><span class="p">(</span><span class="n">f</span> <span class="p">=&gt;</span> <span class="n">File</span><span class="p">.</span><span class="nf">Delete</span><span class="p">(</span><span class="n">f</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">catch</span>
    <span class="p">{</span>
        <span class="c1">//何もしない</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h1>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h1>

<p>最近、技術関連でネット検索していると中国ブログが引っかかる。<br>
今回のSpire.Officeも中国のE-iceblue社で素晴らしいライブラリーを提供してもらい助かっている。中国のOSSライブラリーをサポートすると漢字圏なので、日本語が文字化けするということが発生しない。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fyaju%2Fitems%2Fcd54a0bf46b1bfec4a8f&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fyaju%2Fitems%2Fcd54a0bf46b1bfec4a8f&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yaju/items/cd54a0bf46b1bfec4a8f/likers" class="css-1iupg5d">7</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">14</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/cd54a0bf46b1bfec4a8f/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yaju/items/cd54a0bf46b1bfec4a8f/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yaju/items/cd54a0bf46b1bfec4a8f/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yaju/items/cd54a0bf46b1bfec4a8f/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yaju/items/cd54a0bf46b1bfec4a8f.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-04edb1d2-687d-49b1-b13d-86719b391476">{"authorAnalyticsTrackingId":"UA-46720329-2","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-1867a44e-affc-4277-a4e8-7a841c36c575"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-1867a44e-affc-4277-a4e8-7a841c36c575">{}</script>
      
<div id="LoginModal-react-component-3b837483-e084-46d6-b18d-8453a35373b8"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-3b837483-e084-46d6-b18d-8453a35373b8">{}</script>
      
<div id="StockModal-react-component-f3adcba4-76e8-47c8-b83b-287d28e50047"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-f3adcba4-76e8-47c8-b83b-287d28e50047">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;i2BF133ieWDzLAfuRUR0yqEnB0BWY3b9UDCgDeBGzMwKa0+y31NUH82jWwb1tRgJPXCkUgzfsL49YPSungJiDg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e現在、サーバーリプレース作業をしている、その中でDelphi 5で作成されたラベルプリンター印刷用アプリケーションがある。※ちなみにDelphi 5は1999年に発売された。\u003cbr\u003e\n数ヶ月前には、使用している別のラベルプリンターを使用したいとのことで久しぶりにDelphi 5を起動して、新しいラベルフォーマットを追加した。\u003c/p\u003e\n\n\u003cp\u003eサーバーリプレースに伴いDelphi 5で開発されたアプリケーションは.NET系に変更していく予定である。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"spireoffice\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#spireoffice\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSpire.Office\u003c/h1\u003e\n\n\u003cp\u003eラベルフォーマットは、開発者以外でも変更や追加ができることを念頭にExcelで作成し、プレースホルダー文字列(実際の内容を後から挿入するために、とりあえず仮に確保した文字列)を埋め込む仕組みに変更した。\u003c/p\u003e\n\n\u003cp\u003eExcelの編集は以前、\u003ca href=\"https://github.com/JanKallman/EPPlus\" rel=\"nofollow noopener\" target=\"_blank\"\u003eEPPlus\u003c/a\u003eというExcel操作ライブラリーを使用したことがあったので、これを使えばいいと当初は思った。\u003cbr\u003e\nしかし、EPPlusおよびClosedXMLでは印刷およびPDF出力が出来ないことが分かり、他のライブラリーを探したところ、中国の\u003ca href=\"https://www.e-iceblue.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eE-iceblue社\u003c/a\u003eが提供するofficeの.NETコンポーネントのSpire.Office があり、印刷およびPDF出力をサポートしていることが分かった。\u003cbr\u003e\nさらに機能制限がある無償版FreeSpire.Officeも提供している。\u003c/p\u003e\n\n\u003cp\u003eSpire.officeには、下記コンポーネントが含まれている。個別にダウンロードすることも出来る。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003eコンポーネント\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e内容\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e無償版制限\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eSpire.Doc\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eWord ファイルの作成・読み・書き・変換・印刷・エクスポート\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eWordファイルの編集は、500段落と25テーブルに制限されています。 \\ PDFファイルの変換は最初の3ページのみ。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eSpire.DocViewer\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eWord ファイルの表示・変換\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eSpire.XLS\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eExcel ファイルの新規作成・編集・変換\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eExcelファイルの編集は、ブックごとに5シート、1シートあたり200行に制限されています。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eSpire.Presentation\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ePowerPont ファイルの新規作成・編集・変換\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eプレゼンテーションスライドが10枚に制限されています。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eSpire.PDF\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ePDFドキュメントの作成・読み・書き・編集\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ePDFファイルの編集は、10ページに制限されています。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eSpire.PDFViewer\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ePDFドキュメントをストリーム、ファイル、バイト配列から読み込み\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eSpire.DataExport\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eWord/Excel/Access、html、PDF、DBF、SQLスクリプト、csv等の形式にデータをエクスポート\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eSpire.Barcode\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eバーコードの生成\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eラベルプリンター印刷用フォーマットに使用する分には機能制限は問題ない。\u003cbr\u003e\nNuGetからFreeSpire.officeを取得して使用する。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"excelファイルからpdf変換\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#excel%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8B%E3%82%89pdf%E5%A4%89%E6%8F%9B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eExcelファイルからPDF変換\u003c/h1\u003e\n\n\u003cp\u003eSpire.XLSを使用してExcelファイルを読み込み、セルに埋め込まれたプレースホルダー「@」文字列を書き換えてPDF出力する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eWorkbook\u003c/span\u003e \u003cspan class=\"n\"\u003eworkbook\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWorkbook\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eCellRange\u003c/span\u003e \u003cspan class=\"n\"\u003ecell\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esheet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"@PARTNO\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecell\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003ecell\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1234567890\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \n\u003cspan class=\"n\"\u003eworkbook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadFromFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"LBL00001.xlsx\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eworkbook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSaveToFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"LBL00001.pdf\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSpire\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eXls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFileFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePDF\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"用紙サイズ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%94%A8%E7%B4%99%E3%82%B5%E3%82%A4%E3%82%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e用紙サイズ\u003c/h2\u003e\n\n\u003cp\u003eラベルプリンターの用紙サイズ(例 55 x 40mm)とする場合、そのままだとExcelファイルのページレイアウトに用紙サイズが出てこない。よって、当初はB5サイズを指定して作成していた。\u003cbr\u003e\nしかし、B5サイズを縮小した状態でラベルプリンターで印刷されるので、文字が綺麗(現状のものと同レベル)に表示されないということを同僚に指摘され、見直しすることになった。\u003c/p\u003e\n\n\u003cp\u003eExcelファイルのページレイアウトに対象の用紙サイズを出すには、対象のラベルプリンター用ドライバーをインストールして、コントロール パネルのデバイスとプリンターにて対象のラベルプリンターを「通常使うプリンターに設定」する。\u003cbr\u003e\nこれで位置や大きさのフォーマットし直して、PDF出力するとA4サイズのままとなってしまう。\u003c/p\u003e\n\n\u003cp\u003eネットで調べて、「ConverterSetting.SheetFitToPage = true」を指定することで対象の用紙サイズでPDF出力されるようになった。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.e-iceblue.com/forum/how-to-shrink-excel-content-to-fit-pdf-page-t6441.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHow to shrink Excel content to fit PDF page?\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eworkbook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eConverterSetting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSheetFitToPage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eworkbook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSaveToFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"LBL00001.pdf\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSpire\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eXls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFileFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePDF\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e正しいExcelファイルが出来てしまえば、ラベルプリンターを「通常使うプリンターに設定」から外してもよい。修正する場合、ラベルプリンターを「通常使うプリンターに設定」にする必要がある。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"pdfサイズ変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pdf%E3%82%B5%E3%82%A4%E3%82%BA%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePDFサイズ変更\u003c/h3\u003e\n\n\u003cp\u003eもう一つの案として、Spire.PDFを使用してPDFの用紙サイズ(A4)をカスタムサイズ(例 55 x 40mm)にリサイズする。\u003cbr\u003e\nこの方法ならラベルプリンターのドライバーを入れてない環境でも問題ない。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://www.e-iceblue.com/forum/need-help-with-creating-pdf-file-with-custom-page-size-t6798.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNeed Help with Creating PDF file with Custom Page Size\u003c/a\u003e\n\u003ca href=\"https://www.e-iceblue.com/forum/resize-and-merge-a-pdf-document-t5538.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eResize and Merge a PDF Document\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.e-iceblue.com/Tutorials/Spire.PDF/Spire.PDF-Program-Guide/Print/How-to-print-PDF-document-in-C.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSet Graphic Overlay in PDF File\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ePdfDocument\u003c/span\u003e \u003cspan class=\"n\"\u003edoc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePdfDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003edoc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadFromFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"LBL00001.pdf\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003ePdfDocument\u003c/span\u003e \u003cspan class=\"n\"\u003enewPdf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePdfDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eSizeF\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSizeF\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e55\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e40\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003ePdfPageBase\u003c/span\u003e \u003cspan class=\"n\"\u003enewPage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enewPdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePages\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePdfMargins\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"n\"\u003ePdfTemplate\u003c/span\u003e \u003cspan class=\"n\"\u003etemplate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edoc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePages\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateTemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003enewPage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCanvas\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDrawTemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePointF\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003enewPdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSaveToFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"result.pdf\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e※印刷は正常に出来る。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"pdfファイルを印刷\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pdf%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E5%8D%B0%E5%88%B7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePDFファイルを印刷\u003c/h1\u003e\n\n\u003cp\u003ePDFファイルを印刷する。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.e-iceblue.com/Tutorials/Spire.PDF/Spire.PDF-Program-Guide/Print/How-to-print-PDF-document-in-C.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHow to print PDF document in C#\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.e-iceblue.com/forum/how-to-print-pdf-file-number-of-times-t6201.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHow to print PDF file number of times\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ePdfDocument\u003c/span\u003e \u003cspan class=\"n\"\u003epdf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePdfDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadFromFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"LBL00001.pdf\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrintSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrinterName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eprinterName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ラベルプリンター名\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrintDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrinterSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCopies\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//部数\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrint\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e【2018/05/24追記】\u003cbr\u003e\n使用しているラベルプリンターの標準サイズは68 x 58mm でプリンターのプロパティで用紙登録して55 x 40mm の印刷するように設定していた。\u003cbr\u003e\nこの状態で印刷すると、横向き指定していないのに勝手に横向きになる上にラベル2枚分のサイズで表示されてしまう。\u003cbr\u003e\nSpire.PDFで、カスタムサイズを印刷する場合は「CustomHandleLandscape = true」を指定することで、横向きから縦向きにすることが出来る。※横向きの横向きは縦向きになる。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.e-iceblue.com/forum/landscape-is-useless-t5502.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eLandscape is useless\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこれで向きの問題は解決したが、次はラベル2枚分のサイズになってしまう問題がある。プリンターのプロパティの用紙のコンボボックスには標準サイズが先頭に登録されていて、次に今回用の用紙が表示されている。もしかしたら、先頭の用紙サイズしか対応できないのかもと用紙編集で標準サイズを68 x 58mm から 55 x 40mm に変更してみたところ、ラベル1枚分のサイズで印刷されるようになった。\u003c/p\u003e\n\n\u003cp\u003e【2019/06/08追記】\u003cbr\u003e\n別のプリンターに対応することになりライブラリーのバージョンを上げたところ、「CustomHandleLandscape = true」とすると横向きに印刷されるようになったので、バグっぽいのが解消されたようです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"pdfサイズの大きさ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pdf%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AE%E5%A4%A7%E3%81%8D%E3%81%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePDFサイズの大きさ\u003c/h2\u003e\n\n\u003cp\u003eSpire.XLSでPDF変換するとラベルプリンターの標準サイズ(68 x 58mm)でPDFが作成されてしまう。用紙編集でサイズ変更しても変わらないので、内部の標準サイズが適用されてしまうのだろう。\u003cbr\u003e\nこの状態で印刷すると、用紙サイズに合わせる設定だと少し小さめに印刷されてしまう、かといって実際のサイズの設定だと枠が消えて印刷されてしまう。\u003c/p\u003e\n\n\u003cp\u003eExcelでPDFを生成すると正しいPDFサイズの大きさ(55 x 40mm)で作成される。そこで思いついたのが、下記サイトのようにPDFを重ね合わせる方法である。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.e-iceblue.com/Tutorials/Spire.PDF/Spire.PDF-Program-Guide/Set-Graphic-Overlay-in-PDF-File.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSet Graphic Overlay in PDF File\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eExcelで枠とラベルのみのPDFを生成、動的な値とQRコードはSpire.XLSのPDF生成し、透明度無しで重ね合わせると、正しいPDFサイズの大きさ(55 x 40mm)の最終結果のPDFが生成できる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//PDFのオーバーレイ処理\u003c/span\u003e\n\u003cspan class=\"n\"\u003ePdfDocument\u003c/span\u003e \u003cspan class=\"n\"\u003edoc1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePdfDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003edoc1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadFromFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"LBL0001.pdf\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003ePdfDocument\u003c/span\u003e \u003cspan class=\"n\"\u003edoc2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePdfDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003edoc2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadFromFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"LBL0001_Base.pdf\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003ePdfTemplate\u003c/span\u003e \u003cspan class=\"n\"\u003etemplate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edoc1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePages\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateTemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePdfPageBase\u003c/span\u003e \u003cspan class=\"n\"\u003epage\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003edoc2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePages\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCanvas\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDrawTemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePointF\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003edoc2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSaveToFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"result.pdf\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003edoc1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003edoc2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれにより、想定したラベルが印刷できるようになった。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ePdfDocument\u003c/span\u003e \u003cspan class=\"n\"\u003epdf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePdfDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadFromFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"result.pdf\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrintSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrinterName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eprinterName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ラベルプリンター名\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCustomHandleLandscape\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//印刷向き 横向き\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePageScaling\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePdfPrintPageScaling\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eActualSize\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//実際の大きさ\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrintDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrinterSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCopies\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//部数\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrint\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"印字サイズ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8D%B0%E5%AD%97%E3%82%B5%E3%82%A4%E3%82%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e印字サイズ\u003c/h2\u003e\n\n\u003cp\u003e【2019/06/07追記】\u003cbr\u003e\nブラザー P-touchで長さを変更したにもかかわらず、反映されないという現象が発生しました。テスト用にWinフォームにボタンのみ追加して試す分には、変更した長さでカットされるのですが、ASP.NETからだと初期の長さのまま。\u003c/p\u003e\n\n\u003cp\u003ePaperSizeを指定することで対応した。PaperSizeの指定はインチとなっている。\u003cbr\u003e\n最新版にSpire.PDFにしたら、これまでの記述が古い形式になってしまっていた。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ePdfDocument\u003c/span\u003e \u003cspan class=\"n\"\u003epdf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePdfDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadFromFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresultPath\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrintSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrinterName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eprinterName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ラベルプリンター名\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCustomHandleLandscape\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eisLandscape\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//印刷向き 横向き\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epaperSize\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//1インチ 25.4mm  例 24.0mm x 100/25.4 = 94  74.0mm x 100/25.4 = 291\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePaperSize\u003c/span\u003e \u003cspan class=\"n\"\u003epaper\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePaperSize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Custom\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003epaperSize\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWidth\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e25.4\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003epaperSize\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHeight\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e25.4\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epaper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRawKind\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ePaperKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCustom\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrintSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaperSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epaper\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrintSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelectSinglePageLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePdfSinglePageScalingMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eActualSize\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e//実際の大きさ\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrintDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrinterSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCopies\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//部数\u003c/span\u003e\n\u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrint\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"小さい文字の印字\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%B0%8F%E3%81%95%E3%81%84%E6%96%87%E5%AD%97%E3%81%AE%E5%8D%B0%E5%AD%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e小さい文字の印字\u003c/h2\u003e\n\n\u003cp\u003eMSゴシック 6ptの文字を印字すると、Acrobat Readerでは印字した場合は細い線を保ったまま綺麗な文字で印字されるが、Spire.PDFだと細い線が汚く印字される。もちろんその状態でも問題なく読めるので運用上は困ることはない。綺麗な状態を知っていると残念なところである。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/7f56cc9b4c37ee66c6a6cf611f8cd6308d04401f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f31343035332f32636237646338662d393862302d646230372d653065632d3365633338653732646135362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F14053%2F2cb7dc8f-98b0-db07-e0ec-3ec38e72da56.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=80f95fe2441951ea860739c22df191f5\" alt=\"品番.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/14053/2cb7dc8f-98b0-db07-e0ec-3ec38e72da56.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F14053%2F2cb7dc8f-98b0-db07-e0ec-3ec38e72da56.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=dd384ff5969d2320249a7f30e1978e23 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n上がAcrobat Readerによる印字、下がSpire.PDFによる印字\u003c/p\u003e\n\n\u003cp\u003eかといって、PDFの印刷部分をAcrobat Readerの呼び出しに切り替えるとしてもコマンドラインには部数の指定が無いわけです。\u003cbr\u003e\nそれ以外のPDFの印刷として、「\u003ca href=\"http://csdicom.blogspot.jp/2017/02/c-itextsharp-ghostscript.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eC# と DICOM\u003c/a\u003e」の記事を参考に \u003ca href=\"https://github.com/jhabjan/Ghostscript.NET\" rel=\"nofollow noopener\" target=\"_blank\"\u003eghostscript.net\u003c/a\u003eも試してみましたが、Spire.PDFと同じ印字状態でした。運用上は困ることはないので、ここは妥協します。\u003c/p\u003e\n\n\u003cp\u003e【2019/06/07追記】\u003cbr\u003e\nAcrobat ReaderはPDFの本家だけに小さいフォントでも印字はきれいです。何か仕組みが違うんですかね。\u003cbr\u003e\nそのため、PDFの印刷部分をAcrobat Readerに切り替えることも考えたのですが、ASP.NETからだとProcess.Startメソッドを呼べないんですね。権限を変更すれば実行可能かも知れませんが。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eAcrobat Reader/Adobe Reader をサーバーにインストールし、ネットワーク経由で使用する方法は原則的に禁止されています。\u003cbr\u003e\n\u003ca href=\"https://helpx.adobe.com/jp/x-productkb/policy-pricing/cpsid_87204.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAcrobat Reader/Adobe Reader のサーバー利用について\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eそれよりも原則禁止されているってことで諦めました。\u003cbr\u003e\nフォントをMEIRYOなどに変更することで多少は改善されますので、それで対応します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"部数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%83%A8%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e部数\u003c/h2\u003e\n\n\u003cp\u003ePrintDocument.PrinterSettings.Copiesプロパティで部数を指定できるとあるので、3をセットして実行しても、1部しか印刷されない。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.e-iceblue.com/forum/how-to-print-pdf-file-number-of-times-t6201.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHow to print PDF file number of times\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eよって、部数分繰り返して印刷する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++){\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePdfDocument\u003c/span\u003e \u003cspan class=\"n\"\u003epdf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePdfDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadFromFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"result.pdf\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrintSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrinterName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eprinterName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ラベルプリンター名\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCustomHandleLandscape\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//印刷向き 横向き\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePageScaling\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePdfPrintPageScaling\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eActualSize\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//実際の大きさ\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epdf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrint\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e  \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e他の方法として、部数分のページ分複製したPDFを生成してから印刷する。\u003cbr\u003e\nこの方法では無償版の制限でPDFの編集は10ページまでになっている。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.e-iceblue.com/Tutorials/Spire.PDF/Spire.PDF-Program-Guide/Page-Setting/How-to-Duplicate-a-Page-within-a-PDF-Document-in-C-VB.NET.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHow to Duplicate a Page within a PDF Document in C#, VB.NET\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"qrコードのセット\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#qr%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eQRコードのセット\u003c/h1\u003e\n\n\u003cp\u003e今回のラベルにはQRコードをセットする必要がある。\u003cbr\u003e\nSpire.officeには、Spire.BarcodeというQRコードを生成するライブラリーが提供されているのだが、\u003ca href=\"https://www.keyence.co.jp/ss/products/autoid/codereader/basic2d_qr.jsp\" rel=\"nofollow noopener\" target=\"_blank\"\u003eQRコードのバージョン\u003c/a\u003e指定はサポートしていない。\u003cbr\u003e\nSpire.Barcodeでは、3つのパラメータ（QRCodeDataMode、QRCodeECL、テキストの長さ）に応じてカウントされるので、パラメータを変化させながらバージョンが異なるようになっている。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.e-iceblue.com/forum/qr-code-settings-t6170.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eQR Code Settings\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e今回、移植元QRコード生成ライブラリーでバージョンを指定してQRコードを生成しているため、バージョンを設定できる\u003ca href=\"https://github.com/codebude/QRCoder\" rel=\"nofollow noopener\" target=\"_blank\"\u003eQRCoder\u003c/a\u003eをNuGetから取得して使用した。\u003c/p\u003e\n\n\u003cp\u003e下記コードでバージョン5の誤り訂正レベルQを使用した場合、qrCode.GetGraphicの第一引数は、pixelsPerModuleで、 1 なら 45 x 45 pixel、20 なら 900 x 900 pixel で生成される。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nf\"\u003eCreateQRCode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"qrcode.png\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1234567890123\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Q\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateQRCode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eeccLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eversion\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eQRCodeGenerator\u003c/span\u003e \u003cspan class=\"n\"\u003eqrGenerator\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eQRCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eQRCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eECCLevel\u003c/span\u003e \u003cspan class=\"n\"\u003elevel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQRCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eECCLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eEnum\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQRCodeGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eECCLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eeccLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eQRCodeData\u003c/span\u003e \u003cspan class=\"n\"\u003eqrCodeData\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eqrGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateQrCode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elevel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erequestedVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eversion\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eQRCode\u003c/span\u003e \u003cspan class=\"n\"\u003eqrCode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eQRCode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eqrCodeData\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBitmap\u003c/span\u003e \u003cspan class=\"n\"\u003ebitmap\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eqrCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetGraphic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ebitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eImageFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePng\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれもプレースホルダー文字列を使用して、QRコードを埋め込むようにしている。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.e-iceblue.com/Tutorials/Spire.XLS/Spire.XLS-Program-Guide/Image/How-to-Align-a-Picture-within-a-Cell-in-C-VB.NET.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHow to Align a Picture within a Cell in C#, VB.NET\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003epicPath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"qrcode.png\"\";\n\u003c/span\u003e\u003cspan class=\"n\"\u003eCellRange\u003c/span\u003e \u003cspan class=\"n\"\u003ecell\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esheet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"@QRCODE\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erange\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eExcelPicture\u003c/span\u003e \u003cspan class=\"n\"\u003epicture\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esheet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePictures\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecell\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRow\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecell\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epicPath\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003epicture\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLeftColumnOffset\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003epicture\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTopRowOffset\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"aspnetでバックグラウンド印刷\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#aspnet%E3%81%A7%E3%83%90%E3%83%83%E3%82%AF%E3%82%B0%E3%83%A9%E3%82%A6%E3%83%B3%E3%83%89%E5%8D%B0%E5%88%B7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eASP.NETでバックグラウンド印刷\u003c/h1\u003e\n\n\u003cp\u003e今回のラベルプリンターへの印刷処理は、ASP.NETのWebAPIで行っている。\u003cbr\u003e\nWebAPIを呼ぶ際にタイムアウトを4秒としており、印刷までの一連処理そのままだと4秒超えでタイムアウトしてしまう。\u003c/p\u003e\n\n\u003cp\u003eその解消方法をネットで「ASP.NET 重い処理」で検索したところ、下記サイトを見つけた。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://beachside.hatenablog.com/entry/2016/01/30/163500\" rel=\"nofollow noopener\" target=\"_blank\"\u003eASP.NET MVC5 とかでバックグラウンド処理（ QueueBackgroundWorkItem 編）\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://blog.shibayan.jp/entry/20140902/1409618887\" rel=\"nofollow noopener\" target=\"_blank\"\u003eASP.NET 4.5.2 で追加されたバックグラウンド処理 API を使って待つ必要のない非同期処理を丸投げする\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eQueueBackgroundWorkItem はASP.NET 4.5.2 で追加されたバックグラウンド処理 APIで待つ必要のない非同期処理を行える。\u003c/p\u003e\n\n\u003cp\u003e印刷は待つ必要が無い処理なので、処理を呼び出すと印刷結果に関わらず処理を戻すので、これによりタイムアウトにならなくて済むようになった。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"嵌ったこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%B5%8C%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e嵌ったこと\u003c/h2\u003e\n\n\u003cp\u003e印刷処理が終わった後に、WebAPIを再度呼ぶと処理が遅くなる現象が発生した。当初、BINフォルダ内にPDFファイルを出力していたのだが、これが原因であった。\u003c/p\u003e\n\n\u003cp\u003eASP.NETは仕組み上、BINフォルダ内のファイルの更新を検知すると、アプリケーションを再起動するようになっており、アプリケーションが再起動すると、初期状態になりASP.NETの呼出しに時間がかかってしまうのです。\u003cbr\u003e\n本来、BINフォルダにはDLLなど滅多に更新されないファイルのみを配置し、頻繁に更新される出力ファイル(PDF)は、別フォルダに作成する必要がありました。\u003c/p\u003e\n\n\u003cp\u003eまた、QRコードの画像(qrcode.png)を削除しようとしたら、ASP.NETのw3wp.exeが使用中で削除できなかった(上書きも駄目)ため、出力フォルダ内のQRコードの画像やPDF出力のファイル名には日時を追加するようにして回避した。\u003c/p\u003e\n\n\u003cp\u003e【2018/05/24追記】\u003cbr\u003e\n印刷が終わったタイミングで、1日経過した出力したファイルを削除する仕組みを用意した。1日1回はIIS Resetする運用なので使用中状態は遅くてもそこで解除される。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nf\"\u003eDeleteByDays\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeleteByDays\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003edays\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddDays\u003c/span\u003e\u003cspan class=\"p\"\u003e(-\u003c/span\u003e\u003cspan class=\"n\"\u003edays\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetFiles\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCreationTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToList\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eForEach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//何もしない\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h1\u003e\n\n\u003cp\u003e最近、技術関連でネット検索していると中国ブログが引っかかる。\u003cbr\u003e\n今回のSpire.Officeも中国のE-iceblue社で素晴らしいライブラリーを提供してもらい助かっている。中国のOSSライブラリーをサポートすると漢字圏なので、日本語が文字化けするということが発生しない。\u003c/p\u003e\n","createdAt":"2018-05-19T16:39:37Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"vwi5aIaWPBj6dchUNfVbmfUUqgGhNL9t--ymmlpDRojeIoB4at--HWxVpb9ngyDf45+biDG7VQ==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2019-06-08T04:05:58Z","likesCount":7,"linkUrl":"https://qiita.com/yaju/items/cd54a0bf46b1bfec4a8f","organization":null,"originalId":647341,"stockedCount":14,"title":"【.NET】ラベルプリンター印刷をExcelファイルからPDF変換して行う","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#spireoffice\"\u003eSpire.Office\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#excel%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8B%E3%82%89pdf%E5%A4%89%E6%8F%9B\"\u003eExcelファイルからPDF変換\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%94%A8%E7%B4%99%E3%82%B5%E3%82%A4%E3%82%BA\"\u003e用紙サイズ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#pdf%E3%82%B5%E3%82%A4%E3%82%BA%E5%A4%89%E6%9B%B4\"\u003ePDFサイズ変更\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#pdf%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E5%8D%B0%E5%88%B7\"\u003ePDFファイルを印刷\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#pdf%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AE%E5%A4%A7%E3%81%8D%E3%81%95\"\u003ePDFサイズの大きさ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8D%B0%E5%AD%97%E3%82%B5%E3%82%A4%E3%82%BA\"\u003e印字サイズ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%B0%8F%E3%81%95%E3%81%84%E6%96%87%E5%AD%97%E3%81%AE%E5%8D%B0%E5%AD%97\"\u003e小さい文字の印字\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%83%A8%E6%95%B0\"\u003e部数\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#qr%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88\"\u003eQRコードのセット\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#aspnet%E3%81%A7%E3%83%90%E3%83%83%E3%82%AF%E3%82%B0%E3%83%A9%E3%82%A6%E3%83%B3%E3%83%89%E5%8D%B0%E5%88%B7\"\u003eASP.NETでバックグラウンド印刷\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%B5%8C%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003e嵌ったこと\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e最後に\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":8342,"uuid":"cd54a0bf46b1bfec4a8f","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"BT1a8gUYOYC0xB6mtvOjGMOE25o=--QaZHizDsP30of0/M--kFp15W8sGJpfDq3xGdm+bA==","originalId":14053,"description":"静岡県島田市在住ののシニアSE（元Microsoft MVP 2010-2012）がコンピューター、機械学習、Unity、数学について考える。","facebookUrl":"https://facebook.com/yasuhito.hiraguchi","githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"やじゅ","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/14053/profile-images/1473683162","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F14053%2Fprofile-images%2F1473683162?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=e8f332c4ab4195584754b9e28b9d6458","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F14053%2Fprofile-images%2F1473683162?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=136b8707be81c2c47a1fbee1976f4e70","urlName":"yaju","websiteUrl":"http://yaju3d.hatenablog.jp/","twitterUrl":"https://twitter.com/yaju","twitterUrlName":"yaju","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":".NET","urlName":".net"},{"name":"ASP.NET","urlName":"asp.net"}],"followingLikers":{"edges":[]},"comments":{"totalCount":2}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

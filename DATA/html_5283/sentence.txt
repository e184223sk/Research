More than 3 years have passed since last update.Azure BLOB Storageを使ってファイルを扱いたいけど検索って出来るの？やったことないので分かりやすいサンプルがあると助かるなーって思っていた人。C#er。Azure SDKがインストールされていること。container1というコンテナに
folder1/folder2/sample1.txt
folder1/folder2/sample2.txt
というファイル名が存在していた場合、この２ファイルの名称が取得できます。本題はこちらのつもりです。先に示した前方一致の検索がある前提を理解しないと、ここからの内容が役に立ちませんので先に実装方式を記載しました。コンテナ名を決めるための理由は、大きく分けて以下があります。一括で消したい場合はコンテナ単位が速いパーティションはコンテナ単位ということで、一番ダメな例は「SeonsorData」などの、上記２つのメリットのどちらも享受できない命名となります。ファイル名には/が使えますので子フォルダがあるように見えますが、実際は/も文字列として使えるだけのファイル名になります。
先の例で "folder1/folder2/sample1.txt" というファイル名を検索する場合に "folder1/folder2/samp" , "folder1/fol" のどちらでもこのファイルは検索されました。この挙動を踏まえてファイル名を決めます。年月日/DeviceId/dataname
DeviceId/年月日時分秒/datanameなど、取得する場合に有利な方を選ぶと良いでしょう。
選択を誤った場合でもParallel.ForEachなどで取ってきてゴニョゴニョすればなんとかなるでしょう。とはいえ処理効率が高くなるように設計段階で考えておくに越したことはありません。
例えばDBも併用しつつ、DB使わなくてもそこそこ検索性能悪くないように作る努力をしましょう。サンプルコード書いて、入れたり出したりしつつ、実データがどう格納されたかをAzureポータルから覗いてみましょう。



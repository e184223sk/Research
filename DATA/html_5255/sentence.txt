More than 3 years have passed since last update.ASP.NET MVC、C#でのファイルをインポートについてのメモです。
ここでのインポートはファイルの内容を、アプリケーション内にデータを取り込むことを指します。
間違いや勘違いに関しましてはご指摘いただけると幸いです。この記事におけるインポートの流れは以下を想定しています。
1.ユーザーが画面からファイルを選択しSubmitボタンを押下する。
2.ファイルをサーバー上に保存
3.保存したファイルを読み込み、要素を取り出す。
4.保存したファイルの破棄
5.取り出した要素を何らかの方法で保存する（DBに登録する等）5の処理はファイルであることで大きく変わることではないので、1から4までの内容とします。これを動かすと以下のような画面になります。まず、ファイルを送信するためにフォームにnew { enctype = "multipart/form-data" }を指定してください。上記で&lt;input type="file"&gt;が生成され、ファイルの参照ボタン、ファイル名を表示する場所が作られます。ファイルを選択してらすぐにサーバーにファイルが送信されるわけではなく、Submitボタンを押下される必要があります。Submitボタン押下後は、Viewで宣言しているUploadModelsの、UploadFileプロパティにファイルの情報が格納されます。
この際、独自の検証属性を付けることも可能のようです。上記で行いました。
その1、その2、その3の3つに分類しています。上記では、モデルに格納したUploadFileを取り出し、ファイル名を取得しています。上記でパスを指定し、そこに選択したファイルをサーバーに保存しています。
これはファイルを読み込むための一時的な保存です。読み込み終了後、finallyで削除しています。保存したファイルのパスから、ファイルを読み込みます。ファイルの読み込む方法はファイルの種類によって使用するクラスが変わります。
ここではExcelファイルとCSVファイルの読み込むコードを記載いたします。まずCSVを読み込む方法ですが、StreamReaderを使用して読み込むことができます。
文字コードの指定がない場合、文字化けが起こることがありますのでそこだけ注意が必要と思います。
ここでは1行ずつ読み込みこんでいます。次にExcelを読み込む方法ですが、ここではColsedXmlを使用しています。上記で読み込むシートを指定し、シートの使用している範囲を取得しています。使用している範囲を1行ずつ取り出しています。インポートから読み込みまで一連の処理として個々の処理は浅く触れる程度にしか書けていないため、今後もう少し掘り下げた記事を書きたいです。



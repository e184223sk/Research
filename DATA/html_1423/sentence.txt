More than 1 year has passed since last update.ReactiveProperty は便利そうだけど、パッケージ追加すると Reactive Extensions 由来の機能がたくさんついてくるのは、ちょっと難しいなぁ…と思っている人が一定数いると思っていたので、先ほどリリースした ReactiveProperty v7 では新たに ReactiveProperty.Core というパッケージを作成しました。以下の 2 つのクラスが含まれています。Reactive Extensions への参照も無い完全に独立したパッケージです。ターゲットプラットフォームは .NET Standard 2.0 になります。プロジェクトに ReactiveProperty.Core パッケージを NuGet から追加します。
そして、ViewModel などで以下のように使えます。Rx 使ってる人から見ると、なんかまどろっこしい感じもありますがラムダ式を受け取る Subscribe メソッドも System.Reactive パッケージで追加されるものなので、ReactiveProperty.Core を使う場合は ReactiveProperty の値が更新されたときの処理は PropertyChanged イベントを使うのが良さそうです。ReadOnlyReactivePropertySlim は ReactivePropertySlim を読み取り専用で外部に公開したいときに使うくらいしか用途はないように感じます。この ViewModel を画面にバインドさせてみましょう。実行すると以下のように動きます。ReactiveProperty では PropertyChanged イベントを自動で UI スレッドで発行していました。ReactivePropertySlim では、値を設定したときのスレッドで PropertyChanged イベントが発行されます。UI コントロールとバインドしている場合はエラーになるので、ReactivePropertySlim への値の設定は UI スレッド上で行いましょう。ただ、この機能は UI スレッドが複数あると破綻していた機能なので個人的には ReactiveProperty からも排除したい気持ちもあります…（あっ、v7 のタイミングですればよかった！！！）ReactiveProperty は DataAnnotations やカスタムロジックでの入力値の検証機能がありますが ReactivePropertySlim にはありません。Select メソッドや Where メソッドやラムダ式を受け取る Subscribe メソッドなどは Rx で提供されているので使えません。Slim 系のクラスに対して Rx のメソッドが使いたくなった場合は System.Reactive を追加で導入してください。System.Reactive を追加すると先ほどの ViewModel は、以下のようにスッキリします。POCO のクラスのプロパティ変更を監視するための ObserveProperty 拡張メソッドを始め色々な拡張メソッドが ReactiveProperty で定義されていますが、ReactiveProperty.Core には、これらも入っていません。使いたい場合は、ReactiveProperty.Core ではなく ReactiveProperty パッケージを使用してください。これも便利系拡張メソッドと同じです。本当に INotifyPropertyChanged インターフェースを実装した値を保持するだけのライトなクラスが欲しい人は ReactiveProperty.Core も試してみてください。
そこから始めて System.Reactive に手を伸ばしたり、フル機能が欲しくなったタイミングで ReactiveProperty.Core から ReactiveProperty にパッケージを差し替えるだけでフル機能に移行できるので、個人的にはお勧めです。



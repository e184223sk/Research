<!DOCTYPE html><html><head><meta charset="utf-8" /><title>UWPでHIDを扱ってみる - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/kndysfm/items/ea06e088edc1893eec6d" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="enYmtUaFJwVI/Q87QVUh4yiF5QZ376qBN3ODYwCoG4E4bhOt+T3d37ddD+nIw4AQv1wgbTAcUyoBh2WDbo7nQg==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@kndys" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="UWPでHIDを扱ってみる - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1WVmRRNDRHblNFbEU0NEtTNW9teDQ0R2o0NEdtNDRHXzQ0S0wmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9YTAyNDc4MDNkNDcxOTJjMTRjMDdkNWVkYmI0MTgwZmU&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3R1WkhselptMCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTk0MTMzODNhMjc1NDc2YjE4YzE0MDA0ZGRkN2E3MGQ4&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=5ff4a006cb48c49cfdd9636de1e5a98c"><meta property="og:description" content="

概要

WindowsにおけるHIDデバイスの扱いに関する話題です。
結論だけまとめると「Windows10 IoT Core向けにC#でHIDデバイスを扱うコードを書いたけど、デスクトップ上ではHIDが開けなかったのにRaspb..."><meta content="https://qiita.com/kndysfm/items/ea06e088edc1893eec6d" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Win32API,Windows10,UWP,HID" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-5ecfad29-af18-4d55-8805-3d2bfb09c638"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fkndysfm%2Fitems%2Fea06e088edc1893eec6d">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fkndysfm%2Fitems%2Fea06e088edc1893eec6d">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-5ecfad29-af18-4d55-8805-3d2bfb09c638">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-02-08T14:22:45.000+09:00","dateModified":"2017-02-23T10:18:12.000+09:00","headline":"UWPでHIDを扱ってみる","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1WVmRRNDRHblNFbEU0NEtTNW9teDQ0R2o0NEdtNDRHXzQ0S0wmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9YTAyNDc4MDNkNDcxOTJjMTRjMDdkNWVkYmI0MTgwZmU\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3R1WkhselptMCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTk0MTMzODNhMjc1NDc2YjE4YzE0MDA0ZGRkN2E3MGQ4\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=5ff4a006cb48c49cfdd9636de1e5a98c","mainEntityOfPage":"https://qiita.com/kndysfm/items/ea06e088edc1893eec6d","author":{"@type":"Person","address":null,"email":null,"identifier":"kndysfm","name":"kndysfm","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F26286%2Fprofile-images%2F1486515188?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=f857b8070305d22b0652a9e423a30d45","url":"https://qiita.com/kndysfm","description":null,"memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kndysfm","type":"items","id":"ea06e088edc1893eec6d"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kndysfm","type":"items","id":"ea06e088edc1893eec6d"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kndysfm","type":"items","id":"ea06e088edc1893eec6d"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/kndysfm/items/ea06e088edc1893eec6d","location":"/kndysfm/items/ea06e088edc1893eec6d","scheme":"https","host":"qiita.com","port":null,"pathname":"/kndysfm/items/ea06e088edc1893eec6d","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"lp3GZiBdb57BcNB8QGmI81cuMJkrvBfnI3lGQp/fQrrUhfN+n+WVRD7Q0K7J/ykAwPf18mxP7kwVjaCi8fm+eQ==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-c501f9ad-4c88-491d-8935-1b19d02041a2"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/kndysfm/items/ea06e088edc1893eec6d/likers" class="css-1iupg5d">4</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">9</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ea06e088edc1893eec6d/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/kndysfm/items/ea06e088edc1893eec6d/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/kndysfm/items/ea06e088edc1893eec6d/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/kndysfm/items/ea06e088edc1893eec6d/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/kndysfm/items/ea06e088edc1893eec6d.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/kndysfm"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/26286/profile-images/1486515188" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/kndysfm" class="css-10ougpm">@<!-- -->kndysfm</a><div class="css-1ay9vb9"><span><meta content="2017-02-08T05:22:45Z"/><time dateTime="2017-02-23T01:18:12Z" class="css-m19uds">updated at 2017-02-23</time></span></div></div></div></div></div><h1 class="css-cgzq40">UWPでHIDを扱ってみる</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/win32api" class="css-4czcte">Win32API</a><a href="/tags/windows10" class="css-4czcte">Windows10</a><a href="/tags/uwp" class="css-4czcte">UWP</a><a href="/tags/hid" class="css-4czcte">HID</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h2>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>

<p>WindowsにおけるHIDデバイスの扱いに関する話題です。<br>
結論だけまとめると「Windows10 IoT Core向けにC#でHIDデバイスを扱うコードを書いたけど、デスクトップ上ではHIDが開けなかったのにRaspberry Pi3上では開けた ｲﾐﾌ」という話です。<br>
個人的な振り返りとして記録したいと思います。</p>

<h2>
<span id="この投稿について" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E6%8A%95%E7%A8%BF%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>この投稿について</h2>

<p>通常、WindowsのアプリケーションでHIDを扱う場合、<code>setupapi.dll</code>と<code>hid.dll</code>をリンクして、<br>
いてこますのが普通だと思います。<br>
なので win32API アプリとしてC/C++で開発することになります(以下、便宜上VC++アプリと表現します)。</p>

<p><strong>P/Invoke</strong> とかいう仕組を使えば .NET アプリからもこれらDLLのAPIを呼び出して使えました。<br>
HIDを扱うためのAPIをC#クラスでラップした <a href="https://github.com/mikeobrien/HidLibrary" rel="nofollow noopener" target="_blank">ライブラリ</a> も存在します。<br>
通常の Windows PC 上であれば互換性などを特に気にすること無く使うことができました。</p>

<p>ところで、Windows 10 IoT Core が登場しました。大雑把に言えば、ラズパイでC#コードが動くようになりました。<br>
基本的にアプリケーションは Universal Windows Platform という基盤のうえで作成するようです。<br>
UWPアプリからのネイティブ関数コールが果たして可能なのかどうなのか、ちょっと調べただけではよく分かりませんでした。<br>
仮に出来たとしてもおそらく Universal なものにならないだろうとは予想できます。</p>

<p>前置きが長くなりましたが、UWP のライブラリAPIにははじめから<a href="https://msdn.microsoft.com/en-us/library/windows/apps/windows.devices.humaninterfacedevice.aspx" rel="nofollow noopener" target="_blank">Windows.Devices.HumanInterfaceDevice</a>名前空間が定義されていて、許可されているものに限り(後述)HIDデバイスにアクセスできるようになっています。<br>
UWP 上で HIDデバイスを扱うにあたり、VC++ との比較や、注意点などを記録したいと思います。</p>

<h2>
<span id="やりたいこと" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>やりたいこと</h2>

<p>Raspberry Pi3 に Windows 10 IoT Core をインストールしてみたので、UWPアプリケーションから接続されたHIDデバイスにアクセスしてみたいと思います。</p>

<h2>
<span id="vcでのhidデバイスの扱い" class="fragment"></span><a href="#vc%E3%81%A7%E3%81%AEhid%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E6%89%B1%E3%81%84"><i class="fa fa-link"></i></a>VC++でのHIDデバイスの扱い</h2>

<p>先に、VC++でHIDデバイスにどのようにアクセスしていたか、おさらいします。<br>
まずはデバイスパスを列挙します。</p>

<div class="code-frame" data-lang="cpp"><div class="highlight"><pre class="with-code"><code><span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">enumerate</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">paths</span><span class="p">;</span> <span class="c1">// デバイスパスのコンテナ</span>
    <span class="n">GUID</span> <span class="n">guid</span><span class="p">;</span>
    <span class="n">HidD_GetHidGuid</span><span class="p">(</span><span class="o">&amp;</span><span class="n">guid</span><span class="p">);</span>
    <span class="c1">// 渡されたGUIDに該当するデバイス情報を取得</span>
    <span class="n">HDEVINFO</span> <span class="n">deviceInfo</span><span class="p">;</span>
    <span class="n">deviceInfo</span> <span class="o">=</span> <span class="n">SetupDiGetClassDevs</span><span class="p">(</span><span class="o">&amp;</span><span class="n">guid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">(</span><span class="n">DIGCF_PRESENT</span> <span class="o">|</span> <span class="n">DIGCF_DEVICEINTERFACE</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">deviceInfo</span> <span class="o">!=</span> <span class="n">INVALID_HANDLE_VALUE</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SP_DEVICE_INTERFACE_DATA</span> <span class="n">deviceInfoData</span><span class="p">;</span>
        <span class="n">deviceInfoData</span><span class="p">.</span><span class="n">cbSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SP_DEVICE_INTERFACE_DATA</span><span class="p">);</span>
        <span class="c1">// インターフェースを列挙</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">DWORD</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">SetupDiEnumDeviceInterfaces</span><span class="p">(</span><span class="n">deviceInfo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">guid</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">deviceInfoData</span><span class="p">);</span>
            <span class="n">index</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">DWORD</span> <span class="n">requiredLength</span><span class="p">;</span>
            <span class="c1">// デバイスパスを含む構造体のサイズを取得</span>
            <span class="n">SetupDiGetDeviceInterfaceDetail</span><span class="p">(</span><span class="n">deviceInfo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">deviceInfoData</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">requiredLength</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
            <span class="c1">// 取得したサイズを元にバッファを確保</span>
            <span class="n">LPBYTE</span> <span class="n">deviceDetailDataBuffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BYTE</span><span class="p">[</span><span class="n">requiredLength</span><span class="p">];</span>
            <span class="n">PSP_DEVICE_INTERFACE_DETAIL_DATA</span> <span class="n">deviceDetailData</span> <span class="o">=</span> <span class="p">(</span><span class="n">PSP_DEVICE_INTERFACE_DETAIL_DATA</span><span class="p">)</span><span class="n">deviceDetailDataBuffer</span><span class="p">;</span>
            <span class="n">deviceDetailData</span><span class="o">-&gt;</span><span class="n">cbSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SP_DEVICE_INTERFACE_DETAIL_DATA</span><span class="p">);</span>
            <span class="c1">// デバイスパスを取得</span>
            <span class="n">SetupDiGetDeviceInterfaceDetail</span><span class="p">(</span><span class="n">deviceInfo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">deviceInfoData</span><span class="p">,</span> <span class="n">deviceDetailData</span><span class="p">,</span> <span class="n">requiredLength</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">requiredLength</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
            <span class="c1">// デバイスパスをコピー</span>
            <span class="n">paths</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">deviceDetailData</span><span class="o">-&gt;</span><span class="n">DevicePath</span><span class="p">);</span>
            <span class="c1">// バッファ削除</span>
            <span class="k">delete</span><span class="p">[]</span> <span class="n">deviceDetailDataBuffer</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// 使用したデバイス情報の破棄</span>
        <span class="n">SetupDiDestroyDeviceInfoList</span><span class="p">(</span><span class="n">deviceInfo</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">paths</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code>tchar.h</code> 絡みの部分は適当に読み替えて下さい。<br>
ほとんどの場合は内製ライブラリの中に押し込んでしまうのでいちいち意識することはありませんが、ここでやっているのは<code>setupapi.dll</code> にお願いしてHIDインターフェースを列挙してもらう処理です。<br>
GUID部分を置き換えてやれば「USBホストコントローラのパスのみを列挙」などといったことも出来ます。</p>

<p>取得したデバイスパスからファイルハンドルを開きます。</p>

<div class="code-frame" data-lang="cpp"><div class="highlight"><pre class="with-code"><code><span class="n">HANDLE</span> <span class="n">h</span> <span class="o">=</span> <span class="o">::</span><span class="n">CreateFile</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="c1">// デバイスパス文字列</span>
                <span class="p">(</span><span class="n">GENERIC_READ</span><span class="o">|</span><span class="n">GENERIC_WRITE</span><span class="p">),</span> <span class="p">(</span><span class="n">FILE_SHARE_READ</span> <span class="o">|</span> <span class="n">FILE_SHARE_WRITE</span><span class="p">),</span> 
                <span class="nb">NULL</span><span class="p">,</span>  <span class="n">OPEN_EXISTING</span><span class="p">,</span> <span class="n">FILE_FLAG_OVERLAPPED</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span> 
</code></pre></div></div>

<p>ファイルハンドルが開けたら、<a href="https://msdn.microsoft.com/en-us/library/windows/hardware/ff538865(v=vs.85).aspx" rel="nofollow noopener" target="_blank">ココ</a> に挙げられた関数を経由してHIDデバイスへのアクセスが可能になります。<br>
  <em>HidD_*</em> 関数は主にデバイスの制御や情報取得を、<em>HidP_*</em> 関数は主にHIDレポートのパース処理をそれぞれ行います。</p>

<p>では開いたHIDデバイスの VendorIDとProductID や トップコレクションのUsagePageとUsageを確認してみます。</p>

<div class="code-frame" data-lang="cpp"><div class="highlight"><pre class="with-code"><code><span class="n">HANDLE</span> <span class="n">h</span><span class="p">;</span> <span class="c1">// HIDのファイルハンドル</span>
<span class="n">HIDD_ATTRIBUTES</span> <span class="n">attributes</span><span class="p">;</span> <span class="c1">// デバイスの基本情報</span>
<span class="k">if</span> <span class="p">(</span><span class="n">HidD_GetAttributes</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attributes</span><span class="p">))</span>
<span class="p">{</span>   <span class="c1">// attributes が取得できた</span>
    <span class="n">attributes</span><span class="p">.</span><span class="n">VendorID</span><span class="p">;</span> <span class="c1">//!&lt; VendorIDあったよ！</span>
    <span class="n">attributes</span><span class="p">.</span><span class="n">ProdcutID</span><span class="p">;</span> <span class="c1">//!&lt; ProductIDあったよ！</span>
    <span class="n">PHIDP_PREPARSED_DATA</span> <span class="n">preparsedData</span><span class="p">;</span> <span class="c1">// HID Report Descriptor 情報</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">HidD_GetPreparsedData</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">preparsedData</span><span class="p">))</span>
    <span class="p">{</span>   <span class="c1">// preparsedData が取得できた</span>
        <span class="n">HIDP_CAPS</span> <span class="n">capabilities</span><span class="p">;</span> <span class="c1">// デバイスが送受信するレポートに関する基本情報</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">HIDP_STATUS_SUCCESS</span> <span class="o">==</span> <span class="n">HidP_GetCaps</span><span class="p">(</span><span class="n">preparsedData</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">capabilities</span><span class="p">))</span>
        <span class="p">{</span>   <span class="c1">// capabilities が取得できた</span>
            <span class="n">capabilities</span><span class="p">.</span><span class="n">UsagePage</span><span class="p">;</span> <span class="c1">//!&lt; UsagePageあったよ！</span>
            <span class="n">capabilities</span><span class="p">.</span><span class="n">Usage</span><span class="p">;</span> <span class="c1">//!&lt; Usageあったよ！</span>
        <span class="p">}</span>
        <span class="c1">// preparsedData は必ず開放する</span>
        <span class="n">HidD_FreePreparsedData</span><span class="p">(</span><span class="n">preparsedData</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>パスを列挙したHIDデバイスについては、それらが目的のものかどうかこれらの上記のデバイス情報を確認してから具体的な操作を行うことになります。</p>

<p>それと <em>HidD_*</em> 関数はすべて同期処理であるため、<em><a href="https://msdn.microsoft.com/en-us/library/windows/hardware/ff538945(v=vs.85).aspx" rel="nofollow noopener" target="_blank">HidD_GetInputReport</a></em> 、<em><a href="https://msdn.microsoft.com/en-us/library/windows/hardware/ff539690(v=vs.85).aspx" rel="nofollow noopener" target="_blank">HidD_SetOutputReport</a></em> 関数の代わりに普通のファイル操作APIの <em>Read</em> , <em>Write</em> 関数を使うことの方が一般的なようです。</p>

<h2>
<span id="uwpでやってみる" class="fragment"></span><a href="#uwp%E3%81%A7%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>UWPでやってみる</h2>

<p>では、UWPで同じことをやってみたいと思います。</p>

<p>「久々のC#、変わり過ぎ・・・」「XAMLぜんぜんわからん・・・」「MVVMってどういうこと・・・」<br>
といった個人的な戸惑いや苦しみがありましたが、ここでは割愛します。</p>

<p>まずはHIDを列挙してみます。<br>
最初にSelectorという文字列を生成します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span> <span class="n">selector</span> <span class="p">=</span> <span class="n">HidDevice</span><span class="p">.</span><span class="nf">GetDeviceSelector</span><span class="p">(</span><span class="n">usagePage</span><span class="p">,</span> <span class="n">usageId</span><span class="p">,</span> <span class="n">vendorId</span><span class="p">,</span> <span class="n">ProductId</span><span class="p">);</span>
</code></pre></div></div>

<p><em><a href="https://msdn.microsoft.com/en-us/library/windows/apps/dn468261.aspx" rel="nofollow noopener" target="_blank">HidDevice.GetDeviceSelector</a></em> は目的とするHIDデバイスを探すための呪文を生成するstatic関数で、むりやり<code>hid.dll</code>から似た関数を挙げるとしたら<em><a href="https://msdn.microsoft.com/en-us/library/windows/hardware/ff538924(v=vs.85).aspx" rel="nofollow noopener" target="_blank">HidD_GetHidGuid</a></em>あたりになるでしょうか。 </p>

<p>戻り値の文字列の中身は「GUIDがコレコレで、現在接続されていて、基本情報がコレコレのデバイスをおくれ」というクエリ状の何かです。<br>
文字列を直接書いても使えますが、UWP特有の事情(後述)によりHIDに限って言えばSelectorの中身を気にしてもあまり面白いことはなさそうです。</p>

<p>SelectorをDeviceInformationクラスに渡すと、ファイルパス(UWPではIDと呼ぶ)も含むデバイス情報を列挙してくれます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">DeviceInformationCollection</span> <span class="n">collection</span> <span class="p">=</span> <span class="k">await</span> <span class="n">DeviceInformation</span><span class="p">.</span><span class="nf">FindAllAsync</span><span class="p">(</span><span class="n">selector</span><span class="p">);</span>
</code></pre></div></div>

<p>これは<code>setupapi.dll</code>でいうところの<em><a href="https://msdn.microsoft.com/ja-jp/library/cc429192.aspx" rel="nofollow noopener" target="_blank">SetupDiEnumDeviceInterfaces</a></em> 関数にあたるでしょうか。<br><br>
なぜか非同期呼び出しです。理由を考えるに、引数なしの <code>DeviceInformation.FindAllAsync()</code> が「これまでPCに接続されたことのあるすべてのデバイスの情報」を列挙するため、とても時間がかかるからではないかと。</p>

<p>とまあ、これだけの記述でデバイスパスが列挙できてしまったことになります。</p>

<p>デバイスを開いて、先程のデバイス情報を確認してみます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">foreach</span><span class="p">(</span><span class="n">DeviceInformation</span> <span class="n">inf</span> <span class="k">in</span> <span class="n">collection</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">HidDevice</span> <span class="n">dev</span> <span class="p">=</span> <span class="k">await</span> <span class="n">HidDevice</span><span class="p">.</span><span class="nf">FromIdAsync</span><span class="p">(</span><span class="n">inf</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">FileAccessMode</span><span class="p">.</span><span class="n">ReadWrite</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dev</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>   <span class="c1">// あったよー！</span>
        <span class="n">dev</span><span class="p">.</span><span class="n">VendorId</span><span class="p">;</span>
        <span class="n">dev</span><span class="p">.</span><span class="n">ProductId</span><span class="p">;</span>
        <span class="n">dev</span><span class="p">.</span><span class="n">UsagePage</span><span class="p">;</span>
        <span class="n">dev</span><span class="p">.</span><span class="n">UsageId</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>なんと、たったこれだけの記述でHIDのAttributesやCappabilitiesに相当する情報が取得できてしm・・・</p>

<p>・・・うまくいきません。</p>

<h2>
<span id="マニフェストの編集" class="fragment"></span><a href="#%E3%83%9E%E3%83%8B%E3%83%95%E3%82%A7%E3%82%B9%E3%83%88%E3%81%AE%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>マニフェストの編集</h2>

<p>UWPでは無条件にHIDデバイスにアクセスできるわけではなかったのです。<br>
どうやらソリューション内に自動生成される <code>Package.appxmanifest</code> ファイルを編集する必要が有るようです。</p>

<blockquote>
<p>HID デバイスにアクセスする Windows ランタイム アプリでは、そのマニフェストの Capabilities ノードに特定の DeviceCapability データが含まれている必要があります。</p>
</blockquote>

<div class="code-frame" data-lang="xml"><div class="highlight"><pre class="with-code"><code><span class="c">&lt;!-- HID Device --&gt;</span>
<span class="nt">&lt;DeviceCapability</span> <span class="na">Name=</span><span class="s">"humaninterfacedevice"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Device</span> <span class="na">Id=</span><span class="s">"vidpid:0A81 0701"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Function</span> <span class="na">Type=</span><span class="s">"usage:ffa0 0001"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Device&gt;</span>
<span class="nt">&lt;/DeviceCapability&gt;</span>
</code></pre></div></div>

<p>参考: <a href="https://msdn.microsoft.com/ja-jp/library/windows/apps/dn263091.aspx" rel="nofollow noopener" target="_blank">HID のデバイス機能を指定する方法 (Windows ランタイム アプリ)</a></p>

<p>さらに、Capabilities に追記すれば何でもかんでも使えるようになるわけでもないようです。</p>

<blockquote>
<p>他の Windows API や OS の動作との競合を避けるために、次の利用状況ページで表される最上位のアプリケーション コレクションをブロックします。<br>
- HID_USAGE_PAGE_UNDEFINED<br>
- HID_USAGE_PAGE_GENERIC<br>
- HID_USAGE_GENERIC_KEYBOARD<br>
- ...(以下略)</p>
</blockquote>

<p>参考:<a href="https://msdn.microsoft.com/ja-jp/library/windows/apps/xaml/dn263140.aspx" rel="nofollow noopener" target="_blank">ヒューマン インターフェイス デバイス (XAML) のサポート</a></p>

<p>基本的に、DeviceCapability には VendorID, ProductID, UsagePage, Usage の4つすべての値を指定する必要がありそうです。<br>
<code>&lt;Device Id="any"&gt;</code> や <code>&lt;Function Type="usage:ff00 *"/&gt;</code> といった指定が可能とは書いてありますが、<br>
具体的にどのような条件においてこのようなワイルド指定が有効になるのか分かりません(ビルドしても実行できない)。</p>

<h2>
<span id="あらためてhidを開いてみる" class="fragment"></span><a href="#%E3%81%82%E3%82%89%E3%81%9F%E3%82%81%E3%81%A6hid%E3%82%92%E9%96%8B%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>あらためてHIDを開いてみる</h2>

<p>いちおうデバッグ用のトレース処理や例外処理も追記してみました。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">try</span>
<span class="p">{</span>
    <span class="n">HidDevice</span> <span class="n">dev</span> <span class="p">=</span> <span class="k">await</span> <span class="n">HidDevice</span><span class="p">.</span><span class="nf">FromIdAsync</span><span class="p">(</span><span class="n">inf</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">FileAccessMode</span><span class="p">.</span><span class="n">ReadWrite</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dev</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>   
        <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Succeeded to open HID"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Failed to open HID"</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">dai</span> <span class="p">=</span> <span class="n">DeviceAccessInformation</span><span class="p">.</span><span class="nf">CreateFromId</span><span class="p">(</span><span class="n">inf</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"CurrentStatus:</span><span class="p">{</span><span class="n">dai</span><span class="p">.</span><span class="n">CurrentStatus</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></div>

<p>さて、これでどうでしょう・・・？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>&gt; Failed to open HID
&gt; System.IO.FileNotFoundException: 指定されたファイルが見つかりません。 (Exception from HRESULT: 0x80070002)
&gt;    at Windows.Devices.Enumeration.DeviceAccessInformation.CreateFromId(String deviceId)
</code></pre></div></div>

<p>・・・？？？？</p>

<h2>
<span id="ちなみに" class="fragment"></span><a href="#%E3%81%A1%E3%81%AA%E3%81%BF%E3%81%AB"><i class="fa fa-link"></i></a>ちなみに</h2>

<p>Raspberry Pi3 上で同じコードを実行するとすんなり開けました。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>&gt; Succeeded to open HID
</code></pre></div></div>

<p>これで当初の目的は果たせたのカモしれませんが、デスクトップでも同じコードが同じように走ってくれないとデバッグの効率が悪いです。</p>

<p><code>Windows.Devices.HumanInterfaceDevice</code>のバグなのかなあ、解せないなあ・・・。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fkndysfm%2Fitems%2Fea06e088edc1893eec6d&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fkndysfm%2Fitems%2Fea06e088edc1893eec6d&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/kndysfm/items/ea06e088edc1893eec6d/likers" class="css-1iupg5d">4</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">9</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ea06e088edc1893eec6d/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/kndysfm/items/ea06e088edc1893eec6d/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/kndysfm/items/ea06e088edc1893eec6d/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/kndysfm/items/ea06e088edc1893eec6d/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/kndysfm/items/ea06e088edc1893eec6d.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-c501f9ad-4c88-491d-8935-1b19d02041a2">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-9bdad305-3674-4052-908f-5427bd2806d2"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-9bdad305-3674-4052-908f-5427bd2806d2">{}</script>
      
<div id="LoginModal-react-component-474da6de-5661-4862-baea-a5c34d3701b3"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-474da6de-5661-4862-baea-a5c34d3701b3">{}</script>
      
<div id="StockModal-react-component-9d202e26-ce4c-4213-b6d4-0d2bf44a80d6"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-9d202e26-ce4c-4213-b6d4-0d2bf44a80d6">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;xet05pK7lwR7rHjiTmO+O4X/dR+xl56qeJmJSlfDlS+H80H+LQNt3oQMeDDH9R/IEiawdPZkZwFObW+qOeVp7A==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch2\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h2\u003e\n\n\u003cp\u003eWindowsにおけるHIDデバイスの扱いに関する話題です。\u003cbr\u003e\n結論だけまとめると「Windows10 IoT Core向けにC#でHIDデバイスを扱うコードを書いたけど、デスクトップ上ではHIDが開けなかったのにRaspberry Pi3上では開けた ｲﾐﾌ」という話です。\u003cbr\u003e\n個人的な振り返りとして記録したいと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"この投稿について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%AE%E6%8A%95%E7%A8%BF%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこの投稿について\u003c/h2\u003e\n\n\u003cp\u003e通常、WindowsのアプリケーションでHIDを扱う場合、\u003ccode\u003esetupapi.dll\u003c/code\u003eと\u003ccode\u003ehid.dll\u003c/code\u003eをリンクして、\u003cbr\u003e\nいてこますのが普通だと思います。\u003cbr\u003e\nなので win32API アプリとしてC/C++で開発することになります(以下、便宜上VC++アプリと表現します)。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eP/Invoke\u003c/strong\u003e とかいう仕組を使えば .NET アプリからもこれらDLLのAPIを呼び出して使えました。\u003cbr\u003e\nHIDを扱うためのAPIをC#クラスでラップした \u003ca href=\"https://github.com/mikeobrien/HidLibrary\" rel=\"nofollow noopener\" target=\"_blank\"\u003eライブラリ\u003c/a\u003e も存在します。\u003cbr\u003e\n通常の Windows PC 上であれば互換性などを特に気にすること無く使うことができました。\u003c/p\u003e\n\n\u003cp\u003eところで、Windows 10 IoT Core が登場しました。大雑把に言えば、ラズパイでC#コードが動くようになりました。\u003cbr\u003e\n基本的にアプリケーションは Universal Windows Platform という基盤のうえで作成するようです。\u003cbr\u003e\nUWPアプリからのネイティブ関数コールが果たして可能なのかどうなのか、ちょっと調べただけではよく分かりませんでした。\u003cbr\u003e\n仮に出来たとしてもおそらく Universal なものにならないだろうとは予想できます。\u003c/p\u003e\n\n\u003cp\u003e前置きが長くなりましたが、UWP のライブラリAPIにははじめから\u003ca href=\"https://msdn.microsoft.com/en-us/library/windows/apps/windows.devices.humaninterfacedevice.aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWindows.Devices.HumanInterfaceDevice\u003c/a\u003e名前空間が定義されていて、許可されているものに限り(後述)HIDデバイスにアクセスできるようになっています。\u003cbr\u003e\nUWP 上で HIDデバイスを扱うにあたり、VC++ との比較や、注意点などを記録したいと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"やりたいこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやりたいこと\u003c/h2\u003e\n\n\u003cp\u003eRaspberry Pi3 に Windows 10 IoT Core をインストールしてみたので、UWPアプリケーションから接続されたHIDデバイスにアクセスしてみたいと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"vcでのhidデバイスの扱い\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#vc%E3%81%A7%E3%81%AEhid%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E6%89%B1%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVC++でのHIDデバイスの扱い\u003c/h2\u003e\n\n\u003cp\u003e先に、VC++でHIDデバイスにどのようにアクセスしていたか、おさらいします。\u003cbr\u003e\nまずはデバイスパスを列挙します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003evector\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003evector\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// デバイスパスのコンテナ\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGUID\u003c/span\u003e \u003cspan class=\"n\"\u003eguid\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eHidD_GetHidGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eguid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 渡されたGUIDに該当するデバイス情報を取得\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eHDEVINFO\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edeviceInfo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSetupDiGetClassDevs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eguid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDIGCF_PRESENT\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eDIGCF_DEVICEINTERFACE\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceInfo\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eINVALID_HANDLE_VALUE\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSP_DEVICE_INTERFACE_DATA\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceInfoData\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edeviceInfoData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecbSize\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSP_DEVICE_INTERFACE_DATA\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// インターフェースを列挙\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDWORD\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eSetupDiEnumDeviceInterfaces\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eguid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceInfoData\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDWORD\u003c/span\u003e \u003cspan class=\"n\"\u003erequiredLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// デバイスパスを含む構造体のサイズを取得\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eSetupDiGetDeviceInterfaceDetail\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceInfoData\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003erequiredLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 取得したサイズを元にバッファを確保\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eLPBYTE\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceDetailDataBuffer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eBYTE\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003erequiredLength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ePSP_DEVICE_INTERFACE_DETAIL_DATA\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceDetailData\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePSP_DEVICE_INTERFACE_DETAIL_DATA\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceDetailDataBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edeviceDetailData\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecbSize\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSP_DEVICE_INTERFACE_DETAIL_DATA\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// デバイスパスを取得\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eSetupDiGetDeviceInterfaceDetail\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceInfoData\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceDetailData\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erequiredLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003erequiredLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// デバイスパスをコピー\u003c/span\u003e\n            \u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epush_back\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceDetailData\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDevicePath\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// バッファ削除\u003c/span\u003e\n            \u003cspan class=\"k\"\u003edelete\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceDetailDataBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 使用したデバイス情報の破棄\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSetupDiDestroyDeviceInfoList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003etchar.h\u003c/code\u003e 絡みの部分は適当に読み替えて下さい。\u003cbr\u003e\nほとんどの場合は内製ライブラリの中に押し込んでしまうのでいちいち意識することはありませんが、ここでやっているのは\u003ccode\u003esetupapi.dll\u003c/code\u003e にお願いしてHIDインターフェースを列挙してもらう処理です。\u003cbr\u003e\nGUID部分を置き換えてやれば「USBホストコントローラのパスのみを列挙」などといったことも出来ます。\u003c/p\u003e\n\n\u003cp\u003e取得したデバイスパスからファイルハンドルを開きます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eHANDLE\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eCreateFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ec_str\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"c1\"\u003e// デバイスパス文字列\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eGENERIC_READ\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003eGENERIC_WRITE\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFILE_SHARE_READ\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eFILE_SHARE_WRITE\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \n                \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"n\"\u003eOPEN_EXISTING\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFILE_FLAG_OVERLAPPED\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eファイルハンドルが開けたら、\u003ca href=\"https://msdn.microsoft.com/en-us/library/windows/hardware/ff538865(v=vs.85).aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eココ\u003c/a\u003e に挙げられた関数を経由してHIDデバイスへのアクセスが可能になります。\u003cbr\u003e\n  \u003cem\u003eHidD_*\u003c/em\u003e 関数は主にデバイスの制御や情報取得を、\u003cem\u003eHidP_*\u003c/em\u003e 関数は主にHIDレポートのパース処理をそれぞれ行います。\u003c/p\u003e\n\n\u003cp\u003eでは開いたHIDデバイスの VendorIDとProductID や トップコレクションのUsagePageとUsageを確認してみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eHANDLE\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// HIDのファイルハンドル\u003c/span\u003e\n\u003cspan class=\"n\"\u003eHIDD_ATTRIBUTES\u003c/span\u003e \u003cspan class=\"n\"\u003eattributes\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// デバイスの基本情報\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHidD_GetAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eattributes\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// attributes が取得できた\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eattributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVendorID\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//!\u0026lt; VendorIDあったよ！\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eattributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eProdcutID\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//!\u0026lt; ProductIDあったよ！\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePHIDP_PREPARSED_DATA\u003c/span\u003e \u003cspan class=\"n\"\u003epreparsedData\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// HID Report Descriptor 情報\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHidD_GetPreparsedData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003epreparsedData\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// preparsedData が取得できた\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eHIDP_CAPS\u003c/span\u003e \u003cspan class=\"n\"\u003ecapabilities\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// デバイスが送受信するレポートに関する基本情報\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHIDP_STATUS_SUCCESS\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eHidP_GetCaps\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epreparsedData\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecapabilities\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// capabilities が取得できた\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecapabilities\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUsagePage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//!\u0026lt; UsagePageあったよ！\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecapabilities\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUsage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//!\u0026lt; Usageあったよ！\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// preparsedData は必ず開放する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eHidD_FreePreparsedData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epreparsedData\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eパスを列挙したHIDデバイスについては、それらが目的のものかどうかこれらの上記のデバイス情報を確認してから具体的な操作を行うことになります。\u003c/p\u003e\n\n\u003cp\u003eそれと \u003cem\u003eHidD_*\u003c/em\u003e 関数はすべて同期処理であるため、\u003cem\u003e\u003ca href=\"https://msdn.microsoft.com/en-us/library/windows/hardware/ff538945(v=vs.85).aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHidD_GetInputReport\u003c/a\u003e\u003c/em\u003e 、\u003cem\u003e\u003ca href=\"https://msdn.microsoft.com/en-us/library/windows/hardware/ff539690(v=vs.85).aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHidD_SetOutputReport\u003c/a\u003e\u003c/em\u003e 関数の代わりに普通のファイル操作APIの \u003cem\u003eRead\u003c/em\u003e , \u003cem\u003eWrite\u003c/em\u003e 関数を使うことの方が一般的なようです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"uwpでやってみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#uwp%E3%81%A7%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUWPでやってみる\u003c/h2\u003e\n\n\u003cp\u003eでは、UWPで同じことをやってみたいと思います。\u003c/p\u003e\n\n\u003cp\u003e「久々のC#、変わり過ぎ・・・」「XAMLぜんぜんわからん・・・」「MVVMってどういうこと・・・」\u003cbr\u003e\nといった個人的な戸惑いや苦しみがありましたが、ここでは割愛します。\u003c/p\u003e\n\n\u003cp\u003eまずはHIDを列挙してみます。\u003cbr\u003e\n最初にSelectorという文字列を生成します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eselector\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eHidDevice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDeviceSelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eusagePage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eusageId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evendorId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eProductId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cem\u003e\u003ca href=\"https://msdn.microsoft.com/en-us/library/windows/apps/dn468261.aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHidDevice.GetDeviceSelector\u003c/a\u003e\u003c/em\u003e は目的とするHIDデバイスを探すための呪文を生成するstatic関数で、むりやり\u003ccode\u003ehid.dll\u003c/code\u003eから似た関数を挙げるとしたら\u003cem\u003e\u003ca href=\"https://msdn.microsoft.com/en-us/library/windows/hardware/ff538924(v=vs.85).aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHidD_GetHidGuid\u003c/a\u003e\u003c/em\u003eあたりになるでしょうか。 \u003c/p\u003e\n\n\u003cp\u003e戻り値の文字列の中身は「GUIDがコレコレで、現在接続されていて、基本情報がコレコレのデバイスをおくれ」というクエリ状の何かです。\u003cbr\u003e\n文字列を直接書いても使えますが、UWP特有の事情(後述)によりHIDに限って言えばSelectorの中身を気にしてもあまり面白いことはなさそうです。\u003c/p\u003e\n\n\u003cp\u003eSelectorをDeviceInformationクラスに渡すと、ファイルパス(UWPではIDと呼ぶ)も含むデバイス情報を列挙してくれます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eDeviceInformationCollection\u003c/span\u003e \u003cspan class=\"n\"\u003ecollection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eDeviceInformation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindAllAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれは\u003ccode\u003esetupapi.dll\u003c/code\u003eでいうところの\u003cem\u003e\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/cc429192.aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSetupDiEnumDeviceInterfaces\u003c/a\u003e\u003c/em\u003e 関数にあたるでしょうか。\u003cbr\u003e\u003cbr\u003e\nなぜか非同期呼び出しです。理由を考えるに、引数なしの \u003ccode\u003eDeviceInformation.FindAllAsync()\u003c/code\u003e が「これまでPCに接続されたことのあるすべてのデバイスの情報」を列挙するため、とても時間がかかるからではないかと。\u003c/p\u003e\n\n\u003cp\u003eとまあ、これだけの記述でデバイスパスが列挙できてしまったことになります。\u003c/p\u003e\n\n\u003cp\u003eデバイスを開いて、先程のデバイス情報を確認してみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceInformation\u003c/span\u003e \u003cspan class=\"n\"\u003einf\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ecollection\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eHidDevice\u003c/span\u003e \u003cspan class=\"n\"\u003edev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eHidDevice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromIdAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFileAccessMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReadWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edev\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// あったよー！\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVendorId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eProductId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUsagePage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUsageId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんと、たったこれだけの記述でHIDのAttributesやCappabilitiesに相当する情報が取得できてしm・・・\u003c/p\u003e\n\n\u003cp\u003e・・・うまくいきません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"マニフェストの編集\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9E%E3%83%8B%E3%83%95%E3%82%A7%E3%82%B9%E3%83%88%E3%81%AE%E7%B7%A8%E9%9B%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eマニフェストの編集\u003c/h2\u003e\n\n\u003cp\u003eUWPでは無条件にHIDデバイスにアクセスできるわけではなかったのです。\u003cbr\u003e\nどうやらソリューション内に自動生成される \u003ccode\u003ePackage.appxmanifest\u003c/code\u003e ファイルを編集する必要が有るようです。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eHID デバイスにアクセスする Windows ランタイム アプリでは、そのマニフェストの Capabilities ノードに特定の DeviceCapability データが含まれている必要があります。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e\u0026lt;!-- HID Device --\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;DeviceCapability\u003c/span\u003e \u003cspan class=\"na\"\u003eName=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"humaninterfacedevice\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;Device\u003c/span\u003e \u003cspan class=\"na\"\u003eId=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"vidpid:0A81 0701\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;Function\u003c/span\u003e \u003cspan class=\"na\"\u003eType=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"usage:ffa0 0001\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/Device\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/DeviceCapability\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e参考: \u003ca href=\"https://msdn.microsoft.com/ja-jp/library/windows/apps/dn263091.aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHID のデバイス機能を指定する方法 (Windows ランタイム アプリ)\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eさらに、Capabilities に追記すれば何でもかんでも使えるようになるわけでもないようです。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e他の Windows API や OS の動作との競合を避けるために、次の利用状況ページで表される最上位のアプリケーション コレクションをブロックします。\u003cbr\u003e\n- HID_USAGE_PAGE_UNDEFINED\u003cbr\u003e\n- HID_USAGE_PAGE_GENERIC\u003cbr\u003e\n- HID_USAGE_GENERIC_KEYBOARD\u003cbr\u003e\n- ...(以下略)\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e参考:\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/windows/apps/xaml/dn263140.aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eヒューマン インターフェイス デバイス (XAML) のサポート\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e基本的に、DeviceCapability には VendorID, ProductID, UsagePage, Usage の4つすべての値を指定する必要がありそうです。\u003cbr\u003e\n\u003ccode\u003e\u0026lt;Device Id=\"any\"\u0026gt;\u003c/code\u003e や \u003ccode\u003e\u0026lt;Function Type=\"usage:ff00 *\"/\u0026gt;\u003c/code\u003e といった指定が可能とは書いてありますが、\u003cbr\u003e\n具体的にどのような条件においてこのようなワイルド指定が有効になるのか分かりません(ビルドしても実行できない)。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"あらためてhidを開いてみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%82%E3%82%89%E3%81%9F%E3%82%81%E3%81%A6hid%E3%82%92%E9%96%8B%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eあらためてHIDを開いてみる\u003c/h2\u003e\n\n\u003cp\u003eいちおうデバッグ用のトレース処理や例外処理も追記してみました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003etry\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eHidDevice\u003c/span\u003e \u003cspan class=\"n\"\u003edev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eHidDevice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromIdAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFileAccessMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReadWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edev\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e   \n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"Succeeded to open HID\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"Failed to open HID\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edai\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDeviceAccessInformation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateFromId\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"CurrentStatus:\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003edai\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eさて、これでどうでしょう・・・？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u0026gt; Failed to open HID\n\u0026gt; System.IO.FileNotFoundException: 指定されたファイルが見つかりません。 (Exception from HRESULT: 0x80070002)\n\u0026gt;    at Windows.Devices.Enumeration.DeviceAccessInformation.CreateFromId(String deviceId)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e・・・？？？？\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ちなみに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A1%E3%81%AA%E3%81%BF%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eちなみに\u003c/h2\u003e\n\n\u003cp\u003eRaspberry Pi3 上で同じコードを実行するとすんなり開けました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u0026gt; Succeeded to open HID\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれで当初の目的は果たせたのカモしれませんが、デスクトップでも同じコードが同じように走ってくれないとデバッグの効率が悪いです。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eWindows.Devices.HumanInterfaceDevice\u003c/code\u003eのバグなのかなあ、解せないなあ・・・。\u003c/p\u003e\n","createdAt":"2017-02-08T05:22:45Z","elapsedYearsFromLastModifiedAt":4,"encryptedId":"rgVbxsOt/D/jXbkAnIkPyPvxdpjwxYFa--k3lNnZxEq3ldmTtd--FlyMD8UAy/gCHGMlBmKE9g==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2017-02-23T01:18:12Z","likesCount":4,"linkUrl":"https://qiita.com/kndysfm/items/ea06e088edc1893eec6d","organization":null,"originalId":466928,"stockedCount":9,"title":"UWPでHIDを扱ってみる","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%93%E3%81%AE%E6%8A%95%E7%A8%BF%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003eこの投稿について\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003eやりたいこと\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#vc%E3%81%A7%E3%81%AEhid%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E6%89%B1%E3%81%84\"\u003eVC++でのHIDデバイスの扱い\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#uwp%E3%81%A7%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003eUWPでやってみる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9E%E3%83%8B%E3%83%95%E3%82%A7%E3%82%B9%E3%83%88%E3%81%AE%E7%B7%A8%E9%9B%86\"\u003eマニフェストの編集\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%82%E3%82%89%E3%81%9F%E3%82%81%E3%81%A6hid%E3%82%92%E9%96%8B%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B\"\u003eあらためてHIDを開いてみる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%A1%E3%81%AA%E3%81%BF%E3%81%AB\"\u003eちなみに\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":8461,"uuid":"ea06e088edc1893eec6d","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"rWF+2Cqi8g1CzJNnqNuWFx6Ury0=--QNiqxdr9j9gM9wml--s9Ct12RMcgOC3D34xjlyIw==","originalId":26286,"description":"","facebookUrl":null,"githubUrl":"https://github.com/kndysfm","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/26286/profile-images/1486515188","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F26286%2Fprofile-images%2F1486515188?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=746e419f721e0c4fbfe9f05f1bad69a6","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F26286%2Fprofile-images%2F1486515188?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=f857b8070305d22b0652a9e423a30d45","urlName":"kndysfm","websiteUrl":null,"twitterUrl":"https://twitter.com/kndys","twitterUrlName":"kndys","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Win32API","urlName":"win32api"},{"name":"Windows10","urlName":"windows10"},{"name":"UWP","urlName":"uwp"},{"name":"HID","urlName":"hid"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

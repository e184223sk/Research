More than 3 years have passed since last update.システムといえば昔は、膨大な時間をかけて複雑なソースコードを組み上げてようやく出来上がるもの という印象がありました。
近年では様々なものがクラウド化されていますが、現在ではクラウド上で迅速なシステム構築を行うことができるサービスも登場しています。その1つが kintone です。ここでは、Salesforce で管理している顧客データ(取引先責任者)の情報を kintone に同期するサンプルアプリケーションを開発してみます。
CDataドライバーを利用すれば、こういったデータ同期を行うアプリケーションの作成を行うことができます。このアプリケーションの概要は次の通りです。それでは、このサンプルアプリケーションの開発手順を見ていきます。このサンプルアプリケーションのソースコードはこちらからどうぞ。※ソースコードについて補足
このソースコードでは接続情報をアプリケーションの設定に格納しています。
動作させる際は、アプリケーション設定のConnectionStringSalesforceにSalesforce用の接続文字列を、ConnectionStringKintoneにkintone用の接続文字列を設定してください。
それぞれの接続文字列は以下のようになります。
Salesforce → Password=&lt;パスワード&gt;;Security Token=&lt;セキュリティトークン&gt;;User=&lt;ユーザ名&gt;
kintone → Password=&lt;パスワード&gt;;Url=&lt;kintoneのURL&gt;;User=&lt;ユーザ名&gt;まずは CData Software をインストールします。今回必要になるのは、次の2つです。Visual Studio を起動し、新しいWindowsフォームアプリケーションのプロジェクトを作成します。インストールした CData Software の2製品には、いくつかのADO.NETアセンブリが含まれています。
今回必要になるのは次の2つのDLLですので、これらをプロジェクトの参照設定で追加します。Salesforce および kintone へのデータ接続を作成します。
以下のオンラインマニュアルを参考にして、2つのデータ接続を作成します。
Salesforce用
kintone用メインのフォームを追加します。
このフォームには、次のコンポーネントを追加します。追加したデータグリッドビューに、データソースの設定を行います。
左側のデータグリッドビューで「DataGridView タスク」→「データソースの選択」→「プロジェクト データソースの追加」を選択します。「データソースの種類の選択」では「データベース」を選択して「次へ」ボタンをクリックします。次の画面では「データセット」を選択して「次へ」ボタンをクリックします。データ接続の選択では、データ接続を作成で作成したSalesforceのデータ接続を選択して「次へ」ボタンをクリックします。次の画面で接続文字列をアプリケーションに保存するかどうか選択できますが、ここでは任意に選択し、「次へ」ボタンをクリックします。最後にデータベースオブジェクトの選択を行います。
今回はSalesforceの「取引先責任者」を対象とするので、Contactのチェックボックスにチェックを入れます。
データセット名は SalesforceDataSet として、「完了」ボタンをクリックします。同じようにして、kintone側もデータソースの設定を行います。
kintone側は、「顧客リスト」をデータベースオブジェクトとして選択します。
※kintoneのアプリが、ここにテーブルとして表示されます。
※このサンプルでは、顧客リストアプリに標準で存在する「会社ロゴ」の項目は削除しています。これで、データグリッドビューへのデータの読み込みまでが行えるようになりました。ここまで、全くコーディングは必要ありません。
メインフォームには、データ読み込みのためのコードが自動生成されています。Salesforce側の会社名と会社住所は、取引先責任者の親である取引先の項目になるため、TableAdapter構成ウィザードを使用して、それらを取引先から取得するよう少し手を加えます。先程のデータソースの構成で作成したデータセットを開き、「構成」メニューを選択します。TableAdaoter構成ウィザードが開くので、ここで取引先(Account)から会社名と会社住所を取得するように修正を加えます。これで、会社名と会社住所を取得できるようになりました。
データグリッドビューの「列の編集」から、これらの項目を追加しておきます。フォームデザイナで「インポート」ボタンをダブルクリックして、クリック時の処理を実装します。
ここでは、Salesforce側の取引先責任者のメールアドレスをkintone側のメールアドレスとひもづけ、これをキーとして取り扱うようにしています。実装は以上です。アプリケーションを起動すると、データグリッドビューにデータが読み込まれます。移行したい行を選択して「インポート」ボタンをクリックすると、選択したデータが kintone に登録されます。



More than 1 year has passed since last update.研究目的のために複数かつ大量のアバターに適用させるアニメーションを作る必要がありました。首から下はHumanoidBornで普通に操作できましたが、FBX(というか既存の人型アバター)だと表情の設定がバラバラすぎて困惑。
なのでせっかくなので最近できたVRMフォーマットで表情制御をしようと決意(Blenderとか使えれば簡単なんだろうけど挫折)Animation,Animatorは最低限使えるドワンゴの公式ページを参考にしてUnityにVRMを読み込む環境構築
使うモデルはAliciaSolidとUnityちゃん
ドラッグ＆ドロップだけで普通に使えたので便利首から下は既に作ってあった「座って腕を組んでる」アニメーションを適用。Sceneに配置して、とりあえず再生ボタンを押すとなぜか顔が消えて軽くホラー
顔のパーツが顔に追従しない親子構造になってたが、構造壊すとどうなるかわからなかったので、とりあえずMeshRendererの位置を下げて対応する。
UniVRMのVRMBlendShapeProxyで表情アニメーション処理を共通化する
↑を読みつつ、VRMBlendShapeProxyを触ればいいのかと理解。
しかし、Editor上ではStartが始まらないとVRMBlendShapeProxyの値が変更できない=Animationで使えない
なので、この値をUpdate後にどうこうするスクリプトを書いて、その変数を変更するAnimationを設定することにした。本来はGetPropertyValueの中身を「変数名(string)から値を取得」とかしたかったけど、Enumからの変換とかが上手くいってないようなのでとりあえず原始的に実装。
このスクリプトをVRMBlendShapeProxyと同じGameObjectに追加。
BlendShapePresetは確か自分で変更できたはずなので、その度にここを変更しなきゃいけないのは難点。とりあえず瞬きをさせたかったので、Blink(瞼を閉じる)の値を触る(0で開ける、1で閉じる)。10秒に1回0.5秒掛けて瞼を閉じる設定。
そして再生

成功同じことがUnityちゃんでもできたので目的達成
項目が増えるごとにGetPropertyValueを変えないといけない。
ゲームの再生中じゃないとどう動くかがわからないので値の調整がやりにくいので、モーションを作っている間は常に再生中にしておく必要がある。VRゲーム系の利用ということで、どうしてもアバターの種類がアニメよりに偏っているのが残念。RobotKyleみたいな学会発表中にニヤつかなくて済む感じのも欲しい…まあ自分で作れればいいんだろうけど…



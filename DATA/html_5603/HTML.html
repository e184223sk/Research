<!DOCTYPE html><html><head><meta charset="utf-8" /><title>C#アプリにスクリプティング機能を追加してみる - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/siy1121/items/aee3ce1fff6e83e33b22" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="o88egt+Hv7wDO0JMonA7XatXJ7ff4CYnOeCpApu/fbet2dhFdB8Gn7PmIso8CWmKTdPDuBg5k3I3uOL4SdvbBw==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@SIY1121" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="C#アプリにスクリプティング機能を追加してみる - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1ReVBqZ3FMamc1ZmpnNnJqZ2F2amdybmpncV9qZzZyamc1ZmpnNGJqZ3FQamc3UGpnckRtcVpfb2c3M2pncExvdjczbGlxRGpnWmZqZ2FiamdiX2pnb3MmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9YTJiYjYyM2FiZDFhMWE2NThjMjk3OGIwMGU4ZGMwYTE&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSE5wZVRFeE1qRSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTRjNmZhNjY0OTRhZWRjMTUwZmIxZTg3MGNlMzM0NzRl&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=3f85b266e3d3b58e2394eb853cae3b5d"><meta property="og:description" content="

こんなものを作ります


C#スクリプトをアプリケーションに組み込むだけでなく、
上の画像のようにインテリセンスやハイライトが効くエディタを組み込んでみます。


使用するもの


Roslyn
RoslynPad



Rosl..."><meta content="https://qiita.com/siy1121/items/aee3ce1fff6e83e33b22" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Roslyn,RoslynPad" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-0afac62a-32ca-4cc7-b201-8908359995f6"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fsiy1121%2Fitems%2Faee3ce1fff6e83e33b22">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fsiy1121%2Fitems%2Faee3ce1fff6e83e33b22">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-0afac62a-32ca-4cc7-b201-8908359995f6">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-01-16T16:33:52.000+09:00","dateModified":"2018-01-21T01:49:12.000+09:00","headline":"C#アプリにスクリプティング機能を追加してみる","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1ReVBqZ3FMamc1ZmpnNnJqZ2F2amdybmpncV9qZzZyamc1ZmpnNGJqZ3FQamc3UGpnckRtcVpfb2c3M2pncExvdjczbGlxRGpnWmZqZ2FiamdiX2pnb3MmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9YTJiYjYyM2FiZDFhMWE2NThjMjk3OGIwMGU4ZGMwYTE\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSE5wZVRFeE1qRSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTRjNmZhNjY0OTRhZWRjMTUwZmIxZTg3MGNlMzM0NzRl\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=3f85b266e3d3b58e2394eb853cae3b5d","mainEntityOfPage":"https://qiita.com/siy1121/items/aee3ce1fff6e83e33b22","author":{"@type":"Person","address":"","email":null,"identifier":"siy1121","name":"siy1121","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Fprofile-images%2F1527769802?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=48bde3e9e95f68591f493be066cb5e43","url":"https://qiita.com/siy1121","description":"情報系の学部に通う大学３年生 / \r\nプログラミングしたり、CG(動画)作ったり、作曲したり色々してます / \r\n動画や音声を扱うプログラムを書くのが好き / \r\nKotlinが好きですが、js/tsの偉大さも感じている今日このごろです","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"siy1121","type":"items","id":"aee3ce1fff6e83e33b22"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"siy1121","type":"items","id":"aee3ce1fff6e83e33b22"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"siy1121","type":"items","id":"aee3ce1fff6e83e33b22"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/siy1121/items/aee3ce1fff6e83e33b22","location":"/siy1121/items/aee3ce1fff6e83e33b22","scheme":"https","host":"qiita.com","port":null,"pathname":"/siy1121/items/aee3ce1fff6e83e33b22","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"+ZJPGoHqnN7ZMXeMlJi7/wP5yZHmsqIesTj5keNHZ/f3hIndKnIl/WnsFwoK4eko5X0tniFrF0u/YLJrMSPBRw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-3c7d8d81-201b-45eb-8a2c-c723831c3477"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/siy1121/items/aee3ce1fff6e83e33b22/likers" class="css-1iupg5d">67</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">64</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/aee3ce1fff6e83e33b22/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/siy1121/items/aee3ce1fff6e83e33b22/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/siy1121/items/aee3ce1fff6e83e33b22/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/siy1121/items/aee3ce1fff6e83e33b22/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/siy1121/items/aee3ce1fff6e83e33b22.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/siy1121"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/89220/profile-images/1527769802" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/siy1121" class="css-10ougpm">@<!-- -->siy1121</a><div class="css-1ay9vb9"><span><meta content="2018-01-16T07:33:52Z"/><time dateTime="2018-01-20T16:49:12Z" class="css-m19uds">updated at 2018-01-20</time></span></div></div></div></div></div><h1 class="css-cgzq40">C#アプリにスクリプティング機能を追加してみる</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/roslyn" class="css-4czcte">Roslyn</a><a href="/tags/roslynpad" class="css-4czcte">RoslynPad</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="こんなものを作ります" class="fragment"></span><a href="#%E3%81%93%E3%82%93%E3%81%AA%E3%82%82%E3%81%AE%E3%82%92%E4%BD%9C%E3%82%8A%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>こんなものを作ります</h1>

<p><a href="https://camo.qiitausercontent.com/501a7e51664174466ae192c6e57f81e8333a8c10/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f35326466653030352d373438362d343561622d356231632d6137313833613063336138372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F52dfe005-7486-45ab-5b1c-a7183a0c3a87.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4566f7c6eb8fe5b43c4d200fcb005b9e" alt="sc1.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/89220/52dfe005-7486-45ab-5b1c-a7183a0c3a87.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F52dfe005-7486-45ab-5b1c-a7183a0c3a87.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f4bf1ab6e41640caf571ef7a5f187cef 1x" loading="lazy"></a><br>
C#スクリプトをアプリケーションに組み込むだけでなく、<br>
上の画像のようにインテリセンスやハイライトが効くエディタを組み込んでみます。</p>

<h1>
<span id="使用するもの" class="fragment"></span><a href="#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>使用するもの</h1>

<ul>
<li><a href="https://github.com/dotnet/roslyn" rel="nofollow noopener" target="_blank">Roslyn</a></li>
<li><a href="https://github.com/aelij/RoslynPad" rel="nofollow noopener" target="_blank">RoslynPad</a></li>
</ul>

<h1>
<span id="roslynロズリンとは" class="fragment"></span><a href="#roslyn%E3%83%AD%E3%82%BA%E3%83%AA%E3%83%B3%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>Roslyn(ロズリン)とは？</h1>

<p>C#/VBのコーディングのサポート（インテリセンス、参照の検索等）や、コードを解析してコンパイルを行うAPIの総称です。Visual Studioの内部でも使用されており、さらにオープンソースで公開もされています。<br>
ただ、Scripting APIの仕様がバージョンアップで変わっているため、数年前の記事で紹介されている方法では動かないことがありました。<br>
今回この記事を書こうと思った理由の１つです。</p>

<h1>
<span id="roslynpad" class="fragment"></span><a href="#roslynpad"><i class="fa fa-link"></i></a>RoslynPad</h1>

<p>内部でRoslynを使用しているコードエディタです。単体のアプリとして公開されている他、WPFに組み込めるようにNugGetでも公開されています。しかし、これに関する日本語の記事が全く見当たらない上、サンプルが少し複雑で1行ごとにコンパイルしていくような汎用性がない？ものでした。本記事では最低限のサンプルも紹介しようと思います。</p>

<h1>
<span id="cスクリプト" class="fragment"></span><a href="#c%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88"><i class="fa fa-link"></i></a>C#スクリプト！？</h1>

<p>C#をスクリプトのように実行できるようにした代物です。2015年末に発表されていますがあまり盛り上がってない気がします。試すだけなら、Visual Studioの上部メニューの表示→その他のウィンドウ→C# インタラクティブを選択することでインタラクティブなC#を使用できます。</p>

<h1>
<span id="roslynpadをwinformsで使用しようとしたところ" class="fragment"></span><a href="#roslynpad%E3%82%92winforms%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%97%E3%82%88%E3%81%86%E3%81%A8%E3%81%97%E3%81%9F%E3%81%A8%E3%81%93%E3%82%8D"><i class="fa fa-link"></i></a>RoslynPadをWinFormsで使用しようとしたところ...</h1>

<p>RoslynPadのコントロールはWPF仕様なので基本的にWPFのアプリにしか組み込むことはできません。<br>
しかし、WinFormsにはWPFコントロールを組み込めるElementHostなるものが存在します。<br>
コントロールのみであれば表示することができましたが、インテリセンスの機能を初期化する際にエラーが出でしまいました。</p>

<p>同じパッケージを入れているはずなのにと不思議に思いつつ、検索しても情報はなく、<br>
該当箇所のソース(Roslyn内部)を見て、呼び出しを遡ってみましたが手がかりは得られませんでした。<br>
箇所がそもそもinternalクラスでRoslynPadが直接呼び出しているようなものではなかったのも一因です。</p>

<p>正直、高校生の自分にはこれが限界です。<br>
既存のWinFormsアプリに組み込むなら、別の実行ファイルにして連携するしか方法はないのかもしれません。<br>
最も、新規で作るならそんなゴリ押ししないでWPFで作れという話ですが（^^;<br>
（何か情報があれば教えてもらえるとうれしいです）</p>

<h1>
<span id="とりあえずスクリプト機能をアプリに組み込んでみる" class="fragment"></span><a href="#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E6%A9%9F%E8%83%BD%E3%82%92%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AB%E7%B5%84%E3%81%BF%E8%BE%BC%E3%82%93%E3%81%A7%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>とりあえずスクリプト機能をアプリに組み込んでみる</h1>

<p>前置きが長くなりましたが、初めは単純にTextBoxにC#スクリプトを書き、それを実行できるアプリを作ってみます。</p>

<h2>
<span id="nugetからインストール" class="fragment"></span><a href="#nuget%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>NuGetからインストール</h2>

<p><a href="https://camo.qiitausercontent.com/0dbc94be5e74c84719f9875ef597dd7c5a99de20/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f66373939333166612d363263642d393332352d316635342d6435636264363738376233312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Ff79931fa-62cd-9325-1f54-d5cbd6787b31.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f469b62c82216a4c395f91374ee87ee4" alt="sc2.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/89220/f79931fa-62cd-9325-1f54-d5cbd6787b31.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Ff79931fa-62cd-9325-1f54-d5cbd6787b31.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=76a4e7a779c671de96c25f537e0fbcc2 1x" loading="lazy"></a><br>
「CSharp Scripting」で検索すると出てきます。<br>
これ一つをインストールするだけで依存している大量のライブラリがインストールされます^^;<br>
また、バージョンによって扱い方が異なるので注意してください。<br>
（執筆時のバージョンは2.6.1）</p>

<h2>
<span id="コード" class="fragment"></span><a href="#%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>コード</h2>

<p><a href="https://camo.qiitausercontent.com/76b0798627f2a6a44dcde3480601b8636a66912a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f63333433376139612d616439372d363831632d373664332d3436366663623061353935312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Fc3437a9a-ad97-681c-76d3-466fcb0a5951.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e611efd549e7505d748b65006bc2cf1e" alt="sc10.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/89220/c3437a9a-ad97-681c-76d3-466fcb0a5951.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Fc3437a9a-ad97-681c-76d3-466fcb0a5951.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8e1d0f94f4b396aff501e9d90b7a27c7 1x" loading="lazy"></a></p>

<p>FormsでもWPFでもいいのでテキストボックスとボタンを用意し、ボタンのクリックイベントに以下を貼り付けます</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">Form1.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">button1_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">script</span> <span class="p">=</span> <span class="n">CSharpScript</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">textBox1</span><span class="p">.</span><span class="n">Text</span><span class="p">);</span>
        <span class="n">script</span><span class="p">.</span><span class="nf">RunAsync</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">CompilationErrorException</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
       <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">,</span> <span class="s">"コンパイルエラー"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
       <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">,</span> <span class="s">"エラー"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>最低限これだけあれば動きます。</p>

<h2>
<span id="スクリプトを実行してみる" class="fragment"></span><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>スクリプトを実行してみる</h2>

<p>テキストボックスに</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">script.csx</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Hello Roslyn"</span><span class="p">);</span>
</code></pre></div>
</div>

<p>と入れてボタンを押してみましょう。<br>
<a href="https://camo.qiitausercontent.com/40bec8c825a59ca41ed2e70348a4400b8100a342/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f30646432363366322d333235382d656539632d333735332d6664626238646237616365332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F0dd263f2-3258-ee9c-3753-fdbb8db7ace3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=99f425bac6651ce8c056567b662cd2a3" alt="sc3.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/89220/0dd263f2-3258-ee9c-3753-fdbb8db7ace3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F0dd263f2-3258-ee9c-3753-fdbb8db7ace3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=48c68cf550bf00f2198aa993bec5069c 1x" loading="lazy"></a><br>
...でました、がかなり地味ですね。</p>

<h2>
<span id="毎回最初にusingを描くのはナンセンス" class="fragment"></span><a href="#%E6%AF%8E%E5%9B%9E%E6%9C%80%E5%88%9D%E3%81%ABusing%E3%82%92%E6%8F%8F%E3%81%8F%E3%81%AE%E3%81%AF%E3%83%8A%E3%83%B3%E3%82%BB%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>毎回最初にusingを描くのはナンセンス？</h2>

<p>使いそうなものは予めusingしておくことができます。<br>
先程のコードを以下のように修正してください。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">Form1.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">ScriptOptions</span> <span class="n">options</span> <span class="p">=</span> <span class="n">ScriptOptions</span><span class="p">.</span><span class="n">Default</span>
    <span class="p">.</span><span class="nf">WithImports</span><span class="p">(</span><span class="s">"System"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">script</span> <span class="p">=</span> <span class="n">CSharpScript</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">textBox1</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span><span class="n">options</span><span class="p">);</span>
<span class="n">script</span><span class="p">.</span><span class="nf">RunAsync</span><span class="p">();</span>
</code></pre></div>
</div>

<p>スクリプトを作成する時に実行時のオプションを指定できる、<strong>ScriptOptions</strong>を一緒に渡すことができます。<br>
<strong>ScriptOptions.Default</strong>でデフォルトを取得し、<strong>WithImports</strong>でusingしておくものを指定できます。</p>

<h2>
<span id="メッセージボックスを出してみる" class="fragment"></span><a href="#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%83%9C%E3%83%83%E3%82%AF%E3%82%B9%E3%82%92%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>メッセージボックスを出してみる</h2>

<p>ここで落とし穴があります。<br>
メッセージボックスは<strong>System.Windows.Forms</strong>にありますが、以下のようにしてもエラーが出ます。<br>
（WPFではSystem.Windows.MessageBoxに読み替えてください）</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">Form1.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">ScriptOptions</span> <span class="n">options</span> <span class="p">=</span> <span class="n">ScriptOptions</span><span class="p">.</span><span class="n">Default</span>
    <span class="p">.</span><span class="nf">WithImports</span><span class="p">(</span><span class="s">"System"</span><span class="p">,</span><span class="s">"System.Windows.Forms"</span><span class="p">);</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">script.csx</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">"Hello Roslyn"</span><span class="p">);</span>
</code></pre></div>
</div>

<p><a href="https://camo.qiitausercontent.com/21db2091e1a846a96f9a61b5cf0684f8fde86bae/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f39313364373234322d303162382d653932632d316231622d3835656565346332653037642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F913d7242-01b8-e92c-1b1b-85eee4c2e07d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2d9e4e918d2f4c11cbda9768bbc29d5d" alt="sc4.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/89220/913d7242-01b8-e92c-1b1b-85eee4c2e07d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F913d7242-01b8-e92c-1b1b-85eee4c2e07d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7fbb2ce423fa8b7573f6cf75a1caf3af 1x" loading="lazy"></a></p>

<h2>
<span id="スクリプト環境にはsystemwindowsformsが参照されていない" class="fragment"></span><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E7%92%B0%E5%A2%83%E3%81%AB%E3%81%AFsystemwindowsforms%E3%81%8C%E5%8F%82%E7%85%A7%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>スクリプト環境にはSystem.Windows.Formsが参照されていない！</h2>

<p>外部ライブラリを使用するとき、プロジェクトにdllの参照を追加すると言った場面があると思います。<br>
普段意識しませんが、WinFormsプロジェクトを作成する際にもVSが<strong>System.Windows.Forms.dll</strong>を自動的に参照に追加しています。</p>

<p>スクリプト環境で自動的に参照してくれるのは<strong>System</strong>のみなので、それ以外を使用するには参照に追加する必要があります。<br>
そのためには<strong>ScriptOptions</strong>を以下のようにします。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">Form1.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">ScriptOptions</span> <span class="n">options</span> <span class="p">=</span> <span class="n">ScriptOptions</span><span class="p">.</span><span class="n">Default</span>
    <span class="p">.</span><span class="nf">WithImports</span><span class="p">(</span><span class="s">"System"</span><span class="p">,</span> <span class="s">"System.Windows.Forms"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">WithReferences</span><span class="p">(</span><span class="n">Assembly</span><span class="p">.</span><span class="nf">GetAssembly</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Forms</span><span class="p">.</span><span class="n">MessageBox</span><span class="p">)));</span>
</code></pre></div>
</div>

<p><strong>WithReferences</strong>にdllファイルなどのアセンブリを指定することで参照に追加できます。</p>

<p><strong>System.Windows.Forms.dll</strong>アセンブリを取得するにはいくつか方法があると思いますが、<br>
dllのパスや完全名を調べるのは面倒なので以下のようにします。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="n">Assembly</span><span class="p">.</span><span class="nf">GetAssembly</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Forms</span><span class="p">.</span><span class="n">MessageBox</span><span class="p">))</span>
</code></pre></div></div>

<p><strong>GetAssembly</strong>は指定したクラスが属しているアセンブリを取得するメソッドです。<br>
なので最後はMessageBoxでもFormでもなんでも良いです。<br>
（もっと気持ちのよい書き方があれば教えてください）</p>

<p>これでようやくメッセージボックスが出せました。<br>
<a href="https://camo.qiitausercontent.com/09e8d1b1bc6be5779964292cec47c4c0964e528f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f39623934643737312d383734632d383234362d666433632d3338326261356533373231362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F9b94d771-874c-8246-fd3c-382ba5e37216.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=bfef4fab0c66d9a4563f7a5a62c725fe" alt="sc5.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/89220/9b94d771-874c-8246-fd3c-382ba5e37216.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F9b94d771-874c-8246-fd3c-382ba5e37216.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=aa5b6556bfc8ba34f0c0bb403a19ec37 1x" loading="lazy"></a><br>
ちなみにScriptOptionsを何も指定しない場合でも以下のようにすることでメッセージボックスは出せます。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">script.csx</span></div>
<div class="highlight"><pre class="with-code"><code><span class="err">#</span><span class="n">r</span><span class="s">"System.Windows.Forms"</span>
<span class="k">using</span> <span class="nn">System.Windows.Forms</span><span class="p">;</span>
<span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">"Hello Roslyn"</span><span class="p">);</span>
</code></pre></div>
</div>

<p>#rが参照を動的に追加するC#スクリプト独自の方法のようです。</p>

<h2>
<span id="スクリプト側からアプリの操作をする" class="fragment"></span><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E5%81%B4%E3%81%8B%E3%82%89%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E6%93%8D%E4%BD%9C%E3%82%92%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>スクリプト側からアプリの操作をする</h2>

<p>この記事を読んでいる方の大半は、スクリプトエディタをを作るというより<br>
アプリをスクリプト側から操作できるよう拡張したいと思っていると思います。<br>
では実際にやってみましょう。<br>
具体的には</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="n">script</span><span class="p">.</span><span class="nf">RunAsync</span><span class="p">(</span><span class="n">globals</span><span class="p">);</span>
</code></pre></div></div>

<p>でスクリプト側で使用したいオブジェクトを<strong>globals</strong>に指定します。<br>
そうすることでそのオブジェクトをグローバルな要素としてアクセスできます。<br>
<strong>また、globalsに渡すオブジェクトはpublicである必要があります。</strong><br>
初めに、実行ファイルのパスを返すだけの簡単なクラスを作ります。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">MyClass.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">MyClass</span><span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="nf">GetCurrentPath</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">Path</span><span class="p">.</span><span class="nf">GetDirectoryName</span><span class="p">(</span>
            <span class="n">System</span><span class="p">.</span><span class="n">Reflection</span><span class="p">.</span><span class="n">Assembly</span><span class="p">.</span><span class="nf">GetExecutingAssembly</span><span class="p">().</span><span class="n">Location</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
</div>

<p>スクリプト実行部分を以下のように変更します。</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">Form1.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">script</span> <span class="p">=</span> <span class="n">CSharpScript</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">textBox1</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span><span class="n">options</span><span class="p">,</span><span class="k">typeof</span><span class="p">(</span><span class="n">MyClass</span><span class="p">));</span>
<span class="n">script</span><span class="p">.</span><span class="nf">RunAsync</span><span class="p">(</span><span class="k">new</span> <span class="nf">MyClass</span><span class="p">());</span>
</code></pre></div>
</div>

<p>・<strong>CSharpScript.Create</strong>の引数３に<strong>typeof(MyClass)</strong>が追加されています。<br>
<strong>globals</strong>に渡すオブジェクトのTypeを渡します。</p>

<p>この状態でscript側で</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">script.csx</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="nf">GetCurrentPath</span><span class="p">());</span>
</code></pre></div>
</div>

<p>として実行すると、実行ファイルのパスが表示されると思います。</p>

<h2>
<span id="地味でつまらない" class="fragment"></span><a href="#%E5%9C%B0%E5%91%B3%E3%81%A7%E3%81%A4%E3%81%BE%E3%82%89%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>地味でつまらない？</h2>

<p>上のサンプルではスクリプトで操作した気になれない人は<br>
globalsに自分自身（Form1)を渡してみてください。<br>
そして</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="n">Text</span> <span class="p">=</span> <span class="s">"Hello from Script"</span><span class="p">;</span>
<span class="n">Top</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
</code></pre></div></div>

<p>など普通にFormのプロパティを操作する感覚でスクリプトを書いて実行してみてください。<br>
なにが起こるか、想像はつくと思います。</p>

<h2>
<span id="クラスや構造体などを定義しておく" class="fragment"></span><a href="#%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%84%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%AA%E3%81%A9%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%97%E3%81%A6%E3%81%8A%E3%81%8F"><i class="fa fa-link"></i></a>クラスや構造体などを定義しておく</h2>

<p>スクリプト内で使用するクラスや構造体を予め定義しておけます。<br>
方法は大きく分けて２つあります。</p>

<h2>
<span id="globalsにわたすクラスの内部に入れ子にする" class="fragment"></span><a href="#globals%E3%81%AB%E3%82%8F%E3%81%9F%E3%81%99%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%86%85%E9%83%A8%E3%81%AB%E5%85%A5%E3%82%8C%E5%AD%90%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>globalsにわたすクラスの内部に入れ子にする</h2>

<p>入れ子にしたものはスクリプト内で使用できます。</p>

<h2>
<span id="別のアセンブリに用意してそれを参照する" class="fragment"></span><a href="#%E5%88%A5%E3%81%AE%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E3%81%AB%E7%94%A8%E6%84%8F%E3%81%97%E3%81%A6%E3%81%9D%E3%82%8C%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>別のアセンブリに用意してそれを参照する</h2>

<p>別プロジェクトを作成し、dllをビルドし、参照に追加します。</p>

<p>もしくは使いたいクラスがアプリ内にある場合、<br>
アプリ自身を参照に追加することでも同じことが実現できますが、<br>
<strong>アプリ内にある全てのpublicなクラスがスクリプト側で操作できてしまう危険があります。</strong><br>
例えばオプションに次のように指定します。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="n">ScriptOptions</span> <span class="n">options</span> <span class="p">=</span> <span class="n">ScriptOptions</span><span class="p">.</span><span class="n">Default</span>
     <span class="p">.</span><span class="nf">WithImports</span><span class="p">(</span><span class="s">"System"</span><span class="p">,</span> <span class="s">"System.Windows.Forms"</span><span class="p">,</span><span class="s">"ScriptingTest"</span><span class="p">)</span>
     <span class="p">.</span><span class="nf">WithReferences</span><span class="p">(</span>
      <span class="n">Assembly</span><span class="p">.</span><span class="nf">GetAssembly</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Forms</span><span class="p">.</span><span class="n">MessageBox</span><span class="p">)),</span>
      <span class="n">Assembly</span><span class="p">.</span><span class="nf">GetExecutingAssembly</span><span class="p">()</span>
      <span class="p">);</span>
</code></pre></div></div>

<p><strong>WithImports</strong>の最後に自身の名前空間を、</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="n">Assembly</span><span class="p">.</span><span class="nf">GetExecutingAssembly</span><span class="p">()</span>
</code></pre></div></div>

<p>で自身を参照に追加しています。<br>
この状態で次のスクリプトを実行すると...</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">script.csx</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">new</span> <span class="nf">Form1</span><span class="p">().</span><span class="nf">Show</span><span class="p">();</span>
</code></pre></div>
</div>

<p>今表示されているFormを複製できてしまいます。</p>

<p>入れ子の方法が確実のように思いますが、<br>
<strong>私はアセンブリを分離した上で後者をおすすめします。</strong></p>

<p>なぜならRoslynPadの実装時に自作のクラスを予測に表示する際、<br>
自作のクラスが含まれるアセンブリを必ず参照しなければいけないからです。</p>

<p>アプリにglobalsに渡すクラスが含まれていると、globalsのメソッドやメンバを予測に表示するために<br>
アプリのアセンブリを参照することになり、結果的に後者の危険な方法と変わりなくなってしまいます。</p>

<p>とは言ったものの、コードをシンプルにするために<br>
本記事では分離しません。ご了承ください。</p>

<p>最もRoslynPadを使わないのであれば、入れ子が一番ラクで安全です。</p>

<h1>
<span id="roslynpadを実装してみる" class="fragment"></span><a href="#roslynpad%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>RoslynPadを実装してみる</h1>

<p>WinFormsのテキストボックスも予約語に色付けをしていけば多少使えるかもしれませんが、<br>
インテリセンスの存在は大きいです。<br>
というわけでここからはWPFのみになりますが実装していきます。<br>
WPFのプロジェクトを作成してください。</p>

<h2>
<span id="nugetのインストール" class="fragment"></span><a href="#nuget%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>NuGetのインストール</h2>

<p><a href="https://camo.qiitausercontent.com/851acd73bddb8991258967d3d0867f9d7f4d4b5d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f33376265303232312d333934352d626232382d656230302d3566393830626636343439632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F37be0221-3945-bb28-eb00-5f980bf6449c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=58f792f780b7b0ba8bef90002bef600a" alt="sc6.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/89220/37be0221-3945-bb28-eb00-5f980bf6449c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F37be0221-3945-bb28-eb00-5f980bf6449c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e6ac0bf38ba8d418bd066ce0afb21da4 1x" loading="lazy"></a><br>
「RoslynPad」で検索するといくつか出てきますが、この中で必要なのは画像中の真ん中３つです。<br>
依存関係的に真ん中をインストールすると必要なものはすべてインストールされます。<br>
先程のCSharpScriptもインストールされます。</p>

<h2>
<span id="レイアウト" class="fragment"></span><a href="#%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88"><i class="fa fa-link"></i></a>レイアウト</h2>

<p><a href="https://camo.qiitausercontent.com/031d3ed3d168b6d2a7ecf2f7f86654fe7ef8de11/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f32346537613866662d643365632d366233372d373631372d3964646362623634353034642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F24e7a8ff-d3ec-6b37-7617-9ddcbb64504d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f0d7f12cab5809c15d6bfbdee466cd09" alt="sc7.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/89220/24e7a8ff-d3ec-6b37-7617-9ddcbb64504d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F24e7a8ff-d3ec-6b37-7617-9ddcbb64504d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=54e85fe1b03bb8944ae99aef1c38b8dd 1x" loading="lazy"></a><br>
ボタンとRoslynCodeEditorを適当に配置してください。<br>
xamlの頭に以下を追記する必要があります。</p>

<p><code>xmlns:editor="clr-namespace:RoslynPad.Editor;assembly=RoslynPad.Editor.Windows"</code></p>

<h2>
<span id="コード-1" class="fragment"></span><a href="#%E3%82%B3%E3%83%BC%E3%83%89-1"><i class="fa fa-link"></i></a>コード</h2>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">MainWindow.xaml.cs</span></div>
<div class="highlight"><pre class="with-code"><code>    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// MainWindow.xaml の相互作用ロジック</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MainWindow</span> <span class="p">:</span> <span class="n">Window</span>
    <span class="p">{</span>
        <span class="n">RoslynHost</span> <span class="n">host</span><span class="p">;</span>
        <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
            <span class="n">host</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RoslynHost</span><span class="p">(</span><span class="n">additionalAssemblies</span><span class="p">:</span> <span class="k">new</span><span class="p">[]</span>
            <span class="p">{</span>
                <span class="n">Assembly</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"RoslynPad.Roslyn.Windows"</span><span class="p">),</span>
                <span class="n">Assembly</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"RoslynPad.Editor.Windows"</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">RoslynCodeEditor_Loaded</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">roslynCodeEditor</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ClassificationHighlightColors</span><span class="p">(),</span> <span class="n">Directory</span><span class="p">.</span><span class="nf">GetCurrentDirectory</span><span class="p">(),</span> <span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">Button_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="n">ScriptOptions</span> <span class="n">options</span> <span class="p">=</span> <span class="n">ScriptOptions</span><span class="p">.</span><span class="n">Default</span>
                    <span class="p">.</span><span class="nf">WithReferences</span><span class="p">(</span><span class="n">host</span><span class="p">.</span><span class="n">DefaultReferences</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">WithImports</span><span class="p">(</span><span class="n">host</span><span class="p">.</span><span class="n">DefaultImports</span><span class="p">);</span>

                <span class="kt">var</span> <span class="n">script</span> <span class="p">=</span> <span class="n">CSharpScript</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">roslynCodeEditor</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">MyClass</span><span class="p">));</span>
                <span class="n">script</span><span class="p">.</span><span class="nf">RunAsync</span><span class="p">(</span><span class="k">new</span> <span class="nf">MyClass</span><span class="p">());</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">CompilationErrorException</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">,</span> <span class="s">"コンパイルエラー"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">,</span> <span class="s">"エラー"</span><span class="p">);</span>

            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
</div>

<p>公式のサンプルを削りに削った結果こうなりました^^;<br>
これで一応動きます。</p>

<h3>
<span id="１コンストラクタ" class="fragment"></span><a href="#%EF%BC%91%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF"><i class="fa fa-link"></i></a>１.コンストラクタ</h3>

<p><strong>RoslynHost</strong>というインテリセンスなどの機能を提供するオブジェクトを初期化します。<br>
（冒頭のWinFormsエラーはここで出ました）<br>
<strong>additionalAssemblies</strong>に既に指定がありますが、これは必須のようです。</p>

<h3>
<span id="２roslyncodeeditor_loaded" class="fragment"></span><a href="#%EF%BC%92roslyncodeeditor_loaded"><i class="fa fa-link"></i></a>２.RoslynCodeEditor_Loaded</h3>

<p>エディタコントロールを初期化します。</p>

<ul>
<li>引数１には１で生成したRoslynHostオブジェクト</li>
<li>引数２にはコードをハイライトするためのクラス</li>
<li>引数３には実行ファイルがあるディレクトリのパス（コード内にファイルへのパスを指定する場面があるとこの設定に沿って相対パス等を補完する目的で使われる？）</li>
<li>引数４には初めに入力されているコードを指定します</li>
</ul>

<p>※RoslynCodeEditorのLoadedイベントに登録しておいてください。</p>

<h3>
<span id="３button_click" class="fragment"></span><a href="#%EF%BC%93button_click"><i class="fa fa-link"></i></a>３.Button_Click</h3>

<p>普通にエディタに入力されたテキストからスクリプトを作成、実行しています。<br>
注目してほしいのが<strong>ScriptOptions</strong>にRoslynHostの<strong>DefaultReferences</strong>と<strong>DefaultImports</strong><br>
が指定されていることです。これが次のキーになります。</p>

<h2>
<span id="実行するとエディタが" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E3%81%8C"><i class="fa fa-link"></i></a>実行するとエディタが！</h2>

<p>実行するとちゃんとエディタとして機能すると思います。<br>
しかし、ここであることに気づきます。<br>
<a href="https://camo.qiitausercontent.com/77ccfd03f1bb41aff24182335b41296c6a5017fa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f35666335333464612d633836312d396635652d633863632d6565343437656661643336352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F5fc534da-c861-9f5e-c8cc-ee447efad365.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e6640afa0d59c6eeb2577feb2616ca47" alt="sc8.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/89220/5fc534da-c861-9f5e-c8cc-ee447efad365.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F5fc534da-c861-9f5e-c8cc-ee447efad365.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f296ca5ff35e64744c989fc78835280e 1x" loading="lazy"></a><br>
これを見て何か気づきませんか...？</p>

<p>そうです。<br>
using Systemをしていないのにも関わらずConsoleが使用できています。<br>
実行もできます。これは一体どういうことなのでしょうか？</p>

<h2>
<span id="roslynhostは必要そうなものを予め追加してくれている" class="fragment"></span><a href="#roslynhost%E3%81%AF%E5%BF%85%E8%A6%81%E3%81%9D%E3%81%86%E3%81%AA%E3%82%82%E3%81%AE%E3%82%92%E4%BA%88%E3%82%81%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%A6%E3%81%8F%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B"><i class="fa fa-link"></i></a>RoslynHostは必要そうなものを予め追加してくれている</h2>

<p>先程のScriptOptionsに次のように指定しました</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">MainWindow.xaml.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">ScriptOptions</span> <span class="n">options</span> <span class="p">=</span> <span class="n">ScriptOptions</span><span class="p">.</span><span class="n">Default</span>
    <span class="p">.</span><span class="nf">WithReferences</span><span class="p">(</span><span class="n">host</span><span class="p">.</span><span class="n">DefaultReferences</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">WithImports</span><span class="p">(</span><span class="n">host</span><span class="p">.</span><span class="n">DefaultImports</span><span class="p">);</span>
</code></pre></div>
</div>

<p>初めにusing担当のDefaultImportsの中身を見てみましょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>System
System.Threading
System.Threading.Tasks
System.Collections.Generic
System.Text.RegularExpressions
System.Text
System
System.Linq
System.Collections
System.IO
System.Reflection
</code></pre></div></div>

<p>これらが初めから追加されていることがわかります。<br>
便利！</p>

<p>DefaultReferencesの中身は上記の他にエディタに必要な大量のdllが指定されていました。<br>
多すぎるので割愛します。</p>

<h2>
<span id="globalsに渡したクラスのメンバを予測に表示する" class="fragment"></span><a href="#globals%E3%81%AB%E6%B8%A1%E3%81%97%E3%81%9F%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E3%83%A1%E3%83%B3%E3%83%90%E3%82%92%E4%BA%88%E6%B8%AC%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>globalsに渡したクラスのメンバを予測に表示する</h2>

<p>これには一手間必要です。まず、先程のMyClassを追加しておいてください。<br>
そして、今まで使用してきたRoslynHostクラスに手を加えます。</p>

<p>まずはRoslynHostを継承したCustomRoslynHostを作成します。<br>
そして次のようにします。</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">CustomRoslynHost.cs</span></div>
<div class="highlight"><pre class="with-code"><code>    <span class="k">class</span> <span class="nc">CustomRoslynHost</span> <span class="p">:</span> <span class="n">RoslynHost</span>
    <span class="p">{</span>

        <span class="k">public</span> <span class="nf">CustomRoslynHost</span><span class="p">(</span><span class="n">NuGetConfiguration</span> <span class="n">nuGetConfiguration</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
            <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Assembly</span><span class="p">&gt;</span> <span class="n">additionalAssemblies</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
            <span class="n">RoslynHostReferences</span> <span class="n">references</span> <span class="p">=</span> <span class="k">null</span><span class="p">):</span><span class="k">base</span><span class="p">(</span><span class="n">nuGetConfiguration</span><span class="p">,</span><span class="n">additionalAssemblies</span><span class="p">,</span><span class="n">references</span><span class="p">)</span>
        <span class="p">{</span>

        <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="n">Project</span> <span class="nf">CreateProject</span><span class="p">(</span><span class="n">Solution</span> <span class="n">solution</span><span class="p">,</span> <span class="n">DocumentCreationArgs</span> <span class="n">args</span><span class="p">,</span> <span class="n">CompilationOptions</span> <span class="n">compilationOptions</span><span class="p">,</span> <span class="n">Project</span> <span class="n">previousProject</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">name</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="n">Name</span> <span class="p">??</span> <span class="s">"Program"</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">id</span> <span class="p">=</span> <span class="n">ProjectId</span><span class="p">.</span><span class="nf">CreateNewId</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">parseOptions</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CSharpParseOptions</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span> <span class="n">SourceCodeKind</span><span class="p">.</span><span class="n">Script</span><span class="p">,</span> <span class="n">languageVersion</span><span class="p">:</span> <span class="n">LanguageVersion</span><span class="p">.</span><span class="n">Latest</span><span class="p">);</span>

            <span class="n">compilationOptions</span> <span class="p">=</span> <span class="n">compilationOptions</span><span class="p">.</span><span class="nf">WithScriptClassName</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>

            <span class="n">solution</span> <span class="p">=</span> <span class="n">solution</span><span class="p">.</span><span class="nf">AddProject</span><span class="p">(</span><span class="n">ProjectInfo</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span>
                <span class="n">id</span><span class="p">,</span>
                <span class="n">VersionStamp</span><span class="p">.</span><span class="nf">Create</span><span class="p">(),</span>
                <span class="n">name</span><span class="p">,</span>
                <span class="n">name</span><span class="p">,</span>
                <span class="n">LanguageNames</span><span class="p">.</span><span class="n">CSharp</span><span class="p">,</span>
                <span class="n">isSubmission</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span>
                <span class="n">parseOptions</span><span class="p">:</span> <span class="n">parseOptions</span><span class="p">,</span>
                <span class="n">hostObjectType</span><span class="p">:</span> <span class="k">typeof</span><span class="p">(</span><span class="n">MyClass</span><span class="p">),</span>
                <span class="n">compilationOptions</span><span class="p">:</span> <span class="n">compilationOptions</span><span class="p">,</span>
                <span class="n">metadataReferences</span><span class="p">:</span> <span class="n">previousProject</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">?</span> <span class="n">ImmutableArray</span><span class="p">&lt;</span><span class="n">MetadataReference</span><span class="p">&gt;.</span><span class="n">Empty</span> <span class="p">:</span> <span class="n">DefaultReferences</span><span class="p">,</span>
                <span class="n">projectReferences</span><span class="p">:</span> <span class="n">previousProject</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">?</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="k">new</span> <span class="nf">ProjectReference</span><span class="p">(</span><span class="n">previousProject</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span> <span class="p">}</span> <span class="p">:</span> <span class="k">null</span><span class="p">));</span>

            <span class="kt">var</span> <span class="n">project</span> <span class="p">=</span> <span class="n">solution</span><span class="p">.</span><span class="nf">GetProject</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">project</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
</div>

<p>ここはどんな処理をしているか理解する必要はありません。<br>
重要なのは下から９行目にある</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="n">hostObjectType</span><span class="p">:</span> <span class="k">typeof</span><span class="p">(</span><span class="n">MyClass</span><span class="p">),</span>
</code></pre></div></div>

<p>という部分です。<br>
ここにglobalsに渡したクラスのTypeを渡します。<br>
これでglobalsにMyClassを指定したとRoslynPadに明示できます。</p>

<p>ただこれだけでは、予測に表示されません。<br>
クラスを含むアセンブリを参照に追加する必要があります。<br>
次に説明します。</p>

<h2>
<span id="自作のクラスを予測に表示する" class="fragment"></span><a href="#%E8%87%AA%E4%BD%9C%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BA%88%E6%B8%AC%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>自作のクラスを予測に表示する</h2>

<p>RoslynHostの初期化部分を以下のように書き換えるだけです。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">MainWindow.xaml.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">host</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CustomRoslynHost</span><span class="p">(</span><span class="n">additionalAssemblies</span><span class="p">:</span> <span class="k">new</span><span class="p">[]</span>
      <span class="p">{</span>
          <span class="n">Assembly</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"RoslynPad.Roslyn.Windows"</span><span class="p">),</span>
          <span class="n">Assembly</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"RoslynPad.Editor.Windows"</span><span class="p">)</span>
      <span class="p">},</span>
      <span class="n">references</span><span class="p">:</span> <span class="n">RoslynHostReferences</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">With</span><span class="p">(</span><span class="n">typeNamespaceImports</span><span class="p">:</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="k">typeof</span><span class="p">(</span><span class="n">MyClass</span><span class="p">)})</span>
      <span class="p">);</span>
</code></pre></div>
</div>

<p>referencesに表示したいクラスを指定します。<br>
正確にはこれだけでMyClassを含むアセンブリが自動的に参照に追加されます。<br>
そのアセンブリに別のpublicなクラスが含まれていた場合、そのクラスも自動的に使用できるようになります。</p>

<p>また、今までScriptOptionsに参照の追加＆usingのオプションを指定していましたが<br>
自動的に<strong>RoslynHost</strong>の<strong>DefaultReferences</strong>と<strong>DefaultImports</strong>に追加されます。<br>
よってScriptOptionsに改めて指定する必要はありません。</p>

<p>これで実行してみると、見事に表示されていることがわかります。<br>
<a href="https://camo.qiitausercontent.com/dc9eb574ba93699ac3b518cf072101b0e77ccb95/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f63653637353465322d663037372d646534612d363166612d3330613962383734636364612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Fce6754e2-f077-de4a-61fa-30a9b874ccda.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d5d7e99ebc1b311ad24324845665ee07" alt="sc12.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/89220/ce6754e2-f077-de4a-61fa-30a9b874ccda.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Fce6754e2-f077-de4a-61fa-30a9b874ccda.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7c784eb13d1674264567d85647d1152c 1x" loading="lazy"></a></p>

<p>最終的なMainWindow.xaml.csは以下になります。</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">MainWindow.xaml.cs</span></div>
<div class="highlight"><pre class="with-code"><code>    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// MainWindow.xaml の相互作用ロジック</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MainWindow</span> <span class="p">:</span> <span class="n">Window</span>
    <span class="p">{</span>
        <span class="n">RoslynHost</span> <span class="n">host</span><span class="p">;</span>
        <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
            <span class="n">host</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CustomRoslynHost</span><span class="p">(</span><span class="n">additionalAssemblies</span><span class="p">:</span> <span class="k">new</span><span class="p">[]</span>
            <span class="p">{</span>
                <span class="n">Assembly</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"RoslynPad.Roslyn.Windows"</span><span class="p">),</span>
                <span class="n">Assembly</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"RoslynPad.Editor.Windows"</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">references</span><span class="p">:</span> <span class="n">RoslynHostReferences</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">With</span><span class="p">(</span><span class="n">typeNamespaceImports</span><span class="p">:</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="k">typeof</span><span class="p">(</span><span class="n">MyClass</span><span class="p">)})</span>
            <span class="p">);</span>


        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">RoslynCodeEditor_Loaded</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">roslynCodeEditor</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ClassificationHighlightColors</span><span class="p">(),</span> <span class="n">Directory</span><span class="p">.</span><span class="nf">GetCurrentDirectory</span><span class="p">(),</span> <span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">Button_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="n">ScriptOptions</span> <span class="n">options</span> <span class="p">=</span> <span class="n">ScriptOptions</span><span class="p">.</span><span class="n">Default</span>
                    <span class="p">.</span><span class="nf">WithReferences</span><span class="p">(</span><span class="n">host</span><span class="p">.</span><span class="n">DefaultReferences</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">WithImports</span><span class="p">(</span><span class="n">host</span><span class="p">.</span><span class="n">DefaultImports</span><span class="p">);</span>

                <span class="kt">var</span> <span class="n">script</span> <span class="p">=</span> <span class="n">CSharpScript</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">roslynCodeEditor</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">MyClass</span><span class="p">));</span>
                <span class="n">script</span><span class="p">.</span><span class="nf">RunAsync</span><span class="p">(</span><span class="k">new</span> <span class="nf">MyClass</span><span class="p">());</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">CompilationErrorException</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">,</span> <span class="s">"コンパイルエラー"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">,</span> <span class="s">"エラー"</span><span class="p">);</span>

            <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
</div>

<p>注意すべき点としてCustomRoslynHostでMyClassを指定しておきながら、<br>
gloablsに何も渡さなかった場合、予測に表示はされるのに実行時にエラーが出るという状態になってしまいます。</p>

<h1>
<span id="終わりに" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>終わりに</h1>

<p>RoslynPadの存在を知ることができたのは幸運でした。<br>
が、RoslynPadの日本語の情報がなかったためかなり苦戦しました。<br>
しかし、これで自分のアプリにどんどん利便性の高いスクリプティング機能を実装できそうです。</p>

<p>この記事は英語記事や、サンプルを自分なりに解釈して書いていることが多いので<br>
間違っている内容が含まれている可能性があります。<br>
その場合はどんどん報告していただけると助かります。<br>
では、最後まで読んでいただきありがとうございました。</p>

<h1>
<span id="参考文献" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-link"></i></a>参考文献</h1>

<ul>
<li><a href="https://github.com/dotnet/roslyn/wiki/Scripting-API-Samples" rel="nofollow noopener" target="_blank">Scripting API Samples</a></li>
<li><a href="https://www.kekyo.net/2015/05/13/4893" rel="nofollow noopener" target="_blank">Roslyn for Scriptingで、あなたのアプリケーションにもC#スクリプトを！！</a></li>
<li><a href="https://qiita.com/hukatama024e/items/741dd950096c3b4c688c" id="reference-bd56d269f6ca18ae0256">【C#】Roslyn for Scriptingについて</a></li>
<li><a href="http://www.buildinsider.net/enterprise/roslyn/01" rel="nofollow noopener" target="_blank">Visual Studio 2015の新機能“Roslyn”とは</a></li>
<li><a href="https://github.com/dotnet/roslyn/wiki/Roslyn%20Overview" rel="nofollow noopener" target="_blank">.NET Compiler Platform ("Roslyn") Overview</a></li>
<li><a href="https://github.com/aelij/RoslynPad" rel="nofollow noopener" target="_blank">RoslynPad</a></li>
<li><a href="https://github.com/aelij/RoslynPad/issues/129" rel="nofollow noopener" target="_blank">Ability to add custom assembly to references in RoslynPad.Editor.Windows</a></li>
<li><a href="https://stackoverflow.com/questions/47293326/is-it-possible-to-include-intellisense-for-the-object-global-of-globalstype-in-t" rel="nofollow noopener" target="_blank">Is it possible to include intellisense for the object global of globalsType in the RoslynPad RoslynCodeEditor control?</a></li>
</ul>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fsiy1121%2Fitems%2Faee3ce1fff6e83e33b22&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fsiy1121%2Fitems%2Faee3ce1fff6e83e33b22&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/siy1121/items/aee3ce1fff6e83e33b22/likers" class="css-1iupg5d">67</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">64</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/aee3ce1fff6e83e33b22/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/siy1121/items/aee3ce1fff6e83e33b22/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/siy1121/items/aee3ce1fff6e83e33b22/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/siy1121/items/aee3ce1fff6e83e33b22/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/siy1121/items/aee3ce1fff6e83e33b22.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-3c7d8d81-201b-45eb-8a2c-c723831c3477">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-b19fa2f6-9fa8-46d1-b961-ecc8aac68fa5"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-b19fa2f6-9fa8-46d1-b961-ecc8aac68fa5">{}</script>
      
<div id="LoginModal-react-component-126677fd-895c-4fe6-a078-7f07639f9ee6"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-126677fd-895c-4fe6-a078-7f07639f9ee6">{}</script>
      
<div id="StockModal-react-component-e450586f-e445-4dc7-b38c-25daddbf9d98"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-e450586f-e445-4dc7-b38c-25daddbf9d98">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;7at7MiZ3KaQmS7Mr/Nce4GJC+JOEVzvO4Uwc1/7CXAnjvb31je+Qh5aW061irkw3hMYcnEOOjpvvFFctLKb6uQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"こんなものを作ります\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%82%93%E3%81%AA%E3%82%82%E3%81%AE%E3%82%92%E4%BD%9C%E3%82%8A%E3%81%BE%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこんなものを作ります\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/501a7e51664174466ae192c6e57f81e8333a8c10/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f35326466653030352d373438362d343561622d356231632d6137313833613063336138372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F52dfe005-7486-45ab-5b1c-a7183a0c3a87.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4566f7c6eb8fe5b43c4d200fcb005b9e\" alt=\"sc1.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/89220/52dfe005-7486-45ab-5b1c-a7183a0c3a87.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F52dfe005-7486-45ab-5b1c-a7183a0c3a87.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f4bf1ab6e41640caf571ef7a5f187cef 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nC#スクリプトをアプリケーションに組み込むだけでなく、\u003cbr\u003e\n上の画像のようにインテリセンスやハイライトが効くエディタを組み込んでみます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"使用するもの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%82%82%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使用するもの\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/dotnet/roslyn\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRoslyn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/aelij/RoslynPad\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRoslynPad\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"roslynロズリンとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#roslyn%E3%83%AD%E3%82%BA%E3%83%AA%E3%83%B3%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRoslyn(ロズリン)とは？\u003c/h1\u003e\n\n\u003cp\u003eC#/VBのコーディングのサポート（インテリセンス、参照の検索等）や、コードを解析してコンパイルを行うAPIの総称です。Visual Studioの内部でも使用されており、さらにオープンソースで公開もされています。\u003cbr\u003e\nただ、Scripting APIの仕様がバージョンアップで変わっているため、数年前の記事で紹介されている方法では動かないことがありました。\u003cbr\u003e\n今回この記事を書こうと思った理由の１つです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"roslynpad\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#roslynpad\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRoslynPad\u003c/h1\u003e\n\n\u003cp\u003e内部でRoslynを使用しているコードエディタです。単体のアプリとして公開されている他、WPFに組み込めるようにNugGetでも公開されています。しかし、これに関する日本語の記事が全く見当たらない上、サンプルが少し複雑で1行ごとにコンパイルしていくような汎用性がない？ものでした。本記事では最低限のサンプルも紹介しようと思います。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"cスクリプト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC#スクリプト！？\u003c/h1\u003e\n\n\u003cp\u003eC#をスクリプトのように実行できるようにした代物です。2015年末に発表されていますがあまり盛り上がってない気がします。試すだけなら、Visual Studioの上部メニューの表示→その他のウィンドウ→C# インタラクティブを選択することでインタラクティブなC#を使用できます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"roslynpadをwinformsで使用しようとしたところ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#roslynpad%E3%82%92winforms%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%97%E3%82%88%E3%81%86%E3%81%A8%E3%81%97%E3%81%9F%E3%81%A8%E3%81%93%E3%82%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRoslynPadをWinFormsで使用しようとしたところ...\u003c/h1\u003e\n\n\u003cp\u003eRoslynPadのコントロールはWPF仕様なので基本的にWPFのアプリにしか組み込むことはできません。\u003cbr\u003e\nしかし、WinFormsにはWPFコントロールを組み込めるElementHostなるものが存在します。\u003cbr\u003e\nコントロールのみであれば表示することができましたが、インテリセンスの機能を初期化する際にエラーが出でしまいました。\u003c/p\u003e\n\n\u003cp\u003e同じパッケージを入れているはずなのにと不思議に思いつつ、検索しても情報はなく、\u003cbr\u003e\n該当箇所のソース(Roslyn内部)を見て、呼び出しを遡ってみましたが手がかりは得られませんでした。\u003cbr\u003e\n箇所がそもそもinternalクラスでRoslynPadが直接呼び出しているようなものではなかったのも一因です。\u003c/p\u003e\n\n\u003cp\u003e正直、高校生の自分にはこれが限界です。\u003cbr\u003e\n既存のWinFormsアプリに組み込むなら、別の実行ファイルにして連携するしか方法はないのかもしれません。\u003cbr\u003e\n最も、新規で作るならそんなゴリ押ししないでWPFで作れという話ですが（^^;\u003cbr\u003e\n（何か情報があれば教えてもらえるとうれしいです）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"とりあえずスクリプト機能をアプリに組み込んでみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E6%A9%9F%E8%83%BD%E3%82%92%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AB%E7%B5%84%E3%81%BF%E8%BE%BC%E3%82%93%E3%81%A7%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eとりあえずスクリプト機能をアプリに組み込んでみる\u003c/h1\u003e\n\n\u003cp\u003e前置きが長くなりましたが、初めは単純にTextBoxにC#スクリプトを書き、それを実行できるアプリを作ってみます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"nugetからインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nuget%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eNuGetからインストール\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/0dbc94be5e74c84719f9875ef597dd7c5a99de20/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f66373939333166612d363263642d393332352d316635342d6435636264363738376233312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Ff79931fa-62cd-9325-1f54-d5cbd6787b31.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f469b62c82216a4c395f91374ee87ee4\" alt=\"sc2.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/89220/f79931fa-62cd-9325-1f54-d5cbd6787b31.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Ff79931fa-62cd-9325-1f54-d5cbd6787b31.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=76a4e7a779c671de96c25f537e0fbcc2 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n「CSharp Scripting」で検索すると出てきます。\u003cbr\u003e\nこれ一つをインストールするだけで依存している大量のライブラリがインストールされます^^;\u003cbr\u003e\nまた、バージョンによって扱い方が異なるので注意してください。\u003cbr\u003e\n（執筆時のバージョンは2.6.1）\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコード\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/76b0798627f2a6a44dcde3480601b8636a66912a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f63333433376139612d616439372d363831632d373664332d3436366663623061353935312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Fc3437a9a-ad97-681c-76d3-466fcb0a5951.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e611efd549e7505d748b65006bc2cf1e\" alt=\"sc10.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/89220/c3437a9a-ad97-681c-76d3-466fcb0a5951.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Fc3437a9a-ad97-681c-76d3-466fcb0a5951.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8e1d0f94f4b396aff501e9d90b7a27c7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eFormsでもWPFでもいいのでテキストボックスとボタンを用意し、ボタンのクリックイベントに以下を貼り付けます\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eForm1.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ebutton1_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003escript\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCSharpScript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etextBox1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCompilationErrorException\u003c/span\u003e \u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n       \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"コンパイルエラー\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n       \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"エラー\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e最低限これだけあれば動きます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"スクリプトを実行してみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスクリプトを実行してみる\u003c/h2\u003e\n\n\u003cp\u003eテキストボックスに\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003escript.csx\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Hello Roslyn\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eと入れてボタンを押してみましょう。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/40bec8c825a59ca41ed2e70348a4400b8100a342/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f30646432363366322d333235382d656539632d333735332d6664626238646237616365332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F0dd263f2-3258-ee9c-3753-fdbb8db7ace3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=99f425bac6651ce8c056567b662cd2a3\" alt=\"sc3.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/89220/0dd263f2-3258-ee9c-3753-fdbb8db7ace3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F0dd263f2-3258-ee9c-3753-fdbb8db7ace3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=48c68cf550bf00f2198aa993bec5069c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n...でました、がかなり地味ですね。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"毎回最初にusingを描くのはナンセンス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AF%8E%E5%9B%9E%E6%9C%80%E5%88%9D%E3%81%ABusing%E3%82%92%E6%8F%8F%E3%81%8F%E3%81%AE%E3%81%AF%E3%83%8A%E3%83%B3%E3%82%BB%E3%83%B3%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e毎回最初にusingを描くのはナンセンス？\u003c/h2\u003e\n\n\u003cp\u003e使いそうなものは予めusingしておくことができます。\u003cbr\u003e\n先程のコードを以下のように修正してください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eForm1.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithImports\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"System\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003escript\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCSharpScript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etextBox1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eスクリプトを作成する時に実行時のオプションを指定できる、\u003cstrong\u003eScriptOptions\u003c/strong\u003eを一緒に渡すことができます。\u003cbr\u003e\n\u003cstrong\u003eScriptOptions.Default\u003c/strong\u003eでデフォルトを取得し、\u003cstrong\u003eWithImports\u003c/strong\u003eでusingしておくものを指定できます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"メッセージボックスを出してみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%83%9C%E3%83%83%E3%82%AF%E3%82%B9%E3%82%92%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメッセージボックスを出してみる\u003c/h2\u003e\n\n\u003cp\u003eここで落とし穴があります。\u003cbr\u003e\nメッセージボックスは\u003cstrong\u003eSystem.Windows.Forms\u003c/strong\u003eにありますが、以下のようにしてもエラーが出ます。\u003cbr\u003e\n（WPFではSystem.Windows.MessageBoxに読み替えてください）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eForm1.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithImports\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"System\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"System.Windows.Forms\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003escript.csx\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Hello Roslyn\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/21db2091e1a846a96f9a61b5cf0684f8fde86bae/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f39313364373234322d303162382d653932632d316231622d3835656565346332653037642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F913d7242-01b8-e92c-1b1b-85eee4c2e07d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2d9e4e918d2f4c11cbda9768bbc29d5d\" alt=\"sc4.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/89220/913d7242-01b8-e92c-1b1b-85eee4c2e07d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F913d7242-01b8-e92c-1b1b-85eee4c2e07d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7fbb2ce423fa8b7573f6cf75a1caf3af 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"スクリプト環境にはsystemwindowsformsが参照されていない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E7%92%B0%E5%A2%83%E3%81%AB%E3%81%AFsystemwindowsforms%E3%81%8C%E5%8F%82%E7%85%A7%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスクリプト環境にはSystem.Windows.Formsが参照されていない！\u003c/h2\u003e\n\n\u003cp\u003e外部ライブラリを使用するとき、プロジェクトにdllの参照を追加すると言った場面があると思います。\u003cbr\u003e\n普段意識しませんが、WinFormsプロジェクトを作成する際にもVSが\u003cstrong\u003eSystem.Windows.Forms.dll\u003c/strong\u003eを自動的に参照に追加しています。\u003c/p\u003e\n\n\u003cp\u003eスクリプト環境で自動的に参照してくれるのは\u003cstrong\u003eSystem\u003c/strong\u003eのみなので、それ以外を使用するには参照に追加する必要があります。\u003cbr\u003e\nそのためには\u003cstrong\u003eScriptOptions\u003c/strong\u003eを以下のようにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eForm1.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithImports\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"System\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"System.Windows.Forms\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eForms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eWithReferences\u003c/strong\u003eにdllファイルなどのアセンブリを指定することで参照に追加できます。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eSystem.Windows.Forms.dll\u003c/strong\u003eアセンブリを取得するにはいくつか方法があると思いますが、\u003cbr\u003e\ndllのパスや完全名を調べるのは面倒なので以下のようにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eForms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eGetAssembly\u003c/strong\u003eは指定したクラスが属しているアセンブリを取得するメソッドです。\u003cbr\u003e\nなので最後はMessageBoxでもFormでもなんでも良いです。\u003cbr\u003e\n（もっと気持ちのよい書き方があれば教えてください）\u003c/p\u003e\n\n\u003cp\u003eこれでようやくメッセージボックスが出せました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/09e8d1b1bc6be5779964292cec47c4c0964e528f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f39623934643737312d383734632d383234362d666433632d3338326261356533373231362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F9b94d771-874c-8246-fd3c-382ba5e37216.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bfef4fab0c66d9a4563f7a5a62c725fe\" alt=\"sc5.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/89220/9b94d771-874c-8246-fd3c-382ba5e37216.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F9b94d771-874c-8246-fd3c-382ba5e37216.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=aa5b6556bfc8ba34f0c0bb403a19ec37 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nちなみにScriptOptionsを何も指定しない場合でも以下のようにすることでメッセージボックスは出せます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003escript.csx\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"s\"\u003e\"System.Windows.Forms\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Windows.Forms\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Hello Roslyn\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e#rが参照を動的に追加するC#スクリプト独自の方法のようです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"スクリプト側からアプリの操作をする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E5%81%B4%E3%81%8B%E3%82%89%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E6%93%8D%E4%BD%9C%E3%82%92%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスクリプト側からアプリの操作をする\u003c/h2\u003e\n\n\u003cp\u003eこの記事を読んでいる方の大半は、スクリプトエディタをを作るというより\u003cbr\u003e\nアプリをスクリプト側から操作できるよう拡張したいと思っていると思います。\u003cbr\u003e\nでは実際にやってみましょう。\u003cbr\u003e\n具体的には\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eglobals\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eでスクリプト側で使用したいオブジェクトを\u003cstrong\u003eglobals\u003c/strong\u003eに指定します。\u003cbr\u003e\nそうすることでそのオブジェクトをグローバルな要素としてアクセスできます。\u003cbr\u003e\n\u003cstrong\u003eまた、globalsに渡すオブジェクトはpublicである必要があります。\u003c/strong\u003e\u003cbr\u003e\n初めに、実行ファイルのパスを返すだけの簡単なクラスを作ります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMyClass.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMyClass\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetCurrentPath\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIO\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDirectoryName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReflection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetExecutingAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eLocation\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eスクリプト実行部分を以下のように変更します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eForm1.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003escript\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCSharpScript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etextBox1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyClass\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"n\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyClass\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e・\u003cstrong\u003eCSharpScript.Create\u003c/strong\u003eの引数３に\u003cstrong\u003etypeof(MyClass)\u003c/strong\u003eが追加されています。\u003cbr\u003e\n\u003cstrong\u003eglobals\u003c/strong\u003eに渡すオブジェクトのTypeを渡します。\u003c/p\u003e\n\n\u003cp\u003eこの状態でscript側で\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003escript.csx\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCurrentPath\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eとして実行すると、実行ファイルのパスが表示されると思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"地味でつまらない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9C%B0%E5%91%B3%E3%81%A7%E3%81%A4%E3%81%BE%E3%82%89%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e地味でつまらない？\u003c/h2\u003e\n\n\u003cp\u003e上のサンプルではスクリプトで操作した気になれない人は\u003cbr\u003e\nglobalsに自分自身（Form1)を渡してみてください。\u003cbr\u003e\nそして\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Hello from Script\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eTop\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなど普通にFormのプロパティを操作する感覚でスクリプトを書いて実行してみてください。\u003cbr\u003e\nなにが起こるか、想像はつくと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"クラスや構造体などを定義しておく\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%84%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%AA%E3%81%A9%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%97%E3%81%A6%E3%81%8A%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eクラスや構造体などを定義しておく\u003c/h2\u003e\n\n\u003cp\u003eスクリプト内で使用するクラスや構造体を予め定義しておけます。\u003cbr\u003e\n方法は大きく分けて２つあります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"globalsにわたすクラスの内部に入れ子にする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#globals%E3%81%AB%E3%82%8F%E3%81%9F%E3%81%99%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%86%85%E9%83%A8%E3%81%AB%E5%85%A5%E3%82%8C%E5%AD%90%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eglobalsにわたすクラスの内部に入れ子にする\u003c/h2\u003e\n\n\u003cp\u003e入れ子にしたものはスクリプト内で使用できます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"別のアセンブリに用意してそれを参照する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%A5%E3%81%AE%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E3%81%AB%E7%94%A8%E6%84%8F%E3%81%97%E3%81%A6%E3%81%9D%E3%82%8C%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e別のアセンブリに用意してそれを参照する\u003c/h2\u003e\n\n\u003cp\u003e別プロジェクトを作成し、dllをビルドし、参照に追加します。\u003c/p\u003e\n\n\u003cp\u003eもしくは使いたいクラスがアプリ内にある場合、\u003cbr\u003e\nアプリ自身を参照に追加することでも同じことが実現できますが、\u003cbr\u003e\n\u003cstrong\u003eアプリ内にある全てのpublicなクラスがスクリプト側で操作できてしまう危険があります。\u003c/strong\u003e\u003cbr\u003e\n例えばオプションに次のように指定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\n     \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithImports\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"System\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"System.Windows.Forms\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ScriptingTest\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n     \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eForms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetExecutingAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eWithImports\u003c/strong\u003eの最後に自身の名前空間を、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetExecutingAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eで自身を参照に追加しています。\u003cbr\u003e\nこの状態で次のスクリプトを実行すると...\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003escript.csx\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eForm1\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e今表示されているFormを複製できてしまいます。\u003c/p\u003e\n\n\u003cp\u003e入れ子の方法が確実のように思いますが、\u003cbr\u003e\n\u003cstrong\u003e私はアセンブリを分離した上で後者をおすすめします。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eなぜならRoslynPadの実装時に自作のクラスを予測に表示する際、\u003cbr\u003e\n自作のクラスが含まれるアセンブリを必ず参照しなければいけないからです。\u003c/p\u003e\n\n\u003cp\u003eアプリにglobalsに渡すクラスが含まれていると、globalsのメソッドやメンバを予測に表示するために\u003cbr\u003e\nアプリのアセンブリを参照することになり、結果的に後者の危険な方法と変わりなくなってしまいます。\u003c/p\u003e\n\n\u003cp\u003eとは言ったものの、コードをシンプルにするために\u003cbr\u003e\n本記事では分離しません。ご了承ください。\u003c/p\u003e\n\n\u003cp\u003e最もRoslynPadを使わないのであれば、入れ子が一番ラクで安全です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"roslynpadを実装してみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#roslynpad%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRoslynPadを実装してみる\u003c/h1\u003e\n\n\u003cp\u003eWinFormsのテキストボックスも予約語に色付けをしていけば多少使えるかもしれませんが、\u003cbr\u003e\nインテリセンスの存在は大きいです。\u003cbr\u003e\nというわけでここからはWPFのみになりますが実装していきます。\u003cbr\u003e\nWPFのプロジェクトを作成してください。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"nugetのインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nuget%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eNuGetのインストール\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/851acd73bddb8991258967d3d0867f9d7f4d4b5d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f33376265303232312d333934352d626232382d656230302d3566393830626636343439632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F37be0221-3945-bb28-eb00-5f980bf6449c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=58f792f780b7b0ba8bef90002bef600a\" alt=\"sc6.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/89220/37be0221-3945-bb28-eb00-5f980bf6449c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F37be0221-3945-bb28-eb00-5f980bf6449c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e6ac0bf38ba8d418bd066ce0afb21da4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n「RoslynPad」で検索するといくつか出てきますが、この中で必要なのは画像中の真ん中３つです。\u003cbr\u003e\n依存関係的に真ん中をインストールすると必要なものはすべてインストールされます。\u003cbr\u003e\n先程のCSharpScriptもインストールされます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"レイアウト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eレイアウト\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/031d3ed3d168b6d2a7ecf2f7f86654fe7ef8de11/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f32346537613866662d643365632d366233372d373631372d3964646362623634353034642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F24e7a8ff-d3ec-6b37-7617-9ddcbb64504d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f0d7f12cab5809c15d6bfbdee466cd09\" alt=\"sc7.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/89220/24e7a8ff-d3ec-6b37-7617-9ddcbb64504d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F24e7a8ff-d3ec-6b37-7617-9ddcbb64504d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=54e85fe1b03bb8944ae99aef1c38b8dd 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nボタンとRoslynCodeEditorを適当に配置してください。\u003cbr\u003e\nxamlの頭に以下を追記する必要があります。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003exmlns:editor=\"clr-namespace:RoslynPad.Editor;assembly=RoslynPad.Editor.Windows\"\u003c/code\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コード-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコード\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainWindow.xaml.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// MainWindow.xaml の相互作用ロジック\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMainWindow\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eWindow\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eRoslynHost\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eMainWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eInitializeComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ehost\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRoslynHost\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eadditionalAssemblies\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoad\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RoslynPad.Roslyn.Windows\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoad\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RoslynPad.Editor.Windows\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eRoslynCodeEditor_Loaded\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eroslynCodeEditor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInitialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eClassificationHighlightColors\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003eDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCurrentDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eButton_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithImports\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultImports\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003escript\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCSharpScript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroslynCodeEditor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyClass\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n                \u003cspan class=\"n\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyClass\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCompilationErrorException\u003c/span\u003e \u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"コンパイルエラー\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"エラー\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e公式のサンプルを削りに削った結果こうなりました^^;\u003cbr\u003e\nこれで一応動きます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"１コンストラクタ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%91%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e１.コンストラクタ\u003c/h3\u003e\n\n\u003cp\u003e\u003cstrong\u003eRoslynHost\u003c/strong\u003eというインテリセンスなどの機能を提供するオブジェクトを初期化します。\u003cbr\u003e\n（冒頭のWinFormsエラーはここで出ました）\u003cbr\u003e\n\u003cstrong\u003eadditionalAssemblies\u003c/strong\u003eに既に指定がありますが、これは必須のようです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"２roslyncodeeditor_loaded\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%92roslyncodeeditor_loaded\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e２.RoslynCodeEditor_Loaded\u003c/h3\u003e\n\n\u003cp\u003eエディタコントロールを初期化します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e引数１には１で生成したRoslynHostオブジェクト\u003c/li\u003e\n\u003cli\u003e引数２にはコードをハイライトするためのクラス\u003c/li\u003e\n\u003cli\u003e引数３には実行ファイルがあるディレクトリのパス（コード内にファイルへのパスを指定する場面があるとこの設定に沿って相対パス等を補完する目的で使われる？）\u003c/li\u003e\n\u003cli\u003e引数４には初めに入力されているコードを指定します\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e※RoslynCodeEditorのLoadedイベントに登録しておいてください。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"３button_click\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%93button_click\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e３.Button_Click\u003c/h3\u003e\n\n\u003cp\u003e普通にエディタに入力されたテキストからスクリプトを作成、実行しています。\u003cbr\u003e\n注目してほしいのが\u003cstrong\u003eScriptOptions\u003c/strong\u003eにRoslynHostの\u003cstrong\u003eDefaultReferences\u003c/strong\u003eと\u003cstrong\u003eDefaultImports\u003c/strong\u003e\u003cbr\u003e\nが指定されていることです。これが次のキーになります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"実行するとエディタが\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E3%81%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行するとエディタが！\u003c/h2\u003e\n\n\u003cp\u003e実行するとちゃんとエディタとして機能すると思います。\u003cbr\u003e\nしかし、ここであることに気づきます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/77ccfd03f1bb41aff24182335b41296c6a5017fa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f35666335333464612d633836312d396635652d633863632d6565343437656661643336352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F5fc534da-c861-9f5e-c8cc-ee447efad365.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e6640afa0d59c6eeb2577feb2616ca47\" alt=\"sc8.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/89220/5fc534da-c861-9f5e-c8cc-ee447efad365.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2F5fc534da-c861-9f5e-c8cc-ee447efad365.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f296ca5ff35e64744c989fc78835280e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nこれを見て何か気づきませんか...？\u003c/p\u003e\n\n\u003cp\u003eそうです。\u003cbr\u003e\nusing Systemをしていないのにも関わらずConsoleが使用できています。\u003cbr\u003e\n実行もできます。これは一体どういうことなのでしょうか？\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"roslynhostは必要そうなものを予め追加してくれている\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#roslynhost%E3%81%AF%E5%BF%85%E8%A6%81%E3%81%9D%E3%81%86%E3%81%AA%E3%82%82%E3%81%AE%E3%82%92%E4%BA%88%E3%82%81%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%A6%E3%81%8F%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRoslynHostは必要そうなものを予め追加してくれている\u003c/h2\u003e\n\n\u003cp\u003e先程のScriptOptionsに次のように指定しました\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainWindow.xaml.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithImports\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultImports\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e初めにusing担当のDefaultImportsの中身を見てみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eSystem\nSystem.Threading\nSystem.Threading.Tasks\nSystem.Collections.Generic\nSystem.Text.RegularExpressions\nSystem.Text\nSystem\nSystem.Linq\nSystem.Collections\nSystem.IO\nSystem.Reflection\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれらが初めから追加されていることがわかります。\u003cbr\u003e\n便利！\u003c/p\u003e\n\n\u003cp\u003eDefaultReferencesの中身は上記の他にエディタに必要な大量のdllが指定されていました。\u003cbr\u003e\n多すぎるので割愛します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"globalsに渡したクラスのメンバを予測に表示する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#globals%E3%81%AB%E6%B8%A1%E3%81%97%E3%81%9F%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E3%83%A1%E3%83%B3%E3%83%90%E3%82%92%E4%BA%88%E6%B8%AC%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eglobalsに渡したクラスのメンバを予測に表示する\u003c/h2\u003e\n\n\u003cp\u003eこれには一手間必要です。まず、先程のMyClassを追加しておいてください。\u003cbr\u003e\nそして、今まで使用してきたRoslynHostクラスに手を加えます。\u003c/p\u003e\n\n\u003cp\u003eまずはRoslynHostを継承したCustomRoslynHostを作成します。\u003cbr\u003e\nそして次のようにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCustomRoslynHost.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eCustomRoslynHost\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eRoslynHost\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eCustomRoslynHost\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNuGetConfiguration\u003c/span\u003e \u003cspan class=\"n\"\u003enuGetConfiguration\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eadditionalAssemblies\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eRoslynHostReferences\u003c/span\u003e \u003cspan class=\"n\"\u003ereferences\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enuGetConfiguration\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eadditionalAssemblies\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ereferences\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eProject\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateProject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSolution\u003c/span\u003e \u003cspan class=\"n\"\u003esolution\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDocumentCreationArgs\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCompilationOptions\u003c/span\u003e \u003cspan class=\"n\"\u003ecompilationOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eProject\u003c/span\u003e \u003cspan class=\"n\"\u003epreviousProject\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e??\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Program\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eProjectId\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateNewId\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eparseOptions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCSharpParseOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSourceCodeKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eScript\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elanguageVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eLanguageVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLatest\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003ecompilationOptions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecompilationOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithScriptClassName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003esolution\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esolution\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddProject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eProjectInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eVersionStamp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eLanguageNames\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eisSubmission\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eparseOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eparseOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ehostObjectType\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyClass\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecompilationOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecompilationOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003emetadataReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epreviousProject\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003eImmutableArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMetadataReference\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eDefaultReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eprojectReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epreviousProject\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eProjectReference\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epreviousProject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eproject\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esolution\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetProject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eproject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eここはどんな処理をしているか理解する必要はありません。\u003cbr\u003e\n重要なのは下から９行目にある\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ehostObjectType\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyClass\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eという部分です。\u003cbr\u003e\nここにglobalsに渡したクラスのTypeを渡します。\u003cbr\u003e\nこれでglobalsにMyClassを指定したとRoslynPadに明示できます。\u003c/p\u003e\n\n\u003cp\u003eただこれだけでは、予測に表示されません。\u003cbr\u003e\nクラスを含むアセンブリを参照に追加する必要があります。\u003cbr\u003e\n次に説明します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"自作のクラスを予測に表示する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E4%BD%9C%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BA%88%E6%B8%AC%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自作のクラスを予測に表示する\u003c/h2\u003e\n\n\u003cp\u003eRoslynHostの初期化部分を以下のように書き換えるだけです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainWindow.xaml.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCustomRoslynHost\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eadditionalAssemblies\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoad\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RoslynPad.Roslyn.Windows\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n          \u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoad\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RoslynPad.Editor.Windows\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n      \u003cspan class=\"n\"\u003ereferences\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eRoslynHostReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etypeNamespaceImports\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyClass\u003c/span\u003e\u003cspan class=\"p\"\u003e)})\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003ereferencesに表示したいクラスを指定します。\u003cbr\u003e\n正確にはこれだけでMyClassを含むアセンブリが自動的に参照に追加されます。\u003cbr\u003e\nそのアセンブリに別のpublicなクラスが含まれていた場合、そのクラスも自動的に使用できるようになります。\u003c/p\u003e\n\n\u003cp\u003eまた、今までScriptOptionsに参照の追加＆usingのオプションを指定していましたが\u003cbr\u003e\n自動的に\u003cstrong\u003eRoslynHost\u003c/strong\u003eの\u003cstrong\u003eDefaultReferences\u003c/strong\u003eと\u003cstrong\u003eDefaultImports\u003c/strong\u003eに追加されます。\u003cbr\u003e\nよってScriptOptionsに改めて指定する必要はありません。\u003c/p\u003e\n\n\u003cp\u003eこれで実行してみると、見事に表示されていることがわかります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/dc9eb574ba93699ac3b518cf072101b0e77ccb95/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f38393232302f63653637353465322d663037372d646534612d363166612d3330613962383734636364612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Fce6754e2-f077-de4a-61fa-30a9b874ccda.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d5d7e99ebc1b311ad24324845665ee07\" alt=\"sc12.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/89220/ce6754e2-f077-de4a-61fa-30a9b874ccda.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Fce6754e2-f077-de4a-61fa-30a9b874ccda.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7c784eb13d1674264567d85647d1152c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e最終的なMainWindow.xaml.csは以下になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainWindow.xaml.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// MainWindow.xaml の相互作用ロジック\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMainWindow\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eWindow\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eRoslynHost\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eMainWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eInitializeComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ehost\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCustomRoslynHost\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eadditionalAssemblies\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoad\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RoslynPad.Roslyn.Windows\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoad\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RoslynPad.Editor.Windows\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ereferences\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eRoslynHostReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etypeNamespaceImports\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyClass\u003c/span\u003e\u003cspan class=\"p\"\u003e)})\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eRoslynCodeEditor_Loaded\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eroslynCodeEditor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInitialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eClassificationHighlightColors\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003eDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCurrentDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eButton_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithImports\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultImports\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003escript\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCSharpScript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroslynCodeEditor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyClass\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n                \u003cspan class=\"n\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyClass\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCompilationErrorException\u003c/span\u003e \u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"コンパイルエラー\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"エラー\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e注意すべき点としてCustomRoslynHostでMyClassを指定しておきながら、\u003cbr\u003e\ngloablsに何も渡さなかった場合、予測に表示はされるのに実行時にエラーが出るという状態になってしまいます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"終わりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e終わりに\u003c/h1\u003e\n\n\u003cp\u003eRoslynPadの存在を知ることができたのは幸運でした。\u003cbr\u003e\nが、RoslynPadの日本語の情報がなかったためかなり苦戦しました。\u003cbr\u003e\nしかし、これで自分のアプリにどんどん利便性の高いスクリプティング機能を実装できそうです。\u003c/p\u003e\n\n\u003cp\u003eこの記事は英語記事や、サンプルを自分なりに解釈して書いていることが多いので\u003cbr\u003e\n間違っている内容が含まれている可能性があります。\u003cbr\u003e\nその場合はどんどん報告していただけると助かります。\u003cbr\u003e\nでは、最後まで読んでいただきありがとうございました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考文献\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考文献\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/dotnet/roslyn/wiki/Scripting-API-Samples\" rel=\"nofollow noopener\" target=\"_blank\"\u003eScripting API Samples\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.kekyo.net/2015/05/13/4893\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRoslyn for Scriptingで、あなたのアプリケーションにもC#スクリプトを！！\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/hukatama024e/items/741dd950096c3b4c688c\" id=\"reference-bd56d269f6ca18ae0256\"\u003e【C#】Roslyn for Scriptingについて\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.buildinsider.net/enterprise/roslyn/01\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVisual Studio 2015の新機能“Roslyn”とは\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/dotnet/roslyn/wiki/Roslyn%20Overview\" rel=\"nofollow noopener\" target=\"_blank\"\u003e.NET Compiler Platform (\"Roslyn\") Overview\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/aelij/RoslynPad\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRoslynPad\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/aelij/RoslynPad/issues/129\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAbility to add custom assembly to references in RoslynPad.Editor.Windows\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/47293326/is-it-possible-to-include-intellisense-for-the-object-global-of-globalstype-in-t\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIs it possible to include intellisense for the object global of globalsType in the RoslynPad RoslynCodeEditor control?\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","createdAt":"2018-01-16T07:33:52Z","elapsedYearsFromLastModifiedAt":3,"encryptedId":"nt2BwRpAjHveG7QwWtEm/BxfxNtN2ILu--4Gpdw0zENal/zg4G--/OcIg/5arm9MIBmLVY0OCA==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-01-20T16:49:12Z","likesCount":67,"linkUrl":"https://qiita.com/siy1121/items/aee3ce1fff6e83e33b22","organization":null,"originalId":600383,"stockedCount":64,"title":"C#アプリにスクリプティング機能を追加してみる","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%93%E3%82%93%E3%81%AA%E3%82%82%E3%81%AE%E3%82%92%E4%BD%9C%E3%82%8A%E3%81%BE%E3%81%99\"\u003eこんなものを作ります\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%82%82%E3%81%AE\"\u003e使用するもの\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#roslyn%E3%83%AD%E3%82%BA%E3%83%AA%E3%83%B3%E3%81%A8%E3%81%AF\"\u003eRoslyn(ロズリン)とは？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#roslynpad\"\u003eRoslynPad\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#c%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88\"\u003eC#スクリプト！？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#roslynpad%E3%82%92winforms%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%97%E3%82%88%E3%81%86%E3%81%A8%E3%81%97%E3%81%9F%E3%81%A8%E3%81%93%E3%82%8D\"\u003eRoslynPadをWinFormsで使用しようとしたところ...\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E6%A9%9F%E8%83%BD%E3%82%92%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AB%E7%B5%84%E3%81%BF%E8%BE%BC%E3%82%93%E3%81%A7%E3%81%BF%E3%82%8B\"\u003eとりあえずスクリプト機能をアプリに組み込んでみる\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#nuget%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003eNuGetからインストール\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89\"\u003eコード\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003eスクリプトを実行してみる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%AF%8E%E5%9B%9E%E6%9C%80%E5%88%9D%E3%81%ABusing%E3%82%92%E6%8F%8F%E3%81%8F%E3%81%AE%E3%81%AF%E3%83%8A%E3%83%B3%E3%82%BB%E3%83%B3%E3%82%B9\"\u003e毎回最初にusingを描くのはナンセンス？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%83%9C%E3%83%83%E3%82%AF%E3%82%B9%E3%82%92%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003eメッセージボックスを出してみる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E7%92%B0%E5%A2%83%E3%81%AB%E3%81%AFsystemwindowsforms%E3%81%8C%E5%8F%82%E7%85%A7%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84\"\u003eスクリプト環境にはSystem.Windows.Formsが参照されていない！\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E5%81%B4%E3%81%8B%E3%82%89%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E6%93%8D%E4%BD%9C%E3%82%92%E3%81%99%E3%82%8B\"\u003eスクリプト側からアプリの操作をする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%9C%B0%E5%91%B3%E3%81%A7%E3%81%A4%E3%81%BE%E3%82%89%E3%81%AA%E3%81%84\"\u003e地味でつまらない？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%84%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%AA%E3%81%A9%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%97%E3%81%A6%E3%81%8A%E3%81%8F\"\u003eクラスや構造体などを定義しておく\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#globals%E3%81%AB%E3%82%8F%E3%81%9F%E3%81%99%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%86%85%E9%83%A8%E3%81%AB%E5%85%A5%E3%82%8C%E5%AD%90%E3%81%AB%E3%81%99%E3%82%8B\"\u003eglobalsにわたすクラスの内部に入れ子にする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%88%A5%E3%81%AE%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E3%81%AB%E7%94%A8%E6%84%8F%E3%81%97%E3%81%A6%E3%81%9D%E3%82%8C%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B\"\u003e別のアセンブリに用意してそれを参照する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#roslynpad%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003eRoslynPadを実装してみる\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#nuget%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003eNuGetのインストール\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88\"\u003eレイアウト\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89-1\"\u003eコード\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%91%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF\"\u003e１.コンストラクタ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%92roslyncodeeditor_loaded\"\u003e２.RoslynCodeEditor_Loaded\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%93button_click\"\u003e３.Button_Click\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E3%81%8C\"\u003e実行するとエディタが！\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#roslynhost%E3%81%AF%E5%BF%85%E8%A6%81%E3%81%9D%E3%81%86%E3%81%AA%E3%82%82%E3%81%AE%E3%82%92%E4%BA%88%E3%82%81%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%A6%E3%81%8F%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B\"\u003eRoslynHostは必要そうなものを予め追加してくれている\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#globals%E3%81%AB%E6%B8%A1%E3%81%97%E3%81%9F%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E3%83%A1%E3%83%B3%E3%83%90%E3%82%92%E4%BA%88%E6%B8%AC%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B\"\u003eglobalsに渡したクラスのメンバを予測に表示する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%87%AA%E4%BD%9C%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BA%88%E6%B8%AC%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B\"\u003e自作のクラスを予測に表示する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e終わりに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\"\u003e参考文献\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":28022,"uuid":"aee3ce1fff6e83e33b22","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"PArd9NFfUJWwFheQFh5RNcqeuOU=--ZgYcUzRDhfv6HfTE--ru8A848RaNM+dn4sjGuM6Q==","originalId":89220,"description":"情報系の学部に通う大学３年生 / \r\nプログラミングしたり、CG(動画)作ったり、作曲したり色々してます / \r\n動画や音声を扱うプログラムを書くのが好き / \r\nKotlinが好きですが、js/tsの偉大さも感じている今日このごろです","facebookUrl":null,"githubUrl":"https://github.com/SIY1121","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/89220/profile-images/1527769802","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Fprofile-images%2F1527769802?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=15c244d30c3ce7e730e7271bd333d682","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F89220%2Fprofile-images%2F1527769802?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=48bde3e9e95f68591f493be066cb5e43","urlName":"siy1121","websiteUrl":"https://siy.space","twitterUrl":"https://twitter.com/SIY1121","twitterUrlName":"SIY1121","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Roslyn","urlName":"roslyn"},{"name":"RoslynPad","urlName":"roslynpad"}],"followingLikers":{"edges":[]},"comments":{"totalCount":2}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

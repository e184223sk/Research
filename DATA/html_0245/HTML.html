<!DOCTYPE html><html><head><meta charset="utf-8" /><title>C#でObserverパターンをきちんと理解して実装する - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/yutorisan/items/6e960426da71b7e02af7" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="saMsCrTMqNTbgTZf24YPKeDNqV1mbJYlazY3O8w5riSYxrED5vuXV4jn2y+tF8D2YvRDXiJm9C+zQexOhqdlRw==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@yutorisan19" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="C#でObserverパターンをきちんと理解して実装する - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1ReVBqZ2FkUFluTmxjblpsY3VPRGtlT0N2LU9Edk9PRHMtT0NrdU9CamVPQm9lT0NrLU9CcU9lUWh1aW5vLU9CbC1PQnB1V3VuLWlqaGVPQm1lT0NpdyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1iYTYzYmY0ZDNlZmZhODBkMDA3OGExMWRlMWJjNTQwMQ&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGwxZEc5eWFYTmhiZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTgxODZjNmQyOWMyMjMwNjA0NDYxZjBhZTI0ODQ3YzI4&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=16a8ff94d0b835bc90e65e6256501b1e"><meta property="og:description" content="

Observerパターンとは

Observerパターンとは、「クラスから通知を発行する仕組み」と、「他のクラスから発行された通知を受け取る仕組み」を実現するためのデザインパターンです。
このデザインパターンは、主にクラス間のデー..."><meta content="https://qiita.com/yutorisan/items/6e960426da71b7e02af7" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,オブジェクト指向,ReactiveExtensions,デザインパターン,GoF" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-6619f1a4-54ad-4f65-8fe8-3788712ab2b6"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fyutorisan%2Fitems%2F6e960426da71b7e02af7">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fyutorisan%2Fitems%2F6e960426da71b7e02af7">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-6619f1a4-54ad-4f65-8fe8-3788712ab2b6">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-12-18T00:41:46.000+09:00","dateModified":"2020-12-22T12:39:25.000+09:00","headline":"C#でObserverパターンをきちんと理解して実装する","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1ReVBqZ2FkUFluTmxjblpsY3VPRGtlT0N2LU9Edk9PRHMtT0NrdU9CamVPQm9lT0NrLU9CcU9lUWh1aW5vLU9CbC1PQnB1V3VuLWlqaGVPQm1lT0NpdyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1iYTYzYmY0ZDNlZmZhODBkMDA3OGExMWRlMWJjNTQwMQ\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGwxZEc5eWFYTmhiZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTgxODZjNmQyOWMyMjMwNjA0NDYxZjBhZTI0ODQ3YzI4\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=16a8ff94d0b835bc90e65e6256501b1e","mainEntityOfPage":"https://qiita.com/yutorisan/items/6e960426da71b7e02af7","author":{"@type":"Person","address":"","email":null,"identifier":"yutorisan","name":"yutorisan","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F1274400166120812544%2FDAWcpHec_bigger.jpg?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=754be610f489085be0fdfc48de5585a9","url":"https://qiita.com/yutorisan","description":"C#が好きです","memberOf":[{"@type":"Organization","address":"オンライン@Slack","legalName":"Unityゲーム開発者ギルド","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/5e3ba3bb442371003e6b5d4618ef627b9b478357/original.jpg?1570216541","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","identifier":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yutorisan","type":"items","id":"6e960426da71b7e02af7"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yutorisan","type":"items","id":"6e960426da71b7e02af7"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yutorisan","type":"items","id":"6e960426da71b7e02af7"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/yutorisan/items/6e960426da71b7e02af7","location":"/yutorisan/items/6e960426da71b7e02af7","scheme":"https","host":"qiita.com","port":null,"pathname":"/yutorisan/items/6e960426da71b7e02af7","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"2vb0EoECGMBcl47Bk6MqcRQ7LBva19A8UmEQ1B/Idrrzk2kb0zUnQw/xY7HlMuWulgLGGJ7dsjaKFsuhVVa92Q==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-eb8ec050-c5dc-42ff-bf91-0199b263bbbd"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yutorisan/items/6e960426da71b7e02af7/likers" class="css-1iupg5d">22</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">21</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/6e960426da71b7e02af7/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yutorisan/items/6e960426da71b7e02af7/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yutorisan/items/6e960426da71b7e02af7/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yutorisan/items/6e960426da71b7e02af7/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yutorisan/items/6e960426da71b7e02af7.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/yutorisan"><img class="css-100alwu eyfquo10" src="https://pbs.twimg.com/profile_images/1274400166120812544/DAWcpHec_bigger.jpg" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/yutorisan" class="css-10ougpm">@<!-- -->yutorisan</a><div class="css-1ay9vb9"><span><meta content="2020-12-17T15:41:46Z"/><time dateTime="2020-12-22T03:39:25Z" class="css-m19uds">updated at 2020-12-22</time></span></div></div></div></div></div><h1 class="css-cgzq40">C#でObserverパターンをきちんと理解して実装する</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e6%8c%87%e5%90%91" class="css-4czcte">オブジェクト指向</a><a href="/tags/reactiveextensions" class="css-4czcte">ReactiveExtensions</a><a href="/tags/%e3%83%87%e3%82%b6%e3%82%a4%e3%83%b3%e3%83%91%e3%82%bf%e3%83%bc%e3%83%b3" class="css-4czcte">デザインパターン</a><a href="/tags/gof" class="css-4czcte">GoF</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="observerパターンとは" class="fragment"></span><a href="#observer%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>Observerパターンとは</h1>

<p>Observerパターンとは、「クラスから通知を発行する仕組み」と、「他のクラスから発行された通知を受け取る仕組み」を実現するためのデザインパターンです。<br>
このデザインパターンは、主にクラス間のデータのやり取りをするときに使われますが、以下のような状況において特に有用です。</p>

<ol>
<li>双方向ではなく、一方からもう一方へと<strong>一方通行でデータを発行する場合</strong>。</li>
<li>1回ではなく、<strong>複数回データを発行する場合</strong>。</li>
<li>
<strong>任意のタイミングでデータを発行したい場合</strong>。</li>
<li>
<strong>発行されたデータを、複数のクラスが同時に受け取りたい場合</strong>。</li>
</ol>

<p>特に1番はObserverパターンの必須要件で、双方向のデータのやり取りには使用できません。</p>

<h1>
<span id="observerとobservable" class="fragment"></span><a href="#observer%E3%81%A8observable"><i class="fa fa-link"></i></a>ObserverとObservable</h1>

<p>このデザインパターンでは、「<strong>データを受け取るクラス</strong>」と「<strong>データを発行するクラス</strong>」を明確に分けて考えます。<br>
このうち、「データを受け取るクラス」のことを「<strong>Observer</strong>」、「データを発行するクラス」のことを「<strong>Observable</strong>」と呼びます。</p>

<p><strong>Observer</strong>とは、「<strong>監視者</strong>」や「<strong>観察者</strong>」といった意味の英単語で、データを発行するクラス（Observable）からの通知を受け取る（つまり、通知を観察する、監視する）ことからその名が付けられています。<br>
対して<strong>Observable</strong>とは、Observerの-able系なので、「<strong>観察可能</strong>」といった意味になります。<br>
Observableは「観察者」であるObserverにデータを発行するので、Observerから「観察されることができる」、「観察可能」といったことから、この名がつけられています。</p>

<p>ObserverとObservableは非常に重要なので、以下のようにまとめます。</p>

<table>
<thead>
<tr>
<th style="text-align: center"></th>
<th style="text-align: center">Observer</th>
<th style="text-align: center">Observable</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center"><strong>単語の意味</strong></td>
<td style="text-align: center">観察者</td>
<td style="text-align: center">観察可能<br>観察されることができる</td>
</tr>
<tr>
<td style="text-align: center"><strong>クラスの意味</strong></td>
<td style="text-align: center">通知を受け取るクラス</td>
<td style="text-align: center">通知を発行するクラス</td>
</tr>
</tbody>
</table>

<h1>
<span id="基本的な仕組み" class="fragment"></span><a href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BB%95%E7%B5%84%E3%81%BF"><i class="fa fa-link"></i></a>基本的な仕組み</h1>

<p>Observerパターンの基本的な仕組みは、次の3ステップとなります。</p>

<ol>
<li>ObserverがObservableにデータの発行先として登録する（＝購読する）</li>
<li>Observableは登録されたすべての発行先に値を発行する</li>
<li>Observerは受け取った値を使用して任意の処理を実行する</li>
</ol>

<p>次の項から詳しく説明します。</p>

<h2>
<span id="1-observerがobservableを購読する" class="fragment"></span><a href="#1-observer%E3%81%8Cobservable%E3%82%92%E8%B3%BC%E8%AA%AD%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>1. ObserverがObservableを購読する</h2>

<p>Observer（値を受信したいクラス）は、欲しい値を発行しているクラス（Observable）に対して、「僕に値を発行・通知してください」と<strong>自分自身を通知先として登録します</strong>。<br>
この「配信登録」することを、「<strong>購読(Subscribe)する</strong>」と言います。</p>

<p>現実世界で「AさんはS社の雑誌を定期購読する」といった表現はよく使われます。<br>
この場合も、AさんはS社に対して「僕に雑誌を定期的に送ってください」と自分自身を送付先として登録しますね。それと同じような意味になります。</p>

<p><a href="https://camo.qiitausercontent.com/ac674cd5c1f9c88323d847d304f9e38e78190595/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f37636430633236302d363032382d363964322d616331322d6537353031373631656638642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F7cd0c260-6028-69d2-ac12-e7501761ef8d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=bbc75a034f0f852acff4caa3038bfd5f" alt="Observerパターン.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/7cd0c260-6028-69d2-ac12-e7501761ef8d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F7cd0c260-6028-69d2-ac12-e7501761ef8d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=21c656607b2f239fe3fb5dc02a028c9c 1x" loading="lazy"></a></p>

<p>そして、一つの値の発行元（Observable）に対して、複数のObserverが値の発行先として登録することができることも、Observerパターンの特徴の一つです。</p>

<p><a href="https://camo.qiitausercontent.com/76bc4b40d089fc60916551fa32e7dcaeb771a7db/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f66613464393663302d346239312d343764392d356461352d3136663434653830393234302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Ffa4d96c0-4b91-47d9-5da5-16f44e809240.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0d447a1c71b3581659f5bffe7030bc56" alt="Observerパターン_複数登録.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/fa4d96c0-4b91-47d9-5da5-16f44e809240.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Ffa4d96c0-4b91-47d9-5da5-16f44e809240.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=57b41466391ffad53d843e50f7d5f8d3 1x" loading="lazy"></a></p>

<h2>
<span id="2observableは登録されたすべての発行先に値を発行する" class="fragment"></span><a href="#2observable%E3%81%AF%E7%99%BB%E9%8C%B2%E3%81%95%E3%82%8C%E3%81%9F%E3%81%99%E3%81%B9%E3%81%A6%E3%81%AE%E7%99%BA%E8%A1%8C%E5%85%88%E3%81%AB%E5%80%A4%E3%82%92%E7%99%BA%E8%A1%8C%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>2.Observableは登録されたすべての発行先に値を発行する</h2>

<p>Observable（値を発行するクラス）は、発行する値ができると、値の発行先として登録された<strong>すべてのObserverに対して一斉に値を発行します</strong>。<br>
こうして、ObserverはObservableからの通知（値）を受け取ることができます。<br>
<a href="https://camo.qiitausercontent.com/0262083f0e4eb3e6b3a18546a12169833ee572fe/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f30653036653365642d383135642d303832662d396638302d3238333532333838623532302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F0e06e3ed-815d-082f-9f80-28352388b520.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7e5699feb938f7bf64141b1828623d95" alt="Observerパターン_値の発行.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/0e06e3ed-815d-082f-9f80-28352388b520.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F0e06e3ed-815d-082f-9f80-28352388b520.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ec7432c6dc4c6c09b10826cf58aa2f22 1x" loading="lazy"></a></p>

<h2>
<span id="3observerは受け取った値を使用して任意の処理を実行する" class="fragment"></span><a href="#3observer%E3%81%AF%E5%8F%97%E3%81%91%E5%8F%96%E3%81%A3%E3%81%9F%E5%80%A4%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E4%BB%BB%E6%84%8F%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>3.Observerは受け取った値を使用して任意の処理を実行する</h2>

<p>Observableから発行された値を受け取ったObserverは、受け取った値を使用して任意の処理を実行することができます。</p>

<p>このようにして、ObservableからObserverへとデータの受け渡しが実現されます。</p>

<h1>
<span id="observerパターンを実装してみる" class="fragment"></span><a href="#observer%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>Observerパターンを実装してみる</h1>

<p>Observerパターンの基本的な仕組みの大枠は理解頂けたかと思います。<br>
それでは、これらの仕組みを実際にどのように実装するかを説明していきます。</p>

<h2>
<span id="iobservertインターフェイスとiobservabletインターフェイス" class="fragment"></span><a href="#iobservert%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%81%A8iobservablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9"><i class="fa fa-link"></i></a><code>IObserver&lt;T&gt;</code>インターフェイスと<code>IObservable&lt;T&gt;</code>インターフェイス</h2>

<p>Observerパターンは、「データを受け取るクラス」と「データを発行するクラス」を明確に分けて考えるデザインパターンと書きました。<br>
実は、.NET Framework4.0以降には、<strong>Observerパターンで使える<code>IObserver&lt;T&gt;</code>インターフェイスと<code>IObservable&lt;T&gt;</code>インターフェイスが<code>System</code>名前空間に標準で用意されています</strong>。<br>
Observerパターンを実装したい場合、これらのインターフェイスをデータの受信側、データの発行側のクラスにそれぞれ実装すれば良いことになります。</p>

<p>これらのインターフェイスの定義は次のようになっています。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IObserver</span><span class="p">&lt;</span><span class="k">in</span> <span class="n">T</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="c1">//データの発行が完了したことを通知する</span>
    <span class="k">void</span> <span class="nf">OnCompleted</span><span class="p">();</span>
    <span class="c1">//データの発行元でエラーが発生したことを通知する</span>
    <span class="k">void</span> <span class="nf">OnError</span><span class="p">(</span><span class="n">Exception</span> <span class="n">error</span><span class="p">);</span>
    <span class="c1">//データを通知する</span>
    <span class="k">void</span> <span class="nf">OnNext</span><span class="p">(</span><span class="n">T</span> <span class="k">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">interface</span> <span class="nc">IObservable</span><span class="p">&lt;</span><span class="k">out</span> <span class="n">T</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="c1">//データの発行を購読する</span>
    <span class="n">IDisposable</span> <span class="nf">Subscribe</span><span class="p">(</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">observer</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code>IObserver&lt;T&gt;</code>インターフェイスの<code>OnNext</code>メソッドは、<strong>データを新しく通知する</strong>際に呼び出すメソッドです。<br>
<code>OnCompleted</code>メソッドは、データの発行がすべて完了し、<strong>これ以上通知するものがない場合</strong>に呼び出します。<br>
万が一、データの発行元で<strong>何らかの例外が発生してしまった場合</strong>は、<code>OnError</code>メソッドを呼び出して、エラーが発生したことを通知します。</p>

<p><code>IObservable&lt;T&gt;</code>インターフェイスの<code>Subscibe</code>メソッドは、<strong>データの発行元からの通知を受け取りたいとき</strong>に呼び出します。<br>
引数には、通知の発行先となる<code>IObserver&lt;T&gt;</code>オブジェクトを指定します。</p>

<p>ここで、以下のような違和感を覚える方がいらっしゃるかもしれません。</p>

<p><em><code>IObserver&lt;T&gt;</code>はデータを受け取るクラスが実装するのに、なぜデータを発行する系のメソッドを実装するのか？<br>
逆に<code>IObservable&lt;T&gt;</code>はデータを発行するクラスが実装するのに、なぜデータの発行を購読するメソッドを実装するのか？</em></p>

<p>その答えは、これらのメソッドは、<strong>実装するクラス自身が使用するのではなく、お互いに相手が使用するものだから</strong>です。</p>

<p>例えば、「データを受け取るクラス(Observer)」が実装した<code>IObserver&lt;T&gt;</code>インターフェイスの<code>OnNext</code>メソッドは、データを発行するクラス(Observable)が呼び出すことで、Observerに対して値を通知することができます。<br>
逆に、「データを発行するクラス(Observable)」が実装した<code>IObservable&lt;T&gt;</code>インターフェイスの<code>Subscribe</code>メソッドは、データを受け取るクラス(Observer)が呼び出すことで、自分自身をデータの発行先として登録することができます。</p>

<p>まだ違和感が拭えないかもしれませんが、実際に実装してみると理解が深まるかもしれません。<br>
それでは、実際に<code>IObserver&lt;T&gt;</code>インターフェイスと<code>IObservable&lt;T&gt;</code>インターフェイスを用いて、Observerパターンを実装してみます。</p>

<h2>
<span id="observerを実装する" class="fragment"></span><a href="#observer%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Observerを実装する</h2>

<p>まずはObserver（通知を受け取るクラス）を作成します。</p>

<h3>
<span id="1クラスを作成する" class="fragment"></span><a href="#1%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>1.クラスを作成する</h3>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Observer</span>
<span class="p">{</span>

<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="2iobservertインターフェイスを実装する" class="fragment"></span><a href="#2iobservert%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>2.<code>IObserver&lt;T&gt;</code>インターフェイスを実装する</h3>

<p>このクラスはObserverなので、<code>IObserver&lt;T&gt;</code>インターフェイスを実装します。<br>
型引数<code>T</code>には受信したい値の型を指定します。ここでは、<code>int</code>型とします。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Observer</span> <span class="p">:</span> <span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnCompleted</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnError</span><span class="p">(</span><span class="n">Exception</span> <span class="n">error</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnNext</span><span class="p">(</span><span class="kt">int</span> <span class="k">value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="3値を受け取ったときのコールバック処理を記述する" class="fragment"></span><a href="#3%E5%80%A4%E3%82%92%E5%8F%97%E3%81%91%E5%8F%96%E3%81%A3%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E5%87%A6%E7%90%86%E3%82%92%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>3.値を受け取ったときのコールバック処理を記述する</h3>

<p>あとは、各メソッドにそれぞれ通知が来たときに実行したい処理を自由に記述します。<br>
例なので、ここでは次のようにコンソールにメッセージを出力するだけの処理を実装しました。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Observer</span> <span class="p">:</span> <span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnCompleted</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"通知の受け取りが完了しました"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnError</span><span class="p">(</span><span class="n">Exception</span> <span class="n">error</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"次のエラーを受信しました:</span><span class="p">{</span><span class="n">error</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnNext</span><span class="p">(</span><span class="kt">int</span> <span class="k">value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="k">value</span><span class="p">}</span><span class="s">を受け取りました"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これだけでObserverの実装は完了です。</p>

<h3>
<span id="複数のobserverを用意できるようにする" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E3%81%AEobserver%E3%82%92%E7%94%A8%E6%84%8F%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>複数のObserverを用意できるようにする</h3>

<p>冒頭にも書きましたが、Observerパターンでは、発行された値を複数のクラス（Observer）が同時に受け取ることができます。<br>
これを試すために、次のようにObserverの名前をコンストラクタで指定するようにして、どのObserverがメッセージを受け取ったかを識別できるようにしておきます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Observer</span> <span class="p">:</span> <span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">string</span> <span class="n">m_name</span><span class="p">;</span>
    <span class="k">public</span> <span class="nf">Observer</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnCompleted</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">m_name</span><span class="p">}</span><span class="s">が通知の受け取りを完了しました"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnError</span><span class="p">(</span><span class="n">Exception</span> <span class="n">error</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">m_name</span><span class="p">}</span><span class="s">が次のエラーを受信しました:</span><span class="p">{</span><span class="n">error</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnNext</span><span class="p">(</span><span class="kt">int</span> <span class="k">value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">m_name</span><span class="p">}</span><span class="s">が</span><span class="p">{</span><span class="k">value</span><span class="p">}</span><span class="s">を受け取りました"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="observableを実装する" class="fragment"></span><a href="#observable%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Observableを実装する</h2>

<p>次にObservable（通知を発行するクラス）を作成します。</p>

<h3>
<span id="1クラスを作成する-1" class="fragment"></span><a href="#1%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B-1"><i class="fa fa-link"></i></a>1.クラスを作成する</h3>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Observable</span>
<span class="p">{</span>

<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="2iobservabletインターフェイスを実装する" class="fragment"></span><a href="#2iobservablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>2.<code>IObservable&lt;T&gt;</code>インターフェイスを実装する</h3>

<p>このクラスはObservableなので、<code>IObservable&lt;T&gt;</code>インターフェイスを実装します。<br>
型引数<code>T</code>には発行したい値の型を指定します。ObserverとObservableの型引数は合致している必要があるため、ここでも<code>T</code>は<code>int</code>とします。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Observable</span> <span class="p">:</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">IDisposable</span> <span class="nf">Subscribe</span><span class="p">(</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">observer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="3値の発行先を覚えておく仕組みを作成する" class="fragment"></span><a href="#3%E5%80%A4%E3%81%AE%E7%99%BA%E8%A1%8C%E5%85%88%E3%82%92%E8%A6%9A%E3%81%88%E3%81%A6%E3%81%8A%E3%81%8F%E4%BB%95%E7%B5%84%E3%81%BF%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>3.値の発行先を覚えておく仕組みを作成する</h3>

<p>Observableの役目は、値の発行先として登録された（購読された、<code>Subscribe</code>された）<code>IObserver&lt;T&gt;</code>を記憶しておき、発行する値が生じたときに、そのすべての<code>IObserver&lt;T&gt;</code>に対して値を発行することです。<br>
※「値を発行する」とは、具体的には<code>IObserver&lt;T&gt;</code>の<code>OnNext</code>、<code>OnCompleted</code>、もしくは<code>OnError</code>メソッドを呼び出すことです</p>

<p>したがって、Observableなクラスに<code>Subscribe</code>で指定された<code>IObserver&lt;int&gt;</code>を覚えておける仕組みを作成する必要があります。<br>
とはいっても、単に<code>List&lt;IObserver&lt;T&gt;&gt;</code>に溜めておくだけで十分です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Observable</span> <span class="p">:</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="c1">//購読されたIObserver&lt;int&gt;のリスト</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;</span> <span class="n">m_observers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;();</span>

    <span class="k">public</span> <span class="n">IDisposable</span> <span class="nf">Subscribe</span><span class="p">(</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">observer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(!</span><span class="n">m_observers</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">observer</span><span class="p">))</span>
            <span class="n">m_observers</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">observer</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これで、<code>Subscribe</code>で指定された<code>IObserver&lt;int&gt;</code>を覚えておくことができるようになりました。</p>

<h3>
<span id="4購読解除用のidisposableなクラスを用意する" class="fragment"></span><a href="#4%E8%B3%BC%E8%AA%AD%E8%A7%A3%E9%99%A4%E7%94%A8%E3%81%AEidisposable%E3%81%AA%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>4.購読解除用の<code>IDisposable</code>なクラスを用意する</h3>

<p>ところで、<code>Subscribe</code>メソッドの戻り値は<code>IDisposable</code>になっています。<br>
今まで説明しませんでしたが、Observerパターンは、値の発行先として登録するSubscribeの対となる機能として、<strong>値の発行を停止してもらう「購読解除」も可能となっています</strong>。</p>

<p><strong><code>Subscribe</code>メソッドの戻り値として返す<code>IDisposable</code>は、<code>Subscribe</code>したObserverが、「もう値はいらないです」と購読を解除するときに使用するものです</strong>。<br>
ご存知の通り、<code>IDisposable</code>インターフェイスの中身は<code>Dispose</code>メソッドただ一つのみであり、<strong>購読を解除したいObserverはこの<code>IDisposable</code>を<code>Dispose</code>することによって購読を解除</strong>することができます。</p>

<p>したがって、<code>Dispose</code>されたときに購読を解除する仕組みを作成する必要があります。<br>
「購読を解除する」とは、Observableなクラス視点で言えば、値の発行先リストである<code>List&lt;IObserver&lt;T&gt;&gt;</code>から購読を解除したい<code>IObserver&lt;T&gt;</code>を<code>Remove</code>することに他なりません。</p>

<p>では、どのように実装すればよいでしょうか？</p>

<p>まず、<code>IDisposable</code>インターフェイスを返さなければなりませんから、当然、<code>IDisposable</code>インターフェイスを実装したクラスが必要になります。<br>
そこで、以下のように「購読を解除する責務を持った<code>IDisposable</code>なクラス」を作成します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Unsubscriber</span> <span class="p">:</span> <span class="n">IDisposable</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>そして、この<code>Dispose</code>メソッドの中に、購読者リストから<code>Remove</code>する処理を書けば完成です。<br>
具体的には、発行先リスト<code>List&lt;IObserver&lt;T&gt;&gt;</code>と<code>Dispose</code>されたときに<code>Remove</code>するターゲットとなる<code>IObserver&lt;T&gt;</code>を、コンストラクタで引き渡して、以下のように実装します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Unsubscriber</span> <span class="p">:</span> <span class="n">IDisposable</span>
<span class="p">{</span>
    <span class="c1">//発行先リスト</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;</span> <span class="n">m_observers</span><span class="p">;</span>
    <span class="c1">//DisposeされたときにRemoveするIObserver&lt;int&gt;</span>
    <span class="k">private</span> <span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">m_observer</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">Unsubscriber</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;</span> <span class="n">observers</span><span class="p">,</span> <span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">observer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_observers</span> <span class="p">=</span> <span class="n">observers</span><span class="p">;</span>
        <span class="n">m_observer</span> <span class="p">=</span> <span class="n">observer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//Disposeされたら発行先リストから対象の発行先を削除する</span>
        <span class="n">m_observers</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">m_observer</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>そして、この新しく作った購読解除用の<code>IDisposable</code>なクラスのインスタンスを、<code>Subscribe</code>の戻り値として返します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Observable</span> <span class="p">:</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="c1">//購読されたIObserver&lt;int&gt;のリスト</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;</span> <span class="n">m_observers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;();</span>

    <span class="k">public</span> <span class="n">IDisposable</span> <span class="nf">Subscribe</span><span class="p">(</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">observer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(!</span><span class="n">m_observers</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">observer</span><span class="p">))</span>
            <span class="n">m_observers</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">observer</span><span class="p">);</span>
        <span class="c1">//購読解除用のクラスをIDisposableとして返す</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Unsubscriber</span><span class="p">(</span><span class="n">m_observers</span><span class="p">,</span> <span class="n">observer</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>こうすることで、この<code>IDisposable</code>を受け取ったObserverは、値が要らなくなった時点で<code>Dispose</code>メソッドを呼び出すことで、自分自身を発行先リストから削除することができるようになります。</p>

<p>ところで、この<code>Unsubscriber</code>クラスは、<code>Observable</code>クラス以外から生成されることはありません。<br>
したがって、下記のように<code>Observable</code>クラスの内部クラスにしてしまいます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Observable</span> <span class="p">:</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="c1">//購読されたIObserver&lt;int&gt;のリスト</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;</span> <span class="n">m_observers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;();</span>

    <span class="k">public</span> <span class="n">IDisposable</span> <span class="nf">Subscribe</span><span class="p">(</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">observer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(!</span><span class="n">m_observers</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">observer</span><span class="p">))</span>
            <span class="n">m_observers</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">observer</span><span class="p">);</span>
        <span class="c1">//購読解除用のクラスをIDisposableとして返す</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Unsubscriber</span><span class="p">(</span><span class="n">m_observers</span><span class="p">,</span> <span class="n">observer</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">//購読解除用内部クラス</span>
    <span class="k">private</span> <span class="k">class</span> <span class="nc">Unsubscriber</span> <span class="p">:</span> <span class="n">IDisposable</span>
    <span class="p">{</span>
        <span class="c1">//発行先リスト</span>
        <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;</span> <span class="n">m_observers</span><span class="p">;</span>
        <span class="c1">//DisposeされたときにRemoveするIObserver&lt;int&gt;</span>
        <span class="k">private</span> <span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">m_observer</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">Unsubscriber</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;</span> <span class="n">observers</span><span class="p">,</span> <span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">observer</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_observers</span> <span class="p">=</span> <span class="n">observers</span><span class="p">;</span>
            <span class="n">m_observer</span> <span class="p">=</span> <span class="n">observer</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">//Disposeされたら発行先リストから対象の発行先を削除する</span>
            <span class="n">m_observers</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">m_observer</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="5通知を発行する処理を記述する" class="fragment"></span><a href="#5%E9%80%9A%E7%9F%A5%E3%82%92%E7%99%BA%E8%A1%8C%E3%81%99%E3%82%8B%E5%87%A6%E7%90%86%E3%82%92%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>5.通知を発行する処理を記述する</h3>

<p>最後に、発行したい情報や値があった場合に通知を発行する処理を記述します。<br>
ここでは例として、<code>SendNotice</code>メソッドが呼ばれたときに“int”型の1,2,3を連続で通知を発行するようにします。</p>

<p>値を発行するには、<code>OnNext</code>メソッドを呼び出します。<br>
すべての発行先に対して<code>OnNext</code>メソッドを呼び出すので、以下のように<code>foreach</code>を使用すればOKです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Observable</span> <span class="p">:</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="c1">//購読されたIObserver&lt;int&gt;のリスト</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;</span> <span class="n">m_observers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;();</span>

    <span class="k">public</span> <span class="n">IDisposable</span> <span class="nf">Subscribe</span><span class="p">(</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">observer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(!</span><span class="n">m_observers</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">observer</span><span class="p">))</span>
            <span class="n">m_observers</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">observer</span><span class="p">);</span>
        <span class="c1">//購読解除用のクラスをIDisposableとして返す</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Unsubscriber</span><span class="p">(</span><span class="n">m_observers</span><span class="p">,</span> <span class="n">observer</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">SendNotice</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//すべての発行先に対して1,2,3を発行する</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">observer</span> <span class="k">in</span> <span class="n">m_observers</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">observer</span><span class="p">.</span><span class="nf">OnNext</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
            <span class="n">observer</span><span class="p">.</span><span class="nf">OnNext</span><span class="p">(</span><span class="m">2</span><span class="p">);</span>
            <span class="n">observer</span><span class="p">.</span><span class="nf">OnNext</span><span class="p">(</span><span class="m">3</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//購読解除用内部クラス</span>
    <span class="k">private</span> <span class="k">class</span> <span class="nc">Unsubscriber</span> <span class="p">:</span> <span class="n">IDisposable</span>
    <span class="p">{</span>
        <span class="c1">//発行先リスト</span>
        <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;</span> <span class="n">m_observers</span><span class="p">;</span>
        <span class="c1">//DisposeされたときにRemoveするIObserver&lt;int&gt;</span>
        <span class="k">private</span> <span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">m_observer</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">Unsubscriber</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;</span> <span class="n">observers</span><span class="p">,</span> <span class="n">IObserver</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">observer</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_observers</span> <span class="p">=</span> <span class="n">observers</span><span class="p">;</span>
            <span class="n">m_observer</span> <span class="p">=</span> <span class="n">observer</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">//Disposeされたら発行先リストから対象の発行先を削除する</span>
            <span class="n">m_observers</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">m_observer</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="使ってみる" class="fragment"></span><a href="#%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>使ってみる</h2>

<p>これまで作成したObserverとObservableを使用して、実際に値の購読と発行、受け取りの流れを実演します。</p>

<p>ここでは、以下のようなコンソールアプリケーションを作成しました。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//値を受け取るクラスを３つ作成</span>
        <span class="n">Observer</span> <span class="n">observerA</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Observer</span><span class="p">(</span><span class="s">"Aさん"</span><span class="p">);</span>
        <span class="n">Observer</span> <span class="n">observerB</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Observer</span><span class="p">(</span><span class="s">"Bさん"</span><span class="p">);</span>
        <span class="n">Observer</span> <span class="n">observerC</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Observer</span><span class="p">(</span><span class="s">"Cさん"</span><span class="p">);</span>

        <span class="c1">//値を発行するクラスを作成</span>
        <span class="n">Observable</span> <span class="n">observable</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Observable</span><span class="p">();</span>

        <span class="c1">//３つのObserverが、自分自身を発行先として登録する（=購読）</span>
        <span class="n">IDisposable</span> <span class="n">disposableA</span> <span class="p">=</span> <span class="n">observable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">observerA</span><span class="p">);</span>
        <span class="n">IDisposable</span> <span class="n">disposableB</span> <span class="p">=</span> <span class="n">observable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">observerB</span><span class="p">);</span>
        <span class="n">IDisposable</span> <span class="n">disposableC</span> <span class="p">=</span> <span class="n">observable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">observerC</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Aさん〜Cさんが値を購読しました"</span><span class="p">);</span>

        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"値を発行させます"</span><span class="p">);</span>
        <span class="c1">//Observableに値を発行させる</span>
        <span class="n">observable</span><span class="p">.</span><span class="nf">SendNotice</span><span class="p">();</span>

        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Aさんが購読解除します"</span><span class="p">);</span>
        <span class="c1">//Aさんが購読解除する</span>
        <span class="n">disposableA</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>

        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"値を発行させます"</span><span class="p">);</span>
        <span class="c1">//再び値を発行させる</span>
        <span class="n">observable</span><span class="p">.</span><span class="nf">SendNotice</span><span class="p">();</span>

        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Bさんが購読解除します"</span><span class="p">);</span>
        <span class="c1">//Bさんが購読解除する</span>
        <span class="n">disposableB</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>

        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"値を発行させます"</span><span class="p">);</span>
        <span class="c1">//再び値を発行させる</span>
        <span class="n">observable</span><span class="p">.</span><span class="nf">SendNotice</span><span class="p">();</span>

        <span class="n">Console</span><span class="p">.</span><span class="nf">ReadKey</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>やっている内容としては、コードを見たとおりですが</p>

<ol>
<li>値の購読者（Observer）をAさん、Bさん、Cさんの３つを作成</li>
<li>値の発行者（Observable）を作成</li>
<li>Aさん〜CさんがObservableを購読</li>
<li>Observableに値を発行させる</li>
<li>Aさん、購読を解除する</li>
<li>Observableに再び値を発行させる</li>
<li>Bさんも購読を解除する</li>
<li>Observableに再び値を発行させる</li>
</ol>

<p>となります。</p>

<p>これを実行すると、次のような出力が得られます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>Aさん〜Cさんが値を購読しました
値を発行させます
Aさんが1を受け取りました
Aさんが2を受け取りました
Aさんが3を受け取りました
Bさんが1を受け取りました
Bさんが2を受け取りました
Bさんが3を受け取りました
Cさんが1を受け取りました
Cさんが2を受け取りました
Cさんが3を受け取りました
Aさんが購読解除します
値を発行させます
Bさんが1を受け取りました
Bさんが2を受け取りました
Bさんが3を受け取りました
Cさんが1を受け取りました
Cさんが2を受け取りました
Cさんが3を受け取りました
Bさんが購読解除します
値を発行させます
Cさんが1を受け取りました
Cさんが2を受け取りました
Cさんが3を受け取りました
</code></pre></div></div>

<p>Observerパターンが期待通りに動作していることが確認できます。</p>

<h1>
<span id="さいごに" class="fragment"></span><a href="#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB"><i class="fa fa-link"></i></a>さいごに</h1>

<p>以上、少し長くなってしまいましたがObserverパターンの解説を行いました。</p>

<p>僕自身としては、Observerパターンをこのようにそのまま利用することは少なく、ReactiveExtensionsというObserverパターンをベースとした非常に強力なライブラリを通じて利用することがほとんどです。<br>
もともとは、このReactiveExtensionsの記事を書いていたのですが、ベースとなるObserverパターンの説明がとても長くなってしまったため、別記事として抜き出しました。<br>
またReactiveExtensionsの記事も書いたらリンクを貼るのでそちらも良ければ御覧ください。</p>

<p>[2020/12/22追記]<br>
ReactiveExtensionに関する記事書きました。よろしければ参照ください。<br>
<strong><a href="https://qiita.com/yutorisan/items/2475eaf5d8c3a6454e3f#comments" id="reference-bd821df24edceb6ad80e">【C#】なぜReactiveExtensionsを導入すると幸せになれるのか</a></strong></p>

<p>何か間違いやご指摘、ご質問あればコメントにお願いします。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fyutorisan%2Fitems%2F6e960426da71b7e02af7&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fyutorisan%2Fitems%2F6e960426da71b7e02af7&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yutorisan/items/6e960426da71b7e02af7/likers" class="css-1iupg5d">22</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">21</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/6e960426da71b7e02af7/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yutorisan/items/6e960426da71b7e02af7/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yutorisan/items/6e960426da71b7e02af7/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yutorisan/items/6e960426da71b7e02af7/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yutorisan/items/6e960426da71b7e02af7.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-eb8ec050-c5dc-42ff-bf91-0199b263bbbd">{"authorAnalyticsTrackingId":"UA-135447292-3","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-db125944-1228-4f29-b231-9fb99a1a205e"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-db125944-1228-4f29-b231-9fb99a1a205e">{}</script>
      
<div id="LoginModal-react-component-2b131771-7b1d-47da-8d5b-88df4aa5c32a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-2b131771-7b1d-47da-8d5b-88df4aa5c32a">{}</script>
      
<div id="StockModal-react-component-f544e7b7-1bf7-4fe3-b15c-1746a21daf91"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-f544e7b7-1bf7-4fe3-b15c-1746a21daf91">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;bvYvspC/8JC9LhIUIn1I1p4DTYUb8zmSz/h7P2GoDeBHk7K7wojPE+5I/2RU7IcJHDqnhl/5W5gXj6BKKzbGgw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"observerパターンとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#observer%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eObserverパターンとは\u003c/h1\u003e\n\n\u003cp\u003eObserverパターンとは、「クラスから通知を発行する仕組み」と、「他のクラスから発行された通知を受け取る仕組み」を実現するためのデザインパターンです。\u003cbr\u003e\nこのデザインパターンは、主にクラス間のデータのやり取りをするときに使われますが、以下のような状況において特に有用です。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e双方向ではなく、一方からもう一方へと\u003cstrong\u003e一方通行でデータを発行する場合\u003c/strong\u003e。\u003c/li\u003e\n\u003cli\u003e1回ではなく、\u003cstrong\u003e複数回データを発行する場合\u003c/strong\u003e。\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003e任意のタイミングでデータを発行したい場合\u003c/strong\u003e。\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003e発行されたデータを、複数のクラスが同時に受け取りたい場合\u003c/strong\u003e。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e特に1番はObserverパターンの必須要件で、双方向のデータのやり取りには使用できません。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"observerとobservable\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#observer%E3%81%A8observable\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eObserverとObservable\u003c/h1\u003e\n\n\u003cp\u003eこのデザインパターンでは、「\u003cstrong\u003eデータを受け取るクラス\u003c/strong\u003e」と「\u003cstrong\u003eデータを発行するクラス\u003c/strong\u003e」を明確に分けて考えます。\u003cbr\u003e\nこのうち、「データを受け取るクラス」のことを「\u003cstrong\u003eObserver\u003c/strong\u003e」、「データを発行するクラス」のことを「\u003cstrong\u003eObservable\u003c/strong\u003e」と呼びます。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eObserver\u003c/strong\u003eとは、「\u003cstrong\u003e監視者\u003c/strong\u003e」や「\u003cstrong\u003e観察者\u003c/strong\u003e」といった意味の英単語で、データを発行するクラス（Observable）からの通知を受け取る（つまり、通知を観察する、監視する）ことからその名が付けられています。\u003cbr\u003e\n対して\u003cstrong\u003eObservable\u003c/strong\u003eとは、Observerの-able系なので、「\u003cstrong\u003e観察可能\u003c/strong\u003e」といった意味になります。\u003cbr\u003e\nObservableは「観察者」であるObserverにデータを発行するので、Observerから「観察されることができる」、「観察可能」といったことから、この名がつけられています。\u003c/p\u003e\n\n\u003cp\u003eObserverとObservableは非常に重要なので、以下のようにまとめます。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003e\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003eObserver\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003eObservable\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003cstrong\u003e単語の意味\u003c/strong\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e観察者\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e観察可能\u003cbr\u003e観察されることができる\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003cstrong\u003eクラスの意味\u003c/strong\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e通知を受け取るクラス\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e通知を発行するクラス\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"基本的な仕組み\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BB%95%E7%B5%84%E3%81%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e基本的な仕組み\u003c/h1\u003e\n\n\u003cp\u003eObserverパターンの基本的な仕組みは、次の3ステップとなります。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eObserverがObservableにデータの発行先として登録する（＝購読する）\u003c/li\u003e\n\u003cli\u003eObservableは登録されたすべての発行先に値を発行する\u003c/li\u003e\n\u003cli\u003eObserverは受け取った値を使用して任意の処理を実行する\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e次の項から詳しく説明します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-observerがobservableを購読する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-observer%E3%81%8Cobservable%E3%82%92%E8%B3%BC%E8%AA%AD%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. ObserverがObservableを購読する\u003c/h2\u003e\n\n\u003cp\u003eObserver（値を受信したいクラス）は、欲しい値を発行しているクラス（Observable）に対して、「僕に値を発行・通知してください」と\u003cstrong\u003e自分自身を通知先として登録します\u003c/strong\u003e。\u003cbr\u003e\nこの「配信登録」することを、「\u003cstrong\u003e購読(Subscribe)する\u003c/strong\u003e」と言います。\u003c/p\u003e\n\n\u003cp\u003e現実世界で「AさんはS社の雑誌を定期購読する」といった表現はよく使われます。\u003cbr\u003e\nこの場合も、AさんはS社に対して「僕に雑誌を定期的に送ってください」と自分自身を送付先として登録しますね。それと同じような意味になります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ac674cd5c1f9c88323d847d304f9e38e78190595/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f37636430633236302d363032382d363964322d616331322d6537353031373631656638642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F7cd0c260-6028-69d2-ac12-e7501761ef8d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bbc75a034f0f852acff4caa3038bfd5f\" alt=\"Observerパターン.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/7cd0c260-6028-69d2-ac12-e7501761ef8d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F7cd0c260-6028-69d2-ac12-e7501761ef8d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=21c656607b2f239fe3fb5dc02a028c9c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eそして、一つの値の発行元（Observable）に対して、複数のObserverが値の発行先として登録することができることも、Observerパターンの特徴の一つです。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/76bc4b40d089fc60916551fa32e7dcaeb771a7db/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f66613464393663302d346239312d343764392d356461352d3136663434653830393234302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Ffa4d96c0-4b91-47d9-5da5-16f44e809240.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0d447a1c71b3581659f5bffe7030bc56\" alt=\"Observerパターン_複数登録.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/fa4d96c0-4b91-47d9-5da5-16f44e809240.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Ffa4d96c0-4b91-47d9-5da5-16f44e809240.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=57b41466391ffad53d843e50f7d5f8d3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2observableは登録されたすべての発行先に値を発行する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2observable%E3%81%AF%E7%99%BB%E9%8C%B2%E3%81%95%E3%82%8C%E3%81%9F%E3%81%99%E3%81%B9%E3%81%A6%E3%81%AE%E7%99%BA%E8%A1%8C%E5%85%88%E3%81%AB%E5%80%A4%E3%82%92%E7%99%BA%E8%A1%8C%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.Observableは登録されたすべての発行先に値を発行する\u003c/h2\u003e\n\n\u003cp\u003eObservable（値を発行するクラス）は、発行する値ができると、値の発行先として登録された\u003cstrong\u003eすべてのObserverに対して一斉に値を発行します\u003c/strong\u003e。\u003cbr\u003e\nこうして、ObserverはObservableからの通知（値）を受け取ることができます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/0262083f0e4eb3e6b3a18546a12169833ee572fe/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f30653036653365642d383135642d303832662d396638302d3238333532333838623532302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F0e06e3ed-815d-082f-9f80-28352388b520.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7e5699feb938f7bf64141b1828623d95\" alt=\"Observerパターン_値の発行.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/0e06e3ed-815d-082f-9f80-28352388b520.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F0e06e3ed-815d-082f-9f80-28352388b520.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ec7432c6dc4c6c09b10826cf58aa2f22 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"3observerは受け取った値を使用して任意の処理を実行する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3observer%E3%81%AF%E5%8F%97%E3%81%91%E5%8F%96%E3%81%A3%E3%81%9F%E5%80%A4%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E4%BB%BB%E6%84%8F%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.Observerは受け取った値を使用して任意の処理を実行する\u003c/h2\u003e\n\n\u003cp\u003eObservableから発行された値を受け取ったObserverは、受け取った値を使用して任意の処理を実行することができます。\u003c/p\u003e\n\n\u003cp\u003eこのようにして、ObservableからObserverへとデータの受け渡しが実現されます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"observerパターンを実装してみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#observer%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eObserverパターンを実装してみる\u003c/h1\u003e\n\n\u003cp\u003eObserverパターンの基本的な仕組みの大枠は理解頂けたかと思います。\u003cbr\u003e\nそれでは、これらの仕組みを実際にどのように実装するかを説明していきます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"iobservertインターフェイスとiobservabletインターフェイス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#iobservert%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%81%A8iobservablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eIObserver\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスと\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイス\u003c/h2\u003e\n\n\u003cp\u003eObserverパターンは、「データを受け取るクラス」と「データを発行するクラス」を明確に分けて考えるデザインパターンと書きました。\u003cbr\u003e\n実は、.NET Framework4.0以降には、\u003cstrong\u003eObserverパターンで使える\u003ccode\u003eIObserver\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスと\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスが\u003ccode\u003eSystem\u003c/code\u003e名前空間に標準で用意されています\u003c/strong\u003e。\u003cbr\u003e\nObserverパターンを実装したい場合、これらのインターフェイスをデータの受信側、データの発行側のクラスにそれぞれ実装すれば良いことになります。\u003c/p\u003e\n\n\u003cp\u003eこれらのインターフェイスの定義は次のようになっています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//データの発行が完了したことを通知する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//データの発行元でエラーが発生したことを通知する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//データを通知する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//データの発行を購読する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e \u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eIObserver\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスの\u003ccode\u003eOnNext\u003c/code\u003eメソッドは、\u003cstrong\u003eデータを新しく通知する\u003c/strong\u003e際に呼び出すメソッドです。\u003cbr\u003e\n\u003ccode\u003eOnCompleted\u003c/code\u003eメソッドは、データの発行がすべて完了し、\u003cstrong\u003eこれ以上通知するものがない場合\u003c/strong\u003eに呼び出します。\u003cbr\u003e\n万が一、データの発行元で\u003cstrong\u003e何らかの例外が発生してしまった場合\u003c/strong\u003eは、\u003ccode\u003eOnError\u003c/code\u003eメソッドを呼び出して、エラーが発生したことを通知します。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスの\u003ccode\u003eSubscibe\u003c/code\u003eメソッドは、\u003cstrong\u003eデータの発行元からの通知を受け取りたいとき\u003c/strong\u003eに呼び出します。\u003cbr\u003e\n引数には、通知の発行先となる\u003ccode\u003eIObserver\u0026lt;T\u0026gt;\u003c/code\u003eオブジェクトを指定します。\u003c/p\u003e\n\n\u003cp\u003eここで、以下のような違和感を覚える方がいらっしゃるかもしれません。\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\u003ccode\u003eIObserver\u0026lt;T\u0026gt;\u003c/code\u003eはデータを受け取るクラスが実装するのに、なぜデータを発行する系のメソッドを実装するのか？\u003cbr\u003e\n逆に\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eはデータを発行するクラスが実装するのに、なぜデータの発行を購読するメソッドを実装するのか？\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eその答えは、これらのメソッドは、\u003cstrong\u003e実装するクラス自身が使用するのではなく、お互いに相手が使用するものだから\u003c/strong\u003eです。\u003c/p\u003e\n\n\u003cp\u003e例えば、「データを受け取るクラス(Observer)」が実装した\u003ccode\u003eIObserver\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスの\u003ccode\u003eOnNext\u003c/code\u003eメソッドは、データを発行するクラス(Observable)が呼び出すことで、Observerに対して値を通知することができます。\u003cbr\u003e\n逆に、「データを発行するクラス(Observable)」が実装した\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスの\u003ccode\u003eSubscribe\u003c/code\u003eメソッドは、データを受け取るクラス(Observer)が呼び出すことで、自分自身をデータの発行先として登録することができます。\u003c/p\u003e\n\n\u003cp\u003eまだ違和感が拭えないかもしれませんが、実際に実装してみると理解が深まるかもしれません。\u003cbr\u003e\nそれでは、実際に\u003ccode\u003eIObserver\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスと\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスを用いて、Observerパターンを実装してみます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"observerを実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#observer%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eObserverを実装する\u003c/h2\u003e\n\n\u003cp\u003eまずはObserver（通知を受け取るクラス）を作成します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"1クラスを作成する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1.クラスを作成する\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eObserver\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"2iobservertインターフェイスを実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2iobservert%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.\u003ccode\u003eIObserver\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスを実装する\u003c/h3\u003e\n\n\u003cp\u003eこのクラスはObserverなので、\u003ccode\u003eIObserver\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスを実装します。\u003cbr\u003e\n型引数\u003ccode\u003eT\u003c/code\u003eには受信したい値の型を指定します。ここでは、\u003ccode\u003eint\u003c/code\u003e型とします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eObserver\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNotImplementedException\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNotImplementedException\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNotImplementedException\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"3値を受け取ったときのコールバック処理を記述する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3%E5%80%A4%E3%82%92%E5%8F%97%E3%81%91%E5%8F%96%E3%81%A3%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E5%87%A6%E7%90%86%E3%82%92%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.値を受け取ったときのコールバック処理を記述する\u003c/h3\u003e\n\n\u003cp\u003eあとは、各メソッドにそれぞれ通知が来たときに実行したい処理を自由に記述します。\u003cbr\u003e\n例なので、ここでは次のようにコンソールにメッセージを出力するだけの処理を実装しました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eObserver\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"通知の受け取りが完了しました\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"次のエラーを受信しました:\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eを受け取りました\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれだけでObserverの実装は完了です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"複数のobserverを用意できるようにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AEobserver%E3%82%92%E7%94%A8%E6%84%8F%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e複数のObserverを用意できるようにする\u003c/h3\u003e\n\n\u003cp\u003e冒頭にも書きましたが、Observerパターンでは、発行された値を複数のクラス（Observer）が同時に受け取ることができます。\u003cbr\u003e\nこれを試すために、次のようにObserverの名前をコンストラクタで指定するようにして、どのObserverがメッセージを受け取ったかを識別できるようにしておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eObserver\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003em_name\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003em_name\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003em_name\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eが通知の受け取りを完了しました\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003em_name\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eが次のエラーを受信しました:\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003em_name\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eが\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eを受け取りました\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"observableを実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#observable%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eObservableを実装する\u003c/h2\u003e\n\n\u003cp\u003e次にObservable（通知を発行するクラス）を作成します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"1クラスを作成する-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1.クラスを作成する\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eObservable\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"2iobservabletインターフェイスを実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2iobservablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスを実装する\u003c/h3\u003e\n\n\u003cp\u003eこのクラスはObservableなので、\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスを実装します。\u003cbr\u003e\n型引数\u003ccode\u003eT\u003c/code\u003eには発行したい値の型を指定します。ObserverとObservableの型引数は合致している必要があるため、ここでも\u003ccode\u003eT\u003c/code\u003eは\u003ccode\u003eint\u003c/code\u003eとします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e \u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNotImplementedException\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"3値の発行先を覚えておく仕組みを作成する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3%E5%80%A4%E3%81%AE%E7%99%BA%E8%A1%8C%E5%85%88%E3%82%92%E8%A6%9A%E3%81%88%E3%81%A6%E3%81%8A%E3%81%8F%E4%BB%95%E7%B5%84%E3%81%BF%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.値の発行先を覚えておく仕組みを作成する\u003c/h3\u003e\n\n\u003cp\u003eObservableの役目は、値の発行先として登録された（購読された、\u003ccode\u003eSubscribe\u003c/code\u003eされた）\u003ccode\u003eIObserver\u0026lt;T\u0026gt;\u003c/code\u003eを記憶しておき、発行する値が生じたときに、そのすべての\u003ccode\u003eIObserver\u0026lt;T\u0026gt;\u003c/code\u003eに対して値を発行することです。\u003cbr\u003e\n※「値を発行する」とは、具体的には\u003ccode\u003eIObserver\u0026lt;T\u0026gt;\u003c/code\u003eの\u003ccode\u003eOnNext\u003c/code\u003e、\u003ccode\u003eOnCompleted\u003c/code\u003e、もしくは\u003ccode\u003eOnError\u003c/code\u003eメソッドを呼び出すことです\u003c/p\u003e\n\n\u003cp\u003eしたがって、Observableなクラスに\u003ccode\u003eSubscribe\u003c/code\u003eで指定された\u003ccode\u003eIObserver\u0026lt;int\u0026gt;\u003c/code\u003eを覚えておける仕組みを作成する必要があります。\u003cbr\u003e\nとはいっても、単に\u003ccode\u003eList\u0026lt;IObserver\u0026lt;T\u0026gt;\u0026gt;\u003c/code\u003eに溜めておくだけで十分です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//購読されたIObserver\u0026lt;int\u0026gt;のリスト\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e \u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれで、\u003ccode\u003eSubscribe\u003c/code\u003eで指定された\u003ccode\u003eIObserver\u0026lt;int\u0026gt;\u003c/code\u003eを覚えておくことができるようになりました。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"4購読解除用のidisposableなクラスを用意する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4%E8%B3%BC%E8%AA%AD%E8%A7%A3%E9%99%A4%E7%94%A8%E3%81%AEidisposable%E3%81%AA%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.購読解除用の\u003ccode\u003eIDisposable\u003c/code\u003eなクラスを用意する\u003c/h3\u003e\n\n\u003cp\u003eところで、\u003ccode\u003eSubscribe\u003c/code\u003eメソッドの戻り値は\u003ccode\u003eIDisposable\u003c/code\u003eになっています。\u003cbr\u003e\n今まで説明しませんでしたが、Observerパターンは、値の発行先として登録するSubscribeの対となる機能として、\u003cstrong\u003e値の発行を停止してもらう「購読解除」も可能となっています\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eSubscribe\u003c/code\u003eメソッドの戻り値として返す\u003ccode\u003eIDisposable\u003c/code\u003eは、\u003ccode\u003eSubscribe\u003c/code\u003eしたObserverが、「もう値はいらないです」と購読を解除するときに使用するものです\u003c/strong\u003e。\u003cbr\u003e\nご存知の通り、\u003ccode\u003eIDisposable\u003c/code\u003eインターフェイスの中身は\u003ccode\u003eDispose\u003c/code\u003eメソッドただ一つのみであり、\u003cstrong\u003e購読を解除したいObserverはこの\u003ccode\u003eIDisposable\u003c/code\u003eを\u003ccode\u003eDispose\u003c/code\u003eすることによって購読を解除\u003c/strong\u003eすることができます。\u003c/p\u003e\n\n\u003cp\u003eしたがって、\u003ccode\u003eDispose\u003c/code\u003eされたときに購読を解除する仕組みを作成する必要があります。\u003cbr\u003e\n「購読を解除する」とは、Observableなクラス視点で言えば、値の発行先リストである\u003ccode\u003eList\u0026lt;IObserver\u0026lt;T\u0026gt;\u0026gt;\u003c/code\u003eから購読を解除したい\u003ccode\u003eIObserver\u0026lt;T\u0026gt;\u003c/code\u003eを\u003ccode\u003eRemove\u003c/code\u003eすることに他なりません。\u003c/p\u003e\n\n\u003cp\u003eでは、どのように実装すればよいでしょうか？\u003c/p\u003e\n\n\u003cp\u003eまず、\u003ccode\u003eIDisposable\u003c/code\u003eインターフェイスを返さなければなりませんから、当然、\u003ccode\u003eIDisposable\u003c/code\u003eインターフェイスを実装したクラスが必要になります。\u003cbr\u003e\nそこで、以下のように「購読を解除する責務を持った\u003ccode\u003eIDisposable\u003c/code\u003eなクラス」を作成します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUnsubscriber\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNotImplementedException\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eそして、この\u003ccode\u003eDispose\u003c/code\u003eメソッドの中に、購読者リストから\u003ccode\u003eRemove\u003c/code\u003eする処理を書けば完成です。\u003cbr\u003e\n具体的には、発行先リスト\u003ccode\u003eList\u0026lt;IObserver\u0026lt;T\u0026gt;\u0026gt;\u003c/code\u003eと\u003ccode\u003eDispose\u003c/code\u003eされたときに\u003ccode\u003eRemove\u003c/code\u003eするターゲットとなる\u003ccode\u003eIObserver\u0026lt;T\u0026gt;\u003c/code\u003eを、コンストラクタで引き渡して、以下のように実装します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUnsubscriber\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//発行先リスト\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//DisposeされたときにRemoveするIObserver\u0026lt;int\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_observer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eUnsubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobservers\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eobservers\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003em_observer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//Disposeされたら発行先リストから対象の発行先を削除する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRemove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em_observer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eそして、この新しく作った購読解除用の\u003ccode\u003eIDisposable\u003c/code\u003eなクラスのインスタンスを、\u003ccode\u003eSubscribe\u003c/code\u003eの戻り値として返します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//購読されたIObserver\u0026lt;int\u0026gt;のリスト\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e \u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//購読解除用のクラスをIDisposableとして返す\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eUnsubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこうすることで、この\u003ccode\u003eIDisposable\u003c/code\u003eを受け取ったObserverは、値が要らなくなった時点で\u003ccode\u003eDispose\u003c/code\u003eメソッドを呼び出すことで、自分自身を発行先リストから削除することができるようになります。\u003c/p\u003e\n\n\u003cp\u003eところで、この\u003ccode\u003eUnsubscriber\u003c/code\u003eクラスは、\u003ccode\u003eObservable\u003c/code\u003eクラス以外から生成されることはありません。\u003cbr\u003e\nしたがって、下記のように\u003ccode\u003eObservable\u003c/code\u003eクラスの内部クラスにしてしまいます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//購読されたIObserver\u0026lt;int\u0026gt;のリスト\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e \u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//購読解除用のクラスをIDisposableとして返す\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eUnsubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//購読解除用内部クラス\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUnsubscriber\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//発行先リスト\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//DisposeされたときにRemoveするIObserver\u0026lt;int\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_observer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eUnsubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobservers\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eobservers\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_observer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//Disposeされたら発行先リストから対象の発行先を削除する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRemove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em_observer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"5通知を発行する処理を記述する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5%E9%80%9A%E7%9F%A5%E3%82%92%E7%99%BA%E8%A1%8C%E3%81%99%E3%82%8B%E5%87%A6%E7%90%86%E3%82%92%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5.通知を発行する処理を記述する\u003c/h3\u003e\n\n\u003cp\u003e最後に、発行したい情報や値があった場合に通知を発行する処理を記述します。\u003cbr\u003e\nここでは例として、\u003ccode\u003eSendNotice\u003c/code\u003eメソッドが呼ばれたときに“int”型の1,2,3を連続で通知を発行するようにします。\u003c/p\u003e\n\n\u003cp\u003e値を発行するには、\u003ccode\u003eOnNext\u003c/code\u003eメソッドを呼び出します。\u003cbr\u003e\nすべての発行先に対して\u003ccode\u003eOnNext\u003c/code\u003eメソッドを呼び出すので、以下のように\u003ccode\u003eforeach\u003c/code\u003eを使用すればOKです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//購読されたIObserver\u0026lt;int\u0026gt;のリスト\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e \u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//購読解除用のクラスをIDisposableとして返す\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eUnsubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendNotice\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//すべての発行先に対して1,2,3を発行する\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//購読解除用内部クラス\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUnsubscriber\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//発行先リスト\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//DisposeされたときにRemoveするIObserver\u0026lt;int\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_observer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eUnsubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobservers\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eobservers\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_observer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//Disposeされたら発行先リストから対象の発行先を削除する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_observers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRemove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em_observer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"使ってみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使ってみる\u003c/h2\u003e\n\n\u003cp\u003eこれまで作成したObserverとObservableを使用して、実際に値の購読と発行、受け取りの流れを実演します。\u003c/p\u003e\n\n\u003cp\u003eここでは、以下のようなコンソールアプリケーションを作成しました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//値を受け取るクラスを３つ作成\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eObserver\u003c/span\u003e \u003cspan class=\"n\"\u003eobserverA\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Aさん\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eObserver\u003c/span\u003e \u003cspan class=\"n\"\u003eobserverB\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Bさん\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eObserver\u003c/span\u003e \u003cspan class=\"n\"\u003eobserverC\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Cさん\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//値を発行するクラスを作成\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eObservable\u003c/span\u003e \u003cspan class=\"n\"\u003eobservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//３つのObserverが、自分自身を発行先として登録する（=購読）\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e \u003cspan class=\"n\"\u003edisposableA\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eobservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobserverA\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e \u003cspan class=\"n\"\u003edisposableB\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eobservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobserverB\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e \u003cspan class=\"n\"\u003edisposableC\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eobservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobserverC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Aさん〜Cさんが値を購読しました\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"値を発行させます\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//Observableに値を発行させる\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eobservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSendNotice\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Aさんが購読解除します\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//Aさんが購読解除する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edisposableA\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"値を発行させます\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//再び値を発行させる\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eobservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSendNotice\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Bさんが購読解除します\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//Bさんが購読解除する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edisposableB\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"値を発行させます\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//再び値を発行させる\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eobservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSendNotice\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadKey\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eやっている内容としては、コードを見たとおりですが\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e値の購読者（Observer）をAさん、Bさん、Cさんの３つを作成\u003c/li\u003e\n\u003cli\u003e値の発行者（Observable）を作成\u003c/li\u003e\n\u003cli\u003eAさん〜CさんがObservableを購読\u003c/li\u003e\n\u003cli\u003eObservableに値を発行させる\u003c/li\u003e\n\u003cli\u003eAさん、購読を解除する\u003c/li\u003e\n\u003cli\u003eObservableに再び値を発行させる\u003c/li\u003e\n\u003cli\u003eBさんも購読を解除する\u003c/li\u003e\n\u003cli\u003eObservableに再び値を発行させる\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eとなります。\u003c/p\u003e\n\n\u003cp\u003eこれを実行すると、次のような出力が得られます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eAさん〜Cさんが値を購読しました\n値を発行させます\nAさんが1を受け取りました\nAさんが2を受け取りました\nAさんが3を受け取りました\nBさんが1を受け取りました\nBさんが2を受け取りました\nBさんが3を受け取りました\nCさんが1を受け取りました\nCさんが2を受け取りました\nCさんが3を受け取りました\nAさんが購読解除します\n値を発行させます\nBさんが1を受け取りました\nBさんが2を受け取りました\nBさんが3を受け取りました\nCさんが1を受け取りました\nCさんが2を受け取りました\nCさんが3を受け取りました\nBさんが購読解除します\n値を発行させます\nCさんが1を受け取りました\nCさんが2を受け取りました\nCさんが3を受け取りました\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eObserverパターンが期待通りに動作していることが確認できます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"さいごに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eさいごに\u003c/h1\u003e\n\n\u003cp\u003e以上、少し長くなってしまいましたがObserverパターンの解説を行いました。\u003c/p\u003e\n\n\u003cp\u003e僕自身としては、Observerパターンをこのようにそのまま利用することは少なく、ReactiveExtensionsというObserverパターンをベースとした非常に強力なライブラリを通じて利用することがほとんどです。\u003cbr\u003e\nもともとは、このReactiveExtensionsの記事を書いていたのですが、ベースとなるObserverパターンの説明がとても長くなってしまったため、別記事として抜き出しました。\u003cbr\u003e\nまたReactiveExtensionsの記事も書いたらリンクを貼るのでそちらも良ければ御覧ください。\u003c/p\u003e\n\n\u003cp\u003e[2020/12/22追記]\u003cbr\u003e\nReactiveExtensionに関する記事書きました。よろしければ参照ください。\u003cbr\u003e\n\u003cstrong\u003e\u003ca href=\"https://qiita.com/yutorisan/items/2475eaf5d8c3a6454e3f#comments\" id=\"reference-bd821df24edceb6ad80e\"\u003e【C#】なぜReactiveExtensionsを導入すると幸せになれるのか\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e何か間違いやご指摘、ご質問あればコメントにお願いします。\u003c/p\u003e\n","createdAt":"2020-12-17T15:41:46Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"a7maBlPEW8KMjegyUtgNUm2FiUTvzhUAkw==--Y83osFX8793itbcM--iGeLZAvUT1ABXxZ/xjCrEg==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-12-22T03:39:25Z","likesCount":22,"linkUrl":"https://qiita.com/yutorisan/items/6e960426da71b7e02af7","organization":null,"originalId":1360865,"stockedCount":21,"title":"C#でObserverパターンをきちんと理解して実装する","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#observer%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%A8%E3%81%AF\"\u003eObserverパターンとは\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#observer%E3%81%A8observable\"\u003eObserverとObservable\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BB%95%E7%B5%84%E3%81%BF\"\u003e基本的な仕組み\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1-observer%E3%81%8Cobservable%E3%82%92%E8%B3%BC%E8%AA%AD%E3%81%99%E3%82%8B\"\u003e1. ObserverがObservableを購読する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2observable%E3%81%AF%E7%99%BB%E9%8C%B2%E3%81%95%E3%82%8C%E3%81%9F%E3%81%99%E3%81%B9%E3%81%A6%E3%81%AE%E7%99%BA%E8%A1%8C%E5%85%88%E3%81%AB%E5%80%A4%E3%82%92%E7%99%BA%E8%A1%8C%E3%81%99%E3%82%8B\"\u003e2.Observableは登録されたすべての発行先に値を発行する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3observer%E3%81%AF%E5%8F%97%E3%81%91%E5%8F%96%E3%81%A3%E3%81%9F%E5%80%A4%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E4%BB%BB%E6%84%8F%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B\"\u003e3.Observerは受け取った値を使用して任意の処理を実行する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#observer%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003eObserverパターンを実装してみる\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#iobservert%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%81%A8iobservablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9\"\u003eIObserver\u0026lt;T\u0026gt;インターフェイスとIObservable\u0026lt;T\u0026gt;インターフェイス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#observer%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003eObserverを実装する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"\u003e1.クラスを作成する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2iobservert%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e2.IObserver\u0026lt;T\u0026gt;インターフェイスを実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3%E5%80%A4%E3%82%92%E5%8F%97%E3%81%91%E5%8F%96%E3%81%A3%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E5%87%A6%E7%90%86%E3%82%92%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B\"\u003e3.値を受け取ったときのコールバック処理を記述する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AEobserver%E3%82%92%E7%94%A8%E6%84%8F%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e複数のObserverを用意できるようにする\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#observable%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003eObservableを実装する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B-1\"\u003e1.クラスを作成する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2iobservablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e2.IObservable\u0026lt;T\u0026gt;インターフェイスを実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3%E5%80%A4%E3%81%AE%E7%99%BA%E8%A1%8C%E5%85%88%E3%82%92%E8%A6%9A%E3%81%88%E3%81%A6%E3%81%8A%E3%81%8F%E4%BB%95%E7%B5%84%E3%81%BF%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"\u003e3.値の発行先を覚えておく仕組みを作成する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4%E8%B3%BC%E8%AA%AD%E8%A7%A3%E9%99%A4%E7%94%A8%E3%81%AEidisposable%E3%81%AA%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003e4.購読解除用のIDisposableなクラスを用意する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#5%E9%80%9A%E7%9F%A5%E3%82%92%E7%99%BA%E8%A1%8C%E3%81%99%E3%82%8B%E5%87%A6%E7%90%86%E3%82%92%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B\"\u003e5.通知を発行する処理を記述する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e使ってみる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\"\u003eさいごに\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":3286,"uuid":"6e960426da71b7e02af7","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"aQDVNmm25c8tjZNqOyJV+vR16bCB--g4gfr87CKdqg25/l--JpHAQenfc5j2Lpw42oBKqw==","originalId":697830,"description":"C#が好きです","facebookUrl":null,"githubUrl":"https://github.com/yutorisan","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://pbs.twimg.com/profile_images/1274400166120812544/DAWcpHec_bigger.jpg","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F1274400166120812544%2FDAWcpHec_bigger.jpg?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=b517115d0e848c54aa4fe1fc93bfa0ff","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F1274400166120812544%2FDAWcpHec_bigger.jpg?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=754be610f489085be0fdfc48de5585a9","urlName":"yutorisan","websiteUrl":"","twitterUrl":"https://twitter.com/yutorisan19","twitterUrlName":"yutorisan19","revealedOrganizations":{"edges":[{"node":{"encryptedId":"JV0vWZ5MkKnyGkrrk6TDITOJKMvMUYqF9bk=--6NZmbeve9pEL6n6E--YLYKPO+zlJkFeXdRGzuz3Q==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"Unityゲーム開発者ギルド","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","urlName":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。","url":"https://unity-game-dev-guild.github.io/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"オブジェクト指向","urlName":"%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e6%8c%87%e5%90%91"},{"name":"ReactiveExtensions","urlName":"reactiveextensions"},{"name":"デザインパターン","urlName":"%e3%83%87%e3%82%b6%e3%82%a4%e3%83%b3%e3%83%91%e3%82%bf%e3%83%bc%e3%83%b3"},{"name":"GoF","urlName":"gof"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

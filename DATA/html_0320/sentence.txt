この記事は 地震界隈 Advent Calendar 2020 9日目のやつです。僕の作成したライブラリである、KyoshinMonitorLibを使って各観測点の震度を取得してみましょう。
初心者の方でもなんとなく動かせるようになるように画像マシマシ、言語機能は控えめにやります。VisualStudioを起動したらまずは 新しいプロジェクトを作成 しましょう。
(もしかしたらウィンドウの色が違うかもしれませんが、あまり気にしないでください)
みなさん豪華な画面のアプリを作ってみたいと思うかもしれませんが、まずは基本のロジック部分を触ってみるということでコンソールアプリを作成します。
プロジェクトの場所は好きな場所で大丈夫ですが、プロジェクトフォルダをまとめるフォルダを作っておくのがおすすめです。
これでプロジェクトの作成は完了です。プロジェクトの作成が完了したら ソリューションエクスプローラー の今回作成したプロジェクトを右クリックして NuGet パッケージの管理 を選んでください。
(殆どの方はソリューションエクスプローラーが左側にあるかもしれません。僕が右側が好きなだけなのであまり気にしないでください)
画面が表示されたら、変更のプレビュー が表示されたらそのままOKしてください。
ここから強震モニタの情報を取得する処理を書いていくわけですが、強震モニタからは観測点情報を取得することができません。
そのため、別途観測点情報が必要になりますが今回は僕が作成した観測点リストをダウンロードしてください。
https://github.com/ingen084/KyoshinEewViewerIngen/raw/936634ae230942126790de1a3d1dc545a2f7de98/src/KyoshinEewViewer/Resources/ShindoObsPoints.mpk.lz4(自作ソフトに同梱も可能です。その際はクレジットの記載をしていただけると非常に喜びます。またこのデータは時期によっては古くなっている可能性があるため定期的に確認してください。)ダウンロードが完了したらそのファイルをソリューションエクスプローラーにドラッグドロップします。
ドラッグドロップが完了したらそのファイルを右クリックし、プロパティを開きます。
出力ディレクトリにコピー を 新しい場合はコピーする に選択してください。
これで観測点データの準備はバッチリです。Program.cs を以下のように書き換えてみてください。ちなみに しっかりメモリを～ と書いている部分は半分ウソなので初心者の方は鵜呑みにしないでください。分かる人はわかると思います。
このまま実行するとずらーっと次のように出力されると思います。バッチリ取得できましたね！
毎秒正確な時間にリクエストするためのタイマーやインターネット時刻の活用などを行う機能もあるので主な使用例はこちらのコードも参考にしてみてください。(丸投げ)
https://github.com/ingen084/KyoshinMonitorLib/blob/master/src/Tests/Program.csタイマー周りは多分Kiwi Monitorでも使われてると思います。そんな解析機能いらねえよ！という方向けにURL生成クラスも用意しています。すでにソフトを作成されている方も是非活用してみてください。



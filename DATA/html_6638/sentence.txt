こんにちは以前キーボードの入力状態を調べるという記事でキー入力をC++/DXライブラリでクラス化する記事を書きました。そして先日のアドベントカレンダー記事のdxlib　小技集（役に立つかは保証できません）(@takuro7021)内で、次のような言及がありました。けどここの方法だと使うキーが増えるたびにオブジェクトを作る必要があります。しかもよく読んでみるとわかるんですけど、キーの数だけupdateを実行する必要がありますし、僕の勘違いでなければGetHitKeyStateAllは本来1フレーム（ゲームのメインループ一回）に一回呼べばいいのにこれじゃキーの数だけ呼ばれてしまいます。およ？と思い改めて自分のコードを読み直しました。これですね元記事読んでもらえるとわかると思いますが、キー一つ一つのオブジェクトがこのUpdate関数を持ち、毎フレーム更新しています。つまり、GetHitKeyStateAll(isKey)は1フレームにつき100回以上呼び出されています。じっさいこの関数は1フレーム一回呼べばいいはずなのです。(そういう指摘コメントは記事のほうに書いてくれてもいいのよ！)個人的に思ったことを書いているだけですので読む必要はありません。記事のちょっとしたのほうに別方法が記載された参考リンクがあります。こちらの方法もいいと思います。ですが私はいまC#メインとなり、KEY_INPUT_Aのような定数もDX.KEY_INPUT_Aと変わりDX.をいちいち打つのもめんどい。というかC#なんだからクラス化したい。というかこれだと自分が必要な情報がすべて集まらないんですよね。
また、Siv3DというC++ライブラリがあるのですが、こちらはなかなかきれいにクラスにまとまっていてかんたんなコードで書けるというメリットもあり気に入っています。でもDXライブラリのほうが自分でやっている感じがして楽しい。となるとDXライブラリでSiv3Dのようなコードに似せればよい。となりました。以上を踏まえてこの前のをそのままC#に流用するとともに改良を加えることにしました。構造は単純で、引数で渡せば済む話です。いまC#メインに切り替えたのでC++のコードはないのですが、少し変えれば動くはずです。少し変数名等は変わっていますが基本同じ。メインループの頭らへんでとでも呼べば、GetHitKeyStateAll関数呼び出しは1フレーム1回で済みました。
これで現状自分が認知している課題は解決しました。マウスも同じようにやっています。何かあったらコメントへ(記事適当でごめんなさい...)



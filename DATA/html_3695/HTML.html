<!DOCTYPE html><html><head><meta charset="utf-8" /><title>BASE64URL Encodingのすすめ - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/libraplanet/items/8e4b51371948850060c1" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="hzE5OGmIMzhd/tgpgQiPbkkg/G0jjj0pckSFavBr2OXWXEcKkqTGbYEkIMER9PWgk2gwVLqJvqyQRKaSCN+Ljw==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="BASE64URL Encodingのすすめ - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1Ra0ZUUlRZMFZWSk1JRVZ1WTI5a2FXNW40NEd1NDRHWjQ0R1o0NEtCJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWYwZjE1MWI3OTczNTQ4YjJkOTg4YzdiYTdmZDk4MWY2&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3hwWW5KaGNHeGhibVYwJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9ODBjMDAyOGY2YmFkYzcwMjgxYzkxYmZiZWM0NWNmYTc&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=5636025043c31c71e1ce3758579b3a59"><meta property="og:description" content="

あのURLで見たBASE64の名前を僕達はまだ知らない。

あれは BASE64URL Encoding と言うらしい。
(どれだよ)


Base64#変形版 - Wikipedia





URLアプリケーションのための変形..."><meta content="https://qiita.com/libraplanet/items/8e4b51371948850060c1" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="Java,C#,base64" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-a574b5b3-8e9f-4c65-8b70-adbdad523a28"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Flibraplanet%2Fitems%2F8e4b51371948850060c1">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Flibraplanet%2Fitems%2F8e4b51371948850060c1">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-a574b5b3-8e9f-4c65-8b70-adbdad523a28">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/java","name":"Java"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2021-05-02T04:00:38.000+09:00","dateModified":"2021-06-17T01:20:53.000+09:00","headline":"BASE64URL Encodingのすすめ","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1Ra0ZUUlRZMFZWSk1JRVZ1WTI5a2FXNW40NEd1NDRHWjQ0R1o0NEtCJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWYwZjE1MWI3OTczNTQ4YjJkOTg4YzdiYTdmZDk4MWY2\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3hwWW5KaGNHeGhibVYwJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9ODBjMDAyOGY2YmFkYzcwMjgxYzkxYmZiZWM0NWNmYTc\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=5636025043c31c71e1ce3758579b3a59","mainEntityOfPage":"https://qiita.com/libraplanet/items/8e4b51371948850060c1","author":{"@type":"Person","address":null,"email":null,"identifier":"libraplanet","name":"libraplanet","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F72257%2Fe381e2f4dd7851e2a001bfbed66153a131d5e78b%2Fx_large.png%3F1598304169?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=d426188a19b67fbd8a5ed5d14dbfe64d","url":"https://qiita.com/libraplanet","description":null,"memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"libraplanet","type":"items","id":"8e4b51371948850060c1"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"libraplanet","type":"items","id":"8e4b51371948850060c1"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"libraplanet","type":"items","id":"8e4b51371948850060c1"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/libraplanet/items/8e4b51371948850060c1","location":"/libraplanet/items/8e4b51371948850060c1","scheme":"https","host":"qiita.com","port":null,"pathname":"/libraplanet/items/8e4b51371948850060c1","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"X7QJRv1Eq00FcRA9TXFnwUFy31FPCFggWA387wq83ZgO2Xd0BmheGNmr6NXdjR0PmzoTaNYP26W6Dd8X8giO8g==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-e7f0aefd-7bb5-465d-b197-268cbfed8a9b"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/libraplanet/items/8e4b51371948850060c1/likers" class="css-1iupg5d">1</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">0</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/8e4b51371948850060c1/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/libraplanet/items/8e4b51371948850060c1/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/libraplanet/items/8e4b51371948850060c1/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/libraplanet/items/8e4b51371948850060c1/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/libraplanet/items/8e4b51371948850060c1.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/libraplanet"><img class="css-100alwu eyfquo10" src="https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/72257/e381e2f4dd7851e2a001bfbed66153a131d5e78b/x_large.png?1598304169" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/libraplanet" class="css-10ougpm">@<!-- -->libraplanet</a><div class="css-1ay9vb9"><span><meta content="2021-05-01T19:00:38Z"/><time dateTime="2021-06-16T16:20:53Z" class="css-m19uds">updated at 2021-06-16</time></span></div></div></div></div></div><h1 class="css-cgzq40">BASE64URL Encodingのすすめ</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/java" class="css-4czcte">Java</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/base64" class="css-4czcte">base64</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="あのurlで見たbase64の名前を僕達はまだ知らない" class="fragment"></span><a href="#%E3%81%82%E3%81%AEurl%E3%81%A7%E8%A6%8B%E3%81%9Fbase64%E3%81%AE%E5%90%8D%E5%89%8D%E3%82%92%E5%83%95%E9%81%94%E3%81%AF%E3%81%BE%E3%81%A0%E7%9F%A5%E3%82%89%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>あのURLで見たBASE64の名前を僕達はまだ知らない。</h1>

<p>あれは <code>BASE64URL Encoding</code> と言うらしい。<br>
(どれだよ)</p>

<ul>
<li>Base64#変形版 - Wikipedia</li>
</ul>

<p><qiita-embed-ogp src="https://ja.wikipedia.org/wiki/Base64#%E5%A4%89%E5%BD%A2%E7%89%88"></qiita-embed-ogp></p>

<blockquote>
<p>URLアプリケーションのための変形 Base64<br>
('base64url' encoding)</p>
</blockquote>

<h1>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h1>

<p><code>BASE64</code> でエンコードした文字列には、 <code>URL</code> 上で意味を持つ <code>+</code> 、 <code>/</code> 、 <code>=</code> が含まれている。そのため  <code>URL</code> で利用するためには工夫が必要である。<code>BASE64</code> には <strong><code>BASE64URL Encoding</code></strong> と言う変形版が公式仕様にあり、<code>URL Encoding</code> や <code>Percent Encoding</code> よりも、URL上で利用するには都合が良い様に感じた。</p>

<p>今回WEBアプリで <code>BASE64URL Encoding</code> を扱うにあたり、ついでに <code>BASE64</code> の自体も実装をしてみようと思い、やってみた、そんな話。</p>

<h1>
<span id="base64の解説" class="fragment"></span><a href="#base64%E3%81%AE%E8%A7%A3%E8%AA%AC"><i class="fa fa-link"></i></a>BASE64の解説</h1>

<h2>
<span id="-base64-original" class="fragment"></span><a href="#-base64-original"><i class="fa fa-link"></i></a>① BASE64 (original)</h2>

<p>読んでみると超シンプルな代物。</p>

<ul>
<li>Base64 - Wikipedia</li>
</ul>

<p><qiita-embed-ogp src="https://ja.wikipedia.org/wiki/Base64"></qiita-embed-ogp></p>

<ul>
<li>バイナリ全体をbitの配列 (bit stream) として捉え、<strong>6bit</strong> ずつ区切り、対応する文字列に置き換える。</li>
<li>
<strong>6bit</strong> = <strong>2^6</strong> = 64 (⇒ 64文字種)</li>
<li>文字テーブル：<br>
<code>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/</code><br>
(64文字種)</li>
<li>3btyte (24bit) ずつ処理し、4byteに伸長する。※ 24は8と6の最小公倍数。

<ul>
<li>不足するbitは0で埋める。</li>
<li>不足するbyteは <code>=</code> 文字で埋める。</li>
<li>必ず文字列長は4の倍数になる。</li>
</ul>
</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/b55e82d608d4a74182f4cde3eaaa7df2f29a2629/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f37323235372f36383961663432312d643938612d363465622d613131622d3137303665636366613735312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F72257%2F689af421-d98a-64eb-a11b-1706eccfa751.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=cc3e7c597e2b87e5650ad41ff8d16104" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/72257/689af421-d98a-64eb-a11b-1706eccfa751.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F72257%2F689af421-d98a-64eb-a11b-1706eccfa751.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2d08a82704b08fe7be0cfed7f73a2822 1x" loading="lazy"></a></p>

<p>コーディングの前に視覚化して整理するのも良いと思う。</p>

<h2>
<span id="-base64-url-encoding-url安全なbase64" class="fragment"></span><a href="#-base64-url-encoding-url%E5%AE%89%E5%85%A8%E3%81%AAbase64"><i class="fa fa-link"></i></a>② BASE64 URL Encoding (URL安全なBASE64)</h2>

<p>BASE64 の仕様 RFC 4648 内で Section 5 「Base 64 Encoding with URL and Filename Safe Alphabet」 にて定義されている。</p>

<p>・RFC 4648 - The Base16, Base32, and Base64 Data Encodings #Section-5 Base 64 Encoding with URL and Filename Safe Alphabet</p>

<p><qiita-embed-ogp src="https://tools.ietf.org/html/rfc4648#section-5"></qiita-embed-ogp></p>

<ul>
<li> <code>+</code> 、 <code>/</code> 、 <code>=</code> は <code>URL</code> 上意味を持つ記号のため、それらの文字を回避したもの。  (URL上の役割は割愛。)</li>
<li> 62番 <code>+</code> ⇒ <code>-</code> で表現する。</li>
<li> 63番 <code>/</code> ⇒ <code>_</code> で表現する。</li>
<li> <code>=</code> によるパディングは行わない。</li>
</ul>

<p>結構シンプルで、ほぼ一緒。</p>

<table>
<thead>
<tr>
<th style="text-align: left">#</th>
<th style="text-align: left">bit</th>
<th style="text-align: left">hex</th>
<th style="text-align: left">BASE64</th>
<th style="text-align: left">BASE64URL</th>
<th style="text-align: left">#</th>
<th style="text-align: left">bit</th>
<th style="text-align: left">hex</th>
<th style="text-align: left">BASE64</th>
<th style="text-align: left">BASE64URL</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">0</td>
<td style="text-align: left">00000000</td>
<td style="text-align: left">0x00</td>
<td style="text-align: left">A</td>
<td style="text-align: left">A</td>
<td style="text-align: left">32</td>
<td style="text-align: left">00100000</td>
<td style="text-align: left">0x20</td>
<td style="text-align: left">g</td>
<td style="text-align: left">g</td>
</tr>
<tr>
<td style="text-align: left">1</td>
<td style="text-align: left">00000001</td>
<td style="text-align: left">0x01</td>
<td style="text-align: left">B</td>
<td style="text-align: left">B</td>
<td style="text-align: left">33</td>
<td style="text-align: left">00100001</td>
<td style="text-align: left">0x21</td>
<td style="text-align: left">h</td>
<td style="text-align: left">h</td>
</tr>
<tr>
<td style="text-align: left">2</td>
<td style="text-align: left">00000010</td>
<td style="text-align: left">0x02</td>
<td style="text-align: left">C</td>
<td style="text-align: left">C</td>
<td style="text-align: left">34</td>
<td style="text-align: left">00100010</td>
<td style="text-align: left">0x22</td>
<td style="text-align: left">i</td>
<td style="text-align: left">i</td>
</tr>
<tr>
<td style="text-align: left">3</td>
<td style="text-align: left">00000011</td>
<td style="text-align: left">0x03</td>
<td style="text-align: left">D</td>
<td style="text-align: left">D</td>
<td style="text-align: left">35</td>
<td style="text-align: left">00100011</td>
<td style="text-align: left">0x23</td>
<td style="text-align: left">j</td>
<td style="text-align: left">j</td>
</tr>
<tr>
<td style="text-align: left">4</td>
<td style="text-align: left">00000100</td>
<td style="text-align: left">0x04</td>
<td style="text-align: left">E</td>
<td style="text-align: left">E</td>
<td style="text-align: left">36</td>
<td style="text-align: left">00100100</td>
<td style="text-align: left">0x24</td>
<td style="text-align: left">k</td>
<td style="text-align: left">k</td>
</tr>
<tr>
<td style="text-align: left">5</td>
<td style="text-align: left">00000101</td>
<td style="text-align: left">0x05</td>
<td style="text-align: left">F</td>
<td style="text-align: left">F</td>
<td style="text-align: left">37</td>
<td style="text-align: left">00100101</td>
<td style="text-align: left">0x25</td>
<td style="text-align: left">l</td>
<td style="text-align: left">l</td>
</tr>
<tr>
<td style="text-align: left">6</td>
<td style="text-align: left">00000110</td>
<td style="text-align: left">0x06</td>
<td style="text-align: left">G</td>
<td style="text-align: left">G</td>
<td style="text-align: left">38</td>
<td style="text-align: left">00100110</td>
<td style="text-align: left">0x26</td>
<td style="text-align: left">m</td>
<td style="text-align: left">m</td>
</tr>
<tr>
<td style="text-align: left">7</td>
<td style="text-align: left">00000111</td>
<td style="text-align: left">0x07</td>
<td style="text-align: left">H</td>
<td style="text-align: left">H</td>
<td style="text-align: left">39</td>
<td style="text-align: left">00100111</td>
<td style="text-align: left">0x27</td>
<td style="text-align: left">n</td>
<td style="text-align: left">n</td>
</tr>
<tr>
<td style="text-align: left">8</td>
<td style="text-align: left">00001000</td>
<td style="text-align: left">0x08</td>
<td style="text-align: left">I</td>
<td style="text-align: left">I</td>
<td style="text-align: left">40</td>
<td style="text-align: left">00101000</td>
<td style="text-align: left">0x28</td>
<td style="text-align: left">o</td>
<td style="text-align: left">o</td>
</tr>
<tr>
<td style="text-align: left">9</td>
<td style="text-align: left">00001001</td>
<td style="text-align: left">0x09</td>
<td style="text-align: left">J</td>
<td style="text-align: left">J</td>
<td style="text-align: left">41</td>
<td style="text-align: left">00101001</td>
<td style="text-align: left">0x29</td>
<td style="text-align: left">p</td>
<td style="text-align: left">p</td>
</tr>
<tr>
<td style="text-align: left">10</td>
<td style="text-align: left">00001010</td>
<td style="text-align: left">0x0A</td>
<td style="text-align: left">K</td>
<td style="text-align: left">K</td>
<td style="text-align: left">42</td>
<td style="text-align: left">00101010</td>
<td style="text-align: left">0x2A</td>
<td style="text-align: left">q</td>
<td style="text-align: left">q</td>
</tr>
<tr>
<td style="text-align: left">11</td>
<td style="text-align: left">00001011</td>
<td style="text-align: left">0x0B</td>
<td style="text-align: left">L</td>
<td style="text-align: left">L</td>
<td style="text-align: left">43</td>
<td style="text-align: left">00101011</td>
<td style="text-align: left">0x2B</td>
<td style="text-align: left">r</td>
<td style="text-align: left">r</td>
</tr>
<tr>
<td style="text-align: left">12</td>
<td style="text-align: left">00001100</td>
<td style="text-align: left">0x0C</td>
<td style="text-align: left">M</td>
<td style="text-align: left">M</td>
<td style="text-align: left">44</td>
<td style="text-align: left">00101100</td>
<td style="text-align: left">0x2C</td>
<td style="text-align: left">s</td>
<td style="text-align: left">s</td>
</tr>
<tr>
<td style="text-align: left">13</td>
<td style="text-align: left">00001101</td>
<td style="text-align: left">0x0D</td>
<td style="text-align: left">N</td>
<td style="text-align: left">N</td>
<td style="text-align: left">45</td>
<td style="text-align: left">00101101</td>
<td style="text-align: left">0x2D</td>
<td style="text-align: left">t</td>
<td style="text-align: left">t</td>
</tr>
<tr>
<td style="text-align: left">14</td>
<td style="text-align: left">00001110</td>
<td style="text-align: left">0x0E</td>
<td style="text-align: left">O</td>
<td style="text-align: left">O</td>
<td style="text-align: left">46</td>
<td style="text-align: left">00101110</td>
<td style="text-align: left">0x2E</td>
<td style="text-align: left">u</td>
<td style="text-align: left">u</td>
</tr>
<tr>
<td style="text-align: left">15</td>
<td style="text-align: left">00001111</td>
<td style="text-align: left">0x0F</td>
<td style="text-align: left">P</td>
<td style="text-align: left">P</td>
<td style="text-align: left">47</td>
<td style="text-align: left">00101111</td>
<td style="text-align: left">0x2F</td>
<td style="text-align: left">v</td>
<td style="text-align: left">v</td>
</tr>
<tr>
<td style="text-align: left">16</td>
<td style="text-align: left">00010000</td>
<td style="text-align: left">0x10</td>
<td style="text-align: left">Q</td>
<td style="text-align: left">Q</td>
<td style="text-align: left">48</td>
<td style="text-align: left">00110000</td>
<td style="text-align: left">0x30</td>
<td style="text-align: left">w</td>
<td style="text-align: left">w</td>
</tr>
<tr>
<td style="text-align: left">17</td>
<td style="text-align: left">00010001</td>
<td style="text-align: left">0x11</td>
<td style="text-align: left">R</td>
<td style="text-align: left">R</td>
<td style="text-align: left">49</td>
<td style="text-align: left">00110001</td>
<td style="text-align: left">0x31</td>
<td style="text-align: left">x</td>
<td style="text-align: left">x</td>
</tr>
<tr>
<td style="text-align: left">18</td>
<td style="text-align: left">00010010</td>
<td style="text-align: left">0x12</td>
<td style="text-align: left">S</td>
<td style="text-align: left">S</td>
<td style="text-align: left">50</td>
<td style="text-align: left">00110010</td>
<td style="text-align: left">0x32</td>
<td style="text-align: left">y</td>
<td style="text-align: left">y</td>
</tr>
<tr>
<td style="text-align: left">19</td>
<td style="text-align: left">00010011</td>
<td style="text-align: left">0x13</td>
<td style="text-align: left">T</td>
<td style="text-align: left">T</td>
<td style="text-align: left">51</td>
<td style="text-align: left">00110011</td>
<td style="text-align: left">0x33</td>
<td style="text-align: left">z</td>
<td style="text-align: left">z</td>
</tr>
<tr>
<td style="text-align: left">20</td>
<td style="text-align: left">00010100</td>
<td style="text-align: left">0x14</td>
<td style="text-align: left">U</td>
<td style="text-align: left">U</td>
<td style="text-align: left">52</td>
<td style="text-align: left">00110100</td>
<td style="text-align: left">0x34</td>
<td style="text-align: left">0</td>
<td style="text-align: left">0</td>
</tr>
<tr>
<td style="text-align: left">21</td>
<td style="text-align: left">00010101</td>
<td style="text-align: left">0x15</td>
<td style="text-align: left">V</td>
<td style="text-align: left">V</td>
<td style="text-align: left">53</td>
<td style="text-align: left">00110101</td>
<td style="text-align: left">0x35</td>
<td style="text-align: left">1</td>
<td style="text-align: left">1</td>
</tr>
<tr>
<td style="text-align: left">22</td>
<td style="text-align: left">00010110</td>
<td style="text-align: left">0x16</td>
<td style="text-align: left">W</td>
<td style="text-align: left">W</td>
<td style="text-align: left">54</td>
<td style="text-align: left">00110110</td>
<td style="text-align: left">0x36</td>
<td style="text-align: left">2</td>
<td style="text-align: left">2</td>
</tr>
<tr>
<td style="text-align: left">23</td>
<td style="text-align: left">00010111</td>
<td style="text-align: left">0x17</td>
<td style="text-align: left">X</td>
<td style="text-align: left">X</td>
<td style="text-align: left">55</td>
<td style="text-align: left">00110111</td>
<td style="text-align: left">0x37</td>
<td style="text-align: left">3</td>
<td style="text-align: left">3</td>
</tr>
<tr>
<td style="text-align: left">24</td>
<td style="text-align: left">00011000</td>
<td style="text-align: left">0x18</td>
<td style="text-align: left">Y</td>
<td style="text-align: left">Y</td>
<td style="text-align: left">56</td>
<td style="text-align: left">00111000</td>
<td style="text-align: left">0x38</td>
<td style="text-align: left">4</td>
<td style="text-align: left">4</td>
</tr>
<tr>
<td style="text-align: left">25</td>
<td style="text-align: left">00011001</td>
<td style="text-align: left">0x19</td>
<td style="text-align: left">Z</td>
<td style="text-align: left">Z</td>
<td style="text-align: left">57</td>
<td style="text-align: left">00111001</td>
<td style="text-align: left">0x39</td>
<td style="text-align: left">5</td>
<td style="text-align: left">5</td>
</tr>
<tr>
<td style="text-align: left">26</td>
<td style="text-align: left">00011010</td>
<td style="text-align: left">0x1A</td>
<td style="text-align: left">a</td>
<td style="text-align: left">a</td>
<td style="text-align: left">58</td>
<td style="text-align: left">00111010</td>
<td style="text-align: left">0x3A</td>
<td style="text-align: left">6</td>
<td style="text-align: left">6</td>
</tr>
<tr>
<td style="text-align: left">27</td>
<td style="text-align: left">00011011</td>
<td style="text-align: left">0x1B</td>
<td style="text-align: left">b</td>
<td style="text-align: left">b</td>
<td style="text-align: left">59</td>
<td style="text-align: left">00111011</td>
<td style="text-align: left">0x3B</td>
<td style="text-align: left">7</td>
<td style="text-align: left">7</td>
</tr>
<tr>
<td style="text-align: left">28</td>
<td style="text-align: left">00011100</td>
<td style="text-align: left">0x1C</td>
<td style="text-align: left">c</td>
<td style="text-align: left">c</td>
<td style="text-align: left">60</td>
<td style="text-align: left">00111100</td>
<td style="text-align: left">0x3C</td>
<td style="text-align: left">8</td>
<td style="text-align: left">8</td>
</tr>
<tr>
<td style="text-align: left">29</td>
<td style="text-align: left">00011101</td>
<td style="text-align: left">0x1D</td>
<td style="text-align: left">d</td>
<td style="text-align: left">d</td>
<td style="text-align: left">61</td>
<td style="text-align: left">00111101</td>
<td style="text-align: left">0x3D</td>
<td style="text-align: left">9</td>
<td style="text-align: left">9</td>
</tr>
<tr>
<td style="text-align: left">30</td>
<td style="text-align: left">00011110</td>
<td style="text-align: left">0x1E</td>
<td style="text-align: left">e</td>
<td style="text-align: left">e</td>
<td style="text-align: left">62</td>
<td style="text-align: left">00111110</td>
<td style="text-align: left">0x3E</td>
<td style="text-align: left">+</td>
<td style="text-align: left">-</td>
</tr>
<tr>
<td style="text-align: left">31</td>
<td style="text-align: left">00011111</td>
<td style="text-align: left">0x1F</td>
<td style="text-align: left">f</td>
<td style="text-align: left">f</td>
<td style="text-align: left">63</td>
<td style="text-align: left">00111111</td>
<td style="text-align: left">0x3F</td>
<td style="text-align: left">/</td>
<td style="text-align: left">_</td>
</tr>
<tr>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
<td style="text-align: left">pad</td>
<td style="text-align: left">n/a</td>
<td style="text-align: left">n/a</td>
<td style="text-align: left">=</td>
<td style="text-align: left">n/a</td>
</tr>
</tbody>
</table>

<h1>
<span id="実装" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>実装</h1>

<h2>
<span id="-base64--base64urlの相互変換" class="fragment"></span><a href="#-base64--base64url%E3%81%AE%E7%9B%B8%E4%BA%92%E5%A4%89%E6%8F%9B"><i class="fa fa-link"></i></a>① BASE64 ⇔ BASE64URLの相互変換</h2>

<ul>
<li>BASE64 Safe URL Convert.(Java) | Online editor and compiler</li>
</ul>

<p><qiita-embed-ogp src="https://paiza.io/projects/RsG1DKW3KU3gzcvttD8wKQ"></qiita-embed-ogp></p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">変換.java</span></div>
<div class="highlight"><pre><code><span class="cm">/**
 * URL安全なBASE64に変換.
 *
 * @param base64
 * @return base64url
 */</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">convertBase64SafeUrl</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">base64</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">base64</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">base64</span><span class="o">;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"\\+"</span><span class="o">,</span> <span class="s">"-"</span><span class="o">);</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"\\/"</span><span class="o">,</span> <span class="s">"_"</span><span class="o">);</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"=+$"</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">ret</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="cm">/**
 * 通常 (URL非安全) のBASE64に変換.
 *
 * @param base64url
 * @return base64
 */</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">convertBase64UnSafeUrl</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">base64url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">base64url</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">base64url</span><span class="o">;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"-"</span><span class="o">,</span> <span class="s">"+"</span><span class="o">);</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"_"</span><span class="o">,</span> <span class="s">"/"</span><span class="o">);</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="s">"==="</span><span class="o">;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="o">((</span><span class="n">ret</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">/</span> <span class="mi">4</span><span class="o">)</span> <span class="o">*</span> <span class="mi">4</span><span class="o">));</span>
        <span class="k">return</span> <span class="n">ret</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">変換結果</span></div>
<div class="highlight"><pre><code>url safe   :8KCut/CfpJTwn42G8J+RjQ== (24)  &gt;&gt;&gt;&gt;  8KCut_CfpJTwn42G8J-RjQ (22)
url unsafe :8KCut_CfpJTwn42G8J-RjQ (22)  &gt;&gt;&gt;&gt;  8KCut/CfpJTwn42G8J+RjQ== (24)

url safe   :01234=== (8)  &gt;&gt;&gt;&gt;  01234 (5)
url safe   :012345== (8)  &gt;&gt;&gt;&gt;  012345 (6)
url safe   :0123456= (8)  &gt;&gt;&gt;&gt;  0123456 (7)
url safe   :01234567 (8)  &gt;&gt;&gt;&gt;  01234567 (8)
url safe   :a+/b==a+/b++a+/b//a+/b==a+/b==a+/b== (36)  &gt;&gt;&gt;&gt;  a-_b==a-_b--a-_b__a-_b==a-_b==a-_b (34)
url safe   :a+/b==a+/b++a+/b//a+/b==a+/b==a+/b (34)  &gt;&gt;&gt;&gt;  a-_b==a-_b--a-_b__a-_b==a-_b==a-_b (34)

url unsafe :01234 (5)  &gt;&gt;&gt;&gt;  01234=== (8)
url unsafe :012345 (6)  &gt;&gt;&gt;&gt;  012345== (8)
url unsafe :0123456 (7)  &gt;&gt;&gt;&gt;  0123456= (8)
url unsafe :01234567 (8)  &gt;&gt;&gt;&gt;  01234567 (8)
url unsafe :012345678 (9)  &gt;&gt;&gt;&gt;  012345678=== (12)
url unsafe :a-_b==a-_b--a-_b__a-_b==a-_b==a-_b (34)  &gt;&gt;&gt;&gt;  a+/b==a+/b++a+/b//a+/b==a+/b==a+/b== (36)
url unsafe :a-_b==a-_b--a-_b__a-_b==a-_b==a-_b (34)  &gt;&gt;&gt;&gt;  a+/b==a+/b++a+/b//a+/b==a+/b==a+/b== (36)
url unsafe :?*+/-_=== (9)  &gt;&gt;&gt;&gt;  ?*+/+/====== (12)
</code></pre></div>
</div>

<p>文字列途中にある <code>=</code> については、そもそものルール違反のため、関知しない。<br>
BASE64の文字についても、そもそものルール違反のため、関知しない。<br>
元々末尾に <code>=</code> がついていた場合も、関知せずパディングを行う。</p>

<h2>
<span id="-base64のencodedecode" class="fragment"></span><a href="#-base64%E3%81%AEencodedecode"><i class="fa fa-link"></i></a>② BASE64のEncode/Decode</h2>

<h1>
<span id="step-とりあえずbyte配列をbase64にするコードを作ってみる" class="fragment"></span><a href="#step-%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9Abyte%E9%85%8D%E5%88%97%E3%82%92base64%E3%81%AB%E3%81%99%E3%82%8B%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>STEP① とりあえずBYTE配列をBASE64にするコードを作ってみる。</h1>

<p>とりあえず、書いてみた。</p>

<ul>
<li>
<code>6bitごとにbyte配列を整形する</code> 処理と <code>文字列化するコード</code> を分けて記述。</li>
<li>進数変換と同様の考え方。<code>今回のbit</code> を <code>bit mask</code> で抽出し、<code>前回余ったbit</code> とを論理和で合成する。</li>
<li>
<code>今回余ったbit</code> は 左シフトし、不用bitを落としておき、次回に持ち越す。</li>
<li>今回取り出すbitの右シフト量 ( <code>v</code> ) は <code>2</code>, <code>4</code>, <code>6</code> の3パターン。 (⇒ <code>(((i % 3) + 1) * 2)</code> )</li>
<li>次回に持ち越すbitの左シフト量は右シフト量 ( <code>v</code> ) に応じて求められ、 <code>4</code>, <code>2</code>, <code>0</code> の3パターン。 (⇒ <code>(6 - v)</code> )

<ul>
<li>上位2bitは落としておく。 左シフトのため下位bitは無視して良い。</li>
</ul>
</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">6bitごとにbyte配列を整形するメソッド</span></div>
<div class="highlight"><pre><code><span class="k">public</span> <span class="k">static</span> <span class="kt">byte</span><span class="p">[]</span> <span class="nf">convert6bitBinary</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">data</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kt">byte</span> <span class="n">mod</span> <span class="p">=</span> <span class="m">0x00</span><span class="p">;</span>
        <span class="n">List</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;</span> <span class="n">list</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;();</span>
        <span class="kt">byte</span><span class="p">[]</span> <span class="n">lowMaskList</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[]</span> <span class="p">{</span>
            <span class="m">0x3F</span><span class="p">,</span> <span class="c1">// [0] 00111111</span>
            <span class="m">0x0F</span><span class="p">,</span> <span class="c1">// [1] 00001111</span>
            <span class="m">0x03</span><span class="p">,</span> <span class="c1">// [2] 00000011</span>
        <span class="p">};</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="n">i</span> <span class="p">%</span> <span class="m">3</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">v</span> <span class="p">=</span> <span class="p">((</span><span class="n">j</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span> <span class="p">*</span> <span class="m">2</span><span class="p">);</span>
            <span class="kt">byte</span> <span class="n">lowMask</span> <span class="p">=</span> <span class="n">lowMaskList</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
            <span class="kt">byte</span> <span class="n">b0</span> <span class="p">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="kt">byte</span> <span class="n">b6</span> <span class="p">=</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)(</span><span class="n">mod</span> <span class="p">|</span> <span class="p">(</span><span class="n">lowMask</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">b0</span> <span class="p">&gt;&gt;</span> <span class="n">v</span><span class="p">)));</span>

            <span class="n">list</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">b6</span><span class="p">);</span>

            <span class="n">mod</span> <span class="p">=</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)(</span><span class="m">0x3F</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">b0</span> <span class="p">&lt;&lt;</span> <span class="p">(</span><span class="m">6</span> <span class="p">-</span> <span class="n">v</span><span class="p">)));</span>
            <span class="k">if</span><span class="p">(</span><span class="n">j</span> <span class="p">==</span> <span class="m">2</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">list</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">mod</span><span class="p">);</span>
                <span class="n">mod</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">((</span><span class="n">data</span><span class="p">.</span><span class="n">Length</span> <span class="p">%</span> <span class="m">3</span><span class="p">)</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">list</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">mod</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">list</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">文字列化するコード</span></div>
<div class="highlight"><pre><code><span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">ToBase64</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">data</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isUrlSafe</span> <span class="p">=</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="n">data</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">string</span> <span class="n">base64_map</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isUrlSafe</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">base64_map</span> <span class="p">=</span> <span class="n">BASE64_MAP_URLSAFE</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">base64_map</span> <span class="p">=</span> <span class="n">BASE64_MAP_BASIC</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">foreach</span><span class="p">(</span><span class="kt">byte</span> <span class="n">b</span> <span class="k">in</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">base64_map</span><span class="p">[</span><span class="n">b</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(!</span><span class="n">isUrlSafe</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">max</span><span class="p">;</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"==="</span><span class="p">);</span>
            <span class="n">max</span> <span class="p">=</span> <span class="p">(</span><span class="n">sb</span><span class="p">.</span><span class="n">Length</span> <span class="p">/</span> <span class="m">4</span><span class="p">)</span> <span class="p">*</span> <span class="m">4</span><span class="p">;</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">max</span><span class="p">,</span> <span class="n">sb</span><span class="p">.</span><span class="n">Length</span> <span class="p">-</span> <span class="n">max</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h1>
<span id="step-4文字ごと-に着目した処理を考え実装する" class="fragment"></span><a href="#step-4%E6%96%87%E5%AD%97%E3%81%94%E3%81%A8-%E3%81%AB%E7%9D%80%E7%9B%AE%E3%81%97%E3%81%9F%E5%87%A6%E7%90%86%E3%82%92%E8%80%83%E3%81%88%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>STEP② <code>4文字ごと</code> に着目した処理を考え実装する。</h1>

<p>BASE64は比較的古くからある仕様であり、展開や実装の容易さと言うのも兼ね備えていたと考える。なので、 <strong><code>=</code> を用いたパディング</strong> は何のために必要なのか疑問語を覚えるが。これは逆説的に、<strong><code>4文字ごと</code> に作業を行うことで、最適化が行える</strong> を可能性を感じられる。特に <code>4文字</code> で表現される <code>24 bit</code> は <code>8</code> と <code>6</code> の <code>最小公倍数</code> である。即ち、<strong><code>3byte</code> ずつ <code>4文字</code> にする</strong> のである。この程度であれば、下手にベタ書きしたした方が可読性もあり、 <code>if文</code> も減り、高速化が望めそうである。そんな訳で、処理を見直して、Encode処理とDecode処理を組み直してみる。</p>

<p>※ 現在のPCのCPUは計算機の発展であり、計算が得意で条件分岐が苦手である。レガシーなPCでは限られたリソースで速度を得るため、条件分岐を省き効率よく処理を作る必要性が高かった。</p>

<h2>
<span id="encode-base64化" class="fragment"></span><a href="#encode-base64%E5%8C%96"><i class="fa fa-link"></i></a>Encode (BASE64化)</h2>

<ul>
<li>3byteずつ、 <code>int配列[3]</code> にコピーする。byteの長さを超えた場合は、<strong>9bit目だけが立っている <code>0x0100</code></strong> にする。</li>
<li>
<code>int配列[3]</code> から <code>byte配列[4]</code> 6bitずつ格納していく。

<ul>
<li>(1) <code>int配列[n]の9bit目</code> を <code>byte配列[n]の7bit目</code> に論理和。<br>
※ <strong>6bitに伸長した場合は7-8bit目は使わないので、存在しないバイトはbitを立てて64以上の値にする。</strong>
</li>
<li>(2) 上位ビットはカレントとして <code>int配列[n]の該当bit</code> を <code>byte配列[n - 1]の該当bit</code> へ <code>左シフト + マスク (抽出)</code> して 論理和</li>
<li>(3) 下位ビットは不足分として <code>int配列[n - 1]の該当bit</code> を <code>byte配列[n - 1]の該当bit</code> へ <code>右シフト + マスク (抽出)</code> して 論理和</li>
<li>存在するバイト値は <code>0 ~ 63</code> の値になる。<br>
※ <strong><code>0x0100</code> の下位8bitが0なので、不足分で使われても問題ない。</strong>
</li>
<li>存在しないバイト値は <code>64</code> の値になる。<br>
※ <strong>これも、<code>0x0100</code> の効果。</strong> </li>
</ul>
</li>
<li>
<code>byte配列</code> の値を文字化して格納。

<ul>
<li>通常の <code>BASE64</code> では変換表の <code>64番目</code> に <code>=</code> を入れておき、条件分岐無くパディング行う。</li>
<li>URL安全の <code>BASE64 URL</code> 場合は、<code>64番目</code> 以上はスキップします。</li>
</ul>
</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">encode処理抜粋</span></div>
<div class="highlight"><pre><code><span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">BASE64_MAP_BASIC</span>   <span class="p">=</span> <span class="s">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="</span><span class="p">;</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">BASE64_MAP_URLSAFE</span> <span class="p">=</span> <span class="s">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"</span><span class="p">;</span>

<span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">encode</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">data</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isUrlSafe</span> <span class="p">=</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span> <span class="p">+=</span> <span class="m">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span><span class="p">[]</span> <span class="n">src</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">3</span><span class="p">];</span>
        <span class="kt">byte</span><span class="p">[]</span> <span class="n">tgt</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="m">4</span><span class="p">];</span>

        <span class="c1">//copy or default.</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="m">3</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">k</span> <span class="p">=</span> <span class="n">i</span> <span class="p">+</span> <span class="n">j</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">k</span> <span class="p">&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">src</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">//(bit: 0001 0000)</span>
                <span class="n">src</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="m">0x0100</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// reformat.</span>
        <span class="n">tgt</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)((</span><span class="m">0x00</span><span class="p">)</span>                 <span class="p">|</span> <span class="p">(</span><span class="m">0x00</span><span class="p">)</span>                 <span class="p">|</span> <span class="p">(</span><span class="m">0x3F</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">&gt;&gt;</span> <span class="m">2</span><span class="p">)));</span>
        <span class="n">tgt</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)((</span><span class="m">0x00</span><span class="p">)</span>                 <span class="p">|</span> <span class="p">(</span><span class="m">0x3F</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">&lt;&lt;</span> <span class="m">4</span><span class="p">))</span> <span class="p">|</span> <span class="p">(</span><span class="m">0x0F</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">&gt;&gt;</span> <span class="m">4</span><span class="p">)));</span>
        <span class="n">tgt</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)((</span><span class="m">0x40</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">&gt;&gt;</span> <span class="m">2</span><span class="p">))</span> <span class="p">|</span> <span class="p">(</span><span class="m">0x3F</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">&lt;&lt;</span> <span class="m">2</span><span class="p">))</span> <span class="p">|</span> <span class="p">(</span><span class="m">0x03</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">&gt;&gt;</span> <span class="m">6</span><span class="p">)));</span>
        <span class="n">tgt</span><span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)((</span><span class="m">0x40</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">&gt;&gt;</span> <span class="m">2</span><span class="p">))</span> <span class="p">|</span> <span class="p">(</span><span class="m">0x3F</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">&lt;&lt;</span> <span class="m">0</span><span class="p">))</span> <span class="p">|</span> <span class="p">(</span><span class="m">0x00</span><span class="p">));</span>

        <span class="c1">// to character.</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isUrlSafe</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">foreach</span><span class="p">(</span><span class="kt">byte</span> <span class="n">b</span> <span class="k">in</span> <span class="n">tgt</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">b</span> <span class="p">&lt;</span> <span class="m">0x40</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">BASE64_MAP_URLSAFE</span><span class="p">[</span><span class="n">b</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">BASE64_MAP_BASIC</span><span class="p">[</span><span class="n">tgt</span><span class="p">[</span><span class="m">0</span><span class="p">]]);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">BASE64_MAP_BASIC</span><span class="p">[</span><span class="n">tgt</span><span class="p">[</span><span class="m">1</span><span class="p">]]);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">BASE64_MAP_BASIC</span><span class="p">[</span><span class="n">tgt</span><span class="p">[</span><span class="m">2</span><span class="p">]]);</span>
            <span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">BASE64_MAP_BASIC</span><span class="p">[</span><span class="n">tgt</span><span class="p">[</span><span class="m">3</span><span class="p">]]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>結構条件分岐が減って、良い感じ。また、符号化には最低でも2文字必要になるため、1-2文字目用のパディング判定処理は省いている。</p>

<h2>
<span id="decode-base64からの復号" class="fragment"></span><a href="#decode-base64%E3%81%8B%E3%82%89%E3%81%AE%E5%BE%A9%E5%8F%B7"><i class="fa fa-link"></i></a>Decode (BASE64からの復号)</h2>

<p>通常の <code>BASE64</code> と URL安全の <code>BASE64 URL</code> どちらでも復号ができる様にしている。</p>

<ul>
<li>
<code>文字列</code> から <code>byte配列[4]</code> に値を格納する。存在しないbyte値は、<code>64</code> にする。

<ul>
<li>通常の <code>BASE64</code> では変換表の <code>64番目</code> に <code>=</code> を入れておき、こちらも <code>64</code> になる。</li>
<li>値が見つからなかった時は、URL安全の <code>BASE64 URL</code> の変換表も探索し、<code>-</code> <code>_</code> を補完する。</li>
</ul>
</li>
<li>
<code>byte配列[4]</code> から <code>int配列[3]</code> へ 8bitずつ格納していく。

<ul>
<li>(1) <code>byte配列[n + 1]の7bit目</code> を <code>int配列[n]の9bit目</code> に論理和。<br>
</li>
<li>(2) 上位ビットはカレントとして <code>byte配列[n]の該当bit</code> を <code>int配列[n]の該当bit</code> へ <code>左シフト + マスク (抽出)</code> して 論理和</li>
<li>(3) 下位ビットは不足分として <code>byte配列[n + 1]の該当bit</code> を <code>int配列[n]の該当bit</code> へ <code>右シフト + マスク (抽出)</code> して 論理和</li>
<li>存在するバイト値の場合 <strong>byteの範囲を内の <code>0 ~ 255</code></strong> の値になり、バイナリに追加する。</li>
<li>存在しないバイト値の場合、<strong>byteの範囲を超えた <code>256 (0x0100)</code></strong> の値になり、バイナリに追加しない。</li>
</ul>
</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">decode処理抜粋</span></div>
<div class="highlight"><pre><code><span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">BASE64_MAP_BASIC</span>   <span class="p">=</span> <span class="s">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="</span><span class="p">;</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">BASE64_MAP_URLSAFE</span> <span class="p">=</span> <span class="s">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"</span><span class="p">;</span>

<span class="k">public</span> <span class="k">static</span> <span class="kt">byte</span><span class="p">[]</span> <span class="nf">decode</span><span class="p">(</span><span class="kt">string</span> <span class="n">base64</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;</span> <span class="n">list</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;();</span>

    <span class="k">if</span><span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">base64</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">base64</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span> <span class="p">+=</span><span class="m">4</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">src</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="m">4</span><span class="p">];</span>
            <span class="kt">int</span><span class="p">[]</span> <span class="n">tgt</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">3</span><span class="p">];</span>

            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="m">4</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">k</span> <span class="p">=</span> <span class="n">i</span> <span class="p">+</span> <span class="n">j</span><span class="p">;</span>
                <span class="kt">byte</span> <span class="n">code</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">k</span> <span class="p">&lt;</span> <span class="n">base64</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kt">char</span> <span class="n">c</span> <span class="p">=</span> <span class="n">base64</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
                    <span class="kt">int</span> <span class="n">index</span> <span class="p">=</span> <span class="n">BASE64_MAP_BASIC</span><span class="p">.</span><span class="nf">IndexOf</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">index</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">index</span> <span class="p">=</span> <span class="n">BASE64_MAP_URLSAFE</span><span class="p">.</span><span class="nf">IndexOf</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="n">code</span> <span class="p">=</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)</span><span class="n">index</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">// 01000000 (64)</span>
                    <span class="n">code</span> <span class="p">=</span> <span class="m">0x40</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">src</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="n">code</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">tgt</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="m">0x00</span><span class="p">)</span>                   <span class="p">|</span> <span class="p">(</span><span class="m">0xFC</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">&lt;&lt;</span> <span class="m">2</span><span class="p">))</span> <span class="p">|</span> <span class="p">(</span><span class="m">0x03</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">&gt;&gt;</span> <span class="m">4</span><span class="p">));</span>
            <span class="n">tgt</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="m">0xFF00</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">&lt;&lt;</span> <span class="m">2</span><span class="p">))</span> <span class="p">|</span> <span class="p">(</span><span class="m">0xF0</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">&lt;&lt;</span> <span class="m">4</span><span class="p">))</span> <span class="p">|</span> <span class="p">(</span><span class="m">0x0F</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">&gt;&gt;</span> <span class="m">2</span><span class="p">));</span>
            <span class="n">tgt</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="m">0xFF00</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="p">&lt;&lt;</span> <span class="m">2</span><span class="p">))</span> <span class="p">|</span> <span class="p">(</span><span class="m">0xC0</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">&lt;&lt;</span> <span class="m">6</span><span class="p">))</span> <span class="p">|</span> <span class="p">(</span><span class="m">0x3F</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="p">&gt;&gt;</span> <span class="m">0</span><span class="p">));</span>

            <span class="k">foreach</span><span class="p">(</span><span class="kt">int</span> <span class="n">val</span> <span class="k">in</span> <span class="n">tgt</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">val</span> <span class="p">&lt;</span> <span class="m">0xFF</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">list</span><span class="p">.</span><span class="nf">Add</span><span class="p">((</span><span class="kt">byte</span><span class="p">)</span><span class="n">val</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">list</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>こちらも変換表の64番目に <code>=</code> を追加して64以上を使うことで、処理を少し簡略化出来ている感がある。<br>
また、復号には最低でも2文字必要になるため、1byte目の復号には存在チェック用のbit処理を省いている。</p>

<p><a href="https://camo.qiitausercontent.com/8f59004925d4e4ccd5486a805df5006072790c78/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f37323235372f39343939336531622d666438642d663930392d333237382d6163356163303132396664322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F72257%2F94993e1b-fd8d-f909-3278-ac5ac0129fd2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=288e13aae38ba9e70515dfdbab536790" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/72257/94993e1b-fd8d-f909-3278-ac5ac0129fd2.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F72257%2F94993e1b-fd8d-f909-3278-ac5ac0129fd2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2da09d4bd221568a449681c08c54eb39 1x" loading="lazy"></a><br>
本来 <code>=</code> 前の文字の場合は更にその前の余りを含んでいるので、</p>

<ul>
<li>1文字の場合 ⇒ BASE64上ありえない  <del>(<code>=</code> で3文字パディング。)</del>
</li>
<li>2文字の場合 ⇒ <strong><code>=</code> の 前の文字の下位4bitが0</strong> (<code>=</code> で2文字パディング。)</li>
<li>3文字の場合 ⇒ <strong><code>=</code> の 前の文字の下位2bitが0</strong> (<code>=</code> で1文字パディング。)</li>
<li>4文字の場合 ⇒ 余りなし (<code>=</code> でパディングする必要もなし。)</li>
</ul>

<p>な感じになる。</p>

<h2>
<span id="実行例" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E4%BE%8B"><i class="fa fa-link"></i></a>実行例</h2>

<ul>
<li>BASE64 scrap (C#) | Online editor and compiler</li>
</ul>

<p><qiita-embed-ogp src="https://paiza.io/projects/yBRImZbpO-rBtQWp23pONw"></qiita-embed-ogp></p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">実行例抜粋</span></div>
<div class="highlight"><pre><code>// check strs[0]-------------------------------------------------------
  #source
    str        : Hellow C#
    bin  (hex) : 48 65 6C 6C 6F 77 20 43 23
    bin  (bit) : 01001000 01100101 01101100 01101100 01101111 01110111 00100000 01000011 00100011

  #encode
    base64     : SGVsbG93IEMj
    base64url  : SGVsbG93IEMj

  #decode (basic) SGVsbG93IEMj
    bin  (hex) : 48 65 6C 6C 6F 77 20 43 23
    bin  (bit) : 01001000 01100101 01101100 01101100 01101111 01110111 00100000 01000011 00100011
    str        : Hellow C#

  #decode (urlsafe) SGVsbG93IEMj
    bin  (hex) : 48 65 6C 6C 6F 77 20 43 23
    bin  (bit) : 01001000 01100101 01101100 01101100 01101111 01110111 00100000 01000011 00100011
    str        : Hellow C#

// check strs[1]-------------------------------------------------------
  #source
    str        : BASE64-
    bin  (hex) : 42 41 53 45 36 34 2D
    bin  (bit) : 01000010 01000001 01010011 01000101 00110110 00110100 00101101

  #encode
    base64     : QkFTRTY0LQ==
    base64url  : QkFTRTY0LQ

  #decode (basic) QkFTRTY0LQ==
    bin  (hex) : 42 41 53 45 36 34 2D
    bin  (bit) : 01000010 01000001 01010011 01000101 00110110 00110100 00101101
    str        : BASE64-

  #decode (urlsafe) QkFTRTY0LQ
    bin  (hex) : 42 41 53 45 36 34 2D
    bin  (bit) : 01000010 01000001 01010011 01000101 00110110 00110100 00101101
    str        : BASE64-

// check strs[2]-------------------------------------------------------
  #source
    str        : 𠮷🤔🍆👍
    bin  (hex) : F0 A0 AE B7 F0 9F A4 94 F0 9F 8D 86 F0 9F 91 8D
    bin  (bit) : 11110000 10100000 10101110 10110111 11110000 10011111 10100100 10010100 11110000 10011111 10001101 10000110 11110000 10011111 10010001 10001101

  #encode
    base64     : 8KCut/CfpJTwn42G8J+RjQ==
    base64url  : 8KCut_CfpJTwn42G8J-RjQ

  #decode (basic) 8KCut/CfpJTwn42G8J+RjQ==
    bin  (hex) : F0 A0 AE B7 F0 9F A4 94 F0 9F 8D 86 F0 9F 91 8D
    bin  (bit) : 11110000 10100000 10101110 10110111 11110000 10011111 10100100 10010100 11110000 10011111 10001101 10000110 11110000 10011111 10010001 10001101
    str        : 𠮷🤔🍆👍

  #decode (urlsafe) 8KCut_CfpJTwn42G8J-RjQ
    bin  (hex) : F0 A0 AE B7 F0 9F A4 94 F0 9F 8D 86 F0 9F 91 8D
    bin  (bit) : 11110000 10100000 10101110 10110111 11110000 10011111 10100100 10010100 11110000 10011111 10001101 10000110 11110000 10011111 10010001 10001101
    str        : 𠮷🤔🍆👍

// check 1st impl.
encode : 6A 05 39 =&gt; agU5
encode : 6A 05    =&gt; agU=
encode : 6A       =&gt; ag==
encode : 6A 05 39 =&gt; agU5
encode : 6A 05    =&gt; agU
encode : 6A       =&gt; ag
decode : agU5 =&gt; 6A 05 39
decode : agU= =&gt; 6A 05
decode : ag== =&gt; 6A
decode : a=== =&gt; 
decode : agU5 =&gt; 6A 05 39
decode : agU =&gt; 6A 05
decode : ag =&gt; 6A
decode : a =&gt; 

// check 2nd impl.
encode : 6A 05 39 =&gt; agU5
encode : 6A 05    =&gt; agU=
encode : 6A       =&gt; ag==
encode : 6A 05 39 =&gt; agU5
encode : 6A 05    =&gt; agU
encode : 6A       =&gt; ag
decode : agU5 =&gt; 6A 05 39
decode : agU= =&gt; 6A 05
decode : ag== =&gt; 6A
decode : a=== =&gt; 
decode : agU5 =&gt; 6A 05 39
decode : agU =&gt; 6A 05
decode : ag =&gt; 6A
decode : a =&gt; 
</code></pre></div>
</div>

<h1>
<span id="base64url-の活用法" class="fragment"></span><a href="#base64url-%E3%81%AE%E6%B4%BB%E7%94%A8%E6%B3%95"><i class="fa fa-link"></i></a>BASE64URL の活用法</h1>

<p>私が今回使おうと思った背景では、Servlet のWEBアプリケーションで <strong>ChromeのAcrobat拡張</strong> を利用するために、リクエストをURLに再現性のない <code>POST</code> から再現性のある <code>GET</code> に変更しようと思ったのがある。パラメータは複数あり、あまり生で見せたくないというのもあり、全パラメータをまとめて <code>BASE64</code> での <code>シリアライズ</code> を行うことにした。</p>

<p><strong>ChromeのAcrobat拡張</strong> ではURLを再度開いているだけのため、再現性のあるURLである必要がある。これはfirefoxで内蔵ビューアで開いたPDFをオンザフライでAdobeReaderなどに開かせる際も同様かと思う。</p>

<p>GETによるアプリケーション連携が増えている昨今。一時的なリクエストにせよ、GET化することのメリットがそれなりに出てきている。</p>

<p>と言うか、私は <code>パーマネント リンク大好きマン</code> なので参照メインのサイトで <code>パーマネント リンク</code> 取れない時に結構キレてます。えぇ、最近のアニメ公式サイトとか多いですね。。。すっごいゴテゴテで、友人にshareしようとしたら、 <code>パーマネント リンク</code> が取れなくてTOPページしか送れないこととか。。。</p>

<p><del><a href="http://penguin-empire.com/" rel="nofollow noopener" target="_blank">ダイミダラーの公式サイト</a> を見習って欲しい</del></p>

<p>(そういう意味ではFLASHが死に絶えたのはほんと、良かったのかも知れない。FLASHだけで作ってるサイトも度々あったので)</p>

<h1>
<span id="パーセント-エンコーディング-や-uri-エンコーディング-じゃダメだったのか-thinking" class="fragment"></span><a href="#%E3%83%91%E3%83%BC%E3%82%BB%E3%83%B3%E3%83%88-%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-%E3%82%84-uri-%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-%E3%81%98%E3%82%83%E3%83%80%E3%83%A1%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%8B-thinking"><i class="fa fa-link"></i></a><code>パーセント エンコーディング</code> や <code>URI エンコーディング</code> じゃダメだったのか？ <img alt=":thinking:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f914.png" title=":thinking:" width="20" loading="lazy">
</h1>

<p><code>パーセント エンコーディング</code> 及び <code>URI エンコーディング</code>はどんな文字列にもエンコード/デコードを処理をかけることができ、符号化/復号化がブラウザやWEBサーバーのリクエスト処理に含まれてしまっている。そのため、間に認証ページなどでジャンプが挟まる様な場合、ジャンプ数を加味して多重で<code>パーセント エンコーディング</code>をかけたりする必要がある場合がある。特に <code>=</code> が含まれている場合には、多段でジャンプ中にQueryStringとして前のページでのパラメータとして喰われてしまい、自分のページに届かない、なんてこともある。<code>BASE64</code> の場合は <code>+</code> <code>/</code> により、多段ジャンプ自体が阻害される場合もある。</p>

<p><code>BASE64URL</code> では自分で展開処理を行わなければいけないデメリット自体がそのままメリットとなり、他のページとの競合を避けることができる。誰も勝手に復号したりしないので、最後までそのまま自分のところに届く。</p>

<p>多段ジャンプ(笑) と思うこともあるかも知れないが。案外Twittterの認証など色々画面見てても、結構パラメーターを引きずっていることが多くあると思い、そんなにマイノリティでは無いかと思う。</p>

<p>HTTPのリクエストのセキュリティは、<code>GET</code> 以上のものが <code>POST</code> で得られるもんでも無いと思うので、もっと別の形で確保してください。<br>
(だから認証でも <code>GET</code> を使っているのでしょう。)</p>

<h1>
<span id="総括" class="fragment"></span><a href="#%E7%B7%8F%E6%8B%AC"><i class="fa fa-link"></i></a>総括</h1>

<p>ベンチマークは取らないが、BASE64の実装をして理解を深めることが出来たと思います。とてもシンプルなロジックなので、一度自分で書いてみるのは、bit演算の訓練にもなって良いかと思った。あと、行数によってはベタに書くことも悪く無く、今回の <code>BASE64</code> もその類なのかと思う。</p>

<p>なお、JavaとC#が混在しているのは単に気分です。( 当方、<code>final教信者</code> の <code>C#er</code> です )。</p>

<h1>
<span id="参考-謝辞" class="fragment"></span><a href="#%E5%8F%82%E8%80%83-%E8%AC%9D%E8%BE%9E"><i class="fa fa-link"></i></a>参考 (謝辞)</h1>

<ul>
<li><p>Base64 - Wikipedia<br>
<a href="https://ja.wikipedia.org/wiki/Base64" class="autolink" rel="nofollow noopener" target="_blank">https://ja.wikipedia.org/wiki/Base64</a></p></li>
<li><p>RFC 4648 - The Base16, Base32, and Base64 Data Encodings<br>
<a href="https://tools.ietf.org/html/rfc4648" class="autolink" rel="nofollow noopener" target="_blank">https://tools.ietf.org/html/rfc4648</a></p></li>
</ul>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Flibraplanet%2Fitems%2F8e4b51371948850060c1&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Flibraplanet%2Fitems%2F8e4b51371948850060c1&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/libraplanet/items/8e4b51371948850060c1/likers" class="css-1iupg5d">1</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">0</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/8e4b51371948850060c1/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/libraplanet/items/8e4b51371948850060c1/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/libraplanet/items/8e4b51371948850060c1/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/libraplanet/items/8e4b51371948850060c1/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/libraplanet/items/8e4b51371948850060c1.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-e7f0aefd-7bb5-465d-b197-268cbfed8a9b">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-5627df49-7e6a-464f-991c-6fd934102b61"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-5627df49-7e6a-464f-991c-6fd934102b61">{}</script>
      
<div id="LoginModal-react-component-2798c556-aff5-4779-ac70-e1356cd08e83"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-2798c556-aff5-4779-ac70-e1356cd08e83">{}</script>
      
<div id="StockModal-react-component-72285b67-a56c-49d7-b131-a98c9f26fd50"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-72285b67-a56c-49d7-b131-a98c9f26fd50">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;zw3mdVuyCDylGJOmigi6JLKUpk0095o4Ldv7bxC/V7eeYJhHoJ79aXnCa04a9MDqaNxqdK3wGb3P29iX6AsE3Q==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"あのurlで見たbase64の名前を僕達はまだ知らない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%82%E3%81%AEurl%E3%81%A7%E8%A6%8B%E3%81%9Fbase64%E3%81%AE%E5%90%8D%E5%89%8D%E3%82%92%E5%83%95%E9%81%94%E3%81%AF%E3%81%BE%E3%81%A0%E7%9F%A5%E3%82%89%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eあのURLで見たBASE64の名前を僕達はまだ知らない。\u003c/h1\u003e\n\n\u003cp\u003eあれは \u003ccode\u003eBASE64URL Encoding\u003c/code\u003e と言うらしい。\u003cbr\u003e\n(どれだよ)\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eBase64#変形版 - Wikipedia\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://ja.wikipedia.org/wiki/Base64#%E5%A4%89%E5%BD%A2%E7%89%88\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eURLアプリケーションのための変形 Base64\u003cbr\u003e\n('base64url' encoding)\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003eBASE64\u003c/code\u003e でエンコードした文字列には、 \u003ccode\u003eURL\u003c/code\u003e 上で意味を持つ \u003ccode\u003e+\u003c/code\u003e 、 \u003ccode\u003e/\u003c/code\u003e 、 \u003ccode\u003e=\u003c/code\u003e が含まれている。そのため  \u003ccode\u003eURL\u003c/code\u003e で利用するためには工夫が必要である。\u003ccode\u003eBASE64\u003c/code\u003e には \u003cstrong\u003e\u003ccode\u003eBASE64URL Encoding\u003c/code\u003e\u003c/strong\u003e と言う変形版が公式仕様にあり、\u003ccode\u003eURL Encoding\u003c/code\u003e や \u003ccode\u003ePercent Encoding\u003c/code\u003e よりも、URL上で利用するには都合が良い様に感じた。\u003c/p\u003e\n\n\u003cp\u003e今回WEBアプリで \u003ccode\u003eBASE64URL Encoding\u003c/code\u003e を扱うにあたり、ついでに \u003ccode\u003eBASE64\u003c/code\u003e の自体も実装をしてみようと思い、やってみた、そんな話。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"base64の解説\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#base64%E3%81%AE%E8%A7%A3%E8%AA%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBASE64の解説\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"-base64-original\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-base64-original\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e① BASE64 (original)\u003c/h2\u003e\n\n\u003cp\u003e読んでみると超シンプルな代物。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eBase64 - Wikipedia\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://ja.wikipedia.org/wiki/Base64\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eバイナリ全体をbitの配列 (bit stream) として捉え、\u003cstrong\u003e6bit\u003c/strong\u003e ずつ区切り、対応する文字列に置き換える。\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003e6bit\u003c/strong\u003e = \u003cstrong\u003e2^6\u003c/strong\u003e = 64 (⇒ 64文字種)\u003c/li\u003e\n\u003cli\u003e文字テーブル：\u003cbr\u003e\n\u003ccode\u003eABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\u003c/code\u003e\u003cbr\u003e\n(64文字種)\u003c/li\u003e\n\u003cli\u003e3btyte (24bit) ずつ処理し、4byteに伸長する。※ 24は8と6の最小公倍数。\n\n\u003cul\u003e\n\u003cli\u003e不足するbitは0で埋める。\u003c/li\u003e\n\u003cli\u003e不足するbyteは \u003ccode\u003e=\u003c/code\u003e 文字で埋める。\u003c/li\u003e\n\u003cli\u003e必ず文字列長は4の倍数になる。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/b55e82d608d4a74182f4cde3eaaa7df2f29a2629/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f37323235372f36383961663432312d643938612d363465622d613131622d3137303665636366613735312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F72257%2F689af421-d98a-64eb-a11b-1706eccfa751.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=cc3e7c597e2b87e5650ad41ff8d16104\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/72257/689af421-d98a-64eb-a11b-1706eccfa751.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F72257%2F689af421-d98a-64eb-a11b-1706eccfa751.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2d08a82704b08fe7be0cfed7f73a2822 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eコーディングの前に視覚化して整理するのも良いと思う。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"-base64-url-encoding-url安全なbase64\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-base64-url-encoding-url%E5%AE%89%E5%85%A8%E3%81%AAbase64\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e② BASE64 URL Encoding (URL安全なBASE64)\u003c/h2\u003e\n\n\u003cp\u003eBASE64 の仕様 RFC 4648 内で Section 5 「Base 64 Encoding with URL and Filename Safe Alphabet」 にて定義されている。\u003c/p\u003e\n\n\u003cp\u003e・RFC 4648 - The Base16, Base32, and Base64 Data Encodings #Section-5 Base 64 Encoding with URL and Filename Safe Alphabet\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://tools.ietf.org/html/rfc4648#section-5\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e \u003ccode\u003e+\u003c/code\u003e 、 \u003ccode\u003e/\u003c/code\u003e 、 \u003ccode\u003e=\u003c/code\u003e は \u003ccode\u003eURL\u003c/code\u003e 上意味を持つ記号のため、それらの文字を回避したもの。  (URL上の役割は割愛。)\u003c/li\u003e\n\u003cli\u003e 62番 \u003ccode\u003e+\u003c/code\u003e ⇒ \u003ccode\u003e-\u003c/code\u003e で表現する。\u003c/li\u003e\n\u003cli\u003e 63番 \u003ccode\u003e/\u003c/code\u003e ⇒ \u003ccode\u003e_\u003c/code\u003e で表現する。\u003c/li\u003e\n\u003cli\u003e \u003ccode\u003e=\u003c/code\u003e によるパディングは行わない。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e結構シンプルで、ほぼ一緒。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003e#\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003ebit\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003ehex\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eBASE64\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eBASE64URL\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e#\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003ebit\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003ehex\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eBASE64\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eBASE64URL\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00000000\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x00\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eA\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eA\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e32\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00100000\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x20\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eg\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eg\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00000001\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x01\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eB\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eB\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e33\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00100001\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x21\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eh\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eh\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e2\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00000010\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x02\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eC\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eC\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e34\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00100010\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x22\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ei\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ei\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e3\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00000011\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x03\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eD\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eD\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e35\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00100011\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x23\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ej\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ej\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e4\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00000100\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x04\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eE\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eE\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e36\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00100100\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x24\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ek\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ek\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e5\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00000101\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x05\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eF\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eF\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e37\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00100101\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x25\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003el\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003el\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e6\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00000110\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x06\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eG\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eG\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e38\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00100110\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x26\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003em\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003em\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e7\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00000111\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x07\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eH\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eH\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e39\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00100111\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x27\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003en\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003en\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e8\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00001000\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x08\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eI\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eI\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e40\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00101000\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x28\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eo\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eo\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e9\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00001001\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x09\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eJ\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eJ\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e41\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00101001\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x29\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ep\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ep\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e10\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00001010\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x0A\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eK\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eK\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e42\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00101010\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x2A\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eq\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eq\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e11\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00001011\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x0B\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eL\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eL\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e43\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00101011\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x2B\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003er\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003er\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e12\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00001100\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x0C\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eM\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eM\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e44\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00101100\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x2C\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003es\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003es\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e13\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00001101\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x0D\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eN\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eN\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e45\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00101101\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x2D\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003et\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003et\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e14\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00001110\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x0E\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eO\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eO\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e46\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00101110\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x2E\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eu\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eu\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e15\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00001111\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x0F\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eP\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eP\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e47\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00101111\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x2F\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ev\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ev\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e16\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00010000\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x10\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eQ\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eQ\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e48\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00110000\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x30\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ew\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ew\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e17\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00010001\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x11\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eR\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eR\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e49\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00110001\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x31\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ex\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ex\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e18\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00010010\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x12\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eS\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eS\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e50\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00110010\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x32\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ey\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ey\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e19\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00010011\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x13\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eT\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eT\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e51\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00110011\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x33\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ez\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ez\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e20\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00010100\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x14\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eU\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eU\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e52\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00110100\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x34\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e21\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00010101\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x15\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eV\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eV\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e53\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00110101\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x35\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e1\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e22\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00010110\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x16\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eW\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eW\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e54\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00110110\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x36\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e2\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e2\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e23\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00010111\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x17\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eX\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eX\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e55\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00110111\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x37\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e3\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e3\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e24\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00011000\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x18\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eY\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eY\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e56\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00111000\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x38\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e4\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e4\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e25\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00011001\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x19\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eZ\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eZ\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e57\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00111001\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x39\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e5\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e5\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e26\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00011010\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x1A\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ea\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ea\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e58\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00111010\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x3A\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e6\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e6\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e27\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00011011\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x1B\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eb\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eb\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e59\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00111011\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x3B\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e7\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e7\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e28\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00011100\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x1C\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ec\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ec\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e60\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00111100\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x3C\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e8\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e29\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00011101\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x1D\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ed\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ed\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e61\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00111101\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x3D\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e9\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e9\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e30\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00011110\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x1E\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ee\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ee\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e62\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00111110\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x3E\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e+\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e-\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e31\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00011111\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x1F\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ef\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003ef\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e63\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e00111111\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0x3F\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e/\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e_\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003epad\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003en/a\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003en/a\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e=\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003en/a\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"-base64--base64urlの相互変換\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-base64--base64url%E3%81%AE%E7%9B%B8%E4%BA%92%E5%A4%89%E6%8F%9B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e① BASE64 ⇔ BASE64URLの相互変換\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eBASE64 Safe URL Convert.(Java) | Online editor and compiler\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://paiza.io/projects/RsG1DKW3KU3gzcvttD8wKQ\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"java\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e変換.java\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"cm\"\u003e/**\n * URL安全なBASE64に変換.\n *\n * @param base64\n * @return base64url\n */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e \u003cspan class=\"nf\"\u003econvertBase64SafeUrl\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efinal\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003ebase64\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase64\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nc\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebase64\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ereplaceAll\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\\\\+\"\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"-\"\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ereplaceAll\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\\\\/\"\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"_\"\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ereplaceAll\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"=+$\"\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/**\n * 通常 (URL非安全) のBASE64に変換.\n *\n * @param base64url\n * @return base64\n */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e \u003cspan class=\"nf\"\u003econvertBase64UnSafeUrl\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efinal\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003ebase64url\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase64url\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nc\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebase64url\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ereplaceAll\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"-\"\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"+\"\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ereplaceAll\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"_\"\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"===\"\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003esubstring\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eret\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003elength\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e変換結果\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eurl safe   :8KCut/CfpJTwn42G8J+RjQ== (24)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  8KCut_CfpJTwn42G8J-RjQ (22)\nurl unsafe :8KCut_CfpJTwn42G8J-RjQ (22)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  8KCut/CfpJTwn42G8J+RjQ== (24)\n\nurl safe   :01234=== (8)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  01234 (5)\nurl safe   :012345== (8)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  012345 (6)\nurl safe   :0123456= (8)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  0123456 (7)\nurl safe   :01234567 (8)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  01234567 (8)\nurl safe   :a+/b==a+/b++a+/b//a+/b==a+/b==a+/b== (36)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  a-_b==a-_b--a-_b__a-_b==a-_b==a-_b (34)\nurl safe   :a+/b==a+/b++a+/b//a+/b==a+/b==a+/b (34)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  a-_b==a-_b--a-_b__a-_b==a-_b==a-_b (34)\n\nurl unsafe :01234 (5)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  01234=== (8)\nurl unsafe :012345 (6)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  012345== (8)\nurl unsafe :0123456 (7)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  0123456= (8)\nurl unsafe :01234567 (8)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  01234567 (8)\nurl unsafe :012345678 (9)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  012345678=== (12)\nurl unsafe :a-_b==a-_b--a-_b__a-_b==a-_b==a-_b (34)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  a+/b==a+/b++a+/b//a+/b==a+/b==a+/b== (36)\nurl unsafe :a-_b==a-_b--a-_b__a-_b==a-_b==a-_b (34)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  a+/b==a+/b++a+/b//a+/b==a+/b==a+/b== (36)\nurl unsafe :?*+/-_=== (9)  \u0026gt;\u0026gt;\u0026gt;\u0026gt;  ?*+/+/====== (12)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e文字列途中にある \u003ccode\u003e=\u003c/code\u003e については、そもそものルール違反のため、関知しない。\u003cbr\u003e\nBASE64の文字についても、そもそものルール違反のため、関知しない。\u003cbr\u003e\n元々末尾に \u003ccode\u003e=\u003c/code\u003e がついていた場合も、関知せずパディングを行う。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"-base64のencodedecode\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-base64%E3%81%AEencodedecode\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e② BASE64のEncode/Decode\u003c/h2\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"step-とりあえずbyte配列をbase64にするコードを作ってみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#step-%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9Abyte%E9%85%8D%E5%88%97%E3%82%92base64%E3%81%AB%E3%81%99%E3%82%8B%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSTEP① とりあえずBYTE配列をBASE64にするコードを作ってみる。\u003c/h1\u003e\n\n\u003cp\u003eとりあえず、書いてみた。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e6bitごとにbyte配列を整形する\u003c/code\u003e 処理と \u003ccode\u003e文字列化するコード\u003c/code\u003e を分けて記述。\u003c/li\u003e\n\u003cli\u003e進数変換と同様の考え方。\u003ccode\u003e今回のbit\u003c/code\u003e を \u003ccode\u003ebit mask\u003c/code\u003e で抽出し、\u003ccode\u003e前回余ったbit\u003c/code\u003e とを論理和で合成する。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e今回余ったbit\u003c/code\u003e は 左シフトし、不用bitを落としておき、次回に持ち越す。\u003c/li\u003e\n\u003cli\u003e今回取り出すbitの右シフト量 ( \u003ccode\u003ev\u003c/code\u003e ) は \u003ccode\u003e2\u003c/code\u003e, \u003ccode\u003e4\u003c/code\u003e, \u003ccode\u003e6\u003c/code\u003e の3パターン。 (⇒ \u003ccode\u003e(((i % 3) + 1) * 2)\u003c/code\u003e )\u003c/li\u003e\n\u003cli\u003e次回に持ち越すbitの左シフト量は右シフト量 ( \u003ccode\u003ev\u003c/code\u003e ) に応じて求められ、 \u003ccode\u003e4\u003c/code\u003e, \u003ccode\u003e2\u003c/code\u003e, \u003ccode\u003e0\u003c/code\u003e の3パターン。 (⇒ \u003ccode\u003e(6 - v)\u003c/code\u003e )\n\n\u003cul\u003e\n\u003cli\u003e上位2bitは落としておく。 左シフトのため下位bitは無視して良い。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e6bitごとにbyte配列を整形するメソッド\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"nf\"\u003econvert6bitBinary\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e \u003cspan class=\"n\"\u003emod\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003elowMaskList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"m\"\u003e0x3F\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// [0] 00111111\u003c/span\u003e\n            \u003cspan class=\"m\"\u003e0x0F\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// [1] 00001111\u003c/span\u003e\n            \u003cspan class=\"m\"\u003e0x03\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// [2] 00000011\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e \u003cspan class=\"n\"\u003elowMask\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elowMaskList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e \u003cspan class=\"n\"\u003eb0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e \u003cspan class=\"n\"\u003eb6\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003emod\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elowMask\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eb0\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eb6\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003emod\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"m\"\u003e0x3F\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eb0\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emod\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003emod\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emod\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e文字列化するコード\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eToBase64\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisUrlSafe\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eStringBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStringBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ebase64_map\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eisUrlSafe\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebase64_map\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBASE64_MAP_URLSAFE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebase64_map\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBASE64_MAP_BASIC\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase64_map\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003eisUrlSafe\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003emax\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"===\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emax\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRemove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emax\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003emax\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"step-4文字ごと-に着目した処理を考え実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#step-4%E6%96%87%E5%AD%97%E3%81%94%E3%81%A8-%E3%81%AB%E7%9D%80%E7%9B%AE%E3%81%97%E3%81%9F%E5%87%A6%E7%90%86%E3%82%92%E8%80%83%E3%81%88%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSTEP② \u003ccode\u003e4文字ごと\u003c/code\u003e に着目した処理を考え実装する。\u003c/h1\u003e\n\n\u003cp\u003eBASE64は比較的古くからある仕様であり、展開や実装の容易さと言うのも兼ね備えていたと考える。なので、 \u003cstrong\u003e\u003ccode\u003e=\u003c/code\u003e を用いたパディング\u003c/strong\u003e は何のために必要なのか疑問語を覚えるが。これは逆説的に、\u003cstrong\u003e\u003ccode\u003e4文字ごと\u003c/code\u003e に作業を行うことで、最適化が行える\u003c/strong\u003e を可能性を感じられる。特に \u003ccode\u003e4文字\u003c/code\u003e で表現される \u003ccode\u003e24 bit\u003c/code\u003e は \u003ccode\u003e8\u003c/code\u003e と \u003ccode\u003e6\u003c/code\u003e の \u003ccode\u003e最小公倍数\u003c/code\u003e である。即ち、\u003cstrong\u003e\u003ccode\u003e3byte\u003c/code\u003e ずつ \u003ccode\u003e4文字\u003c/code\u003e にする\u003c/strong\u003e のである。この程度であれば、下手にベタ書きしたした方が可読性もあり、 \u003ccode\u003eif文\u003c/code\u003e も減り、高速化が望めそうである。そんな訳で、処理を見直して、Encode処理とDecode処理を組み直してみる。\u003c/p\u003e\n\n\u003cp\u003e※ 現在のPCのCPUは計算機の発展であり、計算が得意で条件分岐が苦手である。レガシーなPCでは限られたリソースで速度を得るため、条件分岐を省き効率よく処理を作る必要性が高かった。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"encode-base64化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#encode-base64%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEncode (BASE64化)\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e3byteずつ、 \u003ccode\u003eint配列[3]\u003c/code\u003e にコピーする。byteの長さを超えた場合は、\u003cstrong\u003e9bit目だけが立っている \u003ccode\u003e0x0100\u003c/code\u003e\u003c/strong\u003e にする。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eint配列[3]\u003c/code\u003e から \u003ccode\u003ebyte配列[4]\u003c/code\u003e 6bitずつ格納していく。\n\n\u003cul\u003e\n\u003cli\u003e(1) \u003ccode\u003eint配列[n]の9bit目\u003c/code\u003e を \u003ccode\u003ebyte配列[n]の7bit目\u003c/code\u003e に論理和。\u003cbr\u003e\n※ \u003cstrong\u003e6bitに伸長した場合は7-8bit目は使わないので、存在しないバイトはbitを立てて64以上の値にする。\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003e(2) 上位ビットはカレントとして \u003ccode\u003eint配列[n]の該当bit\u003c/code\u003e を \u003ccode\u003ebyte配列[n - 1]の該当bit\u003c/code\u003e へ \u003ccode\u003e左シフト + マスク (抽出)\u003c/code\u003e して 論理和\u003c/li\u003e\n\u003cli\u003e(3) 下位ビットは不足分として \u003ccode\u003eint配列[n - 1]の該当bit\u003c/code\u003e を \u003ccode\u003ebyte配列[n - 1]の該当bit\u003c/code\u003e へ \u003ccode\u003e右シフト + マスク (抽出)\u003c/code\u003e して 論理和\u003c/li\u003e\n\u003cli\u003e存在するバイト値は \u003ccode\u003e0 ~ 63\u003c/code\u003e の値になる。\u003cbr\u003e\n※ \u003cstrong\u003e\u003ccode\u003e0x0100\u003c/code\u003e の下位8bitが0なので、不足分で使われても問題ない。\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003e存在しないバイト値は \u003ccode\u003e64\u003c/code\u003e の値になる。\u003cbr\u003e\n※ \u003cstrong\u003eこれも、\u003ccode\u003e0x0100\u003c/code\u003e の効果。\u003c/strong\u003e \u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ebyte配列\u003c/code\u003e の値を文字化して格納。\n\n\u003cul\u003e\n\u003cli\u003e通常の \u003ccode\u003eBASE64\u003c/code\u003e では変換表の \u003ccode\u003e64番目\u003c/code\u003e に \u003ccode\u003e=\u003c/code\u003e を入れておき、条件分岐無くパディング行う。\u003c/li\u003e\n\u003cli\u003eURL安全の \u003ccode\u003eBASE64 URL\u003c/code\u003e 場合は、\u003ccode\u003e64番目\u003c/code\u003e 以上はスキップします。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eencode処理抜粋\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eBASE64_MAP_BASIC\u003c/span\u003e   \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eBASE64_MAP_URLSAFE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eencode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisUrlSafe\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eStringBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStringBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003etgt\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//copy or default.\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e//(bit: 0001 0000)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// reformat.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etgt\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e)((\u003c/span\u003e\u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e                 \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e                 \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0x3F\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etgt\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e)((\u003c/span\u003e\u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e                 \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0x3F\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0x0F\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etgt\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e)((\u003c/span\u003e\u003cspan class=\"m\"\u003e0x40\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0x3F\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0x03\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etgt\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e)((\u003c/span\u003e\u003cspan class=\"m\"\u003e0x40\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0x3F\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// to character.\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eisUrlSafe\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etgt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0x40\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBASE64_MAP_URLSAFE\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBASE64_MAP_BASIC\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003etgt\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]]);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBASE64_MAP_BASIC\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003etgt\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]]);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBASE64_MAP_BASIC\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003etgt\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]]);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBASE64_MAP_BASIC\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003etgt\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]]);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e結構条件分岐が減って、良い感じ。また、符号化には最低でも2文字必要になるため、1-2文字目用のパディング判定処理は省いている。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"decode-base64からの復号\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#decode-base64%E3%81%8B%E3%82%89%E3%81%AE%E5%BE%A9%E5%8F%B7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDecode (BASE64からの復号)\u003c/h2\u003e\n\n\u003cp\u003e通常の \u003ccode\u003eBASE64\u003c/code\u003e と URL安全の \u003ccode\u003eBASE64 URL\u003c/code\u003e どちらでも復号ができる様にしている。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e文字列\u003c/code\u003e から \u003ccode\u003ebyte配列[4]\u003c/code\u003e に値を格納する。存在しないbyte値は、\u003ccode\u003e64\u003c/code\u003e にする。\n\n\u003cul\u003e\n\u003cli\u003e通常の \u003ccode\u003eBASE64\u003c/code\u003e では変換表の \u003ccode\u003e64番目\u003c/code\u003e に \u003ccode\u003e=\u003c/code\u003e を入れておき、こちらも \u003ccode\u003e64\u003c/code\u003e になる。\u003c/li\u003e\n\u003cli\u003e値が見つからなかった時は、URL安全の \u003ccode\u003eBASE64 URL\u003c/code\u003e の変換表も探索し、\u003ccode\u003e-\u003c/code\u003e \u003ccode\u003e_\u003c/code\u003e を補完する。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ebyte配列[4]\u003c/code\u003e から \u003ccode\u003eint配列[3]\u003c/code\u003e へ 8bitずつ格納していく。\n\n\u003cul\u003e\n\u003cli\u003e(1) \u003ccode\u003ebyte配列[n + 1]の7bit目\u003c/code\u003e を \u003ccode\u003eint配列[n]の9bit目\u003c/code\u003e に論理和。\u003cbr\u003e\n\u003c/li\u003e\n\u003cli\u003e(2) 上位ビットはカレントとして \u003ccode\u003ebyte配列[n]の該当bit\u003c/code\u003e を \u003ccode\u003eint配列[n]の該当bit\u003c/code\u003e へ \u003ccode\u003e左シフト + マスク (抽出)\u003c/code\u003e して 論理和\u003c/li\u003e\n\u003cli\u003e(3) 下位ビットは不足分として \u003ccode\u003ebyte配列[n + 1]の該当bit\u003c/code\u003e を \u003ccode\u003eint配列[n]の該当bit\u003c/code\u003e へ \u003ccode\u003e右シフト + マスク (抽出)\u003c/code\u003e して 論理和\u003c/li\u003e\n\u003cli\u003e存在するバイト値の場合 \u003cstrong\u003ebyteの範囲を内の \u003ccode\u003e0 ~ 255\u003c/code\u003e\u003c/strong\u003e の値になり、バイナリに追加する。\u003c/li\u003e\n\u003cli\u003e存在しないバイト値の場合、\u003cstrong\u003ebyteの範囲を超えた \u003ccode\u003e256 (0x0100)\u003c/code\u003e\u003c/strong\u003e の値になり、バイナリに追加しない。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edecode処理抜粋\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eBASE64_MAP_BASIC\u003c/span\u003e   \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eBASE64_MAP_URLSAFE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"nf\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ebase64\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsNullOrEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase64\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebase64\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003etgt\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebase64\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebase64\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBASE64_MAP_BASIC\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIndexOf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBASE64_MAP_URLSAFE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIndexOf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ecode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 01000000 (64)\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ecode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x40\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003etgt\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e                   \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0xFC\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0x03\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etgt\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0xFF00\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0xF0\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0x0F\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etgt\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0xFF00\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0xC0\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0x3F\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eval\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etgt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eval\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0xFF\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eval\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこちらも変換表の64番目に \u003ccode\u003e=\u003c/code\u003e を追加して64以上を使うことで、処理を少し簡略化出来ている感がある。\u003cbr\u003e\nまた、復号には最低でも2文字必要になるため、1byte目の復号には存在チェック用のbit処理を省いている。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/8f59004925d4e4ccd5486a805df5006072790c78/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f37323235372f39343939336531622d666438642d663930392d333237382d6163356163303132396664322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F72257%2F94993e1b-fd8d-f909-3278-ac5ac0129fd2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=288e13aae38ba9e70515dfdbab536790\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/72257/94993e1b-fd8d-f909-3278-ac5ac0129fd2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F72257%2F94993e1b-fd8d-f909-3278-ac5ac0129fd2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2da09d4bd221568a449681c08c54eb39 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n本来 \u003ccode\u003e=\u003c/code\u003e 前の文字の場合は更にその前の余りを含んでいるので、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e1文字の場合 ⇒ BASE64上ありえない  \u003cdel\u003e(\u003ccode\u003e=\u003c/code\u003e で3文字パディング。)\u003c/del\u003e\n\u003c/li\u003e\n\u003cli\u003e2文字の場合 ⇒ \u003cstrong\u003e\u003ccode\u003e=\u003c/code\u003e の 前の文字の下位4bitが0\u003c/strong\u003e (\u003ccode\u003e=\u003c/code\u003e で2文字パディング。)\u003c/li\u003e\n\u003cli\u003e3文字の場合 ⇒ \u003cstrong\u003e\u003ccode\u003e=\u003c/code\u003e の 前の文字の下位2bitが0\u003c/strong\u003e (\u003ccode\u003e=\u003c/code\u003e で1文字パディング。)\u003c/li\u003e\n\u003cli\u003e4文字の場合 ⇒ 余りなし (\u003ccode\u003e=\u003c/code\u003e でパディングする必要もなし。)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eな感じになる。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"実行例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行例\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eBASE64 scrap (C#) | Online editor and compiler\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://paiza.io/projects/yBRImZbpO-rBtQWp23pONw\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e実行例抜粋\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e// check strs[0]-------------------------------------------------------\n  #source\n    str        : Hellow C#\n    bin  (hex) : 48 65 6C 6C 6F 77 20 43 23\n    bin  (bit) : 01001000 01100101 01101100 01101100 01101111 01110111 00100000 01000011 00100011\n\n  #encode\n    base64     : SGVsbG93IEMj\n    base64url  : SGVsbG93IEMj\n\n  #decode (basic) SGVsbG93IEMj\n    bin  (hex) : 48 65 6C 6C 6F 77 20 43 23\n    bin  (bit) : 01001000 01100101 01101100 01101100 01101111 01110111 00100000 01000011 00100011\n    str        : Hellow C#\n\n  #decode (urlsafe) SGVsbG93IEMj\n    bin  (hex) : 48 65 6C 6C 6F 77 20 43 23\n    bin  (bit) : 01001000 01100101 01101100 01101100 01101111 01110111 00100000 01000011 00100011\n    str        : Hellow C#\n\n// check strs[1]-------------------------------------------------------\n  #source\n    str        : BASE64-\n    bin  (hex) : 42 41 53 45 36 34 2D\n    bin  (bit) : 01000010 01000001 01010011 01000101 00110110 00110100 00101101\n\n  #encode\n    base64     : QkFTRTY0LQ==\n    base64url  : QkFTRTY0LQ\n\n  #decode (basic) QkFTRTY0LQ==\n    bin  (hex) : 42 41 53 45 36 34 2D\n    bin  (bit) : 01000010 01000001 01010011 01000101 00110110 00110100 00101101\n    str        : BASE64-\n\n  #decode (urlsafe) QkFTRTY0LQ\n    bin  (hex) : 42 41 53 45 36 34 2D\n    bin  (bit) : 01000010 01000001 01010011 01000101 00110110 00110100 00101101\n    str        : BASE64-\n\n// check strs[2]-------------------------------------------------------\n  #source\n    str        : 𠮷🤔🍆👍\n    bin  (hex) : F0 A0 AE B7 F0 9F A4 94 F0 9F 8D 86 F0 9F 91 8D\n    bin  (bit) : 11110000 10100000 10101110 10110111 11110000 10011111 10100100 10010100 11110000 10011111 10001101 10000110 11110000 10011111 10010001 10001101\n\n  #encode\n    base64     : 8KCut/CfpJTwn42G8J+RjQ==\n    base64url  : 8KCut_CfpJTwn42G8J-RjQ\n\n  #decode (basic) 8KCut/CfpJTwn42G8J+RjQ==\n    bin  (hex) : F0 A0 AE B7 F0 9F A4 94 F0 9F 8D 86 F0 9F 91 8D\n    bin  (bit) : 11110000 10100000 10101110 10110111 11110000 10011111 10100100 10010100 11110000 10011111 10001101 10000110 11110000 10011111 10010001 10001101\n    str        : 𠮷🤔🍆👍\n\n  #decode (urlsafe) 8KCut_CfpJTwn42G8J-RjQ\n    bin  (hex) : F0 A0 AE B7 F0 9F A4 94 F0 9F 8D 86 F0 9F 91 8D\n    bin  (bit) : 11110000 10100000 10101110 10110111 11110000 10011111 10100100 10010100 11110000 10011111 10001101 10000110 11110000 10011111 10010001 10001101\n    str        : 𠮷🤔🍆👍\n\n// check 1st impl.\nencode : 6A 05 39 =\u0026gt; agU5\nencode : 6A 05    =\u0026gt; agU=\nencode : 6A       =\u0026gt; ag==\nencode : 6A 05 39 =\u0026gt; agU5\nencode : 6A 05    =\u0026gt; agU\nencode : 6A       =\u0026gt; ag\ndecode : agU5 =\u0026gt; 6A 05 39\ndecode : agU= =\u0026gt; 6A 05\ndecode : ag== =\u0026gt; 6A\ndecode : a=== =\u0026gt; \ndecode : agU5 =\u0026gt; 6A 05 39\ndecode : agU =\u0026gt; 6A 05\ndecode : ag =\u0026gt; 6A\ndecode : a =\u0026gt; \n\n// check 2nd impl.\nencode : 6A 05 39 =\u0026gt; agU5\nencode : 6A 05    =\u0026gt; agU=\nencode : 6A       =\u0026gt; ag==\nencode : 6A 05 39 =\u0026gt; agU5\nencode : 6A 05    =\u0026gt; agU\nencode : 6A       =\u0026gt; ag\ndecode : agU5 =\u0026gt; 6A 05 39\ndecode : agU= =\u0026gt; 6A 05\ndecode : ag== =\u0026gt; 6A\ndecode : a=== =\u0026gt; \ndecode : agU5 =\u0026gt; 6A 05 39\ndecode : agU =\u0026gt; 6A 05\ndecode : ag =\u0026gt; 6A\ndecode : a =\u0026gt; \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"base64url-の活用法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#base64url-%E3%81%AE%E6%B4%BB%E7%94%A8%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBASE64URL の活用法\u003c/h1\u003e\n\n\u003cp\u003e私が今回使おうと思った背景では、Servlet のWEBアプリケーションで \u003cstrong\u003eChromeのAcrobat拡張\u003c/strong\u003e を利用するために、リクエストをURLに再現性のない \u003ccode\u003ePOST\u003c/code\u003e から再現性のある \u003ccode\u003eGET\u003c/code\u003e に変更しようと思ったのがある。パラメータは複数あり、あまり生で見せたくないというのもあり、全パラメータをまとめて \u003ccode\u003eBASE64\u003c/code\u003e での \u003ccode\u003eシリアライズ\u003c/code\u003e を行うことにした。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eChromeのAcrobat拡張\u003c/strong\u003e ではURLを再度開いているだけのため、再現性のあるURLである必要がある。これはfirefoxで内蔵ビューアで開いたPDFをオンザフライでAdobeReaderなどに開かせる際も同様かと思う。\u003c/p\u003e\n\n\u003cp\u003eGETによるアプリケーション連携が増えている昨今。一時的なリクエストにせよ、GET化することのメリットがそれなりに出てきている。\u003c/p\u003e\n\n\u003cp\u003eと言うか、私は \u003ccode\u003eパーマネント リンク大好きマン\u003c/code\u003e なので参照メインのサイトで \u003ccode\u003eパーマネント リンク\u003c/code\u003e 取れない時に結構キレてます。えぇ、最近のアニメ公式サイトとか多いですね。。。すっごいゴテゴテで、友人にshareしようとしたら、 \u003ccode\u003eパーマネント リンク\u003c/code\u003e が取れなくてTOPページしか送れないこととか。。。\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003e\u003ca href=\"http://penguin-empire.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eダイミダラーの公式サイト\u003c/a\u003e を見習って欲しい\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e(そういう意味ではFLASHが死に絶えたのはほんと、良かったのかも知れない。FLASHだけで作ってるサイトも度々あったので)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"パーセント-エンコーディング-や-uri-エンコーディング-じゃダメだったのか-thinking\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%91%E3%83%BC%E3%82%BB%E3%83%B3%E3%83%88-%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-%E3%82%84-uri-%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-%E3%81%98%E3%82%83%E3%83%80%E3%83%A1%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%8B-thinking\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eパーセント エンコーディング\u003c/code\u003e や \u003ccode\u003eURI エンコーディング\u003c/code\u003e じゃダメだったのか？ \u003cimg alt=\":thinking:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f914.png\" title=\":thinking:\" width=\"20\" loading=\"lazy\"\u003e\n\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003eパーセント エンコーディング\u003c/code\u003e 及び \u003ccode\u003eURI エンコーディング\u003c/code\u003eはどんな文字列にもエンコード/デコードを処理をかけることができ、符号化/復号化がブラウザやWEBサーバーのリクエスト処理に含まれてしまっている。そのため、間に認証ページなどでジャンプが挟まる様な場合、ジャンプ数を加味して多重で\u003ccode\u003eパーセント エンコーディング\u003c/code\u003eをかけたりする必要がある場合がある。特に \u003ccode\u003e=\u003c/code\u003e が含まれている場合には、多段でジャンプ中にQueryStringとして前のページでのパラメータとして喰われてしまい、自分のページに届かない、なんてこともある。\u003ccode\u003eBASE64\u003c/code\u003e の場合は \u003ccode\u003e+\u003c/code\u003e \u003ccode\u003e/\u003c/code\u003e により、多段ジャンプ自体が阻害される場合もある。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eBASE64URL\u003c/code\u003e では自分で展開処理を行わなければいけないデメリット自体がそのままメリットとなり、他のページとの競合を避けることができる。誰も勝手に復号したりしないので、最後までそのまま自分のところに届く。\u003c/p\u003e\n\n\u003cp\u003e多段ジャンプ(笑) と思うこともあるかも知れないが。案外Twittterの認証など色々画面見てても、結構パラメーターを引きずっていることが多くあると思い、そんなにマイノリティでは無いかと思う。\u003c/p\u003e\n\n\u003cp\u003eHTTPのリクエストのセキュリティは、\u003ccode\u003eGET\u003c/code\u003e 以上のものが \u003ccode\u003ePOST\u003c/code\u003e で得られるもんでも無いと思うので、もっと別の形で確保してください。\u003cbr\u003e\n(だから認証でも \u003ccode\u003eGET\u003c/code\u003e を使っているのでしょう。)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"総括\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B7%8F%E6%8B%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e総括\u003c/h1\u003e\n\n\u003cp\u003eベンチマークは取らないが、BASE64の実装をして理解を深めることが出来たと思います。とてもシンプルなロジックなので、一度自分で書いてみるのは、bit演算の訓練にもなって良いかと思った。あと、行数によってはベタに書くことも悪く無く、今回の \u003ccode\u003eBASE64\u003c/code\u003e もその類なのかと思う。\u003c/p\u003e\n\n\u003cp\u003eなお、JavaとC#が混在しているのは単に気分です。( 当方、\u003ccode\u003efinal教信者\u003c/code\u003e の \u003ccode\u003eC#er\u003c/code\u003e です )。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考-謝辞\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83-%E8%AC%9D%E8%BE%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考 (謝辞)\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eBase64 - Wikipedia\u003cbr\u003e\n\u003ca href=\"https://ja.wikipedia.org/wiki/Base64\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://ja.wikipedia.org/wiki/Base64\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eRFC 4648 - The Base16, Base32, and Base64 Data Encodings\u003cbr\u003e\n\u003ca href=\"https://tools.ietf.org/html/rfc4648\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://tools.ietf.org/html/rfc4648\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","createdAt":"2021-05-01T19:00:38Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"unr4UhWR8TQNvCY6vEFs2Gb/nJbcjlLZvw==--L6PeAt+T/auavP0N--Gbk+w9u+mSIMIqIKPo5x5w==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2021-06-16T16:20:53Z","likesCount":1,"linkUrl":"https://qiita.com/libraplanet/items/8e4b51371948850060c1","organization":null,"originalId":1429134,"stockedCount":0,"title":"BASE64URL Encodingのすすめ","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%82%E3%81%AEurl%E3%81%A7%E8%A6%8B%E3%81%9Fbase64%E3%81%AE%E5%90%8D%E5%89%8D%E3%82%92%E5%83%95%E9%81%94%E3%81%AF%E3%81%BE%E3%81%A0%E7%9F%A5%E3%82%89%E3%81%AA%E3%81%84\"\u003eあのURLで見たBASE64の名前を僕達はまだ知らない。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#base64%E3%81%AE%E8%A7%A3%E8%AA%AC\"\u003eBASE64の解説\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#-base64-original\"\u003e① BASE64 (original)\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#-base64-url-encoding-url%E5%AE%89%E5%85%A8%E3%81%AAbase64\"\u003e② BASE64 URL Encoding (URL安全なBASE64)\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e実装\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#-base64--base64url%E3%81%AE%E7%9B%B8%E4%BA%92%E5%A4%89%E6%8F%9B\"\u003e① BASE64 ⇔ BASE64URLの相互変換\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#-base64%E3%81%AEencodedecode\"\u003e② BASE64のEncode/Decode\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#step-%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9Abyte%E9%85%8D%E5%88%97%E3%82%92base64%E3%81%AB%E3%81%99%E3%82%8B%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003eSTEP① とりあえずBYTE配列をBASE64にするコードを作ってみる。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#step-4%E6%96%87%E5%AD%97%E3%81%94%E3%81%A8-%E3%81%AB%E7%9D%80%E7%9B%AE%E3%81%97%E3%81%9F%E5%87%A6%E7%90%86%E3%82%92%E8%80%83%E3%81%88%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003eSTEP② 4文字ごと に着目した処理を考え実装する。\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#encode-base64%E5%8C%96\"\u003eEncode (BASE64化)\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#decode-base64%E3%81%8B%E3%82%89%E3%81%AE%E5%BE%A9%E5%8F%B7\"\u003eDecode (BASE64からの復号)\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E4%BE%8B\"\u003e実行例\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#base64url-%E3%81%AE%E6%B4%BB%E7%94%A8%E6%B3%95\"\u003eBASE64URL の活用法\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%91%E3%83%BC%E3%82%BB%E3%83%B3%E3%83%88-%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-%E3%82%84-uri-%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-%E3%81%98%E3%82%83%E3%83%80%E3%83%A1%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%8B-thinking\"\u003eパーセント エンコーディング や URI エンコーディング じゃダメだったのか？ :thinking:\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B7%8F%E6%8B%AC\"\u003e総括\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83-%E8%AC%9D%E8%BE%9E\"\u003e参考 (謝辞)\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":820,"uuid":"8e4b51371948850060c1","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"EWm8AlrcbS5CEj1wq3dmoDuUxKk=--yxFj/E4M/mbNVSsx--9s/+OZy1mZD1MgUq5CRDsw==","originalId":72257,"description":"","facebookUrl":null,"githubUrl":"https://github.com/libraplanet","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/72257/e381e2f4dd7851e2a001bfbed66153a131d5e78b/x_large.png?1598304169","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F72257%2Fe381e2f4dd7851e2a001bfbed66153a131d5e78b%2Fx_large.png%3F1598304169?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=4b2e0d9f9a7bd97f8b438c91caa6c265","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F72257%2Fe381e2f4dd7851e2a001bfbed66153a131d5e78b%2Fx_large.png%3F1598304169?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=d426188a19b67fbd8a5ed5d14dbfe64d","urlName":"libraplanet","websiteUrl":null,"twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"Java","urlName":"java"},{"name":"C#","urlName":"csharp"},{"name":"base64","urlName":"base64"}],"followingLikers":{"edges":[]},"comments":{"totalCount":2}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

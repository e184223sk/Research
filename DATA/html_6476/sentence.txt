More than 3 years have passed since last update.この記事は、SkyrimというゲームソフトのModファイルのバリナリ解析とそれを利用してModを生成するC#のコードについて記載していくシリーズ物です。
ファイルフォーマットについての詳しい情報は以下のサイトがあります。(以降UESP)
Tes5Mod:Mod File Format - The Unofficial Elder Scrolls Pages (UESP)前回はレコードについて扱いましたので、今回はフィールドについてです。フィールドのヘッダー構成は次の通りです。フィールド内でもデータの内容が分かれていたりしますが、後は、構造体として何byte目が何の情報で・・・のように扱うことになります。まずは、そのままDataSize分のバイト数を取り込むようにしていますが、後々個別のフィールドを扱うように、一応リストにしておきます。では、フィールドを扱うようにレコードクラスなどに修正を入れます。レコードクラスはそこそこ手入れをしました。
まず、フィールドについては、出力用のOutputItemsに追加すると共に、SignatureでアクセスできるようにDictionaryに登録することにします。
また、同じSignatureで複数フィールドある場合があるため、リストに追加します。
フィールドの読み取りは、後々レコードクラスを継承して個別のレコードに対応した際に、必要なフィールドを処理できるようにしておきます。
特に、いくつかのフィールドは同じSignatureでも、中身が異なるケースがあるため、注意が必要です。以上、今回はここまでです。



More than 3 years have passed since last update.14日目担当のf-murakamiです。簡単にスマホアプリを作る方法について書いてみたいと思います。スマホアプリを作るにはAndroidならjavaやkotlin、iOSならobjective-cやswiftなどが主流ですが、あえてUnityを使ってみたいと思います。Unityは、スーパーマリオランや白猫プロジェクトなどの有名なゲームにも使われている、本来3Dや2Dのゲームを作るためのエンジンですが、実はUI機能もかなり充実しており、ツール的なアプリも簡単に作ることができます。そして、Android、iOS、WebGLなどいろいろなプラットフォームに対応しており、１つ作ればいろいろな環境で動かすことができます。さらに、プログラム言語にC#が使えるので、C#er（シーシャーパー）の私としては、もってこいなんです。題材は簡単で実用的なものが良いので、電卓アプリにしてみます。ただ、単純な電卓アプリなら世に掃いて捨てるほどありますので、割り算の商と余りを求めるのに特化した電卓（名付けるとしたら「あまり電卓」かな）を考えてみます。意外にも、こんな電卓アプリはありそうでほとんどありません。
使い道は少ないかもしれませんが、子供が小学校で習う割り算の答えあわせに使えたりしますよ。まずは、Unityをインストールしてください。
インストール方法はいろいろなサイトにありますので、ググってみてください。2017年12月14日現在、最新バージョンは2017.2.1です。あと、AndoridアプリならAndroidStudio、iOSアプリならXCodeが必要です。
こちらもインストールしておいてください。アプリを以下の流れで作っていきます。それでは順にいきましょう。すぐ実装に入りたいところですが、その前に設計しましょう。
割り算の機能しかないので、以下のようなイメージです。手書きで恐縮ですが、趣味で作る分には凝った設計図は不要です。
まず、どういったアプリを作りたいかイメージを膨らませて図解してみてください。設計図ができたらいよいよ実装に入ります。Unityで実装するにあたり、まずプロジェクトというものを作ります。UnityのSDKを開くと、プロジェクトメニューが表示されますので、右上のNewを押します。プロジェクト名をいれて、2Dにチェックしますすると以下の画面が表示されます。最初にどのプラットフォームで動かすかを選択します。
（あとで選択してもいいですが、先に選択した方が、画面サイズなどシミュレーションしやすいです。）プラットフォームを選択するにはFileメニューからBuild Settingsを選択します。今回はAndroidのアプリとして作ってみます。
その場合、Androidを選択して、Switch Platformを押下します。これでプラットフォームの準備ができました。次に画面を作っていきます。Unityでは画面１つ１つをシーン（Scene）といいます。
複数画面を遷移するようなアプリは複数のシーンが必要です。最初はシーンが１つだけ用意されていますが、まだ保存されておらずUntitledとなっています。
今回作るアプリは、画面が１つだけなので、このシーンをMainとリネームして保存します。画面にラベルやボタンなどを配置するには、まずCanvasというオブジェクトを作る必要があります。
このCanvas上に、ラベルやボタンなどを配置していきます。
Canvas自体に座標をもっており、通常の2Dや3Dのオブジェクトを配置する座標とは別モノです。Canvasを作るにはシーンの右クリックメニューからCanvasを選択します。今見えている図面は2Dや3Dのオブジェクトを配置する図面で、この右上に向かって広がっているのがCanvasの図面です。Canvasを作ったら、Canvasの図面に合わせて表示領域を広げます。Canvasの図面が表示領域におさまればOKです。次にラベルやボタンなどのオブジェクトをおいていきます。必要なオブジェクトは以下です。入力欄なので入力フィールド（InputField）が良さそうですが、手入力はさせずボタンによる入力に限定するため、パネル（Panel）をおいてその上に文字を表示するようにします。
そのため、パネルの子オブジェクトとして、文字を表示できるテキスト（Text）をつかいます入力欄としてパネルを配置します。パネルが画面全体に広がっているので縮小し、この子オブジェクトとしてテキストを配置します。こんな感じです。計算式入力欄と同じようにパネルで作ります。子にテキストをセットします。文字も入れてみました。フォントなどはInspectorウインドウで設定します。以下の４種類のボタンを配置します。まずは1個数字ボタンを作ってみましょう。
サイズやフォントをいい感じに設定したら、他のボタンはコピーして作りましょう。
（あとで配置とか調整しますのでおおざっぱで良いです。）こんな感じになります。これで画面の配置は一通り完了です。手順は以下の流れ。ProjectウインドウのAssetsから右クリックメニューでCreate→C# Scriptを選択以下のコードが書かれたスクリプトファイルができます。
（Main.csと命名してます）このスクリプトを画面のオブジェクトにアタッチします。
今回の場合は、どのオブジェクトでも良いのですが、Canvasオブジェクトにしてみましょう。
以下手順です。CanvasのInspectorウインドウから、Add Componentを押下Scriptsを選択先ほど作成したスクリプトMainを選択これでアタッチ完了です。どんなイベントがあるかは、最初設計図に書きましたね。
各イベントと対応するメソッドを定義してみます。（Updateメソッドは常に動かす処理を書きます。このアプリでは使いません）また、画面のオブジェクトをスクリプトに受け渡すため、クラス変数に定義します。
あと、UnityのUIクラスを使うので、ネームスペースにusing UnityEngine.UIを定義しときます。変数とメソッドを一通り定義すると、以下のコードになります。先ほどCanvasオブジェクトにアタッチしたスクリプトをみると、パラメータを渡せるようになってます。
そこに受け渡す画面オブジェクトを指定します。
（数字ボタンは配列で受け渡しています。）各ボタンオブジェクトにはクリックイベントが設定できるようになってます。
スクリプトをアタッチしたオブジェクトと、イベントで実行するメソッドを指定します。
これを各ボタンに設定していきます。以下の図は、数字1のボタンの設定例です。イベント毎の処理ロジックを書いていきます。
特に難しいロジックはないと思います。できあがったスクリプトは以下になります。一通り作ったら、PC上で動かしてみましょう。
Gameビューから再生するとアプリが立ち上がります。いろいろ動かしてみて、うまく動かなければデバッグして修正。
これを繰り返します。PCで一通り動いたら、スマホで動かしたいところですが、その前にやるべきことが！スマホは機種によって画面のサイズや解像度が違います。
先ほど、一通り配置したのは、絶対座標で設定されており、画面サイズや解像度が異なると、同じ座標でも位置が変わってしまいます。どのような画面でも対応できるようにするには、画面の最小最大の座標を統一し、相対的な位置を設定する必要があります。これには、アンカー(Anchors)というレイアウトの概念を用います。アンカーを用いると、画面のX軸Y軸それぞれ最小を0、最大を1に統一し、画面の相対的な位置を定義できます。以下のようなイメージです。例１）入力テキスト欄の場合
（アンカーの基準を(0,0)にするため、Left,Right,Top,Bottomは全てゼロにしてください）例２）数字1ボタンの場合アンカーの設定を行ったら、いよいよスマホで動かしてみます。FileメニューからBuild Settingsを開きます。まずは、Player SettingsからPackageNameをいれてください。設定したら、PCとスマホをつないで、Build And Runを押して転送します。
あらかじめスマホのロックははずしておいてください。転送が完了したら自動的に立ち上がります計算してみます。ちゃんと動きますね！Unityを使ってスマホアプリを作る方法を、プロジェクトの作り方から、実機で動くところまで書いてみました。
予想以上に記事量が増えてしまい、ところどころ端折ってます。
もし、ここってどうすればいいの？など不明な点がありましたらコメントしてください。また、今回はとりあえず動くところまででしたが、もちろんここから画面をもっときれいにしたり、操作しやすいレイアウトにしたり、機能を増やしてみたり、どんどんブラッシュアップできます。
さらに、プラットフォームを切り替えればiOS用にも作れます。本稿を読んでみて、アプリを作ってみたい！って思った方、これなら私でもできる！って思った方、ぜひともアプリを作ってみましょう。
そして、いいのが作れたら、パブリックにも公開してみましょう。
（公開の仕方は、いろいろなサイトに載ってますので調べてみてください。）それでは！



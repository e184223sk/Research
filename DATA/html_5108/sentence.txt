More than 3 years have passed since last update.fake-s3 や LocalStack を使って、S3 の動作確認をローカルで行うことができますが、AWS SDK for .NET を使った場合には少々面倒な部分があったので記録しておきます。LocalStack を docker-compose で以下のように設定し立ち上げるとしますCredential は何でも良いので aws cli なら例えば以下で接続できます。もちろん profile ではなく accesskey, secret を指定しても良いです。よって、以下を設定できれば C# のコードからも接続できそうです。また、注意すべきは、HTTP であるという点です。これだけで接続できます。endpointDefinition に関しては上記（日本語版が古いと困るので一応英語版を参照）に記載があります。
ただ、そこからリンクされている endpoints.json の Github のリンク先にあるサンプルでは動作しません  以下は RegionEndpointProvider というまさに endpoints.json の内容を読み込むためのクラスですが、これには内部的に V2, V3 とバージョンが分かれています。コメントとコードから分かるように、ユーザーが設定する endpoints.json は V2 で読み込まれます。一方で、リンク先の endpoints.jsonは V3 用のものになっています。よって、過去のコミットをたどって V2 用の endpoints.json を探します。上記を使って今回は us-east-1/s3 だけを書き換えます。後はこれを実行ディレクトリにコピーされるようにしておきます。ただ、これでは HTTPS での接続になってしまうので、コードは以下のようにする必要があります。上記はコンソールアプリケーション等の実行ファイルと endpoints.json が同じ場所に存在する場合を想定していましたが、テストランナーが別の場所にあるケースがありえます。（というか、fake を使うのはそちらの方が多いと思います）以下のように、なんらか SetUp フェーズで必要に応じて、テスト実行ディレクトリにパスを差し替えてあげるとうまくいきます。（xUnit の場合は調べておらず）今回は S3 を題材にしましたが、LocalStack 等を使えば DynamoDB や他の AWS Sevice の Fake もローカルで実行することができ、動作確認や自動テスト環境に便利に使えます。今回のコードは以下に置いてあります。
https://github.com/dany1468/LocalAwsSample



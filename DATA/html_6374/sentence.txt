More than 3 years have passed since last update.前回、エクスプローラー風の画面で選択している要素の取得までできるものを実装してみた
しかし、このままだと初回起動時にしかルートフォルダを指定できない
現実的には「開く」とかのメニューでルートフォルダを変更することが多々あると思う
そこで今回は動的にルートが変更できるようにしてみたこんな感じでメニューの「開く」ボタンからフォルダを選択して、それをルートにTreeViewを変更する
前回同様MVVM的に作る
※ReactivePropertyを使用
(参考:かずきのBlog@hatena/ReactiveProperty オーバービュー)※Microsoft.WindowsAPICodePack.Dialogsを使用
(参考:中の下の上の真ん中あたり )前回作ったModelを流用したい
でも前回のModelにルートフォルダの変更を通知させる機能を持たせるのは無理っぽい、というか持たせたらおかしい
それならルートフォルダのプロパティ持つ新しいModelを作って、プロパティの変更時(PropertyChanged)に前回のModelを変更すればいけそう！
あとルートフォルダのパスは設定値に保持させたら次回起動時に楽そう
ってことでやってみるまずは前回作ったModel
少し変更そんで今回新しく作るModelまずプロパティは以下の通りんで、コンストラクタではをやっている_WorkingFolderPathのプロパティ変更時にはをしている
これで_WorkingFolderPathの値を変更するだけで_ProjectTreeが更新されるようになった※注意　PropertyChangedは同じ値が入るときには呼ばれない
例えば、設定値から読み込んだパスのフォルダが削除されていて、同じパスで新たにフォルダを作りそのパスを_WorkingFolderPathに入れた時、読み込んだ時の値と同じなのでPropertyChangedが呼ばれずTreeが更新されない現象が発生する
その場合は、新たに値を入れる前に一度空白とかをダミーで入れておくと回避できるコマンドについては、Microsoft.WindowsAPICodePack.Dialogsを使ってフォルダを選択するダイアログを出している
詳細は省くなんの変哲もないただのViewModel
初期化でパスを渡す必要もなくなったのでさらにシンプルになったTreeViewとMenuItemにバインドするだけ
(バインド部以外省略)またまた思いつきでやってみたら案外うまくいった
Modelを持ったModelってどうなの？それはもうViewModelじゃないの？とか思ったけどModelと思い込むことにする
コマンドを増やしていけば「新規作成」とかも簡単に実装できそう



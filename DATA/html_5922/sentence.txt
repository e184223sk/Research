More than 3 years have passed since last update.どうも！無職の進藤京介です！
正確には年明けから無職になりますさて、現在はC#の勉強中ということで倉庫番ゲームを作ってみました
Visual Studio for Mac v7.0.1 で作成しました。
機能としましてはくらいです（少ない）作ったクラスは
Map
オブジェクトを格納する配列を持っています。
ほとんどの処理をこのクラスが行います
オブジェクトの作成　キー入力　プレイヤーの移動と判定等　クリアチェック

GameScene
正直要らないクラスですが作っちゃいました
MapObject
オブジェクトの種類を持っています。
プレイヤー、ゴール、荷物、壁、床、などをenumで持っています。
こちらのクラスのインスタンスがMapクラスの配列に入ります。
Program
最初に呼ばれるmainメソッドを持っていますゲーム出力例
■■■■■■■■■■■■■■
■□□□□□□□□□□□□■
■□□□□□■N□□G□□■
■□□□P□□□□□□□□■
■□□□□D■□□□□□□■
■■■■■■■■■■■■■■P：プレイヤー
N：荷物
G：ゴール
□：床
■：壁
D：ゴールの上にのった荷物ルール
プレイヤーは荷物を押してゴールに運びます。
全てのゴールに荷物を乗せればゲームクリアです。GameSceneでやることを、Programでやっても変わらないですねMapObjectクラスは配列に入れるもので、オブジェクトのタイプをenumで管理します。
コンストラクタでどのOBJ_TYPEにするかを決定させています。やっていることはコメントに書きました。
全てをこのクラスに突っ込んでしまいました。なので汚いコードですステージは四角形である必要があります。
テキストファイルを読み込むと改行コードまで配列に入れてしまうようで、高さと幅で配列の要素数を決定すると、テキストファイルの文字数よりも多くの要素が入ってしまいます。なのでここで改行文字じゃない場合のみ、配列に要素を格納しています。配列には文字列を格納するのではなく、MapObjectを格納し、そのインスタンスが持っているOBJ_TYPEによってコンソールに出力する文字を変えています。移動処理ですが一次元配列なので横長の箱に要素が並んだ状態です
[P][□][□][□][□][□][■][□][□][□][□]□
なので、コンソールで出力すれば1行に表示されてしまいます。そこでMapの幅で改行文字を出力させることで対応しています。上記のようにすれば配列は
[ 0][ 1][ 2][ 3][ 4][ 5]
[ 6][ 7][ 8][ 9][10][11]
[12][13][14][15][16][17]のように並んでいるのです。
そのため移動方向を決めるのは簡単です。7から8に移動するならば1を足す
7から6に移動するならば1を引く
7から13に移動するならば、6を足す(マップの幅)
7から1に移動するならば、6を引く(マップの幅)ということをしています。実は倉庫番作りに悩んでいて、全てをMapクラスに任せるのは心地悪い！と思ったわけです。
最初に作ったのはプレイヤークラスと荷物クラスの基底クラスにポジションプロパティを持たせていました。それはそれでうまくいったのですが荷物を増やした時に、それだとオブジェクトの特定管理が大変だということでListと配列の両方で管理させました。
配列のindex番号とMapObjectのポジションプロパティを紐づけたような管理にしました。結果的に移動処理で入れ替えたりするのが大変で断念。まぁよくわからないことを書きましたが、namespace soukoban3ということで何回か作り直しているということですゲームを作るって難しい。。。けど楽しいゲームプログラマになる前に覚えておきたい技術
実戦で役立つ C#プログラミングのイディオム/定石&amp;パターン今回の倉庫番は
「ゲームプログラマになる前に覚えておきたい技術」のチャプター1-2を読んで参考に作って見ました。
本の部分を読んだだけですが、全体像が掴めたので大変勉強になりました。以上になります。
ありがとうございました。



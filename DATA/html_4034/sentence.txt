More than 1 year has passed since last update.AzureWebAppでstagingスロットを作成し、stagingにデプロイして動作確認してからproductionスロットとスワップするという運用を行うことがあると思います。その際、AzureAD認証を利用しているとproductionとstagingで応答URLが異なるためstagingの認証が通らないことがあります。その問題に対する対応策を記載します。AzureWebAppでstagingスロットを作成して運用する方法
AzureAD認証の仕組み
OpenIdConnectの仕組み開発言語:C#
フレームワーク：ASP.NET MVC
Webサーバー:IISAADアプリケーションの応答URLにproductionとstagingの両方の応答URLを登録します。（2つ登録する）Startup.Auth内で応答URLをWeb.configから読んで設定するようにします。アプリケーション設定にproductionとstagingそれぞれに応答URLをスロット固有の設定として登録します。
WebAppのアプリケーション設定を開き、「ida:RedirectUri」パラメータで応答URLを設定します。
（ここに設定することでアプリのWeb.configの設定が上書きされる。）「スロットの設定」のチェックボックスにチェックを付けます。
このチェックがついているとスロット固有の設定として扱われ、スワップしたときに一緒にスワップされなくなります。
これがないと設定ごとスワップされてしまうので注意してください。これで一つのAADアプリケーションでstagingとproductionどちらも認証できるようになり、stagingで動作確認してスワップするという運用ができるようになります。



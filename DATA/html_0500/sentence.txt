この記事では例外の発生箇所が特定できないパターンをサンプルコードを用いて紹介し、それに対する解決策をまとめます。以下の要件を満たすアプリケーションを考えます。この要件を満たすように以下のように実装したとしましょう。このコードを実行すると以下のような結果になりました。出力結果を見ると、要件は満たせているように見えますが、実はこのコードは例外の発生箇所を特定できるようにするという要件を満たせていません。ログの行番号から発生箇所を特定しようとすると、本来の例外の発生箇所ではない行に行き着いてしまいます。このように新しくnewした例外クラスをスローしてしまうと、本来の例外を上書きし、スタックトレースを消してしまうため、例外の発生箇所が特定できなくなってしまいます。この問題を解決するには、例外クラスをnewする際に本来の例外をInnerExceptionプロパティに持たせるようにします。
自作した例外の場合は下記のように、InnerExceptionに入れておくためのコンストラクタを作成します。この状態でログを出力すると、下記のようなログを出力するようになり、ログの行番号から発生箇所を特定することができるようになります。例外の発生箇所を特定できないパターンとその解決策を紹介しました。
例外処理では本来の例外を消してしまうことがないように十分注意して処理するようにしましょう。それではまた。TomoProg



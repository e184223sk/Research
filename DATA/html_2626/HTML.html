<!DOCTYPE html><html><head><meta charset="utf-8" /><title>OpenTK でテッセレーションして、曲面パッチ間が滑らかに繋がった物体を表示 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/beziex/items/ab1c87918892338eb8df" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="Jf4ju2ZzrYScaQ4QSzT38HHURAAfnaVEPt+kxgO6qeTujJaiCWTt1c04UOvwW9KTUuOCoEgfmxxOVBHfYXArIQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="OpenTK でテッセレーションして、曲面パッチ間が滑らかに繋がった物体を表示 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1UM0JsYmxSTElPT0JwLU9EaHVPRGctT0N1LU9Eck9PRHZPT0N0LU9EcC1PRHMtT0JsLU9CcHVPQWdlYWJzdW1kb3VPRGtlT0RnLU9EZ2VtV2stT0JqT2E3a2VPQ2llT0JpLU9CcS1lNWktT0JqT09Cby1PQm4tZUpxZVM5ay1PQ2t1aWhxT2VrdWcmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NjQ1Nzg4MmYyY2YwZWRlMDdlMjZlMzM2ZGQyODRmMjE&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR0psZW1sbGVBJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9OWY0MDdhZjJkNGJhYWE1ZmNiNjhjMjNiYTNkYjEyYjA&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=ae27f4e0208b47da2a28d59c36bbcc8c"><meta property="og:description" content="

ソースコード

本プログラムのソースコードは、github で公開してます。（MIT ライセンスです）
beziex/Beziex_Op [github] :  (https://github.com/beziex/Beziex_..."><meta content="https://qiita.com/beziex/items/ab1c87918892338eb8df" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,GLSL,OpenTK,tessellation" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-e4dc0ab0-1788-46a7-b1d5-42c7983f95de"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fbeziex%2Fitems%2Fab1c87918892338eb8df">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fbeziex%2Fitems%2Fab1c87918892338eb8df">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-e4dc0ab0-1788-46a7-b1d5-42c7983f95de">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-10-14T17:46:14.000+09:00","dateModified":"2019-10-15T21:53:17.000+09:00","headline":"OpenTK でテッセレーションして、曲面パッチ間が滑らかに繋がった物体を表示","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1UM0JsYmxSTElPT0JwLU9EaHVPRGctT0N1LU9Eck9PRHZPT0N0LU9EcC1PRHMtT0JsLU9CcHVPQWdlYWJzdW1kb3VPRGtlT0RnLU9EZ2VtV2stT0JqT2E3a2VPQ2llT0JpLU9CcS1lNWktT0JqT09Cby1PQm4tZUpxZVM5ay1PQ2t1aWhxT2VrdWcmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NjQ1Nzg4MmYyY2YwZWRlMDdlMjZlMzM2ZGQyODRmMjE\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR0psZW1sbGVBJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9OWY0MDdhZjJkNGJhYWE1ZmNiNjhjMjNiYTNkYjEyYjA\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=ae27f4e0208b47da2a28d59c36bbcc8c","mainEntityOfPage":"https://qiita.com/beziex/items/ab1c87918892338eb8df","author":{"@type":"Person","address":"Tokyo","email":null,"identifier":"beziex","name":"beziex","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F50129982%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=7c74fb117b6ec825e3e50ce915d6550e","url":"https://qiita.com/beziex","description":"CGのモデリング系をプログラミングしてます。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita&amp;utm_medium=header-banner">「最高の開発者体験」を目指す NewsPicks開発チーム</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"beziex","type":"items","id":"ab1c87918892338eb8df"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「最高の開発者体験」を目指す NewsPicks開発チーム","url":"https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"beziex","type":"items","id":"ab1c87918892338eb8df"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「最高の開発者体験」を目指す NewsPicks開発チーム","url":"https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"beziex","type":"items","id":"ab1c87918892338eb8df"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「最高の開発者体験」を目指す NewsPicks開発チーム","url":"https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/beziex/items/ab1c87918892338eb8df","location":"/beziex/items/ab1c87918892338eb8df","scheme":"https","host":"qiita.com","port":null,"pathname":"/beziex/items/ab1c87918892338eb8df","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"/cv5ghZRDhLwImfzWdnRdPqb0S0JK+NYvffS1u9JmlI2uUybeUZOQ6FzOQjitvQX2awXjV6p3QDNfGfPjYMYlw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-4bdb4c1c-85e0-4ee6-ad16-1061c387d0a8"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/beziex/items/ab1c87918892338eb8df/likers" class="css-1iupg5d">2</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">1</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ab1c87918892338eb8df/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/beziex/items/ab1c87918892338eb8df/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/beziex/items/ab1c87918892338eb8df/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/beziex/items/ab1c87918892338eb8df/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/beziex/items/ab1c87918892338eb8df.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/beziex"><img class="css-100alwu eyfquo10" src="https://avatars1.githubusercontent.com/u/50129982?v=4" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/beziex" class="css-10ougpm">@<!-- -->beziex</a><div class="css-1ay9vb9"><span><meta content="2019-10-14T08:46:14Z"/><time dateTime="2019-10-15T12:53:17Z" class="css-m19uds">updated at 2019-10-15</time></span></div></div></div></div></div><h1 class="css-cgzq40">OpenTK でテッセレーションして、曲面パッチ間が滑らかに繋がった物体を表示</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/glsl" class="css-4czcte">GLSL</a><a href="/tags/opentk" class="css-4czcte">OpenTK</a><a href="/tags/tessellation" class="css-4czcte">tessellation</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h2>
<span id="ソースコード" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>ソースコード</h2>

<p>本プログラムのソースコードは、github で公開してます。（MIT ライセンスです）<br>
<a href="https://github.com/beziex/Beziex_Op" rel="nofollow noopener" target="_blank">beziex/Beziex_Op [github] :  (</a><a href="https://github.com/beziex/Beziex_Op" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/beziex/Beziex_Op</a>)</p>

<h2>
<span id="opentk-テッセレーション-ビューワ" class="fragment"></span><a href="#opentk-%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-%E3%83%93%E3%83%A5%E3%83%BC%E3%83%AF"><i class="fa fa-link"></i></a>OpenTK テッセレーション ビューワ</h2>

<p>2ヶ月ほど前に、「独自の高次元曲面パッチデータを WebGL 上でリアルタイムにテッセレーションし、ウェブブラウザに表示する 3Dモデルビューワ」を作ったということで、寄稿させていただきました。</p>

<p><a href="https://qiita.com/beziex/items/d3ad67752dba8cc355c7" id="reference-4458fe5094711d1a16ac">［前編］: WebGL でテッセレーションして、曲面パッチ間が滑らかに繋がった物体を表示（１）</a></p>

<p>今回の投稿も「テッセレーション ビューワ」なのですが WebGL では無く、「OpenTK」で実装しています。よって、Web アプリではありません。（デスクトップアプリケーションです）<br>
ちなみに WebGL 版では、ベースとなっている OpenGL のバージョンの制限からテッセレーションシェーダを使うことが出来ず、バーテックスシェーダとフラグメントシェーダだけでテッセレーションしていました。ジオメトリインスタンシングという方法です。（詳しくは、上記の記事をご参照ください）</p>

<p>しかし OpenTK であれば、OpenGL のバージョン制限はありません。ということで、素直にテッセレーションシェーダを使う方法でプログラミングすることにしました。<br>
でもそれだけだと、テッセレーションシェーダ使用の方が良いのかどうか分かりませんね。そこで、ジオメトリインスタンシング法にも切り替えれるようにして、さらにそれぞれの実行速度も表示できるようにしています。<br>
実行速度の比較が出来れば、どちらが良いか一目瞭然でしょう。</p>

<h2>
<span id="ビルド環境と実行環境" class="fragment"></span><a href="#%E3%83%93%E3%83%AB%E3%83%89%E7%92%B0%E5%A2%83%E3%81%A8%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>ビルド環境と実行環境</h2>

<p>まずビルド環境／実行環境ともに、OS は 64bit 版 Windows のみ（Windows 10 以外は未確認）です。また使用言語は C# となっています。「WebGL 版テッセレーションビューワ」は一応マルチプラットフォームだったので、制限が加わり申し訳ないです。</p>

<p>また WebGL 版では <a href="https://beziex.netlify.com/beziex_we/" rel="nofollow noopener" target="_blank">デモ</a> を用意したので、即座に動きを見ることが出来ましたが、OpenTK 版ではセキュリティ上の観点から実行ファイルは置いていません。<br>
そのため実行させるためには、前もってビルドが必要です。面倒くさくなってしまいましたが、ご容赦願います。</p>

<h2>
<span id="インストールビルド実行" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%83%93%E3%83%AB%E3%83%89%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>インストール／ビルド／実行</h2>

<p>まずビルドの為には、Visual Studio 2019 が必要です。ビルドについては、下記が参考になると思います。<br>
<a href="https://github.com/beziex/Beziex_Op/blob/master/README.md#install-environment-for-build--%E3%83%93%E3%83%AB%E3%83%89%E7%92%B0%E5%A2%83%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" rel="nofollow noopener" target="_blank">Install environment for build / ビルド環境のインストール</a></p>

<p>あとは普通にビルド＆実行できます。実行後の使用方法については、下記をご覧ください。<br>
<a href="https://github.com/beziex/Beziex_Op/blob/master/README.md#usage--%E4%BD%BF%E3%81%84%E6%96%B9" rel="nofollow noopener" target="_blank">Usage ／ 使い方</a></p>

<p>なお上記リンクのページにも書いてますが、起動しただけでは 3D モデルは表示されていないので、「General タブの "Open gzjson" ボタン」を押して、gzjson ファイルを選択します。<br>
例えば「MascuteAzur001.gzjson」を選ぶと、下記のようなウインドウが現れるはずです。(スクリーンショット 左: "General" タブ選択時, 右: "Transform" タブ選択時)<br>
<a href="https://camo.qiitausercontent.com/654a3d2f99c02e461dffd096678239e8914a7b18/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3438323138312f36643566356432382d646338362d663430372d653237302d3066333862383636666161372e706e67" target="_blank" rel="nofollow noopener"><img alt="overview.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482181%2F6d5f5d28-dc86-f407-e270-0f38b866faa7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9849629e99128964536e25879cdc93a5" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/482181/6d5f5d28-dc86-f407-e270-0f38b866faa7.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482181%2F6d5f5d28-dc86-f407-e270-0f38b866faa7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4dffed63242be93c0602566c7ee462ac 1x" loading="lazy"></a><br>
ちなみにこの 3D モデルの元データは、WebGL 版の記事と同じく、<a href="https://twitter.com/thecoolmuseum/status/785896516422471681" rel="nofollow noopener" target="_blank">クールなびじゅつかん館長さんのツイート</a> を使わせていただきました。</p>

<p>ということで、ユーザー寄りの説明はココまで。次項からは、技術的な説明に移りたいと思います。</p>

<h2>
<span id="前知識" class="fragment"></span><a href="#%E5%89%8D%E7%9F%A5%E8%AD%98"><i class="fa fa-link"></i></a>前知識</h2>

<p>WebGL 版の記事と同じことはあまり書きたくないので、WebGL 版では使っていない本プログラム（OpenTK 版）独自の技術について記述します。具体的には、以下の技術です。</p>

<ul>
<li>独自の高次元曲面パッチを、テッセレーションシェーダを使ってテッセレーションする方法</li>
</ul>

<p>ただし多少の前知識は必要なので、前もって WebGL 版記事の下記の項目を読んでおくと分かりやすいと思います。</p>

<p><a href="https://qiita.com/beziex/items/d3ad67752dba8cc355c7#%E9%AB%98%E6%AC%A1%E5%85%83%E6%9B%B2%E9%9D%A2%E3%83%91%E3%83%83%E3%83%81" id="reference-4458fe5094711d1a16ac">高次元曲面パッチ</a><br>
<a href="https://qiita.com/beziex/items/d3ad67752dba8cc355c7#%E6%9B%B2%E9%9D%A2%E3%83%91%E3%83%83%E3%83%81%E3%81%A8%E6%B3%95%E7%B7%9A%E3%81%AE%E9%96%A2%E9%80%A3%E6%80%A7" id="reference-4458fe5094711d1a16ac">曲面パッチと法線の関連性</a><br>
<a href="https://qiita.com/beziex/items/d3ad67752dba8cc355c7#%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E5%86%85%E3%81%A7%E3%81%AE%E6%B3%95%E7%B7%9A%E3%81%AE%E8%A8%88%E7%AE%97" id="reference-4458fe5094711d1a16ac">シェーダ内での法線の計算</a></p>

<h2>
<span id="コントロールポイント組み直し微分値用パラメータ生成の処理" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E7%B5%84%E3%81%BF%E7%9B%B4%E3%81%97%E5%BE%AE%E5%88%86%E5%80%A4%E7%94%A8%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E7%94%9F%E6%88%90%E3%81%AE%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>コントロールポイント組み直し＆微分値用パラメータ生成の処理</h2>

<p>この処理は、WebGL 版記事の下記の項目の前半と同様です。<br>
<a href="https://qiita.com/beziex/items/d3ad67752dba8cc355c7#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E7%B5%84%E3%81%BF%E7%9B%B4%E3%81%97%E5%BE%AE%E5%88%86%E5%80%A4%E7%94%A8%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E7%94%9F%E6%88%90%E3%81%AE%E5%87%A6%E7%90%86" id="reference-4458fe5094711d1a16ac">コントロールポイント組み直し＆微分値用パラメータ生成の処理</a></p>

<p>しかし WebGL 版記事にあるソースコードは TypeScript で書かれているので、本プログラム（C#）での該当箇所を以下に示しました。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">BxGlShadeVbo1.GetPosDiff</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span>  <span class="nf">GetPosDiff</span><span class="p">(</span>
    <span class="n">BxCmSeparatePatch_Object</span> <span class="n">patch</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">surfaceNo</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier3Line3F</span> <span class="n">hPosBez0</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier6Line3F</span> <span class="n">hPosBez1</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier6Line3F</span> <span class="n">hPosBez2</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier3Line3F</span> <span class="n">hPosBez3</span><span class="p">,</span>
    <span class="k">out</span> <span class="n">BxBezier3Line3F</span> <span class="n">vPosBez0</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier6Line3F</span> <span class="n">vPosBez1</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier6Line3F</span> <span class="n">vPosBez2</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier3Line3F</span> <span class="n">vPosBez3</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier2Line3F</span> <span class="n">hDiffBez0</span><span class="p">,</span>
    <span class="k">out</span> <span class="n">BxBezier5Line3F</span> <span class="n">hDiffBez1</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier5Line3F</span> <span class="n">hDiffBez2</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier2Line3F</span> <span class="n">hDiffBez3</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier2Line3F</span> <span class="n">vDiffBez0</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier5Line3F</span> <span class="n">vDiffBez1</span><span class="p">,</span>
    <span class="k">out</span> <span class="n">BxBezier5Line3F</span> <span class="n">vDiffBez2</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier2Line3F</span> <span class="n">vDiffBez3</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="nf">GetPosBezierH</span><span class="p">(</span> <span class="n">patch</span><span class="p">,</span> <span class="n">surfaceNo</span><span class="p">,</span> <span class="k">out</span> <span class="n">hPosBez0</span><span class="p">,</span> <span class="k">out</span> <span class="n">hPosBez1</span><span class="p">,</span> <span class="k">out</span> <span class="n">hPosBez2</span><span class="p">,</span> <span class="k">out</span> <span class="n">hPosBez3</span> <span class="p">);</span>
    <span class="nf">GetPosBezierV</span><span class="p">(</span> <span class="n">patch</span><span class="p">,</span> <span class="n">surfaceNo</span><span class="p">,</span> <span class="k">out</span> <span class="n">vPosBez0</span><span class="p">,</span> <span class="k">out</span> <span class="n">vPosBez1</span><span class="p">,</span> <span class="k">out</span> <span class="n">vPosBez2</span><span class="p">,</span> <span class="k">out</span> <span class="n">vPosBez3</span> <span class="p">);</span>
    <span class="nf">GetDiffBezierH</span><span class="p">(</span> <span class="n">patch</span><span class="p">,</span> <span class="n">surfaceNo</span><span class="p">,</span> <span class="k">out</span> <span class="n">hDiffBez0</span><span class="p">,</span> <span class="k">out</span> <span class="n">hDiffBez1</span><span class="p">,</span> <span class="k">out</span> <span class="n">hDiffBez2</span><span class="p">,</span> <span class="k">out</span> <span class="n">hDiffBez3</span> <span class="p">);</span>
    <span class="nf">GetDiffBezierV</span><span class="p">(</span> <span class="n">patch</span><span class="p">,</span> <span class="n">surfaceNo</span><span class="p">,</span> <span class="k">out</span> <span class="n">vDiffBez0</span><span class="p">,</span> <span class="k">out</span> <span class="n">vDiffBez1</span><span class="p">,</span> <span class="k">out</span> <span class="n">vDiffBez2</span><span class="p">,</span> <span class="k">out</span> <span class="n">vDiffBez3</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>なおこれにより変換後の値は、1パッチ辺り「ベクトル値ベースで 80個」になります。</p>

<h2>
<span id="パラメータの配列化" class="fragment"></span><a href="#%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AE%E9%85%8D%E5%88%97%E5%8C%96"><i class="fa fa-link"></i></a>パラメータの配列化</h2>

<p>WebGL 版ではパラメータ生成後、1パッチ毎に「80個の配列（配列要素はベクトル値）」に変換していました。<br>
しかし OpenTK 版のテッセレーションシェーダを使う方法では少し違います。配列にすることに関しては同じなのですが、</p>

<ul>
<li>配列の個数は1パッチ辺り 6個。ただし配列要素は、14個のメンバ変数（ベクトル値）から成るオブジェクト</li>
</ul>

<p>という形にします。<br>
つまりこれにより $6\times14=84$ で、計84個の値となるわけです。なお必要な個数は 80個なので少し余ることになりますが、余った部分は使わなければ良いだけなので問題ありません。<br>
ちなみに実際のコードでは、「テッセレーション関連の整数値（<code>tessDenom</code>）」も配列に入れてます。これについての詳細は割愛しますが、結果として配列に 81個の値を入れていることになります。</p>

<p>そしてこの処理を行っているのが、同じく <code>BxGlShadeVbo1</code> クラスの <code>SetVertexBufferOne()</code> 関数です。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">BxGlShadeVbo1.SetVertexBufferOne</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span>  <span class="nf">SetVertexBufferOne</span><span class="p">(</span>
    <span class="n">BxBezier3Line3F</span> <span class="n">hPosBez0</span><span class="p">,</span> <span class="n">BxBezier6Line3F</span> <span class="n">hPosBez1</span><span class="p">,</span> <span class="n">BxBezier6Line3F</span> <span class="n">hPosBez2</span><span class="p">,</span> <span class="n">BxBezier3Line3F</span> <span class="n">hPosBez3</span><span class="p">,</span> <span class="n">BxBezier3Line3F</span> <span class="n">vPosBez0</span><span class="p">,</span> <span class="n">BxBezier6Line3F</span> <span class="n">vPosBez1</span><span class="p">,</span>
    <span class="n">BxBezier6Line3F</span> <span class="n">vPosBez2</span><span class="p">,</span> <span class="n">BxBezier3Line3F</span> <span class="n">vPosBez3</span><span class="p">,</span> <span class="n">BxBezier2Line3F</span> <span class="n">hDiffBez0</span><span class="p">,</span> <span class="n">BxBezier5Line3F</span> <span class="n">hDiffBez1</span><span class="p">,</span> <span class="n">BxBezier5Line3F</span> <span class="n">hDiffBez2</span><span class="p">,</span> <span class="n">BxBezier2Line3F</span> <span class="n">hDiffBez3</span><span class="p">,</span>
    <span class="n">BxBezier2Line3F</span> <span class="n">vDiffBez0</span><span class="p">,</span> <span class="n">BxBezier5Line3F</span> <span class="n">vDiffBez1</span><span class="p">,</span> <span class="n">BxBezier5Line3F</span> <span class="n">vDiffBez2</span><span class="p">,</span> <span class="n">BxBezier2Line3F</span> <span class="n">vDiffBez3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tessDenom</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">surfaceNo</span><span class="p">,</span> <span class="n">VertexInfo</span><span class="p">[]</span> <span class="n">vertexAry</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="nf">SetVertexBuffer0</span><span class="p">(</span> <span class="n">hPosBez0</span><span class="p">,</span>  <span class="n">hPosBez1</span><span class="p">,</span>  <span class="n">hDiffBez0</span><span class="p">,</span> <span class="n">surfaceNo</span><span class="p">,</span> <span class="n">vertexAry</span> <span class="p">);</span>
    <span class="nf">SetVertexBuffer1</span><span class="p">(</span> <span class="n">hPosBez2</span><span class="p">,</span>  <span class="n">hPosBez3</span><span class="p">,</span>  <span class="n">hDiffBez3</span><span class="p">,</span> <span class="n">surfaceNo</span><span class="p">,</span> <span class="n">vertexAry</span> <span class="p">);</span>
    <span class="nf">SetVertexBuffer2</span><span class="p">(</span> <span class="n">hDiffBez1</span><span class="p">,</span> <span class="n">hDiffBez2</span><span class="p">,</span> <span class="n">tessDenom</span><span class="p">,</span> <span class="n">surfaceNo</span><span class="p">,</span> <span class="n">vertexAry</span> <span class="p">);</span>
    <span class="nf">SetVertexBuffer3</span><span class="p">(</span> <span class="n">vPosBez0</span><span class="p">,</span>  <span class="n">vPosBez1</span><span class="p">,</span>  <span class="n">vDiffBez0</span><span class="p">,</span> <span class="n">surfaceNo</span><span class="p">,</span> <span class="n">vertexAry</span> <span class="p">);</span>
    <span class="nf">SetVertexBuffer4</span><span class="p">(</span> <span class="n">vPosBez2</span><span class="p">,</span>  <span class="n">vPosBez3</span><span class="p">,</span>  <span class="n">vDiffBez3</span><span class="p">,</span> <span class="n">surfaceNo</span><span class="p">,</span> <span class="n">vertexAry</span> <span class="p">);</span>
    <span class="nf">SetVertexBuffer5</span><span class="p">(</span> <span class="n">vDiffBez1</span><span class="p">,</span> <span class="n">vDiffBez2</span><span class="p">,</span> <span class="n">surfaceNo</span><span class="p">,</span> <span class="n">vertexAry</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>このコードを見ると、<code>SetVertexBuffer0()</code> ～ <code>SetVertexBuffer5()</code> という 6個の関数がありますが、この各関数はそれぞれ別の配列インデックスのオブジェクトに値をセットしています。<br>
例えば <code>SetVertexBuffer0()</code> の中身を見てみると、下記のようになっていることが分かります。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">BxGlShadeVbo1.SetVertexBuffer0</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span>  <span class="nf">SetVertexBuffer0</span><span class="p">(</span> <span class="n">BxBezier3Line3F</span> <span class="n">hPosBez0</span><span class="p">,</span> <span class="n">BxBezier6Line3F</span> <span class="n">hPosBez1</span><span class="p">,</span> <span class="n">BxBezier2Line3F</span> <span class="n">hDiffBez0</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">surfaceNo</span><span class="p">,</span> <span class="n">VertexInfo</span><span class="p">[]</span> <span class="n">vertexAry</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">uint</span>  <span class="n">dstIndex</span> <span class="p">=</span> <span class="p">(</span> <span class="n">surfaceNo</span> <span class="p">*</span> <span class="m">6</span> <span class="p">)</span> <span class="p">+</span> <span class="m">0</span><span class="p">;</span>

    <span class="nf">ToVector3</span><span class="p">(</span> <span class="n">hPosBez0</span><span class="p">[</span> <span class="m">0</span> <span class="p">],</span>  <span class="k">ref</span> <span class="n">vertexAry</span><span class="p">[</span> <span class="n">dstIndex</span> <span class="p">].</span><span class="n">pnt0</span>  <span class="p">);</span>
    <span class="nf">ToVector3</span><span class="p">(</span> <span class="n">hPosBez0</span><span class="p">[</span> <span class="m">1</span> <span class="p">],</span>  <span class="k">ref</span> <span class="n">vertexAry</span><span class="p">[</span> <span class="n">dstIndex</span> <span class="p">].</span><span class="n">pnt1</span>  <span class="p">);</span>
    <span class="nf">ToVector3</span><span class="p">(</span> <span class="n">hPosBez0</span><span class="p">[</span> <span class="m">2</span> <span class="p">],</span>  <span class="k">ref</span> <span class="n">vertexAry</span><span class="p">[</span> <span class="n">dstIndex</span> <span class="p">].</span><span class="n">pnt2</span>  <span class="p">);</span>
    <span class="nf">ToVector3</span><span class="p">(</span> <span class="n">hPosBez0</span><span class="p">[</span> <span class="m">3</span> <span class="p">],</span>  <span class="k">ref</span> <span class="n">vertexAry</span><span class="p">[</span> <span class="n">dstIndex</span> <span class="p">].</span><span class="n">pnt3</span>  <span class="p">);</span>

    <span class="nf">ToVector3</span><span class="p">(</span> <span class="n">hPosBez1</span><span class="p">[</span> <span class="m">0</span> <span class="p">],</span>  <span class="k">ref</span> <span class="n">vertexAry</span><span class="p">[</span> <span class="n">dstIndex</span> <span class="p">].</span><span class="n">pnt4</span>  <span class="p">);</span>
    <span class="nf">ToVector3</span><span class="p">(</span> <span class="n">hPosBez1</span><span class="p">[</span> <span class="m">1</span> <span class="p">],</span>  <span class="k">ref</span> <span class="n">vertexAry</span><span class="p">[</span> <span class="n">dstIndex</span> <span class="p">].</span><span class="n">pnt5</span>  <span class="p">);</span>
    <span class="nf">ToVector3</span><span class="p">(</span> <span class="n">hPosBez1</span><span class="p">[</span> <span class="m">2</span> <span class="p">],</span>  <span class="k">ref</span> <span class="n">vertexAry</span><span class="p">[</span> <span class="n">dstIndex</span> <span class="p">].</span><span class="n">pnt6</span>  <span class="p">);</span>
    <span class="nf">ToVector3</span><span class="p">(</span> <span class="n">hPosBez1</span><span class="p">[</span> <span class="m">3</span> <span class="p">],</span>  <span class="k">ref</span> <span class="n">vertexAry</span><span class="p">[</span> <span class="n">dstIndex</span> <span class="p">].</span><span class="n">pnt7</span>  <span class="p">);</span>
    <span class="nf">ToVector3</span><span class="p">(</span> <span class="n">hPosBez1</span><span class="p">[</span> <span class="m">4</span> <span class="p">],</span>  <span class="k">ref</span> <span class="n">vertexAry</span><span class="p">[</span> <span class="n">dstIndex</span> <span class="p">].</span><span class="n">pnt8</span>  <span class="p">);</span>
    <span class="nf">ToVector3</span><span class="p">(</span> <span class="n">hPosBez1</span><span class="p">[</span> <span class="m">5</span> <span class="p">],</span>  <span class="k">ref</span> <span class="n">vertexAry</span><span class="p">[</span> <span class="n">dstIndex</span> <span class="p">].</span><span class="n">pnt9</span>  <span class="p">);</span>
    <span class="nf">ToVector3</span><span class="p">(</span> <span class="n">hPosBez1</span><span class="p">[</span> <span class="m">6</span> <span class="p">],</span>  <span class="k">ref</span> <span class="n">vertexAry</span><span class="p">[</span> <span class="n">dstIndex</span> <span class="p">].</span><span class="n">pnt10</span> <span class="p">);</span>

    <span class="nf">ToVector3</span><span class="p">(</span> <span class="n">hDiffBez0</span><span class="p">[</span> <span class="m">0</span> <span class="p">],</span> <span class="k">ref</span> <span class="n">vertexAry</span><span class="p">[</span> <span class="n">dstIndex</span> <span class="p">].</span><span class="n">pnt11</span> <span class="p">);</span>
    <span class="nf">ToVector3</span><span class="p">(</span> <span class="n">hDiffBez0</span><span class="p">[</span> <span class="m">1</span> <span class="p">],</span> <span class="k">ref</span> <span class="n">vertexAry</span><span class="p">[</span> <span class="n">dstIndex</span> <span class="p">].</span><span class="n">pnt12</span> <span class="p">);</span>
    <span class="nf">ToVector3</span><span class="p">(</span> <span class="n">hDiffBez0</span><span class="p">[</span> <span class="m">2</span> <span class="p">],</span> <span class="k">ref</span> <span class="n">vertexAry</span><span class="p">[</span> <span class="n">dstIndex</span> <span class="p">].</span><span class="n">pnt13</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>具体的には、<code>pnt0</code> ～ <code>pnt13</code> という 14個のメンバ変数に値を入れていますね。<br>
なお <code>vertexAry</code> は 1パッチ辺りでは「配列 6個分」ですが、実際には全パッチの情報をすべて <code>vertexAry</code> に入れるので、「6$\times$パッチ数」の個数の配列となります。</p>

<h2>
<span id="vbo" class="fragment"></span><a href="#vbo"><i class="fa fa-link"></i></a>VBO</h2>

<p>全パッチについて前項の <code>GetPosDiff()</code> と <code>SetVertexBufferOne()</code> を行い、<code>vertexAry</code> の情報を VBO に転送する処理を行っているのが、<code>BxGlShadeVbo1.SetVertexBuffer()</code> です。<br>
そしてこの関数内の <code>GL.BufferData()</code> が、実際に転送を行っている箇所になります。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">BxGlShadeVbo1.SetVertexBuffer</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span>  <span class="nf">SetVertexBuffer</span><span class="p">(</span> <span class="n">BxCmSeparatePatch_Object</span> <span class="n">patch</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">Buf</span><span class="p">.</span><span class="nf">HasVertexBuffer</span><span class="p">()</span> <span class="p">==</span> <span class="k">true</span> <span class="p">)</span>
        <span class="n">Buf</span><span class="p">.</span><span class="nf">ReleaseVertexBuffer</span><span class="p">();</span>

    <span class="n">Buf</span><span class="p">.</span><span class="n">NumVertices</span> <span class="p">=</span> <span class="p">(</span> <span class="kt">int</span> <span class="p">)(</span> <span class="n">patch</span><span class="p">.</span><span class="n">NumSurface</span> <span class="p">*</span> <span class="m">6</span> <span class="p">);</span>

    <span class="n">VertexInfo</span><span class="p">[]</span> <span class="n">vertexAry</span> <span class="p">=</span> <span class="k">new</span> <span class="n">VertexInfo</span><span class="p">[</span> <span class="n">Buf</span><span class="p">.</span><span class="n">NumVertices</span> <span class="p">];</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">uint</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span> <span class="n">i</span><span class="p">&lt;</span><span class="n">patch</span><span class="p">.</span><span class="n">NumSurface</span><span class="p">;</span> <span class="n">i</span><span class="p">++</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nf">GetPosDiff</span><span class="p">(</span> <span class="n">patch</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier3Line3F</span> <span class="n">hPosBez0</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier6Line3F</span> <span class="n">hPosBez1</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier6Line3F</span> <span class="n">hPosBez2</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier3Line3F</span> <span class="n">hPosBez3</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier3Line3F</span> <span class="n">vPosBez0</span><span class="p">,</span>
            <span class="k">out</span> <span class="n">BxBezier6Line3F</span> <span class="n">vPosBez1</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier6Line3F</span> <span class="n">vPosBez2</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier3Line3F</span> <span class="n">vPosBez3</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier2Line3F</span> <span class="n">hDiffBez0</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier5Line3F</span> <span class="n">hDiffBez1</span><span class="p">,</span>
            <span class="k">out</span> <span class="n">BxBezier5Line3F</span> <span class="n">hDiffBez2</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier2Line3F</span> <span class="n">hDiffBez3</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier2Line3F</span> <span class="n">vDiffBez0</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier5Line3F</span> <span class="n">vDiffBez1</span><span class="p">,</span> <span class="k">out</span> <span class="n">BxBezier5Line3F</span> <span class="n">vDiffBez2</span><span class="p">,</span>
            <span class="k">out</span> <span class="n">BxBezier2Line3F</span> <span class="n">vDiffBez3</span> <span class="p">);</span>

        <span class="kt">int</span>  <span class="n">tessDenom</span> <span class="p">=</span> <span class="nf">GetTessDenom</span><span class="p">(</span> <span class="n">patch</span><span class="p">,</span> <span class="n">i</span> <span class="p">);</span>

        <span class="nf">SetVertexBufferOne</span><span class="p">(</span> <span class="n">hPosBez0</span><span class="p">,</span> <span class="n">hPosBez1</span><span class="p">,</span> <span class="n">hPosBez2</span><span class="p">,</span> <span class="n">hPosBez3</span><span class="p">,</span> <span class="n">vPosBez0</span><span class="p">,</span> <span class="n">vPosBez1</span><span class="p">,</span> <span class="n">vPosBez2</span><span class="p">,</span> <span class="n">vPosBez3</span><span class="p">,</span> <span class="n">hDiffBez0</span><span class="p">,</span> <span class="n">hDiffBez1</span><span class="p">,</span> <span class="n">hDiffBez2</span><span class="p">,</span> <span class="n">hDiffBez3</span><span class="p">,</span> <span class="n">vDiffBez0</span><span class="p">,</span> <span class="n">vDiffBez1</span><span class="p">,</span>
                            <span class="n">vDiffBez2</span><span class="p">,</span> <span class="n">vDiffBez3</span><span class="p">,</span> <span class="n">tessDenom</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">vertexAry</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="n">GL</span><span class="p">.</span><span class="nf">GenBuffers</span><span class="p">(</span> <span class="m">1</span><span class="p">,</span> <span class="n">Buf</span><span class="p">.</span><span class="n">VboID</span> <span class="p">);</span>

    <span class="n">GL</span><span class="p">.</span><span class="nf">BindBuffer</span><span class="p">(</span> <span class="n">BufferTarget</span><span class="p">.</span><span class="n">ArrayBuffer</span><span class="p">,</span> <span class="n">Buf</span><span class="p">.</span><span class="n">VboID</span><span class="p">[</span> <span class="m">0</span> <span class="p">]</span> <span class="p">);</span>
    <span class="n">GL</span><span class="p">.</span><span class="nf">BufferData</span><span class="p">(</span> <span class="n">BufferTarget</span><span class="p">.</span><span class="n">ArrayBuffer</span><span class="p">,</span> <span class="k">new</span> <span class="nf">IntPtr</span><span class="p">(</span> <span class="n">Buf</span><span class="p">.</span><span class="n">NumVertices</span> <span class="p">*</span> <span class="n">VertexInfo</span><span class="p">.</span><span class="n">Length</span> <span class="p">),</span> <span class="n">vertexAry</span><span class="p">,</span> <span class="n">BufferUsageHint</span><span class="p">.</span><span class="n">StaticDraw</span> <span class="p">);</span>

    <span class="n">GL</span><span class="p">.</span><span class="nf">BindBuffer</span><span class="p">(</span> <span class="n">BufferTarget</span><span class="p">.</span><span class="n">ArrayBuffer</span><span class="p">,</span> <span class="m">0</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="vao" class="fragment"></span><a href="#vao"><i class="fa fa-link"></i></a>VAO</h2>

<p>前項で、<code>GL.BufferData()</code> により「<code>vertexAry</code> の情報を VBO に転送」しましたが、実際には <code>vertexAry</code> の各要素は、14個のメンバ変数から成るオブジェクトです。そのためバーテックスシェーダのコード内では、「14個の中の任意の値が、どのメンバ変数と対応しているか」を知っていなければなりません。<br>
これを行うための OpenGL 上での仕組みが VAO で、本プログラムでは <code>BxGlShadeVbo1.SetVAO()</code> でこれを行っています。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">BxGlShadeVbo1.SetVAO</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span>  <span class="nf">SetVAO</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">GL</span><span class="p">.</span><span class="nf">GenVertexArrays</span><span class="p">(</span> <span class="m">1</span><span class="p">,</span> <span class="k">out</span> <span class="n">Buf</span><span class="p">.</span><span class="n">VaoHandle</span><span class="p">[</span> <span class="m">0</span> <span class="p">]</span> <span class="p">);</span>
    <span class="n">GL</span><span class="p">.</span><span class="nf">BindVertexArray</span><span class="p">(</span> <span class="n">Buf</span><span class="p">.</span><span class="n">VaoHandle</span><span class="p">[</span> <span class="m">0</span> <span class="p">]</span> <span class="p">);</span>

    <span class="n">GL</span><span class="p">.</span><span class="nf">BindBuffer</span><span class="p">(</span> <span class="n">BufferTarget</span><span class="p">.</span><span class="n">ArrayBuffer</span><span class="p">,</span> <span class="n">Buf</span><span class="p">.</span><span class="n">VboID</span><span class="p">[</span> <span class="m">0</span> <span class="p">]</span> <span class="p">);</span>

    <span class="kt">int</span>  <span class="n">pnt0Location</span>  <span class="p">=</span> <span class="n">GL</span><span class="p">.</span><span class="nf">GetAttribLocation</span><span class="p">(</span> <span class="n">fProgramObj</span><span class="p">.</span><span class="nf">ShaderProgramID</span><span class="p">(),</span> <span class="s">"vertPnt0"</span>  <span class="p">);</span>
    <span class="kt">int</span>  <span class="n">pnt1Location</span>  <span class="p">=</span> <span class="n">GL</span><span class="p">.</span><span class="nf">GetAttribLocation</span><span class="p">(</span> <span class="n">fProgramObj</span><span class="p">.</span><span class="nf">ShaderProgramID</span><span class="p">(),</span> <span class="s">"vertPnt1"</span>  <span class="p">);</span>
                          <span class="p">:</span>
    <span class="kt">int</span>  <span class="n">pnt12Location</span> <span class="p">=</span> <span class="n">GL</span><span class="p">.</span><span class="nf">GetAttribLocation</span><span class="p">(</span> <span class="n">fProgramObj</span><span class="p">.</span><span class="nf">ShaderProgramID</span><span class="p">(),</span> <span class="s">"vertPnt12"</span> <span class="p">);</span>
    <span class="kt">int</span>  <span class="n">pnt13Location</span> <span class="p">=</span> <span class="n">GL</span><span class="p">.</span><span class="nf">GetAttribLocation</span><span class="p">(</span> <span class="n">fProgramObj</span><span class="p">.</span><span class="nf">ShaderProgramID</span><span class="p">(),</span> <span class="s">"vertPnt13"</span> <span class="p">);</span>

    <span class="n">GL</span><span class="p">.</span><span class="nf">EnableVertexAttribArray</span><span class="p">(</span> <span class="n">pnt0Location</span>  <span class="p">);</span>
    <span class="n">GL</span><span class="p">.</span><span class="nf">EnableVertexAttribArray</span><span class="p">(</span> <span class="n">pnt1Location</span>  <span class="p">);</span>
                          <span class="p">:</span>
    <span class="n">GL</span><span class="p">.</span><span class="nf">EnableVertexAttribArray</span><span class="p">(</span> <span class="n">pnt12Location</span> <span class="p">);</span>
    <span class="n">GL</span><span class="p">.</span><span class="nf">EnableVertexAttribArray</span><span class="p">(</span> <span class="n">pnt13Location</span> <span class="p">);</span>

    <span class="n">GL</span><span class="p">.</span><span class="nf">VertexAttribPointer</span><span class="p">(</span> <span class="n">pnt0Location</span><span class="p">,</span>  <span class="m">3</span><span class="p">,</span> <span class="n">VertexAttribPointerType</span><span class="p">.</span><span class="n">Float</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="n">VertexInfo</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="m">0</span> <span class="p">);</span>
    <span class="n">GL</span><span class="p">.</span><span class="nf">VertexAttribPointer</span><span class="p">(</span> <span class="n">pnt1Location</span><span class="p">,</span>  <span class="m">3</span><span class="p">,</span> <span class="n">VertexAttribPointerType</span><span class="p">.</span><span class="n">Float</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="n">VertexInfo</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="p">(</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">SizeInBytes</span> <span class="p">*</span> <span class="m">1</span>  <span class="p">)</span> <span class="p">);</span>
                          <span class="p">:</span>
    <span class="n">GL</span><span class="p">.</span><span class="nf">VertexAttribPointer</span><span class="p">(</span> <span class="n">pnt12Location</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="n">VertexAttribPointerType</span><span class="p">.</span><span class="n">Float</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="n">VertexInfo</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="p">(</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">SizeInBytes</span> <span class="p">*</span> <span class="m">12</span> <span class="p">)</span> <span class="p">);</span>
    <span class="n">GL</span><span class="p">.</span><span class="nf">VertexAttribPointer</span><span class="p">(</span> <span class="n">pnt13Location</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="n">VertexAttribPointerType</span><span class="p">.</span><span class="n">Float</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="n">VertexInfo</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="p">(</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">SizeInBytes</span> <span class="p">*</span> <span class="m">13</span> <span class="p">)</span> <span class="p">);</span>

    <span class="n">GL</span><span class="p">.</span><span class="nf">BindVertexArray</span><span class="p">(</span> <span class="m">0</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>具体的には、</p>

<ol>
<li>
<code>GL.GetAttribLocation()</code> で「バーテックスシェーダ コード内の入力変数」を attribute location という ID の形で求める。</li>
<li>
<code>GL.EnableVertexAttribArray()</code> で、指定した attribute location を有効化する。</li>
<li>
<code>GL.VertexAttribPointer()</code> で、attribute location と「バーテックスデータのパッチ内におけるオフセット」を結びつける。</li>
</ol>

<p>ということにより、対応付けが成されるわけです。<br>
なお上記コードを見ると「バーテックスシェーダ コード内の入力変数」として、<code>vertPnt0</code> ～ <code>vertPnt13</code> が定義されていることが分かります。そしてこの変数名は、この後バーテックスシェーダのコードを説明する際にも出てくることになります。</p>

<h2>
<span id="ドローコール" class="fragment"></span><a href="#%E3%83%89%E3%83%AD%E3%83%BC%E3%82%B3%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>ドローコール</h2>

<p>CPU 側では、前項までで各種設定を行ってきました。そして最後にドローコールすることにより、実際に 3D モデルが表示されることになります。<br>
これをやっているのが <code>BxGlShaderBase</code> クラスの <code>DrawMain()</code> 関数です。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">BxGlShaderBase.DrawMain</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">virtual</span> <span class="k">protected</span> <span class="k">void</span>  <span class="nf">DrawMain</span><span class="p">(</span> <span class="n">BxCmUiParam</span> <span class="n">param</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="nf">SetFaceColor</span><span class="p">();</span>

    <span class="nf">PatchParameter</span><span class="p">();</span>

    <span class="n">GL</span><span class="p">.</span><span class="nf">BindVertexArray</span><span class="p">(</span> <span class="n">Buf</span><span class="p">.</span><span class="n">VaoHandle</span><span class="p">[</span> <span class="m">0</span> <span class="p">]</span> <span class="p">);</span>
    <span class="nf">BeginBenchmark</span><span class="p">(</span> <span class="n">param</span> <span class="p">);</span>

    <span class="n">GL</span><span class="p">.</span><span class="nf">DrawArrays</span><span class="p">(</span> <span class="n">PrimitiveType</span><span class="p">.</span><span class="n">Patches</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">Buf</span><span class="p">.</span><span class="n">NumVertices</span> <span class="p">);</span>

    <span class="nf">EndBenchmark</span><span class="p">(</span> <span class="n">param</span> <span class="p">);</span>
    <span class="n">GL</span><span class="p">.</span><span class="nf">BindVertexArray</span><span class="p">(</span> <span class="m">0</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>この中で重要なのは、OpenGL（OpenTK）の Draw 系関数である <code>GL.DrawArrays()</code> となります。<br>
さらに <code>GL.DrawArrays()</code> の引数として <code>PrimitiveType.Patches</code> を指定していることにご注目ください。この指定により、テッセレーション系シェーダが使われることになります。</p>

<h2>
<span id="バーテックスシェーダ" class="fragment"></span><a href="#%E3%83%90%E3%83%BC%E3%83%86%E3%83%83%E3%82%AF%E3%82%B9%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80"><i class="fa fa-link"></i></a>バーテックスシェーダ</h2>

<p>ここでようやく GPU 側のプログラムに入ってきました。まずはバーテックスシェーダです。</p>

<div class="code-frame" data-lang="glsl">
<div class="code-lang"><span class="bold">（bxViewVbo1.vert）</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cp">#version 400
</span>
<span class="k">in</span> <span class="kt">vec3</span>  <span class="n">vertPnt0</span><span class="p">;</span>
<span class="k">in</span> <span class="kt">vec3</span>  <span class="n">vertPnt1</span><span class="p">;</span>
            <span class="o">:</span>
<span class="k">in</span> <span class="kt">vec3</span>  <span class="n">vertPnt12</span><span class="p">;</span>
<span class="k">in</span> <span class="kt">vec3</span>  <span class="n">vertPnt13</span><span class="p">;</span>

<span class="k">out</span> <span class="kt">vec3</span>  <span class="n">tescPnt0</span><span class="p">;</span>
<span class="k">out</span> <span class="kt">vec3</span>  <span class="n">tescPnt1</span><span class="p">;</span>
            <span class="o">:</span>
<span class="k">out</span> <span class="kt">vec3</span>  <span class="n">tescPnt12</span><span class="p">;</span>
<span class="k">out</span> <span class="kt">vec3</span>  <span class="n">tescPnt13</span><span class="p">;</span>


<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">tescPnt0</span>  <span class="o">=</span> <span class="n">vertPnt0</span><span class="p">;</span>
    <span class="n">tescPnt1</span>  <span class="o">=</span> <span class="n">vertPnt1</span><span class="p">;</span>
            <span class="o">:</span>
    <span class="n">tescPnt12</span> <span class="o">=</span> <span class="n">vertPnt12</span><span class="p">;</span>
    <span class="n">tescPnt13</span> <span class="o">=</span> <span class="n">vertPnt13</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>このバーテックスシェーダのコードは、上記を見てわかるように大したことは行っていません。入力変数である <code>vertPnt0</code> ～ <code>vertPnt13</code> の値を、出力変数の <code>tescPnt0</code> ～ <code>tescPnt13</code> に代入しているだけです。</p>

<p>ただ <code>vertPnt0</code> ～ <code>vertPnt13</code> という変数名が、前述した <a href="https://qiita.com/beziex/items/ab1c87918892338eb8df#vao">VAO</a> の項にも出てくることについては注目する必要があります。<br>
すなわち CPU 側のバーテックスバッファである <code>vertexAry</code> 配列について、配列の各要素の 14個のメンバ変数が、GPU 側では <code>vertPnt0</code> ～ <code>vertPnt13</code> という変数になるわけです。</p>

<h2>
<span id="テッセレーションコントロールシェーダ" class="fragment"></span><a href="#%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80"><i class="fa fa-link"></i></a>テッセレーション・コントロールシェーダ</h2>

<p>次に実行されるのは「テッセレーション・コントロールシェーダ」ですが、これも大したことはしていません。</p>

<div class="code-frame" data-lang="glsl">
<div class="code-lang"><span class="bold">（bxViewVbo1.tesc）</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cp">#version 400
</span>
<span class="k">layout</span><span class="p">(</span> <span class="n">vertices</span> <span class="o">=</span> <span class="mi">6</span> <span class="p">)</span> <span class="k">out</span><span class="p">;</span>

<span class="k">in</span> <span class="kt">vec3</span>  <span class="n">tescPnt0</span><span class="p">[];</span>
<span class="k">in</span> <span class="kt">vec3</span>  <span class="n">tescPnt1</span><span class="p">[];</span>
            <span class="o">:</span>
<span class="k">in</span> <span class="kt">vec3</span>  <span class="n">tescPnt12</span><span class="p">[];</span>
<span class="k">in</span> <span class="kt">vec3</span>  <span class="n">tescPnt13</span><span class="p">[];</span>

<span class="k">out</span> <span class="kt">vec3</span>  <span class="n">tesePnt0</span><span class="p">[];</span>
<span class="k">out</span> <span class="kt">vec3</span>  <span class="n">tesePnt1</span><span class="p">[];</span>
            <span class="o">:</span>
<span class="k">out</span> <span class="kt">vec3</span>  <span class="n">tesePnt12</span><span class="p">[];</span>
<span class="k">out</span> <span class="kt">vec3</span>  <span class="n">tesePnt13</span><span class="p">[];</span>

<span class="k">uniform</span> <span class="kt">float</span>  <span class="n">tessLevel</span><span class="p">;</span>


<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">tesePnt0</span><span class="p">[</span>  <span class="nb">gl_InvocationID</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tescPnt0</span><span class="p">[</span>  <span class="nb">gl_InvocationID</span> <span class="p">];</span>
    <span class="n">tesePnt1</span><span class="p">[</span>  <span class="nb">gl_InvocationID</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tescPnt1</span><span class="p">[</span>  <span class="nb">gl_InvocationID</span> <span class="p">];</span>
                           <span class="o">:</span>
    <span class="n">tesePnt12</span><span class="p">[</span> <span class="nb">gl_InvocationID</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tescPnt12</span><span class="p">[</span> <span class="nb">gl_InvocationID</span> <span class="p">];</span>
    <span class="n">tesePnt13</span><span class="p">[</span> <span class="nb">gl_InvocationID</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tescPnt13</span><span class="p">[</span> <span class="nb">gl_InvocationID</span> <span class="p">];</span>

    <span class="k">if</span><span class="p">(</span> <span class="nb">gl_InvocationID</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kt">float</span>  <span class="n">tessDenom</span> <span class="o">=</span> <span class="n">tescPnt12</span><span class="p">[</span> <span class="mi">2</span> <span class="p">].</span><span class="n">x</span><span class="p">;</span>

        <span class="nb">gl_TessLevelOuter</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tessLevel</span> <span class="o">/</span> <span class="n">tessDenom</span><span class="p">;</span>
        <span class="nb">gl_TessLevelOuter</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tessLevel</span> <span class="o">/</span> <span class="n">tessDenom</span><span class="p">;</span>
        <span class="nb">gl_TessLevelOuter</span><span class="p">[</span> <span class="mi">2</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tessLevel</span> <span class="o">/</span> <span class="n">tessDenom</span><span class="p">;</span>
        <span class="nb">gl_TessLevelOuter</span><span class="p">[</span> <span class="mi">3</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tessLevel</span> <span class="o">/</span> <span class="n">tessDenom</span><span class="p">;</span>

        <span class="nb">gl_TessLevelInner</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tessLevel</span> <span class="o">/</span> <span class="n">tessDenom</span><span class="p">;</span>
        <span class="nb">gl_TessLevelInner</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tessLevel</span> <span class="o">/</span> <span class="n">tessDenom</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>以下のように、</p>

<ol>
<li>入力変数の <code>tescPnt0[gl_InvocationID]</code> ～ <code>tescPnt13[gl_InvocationID]</code> の値を、出力変数の <code>tesePnt0[gl_InvocationID]</code> ～ <code>tesePnt13[gl_InvocationID]</code> に代入する。</li>
<li>パッチ境界の分割数（<code>gl_TessLevelOuter</code>）と、パッチ内部の分割数（<code>gl_TessLevelInner</code>）を指定する。</li>
</ol>

<p>を行っているだけです。</p>

<h2>
<span id="テッセレーションエバリュエーションシェーダfromvbo" class="fragment"></span><a href="#%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%A8%E3%83%90%E3%83%AA%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80fromvbo"><i class="fa fa-link"></i></a>テッセレーション・エバリュエーションシェーダ（<code>fromVbo</code>）</h2>

<p>そして「テッセレーション・エバリュエーションシェーダ」のコードが実行されますが、これが GPU 側プログラムの要となります。<br>
まずここでは、<code>fromVbo()</code> という関数を見てみましょう。</p>

<div class="code-frame" data-lang="glsl">
<div class="code-lang"><span class="bold">（bxViewVbo1.tese）fromVbo</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">void</span> <span class="nf">fromVbo</span><span class="p">(</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">hPosBez0</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">hPosBez1</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">hPosBez2</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">hPosBez3</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">vPosBez0</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">vPosBez1</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">vPosBez2</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">vPosBez3</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
              <span class="k">out</span> <span class="kt">vec3</span> <span class="n">hDiffBez0</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">hDiffBez1</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">hDiffBez2</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">hDiffBez3</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">vDiffBez0</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">vDiffBez1</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">vDiffBez2</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">vDiffBez3</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">hPosBez0</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt0</span><span class="p">[</span>  <span class="mi">0</span> <span class="p">];</span>
    <span class="n">hPosBez0</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt1</span><span class="p">[</span>  <span class="mi">0</span> <span class="p">];</span>
    <span class="n">hPosBez0</span><span class="p">[</span> <span class="mi">2</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt2</span><span class="p">[</span>  <span class="mi">0</span> <span class="p">];</span>
    <span class="n">hPosBez0</span><span class="p">[</span> <span class="mi">3</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt3</span><span class="p">[</span>  <span class="mi">0</span> <span class="p">];</span>

    <span class="n">hPosBez1</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt4</span><span class="p">[</span>  <span class="mi">0</span> <span class="p">];</span>
    <span class="n">hPosBez1</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt5</span><span class="p">[</span>  <span class="mi">0</span> <span class="p">];</span>
                  <span class="o">:</span>
    <span class="n">hPosBez1</span><span class="p">[</span> <span class="mi">5</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt9</span><span class="p">[</span>  <span class="mi">0</span> <span class="p">];</span>
    <span class="n">hPosBez1</span><span class="p">[</span> <span class="mi">6</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt10</span><span class="p">[</span> <span class="mi">0</span> <span class="p">];</span>

    <span class="n">hPosBez2</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt0</span><span class="p">[</span>  <span class="mi">1</span> <span class="p">];</span>
    <span class="n">hPosBez2</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt1</span><span class="p">[</span>  <span class="mi">1</span> <span class="p">];</span>
                  <span class="o">:</span>
    <span class="n">hPosBez2</span><span class="p">[</span> <span class="mi">5</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt5</span><span class="p">[</span>  <span class="mi">1</span> <span class="p">];</span>
    <span class="n">hPosBez2</span><span class="p">[</span> <span class="mi">6</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt6</span><span class="p">[</span>  <span class="mi">1</span> <span class="p">];</span>

    <span class="n">hPosBez3</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt7</span><span class="p">[</span>  <span class="mi">1</span> <span class="p">];</span>
    <span class="n">hPosBez3</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt8</span><span class="p">[</span>  <span class="mi">1</span> <span class="p">];</span>
    <span class="n">hPosBez3</span><span class="p">[</span> <span class="mi">2</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt9</span><span class="p">[</span>  <span class="mi">1</span> <span class="p">];</span>
    <span class="n">hPosBez3</span><span class="p">[</span> <span class="mi">3</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt10</span><span class="p">[</span> <span class="mi">1</span> <span class="p">];</span>

    <span class="n">vPosBez0</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt0</span><span class="p">[</span>  <span class="mi">3</span> <span class="p">];</span>
    <span class="n">vPosBez0</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt1</span><span class="p">[</span>  <span class="mi">3</span> <span class="p">];</span>
    <span class="n">vPosBez0</span><span class="p">[</span> <span class="mi">2</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt2</span><span class="p">[</span>  <span class="mi">3</span> <span class="p">];</span>
    <span class="n">vPosBez0</span><span class="p">[</span> <span class="mi">3</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt3</span><span class="p">[</span>  <span class="mi">3</span> <span class="p">];</span>

    <span class="n">vPosBez1</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt4</span><span class="p">[</span>  <span class="mi">3</span> <span class="p">];</span>
    <span class="n">vPosBez1</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt5</span><span class="p">[</span>  <span class="mi">3</span> <span class="p">];</span>
                  <span class="o">:</span>
    <span class="n">vPosBez1</span><span class="p">[</span> <span class="mi">5</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt9</span><span class="p">[</span>  <span class="mi">3</span> <span class="p">];</span>
    <span class="n">vPosBez1</span><span class="p">[</span> <span class="mi">6</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt10</span><span class="p">[</span> <span class="mi">3</span> <span class="p">];</span>

    <span class="n">vPosBez2</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt0</span><span class="p">[</span>  <span class="mi">4</span> <span class="p">];</span>
    <span class="n">vPosBez2</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt1</span><span class="p">[</span>  <span class="mi">4</span> <span class="p">];</span>
                  <span class="o">:</span>
    <span class="n">vPosBez2</span><span class="p">[</span> <span class="mi">5</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt5</span><span class="p">[</span>  <span class="mi">4</span> <span class="p">];</span>
    <span class="n">vPosBez2</span><span class="p">[</span> <span class="mi">6</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt6</span><span class="p">[</span>  <span class="mi">4</span> <span class="p">];</span>

    <span class="n">vPosBez3</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt7</span><span class="p">[</span>  <span class="mi">4</span> <span class="p">];</span>
    <span class="n">vPosBez3</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt8</span><span class="p">[</span>  <span class="mi">4</span> <span class="p">];</span>
    <span class="n">vPosBez3</span><span class="p">[</span> <span class="mi">2</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt9</span><span class="p">[</span>  <span class="mi">4</span> <span class="p">];</span>
    <span class="n">vPosBez3</span><span class="p">[</span> <span class="mi">3</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt10</span><span class="p">[</span> <span class="mi">4</span> <span class="p">];</span>

    <span class="n">hDiffBez0</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt11</span><span class="p">[</span> <span class="mi">0</span> <span class="p">];</span>
    <span class="n">hDiffBez0</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt12</span><span class="p">[</span> <span class="mi">0</span> <span class="p">];</span>
    <span class="n">hDiffBez0</span><span class="p">[</span> <span class="mi">2</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt13</span><span class="p">[</span> <span class="mi">0</span> <span class="p">];</span>

    <span class="n">hDiffBez1</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt0</span><span class="p">[</span>  <span class="mi">2</span> <span class="p">];</span>
    <span class="n">hDiffBez1</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt1</span><span class="p">[</span>  <span class="mi">2</span> <span class="p">];</span>
                   <span class="o">:</span>
    <span class="n">hDiffBez1</span><span class="p">[</span> <span class="mi">4</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt4</span><span class="p">[</span>  <span class="mi">2</span> <span class="p">];</span>
    <span class="n">hDiffBez1</span><span class="p">[</span> <span class="mi">5</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt5</span><span class="p">[</span>  <span class="mi">2</span> <span class="p">];</span>

    <span class="n">hDiffBez2</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt6</span><span class="p">[</span>  <span class="mi">2</span> <span class="p">];</span>
    <span class="n">hDiffBez2</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt7</span><span class="p">[</span>  <span class="mi">2</span> <span class="p">];</span>
                   <span class="o">:</span>
    <span class="n">hDiffBez2</span><span class="p">[</span> <span class="mi">4</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt10</span><span class="p">[</span> <span class="mi">2</span> <span class="p">];</span>
    <span class="n">hDiffBez2</span><span class="p">[</span> <span class="mi">5</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt11</span><span class="p">[</span> <span class="mi">2</span> <span class="p">];</span>

    <span class="n">hDiffBez3</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt11</span><span class="p">[</span> <span class="mi">1</span> <span class="p">];</span>
    <span class="n">hDiffBez3</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt12</span><span class="p">[</span> <span class="mi">1</span> <span class="p">];</span>
    <span class="n">hDiffBez3</span><span class="p">[</span> <span class="mi">2</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt13</span><span class="p">[</span> <span class="mi">1</span> <span class="p">];</span>

    <span class="n">vDiffBez0</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt11</span><span class="p">[</span> <span class="mi">3</span> <span class="p">];</span>
    <span class="n">vDiffBez0</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt12</span><span class="p">[</span> <span class="mi">3</span> <span class="p">];</span>
    <span class="n">vDiffBez0</span><span class="p">[</span> <span class="mi">2</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt13</span><span class="p">[</span> <span class="mi">3</span> <span class="p">];</span>

    <span class="n">vDiffBez1</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt0</span><span class="p">[</span>  <span class="mi">5</span> <span class="p">];</span>
    <span class="n">vDiffBez1</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt1</span><span class="p">[</span>  <span class="mi">5</span> <span class="p">];</span>
                   <span class="o">:</span>
    <span class="n">vDiffBez1</span><span class="p">[</span> <span class="mi">4</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt4</span><span class="p">[</span>  <span class="mi">5</span> <span class="p">];</span>
    <span class="n">vDiffBez1</span><span class="p">[</span> <span class="mi">5</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt5</span><span class="p">[</span>  <span class="mi">5</span> <span class="p">];</span>

    <span class="n">vDiffBez2</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt6</span><span class="p">[</span>  <span class="mi">5</span> <span class="p">];</span>
    <span class="n">vDiffBez2</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt7</span><span class="p">[</span>  <span class="mi">5</span> <span class="p">];</span>
                   <span class="o">:</span>
    <span class="n">vDiffBez2</span><span class="p">[</span> <span class="mi">4</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt10</span><span class="p">[</span> <span class="mi">5</span> <span class="p">];</span>
    <span class="n">vDiffBez2</span><span class="p">[</span> <span class="mi">5</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt11</span><span class="p">[</span> <span class="mi">5</span> <span class="p">];</span>

    <span class="n">vDiffBez3</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt11</span><span class="p">[</span> <span class="mi">4</span> <span class="p">];</span>
    <span class="n">vDiffBez3</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt12</span><span class="p">[</span> <span class="mi">4</span> <span class="p">];</span>
    <span class="n">vDiffBez3</span><span class="p">[</span> <span class="mi">2</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tesePnt13</span><span class="p">[</span> <span class="mi">4</span> <span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>この関数は、入力変数 <code>tesePnt0[i]</code> ～ <code>tesePnt13[i]</code>（<code>i</code> は 0～5）を、<code>hPosBez0</code>、<code>vDiffBez3</code> 等といった「3次または6次のベジェ曲線」「2次または5次の微分値用ベジェ曲線」に代入するためのものです。<br>
なおこれら複数のベジェ曲線によって、独自高次元曲面パッチ（Beziex パッチ）が生成されるわけですが、これに関する式については下記を参照ください。<br>
<a href="https://qiita.com/beziex/items/d913102ca03266996a0e#%E7%8B%AC%E8%87%AA%E9%AB%98%E6%AC%A1%E5%85%83%E6%9B%B2%E9%9D%A2%E3%83%91%E3%83%83%E3%83%81%E3%81%AE%E6%A6%82%E8%A6%81" id="reference-a77a299f6e7d9487a535">独自高次元曲面パッチの概要</a> ～ <a href="https://qiita.com/beziex/items/d913102ca03266996a0e#beziex-%E3%83%91%E3%83%83%E3%83%81%E3%81%AE%E9%A0%82%E7%82%B9%E4%BD%8D%E7%BD%AE%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E5%BC%8F" id="reference-a77a299f6e7d9487a535">Beziex パッチの頂点位置に関する式</a><br>
<a href="https://qiita.com/beziex/items/00b614f7aa73f5124a19#%E6%B3%95%E7%B7%9A%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B-%E3%81%8A%E3%81%95%E3%82%89%E3%81%84" id="reference-78ce64810336ed158d8b">法線に関する おさらい</a> ～ <a href="https://qiita.com/beziex/items/00b614f7aa73f5124a19#%E6%9B%B2%E9%9D%A2-a-%E3%81%A8%E6%9B%B2%E9%9D%A2-b-%E3%81%AE%E5%81%8F%E5%BE%AE%E5%88%86%E5%80%A4%E3%81%AE%E6%B7%B7%E3%81%9C%E5%90%88%E3%82%8F%E3%81%9B" id="reference-78ce64810336ed158d8b">曲面 A と曲面 B の偏微分値の混ぜ合わせ</a></p>

<h2>
<span id="一つのパッチの為に大量のコントロールポイントを置く方法" class="fragment"></span><a href="#%E4%B8%80%E3%81%A4%E3%81%AE%E3%83%91%E3%83%83%E3%83%81%E3%81%AE%E7%82%BA%E3%81%AB%E5%A4%A7%E9%87%8F%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%82%92%E7%BD%AE%E3%81%8F%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>一つのパッチの為に大量のコントロールポイントを置く方法</h2>

<p>本プログラムでは、1個のパッチに対して</p>

<ul>
<li>80個のベクトル値をテッセレーション・エバリュエーションシェーダに送り込む</li>
</ul>

<p>ということを行っています。このベクトル値はコントロールポイントと見なすことが出来るので、1個のパッチに 80個のコントロールポイントを使っているわけです。<br>
しかし下記サイトを見てみると、1個のパッチの最大コントロールポイント数である <code>GL_MAX_PATCH_VERTICES</code> は、GeForce GTX 970M で「32」となっています。<br>
<a href="https://compubench.com/device.jsp?benchmark=compu20&amp;os=Windows&amp;api=cl&amp;D=NVIDIA+GeForce+GTX+970M&amp;testgroup=info" rel="nofollow noopener" target="_blank">Compute Performance of NVIDIA GeForce GTX 970M</a><br>
（「OpenGL API : GeForce GTX 970M/PCIe/SSE2」を開いて検索してください）</p>

<p>32 だと、80個のコントロールポイントは送り込めないですよね。ではどうすれば良いのでしょうか？<br>
ヒントは、<code>GL_MAX_PATCH_VERTICES</code> の名前に <code>VERTICES</code> と書かれているというところにあります。<code>VERTICES</code> は頂点のことですが、例えばバーテックスシェーダで頂点を扱う際、1個の頂点には位置情報の他に法線／色／テクスチャ座標値等を付けたりしますね。</p>

<p>すなわち 1個の頂点に複数のベクトル値を設定することが出来るわけです。テッセレーション・エバリュエーションシェーダでもそれは同じで、1個のコントロールポイント（頂点）に複数のベクトル値を置くことが出来ます。<br>
実際上記サイトでは GTX 970M で、1頂点辺りの最大属性数である <code>GL_MAX_VERTEX_ATTRIBS</code> は「16」となっていました。</p>

<p>つまり $32\times16=512$ で、1パッチ辺り最大 512個のベクトル値を置けるはずです（やったことは無いですが）。そのため 80個であれば、問題ないわけなのです。</p>

<p>ただし「1個の頂点に設定する属性の数」は、すべての頂点で同じにしなければなりません。そこで、</p>

<ul>
<li>1コントロールポイントに設定する属性数は「14」個に固定。これは前述した <code>vertexAry</code> 配列の要素（オブジェクト）が、14個のメンバ変数から成っていることに対応してます。</li>
<li>1パッチのコントロールポイント数は「6」個に固定。1パッチ辺りの <code>vertexAry</code> 配列内の個数が 6個なのは、このためです。</li>
<li>コントロールポイントの属性数は 14個ですが、ベジェ曲線のコントロールポイント数はそれと無関係な個数なので、うまく調整して $6\times14$ 内に収まるようにします。</li>
<li>CPU 側の <code>vertexAry</code> 配列の中身と、テッセレーション・エバリュエーションシェーダの <code>fromVbo()</code> 関数内での代入との間で整合性が取れていれば、データの引き渡しは成功するはず。</li>
</ul>

<p>としています。</p>

<h2>
<span id="バーテックスシェーダテッセレーションコントロールシェーダの補足" class="fragment"></span><a href="#%E3%83%90%E3%83%BC%E3%83%86%E3%83%83%E3%82%AF%E3%82%B9%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%81%AE%E8%A3%9C%E8%B6%B3"><i class="fa fa-link"></i></a>バーテックスシェーダ／テッセレーション・コントロールシェーダの補足</h2>

<p>「バーテックスシェーダ」の項で、<code>vertPnt0</code> ～ <code>vertPnt13</code> の値を <code>tescPnt0</code> ～ <code>tescPnt13</code> に代入していると書きました。つまりこれらの変数は、1コントロールポイントに設定する属性ということになります。<br>
ということは、バーテックスシェーダの 1回の実行で処理されるのは、1個のコントロールポイントということです。1パッチ辺り 6個のコントロールポイントがあるので、1個のパッチで 6回バーテックスシェーダが実行されることになりますね。<br>
もうここまで来ると、バーテックスシェーダの名前の由来である「頂点」とは関係が薄くなってきました。。</p>

<p>また「テッセレーション・コントロールシェーダ」の項でも、<code>tescPnt0[gl_InvocationID]</code> ～ <code>tescPnt13[gl_InvocationID]</code> の値を <code>tesePnt0[gl_InvocationID]</code> ～ <code>tesePnt13[gl_InvocationID]</code> に代入するということについて書いています。<br>
バーテックスシェーダとは異なり配列の一要素を代入する形になっていますが、これも 1回の実行で処理されるのは、1個のコントロールポイントです。</p>

<h2>
<span id="テッセレーションエバリュエーションシェーダgetposnormal" class="fragment"></span><a href="#%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%A8%E3%83%90%E3%83%AA%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80getposnormal"><i class="fa fa-link"></i></a>テッセレーション・エバリュエーションシェーダ（<code>getPosNormal</code>）</h2>

<p>テッセレーション・エバリュエーションシェーダの関数「<code>fromVbo()</code>」は、下記の関数からコールされます。</p>

<div class="code-frame" data-lang="glsl">
<div class="code-lang"><span class="bold">（bxViewVbo1.tese）getPosNormal</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">void</span> <span class="nf">getPosNormal</span><span class="p">(</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">pos</span><span class="p">,</span> <span class="k">out</span> <span class="kt">vec3</span> <span class="n">normalE</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">float</span>  <span class="n">u</span> <span class="o">=</span> <span class="nb">gl_TessCoord</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">float</span>  <span class="n">v</span> <span class="o">=</span> <span class="nb">gl_TessCoord</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

    <span class="kt">vec3</span>  <span class="n">hPosBez0</span><span class="p">[</span> <span class="mi">4</span> <span class="p">],</span>  <span class="n">hPosBez1</span><span class="p">[</span> <span class="mi">7</span> <span class="p">],</span>  <span class="n">hPosBez2</span><span class="p">[</span> <span class="mi">7</span> <span class="p">],</span>  <span class="n">hPosBez3</span><span class="p">[</span> <span class="mi">4</span> <span class="p">],</span>  <span class="n">vPosBez0</span><span class="p">[</span> <span class="mi">4</span> <span class="p">],</span>  <span class="n">vPosBez1</span><span class="p">[</span> <span class="mi">7</span> <span class="p">],</span>  <span class="n">vPosBez2</span><span class="p">[</span> <span class="mi">7</span> <span class="p">],</span>  <span class="n">vPosBez3</span><span class="p">[</span> <span class="mi">4</span> <span class="p">];</span>
    <span class="kt">vec3</span>  <span class="n">hDiffBez0</span><span class="p">[</span> <span class="mi">3</span> <span class="p">],</span> <span class="n">hDiffBez1</span><span class="p">[</span> <span class="mi">6</span> <span class="p">],</span> <span class="n">hDiffBez2</span><span class="p">[</span> <span class="mi">6</span> <span class="p">],</span> <span class="n">hDiffBez3</span><span class="p">[</span> <span class="mi">3</span> <span class="p">],</span> <span class="n">vDiffBez0</span><span class="p">[</span> <span class="mi">3</span> <span class="p">],</span> <span class="n">vDiffBez1</span><span class="p">[</span> <span class="mi">6</span> <span class="p">],</span> <span class="n">vDiffBez2</span><span class="p">[</span> <span class="mi">6</span> <span class="p">],</span> <span class="n">vDiffBez3</span><span class="p">[</span> <span class="mi">3</span> <span class="p">];</span>
    <span class="n">fromVbo</span><span class="p">(</span> <span class="n">hPosBez0</span><span class="p">,</span> <span class="n">hPosBez1</span><span class="p">,</span> <span class="n">hPosBez2</span><span class="p">,</span> <span class="n">hPosBez3</span><span class="p">,</span> <span class="n">vPosBez0</span><span class="p">,</span> <span class="n">vPosBez1</span><span class="p">,</span> <span class="n">vPosBez2</span><span class="p">,</span> <span class="n">vPosBez3</span><span class="p">,</span> <span class="n">hDiffBez0</span><span class="p">,</span> <span class="n">hDiffBez1</span><span class="p">,</span> <span class="n">hDiffBez2</span><span class="p">,</span> <span class="n">hDiffBez3</span><span class="p">,</span> <span class="n">vDiffBez0</span><span class="p">,</span> <span class="n">vDiffBez1</span><span class="p">,</span> <span class="n">vDiffBez2</span><span class="p">,</span> <span class="n">vDiffBez3</span> <span class="p">);</span>

    <span class="kt">vec3</span>  <span class="n">posH</span><span class="p">,</span> <span class="n">posV</span><span class="p">;</span>
    <span class="n">getPosition</span><span class="p">(</span> <span class="n">hPosBez0</span><span class="p">,</span> <span class="n">hPosBez1</span><span class="p">,</span> <span class="n">hPosBez2</span><span class="p">,</span> <span class="n">hPosBez3</span><span class="p">,</span> <span class="n">vPosBez0</span><span class="p">,</span> <span class="n">vPosBez1</span><span class="p">,</span> <span class="n">vPosBez2</span><span class="p">,</span> <span class="n">vPosBez3</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">posH</span><span class="p">,</span> <span class="n">posV</span><span class="p">,</span> <span class="n">pos</span> <span class="p">);</span>

    <span class="n">getNormalE</span><span class="p">(</span> <span class="n">hDiffBez0</span><span class="p">,</span> <span class="n">hDiffBez1</span><span class="p">,</span> <span class="n">hDiffBez2</span><span class="p">,</span> <span class="n">hDiffBez3</span><span class="p">,</span> <span class="n">vPosBez0</span><span class="p">,</span> <span class="n">vPosBez1</span><span class="p">,</span> <span class="n">vPosBez2</span><span class="p">,</span> <span class="n">vPosBez3</span><span class="p">,</span> <span class="n">hPosBez0</span><span class="p">,</span> <span class="n">hPosBez1</span><span class="p">,</span> <span class="n">hPosBez2</span><span class="p">,</span> <span class="n">hPosBez3</span><span class="p">,</span>
                <span class="n">vDiffBez0</span><span class="p">,</span> <span class="n">vDiffBez1</span><span class="p">,</span> <span class="n">vDiffBez2</span><span class="p">,</span> <span class="n">vDiffBez3</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">posH</span><span class="p">,</span> <span class="n">posV</span><span class="p">,</span> <span class="n">normalE</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>これを見ると分かるように、<code>fromVbo()</code> の実行後、<code>getPosition()</code> や <code>getNormalE()</code> がコールされています。これらの関数は、分割後の頂点位置や法線を算定するためのものですが、詳細は下記リンクをご覧ください。<br>
このリンクは WebGL 版の記事なので言語等が異なりますが、何となく分かるのではないでしょうか？<br>
<a href="https://qiita.com/beziex/items/d913102ca03266996a0e#beziex-%E3%83%91%E3%83%83%E3%83%81%E3%81%AE%E5%BC%8F%E9%A0%82%E7%82%B9%E4%BD%8D%E7%BD%AE%E3%81%AE%E5%AE%9F%E8%A3%85" id="reference-a77a299f6e7d9487a535">Beziex パッチの式（頂点位置）の実装</a><br>
<a href="https://qiita.com/beziex/items/00b614f7aa73f5124a19#u-%E6%96%B9%E5%90%91%E3%81%AE%E5%81%8F%E5%BE%AE%E5%88%86%E5%80%A4%E3%81%AE%E5%BC%8F%E6%9B%B2%E9%9D%A2-a" id="reference-78ce64810336ed158d8b">u 方向の偏微分値の式（曲面 A）</a> ～ <a href="https://qiita.com/beziex/items/00b614f7aa73f5124a19#%E6%9B%B2%E9%9D%A2-a-%E3%81%A8%E6%9B%B2%E9%9D%A2-b-%E3%81%AE%E5%81%8F%E5%BE%AE%E5%88%86%E5%80%A4%E3%81%AE%E6%B7%B7%E3%81%9C%E5%90%88%E3%82%8F%E3%81%9B">曲面 A と曲面 B の偏微分値の混ぜ合わせ</a></p>

<p>ちなみにテッセレーション・エバリュエーションシェーダでは、u および v の値を取得する際に <code>gl_TessCoord</code> を使います。</p>

<h2>
<span id="tessellation-algorithm--surface-type--gpu-benchmark-fps" class="fragment"></span><a href="#tessellation-algorithm--surface-type--gpu-benchmark-fps"><i class="fa fa-link"></i></a>Tessellation algorithm ／ Surface type ／ GPU Benchmark (FPS)</h2>

<p>本プログラムの UI の、General タブには「Tessellation algorithm」「Surface type」「GPU Benchmark (FPS)」という項目があります。</p>

<h3>
<span id="tessellation-algorithm" class="fragment"></span><a href="#tessellation-algorithm"><i class="fa fa-link"></i></a>Tessellation algorithm</h3>

<p>Tessellation algorithm では、「Tessellation shader アルゴリズム」と「Instance geometry アルゴリズム」を切り替えることが出来ます。<br>
このうち Tessellation shader は本稿でこれまで述べてきたアルゴリズムです。Instance geometry は WebGL版で使用しているアルゴリズムですが、本プログラムにも搭載されているので切り替えが可能なのです。<br>
なお少し詳しい情報は、下記に載っています。<br>
<a href="https://github.com/beziex/Beziex_Op/blob/master/README.md#tessellation-algorithm--%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0" rel="nofollow noopener" target="_blank">Tessellation algorithm ／ テッセレーション・アルゴリズム</a></p>

<h3>
<span id="surface-type" class="fragment"></span><a href="#surface-type"><i class="fa fa-link"></i></a>Surface type</h3>

<p>「Solid」はシェーディング面表示、「Wire」はワイヤーフレーム表示です。<br>
Wire はオマケですが、ポリゴン分割の状態を見る際に分かりやすいと思います。</p>

<h3>
<span id="gpu-benchmark-fps" class="fragment"></span><a href="#gpu-benchmark-fps"><i class="fa fa-link"></i></a>GPU Benchmark (FPS)</h3>

<p>本プログラムのベンチマークは「一つのフレームを作り上げるための全ての時間」を示すものでは無く、ドローコールの時間を計るものです。詳細は下記に述べています。<br>
<a href="https://github.com/beziex/Beziex_Op/blob/master/README.md#gpu-benchmark-fps--gpu-%E3%83%99%E3%83%B3%E3%83%81%E3%83%9E%E3%83%BC%E3%82%AF-fps" rel="nofollow noopener" target="_blank">GPU Benchmark (FPS) ／ GPU ベンチマーク (FPS)</a></p>

<h2>
<span id="gpu-benchmark-fps-の実行例" class="fragment"></span><a href="#gpu-benchmark-fps-%E3%81%AE%E5%AE%9F%E8%A1%8C%E4%BE%8B"><i class="fa fa-link"></i></a>GPU Benchmark (FPS) の実行例</h2>

<p>以下に、「i7-6700HQ + GTX 970M + 64bit 版 Windows 10 Pro (1903)」上で、3D モデルとして「MascuteAzur001.gzjson」、分割数 8 で測定した実行例を載せました。ただし実際には Analyze ボタンを押す度に数値は変わるので、あくまでも目安と考えてください。</p>

<table>
<tr>
<th>Tessellation algorithm</th>
<th>Surface type</th>
<th>FPS</th>
</tr>
<tr>
<td rowspan="2">Tessellation shader</td>
<td>Solid</td>
<td>1682.2386</td>
</tr>
<tr>
<td>Wire</td>
<td>280.6474</td>
</tr>
<tr>
<td rowspan="2">Instance geometry</td>
<td>Solid</td>
<td>485.1686</td>
</tr>
<tr>
<td>Wire</td>
<td>306.8509</td>
</tr>
</table>

<p>上記の環境では、Wire 選択時のベンチマークがかなり遅いのですが、ゲーム等でワイヤーフレーム表示を行うことは少ないので、とりあえず無視しましょう。<br>
そんなわけで Solid どうしで比較すると、</p>

<ul>
<li>Tessellation shader アルゴリズムは、Instance geometry アルゴリズムの約 3.5倍速い</li>
</ul>

<p>ということが分かります。ちなみに分割数を上げると、さらに速度差が広がりますよ。</p>

<h2>
<span id="終わりに" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>終わりに</h2>

<p>ということで、WebGL 版テッセレーション ビューワに続いて、OpenTK 版も作ってみたのでした。<br>
ちなみに本プログラム (C#) の UI は、</p>

<ul>
<li>WPF + Prism + ReactiveProperty + Material Design In XAML</li>
</ul>

<p>で作っています。つまり MVVM パターンなのですが、これについては何も説明してませんでしたね。<br>
何か機会がありましたらその時に、ということで。。。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fbeziex%2Fitems%2Fab1c87918892338eb8df&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fbeziex%2Fitems%2Fab1c87918892338eb8df&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/beziex/items/ab1c87918892338eb8df/likers" class="css-1iupg5d">2</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">1</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ab1c87918892338eb8df/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/beziex/items/ab1c87918892338eb8df/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/beziex/items/ab1c87918892338eb8df/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/beziex/items/ab1c87918892338eb8df/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/beziex/items/ab1c87918892338eb8df.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-4bdb4c1c-85e0-4ee6-ad16-1061c387d0a8">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-684d257d-95f1-4def-a41e-91e6b62edb5a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-684d257d-95f1-4def-a41e-91e6b62edb5a">{}</script>
      
<div id="LoginModal-react-component-f4dd7fbf-e824-433e-acd8-a6f88dee14fe"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-f4dd7fbf-e824-433e-acd8-a6f88dee14fe">{}</script>
      
<div id="StockModal-react-component-a80bff52-cd92-4a08-bf0b-39f8159e1e65"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-a80bff52-cd92-4a08-bf0b-39f8159e1e65">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;6H7dXPmetr/nIzlAIbQLwQ8ldXrrIj6+cCpY0Q70iNYjDGhFlon27rZyZ7ua2y6iLBKz2rygAOYAoe3IbD4KEw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch2\u003e\n\u003cspan id=\"ソースコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eソースコード\u003c/h2\u003e\n\n\u003cp\u003e本プログラムのソースコードは、github で公開してます。（MIT ライセンスです）\u003cbr\u003e\n\u003ca href=\"https://github.com/beziex/Beziex_Op\" rel=\"nofollow noopener\" target=\"_blank\"\u003ebeziex/Beziex_Op [github] :  (\u003c/a\u003e\u003ca href=\"https://github.com/beziex/Beziex_Op\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/beziex/Beziex_Op\u003c/a\u003e)\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"opentk-テッセレーション-ビューワ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#opentk-%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-%E3%83%93%E3%83%A5%E3%83%BC%E3%83%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eOpenTK テッセレーション ビューワ\u003c/h2\u003e\n\n\u003cp\u003e2ヶ月ほど前に、「独自の高次元曲面パッチデータを WebGL 上でリアルタイムにテッセレーションし、ウェブブラウザに表示する 3Dモデルビューワ」を作ったということで、寄稿させていただきました。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/beziex/items/d3ad67752dba8cc355c7\" id=\"reference-4458fe5094711d1a16ac\"\u003e［前編］: WebGL でテッセレーションして、曲面パッチ間が滑らかに繋がった物体を表示（１）\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e今回の投稿も「テッセレーション ビューワ」なのですが WebGL では無く、「OpenTK」で実装しています。よって、Web アプリではありません。（デスクトップアプリケーションです）\u003cbr\u003e\nちなみに WebGL 版では、ベースとなっている OpenGL のバージョンの制限からテッセレーションシェーダを使うことが出来ず、バーテックスシェーダとフラグメントシェーダだけでテッセレーションしていました。ジオメトリインスタンシングという方法です。（詳しくは、上記の記事をご参照ください）\u003c/p\u003e\n\n\u003cp\u003eしかし OpenTK であれば、OpenGL のバージョン制限はありません。ということで、素直にテッセレーションシェーダを使う方法でプログラミングすることにしました。\u003cbr\u003e\nでもそれだけだと、テッセレーションシェーダ使用の方が良いのかどうか分かりませんね。そこで、ジオメトリインスタンシング法にも切り替えれるようにして、さらにそれぞれの実行速度も表示できるようにしています。\u003cbr\u003e\n実行速度の比較が出来れば、どちらが良いか一目瞭然でしょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ビルド環境と実行環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%93%E3%83%AB%E3%83%89%E7%92%B0%E5%A2%83%E3%81%A8%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eビルド環境と実行環境\u003c/h2\u003e\n\n\u003cp\u003eまずビルド環境／実行環境ともに、OS は 64bit 版 Windows のみ（Windows 10 以外は未確認）です。また使用言語は C# となっています。「WebGL 版テッセレーションビューワ」は一応マルチプラットフォームだったので、制限が加わり申し訳ないです。\u003c/p\u003e\n\n\u003cp\u003eまた WebGL 版では \u003ca href=\"https://beziex.netlify.com/beziex_we/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eデモ\u003c/a\u003e を用意したので、即座に動きを見ることが出来ましたが、OpenTK 版ではセキュリティ上の観点から実行ファイルは置いていません。\u003cbr\u003e\nそのため実行させるためには、前もってビルドが必要です。面倒くさくなってしまいましたが、ご容赦願います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"インストールビルド実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%83%93%E3%83%AB%E3%83%89%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eインストール／ビルド／実行\u003c/h2\u003e\n\n\u003cp\u003eまずビルドの為には、Visual Studio 2019 が必要です。ビルドについては、下記が参考になると思います。\u003cbr\u003e\n\u003ca href=\"https://github.com/beziex/Beziex_Op/blob/master/README.md#install-environment-for-build--%E3%83%93%E3%83%AB%E3%83%89%E7%92%B0%E5%A2%83%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" rel=\"nofollow noopener\" target=\"_blank\"\u003eInstall environment for build / ビルド環境のインストール\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eあとは普通にビルド＆実行できます。実行後の使用方法については、下記をご覧ください。\u003cbr\u003e\n\u003ca href=\"https://github.com/beziex/Beziex_Op/blob/master/README.md#usage--%E4%BD%BF%E3%81%84%E6%96%B9\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUsage ／ 使い方\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eなお上記リンクのページにも書いてますが、起動しただけでは 3D モデルは表示されていないので、「General タブの \"Open gzjson\" ボタン」を押して、gzjson ファイルを選択します。\u003cbr\u003e\n例えば「MascuteAzur001.gzjson」を選ぶと、下記のようなウインドウが現れるはずです。(スクリーンショット 左: \"General\" タブ選択時, 右: \"Transform\" タブ選択時)\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/654a3d2f99c02e461dffd096678239e8914a7b18/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3438323138312f36643566356432382d646338362d663430372d653237302d3066333862383636666161372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg alt=\"overview.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482181%2F6d5f5d28-dc86-f407-e270-0f38b866faa7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9849629e99128964536e25879cdc93a5\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/482181/6d5f5d28-dc86-f407-e270-0f38b866faa7.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F482181%2F6d5f5d28-dc86-f407-e270-0f38b866faa7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4dffed63242be93c0602566c7ee462ac 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nちなみにこの 3D モデルの元データは、WebGL 版の記事と同じく、\u003ca href=\"https://twitter.com/thecoolmuseum/status/785896516422471681\" rel=\"nofollow noopener\" target=\"_blank\"\u003eクールなびじゅつかん館長さんのツイート\u003c/a\u003e を使わせていただきました。\u003c/p\u003e\n\n\u003cp\u003eということで、ユーザー寄りの説明はココまで。次項からは、技術的な説明に移りたいと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"前知識\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E7%9F%A5%E8%AD%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前知識\u003c/h2\u003e\n\n\u003cp\u003eWebGL 版の記事と同じことはあまり書きたくないので、WebGL 版では使っていない本プログラム（OpenTK 版）独自の技術について記述します。具体的には、以下の技術です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e独自の高次元曲面パッチを、テッセレーションシェーダを使ってテッセレーションする方法\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eただし多少の前知識は必要なので、前もって WebGL 版記事の下記の項目を読んでおくと分かりやすいと思います。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/beziex/items/d3ad67752dba8cc355c7#%E9%AB%98%E6%AC%A1%E5%85%83%E6%9B%B2%E9%9D%A2%E3%83%91%E3%83%83%E3%83%81\" id=\"reference-4458fe5094711d1a16ac\"\u003e高次元曲面パッチ\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/beziex/items/d3ad67752dba8cc355c7#%E6%9B%B2%E9%9D%A2%E3%83%91%E3%83%83%E3%83%81%E3%81%A8%E6%B3%95%E7%B7%9A%E3%81%AE%E9%96%A2%E9%80%A3%E6%80%A7\" id=\"reference-4458fe5094711d1a16ac\"\u003e曲面パッチと法線の関連性\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/beziex/items/d3ad67752dba8cc355c7#%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E5%86%85%E3%81%A7%E3%81%AE%E6%B3%95%E7%B7%9A%E3%81%AE%E8%A8%88%E7%AE%97\" id=\"reference-4458fe5094711d1a16ac\"\u003eシェーダ内での法線の計算\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コントロールポイント組み直し微分値用パラメータ生成の処理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E7%B5%84%E3%81%BF%E7%9B%B4%E3%81%97%E5%BE%AE%E5%88%86%E5%80%A4%E7%94%A8%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E7%94%9F%E6%88%90%E3%81%AE%E5%87%A6%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコントロールポイント組み直し＆微分値用パラメータ生成の処理\u003c/h2\u003e\n\n\u003cp\u003eこの処理は、WebGL 版記事の下記の項目の前半と同様です。\u003cbr\u003e\n\u003ca href=\"https://qiita.com/beziex/items/d3ad67752dba8cc355c7#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E7%B5%84%E3%81%BF%E7%9B%B4%E3%81%97%E5%BE%AE%E5%88%86%E5%80%A4%E7%94%A8%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E7%94%9F%E6%88%90%E3%81%AE%E5%87%A6%E7%90%86\" id=\"reference-4458fe5094711d1a16ac\"\u003eコントロールポイント組み直し＆微分値用パラメータ生成の処理\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eしかし WebGL 版記事にあるソースコードは TypeScript で書かれているので、本プログラム（C#）での該当箇所を以下に示しました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eBxGlShadeVbo1.GetPosDiff\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e  \u003cspan class=\"nf\"\u003eGetPosDiff\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eBxCmSeparatePatch_Object\u003c/span\u003e \u003cspan class=\"n\"\u003epatch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003esurfaceNo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier3Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier6Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier6Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier3Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier3Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier6Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier6Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier3Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier2Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier5Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier5Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier2Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier2Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier5Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier5Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier2Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez3\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eGetPosBezierH\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epatch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esurfaceNo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eGetPosBezierV\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epatch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esurfaceNo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eGetDiffBezierH\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epatch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esurfaceNo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez3\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eGetDiffBezierV\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epatch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esurfaceNo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez3\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eなおこれにより変換後の値は、1パッチ辺り「ベクトル値ベースで 80個」になります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"パラメータの配列化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AE%E9%85%8D%E5%88%97%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eパラメータの配列化\u003c/h2\u003e\n\n\u003cp\u003eWebGL 版ではパラメータ生成後、1パッチ毎に「80個の配列（配列要素はベクトル値）」に変換していました。\u003cbr\u003e\nしかし OpenTK 版のテッセレーションシェーダを使う方法では少し違います。配列にすることに関しては同じなのですが、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e配列の個数は1パッチ辺り 6個。ただし配列要素は、14個のメンバ変数（ベクトル値）から成るオブジェクト\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eという形にします。\u003cbr\u003e\nつまりこれにより $6\\times14=84$ で、計84個の値となるわけです。なお必要な個数は 80個なので少し余ることになりますが、余った部分は使わなければ良いだけなので問題ありません。\u003cbr\u003e\nちなみに実際のコードでは、「テッセレーション関連の整数値（\u003ccode\u003etessDenom\u003c/code\u003e）」も配列に入れてます。これについての詳細は割愛しますが、結果として配列に 81個の値を入れていることになります。\u003c/p\u003e\n\n\u003cp\u003eそしてこの処理を行っているのが、同じく \u003ccode\u003eBxGlShadeVbo1\u003c/code\u003e クラスの \u003ccode\u003eSetVertexBufferOne()\u003c/code\u003e 関数です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eBxGlShadeVbo1.SetVertexBufferOne\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e  \u003cspan class=\"nf\"\u003eSetVertexBufferOne\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eBxBezier3Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier6Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier6Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier3Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier3Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier6Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eBxBezier6Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier3Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier2Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier5Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier5Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier2Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eBxBezier2Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier5Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier5Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier2Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003etessDenom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003esurfaceNo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVertexInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSetVertexBuffer0\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esurfaceNo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSetVertexBuffer1\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"n\"\u003ehDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esurfaceNo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSetVertexBuffer2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etessDenom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esurfaceNo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSetVertexBuffer3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"n\"\u003evDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esurfaceNo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSetVertexBuffer4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"n\"\u003evDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esurfaceNo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSetVertexBuffer5\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esurfaceNo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこのコードを見ると、\u003ccode\u003eSetVertexBuffer0()\u003c/code\u003e ～ \u003ccode\u003eSetVertexBuffer5()\u003c/code\u003e という 6個の関数がありますが、この各関数はそれぞれ別の配列インデックスのオブジェクトに値をセットしています。\u003cbr\u003e\n例えば \u003ccode\u003eSetVertexBuffer0()\u003c/code\u003e の中身を見てみると、下記のようになっていることが分かります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eBxGlShadeVbo1.SetVertexBuffer0\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e  \u003cspan class=\"nf\"\u003eSetVertexBuffer0\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier3Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier6Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier2Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003esurfaceNo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVertexInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003euint\u003c/span\u003e  \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003esurfaceNo\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003eToVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003epnt0\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eToVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003epnt1\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eToVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003epnt2\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eToVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003epnt3\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003eToVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003epnt4\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eToVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003epnt5\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eToVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003epnt6\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eToVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003epnt7\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eToVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003epnt8\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eToVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003epnt9\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eToVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003epnt10\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003eToVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003epnt11\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eToVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003epnt12\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eToVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003edstIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003epnt13\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e具体的には、\u003ccode\u003epnt0\u003c/code\u003e ～ \u003ccode\u003epnt13\u003c/code\u003e という 14個のメンバ変数に値を入れていますね。\u003cbr\u003e\nなお \u003ccode\u003evertexAry\u003c/code\u003e は 1パッチ辺りでは「配列 6個分」ですが、実際には全パッチの情報をすべて \u003ccode\u003evertexAry\u003c/code\u003e に入れるので、「6$\\times$パッチ数」の個数の配列となります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"vbo\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#vbo\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVBO\u003c/h2\u003e\n\n\u003cp\u003e全パッチについて前項の \u003ccode\u003eGetPosDiff()\u003c/code\u003e と \u003ccode\u003eSetVertexBufferOne()\u003c/code\u003e を行い、\u003ccode\u003evertexAry\u003c/code\u003e の情報を VBO に転送する処理を行っているのが、\u003ccode\u003eBxGlShadeVbo1.SetVertexBuffer()\u003c/code\u003e です。\u003cbr\u003e\nそしてこの関数内の \u003ccode\u003eGL.BufferData()\u003c/code\u003e が、実際に転送を行っている箇所になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eBxGlShadeVbo1.SetVertexBuffer\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e  \u003cspan class=\"nf\"\u003eSetVertexBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eBxCmSeparatePatch_Object\u003c/span\u003e \u003cspan class=\"n\"\u003epatch\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eHasVertexBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReleaseVertexBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNumVertices\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"p\"\u003e)(\u003c/span\u003e \u003cspan class=\"n\"\u003epatch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNumSurface\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eVertexInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVertexInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003eBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNumVertices\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003epatch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNumSurface\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eGetPosDiff\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epatch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier3Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier6Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier6Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier3Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier3Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier6Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier6Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier3Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier2Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier5Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier5Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier2Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier2Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier5Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier5Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBxBezier2Line3F\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez3\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e  \u003cspan class=\"n\"\u003etessDenom\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetTessDenom\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epatch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"nf\"\u003eSetVertexBufferOne\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003evDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etessDenom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGenBuffers\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVboID\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBindBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eBufferTarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eArrayBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVboID\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBufferData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eBufferTarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eArrayBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eIntPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNumVertices\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eVertexInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003evertexAry\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBufferUsageHint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStaticDraw\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBindBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eBufferTarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eArrayBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"vao\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#vao\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVAO\u003c/h2\u003e\n\n\u003cp\u003e前項で、\u003ccode\u003eGL.BufferData()\u003c/code\u003e により「\u003ccode\u003evertexAry\u003c/code\u003e の情報を VBO に転送」しましたが、実際には \u003ccode\u003evertexAry\u003c/code\u003e の各要素は、14個のメンバ変数から成るオブジェクトです。そのためバーテックスシェーダのコード内では、「14個の中の任意の値が、どのメンバ変数と対応しているか」を知っていなければなりません。\u003cbr\u003e\nこれを行うための OpenGL 上での仕組みが VAO で、本プログラムでは \u003ccode\u003eBxGlShadeVbo1.SetVAO()\u003c/code\u003e でこれを行っています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eBxGlShadeVbo1.SetVAO\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e  \u003cspan class=\"nf\"\u003eSetVAO\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGenVertexArrays\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVaoHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBindVertexArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVaoHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBindBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eBufferTarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eArrayBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVboID\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e  \u003cspan class=\"n\"\u003epnt0Location\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAttribLocation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003efProgramObj\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShaderProgramID\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"s\"\u003e\"vertPnt0\"\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e  \u003cspan class=\"n\"\u003epnt1Location\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAttribLocation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003efProgramObj\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShaderProgramID\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"s\"\u003e\"vertPnt1\"\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                          \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e  \u003cspan class=\"n\"\u003epnt12Location\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAttribLocation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003efProgramObj\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShaderProgramID\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"s\"\u003e\"vertPnt12\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e  \u003cspan class=\"n\"\u003epnt13Location\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAttribLocation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003efProgramObj\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShaderProgramID\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"s\"\u003e\"vertPnt13\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEnableVertexAttribArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epnt0Location\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEnableVertexAttribArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epnt1Location\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                          \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEnableVertexAttribArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epnt12Location\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEnableVertexAttribArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epnt13Location\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eVertexAttribPointer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epnt0Location\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVertexAttribPointerType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVertexInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eVertexAttribPointer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epnt1Location\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVertexAttribPointerType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVertexInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSizeInBytes\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e  \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                          \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eVertexAttribPointer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epnt12Location\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVertexAttribPointerType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVertexInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSizeInBytes\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e12\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eVertexAttribPointer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epnt13Location\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVertexAttribPointerType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVertexInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSizeInBytes\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e13\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBindVertexArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e具体的には、\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ccode\u003eGL.GetAttribLocation()\u003c/code\u003e で「バーテックスシェーダ コード内の入力変数」を attribute location という ID の形で求める。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eGL.EnableVertexAttribArray()\u003c/code\u003e で、指定した attribute location を有効化する。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eGL.VertexAttribPointer()\u003c/code\u003e で、attribute location と「バーテックスデータのパッチ内におけるオフセット」を結びつける。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eということにより、対応付けが成されるわけです。\u003cbr\u003e\nなお上記コードを見ると「バーテックスシェーダ コード内の入力変数」として、\u003ccode\u003evertPnt0\u003c/code\u003e ～ \u003ccode\u003evertPnt13\u003c/code\u003e が定義されていることが分かります。そしてこの変数名は、この後バーテックスシェーダのコードを説明する際にも出てくることになります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ドローコール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%89%E3%83%AD%E3%83%BC%E3%82%B3%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eドローコール\u003c/h2\u003e\n\n\u003cp\u003eCPU 側では、前項までで各種設定を行ってきました。そして最後にドローコールすることにより、実際に 3D モデルが表示されることになります。\u003cbr\u003e\nこれをやっているのが \u003ccode\u003eBxGlShaderBase\u003c/code\u003e クラスの \u003ccode\u003eDrawMain()\u003c/code\u003e 関数です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eBxGlShaderBase.DrawMain\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e  \u003cspan class=\"nf\"\u003eDrawMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eBxCmUiParam\u003c/span\u003e \u003cspan class=\"n\"\u003eparam\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSetFaceColor\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003ePatchParameter\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBindVertexArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVaoHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eBeginBenchmark\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eparam\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDrawArrays\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ePrimitiveType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePatches\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNumVertices\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003eEndBenchmark\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eparam\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBindVertexArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの中で重要なのは、OpenGL（OpenTK）の Draw 系関数である \u003ccode\u003eGL.DrawArrays()\u003c/code\u003e となります。\u003cbr\u003e\nさらに \u003ccode\u003eGL.DrawArrays()\u003c/code\u003e の引数として \u003ccode\u003ePrimitiveType.Patches\u003c/code\u003e を指定していることにご注目ください。この指定により、テッセレーション系シェーダが使われることになります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"バーテックスシェーダ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%90%E3%83%BC%E3%83%86%E3%83%83%E3%82%AF%E3%82%B9%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eバーテックスシェーダ\u003c/h2\u003e\n\n\u003cp\u003eここでようやく GPU 側のプログラムに入ってきました。まずはバーテックスシェーダです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"glsl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e（bxViewVbo1.vert）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#version 400\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003evertPnt0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003evertPnt1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n\u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003evertPnt12\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003evertPnt13\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003etescPnt0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003etescPnt1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003etescPnt12\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003etescPnt13\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etescPnt0\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evertPnt0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etescPnt1\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evertPnt1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etescPnt12\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evertPnt12\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etescPnt13\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evertPnt13\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこのバーテックスシェーダのコードは、上記を見てわかるように大したことは行っていません。入力変数である \u003ccode\u003evertPnt0\u003c/code\u003e ～ \u003ccode\u003evertPnt13\u003c/code\u003e の値を、出力変数の \u003ccode\u003etescPnt0\u003c/code\u003e ～ \u003ccode\u003etescPnt13\u003c/code\u003e に代入しているだけです。\u003c/p\u003e\n\n\u003cp\u003eただ \u003ccode\u003evertPnt0\u003c/code\u003e ～ \u003ccode\u003evertPnt13\u003c/code\u003e という変数名が、前述した \u003ca href=\"https://qiita.com/beziex/items/ab1c87918892338eb8df#vao\"\u003eVAO\u003c/a\u003e の項にも出てくることについては注目する必要があります。\u003cbr\u003e\nすなわち CPU 側のバーテックスバッファである \u003ccode\u003evertexAry\u003c/code\u003e 配列について、配列の各要素の 14個のメンバ変数が、GPU 側では \u003ccode\u003evertPnt0\u003c/code\u003e ～ \u003ccode\u003evertPnt13\u003c/code\u003e という変数になるわけです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"テッセレーションコントロールシェーダ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eテッセレーション・コントロールシェーダ\u003c/h2\u003e\n\n\u003cp\u003e次に実行されるのは「テッセレーション・コントロールシェーダ」ですが、これも大したことはしていません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"glsl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e（bxViewVbo1.tesc）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#version 400\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003elayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003evertices\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003etescPnt0\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n\u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003etescPnt1\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n\u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003etescPnt12\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n\u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003etescPnt13\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003etesePnt0\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003etesePnt1\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003etesePnt12\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003etesePnt13\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003euniform\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e  \u003cspan class=\"n\"\u003etessLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etesePnt0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"nb\"\u003egl_InvocationID\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etescPnt0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"nb\"\u003egl_InvocationID\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etesePnt1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"nb\"\u003egl_InvocationID\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etescPnt1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"nb\"\u003egl_InvocationID\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                           \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etesePnt12\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"nb\"\u003egl_InvocationID\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etescPnt12\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"nb\"\u003egl_InvocationID\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etesePnt13\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"nb\"\u003egl_InvocationID\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etescPnt13\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"nb\"\u003egl_InvocationID\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nb\"\u003egl_InvocationID\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e  \u003cspan class=\"n\"\u003etessDenom\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etescPnt12\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"nb\"\u003egl_TessLevelOuter\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etessLevel\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003etessDenom\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003egl_TessLevelOuter\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etessLevel\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003etessDenom\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003egl_TessLevelOuter\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etessLevel\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003etessDenom\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003egl_TessLevelOuter\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etessLevel\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003etessDenom\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"nb\"\u003egl_TessLevelInner\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etessLevel\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003etessDenom\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003egl_TessLevelInner\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etessLevel\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003etessDenom\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e以下のように、\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e入力変数の \u003ccode\u003etescPnt0[gl_InvocationID]\u003c/code\u003e ～ \u003ccode\u003etescPnt13[gl_InvocationID]\u003c/code\u003e の値を、出力変数の \u003ccode\u003etesePnt0[gl_InvocationID]\u003c/code\u003e ～ \u003ccode\u003etesePnt13[gl_InvocationID]\u003c/code\u003e に代入する。\u003c/li\u003e\n\u003cli\u003eパッチ境界の分割数（\u003ccode\u003egl_TessLevelOuter\u003c/code\u003e）と、パッチ内部の分割数（\u003ccode\u003egl_TessLevelInner\u003c/code\u003e）を指定する。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eを行っているだけです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"テッセレーションエバリュエーションシェーダfromvbo\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%A8%E3%83%90%E3%83%AA%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80fromvbo\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eテッセレーション・エバリュエーションシェーダ（\u003ccode\u003efromVbo\u003c/code\u003e）\u003c/h2\u003e\n\n\u003cp\u003eそして「テッセレーション・エバリュエーションシェーダ」のコードが実行されますが、これが GPU 側プログラムの要となります。\u003cbr\u003e\nまずここでは、\u003ccode\u003efromVbo()\u003c/code\u003e という関数を見てみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"glsl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e（bxViewVbo1.tese）fromVbo\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003efromVbo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n              \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt4\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt5\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                  \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt9\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt10\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                  \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt5\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt6\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt7\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt8\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt9\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt10\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt4\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt5\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                  \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt9\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt10\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                  \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt5\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt6\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt7\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt8\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt9\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt10\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt11\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt12\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt13\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ehDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                   \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt4\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt5\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ehDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt6\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt7\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                   \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt10\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt11\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ehDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt11\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt12\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt13\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003evDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt11\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt12\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt13\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003evDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                   \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt4\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt5\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003evDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt6\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt7\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e  \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                   \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt10\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt11\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003evDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt11\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt12\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etesePnt13\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの関数は、入力変数 \u003ccode\u003etesePnt0[i]\u003c/code\u003e ～ \u003ccode\u003etesePnt13[i]\u003c/code\u003e（\u003ccode\u003ei\u003c/code\u003e は 0～5）を、\u003ccode\u003ehPosBez0\u003c/code\u003e、\u003ccode\u003evDiffBez3\u003c/code\u003e 等といった「3次または6次のベジェ曲線」「2次または5次の微分値用ベジェ曲線」に代入するためのものです。\u003cbr\u003e\nなおこれら複数のベジェ曲線によって、独自高次元曲面パッチ（Beziex パッチ）が生成されるわけですが、これに関する式については下記を参照ください。\u003cbr\u003e\n\u003ca href=\"https://qiita.com/beziex/items/d913102ca03266996a0e#%E7%8B%AC%E8%87%AA%E9%AB%98%E6%AC%A1%E5%85%83%E6%9B%B2%E9%9D%A2%E3%83%91%E3%83%83%E3%83%81%E3%81%AE%E6%A6%82%E8%A6%81\" id=\"reference-a77a299f6e7d9487a535\"\u003e独自高次元曲面パッチの概要\u003c/a\u003e ～ \u003ca href=\"https://qiita.com/beziex/items/d913102ca03266996a0e#beziex-%E3%83%91%E3%83%83%E3%83%81%E3%81%AE%E9%A0%82%E7%82%B9%E4%BD%8D%E7%BD%AE%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E5%BC%8F\" id=\"reference-a77a299f6e7d9487a535\"\u003eBeziex パッチの頂点位置に関する式\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/beziex/items/00b614f7aa73f5124a19#%E6%B3%95%E7%B7%9A%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B-%E3%81%8A%E3%81%95%E3%82%89%E3%81%84\" id=\"reference-78ce64810336ed158d8b\"\u003e法線に関する おさらい\u003c/a\u003e ～ \u003ca href=\"https://qiita.com/beziex/items/00b614f7aa73f5124a19#%E6%9B%B2%E9%9D%A2-a-%E3%81%A8%E6%9B%B2%E9%9D%A2-b-%E3%81%AE%E5%81%8F%E5%BE%AE%E5%88%86%E5%80%A4%E3%81%AE%E6%B7%B7%E3%81%9C%E5%90%88%E3%82%8F%E3%81%9B\" id=\"reference-78ce64810336ed158d8b\"\u003e曲面 A と曲面 B の偏微分値の混ぜ合わせ\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"一つのパッチの為に大量のコントロールポイントを置く方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%80%E3%81%A4%E3%81%AE%E3%83%91%E3%83%83%E3%83%81%E3%81%AE%E7%82%BA%E3%81%AB%E5%A4%A7%E9%87%8F%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%82%92%E7%BD%AE%E3%81%8F%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e一つのパッチの為に大量のコントロールポイントを置く方法\u003c/h2\u003e\n\n\u003cp\u003e本プログラムでは、1個のパッチに対して\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e80個のベクトル値をテッセレーション・エバリュエーションシェーダに送り込む\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eということを行っています。このベクトル値はコントロールポイントと見なすことが出来るので、1個のパッチに 80個のコントロールポイントを使っているわけです。\u003cbr\u003e\nしかし下記サイトを見てみると、1個のパッチの最大コントロールポイント数である \u003ccode\u003eGL_MAX_PATCH_VERTICES\u003c/code\u003e は、GeForce GTX 970M で「32」となっています。\u003cbr\u003e\n\u003ca href=\"https://compubench.com/device.jsp?benchmark=compu20\u0026amp;os=Windows\u0026amp;api=cl\u0026amp;D=NVIDIA+GeForce+GTX+970M\u0026amp;testgroup=info\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCompute Performance of NVIDIA GeForce GTX 970M\u003c/a\u003e\u003cbr\u003e\n（「OpenGL API : GeForce GTX 970M/PCIe/SSE2」を開いて検索してください）\u003c/p\u003e\n\n\u003cp\u003e32 だと、80個のコントロールポイントは送り込めないですよね。ではどうすれば良いのでしょうか？\u003cbr\u003e\nヒントは、\u003ccode\u003eGL_MAX_PATCH_VERTICES\u003c/code\u003e の名前に \u003ccode\u003eVERTICES\u003c/code\u003e と書かれているというところにあります。\u003ccode\u003eVERTICES\u003c/code\u003e は頂点のことですが、例えばバーテックスシェーダで頂点を扱う際、1個の頂点には位置情報の他に法線／色／テクスチャ座標値等を付けたりしますね。\u003c/p\u003e\n\n\u003cp\u003eすなわち 1個の頂点に複数のベクトル値を設定することが出来るわけです。テッセレーション・エバリュエーションシェーダでもそれは同じで、1個のコントロールポイント（頂点）に複数のベクトル値を置くことが出来ます。\u003cbr\u003e\n実際上記サイトでは GTX 970M で、1頂点辺りの最大属性数である \u003ccode\u003eGL_MAX_VERTEX_ATTRIBS\u003c/code\u003e は「16」となっていました。\u003c/p\u003e\n\n\u003cp\u003eつまり $32\\times16=512$ で、1パッチ辺り最大 512個のベクトル値を置けるはずです（やったことは無いですが）。そのため 80個であれば、問題ないわけなのです。\u003c/p\u003e\n\n\u003cp\u003eただし「1個の頂点に設定する属性の数」は、すべての頂点で同じにしなければなりません。そこで、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e1コントロールポイントに設定する属性数は「14」個に固定。これは前述した \u003ccode\u003evertexAry\u003c/code\u003e 配列の要素（オブジェクト）が、14個のメンバ変数から成っていることに対応してます。\u003c/li\u003e\n\u003cli\u003e1パッチのコントロールポイント数は「6」個に固定。1パッチ辺りの \u003ccode\u003evertexAry\u003c/code\u003e 配列内の個数が 6個なのは、このためです。\u003c/li\u003e\n\u003cli\u003eコントロールポイントの属性数は 14個ですが、ベジェ曲線のコントロールポイント数はそれと無関係な個数なので、うまく調整して $6\\times14$ 内に収まるようにします。\u003c/li\u003e\n\u003cli\u003eCPU 側の \u003ccode\u003evertexAry\u003c/code\u003e 配列の中身と、テッセレーション・エバリュエーションシェーダの \u003ccode\u003efromVbo()\u003c/code\u003e 関数内での代入との間で整合性が取れていれば、データの引き渡しは成功するはず。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eとしています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"バーテックスシェーダテッセレーションコントロールシェーダの補足\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%90%E3%83%BC%E3%83%86%E3%83%83%E3%82%AF%E3%82%B9%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%81%AE%E8%A3%9C%E8%B6%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eバーテックスシェーダ／テッセレーション・コントロールシェーダの補足\u003c/h2\u003e\n\n\u003cp\u003e「バーテックスシェーダ」の項で、\u003ccode\u003evertPnt0\u003c/code\u003e ～ \u003ccode\u003evertPnt13\u003c/code\u003e の値を \u003ccode\u003etescPnt0\u003c/code\u003e ～ \u003ccode\u003etescPnt13\u003c/code\u003e に代入していると書きました。つまりこれらの変数は、1コントロールポイントに設定する属性ということになります。\u003cbr\u003e\nということは、バーテックスシェーダの 1回の実行で処理されるのは、1個のコントロールポイントということです。1パッチ辺り 6個のコントロールポイントがあるので、1個のパッチで 6回バーテックスシェーダが実行されることになりますね。\u003cbr\u003e\nもうここまで来ると、バーテックスシェーダの名前の由来である「頂点」とは関係が薄くなってきました。。\u003c/p\u003e\n\n\u003cp\u003eまた「テッセレーション・コントロールシェーダ」の項でも、\u003ccode\u003etescPnt0[gl_InvocationID]\u003c/code\u003e ～ \u003ccode\u003etescPnt13[gl_InvocationID]\u003c/code\u003e の値を \u003ccode\u003etesePnt0[gl_InvocationID]\u003c/code\u003e ～ \u003ccode\u003etesePnt13[gl_InvocationID]\u003c/code\u003e に代入するということについて書いています。\u003cbr\u003e\nバーテックスシェーダとは異なり配列の一要素を代入する形になっていますが、これも 1回の実行で処理されるのは、1個のコントロールポイントです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"テッセレーションエバリュエーションシェーダgetposnormal\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%A8%E3%83%90%E3%83%AA%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80getposnormal\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eテッセレーション・エバリュエーションシェーダ（\u003ccode\u003egetPosNormal\u003c/code\u003e）\u003c/h2\u003e\n\n\u003cp\u003eテッセレーション・エバリュエーションシェーダの関数「\u003ccode\u003efromVbo()\u003c/code\u003e」は、下記の関数からコールされます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"glsl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e（bxViewVbo1.tese）getPosNormal\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003egetPosNormal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e \u003cspan class=\"n\"\u003enormalE\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e  \u003cspan class=\"n\"\u003eu\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003egl_TessCoord\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e  \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003egl_TessCoord\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e7\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e7\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e7\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e7\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e  \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efromVbo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez3\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003evec3\u003c/span\u003e  \u003cspan class=\"n\"\u003eposH\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eposV\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egetPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eposH\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eposV\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003egetNormalE\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehPosBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003evDiffBez0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evDiffBez3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eposH\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eposV\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enormalE\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれを見ると分かるように、\u003ccode\u003efromVbo()\u003c/code\u003e の実行後、\u003ccode\u003egetPosition()\u003c/code\u003e や \u003ccode\u003egetNormalE()\u003c/code\u003e がコールされています。これらの関数は、分割後の頂点位置や法線を算定するためのものですが、詳細は下記リンクをご覧ください。\u003cbr\u003e\nこのリンクは WebGL 版の記事なので言語等が異なりますが、何となく分かるのではないでしょうか？\u003cbr\u003e\n\u003ca href=\"https://qiita.com/beziex/items/d913102ca03266996a0e#beziex-%E3%83%91%E3%83%83%E3%83%81%E3%81%AE%E5%BC%8F%E9%A0%82%E7%82%B9%E4%BD%8D%E7%BD%AE%E3%81%AE%E5%AE%9F%E8%A3%85\" id=\"reference-a77a299f6e7d9487a535\"\u003eBeziex パッチの式（頂点位置）の実装\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/beziex/items/00b614f7aa73f5124a19#u-%E6%96%B9%E5%90%91%E3%81%AE%E5%81%8F%E5%BE%AE%E5%88%86%E5%80%A4%E3%81%AE%E5%BC%8F%E6%9B%B2%E9%9D%A2-a\" id=\"reference-78ce64810336ed158d8b\"\u003eu 方向の偏微分値の式（曲面 A）\u003c/a\u003e ～ \u003ca href=\"https://qiita.com/beziex/items/00b614f7aa73f5124a19#%E6%9B%B2%E9%9D%A2-a-%E3%81%A8%E6%9B%B2%E9%9D%A2-b-%E3%81%AE%E5%81%8F%E5%BE%AE%E5%88%86%E5%80%A4%E3%81%AE%E6%B7%B7%E3%81%9C%E5%90%88%E3%82%8F%E3%81%9B\"\u003e曲面 A と曲面 B の偏微分値の混ぜ合わせ\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eちなみにテッセレーション・エバリュエーションシェーダでは、u および v の値を取得する際に \u003ccode\u003egl_TessCoord\u003c/code\u003e を使います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"tessellation-algorithm--surface-type--gpu-benchmark-fps\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tessellation-algorithm--surface-type--gpu-benchmark-fps\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTessellation algorithm ／ Surface type ／ GPU Benchmark (FPS)\u003c/h2\u003e\n\n\u003cp\u003e本プログラムの UI の、General タブには「Tessellation algorithm」「Surface type」「GPU Benchmark (FPS)」という項目があります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"tessellation-algorithm\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tessellation-algorithm\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTessellation algorithm\u003c/h3\u003e\n\n\u003cp\u003eTessellation algorithm では、「Tessellation shader アルゴリズム」と「Instance geometry アルゴリズム」を切り替えることが出来ます。\u003cbr\u003e\nこのうち Tessellation shader は本稿でこれまで述べてきたアルゴリズムです。Instance geometry は WebGL版で使用しているアルゴリズムですが、本プログラムにも搭載されているので切り替えが可能なのです。\u003cbr\u003e\nなお少し詳しい情報は、下記に載っています。\u003cbr\u003e\n\u003ca href=\"https://github.com/beziex/Beziex_Op/blob/master/README.md#tessellation-algorithm--%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0\" rel=\"nofollow noopener\" target=\"_blank\"\u003eTessellation algorithm ／ テッセレーション・アルゴリズム\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"surface-type\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#surface-type\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSurface type\u003c/h3\u003e\n\n\u003cp\u003e「Solid」はシェーディング面表示、「Wire」はワイヤーフレーム表示です。\u003cbr\u003e\nWire はオマケですが、ポリゴン分割の状態を見る際に分かりやすいと思います。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"gpu-benchmark-fps\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gpu-benchmark-fps\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGPU Benchmark (FPS)\u003c/h3\u003e\n\n\u003cp\u003e本プログラムのベンチマークは「一つのフレームを作り上げるための全ての時間」を示すものでは無く、ドローコールの時間を計るものです。詳細は下記に述べています。\u003cbr\u003e\n\u003ca href=\"https://github.com/beziex/Beziex_Op/blob/master/README.md#gpu-benchmark-fps--gpu-%E3%83%99%E3%83%B3%E3%83%81%E3%83%9E%E3%83%BC%E3%82%AF-fps\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGPU Benchmark (FPS) ／ GPU ベンチマーク (FPS)\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"gpu-benchmark-fps-の実行例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gpu-benchmark-fps-%E3%81%AE%E5%AE%9F%E8%A1%8C%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGPU Benchmark (FPS) の実行例\u003c/h2\u003e\n\n\u003cp\u003e以下に、「i7-6700HQ + GTX 970M + 64bit 版 Windows 10 Pro (1903)」上で、3D モデルとして「MascuteAzur001.gzjson」、分割数 8 で測定した実行例を載せました。ただし実際には Analyze ボタンを押す度に数値は変わるので、あくまでも目安と考えてください。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003ctr\u003e\n\u003cth\u003eTessellation algorithm\u003c/th\u003e\n\u003cth\u003eSurface type\u003c/th\u003e\n\u003cth\u003eFPS\u003c/th\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd rowspan=\"2\"\u003eTessellation shader\u003c/td\u003e\n\u003ctd\u003eSolid\u003c/td\u003e\n\u003ctd\u003e1682.2386\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eWire\u003c/td\u003e\n\u003ctd\u003e280.6474\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd rowspan=\"2\"\u003eInstance geometry\u003c/td\u003e\n\u003ctd\u003eSolid\u003c/td\u003e\n\u003ctd\u003e485.1686\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eWire\u003c/td\u003e\n\u003ctd\u003e306.8509\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/table\u003e\n\n\u003cp\u003e上記の環境では、Wire 選択時のベンチマークがかなり遅いのですが、ゲーム等でワイヤーフレーム表示を行うことは少ないので、とりあえず無視しましょう。\u003cbr\u003e\nそんなわけで Solid どうしで比較すると、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eTessellation shader アルゴリズムは、Instance geometry アルゴリズムの約 3.5倍速い\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eということが分かります。ちなみに分割数を上げると、さらに速度差が広がりますよ。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"終わりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e終わりに\u003c/h2\u003e\n\n\u003cp\u003eということで、WebGL 版テッセレーション ビューワに続いて、OpenTK 版も作ってみたのでした。\u003cbr\u003e\nちなみに本プログラム (C#) の UI は、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eWPF + Prism + ReactiveProperty + Material Design In XAML\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eで作っています。つまり MVVM パターンなのですが、これについては何も説明してませんでしたね。\u003cbr\u003e\n何か機会がありましたらその時に、ということで。。。\u003c/p\u003e\n","createdAt":"2019-10-14T08:46:14Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"0M9PUa1YSwgIv06L2P2xZWrXej/m2SEeeg==--ViQntFEtMlWvDN6T--SVmr6uXe9mex3DKMZ4mYfA==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2019-10-15T12:53:17Z","likesCount":2,"linkUrl":"https://qiita.com/beziex/items/ab1c87918892338eb8df","organization":null,"originalId":1047398,"stockedCount":1,"title":"OpenTK でテッセレーションして、曲面パッチ間が滑らかに繋がった物体を表示","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89\"\u003eソースコード\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#opentk-%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-%E3%83%93%E3%83%A5%E3%83%BC%E3%83%AF\"\u003eOpenTK テッセレーション ビューワ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%93%E3%83%AB%E3%83%89%E7%92%B0%E5%A2%83%E3%81%A8%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83\"\u003eビルド環境と実行環境\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%83%93%E3%83%AB%E3%83%89%E5%AE%9F%E8%A1%8C\"\u003eインストール／ビルド／実行\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%89%8D%E7%9F%A5%E8%AD%98\"\u003e前知識\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E7%B5%84%E3%81%BF%E7%9B%B4%E3%81%97%E5%BE%AE%E5%88%86%E5%80%A4%E7%94%A8%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E7%94%9F%E6%88%90%E3%81%AE%E5%87%A6%E7%90%86\"\u003eコントロールポイント組み直し＆微分値用パラメータ生成の処理\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AE%E9%85%8D%E5%88%97%E5%8C%96\"\u003eパラメータの配列化\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#vbo\"\u003eVBO\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#vao\"\u003eVAO\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%89%E3%83%AD%E3%83%BC%E3%82%B3%E3%83%BC%E3%83%AB\"\u003eドローコール\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%90%E3%83%BC%E3%83%86%E3%83%83%E3%82%AF%E3%82%B9%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80\"\u003eバーテックスシェーダ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80\"\u003eテッセレーション・コントロールシェーダ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%A8%E3%83%90%E3%83%AA%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80fromvbo\"\u003eテッセレーション・エバリュエーションシェーダ（fromVbo）\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%B8%80%E3%81%A4%E3%81%AE%E3%83%91%E3%83%83%E3%83%81%E3%81%AE%E7%82%BA%E3%81%AB%E5%A4%A7%E9%87%8F%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%82%92%E7%BD%AE%E3%81%8F%E6%96%B9%E6%B3%95\"\u003e一つのパッチの為に大量のコントロールポイントを置く方法\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%90%E3%83%BC%E3%83%86%E3%83%83%E3%82%AF%E3%82%B9%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%81%AE%E8%A3%9C%E8%B6%B3\"\u003eバーテックスシェーダ／テッセレーション・コントロールシェーダの補足\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%86%E3%83%83%E3%82%BB%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%A8%E3%83%90%E3%83%AA%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80getposnormal\"\u003eテッセレーション・エバリュエーションシェーダ（getPosNormal）\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#tessellation-algorithm--surface-type--gpu-benchmark-fps\"\u003eTessellation algorithm ／ Surface type ／ GPU Benchmark (FPS)\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#tessellation-algorithm\"\u003eTessellation algorithm\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#surface-type\"\u003eSurface type\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#gpu-benchmark-fps\"\u003eGPU Benchmark (FPS)\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#gpu-benchmark-fps-%E3%81%AE%E5%AE%9F%E8%A1%8C%E4%BE%8B\"\u003eGPU Benchmark (FPS) の実行例\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e終わりに\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":1367,"uuid":"ab1c87918892338eb8df","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"mU4kjIZgzVFQxC+OX1ZsEvpn/eQB--rSuIcrfJNkR/+g4Y--tbE0PfFWLpEFh9tqh9WXdw==","originalId":482181,"description":"CGのモデリング系をプログラミングしてます。","facebookUrl":null,"githubUrl":"https://github.com/beziex","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"beziex（べジェックス）","profileImageUrl":"https://avatars1.githubusercontent.com/u/50129982?v=4","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F50129982%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=8fd0ed034e5de96a74f658640904cb17","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F50129982%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=7c74fb117b6ec825e3e50ce915d6550e","urlName":"beziex","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"GLSL","urlName":"glsl"},{"name":"OpenTK","urlName":"opentk"},{"name":"tessellation","urlName":"tessellation"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

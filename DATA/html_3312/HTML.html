<!DOCTYPE html><html><head><meta charset="utf-8" /><title>Autodesk Inventor API Hacking (だいたい一度はハマること) - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/yamarah/items/43d5858d22bf8604c7fe" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="CIkzdhEqvKXsWkPqOKae8eTagJ8Ajclj7ah8xEz57jFmhBqkSIq8bhpxYFQbTTTpf62zpgEGM6ATxiX7c3Ilhg==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="Autodesk Inventor API Hacking (だいたい一度はハマること) - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1RWFYwYjJSbGMyc2dTVzUyWlc1MGIzSWdRVkJKSUVoaFkydHBibWNnS09PQm9PT0JoT09Cbi1PQmhPUzRnT1c2cHVPQnItT0RqLU9EbnVPQ2ktT0JrLU9CcUNrJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTc5YTNlMmFhN2E0OTMzODAyY2VjZGQ4MmUxYTE0ZDc3&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGxoYldGeVlXZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWJlZTljNGM0Y2I4ODYyZTFiNmVkYmY5OTA4ZGRkNGEy&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=16e7ee7dd5687fdf0a72689a6c60a34a"><meta property="og:description" content="

0. はじめに

Freeradicalの中の人、yamarahです。
一度は誰もがハマる失敗を、まとめてみました。今後もハマる度に、追加していきます。
明らかに直ぐに判明するbugではなく、ある時突然発病する系のものが中心です。..."><meta content="https://qiita.com/yamarah/items/43d5858d22bf8604c7fe" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,api,Autodesk,Addin,Inventor" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-291afb1f-9d7b-4181-b8ab-eee49c62a04e"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fyamarah%2Fitems%2F43d5858d22bf8604c7fe">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fyamarah%2Fitems%2F43d5858d22bf8604c7fe">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-291afb1f-9d7b-4181-b8ab-eee49c62a04e">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-05-26T19:23:23.000+09:00","dateModified":"2021-07-16T12:03:54.000+09:00","headline":"Autodesk Inventor API Hacking (だいたい一度はハマること)","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1RWFYwYjJSbGMyc2dTVzUyWlc1MGIzSWdRVkJKSUVoaFkydHBibWNnS09PQm9PT0JoT09Cbi1PQmhPUzRnT1c2cHVPQnItT0RqLU9EbnVPQ2ktT0JrLU9CcUNrJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTc5YTNlMmFhN2E0OTMzODAyY2VjZGQ4MmUxYTE0ZDc3\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGxoYldGeVlXZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWJlZTljNGM0Y2I4ODYyZTFiNmVkYmY5OTA4ZGRkNGEy\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=16e7ee7dd5687fdf0a72689a6c60a34a","mainEntityOfPage":"https://qiita.com/yamarah/items/43d5858d22bf8604c7fe","author":{"@type":"Person","address":"Japan","email":null,"identifier":"yamarah","name":"yamarah","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F424028%2Fprofile-images%2F1566697359?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=2df8e9f8b5e1739a16ff2e7eb5d407d3","url":"https://qiita.com/yamarah","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yamarah","type":"items","id":"43d5858d22bf8604c7fe"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yamarah","type":"items","id":"43d5858d22bf8604c7fe"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yamarah","type":"items","id":"43d5858d22bf8604c7fe"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/yamarah/items/43d5858d22bf8604c7fe","location":"/yamarah/items/43d5858d22bf8604c7fe","scheme":"https","host":"qiita.com","port":null,"pathname":"/yamarah/items/43d5858d22bf8604c7fe","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"8A1m/j+7+H2BkMiKpw6W0/Od8FoXpiu6Z87iLJEhm5ieAE8sZhv4tne76zSE5TzLaOrDYxYt0XmZoLsTrqpQLw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-023eedfa-fbb9-4ec3-b8a9-69b821dc5fde"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yamarah/items/43d5858d22bf8604c7fe/likers" class="css-1iupg5d">0</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">0</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/43d5858d22bf8604c7fe/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yamarah/items/43d5858d22bf8604c7fe/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yamarah/items/43d5858d22bf8604c7fe/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yamarah/items/43d5858d22bf8604c7fe/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yamarah/items/43d5858d22bf8604c7fe.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/yamarah"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/424028/profile-images/1566697359" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/yamarah" class="css-10ougpm">@<!-- -->yamarah</a><div class="css-1ay9vb9"><span><meta content="2019-05-26T10:23:23Z"/><time dateTime="2021-07-16T03:03:54Z" class="css-m19uds">updated at 2021-07-16</time></span></div></div></div></div></div><h1 class="css-cgzq40">Autodesk Inventor API Hacking (だいたい一度はハマること)</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/api" class="css-4czcte">api</a><a href="/tags/autodesk" class="css-4czcte">Autodesk</a><a href="/tags/addin" class="css-4czcte">Addin</a><a href="/tags/inventor" class="css-4czcte">Inventor</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="0-はじめに" class="fragment"></span><a href="#0-%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>0. はじめに</h1>

<p><a href="https://www.freeradical.jp" rel="nofollow noopener" target="_blank">Freeradical</a>の中の人、<a href="https://qiita.com/yamarah">yamarah</a>です。<br>
一度は誰もがハマる失敗を、まとめてみました。今後もハマる度に、追加していきます。<br>
明らかに直ぐに判明するbugではなく、ある時突然発病する系のものが中心です。</p>

<h1>
<span id="1-selectset" class="fragment"></span><a href="#1-selectset"><i class="fa fa-link"></i></a>1. SelectSet</h1>

<p>通常はActiveEditDocumentを起点にdocumentにアクセスしますが、SelectSetだけは例外です。<br>
ActiveDocument.SelectSetにアクセスしないと、失敗します。<br>
だいたい、インプレース編集するまで気づきません。</p>

<h1>
<span id="2-proxy" class="fragment"></span><a href="#2-proxy"><i class="fa fa-link"></i></a>2. Proxy</h1>

<p>これは奥が深いので、簡単にしか触れませんが、AssemblyDocument内で、Sub Assemblyをインプレース編集中にoccurrenceにアクセスする時は、注意が必要です。<br>
テスト項目に、インプレース編集中の動作は必ず入れるべきです。</p>

<h1>
<span id="3-ユーザーは自由に選択する" class="fragment"></span><a href="#3-%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AF%E8%87%AA%E7%94%B1%E3%81%AB%E9%81%B8%E6%8A%9E%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>3. ユーザーは自由に選択する</h1>

<p>例えば、次のようなコマンドを開発するとします。</p>

<ul>
<li>2Dスケッチ環境で</li>
<li>選択されたSketchEntityの</li>
<li>色を変える。</li>
</ul>

<p>この場合、ユーザーがアクティブではないスケッチのSketchEntityを選択する可能性を考慮する必要があります。</p>

<h1>
<span id="4-何もない場合がある" class="fragment"></span><a href="#4-%E4%BD%95%E3%82%82%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88%E3%81%8C%E3%81%82%E3%82%8B"><i class="fa fa-link"></i></a>4. 何もない場合がある</h1>

<ul>
<li>開いているDocumentがない。(ActiveEditDocument == null)</li>
<li>PartDocumentにFeatureが1つもない。</li>
<li>AssemblyDocumentにOccuurenceが1つもない。</li>
<li>DrawingDocumentにViewが1つもない。</li>
<li>DrawingDocumentに図面枠、表題欄がない。</li>
</ul>

<h1>
<span id="5-オブジェクト編集中" class="fragment"></span><a href="#5-%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E7%B7%A8%E9%9B%86%E4%B8%AD"><i class="fa fa-link"></i></a>5. オブジェクト編集中</h1>

<p>インプレース編集中でない時にしか動作させないコマンドは、現在インプレース編集中でないかを判断してから実行する必要があります。<br>
PartDocument, AssemblyDocumentでは、document.ActivatedObject == nullかどうか、<br>
DrawingDocumentでは、document.ActivatedObject is Sheetかどうかで判断します。</p>

<h1>
<span id="6-コマンド実行中にdocumentをスイッチ" class="fragment"></span><a href="#6-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E5%AE%9F%E8%A1%8C%E4%B8%AD%E3%81%ABdocument%E3%82%92%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81"><i class="fa fa-link"></i></a>6. コマンド実行中にDocumentをスイッチ</h1>

<p>コマンドでインタラクティブな操作を実行中に、ユーザーがActiveEditDocumetを変更する可能性があります。<br>
場合によっては、コンテキスト(データ)をDoument毎に用意する必要があります。</p>

<h1>
<span id="7-コマンド実行中にコマンドを実行" class="fragment"></span><a href="#7-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E5%AE%9F%E8%A1%8C%E4%B8%AD%E3%81%AB%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>7. コマンド実行中にコマンドを実行</h1>

<p>コマンドを実行中に、ユーザーにコマンドを起動されることがあります。<br>
OnExecute()で、いわゆる再入が発生します。</p>

<h1>
<span id="8-インタラクティブな操作をする時は一旦onexecuteを抜けるべき" class="fragment"></span><a href="#8-%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%81%AA%E6%93%8D%E4%BD%9C%E3%82%92%E3%81%99%E3%82%8B%E6%99%82%E3%81%AF%E4%B8%80%E6%97%A6onexecute%E3%82%92%E6%8A%9C%E3%81%91%E3%82%8B%E3%81%B9%E3%81%8D"><i class="fa fa-link"></i></a>8. インタラクティブな操作をする時は、一旦OnExecute()を抜けるべき</h1>

<p>インタラクティブな操作をする時は、InteractionEvents.Start()して、即座にOnExecute()を終了すべきです。<br>
OnExecute()から抜けずに処理していると、色々と微妙な問題が発生します。</p>

<h1>
<span id="9-新規ドキュメント" class="fragment"></span><a href="#9-%E6%96%B0%E8%A6%8F%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>9. 新規ドキュメント</h1>

<p>新規に作成されたDocumentで、一度も保存されていないものは、一部のPropertyにアクセスすると例外を発生します。(ファイルの実体が無いので)</p>

<h1>
<span id="10-解決していないドキュメント" class="fragment"></span><a href="#10-%E8%A7%A3%E6%B1%BA%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>10. 解決していないドキュメント</h1>

<p>Inventorは柔軟なので、一部のDocumentファイルがなくても、親Documentを開くことが出来ます。<br>
その場合、リンク切れのOccurrenceの一部のPropertyにアクセスすると、例外が発生します。</p>

<h1>
<span id="11-browsernodenativeobjectに触れると例外発生" class="fragment"></span><a href="#11-browsernodenativeobject%E3%81%AB%E8%A7%A6%E3%82%8C%E3%82%8B%E3%81%A8%E4%BE%8B%E5%A4%96%E7%99%BA%E7%94%9F"><i class="fa fa-link"></i></a>11. BrowserNode.NativeObjectに触れると例外発生</h1>

<p>例えばDrawingDocumentで、BrowserNode.NativeObjectに触れると例外が発生することがあります。<br>
他には、インポートしたソリッドなども同様です。<br>
ですので、以下のcodeは、そのうち例外を送出します。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="n">BrowserNodesEnumerator</span> <span class="n">browserNodes</span> <span class="p">=</span> <span class="n">document</span><span class="p">.</span><span class="n">BrowserPanes</span><span class="p">[</span><span class="s">"PmDefault"</span><span class="p">].</span><span class="n">TopNode</span><span class="p">.</span><span class="n">BrowserNodes</span><span class="p">;</span>
<span class="k">foreach</span> <span class="p">(</span><span class="n">BrowserNode</span> <span class="n">node</span> <span class="k">in</span> <span class="n">browserNodes</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">NativeObject</span> <span class="k">is</span> <span class="n">EndOfFeatures</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//</span>
    <span class="c1">// 何らかの処理</span>
    <span class="c1">//</span>
<span class="p">}</span>

</code></pre></div></div>

<h1>
<span id="12-ファイル名問題" class="fragment"></span><a href="#12-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%90%8D%E5%95%8F%E9%A1%8C"><i class="fa fa-link"></i></a>12. ファイル名問題</h1>

<p>これはInventorのAddIn開発に限った話ではなく、Windows全般の問題ですが、あるpath(ファイル名)が、他のpathと同じファイルを指しているかどうかを判断するのが、非常に難しいです。</p>

<ul>
<li>大文字、小文字</li>
<li>ネットワークドライブ</li>
<li>Symbolic link</li>
<li>などなど・・・</li>
</ul>

<p>path文字列同士の比較では、恐らく判断しきれないので、わざと実行時例外を発生させるようなcodeを書いて判断するしかないのかなと思います。<br>
大文字・小文字問題はToUpper()すればいいじゃないか、という人もいますが、それ、本当に全言語のWindowsで成り立ちますか?</p>

<h1>
<span id="13-selecteventsremovefromselectedentitiesしてますか" class="fragment"></span><a href="#13-selecteventsremovefromselectedentities%E3%81%97%E3%81%A6%E3%81%BE%E3%81%99%E3%81%8B"><i class="fa fa-link"></i></a>13. SelectEvents.RemoveFromSelectedEntities()してますか?</h1>

<p>これはやれば気付く部類ですが、SelectEventsを実行しっぱしで、選択したものを次々処理するような場合は、処理が終わったobjectは<code>RemoveFromSelectedEntities()</code>で<code>SelectEvents</code>から除去する必要があります。<br>
(でないと、HighLightしたままになる)</p>

<h1>
<span id="14-readonlyとstatic" class="fragment"></span><a href="#14-readonly%E3%81%A8static"><i class="fa fa-link"></i></a>14. readonlyとstatic</h1>

<p>例えば、次のようなコードがあるとします。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="k">public</span> <span class="k">class</span> <span class="nc">StandardAddInServer</span> <span class="p">:</span> <span class="n">Inventor</span><span class="p">.</span><span class="n">ApplicationAddInServer</span>
<span class="p">{</span>
    <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Document</span><span class="p">&gt;</span> <span class="n">list1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Document</span><span class="p">&gt;();</span>
    <span class="k">static</span>   <span class="n">List</span><span class="p">&lt;</span><span class="n">Document</span><span class="p">&gt;</span> <span class="n">list2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Document</span><span class="p">&gt;();</span>

</code></pre></div></div>

<p>これらは、AddInを開発する上では、ほとんど同じに思えます。<br>
(まず間違いなく、StandardAddInServerの実体は1つしか作られないのですから)<br>
しかし、決定的な違いが出る場合があります。それは、<code>アドイン マネージャ</code>から<code>ロード解除</code> → 再<code>ロード</code>した場合です。<br>
この場合、StandardAddInServerの実体は破棄されて再構築されますが、staticな要素はそのままです。<br>
つまり、list1は必ず空になりますが、list2は前回のセッションの内容を残すということです。<br>
安易にグローバル変数の代替にstaticを使うと、はまります。(自戒)</p>

<h1>
<span id="15-interopのプロパティ設定" class="fragment"></span><a href="#15-interop%E3%81%AE%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>15. interopのプロパティ設定</h1>

<p>下記項目は、全てFalseにしておかないと、環境によって動いたり動かなかったりします。<br>
<a href="https://camo.qiitausercontent.com/c5f5db40529cc3a194e71a6efcfa294421d255ed/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3432343032382f39393361633131652d613034372d653036372d356461332d3362343736613364306662342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F424028%2F993ac11e-a047-e067-5da3-3b476a3d0fb4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6760024b49e29c2f4cd7a1cb084832cb" alt="interop.PNG" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/424028/993ac11e-a047-e067-5da3-3b476a3d0fb4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F424028%2F993ac11e-a047-e067-5da3-3b476a3d0fb4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8e19da59aae7cd26ed40989038b039bb 1x" loading="lazy"></a><br>
* ローカルにコピー<br>
* 相互運用型の埋め込み<br>
* 特定バージョン</p>

<p>自分の環境では動くのに、配布先で動かないという場合は、相手のInventorのversion確認は当然として、この設定も確認してみてください。</p>

<h1>
<span id="16-documentをdirtyにする可能性があるならinteractioneventsstartすべき" class="fragment"></span><a href="#16-document%E3%82%92dirty%E3%81%AB%E3%81%99%E3%82%8B%E5%8F%AF%E8%83%BD%E6%80%A7%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AA%E3%82%89interactioneventsstart%E3%81%99%E3%81%B9%E3%81%8D"><i class="fa fa-link"></i></a>16. DocumentをDirtyにする可能性があるなら、InteractionEvents.Start()すべき</h1>

<p>長くなるので、<a href="https://qiita.com/yamarah/items/5cba5a3772df76c67086" id="reference-39ae7b8d175e8f06f4e6">別記事</a>に纏めました。<br>
特殊な条件下で、Inventorをcrashさせる可能性があります。</p>

<h1>
<span id="17-sketchlineにstartsketchpoint-endsketchpointがあるとは限らない" class="fragment"></span><a href="#17-sketchline%E3%81%ABstartsketchpoint-endsketchpoint%E3%81%8C%E3%81%82%E3%82%8B%E3%81%A8%E3%81%AF%E9%99%90%E3%82%89%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>17. SketchLineにStartSketchPoint, EndSketchPointがあるとは限らない</h1>

<p>例えば作業線を投影した直線は、長さを持ちません。<br>
ですので、画面上では線分ですが扱いは(数学的な)直線であり、両端がありません。</p>

<h1>
<span id="18-virtual-componentに注意しろ" class="fragment"></span><a href="#18-virtual-component%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%97%E3%82%8D"><i class="fa fa-link"></i></a>18. Virtual Componentに注意しろ</h1>

<p>Virtual ComponentのOccurrenceの<code>DefinitionDocumentType</code>には、<code>kAssemblyDocumentObject</code>が設定されています。<br>
例えば名前を参照するだけならAssemblyとして扱っても良いのかもしれませんが、経験上はだいたいハマります。Virtual Componentに出会うまで発病しないパターンです。<br>
Virtual Componentかどうかを<code>occurrence.Definition is VirtualComponentDefinition</code>で切り分けて、特別な処理をするcodeを書くのが良いでしょう。<br>
BOMを辿るときも、同様な注意が必要です。</p>

<h1>
<span id="19-画面上のbrowserに存在しないbrowsernodeがある" class="fragment"></span><a href="#19-%E7%94%BB%E9%9D%A2%E4%B8%8A%E3%81%AEbrowser%E3%81%AB%E5%AD%98%E5%9C%A8%E3%81%97%E3%81%AA%E3%81%84browsernode%E3%81%8C%E3%81%82%E3%82%8B"><i class="fa fa-link"></i></a>19. 画面上のBrowserに存在しないBrowserNodeがある</h1>

<p><code>DrawingDocument</code>において、例えば断面ビューではビューに存在しない<code>Occurrence</code>は、画面上のBrowserにも表示されません。<br>
しかし、内部的には<code>BrowserNode</code>は存在しており、Topから辿っていくと到達することが出来ます。<br>
この、「存在しているのに表示されていない」<code>BrowserNode</code>にアクセスすると、例外が送出されることがあります。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="n">BrowserNode</span> <span class="n">node</span><span class="p">;</span> <span class="c1">// 存在しているのに表示されていないBrowserNode</span>
<span class="c1">// 中略</span>
<span class="n">node</span><span class="p">.</span><span class="nf">DoSelect</span><span class="p">();</span>       <span class="c1">// 何も選択されない</span>
<span class="n">_</span> <span class="p">=</span> <span class="n">node</span><span class="p">.</span><span class="n">Expanded</span><span class="p">;</span>     <span class="c1">// 例外にならない</span>
<span class="n">node</span><span class="p">.</span><span class="n">Expanded</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span> <span class="c1">// 例外が送出される!!</span>
</code></pre></div></div>

<h1>
<span id="20-図面環境でカスタムビューの方向を選択すると特殊なビューが作られる" class="fragment"></span><a href="#20-%E5%9B%B3%E9%9D%A2%E7%92%B0%E5%A2%83%E3%81%A7%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%93%E3%83%A5%E3%83%BC%E3%81%AE%E6%96%B9%E5%90%91%E3%82%92%E9%81%B8%E6%8A%9E%E3%81%99%E3%82%8B%E3%81%A8%E7%89%B9%E6%AE%8A%E3%81%AA%E3%83%93%E3%83%A5%E3%83%BC%E3%81%8C%E4%BD%9C%E3%82%89%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>20. 図面環境で「カスタムビューの方向」を選択すると、特殊なビューが作られる</h1>

<p>タイトル通り、「カスタムビューの方向」を選択すると、特殊なビューが作られます。<br>
このビューが表示中は、いくつかの機能が制限されます。(例 : <code>ファイル</code> → <code>開く</code>が使えない)<br>
また、このビューが表示中は・・・</p>

<ul>
<li>ActiveDocumentがnullになる</li>
<li>ActiveDocumentTypeがkNoDocumentになる</li>
<li>ActiveViewの幾つかのメンバー(例えば、Parent)に触れるだけで例外が発生する</li>
</ul>

<p>などの、通常と異なった振る舞いをします。<br>
常駐系のAddInを開発する場合は、この状況で誤動作しないように注意が必要です。<br>
下記codeで「カスタムビューの方向」が実行中かどうか、判断できます。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre><code><span class="k">if</span> <span class="p">(</span><span class="n">InventorApplication</span><span class="p">.</span><span class="n">ActiveEnvironment</span><span class="p">.</span><span class="n">InternalName</span> <span class="p">==</span> <span class="s">"DLxDrawingCustomViewEnvironment"</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Drawing環境で、カスタムビューを実行中</span>
    <span class="c1">// Errorを表示するなり、処理を終了するなり・・・</span>
<span class="p">}</span>
</code></pre></div></div>

<h1>
<span id="21-interactionevents実行中にwinformを作るとinventor終了時にエラーが起きる" class="fragment"></span><a href="#21-interactionevents%E5%AE%9F%E8%A1%8C%E4%B8%AD%E3%81%ABwinform%E3%82%92%E4%BD%9C%E3%82%8B%E3%81%A8inventor%E7%B5%82%E4%BA%86%E6%99%82%E3%81%AB%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E8%B5%B7%E3%81%8D%E3%82%8B"><i class="fa fa-link"></i></a>21. InteractionEvents実行中にWinFormを作るとInventor終了時にエラーが起きる</h1>

<p><code>InteractionEvents</code>とDialog(WinForm)を同時に使うと、ごくまれにInventor終了時にアプリケーションエラーが発生します。(Inventor 2020にて確認)<br>
Dialogがmodelでもmodelessでも関係ない、というか、<code>new</code>していれば表示しなくてもエラーが起きます。<br>
かなり再現性が低いのですが、ゼロではありません。<br>
<del>残念ながら、回避する方法はなさそうなので、こういう構成のアプリケーションは作成してはいけない、ということです。</del></p>

<p>19.11.01 追記<br>
回避策を見つけました。<br>
<code>InteractionEvents</code>中で登録したEvent(例えば、<code>InteractionEvents.SelectEvents.OnPreSelect</code>)を、<code>InteractionEvents.OnTerminate</code>などで登録解除すると、エラーが出なくなりました。</p>

<h1>
<span id="22-selectevent中にaddbyprojectingentityするなら先にremovefromselectedentitiesしろ" class="fragment"></span><a href="#22-selectevent%E4%B8%AD%E3%81%ABaddbyprojectingentity%E3%81%99%E3%82%8B%E3%81%AA%E3%82%89%E5%85%88%E3%81%ABremovefromselectedentities%E3%81%97%E3%82%8D"><i class="fa fa-link"></i></a>22. SelectEvent中にAddByProjectingEntityするなら、先にRemoveFromSelectedEntitiesしろ</h1>

<p>これはタイトルの通りで、SelectEventで要素を選択して、それを投影する場合は、投影するより先に選択表示を解除する必要があります。<br>
後で解除すると、不安定な<code>OnPreSelect</code>や<code>OnSelect</code>が発行されることがあります。<br>
また、選択表示解除しないと、見た目は選択が解除されているが内部的には選択表示のままになりることがあります。</p>

<h1>
<span id="23-sketchesaddが迷子のsketchを返すことがある" class="fragment"></span><a href="#23-sketchesadd%E3%81%8C%E8%BF%B7%E5%AD%90%E3%81%AEsketch%E3%82%92%E8%BF%94%E3%81%99%E3%81%93%E3%81%A8%E3%81%8C%E3%81%82%E3%82%8B"><i class="fa fa-link"></i></a>23. Sketches.Addが迷子のSketchを返すことがある</h1>

<p>AssemblyDocument中のPartDocumentをIn-Place編集中に、AssemblyのWorkplaneを引数に<code>Sketches.Add(workplane)</code>すると、しれっとPlanarSketchが返ってくるのですが、このSketchはどのDocumentにも属していない迷子のSketchです。<br>
編集しようとすると、Inventorごと落ちることがあります。<br>
手動でこの操作をすると、AdaptiveなWorkplaneが自動的に作られ、そこにSketchが作成されます。ですので、APIでも同様に動作するか、もしくはいっそ例外を投げて欲しいところです。</p>

<h1>
<span id="24-スケッチブロック編集" class="fragment"></span><a href="#24-%E3%82%B9%E3%82%B1%E3%83%83%E3%83%81%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>24. スケッチブロック編集</h1>

<p>スケッチ編集中に動作するAddInを作る場合は、それがスケッチブロックを編集中でも動作するか確認すべきです。<br>
残念ながら、2020年5月6日時点では、APIでスケッチブロック内に拘束を付与することが出来ないようなので(<a href="https://qiita.com/yamarah/items/373e3a8b4169312b1749#4-sketchblockdefinition%E5%86%85%E3%81%AB%E6%8B%98%E6%9D%9F%E4%BB%98%E4%B8%8E%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84" id="reference-d5aadf47b7ec6bef1797">4. SketchBlockDefinition内に拘束付与できない</a>)、スケッチ拘束を操作するAddInはスケッチブロック編集中に動作しないようロックするなどの措置が必要です。<br>
また、<code>SketchBlockDefinition</code>は<code>PlanarSketch</code>を継承しているので、条件分岐のコードを書く場合は順序に注意が必要です。<br>
(具体的には、先に<code>SketchBlockDefinition</code>かどうかを確認すべき。)</p>

<h1>
<span id="25-model-stateモデル状態に気を付けろ" class="fragment"></span><a href="#25-model-state%E3%83%A2%E3%83%87%E3%83%AB%E7%8A%B6%E6%85%8B%E3%81%AB%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8D"><i class="fa fa-link"></i></a>25. Model State(モデル状態)に気を付けろ</h1>

<p>Inventor2022からModel State(モデル状態)が導入されました。これにより、同じDocumentだとしても、形状やiPropertyが違う可能性が出てきました。<br>
情報をキャッシュしている場合や、同じDocumentのOccurrenceなら内容も同じと決め打ちしている場合は、正常に動作しない可能性があります。</p>

<h1>
<span id="26-sheetmetalに気を付けろ" class="fragment"></span><a href="#26-sheetmetal%E3%81%AB%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8D"><i class="fa fa-link"></i></a>26. SheetMetalに気を付けろ</h1>

<p>SheetMetalは普通のパーツと違うところがあるのですが、Documentとしては、<code>PartDocument</code>です。DocumentのFeatureをなめて操作するToolだと、SheetMetalはFeatureが"曲げモデル"というFolderに入っているので、専用の処理が必要になります。<br>
次のような拡張メソッドを定義するのが良いでしょう。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="k">public</span> <span class="k">static</span> <span class="n">BrowserNodesEnumerator</span> <span class="nf">GetFeatureNodes</span><span class="p">(</span><span class="k">this</span> <span class="n">PartDocument</span> <span class="n">PartDocument</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">BrowserNodesEnumerator</span> <span class="n">browserNodes</span> <span class="p">=</span> <span class="n">PartDocument</span><span class="p">.</span><span class="n">BrowserPanes</span><span class="p">[</span><span class="s">"PmDefault"</span><span class="p">].</span><span class="n">TopNode</span><span class="p">.</span><span class="n">BrowserNodes</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">PartDocument</span><span class="p">.</span><span class="n">ComponentDefinition</span> <span class="k">is</span> <span class="n">not</span> <span class="n">SheetMetalComponentDefinition</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">browserNodes</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="n">BrowserNode</span> <span class="n">node</span> <span class="k">in</span> <span class="n">browserNodes</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">NativeObject</span> <span class="k">is</span> <span class="n">SheetMetalComponentDefinition</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">node</span><span class="p">.</span><span class="n">BrowserNodes</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h1>
<span id="99-親の記事に戻る" class="fragment"></span><a href="#99-%E8%A6%AA%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E6%88%BB%E3%82%8B"><i class="fa fa-link"></i></a>99. 親の記事に戻る</h1>

<p><a href="https://qiita.com/yamarah/items/cee08eb8f2b7aecbda83" id="reference-c780aa93c6a66d2f3dbd">Autodesk Inventor API Hacking (概略)</a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fyamarah%2Fitems%2F43d5858d22bf8604c7fe&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fyamarah%2Fitems%2F43d5858d22bf8604c7fe&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yamarah/items/43d5858d22bf8604c7fe/likers" class="css-1iupg5d">0</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">0</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/43d5858d22bf8604c7fe/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yamarah/items/43d5858d22bf8604c7fe/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yamarah/items/43d5858d22bf8604c7fe/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yamarah/items/43d5858d22bf8604c7fe/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yamarah/items/43d5858d22bf8604c7fe.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-023eedfa-fbb9-4ec3-b8a9-69b821dc5fde">{"authorAnalyticsTrackingId":"UA-148455261-2","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-145a526f-0247-4a65-b3fc-288067c1713e"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-145a526f-0247-4a65-b3fc-288067c1713e">{}</script>
      
<div id="LoginModal-react-component-d5012b29-1eb5-410e-b367-2191870dc18b"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-d5012b29-1eb5-410e-b367-2191870dc18b">{}</script>
      
<div id="StockModal-react-component-fb4be732-b301-4607-a501-2720ec747864"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-fb4be732-b301-4607-a501-2720ec747864">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;uJ/Sc9I0LtIchdhPSk47zCvDDkCS+bbuAXB8IAe+WgHWkvuhi5QuGequ+/FppZHUsLQ9eZNyTC3/HiUfODWRtg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"0-はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#0-%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e0. はじめに\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.freeradical.jp\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFreeradical\u003c/a\u003eの中の人、\u003ca href=\"https://qiita.com/yamarah\"\u003eyamarah\u003c/a\u003eです。\u003cbr\u003e\n一度は誰もがハマる失敗を、まとめてみました。今後もハマる度に、追加していきます。\u003cbr\u003e\n明らかに直ぐに判明するbugではなく、ある時突然発病する系のものが中心です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"1-selectset\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-selectset\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. SelectSet\u003c/h1\u003e\n\n\u003cp\u003e通常はActiveEditDocumentを起点にdocumentにアクセスしますが、SelectSetだけは例外です。\u003cbr\u003e\nActiveDocument.SelectSetにアクセスしないと、失敗します。\u003cbr\u003e\nだいたい、インプレース編集するまで気づきません。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"2-proxy\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-proxy\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. Proxy\u003c/h1\u003e\n\n\u003cp\u003eこれは奥が深いので、簡単にしか触れませんが、AssemblyDocument内で、Sub Assemblyをインプレース編集中にoccurrenceにアクセスする時は、注意が必要です。\u003cbr\u003e\nテスト項目に、インプレース編集中の動作は必ず入れるべきです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"3-ユーザーは自由に選択する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AF%E8%87%AA%E7%94%B1%E3%81%AB%E9%81%B8%E6%8A%9E%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. ユーザーは自由に選択する\u003c/h1\u003e\n\n\u003cp\u003e例えば、次のようなコマンドを開発するとします。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e2Dスケッチ環境で\u003c/li\u003e\n\u003cli\u003e選択されたSketchEntityの\u003c/li\u003e\n\u003cli\u003e色を変える。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこの場合、ユーザーがアクティブではないスケッチのSketchEntityを選択する可能性を考慮する必要があります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"4-何もない場合がある\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-%E4%BD%95%E3%82%82%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88%E3%81%8C%E3%81%82%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4. 何もない場合がある\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e開いているDocumentがない。(ActiveEditDocument == null)\u003c/li\u003e\n\u003cli\u003ePartDocumentにFeatureが1つもない。\u003c/li\u003e\n\u003cli\u003eAssemblyDocumentにOccuurenceが1つもない。\u003c/li\u003e\n\u003cli\u003eDrawingDocumentにViewが1つもない。\u003c/li\u003e\n\u003cli\u003eDrawingDocumentに図面枠、表題欄がない。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"5-オブジェクト編集中\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E7%B7%A8%E9%9B%86%E4%B8%AD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5. オブジェクト編集中\u003c/h1\u003e\n\n\u003cp\u003eインプレース編集中でない時にしか動作させないコマンドは、現在インプレース編集中でないかを判断してから実行する必要があります。\u003cbr\u003e\nPartDocument, AssemblyDocumentでは、document.ActivatedObject == nullかどうか、\u003cbr\u003e\nDrawingDocumentでは、document.ActivatedObject is Sheetかどうかで判断します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"6-コマンド実行中にdocumentをスイッチ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E5%AE%9F%E8%A1%8C%E4%B8%AD%E3%81%ABdocument%E3%82%92%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6. コマンド実行中にDocumentをスイッチ\u003c/h1\u003e\n\n\u003cp\u003eコマンドでインタラクティブな操作を実行中に、ユーザーがActiveEditDocumetを変更する可能性があります。\u003cbr\u003e\n場合によっては、コンテキスト(データ)をDoument毎に用意する必要があります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"7-コマンド実行中にコマンドを実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#7-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E5%AE%9F%E8%A1%8C%E4%B8%AD%E3%81%AB%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e7. コマンド実行中にコマンドを実行\u003c/h1\u003e\n\n\u003cp\u003eコマンドを実行中に、ユーザーにコマンドを起動されることがあります。\u003cbr\u003e\nOnExecute()で、いわゆる再入が発生します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"8-インタラクティブな操作をする時は一旦onexecuteを抜けるべき\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#8-%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%81%AA%E6%93%8D%E4%BD%9C%E3%82%92%E3%81%99%E3%82%8B%E6%99%82%E3%81%AF%E4%B8%80%E6%97%A6onexecute%E3%82%92%E6%8A%9C%E3%81%91%E3%82%8B%E3%81%B9%E3%81%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e8. インタラクティブな操作をする時は、一旦OnExecute()を抜けるべき\u003c/h1\u003e\n\n\u003cp\u003eインタラクティブな操作をする時は、InteractionEvents.Start()して、即座にOnExecute()を終了すべきです。\u003cbr\u003e\nOnExecute()から抜けずに処理していると、色々と微妙な問題が発生します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"9-新規ドキュメント\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#9-%E6%96%B0%E8%A6%8F%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e9. 新規ドキュメント\u003c/h1\u003e\n\n\u003cp\u003e新規に作成されたDocumentで、一度も保存されていないものは、一部のPropertyにアクセスすると例外を発生します。(ファイルの実体が無いので)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"10-解決していないドキュメント\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#10-%E8%A7%A3%E6%B1%BA%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e10. 解決していないドキュメント\u003c/h1\u003e\n\n\u003cp\u003eInventorは柔軟なので、一部のDocumentファイルがなくても、親Documentを開くことが出来ます。\u003cbr\u003e\nその場合、リンク切れのOccurrenceの一部のPropertyにアクセスすると、例外が発生します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"11-browsernodenativeobjectに触れると例外発生\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#11-browsernodenativeobject%E3%81%AB%E8%A7%A6%E3%82%8C%E3%82%8B%E3%81%A8%E4%BE%8B%E5%A4%96%E7%99%BA%E7%94%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e11. BrowserNode.NativeObjectに触れると例外発生\u003c/h1\u003e\n\n\u003cp\u003e例えばDrawingDocumentで、BrowserNode.NativeObjectに触れると例外が発生することがあります。\u003cbr\u003e\n他には、インポートしたソリッドなども同様です。\u003cbr\u003e\nですので、以下のcodeは、そのうち例外を送出します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eBrowserNodesEnumerator\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowserNodes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserPanes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"PmDefault\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eTopNode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserNodes\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserNode\u003c/span\u003e \u003cspan class=\"n\"\u003enode\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowserNodes\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNativeObject\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003eEndOfFeatures\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 何らかの処理\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"12-ファイル名問題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#12-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%90%8D%E5%95%8F%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e12. ファイル名問題\u003c/h1\u003e\n\n\u003cp\u003eこれはInventorのAddIn開発に限った話ではなく、Windows全般の問題ですが、あるpath(ファイル名)が、他のpathと同じファイルを指しているかどうかを判断するのが、非常に難しいです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e大文字、小文字\u003c/li\u003e\n\u003cli\u003eネットワークドライブ\u003c/li\u003e\n\u003cli\u003eSymbolic link\u003c/li\u003e\n\u003cli\u003eなどなど・・・\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003epath文字列同士の比較では、恐らく判断しきれないので、わざと実行時例外を発生させるようなcodeを書いて判断するしかないのかなと思います。\u003cbr\u003e\n大文字・小文字問題はToUpper()すればいいじゃないか、という人もいますが、それ、本当に全言語のWindowsで成り立ちますか?\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"13-selecteventsremovefromselectedentitiesしてますか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#13-selecteventsremovefromselectedentities%E3%81%97%E3%81%A6%E3%81%BE%E3%81%99%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e13. SelectEvents.RemoveFromSelectedEntities()してますか?\u003c/h1\u003e\n\n\u003cp\u003eこれはやれば気付く部類ですが、SelectEventsを実行しっぱしで、選択したものを次々処理するような場合は、処理が終わったobjectは\u003ccode\u003eRemoveFromSelectedEntities()\u003c/code\u003eで\u003ccode\u003eSelectEvents\u003c/code\u003eから除去する必要があります。\u003cbr\u003e\n(でないと、HighLightしたままになる)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"14-readonlyとstatic\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#14-readonly%E3%81%A8static\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e14. readonlyとstatic\u003c/h1\u003e\n\n\u003cp\u003e例えば、次のようなコードがあるとします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eStandardAddInServer\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eInventor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eApplicationAddInServer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elist1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e   \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elist2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれらは、AddInを開発する上では、ほとんど同じに思えます。\u003cbr\u003e\n(まず間違いなく、StandardAddInServerの実体は1つしか作られないのですから)\u003cbr\u003e\nしかし、決定的な違いが出る場合があります。それは、\u003ccode\u003eアドイン マネージャ\u003c/code\u003eから\u003ccode\u003eロード解除\u003c/code\u003e → 再\u003ccode\u003eロード\u003c/code\u003eした場合です。\u003cbr\u003e\nこの場合、StandardAddInServerの実体は破棄されて再構築されますが、staticな要素はそのままです。\u003cbr\u003e\nつまり、list1は必ず空になりますが、list2は前回のセッションの内容を残すということです。\u003cbr\u003e\n安易にグローバル変数の代替にstaticを使うと、はまります。(自戒)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"15-interopのプロパティ設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#15-interop%E3%81%AE%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e15. interopのプロパティ設定\u003c/h1\u003e\n\n\u003cp\u003e下記項目は、全てFalseにしておかないと、環境によって動いたり動かなかったりします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c5f5db40529cc3a194e71a6efcfa294421d255ed/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3432343032382f39393361633131652d613034372d653036372d356461332d3362343736613364306662342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F424028%2F993ac11e-a047-e067-5da3-3b476a3d0fb4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6760024b49e29c2f4cd7a1cb084832cb\" alt=\"interop.PNG\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/424028/993ac11e-a047-e067-5da3-3b476a3d0fb4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F424028%2F993ac11e-a047-e067-5da3-3b476a3d0fb4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8e19da59aae7cd26ed40989038b039bb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n* ローカルにコピー\u003cbr\u003e\n* 相互運用型の埋め込み\u003cbr\u003e\n* 特定バージョン\u003c/p\u003e\n\n\u003cp\u003e自分の環境では動くのに、配布先で動かないという場合は、相手のInventorのversion確認は当然として、この設定も確認してみてください。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"16-documentをdirtyにする可能性があるならinteractioneventsstartすべき\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#16-document%E3%82%92dirty%E3%81%AB%E3%81%99%E3%82%8B%E5%8F%AF%E8%83%BD%E6%80%A7%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AA%E3%82%89interactioneventsstart%E3%81%99%E3%81%B9%E3%81%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e16. DocumentをDirtyにする可能性があるなら、InteractionEvents.Start()すべき\u003c/h1\u003e\n\n\u003cp\u003e長くなるので、\u003ca href=\"https://qiita.com/yamarah/items/5cba5a3772df76c67086\" id=\"reference-39ae7b8d175e8f06f4e6\"\u003e別記事\u003c/a\u003eに纏めました。\u003cbr\u003e\n特殊な条件下で、Inventorをcrashさせる可能性があります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"17-sketchlineにstartsketchpoint-endsketchpointがあるとは限らない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#17-sketchline%E3%81%ABstartsketchpoint-endsketchpoint%E3%81%8C%E3%81%82%E3%82%8B%E3%81%A8%E3%81%AF%E9%99%90%E3%82%89%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e17. SketchLineにStartSketchPoint, EndSketchPointがあるとは限らない\u003c/h1\u003e\n\n\u003cp\u003e例えば作業線を投影した直線は、長さを持ちません。\u003cbr\u003e\nですので、画面上では線分ですが扱いは(数学的な)直線であり、両端がありません。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"18-virtual-componentに注意しろ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#18-virtual-component%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%97%E3%82%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e18. Virtual Componentに注意しろ\u003c/h1\u003e\n\n\u003cp\u003eVirtual ComponentのOccurrenceの\u003ccode\u003eDefinitionDocumentType\u003c/code\u003eには、\u003ccode\u003ekAssemblyDocumentObject\u003c/code\u003eが設定されています。\u003cbr\u003e\n例えば名前を参照するだけならAssemblyとして扱っても良いのかもしれませんが、経験上はだいたいハマります。Virtual Componentに出会うまで発病しないパターンです。\u003cbr\u003e\nVirtual Componentかどうかを\u003ccode\u003eoccurrence.Definition is VirtualComponentDefinition\u003c/code\u003eで切り分けて、特別な処理をするcodeを書くのが良いでしょう。\u003cbr\u003e\nBOMを辿るときも、同様な注意が必要です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"19-画面上のbrowserに存在しないbrowsernodeがある\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#19-%E7%94%BB%E9%9D%A2%E4%B8%8A%E3%81%AEbrowser%E3%81%AB%E5%AD%98%E5%9C%A8%E3%81%97%E3%81%AA%E3%81%84browsernode%E3%81%8C%E3%81%82%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e19. 画面上のBrowserに存在しないBrowserNodeがある\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003eDrawingDocument\u003c/code\u003eにおいて、例えば断面ビューではビューに存在しない\u003ccode\u003eOccurrence\u003c/code\u003eは、画面上のBrowserにも表示されません。\u003cbr\u003e\nしかし、内部的には\u003ccode\u003eBrowserNode\u003c/code\u003eは存在しており、Topから辿っていくと到達することが出来ます。\u003cbr\u003e\nこの、「存在しているのに表示されていない」\u003ccode\u003eBrowserNode\u003c/code\u003eにアクセスすると、例外が送出されることがあります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eBrowserNode\u003c/span\u003e \u003cspan class=\"n\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 存在しているのに表示されていないBrowserNode\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 中略\u003c/span\u003e\n\u003cspan class=\"n\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDoSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e       \u003cspan class=\"c1\"\u003e// 何も選択されない\u003c/span\u003e\n\u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExpanded\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// 例外にならない\u003c/span\u003e\n\u003cspan class=\"n\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExpanded\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 例外が送出される!!\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"20-図面環境でカスタムビューの方向を選択すると特殊なビューが作られる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#20-%E5%9B%B3%E9%9D%A2%E7%92%B0%E5%A2%83%E3%81%A7%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%93%E3%83%A5%E3%83%BC%E3%81%AE%E6%96%B9%E5%90%91%E3%82%92%E9%81%B8%E6%8A%9E%E3%81%99%E3%82%8B%E3%81%A8%E7%89%B9%E6%AE%8A%E3%81%AA%E3%83%93%E3%83%A5%E3%83%BC%E3%81%8C%E4%BD%9C%E3%82%89%E3%82%8C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e20. 図面環境で「カスタムビューの方向」を選択すると、特殊なビューが作られる\u003c/h1\u003e\n\n\u003cp\u003eタイトル通り、「カスタムビューの方向」を選択すると、特殊なビューが作られます。\u003cbr\u003e\nこのビューが表示中は、いくつかの機能が制限されます。(例 : \u003ccode\u003eファイル\u003c/code\u003e → \u003ccode\u003e開く\u003c/code\u003eが使えない)\u003cbr\u003e\nまた、このビューが表示中は・・・\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eActiveDocumentがnullになる\u003c/li\u003e\n\u003cli\u003eActiveDocumentTypeがkNoDocumentになる\u003c/li\u003e\n\u003cli\u003eActiveViewの幾つかのメンバー(例えば、Parent)に触れるだけで例外が発生する\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eなどの、通常と異なった振る舞いをします。\u003cbr\u003e\n常駐系のAddInを開発する場合は、この状況で誤動作しないように注意が必要です。\u003cbr\u003e\n下記codeで「カスタムビューの方向」が実行中かどうか、判断できます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInventorApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eActiveEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInternalName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"DLxDrawingCustomViewEnvironment\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// Drawing環境で、カスタムビューを実行中\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// Errorを表示するなり、処理を終了するなり・・・\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"21-interactionevents実行中にwinformを作るとinventor終了時にエラーが起きる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#21-interactionevents%E5%AE%9F%E8%A1%8C%E4%B8%AD%E3%81%ABwinform%E3%82%92%E4%BD%9C%E3%82%8B%E3%81%A8inventor%E7%B5%82%E4%BA%86%E6%99%82%E3%81%AB%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E8%B5%B7%E3%81%8D%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e21. InteractionEvents実行中にWinFormを作るとInventor終了時にエラーが起きる\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003eInteractionEvents\u003c/code\u003eとDialog(WinForm)を同時に使うと、ごくまれにInventor終了時にアプリケーションエラーが発生します。(Inventor 2020にて確認)\u003cbr\u003e\nDialogがmodelでもmodelessでも関係ない、というか、\u003ccode\u003enew\u003c/code\u003eしていれば表示しなくてもエラーが起きます。\u003cbr\u003e\nかなり再現性が低いのですが、ゼロではありません。\u003cbr\u003e\n\u003cdel\u003e残念ながら、回避する方法はなさそうなので、こういう構成のアプリケーションは作成してはいけない、ということです。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e19.11.01 追記\u003cbr\u003e\n回避策を見つけました。\u003cbr\u003e\n\u003ccode\u003eInteractionEvents\u003c/code\u003e中で登録したEvent(例えば、\u003ccode\u003eInteractionEvents.SelectEvents.OnPreSelect\u003c/code\u003e)を、\u003ccode\u003eInteractionEvents.OnTerminate\u003c/code\u003eなどで登録解除すると、エラーが出なくなりました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"22-selectevent中にaddbyprojectingentityするなら先にremovefromselectedentitiesしろ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#22-selectevent%E4%B8%AD%E3%81%ABaddbyprojectingentity%E3%81%99%E3%82%8B%E3%81%AA%E3%82%89%E5%85%88%E3%81%ABremovefromselectedentities%E3%81%97%E3%82%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e22. SelectEvent中にAddByProjectingEntityするなら、先にRemoveFromSelectedEntitiesしろ\u003c/h1\u003e\n\n\u003cp\u003eこれはタイトルの通りで、SelectEventで要素を選択して、それを投影する場合は、投影するより先に選択表示を解除する必要があります。\u003cbr\u003e\n後で解除すると、不安定な\u003ccode\u003eOnPreSelect\u003c/code\u003eや\u003ccode\u003eOnSelect\u003c/code\u003eが発行されることがあります。\u003cbr\u003e\nまた、選択表示解除しないと、見た目は選択が解除されているが内部的には選択表示のままになりることがあります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"23-sketchesaddが迷子のsketchを返すことがある\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#23-sketchesadd%E3%81%8C%E8%BF%B7%E5%AD%90%E3%81%AEsketch%E3%82%92%E8%BF%94%E3%81%99%E3%81%93%E3%81%A8%E3%81%8C%E3%81%82%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e23. Sketches.Addが迷子のSketchを返すことがある\u003c/h1\u003e\n\n\u003cp\u003eAssemblyDocument中のPartDocumentをIn-Place編集中に、AssemblyのWorkplaneを引数に\u003ccode\u003eSketches.Add(workplane)\u003c/code\u003eすると、しれっとPlanarSketchが返ってくるのですが、このSketchはどのDocumentにも属していない迷子のSketchです。\u003cbr\u003e\n編集しようとすると、Inventorごと落ちることがあります。\u003cbr\u003e\n手動でこの操作をすると、AdaptiveなWorkplaneが自動的に作られ、そこにSketchが作成されます。ですので、APIでも同様に動作するか、もしくはいっそ例外を投げて欲しいところです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"24-スケッチブロック編集\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#24-%E3%82%B9%E3%82%B1%E3%83%83%E3%83%81%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E7%B7%A8%E9%9B%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e24. スケッチブロック編集\u003c/h1\u003e\n\n\u003cp\u003eスケッチ編集中に動作するAddInを作る場合は、それがスケッチブロックを編集中でも動作するか確認すべきです。\u003cbr\u003e\n残念ながら、2020年5月6日時点では、APIでスケッチブロック内に拘束を付与することが出来ないようなので(\u003ca href=\"https://qiita.com/yamarah/items/373e3a8b4169312b1749#4-sketchblockdefinition%E5%86%85%E3%81%AB%E6%8B%98%E6%9D%9F%E4%BB%98%E4%B8%8E%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84\" id=\"reference-d5aadf47b7ec6bef1797\"\u003e4. SketchBlockDefinition内に拘束付与できない\u003c/a\u003e)、スケッチ拘束を操作するAddInはスケッチブロック編集中に動作しないようロックするなどの措置が必要です。\u003cbr\u003e\nまた、\u003ccode\u003eSketchBlockDefinition\u003c/code\u003eは\u003ccode\u003ePlanarSketch\u003c/code\u003eを継承しているので、条件分岐のコードを書く場合は順序に注意が必要です。\u003cbr\u003e\n(具体的には、先に\u003ccode\u003eSketchBlockDefinition\u003c/code\u003eかどうかを確認すべき。)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"25-model-stateモデル状態に気を付けろ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#25-model-state%E3%83%A2%E3%83%87%E3%83%AB%E7%8A%B6%E6%85%8B%E3%81%AB%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e25. Model State(モデル状態)に気を付けろ\u003c/h1\u003e\n\n\u003cp\u003eInventor2022からModel State(モデル状態)が導入されました。これにより、同じDocumentだとしても、形状やiPropertyが違う可能性が出てきました。\u003cbr\u003e\n情報をキャッシュしている場合や、同じDocumentのOccurrenceなら内容も同じと決め打ちしている場合は、正常に動作しない可能性があります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"26-sheetmetalに気を付けろ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#26-sheetmetal%E3%81%AB%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e26. SheetMetalに気を付けろ\u003c/h1\u003e\n\n\u003cp\u003eSheetMetalは普通のパーツと違うところがあるのですが、Documentとしては、\u003ccode\u003ePartDocument\u003c/code\u003eです。DocumentのFeatureをなめて操作するToolだと、SheetMetalはFeatureが\"曲げモデル\"というFolderに入っているので、専用の処理が必要になります。\u003cbr\u003e\n次のような拡張メソッドを定義するのが良いでしょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eBrowserNodesEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFeatureNodes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003ePartDocument\u003c/span\u003e \u003cspan class=\"n\"\u003ePartDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eBrowserNodesEnumerator\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowserNodes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePartDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserPanes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"PmDefault\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eTopNode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserNodes\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePartDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eComponentDefinition\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003enot\u003c/span\u003e \u003cspan class=\"n\"\u003eSheetMetalComponentDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowserNodes\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserNode\u003c/span\u003e \u003cspan class=\"n\"\u003enode\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowserNodes\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNativeObject\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003eSheetMetalComponentDefinition\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserNodes\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eInvalidOperationException\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"99-親の記事に戻る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#99-%E8%A6%AA%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E6%88%BB%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e99. 親の記事に戻る\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/yamarah/items/cee08eb8f2b7aecbda83\" id=\"reference-c780aa93c6a66d2f3dbd\"\u003eAutodesk Inventor API Hacking (概略)\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2019-05-26T10:23:23Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"n1ouRBKz211MTmIQcDCmrkF9QSWYEA08--UmABPSQb8UrZBNMH--czekNhj1wiEjshmAhtyOXw==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2021-07-16T03:03:54Z","likesCount":0,"linkUrl":"https://qiita.com/yamarah/items/43d5858d22bf8604c7fe","organization":null,"originalId":907217,"stockedCount":0,"title":"Autodesk Inventor API Hacking (だいたい一度はハマること)","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#0-%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e0. はじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1-selectset\"\u003e1. SelectSet\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-proxy\"\u003e2. Proxy\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3-%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AF%E8%87%AA%E7%94%B1%E3%81%AB%E9%81%B8%E6%8A%9E%E3%81%99%E3%82%8B\"\u003e3. ユーザーは自由に選択する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4-%E4%BD%95%E3%82%82%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88%E3%81%8C%E3%81%82%E3%82%8B\"\u003e4. 何もない場合がある\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#5-%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E7%B7%A8%E9%9B%86%E4%B8%AD\"\u003e5. オブジェクト編集中\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#6-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E5%AE%9F%E8%A1%8C%E4%B8%AD%E3%81%ABdocument%E3%82%92%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81\"\u003e6. コマンド実行中にDocumentをスイッチ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#7-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E5%AE%9F%E8%A1%8C%E4%B8%AD%E3%81%AB%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E5%AE%9F%E8%A1%8C\"\u003e7. コマンド実行中にコマンドを実行\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#8-%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%81%AA%E6%93%8D%E4%BD%9C%E3%82%92%E3%81%99%E3%82%8B%E6%99%82%E3%81%AF%E4%B8%80%E6%97%A6onexecute%E3%82%92%E6%8A%9C%E3%81%91%E3%82%8B%E3%81%B9%E3%81%8D\"\u003e8. インタラクティブな操作をする時は、一旦OnExecute()を抜けるべき\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#9-%E6%96%B0%E8%A6%8F%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88\"\u003e9. 新規ドキュメント\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#10-%E8%A7%A3%E6%B1%BA%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88\"\u003e10. 解決していないドキュメント\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#11-browsernodenativeobject%E3%81%AB%E8%A7%A6%E3%82%8C%E3%82%8B%E3%81%A8%E4%BE%8B%E5%A4%96%E7%99%BA%E7%94%9F\"\u003e11. BrowserNode.NativeObjectに触れると例外発生\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#12-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%90%8D%E5%95%8F%E9%A1%8C\"\u003e12. ファイル名問題\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#13-selecteventsremovefromselectedentities%E3%81%97%E3%81%A6%E3%81%BE%E3%81%99%E3%81%8B\"\u003e13. SelectEvents.RemoveFromSelectedEntities()してますか?\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#14-readonly%E3%81%A8static\"\u003e14. readonlyとstatic\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#15-interop%E3%81%AE%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E8%A8%AD%E5%AE%9A\"\u003e15. interopのプロパティ設定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#16-document%E3%82%92dirty%E3%81%AB%E3%81%99%E3%82%8B%E5%8F%AF%E8%83%BD%E6%80%A7%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AA%E3%82%89interactioneventsstart%E3%81%99%E3%81%B9%E3%81%8D\"\u003e16. DocumentをDirtyにする可能性があるなら、InteractionEvents.Start()すべき\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#17-sketchline%E3%81%ABstartsketchpoint-endsketchpoint%E3%81%8C%E3%81%82%E3%82%8B%E3%81%A8%E3%81%AF%E9%99%90%E3%82%89%E3%81%AA%E3%81%84\"\u003e17. SketchLineにStartSketchPoint, EndSketchPointがあるとは限らない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#18-virtual-component%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%97%E3%82%8D\"\u003e18. Virtual Componentに注意しろ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#19-%E7%94%BB%E9%9D%A2%E4%B8%8A%E3%81%AEbrowser%E3%81%AB%E5%AD%98%E5%9C%A8%E3%81%97%E3%81%AA%E3%81%84browsernode%E3%81%8C%E3%81%82%E3%82%8B\"\u003e19. 画面上のBrowserに存在しないBrowserNodeがある\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#20-%E5%9B%B3%E9%9D%A2%E7%92%B0%E5%A2%83%E3%81%A7%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%93%E3%83%A5%E3%83%BC%E3%81%AE%E6%96%B9%E5%90%91%E3%82%92%E9%81%B8%E6%8A%9E%E3%81%99%E3%82%8B%E3%81%A8%E7%89%B9%E6%AE%8A%E3%81%AA%E3%83%93%E3%83%A5%E3%83%BC%E3%81%8C%E4%BD%9C%E3%82%89%E3%82%8C%E3%82%8B\"\u003e20. 図面環境で「カスタムビューの方向」を選択すると、特殊なビューが作られる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#21-interactionevents%E5%AE%9F%E8%A1%8C%E4%B8%AD%E3%81%ABwinform%E3%82%92%E4%BD%9C%E3%82%8B%E3%81%A8inventor%E7%B5%82%E4%BA%86%E6%99%82%E3%81%AB%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E8%B5%B7%E3%81%8D%E3%82%8B\"\u003e21. InteractionEvents実行中にWinFormを作るとInventor終了時にエラーが起きる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#22-selectevent%E4%B8%AD%E3%81%ABaddbyprojectingentity%E3%81%99%E3%82%8B%E3%81%AA%E3%82%89%E5%85%88%E3%81%ABremovefromselectedentities%E3%81%97%E3%82%8D\"\u003e22. SelectEvent中にAddByProjectingEntityするなら、先にRemoveFromSelectedEntitiesしろ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#23-sketchesadd%E3%81%8C%E8%BF%B7%E5%AD%90%E3%81%AEsketch%E3%82%92%E8%BF%94%E3%81%99%E3%81%93%E3%81%A8%E3%81%8C%E3%81%82%E3%82%8B\"\u003e23. Sketches.Addが迷子のSketchを返すことがある\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#24-%E3%82%B9%E3%82%B1%E3%83%83%E3%83%81%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E7%B7%A8%E9%9B%86\"\u003e24. スケッチブロック編集\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#25-model-state%E3%83%A2%E3%83%87%E3%83%AB%E7%8A%B6%E6%85%8B%E3%81%AB%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8D\"\u003e25. Model State(モデル状態)に気を付けろ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#26-sheetmetal%E3%81%AB%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8D\"\u003e26. SheetMetalに気を付けろ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#99-%E8%A6%AA%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E6%88%BB%E3%82%8B\"\u003e99. 親の記事に戻る\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":2402,"uuid":"43d5858d22bf8604c7fe","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"euiLuUQL0rLdviBee1q1CrNt4DrZ--TKnPQLbhR2Ugp/ec--K3LxfEZMIcwXdCZ5ByfFNg==","originalId":424028,"description":"","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"yamarah","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/424028/profile-images/1566697359","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F424028%2Fprofile-images%2F1566697359?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=0dfe81fe613f51099ee087a94b11e01e","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F424028%2Fprofile-images%2F1566697359?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=2df8e9f8b5e1739a16ff2e7eb5d407d3","urlName":"yamarah","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"api","urlName":"api"},{"name":"Autodesk","urlName":"autodesk"},{"name":"Addin","urlName":"addin"},{"name":"Inventor","urlName":"inventor"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

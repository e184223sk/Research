本記事は QualiArts Advent Calendar 2020の２４日目の記事です。Editorを実装した際に躓いた点や新しく発見した点などを、個人的に後日振り替えれるようにまとめました。各内容が大きくなってしまったので記事をわけています。
興味のあるき時から読んでいただければ幸いです。この記事では主にUnityのEditor拡張でUIを作成したときの内容をまとめています。
Unityでゲームを作っているがツール周りの開発経験はほぼないため基本的な内容になります。次の画像を参考にUIを組んでいきました。まずはEditorを縦に分けている3つのエリアを作っていきます。
縦のエリアを分けるためには、EditorGUILayoutのVerticalScopeを使います。
具体的には、次のように実装をしました。参考画像 こんな感じに分かれる。
タイムラインの再生や停止などタイムラインの操作をするためのボタンを配置していきます。
先程3つにわかれたエリアの上部を使います。このような感じで必要なボタンやトグルを作っていきます。
とりあえず3つのボタンを配置するとこのような感じになりました。
ボタンを押したときのメニューを表示できるようにします。
想定されているのはTweenを追加・削除する場合ですが、いろいろな場面で使えそうなUIです。
GenericMenuを使って実装を行います。ボタンを押したときにメニューが表示されるようになりました。
実際には、どのUIをアニメーションさせたいかのUIを指定したいです。ある特定の範囲内でマウスのボタンを押したときにメニューが表示されるようにしたい場合、次のような実装を行います。
マウスのクリック判定にはEvent.currentを使います。図はわかりにくいですが、このように特定の範囲でMenuを表示させることができます。
ただこのままではEditor上のどこをクリックしてもメニューが表示されてしまうので、クリックできる範囲を指定する必要がありそうです。
その場合には次のように実装をしました。真ん中のエリアに表示したいのがタイムラインのUIです。まずは、タイムライン上の現在の時間がわかるUIを表示したいと思います。
一定の距離の応じて線を引いて時間の区分を表します。
線はHandlesクラスを使って実装をしてみます。Handlesは本来3D空間に図形を書くクラスなのですが2D画面上でも使うことができます。
DrawLineはスタート位置と終了位置を結ぶ線を描画します
「Handles.DrawLine」
https://docs.unity3d.com/ja/current/ScriptReference/Handles.DrawLine.htmlこのような感じで線を引くことができます。
時間がわかりやすいように数字を入れても良いかもしれません。
タイムラインを再生しているときの現在の位置を確認するためのライン（縦線）を実装します。
これもHandlesのDrawLineを使います。フラグを上手く管理して、再生ボタンを押すと赤い線が表示されるようするとそれっぽくなります。
実際にはUpdateを使い再生中にoffsetの値を変更してあげれば動きます。
UpdateでRpaint処理を呼びUIを更新させる必要があります。タイムライン上にアニメーションの情報を描画します。
今回はTestとして開始時間のみのAnimation情報を用意しました。
これを使います。このような感じで描画されます。
現状、スタート時間しか変更できないですが長さなどを変更できるようすれば連続したAnimationを実装できます。再生するアニメーション情報を表示・編集するためにInspectorを右側のエリアに表示をします。
この場合、Editor.CreateEditorを使うと上手く表示ができました。
[参考]
https://baba-s.hatenablog.com/entry/2017/12/29/095000このような感じでSerializeFieldやpublicな変数がEditor上に表示できます。
Editorに関しては、この記事執筆時（2020/12/24)ある程度動くところまで実装はできたのですが、まだゲーム開発で使えるまでには作り込めていないため、サンプルなどは用意していません。
今後継続して開発は続けるつもりですので、何かしらアウトプットできるものがあれば何かしらの形で公開したいと思っています。現在、本当に基本的な部分までしか実装できていないので、今後実装をしてみたい機能を列挙してみました。エディタ拡張のUIについては今後UITookKitに置き換わっていくと思うので、今回は従来のUI実装をやってみましたが、UITookKitでも実装をしてみたいなと思っています。
https://docs.unity3d.com/ja/2020.1/Manual/UIElements.html



<!DOCTYPE html><html><head><meta charset="utf-8" /><title>駅すぱあと x Cognitive Services で 画像DE路線当てBOT を作ろう！ [Bot実装 (C# ver) 編] - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/annie/items/c4bcc3dff1fa17deea2b" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="aM4qqkS2IKZS45Pd63Shudba7k+PQGRwlEJ9sFKXeQxlSrA1f6VIrNjqzXMc0f75q9IvCEm6n4l19QPPpaUV9g==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="駅すぱあと x Cognitive Services で 画像DE路線当てBOT を作ろう！ [Bot実装 (C# ver) 編] - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND02YWVGNDRHWjQ0R3g0NEdDNDRHb0lIZ2dRMjluYm1sMGFYWmxJRk5sY25acFkyVnpJT09CcHlEbmxMdmxnNDlFUmVpM3ItZTNtdVc5ay1PQnBrSlBWQ0RqZ3BMa3ZaempnbzNqZ1lidnZJRWdXMEp2ZE9XdW4taWpoU0FvUXlNZ2RtVnlLU0RudDZoZCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz02NGRjOGRlYzA5YjdhMjAzYTBlY2ZkNGFmYzE0YTU1Zg&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR0Z1Ym1sbCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWQ4ZmNkZWE0YWRlZWRmMGZhMmJkMmU0M2U0M2M4ZDFl&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=60be5f61490d6b9a66c026d7ab71e2f5"><meta property="og:description" content="Microsoft Cognitive Services の Custom Vision Service は、オリジナルの画像判定エンジンを作成して API で推定値を取得できるサービスです。また、駅すぱあとwebサービス は、国内初..."><meta content="https://qiita.com/annie/items/c4bcc3dff1fa17deea2b" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,BotFramework,CognitiveServices,駅すぱあと,CustomVisionService" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-1ef5b52b-ee60-49fb-997b-22be18e76390"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fannie%2Fitems%2Fc4bcc3dff1fa17deea2b">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fannie%2Fitems%2Fc4bcc3dff1fa17deea2b">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-1ef5b52b-ee60-49fb-997b-22be18e76390">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-09-25T06:59:00.000+09:00","dateModified":"2017-09-28T14:34:45.000+09:00","headline":"駅すぱあと x Cognitive Services で 画像DE路線当てBOT を作ろう！ [Bot実装 (C# ver) 編]","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND02YWVGNDRHWjQ0R3g0NEdDNDRHb0lIZ2dRMjluYm1sMGFYWmxJRk5sY25acFkyVnpJT09CcHlEbmxMdmxnNDlFUmVpM3ItZTNtdVc5ay1PQnBrSlBWQ0RqZ3BMa3ZaempnbzNqZ1lidnZJRWdXMEp2ZE9XdW4taWpoU0FvUXlNZ2RtVnlLU0RudDZoZCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz02NGRjOGRlYzA5YjdhMjAzYTBlY2ZkNGFmYzE0YTU1Zg\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR0Z1Ym1sbCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWQ4ZmNkZWE0YWRlZWRmMGZhMmJkMmU0M2U0M2M4ZDFl\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=60be5f61490d6b9a66c026d7ab71e2f5","mainEntityOfPage":"https://qiita.com/annie/items/c4bcc3dff1fa17deea2b","author":{"@type":"Person","address":"","email":null,"identifier":"annie","name":"annie","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F117583%2F73c0d5e64925a01ddfcb5dfec9aa2ffb823090e5%2Fx_large.png%3F1604022610?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=3764d31bd55c31b2a8f553c55cffdb7d","url":"https://qiita.com/annie","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita&amp;utm_medium=header-banner">運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"annie","type":"items","id":"c4bcc3dff1fa17deea2b"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"annie","type":"items","id":"c4bcc3dff1fa17deea2b"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"annie","type":"items","id":"c4bcc3dff1fa17deea2b"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/annie/items/c4bcc3dff1fa17deea2b","location":"/annie/items/c4bcc3dff1fa17deea2b","scheme":"https","host":"qiita.com","port":null,"pathname":"/annie/items/c4bcc3dff1fa17deea2b","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"8aryPCHnhjCi2kFWimISLkJy09uSu1EWv3HA5UDXyzL8LmijGvTuOijTH/h9x01uP3oSnFRBqu9exr6at+WnyA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-3fe08f1b-7554-434c-b3a1-cec0f95c8456"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/annie/items/c4bcc3dff1fa17deea2b/likers" class="css-1iupg5d">3</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">9</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/c4bcc3dff1fa17deea2b/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/annie/items/c4bcc3dff1fa17deea2b/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/annie/items/c4bcc3dff1fa17deea2b/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/annie/items/c4bcc3dff1fa17deea2b/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/annie/items/c4bcc3dff1fa17deea2b.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/annie"><img class="css-100alwu eyfquo10" src="https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/117583/73c0d5e64925a01ddfcb5dfec9aa2ffb823090e5/x_large.png?1604022610" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/annie" class="css-10ougpm">@<!-- -->annie</a><div class="css-1ay9vb9"><span><meta content="2017-09-24T21:59:00Z"/><time dateTime="2017-09-28T05:34:45Z" class="css-m19uds">updated at 2017-09-28</time></span></div></div></div></div></div><h1 class="css-cgzq40">駅すぱあと x Cognitive Services で 画像DE路線当てBOT を作ろう！ [Bot実装 (C# ver) 編]</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/botframework" class="css-4czcte">BotFramework</a><a href="/tags/cognitiveservices" class="css-4czcte">CognitiveServices</a><a href="/tags/%e9%a7%85%e3%81%99%e3%81%b1%e3%81%82%e3%81%a8" class="css-4czcte">駅すぱあと</a><a href="/tags/customvisionservice" class="css-4czcte">CustomVisionService</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p><a href="https://azure.microsoft.com/ja-jp/services/cognitive-services/" rel="nofollow noopener" target="_blank">Microsoft Cognitive Services</a> の <a href="https://azure.microsoft.com/ja-jp/services/cognitive-services/custom-vision-service/" rel="nofollow noopener" target="_blank">Custom Vision Service</a> は、オリジナルの画像判定エンジンを作成して API で推定値を取得できるサービスです。また、<a href="https://ekiworld.net/service/lp/webservice/" rel="nofollow noopener" target="_blank">駅すぱあとwebサービス</a> は、国内初の乗換案内ソフト <a href="https://ekiworld.net/about/index.html" rel="nofollow noopener" target="_blank">駅すぱあと</a> がもつ様々な情報をWebAPIで提供しているサービスです。</p>

<p>今回は Custom Vision Service で作成した画像判定エンジンを利用して、<br>
鉄道の路線を画像から判別し、 駅すぱあとwebサービス を利用して路線に含まれる駅を検索し、それを返す BOT を作成する方法を紹介します。</p>

<blockquote>
<p>Microsoft Cognitive Services の Custom Vision Service は、オリジナルの画像判定エンジンを作成して API で推定値を取得できるサービスです。<br>
機械学習などで画像判定ロジックを構築しなくても、画像をアップロードしてタグ付けを行うことで、画像判定エンジンを構築できます。</p>

<p><a href="https://ekiworld.net/service/lp/webservice/" rel="nofollow noopener" target="_blank">駅すぱあとwebサービス</a> は、国内初の乗換案内ソフト <a href="https://ekiworld.net/about/index.html" rel="nofollow noopener" target="_blank">駅すぱあと</a> がもつ様々な情報をWebAPIで提供しているサービスです。<br>
経路探索はもちろん、駅データや時刻表などの情報を取得することができます。 <br>
無料で使えるフリープランを用意しており、企業にかぎらず個人でもご利用いただけます。</p>
</blockquote>

<p>ベースは Microsoft Bot Framework (V3.0 以降) テンプレートを利用し、Cognitive Services Custom Vision (Prediction) C# クラスライブラリーを用いて呼び出しを行います。</p>

<p>この BOT アプリは Bot Framework Channel Emulator を使ってローカル環境で稼働確認することが可能です。また、Web 公開 &amp; Bot Framework に登録すると、埋め込み可能な Web Chat が利用できます。</p>

<blockquote>
<p><strong>駅すぱあと x Cognitive Services で 画像DE路線当てBOT を作ろう！</strong><br>
(1) <a href="https://qiita.com/hmaruyama/items/fd28cdee19a55fb510b1" id="reference-51c8690fd6b379afa4de">Custom Vision 編</a><br>
(2) Bot実装編 <br>
- <a href="https://qiita.com/hmaruyama/items/8db9d869e63408c6c444" id="reference-395c4b36666e770539b8">Node.js ver 編</a><br>
- <strong>C# ver 編</strong> ※このページ</p>
</blockquote>

<p>Custom Vision 編、Bot実装 編を通して作成できる 画像DE路線当てBOT↓<br>
<a href="https://camo.qiitausercontent.com/7a6a6ddb4adb03c310b58e1305b16d1c1c1f65f4/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30312e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_01.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=75a206dd6c909f3f7803e605649f1fdd" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_01.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_01.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ee23c8dfcd465d0eb4bbe5c4b059459d 1x" loading="lazy"></a></p>

<h1>
<span id="bot-framework--cognitive-services-利用に必要な環境サブスクリプションの準備" class="fragment"></span><a href="#bot-framework--cognitive-services-%E5%88%A9%E7%94%A8%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E7%92%B0%E5%A2%83%E3%82%B5%E3%83%96%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>Bot Framework &amp; Cognitive Services 利用に必要な環境、サブスクリプションの準備</h1>

<h2>
<span id="開発環境" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>開発環境</h2>

<h3>
<span id="visual-studiobot-framework-template--bot-framework-channel-emulator" class="fragment"></span><a href="#visual-studiobot-framework-template--bot-framework-channel-emulator"><i class="fa fa-link"></i></a>Visual Studio、Bot Framework Template &amp; Bot Framework Channel Emulator</h3>

<p>無償の Visual Studio 2017 Community or 2015 Community でOKなので、既存の環境がない場合は、ダウンロードしてインストールします。<br>
<a href="https://www.visualstudio.com/ja-jp/products/visual-studio-community-vs.aspx" rel="nofollow noopener" target="_blank">Visual Studio 2017 Community ダウンロードサイト</a><br>
<a href="http://aka.ms/bf-bc-vstemplate" rel="nofollow noopener" target="_blank">Visual Studio 用の Bot Framework C# テンプレート</a><br>
<a href="https://aka.ms/bf-bc-emulator" rel="nofollow noopener" target="_blank">Bot Framework Channel Emulator (Windows版)</a> ※Mac/Linux は <a href="https://aka.ms/bfemulator" rel="nofollow noopener" target="_blank">Console版</a> をご利用ください</p>

<blockquote>
<p>Bot Framework 開発環境の作り方は、<a href="http://qiita.com/annie/items/edc26c0ee9603e84a2e4#bot-framework-%E3%82%92%E4%BD%BF%E3%81%86%E3%81%9F%E3%82%81%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83" id="reference-bc54f93104f2e73c7ee5">Microsoft Bot Framework v3.0 からはじめる BOT 開発: Bot Framework を使うための開発環境</a> をご覧ください。</p>
</blockquote>

<h2>
<span id="駅すぱあと-webサービス-のアクセスキー" class="fragment"></span><a href="#%E9%A7%85%E3%81%99%E3%81%B1%E3%81%82%E3%81%A8-web%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9-%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%AD%E3%83%BC"><i class="fa fa-link"></i></a>駅すぱあと Webサービス のアクセスキー</h2>

<p><a href="https://ekiworld.net/service/sier/webservice/index.html" rel="nofollow noopener" target="_blank">駅すぱあと Webサービス</a> のフリープランをお申込みいただき、アクセスキーを取得してください。<br>
<a href="https://ekiworld.net/service/sier/webservice/free_provision.html" class="autolink" rel="nofollow noopener" target="_blank">https://ekiworld.net/service/sier/webservice/free_provision.html</a></p>

<h2>
<span id="custom-vision-編-を実施していない場合" class="fragment"></span><a href="#custom-vision-%E7%B7%A8-%E3%82%92%E5%AE%9F%E6%96%BD%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>Custom Vision 編 を実施していない場合</h2>

<p><a href="https://qiita.com/hmaruyama/items/fd28cdee19a55fb510b1">Custom Vision 編</a> を実施していない場合はMicrosoft アカウントを準備してください。([Custom Vision 編] と同じもので問題ありません。)</p>

<h3>
<span id="microsoft-アカウント" class="fragment"></span><a href="#microsoft-%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>Microsoft アカウント</h3>

<p>Cognitive Services (と必要に応じて Azure) サブスクリプションの申し込みに必要ですので、持っていない場合は取得しておきます。</p>

<blockquote>
<p><a href="https://www.microsoft.com/ja-jp/msaccount/signup/default.aspx" rel="nofollow noopener" target="_blank">Microsoft アカウント登録手続き</a></p>
</blockquote>

<h1>
<span id="bot-アプリの実装" class="fragment"></span><a href="#bot-%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>BOT アプリの実装</h1>

<h2>
<span id="bot-アプリケーションの作成" class="fragment"></span><a href="#bot-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>Bot アプリケーションの作成</h2>

<p><a href="http://qiita.com/annie/items/edc26c0ee9603e84a2e4#visual-studio-%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%81%8B%E3%82%89-bot-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90" id="reference-bc54f93104f2e73c7ee5">Visual Studio テンプレートから Bot アプリケーションの作成</a> と同じ手順で、新規 Bot アプリケーションを作成します。今回は TrainFinderBot という名称で作成しています。<br>
<a href="https://camo.qiitausercontent.com/cb56ad1a46950ab8b6475bab5dfa500eaefd3143/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30322e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_02.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ac3e351efda98824a151ee9468b9bda8" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_02.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_02.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=09272470e30c41e80a354fae44682a6f 1x" loading="lazy"></a></p>

<h2>
<span id="cognitive-services-emotion-api-の-c-ライブラリーのインストール" class="fragment"></span><a href="#cognitive-services-emotion-api-%E3%81%AE-c-%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%83%BC%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>Cognitive Services Emotion API の C# ライブラリーのインストール</h2>

<p>ソリューションエクスプローラーでプロジェクト名 (ソリューションの下) を右クリックして、<em>NuGet パッケージの管理</em> を選択します。<br>
<a href="https://camo.qiitausercontent.com/f13edca2e3f88d6533298924d32170be286d3bd7/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30332e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_03.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=614e1bfa9159fbcb715c8b6b8ac25c2f" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_03.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_03.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=67e983cfe572df8d1c8c610feffadba6 1x" loading="lazy"></a></p>

<p><em>このソリューションに一部のNuGetパッケージが見つかりません・・・</em> というメッセージが表示される場合は、その横にある [復元] をクリックしてインストールします。(表示されない場合はそのまま次に進んでください)<br>
<a href="https://camo.qiitausercontent.com/727800a7a6dd492323de2767fae45138c57feb58/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30342e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_04.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a9798d1874c32f4570e8e4a3c8ea9313" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_04.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_04.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d322405bd4e27fb275b6af2b70608ab8 1x" loading="lazy"></a></p>

<p><em>参照</em> をクリックし、<em>custom vision</em> と入力して検索します。<em>Microsoft.Cognitive.CustomVision.Prediction</em> を選択し、<em>インストール</em> をクリックしてインストールします。<br>
<a href="https://camo.qiitausercontent.com/ddc79cea498edd7002ea9ec836ecac3da8fccd4f/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30352e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_05.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e2e70b0c2033b27e0d3e662d92fc122c" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_05.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_05.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c1f1b38a69f6d1ef65adec733643bd8e 1x" loading="lazy"></a></p>

<p>Custom Vision (Prediction) のライブラリーと、依存関係のあるライブラリーが合わせて表示されますので、<em>OK</em> をクリックしてインストールします。<br>
<a href="https://camo.qiitausercontent.com/668cf8eaf6884f772777cf3a44d68d7fb16c2760/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30362e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_06.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d569ae7ae7d8d6f5d98026ba0e7ff699" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_06.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_06.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=bb90799e175b63005bf27f4a4eb81f42 1x" loading="lazy"></a><br>
<a href="https://camo.qiitausercontent.com/3dcbf44052d103519148db1d606c4e68f8c2ef49/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30372e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_07.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c45f8c7c877e3d24e3ff3f6cae011ce7" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_07.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_07.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6c2acacee8c026c24b50abb7ef73934b 1x" loading="lazy"></a></p>

<p>インストールが終了したら、NuGet のウインドウを閉じます。</p>

<h2>
<span id="会話のハンドリングの記述-基本" class="fragment"></span><a href="#%E4%BC%9A%E8%A9%B1%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AE%E8%A8%98%E8%BF%B0-%E5%9F%BA%E6%9C%AC"><i class="fa fa-link"></i></a>会話のハンドリングの記述 (基本)</h2>

<p><em>Dialogs</em> フォルダー をクリックして開きます。<em>RootDialog.cs</em> をクリックして表示し、こちらを編集していきます。RootDialog.cs にはメッセージを受信したときの動作を記述します。</p>

<p><a href="https://camo.qiitausercontent.com/9df7cc35c6b9a346def4409ea5fac64c640a0f73/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30382e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_08.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=22017f3a597654914120c4e18f771ce4" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_08.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_08.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=fbf597b0c2d02f5c3f0f58bf7de8aa97 1x" loading="lazy"></a></p>

<p>冒頭に、先ほど追加した Microsoft.Cognitive.CustomVision を追加します。合わせて System.Net.Http も追加しておきます。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">RootDialog.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Microsoft.Cognitive.CustomVision</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
</code></pre></div>
</div>

<h3>
<span id="初期メッセージの追加" class="fragment"></span><a href="#%E5%88%9D%E6%9C%9F%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>初期メッセージの追加</h3>

<p>メッセージを受信したとき最初に <em>StartAsync</em> が呼びだされ、<em>StartAsync</em> から <em>MessageReceivedAsync</em> が呼び出されます。<br>
<em>MessageReceivedAsync</em> 呼び出し前に初期メッセージを追加します。 </p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">RootDialog.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="n">Task</span> <span class="nf">StartAsync</span><span class="p">(</span><span class="n">IDialogContext</span> <span class="n">context</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// デフォルトのメッセージをセット</span>
    <span class="n">context</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="s">$"こんにちは！画像DE路線当てBot です。"</span><span class="p">);</span>
    <span class="n">context</span><span class="p">.</span><span class="nf">Wait</span><span class="p">(</span><span class="n">MessageReceivedAsync</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="n">CompletedTask</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div>
</div>

<h3>
<span id="custom-vision-を呼び出す準備" class="fragment"></span><a href="#custom-vision-%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>Custom Vision を呼び出す準備</h3>

<p>MessageReceivedAsync に Custom Vision の画像分析エンジンを呼び出すコードを追加していきます。<br>
下記コードの YOUR_PREDICTION_KEY には Custom Vision の Prediction URL 表示画面で表示される Prediction-key、YOUR_PROJECT_ID には URL に含まれている Project ID をコピーします。<br>
<a href="https://qiita.com/hmaruyama/private/fd28cdee19a55fb510b1" id="reference-51c8690fd6b379afa4de">Custom Vision 編</a> の API アクセス情報画面から取得できます。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">RootDialog.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">MessageReceivedAsync</span><span class="p">(</span><span class="n">IDialogContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IAwaitable</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">activity</span> <span class="p">=</span> <span class="k">await</span> <span class="n">result</span> <span class="k">as</span> <span class="n">Activity</span><span class="p">;</span>

    <span class="c1">// 変数定義</span>
    <span class="kt">string</span> <span class="n">tag</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>     <span class="c1">// 電車カテゴリータグ</span>
    <span class="kt">string</span> <span class="n">msg</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>     <span class="c1">// 返答メッセージ</span>

    <span class="c1">// Custom Vision API を使う準備</span>
    <span class="kt">var</span> <span class="n">cvCred</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PredictionEndpointCredentials</span><span class="p">(</span><span class="s">"YOUR_PREDICTION_KEY"</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">cvEp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PredictionEndpoint</span><span class="p">(</span><span class="n">cvCred</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">cvGuid</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Guid</span><span class="p">(</span><span class="s">"YOUR_PROJECT_ID"</span><span class="p">);</span>

    <span class="c1">// 画像が送られてきたら Custom Vision を呼び出してタグを取得</span>
    <span class="c1">// メッセージをセット</span>
    <span class="c1">// ※次以降の項目で作成します</span>

    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="n">context</span><span class="p">.</span><span class="nf">Wait</span><span class="p">(</span><span class="n">MessageReceivedAsync</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div>
</div>

<h3>
<span id="custom-vision-の呼び出し結果の取得" class="fragment"></span><a href="#custom-vision-%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E7%B5%90%E6%9E%9C%E3%81%AE%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>Custom Vision の呼び出し、結果の取得</h3>

<p>画像を Stream として取得し、Custom Vision を呼び出します。Probability (≒信頼度) の高いものからリストされるため、最初にリストされるタグのみを取得します。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">RootDialog.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">MessageReceivedAsync</span><span class="p">(</span><span class="n">IDialogContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IAwaitable</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">:</span>
    <span class="err">中略</span>
    <span class="p">:</span>
    <span class="c1">// 画像が送られてきたら Custom Vision を呼び出してタグを取得</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">activity</span><span class="p">.</span><span class="n">Attachments</span><span class="p">?.</span><span class="n">Count</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 送られてきた画像を Stream として取得</span>
        <span class="kt">var</span> <span class="n">photoUrl</span> <span class="p">=</span> <span class="n">activity</span><span class="p">.</span><span class="n">Attachments</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">ContentUrl</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">photoStream</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetStreamAsync</span><span class="p">(</span><span class="n">photoUrl</span><span class="p">);</span>

        <span class="k">try</span>
            <span class="p">{</span>
                <span class="c1">// 画像を判定</span>
                <span class="kt">var</span> <span class="n">cvResult</span> <span class="p">=</span> <span class="k">await</span> <span class="n">cvEp</span><span class="p">.</span><span class="nf">PredictImageAsync</span><span class="p">(</span><span class="n">cvGuid</span><span class="p">,</span> <span class="n">photoStream</span><span class="p">);</span>

                <span class="c1">// タグを取得</span>
                <span class="n">tag</span> <span class="p">=</span> <span class="n">cvResult</span><span class="p">.</span><span class="n">Predictions</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Tag</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">catch</span>
            <span class="p">{</span>
                <span class="c1">// Error Handling</span>
            <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// メッセージをセット</span>
    <span class="c1">// ※次以降の項目で作成します</span>

    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="n">context</span><span class="p">.</span><span class="nf">Wait</span><span class="p">(</span><span class="n">MessageReceivedAsync</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h3>
<span id="返答の作成" class="fragment"></span><a href="#%E8%BF%94%E7%AD%94%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>返答の作成</h3>

<p>返答メッセージにタグをセットします。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">RootDialog.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">MessageReceivedAsync</span><span class="p">(</span><span class="n">IDialogContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IAwaitable</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">:</span>
    <span class="err">中略</span>
    <span class="p">:</span>
    <span class="c1">// メッセージをセット</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tag</span> <span class="p">!=</span> <span class="s">""</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">msg</span> <span class="p">=</span> <span class="n">tag</span> <span class="p">+</span> <span class="s">"、に いちばんにてるね！"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// 判定できなかった場合</span>
        <span class="n">msg</span> <span class="p">=</span> <span class="s">"電車の写真を送ってね"</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="n">context</span><span class="p">.</span><span class="nf">Wait</span><span class="p">(</span><span class="n">MessageReceivedAsync</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>忘れずに <em>RootDialog.cs</em> を保存しておきます。</p>

<h3>
<span id="アプリケーションの動作確認" class="fragment"></span><a href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>アプリケーションの動作確認</h3>

<p>ここで一旦 BOT の動作確認を行います。、F5 または デバック＞デバックの開始 をクリックして、プロジェクトのビルドおよび起動を行います。ブラウザが起動して Bot Framework のデフォルト画面が表示されたら、Bot Framework Channel Emulator を起動してアクセスを行います。<br>
Bot Framework Channel Emulator の上部中央にある Bot Url に、起動しているブラウザと同じ URL (デフォルトでは <a href="http://localhost:xxxx" class="autolink">http://localhost:xxxx</a>) に /api/messages を追加したアドレス (<a href="http://localhost:xxxx/api/messages" class="autolink">http://localhost:xxxx/api/messages</a>) を指定します。</p>

<p>何か文字を入力して送信すると、StartAsync で指定したデフォルトの回答が返信されることを確認してください。<br>
入力エリアの画像アイコンをクリックして、分析した画像を選択、BOT に送信すると、判定されたタグが返信されるのを確認してください。</p>

<p><a href="https://camo.qiitausercontent.com/ffd28f9ecaed4288e97aa6ab9d893060f6025c4e/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30392e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_09.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=47ad786209f14cf60b0ba6f5c542317a" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_09.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_09.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=86eba858839028c67cd6f5a2dc42dd9c 1x" loading="lazy"></a></p>

<h2>
<span id="会話のハンドリングの記述-駅すぱあと-web-サービス-を利用した情報の取得とセット" class="fragment"></span><a href="#%E4%BC%9A%E8%A9%B1%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AE%E8%A8%98%E8%BF%B0-%E9%A7%85%E3%81%99%E3%81%B1%E3%81%82%E3%81%A8-web-%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9-%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E6%83%85%E5%A0%B1%E3%81%AE%E5%8F%96%E5%BE%97%E3%81%A8%E3%82%BB%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>会話のハンドリングの記述 (駅すぱあと Web サービス を利用した情報の取得とセット)</h2>

<p>画像を判定して取得できたタグに応じてメッセージを変更します。<br>
今回は、<a href="https://ekiworld.net/service/sier/webservice/index.html" rel="nofollow noopener" target="_blank">駅すぱあと Web サービス</a> を利用して、路線名から停車駅を取得し、表示するようにします。</p>

<blockquote>
<p>路線名、停車駅はこちらの API を利用して取得できます。今回は予め路線コードはアプリ内に保持し、停車駅のみを API で取得しています。<br>
- 路線名の取得: <a href="http://api.ekispert.jp/v1/xml/operationLine?name=%E8%B7%AF%E7%B7%9A%E5%90%8D&amp;key=%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%AD%E3%83%BC" class="autolink" rel="nofollow noopener" target="_blank">http://api.ekispert.jp/v1/xml/operationLine?name=路線名&amp;key=アクセスキー</a><br>
- 停車駅の取得: <a href="http://api.ekispert.jp/v1/json/station?&amp;operationLineCode=%E8%B7%AF%E7%B7%9A%E3%82%B3%E3%83%BC%E3%83%89&amp;key=%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%AD%E3%83%BC" class="autolink" rel="nofollow noopener" target="_blank">http://api.ekispert.jp/v1/json/station?&amp;operationLineCode=路線コード&amp;key=アクセスキー</a></p>
</blockquote>

<h3>
<span id="停車駅を取得する準備" class="fragment"></span><a href="#%E5%81%9C%E8%BB%8A%E9%A7%85%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>停車駅を取得する準備</h3>

<p>駅すぱあと API で取得した情報は XML または JSON で取得できます。<br>
今回は JSON でデータを取得し、その後利用しやすくするためのクラスを作成します。</p>

<p>プロジェクトを右クリックして [追加]＞[新しいフォルダー] をクリック、<em>Models</em> というフォルダーを作成します。<br>
<a href="https://camo.qiitausercontent.com/2673a1204ea83e4187d4815626a6780dc7f18a5b/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31302e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_10.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=10401b113b474e3c6676f6a2a2e44df0" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_10.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_10.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=fbce105e2e0eef3d68047be3a46d5346 1x" loading="lazy"></a></p>

<p>作成した <em>Models</em> フォルダーを右クリックして、[追加]＞[クラス]をクリックします。<br>
<a href="https://camo.qiitausercontent.com/501a143099656fd288f0d51064594f7e38b3e0ba/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31312e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_11.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c4b53c6260f2973e1e5efed903af4795" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_11.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_11.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=292e15b36275bdb698e0ce3f42590069 1x" loading="lazy"></a></p>

<p>名前に <em>StationModel.cs</em> と入力して、[追加] をクリックして新規クラスファイルを作成します。<br>
<a href="https://camo.qiitausercontent.com/9197a928c1beceabb47c4bd608b134903bbf12dc/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31322e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_12.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c77f854d2d57836013aa34b479067f33" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_12.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_12.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=75c615e643295f8cba11de58e18e5710 1x" loading="lazy"></a></p>

<p>StationModel.cs を開き、デフォルトで作成されている StationModel クラスを一旦削除します。<br>
<a href="https://camo.qiitausercontent.com/af97a91f7a474783b0135376ccf9a2443d92b43b/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31332e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_13.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6acc3794b64f36523cfbcf9775959028" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_13.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_13.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c1d02a1620c29ae50989d0b0cb3c8e2e 1x" loading="lazy"></a></p>

<p>API のフォーマットを取得するため、ブラウザーを起動して API にアクセスを行います。<br>
<a href="http://api.ekispert.jp/v1/json/station?&amp;operationLineCode=113&amp;direction=down&amp;key=%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%AD%E3%83%BC" class="autolink" rel="nofollow noopener" target="_blank">http://api.ekispert.jp/v1/json/station?&amp;operationLineCode=113&amp;direction=down&amp;key=アクセスキー</a></p>

<p>表示される結果をすべて選択して、コピーします。<br>
<a href="https://camo.qiitausercontent.com/ca24a9acaa23c9365dc7c89206474e2549cbbac9/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31342e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_14.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9f93e7ce5812ddce56d257a65fd6c229" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_14.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_14.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b652998d38be94d7f6245b85a4976c92 1x" loading="lazy"></a></p>

<p>Visual Studio に戻り、<em>namespace .Models</em> 内をクリックして選択してから、上部ツールバーから [編集]＞[形式を選択して貼り付け]＞[JSON をクラスとして貼り付ける] を選択して、コピーした内容を貼り付けます。<br>
<a href="https://camo.qiitausercontent.com/c877af173b125e33fad4a645c2c2b48a0b1518dd/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31352e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_15.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=beeb182bfefe3f33d4f360b846706b9d" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_15.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_15.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=de926bc15a93195b31146bb7fb658883 1x" loading="lazy"></a><br>
<a href="https://camo.qiitausercontent.com/14a5a9392ad378f1ffc1d5b7932d294ef7caad88/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31362e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_16.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=720f7671ed6cfe843375139298a9ce3a" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_16.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_16.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=da74934989cf43143f4c77d40b9ea9eb 1x" loading="lazy"></a></p>

<p><em>class Rootobject</em> は <em>class StationModel</em> に変更します。<br>
<a href="https://camo.qiitausercontent.com/262e9b1ed797544a38fe782de4743a91de126a6d/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31372e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_17.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d42f22c07ae8c849977b21dbb46d9c0b" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_17.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_17.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6dc23abaf8ce8e07f93a353b80b5bc99 1x" loading="lazy"></a></p>

<p>適時ファイルの保存を行っておきます。</p>

<h3>
<span id="路線名路線コードのセット" class="fragment"></span><a href="#%E8%B7%AF%E7%B7%9A%E5%90%8D%E8%B7%AF%E7%B7%9A%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>路線名、路線コードのセット</h3>

<p>画像を判定して取得できたタグによって、路線名と路線コードをセットします。<br>
まず、変数定義のところで、路線名と路線コードを扱う変数 (lineName, lineCode) を追加します。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">RootDialog.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">MessageReceivedAsync</span><span class="p">(</span><span class="n">IDialogContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IAwaitable</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">activity</span> <span class="p">=</span> <span class="k">await</span> <span class="n">result</span> <span class="k">as</span> <span class="n">Activity</span><span class="p">;</span>

    <span class="c1">// 変数定義</span>
    <span class="kt">string</span> <span class="n">tag</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>     <span class="c1">// 電車カテゴリータグ</span>
    <span class="kt">string</span> <span class="n">msg</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>     <span class="c1">// 返答メッセージ</span>
    <span class="kt">string</span> <span class="n">lineName</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>   <span class="c1">// [追加] 路線名 (駅すぱあと運航路線名)</span>
    <span class="kt">string</span> <span class="n">lineCode</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>   <span class="c1">// [追加] 路線コード (駅すぱあと運航路線コード)</span>
    <span class="p">:</span>
    <span class="p">(</span><span class="err">後略</span><span class="p">)</span>

</code></pre></div>
</div>

<p>次に取得したタグに応じて lineName と lineCode をセットするように変更します。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">RootDialog.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">MessageReceivedAsync</span><span class="p">(</span><span class="n">IDialogContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IAwaitable</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">activity</span> <span class="p">=</span> <span class="k">await</span> <span class="n">result</span> <span class="k">as</span> <span class="n">Activity</span><span class="p">;</span>
    <span class="p">:</span>
    <span class="err">中略</span>
    <span class="p">:</span>
    <span class="c1">// メッセージをセット</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tag</span> <span class="p">!=</span> <span class="s">""</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//msg = tag + "、に いちばんにてるね！";</span>
        <span class="c1">// タグに応じてメッセージをセット</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="s">"Chuo_Sobu"</span><span class="p">:</span>
                <span class="n">lineName</span> <span class="p">=</span> <span class="s">"ＪＲ中央・総武線各駅停車"</span><span class="p">;</span>
                <span class="n">lineCode</span> <span class="p">=</span> <span class="s">"110"</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s">"Chuo_Ex"</span><span class="p">:</span>
                <span class="n">lineName</span> <span class="p">=</span> <span class="s">"ＪＲ中央線快速"</span><span class="p">;</span>
                <span class="n">lineCode</span> <span class="p">=</span> <span class="s">"109"</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s">"Keihin-Tohoku"</span><span class="p">:</span>
                <span class="n">lineName</span> <span class="p">=</span> <span class="s">"ＪＲ京浜東北線"</span><span class="p">;</span>
                <span class="n">lineCode</span> <span class="p">=</span> <span class="s">"115"</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s">"Tokaido"</span><span class="p">:</span>
                <span class="n">lineName</span> <span class="p">=</span> <span class="s">"ＪＲ東海道本線"</span><span class="p">;</span>
                <span class="n">lineCode</span> <span class="p">=</span> <span class="s">"117"</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s">"Yamanote"</span><span class="p">:</span>
                <span class="n">lineName</span> <span class="p">=</span> <span class="s">"ＪＲ山手線"</span><span class="p">;</span>
                <span class="n">lineCode</span> <span class="p">=</span> <span class="s">"113"</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s">"Yokosuka_SobuEx"</span><span class="p">:</span>
                <span class="n">lineName</span> <span class="p">=</span> <span class="s">"ＪＲ横須賀線"</span><span class="p">;</span>
                <span class="n">lineCode</span> <span class="p">=</span> <span class="s">"116"</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>        
        <span class="p">}</span>

        <span class="c1">// 路線情報を取得してセット</span>
        <span class="c1">// ※次以降の項目で作成します</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">msg</span> <span class="p">=</span> <span class="s">"電車の写真を送ってね"</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="n">context</span><span class="p">.</span><span class="nf">Wait</span><span class="p">(</span><span class="n">MessageReceivedAsync</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div>
</div>

<p>lineCode を使って停車駅情報を取得して (line に代入)、表示する内容に変更します。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">RootDialog.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">MessageReceivedAsync</span><span class="p">(</span><span class="n">IDialogContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IAwaitable</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">activity</span> <span class="p">=</span> <span class="k">await</span> <span class="n">result</span> <span class="k">as</span> <span class="n">Activity</span><span class="p">;</span>
    <span class="p">:</span>
    <span class="err">中略</span>
    <span class="p">:</span>
    <span class="c1">// メッセージをセット</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tag</span> <span class="p">!=</span> <span class="s">""</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//msg = tag + "、に いちばんにてるね！";</span>
        <span class="c1">// タグに応じてメッセージをセット</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="s">"Chuo_Sobu"</span><span class="p">:</span>
                <span class="n">lineName</span> <span class="p">=</span> <span class="s">"ＪＲ中央・総武線各駅停車"</span><span class="p">;</span>
                <span class="n">lineCode</span> <span class="p">=</span> <span class="s">"110"</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">:</span>
            <span class="err">中略</span>
            <span class="p">:</span>
        <span class="p">}</span>

        <span class="c1">// 路線情報を取得してセット</span>
        <span class="kt">var</span> <span class="n">list</span> <span class="p">=</span> <span class="k">await</span> <span class="nf">GetStationList</span><span class="p">(</span><span class="n">lineCode</span><span class="p">);</span> <span class="c1">// ※GetStationList は次以降の項目で作成</span>
        <span class="n">msg</span> <span class="p">=</span> <span class="n">lineName</span> <span class="p">+</span> <span class="s">"、に いちばんにてるね！\n\n"</span> 
            <span class="p">+</span> <span class="n">lineName</span> <span class="p">+</span> <span class="s">"は、以下のえきをはしるよ。\n\n---- - \n\n"</span>
            <span class="p">+</span> <span class="n">list</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">msg</span> <span class="p">=</span> <span class="s">"電車の写真を送ってね"</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="n">context</span><span class="p">.</span><span class="nf">Wait</span><span class="p">(</span><span class="n">MessageReceivedAsync</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div>
</div>

<h3>
<span id="停車駅の取得とセット" class="fragment"></span><a href="#%E5%81%9C%E8%BB%8A%E9%A7%85%E3%81%AE%E5%8F%96%E5%BE%97%E3%81%A8%E3%82%BB%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>停車駅の取得とセット</h3>

<p>停車駅を取得してセットします。<br>
JSON を扱えるように　Newtonsoft.JSON と、前の項目で作成した Model を RootDialog.cs の冒頭に追加しておきます。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">RootDialog.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">TrainFinderBot.Models</span><span class="p">;</span>
</code></pre></div>
</div>

<p>GetStationList を追加し、路線情報を取得します。<br>
取得できた停車駅は "→" で繋いで 1 行にします。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">RootDialog.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">MessageReceivedAsync</span><span class="p">(</span><span class="n">IDialogContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IAwaitable</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">:</span>
    <span class="err">中略</span>
    <span class="p">:</span>
<span class="p">}</span>
<span class="k">private</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="nf">GetStationList</span><span class="p">(</span><span class="kt">string</span> <span class="n">lineCode</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

    <span class="c1">// 路線名、アクセスキーをセット</span>
    <span class="kt">var</span> <span class="n">ekiRequest</span> <span class="p">=</span> <span class="s">"http://api.ekispert.jp/v1/json/station?&amp;operationLineCode="</span>
                <span class="p">+</span> <span class="n">lineCode</span>
                <span class="p">+</span> <span class="s">"&amp;direction=down&amp;key="</span>
                <span class="p">+</span> <span class="s">"YOUR_ACCESSKEY"</span><span class="p">;</span> <span class="c1">//アクセスキー</span>

    <span class="c1">// 路線情報の取得</span>
    <span class="kt">var</span> <span class="n">ekiResult</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetStringAsync</span><span class="p">(</span><span class="n">ekiRequest</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">ekiStr</span> <span class="p">=</span> <span class="n">Uri</span><span class="p">.</span><span class="nf">UnescapeDataString</span><span class="p">(</span><span class="n">ekiResult</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
    <span class="kt">var</span> <span class="n">ekiModel</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="n">DeserializeObject</span><span class="p">&lt;</span><span class="n">StationModel</span><span class="p">&gt;(</span><span class="n">ekiStr</span><span class="p">);</span>

    <span class="c1">// 停車駅情報を編集</span>
    <span class="kt">var</span> <span class="n">stationList</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">point</span> <span class="k">in</span> <span class="n">ekiModel</span><span class="p">.</span><span class="n">ResultSet</span><span class="p">.</span><span class="n">Point</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">stationList</span> <span class="p">=</span> <span class="n">stationList</span> <span class="p">+</span> <span class="s">"→"</span> <span class="p">+</span> <span class="n">point</span><span class="p">.</span><span class="n">Station</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">stationList</span> <span class="p">=</span> <span class="n">stationList</span><span class="p">.</span><span class="nf">Substring</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">stationList</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></div>
</div>

<h3>
<span id="アプリケーションの動作再確認" class="fragment"></span><a href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%8B%95%E4%BD%9C%E5%86%8D%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>アプリケーションの動作(再)確認</h3>

<p>F5 または デバック＞デバックの開始 をクリックして、プロジェクトのビルドおよび起動を行います。ブラウザが起動して Bot Framework のデフォルト画面が表示されたら、Bot Framework Channel Emulator を起動してアクセスを行います。</p>

<p>入力エリアの画像アイコンをクリックして、分析した画像を選択、BOT に送信します。<br>
設定したメッセージが返答されたら完成です。</p>

<p><a href="https://camo.qiitausercontent.com/7a6a6ddb4adb03c310b58e1305b16d1c1c1f65f4/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30312e4a50473f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_01.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=75a206dd6c909f3f7803e605649f1fdd" alt="" data-canonical-src="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_01.JPG?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_01.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ee23c8dfcd465d0eb4bbe5c4b059459d 1x" loading="lazy"></a></p>

<h1>
<span id="appendix" class="fragment"></span><a href="#appendix"><i class="fa fa-link"></i></a>Appendix</h1>

<p>完成形のソースコードを GitHub にて公開しました。<br>
<a href="https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot</a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fannie%2Fitems%2Fc4bcc3dff1fa17deea2b&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fannie%2Fitems%2Fc4bcc3dff1fa17deea2b&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/annie/items/c4bcc3dff1fa17deea2b/likers" class="css-1iupg5d">3</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">9</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/c4bcc3dff1fa17deea2b/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/annie/items/c4bcc3dff1fa17deea2b/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/annie/items/c4bcc3dff1fa17deea2b/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/annie/items/c4bcc3dff1fa17deea2b/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/annie/items/c4bcc3dff1fa17deea2b.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-3fe08f1b-7554-434c-b3a1-cec0f95c8456">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-b8076050-88ed-424d-87b2-c8f77fa9dc6a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-b8076050-88ed-424d-87b2-c8f77fa9dc6a">{}</script>
      
<div id="LoginModal-react-component-fe65535b-73c4-4a0d-a1ac-10517c5173dd"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-fe65535b-73c4-4a0d-a1ac-10517c5173dd">{}</script>
      
<div id="StockModal-react-component-14a81d43-d3e2-4f65-a1b9-39bbf0443be5"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-14a81d43-d3e2-4f65-a1b9-39bbf0443be5">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;7MGpcpEZFmHMCkmWscPD4I0Mw/Bxnp3M8bEeRvqnmQLhRTPtqgp+a0YDFzhGZpyg8AQCt7dkZjUQBmA5DZX1+A==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e\u003ca href=\"https://azure.microsoft.com/ja-jp/services/cognitive-services/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMicrosoft Cognitive Services\u003c/a\u003e の \u003ca href=\"https://azure.microsoft.com/ja-jp/services/cognitive-services/custom-vision-service/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCustom Vision Service\u003c/a\u003e は、オリジナルの画像判定エンジンを作成して API で推定値を取得できるサービスです。また、\u003ca href=\"https://ekiworld.net/service/lp/webservice/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e駅すぱあとwebサービス\u003c/a\u003e は、国内初の乗換案内ソフト \u003ca href=\"https://ekiworld.net/about/index.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e駅すぱあと\u003c/a\u003e がもつ様々な情報をWebAPIで提供しているサービスです。\u003c/p\u003e\n\n\u003cp\u003e今回は Custom Vision Service で作成した画像判定エンジンを利用して、\u003cbr\u003e\n鉄道の路線を画像から判別し、 駅すぱあとwebサービス を利用して路線に含まれる駅を検索し、それを返す BOT を作成する方法を紹介します。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eMicrosoft Cognitive Services の Custom Vision Service は、オリジナルの画像判定エンジンを作成して API で推定値を取得できるサービスです。\u003cbr\u003e\n機械学習などで画像判定ロジックを構築しなくても、画像をアップロードしてタグ付けを行うことで、画像判定エンジンを構築できます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://ekiworld.net/service/lp/webservice/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e駅すぱあとwebサービス\u003c/a\u003e は、国内初の乗換案内ソフト \u003ca href=\"https://ekiworld.net/about/index.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e駅すぱあと\u003c/a\u003e がもつ様々な情報をWebAPIで提供しているサービスです。\u003cbr\u003e\n経路探索はもちろん、駅データや時刻表などの情報を取得することができます。 \u003cbr\u003e\n無料で使えるフリープランを用意しており、企業にかぎらず個人でもご利用いただけます。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eベースは Microsoft Bot Framework (V3.0 以降) テンプレートを利用し、Cognitive Services Custom Vision (Prediction) C# クラスライブラリーを用いて呼び出しを行います。\u003c/p\u003e\n\n\u003cp\u003eこの BOT アプリは Bot Framework Channel Emulator を使ってローカル環境で稼働確認することが可能です。また、Web 公開 \u0026amp; Bot Framework に登録すると、埋め込み可能な Web Chat が利用できます。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e駅すぱあと x Cognitive Services で 画像DE路線当てBOT を作ろう！\u003c/strong\u003e\u003cbr\u003e\n(1) \u003ca href=\"https://qiita.com/hmaruyama/items/fd28cdee19a55fb510b1\" id=\"reference-51c8690fd6b379afa4de\"\u003eCustom Vision 編\u003c/a\u003e\u003cbr\u003e\n(2) Bot実装編 \u003cbr\u003e\n- \u003ca href=\"https://qiita.com/hmaruyama/items/8db9d869e63408c6c444\" id=\"reference-395c4b36666e770539b8\"\u003eNode.js ver 編\u003c/a\u003e\u003cbr\u003e\n- \u003cstrong\u003eC# ver 編\u003c/strong\u003e ※このページ\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eCustom Vision 編、Bot実装 編を通して作成できる 画像DE路線当てBOT↓\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/7a6a6ddb4adb03c310b58e1305b16d1c1c1f65f4/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30312e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_01.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=75a206dd6c909f3f7803e605649f1fdd\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_01.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_01.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ee23c8dfcd465d0eb4bbe5c4b059459d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"bot-framework--cognitive-services-利用に必要な環境サブスクリプションの準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bot-framework--cognitive-services-%E5%88%A9%E7%94%A8%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E7%92%B0%E5%A2%83%E3%82%B5%E3%83%96%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBot Framework \u0026amp; Cognitive Services 利用に必要な環境、サブスクリプションの準備\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"開発環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e開発環境\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"visual-studiobot-framework-template--bot-framework-channel-emulator\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#visual-studiobot-framework-template--bot-framework-channel-emulator\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVisual Studio、Bot Framework Template \u0026amp; Bot Framework Channel Emulator\u003c/h3\u003e\n\n\u003cp\u003e無償の Visual Studio 2017 Community or 2015 Community でOKなので、既存の環境がない場合は、ダウンロードしてインストールします。\u003cbr\u003e\n\u003ca href=\"https://www.visualstudio.com/ja-jp/products/visual-studio-community-vs.aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVisual Studio 2017 Community ダウンロードサイト\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"http://aka.ms/bf-bc-vstemplate\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVisual Studio 用の Bot Framework C# テンプレート\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://aka.ms/bf-bc-emulator\" rel=\"nofollow noopener\" target=\"_blank\"\u003eBot Framework Channel Emulator (Windows版)\u003c/a\u003e ※Mac/Linux は \u003ca href=\"https://aka.ms/bfemulator\" rel=\"nofollow noopener\" target=\"_blank\"\u003eConsole版\u003c/a\u003e をご利用ください\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eBot Framework 開発環境の作り方は、\u003ca href=\"http://qiita.com/annie/items/edc26c0ee9603e84a2e4#bot-framework-%E3%82%92%E4%BD%BF%E3%81%86%E3%81%9F%E3%82%81%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\" id=\"reference-bc54f93104f2e73c7ee5\"\u003eMicrosoft Bot Framework v3.0 からはじめる BOT 開発: Bot Framework を使うための開発環境\u003c/a\u003e をご覧ください。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"駅すぱあと-webサービス-のアクセスキー\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%A7%85%E3%81%99%E3%81%B1%E3%81%82%E3%81%A8-web%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9-%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%AD%E3%83%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e駅すぱあと Webサービス のアクセスキー\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://ekiworld.net/service/sier/webservice/index.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e駅すぱあと Webサービス\u003c/a\u003e のフリープランをお申込みいただき、アクセスキーを取得してください。\u003cbr\u003e\n\u003ca href=\"https://ekiworld.net/service/sier/webservice/free_provision.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://ekiworld.net/service/sier/webservice/free_provision.html\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"custom-vision-編-を実施していない場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#custom-vision-%E7%B7%A8-%E3%82%92%E5%AE%9F%E6%96%BD%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCustom Vision 編 を実施していない場合\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/hmaruyama/items/fd28cdee19a55fb510b1\"\u003eCustom Vision 編\u003c/a\u003e を実施していない場合はMicrosoft アカウントを準備してください。([Custom Vision 編] と同じもので問題ありません。)\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"microsoft-アカウント\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#microsoft-%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMicrosoft アカウント\u003c/h3\u003e\n\n\u003cp\u003eCognitive Services (と必要に応じて Azure) サブスクリプションの申し込みに必要ですので、持っていない場合は取得しておきます。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://www.microsoft.com/ja-jp/msaccount/signup/default.aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMicrosoft アカウント登録手続き\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"bot-アプリの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bot-%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBOT アプリの実装\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"bot-アプリケーションの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bot-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBot アプリケーションの作成\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"http://qiita.com/annie/items/edc26c0ee9603e84a2e4#visual-studio-%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%81%8B%E3%82%89-bot-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90\" id=\"reference-bc54f93104f2e73c7ee5\"\u003eVisual Studio テンプレートから Bot アプリケーションの作成\u003c/a\u003e と同じ手順で、新規 Bot アプリケーションを作成します。今回は TrainFinderBot という名称で作成しています。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/cb56ad1a46950ab8b6475bab5dfa500eaefd3143/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30322e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_02.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ac3e351efda98824a151ee9468b9bda8\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_02.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_02.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=09272470e30c41e80a354fae44682a6f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"cognitive-services-emotion-api-の-c-ライブラリーのインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cognitive-services-emotion-api-%E3%81%AE-c-%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%83%BC%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCognitive Services Emotion API の C# ライブラリーのインストール\u003c/h2\u003e\n\n\u003cp\u003eソリューションエクスプローラーでプロジェクト名 (ソリューションの下) を右クリックして、\u003cem\u003eNuGet パッケージの管理\u003c/em\u003e を選択します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f13edca2e3f88d6533298924d32170be286d3bd7/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30332e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_03.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=614e1bfa9159fbcb715c8b6b8ac25c2f\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_03.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_03.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=67e983cfe572df8d1c8c610feffadba6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eこのソリューションに一部のNuGetパッケージが見つかりません・・・\u003c/em\u003e というメッセージが表示される場合は、その横にある [復元] をクリックしてインストールします。(表示されない場合はそのまま次に進んでください)\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/727800a7a6dd492323de2767fae45138c57feb58/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30342e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_04.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a9798d1874c32f4570e8e4a3c8ea9313\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_04.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_04.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d322405bd4e27fb275b6af2b70608ab8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e参照\u003c/em\u003e をクリックし、\u003cem\u003ecustom vision\u003c/em\u003e と入力して検索します。\u003cem\u003eMicrosoft.Cognitive.CustomVision.Prediction\u003c/em\u003e を選択し、\u003cem\u003eインストール\u003c/em\u003e をクリックしてインストールします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ddc79cea498edd7002ea9ec836ecac3da8fccd4f/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30352e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_05.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e2e70b0c2033b27e0d3e662d92fc122c\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_05.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_05.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c1f1b38a69f6d1ef65adec733643bd8e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eCustom Vision (Prediction) のライブラリーと、依存関係のあるライブラリーが合わせて表示されますので、\u003cem\u003eOK\u003c/em\u003e をクリックしてインストールします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/668cf8eaf6884f772777cf3a44d68d7fb16c2760/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30362e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_06.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d569ae7ae7d8d6f5d98026ba0e7ff699\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_06.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_06.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bb90799e175b63005bf27f4a4eb81f42 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/3dcbf44052d103519148db1d606c4e68f8c2ef49/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30372e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_07.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c45f8c7c877e3d24e3ff3f6cae011ce7\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_07.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_07.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6c2acacee8c026c24b50abb7ef73934b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eインストールが終了したら、NuGet のウインドウを閉じます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"会話のハンドリングの記述-基本\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BC%9A%E8%A9%B1%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AE%E8%A8%98%E8%BF%B0-%E5%9F%BA%E6%9C%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e会話のハンドリングの記述 (基本)\u003c/h2\u003e\n\n\u003cp\u003e\u003cem\u003eDialogs\u003c/em\u003e フォルダー をクリックして開きます。\u003cem\u003eRootDialog.cs\u003c/em\u003e をクリックして表示し、こちらを編集していきます。RootDialog.cs にはメッセージを受信したときの動作を記述します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/9df7cc35c6b9a346def4409ea5fac64c640a0f73/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30382e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_08.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=22017f3a597654914120c4e18f771ce4\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_08.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_08.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fbf597b0c2d02f5c3f0f58bf7de8aa97 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e冒頭に、先ほど追加した Microsoft.Cognitive.CustomVision を追加します。合わせて System.Net.Http も追加しておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eRootDialog.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.Cognitive.CustomVision\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Net.Http\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"初期メッセージの追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%9D%E6%9C%9F%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e初期メッセージの追加\u003c/h3\u003e\n\n\u003cp\u003eメッセージを受信したとき最初に \u003cem\u003eStartAsync\u003c/em\u003e が呼びだされ、\u003cem\u003eStartAsync\u003c/em\u003e から \u003cem\u003eMessageReceivedAsync\u003c/em\u003e が呼び出されます。\u003cbr\u003e\n\u003cem\u003eMessageReceivedAsync\u003c/em\u003e 呼び出し前に初期メッセージを追加します。 \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eRootDialog.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eStartAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIDialogContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// デフォルトのメッセージをセット\u003c/span\u003e\n    \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePostAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"こんにちは！画像DE路線当てBot です。\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWait\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageReceivedAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompletedTask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"custom-vision-を呼び出す準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#custom-vision-%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCustom Vision を呼び出す準備\u003c/h3\u003e\n\n\u003cp\u003eMessageReceivedAsync に Custom Vision の画像分析エンジンを呼び出すコードを追加していきます。\u003cbr\u003e\n下記コードの YOUR_PREDICTION_KEY には Custom Vision の Prediction URL 表示画面で表示される Prediction-key、YOUR_PROJECT_ID には URL に含まれている Project ID をコピーします。\u003cbr\u003e\n\u003ca href=\"https://qiita.com/hmaruyama/private/fd28cdee19a55fb510b1\" id=\"reference-51c8690fd6b379afa4de\"\u003eCustom Vision 編\u003c/a\u003e の API アクセス情報画面から取得できます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eRootDialog.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eMessageReceivedAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIDialogContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIAwaitable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eactivity\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eActivity\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 変数定義\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etag\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// 電車カテゴリータグ\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emsg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// 返答メッセージ\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Custom Vision API を使う準備\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecvCred\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePredictionEndpointCredentials\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"YOUR_PREDICTION_KEY\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecvEp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePredictionEndpoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecvCred\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecvGuid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"YOUR_PROJECT_ID\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 画像が送られてきたら Custom Vision を呼び出してタグを取得\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// メッセージをセット\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ※次以降の項目で作成します\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePostAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWait\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageReceivedAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"custom-vision-の呼び出し結果の取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#custom-vision-%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E7%B5%90%E6%9E%9C%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCustom Vision の呼び出し、結果の取得\u003c/h3\u003e\n\n\u003cp\u003e画像を Stream として取得し、Custom Vision を呼び出します。Probability (≒信頼度) の高いものからリストされるため、最初にリストされるタグのみを取得します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eRootDialog.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eMessageReceivedAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIDialogContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIAwaitable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"err\"\u003e中略\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 画像が送られてきたら Custom Vision を呼び出してタグを取得\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eactivity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAttachments\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 送られてきた画像を Stream として取得\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ephotoUrl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eactivity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAttachments\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eContentUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHttpClient\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ephotoStream\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetStreamAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ephotoUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 画像を判定\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecvResult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ecvEp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePredictImageAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecvGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ephotoStream\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// タグを取得\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etag\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecvResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePredictions\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eTag\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// Error Handling\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// メッセージをセット\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ※次以降の項目で作成します\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePostAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWait\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageReceivedAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"返答の作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%BF%94%E7%AD%94%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e返答の作成\u003c/h3\u003e\n\n\u003cp\u003e返答メッセージにタグをセットします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eRootDialog.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eMessageReceivedAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIDialogContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIAwaitable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"err\"\u003e中略\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// メッセージをセット\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etag\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emsg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etag\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"、に いちばんにてるね！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 判定できなかった場合\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emsg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"電車の写真を送ってね\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePostAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWait\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageReceivedAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e忘れずに \u003cem\u003eRootDialog.cs\u003c/em\u003e を保存しておきます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"アプリケーションの動作確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアプリケーションの動作確認\u003c/h3\u003e\n\n\u003cp\u003eここで一旦 BOT の動作確認を行います。、F5 または デバック＞デバックの開始 をクリックして、プロジェクトのビルドおよび起動を行います。ブラウザが起動して Bot Framework のデフォルト画面が表示されたら、Bot Framework Channel Emulator を起動してアクセスを行います。\u003cbr\u003e\nBot Framework Channel Emulator の上部中央にある Bot Url に、起動しているブラウザと同じ URL (デフォルトでは \u003ca href=\"http://localhost:xxxx\" class=\"autolink\"\u003ehttp://localhost:xxxx\u003c/a\u003e) に /api/messages を追加したアドレス (\u003ca href=\"http://localhost:xxxx/api/messages\" class=\"autolink\"\u003ehttp://localhost:xxxx/api/messages\u003c/a\u003e) を指定します。\u003c/p\u003e\n\n\u003cp\u003e何か文字を入力して送信すると、StartAsync で指定したデフォルトの回答が返信されることを確認してください。\u003cbr\u003e\n入力エリアの画像アイコンをクリックして、分析した画像を選択、BOT に送信すると、判定されたタグが返信されるのを確認してください。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ffd28f9ecaed4288e97aa6ab9d893060f6025c4e/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30392e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_09.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=47ad786209f14cf60b0ba6f5c542317a\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_09.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_09.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=86eba858839028c67cd6f5a2dc42dd9c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"会話のハンドリングの記述-駅すぱあと-web-サービス-を利用した情報の取得とセット\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BC%9A%E8%A9%B1%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AE%E8%A8%98%E8%BF%B0-%E9%A7%85%E3%81%99%E3%81%B1%E3%81%82%E3%81%A8-web-%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9-%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E6%83%85%E5%A0%B1%E3%81%AE%E5%8F%96%E5%BE%97%E3%81%A8%E3%82%BB%E3%83%83%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e会話のハンドリングの記述 (駅すぱあと Web サービス を利用した情報の取得とセット)\u003c/h2\u003e\n\n\u003cp\u003e画像を判定して取得できたタグに応じてメッセージを変更します。\u003cbr\u003e\n今回は、\u003ca href=\"https://ekiworld.net/service/sier/webservice/index.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e駅すぱあと Web サービス\u003c/a\u003e を利用して、路線名から停車駅を取得し、表示するようにします。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e路線名、停車駅はこちらの API を利用して取得できます。今回は予め路線コードはアプリ内に保持し、停車駅のみを API で取得しています。\u003cbr\u003e\n- 路線名の取得: \u003ca href=\"http://api.ekispert.jp/v1/xml/operationLine?name=%E8%B7%AF%E7%B7%9A%E5%90%8D\u0026amp;key=%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%AD%E3%83%BC\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://api.ekispert.jp/v1/xml/operationLine?name=路線名\u0026amp;key=アクセスキー\u003c/a\u003e\u003cbr\u003e\n- 停車駅の取得: \u003ca href=\"http://api.ekispert.jp/v1/json/station?\u0026amp;operationLineCode=%E8%B7%AF%E7%B7%9A%E3%82%B3%E3%83%BC%E3%83%89\u0026amp;key=%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%AD%E3%83%BC\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://api.ekispert.jp/v1/json/station?\u0026amp;operationLineCode=路線コード\u0026amp;key=アクセスキー\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"停車駅を取得する準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%81%9C%E8%BB%8A%E9%A7%85%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e停車駅を取得する準備\u003c/h3\u003e\n\n\u003cp\u003e駅すぱあと API で取得した情報は XML または JSON で取得できます。\u003cbr\u003e\n今回は JSON でデータを取得し、その後利用しやすくするためのクラスを作成します。\u003c/p\u003e\n\n\u003cp\u003eプロジェクトを右クリックして [追加]＞[新しいフォルダー] をクリック、\u003cem\u003eModels\u003c/em\u003e というフォルダーを作成します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/2673a1204ea83e4187d4815626a6780dc7f18a5b/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31302e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_10.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=10401b113b474e3c6676f6a2a2e44df0\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_10.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_10.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fbce105e2e0eef3d68047be3a46d5346 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e作成した \u003cem\u003eModels\u003c/em\u003e フォルダーを右クリックして、[追加]＞[クラス]をクリックします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/501a143099656fd288f0d51064594f7e38b3e0ba/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31312e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_11.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c4b53c6260f2973e1e5efed903af4795\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_11.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_11.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=292e15b36275bdb698e0ce3f42590069 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e名前に \u003cem\u003eStationModel.cs\u003c/em\u003e と入力して、[追加] をクリックして新規クラスファイルを作成します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/9197a928c1beceabb47c4bd608b134903bbf12dc/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31322e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_12.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c77f854d2d57836013aa34b479067f33\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_12.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_12.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=75c615e643295f8cba11de58e18e5710 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eStationModel.cs を開き、デフォルトで作成されている StationModel クラスを一旦削除します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/af97a91f7a474783b0135376ccf9a2443d92b43b/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31332e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_13.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6acc3794b64f36523cfbcf9775959028\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_13.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_13.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c1d02a1620c29ae50989d0b0cb3c8e2e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAPI のフォーマットを取得するため、ブラウザーを起動して API にアクセスを行います。\u003cbr\u003e\n\u003ca href=\"http://api.ekispert.jp/v1/json/station?\u0026amp;operationLineCode=113\u0026amp;direction=down\u0026amp;key=%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%AD%E3%83%BC\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://api.ekispert.jp/v1/json/station?\u0026amp;operationLineCode=113\u0026amp;direction=down\u0026amp;key=アクセスキー\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e表示される結果をすべて選択して、コピーします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ca24a9acaa23c9365dc7c89206474e2549cbbac9/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31342e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_14.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9f93e7ce5812ddce56d257a65fd6c229\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_14.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_14.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b652998d38be94d7f6245b85a4976c92 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eVisual Studio に戻り、\u003cem\u003enamespace .Models\u003c/em\u003e 内をクリックして選択してから、上部ツールバーから [編集]＞[形式を選択して貼り付け]＞[JSON をクラスとして貼り付ける] を選択して、コピーした内容を貼り付けます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c877af173b125e33fad4a645c2c2b48a0b1518dd/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31352e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_15.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=beeb182bfefe3f33d4f360b846706b9d\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_15.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_15.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=de926bc15a93195b31146bb7fb658883 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/14a5a9392ad378f1ffc1d5b7932d294ef7caad88/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31362e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_16.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=720f7671ed6cfe843375139298a9ce3a\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_16.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_16.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=da74934989cf43143f4c77d40b9ea9eb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eclass Rootobject\u003c/em\u003e は \u003cem\u003eclass StationModel\u003c/em\u003e に変更します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/262e9b1ed797544a38fe782de4743a91de126a6d/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f31372e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_17.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d42f22c07ae8c849977b21dbb46d9c0b\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_17.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_17.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6dc23abaf8ce8e07f93a353b80b5bc99 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e適時ファイルの保存を行っておきます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"路線名路線コードのセット\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%B7%AF%E7%B7%9A%E5%90%8D%E8%B7%AF%E7%B7%9A%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e路線名、路線コードのセット\u003c/h3\u003e\n\n\u003cp\u003e画像を判定して取得できたタグによって、路線名と路線コードをセットします。\u003cbr\u003e\nまず、変数定義のところで、路線名と路線コードを扱う変数 (lineName, lineCode) を追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eRootDialog.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eMessageReceivedAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIDialogContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIAwaitable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eactivity\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eActivity\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 変数定義\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etag\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// 電車カテゴリータグ\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emsg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// 返答メッセージ\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003elineName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// [追加] 路線名 (駅すぱあと運航路線名)\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003elineCode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// [追加] 路線コード (駅すぱあと運航路線コード)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003e後略\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e次に取得したタグに応じて lineName と lineCode をセットするように変更します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eRootDialog.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eMessageReceivedAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIDialogContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIAwaitable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eactivity\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eActivity\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"err\"\u003e中略\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// メッセージをセット\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etag\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//msg = tag + \"、に いちばんにてるね！\";\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// タグに応じてメッセージをセット\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etag\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Chuo_Sobu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ＪＲ中央・総武線各駅停車\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineCode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"110\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Chuo_Ex\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ＪＲ中央線快速\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineCode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"109\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Keihin-Tohoku\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ＪＲ京浜東北線\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineCode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"115\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Tokaido\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ＪＲ東海道本線\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineCode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"117\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Yamanote\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ＪＲ山手線\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineCode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"113\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Yokosuka_SobuEx\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ＪＲ横須賀線\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineCode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"116\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e        \n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 路線情報を取得してセット\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ※次以降の項目で作成します\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emsg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"電車の写真を送ってね\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePostAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWait\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageReceivedAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003elineCode を使って停車駅情報を取得して (line に代入)、表示する内容に変更します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eRootDialog.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eMessageReceivedAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIDialogContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIAwaitable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eactivity\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eActivity\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"err\"\u003e中略\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// メッセージをセット\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etag\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//msg = tag + \"、に いちばんにてるね！\";\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// タグに応じてメッセージをセット\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etag\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Chuo_Sobu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ＪＲ中央・総武線各駅停車\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineCode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"110\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"err\"\u003e中略\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 路線情報を取得してセット\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetStationList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elineCode\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ※GetStationList は次以降の項目で作成\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emsg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elineName\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"、に いちばんにてるね！\\n\\n\"\u003c/span\u003e \n            \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003elineName\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"は、以下のえきをはしるよ。\\n\\n---- - \\n\\n\"\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emsg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"電車の写真を送ってね\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePostAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWait\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageReceivedAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"停車駅の取得とセット\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%81%9C%E8%BB%8A%E9%A7%85%E3%81%AE%E5%8F%96%E5%BE%97%E3%81%A8%E3%82%BB%E3%83%83%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e停車駅の取得とセット\u003c/h3\u003e\n\n\u003cp\u003e停車駅を取得してセットします。\u003cbr\u003e\nJSON を扱えるように　Newtonsoft.JSON と、前の項目で作成した Model を RootDialog.cs の冒頭に追加しておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eRootDialog.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eNewtonsoft.Json\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eTrainFinderBot.Models\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eGetStationList を追加し、路線情報を取得します。\u003cbr\u003e\n取得できた停車駅は \"→\" で繋いで 1 行にします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eRootDialog.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eMessageReceivedAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIDialogContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIAwaitable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"err\"\u003e中略\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetStationList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003elineCode\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHttpClient\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 路線名、アクセスキーをセット\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eekiRequest\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"http://api.ekispert.jp/v1/json/station?\u0026amp;operationLineCode=\"\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003elineCode\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\u0026amp;direction=down\u0026amp;key=\"\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"YOUR_ACCESSKEY\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//アクセスキー\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 路線情報の取得\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eekiResult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetStringAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eekiRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eekiStr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUri\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUnescapeDataString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eekiResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eekiModel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eJsonConvert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeserializeObject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eStationModel\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eekiStr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 停車駅情報を編集\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estationList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eekiModel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResultSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estationList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estationList\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"→\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estationList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estationList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubstring\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003estationList\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"アプリケーションの動作再確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%8B%95%E4%BD%9C%E5%86%8D%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアプリケーションの動作(再)確認\u003c/h3\u003e\n\n\u003cp\u003eF5 または デバック＞デバックの開始 をクリックして、プロジェクトのビルドおよび起動を行います。ブラウザが起動して Bot Framework のデフォルト画面が表示されたら、Bot Framework Channel Emulator を起動してアクセスを行います。\u003c/p\u003e\n\n\u003cp\u003e入力エリアの画像アイコンをクリックして、分析した画像を選択、BOT に送信します。\u003cbr\u003e\n設定したメッセージが返答されたら完成です。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/7a6a6ddb4adb03c310b58e1305b16d1c1c1f65f4/68747470733a2f2f6769746875622e636f6d2f612d6e2d6e2d692d652f436f676e6974697665437573746f6d566973696f6e2d547261696e46696e646572426f742f626c6f622f6d61737465722f73637265656e73686f74732f547261696e46696e646572426f745f30312e4a50473f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_01.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=75a206dd6c909f3f7803e605649f1fdd\" alt=\"\" data-canonical-src=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot/blob/master/screenshots/TrainFinderBot_01.JPG?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fa-n-n-i-e%2FCognitiveCustomVision-TrainFinderBot%2Fblob%2Fmaster%2Fscreenshots%2FTrainFinderBot_01.JPG%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ee23c8dfcd465d0eb4bbe5c4b059459d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"appendix\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#appendix\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAppendix\u003c/h1\u003e\n\n\u003cp\u003e完成形のソースコードを GitHub にて公開しました。\u003cbr\u003e\n\u003ca href=\"https://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/a-n-n-i-e/CognitiveCustomVision-TrainFinderBot\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2017-09-24T21:59:00Z","elapsedYearsFromLastModifiedAt":3,"encryptedId":"agqIZxo01cmspDfu2vQnut8nd9MzW8Pb--KrR0+E0+kG/ZlA68--mCqo6M7sfGLkDqE7fwhEuw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2017-09-28T05:34:45Z","likesCount":3,"linkUrl":"https://qiita.com/annie/items/c4bcc3dff1fa17deea2b","organization":null,"originalId":526420,"stockedCount":9,"title":"駅すぱあと x Cognitive Services で 画像DE路線当てBOT を作ろう！ [Bot実装 (C# ver) 編]","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#bot-framework--cognitive-services-%E5%88%A9%E7%94%A8%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E7%92%B0%E5%A2%83%E3%82%B5%E3%83%96%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E6%BA%96%E5%82%99\"\u003eBot Framework \u0026amp; Cognitive Services 利用に必要な環境、サブスクリプションの準備\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\"\u003e開発環境\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#visual-studiobot-framework-template--bot-framework-channel-emulator\"\u003eVisual Studio、Bot Framework Template \u0026amp; Bot Framework Channel Emulator\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%A7%85%E3%81%99%E3%81%B1%E3%81%82%E3%81%A8-web%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9-%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%AD%E3%83%BC\"\u003e駅すぱあと Webサービス のアクセスキー\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#custom-vision-%E7%B7%A8-%E3%82%92%E5%AE%9F%E6%96%BD%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88\"\u003eCustom Vision 編 を実施していない場合\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#microsoft-%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88\"\u003eMicrosoft アカウント\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#bot-%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003eBOT アプリの実装\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#bot-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90\"\u003eBot アプリケーションの作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#cognitive-services-emotion-api-%E3%81%AE-c-%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%83%BC%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003eCognitive Services Emotion API の C# ライブラリーのインストール\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BC%9A%E8%A9%B1%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AE%E8%A8%98%E8%BF%B0-%E5%9F%BA%E6%9C%AC\"\u003e会話のハンドリングの記述 (基本)\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%88%9D%E6%9C%9F%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e初期メッセージの追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#custom-vision-%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E6%BA%96%E5%82%99\"\u003eCustom Vision を呼び出す準備\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#custom-vision-%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E7%B5%90%E6%9E%9C%E3%81%AE%E5%8F%96%E5%BE%97\"\u003eCustom Vision の呼び出し、結果の取得\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%BF%94%E7%AD%94%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e返答の作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003eアプリケーションの動作確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BC%9A%E8%A9%B1%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AE%E8%A8%98%E8%BF%B0-%E9%A7%85%E3%81%99%E3%81%B1%E3%81%82%E3%81%A8-web-%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9-%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E6%83%85%E5%A0%B1%E3%81%AE%E5%8F%96%E5%BE%97%E3%81%A8%E3%82%BB%E3%83%83%E3%83%88\"\u003e会話のハンドリングの記述 (駅すぱあと Web サービス を利用した情報の取得とセット)\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%81%9C%E8%BB%8A%E9%A7%85%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B%E6%BA%96%E5%82%99\"\u003e停車駅を取得する準備\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%B7%AF%E7%B7%9A%E5%90%8D%E8%B7%AF%E7%B7%9A%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88\"\u003e路線名、路線コードのセット\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%81%9C%E8%BB%8A%E9%A7%85%E3%81%AE%E5%8F%96%E5%BE%97%E3%81%A8%E3%82%BB%E3%83%83%E3%83%88\"\u003e停車駅の取得とセット\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%8B%95%E4%BD%9C%E5%86%8D%E7%A2%BA%E8%AA%8D\"\u003eアプリケーションの動作(再)確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#appendix\"\u003eAppendix\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":3318,"uuid":"c4bcc3dff1fa17deea2b","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"fqOUqH4naSHXbl9oni550WK26cKp--fg/xLtHm/GKN995/--Coqh40jgDU2rjf7x+pYURw==","originalId":117583,"description":"","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"annie","profileImageUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/117583/73c0d5e64925a01ddfcb5dfec9aa2ffb823090e5/x_large.png?1604022610","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F117583%2F73c0d5e64925a01ddfcb5dfec9aa2ffb823090e5%2Fx_large.png%3F1604022610?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=fa81f2b4bfbecd0f1d6ad352438cd20f","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F117583%2F73c0d5e64925a01ddfcb5dfec9aa2ffb823090e5%2Fx_large.png%3F1604022610?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=3764d31bd55c31b2a8f553c55cffdb7d","urlName":"annie","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"BotFramework","urlName":"botframework"},{"name":"CognitiveServices","urlName":"cognitiveservices"},{"name":"駅すぱあと","urlName":"%e9%a7%85%e3%81%99%e3%81%b1%e3%81%82%e3%81%a8"},{"name":"CustomVisionService","urlName":"customvisionservice"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

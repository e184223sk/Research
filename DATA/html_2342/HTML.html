<!DOCTYPE html><html><head><meta charset="utf-8" /><title>RPG戦闘のAIを総当たりで実装する（そして、インターフェースを用いた設計） - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/NumAniCloud/items/75f7253483b685d0d7b0" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="lpoOwxIgZz2Hv1LqjlMXxj/oKoLfLsygRyveGfxHWr7ovm4n0jUvXBJ3XTJh1xEeLyfug1iRJG8LJF1UepN75g==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@NumAniCloud" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="RPG戦闘のAIを総当たりで実装する（そして、インターフェースを用いた設計） - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1VbEJINW9pbTZaZVk0NEd1UVVuamdwTG50NF9sdlpQamdaX2pnb3JqZ2FmbHJwX29vNFhqZ1puamdvdnZ2SWpqZ1ozamdaZmpnYWJqZ0lIamdxVGpnN1BqZ3Jfamc3empnNVhqZ3Fmamc3empncm5qZ3BMbmxLampnWVRqZ1pfb3FLM29xSWp2dklrJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTFlNDk5Y2YyYWFiYTJmMWE1NGJkZWNiYTYxNjliNTAw&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRTUxYlVGdWFVTnNiM1ZrJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9MGVlOGNkYTBmYzVkZTI4ZTFlMTFiZjcxYjZlNzYyNDI&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=b6a6d2baba877829d7eba8546b19c864"><meta property="og:description" content="この記事は C# Advent Calendar 2019 の1日目です。

私はRPGを作るのが大好きです。特に、ちょっと複雑な効果を持ったユニークなスキルを実装するのが好きです。しかし、そういったスキルを敵に使わせる時には悩ましい..."><meta content="https://qiita.com/NumAniCloud/items/75f7253483b685d0d7b0" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,game,oop,AI,RPG" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-28e70ab0-0dca-4b5d-9bfc-38d1d1822495"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2FNumAniCloud%2Fitems%2F75f7253483b685d0d7b0">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2FNumAniCloud%2Fitems%2F75f7253483b685d0d7b0">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-28e70ab0-0dca-4b5d-9bfc-38d1d1822495">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-11-28T17:08:52.000+09:00","dateModified":"2019-12-01T07:00:24.000+09:00","headline":"RPG戦闘のAIを総当たりで実装する（そして、インターフェースを用いた設計）","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1VbEJINW9pbTZaZVk0NEd1UVVuamdwTG50NF9sdlpQamdaX2pnb3JqZ2FmbHJwX29vNFhqZ1puamdvdnZ2SWpqZ1ozamdaZmpnYWJqZ0lIamdxVGpnN1BqZ3Jfamc3empnNVhqZ3Fmamc3empncm5qZ3BMbmxLampnWVRqZ1pfb3FLM29xSWp2dklrJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTFlNDk5Y2YyYWFiYTJmMWE1NGJkZWNiYTYxNjliNTAw\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRTUxYlVGdWFVTnNiM1ZrJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9MGVlOGNkYTBmYzVkZTI4ZTFlMTFiZjcxYjZlNzYyNDI\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=b6a6d2baba877829d7eba8546b19c864","mainEntityOfPage":"https://qiita.com/NumAniCloud/items/75f7253483b685d0d7b0","author":{"@type":"Person","address":"","email":null,"identifier":"NumAniCloud","name":"NumAniCloud","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F32800%2Fprofile-images%2F1569302037?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=55f84c18aea88997e63d164ddbf75449","url":"https://qiita.com/NumAniCloud","description":"ゲーム制作に興味があります。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"NumAniCloud","type":"items","id":"75f7253483b685d0d7b0"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"NumAniCloud","type":"items","id":"75f7253483b685d0d7b0"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"NumAniCloud","type":"items","id":"75f7253483b685d0d7b0"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/NumAniCloud/items/75f7253483b685d0d7b0","location":"/NumAniCloud/items/75f7253483b685d0d7b0","scheme":"https","host":"qiita.com","port":null,"pathname":"/NumAniCloud/items/75f7253483b685d0d7b0","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"rVH0IfEFbZKWVFqxx+ClKwj9hNqef4MYQIa82dvfodfTdZTFMRAl8wOcVWkoZKPzGDJA2xnAa9cMiT+UXQuAjw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-4a4fe841-c63e-468a-b02d-b499c494c48f"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/NumAniCloud/items/75f7253483b685d0d7b0/likers" class="css-1iupg5d">17</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">16</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/75f7253483b685d0d7b0/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/NumAniCloud/items/75f7253483b685d0d7b0/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/NumAniCloud/items/75f7253483b685d0d7b0/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/NumAniCloud/items/75f7253483b685d0d7b0/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/NumAniCloud/items/75f7253483b685d0d7b0.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><span><a href="/advent-calendar/2019/c-sharp" class="it-AdcalRibbon_title">C#<!-- --> Advent Calendar<!-- --> <!-- -->2019</a>Day 1</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/NumAniCloud"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/32800/profile-images/1569302037" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/NumAniCloud" class="css-10ougpm">@<!-- -->NumAniCloud</a><div class="css-1ay9vb9"><span><meta content="2019-11-28T08:08:52Z"/><time dateTime="2019-11-30T22:00:24Z" class="css-m19uds">updated at 2019-11-30</time></span></div></div></div></div></div><h1 class="css-cgzq40">RPG戦闘のAIを総当たりで実装する（そして、インターフェースを用いた設計）</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/game" class="css-4czcte">game</a><a href="/tags/oop" class="css-4czcte">oop</a><a href="/tags/ai" class="css-4czcte">AI</a><a href="/tags/rpg" class="css-4czcte">RPG</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>この記事は <a href="https://qiita.com/advent-calendar/2019/c-sharp">C# Advent Calendar 2019</a> の1日目です。</p>

<p>私はRPGを作るのが大好きです。特に、ちょっと複雑な効果を持ったユニークなスキルを実装するのが好きです。しかし、そういったスキルを敵に使わせる時には悩ましい問題があります。</p>

<p>「攻撃力の高いスキル」と「自分のHPを回復するスキル」があったとして、どちらを使うと良いでしょうか？それは場合によります。1撃でライバルを倒せるならば前者ですし、逆に自分が1撃で倒れそうなら後者かもしれません。</p>

<p>実際にゲームシステムを組みながら、AIをどのような発想で実装するとよいか、その際にプログラムの設計で気を付けることなどを紹介します。オブジェクト指向などの設計のための参考にしていただければ幸いです。</p>

<h2>
<span id="ゲームシステム" class="fragment"></span><a href="#%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0"><i class="fa fa-link"></i></a>ゲームシステム</h2>

<p>今回実装するゲームは以下のようなシステムです：</p>

<ul>
<li>プレイヤー1体と敵1体がいて、お互いに相手のHPが0になることを目指す</li>
<li>プレイヤーと敵は1ラウンドに一回行動できる。</li>
<li>プレイヤーはAIによって自動で行動する。</li>
<li>敵は固定の行動しかとらない。</li>
<li>プレイヤーは複数のスキルから何らかの手段でスキルを選んで使用できる。</li>
<li>スキルには攻撃力が、戦闘参加者には防御力がある。

<ul>
<li>(ダメージ) = (攻撃力) - (防御力)</li>
</ul>
</li>
<li>決着がつくとプログラムは終了する。</li>
<li>戦闘の様子はコンソール ウィンドウに出力される。</li>
</ul>

<p>ユーザーが操作できる部分すらなく寂しい感じですが、今回はAIを実装したいだけなのでバッサリ割愛しました。</p>

<h2>
<span id="下準備" class="fragment"></span><a href="#%E4%B8%8B%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>下準備</h2>

<p>まずはゲームの全体の流れを作成します。<br>
つまり、バトルの参加者に関する情報の初期化や、<br>
ゲームの勝利条件の判定などのことです。</p>

<p>まだ定義していないクラスが多数登場しますので、この後ひとつづつ実装していきます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Program.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// HPが低いが防御が高い敵と、HPが高く防御が低い敵を作成</span>
        <span class="c1">// BattleContext.Enemy にどちらを渡すかによって、対戦相手を差し替えることができる</span>
        <span class="kt">var</span> <span class="n">enemy1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EnemyBattler</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Hp</span> <span class="p">=</span> <span class="m">45</span><span class="p">,</span>
            <span class="n">Defense</span> <span class="p">=</span> <span class="m">25</span><span class="p">,</span>
        <span class="p">};</span>
        <span class="kt">var</span> <span class="n">enemy2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EnemyBattler</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Hp</span> <span class="p">=</span> <span class="m">100</span><span class="p">,</span>
            <span class="n">Defense</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
        <span class="p">};</span>

        <span class="c1">// バトルの制御全体にわたって必要になる情報を保持するクラス</span>
        <span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BattleContext</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Enemy</span> <span class="p">=</span> <span class="n">enemy1</span><span class="p">,</span>
            <span class="n">Player</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PlayerBattler</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Hp</span> <span class="p">=</span> <span class="m">100</span><span class="p">,</span>
                <span class="n">Defense</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
                <span class="n">Skills</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Skill</span><span class="p">[]</span>
                <span class="p">{</span>
                    <span class="k">new</span> <span class="nf">SingleAttackSkill</span><span class="p">(</span><span class="m">87</span><span class="p">),</span>  <span class="c1">// ここでスキルの攻撃力を設定</span>
                    <span class="k">new</span> <span class="nf">TripleAttackSkill</span><span class="p">(</span><span class="m">39</span><span class="p">),</span>  <span class="c1">// ここでスキルの攻撃力を設定</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"プレイヤーのHP:</span><span class="p">{</span><span class="n">context</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Hp</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"敵のHP:</span><span class="p">{</span><span class="n">context</span><span class="p">.</span><span class="n">Enemy</span><span class="p">.</span><span class="n">Hp</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>

        <span class="k">while</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">context</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="nf">Act</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">Enemy</span><span class="p">.</span><span class="n">Hp</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"敵は倒れた！"</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"プレイヤーの勝ち"</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">context</span><span class="p">.</span><span class="n">Enemy</span><span class="p">.</span><span class="nf">Act</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Hp</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"プレイヤーは倒れた！"</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"敵の勝ち"</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>次に定義するのは、バトル全体にわたって必要になる機能をまとめる <code>BattleContext</code> クラスです。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">BattleContext.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">BattleContext</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">EnemyBattler</span> <span class="n">Enemy</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">PlayerBattler</span> <span class="n">Player</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>独特で多様なスキルをたくさん作るためにも、戦況に関わる情報はなるべくどこからでも書き換えできるように、 <code>BattleContext</code> のプロパティに押し込めて様々なクラスに受け渡します。敵とプレイヤーの情報が同時に必要になる場面はいくらかあるので、こうして固めておいて、メソッドの引数の定義が簡潔になることを狙っています（パラメータ オブジェクトといいます）。</p>

<p>次は、バトルの主役である <code>EnemyBattler</code>, <code>PlayerBattler</code> を定義します。まずはそれらの基底クラスとして、敵にもプレイヤーにもあるHPと防御力を持たせた <code>Battler</code> クラスを定義します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Battler.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Battler</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Hp</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Defense</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>そして、 <code>EnemyBattler</code> クラスを定義します。このクラスは、ターンが回ってきたときの行動を実行する <code>Act</code> メソッドを持ちます。敵のAIとして、プレイヤーに対して119の固定ダメージを及ぼす攻撃をさせることにします。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">EnemyBattler.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">EnemyBattler</span> <span class="p">:</span> <span class="n">Battler</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Act</span><span class="p">(</span><span class="n">BattleContext</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"敵の攻撃"</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"プレイヤーに 119 のダメージ"</span><span class="p">);</span>
        <span class="n">context</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Hp</span> <span class="p">-=</span> <span class="m">119</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>つぎに <code>PlayerBattler</code> クラスを定義します。このクラスも敵と同じ役割である <code>Act</code> メソッドを持ちますが、行動内容としてスキルを適当に選び、実行します。今回は、持っているスキルから先頭のものを必ず使うようにしましょう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">PlayerBattler.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">PlayerBattler</span> <span class="p">:</span> <span class="n">Battler</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">Skill</span><span class="p">[]</span> <span class="n">Skills</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Act</span><span class="p">(</span><span class="n">BattleContext</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Skills</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="nf">Run</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">context</span><span class="p">.</span><span class="n">Enemy</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>詳しくは前述の <code>Program.cs</code> に書かれていますが、スキルの配列には次のものを決め打ちで渡します：</p>

<ul>
<li>0番目は一回攻撃のスキルで、威力87</li>
<li>1番目は三回攻撃のスキルで、威力39</li>
</ul>

<p>スキルとは、次のようなクラスです。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Skill.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">abstract</span> <span class="k">class</span> <span class="nc">Skill</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Run</span><span class="p">(</span><span class="n">BattleContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Battler</span> <span class="n">target</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><code>Skill</code> には、 <code>SingleAttackSkill</code>, <code>TripleAttackSkill</code> という2つのバリエーションがあります。 <code>SingleAttackSkill</code> は、敵に一回だけ攻撃するスキルです。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">SingleAttackSkill.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">sealed</span> <span class="k">class</span> <span class="nc">SingleAttackSkill</span> <span class="p">:</span> <span class="n">Skill</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Power</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">SingleAttackSkill</span><span class="p">(</span><span class="kt">int</span> <span class="n">power</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Power</span> <span class="p">=</span> <span class="n">power</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Run</span><span class="p">(</span><span class="n">BattleContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Battler</span> <span class="n">target</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"あなたは狙いを定めて敵を撃ちぬいた！"</span><span class="p">);</span>

        <span class="kt">var</span> <span class="n">damage</span> <span class="p">=</span> <span class="n">Power</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">Defense</span><span class="p">;</span>    <span class="c1">// ダメージ計算</span>
        <span class="n">target</span><span class="p">.</span><span class="n">Hp</span> <span class="p">-=</span> <span class="n">damage</span><span class="p">;</span>                    <span class="c1">// 実際にHPを減らす</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"敵に</span><span class="p">{</span><span class="n">damage</span><span class="p">}</span><span class="s">のダメージ！"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><code>TripleAttackSkill</code> は、敵に3回連続で攻撃するスキルです。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">TripleAttackSkill.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">sealed</span> <span class="k">class</span> <span class="nc">TripleAttackSkill</span> <span class="p">:</span> <span class="n">Skill</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Power</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">TripleAttackSkill</span><span class="p">(</span><span class="kt">int</span> <span class="n">power</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Power</span> <span class="p">=</span> <span class="n">power</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Run</span><span class="p">(</span><span class="n">BattleContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Battler</span> <span class="n">target</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"あなたは敵の体へ銃を3連射した！"</span><span class="p">);</span>

        <span class="kt">var</span> <span class="n">singleDamage</span> <span class="p">=</span> <span class="n">Power</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">Defense</span><span class="p">;</span>  <span class="c1">// ダメージ計算</span>
        <span class="n">target</span><span class="p">.</span><span class="n">Hp</span> <span class="p">-=</span> <span class="n">singleDamage</span> <span class="p">*</span> <span class="m">3</span><span class="p">;</span>              <span class="c1">// 実際にHPを減らす</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"敵に </span><span class="p">{</span><span class="n">singleDamage</span><span class="p">}</span><span class="s"> のダメージ！"</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"敵に </span><span class="p">{</span><span class="n">singleDamage</span><span class="p">}</span><span class="s"> のダメージ！"</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"敵に </span><span class="p">{</span><span class="n">singleDamage</span><span class="p">}</span><span class="s"> のダメージ！"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="ひとまず実行" class="fragment"></span><a href="#%E3%81%B2%E3%81%A8%E3%81%BE%E3%81%9A%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>ひとまず実行</h2>

<p>上記のサンプルでは、 <code>BattleContext.Enemy</code> プロパティに <code>enemy1</code> 変数の内容を設定してあります。このまま実行すると次のようになります：</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>プレイヤーのHP:100
敵のHP:45
あなたは狙いを定めて敵を撃ちぬいた！
敵に62のダメージ！
敵は倒れた！
プレイヤーの勝ち
</code></pre></div></div>

<p>用意した一回攻撃のスキルは威力が<code>87</code>で、敵の防御力によって<code>25</code>軽減されましたが、それでも敵のHP<code>45</code>を超えるダメージを与えて倒すことができました。</p>

<p><code>BattleContext.Enemy</code> プロパティに <code>enemy2</code> 変数の内容を代入するように書き換えてみてください。それを実行すると次のようになります：</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>プレイヤーのHP:100
敵のHP:100
あなたは狙いを定めて敵を撃ちぬいた！
敵に87のダメージ！
敵の攻撃
プレイヤーに 119 のダメージ
プレイヤーは倒れた！
敵の勝ち
</code></pre></div></div>

<p>用意した一回攻撃のスキルは威力が<code>87</code>で、敵の防御力は<code>0</code>なのでダメージは減りませんでしたが、それでも敵のHP<code>100</code>を超えるダメージを与えられなかったので倒しきれず、反撃でやられてしまいました。</p>

<p>そこで、<code>PlayerBattler</code> の選択するスキルを0番目のスキルではなく1番目のスキルに変えてみるとどうでしょうか。書き換える場所は、 <code>PlayerBattler.cs</code> の <code>Act</code> メソッドの中です。1番目のスキルには「三回攻撃」が割り当てられているはずです。これで実行してみましょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>プレイヤーのHP:100
敵のHP:100
あなたは敵の体へ銃を3連射した！
敵に 39 のダメージ！
敵に 39 のダメージ！
敵に 39 のダメージ！
敵は倒れた！
プレイヤーの勝ち
</code></pre></div></div>

<p>敵に<code>39*3</code>のダメージを与え、これはHP<code>100</code>を超えているので倒すことができました。</p>

<p>しかし、いつも三回攻撃のスキルを選べば良いわけではありませんよね。対戦相手を <code>enemy1</code> に戻すと次のような結果になります：</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>プレイヤーのHP:100
敵のHP:45
あなたは敵の体へ銃を3連射した！
敵に 14 のダメージ！
敵に 14 のダメージ！
敵に 14 のダメージ！
敵の攻撃
プレイヤーに 119 のダメージ
プレイヤーは倒れた！
敵の勝ち
</code></pre></div></div>

<p>三回攻撃スキルは一回のダメージが<code>39</code>ですが、敵の防御力<code>15</code>により軽減され、ダメージは<code>14*3=42</code>しか与えられませんでした。これだとHP<code>45</code>を削り切れないので、反撃でやられてしまいました。</p>

<p>こうなるようにルールを作ったので、プレイヤーは適切なスキルを考えて選択する必要があるわけです。</p>

<h2>
<span id="aiにやらせたいよね" class="fragment"></span><a href="#ai%E3%81%AB%E3%82%84%E3%82%89%E3%81%9B%E3%81%9F%E3%81%84%E3%82%88%E3%81%AD"><i class="fa fa-link"></i></a>AIにやらせたいよね</h2>

<p>でも、このように適切なスキルを選ばなければならないのは敵も同じです。敵キャラクターの行動はプレイヤーに選択させるわけにはいかないため、AIでスキルを決定する必要があるはずです。さて、AIに適切なスキルを選ばせるためにはどうすればよいのでしょうか？</p>

<p>攻撃力が高いスキルを選ぶのがよいでしょうか？でも、攻撃回数が多くて攻撃力の低いスキルの方が強いかもしれません。もしかしたら自分に攻撃力アップの状態変化がついているかもしれませんし、ほかにも、このターンは攻撃せずに敵に毒状態などを与えた方がいいのかもしれません。どんなスキルもシンプルな考え方で評価できる方法はないでしょうか？</p>

<p>今回紹介するのは、すべてのスキルに対して、それを使った結果をシミュレーションし、攻撃結果だけを評価する方法です。サンプルプログラムでは、敵側ではなくプレイヤーキャラクターが自動で適切なスキルを選ぶことができるAIを作ってみましょう（それはプレイヤーキャラクターとは言わない気がしますが悪しからず）。</p>

<h2>
<span id="スキルをシミュレーションするai" class="fragment"></span><a href="#%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E3%82%B7%E3%83%9F%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%99%E3%82%8Bai"><i class="fa fa-link"></i></a>スキルをシミュレーションするAI</h2>

<p>今回紹介する方法では、プレイヤーのAIは次のように実装します。引数として、選択肢となるスキルの配列を渡し、戻り値としてそのスキルの配列の中で最も効果的なものを選んで返します。詳細はこの後すぐ説明します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">PlayerAi.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">PlayerAi</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">Skill</span> <span class="nf">DetermineSkill</span><span class="p">(</span><span class="n">BattleContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Skill</span><span class="p">[]</span> <span class="n">skills</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 最も優先度が高い候補を保持する変数。より優先度の高いスキルが現れれば、その都度更新される</span>
        <span class="p">(</span><span class="n">Skill</span><span class="p">,</span> <span class="kt">int</span> <span class="n">priority</span><span class="p">)</span> <span class="n">candidate</span> <span class="p">=</span> <span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="p">-</span><span class="n">context</span><span class="p">.</span><span class="n">Enemy</span><span class="p">.</span><span class="n">Hp</span><span class="p">);</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">skill</span> <span class="k">in</span> <span class="n">skills</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// A. シミュレーション中に敵が受けるダメージを実際には反映しないためのクローン</span>
            <span class="kt">var</span> <span class="n">clone</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EnemyBattler</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Hp</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Enemy</span><span class="p">.</span><span class="n">Hp</span><span class="p">,</span>
                <span class="n">Defense</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Enemy</span><span class="p">.</span><span class="n">Defense</span>
            <span class="p">};</span>

            <span class="c1">// B. スキルを実際に適用してみる</span>
            <span class="n">skill</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">clone</span><span class="p">);</span>

            <span class="c1">// C. スキルの仕様結果を評価する。</span>
            <span class="c1">// 敵のHPが少ないほど好ましい状況のはず</span>
            <span class="kt">var</span> <span class="n">priority</span> <span class="p">=</span> <span class="p">-</span><span class="n">clone</span><span class="p">.</span><span class="n">Hp</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">candidate</span><span class="p">.</span><span class="n">priority</span> <span class="p">&lt;</span> <span class="n">priority</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">candidate</span> <span class="p">=</span> <span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">priority</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">candidate</span><span class="p">.</span><span class="n">Item1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>このコードについて詳しく見てみましょう。</p>

<h3>
<span id="b-本当にスキルを適用しているだけ" class="fragment"></span><a href="#b-%E6%9C%AC%E5%BD%93%E3%81%AB%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E9%81%A9%E7%94%A8%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%A0%E3%81%91"><i class="fa fa-link"></i></a>B. 本当にスキルを適用しているだけ</h3>

<p>コメント <code>B.</code> のところを見ると、本当にスキルを実行して試していることが分かりますね。</p>

<h3>
<span id="a-スキルは敵のコピーに対して使用する" class="fragment"></span><a href="#a-%E3%82%B9%E3%82%AD%E3%83%AB%E3%81%AF%E6%95%B5%E3%81%AE%E3%82%B3%E3%83%94%E3%83%BC%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>A. スキルは敵のコピーに対して使用する</h3>

<p>ただし、スキルの対象者として本物の <code>Enemy</code> を渡すわけにはいきません。そうしてしまうと、使うべきスキルが確定するころには敵キャラクターは全種類のスキルを喰らった後の満身創痍の状態になってしまい、それはこのゲームではルール違反です。ですので、元の <code>EnemyBattler</code> のパラメータをコピーした新しい <code>EnemyBattler</code> を作成します。この2つは完全に別のオブジェクトですので、コピーの方のHPが書き換わっても元のオブジェクトのHPは書き換わりません。このようなコピーを作ることを「クローンする」といいます。</p>

<p>「クローン」と「クローンでないもの」の違いは以下のような感じです：</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// 元のオブジェクト。</span>
<span class="kt">var</span> <span class="n">source</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EnemyBattler</span><span class="p">()</span> <span class="p">{</span> <span class="n">Hp</span> <span class="p">=</span> <span class="m">100</span> <span class="p">};</span>

<span class="c1">// 変数 source を変数 notClone に代入しただけ。クローンじゃない。</span>
<span class="c1">// この2つの変数は参照先が同じ</span>
<span class="kt">var</span> <span class="n">notClone</span> <span class="p">=</span> <span class="n">source</span><span class="p">;</span>

<span class="c1">// notClone.Hp を書き換えると source.Hp も書き換わってしまう。</span>
<span class="n">notClone</span><span class="p">.</span><span class="n">Hp</span> <span class="p">=</span> <span class="m">99</span><span class="p">;</span>

<span class="c1">// 変数 source のメンバー変数の値だけを引き継ぐ新しいオブジェクト。これがクローン。</span>
<span class="c1">// この2つの変数は参照先が違う</span>
<span class="kt">var</span> <span class="n">clone</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EnemyBattler</span><span class="p">()</span> <span class="p">{</span> <span class="n">Hp</span> <span class="p">=</span> <span class="n">source</span><span class="p">.</span><span class="n">Hp</span> <span class="p">};</span>

<span class="c1">// clone.Hp を書き換えても、 source.Hp は書き換わらない。</span>
<span class="n">clone</span><span class="p">.</span><span class="n">Hp</span> <span class="p">=</span> <span class="m">50</span><span class="p">;</span>
</code></pre></div></div>

<h3>
<span id="c-スキルを適用した結果を評価する" class="fragment"></span><a href="#c-%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E9%81%A9%E7%94%A8%E3%81%97%E3%81%9F%E7%B5%90%E6%9E%9C%E3%82%92%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>C. スキルを適用した結果を評価する</h3>

<p>スキルを適用したら、実際にどれだけ有効だったかを評価します。最も評価が高かったスキルをAIが実際に使うように制御するわけです。</p>

<p>スキルがどれだけ有効だったか、その評価基準はゲームのルールに依存します。多くのRPGは相手のHPを最も良く削るものを選ぶでしょうし、ひょっとすると、プレイヤーのお金を盗むことが最優先事項である敵キャラなどもいるかもしれません。</p>

<p>今回は、敵のHPを最も削ることができるスキルを選ぶことにしましょう。<code>B.</code> でスキルを適用したので、変数 <code>clone</code> の表す敵キャラクターはHPが減っているはずです。そこで、HPの正負を逆転したものをそのまま、そのスキルの優先度としましょう（HPが大きいほど、優先度が下がりますからね）。そして、優先度が最も高いスキルを最後に選ぶのです。</p>

<p>変数 <code>canndidate</code> に、最も高かった優先度とその時のスキルを記録しておき、最後に残ったスキルが最も優先度の高いスキルとなりますので、それがAIの計算結果となります。</p>

<h2>
<span id="aiの呼び出し側" class="fragment"></span><a href="#ai%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E5%81%B4"><i class="fa fa-link"></i></a>AIの呼び出し側</h2>

<p><code>PlayerBattler</code> クラスを以下のように書き換えましょう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">PlayerBattler.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">PlayerBattler</span> <span class="p">:</span> <span class="n">Battler</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">Skill</span><span class="p">[]</span> <span class="n">Skills</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="n">PlayerAi</span> <span class="n">ai</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">PlayerBattler</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">ai</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PlayerAi</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Act</span><span class="p">(</span><span class="n">BattleContext</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">skill</span> <span class="p">=</span> <span class="n">ai</span><span class="p">.</span><span class="nf">DetermineSkill</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">Skills</span><span class="p">);</span>
        <span class="n">skill</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">context</span><span class="p">.</span><span class="n">Enemy</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><code>PlayerBattler</code> は <code>PlayerAi</code> を持ち、使うスキルを決定したいときはこのクラスに依頼します。スキルを発動する部分はほぼ今まで通りですが、前もって決まったスキルを選ぶのではなくAIから返ってきたスキルを呼び出す、という点は今までと異なります。</p>

<h2>
<span id="新しいaiを実行" class="fragment"></span><a href="#%E6%96%B0%E3%81%97%E3%81%84ai%E3%82%92%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>新しいAIを実行</h2>

<p>新しいAIを搭載した <code>PlayerBattler</code> を戦わせてみましょう。対戦相手を <code>enemy1</code> にして実行してみます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>レイヤーのHP:100
敵のHP:45
あなたは狙いを定めて敵を撃ちぬいた！
敵に62のダメージ！
あなたは敵の体へ銃を3連射した！
敵に 14 のダメージ！
敵に 14 のダメージ！
敵に 14 のダメージ！
あなたは狙いを定めて敵を撃ちぬいた！
敵に62のダメージ！
敵は倒れた！
プレイヤーの勝ち
</code></pre></div></div>

<p>……何かがおかしい気がしますが、最終的にはAIが「1回攻撃」を選択し、敵を倒すことができました。次は対戦相手を <code>enemy2</code> にしてみましょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>プレイヤーのHP:100
敵のHP:100
あなたは狙いを定めて敵を撃ちぬいた！
敵に87のダメージ！
あなたは敵の体へ銃を3連射した！
敵に 39 のダメージ！
敵に 39 のダメージ！
敵に 39 のダメージ！
あなたは敵の体へ銃を3連射した！
敵に 39 のダメージ！
敵に 39 のダメージ！
敵に 39 のダメージ！
敵は倒れた！
プレイヤーの勝ち
</code></pre></div></div>

<p>今度は敵の防御力に合わせて「3回攻撃」を選びました。確かに、戦況が最も良くなるスキルを選ぶことができているようです。余裕があれば、新しい対戦相手を追加してみると面白いです。HPが高すぎて倒しきれない相手であっても、可能な限りHPをたくさん削れるスキルを選ぶはずです。</p>

<h2>
<span id="aiの実行中にメッセージが表示されてしまう" class="fragment"></span><a href="#ai%E3%81%AE%E5%AE%9F%E8%A1%8C%E4%B8%AD%E3%81%AB%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%8C%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86"><i class="fa fa-link"></i></a>AIの実行中にメッセージが表示されてしまう</h2>

<p>もうお気づきかもしれませんが、ここまでの実装だと、スキルのシミュレーション中にメッセージが表示されてしまいます。先ほどの例では、良く見ると1回行動するためにスキル3回ぶんのメッセージが表示されてしまっているのが分かると思います。全てのスキルを試しているので、スキルが2個あればメッセージはスキル(2+1)回ぶん表示されてしまうわけです。</p>

<p>この問題を回避するためには、メッセージの表示先を切り替えられるようにする必要があります。そして、「コンソールに表示する」モードと、「どこにも表示しない」モードを用意したいところです。今回の例だと主な表示先がコンソールでしたが、美麗なグラフィックのコンシューマーゲームだったとしても、スキルのキラキラしたエフェクトがシミュレーション中に全種類再生されたらカッコ悪いですから、やはり「どこにも表示しない」モードは必要になります。</p>

<p>表示先を切り替える機能は、インターフェースを用いたテクニックによってシンプルに実装できます。</p>

<h2>
<span id="メッセージの表示先を差し替えられるようにしよう" class="fragment"></span><a href="#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE%E8%A1%A8%E7%A4%BA%E5%85%88%E3%82%92%E5%B7%AE%E3%81%97%E6%9B%BF%E3%81%88%E3%82%89%E3%82%8C%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>メッセージの表示先を差し替えられるようにしよう</h2>

<p>インターフェースを用いたやり方を紹介する前に、フラグやメソッドを用いた実装方法について考えてみましょう。</p>

<h3>
<span id="フラグを使った方法はどうか" class="fragment"></span><a href="#%E3%83%95%E3%83%A9%E3%82%B0%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%96%B9%E6%B3%95%E3%81%AF%E3%81%A9%E3%81%86%E3%81%8B"><i class="fa fa-link"></i></a>フラグを使った方法はどうか？</h3>

<p>今のところ、メッセージを画面に表示するためには <code>Console.WriteLine</code> メソッドを使っていますね。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"あなたは狙いを定めて敵を撃ちぬいた！"</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">damage</span> <span class="p">=</span> <span class="n">Power</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">Defense</span><span class="p">;</span>
<span class="n">target</span><span class="p">.</span><span class="n">Hp</span> <span class="p">-=</span> <span class="n">damage</span><span class="p">;</span>
<span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"敵に</span><span class="p">{</span><span class="n">damage</span><span class="p">}</span><span class="s">のダメージ！"</span><span class="p">);</span>
</code></pre></div></div>

<p>これから実装したい「モード切り替え」機能はどのように実装するとよいでしょうか？試しに、<code>bool</code>型のフラグを1つ用意して、<code>true</code>のときはコンソールに表示し、<code>false</code>のときはどこにも表示しない、と決めたとするとどうなるでしょうか？そのフラグ <code>IsShown</code> は、バトル中のどこからでもアクセスできるつもりのオブジェクト <code>BattleContext</code> に持たせるとよいでしょう。すると、メッセージを表示する部分は以下のようになります:</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">IsShown</span><span class="p">)</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"あなたは狙いを定めて敵を撃ちぬいた！"</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">damage</span> <span class="p">=</span> <span class="n">Power</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">Defense</span><span class="p">;</span>
<span class="n">target</span><span class="p">.</span><span class="n">Hp</span> <span class="p">-=</span> <span class="n">damage</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">IsShown</span><span class="p">)</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"敵に</span><span class="p">{</span><span class="n">damage</span><span class="p">}</span><span class="s">のダメージ！"</span><span class="p">);</span>
</code></pre></div></div>

<p><code>Console.WriteLine</code> を呼び出すかどうかを、 <code>BattleContext.IsShown</code> フラグの状態によって分岐しています。しかしこの方法だと、 <code>Console.WriteLine</code> を呼び出す部分全てでif文を追加しなければなりません。これをゲームの完成までずっと、必ず忘れずに続けるのはなかなかに苦痛です。</p>

<h3>
<span id="メソッドを使った方法" class="fragment"></span><a href="#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>メソッドを使った方法</h3>

<p>先ほどのフラグを使った方法では、if文で分岐をするという処理が繰り返し登場していました。繰り返し登場する処理をメソッドによって共通化するというのはよい考えです。そのメソッドを <code>BattleContext</code> クラスに足してみるとどうなるでしょう。そのメソッドは以下のようなものです：</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">BattleContext.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// 前略</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Talk</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// isShownというprivateフィールドをBattleContextに追加しておく。</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isShown</span><span class="p">)</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
    <span class="p">}</span>
<span class="c1">// 後略</span>
</code></pre></div>
</div>

<p>呼び出し側は以下のようになります：</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">context</span><span class="p">.</span><span class="nf">Talk</span><span class="p">(</span><span class="s">"あなたは狙いを定めて敵を撃ちぬいた！"</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">damage</span> <span class="p">=</span> <span class="n">Power</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">Defense</span><span class="p">;</span>
<span class="n">target</span><span class="p">.</span><span class="n">Hp</span> <span class="p">-=</span> <span class="n">damage</span><span class="p">;</span>
<span class="n">context</span><span class="p">.</span><span class="nf">Talk</span><span class="p">(</span><span class="s">$"敵に</span><span class="p">{</span><span class="n">damage</span><span class="p">}</span><span class="s">のダメージ！"</span><span class="p">);</span>
</code></pre></div></div>

<p>なかなかすっきりした記述になりましたね。これなら面倒がらずに書くことができそうです。</p>

<p>しかしこの書き方にも問題はあります。 <code>BattleContext</code> は元々、バトルの制御に必要な情報をまとめるのが責務であり、そのためのプロパティが用意されています。そこにこういった実際に何らかの処理を行うメソッドが追加された場合、そのメソッドが元々あったプロパティに不正な値を代入したりしないよう気を付けなければなりません。</p>

<p>今回は単純なメソッドなのでよいかもしれませんが、今後もずっとそうとは限りません。ゲーム開発はどんな仕様が正解なのかがはじめからは定まっていませんから、仕様変更により <code>BattleContext</code> の実装の信頼性が少しづつ不安定になっていくかもしれません。</p>

<h3>
<span id="インターフェースを使った方法" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>インターフェースを使った方法</h3>

<p>インターフェースを使って、メッセージの表示先を <code>Skill</code> 側が意識しなくて済むようにしてみましょう。さしあたっての目標は、以下のようなメソッド呼び出しを：</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"あなたは狙いを定めて敵を撃ちぬいた！"</span><span class="p">);</span>
</code></pre></div></div>

<p>以下のように書き換え、メッセージ データがどのような機能へ流れ着くのかを隠蔽します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// Talkメソッド自体は表示の作業はせず、あくまでどのような機能へデータを流すかを制御するだけ。</span>
<span class="c1">// もはや Console.WriteLine を読んでいるのかどうかを把握することは、呼び出し側の責任ではない</span>
<span class="n">context</span><span class="p">.</span><span class="n">View</span><span class="p">.</span><span class="nf">Talk</span><span class="p">(</span><span class="s">"あなたは狙いを定めて敵を撃ちぬいた！"</span><span class="p">);</span>
</code></pre></div></div>

<p>そのようなインターフェースとして、以下のようなものを定義します。これが「メッセージを表示する機能」を表すインターフェースとなります。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IView.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">interface</span> <span class="nc">IView</span>
<span class="p">{</span>
    <span class="k">void</span> <span class="nf">Talk</span><span class="p">(</span><span class="kt">string</span> <span class="n">text</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>その実装……つまり「特定の方法でメッセージを表示するクラス」は、「コンソールに表示する」モードと「どこにも表示しない」モードの2つのためのクラスが必要です。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ConsoleView.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// コンソールに表示するモード</span>
<span class="k">class</span> <span class="nc">ConsoleView</span> <span class="p">:</span> <span class="n">IView</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Talk</span><span class="p">(</span><span class="kt">string</span> <span class="n">text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NullView.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// どこにも表示しないモード</span>
<span class="k">class</span> <span class="nc">NullView</span> <span class="p">:</span> <span class="n">IView</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Talk</span><span class="p">(</span><span class="kt">string</span> <span class="n">text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 何もしない</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><code>IView</code> インターフェースを実装するオブジェクトは、 <code>BattleContext</code> クラスに持たせることで、バトルの制御コード内のどこからでもアクセスできるようにしましょう。 <code>BattleContext</code> はあくまで情報をまとめる以外の責任は持たず、何か管轄外の要求が来た場合は <code>View</code> プロパティに設定されたオブジェクトに丸投げするつもりです。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">BattleContext.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">BattleContext</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">EnemyBattler</span> <span class="n">Enemy</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">PlayerBattler</span> <span class="n">Player</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">IView</span> <span class="n">View</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="c1">// コンストラクター引数から受け取って、読み取り専用プロパティに設定する</span>
    <span class="c1">// View プロパティの内容を後から書き換えることのない設計にするつもりのため</span>
    <span class="k">public</span> <span class="nf">BattleContext</span><span class="p">(</span><span class="n">IView</span> <span class="n">view</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">View</span> <span class="p">=</span> <span class="n">view</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>そして、 <code>Program.cs</code> で <code>BattleContext</code> を生成している部分を書き換えます。<code>IView</code> を実装するオブジェクトとして、 <code>ConsoleView</code> を生成して渡してあげます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Program.cs(変更前)</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// 前略</span>
<span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BattleContext</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Enemy</span> <span class="p">=</span> <span class="n">enemy1</span><span class="p">,</span>
    <span class="n">Player</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PlayerBattler</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Hp</span> <span class="p">=</span> <span class="m">100</span><span class="p">,</span>
        <span class="n">Defense</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
        <span class="n">Skills</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Skill</span><span class="p">[]</span>
        <span class="p">{</span>
            <span class="k">new</span> <span class="nf">SingleAttackSkill</span><span class="p">(</span><span class="m">87</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">TripleAttackSkill</span><span class="p">(</span><span class="m">39</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="c1">// 後略</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Program.cs(変更後)</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// 前略</span>
<span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BattleContext</span><span class="p">(</span><span class="k">new</span> <span class="nf">ConsoleView</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">Enemy</span> <span class="p">=</span> <span class="n">enemy2</span><span class="p">,</span>
    <span class="n">Player</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PlayerBattler</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Hp</span> <span class="p">=</span> <span class="m">100</span><span class="p">,</span>
        <span class="n">Defense</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
        <span class="n">Skills</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Skill</span><span class="p">[]</span>
        <span class="p">{</span>
            <span class="k">new</span> <span class="nf">SingleAttackSkill</span><span class="p">(</span><span class="m">87</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">TripleAttackSkill</span><span class="p">(</span><span class="m">39</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="c1">// 後略</span>
</code></pre></div>
</div>

<p>この後は、<code>Console.WriteLine</code> を呼び出している部分を <code>context.View.Talk</code> に置き換えていく作業となります。スキルの発動に関係ない部分でも全て置き換えておくことをお勧めしますし、今回は全て置き換えた場合で説明します。</p>

<p>なかなか大変な作業ですし、実際の開発ではこういう仕様変更が起きる可能性を考えて前もってインターフェースを用いて差し替えられるようにしておくと良いかもしれません。そうすると良いのは、今回必要になったモードの他にもたとえば「iPhoneで動かすためのモード」「ゲームエンジンを用いてグラフィカルに表示するモード」などの様々な新しい要求が起きても対応できることです。</p>

<p>さて、ここまでの作業だと、動作は何も変わらないはずです。実行してみましょう（このようなリファクタリング作業では、動作が変わっていないことの確認は重要です）：</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>プレイヤーのHP:100
敵のHP:100
あなたは狙いを定めて敵を撃ちぬいた！
敵に87のダメージ！
あなたは敵の体へ銃を3連射した！
敵に 39 のダメージ！
敵に 39 のダメージ！
敵に 39 のダメージ！
あなたは敵の体へ銃を3連射した！
敵に 39 のダメージ！
敵に 39 のダメージ！
敵に 39 のダメージ！
敵は倒れた！
プレイヤーの勝ち
</code></pre></div></div>

<p>次に、<code>BattleContext</code>を生成するときに <code>NullView</code> を渡すようにしてみましょう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Program.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// 前略</span>
<span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BattleContext</span><span class="p">(</span><span class="k">new</span> <span class="nf">NullView</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">Enemy</span> <span class="p">=</span> <span class="n">enemy2</span><span class="p">,</span>
    <span class="n">Player</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PlayerBattler</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Hp</span> <span class="p">=</span> <span class="m">100</span><span class="p">,</span>
        <span class="n">Defense</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
        <span class="n">Skills</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Skill</span><span class="p">[]</span>
        <span class="p">{</span>
            <span class="k">new</span> <span class="nf">SingleAttackSkill</span><span class="p">(</span><span class="m">87</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">TripleAttackSkill</span><span class="p">(</span><span class="m">39</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="c1">// 後略</span>
</code></pre></div>
</div>

<p>すると、今度は実行しても画面には何も表示しなくなるはずです。</p>

<p>これで下準備ができました。今度は、スキルのシミュレーション中は画面に何も表示せず、実際に発動するときにはちゃんと表示をするようにしたいところです。</p>

<p>この要求を満たすために修正した <code>PlayerAi</code> クラスは以下のようになります：</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">PlayerAi.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">PlayerAi</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">Skill</span> <span class="nf">DetermineSkill</span><span class="p">(</span><span class="n">BattleContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Skill</span><span class="p">[]</span> <span class="n">skills</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">(</span><span class="n">Skill</span><span class="p">,</span> <span class="kt">int</span> <span class="n">priority</span><span class="p">)</span> <span class="n">candidate</span> <span class="p">=</span> <span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="p">-</span><span class="n">context</span><span class="p">.</span><span class="n">Enemy</span><span class="p">.</span><span class="n">Hp</span><span class="p">);</span>

        <span class="c1">// *修正* シミュレーション中に発動するスキルのメッセージを表示しないようにするためのクローン</span>
        <span class="kt">var</span> <span class="n">cloneContext</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BattleContext</span><span class="p">(</span><span class="k">new</span> <span class="nf">NullView</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">Enemy</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Enemy</span><span class="p">,</span>
            <span class="n">Player</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Player</span>
        <span class="p">};</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">skill</span> <span class="k">in</span> <span class="n">skills</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// シミュレーション中に敵が受けるダメージを実際には反映しないためのクローン</span>
            <span class="c1">// 割愛しているが、実際はプレイヤーのクローンも生成しておいたり、</span>
            <span class="c1">// 敵のクローンはBattleContext.Enemyなどにもsetしておいたほうが</span>
            <span class="c1">// 独特なスキルをたくさん実装する際に安全</span>
            <span class="kt">var</span> <span class="n">clone</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EnemyBattler</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Hp</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Enemy</span><span class="p">.</span><span class="n">Hp</span><span class="p">,</span>
                <span class="n">Defense</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Enemy</span><span class="p">.</span><span class="n">Defense</span>
            <span class="p">};</span>

            <span class="c1">// *修正* BattleContext を渡す場所には、メインの BattleContext ではなく</span>
            <span class="c1">// NullView を持たせてあるクローンのほうの BattleContext を渡す</span>
            <span class="n">skill</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="n">cloneContext</span><span class="p">,</span> <span class="n">clone</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">priority</span> <span class="p">=</span> <span class="p">-</span><span class="n">clone</span><span class="p">.</span><span class="n">Hp</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">candidate</span><span class="p">.</span><span class="n">priority</span> <span class="p">&lt;</span> <span class="n">priority</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">candidate</span> <span class="p">=</span> <span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">priority</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">candidate</span><span class="p">.</span><span class="n">Item1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>今回は、 <code>EnemyBattler</code> だけでなく <code>BattleContext</code> のクローンも作成しています。 <code>BattleContext.Enemy</code> プロパティと <code>BattleContext.Player</code> プロパティの中身は元々の <code>BattleContext</code> の中身を雑に代入していますが、これはクローンになっていないので、このプロパティを経由してHPを変更したりすると元々の <code>BattleContext</code> に影響が出てしまいます。実際には全てのメンバーについて、その子のメンバー、孫のメンバーというふうに再帰的に潜って完全に切り離されたクローンを作るべきです。</p>

<p>そして、シミュレーションのためにスキルを実行する際には、元々の <code>BattleContext</code> ではなく、 <code>NullView</code> を持たせてあるクローンの方を渡す必要があります。こうすることによって、スキルのシミュレーションをする時に限って画面への表示を禁止することができます。</p>

<p>さあ、この状態で実行してみましょう。対戦相手が <code>enemy2</code> ならば、次のようになるはずです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>プレイヤーのHP:100
敵のHP:100
あなたは敵の体へ銃を3連射した！
敵に 39 のダメージ！
敵に 39 のダメージ！
敵に 39 のダメージ！
敵は倒れた！
プレイヤーの勝ち
</code></pre></div></div>

<p>きちんと適切なスキルを選べていますし、しかもシミュレーション中にスキルを実際に試していることはバレずに済んでいます！お疲れさまでした。</p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<h3>
<span id="総当たりのaiも悪くない" class="fragment"></span><a href="#%E7%B7%8F%E5%BD%93%E3%81%9F%E3%82%8A%E3%81%AEai%E3%82%82%E6%82%AA%E3%81%8F%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>総当たりのAIも悪くない</h3>

<p>RPGなどにおけるゲームAIを作る際、全てのパターンを試してみる、というのは悪くない方法です。いわゆる「総当たり」というやつです。この方法の問題点は最終的なスキルを決定するまでに時間がかかることですが、それが顕著になるパターンもいくつか考えられます：</p>

<ul>
<li>スキルの個数が数十個にも及ぶ場合</li>
<li>スキルの効果が膨大な数の条件に応じて変動する場合</li>
<li>何回も連続で行動でき、スキルを使う順番によっても戦況が大きく変わる場合

<ul>
<li>スキルが2個で行動回数2回だったとしても、「使うか使わないか」「順番」によって6パターン試さなければなりません</li>
</ul>
</li>
</ul>

<p>そのような状態に陥った時には、私の場合は次に、行動パターンをランダムに打ち切る方法を使います。一部のスキルをランダムに、「評価する価値もなく不採用だ」と見なして切り捨てることで、シミュレーションの手間を省きます。時折、非常に強力なスキルを使うのを不意に諦めてしまって妙な感じになるかもしれませんが、強すぎるAIにするとゲームにならないですし、最強のスキルをひたすら撃つ敵ばかりになるとつまらないので、容認することにしています。</p>

<p>他にも色々な最適化方法があるかと思いますが、総当たりの手法を改善して効率的にしたものを使う、という発想はやはり有効と考えています。</p>

<h3>
<span id="インターフェースを使おう" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E3%81%8A%E3%81%86"><i class="fa fa-link"></i></a>インターフェースを使おう</h3>

<p>特定の処理を後で差し替えられるようにしたいとき、インターフェースを用いるのはよい方法です。特に今回は、メソッドに切り出して共通化するだけでも実現できましたが、後々の保守のことも考えてあえてインターフェースを用いた切り出し方にしました。それはなぜかというと、 <code>BattleContext</code> に元々あった機能と、新たに追加された機能のあいだの相互作用に気を配らなければならない可能性を排除するためでした。</p>

<p>インターフェースに切り出す作業をすることには、他にも様々な狙いがあります。詳しくは、「SOLID原則」について調べてみてください。</p>

<h2>
<span id="余談決め打ちのaiという手段もあり" class="fragment"></span><a href="#%E4%BD%99%E8%AB%87%E6%B1%BA%E3%82%81%E6%89%93%E3%81%A1%E3%81%AEai%E3%81%A8%E3%81%84%E3%81%86%E6%89%8B%E6%AE%B5%E3%82%82%E3%81%82%E3%82%8A"><i class="fa fa-link"></i></a>余談：決め打ちのAIという手段もあり</h2>

<p>今回紹介したAIの実装はとても汎用的なもので、どんなスキルを用意しても評価方法を準備しておけば、適切なスキルを選ぶことができます。一方で、これから私たちが作ろうとしているゲームは、そんなに複雑なスキルがたくさん登場しないかもしれません。そういったときは、敵キャラクターごとに決まったルールでスキルを選ぶようにしてもよいでしょう。たとえば：</p>

<ul>
<li>Nターン目は必ず決まったスキルを選ぶ</li>
<li>HPが半分以下になったターンだけは通常と違う固定のスキルを選ぶ</li>
<li>スキルを1つしか持たないので、必ずそれを使う</li>
</ul>

<p>この方法はシンプルなだけでなく、ゲームデザインがしやすい長所もあります。今回紹介した方法は、「Nターン目は必ず決まったスキルを選ぶ」のような柔軟な行動パターンを作るためには更にひと手間がいる特徴があります。</p>

<p>皆さんのゲームデザインに合ったAIを作ってみてください。</p>

<h2>
<span id="おわり" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A"><i class="fa fa-link"></i></a>おわり</h2>

<p>みんなもRPGつくろうね！</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2FNumAniCloud%2Fitems%2F75f7253483b685d0d7b0&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2FNumAniCloud%2Fitems%2F75f7253483b685d0d7b0&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/NumAniCloud/items/75f7253483b685d0d7b0/likers" class="css-1iupg5d">17</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">16</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/75f7253483b685d0d7b0/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/NumAniCloud/items/75f7253483b685d0d7b0/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/NumAniCloud/items/75f7253483b685d0d7b0/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/NumAniCloud/items/75f7253483b685d0d7b0/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/NumAniCloud/items/75f7253483b685d0d7b0.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-4a4fe841-c63e-468a-b02d-b499c494c48f">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-2e0dcc82-cd77-4e3f-ae97-ca09095dca56"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-2e0dcc82-cd77-4e3f-ae97-ca09095dca56">{}</script>
      
<div id="LoginModal-react-component-cb560159-a725-487c-91f9-1dfe4a45cfa2"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-cb560159-a725-487c-91f9-1dfe4a45cfa2">{}</script>
      
<div id="StockModal-react-component-0b943400-2da1-4675-94bd-77308abddd8a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-0b943400-2da1-4675-94bd-77308abddd8a">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;nBgk6idTz/JDzGvcv/jlwx86XL7Iitfox3KgNXQFMUviPEQO50aHk9YEZARQfOMbD/WYv081PyeLfSN48tEQEw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003eこの記事は \u003ca href=\"https://qiita.com/advent-calendar/2019/c-sharp\"\u003eC# Advent Calendar 2019\u003c/a\u003e の1日目です。\u003c/p\u003e\n\n\u003cp\u003e私はRPGを作るのが大好きです。特に、ちょっと複雑な効果を持ったユニークなスキルを実装するのが好きです。しかし、そういったスキルを敵に使わせる時には悩ましい問題があります。\u003c/p\u003e\n\n\u003cp\u003e「攻撃力の高いスキル」と「自分のHPを回復するスキル」があったとして、どちらを使うと良いでしょうか？それは場合によります。1撃でライバルを倒せるならば前者ですし、逆に自分が1撃で倒れそうなら後者かもしれません。\u003c/p\u003e\n\n\u003cp\u003e実際にゲームシステムを組みながら、AIをどのような発想で実装するとよいか、その際にプログラムの設計で気を付けることなどを紹介します。オブジェクト指向などの設計のための参考にしていただければ幸いです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ゲームシステム\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eゲームシステム\u003c/h2\u003e\n\n\u003cp\u003e今回実装するゲームは以下のようなシステムです：\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eプレイヤー1体と敵1体がいて、お互いに相手のHPが0になることを目指す\u003c/li\u003e\n\u003cli\u003eプレイヤーと敵は1ラウンドに一回行動できる。\u003c/li\u003e\n\u003cli\u003eプレイヤーはAIによって自動で行動する。\u003c/li\u003e\n\u003cli\u003e敵は固定の行動しかとらない。\u003c/li\u003e\n\u003cli\u003eプレイヤーは複数のスキルから何らかの手段でスキルを選んで使用できる。\u003c/li\u003e\n\u003cli\u003eスキルには攻撃力が、戦闘参加者には防御力がある。\n\n\u003cul\u003e\n\u003cli\u003e(ダメージ) = (攻撃力) - (防御力)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e決着がつくとプログラムは終了する。\u003c/li\u003e\n\u003cli\u003e戦闘の様子はコンソール ウィンドウに出力される。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eユーザーが操作できる部分すらなく寂しい感じですが、今回はAIを実装したいだけなのでバッサリ割愛しました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"下準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%8B%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e下準備\u003c/h2\u003e\n\n\u003cp\u003eまずはゲームの全体の流れを作成します。\u003cbr\u003e\nつまり、バトルの参加者に関する情報の初期化や、\u003cbr\u003e\nゲームの勝利条件の判定などのことです。\u003c/p\u003e\n\n\u003cp\u003eまだ定義していないクラスが多数登場しますので、この後ひとつづつ実装していきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eProgram.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// HPが低いが防御が高い敵と、HPが高く防御が低い敵を作成\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// BattleContext.Enemy にどちらを渡すかによって、対戦相手を差し替えることができる\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eenemy1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnemyBattler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e45\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDefense\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e25\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eenemy2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnemyBattler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDefense\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// バトルの制御全体にわたって必要になる情報を保持するクラス\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBattleContext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eenemy1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePlayerBattler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eDefense\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eSkills\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSingleAttackSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e87\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// ここでスキルの攻撃力を設定\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTripleAttackSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e39\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// ここでスキルの攻撃力を設定\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"プレイヤーのHP:\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"敵のHP:\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"敵は倒れた！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"プレイヤーの勝ち\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"プレイヤーは倒れた！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"敵の勝ち\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e次に定義するのは、バトル全体にわたって必要になる機能をまとめる \u003ccode\u003eBattleContext\u003c/code\u003e クラスです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eBattleContext.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBattleContext\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eEnemyBattler\u003c/span\u003e \u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayerBattler\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e独特で多様なスキルをたくさん作るためにも、戦況に関わる情報はなるべくどこからでも書き換えできるように、 \u003ccode\u003eBattleContext\u003c/code\u003e のプロパティに押し込めて様々なクラスに受け渡します。敵とプレイヤーの情報が同時に必要になる場面はいくらかあるので、こうして固めておいて、メソッドの引数の定義が簡潔になることを狙っています（パラメータ オブジェクトといいます）。\u003c/p\u003e\n\n\u003cp\u003e次は、バトルの主役である \u003ccode\u003eEnemyBattler\u003c/code\u003e, \u003ccode\u003ePlayerBattler\u003c/code\u003e を定義します。まずはそれらの基底クラスとして、敵にもプレイヤーにもあるHPと防御力を持たせた \u003ccode\u003eBattler\u003c/code\u003e クラスを定義します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eBattler.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBattler\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eDefense\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eそして、 \u003ccode\u003eEnemyBattler\u003c/code\u003e クラスを定義します。このクラスは、ターンが回ってきたときの行動を実行する \u003ccode\u003eAct\u003c/code\u003e メソッドを持ちます。敵のAIとして、プレイヤーに対して119の固定ダメージを及ぼす攻撃をさせることにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eEnemyBattler.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eEnemyBattler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eBattler\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBattleContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"敵の攻撃\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"プレイヤーに 119 のダメージ\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e-=\u003c/span\u003e \u003cspan class=\"m\"\u003e119\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eつぎに \u003ccode\u003ePlayerBattler\u003c/code\u003e クラスを定義します。このクラスも敵と同じ役割である \u003ccode\u003eAct\u003c/code\u003e メソッドを持ちますが、行動内容としてスキルを適当に選び、実行します。今回は、持っているスキルから先頭のものを必ず使うようにしましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePlayerBattler.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ePlayerBattler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eBattler\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eSkills\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBattleContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSkills\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e詳しくは前述の \u003ccode\u003eProgram.cs\u003c/code\u003e に書かれていますが、スキルの配列には次のものを決め打ちで渡します：\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e0番目は一回攻撃のスキルで、威力87\u003c/li\u003e\n\u003cli\u003e1番目は三回攻撃のスキルで、威力39\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eスキルとは、次のようなクラスです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSkill.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSkill\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBattleContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBattler\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eSkill\u003c/code\u003e には、 \u003ccode\u003eSingleAttackSkill\u003c/code\u003e, \u003ccode\u003eTripleAttackSkill\u003c/code\u003e という2つのバリエーションがあります。 \u003ccode\u003eSingleAttackSkill\u003c/code\u003e は、敵に一回だけ攻撃するスキルです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSingleAttackSkill.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003esealed\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSingleAttackSkill\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSkill\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ePower\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSingleAttackSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003epower\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePower\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epower\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBattleContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBattler\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"あなたは狙いを定めて敵を撃ちぬいた！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edamage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePower\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefense\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e    \u003cspan class=\"c1\"\u003e// ダメージ計算\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e-=\u003c/span\u003e \u003cspan class=\"n\"\u003edamage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e                    \u003cspan class=\"c1\"\u003e// 実際にHPを減らす\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"敵に\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003edamage\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eのダメージ！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eTripleAttackSkill\u003c/code\u003e は、敵に3回連続で攻撃するスキルです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eTripleAttackSkill.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003esealed\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTripleAttackSkill\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSkill\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ePower\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eTripleAttackSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003epower\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePower\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epower\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBattleContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBattler\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"あなたは敵の体へ銃を3連射した！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esingleDamage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePower\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefense\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// ダメージ計算\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e-=\u003c/span\u003e \u003cspan class=\"n\"\u003esingleDamage\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e              \u003cspan class=\"c1\"\u003e// 実際にHPを減らす\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"敵に \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003esingleDamage\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e のダメージ！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"敵に \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003esingleDamage\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e のダメージ！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"敵に \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003esingleDamage\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e のダメージ！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ひとまず実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%B2%E3%81%A8%E3%81%BE%E3%81%9A%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eひとまず実行\u003c/h2\u003e\n\n\u003cp\u003e上記のサンプルでは、 \u003ccode\u003eBattleContext.Enemy\u003c/code\u003e プロパティに \u003ccode\u003eenemy1\u003c/code\u003e 変数の内容を設定してあります。このまま実行すると次のようになります：\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eプレイヤーのHP:100\n敵のHP:45\nあなたは狙いを定めて敵を撃ちぬいた！\n敵に62のダメージ！\n敵は倒れた！\nプレイヤーの勝ち\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e用意した一回攻撃のスキルは威力が\u003ccode\u003e87\u003c/code\u003eで、敵の防御力によって\u003ccode\u003e25\u003c/code\u003e軽減されましたが、それでも敵のHP\u003ccode\u003e45\u003c/code\u003eを超えるダメージを与えて倒すことができました。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eBattleContext.Enemy\u003c/code\u003e プロパティに \u003ccode\u003eenemy2\u003c/code\u003e 変数の内容を代入するように書き換えてみてください。それを実行すると次のようになります：\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eプレイヤーのHP:100\n敵のHP:100\nあなたは狙いを定めて敵を撃ちぬいた！\n敵に87のダメージ！\n敵の攻撃\nプレイヤーに 119 のダメージ\nプレイヤーは倒れた！\n敵の勝ち\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e用意した一回攻撃のスキルは威力が\u003ccode\u003e87\u003c/code\u003eで、敵の防御力は\u003ccode\u003e0\u003c/code\u003eなのでダメージは減りませんでしたが、それでも敵のHP\u003ccode\u003e100\u003c/code\u003eを超えるダメージを与えられなかったので倒しきれず、反撃でやられてしまいました。\u003c/p\u003e\n\n\u003cp\u003eそこで、\u003ccode\u003ePlayerBattler\u003c/code\u003e の選択するスキルを0番目のスキルではなく1番目のスキルに変えてみるとどうでしょうか。書き換える場所は、 \u003ccode\u003ePlayerBattler.cs\u003c/code\u003e の \u003ccode\u003eAct\u003c/code\u003e メソッドの中です。1番目のスキルには「三回攻撃」が割り当てられているはずです。これで実行してみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eプレイヤーのHP:100\n敵のHP:100\nあなたは敵の体へ銃を3連射した！\n敵に 39 のダメージ！\n敵に 39 のダメージ！\n敵に 39 のダメージ！\n敵は倒れた！\nプレイヤーの勝ち\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e敵に\u003ccode\u003e39*3\u003c/code\u003eのダメージを与え、これはHP\u003ccode\u003e100\u003c/code\u003eを超えているので倒すことができました。\u003c/p\u003e\n\n\u003cp\u003eしかし、いつも三回攻撃のスキルを選べば良いわけではありませんよね。対戦相手を \u003ccode\u003eenemy1\u003c/code\u003e に戻すと次のような結果になります：\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eプレイヤーのHP:100\n敵のHP:45\nあなたは敵の体へ銃を3連射した！\n敵に 14 のダメージ！\n敵に 14 のダメージ！\n敵に 14 のダメージ！\n敵の攻撃\nプレイヤーに 119 のダメージ\nプレイヤーは倒れた！\n敵の勝ち\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e三回攻撃スキルは一回のダメージが\u003ccode\u003e39\u003c/code\u003eですが、敵の防御力\u003ccode\u003e15\u003c/code\u003eにより軽減され、ダメージは\u003ccode\u003e14*3=42\u003c/code\u003eしか与えられませんでした。これだとHP\u003ccode\u003e45\u003c/code\u003eを削り切れないので、反撃でやられてしまいました。\u003c/p\u003e\n\n\u003cp\u003eこうなるようにルールを作ったので、プレイヤーは適切なスキルを考えて選択する必要があるわけです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"aiにやらせたいよね\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ai%E3%81%AB%E3%82%84%E3%82%89%E3%81%9B%E3%81%9F%E3%81%84%E3%82%88%E3%81%AD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAIにやらせたいよね\u003c/h2\u003e\n\n\u003cp\u003eでも、このように適切なスキルを選ばなければならないのは敵も同じです。敵キャラクターの行動はプレイヤーに選択させるわけにはいかないため、AIでスキルを決定する必要があるはずです。さて、AIに適切なスキルを選ばせるためにはどうすればよいのでしょうか？\u003c/p\u003e\n\n\u003cp\u003e攻撃力が高いスキルを選ぶのがよいでしょうか？でも、攻撃回数が多くて攻撃力の低いスキルの方が強いかもしれません。もしかしたら自分に攻撃力アップの状態変化がついているかもしれませんし、ほかにも、このターンは攻撃せずに敵に毒状態などを与えた方がいいのかもしれません。どんなスキルもシンプルな考え方で評価できる方法はないでしょうか？\u003c/p\u003e\n\n\u003cp\u003e今回紹介するのは、すべてのスキルに対して、それを使った結果をシミュレーションし、攻撃結果だけを評価する方法です。サンプルプログラムでは、敵側ではなくプレイヤーキャラクターが自動で適切なスキルを選ぶことができるAIを作ってみましょう（それはプレイヤーキャラクターとは言わない気がしますが悪しからず）。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"スキルをシミュレーションするai\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E3%82%B7%E3%83%9F%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%99%E3%82%8Bai\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスキルをシミュレーションするAI\u003c/h2\u003e\n\n\u003cp\u003e今回紹介する方法では、プレイヤーのAIは次のように実装します。引数として、選択肢となるスキルの配列を渡し、戻り値としてそのスキルの配列の中で最も効果的なものを選んで返します。詳細はこの後すぐ説明します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePlayerAi.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ePlayerAi\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eSkill\u003c/span\u003e \u003cspan class=\"nf\"\u003eDetermineSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBattleContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eskills\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 最も優先度が高い候補を保持する変数。より優先度の高いスキルが現れれば、その都度更新される\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003epriority\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003ecandidate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eskill\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eskills\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// A. シミュレーション中に敵が受けるダメージを実際には反映しないためのクローン\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eclone\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnemyBattler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eDefense\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefense\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// B. スキルを実際に適用してみる\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eskill\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eclone\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// C. スキルの仕様結果を評価する。\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 敵のHPが少ないほど好ましい状況のはず\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003epriority\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eclone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecandidate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epriority\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003epriority\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecandidate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eskill\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epriority\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ecandidate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eItem1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこのコードについて詳しく見てみましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"b-本当にスキルを適用しているだけ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#b-%E6%9C%AC%E5%BD%93%E3%81%AB%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E9%81%A9%E7%94%A8%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%A0%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eB. 本当にスキルを適用しているだけ\u003c/h3\u003e\n\n\u003cp\u003eコメント \u003ccode\u003eB.\u003c/code\u003e のところを見ると、本当にスキルを実行して試していることが分かりますね。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"a-スキルは敵のコピーに対して使用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#a-%E3%82%B9%E3%82%AD%E3%83%AB%E3%81%AF%E6%95%B5%E3%81%AE%E3%82%B3%E3%83%94%E3%83%BC%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eA. スキルは敵のコピーに対して使用する\u003c/h3\u003e\n\n\u003cp\u003eただし、スキルの対象者として本物の \u003ccode\u003eEnemy\u003c/code\u003e を渡すわけにはいきません。そうしてしまうと、使うべきスキルが確定するころには敵キャラクターは全種類のスキルを喰らった後の満身創痍の状態になってしまい、それはこのゲームではルール違反です。ですので、元の \u003ccode\u003eEnemyBattler\u003c/code\u003e のパラメータをコピーした新しい \u003ccode\u003eEnemyBattler\u003c/code\u003e を作成します。この2つは完全に別のオブジェクトですので、コピーの方のHPが書き換わっても元のオブジェクトのHPは書き換わりません。このようなコピーを作ることを「クローンする」といいます。\u003c/p\u003e\n\n\u003cp\u003e「クローン」と「クローンでないもの」の違いは以下のような感じです：\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 元のオブジェクト。\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esource\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnemyBattler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 変数 source を変数 notClone に代入しただけ。クローンじゃない。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// この2つの変数は参照先が同じ\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enotClone\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esource\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// notClone.Hp を書き換えると source.Hp も書き換わってしまう。\u003c/span\u003e\n\u003cspan class=\"n\"\u003enotClone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e99\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 変数 source のメンバー変数の値だけを引き継ぐ新しいオブジェクト。これがクローン。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// この2つの変数は参照先が違う\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eclone\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnemyBattler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// clone.Hp を書き換えても、 source.Hp は書き換わらない。\u003c/span\u003e\n\u003cspan class=\"n\"\u003eclone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e50\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"c-スキルを適用した結果を評価する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c-%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E9%81%A9%E7%94%A8%E3%81%97%E3%81%9F%E7%B5%90%E6%9E%9C%E3%82%92%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC. スキルを適用した結果を評価する\u003c/h3\u003e\n\n\u003cp\u003eスキルを適用したら、実際にどれだけ有効だったかを評価します。最も評価が高かったスキルをAIが実際に使うように制御するわけです。\u003c/p\u003e\n\n\u003cp\u003eスキルがどれだけ有効だったか、その評価基準はゲームのルールに依存します。多くのRPGは相手のHPを最も良く削るものを選ぶでしょうし、ひょっとすると、プレイヤーのお金を盗むことが最優先事項である敵キャラなどもいるかもしれません。\u003c/p\u003e\n\n\u003cp\u003e今回は、敵のHPを最も削ることができるスキルを選ぶことにしましょう。\u003ccode\u003eB.\u003c/code\u003e でスキルを適用したので、変数 \u003ccode\u003eclone\u003c/code\u003e の表す敵キャラクターはHPが減っているはずです。そこで、HPの正負を逆転したものをそのまま、そのスキルの優先度としましょう（HPが大きいほど、優先度が下がりますからね）。そして、優先度が最も高いスキルを最後に選ぶのです。\u003c/p\u003e\n\n\u003cp\u003e変数 \u003ccode\u003ecanndidate\u003c/code\u003e に、最も高かった優先度とその時のスキルを記録しておき、最後に残ったスキルが最も優先度の高いスキルとなりますので、それがAIの計算結果となります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"aiの呼び出し側\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ai%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E5%81%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAIの呼び出し側\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003ePlayerBattler\u003c/code\u003e クラスを以下のように書き換えましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePlayerBattler.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ePlayerBattler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eBattler\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eSkills\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayerAi\u003c/span\u003e \u003cspan class=\"n\"\u003eai\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003ePlayerBattler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eai\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePlayerAi\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBattleContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eskill\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eai\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDetermineSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSkills\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eskill\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003ePlayerBattler\u003c/code\u003e は \u003ccode\u003ePlayerAi\u003c/code\u003e を持ち、使うスキルを決定したいときはこのクラスに依頼します。スキルを発動する部分はほぼ今まで通りですが、前もって決まったスキルを選ぶのではなくAIから返ってきたスキルを呼び出す、という点は今までと異なります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"新しいaiを実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%B0%E3%81%97%E3%81%84ai%E3%82%92%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e新しいAIを実行\u003c/h2\u003e\n\n\u003cp\u003e新しいAIを搭載した \u003ccode\u003ePlayerBattler\u003c/code\u003e を戦わせてみましょう。対戦相手を \u003ccode\u003eenemy1\u003c/code\u003e にして実行してみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eレイヤーのHP:100\n敵のHP:45\nあなたは狙いを定めて敵を撃ちぬいた！\n敵に62のダメージ！\nあなたは敵の体へ銃を3連射した！\n敵に 14 のダメージ！\n敵に 14 のダメージ！\n敵に 14 のダメージ！\nあなたは狙いを定めて敵を撃ちぬいた！\n敵に62のダメージ！\n敵は倒れた！\nプレイヤーの勝ち\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e……何かがおかしい気がしますが、最終的にはAIが「1回攻撃」を選択し、敵を倒すことができました。次は対戦相手を \u003ccode\u003eenemy2\u003c/code\u003e にしてみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eプレイヤーのHP:100\n敵のHP:100\nあなたは狙いを定めて敵を撃ちぬいた！\n敵に87のダメージ！\nあなたは敵の体へ銃を3連射した！\n敵に 39 のダメージ！\n敵に 39 のダメージ！\n敵に 39 のダメージ！\nあなたは敵の体へ銃を3連射した！\n敵に 39 のダメージ！\n敵に 39 のダメージ！\n敵に 39 のダメージ！\n敵は倒れた！\nプレイヤーの勝ち\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e今度は敵の防御力に合わせて「3回攻撃」を選びました。確かに、戦況が最も良くなるスキルを選ぶことができているようです。余裕があれば、新しい対戦相手を追加してみると面白いです。HPが高すぎて倒しきれない相手であっても、可能な限りHPをたくさん削れるスキルを選ぶはずです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"aiの実行中にメッセージが表示されてしまう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ai%E3%81%AE%E5%AE%9F%E8%A1%8C%E4%B8%AD%E3%81%AB%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%8C%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAIの実行中にメッセージが表示されてしまう\u003c/h2\u003e\n\n\u003cp\u003eもうお気づきかもしれませんが、ここまでの実装だと、スキルのシミュレーション中にメッセージが表示されてしまいます。先ほどの例では、良く見ると1回行動するためにスキル3回ぶんのメッセージが表示されてしまっているのが分かると思います。全てのスキルを試しているので、スキルが2個あればメッセージはスキル(2+1)回ぶん表示されてしまうわけです。\u003c/p\u003e\n\n\u003cp\u003eこの問題を回避するためには、メッセージの表示先を切り替えられるようにする必要があります。そして、「コンソールに表示する」モードと、「どこにも表示しない」モードを用意したいところです。今回の例だと主な表示先がコンソールでしたが、美麗なグラフィックのコンシューマーゲームだったとしても、スキルのキラキラしたエフェクトがシミュレーション中に全種類再生されたらカッコ悪いですから、やはり「どこにも表示しない」モードは必要になります。\u003c/p\u003e\n\n\u003cp\u003e表示先を切り替える機能は、インターフェースを用いたテクニックによってシンプルに実装できます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"メッセージの表示先を差し替えられるようにしよう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE%E8%A1%A8%E7%A4%BA%E5%85%88%E3%82%92%E5%B7%AE%E3%81%97%E6%9B%BF%E3%81%88%E3%82%89%E3%82%8C%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%82%88%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメッセージの表示先を差し替えられるようにしよう\u003c/h2\u003e\n\n\u003cp\u003eインターフェースを用いたやり方を紹介する前に、フラグやメソッドを用いた実装方法について考えてみましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"フラグを使った方法はどうか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%83%A9%E3%82%B0%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%96%B9%E6%B3%95%E3%81%AF%E3%81%A9%E3%81%86%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eフラグを使った方法はどうか？\u003c/h3\u003e\n\n\u003cp\u003e今のところ、メッセージを画面に表示するためには \u003ccode\u003eConsole.WriteLine\u003c/code\u003e メソッドを使っていますね。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"あなたは狙いを定めて敵を撃ちぬいた！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edamage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePower\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefense\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e-=\u003c/span\u003e \u003cspan class=\"n\"\u003edamage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"敵に\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003edamage\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eのダメージ！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれから実装したい「モード切り替え」機能はどのように実装するとよいでしょうか？試しに、\u003ccode\u003ebool\u003c/code\u003e型のフラグを1つ用意して、\u003ccode\u003etrue\u003c/code\u003eのときはコンソールに表示し、\u003ccode\u003efalse\u003c/code\u003eのときはどこにも表示しない、と決めたとするとどうなるでしょうか？そのフラグ \u003ccode\u003eIsShown\u003c/code\u003e は、バトル中のどこからでもアクセスできるつもりのオブジェクト \u003ccode\u003eBattleContext\u003c/code\u003e に持たせるとよいでしょう。すると、メッセージを表示する部分は以下のようになります:\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsShown\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"あなたは狙いを定めて敵を撃ちぬいた！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edamage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePower\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefense\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e-=\u003c/span\u003e \u003cspan class=\"n\"\u003edamage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsShown\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"敵に\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003edamage\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eのダメージ！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eConsole.WriteLine\u003c/code\u003e を呼び出すかどうかを、 \u003ccode\u003eBattleContext.IsShown\u003c/code\u003e フラグの状態によって分岐しています。しかしこの方法だと、 \u003ccode\u003eConsole.WriteLine\u003c/code\u003e を呼び出す部分全てでif文を追加しなければなりません。これをゲームの完成までずっと、必ず忘れずに続けるのはなかなかに苦痛です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"メソッドを使った方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメソッドを使った方法\u003c/h3\u003e\n\n\u003cp\u003e先ほどのフラグを使った方法では、if文で分岐をするという処理が繰り返し登場していました。繰り返し登場する処理をメソッドによって共通化するというのはよい考えです。そのメソッドを \u003ccode\u003eBattleContext\u003c/code\u003e クラスに足してみるとどうなるでしょう。そのメソッドは以下のようなものです：\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eBattleContext.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 前略\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTalk\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// isShownというprivateフィールドをBattleContextに追加しておく。\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eisShown\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 後略\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e呼び出し側は以下のようになります：\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTalk\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"あなたは狙いを定めて敵を撃ちぬいた！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edamage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePower\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefense\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e-=\u003c/span\u003e \u003cspan class=\"n\"\u003edamage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTalk\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"敵に\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003edamage\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eのダメージ！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなかなかすっきりした記述になりましたね。これなら面倒がらずに書くことができそうです。\u003c/p\u003e\n\n\u003cp\u003eしかしこの書き方にも問題はあります。 \u003ccode\u003eBattleContext\u003c/code\u003e は元々、バトルの制御に必要な情報をまとめるのが責務であり、そのためのプロパティが用意されています。そこにこういった実際に何らかの処理を行うメソッドが追加された場合、そのメソッドが元々あったプロパティに不正な値を代入したりしないよう気を付けなければなりません。\u003c/p\u003e\n\n\u003cp\u003e今回は単純なメソッドなのでよいかもしれませんが、今後もずっとそうとは限りません。ゲーム開発はどんな仕様が正解なのかがはじめからは定まっていませんから、仕様変更により \u003ccode\u003eBattleContext\u003c/code\u003e の実装の信頼性が少しづつ不安定になっていくかもしれません。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"インターフェースを使った方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eインターフェースを使った方法\u003c/h3\u003e\n\n\u003cp\u003eインターフェースを使って、メッセージの表示先を \u003ccode\u003eSkill\u003c/code\u003e 側が意識しなくて済むようにしてみましょう。さしあたっての目標は、以下のようなメソッド呼び出しを：\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"あなたは狙いを定めて敵を撃ちぬいた！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e以下のように書き換え、メッセージ データがどのような機能へ流れ着くのかを隠蔽します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Talkメソッド自体は表示の作業はせず、あくまでどのような機能へデータを流すかを制御するだけ。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// もはや Console.WriteLine を読んでいるのかどうかを把握することは、呼び出し側の責任ではない\u003c/span\u003e\n\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTalk\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"あなたは狙いを定めて敵を撃ちぬいた！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eそのようなインターフェースとして、以下のようなものを定義します。これが「メッセージを表示する機能」を表すインターフェースとなります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIView.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIView\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTalk\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eその実装……つまり「特定の方法でメッセージを表示するクラス」は、「コンソールに表示する」モードと「どこにも表示しない」モードの2つのためのクラスが必要です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eConsoleView.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// コンソールに表示するモード\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eConsoleView\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIView\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTalk\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNullView.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// どこにも表示しないモード\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNullView\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIView\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTalk\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 何もしない\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eIView\u003c/code\u003e インターフェースを実装するオブジェクトは、 \u003ccode\u003eBattleContext\u003c/code\u003e クラスに持たせることで、バトルの制御コード内のどこからでもアクセスできるようにしましょう。 \u003ccode\u003eBattleContext\u003c/code\u003e はあくまで情報をまとめる以外の責任は持たず、何か管轄外の要求が来た場合は \u003ccode\u003eView\u003c/code\u003e プロパティに設定されたオブジェクトに丸投げするつもりです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eBattleContext.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBattleContext\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eEnemyBattler\u003c/span\u003e \u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayerBattler\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIView\u003c/span\u003e \u003cspan class=\"n\"\u003eView\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// コンストラクター引数から受け取って、読み取り専用プロパティに設定する\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// View プロパティの内容を後から書き換えることのない設計にするつもりのため\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eBattleContext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIView\u003c/span\u003e \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eView\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eそして、 \u003ccode\u003eProgram.cs\u003c/code\u003e で \u003ccode\u003eBattleContext\u003c/code\u003e を生成している部分を書き換えます。\u003ccode\u003eIView\u003c/code\u003e を実装するオブジェクトとして、 \u003ccode\u003eConsoleView\u003c/code\u003e を生成して渡してあげます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eProgram.cs(変更前)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 前略\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBattleContext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eenemy1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePlayerBattler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDefense\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSkills\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSingleAttackSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e87\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTripleAttackSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e39\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 後略\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eProgram.cs(変更後)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 前略\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBattleContext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eConsoleView\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eenemy2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePlayerBattler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDefense\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSkills\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSingleAttackSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e87\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTripleAttackSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e39\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 後略\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの後は、\u003ccode\u003eConsole.WriteLine\u003c/code\u003e を呼び出している部分を \u003ccode\u003econtext.View.Talk\u003c/code\u003e に置き換えていく作業となります。スキルの発動に関係ない部分でも全て置き換えておくことをお勧めしますし、今回は全て置き換えた場合で説明します。\u003c/p\u003e\n\n\u003cp\u003eなかなか大変な作業ですし、実際の開発ではこういう仕様変更が起きる可能性を考えて前もってインターフェースを用いて差し替えられるようにしておくと良いかもしれません。そうすると良いのは、今回必要になったモードの他にもたとえば「iPhoneで動かすためのモード」「ゲームエンジンを用いてグラフィカルに表示するモード」などの様々な新しい要求が起きても対応できることです。\u003c/p\u003e\n\n\u003cp\u003eさて、ここまでの作業だと、動作は何も変わらないはずです。実行してみましょう（このようなリファクタリング作業では、動作が変わっていないことの確認は重要です）：\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eプレイヤーのHP:100\n敵のHP:100\nあなたは狙いを定めて敵を撃ちぬいた！\n敵に87のダメージ！\nあなたは敵の体へ銃を3連射した！\n敵に 39 のダメージ！\n敵に 39 のダメージ！\n敵に 39 のダメージ！\nあなたは敵の体へ銃を3連射した！\n敵に 39 のダメージ！\n敵に 39 のダメージ！\n敵に 39 のダメージ！\n敵は倒れた！\nプレイヤーの勝ち\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e次に、\u003ccode\u003eBattleContext\u003c/code\u003eを生成するときに \u003ccode\u003eNullView\u003c/code\u003e を渡すようにしてみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eProgram.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 前略\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBattleContext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNullView\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eenemy2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePlayerBattler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDefense\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSkills\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSingleAttackSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e87\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTripleAttackSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e39\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 後略\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eすると、今度は実行しても画面には何も表示しなくなるはずです。\u003c/p\u003e\n\n\u003cp\u003eこれで下準備ができました。今度は、スキルのシミュレーション中は画面に何も表示せず、実際に発動するときにはちゃんと表示をするようにしたいところです。\u003c/p\u003e\n\n\u003cp\u003eこの要求を満たすために修正した \u003ccode\u003ePlayerAi\u003c/code\u003e クラスは以下のようになります：\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePlayerAi.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ePlayerAi\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eSkill\u003c/span\u003e \u003cspan class=\"nf\"\u003eDetermineSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBattleContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eskills\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSkill\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003epriority\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003ecandidate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// *修正* シミュレーション中に発動するスキルのメッセージを表示しないようにするためのクローン\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecloneContext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBattleContext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNullView\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eskill\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eskills\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// シミュレーション中に敵が受けるダメージを実際には反映しないためのクローン\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 割愛しているが、実際はプレイヤーのクローンも生成しておいたり、\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 敵のクローンはBattleContext.Enemyなどにもsetしておいたほうが\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 独特なスキルをたくさん実装する際に安全\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eclone\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnemyBattler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eHp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eDefense\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefense\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// *修正* BattleContext を渡す場所には、メインの BattleContext ではなく\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// NullView を持たせてあるクローンのほうの BattleContext を渡す\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eskill\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecloneContext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eclone\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003epriority\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eclone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecandidate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epriority\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003epriority\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecandidate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eskill\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epriority\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ecandidate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eItem1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e今回は、 \u003ccode\u003eEnemyBattler\u003c/code\u003e だけでなく \u003ccode\u003eBattleContext\u003c/code\u003e のクローンも作成しています。 \u003ccode\u003eBattleContext.Enemy\u003c/code\u003e プロパティと \u003ccode\u003eBattleContext.Player\u003c/code\u003e プロパティの中身は元々の \u003ccode\u003eBattleContext\u003c/code\u003e の中身を雑に代入していますが、これはクローンになっていないので、このプロパティを経由してHPを変更したりすると元々の \u003ccode\u003eBattleContext\u003c/code\u003e に影響が出てしまいます。実際には全てのメンバーについて、その子のメンバー、孫のメンバーというふうに再帰的に潜って完全に切り離されたクローンを作るべきです。\u003c/p\u003e\n\n\u003cp\u003eそして、シミュレーションのためにスキルを実行する際には、元々の \u003ccode\u003eBattleContext\u003c/code\u003e ではなく、 \u003ccode\u003eNullView\u003c/code\u003e を持たせてあるクローンの方を渡す必要があります。こうすることによって、スキルのシミュレーションをする時に限って画面への表示を禁止することができます。\u003c/p\u003e\n\n\u003cp\u003eさあ、この状態で実行してみましょう。対戦相手が \u003ccode\u003eenemy2\u003c/code\u003e ならば、次のようになるはずです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eプレイヤーのHP:100\n敵のHP:100\nあなたは敵の体へ銃を3連射した！\n敵に 39 のダメージ！\n敵に 39 のダメージ！\n敵に 39 のダメージ！\n敵は倒れた！\nプレイヤーの勝ち\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eきちんと適切なスキルを選べていますし、しかもシミュレーション中にスキルを実際に試していることはバレずに済んでいます！お疲れさまでした。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"総当たりのaiも悪くない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B7%8F%E5%BD%93%E3%81%9F%E3%82%8A%E3%81%AEai%E3%82%82%E6%82%AA%E3%81%8F%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e総当たりのAIも悪くない\u003c/h3\u003e\n\n\u003cp\u003eRPGなどにおけるゲームAIを作る際、全てのパターンを試してみる、というのは悪くない方法です。いわゆる「総当たり」というやつです。この方法の問題点は最終的なスキルを決定するまでに時間がかかることですが、それが顕著になるパターンもいくつか考えられます：\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eスキルの個数が数十個にも及ぶ場合\u003c/li\u003e\n\u003cli\u003eスキルの効果が膨大な数の条件に応じて変動する場合\u003c/li\u003e\n\u003cli\u003e何回も連続で行動でき、スキルを使う順番によっても戦況が大きく変わる場合\n\n\u003cul\u003e\n\u003cli\u003eスキルが2個で行動回数2回だったとしても、「使うか使わないか」「順番」によって6パターン試さなければなりません\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eそのような状態に陥った時には、私の場合は次に、行動パターンをランダムに打ち切る方法を使います。一部のスキルをランダムに、「評価する価値もなく不採用だ」と見なして切り捨てることで、シミュレーションの手間を省きます。時折、非常に強力なスキルを使うのを不意に諦めてしまって妙な感じになるかもしれませんが、強すぎるAIにするとゲームにならないですし、最強のスキルをひたすら撃つ敵ばかりになるとつまらないので、容認することにしています。\u003c/p\u003e\n\n\u003cp\u003e他にも色々な最適化方法があるかと思いますが、総当たりの手法を改善して効率的にしたものを使う、という発想はやはり有効と考えています。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"インターフェースを使おう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E3%81%8A%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eインターフェースを使おう\u003c/h3\u003e\n\n\u003cp\u003e特定の処理を後で差し替えられるようにしたいとき、インターフェースを用いるのはよい方法です。特に今回は、メソッドに切り出して共通化するだけでも実現できましたが、後々の保守のことも考えてあえてインターフェースを用いた切り出し方にしました。それはなぜかというと、 \u003ccode\u003eBattleContext\u003c/code\u003e に元々あった機能と、新たに追加された機能のあいだの相互作用に気を配らなければならない可能性を排除するためでした。\u003c/p\u003e\n\n\u003cp\u003eインターフェースに切り出す作業をすることには、他にも様々な狙いがあります。詳しくは、「SOLID原則」について調べてみてください。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"余談決め打ちのaiという手段もあり\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%99%E8%AB%87%E6%B1%BA%E3%82%81%E6%89%93%E3%81%A1%E3%81%AEai%E3%81%A8%E3%81%84%E3%81%86%E6%89%8B%E6%AE%B5%E3%82%82%E3%81%82%E3%82%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e余談：決め打ちのAIという手段もあり\u003c/h2\u003e\n\n\u003cp\u003e今回紹介したAIの実装はとても汎用的なもので、どんなスキルを用意しても評価方法を準備しておけば、適切なスキルを選ぶことができます。一方で、これから私たちが作ろうとしているゲームは、そんなに複雑なスキルがたくさん登場しないかもしれません。そういったときは、敵キャラクターごとに決まったルールでスキルを選ぶようにしてもよいでしょう。たとえば：\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eNターン目は必ず決まったスキルを選ぶ\u003c/li\u003e\n\u003cli\u003eHPが半分以下になったターンだけは通常と違う固定のスキルを選ぶ\u003c/li\u003e\n\u003cli\u003eスキルを1つしか持たないので、必ずそれを使う\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこの方法はシンプルなだけでなく、ゲームデザインがしやすい長所もあります。今回紹介した方法は、「Nターン目は必ず決まったスキルを選ぶ」のような柔軟な行動パターンを作るためには更にひと手間がいる特徴があります。\u003c/p\u003e\n\n\u003cp\u003e皆さんのゲームデザインに合ったAIを作ってみてください。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"おわり\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわり\u003c/h2\u003e\n\n\u003cp\u003eみんなもRPGつくろうね！\u003c/p\u003e\n","createdAt":"2019-11-28T08:08:52Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"FtId7+8H+5uAt2XimadrOyf55kRyVfKbEA==--vVjFL3EOK01UpWBH--wLK3u63kE9LUDrb2z+KHgQ==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2019-11-30T22:00:24Z","likesCount":17,"linkUrl":"https://qiita.com/NumAniCloud/items/75f7253483b685d0d7b0","organization":null,"originalId":1092157,"stockedCount":16,"title":"RPG戦闘のAIを総当たりで実装する（そして、インターフェースを用いた設計）","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0\"\u003eゲームシステム\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%B8%8B%E6%BA%96%E5%82%99\"\u003e下準備\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%B2%E3%81%A8%E3%81%BE%E3%81%9A%E5%AE%9F%E8%A1%8C\"\u003eひとまず実行\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ai%E3%81%AB%E3%82%84%E3%82%89%E3%81%9B%E3%81%9F%E3%81%84%E3%82%88%E3%81%AD\"\u003eAIにやらせたいよね\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E3%82%B7%E3%83%9F%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%99%E3%82%8Bai\"\u003eスキルをシミュレーションするAI\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#b-%E6%9C%AC%E5%BD%93%E3%81%AB%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E9%81%A9%E7%94%A8%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%A0%E3%81%91\"\u003eB. 本当にスキルを適用しているだけ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#a-%E3%82%B9%E3%82%AD%E3%83%AB%E3%81%AF%E6%95%B5%E3%81%AE%E3%82%B3%E3%83%94%E3%83%BC%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003eA. スキルは敵のコピーに対して使用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#c-%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E9%81%A9%E7%94%A8%E3%81%97%E3%81%9F%E7%B5%90%E6%9E%9C%E3%82%92%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B\"\u003eC. スキルを適用した結果を評価する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ai%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E5%81%B4\"\u003eAIの呼び出し側\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%96%B0%E3%81%97%E3%81%84ai%E3%82%92%E5%AE%9F%E8%A1%8C\"\u003e新しいAIを実行\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ai%E3%81%AE%E5%AE%9F%E8%A1%8C%E4%B8%AD%E3%81%AB%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%8C%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86\"\u003eAIの実行中にメッセージが表示されてしまう\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE%E8%A1%A8%E7%A4%BA%E5%85%88%E3%82%92%E5%B7%AE%E3%81%97%E6%9B%BF%E3%81%88%E3%82%89%E3%82%8C%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%82%88%E3%81%86\"\u003eメッセージの表示先を差し替えられるようにしよう\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%95%E3%83%A9%E3%82%B0%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%96%B9%E6%B3%95%E3%81%AF%E3%81%A9%E3%81%86%E3%81%8B\"\u003eフラグを使った方法はどうか？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%96%B9%E6%B3%95\"\u003eメソッドを使った方法\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%96%B9%E6%B3%95\"\u003eインターフェースを使った方法\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B7%8F%E5%BD%93%E3%81%9F%E3%82%8A%E3%81%AEai%E3%82%82%E6%82%AA%E3%81%8F%E3%81%AA%E3%81%84\"\u003e総当たりのAIも悪くない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E3%81%8A%E3%81%86\"\u003eインターフェースを使おう\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%99%E8%AB%87%E6%B1%BA%E3%82%81%E6%89%93%E3%81%A1%E3%81%AEai%E3%81%A8%E3%81%84%E3%81%86%E6%89%8B%E6%AE%B5%E3%82%82%E3%81%82%E3%82%8A\"\u003e余談：決め打ちのAIという手段もあり\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A\"\u003eおわり\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":4396,"uuid":"75f7253483b685d0d7b0","banReason":null,"adventCalendarItem":{"day":1,"calendar":{"name":"C#","urlName":"c-sharp","year":2019,"organization":null}},"author":{"encryptedId":"iHk+TiykaK/WYwlu6LfCg0e0mfs=--6C7U7VLcITJ5kI0L--asY6zPaTTICODETTBq3rcw==","originalId":32800,"description":"ゲーム制作に興味があります。","facebookUrl":null,"githubUrl":"https://github.com/NumAniCloud","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/32800/profile-images/1569302037","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F32800%2Fprofile-images%2F1569302037?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=9f63f3a3db183cdaee4d47d97c3d4a5d","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F32800%2Fprofile-images%2F1569302037?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=55f84c18aea88997e63d164ddbf75449","urlName":"NumAniCloud","websiteUrl":"http://numani.info/","twitterUrl":"https://twitter.com/NumAniCloud","twitterUrlName":"NumAniCloud","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"game","urlName":"game"},{"name":"oop","urlName":"oop"},{"name":"AI","urlName":"ai"},{"name":"RPG","urlName":"rpg"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

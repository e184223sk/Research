More than 1 year has passed since last update.職場で新型コロナによるBCP対応という事で，在宅勤務が施行されました。
業務の環境は自席PCからシンクライアントを利用した環境に変更となりました。
しかし，一部の業務では自席PCを利用する必要があったため，WOL(Wake On Lan)を利用することにしました。
この時，社内環境の制約など，いろいろな課題に直面したので，覚書として解決策を残しておきます。社内環境では以下の制約がありました。上記より，WOLを実行するためのマジックパケットを送付するために，exeのフリーウェアを使用することが出来ませんでした。
また，シンクライアントと自席PCはサブネットが異なるため，ブロードキャストによるマジックパケットの送付は出来ませんでした。
そのため，IPアドレスを直指定してマジックパケットを送付する必要がありましたが，ARPキャッシュが4時間で破棄されるので，一晩立つと起動できないといった事態に見舞われました。これらを踏まえて以下の方法を採用しました。送信クライアントは踏み台PCのIPアドレスを設定してユーザに配布しました。
ユーザには自席PCのMACアドレスを設定してもらいました。また，PowerShellは何も設定していないとセキュリティで実行できないので，-ExecutionPolicyオプションを指定した実行用ショートカットも合わせて配布しました。
%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe -NoExit -ExecutionPolicy RemoteSigned .\StartWOL.ps1PowerShellでは.netのTCPクライアントでMACアドレスを送付しています。C#で実装しました。



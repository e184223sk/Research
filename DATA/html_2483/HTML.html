<!DOCTYPE html><html><head><meta charset="utf-8" /><title>スーパーマリオのジャンプのアルゴリズム - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/morian-bisco/items/4c659d9f940c7e3a2099" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="TrIsmKRMIZazWj0KByazT7cB/klm1ynO4OfApt6P+5E3jhL+bM0i5f9r/i2aUivU+dW4ZExZW45GHvTkiQuh4A==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="スーパーマリオのジャンプのアルゴリズム - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEs1NDRPODQ0T1I0NE84NDRPZTQ0T3E0NEtxNDRHdTQ0SzQ0NE9qNDRPejQ0T1g0NEd1NDRLaTQ0T3I0NEswNDRPcTQ0SzY0NE9nJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTU1MGE3N2ViY2VhMWQ1OTdlZTE1MDBjNTFiZTJiOWZj&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzF2Y21saGJpMWlhWE5qYncmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1kOGU5YTMzODA5YTMxZDUyMzEzNWZhYTAxNTg1ODZkOQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=48b47130c955872d93643fcaeaad04ff"><meta property="og:description" content="先日、気持ちのいいジャンプを目指してというQiitaの記事を見かけました。記事中では、マリオのジャンプについても触れられています。マリオというと、マリオブラザースやスーパーマリオブラザース等々、色々あるのですが、これはおそらくスーパー..."><meta content="https://qiita.com/morian-bisco/items/4c659d9f940c7e3a2099" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,game,Unity,ゲームプログラミング" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-a8d734e5-83ca-496b-8e41-b4f7b0b6e0ad"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fmorian-bisco%2Fitems%2F4c659d9f940c7e3a2099">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fmorian-bisco%2Fitems%2F4c659d9f940c7e3a2099">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-a8d734e5-83ca-496b-8e41-b4f7b0b6e0ad">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-11-06T21:09:47.000+09:00","dateModified":"2019-11-16T22:59:09.000+09:00","headline":"スーパーマリオのジャンプのアルゴリズム","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEs1NDRPODQ0T1I0NE84NDRPZTQ0T3E0NEtxNDRHdTQ0SzQ0NE9qNDRPejQ0T1g0NEd1NDRLaTQ0T3I0NEswNDRPcTQ0SzY0NE9nJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTU1MGE3N2ViY2VhMWQ1OTdlZTE1MDBjNTFiZTJiOWZj\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzF2Y21saGJpMWlhWE5qYncmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1kOGU5YTMzODA5YTMxZDUyMzEzNWZhYTAxNTg1ODZkOQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=48b47130c955872d93643fcaeaad04ff","mainEntityOfPage":"https://qiita.com/morian-bisco/items/4c659d9f940c7e3a2099","author":{"@type":"Person","address":"","email":null,"identifier":"morian-bisco","name":"morian-bisco","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2Fprofile-images%2F1561893741?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=7b30a6767ee84678df4d1c2d653c86bb","url":"https://qiita.com/morian-bisco","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"morian-bisco","type":"items","id":"4c659d9f940c7e3a2099"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"morian-bisco","type":"items","id":"4c659d9f940c7e3a2099"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"morian-bisco","type":"items","id":"4c659d9f940c7e3a2099"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/morian-bisco/items/4c659d9f940c7e3a2099","location":"/morian-bisco/items/4c659d9f940c7e3a2099","scheme":"https","host":"qiita.com","port":null,"pathname":"/morian-bisco/items/4c659d9f940c7e3a2099","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"8x1YP0qe9El7LdLMFIHtqqfoMcxHHkAzaI2+gVdo7n2KIWZZgh/3OjccEeuJ9XUx6Tx34W2QMnPOdIrDAOy0DA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-0e6dfef1-39de-4b64-a625-d10fb90d1404"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/morian-bisco/items/4c659d9f940c7e3a2099/likers" class="css-1iupg5d">1894</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">1178</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/4c659d9f940c7e3a2099/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/morian-bisco/items/4c659d9f940c7e3a2099/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/morian-bisco/items/4c659d9f940c7e3a2099/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/morian-bisco/items/4c659d9f940c7e3a2099/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/morian-bisco/items/4c659d9f940c7e3a2099.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/morian-bisco"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167904/profile-images/1561893741" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/morian-bisco" class="css-10ougpm">@<!-- -->morian-bisco</a><div class="css-1ay9vb9"><span><meta content="2019-11-06T12:09:47Z"/><time dateTime="2019-11-16T13:59:09Z" class="css-m19uds">updated at 2019-11-16</time></span></div></div></div></div></div><h1 class="css-cgzq40">スーパーマリオのジャンプのアルゴリズム</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/game" class="css-4czcte">game</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/%e3%82%b2%e3%83%bc%e3%83%a0%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0" class="css-4czcte">ゲームプログラミング</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>先日、<a href="https://qiita.com/odanny/items/297f32a334c41410cc5d" id="reference-abd77413a554f6a7398d">気持ちのいいジャンプを目指して</a>というQiitaの記事を見かけました。記事中では、マリオのジャンプについても触れられています。マリオというと、マリオブラザースやスーパーマリオブラザース等々、色々あるのですが、これはおそらくスーパーマリオブラザースの事だと思われます。ジャンプアクションゲームといったらスーマリですね。</p>

<p>そのマリオのジャンプの仕組みは「マリオの速度ベクトルを保存しておいて座標を計算するんじゃなくて～」と書かれていて、別サイトのブログへのリンクが張られています。</p>

<p><a href="https://gemma.hatenadiary.org/entry/20080517/1211010942" rel="nofollow noopener" target="_blank">マリオのジャンプ実装法とVerlet積分</a></p>

<p>ただ、この記述については不正確であるという別のブログもあったりします。</p>

<p><a href="https://blog.game-kids.net/haruzakki/entry-769.html" rel="nofollow noopener" target="_blank">マリオの完コピvol.28 ジャンプの解析と修正</a></p>

<p>ホントのところはどうなんでしょうか？世界で最も有名なゲームのジャンプがどのように処理されているのか気になったので調べてみることにしました。</p>

<h2>
<span id="原典にあたる" class="fragment"></span><a href="#%E5%8E%9F%E5%85%B8%E3%81%AB%E3%81%82%E3%81%9F%E3%82%8B"><i class="fa fa-link"></i></a>原典にあたる</h2>

<p>さて、その調べ方ですが、オリジナルのプログラムを見ればいいのですから話はカンタンです。え？肝心のプログラムがどこにあるかって？それはカセットの中に決まってるじゃないですか。</p>

<p><a href="https://camo.qiitausercontent.com/6fbee07eb9b937e969705c352a18f64c22884abc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3136373930342f66663732666331302d626535372d353563372d316533352d6333623333656231303038652e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2Fff72fc10-be57-55c7-1e35-c3b33eb1008e.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f0eb57ee05ba773dc00ea1c20ff04829" alt="DSC05587_320.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167904/ff72fc10-be57-55c7-1e35-c3b33eb1008e.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2Fff72fc10-be57-55c7-1e35-c3b33eb1008e.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c09b46261856f7a59aa166c403f86963 1x" loading="lazy"></a></p>

<p>皆さんのご家庭にもある、ファミコンとスーマリのカセットです。</p>

<p>このカセットの端子には、アドレスバスとデータバスと制御用信号線があり、スーマリの場合は、それらが素直にカートリッジ内部のROMに接続されています。</p>

<p><a href="https://camo.qiitausercontent.com/074ba0dacc7109af737c1a7e45399c85b4c5fa3c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3136373930342f39663166383934352d393235352d633563612d383338652d3562376331626361653064322e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F9f1f8945-9255-c5ca-838e-5b7c1bcae0d2.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2f7da0883d3b816f1739ab376afb13bb" alt="DSC05593_320.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167904/9f1f8945-9255-c5ca-838e-5b7c1bcae0d2.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F9f1f8945-9255-c5ca-838e-5b7c1bcae0d2.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=147644afa7e93de9d6298278fc85798e 1x" loading="lazy"></a></p>

<p><a href="http://img.atwikiimg.com/www34.atwiki.jp/cc65/pub/dsoft/cart.html" rel="nofollow noopener" target="_blank">ファミコンカートリッジ自作計画</a></p>

<p>これがどういうことかというと、アドレスバスのPRG-A0～A14が15ビットのメモリアドレスを指していることになります。また、データバスはD0～D7の8本なので8ビットです。つまり、1つのアドレスごとに8ビット（一般的に1バイト）のデータを持つ32KByteのROMになります。</p>

<p>高級言語の配列で表現すると、<br>
<code>readonly byte ROM[32768] = {バイトデータ...}}</code><br>
という感じです。特にROMへのアクセスを困難にするような仕組みは施されていません。</p>

<p>実際に電気信号として読むには、制御信号を上手くハンドリングする必要がありますが、アドレスバスとデータバスの端子の電圧は+5Vか0Vなので、ArduinoやRaspberryPiとかを上手く使えば読込み出来ます。そうして読み込んだ内容はこれがそのままプログラムということになります。</p>

<p><a href="https://camo.qiitausercontent.com/1c97d0035f2ea9cb2ccf80a27bb1d04b9cfdc87d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3136373930342f36663638356263332d626638662d653233372d373661642d3237336239326663393265382e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F6f685bc3-bf8f-e237-76ad-273b92fc92e8.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e57c3e39c6f6bf0dfe22e82ae4f2ea2f" alt="dump.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167904/6f685bc3-bf8f-e237-76ad-273b92fc92e8.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F6f685bc3-bf8f-e237-76ad-273b92fc92e8.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d15e2663c0aefd2c4b2cd07ef11af4b4 1x" loading="lazy"></a></p>

<p>ファミコンのCPUは<a href="https://ja.wikipedia.org/wiki/MOS_6502" rel="nofollow noopener" target="_blank">MOS 6502</a>互換品で、アーキテクチャやコードの命令セットも<a href="http://hp.vector.co.jp/authors/VA042397/nes/6502.html" rel="nofollow noopener" target="_blank">ほぼ同じ</a>です。</p>

<p>あとは、命令のコードと機能を理解して、プログラムをひたすら読み進めていくと、何をしているのか解るわけです。理屈だけは簡単です。（実際にやってみたら簡単じゃなかった・・・）</p>

<p>前置きが長くなりましたが、この記事の本来の目的であるジャンプ処理の仕組みは、日本語で動作内容を書くよりも高級言語で表した方が解り易いでしょうし、動作検証もしておきたかったので、流行りのC#＆Unityに置き換えてみました。</p>

<p><a href="https://github.com/moriyan6001/FcMario" rel="nofollow noopener" target="_blank">GitHub - moriyan6001/FcMario</a></p>

<p>実際のスーマリのプログラムでは、ジャンプ処理中に様々な挙動の判定や演算をしてたり、ジャンプルーチンはマリオだけでなく他のキャラの動作にも使われているようですが、その辺は省いています。</p>

<p><strong>(注) 以下、プログラムの理解不足や変換ミス、カセットのバージョン違いがあるかもしれませんので、その辺は緩く見てもらえればと思います。</strong></p>

<h2>
<span id="ジャンプ部分のコード" class="fragment"></span><a href="#%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97%E9%83%A8%E5%88%86%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>ジャンプ部分のコード</h2>

<p>記事が長くなるので折りたたんでいます。↓</p>

<p><details><summary>ジャンプ処理コード</summary><div>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">FcSmb</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">VerticalPositionOrigin</span><span class="p">;</span>     <span class="c1">// ジャンプ開始時の位置</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">VerticalPosition</span><span class="p">;</span>           <span class="c1">// 現在位置</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">VerticalSpeed</span><span class="p">;</span>              <span class="c1">// 速度</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">VerticalForce</span><span class="p">;</span>              <span class="c1">// 現在の加速度</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">VerticalForceFall</span><span class="p">;</span>          <span class="c1">// 降下時の加速度</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">VerticalForceDecimalPart</span><span class="p">;</span>   <span class="c1">// 加速度の増加値</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">CorrectionValue</span><span class="p">;</span>            <span class="c1">// 累積計算での補正値？</span>

    <span class="k">private</span> <span class="kt">int</span> <span class="n">HorizontalSpeed</span> <span class="p">=</span> <span class="m">00</span><span class="p">;</span>       <span class="c1">// 横方向速度</span>

    <span class="c1">// ジャンプ開始時の初期パラメータ</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">byte</span><span class="p">[]</span>  <span class="n">VerticalForceDecimalPartData</span>    <span class="p">=</span> <span class="p">{</span> <span class="m">0x20</span><span class="p">,</span> <span class="m">0x20</span><span class="p">,</span> <span class="m">0x1e</span><span class="p">,</span> <span class="m">0x28</span><span class="p">,</span> <span class="m">0x28</span> <span class="p">};</span> <span class="c1">// 加速度の増加値</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">byte</span><span class="p">[]</span>  <span class="n">VerticalFallForceData</span>           <span class="p">=</span> <span class="p">{</span> <span class="m">0x70</span><span class="p">,</span> <span class="m">0x70</span><span class="p">,</span> <span class="m">0x60</span><span class="p">,</span> <span class="m">0x90</span><span class="p">,</span> <span class="m">0x90</span> <span class="p">};</span> <span class="c1">// 降下時の加速度</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">sbyte</span><span class="p">[]</span> <span class="n">InitialVerticalSpeedData</span>        <span class="p">=</span> <span class="p">{</span>   <span class="p">-</span><span class="m">4</span><span class="p">,</span>   <span class="p">-</span><span class="m">4</span><span class="p">,</span>   <span class="p">-</span><span class="m">4</span><span class="p">,</span>   <span class="p">-</span><span class="m">5</span><span class="p">,</span>   <span class="p">-</span><span class="m">5</span> <span class="p">};</span> <span class="c1">// 初速度</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">byte</span><span class="p">[]</span>  <span class="n">InitialVerticalForceData</span>        <span class="p">=</span> <span class="p">{</span> <span class="m">0x00</span><span class="p">,</span> <span class="m">0x00</span><span class="p">,</span> <span class="m">0x00</span><span class="p">,</span> <span class="m">0x00</span><span class="p">,</span> <span class="m">0x00</span> <span class="p">};</span> <span class="c1">// 初期加速度</span>

    <span class="c1">// 落下時の最大速度</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">sbyte</span> <span class="n">DOWN_SPEED_LIMIT</span> <span class="p">=</span> <span class="m">0x04</span><span class="p">;</span>

    <span class="c1">// 1フレ前のジャンプボタンの押下状態</span>
    <span class="k">private</span> <span class="kt">bool</span> <span class="n">JumpBtnPrevPress</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

    <span class="c1">// 地面にいるかジャンプ中か</span>
    <span class="k">public</span> <span class="k">enum</span> <span class="n">MovementState</span>
    <span class="p">{</span>
        <span class="n">OnGround</span><span class="p">,</span>
        <span class="n">Jumping</span>
    <span class="p">}</span>
    <span class="k">private</span> <span class="n">MovementState</span> <span class="n">CurrentState</span> <span class="p">=</span> <span class="n">MovementState</span><span class="p">.</span><span class="n">OnGround</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">ResetParam</span><span class="p">(</span><span class="kt">int</span> <span class="n">initVerticalPos</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">VerticalSpeed</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">VerticalForce</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">VerticalForceFall</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">VerticalForceDecimalPart</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">CurrentState</span> <span class="p">=</span> <span class="n">MovementState</span><span class="p">.</span><span class="n">OnGround</span><span class="p">;</span>
        <span class="n">CorrectionValue</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

        <span class="n">VerticalPosition</span> <span class="p">=</span> <span class="n">initVerticalPos</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">int</span> <span class="n">PosY</span>
    <span class="p">{</span>
        <span class="c1">//set { VerticalPosition = value; }</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">VerticalPosition</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">MovementState</span> <span class="n">GetPlayerState</span>
    <span class="p">{</span>
        <span class="k">get</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">CurrentState</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Movement</span><span class="p">(</span><span class="kt">bool</span> <span class="n">jumpBtnPress</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">JumpCheck</span><span class="p">(</span><span class="n">jumpBtnPress</span><span class="p">);</span>
        <span class="nf">MoveProcess</span><span class="p">(</span><span class="n">jumpBtnPress</span><span class="p">);</span>

        <span class="n">JumpBtnPrevPress</span> <span class="p">=</span> <span class="n">jumpBtnPress</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">JumpCheck</span><span class="p">(</span><span class="kt">bool</span> <span class="n">jumpBtnPress</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 初めてジャンプボタンが押された？</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">jumpBtnPress</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">JumpBtnPrevPress</span> <span class="p">==</span> <span class="k">true</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

        <span class="c1">// 地面上にいる状態？</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">CurrentState</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// ジャンプ開始準備</span>
            <span class="nf">PreparingJump</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">PreparingJump</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">VerticalForceDecimalPart</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">VerticalPositionOrigin</span> <span class="p">=</span> <span class="n">VerticalPosition</span><span class="p">;</span>

        <span class="n">CurrentState</span> <span class="p">=</span> <span class="n">MovementState</span><span class="p">.</span><span class="n">Jumping</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">idx</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">HorizontalSpeed</span> <span class="p">&gt;=</span> <span class="m">0x1c</span><span class="p">)</span> <span class="n">idx</span><span class="p">++;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">HorizontalSpeed</span> <span class="p">&gt;=</span> <span class="m">0x19</span><span class="p">)</span> <span class="n">idx</span><span class="p">++;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">HorizontalSpeed</span> <span class="p">&gt;=</span> <span class="m">0x10</span><span class="p">)</span> <span class="n">idx</span><span class="p">++;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">HorizontalSpeed</span> <span class="p">&gt;=</span> <span class="m">0x09</span><span class="p">)</span> <span class="n">idx</span><span class="p">++;</span>

        <span class="n">VerticalForce</span>               <span class="p">=</span> <span class="n">VerticalForceDecimalPartData</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
        <span class="n">VerticalForceFall</span>           <span class="p">=</span> <span class="n">VerticalFallForceData</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
        <span class="n">VerticalForceDecimalPart</span>    <span class="p">=</span> <span class="n">InitialVerticalForceData</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
        <span class="n">VerticalSpeed</span>               <span class="p">=</span> <span class="n">InitialVerticalSpeedData</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">MoveProcess</span><span class="p">(</span> <span class="kt">bool</span> <span class="n">jumpBtnPress</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 速度が0かプラスなら画面下へ進んでいるものとして落下状態の加速度に切り替える</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">VerticalSpeed</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">VerticalForce</span> <span class="p">=</span> <span class="n">VerticalForceFall</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="c1">// Aボタンが離された&amp;上昇中？</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">jumpBtnPress</span> <span class="p">==</span> <span class="k">false</span> <span class="p">&amp;&amp;</span> <span class="n">JumpBtnPrevPress</span> <span class="p">==</span> <span class="k">true</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">VerticalPositionOrigin</span> <span class="p">-</span> <span class="n">VerticalPosition</span>  <span class="p">&gt;=</span> <span class="m">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// 落下状態の加速度値に切り替える</span>
                    <span class="n">VerticalForce</span> <span class="p">=</span> <span class="n">VerticalForceFall</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nf">Physics</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Physics</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 累積計算での補正値っぽい</span>
        <span class="kt">int</span> <span class="n">cy</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">CorrectionValue</span> <span class="p">+=</span> <span class="n">VerticalForceDecimalPart</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">CorrectionValue</span> <span class="p">&gt;=</span> <span class="m">256</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">CorrectionValue</span> <span class="p">-=</span> <span class="m">256</span><span class="p">;</span>
            <span class="n">cy</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 現在位置に速度を加算 (累積計算での補正値も加算)</span>
        <span class="n">VerticalPosition</span> <span class="p">+=</span> <span class="n">VerticalSpeed</span> <span class="p">+</span> <span class="n">cy</span><span class="p">;</span>

        <span class="c1">// 加速度の固定少数点部への加算</span>
        <span class="c1">// 1バイトをオーバーフローしたら、速度が加算される。その時、加速度の整数部は0に戻される</span>
        <span class="n">VerticalForceDecimalPart</span> <span class="p">+=</span> <span class="n">VerticalForce</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">VerticalForceDecimalPart</span> <span class="p">&gt;=</span> <span class="m">256</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">VerticalForceDecimalPart</span> <span class="p">-=</span> <span class="m">256</span><span class="p">;</span>
            <span class="n">VerticalSpeed</span><span class="p">++;</span>
        <span class="p">}</span>

        <span class="c1">// 速度の上限チェック</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">VerticalSpeed</span> <span class="p">&gt;=</span> <span class="n">DOWN_SPEED_LIMIT</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 謎の判定</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">VerticalForceDecimalPart</span> <span class="p">&gt;=</span> <span class="m">0x80</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">VerticalSpeed</span> <span class="p">=</span> <span class="n">DOWN_SPEED_LIMIT</span><span class="p">;</span>
                <span class="n">VerticalForceDecimalPart</span> <span class="p">=</span> <span class="m">0x00</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p></p>
</div></details></p>

<h2>
<span id="位置と速度と加速度" class="fragment"></span><a href="#%E4%BD%8D%E7%BD%AE%E3%81%A8%E9%80%9F%E5%BA%A6%E3%81%A8%E5%8A%A0%E9%80%9F%E5%BA%A6"><i class="fa fa-link"></i></a>位置と速度と加速度</h2>

<p>ジャンプ処理はコードのまま読んでもらえれば「なるほどそうなのね」で終わるのですが、せっかくなのでもう少し説明しようと思います。</p>

<p>そのための予備知識として、ゲーム作りの物理本に出てきそうな、位置と速度と加速度の関係を簡潔に説明します。</p>

<p>スーマリジャンプの処理は基本的に、位置と速度と加速度の式です。位置は速度の時間による累積、速度は加速度の時間による累積という、ニュートンのアレです。</p>

<p>速度の定義は一定時間あたりの移動量なので、位置に速度を足したら次の位置になります。これが等速度運動ですね。ファミコンのゲーム画面であれば、速度は1フレーム当たりに移動するピクセル量なので、ピクセル/フレームが単位になります。1フレームで1ピクセル動く場合、1ピクセル/フレームです。スーマリは実時間に関係しないので、Δtを乗算するみたいなことはしません。1フレームあたりの処理が間に合わないと実時間あたりの速度にも影響が出ます。</p>

<p>速度が時間によって変化する場合は、速度の変化分が加速度として加わっていきます。いわゆる等加速度運動です。1フレームあたりに速度が1フレーム/ピクセルだけ増えるのであれば、その加速度は1ピクセル/フレーム^2になります。重力のある空間では、重力という力が加速度と関係してきますから、重力が加速度として速度に加わり、それが物体の位置を変化させるという考え方ですね。</p>

<p>まとめると、y：位置、v：速度、a：加速度の時は</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>y = y + v\\
v = v + a
</code></pre></div></div>

<p>という式になります。(数学的には不適切な表現ですが気にしないでください)</p>

<p>高校くらいで学ぶ物理では、時間tにおける位置yを求める式なんかが出てきますが、</p>

<p>$$y = 1/2 * a * t^2$$</p>

<p>この計算式には掛け算が含まれています。ファミコンのCPUは動作速度が1.79MHzで掛け算命令なんてありません。また、変数（レジスタ）も8ビットの整数型だけです。このCPUに掛け算をさせるのは重い処理になります。また、スーマリはジャンプ中でもプレイヤーの操作によってジャンプの挙動が変化するので、マリオの位置を方程式を用いて事前に計算することは意味がありませんし、現在位置から1フレーム後の位置を算出するには不便な式です。<br>
位置と速度と加速度の考え方であれば、掛け算を使わずに足し算を数回するだけで、位置の変化を計算することが出来ますから、何かと都合がいいのです。</p>

<p>この計算をしているのが、先のプログラムのPhysics()というメソッドです。ここで、位置と速度をフレームごとに計算しています。</p>

<p>ところで、プログラムを改めて見ると、素直に速度に加速度を加えてはいません。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code>
<span class="c1">// 加速度の固定少数点部への加算</span>
<span class="c1">// 1バイトをオーバーフローしたら、速度が加算される</span>
<span class="n">VerticalForceDecimalPart</span> <span class="p">+=</span> <span class="n">VerticalForce</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">VerticalForceDecimalPart</span> <span class="p">&gt;=</span> <span class="m">256</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">VerticalForceDecimalPart</span> <span class="p">-=</span> <span class="m">256</span><span class="p">;</span>
    <span class="n">VerticalSpeed</span><span class="p">++;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>毎フレームごとに加速度の変数に一定の値を加算していき、それが256を超えたら速度を+1しています。要するに、1ビットの整数部 + 8ビットの小数部の変数があり、整数部分が1になったら速度を+1するということです。（ただし、速度を+1した時に整数部を0に戻しています）</p>

<p>ファミコンにしてもUnityにしても、画面の更新頻度（一定間隔毎の処理頻度）は基本的に1秒当たり約60回です。“整数”を使って位置や速度を計算すると、1フレーム当たり1ピクセルというのが最低速度になります。これは加速度も同様です。<br>
ただ、ゲームでは、それよりも遅い速度や加速度を使いたい時もあるわけです。1秒かけて1ピクセル移動したいような、要するに、速度が0.1ピクセル/フレームみたいなことです。<br>
そこで、整数だけで疑似的に少数表現をするために、スーマリでは加速度を1ビット、加速度の増加分を1バイトとして計算して、加速度が256を超えたら速度を+1するという方式をとっています。</p>

<p>上記のプログラムでは解り易さ優先でif命令を使っていますが、6502には8ビット演算をするとオーバーフローしたかどうかを表す1ビットのフラグ変数があり、そのフラグ変数の値も加える加算命令もあるので、2回の足し算命令で済んでしまいます。（C#でも計算式だけで記述できます）</p>

<p>最初、ここの処理を見た時には、加速度は固定少数点表記か、加速度の増加値である<a href="https://ja.wikipedia.org/wiki/%E8%BA%8D%E5%BA%A6" rel="nofollow noopener" target="_blank">加加速度（躍度）</a>なのかなと思ったのですが、ちょっと違いますね。</p>

<p>その他、ここまでまるっと無視してきましたが、Physics()メソッドの最初に</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="c1">// 累積計算での補正値っぽい</span>
<span class="kt">int</span> <span class="n">cy</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="n">MysteryAdjustment</span> <span class="p">+=</span> <span class="n">VerticalForceDecimalPart</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">MysteryAdjustment</span> <span class="p">&gt;=</span> <span class="m">256</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">MysteryAdjustment</span> <span class="p">-=</span> <span class="m">256</span><span class="p">;</span>
    <span class="n">cy</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>加速度の小数部分の累積分を位置に加えるという処理が入っています。</p>

<p>2011/11/16追記：記事公開当初は謎な処理として扱っていたのですが、なんとなくわかったような気がしなくもないのでざっと説明します。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>y=\frac{1}{2}at^2
</code></pre></div></div>

<p>この式は積分によって導き出されます。（定数項と単位は省略してます）</p>

<p>また、ここまでに、加算だけで計算する方法を説明してきました。（プログラムっぽい書き方なので数学的には単位と表記がおかしいのですが気にしないでください）</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>v=v+a \\
y=y+v \\
</code></pre></div></div>

<p>これらを試しに5秒後・・・5フレーム目でもいいのですが、実際に計算してみて比較してみます。時間をtとしています。</p>

<table>
<thead>
<tr>
<th>t</th>
<th>y=1/2at^2</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1/2a</td>
</tr>
<tr>
<td>2</td>
<td>2a</td>
</tr>
<tr>
<td>3</td>
<td>4.5a</td>
</tr>
<tr>
<td>4</td>
<td>8a</td>
</tr>
<tr>
<td>5</td>
<td>12.5a</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th>t</th>
<th>v+=a</th>
<th>y+=v</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>a</td>
<td>a</td>
</tr>
<tr>
<td>2</td>
<td>2a</td>
<td>3a</td>
</tr>
<tr>
<td>3</td>
<td>3a</td>
<td>6a</td>
</tr>
<tr>
<td>4</td>
<td>4a</td>
<td>10a</td>
</tr>
<tr>
<td>5</td>
<td>5a</td>
<td>15a</td>
</tr>
</tbody>
</table>

<p>それぞれの計算で導き出されるyの値がズレています。どれくらいずれているのか並べて比べてみると</p>

<table>
<thead>
<tr>
<th>t</th>
<th>y=1/2at^2</th>
<th>y+=v</th>
<th>差(d)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1/2a</td>
<td>a</td>
<td>1/2a</td>
</tr>
<tr>
<td>2</td>
<td>2a</td>
<td>3a</td>
<td>1a</td>
</tr>
<tr>
<td>3</td>
<td>4.5a</td>
<td>6a</td>
<td>1.5a</td>
</tr>
<tr>
<td>4</td>
<td>8a</td>
<td>10a</td>
<td>2a</td>
</tr>
<tr>
<td>5</td>
<td>12.5a</td>
<td>15a</td>
<td>2.5a</td>
</tr>
</tbody>
</table>

<p>ですね。差($d$)は$t$を使った式で表せることに気が付きます。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>d=\frac{1}{2}at
</code></pre></div></div>

<p>ジャンプ処理の冒頭に出てくる計算はこれだと思われますが違うかもしれません。この辺は別の解釈もあるようですので、コメント欄も参照して頂ければと思います。</p>

<h2>
<span id="ビヨーンからのシュッ" class="fragment"></span><a href="#%E3%83%93%E3%83%A8%E3%83%BC%E3%83%B3%E3%81%8B%E3%82%89%E3%81%AE%E3%82%B7%E3%83%A5%E3%83%83"><i class="fa fa-link"></i></a>ビヨーンからのシュッ</h2>

<p>ファミコンの座標系は左上が原点で右がプラス、下にプラスです。速度がマイナスの時には位置がマイナスされていくので上へと移動します。<br>
マリオの初期速度はマイナスで上昇しますが、加速度が加わり続けることで速度が+1されていきます。そのうちに速度が0になり、そしてプラスになりますが、そこに判定処理が入っています。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="c1">// 速度が0かプラスなら画面下へ進んでいるものとして落下状態の加速度に切り替える</span>
<span class="k">if</span> <span class="p">(</span><span class="n">VerticalSpeed</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">VerticalForce</span> <span class="p">=</span> <span class="n">VerticalForceFall</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ここの処理はコメントの通り、速度が0以上に転じたら落下用の加速度を書き換えるという意味です。この判定処理と設定値によって、上昇時と下降時は加速度の値が異なっています。具体的には、上昇時に比べると下降時は素早く落ちる挙動になっています。</p>

<p>擬音で表すと「ビヨ～ンからピタッとしてシュッと落ちてスタッと着地」って感じでしょうか。</p>

<p>ゲームの企画をする人（プランナー）がプログラマに「ジャンプはビヨーンって感じでゆっくり減速しながら上がっていくけど、着地は素早くシュッって感じでヨロシク」と説明した時に、それをプログラマが理解＆納得＆実装できるかどうかというのは重要なチームコミュニケーションだと思います。（ですが、もっと伝わるように伝えて欲しいと思うこともあります）</p>

<p>ゆっくり落下した方が着地点を狙い定めやすくなると思うのですが、スーマリでは、素早く着地させてプレイヤーに次のアクションを起こさせやすくしたのかもしれませんね。ただ、そのようにした理由は作った人にしかわかりません。教えて宮本さん！<br>
また、この挙動は、後で説明するジャンプキャンセルとも関係してきます。</p>

<p>それから、落下速度には限界値があり、4に設定されています。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="c1">// 速度の上限チェック</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">VerticalSpeed</span> <span class="p">&gt;=</span> <span class="n">DOWN_SPEED_LIMIT</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 謎の判定(これが無いと少しだけ計算に差が出る)</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">VerticalForceDecimalPart</span> <span class="p">&gt;=</span> <span class="m">0x80</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">VerticalSpeed</span> <span class="p">=</span> <span class="n">DOWN_SPEED_LIMIT</span><span class="p">;</span>
        <span class="n">VerticalForceDecimalPart</span> <span class="p">=</span> <span class="m">0x00</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>自然界での落下は速度に比例した空気抵抗を受けるため落下速度は次第に一定になりますから、スーマリの世界でも何かしらの抵抗力が働くようです。<br>
ではなぜ4なのかというと、これは推測ですが、ゲームのバランス調整によって出てきた数字というだけでなく、マリオと接触判定を持つ背景や敵は8×8ピクセルのブロックサイズ単位なので、めり込みやすり抜けの誤判定を無くしているのではないかなと思われます。雑な説明ですが。たぶん（ちゃんと調べてません）。</p>

<h2>
<span id="押し続けると高く飛ぶ" class="fragment"></span><a href="#%E6%8A%BC%E3%81%97%E7%B6%9A%E3%81%91%E3%82%8B%E3%81%A8%E9%AB%98%E3%81%8F%E9%A3%9B%E3%81%B6"><i class="fa fa-link"></i></a>押し続けると高く飛ぶ？</h2>

<p>スーマリでは、ジャンプの上昇中にジャンプボタンを離すと降下動作になるというコードになっています。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="c1">// Aボタンが離された&amp;上昇中？</span>
<span class="k">if</span> <span class="p">(</span><span class="n">jumpBtnPress</span> <span class="p">==</span> <span class="k">false</span> <span class="p">&amp;&amp;</span> <span class="n">JumpBtnPrevPress</span> <span class="p">==</span> <span class="k">true</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">VerticalPositionOrigin</span> <span class="p">-</span> <span class="n">VerticalPosition</span>  <span class="p">&gt;=</span> <span class="m">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 落下状態の加速度値に切り替える</span>
        <span class="n">VerticalForce</span> <span class="p">=</span> <span class="n">VerticalForceFall</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ゲームを遊んでいる時の感覚は「ボタンを長く押し続けるほど高く飛べる」ような気がしますし、取り扱い説明書でも「長い間押すと、高くジャンプします」と書かれています。<br>
プログラムでは、飛べる高さはジャンプ開始時点で確定していて、ジャンプボタンを離すと、そこから下に強く引っ張られる（落下用の加速度に切り替わる）という処理になっているのですね。</p>

<p><a href="https://camo.qiitausercontent.com/3e1e4b2130b929440a0e45ea711e0da5331cd8dd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3136373930342f34643762353563392d616365312d333838382d663036612d3935396537313964666236612e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F4d7b55c9-ace1-3888-f06a-959e719dfb6a.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=70b548e6af7d2f9dcf1c2176aa25cda9" alt="DSC05594_320.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167904/4d7b55c9-ace1-3888-f06a-959e719dfb6a.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F4d7b55c9-ace1-3888-f06a-959e719dfb6a.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=29d5f45e546963476c414c9b94870747 1x" loading="lazy"></a></p>

<h2>
<span id="ダッシュジャンプ" class="fragment"></span><a href="#%E3%83%80%E3%83%83%E3%82%B7%E3%83%A5%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97"><i class="fa fa-link"></i></a>ダッシュジャンプ</h2>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="c1">// ジャンプ開始時の初期パラメータ</span>
<span class="k">static</span> <span class="k">readonly</span> <span class="kt">byte</span><span class="p">[]</span>  <span class="n">VerticalForceDecimalPartData</span>    <span class="p">=</span> <span class="p">{</span> <span class="m">0x20</span><span class="p">,</span> <span class="m">0x20</span><span class="p">,</span> <span class="m">0x1e</span><span class="p">,</span> <span class="m">0x28</span><span class="p">,</span> <span class="m">0x28</span> <span class="p">};</span> <span class="c1">// 加速度の増加値</span>
<span class="k">static</span> <span class="k">readonly</span> <span class="kt">byte</span><span class="p">[]</span>  <span class="n">VerticalFallForceData</span>           <span class="p">=</span> <span class="p">{</span> <span class="m">0x70</span><span class="p">,</span> <span class="m">0x70</span><span class="p">,</span> <span class="m">0x60</span><span class="p">,</span> <span class="m">0x90</span><span class="p">,</span> <span class="m">0x90</span> <span class="p">};</span> <span class="c1">// 降下時の加速度</span>
<span class="k">static</span> <span class="k">readonly</span> <span class="kt">sbyte</span><span class="p">[]</span> <span class="n">InitialVerticalSpeedData</span>        <span class="p">=</span> <span class="p">{</span>   <span class="p">-</span><span class="m">4</span><span class="p">,</span>   <span class="p">-</span><span class="m">4</span><span class="p">,</span>   <span class="p">-</span><span class="m">4</span><span class="p">,</span>   <span class="p">-</span><span class="m">5</span><span class="p">,</span>   <span class="p">-</span><span class="m">5</span> <span class="p">};</span> <span class="c1">// 初速度</span>
<span class="k">static</span> <span class="k">readonly</span> <span class="kt">byte</span><span class="p">[]</span>  <span class="n">InitialVerticalForceData</span>        <span class="p">=</span> <span class="p">{</span> <span class="m">0x00</span><span class="p">,</span> <span class="m">0x00</span><span class="p">,</span> <span class="m">0x00</span><span class="p">,</span> <span class="m">0x00</span><span class="p">,</span> <span class="m">0x00</span> <span class="p">};</span> <span class="c1">// 初期加速度</span>
</code></pre></div></div>

<p>これらはジャンプ開始時の初期値です。<br>
初速度、初期加速度、・・・といったパラメータが並んでいます。初速度がマイナスなのは、先ほど説明した通りで座標系の都合です。<br>
パラメータの種類それぞれに5段階あり、それを決定しているのが以下の処理です。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="kt">int</span> <span class="n">idx</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">HorizontalSpeed</span> <span class="p">&gt;=</span> <span class="m">0x1c</span><span class="p">)</span> <span class="n">idx</span><span class="p">++;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">HorizontalSpeed</span> <span class="p">&gt;=</span> <span class="m">0x19</span><span class="p">)</span> <span class="n">idx</span><span class="p">++;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">HorizontalSpeed</span> <span class="p">&gt;=</span> <span class="m">0x10</span><span class="p">)</span> <span class="n">idx</span><span class="p">++;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">HorizontalSpeed</span> <span class="p">&gt;=</span> <span class="m">0x09</span><span class="p">)</span> <span class="n">idx</span><span class="p">++;</span>
</code></pre></div></div>

<p>HorizontalSpeedはマリオの横方向速度です。つまり、ジャンプ開始時のX方向の移動速度でジャンプの初期値が変わるということを意味しています。</p>

<p>スーマリの世界では、早く走ると高くジャンプすることが出来ます。</p>

<p>一般的には、ベクトルは軸の成分に分解することが出来ます。ベクトルのY方向の大きさは、X方向の大きさとは関係ありません。どんなに速く走っている車でも縦方向の速度は0です。止まってる車と、走っている車の屋根から真上へジャンプした時、ジャンプできる高さは変わらないのです。<br>
助走をしない垂直跳びと、走り高跳びではどちらが高く飛べるかというと・・・それは判定方法も判定箇所も違うので比べることは出来ません。計算対象が質点か剛体か連続体なのか時間で形状が変化するかで考え方も計算方法も大きく違いますが、スーマリのマリオは単純に点の座標だけを使って計算されています。それでも、</p>

<p>「助走をつけた方が高く飛べそうな気がするじゃん？」</p>

<p>ということになっています。正しさよりも、感覚的な動きに合わせるというのは、ゲーム作りで大切な事なのではないかなと個人的には思います。</p>

<p>ところで、ジャンプの初期パラメータですが、よくみると同じ数字が並んでいる列があり、実施的には3段階であることがわかります。判定は5段階ですが、挙動は3種類ということですね。なぜこうしたのかは、教えて宮本さん！案件です。<br>
ちなみに3段階というのは、停止時・一定速度での歩行時、Bダッシュの最大速度時みたいです。停止時よりも歩行時の方が落下の加速が緩やかなんですね。このような数値にした理由はわかりませんが、マリオの歩行時は1ブロック幅の穴に落ちないようになっているので、その調整なのかもしれません。（ちゃんと調べてません）</p>

<h2>
<span id="verlet積分" class="fragment"></span><a href="#verlet%E7%A9%8D%E5%88%86"><i class="fa fa-link"></i></a>Verlet積分？</h2>

<p>今回の調査の元になったブログに気になる記述があります。</p>

<p><a href="https://gemma.hatenadiary.org/entry/20080517/1211010942" rel="nofollow noopener" target="_blank">マリオのジャンプ実装法とVerlet積分</a></p>

<blockquote>
<p>「昔、何かの雑誌*1でマリオのジャンプの実装法を見た覚えが～」（bit誌1997年"アーケードゲームのテクノロジ"だったかな。情報求む）</p>
</blockquote>

<p>このBit誌の記事とは、アーケードゲームの<a href="https://ja.wikipedia.org/wiki/%E3%83%89%E3%83%B3%E3%82%AD%E3%83%BC%E3%82%B3%E3%83%B3%E3%82%B0" rel="nofollow noopener" target="_blank">ドンキーコング</a>を開発した<a href="https://ja.wikipedia.org/wiki/%E6%B1%A0%E4%B8%8A%E9%80%9A%E4%BF%A1%E6%A9%9F" rel="nofollow noopener" target="_blank">池上通信機</a>のメインプログラマさんによる当時の回顧録で、ドンキーコングの開発史が垣間見える貴重な資料です。</p>

<p><a href="https://camo.qiitausercontent.com/c5ccb9f17bb83b9abf7a4ef9c21951089ae579ee/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3136373930342f33316136383736322d363633372d643764302d366238342d3866373064303561306263372e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F31a68762-6637-d7d0-6b84-8f70d05a0bc7.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=395946e1c7ee51220c6ace04e9fa4191" alt="DSC05595_320.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167904/31a68762-6637-d7d0-6b84-8f70d05a0bc7.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F31a68762-6637-d7d0-6b84-8f70d05a0bc7.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8c309e39ddf61f7d5beaa9658e04ddad 1x" loading="lazy"></a></p>

<p>この記事中に、ジャンプの計算について触れている箇所がありましたので引用させて頂きます。</p>

<blockquote>
<p>まず、放物線の方程式を思い出してもらいたい。x方向は一定速度となり問題ないため、y方向のみを考えると次の式によって求められる。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>S(t)=v_0t-\frac{1}{2}gt^2
</code></pre></div></div>

<p>（$S$：物体の位置、$v_0$：初速度、$g$：重力加速度）</p>

<p>この方程式の一階差分（離散値であるから差分）をとる。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\begin{align}
S(t+1)-S(t)&amp;=v_0(t+1)-\frac{1}{2}g(t+1)^2-(v_0t-\frac{1}{2}gt^2)\\
&amp;=v_0-gt-\frac{1}{2}g
\end{align}
</code></pre></div></div>

<p>さらに、二階差分をとると</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>S(t+2)-2S(t+1)+S(t)=-g
</code></pre></div></div>

<p>となる。以上より、ある画面$t$（ゲームは1/60秒ごとに画面が更新している）における物体のy座標値$S(t)$は、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>S(0)=0 （基準位置）\\
S(1)=v_0-\frac{1}{2}g （初速度）\\
S(t+2)=2S(t+1)-S(t)-g
</code></pre></div></div>

<p>として求められる。したがって、一つ前の画面の値を2回加算し、前々の画面の値を引き、定数$g$を引けば得られることになる。$S(t)$を毎画面、正直に計算すれば3回の乗算が必要となるが、二階差分をとることにより、1回のシフトと2回の足し算で演算することができる。</p>
</blockquote>

<p>高校物理などで習う、落下位置の式には掛け算が出てきます。</p>

<p>$$y=v_0t+\frac{1}{2}gt^2$$</p>

<p>この式から、掛け算を無くす考え方ですね。これはドンキーコングの基板で採用されている低速なCPU（Z80 / CPUクロックは約3MHz）を使って計算を減らそうとして導き出された式です。</p>

<p>一般的に、<a href="https://qiita.com/search?q=verlet%E6%B3%95">verlet積分</a>は複数の物体の運動を近似的に計算するための手法の一つなのですが、この考え方でも同じ式になります。<br>
verlet積分の説明と実装例は以下のページが分かりやすいです。</p>

<p><a href="http://himaxoff.blog111.fc2.com/blog-entry-92.html" rel="nofollow noopener" target="_blank">ジャンプしたときの座標をVerlet法で求める</a></p>

<p>先のブログの誤解は、ドンキーコングの主人公はマリオではないということと、Bit誌の記事内容がスーマリではないことです。実はBit誌の記事でもマリオと書かれているのですが、アーケードゲームのドンキーコングは発表された時点では、プレイヤーキャラはジャンプマンと表記されるか、名前のない大工で、後にマリオと呼ばれることになるので、そこはマリオ違いなのでした。</p>

<p>ところで、ブログに出てくる式と、bit誌の記事の式では計算方法が違うように見えるのですが、実際のドンキーコングのジャンププログラムはどうなんでしょうか？気になりますね。気になったら調べてみるというものです。</p>

<h2>
<span id="ジャンプマンのジャンプ" class="fragment"></span><a href="#%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97%E3%83%9E%E3%83%B3%E3%81%AE%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97"><i class="fa fa-link"></i></a>ジャンプマンのジャンプ</h2>

<p>どのご家庭にもあると思われるドンキーコングの基板です。</p>

<p><a href="https://camo.qiitausercontent.com/322da8dfc34810b8a4ef2e542830f6b1d340ece4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3136373930342f64376661366538662d373533372d633734372d626630622d3239303634653838386130372e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2Fd7fa6e8f-7537-c747-bf0b-29064e888a07.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=aa8a59d53fe21338969ebc8e6a32be23" alt="DSC05590_320.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167904/d7fa6e8f-7537-c747-bf0b-29064e888a07.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2Fd7fa6e8f-7537-c747-bf0b-29064e888a07.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c0359e97873752dba362bc35be0b02d6 1x" loading="lazy"></a></p>

<p>基板上にROMが載っているので、ファミコンのカセット同様にメモリからプログラムを読むことが出来ます。オリジナルのコードを元にジャンプ周りの処理だけをC#＆Unity化してみました。</p>

<p>記事が長くなるので折りたたんでいます。↓</p>

<p><details><summary>ジャンプ</summary><div>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">AcDkJump</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">StartYpos</span><span class="p">;</span>

    <span class="k">private</span> <span class="kt">int</span> <span class="n">Counter</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">PosYi</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">PosYd</span><span class="p">;</span>

    <span class="k">static</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">DY_I</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">DY_D</span> <span class="p">=</span> <span class="m">0x48</span><span class="p">;</span>

    <span class="k">public</span> <span class="kt">int</span> <span class="n">PosY</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">PosYi</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 地面にいるかジャンプ中か</span>
    <span class="k">public</span> <span class="k">enum</span> <span class="n">MovementState</span>
    <span class="p">{</span>
        <span class="n">OnGround</span><span class="p">,</span>
        <span class="n">Jumping</span>
    <span class="p">}</span>
    <span class="k">private</span> <span class="n">MovementState</span> <span class="n">CurrentState</span> <span class="p">=</span> <span class="n">MovementState</span><span class="p">.</span><span class="n">OnGround</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">MovementState</span> <span class="n">PlayerState</span>
    <span class="p">{</span>
        <span class="k">get</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">CurrentState</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 1フレ前のジャンプボタンの押下状態</span>
    <span class="k">private</span> <span class="kt">bool</span> <span class="n">JumpBtnPrevPress</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

    <span class="c1">// constructor</span>
    <span class="k">public</span> <span class="nf">AcDkJump</span><span class="p">(</span><span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">StartYpos</span> <span class="p">=</span> <span class="n">y</span><span class="p">;</span>
        <span class="nf">ResetParam</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">ResetParam</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">CurrentState</span> <span class="p">=</span> <span class="n">MovementState</span><span class="p">.</span><span class="n">OnGround</span><span class="p">;</span>
        <span class="n">PosYi</span> <span class="p">=</span> <span class="n">StartYpos</span><span class="p">;</span>
        <span class="n">PosYd</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">Counter</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Movement</span><span class="p">(</span><span class="kt">bool</span> <span class="n">jumpBtnPress</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">jumpBtnPress</span> <span class="p">==</span> <span class="k">true</span> <span class="p">&amp;&amp;</span> <span class="n">JumpBtnPrevPress</span> <span class="p">==</span> <span class="k">false</span> <span class="p">&amp;&amp;</span> <span class="n">CurrentState</span> <span class="p">==</span> <span class="n">MovementState</span><span class="p">.</span><span class="n">OnGround</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">ResetParam</span><span class="p">();</span>
            <span class="n">CurrentState</span> <span class="p">=</span> <span class="n">MovementState</span><span class="p">.</span><span class="n">Jumping</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">prevYpos</span> <span class="p">=</span> <span class="n">PosYi</span><span class="p">;</span>

        <span class="nf">JumpUpdate</span><span class="p">();</span>

        <span class="c1">// 着地判定</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">PosYi</span> <span class="p">&gt;=</span> <span class="n">StartYpos</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">PosYi</span> <span class="p">=</span> <span class="n">StartYpos</span><span class="p">;</span>
            <span class="n">CurrentState</span> <span class="p">=</span> <span class="n">MovementState</span><span class="p">.</span><span class="n">OnGround</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">JumpBtnPrevPress</span> <span class="p">=</span> <span class="n">jumpBtnPress</span><span class="p">;</span>
<span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">JumpUpdate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">CurrentState</span> <span class="p">==</span> <span class="n">MovementState</span><span class="p">.</span><span class="n">OnGround</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

        <span class="c1">// 定数での上昇</span>
        <span class="n">PosYi</span> <span class="p">=</span> <span class="n">PosYi</span> <span class="p">-</span> <span class="n">DY_I</span><span class="p">;</span>
        <span class="n">PosYd</span> <span class="p">=</span> <span class="n">PosYd</span> <span class="p">-</span> <span class="n">DY_D</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">PosYd</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">PosYi</span><span class="p">--;</span>
            <span class="n">PosYd</span> <span class="p">=</span> <span class="m">256</span> <span class="p">+</span> <span class="n">PosYd</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// フレームカウンタ値から整数・少数を算出する</span>
        <span class="kt">int</span> <span class="n">Breg</span> <span class="p">=</span> <span class="p">(</span><span class="n">Counter</span> <span class="p">&gt;&gt;</span> <span class="m">4</span><span class="p">)</span> <span class="p">&amp;</span> <span class="m">0x0f</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">Creg</span> <span class="p">=</span> <span class="m">8</span> <span class="p">*</span> <span class="p">(</span><span class="n">Counter</span> <span class="p">*</span> <span class="m">2</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span> <span class="p">&amp;</span> <span class="m">0xff</span><span class="p">;</span>

        <span class="c1">// フレームカウンタ値による位置更新</span>
        <span class="n">PosYi</span> <span class="p">=</span> <span class="n">PosYi</span> <span class="p">+</span> <span class="n">Breg</span><span class="p">;</span>
        <span class="n">PosYd</span> <span class="p">=</span> <span class="n">PosYd</span> <span class="p">+</span> <span class="n">Creg</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">PosYd</span> <span class="p">&gt;=</span> <span class="m">256</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">PosYi</span><span class="p">++;</span>
            <span class="n">PosYd</span> <span class="p">=</span> <span class="n">PosYd</span> <span class="p">-</span> <span class="m">256</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Counter</span><span class="p">++;</span>
    <span class="p">}</span>

<span class="p">}</span>

</code></pre></div></div>

<p></p>
</div></details></p>

<p>流し読みすると、処理の最初に以前の位置を保持しているのでBit誌の記事の通りなのかなと思えるのですが、</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="kt">int</span> <span class="n">prevYpos</span> <span class="p">=</span> <span class="n">PosYi</span><span class="p">;</span>
</code></pre></div></div>

<p>なんと、この保持された値が使われている形跡がありません。では、どのようにしてジャンプの動きを作り出しているのかというと、フレームごとに更新されるカウンター値を元に値を算出して、移動位置を変化させています。これは一体・・・？</p>

<p>なぜ、Bit誌の記事と違うジャンプの実装がされているのかという謎だけが残りましたが、長くなりましたので、この辺で記事を書き終えたいと思います。</p>

<h2>
<span id="追記20191110" class="fragment"></span><a href="#%E8%BF%BD%E8%A8%9820191110"><i class="fa fa-link"></i></a>追記(2019/11/10)</h2>

<p>記事の公開後に様々なご意見をいただいたので、記事公開にあたって考えたことをポエムとしてnoteの方に“<a href="https://note.mu/morian/n/nb6bdaa31a418" rel="nofollow noopener" target="_blank">マリオジャンプの公開で考えたこと</a>”として書きました。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fmorian-bisco%2Fitems%2F4c659d9f940c7e3a2099&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fmorian-bisco%2Fitems%2F4c659d9f940c7e3a2099&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/morian-bisco/items/4c659d9f940c7e3a2099/likers" class="css-1iupg5d">1894</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">1178</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/4c659d9f940c7e3a2099/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/morian-bisco/items/4c659d9f940c7e3a2099/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/morian-bisco/items/4c659d9f940c7e3a2099/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/morian-bisco/items/4c659d9f940c7e3a2099/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/morian-bisco/items/4c659d9f940c7e3a2099.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-0e6dfef1-39de-4b64-a625-d10fb90d1404">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-a8f90917-a192-42ac-af5d-1a932dad6d9a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-a8f90917-a192-42ac-af5d-1a932dad6d9a">{}</script>
      
<div id="LoginModal-react-component-298582e7-f868-4d1b-a1dc-2c71b5a58223"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-298582e7-f868-4d1b-a1dc-2c71b5a58223">{}</script>
      
<div id="StockModal-react-component-966041a2-2f03-4f76-acc9-55562d66e4fd"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-966041a2-2f03-4f76-acc9-55562d66e4fd">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;loghGO4QRLYDJda55mg4nFH9/HOQPcK1LjRKUcuNGw/vtB9+JpFHxU8UFZ57HKAHHym6XrqzsPWIzX4TnAlBfg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e先日、\u003ca href=\"https://qiita.com/odanny/items/297f32a334c41410cc5d\" id=\"reference-abd77413a554f6a7398d\"\u003e気持ちのいいジャンプを目指して\u003c/a\u003eというQiitaの記事を見かけました。記事中では、マリオのジャンプについても触れられています。マリオというと、マリオブラザースやスーパーマリオブラザース等々、色々あるのですが、これはおそらくスーパーマリオブラザースの事だと思われます。ジャンプアクションゲームといったらスーマリですね。\u003c/p\u003e\n\n\u003cp\u003eそのマリオのジャンプの仕組みは「マリオの速度ベクトルを保存しておいて座標を計算するんじゃなくて～」と書かれていて、別サイトのブログへのリンクが張られています。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://gemma.hatenadiary.org/entry/20080517/1211010942\" rel=\"nofollow noopener\" target=\"_blank\"\u003eマリオのジャンプ実装法とVerlet積分\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eただ、この記述については不正確であるという別のブログもあったりします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://blog.game-kids.net/haruzakki/entry-769.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eマリオの完コピvol.28 ジャンプの解析と修正\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eホントのところはどうなんでしょうか？世界で最も有名なゲームのジャンプがどのように処理されているのか気になったので調べてみることにしました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"原典にあたる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8E%9F%E5%85%B8%E3%81%AB%E3%81%82%E3%81%9F%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e原典にあたる\u003c/h2\u003e\n\n\u003cp\u003eさて、その調べ方ですが、オリジナルのプログラムを見ればいいのですから話はカンタンです。え？肝心のプログラムがどこにあるかって？それはカセットの中に決まってるじゃないですか。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/6fbee07eb9b937e969705c352a18f64c22884abc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3136373930342f66663732666331302d626535372d353563372d316533352d6333623333656231303038652e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2Fff72fc10-be57-55c7-1e35-c3b33eb1008e.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f0eb57ee05ba773dc00ea1c20ff04829\" alt=\"DSC05587_320.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167904/ff72fc10-be57-55c7-1e35-c3b33eb1008e.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2Fff72fc10-be57-55c7-1e35-c3b33eb1008e.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c09b46261856f7a59aa166c403f86963 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e皆さんのご家庭にもある、ファミコンとスーマリのカセットです。\u003c/p\u003e\n\n\u003cp\u003eこのカセットの端子には、アドレスバスとデータバスと制御用信号線があり、スーマリの場合は、それらが素直にカートリッジ内部のROMに接続されています。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/074ba0dacc7109af737c1a7e45399c85b4c5fa3c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3136373930342f39663166383934352d393235352d633563612d383338652d3562376331626361653064322e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F9f1f8945-9255-c5ca-838e-5b7c1bcae0d2.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2f7da0883d3b816f1739ab376afb13bb\" alt=\"DSC05593_320.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167904/9f1f8945-9255-c5ca-838e-5b7c1bcae0d2.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F9f1f8945-9255-c5ca-838e-5b7c1bcae0d2.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=147644afa7e93de9d6298278fc85798e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://img.atwikiimg.com/www34.atwiki.jp/cc65/pub/dsoft/cart.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eファミコンカートリッジ自作計画\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれがどういうことかというと、アドレスバスのPRG-A0～A14が15ビットのメモリアドレスを指していることになります。また、データバスはD0～D7の8本なので8ビットです。つまり、1つのアドレスごとに8ビット（一般的に1バイト）のデータを持つ32KByteのROMになります。\u003c/p\u003e\n\n\u003cp\u003e高級言語の配列で表現すると、\u003cbr\u003e\n\u003ccode\u003ereadonly byte ROM[32768] = {バイトデータ...}}\u003c/code\u003e\u003cbr\u003e\nという感じです。特にROMへのアクセスを困難にするような仕組みは施されていません。\u003c/p\u003e\n\n\u003cp\u003e実際に電気信号として読むには、制御信号を上手くハンドリングする必要がありますが、アドレスバスとデータバスの端子の電圧は+5Vか0Vなので、ArduinoやRaspberryPiとかを上手く使えば読込み出来ます。そうして読み込んだ内容はこれがそのままプログラムということになります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/1c97d0035f2ea9cb2ccf80a27bb1d04b9cfdc87d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3136373930342f36663638356263332d626638662d653233372d373661642d3237336239326663393265382e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F6f685bc3-bf8f-e237-76ad-273b92fc92e8.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e57c3e39c6f6bf0dfe22e82ae4f2ea2f\" alt=\"dump.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167904/6f685bc3-bf8f-e237-76ad-273b92fc92e8.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F6f685bc3-bf8f-e237-76ad-273b92fc92e8.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d15e2663c0aefd2c4b2cd07ef11af4b4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eファミコンのCPUは\u003ca href=\"https://ja.wikipedia.org/wiki/MOS_6502\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMOS 6502\u003c/a\u003e互換品で、アーキテクチャやコードの命令セットも\u003ca href=\"http://hp.vector.co.jp/authors/VA042397/nes/6502.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eほぼ同じ\u003c/a\u003eです。\u003c/p\u003e\n\n\u003cp\u003eあとは、命令のコードと機能を理解して、プログラムをひたすら読み進めていくと、何をしているのか解るわけです。理屈だけは簡単です。（実際にやってみたら簡単じゃなかった・・・）\u003c/p\u003e\n\n\u003cp\u003e前置きが長くなりましたが、この記事の本来の目的であるジャンプ処理の仕組みは、日本語で動作内容を書くよりも高級言語で表した方が解り易いでしょうし、動作検証もしておきたかったので、流行りのC#＆Unityに置き換えてみました。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/moriyan6001/FcMario\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGitHub - moriyan6001/FcMario\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e実際のスーマリのプログラムでは、ジャンプ処理中に様々な挙動の判定や演算をしてたり、ジャンプルーチンはマリオだけでなく他のキャラの動作にも使われているようですが、その辺は省いています。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e(注) 以下、プログラムの理解不足や変換ミス、カセットのバージョン違いがあるかもしれませんので、その辺は緩く見てもらえればと思います。\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ジャンプ部分のコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97%E9%83%A8%E5%88%86%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eジャンプ部分のコード\u003c/h2\u003e\n\n\u003cp\u003e記事が長くなるので折りたたんでいます。↓\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eジャンプ処理コード\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFcSmb\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalPositionOrigin\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// ジャンプ開始時の位置\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e           \u003cspan class=\"c1\"\u003e// 現在位置\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalSpeed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e              \u003cspan class=\"c1\"\u003e// 速度\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForce\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e              \u003cspan class=\"c1\"\u003e// 現在の加速度\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForceFall\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e          \u003cspan class=\"c1\"\u003e// 降下時の加速度\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// 加速度の増加値\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eCorrectionValue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e            \u003cspan class=\"c1\"\u003e// 累積計算での補正値？\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eHorizontalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e00\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e       \u003cspan class=\"c1\"\u003e// 横方向速度\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// ジャンプ開始時の初期パラメータ\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e  \u003cspan class=\"n\"\u003eVerticalForceDecimalPartData\u003c/span\u003e    \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e0x20\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x20\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1e\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x28\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x28\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 加速度の増加値\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e  \u003cspan class=\"n\"\u003eVerticalFallForceData\u003c/span\u003e           \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e0x70\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x70\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x60\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x90\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x90\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 降下時の加速度\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003esbyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eInitialVerticalSpeedData\u003c/span\u003e        \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e   \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e   \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e   \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e   \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e   \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 初速度\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e  \u003cspan class=\"n\"\u003eInitialVerticalForceData\u003c/span\u003e        \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 初期加速度\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 落下時の最大速度\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003esbyte\u003c/span\u003e \u003cspan class=\"n\"\u003eDOWN_SPEED_LIMIT\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x04\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 1フレ前のジャンプボタンの押下状態\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eJumpBtnPrevPress\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 地面にいるかジャンプ中か\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eOnGround\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eJumping\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOnGround\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eResetParam\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003einitVerticalPos\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVerticalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVerticalForce\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVerticalForceFall\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOnGround\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCorrectionValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eVerticalPosition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einitVerticalPos\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ePosY\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//set { VerticalPosition = value; }\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e \u003cspan class=\"n\"\u003eGetPlayerState\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMovement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003ejumpBtnPress\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eJumpCheck\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejumpBtnPress\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eMoveProcess\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejumpBtnPress\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eJumpBtnPrevPress\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ejumpBtnPress\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eJumpCheck\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003ejumpBtnPress\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 初めてジャンプボタンが押された？\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejumpBtnPress\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJumpBtnPrevPress\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 地面上にいる状態？\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// ジャンプ開始準備\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003ePreparingJump\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ePreparingJump\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVerticalPositionOrigin\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eJumping\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHorizontalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1c\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHorizontalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x19\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHorizontalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHorizontalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x09\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eVerticalForce\u003c/span\u003e               \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForceDecimalPartData\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVerticalForceFall\u003c/span\u003e           \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalFallForceData\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e    \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eInitialVerticalForceData\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVerticalSpeed\u003c/span\u003e               \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eInitialVerticalSpeedData\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveProcess\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003ejumpBtnPress\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 速度が0かプラスなら画面下へ進んでいるものとして落下状態の加速度に切り替える\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVerticalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVerticalForce\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForceFall\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Aボタンが離された\u0026amp;上昇中？\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejumpBtnPress\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eJumpBtnPrevPress\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVerticalPositionOrigin\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalPosition\u003c/span\u003e  \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 落下状態の加速度値に切り替える\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eVerticalForce\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForceFall\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"nf\"\u003ePhysics\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ePhysics\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 累積計算での補正値っぽい\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCorrectionValue\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCorrectionValue\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCorrectionValue\u003c/span\u003e \u003cspan class=\"p\"\u003e-=\u003c/span\u003e \u003cspan class=\"m\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 現在位置に速度を加算 (累積計算での補正値も加算)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVerticalPosition\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ecy\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 加速度の固定少数点部への加算\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 1バイトをオーバーフローしたら、速度が加算される。その時、加速度の整数部は0に戻される\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForce\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e \u003cspan class=\"p\"\u003e-=\u003c/span\u003e \u003cspan class=\"m\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eVerticalSpeed\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 速度の上限チェック\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"n\"\u003eDOWN_SPEED_LIMIT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 謎の判定\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x80\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eVerticalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDOWN_SPEED_LIMIT\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"位置と速度と加速度\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%8D%E7%BD%AE%E3%81%A8%E9%80%9F%E5%BA%A6%E3%81%A8%E5%8A%A0%E9%80%9F%E5%BA%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e位置と速度と加速度\u003c/h2\u003e\n\n\u003cp\u003eジャンプ処理はコードのまま読んでもらえれば「なるほどそうなのね」で終わるのですが、せっかくなのでもう少し説明しようと思います。\u003c/p\u003e\n\n\u003cp\u003eそのための予備知識として、ゲーム作りの物理本に出てきそうな、位置と速度と加速度の関係を簡潔に説明します。\u003c/p\u003e\n\n\u003cp\u003eスーマリジャンプの処理は基本的に、位置と速度と加速度の式です。位置は速度の時間による累積、速度は加速度の時間による累積という、ニュートンのアレです。\u003c/p\u003e\n\n\u003cp\u003e速度の定義は一定時間あたりの移動量なので、位置に速度を足したら次の位置になります。これが等速度運動ですね。ファミコンのゲーム画面であれば、速度は1フレーム当たりに移動するピクセル量なので、ピクセル/フレームが単位になります。1フレームで1ピクセル動く場合、1ピクセル/フレームです。スーマリは実時間に関係しないので、Δtを乗算するみたいなことはしません。1フレームあたりの処理が間に合わないと実時間あたりの速度にも影響が出ます。\u003c/p\u003e\n\n\u003cp\u003e速度が時間によって変化する場合は、速度の変化分が加速度として加わっていきます。いわゆる等加速度運動です。1フレームあたりに速度が1フレーム/ピクセルだけ増えるのであれば、その加速度は1ピクセル/フレーム^2になります。重力のある空間では、重力という力が加速度と関係してきますから、重力が加速度として速度に加わり、それが物体の位置を変化させるという考え方ですね。\u003c/p\u003e\n\n\u003cp\u003eまとめると、y：位置、v：速度、a：加速度の時は\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003ey = y + v\\\\\nv = v + a\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eという式になります。(数学的には不適切な表現ですが気にしないでください)\u003c/p\u003e\n\n\u003cp\u003e高校くらいで学ぶ物理では、時間tにおける位置yを求める式なんかが出てきますが、\u003c/p\u003e\n\n\u003cp\u003e$$y = 1/2 * a * t^2$$\u003c/p\u003e\n\n\u003cp\u003eこの計算式には掛け算が含まれています。ファミコンのCPUは動作速度が1.79MHzで掛け算命令なんてありません。また、変数（レジスタ）も8ビットの整数型だけです。このCPUに掛け算をさせるのは重い処理になります。また、スーマリはジャンプ中でもプレイヤーの操作によってジャンプの挙動が変化するので、マリオの位置を方程式を用いて事前に計算することは意味がありませんし、現在位置から1フレーム後の位置を算出するには不便な式です。\u003cbr\u003e\n位置と速度と加速度の考え方であれば、掛け算を使わずに足し算を数回するだけで、位置の変化を計算することが出来ますから、何かと都合がいいのです。\u003c/p\u003e\n\n\u003cp\u003eこの計算をしているのが、先のプログラムのPhysics()というメソッドです。ここで、位置と速度をフレームごとに計算しています。\u003c/p\u003e\n\n\u003cp\u003eところで、プログラムを改めて見ると、素直に速度に加速度を加えてはいません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"c1\"\u003e// 加速度の固定少数点部への加算\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 1バイトをオーバーフローしたら、速度が加算される\u003c/span\u003e\n\u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForce\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e \u003cspan class=\"p\"\u003e-=\u003c/span\u003e \u003cspan class=\"m\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eVerticalSpeed\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e毎フレームごとに加速度の変数に一定の値を加算していき、それが256を超えたら速度を+1しています。要するに、1ビットの整数部 + 8ビットの小数部の変数があり、整数部分が1になったら速度を+1するということです。（ただし、速度を+1した時に整数部を0に戻しています）\u003c/p\u003e\n\n\u003cp\u003eファミコンにしてもUnityにしても、画面の更新頻度（一定間隔毎の処理頻度）は基本的に1秒当たり約60回です。“整数”を使って位置や速度を計算すると、1フレーム当たり1ピクセルというのが最低速度になります。これは加速度も同様です。\u003cbr\u003e\nただ、ゲームでは、それよりも遅い速度や加速度を使いたい時もあるわけです。1秒かけて1ピクセル移動したいような、要するに、速度が0.1ピクセル/フレームみたいなことです。\u003cbr\u003e\nそこで、整数だけで疑似的に少数表現をするために、スーマリでは加速度を1ビット、加速度の増加分を1バイトとして計算して、加速度が256を超えたら速度を+1するという方式をとっています。\u003c/p\u003e\n\n\u003cp\u003e上記のプログラムでは解り易さ優先でif命令を使っていますが、6502には8ビット演算をするとオーバーフローしたかどうかを表す1ビットのフラグ変数があり、そのフラグ変数の値も加える加算命令もあるので、2回の足し算命令で済んでしまいます。（C#でも計算式だけで記述できます）\u003c/p\u003e\n\n\u003cp\u003e最初、ここの処理を見た時には、加速度は固定少数点表記か、加速度の増加値である\u003ca href=\"https://ja.wikipedia.org/wiki/%E8%BA%8D%E5%BA%A6\" rel=\"nofollow noopener\" target=\"_blank\"\u003e加加速度（躍度）\u003c/a\u003eなのかなと思ったのですが、ちょっと違いますね。\u003c/p\u003e\n\n\u003cp\u003eその他、ここまでまるっと無視してきましたが、Physics()メソッドの最初に\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 累積計算での補正値っぽい\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eMysteryAdjustment\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMysteryAdjustment\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMysteryAdjustment\u003c/span\u003e \u003cspan class=\"p\"\u003e-=\u003c/span\u003e \u003cspan class=\"m\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e加速度の小数部分の累積分を位置に加えるという処理が入っています。\u003c/p\u003e\n\n\u003cp\u003e2011/11/16追記：記事公開当初は謎な処理として扱っていたのですが、なんとなくわかったような気がしなくもないのでざっと説明します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003ey=\\frac{1}{2}at^2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの式は積分によって導き出されます。（定数項と単位は省略してます）\u003c/p\u003e\n\n\u003cp\u003eまた、ここまでに、加算だけで計算する方法を説明してきました。（プログラムっぽい書き方なので数学的には単位と表記がおかしいのですが気にしないでください）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003ev=v+a \\\\\ny=y+v \\\\\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれらを試しに5秒後・・・5フレーム目でもいいのですが、実際に計算してみて比較してみます。時間をtとしています。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003et\u003c/th\u003e\n\u003cth\u003ey=1/2at^2\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e1/2a\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e2a\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003e4.5a\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003ctd\u003e8a\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e5\u003c/td\u003e\n\u003ctd\u003e12.5a\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003et\u003c/th\u003e\n\u003cth\u003ev+=a\u003c/th\u003e\n\u003cth\u003ey+=v\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003ea\u003c/td\u003e\n\u003ctd\u003ea\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e2a\u003c/td\u003e\n\u003ctd\u003e3a\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003e3a\u003c/td\u003e\n\u003ctd\u003e6a\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003ctd\u003e4a\u003c/td\u003e\n\u003ctd\u003e10a\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e5\u003c/td\u003e\n\u003ctd\u003e5a\u003c/td\u003e\n\u003ctd\u003e15a\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eそれぞれの計算で導き出されるyの値がズレています。どれくらいずれているのか並べて比べてみると\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003et\u003c/th\u003e\n\u003cth\u003ey=1/2at^2\u003c/th\u003e\n\u003cth\u003ey+=v\u003c/th\u003e\n\u003cth\u003e差(d)\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e1/2a\u003c/td\u003e\n\u003ctd\u003ea\u003c/td\u003e\n\u003ctd\u003e1/2a\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e2a\u003c/td\u003e\n\u003ctd\u003e3a\u003c/td\u003e\n\u003ctd\u003e1a\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003e4.5a\u003c/td\u003e\n\u003ctd\u003e6a\u003c/td\u003e\n\u003ctd\u003e1.5a\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003ctd\u003e8a\u003c/td\u003e\n\u003ctd\u003e10a\u003c/td\u003e\n\u003ctd\u003e2a\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e5\u003c/td\u003e\n\u003ctd\u003e12.5a\u003c/td\u003e\n\u003ctd\u003e15a\u003c/td\u003e\n\u003ctd\u003e2.5a\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eですね。差($d$)は$t$を使った式で表せることに気が付きます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003ed=\\frac{1}{2}at\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eジャンプ処理の冒頭に出てくる計算はこれだと思われますが違うかもしれません。この辺は別の解釈もあるようですので、コメント欄も参照して頂ければと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ビヨーンからのシュッ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%93%E3%83%A8%E3%83%BC%E3%83%B3%E3%81%8B%E3%82%89%E3%81%AE%E3%82%B7%E3%83%A5%E3%83%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eビヨーンからのシュッ\u003c/h2\u003e\n\n\u003cp\u003eファミコンの座標系は左上が原点で右がプラス、下にプラスです。速度がマイナスの時には位置がマイナスされていくので上へと移動します。\u003cbr\u003e\nマリオの初期速度はマイナスで上昇しますが、加速度が加わり続けることで速度が+1されていきます。そのうちに速度が0になり、そしてプラスになりますが、そこに判定処理が入っています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 速度が0かプラスなら画面下へ進んでいるものとして落下状態の加速度に切り替える\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVerticalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eVerticalForce\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForceFall\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eここの処理はコメントの通り、速度が0以上に転じたら落下用の加速度を書き換えるという意味です。この判定処理と設定値によって、上昇時と下降時は加速度の値が異なっています。具体的には、上昇時に比べると下降時は素早く落ちる挙動になっています。\u003c/p\u003e\n\n\u003cp\u003e擬音で表すと「ビヨ～ンからピタッとしてシュッと落ちてスタッと着地」って感じでしょうか。\u003c/p\u003e\n\n\u003cp\u003eゲームの企画をする人（プランナー）がプログラマに「ジャンプはビヨーンって感じでゆっくり減速しながら上がっていくけど、着地は素早くシュッって感じでヨロシク」と説明した時に、それをプログラマが理解＆納得＆実装できるかどうかというのは重要なチームコミュニケーションだと思います。（ですが、もっと伝わるように伝えて欲しいと思うこともあります）\u003c/p\u003e\n\n\u003cp\u003eゆっくり落下した方が着地点を狙い定めやすくなると思うのですが、スーマリでは、素早く着地させてプレイヤーに次のアクションを起こさせやすくしたのかもしれませんね。ただ、そのようにした理由は作った人にしかわかりません。教えて宮本さん！\u003cbr\u003e\nまた、この挙動は、後で説明するジャンプキャンセルとも関係してきます。\u003c/p\u003e\n\n\u003cp\u003eそれから、落下速度には限界値があり、4に設定されています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 速度の上限チェック\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"n\"\u003eDOWN_SPEED_LIMIT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 謎の判定(これが無いと少しだけ計算に差が出る)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x80\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVerticalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDOWN_SPEED_LIMIT\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVerticalForceDecimalPart\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e自然界での落下は速度に比例した空気抵抗を受けるため落下速度は次第に一定になりますから、スーマリの世界でも何かしらの抵抗力が働くようです。\u003cbr\u003e\nではなぜ4なのかというと、これは推測ですが、ゲームのバランス調整によって出てきた数字というだけでなく、マリオと接触判定を持つ背景や敵は8×8ピクセルのブロックサイズ単位なので、めり込みやすり抜けの誤判定を無くしているのではないかなと思われます。雑な説明ですが。たぶん（ちゃんと調べてません）。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"押し続けると高く飛ぶ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8A%BC%E3%81%97%E7%B6%9A%E3%81%91%E3%82%8B%E3%81%A8%E9%AB%98%E3%81%8F%E9%A3%9B%E3%81%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e押し続けると高く飛ぶ？\u003c/h2\u003e\n\n\u003cp\u003eスーマリでは、ジャンプの上昇中にジャンプボタンを離すと降下動作になるというコードになっています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Aボタンが離された\u0026amp;上昇中？\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejumpBtnPress\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eJumpBtnPrevPress\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVerticalPositionOrigin\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalPosition\u003c/span\u003e  \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 落下状態の加速度値に切り替える\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVerticalForce\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVerticalForceFall\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eゲームを遊んでいる時の感覚は「ボタンを長く押し続けるほど高く飛べる」ような気がしますし、取り扱い説明書でも「長い間押すと、高くジャンプします」と書かれています。\u003cbr\u003e\nプログラムでは、飛べる高さはジャンプ開始時点で確定していて、ジャンプボタンを離すと、そこから下に強く引っ張られる（落下用の加速度に切り替わる）という処理になっているのですね。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/3e1e4b2130b929440a0e45ea711e0da5331cd8dd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3136373930342f34643762353563392d616365312d333838382d663036612d3935396537313964666236612e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F4d7b55c9-ace1-3888-f06a-959e719dfb6a.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=70b548e6af7d2f9dcf1c2176aa25cda9\" alt=\"DSC05594_320.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167904/4d7b55c9-ace1-3888-f06a-959e719dfb6a.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F4d7b55c9-ace1-3888-f06a-959e719dfb6a.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=29d5f45e546963476c414c9b94870747 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ダッシュジャンプ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%80%E3%83%83%E3%82%B7%E3%83%A5%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eダッシュジャンプ\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// ジャンプ開始時の初期パラメータ\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e  \u003cspan class=\"n\"\u003eVerticalForceDecimalPartData\u003c/span\u003e    \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e0x20\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x20\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1e\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x28\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x28\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 加速度の増加値\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e  \u003cspan class=\"n\"\u003eVerticalFallForceData\u003c/span\u003e           \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e0x70\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x70\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x60\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x90\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x90\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 降下時の加速度\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003esbyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eInitialVerticalSpeedData\u003c/span\u003e        \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e   \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e   \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e   \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e   \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e   \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 初速度\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e  \u003cspan class=\"n\"\u003eInitialVerticalForceData\u003c/span\u003e        \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 初期加速度\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれらはジャンプ開始時の初期値です。\u003cbr\u003e\n初速度、初期加速度、・・・といったパラメータが並んでいます。初速度がマイナスなのは、先ほど説明した通りで座標系の都合です。\u003cbr\u003e\nパラメータの種類それぞれに5段階あり、それを決定しているのが以下の処理です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHorizontalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1c\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHorizontalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x19\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHorizontalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHorizontalSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x09\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eHorizontalSpeedはマリオの横方向速度です。つまり、ジャンプ開始時のX方向の移動速度でジャンプの初期値が変わるということを意味しています。\u003c/p\u003e\n\n\u003cp\u003eスーマリの世界では、早く走ると高くジャンプすることが出来ます。\u003c/p\u003e\n\n\u003cp\u003e一般的には、ベクトルは軸の成分に分解することが出来ます。ベクトルのY方向の大きさは、X方向の大きさとは関係ありません。どんなに速く走っている車でも縦方向の速度は0です。止まってる車と、走っている車の屋根から真上へジャンプした時、ジャンプできる高さは変わらないのです。\u003cbr\u003e\n助走をしない垂直跳びと、走り高跳びではどちらが高く飛べるかというと・・・それは判定方法も判定箇所も違うので比べることは出来ません。計算対象が質点か剛体か連続体なのか時間で形状が変化するかで考え方も計算方法も大きく違いますが、スーマリのマリオは単純に点の座標だけを使って計算されています。それでも、\u003c/p\u003e\n\n\u003cp\u003e「助走をつけた方が高く飛べそうな気がするじゃん？」\u003c/p\u003e\n\n\u003cp\u003eということになっています。正しさよりも、感覚的な動きに合わせるというのは、ゲーム作りで大切な事なのではないかなと個人的には思います。\u003c/p\u003e\n\n\u003cp\u003eところで、ジャンプの初期パラメータですが、よくみると同じ数字が並んでいる列があり、実施的には3段階であることがわかります。判定は5段階ですが、挙動は3種類ということですね。なぜこうしたのかは、教えて宮本さん！案件です。\u003cbr\u003e\nちなみに3段階というのは、停止時・一定速度での歩行時、Bダッシュの最大速度時みたいです。停止時よりも歩行時の方が落下の加速が緩やかなんですね。このような数値にした理由はわかりませんが、マリオの歩行時は1ブロック幅の穴に落ちないようになっているので、その調整なのかもしれません。（ちゃんと調べてません）\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"verlet積分\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#verlet%E7%A9%8D%E5%88%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVerlet積分？\u003c/h2\u003e\n\n\u003cp\u003e今回の調査の元になったブログに気になる記述があります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://gemma.hatenadiary.org/entry/20080517/1211010942\" rel=\"nofollow noopener\" target=\"_blank\"\u003eマリオのジャンプ実装法とVerlet積分\u003c/a\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e「昔、何かの雑誌*1でマリオのジャンプの実装法を見た覚えが～」（bit誌1997年\"アーケードゲームのテクノロジ\"だったかな。情報求む）\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eこのBit誌の記事とは、アーケードゲームの\u003ca href=\"https://ja.wikipedia.org/wiki/%E3%83%89%E3%83%B3%E3%82%AD%E3%83%BC%E3%82%B3%E3%83%B3%E3%82%B0\" rel=\"nofollow noopener\" target=\"_blank\"\u003eドンキーコング\u003c/a\u003eを開発した\u003ca href=\"https://ja.wikipedia.org/wiki/%E6%B1%A0%E4%B8%8A%E9%80%9A%E4%BF%A1%E6%A9%9F\" rel=\"nofollow noopener\" target=\"_blank\"\u003e池上通信機\u003c/a\u003eのメインプログラマさんによる当時の回顧録で、ドンキーコングの開発史が垣間見える貴重な資料です。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/c5ccb9f17bb83b9abf7a4ef9c21951089ae579ee/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3136373930342f33316136383736322d363633372d643764302d366238342d3866373064303561306263372e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F31a68762-6637-d7d0-6b84-8f70d05a0bc7.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=395946e1c7ee51220c6ace04e9fa4191\" alt=\"DSC05595_320.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167904/31a68762-6637-d7d0-6b84-8f70d05a0bc7.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2F31a68762-6637-d7d0-6b84-8f70d05a0bc7.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8c309e39ddf61f7d5beaa9658e04ddad 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこの記事中に、ジャンプの計算について触れている箇所がありましたので引用させて頂きます。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eまず、放物線の方程式を思い出してもらいたい。x方向は一定速度となり問題ないため、y方向のみを考えると次の式によって求められる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eS(t)=v_0t-\\frac{1}{2}gt^2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e（$S$：物体の位置、$v_0$：初速度、$g$：重力加速度）\u003c/p\u003e\n\n\u003cp\u003eこの方程式の一階差分（離散値であるから差分）をとる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\begin{align}\nS(t+1)-S(t)\u0026amp;=v_0(t+1)-\\frac{1}{2}g(t+1)^2-(v_0t-\\frac{1}{2}gt^2)\\\\\n\u0026amp;=v_0-gt-\\frac{1}{2}g\n\\end{align}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eさらに、二階差分をとると\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eS(t+2)-2S(t+1)+S(t)=-g\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとなる。以上より、ある画面$t$（ゲームは1/60秒ごとに画面が更新している）における物体のy座標値$S(t)$は、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eS(0)=0 （基準位置）\\\\\nS(1)=v_0-\\frac{1}{2}g （初速度）\\\\\nS(t+2)=2S(t+1)-S(t)-g\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとして求められる。したがって、一つ前の画面の値を2回加算し、前々の画面の値を引き、定数$g$を引けば得られることになる。$S(t)$を毎画面、正直に計算すれば3回の乗算が必要となるが、二階差分をとることにより、1回のシフトと2回の足し算で演算することができる。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e高校物理などで習う、落下位置の式には掛け算が出てきます。\u003c/p\u003e\n\n\u003cp\u003e$$y=v_0t+\\frac{1}{2}gt^2$$\u003c/p\u003e\n\n\u003cp\u003eこの式から、掛け算を無くす考え方ですね。これはドンキーコングの基板で採用されている低速なCPU（Z80 / CPUクロックは約3MHz）を使って計算を減らそうとして導き出された式です。\u003c/p\u003e\n\n\u003cp\u003e一般的に、\u003ca href=\"https://qiita.com/search?q=verlet%E6%B3%95\"\u003everlet積分\u003c/a\u003eは複数の物体の運動を近似的に計算するための手法の一つなのですが、この考え方でも同じ式になります。\u003cbr\u003e\nverlet積分の説明と実装例は以下のページが分かりやすいです。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://himaxoff.blog111.fc2.com/blog-entry-92.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eジャンプしたときの座標をVerlet法で求める\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e先のブログの誤解は、ドンキーコングの主人公はマリオではないということと、Bit誌の記事内容がスーマリではないことです。実はBit誌の記事でもマリオと書かれているのですが、アーケードゲームのドンキーコングは発表された時点では、プレイヤーキャラはジャンプマンと表記されるか、名前のない大工で、後にマリオと呼ばれることになるので、そこはマリオ違いなのでした。\u003c/p\u003e\n\n\u003cp\u003eところで、ブログに出てくる式と、bit誌の記事の式では計算方法が違うように見えるのですが、実際のドンキーコングのジャンププログラムはどうなんでしょうか？気になりますね。気になったら調べてみるというものです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ジャンプマンのジャンプ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97%E3%83%9E%E3%83%B3%E3%81%AE%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eジャンプマンのジャンプ\u003c/h2\u003e\n\n\u003cp\u003eどのご家庭にもあると思われるドンキーコングの基板です。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/322da8dfc34810b8a4ef2e542830f6b1d340ece4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3136373930342f64376661366538662d373533372d633734372d626630622d3239303634653838386130372e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2Fd7fa6e8f-7537-c747-bf0b-29064e888a07.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=aa8a59d53fe21338969ebc8e6a32be23\" alt=\"DSC05590_320.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167904/d7fa6e8f-7537-c747-bf0b-29064e888a07.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2Fd7fa6e8f-7537-c747-bf0b-29064e888a07.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c0359e97873752dba362bc35be0b02d6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e基板上にROMが載っているので、ファミコンのカセット同様にメモリからプログラムを読むことが出来ます。オリジナルのコードを元にジャンプ周りの処理だけをC#＆Unity化してみました。\u003c/p\u003e\n\n\u003cp\u003e記事が長くなるので折りたたんでいます。↓\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eジャンプ\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAcDkJump\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eStartYpos\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eCounter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ePosYi\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ePosYd\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eDY_I\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eDY_D\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x48\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ePosY\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ePosYi\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 地面にいるかジャンプ中か\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eOnGround\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eJumping\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOnGround\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayerState\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 1フレ前のジャンプボタンの押下状態\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eJumpBtnPrevPress\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// constructor\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eAcDkJump\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eStartYpos\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eResetParam\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eResetParam\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOnGround\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePosYi\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eStartYpos\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePosYd\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCounter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMovement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003ejumpBtnPress\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejumpBtnPress\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eJumpBtnPrevPress\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOnGround\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eResetParam\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eJumping\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eprevYpos\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePosYi\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"nf\"\u003eJumpUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 着地判定\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePosYi\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"n\"\u003eStartYpos\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ePosYi\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eStartYpos\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOnGround\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eJumpBtnPrevPress\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ejumpBtnPress\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eJumpUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eMovementState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOnGround\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 定数での上昇\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePosYi\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePosYi\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eDY_I\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePosYd\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePosYd\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eDY_D\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePosYd\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ePosYi\u003c/span\u003e\u003cspan class=\"p\"\u003e--;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ePosYd\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e256\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ePosYd\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// フレームカウンタ値から整数・少数を算出する\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eBreg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCounter\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eCreg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCounter\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"m\"\u003e0xff\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// フレームカウンタ値による位置更新\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePosYi\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePosYi\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eBreg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePosYd\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePosYd\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eCreg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ePosYd\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ePosYi\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ePosYd\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePosYd\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eCounter\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003e流し読みすると、処理の最初に以前の位置を保持しているのでBit誌の記事の通りなのかなと思えるのですが、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eprevYpos\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePosYi\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんと、この保持された値が使われている形跡がありません。では、どのようにしてジャンプの動きを作り出しているのかというと、フレームごとに更新されるカウンター値を元に値を算出して、移動位置を変化させています。これは一体・・・？\u003c/p\u003e\n\n\u003cp\u003eなぜ、Bit誌の記事と違うジャンプの実装がされているのかという謎だけが残りましたが、長くなりましたので、この辺で記事を書き終えたいと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"追記20191110\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%BF%BD%E8%A8%9820191110\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e追記(2019/11/10)\u003c/h2\u003e\n\n\u003cp\u003e記事の公開後に様々なご意見をいただいたので、記事公開にあたって考えたことをポエムとしてnoteの方に“\u003ca href=\"https://note.mu/morian/n/nb6bdaa31a418\" rel=\"nofollow noopener\" target=\"_blank\"\u003eマリオジャンプの公開で考えたこと\u003c/a\u003e”として書きました。\u003c/p\u003e\n","createdAt":"2019-11-06T12:09:47Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"lq+7f+E1VxdR+UVT5CRJhCV2dB8L3tjzUw==--lO2pZLJRGUXjM9Ju--OTfY/jjL2lfqS/4+yVwr4Q==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2019-11-16T13:59:09Z","likesCount":1894,"linkUrl":"https://qiita.com/morian-bisco/items/4c659d9f940c7e3a2099","organization":null,"originalId":1070138,"stockedCount":1178,"title":"スーパーマリオのジャンプのアルゴリズム","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8E%9F%E5%85%B8%E3%81%AB%E3%81%82%E3%81%9F%E3%82%8B\"\u003e原典にあたる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97%E9%83%A8%E5%88%86%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89\"\u003eジャンプ部分のコード\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%8D%E7%BD%AE%E3%81%A8%E9%80%9F%E5%BA%A6%E3%81%A8%E5%8A%A0%E9%80%9F%E5%BA%A6\"\u003e位置と速度と加速度\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%93%E3%83%A8%E3%83%BC%E3%83%B3%E3%81%8B%E3%82%89%E3%81%AE%E3%82%B7%E3%83%A5%E3%83%83\"\u003eビヨーンからのシュッ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%8A%BC%E3%81%97%E7%B6%9A%E3%81%91%E3%82%8B%E3%81%A8%E9%AB%98%E3%81%8F%E9%A3%9B%E3%81%B6\"\u003e押し続けると高く飛ぶ？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%80%E3%83%83%E3%82%B7%E3%83%A5%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97\"\u003eダッシュジャンプ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#verlet%E7%A9%8D%E5%88%86\"\u003eVerlet積分？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97%E3%83%9E%E3%83%B3%E3%81%AE%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97\"\u003eジャンプマンのジャンプ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%BF%BD%E8%A8%9820191110\"\u003e追記(2019/11/10)\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":115819,"uuid":"4c659d9f940c7e3a2099","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"cuYOCNlBpbLlVOTnRvJn6+vrESZW--laFtlcbrNyA8SuoA--M3XM6ecKgEar2WcHhXOHng==","originalId":167904,"description":"","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167904/profile-images/1561893741","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2Fprofile-images%2F1561893741?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=c097e02fe792e4ce1fe88f121e24c0c9","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167904%2Fprofile-images%2F1561893741?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=7b30a6767ee84678df4d1c2d653c86bb","urlName":"morian-bisco","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"game","urlName":"game"},{"name":"Unity","urlName":"unity"},{"name":"ゲームプログラミング","urlName":"%e3%82%b2%e3%83%bc%e3%83%a0%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0"}],"followingLikers":{"edges":[]},"comments":{"totalCount":8}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

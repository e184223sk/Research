More than 3 years have passed since last update.Trelloのとあるリストに入ったもののラベルの色を特定の色にするバッチプログラムをAzure Functionで(しかもC#で)書こうとしたのですが、ライブラリが古くて結構つらかったので書きます。
Trelloのラベルの色を変えるFunctionはgithubに公開しています。以下のようにproject.jsonに"MyTrelloNet": "1.0.8"と書くことで解決させました。もしかしたら、Azure Functionにpublishした後に、手動でnuget restoreしないといけないかもしれません。TrelloのクライアントとしてTrello.NETというものがあります。
これがだいぶメンテされていなくて、結構エラーが出ていたのが今回の話です。
すぐ使いたかったしプルリクはテストに失敗するみたいなので修正して自分が使う用にMyTrelloNetとしてnugetにあげました。MyTrelloNetという名前で使えます。namespaceはTrelloNetのままです。
以下修正したところの紹介です。Azure Functionが.net46なので合わせて.net46でビルドしました。
RestSharpのrestclientのAuthenticatorが下のようになっていて後方互換性がなかったので再ビルドも必要でした。合わせてNewtonsoft.Jsonを10.0.1、RestSharpを105.2.3を使うようにしました。using RestSharp.Authenticators;
をMemberTokenAuthenticator.csに追記これはプルリクにもあるやつをコピペ私はEleganttというガントチャートツールを使っているのですが、どうもこれがあるとカードのdescに変な値が入るみたいでJsonパースエラーが起きていました。
RestShartにExecute&lt;T&gt;(request)みたいなリクエストしてレスポンスをデシリアライズしてくれるメソッドがあるのですが、この中にエスケープ処理が入っていないので普通のExecuteでJson取得して、手動でデシリアライズします。
その時にJsonをエスケープのためにリテラル文字列に変えます。



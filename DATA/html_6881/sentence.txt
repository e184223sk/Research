More than 3 years have passed since last update.（サクッと見たい人はささっとサンプルへGO!）
　とあるプロジェクトで（これはまぁ追々書きたいと思う）グローバルフックを行うアプリを作成しています。exe、dll共にwin32API直叩きのオールドスクールなアプリでメンテを10年ほど細々と気分で続けているけどさすがに古めかしてくて更新することにしました。
　リプレースするにあたっていろいろ調査を行ったうえで、exeはC#+WPF、フックdllはC++というのが現実的だろうということに。　さて、この既存のアプリはdllとexe間でプロセス間通信を行ってて、ファイルマッピングを使って設定データのやり取りを行い、dllからのイベントはウィンドウメッセージを用いていましたが、リプレースに伴いこのあたりも再検討したところやっぱり同様の手法がお手軽だろうという結論に。
　設定ファイルはXML or JSONのフォーマットと決めてて、またフック側は可能ならメモリを動的生成したくないのでSTLも使用禁止としたかったので、dll側（C++）でJSON or XMLパーサのライブラリをリンクするのは諦めました。
　となるとC#でパースしたデータをC++のフックで読み込み可能なバイナリデータ、すなわち構造体型に押し込んでファイルマッピングに詰め込めばいいんじゃね？という結論に至って、じゃぁその構造体作るかとなりました。　しかし、C#で設定ファイルを保持するデータクラスを作成した上にC++用に構造体を作成せねばならなくて、設定をイジルときに二重管理メンドクセーなーおいーと思ったので、以前お仕事でリフレクションとCodeDOMを使ってコンパイラをメンテしたなぁもうよく覚えてないけどそれでなんとか出来んじゃね？と思って表題が頭に浮かんだわけです。でもって、調べてもみなさんサクッとやってらっしゃるのか特殊すぎるのか知らないけどサンプルが無かったのでんじゃぁサンプル置きますかと一念発起してqiitaのアカウント取りました。　はい、長いですね。次行きましょう。C#のコンソールアプリで確認したレベルのものです。解説は下に。私のやってるプロジェクト的にはこんだけ出れば満足なので残りは御自分でお試しください



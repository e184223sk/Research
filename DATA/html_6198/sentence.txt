More than 3 years have passed since last update.会社の基幹システムがAS/400(=IBM i)を使っていて、データの抽出を行う機会がちょくちょくあります。
これまでは、フリーソフトのA5M2を使っていて、これはこれで非常に使い勝手が良かったですが、DB2/400に保有している
テーブルや各カラムの日本語名が出ない事が、ほんのちょっとだけ不便でした。
というわけで、夏の工作がてらDB2/400のSQL実行ツールを作成しようと思い立ちました。SQL入力エリアで下記の機能を実装する
　①シンタックスハイライト
　②オートコンプリート機能
　③SQL整形機能①Fast Colored TextBox for Syntax Highlighting
  ②Autocomplete Menu
  ③Poor Man's T-SQL FormatterFCTBはデザイナは使えないので、コードからコントロールを追加する必要があります。
配置については、Panelを使ってそのコントロールに追加するのが良いと思います。たったこれだけで、それなりの見た目の入力エリアが出来ました。
下記の様なClassを作成しました。キモになるのは、QSYS2.SYSTABLESです。このテーブルには、テーブルの物理名・論理名・テキスト名などが保管されています。
他にもQSYS2.SYSCOLUMNSというテーブルにはカラム名とそれに紐づくTEXT情報が格納されているので、工夫次第でカラム名の日本語化も可能です。setAutoCompleteMenuForSQLInputAreaというメソッドを作成しました。上記で取得したテーブルの一覧を、AutoComplete用の文字列として設定しています。MulticolumnAutocompleteItemに文字配列を設定すると、マルチカラムでオートコンプリートが出力されるようになります。結果、テーブル名を入れると下記の様に日本語名+実際の名前の候補が選択肢として出力されるようになりました！実に簡単。
最後にSQLを見易く整形する機能を実装します。formatSQLという名前のボタンをクリックすると、SQLを整形するようにしています。実際に追加したのは、formatSQL_Clickというメソッドです。今回は全てデフォルトで整形していますが、プロパティの与え方で、整形の仕方は調整が可能です。整形前
整形後
それなりにSQLが見易くなりましたね。ちなみに、上記で使ったTSqlStandardParserですが、SQLを構造化してXML化しています。
つまり下記の様なコードで、SQLに書かれた要素を抽出する事が出来ます。私はこの機能を利用して、SQL中のテーブル名を抽出→カラム名のオートコンプリート候補作成機能を実装しています。このあたりを弄りながら作成すると、DB2/400におけるSQL作成の生産性が上がるかもしれませんね。
(でもQUERYとかあるから、あんまりSQLの需要はないのかな…)



More than 5 years have passed since last update.Google Sheets API 4をC#.NETで使う機会があったのでそっち関係のまとめ。最初にハマったところを書く。Sheets APIにはAppendがあって、これを使えば一発だろう、Google.Apis.Sheets.v4パッケージの資料にもAppend用のRequestがあるし。と、思ってやってみたら実際のライブラリにはどうもこのリクエストが見つからない…。Appendしようと四苦八苦したあげく挫折。なので方針転換、書き込む前にすでに書かれているデータを読み出して調べてその次の行を指定して書き込むようにした。まず、コードから。Googleのページのサンプルを多少書き換えた。やってることはなんてことなく、というわけで、これを動かす前に必要なのは、の三作業。Google Sheets APIの".NET Quickstart"のページ通りでできる。デベロッパコンソールのウィザードにアクセスして以下の作業。プログラムをビルドしたらこのファイルを"client_secret.json"にリネームして実行ディレクトリに置く。VS2015でVisual C#のコンソールアプリケーションのプロジェクトを作成、プロジェクト上で以下の作業。追加するのは、Google DriveにアクセスしてSpreadsheetを作成する。
SpreadsheetIDはURLのhttps://docs.google.com/spreadsheets/d/の次の文字列。
Worksheet名は適宜変更してプログラムに渡せるようにする。サンプルでは、変数 spreadsheetIdとsheetNameに埋め込んでいる。ビルドしたらプログラムの実行ディレクトリにclient_secret.jsonにリネームしたクライアントIDファイルを置く。
実行すると初回はWebブラウザが起動してアクセス許可を促すので許可する。だいたいこんな感じ。しかしAppendもできないんでは、次の機会があれば、違う処理系でやるだろうなあ。



More than 1 year has passed since last update.この記事はゲーム The Elder Scrolls シリーズの1作目である Arena を何とか日本語で遊べるようにしようとする試みの中で、主だった技術部分のコードを備忘録として残すためのものです。
いきさつなどの詳細ははてなブログの記事にて記載しております。
The Elder Scrolls: Arena の日本語化 - 1 - プログラミング・動画編集 備忘録なお、環境や作成するツールの形態は次の通りです。また、現時点での翻訳精度などは同じくはてなブログの次の記事に記載しております。
The Elder Scrolls: Arena の日本語化 - 2 - プログラミング・動画編集 備忘録ゲームのスクリーンショットからOCRを行う部分は Tesseract を使用します。
理由は以前調査した事があるため。
【随時更新】Python・OpenCV・Tesseractで参考にした記事などの一覧 - QiitaOCRで認識した文字列を翻訳するのは Selenium を使用して、Google翻訳にかける方法を使用します。
なお、以前同じような事を実施しており、その際は標準のWebBrowserコントロールを使用しましたが、スクリプトエラー等が発生しうまくいかないため、もっと行動な操作の行えるSeleniumを使用することにしました。また、Google翻訳を使うだけであれば、GASを使って自分でAPI化するすばらしい方法が次の記事などでありました。
Google翻訳APIを無料で作る方法 - Qiitaただ、今回は一応使えるものが出来たらツールは公開するつもりなので、自前のAPIを使う方法は避けるためブラウザを操作してGoogle翻訳を実行させるという方式をとります。OCRの認識精度を高めるため、画像補正を行うのに OpenCvSharp を使用します。
OpenCvも使い方をほとんど忘れていますが、画像操作するならOpenCvだろうということで選択しています。NuGet パッケージ マネージャーから Tesseract で検索。
Tesseract とあるのでインストール。バージョンは 3.3.0。
サンプルコード内では、jTessBoxEditorにて作成したトレーニングデータを使用しているので、データが無い場合は以下の場所なりからデータを取得して適当な場所に配置してパスを指定する。
GitHub - tesseract-ocr/tessdata: Trained models with support for legacy and LSTM OCR engine必要な部分のみ抜粋。NuGet パッケージ マネージャーから Selenium で検索。
Selenium.WebDriver をインストールする。バージョンは 3.141.0 。
さらに、個別のブラウザのドライバーが必要なので、ここではChromeを使用する事にする。
Selenium.Chrome.WebDriver をインストール。バージョンは 83.0.0。SeleniumのChromeのドライバーを使って、文字列を渡して翻訳結果を返すクラスを次のように作成した。
Google翻訳部分の操作は、とりあえずこれで動いたというレベルのもの。もっといい書き方は今後模索する。
注意点としては、Quitを呼ばないと非表示にしているブラウザやコンソールが残ったままとなるので、特にデバッグ起動で強制終了などをすると裏で残されてしまう。こちらは正直どれを選ぶのが良いのかよくわかっていないが次のようにした。
NuGet パッケージ マネージャーから OpenCvSharp で検索。
OpenCvSharp4.Windows をインストール。バージョンは 4.4.0.20200725。
プロジェクトURLは次の通り。
https://github.com/shimat/opencvsharp実際にゲームをプレイしている際は、[Alt]+[PrintScreen]にてゲーム画面のスクリーンショットを取得する。
このため、クリップボードを監視して画像を取得できるようにする。



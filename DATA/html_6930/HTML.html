<!DOCTYPE html><html><head><meta charset="utf-8" /><title>.NET で Windows エクスプローラのコンテキストメニューを拡張 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/tinymouse/items/26c1bfa0d2a6a2116cff" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="VtMIYku9/706rZsMSeOZOj913kPDwH8ZivuuzOPcgTjTm+am/ooxI2FclEaTkTFBxikImUrjDGKlUm13ncaFzg==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content=".NET で Windows エクスプローラのコンテキストメニューを拡張 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1MazVGVkNEamdhY2dWMmx1Wkc5M2N5RGpncWpqZ3FfamdybmpnNWZqZzYzamc3empnNm5qZ2E3amdyUGpnN1BqZzRiamdxM2pncm5qZzRqamc2SGpnNHZqZzZYamc3empncExtaTZIbHZMVSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz0yYTNhNzU2NWFjOTI4OTk4ZDNjNTdhZGM1ZjE3OTkxYw&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJwYm5sdGIzVnpaUSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWM5ZWMwZWNlMzdmOTcyOGQzNGQ3YTVjMDYxN2M0ZTIz&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=73800616303d73b9ea010ee38f9f6957"><meta property="og:description" content="

はじめに

僕は以前 Delphi で Windows のシェル拡張（Shell Extension）を使ってエクスプローラに機能を追加するアプリを作りました。
簡単エクスプローラ拡張 EzExpEx
これは残念なことに 64 ビ..."><meta content="https://qiita.com/tinymouse/items/26c1bfa0d2a6a2116cff" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="VB.Net,C#,.NET" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-3d53aa12-086f-4834-bb47-b7ab09e0fbcb"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Ftinymouse%2Fitems%2F26c1bfa0d2a6a2116cff">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Ftinymouse%2Fitems%2F26c1bfa0d2a6a2116cff">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-3d53aa12-086f-4834-bb47-b7ab09e0fbcb">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/vb.net","name":"VB.Net"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2016-10-22T22:50:17.000+09:00","dateModified":"2016-11-27T16:35:10.000+09:00","headline":".NET で Windows エクスプローラのコンテキストメニューを拡張","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1MazVGVkNEamdhY2dWMmx1Wkc5M2N5RGpncWpqZ3FfamdybmpnNWZqZzYzamc3empnNm5qZ2E3amdyUGpnN1BqZzRiamdxM2pncm5qZzRqamc2SGpnNHZqZzZYamc3empncExtaTZIbHZMVSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz0yYTNhNzU2NWFjOTI4OTk4ZDNjNTdhZGM1ZjE3OTkxYw\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJwYm5sdGIzVnpaUSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWM5ZWMwZWNlMzdmOTcyOGQzNGQ3YTVjMDYxN2M0ZTIz\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=73800616303d73b9ea010ee38f9f6957","mainEntityOfPage":"https://qiita.com/tinymouse/items/26c1bfa0d2a6a2116cff","author":{"@type":"Person","address":"名古屋市西区","email":null,"identifier":"tinymouse","name":"tinymouse","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114460%2Fprofile-images%2F1473712599?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=efbd473d8ab1891f3c67fd7567aec588","url":"https://qiita.com/tinymouse","description":"SI 企業の SE であり、日曜プログラマであり、二児の父。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tinymouse","type":"items","id":"26c1bfa0d2a6a2116cff"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tinymouse","type":"items","id":"26c1bfa0d2a6a2116cff"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tinymouse","type":"items","id":"26c1bfa0d2a6a2116cff"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/tinymouse/items/26c1bfa0d2a6a2116cff","location":"/tinymouse/items/26c1bfa0d2a6a2116cff","scheme":"https","host":"qiita.com","port":null,"pathname":"/tinymouse/items/26c1bfa0d2a6a2116cff","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"JHuYY4DrqtIY6Qdc8r2e76x42dXVsYHXcy4R8OeqPuehM3anNdxkTEMYCBYozzaUVSQPD1yS8qxch9JLmbA6EQ==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-0b44d63b-939e-4674-abad-4ca6712ae092"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tinymouse/items/26c1bfa0d2a6a2116cff/likers" class="css-1iupg5d">17</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">14</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/26c1bfa0d2a6a2116cff/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tinymouse/items/26c1bfa0d2a6a2116cff/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tinymouse/items/26c1bfa0d2a6a2116cff/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tinymouse/items/26c1bfa0d2a6a2116cff/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tinymouse/items/26c1bfa0d2a6a2116cff.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/tinymouse"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/114460/profile-images/1473712599" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/tinymouse" class="css-10ougpm">@<!-- -->tinymouse</a><div class="css-1ay9vb9"><span><meta content="2016-10-22T13:50:17Z"/><time dateTime="2016-11-27T07:35:10Z" class="css-m19uds">updated at 2016-11-27</time></span></div></div></div></div></div><h1 class="css-cgzq40">.NET で Windows エクスプローラのコンテキストメニューを拡張</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/vb.net" class="css-4czcte">VB.Net</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/.net" class="css-4czcte">.NET</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>僕は以前 Delphi で Windows のシェル拡張（Shell Extension）を使ってエクスプローラに機能を追加するアプリを作りました。<br>
<a href="http://hp.vector.co.jp/authors/VA029585/EzExpEx/" rel="nofollow noopener" target="_blank">簡単エクスプローラ拡張 EzExpEx</a><br>
これは残念なことに 64 ビット Windows のエクスプローラで動かないんですよね。僕が持っている Delphi では 64 ビット Windows アプリを作れないんです。<br>
これを VB.NET で作り直したいとずっと思っていました。</p>

<p>そのために調べていると次の記事がありました。<br>
<a href="http://www.codeproject.com/Articles/174369/How-to-Write-Windows-Shell-Extension-with-NET-Lang" rel="nofollow noopener" target="_blank">How to Write Windows Shell Extension with .NET Languages - CodeProject</a><br>
これを参考にしてプログラムを書いてみました。</p>

<h1>
<span id="windows-シェル拡張でコンテキストメニュー" class="fragment"></span><a href="#windows-%E3%82%B7%E3%82%A7%E3%83%AB%E6%8B%A1%E5%BC%B5%E3%81%A7%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%83%A1%E3%83%8B%E3%83%A5%E3%83%BC"><i class="fa fa-link"></i></a>Windows シェル拡張でコンテキストメニュー</h1>

<p>エクスプローラで右クリックするとコンテキストメニューが表示されます。このメニューに独自の項目を追加します。</p>

<h2>
<span id="プロジェクトを作る" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>プロジェクトを作る</h2>

<p>まず、「クラスライブラリ」のプロジェクトを新規作成します。</p>

<p>ここではプロジェクト名を「ContextMenuExtension」にします。</p>

<p>次に、プロジェクトの「参照」設定に以下のアセンブリを追加します。</p>

<ul>
<li>System.Windows.Forms</li>
<li>System.Drawing</li>
</ul>

<p>IDE が作成したソースファイル「Class1.cs」または「Class1.vb」を「ContextMenuExtension.cs」または「ContextMenuExtension.vb」にリネームします。* 好きなファイル名で構いません。</p>

<h2>
<span id="ishellextinit-と-icontextmenu-を用意する" class="fragment"></span><a href="#ishellextinit-%E3%81%A8-icontextmenu-%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>IShellExtInit と IContextMenu を用意する</h2>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ContextMenuExtension.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ContextMenuExtension</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">ComImport</span><span class="p">(),</span> 
    <span class="nf">InterfaceType</span><span class="p">(</span><span class="n">ComInterfaceType</span><span class="p">.</span><span class="n">InterfaceIsIUnknown</span><span class="p">),</span>
    <span class="nf">Guid</span><span class="p">(</span><span class="s">"000214e8-0000-0000-c000-000000000046"</span><span class="p">)]</span>
    <span class="k">internal</span> <span class="k">interface</span> <span class="nc">IShellExtInit</span>
    <span class="p">{</span>
        <span class="k">void</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">IntPtr</span> <span class="cm">/*LPCITEMIDLIST*/</span> <span class="n">pidlFolder</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="cm">/*LPDATAOBJECT*/</span> <span class="n">pDataObj</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="cm">/*HKEY*/</span> <span class="n">hKeyProgID</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">ComImport</span><span class="p">(),</span> 
    <span class="nf">InterfaceType</span><span class="p">(</span><span class="n">ComInterfaceType</span><span class="p">.</span><span class="n">InterfaceIsIUnknown</span><span class="p">),</span>
    <span class="nf">Guid</span><span class="p">(</span><span class="s">"000214e4-0000-0000-c000-000000000046"</span><span class="p">)]</span>
    <span class="k">internal</span> <span class="k">interface</span> <span class="nc">IContextMenu</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="n">PreserveSig</span><span class="p">]</span>
        <span class="kt">int</span> <span class="nf">QueryContextMenu</span><span class="p">(</span><span class="n">IntPtr</span> <span class="cm">/*HMENU*/</span> <span class="n">hMenu</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">iMenu</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">idCmdFirst</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">idCmdLast</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">uFlags</span><span class="p">);</span>
        <span class="k">void</span> <span class="nf">InvokeCommand</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">pici</span><span class="p">);</span>
        <span class="k">void</span> <span class="nf">GetCommandString</span><span class="p">(</span><span class="n">UIntPtr</span> <span class="n">idCmd</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">uFlags</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">pReserved</span><span class="p">,</span> <span class="n">StringBuilder</span> <span class="n">pszName</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">cchMax</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="vbnet">
<div class="code-lang"><span class="bold">ContextMenuExtension.vb</span></div>
<div class="highlight"><pre class="with-code"><code>Imports System.Runtime.InteropServices
Imports System.Text

&lt;ComImport(),
InterfaceType(ComInterfaceType.InterfaceIsIUnknown),
Guid("000214e8-0000-0000-c000-000000000046")&gt;
Friend Interface IShellExtInit
    Sub Initialize(ByVal pidlFolder As IntPtr, ByVal pDataObj As IntPtr, ByVal hKeyProgID As IntPtr)
End Interface

&lt;ComImport(),
InterfaceType(ComInterfaceType.InterfaceIsIUnknown),
Guid("000214e4-0000-0000-c000-000000000046")&gt;
Friend Interface IContextMenu
    &lt;PreserveSig()&gt;
    Function QueryContextMenu(ByVal hMenu As IntPtr, ByVal iMenu As UInt32, ByVal idCmdFirst As UInt32, ByVal idCmdLast As UInt32, ByVal uFlags As UInt32) As Integer
    Sub InvokeCommand(ByVal pici As IntPtr)
    Sub GetCommandString(ByVal idCmd As UIntPtr, ByVal uFlags As UInt32, ByVal pReserved As IntPtr, ByVal pszName As StringBuilder, ByVal cchMax As UInt32)
End Interface
</code></pre></div>
</div>

<h2>
<span id="ishellextinit-と-icontextmenu-から派生する" class="fragment"></span><a href="#ishellextinit-%E3%81%A8-icontextmenu-%E3%81%8B%E3%82%89%E6%B4%BE%E7%94%9F%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>IShellExtInit と IContextMenu から派生する</h2>

<p>「ContextMenuExtension」クラスを「IShellExtInit」「IContextMenu」から派生するよう書換します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ContextMenuExtension.cs</span></div>
<div class="highlight"><pre class="with-code"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">ContextMenuExtension</span> <span class="p">:</span> <span class="n">IShellExtInit</span><span class="p">,</span> <span class="n">IContextMenu</span>
    <span class="p">{</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="vbnet">
<div class="code-lang"><span class="bold">ContextMenuExtension.vb</span></div>
<div class="highlight"><pre class="with-code"><code>Public Class ContextMenuExtension
    Implements IShellExtInit, IContextMenu
</code></pre></div>
</div>

<p>IDE が「インターフェイスの実装」を助言してくるので従って以下のメソッドを実装します。</p>

<ul>
<li>Initialize</li>
<li>QueryContextMenu</li>
<li>GetComandString</li>
<li>InvokeCommand</li>
</ul>

<h2>
<span id="必要な定数やメソッドを用意する" class="fragment"></span><a href="#%E5%BF%85%E8%A6%81%E3%81%AA%E5%AE%9A%E6%95%B0%E3%82%84%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>必要な定数やメソッドを用意する</h2>

<p>必要な定数やメソッドを用意します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ContextMenuExtension.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Runtime.InteropServices.ComTypes</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">CsContextMenuExtension</span>
<span class="p">{</span>
    <span class="k">internal</span> <span class="k">enum</span> <span class="n">CLIPFORMAT</span> <span class="p">:</span> <span class="kt">uint</span>
    <span class="p">{</span>
        <span class="n">CF_TEXT</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
        <span class="n">CF_BITMAP</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span>
        <span class="n">CF_METAFILEPICT</span> <span class="p">=</span> <span class="m">3</span><span class="p">,</span>
        <span class="n">CF_SYLK</span> <span class="p">=</span> <span class="m">4</span><span class="p">,</span>
        <span class="n">CF_DIF</span> <span class="p">=</span> <span class="m">5</span><span class="p">,</span>
        <span class="n">CF_TIFF</span> <span class="p">=</span> <span class="m">6</span><span class="p">,</span>
        <span class="n">CF_OEMTEXT</span> <span class="p">=</span> <span class="m">7</span><span class="p">,</span>
        <span class="n">CF_DIB</span> <span class="p">=</span> <span class="m">8</span><span class="p">,</span>
        <span class="n">CF_PALETTE</span> <span class="p">=</span> <span class="m">9</span><span class="p">,</span>
        <span class="n">CF_PENDATA</span> <span class="p">=</span> <span class="m">10</span><span class="p">,</span>
        <span class="n">CF_RIFF</span> <span class="p">=</span> <span class="m">11</span><span class="p">,</span>
        <span class="n">CF_WAVE</span> <span class="p">=</span> <span class="m">12</span><span class="p">,</span>
        <span class="n">CF_UNICODETEXT</span> <span class="p">=</span> <span class="m">13</span><span class="p">,</span>
        <span class="n">CF_ENHMETAFILE</span> <span class="p">=</span> <span class="m">14</span><span class="p">,</span>
        <span class="n">CF_HDROP</span> <span class="p">=</span> <span class="m">15</span><span class="p">,</span>
        <span class="n">CF_LOCALE</span> <span class="p">=</span> <span class="m">16</span><span class="p">,</span>
        <span class="n">CF_MAX</span> <span class="p">=</span> <span class="m">17</span><span class="p">,</span>

        <span class="n">CF_OWNERDISPLAY</span> <span class="p">=</span> <span class="m">0x0080</span><span class="p">,</span>
        <span class="n">CF_DSPTEXT</span> <span class="p">=</span> <span class="m">0x0081</span><span class="p">,</span>
        <span class="n">CF_DSPBITMAP</span> <span class="p">=</span> <span class="m">0x0082</span><span class="p">,</span>
        <span class="n">CF_DSPMETAFILEPICT</span> <span class="p">=</span> <span class="m">0x0083</span><span class="p">,</span>
        <span class="n">CF_DSPENHMETAFILE</span> <span class="p">=</span> <span class="m">0x008E</span><span class="p">,</span>

        <span class="n">CF_PRIVATEFIRST</span> <span class="p">=</span> <span class="m">0x0200</span><span class="p">,</span>
        <span class="n">CF_PRIVATELAST</span> <span class="p">=</span> <span class="m">0x02FF</span><span class="p">,</span>

        <span class="n">CF_GDIOBJFIRST</span> <span class="p">=</span> <span class="m">0x0300</span><span class="p">,</span>
        <span class="n">CF_GDIOBJLAST</span> <span class="p">=</span> <span class="m">0x03FF</span>
    <span class="p">}</span>

    <span class="k">internal</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">WinError</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">S_OK</span> <span class="p">=</span> <span class="m">0x0000</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">S_FALSE</span> <span class="p">=</span> <span class="m">0x0001</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">E_FAIL</span> <span class="p">=</span> <span class="p">-</span><span class="m">2147467259</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">E_INVALIDARG</span> <span class="p">=</span> <span class="p">-</span><span class="m">2147024809</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">E_OUTOFMEMORY</span> <span class="p">=</span> <span class="p">-</span><span class="m">2147024882</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">STRSAFE_E_INSUFFICIENT_BUFFER</span> <span class="p">=</span> <span class="p">-</span><span class="m">2147024774</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">const</span> <span class="kt">uint</span> <span class="n">SEVERITY_SUCCESS</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">uint</span> <span class="n">SEVERITY_ERROR</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">static</span> <span class="kt">int</span> <span class="nf">MAKE_HRESULT</span><span class="p">(</span><span class="kt">uint</span> <span class="n">sev</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">fac</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">code</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((</span><span class="n">sev</span> <span class="p">&lt;&lt;</span> <span class="m">31</span><span class="p">)</span> <span class="p">|</span> <span class="p">(</span><span class="n">fac</span> <span class="p">&lt;&lt;</span> <span class="m">16</span><span class="p">)</span> <span class="p">|</span> <span class="n">code</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="n">Flags</span><span class="p">]</span>
    <span class="k">internal</span> <span class="k">enum</span> <span class="n">MIIM</span> <span class="p">:</span> <span class="kt">uint</span>
    <span class="p">{</span>
        <span class="n">MIIM_STATE</span> <span class="p">=</span> <span class="m">0x00000001</span><span class="p">,</span>
        <span class="n">MIIM_ID</span> <span class="p">=</span> <span class="m">0x00000002</span><span class="p">,</span>
        <span class="n">MIIM_SUBMENU</span> <span class="p">=</span> <span class="m">0x00000004</span><span class="p">,</span>
        <span class="n">MIIM_CHECKMARKS</span> <span class="p">=</span> <span class="m">0x00000008</span><span class="p">,</span>
        <span class="n">MIIM_TYPE</span> <span class="p">=</span> <span class="m">0x00000010</span><span class="p">,</span>
        <span class="n">MIIM_DATA</span> <span class="p">=</span> <span class="m">0x00000020</span><span class="p">,</span>
        <span class="n">MIIM_STRING</span> <span class="p">=</span> <span class="m">0x00000040</span><span class="p">,</span>
        <span class="n">MIIM_BITMAP</span> <span class="p">=</span> <span class="m">0x00000080</span><span class="p">,</span>
        <span class="n">MIIM_FTYPE</span> <span class="p">=</span> <span class="m">0x00000100</span>
    <span class="p">}</span>

    <span class="k">internal</span> <span class="k">enum</span> <span class="n">MFT</span> <span class="p">:</span> <span class="kt">uint</span>
    <span class="p">{</span>
        <span class="n">MFT_STRING</span> <span class="p">=</span> <span class="m">0x00000000</span><span class="p">,</span>
        <span class="n">MFT_BITMAP</span> <span class="p">=</span> <span class="m">0x00000004</span><span class="p">,</span>
        <span class="n">MFT_MENUBARBREAK</span> <span class="p">=</span> <span class="m">0x00000020</span><span class="p">,</span>
        <span class="n">MFT_MENUBREAK</span> <span class="p">=</span> <span class="m">0x00000040</span><span class="p">,</span>
        <span class="n">MFT_OWNERDRAW</span> <span class="p">=</span> <span class="m">0x00000100</span><span class="p">,</span>
        <span class="n">MFT_RADIOCHECK</span> <span class="p">=</span> <span class="m">0x00000200</span><span class="p">,</span>
        <span class="n">MFT_SEPARATOR</span> <span class="p">=</span> <span class="m">0x00000800</span><span class="p">,</span>
        <span class="n">MFT_RIGHTORDER</span> <span class="p">=</span> <span class="m">0x00002000</span><span class="p">,</span>
        <span class="n">MFT_RIGHTJUSTIFY</span> <span class="p">=</span> <span class="m">0x00004000</span>
    <span class="p">}</span>

    <span class="k">internal</span> <span class="k">enum</span> <span class="n">MFS</span> <span class="p">:</span> <span class="kt">uint</span>
    <span class="p">{</span>
        <span class="n">MFS_ENABLED</span> <span class="p">=</span> <span class="m">0x00000000</span><span class="p">,</span>
        <span class="n">MFS_UNCHECKED</span> <span class="p">=</span> <span class="m">0x00000000</span><span class="p">,</span>
        <span class="n">MFS_UNHILITE</span> <span class="p">=</span> <span class="m">0x00000000</span><span class="p">,</span>
        <span class="n">MFS_GRAYED</span> <span class="p">=</span> <span class="m">0x00000003</span><span class="p">,</span>
        <span class="n">MFS_DISABLED</span> <span class="p">=</span> <span class="m">0x00000003</span><span class="p">,</span>
        <span class="n">MFS_CHECKED</span> <span class="p">=</span> <span class="m">0x00000008</span><span class="p">,</span>
        <span class="n">MFS_HILITE</span> <span class="p">=</span> <span class="m">0x00000080</span><span class="p">,</span>
        <span class="n">MFS_DEFAULT</span> <span class="p">=</span> <span class="m">0x00001000</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Unicode</span><span class="p">)]</span>
    <span class="k">internal</span> <span class="k">struct</span> <span class="nc">MENUITEMINFO</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">uint</span> <span class="n">cbSize</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">MIIM</span> <span class="n">fMask</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">MFT</span> <span class="n">fType</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">MFS</span> <span class="n">fState</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">uint</span> <span class="n">wID</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">IntPtr</span> <span class="n">hSubMenu</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">IntPtr</span> <span class="n">hbmpChecked</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">IntPtr</span> <span class="n">hbmpUnchecked</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">UIntPtr</span> <span class="n">dwItemData</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">dwTypeData</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">uint</span> <span class="n">cch</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">IntPtr</span> <span class="n">hbmpItem</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="n">Flags</span><span class="p">]</span>
    <span class="k">internal</span> <span class="k">enum</span> <span class="n">CMF</span> <span class="p">:</span> <span class="kt">uint</span>
    <span class="p">{</span>
        <span class="n">CMF_NORMAL</span> <span class="p">=</span> <span class="m">0x00000000</span><span class="p">,</span>
        <span class="n">CMF_DEFAULTONLY</span> <span class="p">=</span> <span class="m">0x00000001</span><span class="p">,</span>
        <span class="n">CMF_VERBSONLY</span> <span class="p">=</span> <span class="m">0x00000002</span><span class="p">,</span>
        <span class="n">CMF_EXPLORE</span> <span class="p">=</span> <span class="m">0x00000004</span><span class="p">,</span>
        <span class="n">CMF_NOVERBS</span> <span class="p">=</span> <span class="m">0x00000008</span><span class="p">,</span>
        <span class="n">CMF_CANRENAME</span> <span class="p">=</span> <span class="m">0x00000010</span><span class="p">,</span>
        <span class="n">CMF_NODEFAULT</span> <span class="p">=</span> <span class="m">0x00000020</span><span class="p">,</span>
        <span class="n">CMF_INCLUDESTATIC</span> <span class="p">=</span> <span class="m">0x00000040</span><span class="p">,</span>
        <span class="n">CMF_ITEMMENU</span> <span class="p">=</span> <span class="m">0x00000080</span><span class="p">,</span>
        <span class="n">CMF_EXTENDEDVERBS</span> <span class="p">=</span> <span class="m">0x00000100</span><span class="p">,</span>
        <span class="n">CMF_DISABLEDVERBS</span> <span class="p">=</span> <span class="m">0x00000200</span><span class="p">,</span>
        <span class="n">CMF_ASYNCVERBSTATE</span> <span class="p">=</span> <span class="m">0x00000400</span><span class="p">,</span>
        <span class="n">CMF_OPTIMIZEFORINVOKE</span> <span class="p">=</span> <span class="m">0x00000800</span><span class="p">,</span>
        <span class="n">CMF_SYNCCASCADEMENU</span> <span class="p">=</span> <span class="m">0x00001000</span><span class="p">,</span>
        <span class="n">CMF_DONOTPICKDEFAULT</span> <span class="p">=</span> <span class="m">0x00002000</span><span class="p">,</span>
        <span class="n">CMF_RESERVED</span> <span class="p">=</span> <span class="m">0xFFFF0000</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="n">Flags</span><span class="p">]</span>
    <span class="k">internal</span> <span class="k">enum</span> <span class="n">CMIC</span> <span class="p">:</span> <span class="kt">uint</span>
    <span class="p">{</span>
        <span class="n">CMIC_MASK_ICON</span> <span class="p">=</span> <span class="m">0x00000010</span><span class="p">,</span>
        <span class="n">CMIC_MASK_HOTKEY</span> <span class="p">=</span> <span class="m">0x00000020</span><span class="p">,</span>
        <span class="n">CMIC_MASK_NOASYNC</span> <span class="p">=</span> <span class="m">0x00000100</span><span class="p">,</span>
        <span class="n">CMIC_MASK_FLAG_NO_UI</span> <span class="p">=</span> <span class="m">0x00000400</span><span class="p">,</span>
        <span class="n">CMIC_MASK_UNICODE</span> <span class="p">=</span> <span class="m">0x00004000</span><span class="p">,</span>
        <span class="n">CMIC_MASK_NO_CONSOLE</span> <span class="p">=</span> <span class="m">0x00008000</span><span class="p">,</span>
        <span class="n">CMIC_MASK_ASYNCOK</span> <span class="p">=</span> <span class="m">0x00100000</span><span class="p">,</span>
        <span class="n">CMIC_MASK_NOZONECHECKS</span> <span class="p">=</span> <span class="m">0x00800000</span><span class="p">,</span>
        <span class="n">CMIC_MASK_FLAG_LOG_USAGE</span> <span class="p">=</span> <span class="m">0x04000000</span><span class="p">,</span>
        <span class="n">CMIC_MASK_SHIFT_DOWN</span> <span class="p">=</span> <span class="m">0x10000000</span><span class="p">,</span>
        <span class="n">CMIC_MASK_PTINVOKE</span> <span class="p">=</span> <span class="m">0x20000000</span><span class="p">,</span>
        <span class="n">CMIC_MASK_CONTROL_DOWN</span> <span class="p">=</span> <span class="m">0x40000000</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Unicode</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">struct</span> <span class="nc">POINT</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">X</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Y</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Unicode</span><span class="p">)]</span>
    <span class="k">internal</span> <span class="k">struct</span> <span class="nc">CMINVOKECOMMANDINFO</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">uint</span> <span class="n">cbSize</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">CMIC</span> <span class="n">fMask</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">IntPtr</span> <span class="n">hwnd</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">IntPtr</span> <span class="n">lpVerb</span><span class="p">;</span>
        <span class="p">[</span><span class="nf">MarshalAs</span><span class="p">(</span><span class="n">UnmanagedType</span><span class="p">.</span><span class="n">LPStr</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">parameters</span><span class="p">;</span>
        <span class="p">[</span><span class="nf">MarshalAs</span><span class="p">(</span><span class="n">UnmanagedType</span><span class="p">.</span><span class="n">LPStr</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">directory</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">nShow</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">uint</span> <span class="n">dwHotKey</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">IntPtr</span> <span class="n">hIcon</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">internal</span> <span class="k">enum</span> <span class="n">GCS</span> <span class="p">:</span> <span class="kt">uint</span>
    <span class="p">{</span>
        <span class="n">GCS_VERBA</span> <span class="p">=</span> <span class="m">0x00000000</span><span class="p">,</span>
        <span class="n">GCS_HELPTEXTA</span> <span class="p">=</span> <span class="m">0x00000001</span><span class="p">,</span>
        <span class="n">GCS_VALIDATEA</span> <span class="p">=</span> <span class="m">0x00000002</span><span class="p">,</span>
        <span class="n">GCS_VERBW</span> <span class="p">=</span> <span class="m">0x00000004</span><span class="p">,</span>
        <span class="n">GCS_HELPTEXTW</span> <span class="p">=</span> <span class="m">0x00000005</span><span class="p">,</span>
        <span class="n">GCS_VALIDATEW</span> <span class="p">=</span> <span class="m">0x00000006</span><span class="p">,</span>
        <span class="n">GCS_VERBICONW</span> <span class="p">=</span> <span class="m">0x00000014</span><span class="p">,</span>
        <span class="n">GCS_UNICODE</span> <span class="p">=</span> <span class="m">0x00000004</span>
    <span class="p">}</span>

    <span class="k">internal</span> <span class="k">class</span> <span class="nc">WinApi</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_PATH</span> <span class="p">=</span> <span class="m">260</span><span class="p">;</span>

        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"shell32"</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Unicode</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">uint</span> <span class="nf">DragQueryFile</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hDrop</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">iFile</span><span class="p">,</span> <span class="n">StringBuilder</span> <span class="n">pszFile</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cch</span><span class="p">);</span>

        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"ole32.dll"</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Unicode</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="k">void</span> <span class="nf">ReleaseStgMedium</span><span class="p">(</span><span class="k">ref</span> <span class="n">STGMEDIUM</span> <span class="n">pmedium</span><span class="p">);</span>

        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32"</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Unicode</span><span class="p">,</span> <span class="n">SetLastError</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
        <span class="p">[</span><span class="k">return</span><span class="p">:</span> <span class="nf">MarshalAs</span><span class="p">(</span><span class="n">UnmanagedType</span><span class="p">.</span><span class="n">Bool</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">bool</span> <span class="nf">InsertMenuItem</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hMenu</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">uItem</span><span class="p">,</span> <span class="p">[</span><span class="nf">MarshalAs</span><span class="p">(</span><span class="n">UnmanagedType</span><span class="p">.</span><span class="n">Bool</span><span class="p">)]</span><span class="kt">bool</span> <span class="n">fByPosition</span><span class="p">,</span> <span class="k">ref</span> <span class="n">MENUITEMINFO</span> <span class="n">mii</span><span class="p">);</span>

        <span class="k">public</span> <span class="k">static</span> <span class="kt">int</span> <span class="nf">HighWord</span><span class="p">(</span><span class="kt">int</span> <span class="n">number</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">number</span> <span class="p">&amp;</span> <span class="m">0x80000000</span><span class="p">)</span> <span class="p">==</span> <span class="m">0x80000000</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="n">number</span> <span class="p">&gt;&gt;</span> <span class="m">16</span><span class="p">)</span> <span class="p">:</span> <span class="p">((</span><span class="n">number</span> <span class="p">&gt;&gt;</span> <span class="m">16</span><span class="p">)</span> <span class="p">&amp;</span> <span class="m">0xffff</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">static</span> <span class="kt">int</span> <span class="nf">LowWord</span><span class="p">(</span><span class="kt">int</span> <span class="n">number</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">number</span> <span class="p">&amp;</span> <span class="m">0xffff</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="vbnet">
<div class="code-lang"><span class="bold">ContextMenuExtension.vb</span></div>
<div class="highlight"><pre class="with-code"><code>Imports System.Runtime.InteropServices.ComTypes

Friend Enum CLIPFORMAT As UInt32
    CF_TEXT = 1
    CF_BITMAP = 2
    CF_METAFILEPICT = 3
    CF_SYLK = 4
    CF_DIF = 5
    CF_TIFF = 6
    CF_OEMTEXT = 7
    CF_DIB = 8
    CF_PALETTE = 9
    CF_PENDATA = 10
    CF_RIFF = 11
    CF_WAVE = 12
    CF_UNICODETEXT = 13
    CF_ENHMETAFILE = 14
    CF_HDROP = 15
    CF_LOCALE = &amp;H10
    CF_MAX = &amp;H11

    CF_OWNERDISPLAY = &amp;H80
    CF_DSPTEXT = &amp;H81
    CF_DSPBITMAP = &amp;H82
    CF_DSPMETAFILEPICT = &amp;H83
    CF_DSPENHMETAFILE = &amp;H8E

    CF_PRIVATEFIRST = &amp;H200
    CF_PRIVATELAST = &amp;H2FF

    CF_GDIOBJFIRST = &amp;H300
    CF_GDIOBJLAST = &amp;H3FF
End Enum

Friend Class WinError
    Public Const S_OK As Integer = 0
    Public Const S_FALSE As Integer = 1
    Public Const E_FAIL As Integer = -2147467259
    Public Const E_INVALIDARG As Integer = -2147024809
    Public Const E_OUTOFMEMORY As Integer = -2147024882
    Public Const STRSAFE_E_INSUFFICIENT_BUFFER As Integer = -2147024774

    Public Const SEVERITY_ERROR As UInt32 = 1
    Public Const SEVERITY_SUCCESS As UInt32 = 0

    Public Shared Function MAKE_HRESULT(ByVal sev As UInt32, ByVal fac As UInt32, ByVal code As UInt32) As Integer
        Return CInt((((sev &lt;&lt; &amp;H1F) Or (fac &lt;&lt; &amp;H10)) Or code))
    End Function
End Class

&lt;Flags()&gt;
Friend Enum MIIM As UInt32
    MIIM_STATE = 1
    MIIM_ID = 2
    MIIM_SUBMENU = 4
    MIIM_CHECKMARKS = 8
    MIIM_TYPE = &amp;H10
    MIIM_DATA = &amp;H20
    MIIM_STRING = &amp;H40
    MIIM_BITMAP = &amp;H80
    MIIM_FTYPE = &amp;H100
End Enum

Friend Enum MFT As UInt32
    MFT_STRING = 0
    MFT_BITMAP = 4
    MFT_MENUBARBREAK = &amp;H20
    MFT_MENUBREAK = &amp;H40
    MFT_OWNERDRAW = &amp;H100
    MFT_RADIOCHECK = &amp;H200
    MFT_SEPARATOR = &amp;H800
    MFT_RIGHTORDER = &amp;H2000
    MFT_RIGHTJUSTIFY = &amp;H4000
End Enum

Friend Enum MFS As UInt32
    MFS_ENABLED = 0
    MFS_UNCHECKED = 0
    MFS_UNHILITE = 0
    MFS_DISABLED = 3
    MFS_GRAYED = 3
    MFS_CHECKED = 8
    MFS_HILITE = &amp;H80
    MFS_DEFAULT = &amp;H1000
End Enum

&lt;StructLayout(LayoutKind.Sequential, CharSet:=CharSet.Unicode)&gt;
Friend Structure MENUITEMINFO
    Public cbSize As UInt32
    Public fMask As MIIM
    Public fType As MFT
    Public fState As MFS
    Public wID As UInt32
    Public hSubMenu As IntPtr
    Public hbmpChecked As IntPtr
    Public hbmpUnchecked As IntPtr
    Public dwItemData As UIntPtr
    Public dwTypeData As String
    Public cch As UInt32
    Public hbmpItem As IntPtr
End Structure

&lt;Flags()&gt;
Friend Enum CMF
    CMF_NORMAL = 0
    CMF_DEFAULTONLY = 1
    CMF_VERBSONLY = 2
    CMF_EXPLORE = 4
    CMF_NOVERBS = 8
    CMF_CANRENAME = &amp;H10
    CMF_NODEFAULT = &amp;H20
    CMF_INCLUDESTATIC = &amp;H40
    CMF_ITEMMENU = &amp;H80
    CMF_EXTENDEDVERBS = &amp;H100
    CMF_DISABLEDVERBS = &amp;H200
    CMF_ASYNCVERBSTATE = &amp;H400
    CMF_OPTIMIZEFORINVOKE = &amp;H800
    CMF_SYNCCASCADEMENU = &amp;H1000
    CMF_DONOTPICKDEFAULT = &amp;H2000
    CMF_RESERVED = &amp;HFFFF0000
End Enum

&lt;Flags()&gt;
Friend Enum CMIC As UInt32
    CMIC_MASK_ICON = &amp;H10
    CMIC_MASK_HOTKEY = &amp;H20
    CMIC_MASK_NOASYNC = &amp;H100
    CMIC_MASK_FLAG_NO_UI = &amp;H400
    CMIC_MASK_UNICODE = &amp;H4000
    CMIC_MASK_NO_CONSOLE = &amp;H8000
    CMIC_MASK_ASYNCOK = &amp;H100000
    CMIC_MASK_NOZONECHECKS = &amp;H800000
    CMIC_MASK_FLAG_LOG_USAGE = &amp;H4000000
    CMIC_MASK_SHIFT_DOWN = &amp;H10000000
    CMIC_MASK_PTINVOKE = &amp;H20000000
    CMIC_MASK_CONTROL_DOWN = &amp;H40000000
End Enum

&lt;StructLayout(LayoutKind.Sequential, CharSet:=CharSet.Unicode)&gt;
Public Structure POINT
    Public X As Integer
    Public Y As Integer
End Structure

&lt;StructLayout(LayoutKind.Sequential, CharSet:=CharSet.Unicode)&gt;
Friend Structure CMINVOKECOMMANDINFO
    Public cbSize As UInt32
    Public fMask As CMIC
    Public hwnd As IntPtr
    Public lpVerb As IntPtr
    &lt;MarshalAs(UnmanagedType.LPStr)&gt;
    Public parameters As String
    &lt;MarshalAs(UnmanagedType.LPStr)&gt;
    Public directory As String
    Public nShow As Integer
    Public dwHotKey As UInt32
    Public hIcon As IntPtr
End Structure

Friend Enum GCS As UInt32
    GCS_VERBA = 0
    GCS_HELPTEXTA = 1
    GCS_VALIDATEA = 2
    GCS_HELPTEXTW = 5
    GCS_UNICODE = 4
    GCS_VERBW = 4
    GCS_VALIDATEW = 6
    GCS_VERBICONW = 20
End Enum

Friend Class WinApi
    Public Const MAX_PATH As Integer = 260

    &lt;DllImport("shell32", CharSet:=CharSet.Unicode)&gt;
    Public Shared Function DragQueryFile(ByVal hDrop As IntPtr, ByVal iFile As UInt32, ByVal pszFile As StringBuilder, ByVal cch As Integer) As UInt32
    End Function

    &lt;DllImport("ole32.dll", CharSet:=CharSet.Unicode)&gt;
    Public Shared Sub ReleaseStgMedium(ByRef pmedium As STGMEDIUM)
    End Sub

    &lt;DllImport("user32", CharSet:=CharSet.Unicode, SetLastError:=True)&gt;
    Public Shared Function InsertMenuItem(ByVal hMenu As IntPtr, ByVal uItem As UInt32, &lt;MarshalAs(UnmanagedType.Bool)&gt; ByVal fByPosition As Boolean, ByRef mii As MENUITEMINFO) As &lt;MarshalAs(UnmanagedType.Bool)&gt; Boolean
    End Function

    Public Shared Function HighWord(ByVal number As Integer) As Integer
        Return If(((number And &amp;H80000000) = &amp;H80000000), (number &gt;&gt; &amp;H10), ((number &gt;&gt; &amp;H10) And &amp;HFFFF))
    End Function

    Public Shared Function LowWord(ByVal number As Integer) As Integer
        Return (number And &amp;HFFFF)
    End Function
End Class
</code></pre></div>
</div>

<h2>
<span id="initialize-メソッドを実装する" class="fragment"></span><a href="#initialize-%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Initialize メソッドを実装する</h2>

<p>選択されたファイル／フォルダを取得して変数にセットしておきます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ContextMenuExtension.cs</span></div>
<div class="highlight"><pre class="with-code"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">ContextMenuExtension</span> <span class="p">:</span> <span class="n">IShellExtInit</span><span class="p">,</span> <span class="n">IContextMenu</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="kt">string</span> <span class="n">selectedFile</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">pidlFolder</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">pDataObj</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">hKeyProgID</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 選択されているファイル/ディレクトリを取得</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pDataObj</span> <span class="p">==</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">FORMATETC</span> <span class="n">fe</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FORMATETC</span><span class="p">();</span>
            <span class="n">fe</span><span class="p">.</span><span class="n">cfFormat</span> <span class="p">=</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="n">CLIPFORMAT</span><span class="p">.</span><span class="n">CF_HDROP</span><span class="p">;</span>
            <span class="n">fe</span><span class="p">.</span><span class="n">ptd</span> <span class="p">=</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">;</span>
            <span class="n">fe</span><span class="p">.</span><span class="n">dwAspect</span> <span class="p">=</span> <span class="n">DVASPECT</span><span class="p">.</span><span class="n">DVASPECT_CONTENT</span><span class="p">;</span>
            <span class="n">fe</span><span class="p">.</span><span class="n">lindex</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
            <span class="n">fe</span><span class="p">.</span><span class="n">tymed</span> <span class="p">=</span> <span class="n">TYMED</span><span class="p">.</span><span class="n">TYMED_HGLOBAL</span><span class="p">;</span>
            <span class="n">STGMEDIUM</span> <span class="n">stm</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">STGMEDIUM</span><span class="p">();</span>
            <span class="n">IDataObject</span> <span class="n">dataObject</span> <span class="p">=</span> <span class="p">(</span><span class="n">IDataObject</span><span class="p">)</span><span class="n">Marshal</span><span class="p">.</span><span class="nf">GetObjectForIUnknown</span><span class="p">(</span><span class="n">pDataObj</span><span class="p">);</span>
            <span class="n">dataObject</span><span class="p">.</span><span class="nf">GetData</span><span class="p">(</span><span class="k">ref</span> <span class="n">fe</span><span class="p">,</span> <span class="k">out</span> <span class="n">stm</span><span class="p">);</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="n">IntPtr</span> <span class="n">hDrop</span> <span class="p">=</span> <span class="n">stm</span><span class="p">.</span><span class="n">unionmember</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">hDrop</span> <span class="p">==</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="kt">uint</span> <span class="n">nFiles</span> <span class="p">=</span> <span class="n">WinApi</span><span class="p">.</span><span class="nf">DragQueryFile</span><span class="p">(</span><span class="n">hDrop</span><span class="p">,</span> <span class="n">UInt32</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nFiles</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">StringBuilder</span> <span class="n">fileName</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">(</span><span class="n">WinApi</span><span class="p">.</span><span class="n">MAX_PATH</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="m">0</span> <span class="p">==</span> <span class="n">WinApi</span><span class="p">.</span><span class="nf">DragQueryFile</span><span class="p">(</span><span class="n">hDrop</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span>
                        <span class="n">fileName</span><span class="p">.</span><span class="n">Capacity</span><span class="p">))</span>
                    <span class="p">{</span>
                        <span class="n">Marshal</span><span class="p">.</span><span class="nf">ThrowExceptionForHR</span><span class="p">(</span><span class="n">WinError</span><span class="p">.</span><span class="n">E_FAIL</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">selectedFile</span> <span class="p">=</span> <span class="n">fileName</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">Marshal</span><span class="p">.</span><span class="nf">ThrowExceptionForHR</span><span class="p">(</span><span class="n">WinError</span><span class="p">.</span><span class="n">E_FAIL</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">finally</span>
            <span class="p">{</span>
                <span class="n">WinApi</span><span class="p">.</span><span class="nf">ReleaseStgMedium</span><span class="p">(</span><span class="k">ref</span> <span class="n">stm</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="vbnet">
<div class="code-lang"><span class="bold">ContextMenuExtension.vb</span></div>
<div class="highlight"><pre class="with-code"><code>Public Class ContextMenuExtension
    Implements IShellExtInit, IContextMenu

    Private SelectedFile As String

    Public Sub Initialize(ByVal pidlFolder As IntPtr, ByVal pDataObj As IntPtr, ByVal hKeyProgID As IntPtr) Implements IShellExtInit.Initialize

        '選択されているファイル/ディレクトリを取得
        If (pDataObj = IntPtr.Zero) Then
            Throw New ArgumentException
        End If
        Dim fe As New FORMATETC
        With fe
            .cfFormat = CLIPFORMAT.CF_HDROP
            .ptd = IntPtr.Zero
            .dwAspect = DVASPECT.DVASPECT_CONTENT
            .lindex = -1
            .tymed = TYMED.TYMED_HGLOBAL
        End With
        Dim stm As New STGMEDIUM
        Dim dataObject As IDataObject = Marshal.GetObjectForIUnknown(pDataObj)
        dataObject.GetData(fe, stm)
        Try
            Dim hDrop As IntPtr = stm.unionmember
            If (hDrop = IntPtr.Zero) Then
                Throw New ArgumentException
            End If
            Dim nFiles As UInteger = WinApi.DragQueryFile(hDrop, UInt32.MaxValue, Nothing, 0)
            If (nFiles = 1) Then
                Dim fileName As New StringBuilder(WinApi.MAX_PATH)
                If (0 = WinApi.DragQueryFile(hDrop, 0, fileName, fileName.Capacity)) Then
                    Marshal.ThrowExceptionForHR(WinError.E_FAIL)
                End If
                Me.SelectedFile = fileName.ToString
            Else
                Marshal.ThrowExceptionForHR(WinError.E_FAIL)
            End If
        Finally
            WinApi.ReleaseStgMedium((stm))
        End Try
    End Sub
</code></pre></div>
</div>

<h2>
<span id="querycontextmenu-メソッドを実装する" class="fragment"></span><a href="#querycontextmenu-%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>QueryContextMenu メソッドを実装する</h2>

<p>コンテキストメニューに項目を追加します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ContextMenuExtension.cs</span></div>
<div class="highlight"><pre class="with-code"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">ContextMenuExtension</span> <span class="p">:</span> <span class="n">IShellExtInit</span><span class="p">,</span> <span class="n">IContextMenu</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="kt">uint</span> <span class="n">IDM_SHOW_FILENAME</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">string</span> <span class="n">TXT_SHOW_FILENAME</span> <span class="p">=</span> <span class="s">"ファイル名を表示(&amp;D)"</span><span class="p">;</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="nf">QueryContextMenu</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hMenu</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">iMenu</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">idCmdFirst</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">idCmdLast</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">uFlags</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// メニュー項目を追加</span>
            <span class="k">if</span> <span class="p">(((</span><span class="kt">uint</span><span class="p">)</span><span class="n">CMF</span><span class="p">.</span><span class="n">CMF_DEFAULTONLY</span> <span class="p">&amp;</span> <span class="n">uFlags</span><span class="p">)</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">WinError</span><span class="p">.</span><span class="nf">MAKE_HRESULT</span><span class="p">(</span><span class="n">WinError</span><span class="p">.</span><span class="n">SEVERITY_SUCCESS</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">MENUITEMINFO</span> <span class="n">mii</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MENUITEMINFO</span><span class="p">();</span>
            <span class="n">mii</span><span class="p">.</span><span class="n">cbSize</span> <span class="p">=</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="n">Marshal</span><span class="p">.</span><span class="nf">SizeOf</span><span class="p">(</span><span class="n">mii</span><span class="p">);</span>
            <span class="n">mii</span><span class="p">.</span><span class="n">fMask</span> <span class="p">=</span> <span class="n">MIIM</span><span class="p">.</span><span class="n">MIIM_ID</span> <span class="p">|</span> <span class="n">MIIM</span><span class="p">.</span><span class="n">MIIM_TYPE</span> <span class="p">|</span> <span class="n">MIIM</span><span class="p">.</span><span class="n">MIIM_STATE</span><span class="p">;</span>
            <span class="n">mii</span><span class="p">.</span><span class="n">wID</span> <span class="p">=</span> <span class="n">idCmdFirst</span> <span class="p">+</span> <span class="n">IDM_SHOW_FILENAME</span><span class="p">;</span>
            <span class="n">mii</span><span class="p">.</span><span class="n">fType</span> <span class="p">=</span> <span class="n">MFT</span><span class="p">.</span><span class="n">MFT_STRING</span><span class="p">;</span>
            <span class="n">mii</span><span class="p">.</span><span class="n">dwTypeData</span> <span class="p">=</span> <span class="n">TXT_SHOW_FILENAME</span><span class="p">;</span>
            <span class="n">mii</span><span class="p">.</span><span class="n">fState</span> <span class="p">=</span> <span class="n">MFS</span><span class="p">.</span><span class="n">MFS_ENABLED</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">WinApi</span><span class="p">.</span><span class="nf">InsertMenuItem</span><span class="p">(</span><span class="n">hMenu</span><span class="p">,</span> <span class="n">iMenu</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="k">ref</span> <span class="n">mii</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">Marshal</span><span class="p">.</span><span class="nf">GetHRForLastWin32Error</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="c1">// 追加したメニュー項目の数を返す</span>
            <span class="k">return</span> <span class="n">WinError</span><span class="p">.</span><span class="nf">MAKE_HRESULT</span><span class="p">(</span><span class="n">WinError</span><span class="p">.</span><span class="n">SEVERITY_SUCCESS</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="vbnet">
<div class="code-lang"><span class="bold">ContextMenuExtension.vb</span></div>
<div class="highlight"><pre class="with-code"><code>Public Class ContextMenuExtension
    Implements IShellExtInit, IContextMenu

    Private IDM_SHOW_FILENAME As UInteger = 0
    Private TXT_SHOW_FILENAME As String = "ファイル名を表示(&amp;D)"

    Public Function QueryContextMenu(ByVal hMenu As IntPtr, ByVal iMenu As UInt32, ByVal idCmdFirst As UInt32, ByVal idCmdLast As UInt32, ByVal uFlags As UInt32) As Integer Implements IContextMenu.QueryContextMenu

        'メニュー項目を追加
        If ((CMF.CMF_DEFAULTONLY And uFlags) &lt;&gt; 0) Then
            Return WinError.MAKE_HRESULT(WinError.SEVERITY_SUCCESS, 0, 0)
        End If
        Dim mii As New MENUITEMINFO
        With mii
            .cbSize = Marshal.SizeOf(mii)
            .fMask = MIIM.MIIM_TYPE Or MIIM.MIIM_STATE Or MIIM.MIIM_ID
            .wID = idCmdFirst + Me.IDM_SHOW_FILENAME
            .fType = MFT.MFT_STRING
            .dwTypeData = Me.TXT_SHOW_FILENAME
            .fState = MFS.MFS_ENABLED
        End With
        If Not WinApi.InsertMenuItem(hMenu, iMenu, True, mii) Then
            Return Marshal.GetHRForLastWin32Error
        End If

        '追加したメニュー項目の数を返す
        Return WinError.MAKE_HRESULT(WinError.SEVERITY_SUCCESS, 0, 1))
    End Function
</code></pre></div>
</div>

<h2>
<span id="getcommandstring-メソッドを実装する" class="fragment"></span><a href="#getcommandstring-%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>GetCommandString メソッドを実装する</h2>

<p>エクスプローラのステータスバーに表示されるメッセージを設定します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ContextMenuExtension.cs</span></div>
<div class="highlight"><pre class="with-code"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">ContextMenuExtension</span> <span class="p">:</span> <span class="n">IShellExtInit</span><span class="p">,</span> <span class="n">IContextMenu</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="kt">string</span> <span class="n">MSG_SHOW_FILENAME</span> <span class="p">=</span> <span class="s">"ファイル名を表示します。"</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">GetCommandString</span><span class="p">(</span><span class="n">UIntPtr</span> <span class="n">idCmd</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">uFlags</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">pReserved</span><span class="p">,</span> <span class="n">StringBuilder</span> <span class="n">pszName</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">cchMax</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">idCmd</span><span class="p">.</span><span class="nf">ToUInt32</span><span class="p">()</span> <span class="p">!=</span> <span class="n">IDM_SHOW_FILENAME</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">GCS</span><span class="p">)</span><span class="n">uFlags</span> <span class="p">==</span> <span class="n">GCS</span><span class="p">.</span><span class="n">GCS_HELPTEXTW</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">MSG_SHOW_FILENAME</span><span class="p">.</span><span class="n">Length</span> <span class="p">&gt;</span> <span class="n">cchMax</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">Marshal</span><span class="p">.</span><span class="nf">ThrowExceptionForHR</span><span class="p">(</span><span class="n">WinError</span><span class="p">.</span><span class="n">STRSAFE_E_INSUFFICIENT_BUFFER</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">pszName</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>
                    <span class="n">pszName</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">MSG_SHOW_FILENAME</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="vbnet">
<div class="code-lang"><span class="bold">ContextMenuExtension.vb</span></div>
<div class="highlight"><pre class="with-code"><code>Public Class ContextMenuExtension
    Implements IShellExtInit, IContextMenu

    Private MSG_SHOW_FILENAME As String = "ファイル名を表示します。"

    Public Sub GetCommandString(ByVal idCmd As UIntPtr, ByVal uFlags As UInt32, ByVal pReserved As IntPtr, ByVal pszName As StringBuilder, ByVal cchMax As UInt32) Implements IContextMenu.GetCommandString

        If Not (idCmd.ToUInt32 = IDM_SHOW_FILENAME) Then
            Exit Sub
        End If
        If DirectCast(uFlags, GCS) = GCS.GCS_HELPTEXTW Then
            If (MSG_SHOW_FILENAME.Length &gt; (cchMax - 1)) Then
                Marshal.ThrowExceptionForHR(WinError.STRSAFE_E_INSUFFICIENT_BUFFER)
            Else
                pszName.Clear()
                pszName.Append(MSG_SHOW_FILENAME)
            End If
        End If
    End Sub
</code></pre></div>
</div>

<h2>
<span id="invokecommand-メソッドを実装する" class="fragment"></span><a href="#invokecommand-%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>InvokeCommand メソッドを実装する</h2>

<p>メニュー項目が選択されると呼出されます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ContextMenuExtension.cs</span></div>
<div class="highlight"><pre class="with-code"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">ContextMenuExtension</span> <span class="p">:</span> <span class="n">IShellExtInit</span><span class="p">,</span> <span class="n">IContextMenu</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">InvokeCommand</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">pici</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">CMINVOKECOMMANDINFO</span> <span class="n">ici</span> <span class="p">=</span> <span class="p">(</span><span class="n">CMINVOKECOMMANDINFO</span><span class="p">)</span><span class="n">Marshal</span><span class="p">.</span><span class="nf">PtrToStructure</span><span class="p">(</span><span class="n">pici</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">CMINVOKECOMMANDINFO</span><span class="p">));</span>
            <span class="c1">// ici.lpVerb の上位ワードが NULL でなければ</span>
            <span class="c1">// このメソッドは別のアプリケーションによって呼出されたものなので</span>
            <span class="c1">// そのまま返す</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">WinApi</span><span class="p">.</span><span class="nf">HighWord</span><span class="p">(</span><span class="n">ici</span><span class="p">.</span><span class="n">lpVerb</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">())</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// そうでなければ</span>
            <span class="c1">// シェルが呼出したもので</span>
            <span class="c1">// ici.lpVerb の下位ワードが、ユーザが選択したメニュー項目</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">WinApi</span><span class="p">.</span><span class="nf">LowWord</span><span class="p">(</span><span class="n">ici</span><span class="p">.</span><span class="n">lpVerb</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">())</span> <span class="p">==</span> <span class="n">IDM_SHOW_FILENAME</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">DoShowFileName</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">Marshal</span><span class="p">.</span><span class="nf">ThrowExceptionForHR</span><span class="p">(</span><span class="n">WinError</span><span class="p">.</span><span class="n">E_FAIL</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="vbnet">
<div class="code-lang"><span class="bold">ContextMenuExtension.vb</span></div>
<div class="highlight"><pre class="with-code"><code>Public Class ContextMenuExtension
    Implements IShellExtInit, IContextMenu

    Public Sub InvokeCommand(ByVal pici As IntPtr) Implements IContextMenu.InvokeCommand

        Dim ici As CMINVOKECOMMANDINFO = Marshal.PtrToStructure(pici, GetType(CMINVOKECOMMANDINFO))
        'ici.lpVerb の上位ワードが NULL でなければ
        'このメソッドは別のアプリケーションによって呼出されたものなので
        'そのまま返す
        If (WinApi.HighWord(ici.lpVerb.ToInt32) &lt;&gt; 0) Then
            Exit Sub
        End If

        'そうでなければ
        'シェルが呼出したもので
        'ici.lpVerb の下位ワードが、ユーザが選択したメニュー項目
        If (WinApi.LowWord(ici.lpVerb.ToInt32) = IDM_SHOW_FILENAME) Then
            Me.DoShowFileName()
        Else
            Marshal.ThrowExceptionForHR(WinError.E_FAIL)
        End If
    End Sub
</code></pre></div>
</div>

<p>主な機能は「DoShowFileName」。選択したファイルの名称を表示します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ContextMenuExtension.cs</span></div>
<div class="highlight"><pre class="with-code"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">ContextMenuExtension</span> <span class="p">:</span> <span class="n">IShellExtInit</span><span class="p">,</span> <span class="n">IContextMenu</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">void</span> <span class="nf">DoShowFileName</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Forms</span><span class="p">.</span><span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">"選択されたファイル: "</span> <span class="p">+</span> <span class="n">Environment</span><span class="p">.</span><span class="n">NewLine</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">selectedFile</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="vbnet">
<div class="code-lang"><span class="bold">ContextMenuExtension.vb</span></div>
<div class="highlight"><pre class="with-code"><code>Public Class ContextMenuExtension
    Implements IShellExtInit, IContextMenu

    Private Sub DoShowFileName(hwnd As IntPtr)
        System.Windows.Forms.MessageBox.Show("選択されたファイル: " &amp; Environment.NewLine &amp; Me.SelectedFile, My.Application.Info.Title)
    End Sub
</code></pre></div>
</div>

<h2>
<span id="com-サーバ登録機能を実装する" class="fragment"></span><a href="#com-%E3%82%B5%E3%83%BC%E3%83%90%E7%99%BB%E9%8C%B2%E6%A9%9F%E8%83%BD%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>COM サーバ登録機能を実装する</h2>

<p>作成しているクラスライブラリが COM サーバとして登録できるようにします。</p>

<p>まず、アセンブリを COM 参照可能にします。以下の手順で作業します。</p>

<blockquote>
<p>プロジェクトの「プロパティ」を開く。<br>
「アプリケーション」タブを選択。<br>
「アセンブリ情報」を押下。<br>
ダイアログボックスで「アセンブリを COM 参照可能にする」にチェック。</p>
</blockquote>

<p>次に、アセンブリに署名します。以下の手順で作業します。</p>

<blockquote>
<p>プロジェクトの「プロパティ」を開く。<br>
「署名」タブを選択。<br>
「アセンブリに署名する」をチェック。<br>
「厳密な名前のキーファイルを選択」で「新規作成」を選択。<br>
ダイアログボックスで「キーファイル名」に任意のファイル名を指定。<br>
「キーファイルをパスワードで保護する」は必須ではない。</p>
</blockquote>

<p>クラスに属性を設定します。</p>

<p>GUID はクラスごとに新規作成して下さい。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ContextMenuExtension.cs</span></div>
<div class="highlight"><pre class="with-code"><code>    <span class="p">[</span><span class="nf">ClassInterface</span><span class="p">(</span><span class="n">ClassInterfaceType</span><span class="p">.</span><span class="n">None</span><span class="p">),</span>
    <span class="nf">Guid</span><span class="p">(</span><span class="s">"99999999-9999-9999-9999-9999999999"</span><span class="p">),</span> 
    <span class="nf">ComVisible</span><span class="p">(</span><span class="k">true</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ContextMenuExtension</span> <span class="p">:</span> <span class="n">IShellExtInit</span><span class="p">,</span> <span class="n">IContextMenu</span>
    <span class="p">{</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="vbnet">
<div class="code-lang"><span class="bold">ContextMenuExtension.vb</span></div>
<div class="highlight"><pre class="with-code"><code>&lt;ClassInterface(ClassInterfaceType.None),
Guid("99999999-9999-9999-9999-9999999999"),
ComVisible(True)&gt;
Public Class ContextMenuExtension
    Implements IShellExtInit, IContextMenu
</code></pre></div>
</div>

<p>登録および解除のためのメソッドを実装します。</p>

<p>ここで対象となるファイルの拡張子を指定します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ContextMenuExtension.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Microsoft.Win32</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">ContextMenuExtension</span> <span class="p">:</span> <span class="n">IShellExtInit</span><span class="p">,</span> <span class="n">IContextMenu</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">Description</span> <span class="p">=</span> <span class="s">"ContextMenuExtention Class"</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">TargetFileType</span> <span class="p">=</span> <span class="s">"*"</span><span class="p">;</span>

        <span class="p">[</span><span class="nf">ComRegisterFunction</span><span class="p">()]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Register</span><span class="p">(</span><span class="n">Type</span> <span class="n">t</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="n">Guid</span> <span class="n">clsid</span> <span class="p">=</span> <span class="n">t</span><span class="p">.</span><span class="n">GUID</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">clsid</span> <span class="p">==</span> <span class="n">Guid</span><span class="p">.</span><span class="n">Empty</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"clsid must not be empty"</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="kt">string</span> <span class="n">keyName</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"{0}\\shellex\\ContextMenuHandlers\\{1}"</span><span class="p">,</span> <span class="n">TargetFileType</span><span class="p">,</span> <span class="n">clsid</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"B"</span><span class="p">));</span>
                <span class="k">using</span> <span class="p">(</span><span class="n">RegistryKey</span> <span class="n">key</span> <span class="p">=</span> <span class="n">Registry</span><span class="p">.</span><span class="n">ClassesRoot</span><span class="p">.</span><span class="nf">CreateSubKey</span><span class="p">(</span><span class="n">keyName</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">Description</span><span class="p">))</span>
                    <span class="p">{</span>
                        <span class="n">key</span><span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">Description</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
                <span class="k">throw</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">ComUnregisterFunction</span><span class="p">()]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Unregister</span><span class="p">(</span><span class="n">Type</span> <span class="n">t</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="n">Guid</span> <span class="n">clsid</span> <span class="p">=</span> <span class="n">t</span><span class="p">.</span><span class="n">GUID</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">clsid</span> <span class="p">==</span> <span class="n">Guid</span><span class="p">.</span><span class="n">Empty</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"clsid must not be empty"</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="kt">string</span> <span class="n">keyName</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"{0}\\shellex\\ContextMenuHandlers\\{1}"</span><span class="p">,</span> <span class="n">TargetFileType</span><span class="p">,</span> <span class="n">clsid</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"B"</span><span class="p">));</span>
                <span class="n">Registry</span><span class="p">.</span><span class="n">ClassesRoot</span><span class="p">.</span><span class="nf">DeleteSubKeyTree</span><span class="p">(</span><span class="n">keyName</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
                <span class="k">throw</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="vbnet">
<div class="code-lang"><span class="bold">ContextMenuExtension.vb</span></div>
<div class="highlight"><pre class="with-code"><code>Imports Microsoft.Win32

Public Class ContextMenuExtension
    Implements IShellExtInit, IContextMenu

    Private Const Description As String = "ContextMenuExtention Class"
    Private Const TargetFileType As String = "*"

    &lt;ComRegisterFunction()&gt;
    Public Shared Sub Register(ByVal t As Type)
        Try
            Dim clsid = t.GUID
            If clsid = Guid.Empty Then
                Throw New ArgumentException("clsid must not be empty")
            End If
            Dim keyName As String = String.Format("{0}\shellex\ContextMenuHandlers\{1}", TargetFileType, clsid.ToString("B"))
            Using key As RegistryKey = Registry.ClassesRoot.CreateSubKey(keyName)
                If ((key IsNot Nothing) AndAlso (Not String.IsNullOrEmpty(Description))) Then
                    key.SetValue(Nothing, Description)
                End If
            End Using
        Catch ex As Exception
            Console.WriteLine(ex.Message)
            Throw
        End Try
    End Sub

    &lt;ComUnregisterFunction()&gt;
    Public Shared Sub Unregister(ByVal t As Type)
        Try
            Dim clsid = t.GUID
            If clsid = Guid.Empty Then
                Throw New ArgumentException("clsid must not be empty")
            End If
            Dim keyName As String = String.Format("{0}\shellex\ContextMenuHandlers\{1}", TargetFileType, clsid.ToString("B"))
            Registry.ClassesRoot.DeleteSubKeyTree(keyName, False)
        Catch ex As Exception
            Console.WriteLine(ex.Message)
            Throw
        End Try
    End Sub
</code></pre></div>
</div>

<h2>
<span id="ビルドする" class="fragment"></span><a href="#%E3%83%93%E3%83%AB%E3%83%89%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ビルドする</h2>

<p>ビルドするとアセンブリファイルが作成されます。これを COM サーバとして Windows に登録します。</p>

<h2>
<span id="com-サーバとして登録する" class="fragment"></span><a href="#com-%E3%82%B5%E3%83%BC%E3%83%90%E3%81%A8%E3%81%97%E3%81%A6%E7%99%BB%E9%8C%B2%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>COM サーバとして登録する</h2>

<p>C# または VB.NET で作成したアセンブリファイルを COM サーバとして登録するには、.NET Framework に同梱されている「regasm」ツールを使います。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>regasm ContextMenuExtension.dll /codebase
</code></pre></div></div>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>以下の記事も書いています。<br>
<a href="http://qiita.com/tinymouse/items/eb8aebb39ddd5c103347" id="reference-3494e78c530de60b752e">.NET で Windows エクスプローラのコンテキストメニューを拡張 - Qiita</a><br>
上記のコードの大半をライブラリにした SharpShell を使用しています。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Ftinymouse%2Fitems%2F26c1bfa0d2a6a2116cff&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Ftinymouse%2Fitems%2F26c1bfa0d2a6a2116cff&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tinymouse/items/26c1bfa0d2a6a2116cff/likers" class="css-1iupg5d">17</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">14</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/26c1bfa0d2a6a2116cff/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tinymouse/items/26c1bfa0d2a6a2116cff/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tinymouse/items/26c1bfa0d2a6a2116cff/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tinymouse/items/26c1bfa0d2a6a2116cff/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tinymouse/items/26c1bfa0d2a6a2116cff.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-0b44d63b-939e-4674-abad-4ca6712ae092">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-2a01bbfe-e915-490f-bcaf-f2ee9c3aaedd"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-2a01bbfe-e915-490f-bcaf-f2ee9c3aaedd">{}</script>
      
<div id="LoginModal-react-component-fdacc00a-3d87-4bfd-bbd0-768f16e360cc"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-fdacc00a-3d87-4bfd-bbd0-768f16e360cc">{}</script>
      
<div id="StockModal-react-component-7dc5bee1-dd6a-4bc8-9809-d467ef3d8224"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-7dc5bee1-dd6a-4bc8-9809-d467ef3d8224">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;1t+aZentd7hidtAeGhnNkqbLNeXY4x6T7RsENN6Ghc5Tl3ShXNq5JjmH31TAa2XpX5fjP1HAbejCssePoJyBOA==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e僕は以前 Delphi で Windows のシェル拡張（Shell Extension）を使ってエクスプローラに機能を追加するアプリを作りました。\u003cbr\u003e\n\u003ca href=\"http://hp.vector.co.jp/authors/VA029585/EzExpEx/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e簡単エクスプローラ拡張 EzExpEx\u003c/a\u003e\u003cbr\u003e\nこれは残念なことに 64 ビット Windows のエクスプローラで動かないんですよね。僕が持っている Delphi では 64 ビット Windows アプリを作れないんです。\u003cbr\u003e\nこれを VB.NET で作り直したいとずっと思っていました。\u003c/p\u003e\n\n\u003cp\u003eそのために調べていると次の記事がありました。\u003cbr\u003e\n\u003ca href=\"http://www.codeproject.com/Articles/174369/How-to-Write-Windows-Shell-Extension-with-NET-Lang\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHow to Write Windows Shell Extension with .NET Languages - CodeProject\u003c/a\u003e\u003cbr\u003e\nこれを参考にしてプログラムを書いてみました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"windows-シェル拡張でコンテキストメニュー\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#windows-%E3%82%B7%E3%82%A7%E3%83%AB%E6%8B%A1%E5%BC%B5%E3%81%A7%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%83%A1%E3%83%8B%E3%83%A5%E3%83%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWindows シェル拡張でコンテキストメニュー\u003c/h1\u003e\n\n\u003cp\u003eエクスプローラで右クリックするとコンテキストメニューが表示されます。このメニューに独自の項目を追加します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"プロジェクトを作る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプロジェクトを作る\u003c/h2\u003e\n\n\u003cp\u003eまず、「クラスライブラリ」のプロジェクトを新規作成します。\u003c/p\u003e\n\n\u003cp\u003eここではプロジェクト名を「ContextMenuExtension」にします。\u003c/p\u003e\n\n\u003cp\u003e次に、プロジェクトの「参照」設定に以下のアセンブリを追加します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSystem.Windows.Forms\u003c/li\u003e\n\u003cli\u003eSystem.Drawing\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIDE が作成したソースファイル「Class1.cs」または「Class1.vb」を「ContextMenuExtension.cs」または「ContextMenuExtension.vb」にリネームします。* 好きなファイル名で構いません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ishellextinit-と-icontextmenu-を用意する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ishellextinit-%E3%81%A8-icontextmenu-%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eIShellExtInit と IContextMenu を用意する\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.InteropServices\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Text\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eContextMenuExtension\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eComImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \n    \u003cspan class=\"nf\"\u003eInterfaceType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eComInterfaceType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInterfaceIsIUnknown\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"000214e8-0000-0000-c000-000000000046\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIShellExtInit\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInitialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"cm\"\u003e/*LPCITEMIDLIST*/\u003c/span\u003e \u003cspan class=\"n\"\u003epidlFolder\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"cm\"\u003e/*LPDATAOBJECT*/\u003c/span\u003e \u003cspan class=\"n\"\u003epDataObj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"cm\"\u003e/*HKEY*/\u003c/span\u003e \u003cspan class=\"n\"\u003ehKeyProgID\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eComImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \n    \u003cspan class=\"nf\"\u003eInterfaceType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eComInterfaceType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInterfaceIsIUnknown\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"000214e4-0000-0000-c000-000000000046\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIContextMenu\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePreserveSig\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003eQueryContextMenu\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"cm\"\u003e/*HMENU*/\u003c/span\u003e \u003cspan class=\"n\"\u003ehMenu\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eiMenu\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eidCmdFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eidCmdLast\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003euFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInvokeCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003epici\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetCommandString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003eidCmd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003euFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003epReserved\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eStringBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003epszName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ecchMax\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vbnet\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.vb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eImports System.Runtime.InteropServices\nImports System.Text\n\n\u0026lt;ComImport(),\nInterfaceType(ComInterfaceType.InterfaceIsIUnknown),\nGuid(\"000214e8-0000-0000-c000-000000000046\")\u0026gt;\nFriend Interface IShellExtInit\n    Sub Initialize(ByVal pidlFolder As IntPtr, ByVal pDataObj As IntPtr, ByVal hKeyProgID As IntPtr)\nEnd Interface\n\n\u0026lt;ComImport(),\nInterfaceType(ComInterfaceType.InterfaceIsIUnknown),\nGuid(\"000214e4-0000-0000-c000-000000000046\")\u0026gt;\nFriend Interface IContextMenu\n    \u0026lt;PreserveSig()\u0026gt;\n    Function QueryContextMenu(ByVal hMenu As IntPtr, ByVal iMenu As UInt32, ByVal idCmdFirst As UInt32, ByVal idCmdLast As UInt32, ByVal uFlags As UInt32) As Integer\n    Sub InvokeCommand(ByVal pici As IntPtr)\n    Sub GetCommandString(ByVal idCmd As UIntPtr, ByVal uFlags As UInt32, ByVal pReserved As IntPtr, ByVal pszName As StringBuilder, ByVal cchMax As UInt32)\nEnd Interface\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ishellextinit-と-icontextmenu-から派生する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ishellextinit-%E3%81%A8-icontextmenu-%E3%81%8B%E3%82%89%E6%B4%BE%E7%94%9F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eIShellExtInit と IContextMenu から派生する\u003c/h2\u003e\n\n\u003cp\u003e「ContextMenuExtension」クラスを「IShellExtInit」「IContextMenu」から派生するよう書換します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eContextMenuExtension\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIShellExtInit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIContextMenu\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vbnet\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.vb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003ePublic Class ContextMenuExtension\n    Implements IShellExtInit, IContextMenu\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eIDE が「インターフェイスの実装」を助言してくるので従って以下のメソッドを実装します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eInitialize\u003c/li\u003e\n\u003cli\u003eQueryContextMenu\u003c/li\u003e\n\u003cli\u003eGetComandString\u003c/li\u003e\n\u003cli\u003eInvokeCommand\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"必要な定数やメソッドを用意する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%85%E8%A6%81%E3%81%AA%E5%AE%9A%E6%95%B0%E3%82%84%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e必要な定数やメソッドを用意する\u003c/h2\u003e\n\n\u003cp\u003e必要な定数やメソッドを用意します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.InteropServices.ComTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eCsContextMenuExtension\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eCLIPFORMAT\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_TEXT\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_BITMAP\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_METAFILEPICT\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_SYLK\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_DIF\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_TIFF\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_OEMTEXT\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_DIB\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_PALETTE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_PENDATA\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_RIFF\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_WAVE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e12\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_UNICODETEXT\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_ENHMETAFILE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e14\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_HDROP\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_LOCALE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_MAX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e17\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eCF_OWNERDISPLAY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0080\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_DSPTEXT\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0081\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_DSPBITMAP\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0082\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_DSPMETAFILEPICT\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0083\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_DSPENHMETAFILE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x008E\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eCF_PRIVATEFIRST\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0200\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_PRIVATELAST\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x02FF\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eCF_GDIOBJFIRST\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0300\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCF_GDIOBJLAST\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x03FF\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eWinError\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eS_OK\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eS_FALSE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0001\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eE_FAIL\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e2147467259\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eE_INVALIDARG\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e2147024809\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eE_OUTOFMEMORY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e2147024882\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eSTRSAFE_E_INSUFFICIENT_BUFFER\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e2147024774\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eSEVERITY_SUCCESS\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eSEVERITY_ERROR\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003eMAKE_HRESULT\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003esev\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003efac\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)((\u003c/span\u003e\u003cspan class=\"n\"\u003esev\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e31\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efac\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eMIIM\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMIIM_STATE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000001\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMIIM_ID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000002\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMIIM_SUBMENU\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000004\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMIIM_CHECKMARKS\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000008\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMIIM_TYPE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000010\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMIIM_DATA\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000020\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMIIM_STRING\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000040\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMIIM_BITMAP\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000080\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMIIM_FTYPE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000100\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eMFT\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFT_STRING\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFT_BITMAP\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000004\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFT_MENUBARBREAK\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000020\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFT_MENUBREAK\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000040\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFT_OWNERDRAW\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFT_RADIOCHECK\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000200\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFT_SEPARATOR\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000800\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFT_RIGHTORDER\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00002000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFT_RIGHTJUSTIFY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00004000\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eMFS\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFS_ENABLED\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFS_UNCHECKED\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFS_UNHILITE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFS_GRAYED\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000003\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFS_DISABLED\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000003\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFS_CHECKED\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000008\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFS_HILITE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000080\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMFS_DEFAULT\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00001000\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eStructLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLayoutKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSequential\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCharSet\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCharSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUnicode\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eMENUITEMINFO\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ecbSize\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eMIIM\u003c/span\u003e \u003cspan class=\"n\"\u003efMask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eMFT\u003c/span\u003e \u003cspan class=\"n\"\u003efType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eMFS\u003c/span\u003e \u003cspan class=\"n\"\u003efState\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ewID\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehSubMenu\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehbmpChecked\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehbmpUnchecked\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eUIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003edwItemData\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003edwTypeData\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ecch\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehbmpItem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eCMF\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_NORMAL\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_DEFAULTONLY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000001\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_VERBSONLY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000002\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_EXPLORE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000004\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_NOVERBS\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000008\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_CANRENAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000010\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_NODEFAULT\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000020\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_INCLUDESTATIC\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000040\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_ITEMMENU\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000080\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_EXTENDEDVERBS\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_DISABLEDVERBS\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000200\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_ASYNCVERBSTATE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000400\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_OPTIMIZEFORINVOKE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000800\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_SYNCCASCADEMENU\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00001000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_DONOTPICKDEFAULT\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00002000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMF_RESERVED\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0xFFFF0000\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eCMIC\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMIC_MASK_ICON\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000010\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMIC_MASK_HOTKEY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000020\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMIC_MASK_NOASYNC\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMIC_MASK_FLAG_NO_UI\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000400\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMIC_MASK_UNICODE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00004000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMIC_MASK_NO_CONSOLE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00008000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMIC_MASK_ASYNCOK\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00100000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMIC_MASK_NOZONECHECKS\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00800000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMIC_MASK_FLAG_LOG_USAGE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x04000000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMIC_MASK_SHIFT_DOWN\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x10000000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMIC_MASK_PTINVOKE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x20000000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCMIC_MASK_CONTROL_DOWN\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x40000000\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eStructLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLayoutKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSequential\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCharSet\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCharSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUnicode\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003ePOINT\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eX\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eY\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eStructLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLayoutKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSequential\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCharSet\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCharSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUnicode\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eCMINVOKECOMMANDINFO\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ecbSize\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eCMIC\u003c/span\u003e \u003cspan class=\"n\"\u003efMask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehwnd\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003elpVerb\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eMarshalAs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUnmanagedType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLPStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eMarshalAs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUnmanagedType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLPStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003edirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enShow\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003edwHotKey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehIcon\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eGCS\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eGCS_VERBA\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eGCS_HELPTEXTA\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000001\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eGCS_VALIDATEA\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000002\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eGCS_VERBW\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000004\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eGCS_HELPTEXTW\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000005\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eGCS_VALIDATEW\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000006\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eGCS_VERBICONW\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000014\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eGCS_UNICODE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x00000004\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eWinApi\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eMAX_PATH\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e260\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"shell32\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCharSet\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCharSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUnicode\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"nf\"\u003eDragQueryFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehDrop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eiFile\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eStringBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003epszFile\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecch\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ole32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCharSet\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCharSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUnicode\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eReleaseStgMedium\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eSTGMEDIUM\u003c/span\u003e \u003cspan class=\"n\"\u003epmedium\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"user32\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCharSet\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCharSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUnicode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSetLastError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eMarshalAs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUnmanagedType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBool\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eInsertMenuItem\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehMenu\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003euItem\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eMarshalAs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUnmanagedType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBool\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003efByPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eMENUITEMINFO\u003c/span\u003e \u003cspan class=\"n\"\u003emii\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003eHighWord\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003enumber\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"m\"\u003e0x80000000\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0x80000000\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enumber\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003enumber\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"m\"\u003e0xffff\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003eLowWord\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"m\"\u003e0xffff\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vbnet\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.vb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eImports System.Runtime.InteropServices.ComTypes\n\nFriend Enum CLIPFORMAT As UInt32\n    CF_TEXT = 1\n    CF_BITMAP = 2\n    CF_METAFILEPICT = 3\n    CF_SYLK = 4\n    CF_DIF = 5\n    CF_TIFF = 6\n    CF_OEMTEXT = 7\n    CF_DIB = 8\n    CF_PALETTE = 9\n    CF_PENDATA = 10\n    CF_RIFF = 11\n    CF_WAVE = 12\n    CF_UNICODETEXT = 13\n    CF_ENHMETAFILE = 14\n    CF_HDROP = 15\n    CF_LOCALE = \u0026amp;H10\n    CF_MAX = \u0026amp;H11\n\n    CF_OWNERDISPLAY = \u0026amp;H80\n    CF_DSPTEXT = \u0026amp;H81\n    CF_DSPBITMAP = \u0026amp;H82\n    CF_DSPMETAFILEPICT = \u0026amp;H83\n    CF_DSPENHMETAFILE = \u0026amp;H8E\n\n    CF_PRIVATEFIRST = \u0026amp;H200\n    CF_PRIVATELAST = \u0026amp;H2FF\n\n    CF_GDIOBJFIRST = \u0026amp;H300\n    CF_GDIOBJLAST = \u0026amp;H3FF\nEnd Enum\n\nFriend Class WinError\n    Public Const S_OK As Integer = 0\n    Public Const S_FALSE As Integer = 1\n    Public Const E_FAIL As Integer = -2147467259\n    Public Const E_INVALIDARG As Integer = -2147024809\n    Public Const E_OUTOFMEMORY As Integer = -2147024882\n    Public Const STRSAFE_E_INSUFFICIENT_BUFFER As Integer = -2147024774\n\n    Public Const SEVERITY_ERROR As UInt32 = 1\n    Public Const SEVERITY_SUCCESS As UInt32 = 0\n\n    Public Shared Function MAKE_HRESULT(ByVal sev As UInt32, ByVal fac As UInt32, ByVal code As UInt32) As Integer\n        Return CInt((((sev \u0026lt;\u0026lt; \u0026amp;H1F) Or (fac \u0026lt;\u0026lt; \u0026amp;H10)) Or code))\n    End Function\nEnd Class\n\n\u0026lt;Flags()\u0026gt;\nFriend Enum MIIM As UInt32\n    MIIM_STATE = 1\n    MIIM_ID = 2\n    MIIM_SUBMENU = 4\n    MIIM_CHECKMARKS = 8\n    MIIM_TYPE = \u0026amp;H10\n    MIIM_DATA = \u0026amp;H20\n    MIIM_STRING = \u0026amp;H40\n    MIIM_BITMAP = \u0026amp;H80\n    MIIM_FTYPE = \u0026amp;H100\nEnd Enum\n\nFriend Enum MFT As UInt32\n    MFT_STRING = 0\n    MFT_BITMAP = 4\n    MFT_MENUBARBREAK = \u0026amp;H20\n    MFT_MENUBREAK = \u0026amp;H40\n    MFT_OWNERDRAW = \u0026amp;H100\n    MFT_RADIOCHECK = \u0026amp;H200\n    MFT_SEPARATOR = \u0026amp;H800\n    MFT_RIGHTORDER = \u0026amp;H2000\n    MFT_RIGHTJUSTIFY = \u0026amp;H4000\nEnd Enum\n\nFriend Enum MFS As UInt32\n    MFS_ENABLED = 0\n    MFS_UNCHECKED = 0\n    MFS_UNHILITE = 0\n    MFS_DISABLED = 3\n    MFS_GRAYED = 3\n    MFS_CHECKED = 8\n    MFS_HILITE = \u0026amp;H80\n    MFS_DEFAULT = \u0026amp;H1000\nEnd Enum\n\n\u0026lt;StructLayout(LayoutKind.Sequential, CharSet:=CharSet.Unicode)\u0026gt;\nFriend Structure MENUITEMINFO\n    Public cbSize As UInt32\n    Public fMask As MIIM\n    Public fType As MFT\n    Public fState As MFS\n    Public wID As UInt32\n    Public hSubMenu As IntPtr\n    Public hbmpChecked As IntPtr\n    Public hbmpUnchecked As IntPtr\n    Public dwItemData As UIntPtr\n    Public dwTypeData As String\n    Public cch As UInt32\n    Public hbmpItem As IntPtr\nEnd Structure\n\n\u0026lt;Flags()\u0026gt;\nFriend Enum CMF\n    CMF_NORMAL = 0\n    CMF_DEFAULTONLY = 1\n    CMF_VERBSONLY = 2\n    CMF_EXPLORE = 4\n    CMF_NOVERBS = 8\n    CMF_CANRENAME = \u0026amp;H10\n    CMF_NODEFAULT = \u0026amp;H20\n    CMF_INCLUDESTATIC = \u0026amp;H40\n    CMF_ITEMMENU = \u0026amp;H80\n    CMF_EXTENDEDVERBS = \u0026amp;H100\n    CMF_DISABLEDVERBS = \u0026amp;H200\n    CMF_ASYNCVERBSTATE = \u0026amp;H400\n    CMF_OPTIMIZEFORINVOKE = \u0026amp;H800\n    CMF_SYNCCASCADEMENU = \u0026amp;H1000\n    CMF_DONOTPICKDEFAULT = \u0026amp;H2000\n    CMF_RESERVED = \u0026amp;HFFFF0000\nEnd Enum\n\n\u0026lt;Flags()\u0026gt;\nFriend Enum CMIC As UInt32\n    CMIC_MASK_ICON = \u0026amp;H10\n    CMIC_MASK_HOTKEY = \u0026amp;H20\n    CMIC_MASK_NOASYNC = \u0026amp;H100\n    CMIC_MASK_FLAG_NO_UI = \u0026amp;H400\n    CMIC_MASK_UNICODE = \u0026amp;H4000\n    CMIC_MASK_NO_CONSOLE = \u0026amp;H8000\n    CMIC_MASK_ASYNCOK = \u0026amp;H100000\n    CMIC_MASK_NOZONECHECKS = \u0026amp;H800000\n    CMIC_MASK_FLAG_LOG_USAGE = \u0026amp;H4000000\n    CMIC_MASK_SHIFT_DOWN = \u0026amp;H10000000\n    CMIC_MASK_PTINVOKE = \u0026amp;H20000000\n    CMIC_MASK_CONTROL_DOWN = \u0026amp;H40000000\nEnd Enum\n\n\u0026lt;StructLayout(LayoutKind.Sequential, CharSet:=CharSet.Unicode)\u0026gt;\nPublic Structure POINT\n    Public X As Integer\n    Public Y As Integer\nEnd Structure\n\n\u0026lt;StructLayout(LayoutKind.Sequential, CharSet:=CharSet.Unicode)\u0026gt;\nFriend Structure CMINVOKECOMMANDINFO\n    Public cbSize As UInt32\n    Public fMask As CMIC\n    Public hwnd As IntPtr\n    Public lpVerb As IntPtr\n    \u0026lt;MarshalAs(UnmanagedType.LPStr)\u0026gt;\n    Public parameters As String\n    \u0026lt;MarshalAs(UnmanagedType.LPStr)\u0026gt;\n    Public directory As String\n    Public nShow As Integer\n    Public dwHotKey As UInt32\n    Public hIcon As IntPtr\nEnd Structure\n\nFriend Enum GCS As UInt32\n    GCS_VERBA = 0\n    GCS_HELPTEXTA = 1\n    GCS_VALIDATEA = 2\n    GCS_HELPTEXTW = 5\n    GCS_UNICODE = 4\n    GCS_VERBW = 4\n    GCS_VALIDATEW = 6\n    GCS_VERBICONW = 20\nEnd Enum\n\nFriend Class WinApi\n    Public Const MAX_PATH As Integer = 260\n\n    \u0026lt;DllImport(\"shell32\", CharSet:=CharSet.Unicode)\u0026gt;\n    Public Shared Function DragQueryFile(ByVal hDrop As IntPtr, ByVal iFile As UInt32, ByVal pszFile As StringBuilder, ByVal cch As Integer) As UInt32\n    End Function\n\n    \u0026lt;DllImport(\"ole32.dll\", CharSet:=CharSet.Unicode)\u0026gt;\n    Public Shared Sub ReleaseStgMedium(ByRef pmedium As STGMEDIUM)\n    End Sub\n\n    \u0026lt;DllImport(\"user32\", CharSet:=CharSet.Unicode, SetLastError:=True)\u0026gt;\n    Public Shared Function InsertMenuItem(ByVal hMenu As IntPtr, ByVal uItem As UInt32, \u0026lt;MarshalAs(UnmanagedType.Bool)\u0026gt; ByVal fByPosition As Boolean, ByRef mii As MENUITEMINFO) As \u0026lt;MarshalAs(UnmanagedType.Bool)\u0026gt; Boolean\n    End Function\n\n    Public Shared Function HighWord(ByVal number As Integer) As Integer\n        Return If(((number And \u0026amp;H80000000) = \u0026amp;H80000000), (number \u0026gt;\u0026gt; \u0026amp;H10), ((number \u0026gt;\u0026gt; \u0026amp;H10) And \u0026amp;HFFFF))\n    End Function\n\n    Public Shared Function LowWord(ByVal number As Integer) As Integer\n        Return (number And \u0026amp;HFFFF)\n    End Function\nEnd Class\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"initialize-メソッドを実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#initialize-%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eInitialize メソッドを実装する\u003c/h2\u003e\n\n\u003cp\u003e選択されたファイル／フォルダを取得して変数にセットしておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eContextMenuExtension\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIShellExtInit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIContextMenu\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eselectedFile\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInitialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003epidlFolder\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003epDataObj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehKeyProgID\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 選択されているファイル/ディレクトリを取得\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epDataObj\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eZero\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eArgumentException\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eFORMATETC\u003c/span\u003e \u003cspan class=\"n\"\u003efe\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFORMATETC\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecfFormat\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eshort\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eCLIPFORMAT\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCF_HDROP\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eptd\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eZero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edwAspect\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDVASPECT\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDVASPECT_CONTENT\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etymed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTYMED\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTYMED_HGLOBAL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eSTGMEDIUM\u003c/span\u003e \u003cspan class=\"n\"\u003estm\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSTGMEDIUM\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eIDataObject\u003c/span\u003e \u003cspan class=\"n\"\u003edataObject\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIDataObject\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eMarshal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetObjectForIUnknown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epDataObj\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edataObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003efe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003estm\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehDrop\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eunionmember\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehDrop\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eZero\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eArgumentException\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003enFiles\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eWinApi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDragQueryFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehDrop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMaxValue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enFiles\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eStringBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003efileName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStringBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWinApi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMAX_PATH\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eWinApi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDragQueryFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehDrop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efileName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003efileName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eMarshal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eThrowExceptionForHR\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWinError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eE_FAIL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselectedFile\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efileName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eMarshal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eThrowExceptionForHR\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWinError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eE_FAIL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efinally\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eWinApi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReleaseStgMedium\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003estm\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vbnet\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.vb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003ePublic Class ContextMenuExtension\n    Implements IShellExtInit, IContextMenu\n\n    Private SelectedFile As String\n\n    Public Sub Initialize(ByVal pidlFolder As IntPtr, ByVal pDataObj As IntPtr, ByVal hKeyProgID As IntPtr) Implements IShellExtInit.Initialize\n\n        '選択されているファイル/ディレクトリを取得\n        If (pDataObj = IntPtr.Zero) Then\n            Throw New ArgumentException\n        End If\n        Dim fe As New FORMATETC\n        With fe\n            .cfFormat = CLIPFORMAT.CF_HDROP\n            .ptd = IntPtr.Zero\n            .dwAspect = DVASPECT.DVASPECT_CONTENT\n            .lindex = -1\n            .tymed = TYMED.TYMED_HGLOBAL\n        End With\n        Dim stm As New STGMEDIUM\n        Dim dataObject As IDataObject = Marshal.GetObjectForIUnknown(pDataObj)\n        dataObject.GetData(fe, stm)\n        Try\n            Dim hDrop As IntPtr = stm.unionmember\n            If (hDrop = IntPtr.Zero) Then\n                Throw New ArgumentException\n            End If\n            Dim nFiles As UInteger = WinApi.DragQueryFile(hDrop, UInt32.MaxValue, Nothing, 0)\n            If (nFiles = 1) Then\n                Dim fileName As New StringBuilder(WinApi.MAX_PATH)\n                If (0 = WinApi.DragQueryFile(hDrop, 0, fileName, fileName.Capacity)) Then\n                    Marshal.ThrowExceptionForHR(WinError.E_FAIL)\n                End If\n                Me.SelectedFile = fileName.ToString\n            Else\n                Marshal.ThrowExceptionForHR(WinError.E_FAIL)\n            End If\n        Finally\n            WinApi.ReleaseStgMedium((stm))\n        End Try\n    End Sub\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"querycontextmenu-メソッドを実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#querycontextmenu-%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eQueryContextMenu メソッドを実装する\u003c/h2\u003e\n\n\u003cp\u003eコンテキストメニューに項目を追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eContextMenuExtension\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIShellExtInit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIContextMenu\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eIDM_SHOW_FILENAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eTXT_SHOW_FILENAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ファイル名を表示(\u0026amp;D)\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003eQueryContextMenu\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehMenu\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eiMenu\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eidCmdFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eidCmdLast\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003euFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// メニュー項目を追加\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eCMF\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCMF_DEFAULTONLY\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003euFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eWinError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMAKE_HRESULT\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWinError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSEVERITY_SUCCESS\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMENUITEMINFO\u003c/span\u003e \u003cspan class=\"n\"\u003emii\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMENUITEMINFO\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emii\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecbSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eMarshal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSizeOf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emii\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emii\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efMask\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMIIM\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMIIM_ID\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eMIIM\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMIIM_TYPE\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eMIIM\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMIIM_STATE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emii\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eidCmdFirst\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eIDM_SHOW_FILENAME\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emii\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMFT\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMFT_STRING\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emii\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edwTypeData\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTXT_SHOW_FILENAME\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emii\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMFS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMFS_ENABLED\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003eWinApi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInsertMenuItem\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehMenu\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eiMenu\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003emii\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eMarshal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetHRForLastWin32Error\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 追加したメニュー項目の数を返す\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eWinError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMAKE_HRESULT\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWinError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSEVERITY_SUCCESS\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vbnet\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.vb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003ePublic Class ContextMenuExtension\n    Implements IShellExtInit, IContextMenu\n\n    Private IDM_SHOW_FILENAME As UInteger = 0\n    Private TXT_SHOW_FILENAME As String = \"ファイル名を表示(\u0026amp;D)\"\n\n    Public Function QueryContextMenu(ByVal hMenu As IntPtr, ByVal iMenu As UInt32, ByVal idCmdFirst As UInt32, ByVal idCmdLast As UInt32, ByVal uFlags As UInt32) As Integer Implements IContextMenu.QueryContextMenu\n\n        'メニュー項目を追加\n        If ((CMF.CMF_DEFAULTONLY And uFlags) \u0026lt;\u0026gt; 0) Then\n            Return WinError.MAKE_HRESULT(WinError.SEVERITY_SUCCESS, 0, 0)\n        End If\n        Dim mii As New MENUITEMINFO\n        With mii\n            .cbSize = Marshal.SizeOf(mii)\n            .fMask = MIIM.MIIM_TYPE Or MIIM.MIIM_STATE Or MIIM.MIIM_ID\n            .wID = idCmdFirst + Me.IDM_SHOW_FILENAME\n            .fType = MFT.MFT_STRING\n            .dwTypeData = Me.TXT_SHOW_FILENAME\n            .fState = MFS.MFS_ENABLED\n        End With\n        If Not WinApi.InsertMenuItem(hMenu, iMenu, True, mii) Then\n            Return Marshal.GetHRForLastWin32Error\n        End If\n\n        '追加したメニュー項目の数を返す\n        Return WinError.MAKE_HRESULT(WinError.SEVERITY_SUCCESS, 0, 1))\n    End Function\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"getcommandstring-メソッドを実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#getcommandstring-%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGetCommandString メソッドを実装する\u003c/h2\u003e\n\n\u003cp\u003eエクスプローラのステータスバーに表示されるメッセージを設定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eContextMenuExtension\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIShellExtInit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIContextMenu\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eMSG_SHOW_FILENAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ファイル名を表示します。\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetCommandString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003eidCmd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003euFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003epReserved\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eStringBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003epszName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ecchMax\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eidCmd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToUInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eIDM_SHOW_FILENAME\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eGCS\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003euFlags\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eGCS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGCS_HELPTEXTW\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMSG_SHOW_FILENAME\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecchMax\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eMarshal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eThrowExceptionForHR\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWinError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSTRSAFE_E_INSUFFICIENT_BUFFER\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003epszName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003epszName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMSG_SHOW_FILENAME\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vbnet\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.vb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003ePublic Class ContextMenuExtension\n    Implements IShellExtInit, IContextMenu\n\n    Private MSG_SHOW_FILENAME As String = \"ファイル名を表示します。\"\n\n    Public Sub GetCommandString(ByVal idCmd As UIntPtr, ByVal uFlags As UInt32, ByVal pReserved As IntPtr, ByVal pszName As StringBuilder, ByVal cchMax As UInt32) Implements IContextMenu.GetCommandString\n\n        If Not (idCmd.ToUInt32 = IDM_SHOW_FILENAME) Then\n            Exit Sub\n        End If\n        If DirectCast(uFlags, GCS) = GCS.GCS_HELPTEXTW Then\n            If (MSG_SHOW_FILENAME.Length \u0026gt; (cchMax - 1)) Then\n                Marshal.ThrowExceptionForHR(WinError.STRSAFE_E_INSUFFICIENT_BUFFER)\n            Else\n                pszName.Clear()\n                pszName.Append(MSG_SHOW_FILENAME)\n            End If\n        End If\n    End Sub\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"invokecommand-メソッドを実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#invokecommand-%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eInvokeCommand メソッドを実装する\u003c/h2\u003e\n\n\u003cp\u003eメニュー項目が選択されると呼出されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eContextMenuExtension\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIShellExtInit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIContextMenu\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInvokeCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003epici\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCMINVOKECOMMANDINFO\u003c/span\u003e \u003cspan class=\"n\"\u003eici\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCMINVOKECOMMANDINFO\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eMarshal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePtrToStructure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epici\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCMINVOKECOMMANDINFO\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// ici.lpVerb の上位ワードが NULL でなければ\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// このメソッドは別のアプリケーションによって呼出されたものなので\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// そのまま返す\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWinApi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eHighWord\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eici\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elpVerb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// そうでなければ\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// シェルが呼出したもので\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// ici.lpVerb の下位ワードが、ユーザが選択したメニュー項目\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWinApi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLowWord\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eici\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elpVerb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eIDM_SHOW_FILENAME\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDoShowFileName\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMarshal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eThrowExceptionForHR\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWinError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eE_FAIL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vbnet\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.vb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003ePublic Class ContextMenuExtension\n    Implements IShellExtInit, IContextMenu\n\n    Public Sub InvokeCommand(ByVal pici As IntPtr) Implements IContextMenu.InvokeCommand\n\n        Dim ici As CMINVOKECOMMANDINFO = Marshal.PtrToStructure(pici, GetType(CMINVOKECOMMANDINFO))\n        'ici.lpVerb の上位ワードが NULL でなければ\n        'このメソッドは別のアプリケーションによって呼出されたものなので\n        'そのまま返す\n        If (WinApi.HighWord(ici.lpVerb.ToInt32) \u0026lt;\u0026gt; 0) Then\n            Exit Sub\n        End If\n\n        'そうでなければ\n        'シェルが呼出したもので\n        'ici.lpVerb の下位ワードが、ユーザが選択したメニュー項目\n        If (WinApi.LowWord(ici.lpVerb.ToInt32) = IDM_SHOW_FILENAME) Then\n            Me.DoShowFileName()\n        Else\n            Marshal.ThrowExceptionForHR(WinError.E_FAIL)\n        End If\n    End Sub\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e主な機能は「DoShowFileName」。選択したファイルの名称を表示します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eContextMenuExtension\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIShellExtInit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIContextMenu\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoShowFileName\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eForms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"選択されたファイル: \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewLine\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselectedFile\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vbnet\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.vb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003ePublic Class ContextMenuExtension\n    Implements IShellExtInit, IContextMenu\n\n    Private Sub DoShowFileName(hwnd As IntPtr)\n        System.Windows.Forms.MessageBox.Show(\"選択されたファイル: \" \u0026amp; Environment.NewLine \u0026amp; Me.SelectedFile, My.Application.Info.Title)\n    End Sub\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"com-サーバ登録機能を実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#com-%E3%82%B5%E3%83%BC%E3%83%90%E7%99%BB%E9%8C%B2%E6%A9%9F%E8%83%BD%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCOM サーバ登録機能を実装する\u003c/h2\u003e\n\n\u003cp\u003e作成しているクラスライブラリが COM サーバとして登録できるようにします。\u003c/p\u003e\n\n\u003cp\u003eまず、アセンブリを COM 参照可能にします。以下の手順で作業します。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eプロジェクトの「プロパティ」を開く。\u003cbr\u003e\n「アプリケーション」タブを選択。\u003cbr\u003e\n「アセンブリ情報」を押下。\u003cbr\u003e\nダイアログボックスで「アセンブリを COM 参照可能にする」にチェック。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e次に、アセンブリに署名します。以下の手順で作業します。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eプロジェクトの「プロパティ」を開く。\u003cbr\u003e\n「署名」タブを選択。\u003cbr\u003e\n「アセンブリに署名する」をチェック。\u003cbr\u003e\n「厳密な名前のキーファイルを選択」で「新規作成」を選択。\u003cbr\u003e\nダイアログボックスで「キーファイル名」に任意のファイル名を指定。\u003cbr\u003e\n「キーファイルをパスワードで保護する」は必須ではない。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eクラスに属性を設定します。\u003c/p\u003e\n\n\u003cp\u003eGUID はクラスごとに新規作成して下さい。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eClassInterface\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eClassInterfaceType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"99999999-9999-9999-9999-9999999999\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \n    \u003cspan class=\"nf\"\u003eComVisible\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eContextMenuExtension\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIShellExtInit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIContextMenu\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vbnet\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.vb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u0026lt;ClassInterface(ClassInterfaceType.None),\nGuid(\"99999999-9999-9999-9999-9999999999\"),\nComVisible(True)\u0026gt;\nPublic Class ContextMenuExtension\n    Implements IShellExtInit, IContextMenu\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e登録および解除のためのメソッドを実装します。\u003c/p\u003e\n\n\u003cp\u003eここで対象となるファイルの拡張子を指定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.Win32\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eContextMenuExtension\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIShellExtInit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIContextMenu\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eDescription\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ContextMenuExtention Class\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eTargetFileType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"*\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eComRegisterFunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eRegister\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eGuid\u003c/span\u003e \u003cspan class=\"n\"\u003eclsid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGUID\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eclsid\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eArgumentException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"clsid must not be empty\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{0}\\\\shellex\\\\ContextMenuHandlers\\\\{1}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTargetFileType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eclsid\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"B\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRegistryKey\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eRegistry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClassesRoot\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateSubKey\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekeyName\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsNullOrEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDescription\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDescription\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eComUnregisterFunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUnregister\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eGuid\u003c/span\u003e \u003cspan class=\"n\"\u003eclsid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGUID\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eclsid\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eArgumentException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"clsid must not be empty\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{0}\\\\shellex\\\\ContextMenuHandlers\\\\{1}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTargetFileType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eclsid\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"B\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eRegistry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClassesRoot\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeleteSubKeyTree\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekeyName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vbnet\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eContextMenuExtension.vb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eImports Microsoft.Win32\n\nPublic Class ContextMenuExtension\n    Implements IShellExtInit, IContextMenu\n\n    Private Const Description As String = \"ContextMenuExtention Class\"\n    Private Const TargetFileType As String = \"*\"\n\n    \u0026lt;ComRegisterFunction()\u0026gt;\n    Public Shared Sub Register(ByVal t As Type)\n        Try\n            Dim clsid = t.GUID\n            If clsid = Guid.Empty Then\n                Throw New ArgumentException(\"clsid must not be empty\")\n            End If\n            Dim keyName As String = String.Format(\"{0}\\shellex\\ContextMenuHandlers\\{1}\", TargetFileType, clsid.ToString(\"B\"))\n            Using key As RegistryKey = Registry.ClassesRoot.CreateSubKey(keyName)\n                If ((key IsNot Nothing) AndAlso (Not String.IsNullOrEmpty(Description))) Then\n                    key.SetValue(Nothing, Description)\n                End If\n            End Using\n        Catch ex As Exception\n            Console.WriteLine(ex.Message)\n            Throw\n        End Try\n    End Sub\n\n    \u0026lt;ComUnregisterFunction()\u0026gt;\n    Public Shared Sub Unregister(ByVal t As Type)\n        Try\n            Dim clsid = t.GUID\n            If clsid = Guid.Empty Then\n                Throw New ArgumentException(\"clsid must not be empty\")\n            End If\n            Dim keyName As String = String.Format(\"{0}\\shellex\\ContextMenuHandlers\\{1}\", TargetFileType, clsid.ToString(\"B\"))\n            Registry.ClassesRoot.DeleteSubKeyTree(keyName, False)\n        Catch ex As Exception\n            Console.WriteLine(ex.Message)\n            Throw\n        End Try\n    End Sub\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ビルドする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%93%E3%83%AB%E3%83%89%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eビルドする\u003c/h2\u003e\n\n\u003cp\u003eビルドするとアセンブリファイルが作成されます。これを COM サーバとして Windows に登録します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"com-サーバとして登録する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#com-%E3%82%B5%E3%83%BC%E3%83%90%E3%81%A8%E3%81%97%E3%81%A6%E7%99%BB%E9%8C%B2%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCOM サーバとして登録する\u003c/h2\u003e\n\n\u003cp\u003eC# または VB.NET で作成したアセンブリファイルを COM サーバとして登録するには、.NET Framework に同梱されている「regasm」ツールを使います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eregasm ContextMenuExtension.dll /codebase\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h1\u003e\n\n\u003cp\u003e以下の記事も書いています。\u003cbr\u003e\n\u003ca href=\"http://qiita.com/tinymouse/items/eb8aebb39ddd5c103347\" id=\"reference-3494e78c530de60b752e\"\u003e.NET で Windows エクスプローラのコンテキストメニューを拡張 - Qiita\u003c/a\u003e\u003cbr\u003e\n上記のコードの大半をライブラリにした SharpShell を使用しています。\u003c/p\u003e\n","createdAt":"2016-10-22T13:50:17Z","elapsedYearsFromLastModifiedAt":4,"encryptedId":"vCqLFnVra+tgL8gQZc0XaJiD4M9MCiD+--8I4xw29HI1kPa74X--3S8WwM7s4nVeQldQ+5lKXg==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2016-11-27T07:35:10Z","likesCount":17,"linkUrl":"https://qiita.com/tinymouse/items/26c1bfa0d2a6a2116cff","organization":null,"originalId":432391,"stockedCount":14,"title":".NET で Windows エクスプローラのコンテキストメニューを拡張","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#windows-%E3%82%B7%E3%82%A7%E3%83%AB%E6%8B%A1%E5%BC%B5%E3%81%A7%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%83%A1%E3%83%8B%E3%83%A5%E3%83%BC\"\u003eWindows シェル拡張でコンテキストメニュー\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B\"\u003eプロジェクトを作る\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ishellextinit-%E3%81%A8-icontextmenu-%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003eIShellExtInit と IContextMenu を用意する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ishellextinit-%E3%81%A8-icontextmenu-%E3%81%8B%E3%82%89%E6%B4%BE%E7%94%9F%E3%81%99%E3%82%8B\"\u003eIShellExtInit と IContextMenu から派生する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BF%85%E8%A6%81%E3%81%AA%E5%AE%9A%E6%95%B0%E3%82%84%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003e必要な定数やメソッドを用意する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#initialize-%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003eInitialize メソッドを実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#querycontextmenu-%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003eQueryContextMenu メソッドを実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#getcommandstring-%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003eGetCommandString メソッドを実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#invokecommand-%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003eInvokeCommand メソッドを実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#com-%E3%82%B5%E3%83%BC%E3%83%90%E7%99%BB%E9%8C%B2%E6%A9%9F%E8%83%BD%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003eCOM サーバ登録機能を実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%93%E3%83%AB%E3%83%89%E3%81%99%E3%82%8B\"\u003eビルドする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#com-%E3%82%B5%E3%83%BC%E3%83%90%E3%81%A8%E3%81%97%E3%81%A6%E7%99%BB%E9%8C%B2%E3%81%99%E3%82%8B\"\u003eCOM サーバとして登録する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003eおわりに\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":4405,"uuid":"26c1bfa0d2a6a2116cff","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"RuC6nUgW9aXdzpelP+iTF0mGTdbm--QS/WKkJWqX12prBu--YQyJrECLn10vdZFCjIW+TA==","originalId":114460,"description":"SI 企業の SE であり、日曜プログラマであり、二児の父。","facebookUrl":null,"githubUrl":"https://github.com/tinymouse","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"Tiny Mouse","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/114460/profile-images/1473712599","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114460%2Fprofile-images%2F1473712599?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=89c748463684d8b579de4e841954034f","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F114460%2Fprofile-images%2F1473712599?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=efbd473d8ab1891f3c67fd7567aec588","urlName":"tinymouse","websiteUrl":"https://tinymouse.hatenadiary.com/","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"VB.Net","urlName":"vb.net"},{"name":"C#","urlName":"csharp"},{"name":".NET","urlName":".net"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

More than 3 years have passed since last update.最小二乗法の情報は、ネット上に溢れに溢れているのですが、
コーディングに至るまで複数のページを参照していたので、それらをまとめてみます。
（正直、最小二乗法そのものの理解は微妙なところです…）
とりあえず、ゴールはEXCELのLINESTと一致するところです。最小二乗法は近似式との差の二乗の総和が最小になる近似式を求めます。
この時、近似式は、直線でも曲線でも何でもいいです。
どんな近似式においても、差はになるかなと。なので、直線式の場合はと。上記4点においてとなります。
最小二乗法は近似式との差の二乗の総和が最小になる近似式を求めるので、
まずは、近似式との差の二乗の総和を求めます。データ数は4つとは限らないので、一般式で表します。ここで、頑張って未知数a,bを求めていきたいのですが、
そのためには、この数式をの行列式にもっていく必要があります。（LU分解を用いて、プログラムで方程式を解くため）
求めたい係数の行列Xは単純になのですが、この行列A、Bが結構曲者でして、どういう風に算出すればいいのかわかりませんでした。
そこで、コピペ参考にしたサイトはこちらで、かなり詳細に書いてあります。
（結論までの説明がかなり丁寧に、数式を交えて説明されています）なので、詳細はリンク先参照ということで、結論だけ書きますととなります。ちなみに、近似式が2次式の場合は、となり、行列A、Bにおいて下記法則性が見えるので問題ないかと思います。私の場合は、近似式が4次式だったので、とまぁ、こんな感じです。
コードにするとこんな感じ。下準備が完了したところで、ここから方程式を解くために行列AをLU分解します。
LU分解のコピペ参考元はこちらになります。
まず、行列L、Uは下記のように定義されます。つまりとなります。
これらをすべて展開するととなるはず。(力技)
これをコードで表現するとここで一度に戻ってみます。この式がLU分解によりとなったので、まずはとして、行列Zを求めていきます。つまり、下記式ですね。これらを分解するととなります。
ここで、未知の行列Zを求めるために式を整理します（ただ移項するだけ）z1がわかっているので、それを2行目に代入して、z2を求め、その結果からさらに3行目に代入してz3を求める感じで
すべての行列Zの値を求めます。
（※行列L（bij）と行列Bは既知で、行列Zが未知）
ただ、コーディングが前提になるのでこれらを一般化します。コードで表現すると下記のようになります。ここまでこれば、あと本丸の行列Xを求めるだけ。より、これらを分解するととなります。
ここで、未知の行列Xを求めるために式を整理します（ただ移項するだけ）同様に、すべての行列Xの値を求めます。
（※行列U（cij）と行列Zは既知で、行列Xが未知）
ただ、コーディングが前提になるのでこれらを一般化します。コードで表現すると下記のようになります。これでようやく、係数が算出できました（res配列の要素）
ソースをまとめるとこんな感じです。結果はこんなもんです。
まぁ今更ですけど、車輪の再発明とか言わないで…。
（どっかに落ちてるライブラリを用いる方が、いろいろとよろしいかと…）最後に改めてコピペ参考元を。
http://qiita.com/nakataSyunsuke/items/15a761506a401d108cad
http://hooktail.org/computer/index.php?LU%CA%AC%B2%F2



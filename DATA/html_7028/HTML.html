<!DOCTYPE html><html><head><meta charset="utf-8" /><title>【ASP.NET＆Microsoft SQL Server】IIS(local filesystem)で公開したWebアプリにSQL Serverを紐づける - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/belre/items/65422a8ee154476fd99b" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="XdBoS3E31nQFrf36TFzk9kvu0qlFWIZaLtJVRTg/YWHNVYblOnlMAMvyLEcAvOHs8yTQRlUngBQLKyyckWNBvA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@icedblack2" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="【ASP.NET＆Microsoft SQL Server】IIS(local filesystem)で公開したWebアプリにSQL Serverを紐づける - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRUVZOUUxrNUZWTy04aGsxcFkzSnZjMjltZENCVFVVd2dVMlZ5ZG1WeTQ0Q1JTVWxUS0d4dlkyRnNJR1pwYkdWemVYTjBaVzBwNDRHbjVZV3M2WmFMNDRHWDQ0R2ZWMlZpNDRLaTQ0T1g0NE9xNDRHclUxRk1JRk5sY25abGN1T0NrdWUwa09PQnBlT0JrZU9DaXcmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NTUxMjUyNTRmYWZmZjg0ZTk2YmZjMGI4MzI5NDMwYmU&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR0psYkhKbCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTc2YWI4ZThhMmZkOTQ0N2UzM2Q5MzRlODA5NmZjMzc0&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=899f4d9afa0b6b109b0c5bf055fa5316"><meta property="og:description" content="ちょっと詰まったので、色々調査しました、メモ.

私的にもまとめておくと、ほかの記事が読みやすかったりするので良いと思う。

SQL Serverって扱うの結構大変よね


開発＆動作環境


Windows 10 20H2 (OSビ..."><meta content="https://qiita.com/belre/items/65422a8ee154476fd99b" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,SQLServer,EntityFramework,IIS,ASP.NET_Core" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-96efc04d-761f-4d47-9e8c-70b4fd6ebfe8"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fbelre%2Fitems%2F65422a8ee154476fd99b">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fbelre%2Fitems%2F65422a8ee154476fd99b">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-96efc04d-761f-4d47-9e8c-70b4fd6ebfe8">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2021-08-03T18:18:17.000+09:00","dateModified":"2021-08-20T13:22:02.000+09:00","headline":"【ASP.NET＆Microsoft SQL Server】IIS(local filesystem)で公開したWebアプリにSQL Serverを紐づける","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRUVZOUUxrNUZWTy04aGsxcFkzSnZjMjltZENCVFVVd2dVMlZ5ZG1WeTQ0Q1JTVWxUS0d4dlkyRnNJR1pwYkdWemVYTjBaVzBwNDRHbjVZV3M2WmFMNDRHWDQ0R2ZWMlZpNDRLaTQ0T1g0NE9xNDRHclUxRk1JRk5sY25abGN1T0NrdWUwa09PQnBlT0JrZU9DaXcmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NTUxMjUyNTRmYWZmZjg0ZTk2YmZjMGI4MzI5NDMwYmU\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR0psYkhKbCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTc2YWI4ZThhMmZkOTQ0N2UzM2Q5MzRlODA5NmZjMzc0\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=899f4d9afa0b6b109b0c5bf055fa5316","mainEntityOfPage":"https://qiita.com/belre/items/65422a8ee154476fd99b","author":{"@type":"Person","address":"Hachioji, Tokyo","email":null,"identifier":"belre","name":"belre","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fprofile-images%2F1627982266?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=6a2be52f9e48cef8bf8b0a0d03332d8d","url":"https://qiita.com/belre","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"belre","type":"items","id":"65422a8ee154476fd99b"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"belre","type":"items","id":"65422a8ee154476fd99b"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"belre","type":"items","id":"65422a8ee154476fd99b"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/belre/items/65422a8ee154476fd99b","location":"/belre/items/65422a8ee154476fd99b","scheme":"https","host":"qiita.com","port":null,"pathname":"/belre/items/65422a8ee154476fd99b","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"+HDb5PzCMzANHJfrt8gHI1NOXouQ2TX1xf+Jz8n5I2xo9TVKt4ypRMNDRlb7KAI564RcZICmM7vgBvAWYKUDsQ==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-746a6cf2-d548-4483-bb65-7be4b690d1a6"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/belre/items/65422a8ee154476fd99b/likers" class="css-1iupg5d">0</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">1</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/65422a8ee154476fd99b/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/belre/items/65422a8ee154476fd99b/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/belre/items/65422a8ee154476fd99b/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/belre/items/65422a8ee154476fd99b/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/belre/items/65422a8ee154476fd99b.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/belre"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/profile-images/1627982266" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/belre" class="css-10ougpm">@<!-- -->belre</a><div class="css-1ay9vb9"><span><meta content="2021-08-03T09:18:17Z"/><time dateTime="2021-08-20T04:22:02Z" class="css-m19uds">updated at 2021-08-20</time></span></div></div></div></div></div><h1 class="css-cgzq40">【ASP.NET＆Microsoft SQL Server】IIS(local filesystem)で公開したWebアプリにSQL Serverを紐づける</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/sqlserver" class="css-4czcte">SQLServer</a><a href="/tags/entityframework" class="css-4czcte">EntityFramework</a><a href="/tags/iis" class="css-4czcte">IIS</a><a href="/tags/asp.net_core" class="css-4czcte">ASP.NET_Core</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>ちょっと詰まったので、色々調査しました、メモ.</p>

<p>私的にもまとめておくと、ほかの記事が読みやすかったりするので良いと思う。</p>

<p>SQL Serverって扱うの結構大変よね</p>

<h1>
<span id="開発動作環境" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E5%8B%95%E4%BD%9C%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>開発＆動作環境</h1>

<ul>
<li><p>Windows 10 20H2 (OSビルド19042.1110)</p></li>
<li><p>Visual Studio 2019 Professional (Version 16.9.4)</p></li>
<li><p>Microsoft SQL Server 2016 (13.0.4001)は、Visual Studio導入時に「ASP .NETとWeb開発」をクリックすると、同時にインストールされるものを設定する(※変更可)</p></li>
<li><p>SQL Serverに定義されたデータにアクセスするため、SQL Server Management Studioを導入</p></li>
</ul>

<p><qiita-embed-ogp src="https://docs.microsoft.com/ja-jp/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-ver15"></qiita-embed-ogp></p>

<ul>
<li><p>開発はASP .NET MVC Core 5で実施 (LTS版である6に今後移行する前提)</p></li>
<li><p>IISで実行するプログラムは、スタンドアロンまたはグループ内ネットワークのみアクセスするのを想定してfilesystemとする</p></li>
</ul>

<p>※有償で必要なものはVisual Studio 2019 Professionalのみ(意外とお手軽).頑張ればVS Codeでもいけるはずや.<br>
※IISのインストールなどの内容は他の記事を参考にすること</p>

<h1>
<span id="やりたいこと" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>やりたいこと</h1>

<p>以下、アプリケーションの定義ファイル(appsetting.json)の中身。</p>

<p>DBの設定用に</p>

<ul>
<li><p>OpMeasureDb  ... デバッグ用<br>
(Visual Studioの動作確認用に、IIS Expressを使って動作確認をする)</p></li>
<li><p>OpMeasureDbRuntime ... ランタイム用<br>
(本番の運用のために、IISを使って運用する. ソフトウエアのアップデートの時には、デプロイ先のfilesystemのファイルのみを入れ替えて実行できるようにする)</p></li>
</ul>

<p>として分割し、デバッグ用のデータベースは別の環境でテストを完了したものを用意する。</p>

<p><a href="https://camo.qiitausercontent.com/e5a19530f63cf32f0ed58f01801c6874d1e2c7a4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f61626231393961362d643266372d386261342d363863372d3161653331363531326664612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fabb199a6-d2f7-8ba4-68c7-1ae316512fda.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f878f43699dc23a8d6b52ce4ef6aaff7" alt="キャプチャ.PNG" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/abb199a6-d2f7-8ba4-68c7-1ae316512fda.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fabb199a6-d2f7-8ba4-68c7-1ae316512fda.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9401034d9026e8e046a51d1f4b60932b 1x" loading="lazy"></a></p>

<p>Visual Studio 2019の画面に従って、Publish(発行)を実施。<br>
発行時のディレクトリは、C:\deployment\を指定。</p>

<p><a href="https://camo.qiitausercontent.com/f06af4d33637fcaaa9d72e9fb2daf852e36a45d3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f62336631613637322d343961362d353461632d393163642d3764363162623236356534352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fb3f1a672-49a6-54ac-91cd-7d61bb265e45.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b952cc70d99d661395e69689f947b0f6" alt="キャプチャ2.PNG" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/b3f1a672-49a6-54ac-91cd-7d61bb265e45.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fb3f1a672-49a6-54ac-91cd-7d61bb265e45.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d8a9fbb7adc7ecb5009f01bff7247266 1x" loading="lazy"></a></p>

<p>発行するとこんな感じで、一連のexeファイルやdll、pdbファイル、jsonファイルなどを一気に出力してくれます</p>

<p><a href="https://camo.qiitausercontent.com/1f133211adb2d8d12ea666b14dd18d8f47a7af48/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f66633061366264392d313166622d326330312d306538352d3464666133656534613964392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Ffc0a6bd9-11fb-2c01-0e85-4dfa3ee4a9d9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f41a49a217c41c233f08a1d60b9b9b99" alt="キャプチャ3.PNG" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/fc0a6bd9-11fb-2c01-0e85-4dfa3ee4a9d9.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Ffc0a6bd9-11fb-2c01-0e85-4dfa3ee4a9d9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=989b98a2e7ba1230541ea27ceb2f5143 1x" loading="lazy"></a></p>

<p>このとき、OpMeasureDb_debugに定義されているように</p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><code><span class="p">{</span><span class="w">
 </span><span class="nl">"ConnectionStrings"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"OpMeasureDb_debug"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Server=(localdb)</span><span class="se">\\</span><span class="s2">mssqllocaldb;Database=OpMeasureDb;
      Trusted_Connection=true;MultipleActiveResultSets=true"</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>と書くと、C#側のstartup.csで定義されているメソッドConfigureServicesの引数IServiceCollection型servicesで、例えば</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">startup.cs</span></div>
<div class="highlight"><pre><code><span class="c1">// AppDbContextはDbContextを継承して作ったクラスで、</span>
<span class="c1">// Code Firstの形式で定義したクラス</span>
<span class="n">services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">AppDbContext</span><span class="p">&gt;(</span><span class="n">option</span> <span class="p">=&gt;</span> <span class="n">options</span><span class="p">.</span>
         <span class="nf">UseSqlServer</span><span class="p">(</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetConnectionString</span><span class="p">(</span><span class="s">"OpMeasureDb_debug"</span><span class="p">)));</span>

</code></pre></div>
</div>

<p>と書くだけで、SQL Server 2016で簡単にCode Firstを実現することが出来る。</p>

<p>ところで、これを例えば、ランタイムモードにしたときに</p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><code><span class="p">{</span><span class="w">
 </span><span class="nl">"ConnectionStrings"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"OpMeasureDb"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Server=(localdb)</span><span class="se">\\</span><span class="s2">mssqllocaldb;Database=OpMeasureDbRuntime;
      Trusted_Connection=true;MultipleActiveResultSets=true"</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>として、</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">startup.cs</span></div>
<div class="highlight"><pre><code><span class="c1">// AppDbContextはDbContextを継承して作ったクラスで、</span>
<span class="c1">// Code Firstの形式で定義したクラス</span>
<span class="n">services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">AppDbContext</span><span class="p">&gt;(</span><span class="n">option</span> <span class="p">=&gt;</span> <span class="n">options</span><span class="p">.</span>
         <span class="nf">UseSqlServer</span><span class="p">(</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetConnectionString</span><span class="p">(</span><span class="s">"OpMeasureDb"</span><span class="p">)));</span>

</code></pre></div>
</div>

<p>と書けば最初は通るものと考えていた。もちろん、Visual Studioでデフォルトで実行するときに使用されるIIS Expressでは実行されるし、生成されたexeを直接実行しても動くのだ。</p>

<p><strong>でも、これをIIS経由で動かそうとすると、DBがまともに動かなくなった。<br>
というか、動くけれども、Postmanやブラウザなどで、データ定義済みのデータベースからWebAPI経由でGET命令でデータ取得しようとしても、データが空のまま出力される。なぜだ！？と考えて、２日経ったとさ</strong></p>

<p><del>前置きがすごく長くなりました</del> SQL Serverを使うとこういうトラブルに見舞われやすいなと体感で感じます。</p>

<h1>
<span id="原因" class="fragment"></span><a href="#%E5%8E%9F%E5%9B%A0"><i class="fa fa-link"></i></a>原因</h1>

<p>Startup.csに、以下の文面を追加してみた。<br>
(静的クラスUserNLogに、PrintDebugと書くとデバッグ情報を出してくれるようにするとします)</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">Startup.cs</span></div>
<div class="highlight"><pre><code><span class="n">UserNLog</span><span class="p">.</span><span class="nf">PrintDebug</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Security</span><span class="p">.</span><span class="n">Principal</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Identity</span><span class="p">.</span><span class="nf">GetCurrent</span><span class="p">().</span><span class="n">Name</span><span class="p">);</span>
</code></pre></div>
</div>

<p>こう書くと、ユーザログオン名を出力してくれるようになるみたいなので、さっそくやってみました。<br>
すると、デバッグ時には</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>DEBUG DESKTOP-*******\myuser
</code></pre></div></div>

<p>という風に、例えばwindows認証のアカウントがmyuserだったら、コンピュータ名とアカウント名を同時に出力してくれていたのですが、IISで実行すると</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>DEBUG IIS APPPOOL/OPSimulator
</code></pre></div></div>

<p>と出ていました。</p>

<p>つまり、データベースにアクセスするときのユーザが違っていた。つまり、myuserには権限はあるけれども、APPPOOL/OPSimulatorにはデータベースにアクセスする権限がないというわけだ！</p>

<p>従って、APPPOOL/OPSimulatorにアクセス権を通せば、この課題はクリアになります。</p>

<h1>
<span id="解決策" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E7%AD%96"><i class="fa fa-link"></i></a>解決策</h1>

<h2>
<span id="いろいろありますがベターな方向性" class="fragment"></span><a href="#%E3%81%84%E3%82%8D%E3%81%84%E3%82%8D%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8C%E3%83%99%E3%82%BF%E3%83%BC%E3%81%AA%E6%96%B9%E5%90%91%E6%80%A7"><i class="fa fa-link"></i></a>いろいろありますがベターな方向性</h2>

<p>　ここから先、色々やり方はあると思います。<br>
　（詳しい内容は <a href="#%E5%8F%82%E8%80%83%E3%82%B5%E3%82%A4%E3%83%88">参考サイト</a> を参照）</p>

<p>①　例えば、SQL Serverのインスタンス名が登録されていないのだから、単純に言えばIIS側の設定で、常にDESKTOP-******* /myuserになるようにログイン出来るようにすればよいじゃない、という案が浮かびます。一応これ、可能です。</p>

<p>　方法は単純で、IISの画面からアプリケーションプールを開き、開こうとしているアプリケーション(今回であればOPSimulator)を右クリックし、詳細設定を押します。そこから、IDをDESKTOP-******* /myuserとすれば、解決できたりします。</p>

<p><a href="https://camo.qiitausercontent.com/70d5ddab7d618ffb8bdad1f46227aee15e0bdce7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f38326565336136652d333230312d663631372d396165312d3436643562623863623538642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F82ee3a6e-3201-f617-9ae1-46d5bb8cb58d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c309cd321d87556962d2562377cf3bb2" alt="キャプチャ4.PNG" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/82ee3a6e-3201-f617-9ae1-46d5bb8cb58d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F82ee3a6e-3201-f617-9ae1-46d5bb8cb58d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=cc1175f22aeeab780858c5d1a5cc89b4 1x" loading="lazy"></a></p>

<p>　ただし、IISが外部攻撃に遭った際に、DESKTOP-******* /myuser権限で実行できるものが実行できてしまいますので、業務アプリレベルでASPを使う用途でもアンチパターンとして避けるべきと考えます。</p>

<p>② <a href="#%E5%8F%82%E8%80%83%E3%82%B5%E3%82%A4%E3%83%88">参考サイト</a>の<strong>Approach 3</strong>のように、SQL Server 2016 (特にExpress)にはSQLEXPRESSという固有のグローバルインスタンスが存在するので、それを使うのもありです。 <del>個人的にはちょっと気持ち悪いけどね</del></p>

<p>③ 最後に、参考サイトのApproach 2のようなやり方。<br>
　そもそも、今のままで実行できていないかというと、MSSQLEXPRESSも実は固有のデータベースになっていて、共有データベースに設定できないからなのです。<br>
　<br>
　従って、共有可能なインスタンスを自分で作って、それを共有可能に設定し、ASP .NET側からも、共有インスタンスとしてデータベースアクセスするように変えればよいのです。</p>

<h2>
<span id="さて解決策" class="fragment"></span><a href="#%E3%81%95%E3%81%A6%E8%A7%A3%E6%B1%BA%E7%AD%96"><i class="fa fa-link"></i></a>さて、解決策</h2>

<h3>
<span id="1-dbの作成共有インスタンスに設定" class="fragment"></span><a href="#1-db%E3%81%AE%E4%BD%9C%E6%88%90%E5%85%B1%E6%9C%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AB%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>1. DBの作成＆共有インスタンスに設定</h3>

<p>Visual Studio開発者用コマンドプロンプトを<strong>管理者権限で</strong>開いて、次のように入力します</p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">DBの生成</span></div>
<div class="highlight"><pre><code>
C:\Windows\System32&gt;sqllocaldb create OPSimulator

LocalDBインスタンス "OPSimulator"はバージョン13.1.4001.0で作成されました。
</code></pre></div>
</div>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">生成されたDBの確認</span></div>
<div class="highlight"><pre><code>C:\Windows\System32&gt;sqllocaldb info
MSSQLLocalDB
OPSimulator
ProjectsV13
</code></pre></div>
</div>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">生成したOPSimulatorを共有インスタンスに指定</span></div>
<div class="highlight"><pre><code>C:\Windows\System32&gt;sqllocaldb share OPSimulator IIS_DB

プライベートLocalDBインスタンス "OPSimulator"は共有名"IIS_DB"で共有します。
</code></pre></div>
</div>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">共有インスタンスになっているかを確認</span></div>
<div class="highlight"><pre><code>C:\Windows\System32&gt;sqllocaldb info OPSimulator

名前　OPSimulator
バージョン　
...
共有名 IIS_DB
</code></pre></div>
</div>

<p>"test_db"でインスタンスを作るとこんな感じになります</p>

<p><a href="https://camo.qiitausercontent.com/c121e96f30aa0676d9b3c2bfc845961b45990237/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f33313436313339332d636563352d633163632d336462392d3761623537363330313861352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F31461393-cec5-c1cc-3db9-7ab5763018a5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=070899e283f2547bc89f62d5d6fe9dfa" alt="キャプチャ5.PNG" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/31461393-cec5-c1cc-3db9-7ab5763018a5.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F31461393-cec5-c1cc-3db9-7ab5763018a5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=bd1504287812be8d1dbcc446c707c77a 1x" loading="lazy"></a></p>

<h3>
<span id="2-生成したインスタンスをvisual-studioに紐づけ" class="fragment"></span><a href="#2-%E7%94%9F%E6%88%90%E3%81%97%E3%81%9F%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%82%92visual-studio%E3%81%AB%E7%B4%90%E3%81%A5%E3%81%91"><i class="fa fa-link"></i></a>2. 生成したインスタンスをVisual Studioに紐づけ</h3>

<p>Management Studioを開き、さっそく作成したOPSimulatorでログインしてみてください。</p>

<p><a href="https://camo.qiitausercontent.com/952011e270a402bc2db7509a91c4c57603171d4b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f30323563383331332d376639322d373035302d643331642d3834383036303536393331662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F025c8313-7f92-7050-d31d-84806056931f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d1f932619cb11db865f96129d20ac255" alt="キャプチャ6.PNG" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/025c8313-7f92-7050-d31d-84806056931f.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F025c8313-7f92-7050-d31d-84806056931f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2d7dd6afafc2f9e3da6671179ba72296 1x" loading="lazy"></a></p>

<p>さっそく権限を確認してみると、publicと一部のログイン情報以外は権限が与えられていないことが分かります。ただし、所有者であるDESKTOP-******* /myuserは気にせずとも権限が自動で設定されます。</p>

<p><a href="https://camo.qiitausercontent.com/9a5cf01f3b36a0bbadb1ab7b4fc2dddd06a8ffa3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f38363861313238372d353834352d393036642d303039652d3833316665373230653966372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F868a1287-5845-906d-009e-831fe720e9f7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=edaaa920ccd3f3254fdd97a2f366a4f1" alt="キャプチャ7.PNG" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/868a1287-5845-906d-009e-831fe720e9f7.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F868a1287-5845-906d-009e-831fe720e9f7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=171663ecd1f9b26f33167cc6cfbe2c6c 1x" loading="lazy"></a></p>

<p>次に生成されたインスタンスに無理やり権限が入るように設定します。<br>
Visual Studio 2019を開き、今データベースを使用としているソリューションを開きます。</p>

<p>その後に、「SQL Server Object Explorer」を開き、SQL Serverを右クリックして、SQL Serverを追加します。</p>

<p><a href="https://camo.qiitausercontent.com/e0150e9047976f369cf66de6aea10015ea830dea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f31643362373436312d633264622d393734312d666638312d6137336531343038393439312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F1d3b7461-c2db-9741-ff81-a73e14089491.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6e4f3b3fd7be84ce723ac6da23ca5386" alt="キャプチャ9.PNG" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/1d3b7461-c2db-9741-ff81-a73e14089491.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F1d3b7461-c2db-9741-ff81-a73e14089491.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7cc1821487176c190fb7bf415adbffe0 1x" loading="lazy"></a></p>

<p><a href="https://camo.qiitausercontent.com/9bd672dee3462735b05d84cf0b077f1b17c2dc7b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f64373233633531612d356531342d613330312d326434312d6262326133306231663332642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fd723c51a-5e14-a301-2d41-bb2a30b1f32d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=acf9af353c1b8c76a7ef13a0da899f2a" alt="キャプチャ8.PNG" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/d723c51a-5e14-a301-2d41-bb2a30b1f32d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fd723c51a-5e14-a301-2d41-bb2a30b1f32d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1f064dad29cbe6f44395be6b2b2f72e8 1x" loading="lazy"></a></p>

<p>接続(Connect)の画面が開かれたら、該当するDB（この場合OPSimulator)をクリックし、Connect(接続)をクリックします。</p>

<p>開いた後に、新たに追加されたDBインスタンスを開き、新たにクエリ文を追加します。<br>
クエリ文は、追加されたDBを押して「New Query(クエリの追加)」で作業できます。<br>
文章はこんな感じで打ちます。</p>

<div class="code-frame" data-lang="SQL">
<div class="code-lang"><span class="bold">権限登録</span></div>
<div class="highlight"><pre><code><span class="k">create</span> <span class="n">login</span> <span class="p">[</span><span class="n">IIS</span> <span class="n">APPPOOL</span><span class="err">\</span><span class="n">OPSimulator</span><span class="p">]</span> <span class="k">from</span> <span class="n">windows</span><span class="p">;</span>
<span class="k">exec</span> <span class="n">sp_addsrvrolemember</span> <span class="n">N</span><span class="s1">'IIS APPPOOL</span><span class="se">\O</span><span class="s1">PSimulator'</span><span class="p">,</span> <span class="n">sysadmin</span>
</code></pre></div>
</div>

<p>IIS APPPOOL\OPSimulatorの部分ですが、これはIISのアプリケーション名によって適宜変更します。<br>
実行すると、権限が割り振られますので、Management Studioを改めて開いてIIS APPPOOL\OPSimulator\に権限が追加されていることを確認します。</p>

<p><a href="https://camo.qiitausercontent.com/c90a90e5c5dc893424378399abb7188c2af612cc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f34623731613365352d623962352d383461642d656534312d3965663164323861376430612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F4b71a3e5-b9b5-84ad-ee41-9ef1d28a7d0a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=40ff38a672aa5c7c4549a9d2903b2538" alt="キャプチャ10.PNG" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/4b71a3e5-b9b5-84ad-ee41-9ef1d28a7d0a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F4b71a3e5-b9b5-84ad-ee41-9ef1d28a7d0a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9d4cac7d3304bf15a1b9b8d2bc34764e 1x" loading="lazy"></a></p>

<p>なお、この設定にするとsysadmin相当の権限が与えられますので、それを回避したい場合はManagement Studioで適宜変更します。</p>

<h3>
<span id="3-dbテーブルやスキーマの登録" class="fragment"></span><a href="#3-db%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%82%84%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%AE%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>3. DBテーブルやスキーマの登録</h3>

<p>まあ、ここはシステムによるところですね。<br>
SQL文をべた書きにしている場合は、ここでは扱わないとして、</p>

<p>Code Firstでマイグレーションでシステム構築している場合は、visual studioのpackage manager consoleを使って、次のように入力します。</p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">PackageConsoleManagerでのCodeFirstの実行</span></div>
<div class="highlight"><pre><code>&gt; update-database -connection 'server=(localdb)\OPSimulator;database=OpMeasureDbRuntime'
Build started
Build succeeded.
Done.
</code></pre></div>
</div>

<p>connectionに新たに作ったインスタンス名を置くのがポイントです。<br>
OpMeasureDbRuntimeの部分は別にデータベースが作られていなくても`、自動的に好き勝手に作ることが出来ます。</p>

<h3>
<span id="4-appsettingjsonの編集発行publish" class="fragment"></span><a href="#4-appsettingjson%E3%81%AE%E7%B7%A8%E9%9B%86%E7%99%BA%E8%A1%8Cpublish"><i class="fa fa-link"></i></a>4. appsetting.jsonの編集＆発行(publish)</h3>

<p>appsettings.jsonを書き換えて、発行(publish)します。</p>

<div class="code-frame" data-lang="json">
<div class="code-lang"><span class="bold">appsettings.json</span></div>
<div class="highlight"><pre><code><span class="p">{</span><span class="w">
 </span><span class="nl">"ConnectionStrings"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"OpMeasureDb"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Server=(localdb)</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">IIS_DB;Initial Catalog=OpMeasureDbRuntime;
      Integrated Security = true"</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
</div>

<p>発行後は、生成されたexeファイルを実行してください。<br>
この場合、簡易的にIIS Expressが実行されますが、DBエラーが発生する場合は強制終了します。</p>

<h3>
<span id="5-iiswebブラウザでの動作確認" class="fragment"></span><a href="#5-iisweb%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%A7%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>5. IIS＆Webブラウザでの動作確認</h3>

<p>IISですでにfilesystemでページを公開している場合は、IIS側では特別何かを行う必要がありません。</p>

<p>IIS自体の再起動は必要ですので、IISのアプリケーションプールで定義されたアプリケーションをもう一度起動すると良いでしょう。</p>

<h3>
<span id="6-スタートアップ動作確認" class="fragment"></span><a href="#6-%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>6. スタートアップ動作確認</h3>

<p>Windows 10が起動した段階では、DBインスタンスは起動しないので、SQL Serverのインスタンスは手動で実行する必要があります。<br>
もっとも簡単なのは、スタートアップから右クリック、ファイル名を指定して実行で「shell:startup」と入力して、<br>
そのフォルダの中に例えば、以下のようなバッチファイルを置くと良いでしょう。</p>

<div class="code-frame" data-lang="batchfile">
<div class="code-lang"><span class="bold">opmeasuredb_startup.bat</span></div>
<div class="highlight"><pre><code><span class="kd">sqllocaldb</span> <span class="nb">start</span> .\IIS_DB
</code></pre></div>
</div>

<h1>
<span id="タイムアウト対策" class="fragment"></span><a href="#%E3%82%BF%E3%82%A4%E3%83%A0%E3%82%A2%E3%82%A6%E3%83%88%E5%AF%BE%E7%AD%96"><i class="fa fa-link"></i></a>タイムアウト対策</h1>

<p><strong>(2021.8.20)更新</strong></p>

<p>6.に書いたsqllocaldb startは、それが実行されてから、一定時間(デフォルト10分)ログインされない状態が続くと、エラー終了してしまうようです。</p>

<p>その対策はこちら</p>

<p><qiita-embed-ogp src="https://stackoverflow.com/questions/14153509/how-to-prevent-sql-server-localdb-auto-shutdown"></qiita-embed-ogp></p>

<p>実質コピペしますが、コマンドプロンプトを開いて、こんな感じで実行します</p>

<div class="code-frame" data-lang="cmd"><div class="highlight"><pre><code>C:\&gt; sqlcmd -S np:\\.\pipe\LOCALDB#SH9D87FB\tsql\query

1&gt; sp_configure 'show advanced options', 1;
2&gt; GO

Configuration option 'show advanced options' changed from 1 to 1. 
Run the RECONFIGURE statement to install.

1&gt; RECONFIGURE;
2&gt; GO

1&gt; sp_configure 'user instance timeout', 5;
2&gt; GO

Configuration option 'user instance timeout' changed from 5 to 5. 
Run the RECONFIGURE statement to install.

1&gt; RECONFIGURE;
2&gt; GO
</code></pre></div></div>

<p>sp_configure 'user instance timeout', 5;のところで、時間を変えると、タイムアウト時間を変更できます。</p>

<h1>
<span id="私見" class="fragment"></span><a href="#%E7%A7%81%E8%A6%8B"><i class="fa fa-link"></i></a>私見</h1>

<p>Windows 11に変わりIISも正直レガシーの部類に入ってくるので、今後どうなるかはちょっと分からないです。</p>

<p>まあ、ASP .NET MVC Core 6がLTSとしてアップデートされますので、他のCoreに追随し切れていないフレームワークと比べると、いきなりなくなることはなさそう。 <del>でもこういうややこしい使い方は少し改善されてほしいよねぇ</del></p>

<h1>
<span id="参考サイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考サイト</h1>

<p>10年前の古い記事ですが、Microsoft SQL Server2016 &amp; Visual Studio 2019でも動作確認が出来た。<br>
Approach 2で対応しました。　</p>

<p><qiita-embed-ogp src="https://stackoverflow.com/questions/13308654/iis-connecting-to-localdb"></qiita-embed-ogp></p>

<p><qiita-embed-ogp src="https://blogs.msdn.microsoft.com/sqlexpress/2011/12/08/using-localdb-with-full-iis-part-2-instance-ownership/"></qiita-embed-ogp></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fbelre%2Fitems%2F65422a8ee154476fd99b&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fbelre%2Fitems%2F65422a8ee154476fd99b&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/belre/items/65422a8ee154476fd99b/likers" class="css-1iupg5d">0</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">1</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/65422a8ee154476fd99b/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/belre/items/65422a8ee154476fd99b/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/belre/items/65422a8ee154476fd99b/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/belre/items/65422a8ee154476fd99b/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/belre/items/65422a8ee154476fd99b.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-746a6cf2-d548-4483-bb65-7be4b690d1a6">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-6361668a-8249-46da-92aa-302049abfb3b"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-6361668a-8249-46da-92aa-302049abfb3b">{}</script>
      
<div id="LoginModal-react-component-49dec9b7-24bf-4856-ae11-46e35e353aa8"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-49dec9b7-24bf-4856-ae11-46e35e353aa8">{}</script>
      
<div id="StockModal-react-component-296d752d-46cc-4c7e-8f96-ee684aba4f91"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-296d752d-46cc-4c7e-8f96-ee684aba4f91">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;ego1afUkjMlzIiZxn/y7teFb895yt0iJRJ4rdDel6r3qj9vHvmoWvb1998zTHL6vWZHxMWLITsdhZ1KtnvnKYA==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003eちょっと詰まったので、色々調査しました、メモ.\u003c/p\u003e\n\n\u003cp\u003e私的にもまとめておくと、ほかの記事が読みやすかったりするので良いと思う。\u003c/p\u003e\n\n\u003cp\u003eSQL Serverって扱うの結構大変よね\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"開発動作環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%8B%E7%99%BA%E5%8B%95%E4%BD%9C%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e開発＆動作環境\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eWindows 10 20H2 (OSビルド19042.1110)\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eVisual Studio 2019 Professional (Version 16.9.4)\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eMicrosoft SQL Server 2016 (13.0.4001)は、Visual Studio導入時に「ASP .NETとWeb開発」をクリックすると、同時にインストールされるものを設定する(※変更可)\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eSQL Serverに定義されたデータにアクセスするため、SQL Server Management Studioを導入\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://docs.microsoft.com/ja-jp/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-ver15\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e開発はASP .NET MVC Core 5で実施 (LTS版である6に今後移行する前提)\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eIISで実行するプログラムは、スタンドアロンまたはグループ内ネットワークのみアクセスするのを想定してfilesystemとする\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e※有償で必要なものはVisual Studio 2019 Professionalのみ(意外とお手軽).頑張ればVS Codeでもいけるはずや.\u003cbr\u003e\n※IISのインストールなどの内容は他の記事を参考にすること\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"やりたいこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやりたいこと\u003c/h1\u003e\n\n\u003cp\u003e以下、アプリケーションの定義ファイル(appsetting.json)の中身。\u003c/p\u003e\n\n\u003cp\u003eDBの設定用に\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eOpMeasureDb  ... デバッグ用\u003cbr\u003e\n(Visual Studioの動作確認用に、IIS Expressを使って動作確認をする)\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eOpMeasureDbRuntime ... ランタイム用\u003cbr\u003e\n(本番の運用のために、IISを使って運用する. ソフトウエアのアップデートの時には、デプロイ先のfilesystemのファイルのみを入れ替えて実行できるようにする)\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eとして分割し、デバッグ用のデータベースは別の環境でテストを完了したものを用意する。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/e5a19530f63cf32f0ed58f01801c6874d1e2c7a4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f61626231393961362d643266372d386261342d363863372d3161653331363531326664612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fabb199a6-d2f7-8ba4-68c7-1ae316512fda.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f878f43699dc23a8d6b52ce4ef6aaff7\" alt=\"キャプチャ.PNG\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/abb199a6-d2f7-8ba4-68c7-1ae316512fda.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fabb199a6-d2f7-8ba4-68c7-1ae316512fda.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9401034d9026e8e046a51d1f4b60932b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eVisual Studio 2019の画面に従って、Publish(発行)を実施。\u003cbr\u003e\n発行時のディレクトリは、C:\\deployment\\を指定。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/f06af4d33637fcaaa9d72e9fb2daf852e36a45d3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f62336631613637322d343961362d353461632d393163642d3764363162623236356534352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fb3f1a672-49a6-54ac-91cd-7d61bb265e45.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b952cc70d99d661395e69689f947b0f6\" alt=\"キャプチャ2.PNG\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/b3f1a672-49a6-54ac-91cd-7d61bb265e45.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fb3f1a672-49a6-54ac-91cd-7d61bb265e45.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d8a9fbb7adc7ecb5009f01bff7247266 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e発行するとこんな感じで、一連のexeファイルやdll、pdbファイル、jsonファイルなどを一気に出力してくれます\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/1f133211adb2d8d12ea666b14dd18d8f47a7af48/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f66633061366264392d313166622d326330312d306538352d3464666133656534613964392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Ffc0a6bd9-11fb-2c01-0e85-4dfa3ee4a9d9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f41a49a217c41c233f08a1d60b9b9b99\" alt=\"キャプチャ3.PNG\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/fc0a6bd9-11fb-2c01-0e85-4dfa3ee4a9d9.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Ffc0a6bd9-11fb-2c01-0e85-4dfa3ee4a9d9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=989b98a2e7ba1230541ea27ceb2f5143 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこのとき、OpMeasureDb_debugに定義されているように\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"ConnectionStrings\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"OpMeasureDb_debug\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Server=(localdb)\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"s2\"\u003emssqllocaldb;Database=OpMeasureDb;\n      Trusted_Connection=true;MultipleActiveResultSets=true\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eと書くと、C#側のstartup.csで定義されているメソッドConfigureServicesの引数IServiceCollection型servicesで、例えば\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003estartup.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// AppDbContextはDbContextを継承して作ったクラスで、\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Code Firstの形式で定義したクラス\u003c/span\u003e\n\u003cspan class=\"n\"\u003eservices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAddDbContext\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eAppDbContext\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eoption\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n         \u003cspan class=\"nf\"\u003eUseSqlServer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConfiguration\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetConnectionString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"OpMeasureDb_debug\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eと書くだけで、SQL Server 2016で簡単にCode Firstを実現することが出来る。\u003c/p\u003e\n\n\u003cp\u003eところで、これを例えば、ランタイムモードにしたときに\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"ConnectionStrings\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"OpMeasureDb\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Server=(localdb)\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"s2\"\u003emssqllocaldb;Database=OpMeasureDbRuntime;\n      Trusted_Connection=true;MultipleActiveResultSets=true\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとして、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003estartup.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// AppDbContextはDbContextを継承して作ったクラスで、\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Code Firstの形式で定義したクラス\u003c/span\u003e\n\u003cspan class=\"n\"\u003eservices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAddDbContext\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eAppDbContext\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eoption\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n         \u003cspan class=\"nf\"\u003eUseSqlServer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConfiguration\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetConnectionString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"OpMeasureDb\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eと書けば最初は通るものと考えていた。もちろん、Visual Studioでデフォルトで実行するときに使用されるIIS Expressでは実行されるし、生成されたexeを直接実行しても動くのだ。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eでも、これをIIS経由で動かそうとすると、DBがまともに動かなくなった。\u003cbr\u003e\nというか、動くけれども、Postmanやブラウザなどで、データ定義済みのデータベースからWebAPI経由でGET命令でデータ取得しようとしても、データが空のまま出力される。なぜだ！？と考えて、２日経ったとさ\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003e前置きがすごく長くなりました\u003c/del\u003e SQL Serverを使うとこういうトラブルに見舞われやすいなと体感で感じます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"原因\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8E%9F%E5%9B%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e原因\u003c/h1\u003e\n\n\u003cp\u003eStartup.csに、以下の文面を追加してみた。\u003cbr\u003e\n(静的クラスUserNLogに、PrintDebugと書くとデバッグ情報を出してくれるようにするとします)\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eStartup.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eUserNLog\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrintDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrincipal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIdentity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこう書くと、ユーザログオン名を出力してくれるようになるみたいなので、さっそくやってみました。\u003cbr\u003e\nすると、デバッグ時には\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eDEBUG DESKTOP-*******\\myuser\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eという風に、例えばwindows認証のアカウントがmyuserだったら、コンピュータ名とアカウント名を同時に出力してくれていたのですが、IISで実行すると\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eDEBUG IIS APPPOOL/OPSimulator\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eと出ていました。\u003c/p\u003e\n\n\u003cp\u003eつまり、データベースにアクセスするときのユーザが違っていた。つまり、myuserには権限はあるけれども、APPPOOL/OPSimulatorにはデータベースにアクセスする権限がないというわけだ！\u003c/p\u003e\n\n\u003cp\u003e従って、APPPOOL/OPSimulatorにアクセス権を通せば、この課題はクリアになります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"解決策\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E6%B1%BA%E7%AD%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解決策\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"いろいろありますがベターな方向性\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%84%E3%82%8D%E3%81%84%E3%82%8D%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8C%E3%83%99%E3%82%BF%E3%83%BC%E3%81%AA%E6%96%B9%E5%90%91%E6%80%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eいろいろありますがベターな方向性\u003c/h2\u003e\n\n\u003cp\u003e　ここから先、色々やり方はあると思います。\u003cbr\u003e\n　（詳しい内容は \u003ca href=\"#%E5%8F%82%E8%80%83%E3%82%B5%E3%82%A4%E3%83%88\"\u003e参考サイト\u003c/a\u003e を参照）\u003c/p\u003e\n\n\u003cp\u003e①　例えば、SQL Serverのインスタンス名が登録されていないのだから、単純に言えばIIS側の設定で、常にDESKTOP-******* /myuserになるようにログイン出来るようにすればよいじゃない、という案が浮かびます。一応これ、可能です。\u003c/p\u003e\n\n\u003cp\u003e　方法は単純で、IISの画面からアプリケーションプールを開き、開こうとしているアプリケーション(今回であればOPSimulator)を右クリックし、詳細設定を押します。そこから、IDをDESKTOP-******* /myuserとすれば、解決できたりします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/70d5ddab7d618ffb8bdad1f46227aee15e0bdce7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f38326565336136652d333230312d663631372d396165312d3436643562623863623538642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F82ee3a6e-3201-f617-9ae1-46d5bb8cb58d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c309cd321d87556962d2562377cf3bb2\" alt=\"キャプチャ4.PNG\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/82ee3a6e-3201-f617-9ae1-46d5bb8cb58d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F82ee3a6e-3201-f617-9ae1-46d5bb8cb58d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cc1175f22aeeab780858c5d1a5cc89b4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e　ただし、IISが外部攻撃に遭った際に、DESKTOP-******* /myuser権限で実行できるものが実行できてしまいますので、業務アプリレベルでASPを使う用途でもアンチパターンとして避けるべきと考えます。\u003c/p\u003e\n\n\u003cp\u003e② \u003ca href=\"#%E5%8F%82%E8%80%83%E3%82%B5%E3%82%A4%E3%83%88\"\u003e参考サイト\u003c/a\u003eの\u003cstrong\u003eApproach 3\u003c/strong\u003eのように、SQL Server 2016 (特にExpress)にはSQLEXPRESSという固有のグローバルインスタンスが存在するので、それを使うのもありです。 \u003cdel\u003e個人的にはちょっと気持ち悪いけどね\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e③ 最後に、参考サイトのApproach 2のようなやり方。\u003cbr\u003e\n　そもそも、今のままで実行できていないかというと、MSSQLEXPRESSも実は固有のデータベースになっていて、共有データベースに設定できないからなのです。\u003cbr\u003e\n　\u003cbr\u003e\n　従って、共有可能なインスタンスを自分で作って、それを共有可能に設定し、ASP .NET側からも、共有インスタンスとしてデータベースアクセスするように変えればよいのです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"さて解決策\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%95%E3%81%A6%E8%A7%A3%E6%B1%BA%E7%AD%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eさて、解決策\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"1-dbの作成共有インスタンスに設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-db%E3%81%AE%E4%BD%9C%E6%88%90%E5%85%B1%E6%9C%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AB%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. DBの作成＆共有インスタンスに設定\u003c/h3\u003e\n\n\u003cp\u003eVisual Studio開発者用コマンドプロンプトを\u003cstrong\u003e管理者権限で\u003c/strong\u003e開いて、次のように入力します\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eDBの生成\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\nC:\\Windows\\System32\u0026gt;sqllocaldb create OPSimulator\n\nLocalDBインスタンス \"OPSimulator\"はバージョン13.1.4001.0で作成されました。\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e生成されたDBの確認\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eC:\\Windows\\System32\u0026gt;sqllocaldb info\nMSSQLLocalDB\nOPSimulator\nProjectsV13\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e生成したOPSimulatorを共有インスタンスに指定\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eC:\\Windows\\System32\u0026gt;sqllocaldb share OPSimulator IIS_DB\n\nプライベートLocalDBインスタンス \"OPSimulator\"は共有名\"IIS_DB\"で共有します。\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e共有インスタンスになっているかを確認\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eC:\\Windows\\System32\u0026gt;sqllocaldb info OPSimulator\n\n名前　OPSimulator\nバージョン　\n...\n共有名 IIS_DB\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\"test_db\"でインスタンスを作るとこんな感じになります\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/c121e96f30aa0676d9b3c2bfc845961b45990237/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f33313436313339332d636563352d633163632d336462392d3761623537363330313861352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F31461393-cec5-c1cc-3db9-7ab5763018a5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=070899e283f2547bc89f62d5d6fe9dfa\" alt=\"キャプチャ5.PNG\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/31461393-cec5-c1cc-3db9-7ab5763018a5.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F31461393-cec5-c1cc-3db9-7ab5763018a5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bd1504287812be8d1dbcc446c707c77a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"2-生成したインスタンスをvisual-studioに紐づけ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-%E7%94%9F%E6%88%90%E3%81%97%E3%81%9F%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%82%92visual-studio%E3%81%AB%E7%B4%90%E3%81%A5%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. 生成したインスタンスをVisual Studioに紐づけ\u003c/h3\u003e\n\n\u003cp\u003eManagement Studioを開き、さっそく作成したOPSimulatorでログインしてみてください。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/952011e270a402bc2db7509a91c4c57603171d4b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f30323563383331332d376639322d373035302d643331642d3834383036303536393331662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F025c8313-7f92-7050-d31d-84806056931f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d1f932619cb11db865f96129d20ac255\" alt=\"キャプチャ6.PNG\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/025c8313-7f92-7050-d31d-84806056931f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F025c8313-7f92-7050-d31d-84806056931f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2d7dd6afafc2f9e3da6671179ba72296 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eさっそく権限を確認してみると、publicと一部のログイン情報以外は権限が与えられていないことが分かります。ただし、所有者であるDESKTOP-******* /myuserは気にせずとも権限が自動で設定されます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/9a5cf01f3b36a0bbadb1ab7b4fc2dddd06a8ffa3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f38363861313238372d353834352d393036642d303039652d3833316665373230653966372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F868a1287-5845-906d-009e-831fe720e9f7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=edaaa920ccd3f3254fdd97a2f366a4f1\" alt=\"キャプチャ7.PNG\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/868a1287-5845-906d-009e-831fe720e9f7.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F868a1287-5845-906d-009e-831fe720e9f7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=171663ecd1f9b26f33167cc6cfbe2c6c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e次に生成されたインスタンスに無理やり権限が入るように設定します。\u003cbr\u003e\nVisual Studio 2019を開き、今データベースを使用としているソリューションを開きます。\u003c/p\u003e\n\n\u003cp\u003eその後に、「SQL Server Object Explorer」を開き、SQL Serverを右クリックして、SQL Serverを追加します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/e0150e9047976f369cf66de6aea10015ea830dea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f31643362373436312d633264622d393734312d666638312d6137336531343038393439312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F1d3b7461-c2db-9741-ff81-a73e14089491.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6e4f3b3fd7be84ce723ac6da23ca5386\" alt=\"キャプチャ9.PNG\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/1d3b7461-c2db-9741-ff81-a73e14089491.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F1d3b7461-c2db-9741-ff81-a73e14089491.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7cc1821487176c190fb7bf415adbffe0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/9bd672dee3462735b05d84cf0b077f1b17c2dc7b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f64373233633531612d356531342d613330312d326434312d6262326133306231663332642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fd723c51a-5e14-a301-2d41-bb2a30b1f32d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=acf9af353c1b8c76a7ef13a0da899f2a\" alt=\"キャプチャ8.PNG\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/d723c51a-5e14-a301-2d41-bb2a30b1f32d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fd723c51a-5e14-a301-2d41-bb2a30b1f32d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1f064dad29cbe6f44395be6b2b2f72e8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e接続(Connect)の画面が開かれたら、該当するDB（この場合OPSimulator)をクリックし、Connect(接続)をクリックします。\u003c/p\u003e\n\n\u003cp\u003e開いた後に、新たに追加されたDBインスタンスを開き、新たにクエリ文を追加します。\u003cbr\u003e\nクエリ文は、追加されたDBを押して「New Query(クエリの追加)」で作業できます。\u003cbr\u003e\n文章はこんな感じで打ちます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"SQL\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e権限登録\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003ecreate\u003c/span\u003e \u003cspan class=\"n\"\u003elogin\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eIIS\u003c/span\u003e \u003cspan class=\"n\"\u003eAPPPOOL\u003c/span\u003e\u003cspan class=\"err\"\u003e\\\u003c/span\u003e\u003cspan class=\"n\"\u003eOPSimulator\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003ewindows\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eexec\u003c/span\u003e \u003cspan class=\"n\"\u003esp_addsrvrolemember\u003c/span\u003e \u003cspan class=\"n\"\u003eN\u003c/span\u003e\u003cspan class=\"s1\"\u003e'IIS APPPOOL\u003c/span\u003e\u003cspan class=\"se\"\u003e\\O\u003c/span\u003e\u003cspan class=\"s1\"\u003ePSimulator'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esysadmin\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eIIS APPPOOL\\OPSimulatorの部分ですが、これはIISのアプリケーション名によって適宜変更します。\u003cbr\u003e\n実行すると、権限が割り振られますので、Management Studioを改めて開いてIIS APPPOOL\\OPSimulator\\に権限が追加されていることを確認します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/c90a90e5c5dc893424378399abb7188c2af612cc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238313137332f34623731613365352d623962352d383461642d656534312d3965663164323861376430612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F4b71a3e5-b9b5-84ad-ee41-9ef1d28a7d0a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=40ff38a672aa5c7c4549a9d2903b2538\" alt=\"キャプチャ10.PNG\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/4b71a3e5-b9b5-84ad-ee41-9ef1d28a7d0a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2F4b71a3e5-b9b5-84ad-ee41-9ef1d28a7d0a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9d4cac7d3304bf15a1b9b8d2bc34764e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eなお、この設定にするとsysadmin相当の権限が与えられますので、それを回避したい場合はManagement Studioで適宜変更します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"3-dbテーブルやスキーマの登録\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-db%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%82%84%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%AE%E7%99%BB%E9%8C%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. DBテーブルやスキーマの登録\u003c/h3\u003e\n\n\u003cp\u003eまあ、ここはシステムによるところですね。\u003cbr\u003e\nSQL文をべた書きにしている場合は、ここでは扱わないとして、\u003c/p\u003e\n\n\u003cp\u003eCode Firstでマイグレーションでシステム構築している場合は、visual studioのpackage manager consoleを使って、次のように入力します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePackageConsoleManagerでのCodeFirstの実行\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026gt; update-database -connection 'server=(localdb)\\OPSimulator;database=OpMeasureDbRuntime'\nBuild started\nBuild succeeded.\nDone.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003econnectionに新たに作ったインスタンス名を置くのがポイントです。\u003cbr\u003e\nOpMeasureDbRuntimeの部分は別にデータベースが作られていなくても`、自動的に好き勝手に作ることが出来ます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"4-appsettingjsonの編集発行publish\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-appsettingjson%E3%81%AE%E7%B7%A8%E9%9B%86%E7%99%BA%E8%A1%8Cpublish\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4. appsetting.jsonの編集＆発行(publish)\u003c/h3\u003e\n\n\u003cp\u003eappsettings.jsonを書き換えて、発行(publish)します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eappsettings.json\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"ConnectionStrings\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"OpMeasureDb\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Server=(localdb)\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"s2\"\u003e.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"s2\"\u003eIIS_DB;Initial Catalog=OpMeasureDbRuntime;\n      Integrated Security = true\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e発行後は、生成されたexeファイルを実行してください。\u003cbr\u003e\nこの場合、簡易的にIIS Expressが実行されますが、DBエラーが発生する場合は強制終了します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"5-iiswebブラウザでの動作確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-iisweb%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%A7%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5. IIS＆Webブラウザでの動作確認\u003c/h3\u003e\n\n\u003cp\u003eIISですでにfilesystemでページを公開している場合は、IIS側では特別何かを行う必要がありません。\u003c/p\u003e\n\n\u003cp\u003eIIS自体の再起動は必要ですので、IISのアプリケーションプールで定義されたアプリケーションをもう一度起動すると良いでしょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"6-スタートアップ動作確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6-%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6. スタートアップ動作確認\u003c/h3\u003e\n\n\u003cp\u003eWindows 10が起動した段階では、DBインスタンスは起動しないので、SQL Serverのインスタンスは手動で実行する必要があります。\u003cbr\u003e\nもっとも簡単なのは、スタートアップから右クリック、ファイル名を指定して実行で「shell:startup」と入力して、\u003cbr\u003e\nそのフォルダの中に例えば、以下のようなバッチファイルを置くと良いでしょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"batchfile\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eopmeasuredb_startup.bat\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003esqllocaldb\u003c/span\u003e \u003cspan class=\"nb\"\u003estart\u003c/span\u003e .\\IIS_DB\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"タイムアウト対策\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BF%E3%82%A4%E3%83%A0%E3%82%A2%E3%82%A6%E3%83%88%E5%AF%BE%E7%AD%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eタイムアウト対策\u003c/h1\u003e\n\n\u003cp\u003e\u003cstrong\u003e(2021.8.20)更新\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e6.に書いたsqllocaldb startは、それが実行されてから、一定時間(デフォルト10分)ログインされない状態が続くと、エラー終了してしまうようです。\u003c/p\u003e\n\n\u003cp\u003eその対策はこちら\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://stackoverflow.com/questions/14153509/how-to-prevent-sql-server-localdb-auto-shutdown\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003e実質コピペしますが、コマンドプロンプトを開いて、こんな感じで実行します\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cmd\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eC:\\\u0026gt; sqlcmd -S np:\\\\.\\pipe\\LOCALDB#SH9D87FB\\tsql\\query\n\n1\u0026gt; sp_configure 'show advanced options', 1;\n2\u0026gt; GO\n\nConfiguration option 'show advanced options' changed from 1 to 1. \nRun the RECONFIGURE statement to install.\n\n1\u0026gt; RECONFIGURE;\n2\u0026gt; GO\n\n1\u0026gt; sp_configure 'user instance timeout', 5;\n2\u0026gt; GO\n\nConfiguration option 'user instance timeout' changed from 5 to 5. \nRun the RECONFIGURE statement to install.\n\n1\u0026gt; RECONFIGURE;\n2\u0026gt; GO\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003esp_configure 'user instance timeout', 5;のところで、時間を変えると、タイムアウト時間を変更できます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"私見\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A7%81%E8%A6%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e私見\u003c/h1\u003e\n\n\u003cp\u003eWindows 11に変わりIISも正直レガシーの部類に入ってくるので、今後どうなるかはちょっと分からないです。\u003c/p\u003e\n\n\u003cp\u003eまあ、ASP .NET MVC Core 6がLTSとしてアップデートされますので、他のCoreに追随し切れていないフレームワークと比べると、いきなりなくなることはなさそう。 \u003cdel\u003eでもこういうややこしい使い方は少し改善されてほしいよねぇ\u003c/del\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考サイト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E3%82%B5%E3%82%A4%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考サイト\u003c/h1\u003e\n\n\u003cp\u003e10年前の古い記事ですが、Microsoft SQL Server2016 \u0026amp; Visual Studio 2019でも動作確認が出来た。\u003cbr\u003e\nApproach 2で対応しました。　\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://stackoverflow.com/questions/13308654/iis-connecting-to-localdb\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://blogs.msdn.microsoft.com/sqlexpress/2011/12/08/using-localdb-with-full-iis-part-2-instance-ownership/\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n","createdAt":"2021-08-03T09:18:17Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"HIzmCPSBTVQxXgaQzB+hh3BRnKyF9CcGHg==--g8k/wxDBERHzUDF0--lyCSOJ+pTcuQR5l4mNcoFg==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2021-08-20T04:22:02Z","likesCount":0,"linkUrl":"https://qiita.com/belre/items/65422a8ee154476fd99b","organization":null,"originalId":1468699,"stockedCount":1,"title":"【ASP.NET＆Microsoft SQL Server】IIS(local filesystem)で公開したWebアプリにSQL Serverを紐づける","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%96%8B%E7%99%BA%E5%8B%95%E4%BD%9C%E7%92%B0%E5%A2%83\"\u003e開発＆動作環境\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003eやりたいこと\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8E%9F%E5%9B%A0\"\u003e原因\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A7%A3%E6%B1%BA%E7%AD%96\"\u003e解決策\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%84%E3%82%8D%E3%81%84%E3%82%8D%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8C%E3%83%99%E3%82%BF%E3%83%BC%E3%81%AA%E6%96%B9%E5%90%91%E6%80%A7\"\u003eいろいろありますがベターな方向性\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%95%E3%81%A6%E8%A7%A3%E6%B1%BA%E7%AD%96\"\u003eさて、解決策\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1-db%E3%81%AE%E4%BD%9C%E6%88%90%E5%85%B1%E6%9C%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AB%E8%A8%AD%E5%AE%9A\"\u003e1. DBの作成＆共有インスタンスに設定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-%E7%94%9F%E6%88%90%E3%81%97%E3%81%9F%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%82%92visual-studio%E3%81%AB%E7%B4%90%E3%81%A5%E3%81%91\"\u003e2. 生成したインスタンスをVisual Studioに紐づけ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3-db%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%82%84%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%AE%E7%99%BB%E9%8C%B2\"\u003e3. DBテーブルやスキーマの登録\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4-appsettingjson%E3%81%AE%E7%B7%A8%E9%9B%86%E7%99%BA%E8%A1%8Cpublish\"\u003e4. appsetting.jsonの編集＆発行(publish)\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#5-iisweb%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%A7%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e5. IIS＆Webブラウザでの動作確認\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#6-%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e6. スタートアップ動作確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%BF%E3%82%A4%E3%83%A0%E3%82%A2%E3%82%A6%E3%83%88%E5%AF%BE%E7%AD%96\"\u003eタイムアウト対策\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%A7%81%E8%A6%8B\"\u003e私見\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83%E3%82%B5%E3%82%A4%E3%83%88\"\u003e参考サイト\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":480,"uuid":"65422a8ee154476fd99b","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"4QeBoBPGjrMzfscDjpn+N+BFC+uv--u9yvH4bo034BDs5O--cAATFjsAg/dYzwS5Py+KLw==","originalId":281173,"description":"","facebookUrl":null,"githubUrl":"https://github.com/belre","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"o yucho","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/281173/profile-images/1627982266","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fprofile-images%2F1627982266?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=608a84b03d9e1ece80b41372ece0e14d","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F281173%2Fprofile-images%2F1627982266?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=6a2be52f9e48cef8bf8b0a0d03332d8d","urlName":"belre","websiteUrl":"","twitterUrl":"https://twitter.com/icedblack2","twitterUrlName":"icedblack2","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"SQLServer","urlName":"sqlserver"},{"name":"EntityFramework","urlName":"entityframework"},{"name":"IIS","urlName":"iis"},{"name":"ASP.NET_Core","urlName":"asp.net_core"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

More than 3 years have passed since last update.本資料では、Salesforceの取引先データをkintoneに同期するWindowsフォームのC#アプリケーションを作成する手順です。※30日間の無償評価版VisualStudio2017を起動して、メニューバーの「ファイル &gt; 新規作成 &gt; プロジェクト」を開きます。 「新しいプロジェクト」ウィザードが起動するので、「VisualC# &gt; Windowsフォームアプリケーション（.NET Framework）」を選択して、名前に「Salesforce2Kintone」と入力して「OK」ボタンをクリックします。プロジェクト作成され、Formのデザイナが開きます。くので、Formを適当な大きさに拡大します。左側の「ツールボックス」の検索ボックスに「table」と入力して抽出された「TableLayoutPanel」を選択して、ドラッグ＆ドロップで、Form上に配置します。配置するときに、行列を「１行×３列」に設定して、Formいっぱいに拡大します。「TableLayoutPanel」が選択された状態で、右側のプロパティ内の「配置 &gt; Anchor」を「Top, Left」から「Top, Bottom, Left, Right」に変更します。あわせて「配置 &gt; Columns」を開き、「列と行のスタイル」ウィンドウにて「サイズの型」を以下の通り設定して保存します。「TableLayoutPanel」のバランスが取れたところで、「ツールボックス」の検索ボックスにて「DataGridView」と入力して抽出された「DataGridView」を、「TableLayoutPanel」の左にドラッグ＆ドロップで配置します。「DataGridView」右上の小さな再生ボタン「▶︎」をクリックして、「データソースの選択」の「（なし）」右の下矢印をクリックして、「プロジェクトデータソースの追加」リンクをクリックします。「データソース構成ウィザード」が立ち上がるので、「データベース &gt; データセット」を選択して進みます。「データ接続の選択」にて、「新しい接続」ボタンをクリックして、「データソースの選択」ウィンドウから「Microsoft ODBC データソース」を選択して「続行」ボタンをクリックします。「ユーザーデータソースまたはシステムデータソース名を使用」のドロップダウンリストから既に作成しているSalesforceのODBC DSN「CData Salesforce Source」を選択して、「テスト接続」をクリックします。テスト接続に成功したら「OK」ボタンをクリックします。「次へ」ボタンをクリックして進みます。プロジェクト内のアプリケーション構成ファイルに保存する名称「ConnectionStringSalesforce」を入力して「次へ」を進みます。Salesforce内のオブジェクトがテーブルリストとして表示されるので取引先に相当する「Account」にチェックを入れ、データセット名を「DataSetSalesforce」として「完了」ボタンをクリックします。フォームのデザイナに戻り、左側の「DataGridView」に、ヘッダー行が追加されたことを確認します。「DataGridView」を選択して、プロパティ内の「配置 &gt; Dock」を「Fill（四角の真ん中）」に変更します。これにより、「TableLayoutPanel」の中いっぱいに「DataGridView」が拡大されます。今度は、右側の「DataGridView」にkintoneの情報をバインドする設定を行いましょう。Salesforceの時と同様に「データベース &gt; データセット」を選択して進みます。「データ接続の選択」の「新しい接続」から、今度は、「ユーザーデータソース名またはシステムデータソース名を使用」からkintoneのODBC DSN「CData Kintone Source」を選択します。「テスト接続」をクリックして、接続に成功したのを確認して「OK」ボタンをクリックします。「次へ」ボタンをクリックします。kintone側の接続文字列名を「ConnectionStringKintone」として「次へ」進みます。kintone内のアプリがテーブルリストとして表示されるので、「顧客管理（営業支援パック）」にチェックを入れてデータセット名は「DataSetKintone」として「完了」ボタンをクリックします。kintone側の「DataGridView」を選択して、プロパティ内の「配置 &gt; Dock」を「Fill（四角の真ん中）」に変更します。それでは、Salesforceとkintoneのデータが、「DataGridView」にバインドされるか確認してみます。メニューバー内の「▶︎開始」ボタンをクリックして実行してみます。しばらくすると「Form1」が起動して、Salesforceとkintoneのデータが表示されれば成功です。確認出来たら「■」の停止ボタンをクリックします。次に、「DataGridView」内の不要な項目を非表示にすることで、より、左（Salesforce）右（kintone）の項目を比較しやすくします。まずは、左側のSalesforce側の「DataGridView」の右上の「▶︎」ボタンをクリックして「列の編集」リンクをクリックします。「列の編集」の「選択された列」に以下の項目のみ残し、「OK」ボタンをクリックします。同様に右側のkintone側の「DataGridView」の右上の「▶︎」ボタンをクリックして「列の編集」リンクをクリックします。「列の編集」の「選択された列」に以下の項目のみ残し、「OK」ボタンをクリックします。再度、Salesforceとkintoneのデータが、必要項目のみ「DataGridView」にバインドされるか確認してみます。メニューバー内の「▶︎開始」ボタンをクリックして実行してみます。しばらくすると「Form1」が起動して、Salesforceとkintoneの項目が設定した項目のみ表示されれば成功です。確認出来たら「■」の停止ボタンをクリックします。「ツールボックス」の検索ボックスにて「button」と検索して抽出された「Button」コントロールを、「TableLayoutPanel」の間に配置します。デフォルトでは右上に寄った配置となるため、「配置 &gt; Anchor」を「None」に変更することで中央に移動します。また、「表示 &gt; Text」をコピーを行う処理として「&gt;&gt;&gt;」に変更して、ボタンをドラッグ＆ドロップ操作で縦に広げて大きくします。追加した「Button」コントロールをダブルクリックします。「Form1.cs」のコードが表示されます。下イメージの「ここ」部分に下記のコードをコピーします。コピー＆ペーストして、構文エラー（赤い波線）が出るようであれば、Datasetの名称など、これまでの設定内容と照らし合わせてください。特に構文エラーがない場合は、プロジェクトをリビルドして、再度、「▶︎開始」でプロジェクトを実行してみます。Formが起動するので、左側のSalesforceのデータを一レコード選択した状態で、「&gt;&gt;&gt;」ボタンをクリックしてみてください。右側に一レコード追加されれば成功です。実際に、kintoneの画面を開き、追加されているか確認してみましょう。もう一度、左側のSalesforceのデータの同じ一レコード選択した状態で、「&gt;&gt;&gt;」ボタンをクリックしてみてください。今度はエラーで止まりました。「From1.cs」内の下記のUpdateするところで「[RecordId]列は読み取り専用です。この列の値を更新出来ません。」というエラーが出ています。これは、kintone側のレコード毎に保有のキー項目であるRecordIdは更新出来ないため発生します。そこで、必要な項目のみUpdate（更新）するように変更します。右側の「ソリューションエクスプローラー」から「DataSetKintone.xsd」を選択して、右クリックから「デザイナーの表示」を開きます。「顧客管理（営業支援パック）　Table Adapter」のアイコンをクリックして、右下の「プロパティ」が「顧客管理（営業支援パック）　Table Adapter」になった事を確認して、「UpdateCommand」のプラスボタンを開き、「CommandText」を右側の「...」から開きます。　「クエリービルダー」が開くので、下記の「郵便番号、住所、TEL、FAX」のみ更新するように変更します。「OK」ボタンをクリッっくして「クエリービルダー」を閉じて、再度、、プロジェクトをリビルドして、再度、「▶︎開始」でプロジェクトを実行してみます。既にkintone側にコピー済みのレコードを再度Salesforce側のレコードを選択してコピーしてみます。kintone側のRevisionが「1」から「２」にカウントアップすれば成功です。それでは、左側のSalesforce側のレコードをすべて選択して、コピーを実行してみましょう。実行が完了したらkintone側の画面でみてみましょう。Salesforce側の取引先（Account）情報が、kintone側の顧客管理（営業支援パック）に同期されたことを確認出来たら完成です。資料では、Salesforceの取引先データをkintoneに同期するWindowsフォームのC#アプリケーションを作成する手順について説明しました。このように、最小限のプログラミングで、そして、ODBCというRDBと同じ規格で、Salesforceとkintoneの両方のSaasに接続してデータ連携を行うことが出来ます。



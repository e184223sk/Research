More than 1 year has passed since last update.ConsoleAppFrameworkリリースしました！破壊的大変更でより便利に！なりました。 / “neue cc - ConsoleAppFramework - .NET Coreコンソールアプリ作成のためのマイクロフレームワーク（旧MicroBatchFramework)” https://t.co/CEXtQ4iJwpとのことで記事修正しました。たまたまツイッターのタイムラインを眺めていたら以下のツイートを拝見しました。はてブ数的にはMicroBatchFrameworkがMagicOnionのリリース記事より超えてしまうやん……。なんか複雑……。 https://t.co/XZNr35rSOqちょうどCLIを作成していたのでConsoleAppFrameworkを試したところ、DIコンテナの差替えではまったので投稿します。
この話はConsoleAppFrameworkではなくベースとなっている.NET Generic Hostのほうの話です。詳細は@neueccさんのConsoleAppFrameworkの記事を読んでいただいたほうが早いのですが、ASP.NET Core 2.1で汎用ホスト(.NET Generic Host)なる機能が追加されていたそうです。
汎用ホスト(.NET Generic Host)はASP.NET Core 2.xですのでDependency Injectionを標準でサポートしています。
しかしながら標準のDIだとコンストラクタインジェクションしかできなかったり、IServiceProviderのGetServiceしか解決方法がなかったりとかゆいところに手が届きません。
そこでDIコンテナを差し替えることにしました。大事なことはUnityをNugetする他にもUnity.Microsoft.DependencyInjectionをNugetすることです。
=&gt; Unity.Microsoft.DependencyInjectionのGitHubに使い方書いていました。利用する際はIServiceProviderをコンストラクタインジェクションしてIUnityContainerを呼び出してResolveします。
UseUnityServiceProviderを使用すればIUnityContainerをコンストラクタインジェクションできました。直接I~~Repositoryをコンストラクタインジェクション出来ればよかったんですけど駄目でした。
何か設定が足りないかも？
UseUnityServiceProviderを呼んだあとサービスとして登録(services.AddSingleton)してやればコンストラクタインジェクション出来ました。DryIocとAutofacにもありました。ConsoleAppFrameworkを利用する前段としての汎用ホスト(.NET Generic Host)の話でした。
汎用ホスト(.NET Generic Host)の存在はまったく知らなかったのでもう少し新情報のアンテナを広げなければなと思いました。
それからConsoleAppFrameworkですがまだ少ししか触ってませんがとても良い感じです。



More than 5 years have passed since last update.ここでは、Unityで作成のアプリにの処理中に、WebSocketを使ったメッセージの送受信を行う実装方法を紹介する。UnityのアプリはC#で開発しているものとする。また、WebSocket自体の実装については省略する。
本記事では、WebSocket-Sharp(http://sta.github.io/websocket-sharp/) を用いる。Unityが対応しているWebSocketは数少なく、WebSocket-Sharpはその対応しているうちの一つであるからである。WebSocketを用いるためには、WebSocket-Sharpで定義されているWebSocketクラスのオブジェクトを生成する必要がある。コンストラクタの引数には、WebSocketが実装されているサーバのURLを指定する。次に、WebSocketのコネクションを確立する。WebSocketのオブジェクトにクッキーなどの設定をする必要がある場合は、socket.Connect()を実行するよりも前に設定する。そして、Send()により、クライアントに送信したいメッセージを送信することができる。WebSocketでメッセージを受信する際にも、WebSocketクラスのオブジェクトを生成する必要がある。コンストラクタの引数には、メッセージ送信側で指定しているWebSocketのサーバのURLと同じものを指定する。次に、WebSocketからのメッセージを受信するために、WebSocketオブジェクトに対してイベントハンドラを登録する。イベントハンドラの登録とは、そのオブジェクトの特定のイベントが発生したことを検知して、そのタイミングで何かしらの処理を実行することである。イベントハンドラの登録は、以下のように記述できる。イベントハンドラの登録後には、WebSocketのコネクションを確立すること。



<!DOCTYPE html><html><head><meta charset="utf-8" /><title>[WPF/C#] Prism(6.3.0)のKeepAliveをfalseにすることとIsNavigationTargetでfalseを返すことの違いの実験 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/tera1707/items/ba525b43fa2482913c85" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="85XfJkSr+bp+rmuR99k8fz4GArgK32agIms1Spk+iYS0GyU5p9qgRhlDsEfvJb3S3NVCMw8b4ZriPjRGX6qmoQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="[WPF/C#] Prism(6.3.0)のKeepAliveをfalseにすることとIsNavigationTargetでfalseを返すことの違いの実験 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XMWRRUmk5REkxMGdVSEpwYzIwb05pNHpMakFwNDRHdVMyVmxjRUZzYVhabDQ0S1NabUZzYzJYamdhdmpnWm5qZ292amdaUGpnYWpqZ2FoSmMwNWhkbWxuWVhScGIyNVVZWEpuWlhUamdhZG1ZV3h6WmVPQ2t1aV9sT09CbWVPQmstT0JxT09CcnVtQmxlT0JoT09CcnVXdW4tbW9rdyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz0wYjlhMzY2Y2RiNmMwYWMyZjYzMzIwMWNkZWRjODRiZQ&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJsY21FeE56QTMmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01OTFjMWUwZjM2MjIxODZiYTQzMTViMmZjOTU0MDFiYg&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=46b6a6bef08e940593471261223f952b"><meta property="og:description" content="もくじ
→https://qiita.com/tera1707/items/4fda73d86eded283ec4f

Prism関連
https://qiita.com/tera1707/items/4fda73d86eded283..."><meta content="https://qiita.com/tera1707/items/ba525b43fa2482913c85" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,WPF,PRISM" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-5cb4bb43-6da5-483b-b0b0-cd2bd25e0b75"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Ftera1707%2Fitems%2Fba525b43fa2482913c85">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Ftera1707%2Fitems%2Fba525b43fa2482913c85">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-5cb4bb43-6da5-483b-b0b0-cd2bd25e0b75">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-09-07T18:47:46.000+09:00","dateModified":"2021-06-03T13:17:52.000+09:00","headline":"[WPF/C#] Prism(6.3.0)のKeepAliveをfalseにすることとIsNavigationTargetでfalseを返すことの違いの実験","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XMWRRUmk5REkxMGdVSEpwYzIwb05pNHpMakFwNDRHdVMyVmxjRUZzYVhabDQ0S1NabUZzYzJYamdhdmpnWm5qZ292amdaUGpnYWpqZ2FoSmMwNWhkbWxuWVhScGIyNVVZWEpuWlhUamdhZG1ZV3h6WmVPQ2t1aV9sT09CbWVPQmstT0JxT09CcnVtQmxlT0JoT09CcnVXdW4tbW9rdyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz0wYjlhMzY2Y2RiNmMwYWMyZjYzMzIwMWNkZWRjODRiZQ\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJsY21FeE56QTMmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01OTFjMWUwZjM2MjIxODZiYTQzMTViMmZjOTU0MDFiYg\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=46b6a6bef08e940593471261223f952b","mainEntityOfPage":"https://qiita.com/tera1707/items/ba525b43fa2482913c85","author":{"@type":"Person","address":"大阪","email":"tera1707@gmail.com","identifier":"tera1707","name":"tera1707","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F19180456%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1ddd4d18cb0c4d9ee77ed7cff93f4ae1","url":"https://qiita.com/tera1707","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita&amp;utm_medium=header-banner">LINEグループの成長を担うLINE Growth Technologyのこれまでとこれから</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tera1707","type":"items","id":"ba525b43fa2482913c85"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"LINEグループの成長を担うLINE Growth Technologyのこれまでとこれから","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tera1707","type":"items","id":"ba525b43fa2482913c85"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"LINEグループの成長を担うLINE Growth Technologyのこれまでとこれから","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tera1707","type":"items","id":"ba525b43fa2482913c85"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"LINEグループの成長を担うLINE Growth Technologyのこれまでとこれから","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/tera1707/items/ba525b43fa2482913c85","location":"/tera1707/items/ba525b43fa2482913c85","scheme":"https","host":"qiita.com","port":null,"pathname":"/tera1707/items/ba525b43fa2482913c85","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"G1PDXabWY2JUGrdeKaOChVfe3fqXC0ODf1ygMco2CWtc3TlCRac6njP3bIgxXwMotQ2dcZLPxLm/CaE9DKImTg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-49d0af86-634d-44d7-bfe7-4c07029347de"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tera1707/items/ba525b43fa2482913c85/likers" class="css-1iupg5d">2</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">0</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ba525b43fa2482913c85/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tera1707/items/ba525b43fa2482913c85/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tera1707/items/ba525b43fa2482913c85/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tera1707/items/ba525b43fa2482913c85/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tera1707/items/ba525b43fa2482913c85.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/tera1707"><img class="css-100alwu eyfquo10" src="https://avatars0.githubusercontent.com/u/19180456?v=4" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/tera1707" class="css-10ougpm">@<!-- -->tera1707</a><div class="css-1ay9vb9"><span><meta content="2020-09-07T09:47:46Z"/><time dateTime="2021-06-03T04:17:52Z" class="css-m19uds">updated at 2021-06-03</time></span></div></div></div></div></div><h1 class="css-cgzq40">[WPF/C#] Prism(6.3.0)のKeepAliveをfalseにすることとIsNavigationTargetでfalseを返すことの違いの実験</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/wpf" class="css-4czcte">WPF</a><a href="/tags/prism" class="css-4czcte">PRISM</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p><strong>もくじ</strong><br>
→<a href="https://qiita.com/tera1707/items/4fda73d86eded283ec4f" class="autolink" id="reference-0109db1287ca72336e9d">https://qiita.com/tera1707/items/4fda73d86eded283ec4f</a></p>

<p><strong>Prism関連</strong><br>
<a href="https://qiita.com/tera1707/items/4fda73d86eded283ec4f#prism%E9%96%A2%E9%80%A3wpfxaml" class="autolink" id="reference-0109db1287ca72336e9d">https://qiita.com/tera1707/items/4fda73d86eded283ec4f#prism%E9%96%A2%E9%80%A3wpfxaml</a></p>

<p><strong>コード</strong><br>
<a href="https://github.com/tera1707/WPF-/tree/master/024_PrismSample" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/tera1707/WPF-/tree/master/024_PrismSample</a></p>

<h1>
<span id="やりたいこと" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>やりたいこと</h1>

<p>Prismの画面遷移をさせるうえで、<br>
<code>RegionManager.RequestNavigate("リージョン名",・・・);</code>としているが、<br>
その時に、画面のViewModelのクラスのインスタンスを一旦破棄して、再度遷移した際にもう一度作り直したい、というケースがあった。</p>

<p>その際、「インスタンスを破棄」とかでやり方を調べていると、</p>

<ul>
<li>
<code>INavigationAware</code>インターフェースの<code>IsNavigationTarget</code>メソッドを実装して、そいつにfalseを返させる</li>
<li>
<code>IRegionMemberLifetime</code>インターフェースの<code>KeepAlive</code>プロパティを実装して、そいつをfalseにする</li>
</ul>

<p>という二つのやり方が見つかった。</p>

<p>簡単に試したところ、どっちも<br>
画面Aから画面Bに<code>RequestNavigate</code>で遷移した後、再度画面Aに戻った際、<strong>画面Aのコンストラクタが呼ばれている。</strong></p>

<p>つまり、どちらも画面Aは画面Bに遷移後、一旦破棄されてる？？まったく同じことに対してやり方が2通りあるのか？<br>
でもそんなわけがない、何か違いがあるはず、と思ったので、何が違うのか調べてみる。</p>

<h1>
<span id="今回試した結論" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9E%E8%A9%A6%E3%81%97%E3%81%9F%E7%B5%90%E8%AB%96"><i class="fa fa-link"></i></a>今回試した結論</h1>

<p>結果、下記である、自分の中ではなった。</p>

<table>
<thead>
<tr>
<th style="text-align: left">やること</th>
<th style="text-align: left">起きていること</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">①KeepAliveをfalseにする</td>
<td style="text-align: left">ViewModelのインスタンスが破棄される。<br>再度同じ画面にRequestNavigateした際に、ViewModelのインスタンスが再作成されている。</td>
</tr>
<tr>
<td style="text-align: left">②IsNavigationTargetにfalseを返させる</td>
<td style="text-align: left">ViewModelのインスタンスは<strong>破棄されない</strong>。<br>再度同じ画面にRequestNavigateした際は、前の画面のインスタンスは<strong>破棄せず保持</strong>で、<strong>新しいVMのインスタンスを作成</strong>し、そっちに遷移する。</td>
</tr>
</tbody>
</table>

<p>つまり、両方ともコンストラクタが呼ばれる、イコール、新しいVMのインスタンスが作成されてるが、KeepAliveをfalseにする方は古い(別画面に遷移後の、元の画面の)インスタンスは破棄されてるが、IsNavigationTargetの戻り値をfalseにする方は、古いインスタンスが実は<strong>破棄されてない。</strong></p>

<p>そのため、②のほうは、画面遷移回数が増えると作成される画面１のインスタンスも増えることになるので、おそらくメモリリークにつながる。<br>
<strong>⇒画面のインスタンスを毎回破棄して、次回遷移時に再作成したい、という目的のために、IsNavigationTarget  をfalseにする、ということを行ってはいけない！</strong></p>

<p>今回やりたい「画面遷移するたびに毎回画面のVMのインスタンスを破棄したい」ということをする場合は、<strong>KeepAliveをOFF</strong>してからRequestNavigateで画面遷移させるのが良い。</p>

<h1>
<span id="結論がでるまでに試したこと" class="fragment"></span><a href="#%E7%B5%90%E8%AB%96%E3%81%8C%E3%81%A7%E3%82%8B%E3%81%BE%E3%81%A7%E3%81%AB%E8%A9%A6%E3%81%97%E3%81%9F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>結論がでるまでに試したこと</h1>

<h2>
<span id="実験コード" class="fragment"></span><a href="#%E5%AE%9F%E9%A8%93%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>実験コード</h2>

<ul>
<li>ViewModelの<code>IsNavigationTarget</code>メソッドに、通ったことがわかるようにDebug.WriteLineでログ出力処理を入れた</li>
<li>ViewModelのデストラクタに、通ったことがわかるようにDebug.WriteLineでログ出力処理を入れた</li>
<li>ViewModelに、自分自身の

<ul>
<li>IsNavigationTargetメソッドの戻り値の値をfalseにできるようにした</li>
<li>KeepAliveをfalseにできるようにした</li>
</ul>
</li>
</ul>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">実験コード1.cs</span></div>
<div class="highlight"><pre><code><span class="k">using</span> <span class="nn">Microsoft.Practices.Unity</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Prism.Commands</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Prism.Mvvm</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Prism.Regions</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">PrismSample.Views</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Diagnostics</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">PrismSample.ViewModels</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">UserControl1ViewModel</span> <span class="p">:</span> <span class="n">BindableBase</span><span class="p">,</span> <span class="n">INavigationAware</span><span class="p">,</span> <span class="n">IRegionMemberLifetime</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="n">Dependency</span><span class="p">]</span>
        <span class="k">public</span> <span class="n">IRegionManager</span> <span class="n">RegionManager</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DelegateCommand</span> <span class="n">ButtonCommand</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DelegateCommand</span> <span class="n">ButtonKeepAliveONCommand</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DelegateCommand</span> <span class="n">ButtonKeepAliveOFFCommand</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DelegateCommand</span> <span class="n">ButtonIsNavigationTargetONCommand</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DelegateCommand</span> <span class="n">ButtonIsNavigationTargetOFFCommand</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DelegateCommand</span> <span class="n">LoadedCommand</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">private</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">constructorCounter</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">destructorCounter</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="n">KeepAlive</span>
        <span class="p">{</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"画面１ KeepAlive is "</span> <span class="p">+</span> <span class="n">keepalive</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">keepalive</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">keepalive</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="kt">bool</span> <span class="n">keepalive</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsNavigationTargetFlag</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">UserControl1ViewModel</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">constructorCounter</span><span class="p">++;</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"画面１ コンストラクタ "</span> <span class="p">+</span> <span class="n">constructorCounter</span> <span class="p">+</span> <span class="s">" 個目"</span><span class="p">);</span>

            <span class="k">this</span><span class="p">.</span><span class="n">LoadedCommand</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DelegateCommand</span><span class="p">(()</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"画面１ LoadedCommand"</span><span class="p">);</span>
            <span class="p">});</span>

            <span class="k">this</span><span class="p">.</span><span class="n">ButtonCommand</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DelegateCommand</span><span class="p">(()</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="c1">// Shell.xaml.csで作成したリージョンの名前と、画面のUserControlクラス名を指定して、画面遷移させる。</span>
                <span class="c1">// (パラメータを渡すこともできる)</span>
                <span class="k">this</span><span class="p">.</span><span class="n">RegionManager</span><span class="p">.</span><span class="nf">RequestNavigate</span><span class="p">(</span><span class="s">"RedRegion"</span><span class="p">,</span> <span class="k">nameof</span><span class="p">(</span><span class="n">UserControl2</span><span class="p">),</span> <span class="k">new</span> <span class="nf">NavigationParameters</span><span class="p">(</span><span class="s">$"id=1"</span><span class="p">));</span>
            <span class="p">});</span>

            <span class="k">this</span><span class="p">.</span><span class="n">ButtonKeepAliveONCommand</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DelegateCommand</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">KeepAlive</span> <span class="p">=</span> <span class="k">true</span> <span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="n">ButtonKeepAliveOFFCommand</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DelegateCommand</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">KeepAlive</span> <span class="p">=</span> <span class="k">false</span><span class="p">);</span>

            <span class="k">this</span><span class="p">.</span><span class="n">ButtonIsNavigationTargetONCommand</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DelegateCommand</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">IsNavigationTargetFlag</span> <span class="p">=</span> <span class="k">true</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="n">ButtonIsNavigationTargetOFFCommand</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DelegateCommand</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">IsNavigationTargetFlag</span> <span class="p">=</span> <span class="k">false</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">~</span><span class="nf">UserControl1ViewModel</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">destructorCounter</span><span class="p">++;</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"画面１ デストラクタ "</span> <span class="p">+</span> <span class="n">destructorCounter</span> <span class="p">+</span> <span class="s">" 回目"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsNavigationTarget</span><span class="p">(</span><span class="n">NavigationContext</span> <span class="n">navigationContext</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"画面１ IsNavigationTarget  return value is"</span> <span class="p">+</span> <span class="n">IsNavigationTargetFlag</span><span class="p">);</span>
            <span class="c1">// このメソッドの返す値により、画面のインスタンスを使いまわすかどうか制御できる。</span>
            <span class="c1">// true ：インスタンスを使いまわす(画面遷移してもコンストラクタ呼ばれない)</span>
            <span class="c1">// false：インスタンスを使いまわさない(画面遷移するとコンストラクタ呼ばれる)</span>
            <span class="c1">// メソッド実装なし：trueになる</span>
            <span class="k">return</span> <span class="n">IsNavigationTargetFlag</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnNavigatedFrom</span><span class="p">(</span><span class="n">NavigationContext</span> <span class="n">navigationContext</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// この画面から他の画面に遷移するときの処理</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"画面１ NavigatedFrom"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnNavigatedTo</span><span class="p">(</span><span class="n">NavigationContext</span> <span class="n">navigationContext</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 他の画面からこの画面に遷移したときの処理</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"画面１ NavigatedTo"</span><span class="p">);</span>

            <span class="c1">// 画面遷移元から、この画面に遷移したときにパラメータを受け取れる。</span>
            <span class="kt">string</span> <span class="n">Id</span> <span class="p">=</span> <span class="n">navigationContext</span><span class="p">.</span><span class="n">Parameters</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span> <span class="k">as</span> <span class="kt">string</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
</div>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">実験3.cs</span></div>
<div class="highlight"><pre><code><span class="k">using</span> <span class="nn">Microsoft.Practices.Unity</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Prism.Commands</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Prism.Mvvm</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Prism.Regions</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">PrismSample.Views</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Diagnostics</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">PrismSample.ViewModels</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">UserControl3ViewModel</span> <span class="p">:</span> <span class="n">BindableBase</span><span class="p">,</span> <span class="n">INavigationAware</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="n">Dependency</span><span class="p">]</span>
        <span class="k">public</span> <span class="n">IRegionManager</span> <span class="n">RegionManager</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DelegateCommand</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">ButtonCommand</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DelegateCommand</span> <span class="n">LoadedCommand</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="nf">UserControl3ViewModel</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"画面３ コンストラクタ"</span><span class="p">);</span>

            <span class="k">this</span><span class="p">.</span><span class="n">LoadedCommand</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DelegateCommand</span><span class="p">(()</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"画面３ LoadedCommand"</span><span class="p">);</span>
            <span class="p">});</span>

            <span class="k">this</span><span class="p">.</span><span class="n">ButtonCommand</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DelegateCommand</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;((</span><span class="n">param</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">kind</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">((</span><span class="kt">string</span><span class="p">)</span><span class="n">param</span><span class="p">);</span>
                <span class="k">switch</span> <span class="p">(</span><span class="n">kind</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">default</span><span class="p">:</span>
                    <span class="k">case</span> <span class="m">0</span><span class="p">:</span> <span class="n">RegionManager</span><span class="p">.</span><span class="nf">RequestNavigate</span><span class="p">(</span><span class="s">"RedRegion"</span><span class="p">,</span> <span class="k">nameof</span><span class="p">(</span><span class="n">UserControl1</span><span class="p">),</span> <span class="k">new</span> <span class="nf">NavigationParameters</span><span class="p">(</span><span class="s">$"id=1"</span><span class="p">));</span> <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="m">1</span><span class="p">:</span> <span class="n">RegionManager</span><span class="p">.</span><span class="nf">RequestNavigate</span><span class="p">(</span><span class="s">"RedRegion"</span><span class="p">,</span> <span class="k">nameof</span><span class="p">(</span><span class="n">UserControl2</span><span class="p">),</span> <span class="k">new</span> <span class="nf">NavigationParameters</span><span class="p">(</span><span class="s">$"id=1"</span><span class="p">));</span> <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="m">2</span><span class="p">:</span> <span class="n">RegionManager</span><span class="p">.</span><span class="nf">RequestNavigate</span><span class="p">(</span><span class="s">"RedRegion"</span><span class="p">,</span> <span class="k">nameof</span><span class="p">(</span><span class="n">UserControl3</span><span class="p">),</span> <span class="k">new</span> <span class="nf">NavigationParameters</span><span class="p">(</span><span class="s">$"id=1"</span><span class="p">));</span> <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="m">3</span><span class="p">:</span> <span class="n">RegionManager</span><span class="p">.</span><span class="nf">RequestNavigate</span><span class="p">(</span><span class="s">"BlueRegion"</span><span class="p">,</span> <span class="k">nameof</span><span class="p">(</span><span class="n">UserControl1</span><span class="p">),</span> <span class="k">new</span> <span class="nf">NavigationParameters</span><span class="p">(</span><span class="s">$"id=1"</span><span class="p">));</span> <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="m">4</span><span class="p">:</span> <span class="n">RegionManager</span><span class="p">.</span><span class="nf">RequestNavigate</span><span class="p">(</span><span class="s">"BlueRegion"</span><span class="p">,</span> <span class="k">nameof</span><span class="p">(</span><span class="n">UserControl2</span><span class="p">),</span> <span class="k">new</span> <span class="nf">NavigationParameters</span><span class="p">(</span><span class="s">$"id=1"</span><span class="p">));</span> <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="m">5</span><span class="p">:</span> <span class="n">RegionManager</span><span class="p">.</span><span class="nf">RequestNavigate</span><span class="p">(</span><span class="s">"BlueRegion"</span><span class="p">,</span> <span class="k">nameof</span><span class="p">(</span><span class="n">UserControl3</span><span class="p">),</span> <span class="k">new</span> <span class="nf">NavigationParameters</span><span class="p">(</span><span class="s">$"id=1"</span><span class="p">));</span> <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="m">10</span><span class="p">:</span> <span class="n">RegionManager</span><span class="p">.</span><span class="n">Regions</span><span class="p">[</span><span class="s">"RedRegion"</span><span class="p">].</span><span class="nf">RemoveAll</span><span class="p">();</span> <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="m">11</span><span class="p">:</span> <span class="n">RegionManager</span><span class="p">.</span><span class="n">Regions</span><span class="p">[</span><span class="s">"BlueRegion"</span><span class="p">].</span><span class="nf">RemoveAll</span><span class="p">();</span> <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="m">91</span><span class="p">:</span> <span class="n">GC</span><span class="p">.</span><span class="nf">Collect</span><span class="p">();</span> <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>

            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsNavigationTarget</span><span class="p">(</span><span class="n">NavigationContext</span> <span class="n">navigationContext</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">false</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnNavigatedFrom</span><span class="p">(</span><span class="n">NavigationContext</span> <span class="n">navigationContext</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"画面３ NavigatedFrom"</span><span class="p">);</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnNavigatedTo</span><span class="p">(</span><span class="n">NavigationContext</span> <span class="n">navigationContext</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"画面３ NavigatedTo"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
</div>

<h2>
<span id="実験内容" class="fragment"></span><a href="#%E5%AE%9F%E9%A8%93%E5%86%85%E5%AE%B9"><i class="fa fa-link"></i></a>実験内容</h2>

<p>その上で、</p>

<h3>
<span id="requestnavigateする前にkeepaliveをoffするisnavigationtargetはtrueのまま" class="fragment"></span><a href="#requestnavigate%E3%81%99%E3%82%8B%E5%89%8D%E3%81%ABkeepalive%E3%82%92off%E3%81%99%E3%82%8Bisnavigationtarget%E3%81%AFtrue%E3%81%AE%E3%81%BE%E3%81%BE"><i class="fa fa-link"></i></a>①RequestNavigateする前にKeepAliveをOFFする（IsNavigationTargetはtrueのまま）</h3>

<ul>
<li>画面１で、

<ul>
<li>KeepAliveをOFFしてから別の画面(この場合画面２)にRequestNavigateする。</li>
<li>それを何度も繰り返す。</li>
</ul>
</li>
</ul>

<p>そうすると、下記のようなログが残る。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>画面１ コンストラクタ 1 個目
画面１ NavigatedTo
画面１ LoadedCommand
画面１ NavigatedFrom
画面２ コンストラクタ
画面１ KeepAlive is False
画面２ NavigatedTo
画面２ LoadedCommand
画面１ デストラクタ 1 回目
画面２ NavigatedFrom
画面１ コンストラクタ 2 個目
画面１ NavigatedTo
画面１ LoadedCommand
画面１ NavigatedFrom
画面１ KeepAlive is False
画面２ NavigatedTo
画面２ LoadedCommand
画面２ NavigatedFrom
画面１ コンストラクタ 3 個目
画面１ NavigatedTo
画面１ LoadedCommand
画面１ NavigatedFrom
画面１ KeepAlive is False
画面２ NavigatedTo
画面２ LoadedCommand
画面２ NavigatedFrom
画面１ コンストラクタ 4 個目
画面１ NavigatedTo
画面１ LoadedCommand
画面１ NavigatedFrom
画面１ KeepAlive is False
画面２ NavigatedTo
画面２ LoadedCommand
画面１ デストラクタ 2 回目
画面１ デストラクタ 3 回目
画面１ デストラクタ 4 回目
画面２ NavigatedFrom
</code></pre></div></div>

<ul>
<li>画面１に遷移したとき、毎回コンストラクタが走る。</li>
<li>LoadCommand(Loadedイベント)も走る。</li>
<li>時間経過すると、今表示中の画面１インスタンス以外が、デストラクタが走って回収される。</li>
<li>GC.Collect()をすると、時間経過しなくても、その時に表示が終わった画面１のインスタンスがGCに回収される。</li>
</ul>

<h3>
<span id="requestnavigateする前にisnavigationtargetの戻り値をfalseにするkeepaliveはtrueのまま" class="fragment"></span><a href="#requestnavigate%E3%81%99%E3%82%8B%E5%89%8D%E3%81%ABisnavigationtarget%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%82%92false%E3%81%AB%E3%81%99%E3%82%8Bkeepalive%E3%81%AFtrue%E3%81%AE%E3%81%BE%E3%81%BE"><i class="fa fa-link"></i></a>②RequestNavigateする前にIsNavigationTargetの戻り値をfalseにする（KeepAliveはtrueのまま）</h3>

<ul>
<li>画面１で、

<ul>
<li>IsNavigationTargetの戻り値をfalseにしてから別の画面にRequestNavigateする。</li>
<li>それを何度も繰り返す。</li>
</ul>
</li>
</ul>

<p>そうすると、下記のようなログが残る。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>画面１ コンストラクタ 1 個目
画面１ NavigatedTo
画面１ LoadedCommand
画面１ NavigatedFrom
画面２ コンストラクタ
画面１ KeepAlive is True
画面２ NavigatedTo
画面２ LoadedCommand
画面２ NavigatedFrom
画面１ IsNavigationTarget  return value isFalse
画面１ コンストラクタ 2 個目
画面１ NavigatedTo
画面１ LoadedCommand
画面１ NavigatedFrom
画面１ KeepAlive is True
画面２ NavigatedTo
画面２ LoadedCommand
画面２ NavigatedFrom
画面１ IsNavigationTarget  return value isFalse
画面１ IsNavigationTarget  return value isFalse
画面１ コンストラクタ 3 個目
画面１ NavigatedTo
画面１ LoadedCommand
画面１ NavigatedFrom
画面１ KeepAlive is True
画面２ NavigatedTo
画面２ LoadedCommand
画面２ NavigatedFrom
画面１ IsNavigationTarget  return value isFalse
画面１ IsNavigationTarget  return value isFalse
画面１ IsNavigationTarget  return value isFalse
画面１ コンストラクタ 4 個目
画面１ NavigatedTo
画面１ LoadedCommand
画面１ NavigatedFrom
画面１ KeepAlive is True
画面２ NavigatedTo
画面２ LoadedCommand
画面２ NavigatedFrom
画面１ IsNavigationTarget  return value isFalse
画面１ IsNavigationTarget  return value isFalse
画面１ IsNavigationTarget  return value isFalse
画面１ IsNavigationTarget  return value isFalse
画面１ コンストラクタ 5 個目
画面１ NavigatedTo
画面１ LoadedCommand
</code></pre></div></div>

<ul>
<li>結果

<ul>
<li>画面遷移時、コンストラクタは通らない。(=画面１のインスタンスは使いまわされている)</li>
<li>LoadedCommand(Loadedイベント)は実行されている。</li>
<li>画面遷移時、IsNavigationTargetが毎回呼ばれている。</li>
<li>IsNavigationTarget  をfalseにして画面遷移した回数だけ、IsNavigationTarget  が呼ばれるようになってしまう</li>
<li>時間がたっても、デストラクタは呼ばれない。</li>
<li>GC.Colect()を実行しても、デストラクタは呼ばれない。

<ul>
<li>＝画面１のインスタンスは使いまわされている。</li>
</ul>
</li>
<li><strong>画面のインスタンスが、画面遷移するたびに新しく作られ、さらにそれがGCに回収されないままたくさん残ってしまっている！？</strong></li>
</ul>
</li>
</ul>

<p>そうなると、画面遷移回数が増えると作成される画面１のインスタンスも増えることになるので、おそらくメモリリークにつながる。<br>
<strong>⇒画面のインスタンスを毎回破棄して、次回遷移時に再作成したい、という目的のために、IsNavigationTarget  をfalseにする、ということを行ってはいけない！</strong></p>

<h1>
<span id="思ったこと" class="fragment"></span><a href="#%E6%80%9D%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>思ったこと</h1>

<p>現状正直なところ、仕事で出会った流用元のコードでprismを使ってて、prismを理解しないまま出てきたとこだけを場渡り的に調べて乗り切っている状態なので(この記事はその時のメモ)、prismの全体的な理解が足りてないために、こういう部分で詰まってしまう感触を感じ出した。</p>

<p>一度しっかりprismの基礎を勉強しなおした方が、結局は急がば回れで早いかもしれない。<br>
(ただ年強するなら6.3.0ではなく新しいのを勉強したいが...)</p>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p><qiita-embed-ogp src="https://www.nuits.jp/entry/prism-wpf-remove-with-goback"></qiita-embed-ogp></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Ftera1707%2Fitems%2Fba525b43fa2482913c85&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Ftera1707%2Fitems%2Fba525b43fa2482913c85&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tera1707/items/ba525b43fa2482913c85/likers" class="css-1iupg5d">2</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">0</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ba525b43fa2482913c85/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tera1707/items/ba525b43fa2482913c85/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tera1707/items/ba525b43fa2482913c85/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tera1707/items/ba525b43fa2482913c85/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tera1707/items/ba525b43fa2482913c85.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-49d0af86-634d-44d7-bfe7-4c07029347de">{"authorAnalyticsTrackingId":"UA-140152640-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-53478b4a-fd9a-40d8-a85c-3e4fdd69bd9b"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-53478b4a-fd9a-40d8-a85c-3e4fdd69bd9b">{}</script>
      
<div id="LoginModal-react-component-b7d2ce44-ea06-4be0-bb4e-2e23748a4ba5"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-b7d2ce44-ea06-4be0-bb4e-2e23748a4ba5">{}</script>
      
<div id="StockModal-react-component-02513927-1dd3-4591-a6b9-a95a3bd5132f"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-02513927-1dd3-4591-a6b9-a95a3bd5132f">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;We1nEd99dWDRqdRAJZ3oEdBIB0mTv/rU/5kQWYDVrqweY50OPAwsnLZED5Y9YWm8MptHwpZ7fe4/zBFVRkGBiQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e\u003cstrong\u003eもくじ\u003c/strong\u003e\u003cbr\u003e\n→\u003ca href=\"https://qiita.com/tera1707/items/4fda73d86eded283ec4f\" class=\"autolink\" id=\"reference-0109db1287ca72336e9d\"\u003ehttps://qiita.com/tera1707/items/4fda73d86eded283ec4f\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003ePrism関連\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/tera1707/items/4fda73d86eded283ec4f#prism%E9%96%A2%E9%80%A3wpfxaml\" class=\"autolink\" id=\"reference-0109db1287ca72336e9d\"\u003ehttps://qiita.com/tera1707/items/4fda73d86eded283ec4f#prism%E9%96%A2%E9%80%A3wpfxaml\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eコード\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/tera1707/WPF-/tree/master/024_PrismSample\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/tera1707/WPF-/tree/master/024_PrismSample\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"やりたいこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやりたいこと\u003c/h1\u003e\n\n\u003cp\u003ePrismの画面遷移をさせるうえで、\u003cbr\u003e\n\u003ccode\u003eRegionManager.RequestNavigate(\"リージョン名\",・・・);\u003c/code\u003eとしているが、\u003cbr\u003e\nその時に、画面のViewModelのクラスのインスタンスを一旦破棄して、再度遷移した際にもう一度作り直したい、というケースがあった。\u003c/p\u003e\n\n\u003cp\u003eその際、「インスタンスを破棄」とかでやり方を調べていると、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eINavigationAware\u003c/code\u003eインターフェースの\u003ccode\u003eIsNavigationTarget\u003c/code\u003eメソッドを実装して、そいつにfalseを返させる\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eIRegionMemberLifetime\u003c/code\u003eインターフェースの\u003ccode\u003eKeepAlive\u003c/code\u003eプロパティを実装して、そいつをfalseにする\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eという二つのやり方が見つかった。\u003c/p\u003e\n\n\u003cp\u003e簡単に試したところ、どっちも\u003cbr\u003e\n画面Aから画面Bに\u003ccode\u003eRequestNavigate\u003c/code\u003eで遷移した後、再度画面Aに戻った際、\u003cstrong\u003e画面Aのコンストラクタが呼ばれている。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eつまり、どちらも画面Aは画面Bに遷移後、一旦破棄されてる？？まったく同じことに対してやり方が2通りあるのか？\u003cbr\u003e\nでもそんなわけがない、何か違いがあるはず、と思ったので、何が違うのか調べてみる。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"今回試した結論\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E8%A9%A6%E3%81%97%E3%81%9F%E7%B5%90%E8%AB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今回試した結論\u003c/h1\u003e\n\n\u003cp\u003e結果、下記である、自分の中ではなった。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003eやること\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e起きていること\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e①KeepAliveをfalseにする\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eViewModelのインスタンスが破棄される。\u003cbr\u003e再度同じ画面にRequestNavigateした際に、ViewModelのインスタンスが再作成されている。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e②IsNavigationTargetにfalseを返させる\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eViewModelのインスタンスは\u003cstrong\u003e破棄されない\u003c/strong\u003e。\u003cbr\u003e再度同じ画面にRequestNavigateした際は、前の画面のインスタンスは\u003cstrong\u003e破棄せず保持\u003c/strong\u003eで、\u003cstrong\u003e新しいVMのインスタンスを作成\u003c/strong\u003eし、そっちに遷移する。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eつまり、両方ともコンストラクタが呼ばれる、イコール、新しいVMのインスタンスが作成されてるが、KeepAliveをfalseにする方は古い(別画面に遷移後の、元の画面の)インスタンスは破棄されてるが、IsNavigationTargetの戻り値をfalseにする方は、古いインスタンスが実は\u003cstrong\u003e破棄されてない。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eそのため、②のほうは、画面遷移回数が増えると作成される画面１のインスタンスも増えることになるので、おそらくメモリリークにつながる。\u003cbr\u003e\n\u003cstrong\u003e⇒画面のインスタンスを毎回破棄して、次回遷移時に再作成したい、という目的のために、IsNavigationTarget  をfalseにする、ということを行ってはいけない！\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e今回やりたい「画面遷移するたびに毎回画面のVMのインスタンスを破棄したい」ということをする場合は、\u003cstrong\u003eKeepAliveをOFF\u003c/strong\u003eしてからRequestNavigateで画面遷移させるのが良い。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"結論がでるまでに試したこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E8%AB%96%E3%81%8C%E3%81%A7%E3%82%8B%E3%81%BE%E3%81%A7%E3%81%AB%E8%A9%A6%E3%81%97%E3%81%9F%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結論がでるまでに試したこと\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"実験コード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E9%A8%93%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実験コード\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eViewModelの\u003ccode\u003eIsNavigationTarget\u003c/code\u003eメソッドに、通ったことがわかるようにDebug.WriteLineでログ出力処理を入れた\u003c/li\u003e\n\u003cli\u003eViewModelのデストラクタに、通ったことがわかるようにDebug.WriteLineでログ出力処理を入れた\u003c/li\u003e\n\u003cli\u003eViewModelに、自分自身の\n\n\u003cul\u003e\n\u003cli\u003eIsNavigationTargetメソッドの戻り値の値をfalseにできるようにした\u003c/li\u003e\n\u003cli\u003eKeepAliveをfalseにできるようにした\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e実験コード1.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.Practices.Unity\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003ePrism.Commands\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003ePrism.Mvvm\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003ePrism.Regions\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003ePrismSample.Views\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Diagnostics\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003ePrismSample.ViewModels\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUserControl1ViewModel\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eBindableBase\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eINavigationAware\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRegionMemberLifetime\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDependency\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIRegionManager\u003c/span\u003e \u003cspan class=\"n\"\u003eRegionManager\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDelegateCommand\u003c/span\u003e \u003cspan class=\"n\"\u003eButtonCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDelegateCommand\u003c/span\u003e \u003cspan class=\"n\"\u003eButtonKeepAliveONCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDelegateCommand\u003c/span\u003e \u003cspan class=\"n\"\u003eButtonKeepAliveOFFCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDelegateCommand\u003c/span\u003e \u003cspan class=\"n\"\u003eButtonIsNavigationTargetONCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDelegateCommand\u003c/span\u003e \u003cspan class=\"n\"\u003eButtonIsNavigationTargetOFFCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDelegateCommand\u003c/span\u003e \u003cspan class=\"n\"\u003eLoadedCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003econstructorCounter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003edestructorCounter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eKeepAlive\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eget\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"画面１ KeepAlive is \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ekeepalive\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ekeepalive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eset\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ekeepalive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003ekeepalive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eIsNavigationTargetFlag\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eUserControl1ViewModel\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econstructorCounter\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"画面１ コンストラクタ \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003econstructorCounter\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" 個目\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLoadedCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDelegateCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"画面１ LoadedCommand\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eButtonCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDelegateCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// Shell.xaml.csで作成したリージョンの名前と、画面のUserControlクラス名を指定して、画面遷移させる。\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// (パラメータを渡すこともできる)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRegionManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRequestNavigate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RedRegion\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enameof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUserControl2\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNavigationParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"id=1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eButtonKeepAliveONCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDelegateCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eKeepAlive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eButtonKeepAliveOFFCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDelegateCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eKeepAlive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eButtonIsNavigationTargetONCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDelegateCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eIsNavigationTargetFlag\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eButtonIsNavigationTargetOFFCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDelegateCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eIsNavigationTargetFlag\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"p\"\u003e~\u003c/span\u003e\u003cspan class=\"nf\"\u003eUserControl1ViewModel\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edestructorCounter\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"画面１ デストラクタ \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003edestructorCounter\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" 回目\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eIsNavigationTarget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNavigationContext\u003c/span\u003e \u003cspan class=\"n\"\u003enavigationContext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"画面１ IsNavigationTarget  return value is\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eIsNavigationTargetFlag\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// このメソッドの返す値により、画面のインスタンスを使いまわすかどうか制御できる。\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// true ：インスタンスを使いまわす(画面遷移してもコンストラクタ呼ばれない)\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// false：インスタンスを使いまわさない(画面遷移するとコンストラクタ呼ばれる)\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// メソッド実装なし：trueになる\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eIsNavigationTargetFlag\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnNavigatedFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNavigationContext\u003c/span\u003e \u003cspan class=\"n\"\u003enavigationContext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// この画面から他の画面に遷移するときの処理\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"画面１ NavigatedFrom\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnNavigatedTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNavigationContext\u003c/span\u003e \u003cspan class=\"n\"\u003enavigationContext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 他の画面からこの画面に遷移したときの処理\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"画面１ NavigatedTo\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 画面遷移元から、この画面に遷移したときにパラメータを受け取れる。\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enavigationContext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e実験3.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.Practices.Unity\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003ePrism.Commands\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003ePrism.Mvvm\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003ePrism.Regions\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003ePrismSample.Views\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Diagnostics\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003ePrismSample.ViewModels\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUserControl3ViewModel\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eBindableBase\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eINavigationAware\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDependency\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIRegionManager\u003c/span\u003e \u003cspan class=\"n\"\u003eRegionManager\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDelegateCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eButtonCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDelegateCommand\u003c/span\u003e \u003cspan class=\"n\"\u003eLoadedCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eUserControl3ViewModel\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"画面３ コンストラクタ\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLoadedCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDelegateCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"画面３ LoadedCommand\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eButtonCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDelegateCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ekind\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eRegionManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRequestNavigate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RedRegion\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enameof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUserControl1\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNavigationParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"id=1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eRegionManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRequestNavigate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RedRegion\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enameof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUserControl2\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNavigationParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"id=1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eRegionManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRequestNavigate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RedRegion\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enameof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUserControl3\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNavigationParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"id=1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eRegionManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRequestNavigate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"BlueRegion\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enameof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUserControl1\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNavigationParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"id=1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eRegionManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRequestNavigate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"BlueRegion\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enameof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUserControl2\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNavigationParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"id=1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eRegionManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRequestNavigate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"BlueRegion\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enameof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUserControl3\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNavigationParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"id=1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eRegionManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRegions\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RedRegion\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eRemoveAll\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eRegionManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRegions\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"BlueRegion\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eRemoveAll\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e91\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eGC\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCollect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eIsNavigationTarget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNavigationContext\u003c/span\u003e \u003cspan class=\"n\"\u003enavigationContext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnNavigatedFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNavigationContext\u003c/span\u003e \u003cspan class=\"n\"\u003enavigationContext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"画面３ NavigatedFrom\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnNavigatedTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNavigationContext\u003c/span\u003e \u003cspan class=\"n\"\u003enavigationContext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"画面３ NavigatedTo\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"実験内容\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E9%A8%93%E5%86%85%E5%AE%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実験内容\u003c/h2\u003e\n\n\u003cp\u003eその上で、\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"requestnavigateする前にkeepaliveをoffするisnavigationtargetはtrueのまま\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#requestnavigate%E3%81%99%E3%82%8B%E5%89%8D%E3%81%ABkeepalive%E3%82%92off%E3%81%99%E3%82%8Bisnavigationtarget%E3%81%AFtrue%E3%81%AE%E3%81%BE%E3%81%BE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e①RequestNavigateする前にKeepAliveをOFFする（IsNavigationTargetはtrueのまま）\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e画面１で、\n\n\u003cul\u003e\n\u003cli\u003eKeepAliveをOFFしてから別の画面(この場合画面２)にRequestNavigateする。\u003c/li\u003e\n\u003cli\u003eそれを何度も繰り返す。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eそうすると、下記のようなログが残る。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e画面１ コンストラクタ 1 個目\n画面１ NavigatedTo\n画面１ LoadedCommand\n画面１ NavigatedFrom\n画面２ コンストラクタ\n画面１ KeepAlive is False\n画面２ NavigatedTo\n画面２ LoadedCommand\n画面１ デストラクタ 1 回目\n画面２ NavigatedFrom\n画面１ コンストラクタ 2 個目\n画面１ NavigatedTo\n画面１ LoadedCommand\n画面１ NavigatedFrom\n画面１ KeepAlive is False\n画面２ NavigatedTo\n画面２ LoadedCommand\n画面２ NavigatedFrom\n画面１ コンストラクタ 3 個目\n画面１ NavigatedTo\n画面１ LoadedCommand\n画面１ NavigatedFrom\n画面１ KeepAlive is False\n画面２ NavigatedTo\n画面２ LoadedCommand\n画面２ NavigatedFrom\n画面１ コンストラクタ 4 個目\n画面１ NavigatedTo\n画面１ LoadedCommand\n画面１ NavigatedFrom\n画面１ KeepAlive is False\n画面２ NavigatedTo\n画面２ LoadedCommand\n画面１ デストラクタ 2 回目\n画面１ デストラクタ 3 回目\n画面１ デストラクタ 4 回目\n画面２ NavigatedFrom\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e画面１に遷移したとき、毎回コンストラクタが走る。\u003c/li\u003e\n\u003cli\u003eLoadCommand(Loadedイベント)も走る。\u003c/li\u003e\n\u003cli\u003e時間経過すると、今表示中の画面１インスタンス以外が、デストラクタが走って回収される。\u003c/li\u003e\n\u003cli\u003eGC.Collect()をすると、時間経過しなくても、その時に表示が終わった画面１のインスタンスがGCに回収される。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"requestnavigateする前にisnavigationtargetの戻り値をfalseにするkeepaliveはtrueのまま\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#requestnavigate%E3%81%99%E3%82%8B%E5%89%8D%E3%81%ABisnavigationtarget%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%82%92false%E3%81%AB%E3%81%99%E3%82%8Bkeepalive%E3%81%AFtrue%E3%81%AE%E3%81%BE%E3%81%BE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e②RequestNavigateする前にIsNavigationTargetの戻り値をfalseにする（KeepAliveはtrueのまま）\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e画面１で、\n\n\u003cul\u003e\n\u003cli\u003eIsNavigationTargetの戻り値をfalseにしてから別の画面にRequestNavigateする。\u003c/li\u003e\n\u003cli\u003eそれを何度も繰り返す。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eそうすると、下記のようなログが残る。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e画面１ コンストラクタ 1 個目\n画面１ NavigatedTo\n画面１ LoadedCommand\n画面１ NavigatedFrom\n画面２ コンストラクタ\n画面１ KeepAlive is True\n画面２ NavigatedTo\n画面２ LoadedCommand\n画面２ NavigatedFrom\n画面１ IsNavigationTarget  return value isFalse\n画面１ コンストラクタ 2 個目\n画面１ NavigatedTo\n画面１ LoadedCommand\n画面１ NavigatedFrom\n画面１ KeepAlive is True\n画面２ NavigatedTo\n画面２ LoadedCommand\n画面２ NavigatedFrom\n画面１ IsNavigationTarget  return value isFalse\n画面１ IsNavigationTarget  return value isFalse\n画面１ コンストラクタ 3 個目\n画面１ NavigatedTo\n画面１ LoadedCommand\n画面１ NavigatedFrom\n画面１ KeepAlive is True\n画面２ NavigatedTo\n画面２ LoadedCommand\n画面２ NavigatedFrom\n画面１ IsNavigationTarget  return value isFalse\n画面１ IsNavigationTarget  return value isFalse\n画面１ IsNavigationTarget  return value isFalse\n画面１ コンストラクタ 4 個目\n画面１ NavigatedTo\n画面１ LoadedCommand\n画面１ NavigatedFrom\n画面１ KeepAlive is True\n画面２ NavigatedTo\n画面２ LoadedCommand\n画面２ NavigatedFrom\n画面１ IsNavigationTarget  return value isFalse\n画面１ IsNavigationTarget  return value isFalse\n画面１ IsNavigationTarget  return value isFalse\n画面１ IsNavigationTarget  return value isFalse\n画面１ コンストラクタ 5 個目\n画面１ NavigatedTo\n画面１ LoadedCommand\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e結果\n\n\u003cul\u003e\n\u003cli\u003e画面遷移時、コンストラクタは通らない。(=画面１のインスタンスは使いまわされている)\u003c/li\u003e\n\u003cli\u003eLoadedCommand(Loadedイベント)は実行されている。\u003c/li\u003e\n\u003cli\u003e画面遷移時、IsNavigationTargetが毎回呼ばれている。\u003c/li\u003e\n\u003cli\u003eIsNavigationTarget  をfalseにして画面遷移した回数だけ、IsNavigationTarget  が呼ばれるようになってしまう\u003c/li\u003e\n\u003cli\u003e時間がたっても、デストラクタは呼ばれない。\u003c/li\u003e\n\u003cli\u003eGC.Colect()を実行しても、デストラクタは呼ばれない。\n\n\u003cul\u003e\n\u003cli\u003e＝画面１のインスタンスは使いまわされている。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e画面のインスタンスが、画面遷移するたびに新しく作られ、さらにそれがGCに回収されないままたくさん残ってしまっている！？\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eそうなると、画面遷移回数が増えると作成される画面１のインスタンスも増えることになるので、おそらくメモリリークにつながる。\u003cbr\u003e\n\u003cstrong\u003e⇒画面のインスタンスを毎回破棄して、次回遷移時に再作成したい、という目的のために、IsNavigationTarget  をfalseにする、ということを行ってはいけない！\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"思ったこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%80%9D%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e思ったこと\u003c/h1\u003e\n\n\u003cp\u003e現状正直なところ、仕事で出会った流用元のコードでprismを使ってて、prismを理解しないまま出てきたとこだけを場渡り的に調べて乗り切っている状態なので(この記事はその時のメモ)、prismの全体的な理解が足りてないために、こういう部分で詰まってしまう感触を感じ出した。\u003c/p\u003e\n\n\u003cp\u003e一度しっかりprismの基礎を勉強しなおした方が、結局は急がば回れで早いかもしれない。\u003cbr\u003e\n(ただ年強するなら6.3.0ではなく新しいのを勉強したいが...)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://www.nuits.jp/entry/prism-wpf-remove-with-goback\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n","createdAt":"2020-09-07T09:47:46Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"kbkSMrT/G2oTvmwNfZfxGOeMkfMZCYSfTw==--M4RzhVL+Pj+AZ3A/--i4o45yZhfTtsvTmuFez32g==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2021-06-03T04:17:52Z","likesCount":2,"linkUrl":"https://qiita.com/tera1707/items/ba525b43fa2482913c85","organization":null,"originalId":1296301,"stockedCount":0,"title":"[WPF/C#] Prism(6.3.0)のKeepAliveをfalseにすることとIsNavigationTargetでfalseを返すことの違いの実験","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003eやりたいこと\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E8%A9%A6%E3%81%97%E3%81%9F%E7%B5%90%E8%AB%96\"\u003e今回試した結論\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B5%90%E8%AB%96%E3%81%8C%E3%81%A7%E3%82%8B%E3%81%BE%E3%81%A7%E3%81%AB%E8%A9%A6%E3%81%97%E3%81%9F%E3%81%93%E3%81%A8\"\u003e結論がでるまでに試したこと\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E9%A8%93%E3%82%B3%E3%83%BC%E3%83%89\"\u003e実験コード\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E9%A8%93%E5%86%85%E5%AE%B9\"\u003e実験内容\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#requestnavigate%E3%81%99%E3%82%8B%E5%89%8D%E3%81%ABkeepalive%E3%82%92off%E3%81%99%E3%82%8Bisnavigationtarget%E3%81%AFtrue%E3%81%AE%E3%81%BE%E3%81%BE\"\u003e①RequestNavigateする前にKeepAliveをOFFする（IsNavigationTargetはtrueのまま）\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#requestnavigate%E3%81%99%E3%82%8B%E5%89%8D%E3%81%ABisnavigationtarget%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%82%92false%E3%81%AB%E3%81%99%E3%82%8Bkeepalive%E3%81%AFtrue%E3%81%AE%E3%81%BE%E3%81%BE\"\u003e②RequestNavigateする前にIsNavigationTargetの戻り値をfalseにする（KeepAliveはtrueのまま）\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%80%9D%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003e思ったこと\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e参考\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":1250,"uuid":"ba525b43fa2482913c85","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"jBlVX0EcJ/kuJJUbiafUCMK5tlfN--9YYfzgqr3GvPg9pa--OZAKGpopFLtEkv09k5Hxeg==","originalId":352601,"description":"","facebookUrl":null,"githubUrl":"https://github.com/tera1707","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://avatars0.githubusercontent.com/u/19180456?v=4","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F19180456%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=d374ef2a13106c43b12251ae9f724ca0","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F19180456%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1ddd4d18cb0c4d9ee77ed7cff93f4ae1","urlName":"tera1707","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"WPF","urlName":"wpf"},{"name":"PRISM","urlName":"prism"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

<!DOCTYPE html><html><head><meta charset="utf-8" /><title>[VB.NET]LINQのクエリ式の複数のFrom句、及び左外部結合はどのように処理されるのか？ - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/jun1s/items/a438d09f037d999434ab" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="yQv01rO4PUnUJZNCpAhaHQ7Wzivk59F7p3yWnBYSJOtT27j8JmNN+hpg99fTBaxvJsjd1QiyHdEpRgXt0eEobg==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@jun1s" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="[VB.NET]LINQのクエリ式の複数のFrom句、及び左外部結合はどのように処理されるのか？ - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XMVpDTGs1RlZGMU1TVTVSNDRHdTQ0S3Y0NEtvNDRPcTVieVA0NEd1NktTSDVwV3c0NEd1Um5KdmJlV1BwZU9BZ2VXUGl1T0JzLVczcHVXa2x1bURxT2Uxa09XUWlPT0JyLU9CcWVPQnJ1T0NpT09CaHVPQnEtV0hwdWVRaHVPQmxlT0NqT09DaS1PQnJ1T0JpLS04bncmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9ZGFhMTkxNzcyNzg0MmVmOWY1MjgzOWE5YjBjNTRlMjg&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3AxYmpGeiZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTVjNzg1Nzg4ZDY1ODM1OTk1OTAxMDFmNjk2Y2I1ZTZk&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=0eeb3a80e1bff4ef545ef02d5f4142c2"><meta property="og:description" content="LINQのクエリ式に複数のfrom句がある場合、どのように処理されるのかを考えてみました。


LINQのクエリ式に複数のfrom句がある場合

Dim alphabets = {&quot;a&quot;, &quot;b&quot;}
Dim numbers = {1,..."><meta content="https://qiita.com/jun1s/items/a438d09f037d999434ab" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="VB.Net,C#,LINQ,クエリ式" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-6d4ec124-ead8-4d45-9647-6a778cbb9711"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fjun1s%2Fitems%2Fa438d09f037d999434ab">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fjun1s%2Fitems%2Fa438d09f037d999434ab">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-6d4ec124-ead8-4d45-9647-6a778cbb9711">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/vb.net","name":"VB.Net"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2021-06-17T12:27:45.000+09:00","dateModified":"2021-08-11T14:19:13.000+09:00","headline":"[VB.NET]LINQのクエリ式の複数のFrom句、及び左外部結合はどのように処理されるのか？","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XMVpDTGs1RlZGMU1TVTVSNDRHdTQ0S3Y0NEtvNDRPcTVieVA0NEd1NktTSDVwV3c0NEd1Um5KdmJlV1BwZU9BZ2VXUGl1T0JzLVczcHVXa2x1bURxT2Uxa09XUWlPT0JyLU9CcWVPQnJ1T0NpT09CaHVPQnEtV0hwdWVRaHVPQmxlT0NqT09DaS1PQnJ1T0JpLS04bncmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9ZGFhMTkxNzcyNzg0MmVmOWY1MjgzOWE5YjBjNTRlMjg\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3AxYmpGeiZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTVjNzg1Nzg4ZDY1ODM1OTk1OTAxMDFmNjk2Y2I1ZTZk\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=0eeb3a80e1bff4ef545ef02d5f4142c2","mainEntityOfPage":"https://qiita.com/jun1s/items/a438d09f037d999434ab","author":{"@type":"Person","address":"Echizen-shi, Fukui, Japan","email":null,"identifier":"jun1s","name":"jun1s","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F207038%2Fprofile-images%2F1626694207?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=d32024917eddb4431b54a590dd0309cd","url":"https://qiita.com/jun1s","description":"福井県越前市在住のプログラマーです。\r\n主にマイクロソフト系の技術者であり、javascript系のweb技術もフォローしています。\r\nVB.NET、C#、ASP.NET MVC(.NET Framework 又は.NET 5)の新規開発、古いVB資産の最新システムへのリプレース案件等を得意としています。\r\nお仕事の依頼や開発チームへの参加要請がありましたらお気軽にご連絡下さい。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"jun1s","type":"items","id":"a438d09f037d999434ab"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"jun1s","type":"items","id":"a438d09f037d999434ab"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"jun1s","type":"items","id":"a438d09f037d999434ab"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/jun1s/items/a438d09f037d999434ab","location":"/jun1s/items/a438d09f037d999434ab","scheme":"https","host":"qiita.com","port":null,"pathname":"/jun1s/items/a438d09f037d999434ab","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"RwZv/BkoVLlK0Sdk+YXBpbRVVk3BRmiTv8X+YTC3ZILd1iPWjPMkCoSUQ/GOiDfXnEtFsy0TpDkx/20Q90RoBw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-37e683fb-3977-4d4a-8c87-5aa554f24e89"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/jun1s/items/a438d09f037d999434ab/likers" class="css-1iupg5d">0</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">1</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/a438d09f037d999434ab/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/jun1s/items/a438d09f037d999434ab/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/jun1s/items/a438d09f037d999434ab/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/jun1s/items/a438d09f037d999434ab/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/jun1s/items/a438d09f037d999434ab.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/jun1s"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/207038/profile-images/1626694207" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/jun1s" class="css-10ougpm">@<!-- -->jun1s</a><div class="css-1ay9vb9"><span><meta content="2021-06-17T03:27:45Z"/><time dateTime="2021-08-11T05:19:13Z" class="css-m19uds">updated at 2021-08-11</time></span></div></div></div></div></div><h1 class="css-cgzq40">[VB.NET]LINQのクエリ式の複数のFrom句、及び左外部結合はどのように処理されるのか？</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/vb.net" class="css-4czcte">VB.Net</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/linq" class="css-4czcte">LINQ</a><a href="/tags/%e3%82%af%e3%82%a8%e3%83%aa%e5%bc%8f" class="css-4czcte">クエリ式</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>LINQのクエリ式に複数のfrom句がある場合、どのように処理されるのかを考えてみました。</p>

<h3>
<span id="linqのクエリ式に複数のfrom句がある場合" class="fragment"></span><a href="#linq%E3%81%AE%E3%82%AF%E3%82%A8%E3%83%AA%E5%BC%8F%E3%81%AB%E8%A4%87%E6%95%B0%E3%81%AEfrom%E5%8F%A5%E3%81%8C%E3%81%82%E3%82%8B%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>LINQのクエリ式に複数のfrom句がある場合</h3>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="k">Dim</span> <span class="nv">alphabets</span> <span class="o">=</span> <span class="p">{</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">}</span>
<span class="k">Dim</span> <span class="nv">numbers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>

<span class="k">Dim</span> <span class="nv">query</span> <span class="o">=</span> 
    <span class="n">from</span> <span class="n">alp</span> <span class="n">in</span> <span class="n">alphabets</span>
    <span class="n">from</span> <span class="n">num</span> <span class="n">in</span> <span class="n">numbers</span>
    <span class="n">select</span> <span class="n">alp</span><span class="p">,</span> <span class="n">num</span>

<span class="k">For</span> <span class="k">Each</span> <span class="n">item</span> <span class="n">in</span> <span class="n">query</span>
    <span class="nb">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span> <span class="n">item</span><span class="p">.</span><span class="n">alp</span> <span class="o">&amp;</span> <span class="s">", "</span> <span class="o">&amp;</span> <span class="n">item</span><span class="p">.</span><span class="n">num</span> <span class="p">)</span>
<span class="k">Next</span>
</code></pre></div></div>

<p>こんなふうに、2つのリスト（実際はテーブルのレコードになると思いますが）があった時に、それらをfrom句でそのまんま繋ぐと、以下のようにalphabetsとnumbersの総当たり結果が出力されます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>a, 1
a, 2
a, 3
b, 1
b, 2
b, 3
</code></pre></div></div>

<p>これはSQLで次のように書いた時と同じです。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">alphabets</span><span class="p">,</span> <span class="n">numbers</span>
</code></pre></div></div>

<p>内部的には次のようにFor Eachループの入れ子処理がされている、という説明を読んだことがあります。</p>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="k">Dim</span> <span class="nv">alphabets</span> <span class="o">=</span> <span class="p">{</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">}</span>
<span class="k">Dim</span> <span class="nv">numbers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>

<span class="k">Dim</span> <span class="nv">query</span> <span class="o">=</span>
    <span class="n">From</span> <span class="n">alp</span> <span class="ow">In</span> <span class="n">alphabets</span>
    <span class="n">From</span> <span class="n">num</span> <span class="ow">In</span> <span class="n">numbers</span>
    <span class="k">Select</span> <span class="n">alp</span><span class="p">,</span> <span class="n">num</span>

<span class="k">For</span> <span class="k">Each</span> <span class="n">item</span> <span class="ow">In</span> <span class="n">query</span>
    <span class="nb">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">alp</span> <span class="o">&amp;</span> <span class="s">", "</span> <span class="o">&amp;</span> <span class="n">item</span><span class="p">.</span><span class="n">num</span><span class="p">)</span>
<span class="k">Next</span>

<span class="k">Dim</span> <span class="nv">list</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="n">ToList</span><span class="p">()</span>
<span class="n">list</span><span class="p">.</span><span class="n">Clear</span><span class="p">()</span>
<span class="k">For</span> <span class="k">Each</span> <span class="n">alp</span> <span class="ow">In</span> <span class="n">alphabets</span>
    <span class="k">For</span> <span class="k">Each</span> <span class="n">num</span> <span class="ow">In</span> <span class="n">numbers</span>
        <span class="n">list</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">New</span> <span class="k">With</span> <span class="p">{</span><span class="n">Key</span> <span class="p">.</span><span class="n">alp</span> <span class="o">=</span> <span class="n">alp</span><span class="p">,</span> <span class="n">Key</span> <span class="p">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">num</span><span class="p">})</span>
    <span class="k">Next</span>
<span class="k">Next</span>

<span class="k">For</span> <span class="k">Each</span> <span class="n">item</span> <span class="ow">In</span> <span class="n">query</span>
    <span class="nb">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">alp</span> <span class="o">&amp;</span> <span class="s">", "</span> <span class="o">&amp;</span> <span class="n">item</span><span class="p">.</span><span class="n">num</span><span class="p">)</span>
<span class="k">Next</span>
</code></pre></div></div>

<p>つまり、alphabetsとnumbersが入れ子のループになっている、という事のようです。<br>
確かに結果は同じく、以下のようになります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>a, 1
a, 2
a, 3
b, 1
b, 2
b, 3
</code></pre></div></div>

<h3>
<span id="親子構造を持つデータで複数のfrom句" class="fragment"></span><a href="#%E8%A6%AA%E5%AD%90%E6%A7%8B%E9%80%A0%E3%82%92%E6%8C%81%E3%81%A4%E3%83%87%E3%83%BC%E3%82%BF%E3%81%A7%E8%A4%87%E6%95%B0%E3%81%AEfrom%E5%8F%A5"><i class="fa fa-link"></i></a>親子構造を持つデータで複数のfrom句</h3>

<p>それでは、次のような、親子構造を持つデータを扱う場合には、どのように考えればよいのでしょうか。<br>
Parentクラスは、Childrenという文字列のリストを持っています。</p>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="k">Class</span> <span class="nc">Parent</span>
    <span class="k">Public</span> <span class="n">Name</span> <span class="ow">As</span> <span class="kt">String</span>
    <span class="k">Public</span> <span class="n">Children</span> <span class="ow">As</span> <span class="k">New</span> <span class="n">List</span><span class="p">(</span><span class="k">Of</span> <span class="kt">String</span><span class="p">)</span>
<span class="k">End</span> <span class="k">Class</span>
</code></pre></div></div>

<p>このデータについて、parentとchildの二つのfrom句を指定してみます。</p>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="k">Dim</span> <span class="nv">parents</span> <span class="n">as</span> <span class="k">New</span> <span class="n">List</span><span class="p">(</span><span class="k">Of</span> <span class="n">Parent</span><span class="p">)</span> <span class="n">From</span> <span class="p">{</span>
    <span class="k">New</span> <span class="n">Parent</span> <span class="k">With</span> <span class="p">{.</span><span class="n">Name</span> <span class="o">=</span> <span class="s">"Parent1"</span><span class="p">,</span> <span class="p">.</span><span class="n">Children</span> <span class="o">=</span> <span class="k">New</span> <span class="n">List</span><span class="p">(</span><span class="k">Of</span> <span class="kt">String</span><span class="p">)</span> <span class="n">From</span> <span class="p">{</span><span class="s">"Child1"</span><span class="p">,</span> <span class="s">"Child2"</span><span class="p">}</span> <span class="p">},</span>
    <span class="k">New</span> <span class="n">Parent</span> <span class="k">With</span> <span class="p">{.</span><span class="n">Name</span> <span class="o">=</span> <span class="s">"Parent2"</span><span class="p">,</span> <span class="p">.</span><span class="n">Children</span> <span class="o">=</span> <span class="k">New</span> <span class="n">List</span><span class="p">(</span><span class="k">Of</span> <span class="kt">String</span><span class="p">)</span> <span class="n">From</span> <span class="p">{</span><span class="s">"Child3"</span><span class="p">,</span> <span class="s">"Child4"</span><span class="p">}</span> <span class="p">}</span> 
<span class="p">}</span>

<span class="k">Dim</span> <span class="nv">query</span> <span class="o">=</span> 
    <span class="n">From</span> <span class="n">parent</span> <span class="ow">In</span> <span class="n">parents</span>
    <span class="n">From</span> <span class="n">child</span> <span class="ow">In</span> <span class="n">parent</span><span class="p">.</span><span class="n">Children</span>
    <span class="k">Select</span> <span class="n">parent</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">child</span>

<span class="k">For</span> <span class="k">Each</span> <span class="n">item</span> <span class="ow">In</span> <span class="n">query</span>
    <span class="nb">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">Name</span> <span class="o">&amp;</span> <span class="s">", "</span> <span class="o">&amp;</span> <span class="n">item</span><span class="p">.</span><span class="n">Child</span><span class="p">)</span>
<span class="k">Next</span>
</code></pre></div></div>

<p>結果は以下のようになります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>Parent1, Child1
Parent1, Child2
Parent2, Child3
Parent2, Child4
</code></pre></div></div>

<p>なんとなく、こうなったりしないのかなと思ったのが、ならないようです。</p>

<div class="code-frame" data-lang="こうはならない"><div class="highlight"><pre><code>Parent1, Child1
Parent1, Child2
Parent1, Child3
Parent1, Child4
Parent2, Child1
Parent2, Child2
Parent2, Child3
Parent2, Child4
</code></pre></div></div>

<p>しかしこれも、For Eachループの入れ子と考えれば、当然の結果です。</p>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="k">For</span> <span class="k">Each</span> <span class="n">parent</span> <span class="ow">In</span> <span class="n">parents</span>
    <span class="k">For</span> <span class="k">Each</span> <span class="n">child</span> <span class="ow">In</span> <span class="n">parent</span><span class="p">.</span><span class="n">Children</span>
        <span class="n">list</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">New</span> <span class="k">With</span> <span class="p">{</span><span class="n">Key</span> <span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">parent</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">Key</span> <span class="p">.</span><span class="n">child</span> <span class="o">=</span> <span class="n">child</span><span class="p">})</span>
    <span class="k">Next</span>
<span class="k">Next</span>
</code></pre></div></div>

<h3>
<span id="複数のfrom句はselectmanyとしても捉えられる" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E3%81%AEfrom%E5%8F%A5%E3%81%AFselectmany%E3%81%A8%E3%81%97%E3%81%A6%E3%82%82%E6%8D%89%E3%81%88%E3%82%89%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>複数のFrom句はSelectManyとしても捉えられる</h3>

<p>ただ、どうも、「For Eachループの入れ子」という考え方が、Linqをメソッドチェーンとして捉えようとした時に相性が悪く、「結局今、リストの状態はどうなっているのか？」というのがいまいちピンと来ません。</p>

<p>色々と探っていると、複数のfrom句は、SelectManyとして実装されているという話を見つけました（本当かどうか知りませんが）。<br>
SelectManyとは、基本的には、リストの各要素1つから複数のリスト構造が出力されるような場合に、各要素からのリストを1つのリストにまとめて出力するというものです。</p>

<p>いくつかの使い方がありますが、そのうちの一つは、階層構造を持つデータに対して、「親から子のリストを取得するラムダ式」と、「その結果得られる子のリストのそれぞれの各要素と、その親を両方受け取って何らかのデータを返すラムダ式」を与えて、後者のラムダ式の結果のリストの合成結果を生成するメソッドになります。</p>

<p>具体的には次のように使います。</p>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="k">Dim</span> <span class="nv">parents</span> <span class="n">as</span> <span class="k">New</span> <span class="n">List</span><span class="p">(</span><span class="k">Of</span> <span class="n">Parent</span><span class="p">)</span> <span class="n">From</span> <span class="p">{</span>
    <span class="k">New</span> <span class="n">Parent</span> <span class="k">With</span> <span class="p">{.</span><span class="n">Name</span> <span class="o">=</span> <span class="s">"Parent1"</span><span class="p">,</span> <span class="p">.</span><span class="n">Children</span> <span class="o">=</span> <span class="k">New</span> <span class="n">List</span><span class="p">(</span><span class="k">Of</span> <span class="kt">String</span><span class="p">)</span> <span class="n">From</span> <span class="p">{</span><span class="s">"Child1"</span><span class="p">,</span> <span class="s">"Child2"</span><span class="p">}</span> <span class="p">},</span>
    <span class="k">New</span> <span class="n">Parent</span> <span class="k">With</span> <span class="p">{.</span><span class="n">Name</span> <span class="o">=</span> <span class="s">"Parent2"</span><span class="p">,</span> <span class="p">.</span><span class="n">Children</span> <span class="o">=</span> <span class="k">New</span> <span class="n">List</span><span class="p">(</span><span class="k">Of</span> <span class="kt">String</span><span class="p">)</span> <span class="n">From</span> <span class="p">{</span><span class="s">"Child3"</span><span class="p">,</span> <span class="s">"Child4"</span><span class="p">}</span> <span class="p">}</span> 
<span class="p">}</span>

<span class="k">Dim</span> <span class="nv">query</span> <span class="o">=</span> <span class="n">parents</span><span class="p">.</span><span class="n">SelectMany</span><span class="p">(</span>
    <span class="k">Function</span><span class="err">(</span><span class="nf">parent</span><span class="p">)</span> <span class="n">parent</span><span class="p">.</span><span class="n">Children</span><span class="p">,</span> 
    <span class="k">Function</span><span class="err">(</span><span class="nf">parent</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span> <span class="k">New</span> <span class="k">With</span> <span class="p">{</span><span class="n">Key</span> <span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">parent</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">Key</span> <span class="p">.</span><span class="n">child</span> <span class="o">=</span> <span class="n">child</span><span class="p">}</span>
<span class="p">)</span>

<span class="k">For</span> <span class="k">Each</span> <span class="n">item</span> <span class="ow">In</span> <span class="n">query</span>
    <span class="nb">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">Name</span> <span class="o">&amp;</span> <span class="s">", "</span> <span class="o">&amp;</span> <span class="n">item</span><span class="p">.</span><span class="n">Child</span><span class="p">)</span>
<span class="k">Next</span>
</code></pre></div></div>

<p>結果は次のようになります。クエリ式と同じ結果ですね。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>Parent1, Child1
Parent1, Child2
Parent2, Child3
Parent2, Child4
</code></pre></div></div>

<p>親子関係があるわけではありませんが、最初の「alphabetsとnumbers」の例も、SelectManyに置き換えるとこうなります。<br>
最初のラムダ式で、alpを受け取って（alpとは無関係の）numbersを返す事で、結果的にループの入れ子のように処理されます。</p>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="k">Dim</span> <span class="nv">alphabets</span> <span class="o">=</span> <span class="p">{</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">}</span>
<span class="k">Dim</span> <span class="nv">numbers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>

<span class="k">Dim</span> <span class="nv">query</span> <span class="o">=</span> <span class="n">alphabets</span><span class="p">.</span><span class="n">SelectMany</span><span class="p">(</span>
    <span class="k">Function</span><span class="err">(</span><span class="nf">alp</span><span class="p">)</span> <span class="n">numbers</span><span class="p">,</span> 
    <span class="k">Function</span><span class="err">(</span><span class="nf">alp</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="k">New</span> <span class="k">With</span> <span class="p">{</span><span class="n">Key</span> <span class="p">.</span><span class="n">alp</span> <span class="o">=</span> <span class="n">alp</span><span class="p">,</span> <span class="n">Key</span> <span class="p">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">num</span><span class="p">}</span>
<span class="p">)</span>

<span class="k">For</span> <span class="k">Each</span> <span class="n">item</span> <span class="n">in</span> <span class="n">query</span>
    <span class="nb">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span> <span class="n">item</span><span class="p">.</span><span class="n">alp</span> <span class="o">&amp;</span> <span class="s">", "</span> <span class="o">&amp;</span> <span class="n">item</span><span class="p">.</span><span class="n">num</span> <span class="p">)</span>
<span class="k">Next</span>
</code></pre></div></div>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">結果</span></div>
<div class="highlight"><pre><code>a, 1
a, 2
a, 3
b, 1
b, 2
b, 3
</code></pre></div>
</div>

<h3>
<span id="クエリ式でテーブル結合を行う" class="fragment"></span><a href="#%E3%82%AF%E3%82%A8%E3%83%AA%E5%BC%8F%E3%81%A7%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E7%B5%90%E5%90%88%E3%82%92%E8%A1%8C%E3%81%86"><i class="fa fa-link"></i></a>クエリ式でテーブル結合を行う</h3>

<p>このあたりを理解していくと、クエリ式でテーブル結合を行うケースについても理解できてきます。</p>

<p>以下のように、社員Empと部署Deptがあり、EmpとDeptがdeptnoでつながっているとします。<br>
社員がどの部署に所属しているかを、deptnoで表しています。</p>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="k">Class</span> <span class="nc">Emp</span>
    <span class="k">Public</span> <span class="n">empno</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Public</span> <span class="n">deptno</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Public</span> <span class="n">empname</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">End</span> <span class="k">Class</span>

<span class="k">Class</span> <span class="nc">Dept</span>
    <span class="k">Public</span> <span class="n">deptno</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="k">Public</span> <span class="n">deptname</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">End</span> <span class="k">Class</span>

<span class="k">Dim</span> <span class="nv">employees</span> <span class="o">=</span> <span class="k">New</span> <span class="n">List</span><span class="p">(</span><span class="k">Of</span> <span class="n">Emp</span><span class="p">)</span> <span class="n">From</span> <span class="p">{</span>
    <span class="k">New</span> <span class="n">Emp</span> <span class="k">With</span> <span class="p">{</span> <span class="p">.</span><span class="n">empno</span> <span class="o">=</span> <span class="s">"1"</span><span class="p">,</span> <span class="p">.</span><span class="n">deptno</span> <span class="o">=</span> <span class="s">"1"</span><span class="p">,</span> <span class="p">.</span><span class="n">empname</span> <span class="o">=</span> <span class="s">"社員1"</span> <span class="p">},</span>
    <span class="k">New</span> <span class="n">Emp</span> <span class="k">With</span> <span class="p">{</span> <span class="p">.</span><span class="n">empno</span> <span class="o">=</span> <span class="s">"2"</span><span class="p">,</span> <span class="p">.</span><span class="n">deptno</span> <span class="o">=</span> <span class="s">"1"</span><span class="p">,</span> <span class="p">.</span><span class="n">empname</span> <span class="o">=</span> <span class="s">"社員2"</span> <span class="p">},</span>
    <span class="k">New</span> <span class="n">Emp</span> <span class="k">With</span> <span class="p">{</span> <span class="p">.</span><span class="n">empno</span> <span class="o">=</span> <span class="s">"3"</span><span class="p">,</span> <span class="p">.</span><span class="n">deptno</span> <span class="o">=</span> <span class="s">"2"</span><span class="p">,</span> <span class="p">.</span><span class="n">empname</span> <span class="o">=</span> <span class="s">"社員3"</span> <span class="p">},</span>
    <span class="k">New</span> <span class="n">Emp</span> <span class="k">With</span> <span class="p">{</span> <span class="p">.</span><span class="n">empno</span> <span class="o">=</span> <span class="s">"4"</span><span class="p">,</span> <span class="p">.</span><span class="n">deptno</span> <span class="o">=</span> <span class="s">"2"</span><span class="p">,</span> <span class="p">.</span><span class="n">empname</span> <span class="o">=</span> <span class="s">"社員4"</span> <span class="p">},</span>
    <span class="k">New</span> <span class="n">Emp</span> <span class="k">With</span> <span class="p">{</span> <span class="p">.</span><span class="n">empno</span> <span class="o">=</span> <span class="s">"5"</span><span class="p">,</span> <span class="p">.</span><span class="n">deptno</span> <span class="o">=</span> <span class="s">"3"</span><span class="p">,</span> <span class="p">.</span><span class="n">empname</span> <span class="o">=</span> <span class="s">"社員5"</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">Dim</span> <span class="nv">departments</span> <span class="o">=</span> <span class="k">New</span> <span class="n">List</span><span class="p">(</span><span class="k">Of</span> <span class="n">Dept</span><span class="p">)</span> <span class="n">From</span> <span class="p">{</span>
    <span class="k">New</span> <span class="n">Dept</span> <span class="k">With</span> <span class="p">{</span> <span class="p">.</span><span class="n">deptno</span> <span class="o">=</span> <span class="s">"1"</span><span class="p">,</span> <span class="p">.</span><span class="n">deptname</span> <span class="o">=</span> <span class="s">"部署1"</span> <span class="p">},</span>
    <span class="k">New</span> <span class="n">Dept</span> <span class="k">With</span> <span class="p">{</span> <span class="p">.</span><span class="n">deptno</span> <span class="o">=</span> <span class="s">"2"</span><span class="p">,</span> <span class="p">.</span><span class="n">deptname</span> <span class="o">=</span> <span class="s">"部署2"</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>この2つのデータを左結合して、「社員一覧に、その所属部署名を表示する」ということをします。</p>

<div class="code-frame" data-lang="vb">
<div class="code-lang"><span class="bold">ダメな例</span></div>
<div class="highlight"><pre><code><span class="k">Dim</span> <span class="nv">query</span> <span class="o">=</span> 
    <span class="n">From</span> <span class="n">emp</span> <span class="ow">In</span> <span class="n">employees</span>
    <span class="n">From</span> <span class="n">dept</span> <span class="ow">In</span> <span class="n">departments</span>
    <span class="k">Select</span> <span class="n">emp</span><span class="p">.</span><span class="n">empname</span><span class="p">,</span> <span class="n">dept</span><span class="p">.</span><span class="n">deptname</span>

<span class="k">For</span> <span class="k">Each</span> <span class="n">item</span> <span class="ow">In</span> <span class="n">query</span>
    <span class="nb">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span> <span class="n">item</span><span class="p">.</span><span class="n">empname</span> <span class="o">&amp;</span> <span class="s">", "</span> <span class="o">&amp;</span> <span class="n">item</span><span class="p">.</span><span class="n">deptname</span> <span class="p">)</span>
<span class="k">Next</span>
</code></pre></div>
</div>

<p>この例は動作はしますが、結果は「総当たり」となってしまいます。deptnoで紐づいてくれません。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>社員1, 部署1
社員1, 部署2
社員2, 部署1
社員2, 部署2
社員3, 部署1
社員3, 部署2
社員4, 部署1
社員4, 部署2
社員5, 部署1
社員5, 部署2
</code></pre></div></div>

<h2>
<span id="クエリ式で内部結合where句版" class="fragment"></span><a href="#%E3%82%AF%E3%82%A8%E3%83%AA%E5%BC%8F%E3%81%A7%E5%86%85%E9%83%A8%E7%B5%90%E5%90%88where%E5%8F%A5%E7%89%88"><i class="fa fa-link"></i></a>クエリ式で内部結合（Where句版）</h2>

<p>そこで、結合条件を追加します。</p>

<div class="code-frame" data-lang="vb">
<div class="code-lang"><span class="bold">joinを使わない内部結合（遅い）</span></div>
<div class="highlight"><pre><code><span class="k">Dim</span> <span class="nv">query</span> <span class="o">=</span> 
    <span class="n">From</span> <span class="n">emp</span> <span class="ow">In</span> <span class="n">employees</span>
    <span class="n">From</span> <span class="n">dept</span> <span class="ow">In</span> <span class="n">departments</span> 
    <span class="n">Where</span> <span class="n">dept</span><span class="p">.</span><span class="n">deptno</span> <span class="o">=</span> <span class="n">emp</span><span class="p">.</span><span class="n">deptno</span>
    <span class="k">Select</span> <span class="n">emp</span><span class="p">.</span><span class="n">empname</span><span class="p">,</span> <span class="n">dept</span><span class="p">.</span><span class="n">deptname</span>

<span class="k">For</span> <span class="k">Each</span> <span class="n">item</span> <span class="ow">In</span> <span class="n">query</span>
    <span class="nb">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span> <span class="n">item</span><span class="p">.</span><span class="n">empname</span> <span class="o">&amp;</span> <span class="s">", "</span> <span class="o">&amp;</span> <span class="n">item</span><span class="p">.</span><span class="n">deptname</span> <span class="p">)</span>
<span class="k">Next</span>
</code></pre></div>
</div>

<p>この例は正しく結合した結果を返しますが、実際にどのように処理されているのかを考えると、結局「総当たり処理」をしてから、deptnoが一致する結果だけを絞り込んでいるだけということが、今回の記事の結果からみて取れます。この程度の分量のデータなら問題はありませんが、何万件ものデータを処理するようなパターンだと大きな問題になります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>社員1, 部署1
社員2, 部署1
社員3, 部署2
社員4, 部署2
</code></pre></div></div>

<h2>
<span id="クエリ式で内部結合join句版" class="fragment"></span><a href="#%E3%82%AF%E3%82%A8%E3%83%AA%E5%BC%8F%E3%81%A7%E5%86%85%E9%83%A8%E7%B5%90%E5%90%88join%E5%8F%A5%E7%89%88"><i class="fa fa-link"></i></a>クエリ式で内部結合（Join句版）</h2>

<p>この問題を解決するのがJoin句です。<br>
左辺（この場合はemp）に対して右辺（この場合はdept）が1件以上存在する場合、自動的に絞り込みつつ対応付けてくれます。</p>

<div class="code-frame" data-lang="vb">
<div class="code-lang"><span class="bold">Join句を使う内部結合（速い）</span></div>
<div class="highlight"><pre><code><span class="k">Dim</span> <span class="nv">employees</span> <span class="o">=</span> <span class="n">GetEmpList</span><span class="p">()</span>
<span class="k">Dim</span> <span class="nv">departments</span> <span class="o">=</span> <span class="n">GetDeptList</span><span class="p">()</span>

<span class="k">Dim</span> <span class="nv">query</span> <span class="o">=</span> 
    <span class="n">From</span> <span class="n">emp</span> <span class="ow">In</span> <span class="n">employees</span>
    <span class="n">Join</span> <span class="n">dept</span> <span class="ow">In</span> <span class="n">departments</span> 
    <span class="k">On</span> <span class="n">dept</span><span class="p">.</span><span class="n">deptno</span> <span class="n">Equals</span> <span class="n">emp</span><span class="p">.</span><span class="n">deptno</span>
    <span class="k">Select</span> <span class="n">emp</span><span class="p">.</span><span class="n">empname</span><span class="p">,</span> <span class="n">dept</span><span class="p">.</span><span class="n">deptname</span>

<span class="k">For</span> <span class="k">Each</span> <span class="n">item</span> <span class="ow">In</span> <span class="n">query</span>
    <span class="nb">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span> <span class="n">item</span><span class="p">.</span><span class="n">empname</span> <span class="o">&amp;</span> <span class="s">", "</span> <span class="o">&amp;</span> <span class="n">item</span><span class="p">.</span><span class="n">deptname</span> <span class="p">)</span>
<span class="k">Next</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>社員1, 部署1
社員2, 部署1
社員3, 部署2
社員4, 部署2
</code></pre></div></div>

<h3>
<span id="group-join句による左外部結合" class="fragment"></span><a href="#group-join%E5%8F%A5%E3%81%AB%E3%82%88%E3%82%8B%E5%B7%A6%E5%A4%96%E9%83%A8%E7%B5%90%E5%90%88"><i class="fa fa-link"></i></a>Group Join句による左外部結合</h3>

<p>Join句はとても便利ですが、問題は、互いに一致するレコードがない場合、そのレコードは存在しないことになってしまう、つまりSQLでいうところの内部結合になってしまうことです。</p>

<p>今回の例でいうと、社員5のdeptno=3はdepartmensに存在しない為、そもそもリストアップされていません。</p>

<p>今回は左外部結合（SQLのLEFT OUTER JOIN）として、deptに対応するdeptnoがなかった場合には、deptnameは空文字で表示したいと思います。</p>

<p>左外部結合をクエリ式で実現する場合には、Group Join句を用います。Group Join句は左結合専用というわけではありませんが、左辺（ここではemp）1つに対して右辺（ここではdept）が「0件以上」紐づくケースで使用します。Join句は、1行1行を対応付けていくので、0件のものは存在しないことになりますが、Group Joinだと、結合されるものを集合として扱うので、0件なら0件として処理ができるのです。</p>

<p>そして、この特徴を利用して、左外部結合に利用することができます。</p>

<p>（C#ではjoin into句を使いますが、VB.NETのクエリ式ではGroup Join句になります。この辺最初、混乱したのでご注意ください。どうしてVBとC#でクエリ式の文法を変えてしまったんでしょうかね？）。</p>

<div class="code-frame" data-lang="vb">
<div class="code-lang"><span class="bold">Group-Joinで左外部結合</span></div>
<div class="highlight"><pre><code><span class="k">Dim</span> <span class="nv">query</span> <span class="o">=</span> 
    <span class="n">From</span> <span class="n">emp</span> <span class="ow">In</span> <span class="n">employees</span>
    <span class="n">Group</span> <span class="n">Join</span> <span class="n">dept</span> <span class="ow">In</span> <span class="n">departments</span>
        <span class="k">On</span> <span class="n">dept</span><span class="p">.</span><span class="n">deptno</span> <span class="n">Equals</span> <span class="n">emp</span><span class="p">.</span><span class="n">deptno</span>
        <span class="n">Into</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">Group</span>
    <span class="n">From</span> <span class="n">tmp2</span> <span class="ow">In</span> <span class="n">tmp</span><span class="p">.</span><span class="n">DefaultIfEmpty</span><span class="p">(</span><span class="k">New</span> <span class="n">Dept</span><span class="p">)</span>
    <span class="k">Select</span> <span class="n">emp</span><span class="p">.</span><span class="n">empname</span><span class="p">,</span> <span class="n">tmp2</span><span class="p">.</span><span class="n">deptname</span>
</code></pre></div>
</div>

<p>念のため、C#版ではこのようになります。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="kt">var</span> <span class="n">query</span> <span class="p">=</span>
    <span class="k">from</span> <span class="n">emp</span> <span class="k">in</span> <span class="n">employees</span>
    <span class="k">join</span> <span class="n">dept</span> <span class="k">in</span> <span class="n">departments</span>
        <span class="k">on</span> <span class="n">dept</span><span class="p">.</span><span class="n">deptno</span> <span class="k">equals</span> <span class="n">emp</span><span class="p">.</span><span class="n">deptno</span> 
        <span class="k">into</span> <span class="n">tmp</span>
    <span class="k">from</span> <span class="n">tmp2</span> <span class="k">in</span> <span class="n">tmp</span><span class="p">.</span><span class="nf">DefaultIfEmpty</span><span class="p">(</span><span class="k">new</span> <span class="nf">Dept</span><span class="p">())</span>
    <span class="k">select</span> <span class="k">new</span> <span class="p">{</span> <span class="n">emp</span><span class="p">.</span><span class="n">empname</span><span class="p">,</span> <span class="n">tmp2</span><span class="p">.</span><span class="n">deptname</span> <span class="p">}</span>

</code></pre></div></div>

<p>Group Join句を使う場合、結合条件には（Where句と違い）Equals句を用います。<br>
残念ながら、Equals以外の結合条件は使えません。複数ある場合はAndで結合します。<br>
もし、結合条件に「あるフィールドが100以上」等の、Equals以外の条件がある場合、先にdepartmentsをWhere句で絞り込んでおくと良いでしょう。</p>

<p>次に、Into句です。<br>
Group Joinの結合条件で絞り込まれたdepartmentsが、Into句で指定した変数に入ります。</p>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="n">Into</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">Group</span>
</code></pre></div></div>

<p>この「Group」はキーワードで、Enumerable(Of T)型です。ここではEnumerable(Of Dept)になります。<br>
例えば1件目のemp.deptno=1 に対するdepartmentsの絞り込み結果2件がGroupに入っています。<br>
それをtmpという変数に格納しています。</p>

<p>Into句には、Group、つまりEnumerable(Of Dept)型の値がGroupというキーワード変数で入力されてきます。<br>
ですので、次のようには書けません。</p>

<div class="code-frame" data-lang="vb">
<div class="code-lang"><span class="bold">これは書けない</span></div>
<div class="highlight"><pre><code><span class="n">Into</span> <span class="n">deptname</span> <span class="o">=</span> <span class="n">dept</span><span class="p">.</span><span class="n">deptname</span>
</code></pre></div>
</div>

<p>deptに直接アクセスすることはできません（もっというと、empにもアクセスできません）。<br>
Groupそのものか、Group（つまりdeptのリスト）に対する集合関数だけが、ここでは使用できます。</p>

<p>ですので、次のように書くことはできます。</p>

<div class="code-frame" data-lang="vb">
<div class="code-lang"><span class="bold">これは書ける（意味はないが）</span></div>
<div class="highlight"><pre><code><span class="n">Into</span> <span class="n">maxdeptno</span> <span class="o">=</span> <span class="n">Max</span><span class="p">(</span><span class="n">dept</span><span class="p">.</span><span class="n">deptno</span><span class="p">)</span>
</code></pre></div>
</div>

<p>これもOKです。</p>

<div class="code-frame" data-lang="vb">
<div class="code-lang"><span class="bold">これは書ける（意味はないが）</span></div>
<div class="highlight"><pre><code><span class="n">Into</span> <span class="n">maxdeptno</span> <span class="o">=</span> <span class="n">Max</span><span class="p">(</span><span class="n">emp</span><span class="p">.</span><span class="n">deptno</span><span class="p">)</span>
</code></pre></div>
</div>

<p>SQLでよく書く、Group By指定していない項目を引っ張ってくるやり方みたいな感じですね。</p>

<p>ちなみに、残念ながら規定では、文字列型変数に対してMax集合関数を適用することはできません（そのような型を受け入れるMaxは定義されていない、というエラーになります）。</p>

<div class="code-frame" data-lang="vb">
<div class="code-lang"><span class="bold">エラーになる</span></div>
<div class="highlight"><pre><code><span class="n">Into</span> <span class="n">deptname</span> <span class="o">=</span> <span class="n">Max</span><span class="p">(</span><span class="n">dept</span><span class="p">.</span><span class="n">deptname</span><span class="p">)</span>
</code></pre></div>
</div>

<p>ですが、もしそういうことがしたければ、Enumerable(Of Dept)の拡張メソッドとして、文字列を受け取って、最も評価値が大きい文字列を返すようなMax関数を作れば、上記もエラーにならなくなるでしょう（試していないのでわかりませんが、たぶん大丈夫です）。</p>

<p>ですので、通常は次のように、Groupそのものを一旦別の変数に格納し、そのGroupをFrom句を使ってまた個々の要素に分解します。</p>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="n">Into</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">Group</span>
<span class="n">From</span> <span class="n">tmp2</span> <span class="ow">In</span> <span class="n">tmp</span><span class="p">.</span><span class="n">DefaultIfEmpty</span><span class="p">(</span><span class="k">New</span> <span class="n">Dept</span><span class="p">)</span>
</code></pre></div></div>

<p>分かりますでしょうか？<br>
Group Joinの結果がtmp（型はEnumerable(Of Dept)）に入り、それをまたFromでtmp2（型はDept）に分解して処理しています。</p>

<p>ここで、tmpを直接Inに入れるのではなく、tmp.DefaultIfEmptyメソッドを介しているのが、今回の本題になります。</p>

<p>もしここが、次のようになっていたらどうでしょうか。</p>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="n">Into</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">Group</span>
<span class="n">From</span> <span class="n">tmp2</span> <span class="ow">In</span> <span class="n">tmp</span>
</code></pre></div></div>

<p>tmpが空のリストだった場合（つまり、emp.deptno=5の時のケースです）、tmp2は生成されず、結局それに対する最後のSelect句も実行されないことになります。</p>

<p>それではわざわざGroup Join句を使った意味がありません。そこで、「空だったら既定のEmpty値を返す」ようにして、処理自体は実行するのです。<br>
それがDefaultIfEmptyです。</p>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="n">DefaultIfEmpty</span><span class="p">(</span><span class="k">New</span> <span class="n">Dept</span><span class="p">)</span>
</code></pre></div></div>

<p>引数に入っている New Deptは、「空だった場合に、Empty値として使用したい値」です。これを指定しないと、そもそも要素自体がNothingで渡されてしまいます。</p>

<p>そして、最後のSelect句で、値を取り出します。</p>

<div class="code-frame" data-lang="vb">
<div class="code-lang"><span class="bold">再掲-Group-Join句で左外部結合</span></div>
<div class="highlight"><pre><code><span class="k">Dim</span> <span class="nv">query</span> <span class="o">=</span> 
    <span class="n">From</span> <span class="n">emp</span> <span class="ow">In</span> <span class="n">employees</span>
    <span class="n">Group</span> <span class="n">Join</span> <span class="n">dept</span> <span class="ow">In</span> <span class="n">departments</span>
        <span class="k">On</span> <span class="n">dept</span><span class="p">.</span><span class="n">deptno</span> <span class="n">Equals</span> <span class="n">emp</span><span class="p">.</span><span class="n">deptno</span>
        <span class="n">Into</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">Group</span>
    <span class="n">From</span> <span class="n">tmp2</span> <span class="ow">In</span> <span class="n">tmp</span><span class="p">.</span><span class="n">DefaultIfEmpty</span><span class="p">(</span><span class="k">New</span> <span class="n">Dept</span><span class="p">)</span>
    <span class="k">Select</span> <span class="n">emp</span><span class="p">.</span><span class="n">empname</span><span class="p">,</span> <span class="n">tmp2</span><span class="p">.</span><span class="n">deptname</span>
</code></pre></div>
</div>

<p>DefaultIfEmptyにNew Deptを渡さないと、ここのtmp2がNothingなので、tmp2.deptnameがNullReferenceExceptionで失敗します。<br>
逆に言うと、次のようにかけば問題ありません。</p>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="k">Dim</span> <span class="nv">query</span> <span class="o">=</span> 
    <span class="n">From</span> <span class="n">emp</span> <span class="ow">In</span> <span class="n">employees</span>
    <span class="n">Group</span> <span class="n">Join</span> <span class="n">dept</span> <span class="ow">In</span> <span class="n">departments</span>
        <span class="k">On</span> <span class="n">dept</span><span class="p">.</span><span class="n">deptno</span> <span class="n">Equals</span> <span class="n">emp</span><span class="p">.</span><span class="n">deptno</span>
        <span class="n">Into</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">Group</span>
    <span class="n">From</span> <span class="n">tmp2</span> <span class="ow">In</span> <span class="n">tmp</span><span class="p">.</span><span class="n">DefaultIfEmpty</span><span class="p">()</span>
    <span class="k">Select</span> <span class="n">emp</span><span class="p">.</span><span class="n">empname</span><span class="p">,</span> <span class="n">deptname</span> <span class="o">=</span> <span class="k">If</span><span class="p">(</span><span class="n">tmp2</span> <span class="ow">IsNot</span> <span class="k">Nothing</span><span class="p">,</span> <span class="n">tmp2</span><span class="p">.</span><span class="n">deptname</span><span class="p">,</span> <span class="kt">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">)</span>
</code></pre></div></div>

<p>尚、C#だとNull許容型演算子「??」が使えるので、このあたりはもっとシンプルに書けます。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="kt">var</span> <span class="n">query</span> <span class="p">=</span>
    <span class="k">from</span> <span class="n">emp</span> <span class="k">in</span> <span class="n">employees</span>
    <span class="k">join</span> <span class="n">dept</span> <span class="k">in</span> <span class="n">departments</span>
        <span class="k">on</span> <span class="n">dept</span><span class="p">.</span><span class="n">deptno</span> <span class="k">equals</span> <span class="n">emp</span><span class="p">.</span><span class="n">deptno</span> 
        <span class="k">into</span> <span class="n">tmp</span>
    <span class="k">from</span> <span class="n">tmp2</span> <span class="k">in</span> <span class="n">tmp</span><span class="p">.</span><span class="nf">DefaultIfEmpty</span><span class="p">()</span>
    <span class="k">select</span> <span class="k">new</span> <span class="p">{</span> <span class="n">emp</span><span class="p">.</span><span class="n">empname</span><span class="p">,</span> <span class="n">deptname</span> <span class="p">=</span> <span class="n">tmp2</span><span class="p">?.</span><span class="n">deptname</span> <span class="p">??</span> <span class="n">String</span><span class="p">.</span><span class="n">Empty</span> <span class="p">}</span>
</code></pre></div></div>

<p>VB.NETは進化が止まってしまったので、残念ですね…。</p>

<h3>
<span id="entityframeworkで左外部結合をする際の注意" class="fragment"></span><a href="#entityframework%E3%81%A7%E5%B7%A6%E5%A4%96%E9%83%A8%E7%B5%90%E5%90%88%E3%82%92%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AE%E6%B3%A8%E6%84%8F"><i class="fa fa-link"></i></a>EntityFrameworkで左外部結合をする際の注意</h3>

<p>尚、Group Join句のDefaultIfEmptyには、EntityFrameworkで使う際に1点、注意があります。</p>

<p>今回、employeesとdepartmentsはソースコード上で生成したメモリ上のオブジェクトですが、もしここでemployeesとdepartmentsがEntityFrameworkで定義しているエンティティオブジェクトだった場合、つまり、実際のテーブルと紐づいているものだった場合、クエリ式は内部でSQLを生成してDBに問い合わせを行おうとします。</p>

<p>すると、以下のクエリ式は、それを実際に評価しようとした時（ToListやToArray、又はCountの取得等）に、例外を発生させます。</p>

<div class="code-frame" data-lang="vb">
<div class="code-lang"><span class="bold">再掲-Group-Join句で左外部結合</span></div>
<div class="highlight"><pre><code><span class="k">Dim</span> <span class="nv">query</span> <span class="o">=</span> 
    <span class="n">From</span> <span class="n">emp</span> <span class="ow">In</span> <span class="n">employees</span>
    <span class="n">Group</span> <span class="n">Join</span> <span class="n">dept</span> <span class="ow">In</span> <span class="n">departments</span>
        <span class="k">On</span> <span class="n">dept</span><span class="p">.</span><span class="n">deptno</span> <span class="n">Equals</span> <span class="n">emp</span><span class="p">.</span><span class="n">deptno</span>
        <span class="n">Into</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">Group</span>
    <span class="n">From</span> <span class="n">tmp2</span> <span class="ow">In</span> <span class="n">tmp</span><span class="p">.</span><span class="n">DefaultIfEmpty</span><span class="p">(</span><span class="k">New</span> <span class="n">Dept</span><span class="p">)</span>
    <span class="k">Select</span> <span class="n">emp</span><span class="p">.</span><span class="n">empname</span><span class="p">,</span> <span class="n">tmp2</span><span class="p">.</span><span class="n">deptname</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>System.NotSupportedException: 'Unable to create a constant value of type 'Dept'. Only primitive types or enumeration types are supported in this context.'
「Dept型の定数値を生成することはできません。このコンテキストではプリミティブ型か列挙型のみがサポートされています。」
</code></pre></div></div>

<p>これは、クエリ式をSQLに変換しようとして、「SQL上で空のDeptを1行生成するってどういうこと？」となるからでしょう（多分）。<br>
EmpやDeptがエンティティオブジェクトだった場合には、次のように、引数無しのDefaultIfEmptyが、「空の行」を自動的に生成してくれます。</p>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="k">Dim</span> <span class="nv">query</span> <span class="o">=</span> 
    <span class="n">From</span> <span class="n">emp</span> <span class="ow">In</span> <span class="n">employees</span>
    <span class="n">Group</span> <span class="n">Join</span> <span class="n">dept</span> <span class="ow">In</span> <span class="n">departments</span>
        <span class="k">On</span> <span class="n">dept</span><span class="p">.</span><span class="n">deptno</span> <span class="n">Equals</span> <span class="n">emp</span><span class="p">.</span><span class="n">deptno</span>
        <span class="n">Into</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">Group</span>
    <span class="n">From</span> <span class="n">tmp2</span> <span class="ow">In</span> <span class="n">tmp</span><span class="p">.</span><span class="n">DefaultIfEmpty</span><span class="p">()</span>
    <span class="k">Select</span> <span class="n">emp</span><span class="p">.</span><span class="n">empname</span><span class="p">,</span> <span class="n">deptname</span> <span class="o">=</span> <span class="k">If</span><span class="p">(</span><span class="k">Not</span> <span class="kt">String</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">tmp2</span><span class="p">.</span><span class="n">deptname</span><span class="p">),</span> <span class="n">tmp2</span><span class="p">.</span><span class="n">deptname</span><span class="p">,</span> <span class="kt">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">)</span>
</code></pre></div></div>

<p>ここで、tmp2はNothingではなく、インスタンスを持っています。しかしそのプロパティは全て、規定値となっています。<br>
文字列型であればNothing(Null)が規定値ですので、tmp2.deptnameはNothing(Null)になって渡されます。</p>

<p>ですので、対応するDeptがない場合にdeptnameを空文字にしたい場合は、ちゃんと変換しなければなりません。</p>

<p>ちなみに、次のように、tmpからdeptnameだけを取り出した結果にDefaultIfEmptyをかければ、それはもうEnumerable(Of Dept)ではなくEnumerable(Of String)ですから、引数で空文字を指定することができます（エラーメッセージの「プリミティブ型か列挙型のみがサポートされています」というのは、そういうことだと思います）。</p>

<div class="code-frame" data-lang="vb"><div class="highlight"><pre><code><span class="k">Dim</span> <span class="nv">query</span> <span class="o">=</span> 
    <span class="n">From</span> <span class="n">emp</span> <span class="ow">In</span> <span class="n">employees</span>
    <span class="n">Group</span> <span class="n">Join</span> <span class="n">dept</span> <span class="ow">In</span> <span class="n">departments</span>
        <span class="k">On</span> <span class="n">dept</span><span class="p">.</span><span class="n">deptno</span> <span class="n">Equals</span> <span class="n">emp</span><span class="p">.</span><span class="n">deptno</span>
        <span class="n">Into</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">Group</span>
    <span class="n">From</span> <span class="n">deptname</span> <span class="ow">In</span> <span class="p">(</span><span class="n">From</span> <span class="n">tmp2</span> <span class="ow">In</span> <span class="n">tmp</span> <span class="k">Select</span> <span class="n">tmp2</span><span class="p">.</span><span class="n">deptname</span><span class="p">).</span><span class="n">DefaultIfEmpty</span><span class="p">(</span><span class="kt">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">)</span>
    <span class="k">Select</span> <span class="n">emp</span><span class="p">.</span><span class="n">empname</span><span class="p">,</span> <span class="n">deptname</span> <span class="o">=</span> <span class="n">deptname</span>
</code></pre></div></div>

<p>なんだかんだでまだちょっと、LINQでSQLみたいなことをやろうとするとなかなか直感的にはいきませんが、とりあえずはできますよ、ということにて。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fjun1s%2Fitems%2Fa438d09f037d999434ab&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fjun1s%2Fitems%2Fa438d09f037d999434ab&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/jun1s/items/a438d09f037d999434ab/likers" class="css-1iupg5d">0</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">1</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/a438d09f037d999434ab/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/jun1s/items/a438d09f037d999434ab/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/jun1s/items/a438d09f037d999434ab/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/jun1s/items/a438d09f037d999434ab/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/jun1s/items/a438d09f037d999434ab.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-37e683fb-3977-4d4a-8c87-5aa554f24e89">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-c5b6fbf9-3069-4d99-bdea-63a062ffc6ea"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-c5b6fbf9-3069-4d99-bdea-63a062ffc6ea">{}</script>
      
<div id="LoginModal-react-component-a4ad3078-84db-48a4-92f7-8440dc087dac"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-a4ad3078-84db-48a4-92f7-8440dc087dac">{}</script>
      
<div id="StockModal-react-component-716f701a-7472-401d-81a1-90dc6c0d51f5"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-716f701a-7472-401d-81a1-90dc6c0d51f5">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;Io2gi+VBRSjrIzPG6ADLotOFqHjNkB2ujTo4r/MIt4W4XeyhcJo1myVmV1OfDT3Q+5u7hiHF0QQDAKveNPu7AA==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003eLINQのクエリ式に複数のfrom句がある場合、どのように処理されるのかを考えてみました。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"linqのクエリ式に複数のfrom句がある場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#linq%E3%81%AE%E3%82%AF%E3%82%A8%E3%83%AA%E5%BC%8F%E3%81%AB%E8%A4%87%E6%95%B0%E3%81%AEfrom%E5%8F%A5%E3%81%8C%E3%81%82%E3%82%8B%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLINQのクエリ式に複数のfrom句がある場合\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003ealphabets\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003enumbers\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \n    \u003cspan class=\"n\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003ealp\u003c/span\u003e \u003cspan class=\"n\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ealphabets\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"n\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003enumbers\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eselect\u003c/span\u003e \u003cspan class=\"n\"\u003ealp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"k\"\u003eEach\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"n\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ealp\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこんなふうに、2つのリスト（実際はテーブルのレコードになると思いますが）があった時に、それらをfrom句でそのまんま繋ぐと、以下のようにalphabetsとnumbersの総当たり結果が出力されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ea, 1\na, 2\na, 3\nb, 1\nb, 2\nb, 3\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれはSQLで次のように書いた時と同じです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"sql\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ealphabets\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enumbers\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e内部的には次のようにFor Eachループの入れ子処理がされている、という説明を読んだことがあります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003ealphabets\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003enumbers\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003ealp\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003ealphabets\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003enumbers\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSelect\u003c/span\u003e \u003cspan class=\"n\"\u003ealp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"k\"\u003eEach\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ealp\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003elist\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToList\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"k\"\u003eEach\u003c/span\u003e \u003cspan class=\"n\"\u003ealp\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003ealphabets\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"k\"\u003eEach\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003enumbers\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eKey\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ealp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ealp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eKey\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n\u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"k\"\u003eEach\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ealp\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eつまり、alphabetsとnumbersが入れ子のループになっている、という事のようです。\u003cbr\u003e\n確かに結果は同じく、以下のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ea, 1\na, 2\na, 3\nb, 1\nb, 2\nb, 3\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"親子構造を持つデータで複数のfrom句\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A6%AA%E5%AD%90%E6%A7%8B%E9%80%A0%E3%82%92%E6%8C%81%E3%81%A4%E3%83%87%E3%83%BC%E3%82%BF%E3%81%A7%E8%A4%87%E6%95%B0%E3%81%AEfrom%E5%8F%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e親子構造を持つデータで複数のfrom句\u003c/h3\u003e\n\n\u003cp\u003eそれでは、次のような、親子構造を持つデータを扱う場合には、どのように考えればよいのでしょうか。\u003cbr\u003e\nParentクラスは、Childrenという文字列のリストを持っています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eClass\u003c/span\u003e \u003cspan class=\"nc\"\u003eParent\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ePublic\u003c/span\u003e \u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ePublic\u003c/span\u003e \u003cspan class=\"n\"\u003eChildren\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eOf\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eClass\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのデータについて、parentとchildの二つのfrom句を指定してみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003eparents\u003c/span\u003e \u003cspan class=\"n\"\u003eas\u003c/span\u003e \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eOf\u003c/span\u003e \u003cspan class=\"n\"\u003eParent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eParent\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Parent1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eChildren\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eOf\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Child1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Child2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eParent\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Parent2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eChildren\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eOf\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Child3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Child4\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003eparents\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003echild\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eChildren\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSelect\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003echild\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"k\"\u003eEach\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eChild\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e結果は以下のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eParent1, Child1\nParent1, Child2\nParent2, Child3\nParent2, Child4\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんとなく、こうなったりしないのかなと思ったのが、ならないようです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"こうはならない\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eParent1, Child1\nParent1, Child2\nParent1, Child3\nParent1, Child4\nParent2, Child1\nParent2, Child2\nParent2, Child3\nParent2, Child4\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eしかしこれも、For Eachループの入れ子と考えれば、当然の結果です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"k\"\u003eEach\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003eparents\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"k\"\u003eEach\u003c/span\u003e \u003cspan class=\"n\"\u003echild\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eChildren\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eKey\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eKey\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echild\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echild\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n\u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"複数のfrom句はselectmanyとしても捉えられる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AEfrom%E5%8F%A5%E3%81%AFselectmany%E3%81%A8%E3%81%97%E3%81%A6%E3%82%82%E6%8D%89%E3%81%88%E3%82%89%E3%82%8C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e複数のFrom句はSelectManyとしても捉えられる\u003c/h3\u003e\n\n\u003cp\u003eただ、どうも、「For Eachループの入れ子」という考え方が、Linqをメソッドチェーンとして捉えようとした時に相性が悪く、「結局今、リストの状態はどうなっているのか？」というのがいまいちピンと来ません。\u003c/p\u003e\n\n\u003cp\u003e色々と探っていると、複数のfrom句は、SelectManyとして実装されているという話を見つけました（本当かどうか知りませんが）。\u003cbr\u003e\nSelectManyとは、基本的には、リストの各要素1つから複数のリスト構造が出力されるような場合に、各要素からのリストを1つのリストにまとめて出力するというものです。\u003c/p\u003e\n\n\u003cp\u003eいくつかの使い方がありますが、そのうちの一つは、階層構造を持つデータに対して、「親から子のリストを取得するラムダ式」と、「その結果得られる子のリストのそれぞれの各要素と、その親を両方受け取って何らかのデータを返すラムダ式」を与えて、後者のラムダ式の結果のリストの合成結果を生成するメソッドになります。\u003c/p\u003e\n\n\u003cp\u003e具体的には次のように使います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003eparents\u003c/span\u003e \u003cspan class=\"n\"\u003eas\u003c/span\u003e \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eOf\u003c/span\u003e \u003cspan class=\"n\"\u003eParent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eParent\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Parent1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eChildren\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eOf\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Child1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Child2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eParent\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Parent2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eChildren\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eOf\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Child3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Child4\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eparents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSelectMany\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eFunction\u003c/span\u003e\u003cspan class=\"err\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eChildren\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n    \u003cspan class=\"k\"\u003eFunction\u003c/span\u003e\u003cspan class=\"err\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003echild\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eKey\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eKey\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echild\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echild\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"k\"\u003eEach\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eChild\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e結果は次のようになります。クエリ式と同じ結果ですね。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eParent1, Child1\nParent1, Child2\nParent2, Child3\nParent2, Child4\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e親子関係があるわけではありませんが、最初の「alphabetsとnumbers」の例も、SelectManyに置き換えるとこうなります。\u003cbr\u003e\n最初のラムダ式で、alpを受け取って（alpとは無関係の）numbersを返す事で、結果的にループの入れ子のように処理されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003ealphabets\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003enumbers\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ealphabets\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSelectMany\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eFunction\u003c/span\u003e\u003cspan class=\"err\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003ealp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003enumbers\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n    \u003cspan class=\"k\"\u003eFunction\u003c/span\u003e\u003cspan class=\"err\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003ealp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eKey\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ealp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ealp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eKey\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"k\"\u003eEach\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"n\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ealp\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e結果\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ea, 1\na, 2\na, 3\nb, 1\nb, 2\nb, 3\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"クエリ式でテーブル結合を行う\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AF%E3%82%A8%E3%83%AA%E5%BC%8F%E3%81%A7%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E7%B5%90%E5%90%88%E3%82%92%E8%A1%8C%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eクエリ式でテーブル結合を行う\u003c/h3\u003e\n\n\u003cp\u003eこのあたりを理解していくと、クエリ式でテーブル結合を行うケースについても理解できてきます。\u003c/p\u003e\n\n\u003cp\u003e以下のように、社員Empと部署Deptがあり、EmpとDeptがdeptnoでつながっているとします。\u003cbr\u003e\n社員がどの部署に所属しているかを、deptnoで表しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eClass\u003c/span\u003e \u003cspan class=\"nc\"\u003eEmp\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ePublic\u003c/span\u003e \u003cspan class=\"n\"\u003eempno\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eInteger\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ePublic\u003c/span\u003e \u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eInteger\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ePublic\u003c/span\u003e \u003cspan class=\"n\"\u003eempname\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eClass\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eClass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDept\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ePublic\u003c/span\u003e \u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eInteger\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ePublic\u003c/span\u003e \u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eClass\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003eemployees\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eOf\u003c/span\u003e \u003cspan class=\"n\"\u003eEmp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eEmp\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"社員1\"\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eEmp\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"社員2\"\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eEmp\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"社員3\"\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eEmp\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"4\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"社員4\"\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eEmp\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"5\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"社員5\"\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003edepartments\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eOf\u003c/span\u003e \u003cspan class=\"n\"\u003eDept\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eDept\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"部署1\"\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eDept\u003c/span\u003e \u003cspan class=\"k\"\u003eWith\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"部署2\"\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの2つのデータを左結合して、「社員一覧に、その所属部署名を表示する」ということをします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eダメな例\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003eemployees\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003edepartments\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSelect\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"k\"\u003eEach\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの例は動作はしますが、結果は「総当たり」となってしまいます。deptnoで紐づいてくれません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e社員1, 部署1\n社員1, 部署2\n社員2, 部署1\n社員2, 部署2\n社員3, 部署1\n社員3, 部署2\n社員4, 部署1\n社員4, 部署2\n社員5, 部署1\n社員5, 部署2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"クエリ式で内部結合where句版\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AF%E3%82%A8%E3%83%AA%E5%BC%8F%E3%81%A7%E5%86%85%E9%83%A8%E7%B5%90%E5%90%88where%E5%8F%A5%E7%89%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eクエリ式で内部結合（Where句版）\u003c/h2\u003e\n\n\u003cp\u003eそこで、結合条件を追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ejoinを使わない内部結合（遅い）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003eemployees\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003edepartments\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eWhere\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSelect\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"k\"\u003eEach\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの例は正しく結合した結果を返しますが、実際にどのように処理されているのかを考えると、結局「総当たり処理」をしてから、deptnoが一致する結果だけを絞り込んでいるだけということが、今回の記事の結果からみて取れます。この程度の分量のデータなら問題はありませんが、何万件ものデータを処理するようなパターンだと大きな問題になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e社員1, 部署1\n社員2, 部署1\n社員3, 部署2\n社員4, 部署2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"クエリ式で内部結合join句版\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AF%E3%82%A8%E3%83%AA%E5%BC%8F%E3%81%A7%E5%86%85%E9%83%A8%E7%B5%90%E5%90%88join%E5%8F%A5%E7%89%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eクエリ式で内部結合（Join句版）\u003c/h2\u003e\n\n\u003cp\u003eこの問題を解決するのがJoin句です。\u003cbr\u003e\n左辺（この場合はemp）に対して右辺（この場合はdept）が1件以上存在する場合、自動的に絞り込みつつ対応付けてくれます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eJoin句を使う内部結合（速い）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003eemployees\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetEmpList\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003edepartments\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetDeptList\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003eemployees\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eJoin\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003edepartments\u003c/span\u003e \n    \u003cspan class=\"k\"\u003eOn\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"n\"\u003eEquals\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSelect\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"k\"\u003eEach\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e社員1, 部署1\n社員2, 部署1\n社員3, 部署2\n社員4, 部署2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"group-join句による左外部結合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#group-join%E5%8F%A5%E3%81%AB%E3%82%88%E3%82%8B%E5%B7%A6%E5%A4%96%E9%83%A8%E7%B5%90%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGroup Join句による左外部結合\u003c/h3\u003e\n\n\u003cp\u003eJoin句はとても便利ですが、問題は、互いに一致するレコードがない場合、そのレコードは存在しないことになってしまう、つまりSQLでいうところの内部結合になってしまうことです。\u003c/p\u003e\n\n\u003cp\u003e今回の例でいうと、社員5のdeptno=3はdepartmensに存在しない為、そもそもリストアップされていません。\u003c/p\u003e\n\n\u003cp\u003e今回は左外部結合（SQLのLEFT OUTER JOIN）として、deptに対応するdeptnoがなかった場合には、deptnameは空文字で表示したいと思います。\u003c/p\u003e\n\n\u003cp\u003e左外部結合をクエリ式で実現する場合には、Group Join句を用います。Group Join句は左結合専用というわけではありませんが、左辺（ここではemp）1つに対して右辺（ここではdept）が「0件以上」紐づくケースで使用します。Join句は、1行1行を対応付けていくので、0件のものは存在しないことになりますが、Group Joinだと、結合されるものを集合として扱うので、0件なら0件として処理ができるのです。\u003c/p\u003e\n\n\u003cp\u003eそして、この特徴を利用して、左外部結合に利用することができます。\u003c/p\u003e\n\n\u003cp\u003e（C#ではjoin into句を使いますが、VB.NETのクエリ式ではGroup Join句になります。この辺最初、混乱したのでご注意ください。どうしてVBとC#でクエリ式の文法を変えてしまったんでしょうかね？）。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eGroup-Joinで左外部結合\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003eemployees\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e \u003cspan class=\"n\"\u003eJoin\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003edepartments\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eOn\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"n\"\u003eEquals\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eInto\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultIfEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eDept\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSelect\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e念のため、C#版ではこのようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eemployees\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ejoin\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003edepartments\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eon\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"k\"\u003eequals\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \n        \u003cspan class=\"k\"\u003einto\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefaultIfEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDept\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eGroup Join句を使う場合、結合条件には（Where句と違い）Equals句を用います。\u003cbr\u003e\n残念ながら、Equals以外の結合条件は使えません。複数ある場合はAndで結合します。\u003cbr\u003e\nもし、結合条件に「あるフィールドが100以上」等の、Equals以外の条件がある場合、先にdepartmentsをWhere句で絞り込んでおくと良いでしょう。\u003c/p\u003e\n\n\u003cp\u003e次に、Into句です。\u003cbr\u003e\nGroup Joinの結合条件で絞り込まれたdepartmentsが、Into句で指定した変数に入ります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eInto\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの「Group」はキーワードで、Enumerable(Of T)型です。ここではEnumerable(Of Dept)になります。\u003cbr\u003e\n例えば1件目のemp.deptno=1 に対するdepartmentsの絞り込み結果2件がGroupに入っています。\u003cbr\u003e\nそれをtmpという変数に格納しています。\u003c/p\u003e\n\n\u003cp\u003eInto句には、Group、つまりEnumerable(Of Dept)型の値がGroupというキーワード変数で入力されてきます。\u003cbr\u003e\nですので、次のようには書けません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eこれは書けない\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eInto\u003c/span\u003e \u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003edeptに直接アクセスすることはできません（もっというと、empにもアクセスできません）。\u003cbr\u003e\nGroupそのものか、Group（つまりdeptのリスト）に対する集合関数だけが、ここでは使用できます。\u003c/p\u003e\n\n\u003cp\u003eですので、次のように書くことはできます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eこれは書ける（意味はないが）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eInto\u003c/span\u003e \u003cspan class=\"n\"\u003emaxdeptno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMax\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれもOKです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eこれは書ける（意味はないが）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eInto\u003c/span\u003e \u003cspan class=\"n\"\u003emaxdeptno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMax\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eSQLでよく書く、Group By指定していない項目を引っ張ってくるやり方みたいな感じですね。\u003c/p\u003e\n\n\u003cp\u003eちなみに、残念ながら規定では、文字列型変数に対してMax集合関数を適用することはできません（そのような型を受け入れるMaxは定義されていない、というエラーになります）。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eエラーになる\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eInto\u003c/span\u003e \u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMax\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eですが、もしそういうことがしたければ、Enumerable(Of Dept)の拡張メソッドとして、文字列を受け取って、最も評価値が大きい文字列を返すようなMax関数を作れば、上記もエラーにならなくなるでしょう（試していないのでわかりませんが、たぶん大丈夫です）。\u003c/p\u003e\n\n\u003cp\u003eですので、通常は次のように、Groupそのものを一旦別の変数に格納し、そのGroupをFrom句を使ってまた個々の要素に分解します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eInto\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e\n\u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultIfEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eDept\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e分かりますでしょうか？\u003cbr\u003e\nGroup Joinの結果がtmp（型はEnumerable(Of Dept)）に入り、それをまたFromでtmp2（型はDept）に分解して処理しています。\u003c/p\u003e\n\n\u003cp\u003eここで、tmpを直接Inに入れるのではなく、tmp.DefaultIfEmptyメソッドを介しているのが、今回の本題になります。\u003c/p\u003e\n\n\u003cp\u003eもしここが、次のようになっていたらどうでしょうか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eInto\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e\n\u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003etmpが空のリストだった場合（つまり、emp.deptno=5の時のケースです）、tmp2は生成されず、結局それに対する最後のSelect句も実行されないことになります。\u003c/p\u003e\n\n\u003cp\u003eそれではわざわざGroup Join句を使った意味がありません。そこで、「空だったら既定のEmpty値を返す」ようにして、処理自体は実行するのです。\u003cbr\u003e\nそれがDefaultIfEmptyです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eDefaultIfEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eDept\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e引数に入っている New Deptは、「空だった場合に、Empty値として使用したい値」です。これを指定しないと、そもそも要素自体がNothingで渡されてしまいます。\u003c/p\u003e\n\n\u003cp\u003eそして、最後のSelect句で、値を取り出します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e再掲-Group-Join句で左外部結合\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003eemployees\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e \u003cspan class=\"n\"\u003eJoin\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003edepartments\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eOn\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"n\"\u003eEquals\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eInto\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultIfEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eDept\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSelect\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eDefaultIfEmptyにNew Deptを渡さないと、ここのtmp2がNothingなので、tmp2.deptnameがNullReferenceExceptionで失敗します。\u003cbr\u003e\n逆に言うと、次のようにかけば問題ありません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003eemployees\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e \u003cspan class=\"n\"\u003eJoin\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003edepartments\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eOn\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"n\"\u003eEquals\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eInto\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultIfEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSelect\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eIf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etmp2\u003c/span\u003e \u003cspan class=\"ow\"\u003eIsNot\u003c/span\u003e \u003cspan class=\"k\"\u003eNothing\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e尚、C#だとNull許容型演算子「??」が使えるので、このあたりはもっとシンプルに書けます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eemployees\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ejoin\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003edepartments\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eon\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"k\"\u003eequals\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \n        \u003cspan class=\"k\"\u003einto\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefaultIfEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"p\"\u003e??\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eVB.NETは進化が止まってしまったので、残念ですね…。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"entityframeworkで左外部結合をする際の注意\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#entityframework%E3%81%A7%E5%B7%A6%E5%A4%96%E9%83%A8%E7%B5%90%E5%90%88%E3%82%92%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AE%E6%B3%A8%E6%84%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEntityFrameworkで左外部結合をする際の注意\u003c/h3\u003e\n\n\u003cp\u003e尚、Group Join句のDefaultIfEmptyには、EntityFrameworkで使う際に1点、注意があります。\u003c/p\u003e\n\n\u003cp\u003e今回、employeesとdepartmentsはソースコード上で生成したメモリ上のオブジェクトですが、もしここでemployeesとdepartmentsがEntityFrameworkで定義しているエンティティオブジェクトだった場合、つまり、実際のテーブルと紐づいているものだった場合、クエリ式は内部でSQLを生成してDBに問い合わせを行おうとします。\u003c/p\u003e\n\n\u003cp\u003eすると、以下のクエリ式は、それを実際に評価しようとした時（ToListやToArray、又はCountの取得等）に、例外を発生させます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e再掲-Group-Join句で左外部結合\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003eemployees\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e \u003cspan class=\"n\"\u003eJoin\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003edepartments\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eOn\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"n\"\u003eEquals\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eInto\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultIfEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eDept\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSelect\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eSystem.NotSupportedException: 'Unable to create a constant value of type 'Dept'. Only primitive types or enumeration types are supported in this context.'\n「Dept型の定数値を生成することはできません。このコンテキストではプリミティブ型か列挙型のみがサポートされています。」\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれは、クエリ式をSQLに変換しようとして、「SQL上で空のDeptを1行生成するってどういうこと？」となるからでしょう（多分）。\u003cbr\u003e\nEmpやDeptがエンティティオブジェクトだった場合には、次のように、引数無しのDefaultIfEmptyが、「空の行」を自動的に生成してくれます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003eemployees\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e \u003cspan class=\"n\"\u003eJoin\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003edepartments\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eOn\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"n\"\u003eEquals\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eInto\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultIfEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSelect\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eIf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eNot\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsNullOrEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etmp2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eここで、tmp2はNothingではなく、インスタンスを持っています。しかしそのプロパティは全て、規定値となっています。\u003cbr\u003e\n文字列型であればNothing(Null)が規定値ですので、tmp2.deptnameはNothing(Null)になって渡されます。\u003c/p\u003e\n\n\u003cp\u003eですので、対応するDeptがない場合にdeptnameを空文字にしたい場合は、ちゃんと変換しなければなりません。\u003c/p\u003e\n\n\u003cp\u003eちなみに、次のように、tmpからdeptnameだけを取り出した結果にDefaultIfEmptyをかければ、それはもうEnumerable(Of Dept)ではなくEnumerable(Of String)ですから、引数で空文字を指定することができます（エラーメッセージの「プリミティブ型か列挙型のみがサポートされています」というのは、そういうことだと思います）。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003eemployees\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e \u003cspan class=\"n\"\u003eJoin\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003edepartments\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eOn\u003c/span\u003e \u003cspan class=\"n\"\u003edept\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e \u003cspan class=\"n\"\u003eEquals\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptno\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eInto\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFrom\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e \u003cspan class=\"ow\"\u003eIn\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e \u003cspan class=\"k\"\u003eSelect\u003c/span\u003e \u003cspan class=\"n\"\u003etmp2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeptname\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultIfEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSelect\u003c/span\u003e \u003cspan class=\"n\"\u003eemp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeptname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edeptname\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんだかんだでまだちょっと、LINQでSQLみたいなことをやろうとするとなかなか直感的にはいきませんが、とりあえずはできますよ、ということにて。\u003c/p\u003e\n","createdAt":"2021-06-17T03:27:45Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"jLo3dSOMqlH/WRcawnibIHGxQbY6LvIzSQ==--WT4wZOGhSR2XEQbi--fvVcX9asYp7QZnpaaXyiCQ==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2021-08-11T05:19:13Z","likesCount":0,"linkUrl":"https://qiita.com/jun1s/items/a438d09f037d999434ab","organization":null,"originalId":1450075,"stockedCount":1,"title":"[VB.NET]LINQのクエリ式の複数のFrom句、及び左外部結合はどのように処理されるのか？","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#linq%E3%81%AE%E3%82%AF%E3%82%A8%E3%83%AA%E5%BC%8F%E3%81%AB%E8%A4%87%E6%95%B0%E3%81%AEfrom%E5%8F%A5%E3%81%8C%E3%81%82%E3%82%8B%E5%A0%B4%E5%90%88\"\u003eLINQのクエリ式に複数のfrom句がある場合\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A6%AA%E5%AD%90%E6%A7%8B%E9%80%A0%E3%82%92%E6%8C%81%E3%81%A4%E3%83%87%E3%83%BC%E3%82%BF%E3%81%A7%E8%A4%87%E6%95%B0%E3%81%AEfrom%E5%8F%A5\"\u003e親子構造を持つデータで複数のfrom句\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AEfrom%E5%8F%A5%E3%81%AFselectmany%E3%81%A8%E3%81%97%E3%81%A6%E3%82%82%E6%8D%89%E3%81%88%E3%82%89%E3%82%8C%E3%82%8B\"\u003e複数のFrom句はSelectManyとしても捉えられる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AF%E3%82%A8%E3%83%AA%E5%BC%8F%E3%81%A7%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E7%B5%90%E5%90%88%E3%82%92%E8%A1%8C%E3%81%86\"\u003eクエリ式でテーブル結合を行う\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AF%E3%82%A8%E3%83%AA%E5%BC%8F%E3%81%A7%E5%86%85%E9%83%A8%E7%B5%90%E5%90%88where%E5%8F%A5%E7%89%88\"\u003eクエリ式で内部結合（Where句版）\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AF%E3%82%A8%E3%83%AA%E5%BC%8F%E3%81%A7%E5%86%85%E9%83%A8%E7%B5%90%E5%90%88join%E5%8F%A5%E7%89%88\"\u003eクエリ式で内部結合（Join句版）\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#group-join%E5%8F%A5%E3%81%AB%E3%82%88%E3%82%8B%E5%B7%A6%E5%A4%96%E9%83%A8%E7%B5%90%E5%90%88\"\u003eGroup Join句による左外部結合\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#entityframework%E3%81%A7%E5%B7%A6%E5%A4%96%E9%83%A8%E7%B5%90%E5%90%88%E3%82%92%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AE%E6%B3%A8%E6%84%8F\"\u003eEntityFrameworkで左外部結合をする際の注意\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":593,"uuid":"a438d09f037d999434ab","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"SBhTVnQ4mR4jIaOirqQt83g8yw6+--E+F3Qmv4QmrIRBGJ--z8jap7TjiLo3lLnBEWEnKg==","originalId":207038,"description":"福井県越前市在住のプログラマーです。\r\n主にマイクロソフト系の技術者であり、javascript系のweb技術もフォローしています。\r\nVB.NET、C#、ASP.NET MVC(.NET Framework 又は.NET 5)の新規開発、古いVB資産の最新システムへのリプレース案件等を得意としています。\r\nお仕事の依頼や開発チームへの参加要請がありましたらお気軽にご連絡下さい。","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"Jun-ichi Shinde","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/207038/profile-images/1626694207","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F207038%2Fprofile-images%2F1626694207?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=9079c756835185fa905352e904e5890a","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F207038%2Fprofile-images%2F1626694207?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=d32024917eddb4431b54a590dd0309cd","urlName":"jun1s","websiteUrl":"","twitterUrl":"https://twitter.com/jun1s","twitterUrlName":"jun1s","revealedOrganizations":{"edges":[]}},"tags":[{"name":"VB.Net","urlName":"vb.net"},{"name":"C#","urlName":"csharp"},{"name":"LINQ","urlName":"linq"},{"name":"クエリ式","urlName":"%e3%82%af%e3%82%a8%e3%83%aa%e5%bc%8f"}],"followingLikers":{"edges":[]},"comments":{"totalCount":4}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

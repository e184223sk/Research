More than 3 years have passed since last update.この記事はテラリアというゲームでのMod開発に関する情報です。
サンプルコードや、公開されているコードを参考にMod開発をしている状況で、備忘録としてのまとめでもあり、記事投稿時点での知識で書いていますので、間違いもあるかもしれませんのでご注意ください。指定したブロックや壁紙を破壊しないようにするModを作成したい。
そのためには、TileオブジェクトからドロップするItemオブジェクトの情報が欲しい。テラリアでは、ブロックなどを破壊した際にそのアイテムがドロップするが、ブロックなどを管理するオブジェクトはTileオブジェクトであり、そこには破壊した際にドロップするItemオブジェクトの情報は紐付いていない。
では、Tileを破壊した際にどのようにしてドロップしているかと言うと、Terraria.WorldGenクラスに、KillTileメソッドがある。
Tile破壊時にはこれが呼ばれるようで、途中の判定でTileの破壊が失敗しなかった場合で、Itemがドロップする場合に、次のような感じで個別に設定されている。※ソースコードはtModLoaderにてTerraria.exeを逆コンパイルして作成されたものこの中から、ブロック系のみを対象にして、どのtile.typeが、どのitem.typeをドロップするかを抜き出したいが、いかんせんわかりづらい。
また、今後の事も考えて、tile-&gt;item を取得するようなメソッドを作っておきたい。このため、この部分のコードを丸ごとコピーし、不要な処理を排除して、かつ、TileIDとItemIDで表記したコードにしたい。なお、Tileのテクスチャは、次のようにおり、ゲーム上でどのテクスチャを表示するかは、tile.frameXで管理されている。
ブロック系のテクスチャは、表現が異なっていても、ドロップするアイテムは同一だが、上記のようなタイプはそれぞれドロップするアイテムが異なる。今回生成するコードでは、単純にtile.typeのみから判断できるものを対象とすることにしている。やっていることは、
1. TileIDクラスとItemIDクラスをリフレクションにて、値と名のディクショナリーを作成
2. TileIDの数分、Terraria.WorldGen.KillTileメソッドのドロップ処理部分を別途抜き出し、不要な処理や、判断できない部分をコメントかしたメソッドを呼び出して、ItemIDを取得する（長いコードなのでここでは省略）
3. 取得できたItemID分の値とアイテム名のディクショナリーを作成
4. TileIDからItemIDを取得するメソッドのコードをファイルへ出力する実際に出力されたものの一部と言った感じで出力したので、後はここから必要な修正を施したりします。以上



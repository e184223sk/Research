More than 1 year has passed since last update.Unity 2019.1.9f1コルーチンを使ってステート遷移待ちをするときやらかしがちなミス。
ステート「Idle」から抜けたら何か処理をしたいとします。上のコードは一見問題なさそうですが、実際に実行すると上手く動作しません。
「Idle」から抜けているはずなのに、いつまでたってもWaitWhileから抜けてくれないのです。…それもそのはず。
Animator.GetCurrentAnimatorStateInfoの戻り値をキャッシュしたものでチェックしていますが、戻り値のAnimatorStateInfoは構造体なので値型。
それをいくら監視していても書き換わらないですね。正しくは下記のように、毎回取る形にします。当たり前と言えば当たり前なんですが、私はこれで躓いてしばらく悩みました…。



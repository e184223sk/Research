More than 1 year has passed since last update.Let's Encryptの証明書は90日で期限が切れちゃうので、定期的に期限を確認して、切れそうだったら教えてくれるプログラムを作りたいと思った。しかし、いまいちC#でサーバ証明書を取得する正しい方法がわからない…
思いついた方法で無理やり作ったので、知っている人いたら教えてください。HttpClientは、内部でSSLサーバ証明書を取得していて、有効かどうかを判定している。
HttpClientHandlerのServerCertificateCustomValidationCallbackを指定すると、証明書が有効かどうかの判定を上書きできる。
その時に証明書にアクセスできるので、それを取り出せば、めでたくサーバ証明書を取得できる。ServerCertificateCustomValidationCallbackで証明書にアクセスできるが、その証明書はすぐに破棄されてしまうようなので、RawDataを使って証明書を複製している。WEBページの内容を取得したいわけじゃないので、false（証明書が無効であること）を返して、内容を取得しないことを期待している。



More than 1 year has passed since last update.最近のOculusQuestさんちょっと攻めすぎですよね。
OculusLinkのβが出たのもつい最近な気がしているのに、さらにハンドトラッキングまで！！！そして、2019/12/20にはUnityのAssetStoreにハンドトラッキング対応のSDKが配布されました。　高速感！導入方法なんかについては他の方の記事にお任せして・・・。OVRHand には GetFingerIsPinching() と GetFingerPinchStrength() があり、それぞれ、ピンチ（つまんでいる）状態かどうかと
つまんでいる力（距離？）が取得できるメソッドが入っています。
参考：OculusQuestのハンドトラッキングについて色々調べてみたしかし、ぱっと見たところそれ以外の情報取得がそんなにありません。そこで上記記事でも言及していますが、もっと詳しい情報を知りたい場合は OVRSkelton.Bones にボーン情報が入っている のでそれを使うことにします。僕がやりたかったのは以前作った 「空中に図形を描いて物体を生成するアプリを作ってみた」 のハンドトラッキング版だったので、空中に絵を描くイメージです。
みなさんが空中に絵を描く（例えば、誰かに「＊＊って漢字どう書くんだったっけ？」と聞かれた）時に指をどんな形にするかっていうと十中八九←これですよねこの「人差し指だけを伸ばして、他曲げている」をGetFingerIsPinching()やGetFingerPinchStrength()でやるのはちょっと無理があります。（できなくはないと思いますが）そこで、 OVRSkelton.Bones から情報を抜き出して簡単に分析することにしました。OVRSkelton.Bones は IList(Readonly)で、何番目にどの情報が入っているかは以下のようにenumで宣言されています。親指:Thumb
人差し指:Index
中指:Middle
薬指:Ring
小指:Pinkyで、1,2,3 は関節を表しており、数字が大きくなるほど指先に近づいていく ようです。
僕は英語をロクに読まず 「第一関節」= 1 だと思い込んで処理を書いていたらさっぱり正しい値が返ってこなくてハテ？　となりました。ご注意を・・・。
そして、 Tip とついているのは指先です。分かりやすくマッピングしてみると、どうもこんな感じ・・・？
なお、Pinky と Thumb だけ 0番があります。そして、この Bone には Transform が入っており、位置や回転が取れそうです。
例えば「人差し指の先端の位置」を取るにはこうなります（注：enumなのでintキャストが必要)以上を踏まえ、この「人差し指がまっすぐになっていて、中指、薬指、小指は曲がっている」を判定します。（親指は除きました。）この「人差し指がまっすぐになっている」というのは人差し指の「第三関節→第二関節」の方向（ベクトル）と、「第二関節→第一関節」の方向(ベクトル）と「第一関節→指先」の方向(ベクトル）が大体同じ方向を向いている ということです。この「二つのベクトルが大体同じ方向を向いている」＝「どれぐらい似通っているか」を表すのは。そう内積(Vector3.Dot)です。ベクトルの内積は直角（一番似通っていない)な場合は０
全く同じ場合は+1
全く逆方向の場合は-1ですこれを人差し指だけではなく他の指の分もベタ書きするとそこそこ長くなってしまうので、以下のようなメソッドを用意すると便利だと思います。可変長配列でBoneIDを複数(3個以上)受けとり、一つ前のBoneIDが示す関節から関節のベクトルと、今のBoneIDが示す関節と次の関節のベクトルの内積を計算して、 dot にどんどん乗算していっています。（別に平均でも良い気はしますが）これを使うと、人差し指がまっすぐかどうかを判定してLogに表示する場合、このようになります。おなじく、他の指も調べていけば、「人差し指がまっすぐになっていて、中指、薬指、小指は曲がっている」は判定できそうです。そして、人差し指の先端の位置 (IndexTip) で線を描くとこうなりました実家に帰っている間にOculusQuestのハンドトラッキングがUnity対応していたので、色々と試し中。左手がボーンだけ表示。ボーンから関節情報が取れるので、各指が伸びているか曲がっているかを独自に計算してみた。しかし・・・。座標が安定しないので全然図形は描けない。ぐぬぬ。#OculusQuest pic.twitter.com/6PaNVLBfmhうーん。　ノイズなのかなんなのか。　まったく直線が描けてないですね。とりあえずの目標（で線を描く）はできているので、よしとします。
この問題はまた後日・・・。OVRHandからとれるピンチ情報に加え、この「各指が曲がっているか(false)伸びているか(true)」が加わるだけでもいろんな事が出来るんじゃないかなと思います。
&lt;例&gt;
- 全部falseならグー、人差し指と中指だけtrueならチョキ、全部trueならパー、でじゃんけん
- 中指と小指がfalse、そのほかがtrueで「グワシ！」
- 中指だけtrue そのほかfalse で 「F******!」で、プログラム強制終了。
などなど。しかし・・。ちゃんとリファレンス見てないので、こんなことしなくても情報は取れるよ！もっといい方法あるよ！　などあったらコメント教えてください。ではでは、よきOculusQuestライフを。



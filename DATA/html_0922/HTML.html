<!DOCTYPE html><html><head><meta charset="utf-8" /><title>Unity + .NET Core + MagicOnion v3 環境構築ハンズオン - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/_y_minami/items/db7b19eb5979ef1d6fe9" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="aMTkAdNSC2R778TlMP10XLlpDLvsslCuzdYRI4TZsuXIbwysGErZWW4taixUN6LlkRdQs4Am6GB4APHy1TMXzQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@_y_minami" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="Unity + .NET Core + MagicOnion v3 環境構築ハンズオン - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1WVzVwZEhrZ0t5QXVUa1ZVSUVOdmNtVWdLeUJOWVdkcFkwOXVhVzl1SUhZeklPZVNzT1dpZy1hbmktZXZpZU9Eai1PRHMtT0N1dU9DcXVPRHN3JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTAzNzQxMGIyMzUzNDAyOTljYjc3NmMwYjA5MGU4MDZh&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRjk1WDIxcGJtRnRhUSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTYwYTdhYWQyZDFjMzM1ZTQzZTBiMGJmNTA4NDE0YzVh&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=5312b6422f59fb044278883e1636d456"><meta property="og:description" content="

はじめに

MagicOnion は一度環境を構築してしまえば、触り心地が良くてとても使いやすいフレームワークだと思います。

しかし初期構築がやや複雑で、特に Unity と サーバー(.NET Core) の両方の経験が無い方..."><meta content="https://qiita.com/_y_minami/items/db7b19eb5979ef1d6fe9" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,.NET,Unity,gRPC,MagicOnion" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-69fe4451-883c-4f03-99f4-ff39b6d97ed5"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2F_y_minami%2Fitems%2Fdb7b19eb5979ef1d6fe9">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2F_y_minami%2Fitems%2Fdb7b19eb5979ef1d6fe9">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-69fe4451-883c-4f03-99f4-ff39b6d97ed5">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-08-08T15:11:21.000+09:00","dateModified":"2020-08-11T10:11:50.000+09:00","headline":"Unity + .NET Core + MagicOnion v3 環境構築ハンズオン","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1WVzVwZEhrZ0t5QXVUa1ZVSUVOdmNtVWdLeUJOWVdkcFkwOXVhVzl1SUhZeklPZVNzT1dpZy1hbmktZXZpZU9Eai1PRHMtT0N1dU9DcXVPRHN3JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTAzNzQxMGIyMzUzNDAyOTljYjc3NmMwYjA5MGU4MDZh\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRjk1WDIxcGJtRnRhUSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTYwYTdhYWQyZDFjMzM1ZTQzZTBiMGJmNTA4NDE0YzVh\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=5312b6422f59fb044278883e1636d456","mainEntityOfPage":"https://qiita.com/_y_minami/items/db7b19eb5979ef1d6fe9","author":{"@type":"Person","address":"東京都","email":null,"identifier":"_y_minami","name":"_y_minami","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fprofile-images%2F1558851334?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=4b08510aff92369a0369f8e4db973360","url":"https://qiita.com/_y_minami","description":"C# .NET Unity Azureが好きでその辺りのお仕事をしてます。\r\n趣味はゲーム制作とお菓子作りと紅茶。\r\n日本紅茶協会認定ティーアドバイザー。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"_y_minami","type":"items","id":"db7b19eb5979ef1d6fe9"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"_y_minami","type":"items","id":"db7b19eb5979ef1d6fe9"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"_y_minami","type":"items","id":"db7b19eb5979ef1d6fe9"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/_y_minami/items/db7b19eb5979ef1d6fe9","location":"/_y_minami/items/db7b19eb5979ef1d6fe9","scheme":"https","host":"qiita.com","port":null,"pathname":"/_y_minami/items/db7b19eb5979ef1d6fe9","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"TKv7ZjVtbzSYHcKKCq5gV9ZRKwQI03woInT8Kq6nkXbsABPL/nW9CY3fbENuZLbu/i93DGRHxOaXohz7/000Xg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-1c2cdd90-f767-4e0a-b444-a7938ab54478"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/_y_minami/items/db7b19eb5979ef1d6fe9/likers" class="css-1iupg5d">25</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">25</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/db7b19eb5979ef1d6fe9/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/_y_minami/items/db7b19eb5979ef1d6fe9/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/_y_minami/items/db7b19eb5979ef1d6fe9/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/_y_minami/items/db7b19eb5979ef1d6fe9/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/_y_minami/items/db7b19eb5979ef1d6fe9.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/_y_minami"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/profile-images/1558851334" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/_y_minami" class="css-10ougpm">@<!-- -->_y_minami</a><div class="css-1ay9vb9"><span><meta content="2020-08-08T06:11:21Z"/><time dateTime="2020-08-11T01:11:50Z" class="css-m19uds">updated at 2020-08-11</time></span></div></div></div></div></div><h1 class="css-cgzq40">Unity + .NET Core + MagicOnion v3 環境構築ハンズオン</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/.net" class="css-4czcte">.NET</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/grpc" class="css-4czcte">gRPC</a><a href="/tags/magiconion" class="css-4czcte">MagicOnion</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>MagicOnion は一度環境を構築してしまえば、触り心地が良くてとても使いやすいフレームワークだと思います。</p>

<p>しかし初期構築がやや複雑で、特に Unity と サーバー(.NET Core) の両方の経験が無い方が挑戦した場合はどこかでつまづいてしまうことも多いのではないかと思いました。</p>

<p>そこで、どちらかの経験が無い方でもつまずかずにポチポチと環境構築できる資料を目指して書いたのがこの記事になります。</p>

<p>もし途中でつまづくところがありましたら Twitter で教えていただけると喜びます。</p>

<p>ハンズオンの所要時間は Unity と VisualStudio をインストール済みの状態から開始して、30分～1時間程度です。</p>

<h2>
<span id="目次" class="fragment"></span><a href="#%E7%9B%AE%E6%AC%A1"><i class="fa fa-link"></i></a>目次</h2>

<h2>
<span id="1-環境について" class="fragment"></span><a href="#1-%E7%92%B0%E5%A2%83%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>1. 環境について</h2>

<p>本記事を書くにあたって使用した OS、ツール、ソフトウェアのバージョンです。</p>

<ul>
<li>Windows 10</li>
<li>Unity 2019.4.7f1</li>
<li>Visual Studio 2019 16.7</li>
<li><a href="https://github.com/Cysharp/MagicOnion/releases/tag/3.0.12" rel="nofollow noopener" target="_blank">MagicOnion 3.0.12</a></li>
<li><a href="https://github.com/neuecc/MessagePack-CSharp/releases/tag/v2.1.152" rel="nofollow noopener" target="_blank">MessagePack 2.1.152</a></li>
<li><a href="https://packages.grpc.io/archive/2019/08/e14154481baf7e23710b60b78a1e91299985ec80-41fb322e-6416-4509-9a6f-2b17085b6272/index.xml" rel="nofollow noopener" target="_blank">gRPC 2.23.0</a></li>
</ul>

<h2>
<span id="2-unity-側の構築" class="fragment"></span><a href="#2-unity-%E5%81%B4%E3%81%AE%E6%A7%8B%E7%AF%89"><i class="fa fa-link"></i></a>2. Unity 側の構築</h2>

<h3>
<span id="21-プロジェクトの新規作成playersettings-の変更各種フォルダの作成" class="fragment"></span><a href="#21-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E6%96%B0%E8%A6%8F%E4%BD%9C%E6%88%90playersettings-%E3%81%AE%E5%A4%89%E6%9B%B4%E5%90%84%E7%A8%AE%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>2.1. プロジェクトの新規作成、PlayerSettings の変更、各種フォルダの作成</h3>

<p>今回は 3D プロジェクトを作成します。<br>
プロジェクト名は任意ですが、サーバーサイドのプロジェクトと見分けやすいように <code>Sample.Unity</code> とします。</p>

<p>保存先は任意の保存先を入力してください。</p>

<p><a href="https://camo.qiitausercontent.com/eddf655cd83612a88e467f6ea5011fc3d0e18bc8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f35653738663534332d363065362d366665322d663238342d3236323366333633396539322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5e78f543-60e6-6fe2-f284-2623f3639e92.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f9b1f119ea904117ee8374bda6814d4a" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/5e78f543-60e6-6fe2-f284-2623f3639e92.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5e78f543-60e6-6fe2-f284-2623f3639e92.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f4106ef96ea8100c62258fa7d453bad6 1x" loading="lazy"></a></p>

<p>Unity が起動したら <code>PlayerSettings</code> を開きます。</p>

<p><a href="https://camo.qiitausercontent.com/1e940dc510e9ce45b6caf153d00168c0a29143bf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f61623963643632652d336436662d363534612d623339652d6137623964366361336133632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fab9cd62e-3d6f-654a-b39e-a7b9d6ca3a3c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6ccea44d1a28a116fc77d90022e98130" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/ab9cd62e-3d6f-654a-b39e-a7b9d6ca3a3c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fab9cd62e-3d6f-654a-b39e-a7b9d6ca3a3c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=462293825927008b79a65445dea5dd59 1x" loading="lazy"></a></p>

<p><code>Player</code> を選択して、下記の2箇所を変更します。</p>

<ul>
<li>APICompatibilityLevel を <code>.NET 4.x</code> に変更する</li>
<li>Allow unsafe Code にチェックをいれる</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/4f0e3c9204421d4faaf6cf7ada1ec14ecae08fd3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f66306364623336622d636663372d643236642d323164312d3966373861333530336431622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Ff0cdb36b-cfc7-d26d-21d1-9f78a3503d1b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d93ff12511ce0f713b06329a68a0f206" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/f0cdb36b-cfc7-d26d-21d1-9f78a3503d1b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Ff0cdb36b-cfc7-d26d-21d1-9f78a3503d1b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=10901ecd86757a394088a7058c00d57e 1x" loading="lazy"></a></p>

<p>次に下記のフォルダを作成します。<br>
※Sample.Unity は自分のプロジェクト名に読み替えてください。</p>

<ul>
<li>Sample.Unity\Assets\Editor</li>
<li>Sample.Unity\Assets\Plugins</li>
<li>Sample.Unity\Assets\Scripts</li>
<li>Sample.Unity\Assets\Scripts\Generated</li>
<li>Sample.Unity\Assets\Scripts\ServerShared</li>
<li>Sample.Unity\Assets\Scripts\ServerShared\Hubs</li>
<li>Sample.Unity\Assets\Scripts\ServerShared\MessagePackObjects</li>
<li>Sample.Unity\Assets\Scripts\ServerShared\Services</li>
</ul>

<p>フォルダ構成が下記のようになっていることを確認します。</p>

<p><a href="https://camo.qiitausercontent.com/0cb323d4fdb312840aad5baab37a77d3eaf26443/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f65303461393130382d373737302d393738642d303334352d6330336266666665663630632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fe04a9108-7770-978d-0345-c03bfffef60c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=dabfd6ae2d51ef22d355abfd98bcadb1" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/e04a9108-7770-978d-0345-c03bfffef60c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fe04a9108-7770-978d-0345-c03bfffef60c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=fbc2ce56d81eabe3bee2567e591ea962 1x" loading="lazy"></a></p>

<h3>
<span id="22-magiconion-のインストール" class="fragment"></span><a href="#22-magiconion-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>2.2. MagicOnion のインストール</h3>

<p><a href="https://github.com/Cysharp/MagicOnion/releases/tag/3.0.12" rel="nofollow noopener" target="_blank">GitHub</a> から <code>MagicOnion.Client.Unity.unitypackage</code> をダウンロードします。</p>

<p><a href="https://camo.qiitausercontent.com/2e1518a41f0a351a7bdd3b613a7e240207fc1b79/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f63666665313131642d366665392d306261662d313365662d6132336637303539653438392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcffe111d-6fe9-0baf-13ef-a23f7059e489.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=31d45e7552d80b022c0292573ea26e1c" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/cffe111d-6fe9-0baf-13ef-a23f7059e489.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcffe111d-6fe9-0baf-13ef-a23f7059e489.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6b6f37b6433bea02a367335a815a8fab 1x" loading="lazy"></a></p>

<p>ダウンロードが終わったらダブルクリックしてインポートします。</p>

<p><a href="https://camo.qiitausercontent.com/24a1c7a7195dd9e4b658719088ff30f0b1455804/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f34303130306235322d313133632d376630632d393865652d3239316138313234353065382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F40100b52-113c-7f0c-98ee-291a812450e8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=fee83e53bba9e0ae720ade6fe032629d" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/40100b52-113c-7f0c-98ee-291a812450e8.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F40100b52-113c-7f0c-98ee-291a812450e8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=45ce8a78e48f193520eb445caeb9022c 1x" loading="lazy"></a></p>

<h3>
<span id="23-messagepack-for-c-のインストール" class="fragment"></span><a href="#23-messagepack-for-c-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>2.3. MessagePack for C# のインストール</h3>

<p><a href="https://github.com/neuecc/MessagePack-CSharp/releases/tag/v2.1.152" rel="nofollow noopener" target="_blank">GitHub</a> から <code>MessagePack.Unity.2.1.152.unitypackage</code> をダウンロードします。</p>

<p><a href="https://camo.qiitausercontent.com/7c6167e6d514b657f150a0ac149f60d773914c58/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f64636234316231312d656662322d303736332d363339372d3166303239633164636637632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fdcb41b11-efb2-0763-6397-1f029c1dcf7c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7f72baedf8de45ebfea04b33f3670564" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/dcb41b11-efb2-0763-6397-1f029c1dcf7c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fdcb41b11-efb2-0763-6397-1f029c1dcf7c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5e484523c7877e5528fc111acfc22b2b 1x" loading="lazy"></a></p>

<p>ダウンロードが終わったらダブルクリックしてインポートします。<br>
MagicOnion と重複するファイルがあるため警告が表示されますがこのままインポートします。</p>

<p><a href="https://camo.qiitausercontent.com/dc58141f8a50d6d91604e6c91819422090330002/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f32613835343936372d353162642d323539382d303661632d3038616235336336343363622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F2a854967-51bd-2598-06ac-08ab53c643cb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ed436be8ab42c3d23d69bfeb35010348" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/2a854967-51bd-2598-06ac-08ab53c643cb.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F2a854967-51bd-2598-06ac-08ab53c643cb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=38d7f2e90e143b09f92954e22f80ee46 1x" loading="lazy"></a></p>

<h3>
<span id="24-grpc-のインストール" class="fragment"></span><a href="#24-grpc-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>2.4. gRPC のインストール</h3>

<p>gRPC の <a href="https://packages.grpc.io/archive/2019/08/e14154481baf7e23710b60b78a1e91299985ec80-41fb322e-6416-4509-9a6f-2b17085b6272/index.xml" rel="nofollow noopener" target="_blank">Daily Builds(2019/08/01)</a> から <code>grpc_unity_package.2.23.0-dev.zip</code> をダウンロードします。</p>

<p><a href="https://camo.qiitausercontent.com/249335dde7d452b9f4fdb0033a2b972b364003c3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f39663830653536352d663537642d323132332d633936352d6263306363366461333166652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F9f80e565-f57d-2123-c965-bc0cc6da31fe.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=feac7b11ba3c3a7fe4498690c81a12d3" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/9f80e565-f57d-2123-c965-bc0cc6da31fe.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F9f80e565-f57d-2123-c965-bc0cc6da31fe.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=03059f60bd42ed2d2b53da5d1aa5ad7b 1x" loading="lazy"></a></p>

<p>ダウンロードが終わったら展開し、以下のフォルダを <code>Sample.Unity\Assets\Plugins</code> にコピーします。</p>

<ul>
<li>Google.Protobuf</li>
<li>Grpc.Core</li>
<li>Grpc.Core.Api</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/c1e239f6b024560624feb1a9ded1b84b45414b8d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f36376432643132342d663761372d653335352d393935392d3832316365633335353030322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F67d2d124-f7a7-e355-9959-821cec355002.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9e156b959f566854c946811526300f4a" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/67d2d124-f7a7-e355-9959-821cec355002.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F67d2d124-f7a7-e355-9959-821cec355002.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c500a8a6410deb2079948c8edf824c68 1x" loading="lazy"></a></p>

<h3>
<span id="25-サーバーへ接続するスクリプトの用意" class="fragment"></span><a href="#25-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%B8%E6%8E%A5%E7%B6%9A%E3%81%99%E3%82%8B%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E7%94%A8%E6%84%8F"><i class="fa fa-link"></i></a>2.5. サーバーへ接続するスクリプトの用意</h3>

<p><code>Assets\Scenes</code> に <code>SampleController</code> スクリプトを作成します。<br>
<a href="https://camo.qiitausercontent.com/25773d0de6d2c7d0af44e3d7eefed62033e15894/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f61613166346431332d626331332d646564372d303331662d3239373835363166313166642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Faa1f4d13-bc13-ded7-031f-2978561f11fd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4bf2e70dd9dfcbfae0899faf390665d9" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/aa1f4d13-bc13-ded7-031f-2978561f11fd.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Faa1f4d13-bc13-ded7-031f-2978561f11fd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c7464b874c95527d19007053dc1adb6d 1x" loading="lazy"></a></p>

<p>SampleController のコードは以下をコピペしてください。<br>
Start() でサーバーへ接続し、OnDestroy() で切断するようになっています。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Grpc.Core</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">SampleController</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">Channel</span> <span class="n">channel</span><span class="p">;</span>

    <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">channel</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Channel</span><span class="p">(</span><span class="s">"localhost:12345"</span><span class="p">,</span> <span class="n">ChannelCredentials</span><span class="p">.</span><span class="n">Insecure</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="k">void</span> <span class="nf">OnDestroy</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">channel</span><span class="p">.</span><span class="nf">ShutdownAsync</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>SampleScene へ空の GameObject を追加します。</p>

<p><a href="https://camo.qiitausercontent.com/64040ff05d75ec17468beef827b6a711796eab89/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f64373633373233312d376434322d363530652d656435382d3166636631656564623032612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fd7637231-7d42-650e-ed58-1fcf1eedb02a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8feaa4b1e6243e5d0f26f091591931d4" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/d7637231-7d42-650e-ed58-1fcf1eedb02a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fd7637231-7d42-650e-ed58-1fcf1eedb02a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4ede8c9ba7b38f59e40bf4fc0b3c5252 1x" loading="lazy"></a></p>

<p>追加した GameObject に SampleController を AddComponent します。</p>

<p><a href="https://camo.qiitausercontent.com/43b1c559a5cce70e25736b068542ed2347a6a5b4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f61333137343930382d356330362d393039352d353339322d3230376462356131663861302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa3174908-5c06-9095-5392-207db5a1f8a0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9920e8b8770b73a2fa7409d3ead0be0a" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/a3174908-5c06-9095-5392-207db5a1f8a0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa3174908-5c06-9095-5392-207db5a1f8a0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2975cd5376c7a5cc5d5de96c5fd99f5a 1x" loading="lazy"></a></p>

<h3>
<span id="26-unity--サーバー間のコード共有の動作確認用のクラスの用意" class="fragment"></span><a href="#26-unity--%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E9%96%93%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E5%85%B1%E6%9C%89%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D%E7%94%A8%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E7%94%A8%E6%84%8F"><i class="fa fa-link"></i></a>2.6. Unity ⇔ サーバー間のコード共有の動作確認用のクラスの用意</h3>

<p>MagicOnion を利用する際は Unity 側で作成したクラスなどをサーバーサイドと共有して使うことが一般的です。<br>
今回は Assets\Scripts\ServerShared 以下に作成したスクリプトをすべて共有する設定を行います。<br>
コード共有の設定は後でサーバー側で設定を行いますが、先に動作確認用のクラスを用意しておきます。</p>

<p><code>Assets\ServerShared\MessagePackObjects</code> に <code>Player</code> スクリプトを作成します。</p>

<p><a href="https://camo.qiitausercontent.com/272ea54d966c220937c42318b5ec6b2aa6d4f3cf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f64633236623832352d366465302d376235632d333361342d3965663434653961336232332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fdc26b825-6de0-7b5c-33a4-9ef44e9a3b23.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3baef6b9ef1e39fe14b28bcc137870f2" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/dc26b825-6de0-7b5c-33a4-9ef44e9a3b23.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fdc26b825-6de0-7b5c-33a4-9ef44e9a3b23.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c37a8cbe17fa35f006775f3a186b4af1 1x" loading="lazy"></a></p>

<p>Player のコードは以下をコピペしてください。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">MessagePack</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Sample.Shared.MessagePackObjects</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">MessagePackObject</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Player</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">Key</span><span class="p">(</span><span class="m">0</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">[</span><span class="nf">Key</span><span class="p">(</span><span class="m">1</span><span class="p">)]</span>
        <span class="k">public</span> <span class="n">Vector3</span> <span class="n">Position</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">[</span><span class="nf">Key</span><span class="p">(</span><span class="m">2</span><span class="p">)]</span>
        <span class="k">public</span> <span class="n">Quaternion</span> <span class="n">Rotation</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>MagicOnion を使用する場合、Client ⇔ サーバー間の通信で使用するクラスはこのような MessagePackObject として定義します。</p>

<p>MessagePackObject として定義するために必要なことは下記の2つだけですので覚えておきましょう。</p>

<ul>
<li>class に MessagePackObjectAttribute を付与する</li>
<li>各プロパティに KeyAttribute を付与して番号を順番にふる</li>
</ul>

<p>Unity 側の構築はここまでです。</p>

<h2>
<span id="3-サーバー側の構築" class="fragment"></span><a href="#3-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%AE%E6%A7%8B%E7%AF%89"><i class="fa fa-link"></i></a>3. サーバー側の構築</h2>

<p>続いてサーバー側の構築作業を進めます。</p>

<h3>
<span id="31-ソリューションへサーバー側のプロジェクトを追加" class="fragment"></span><a href="#31-%E3%82%BD%E3%83%AA%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%B8%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>3.1. ソリューションへサーバー側のプロジェクトを追加</h3>

<p>ソリューションを右クリックして、新しいプロジェクトを追加します。<br>
<a href="https://camo.qiitausercontent.com/bbfffc2d0152ab62c48d6150c2dc3d5220445a51/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f39663962646565352d613865342d643737312d383438372d3939653133633764613363662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F9f9bdee5-a8e4-d771-8487-99e13c7da3cf.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ff3a8c1fc5c78d87a617f1ed15283fbe" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/9f9bdee5-a8e4-d771-8487-99e13c7da3cf.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F9f9bdee5-a8e4-d771-8487-99e13c7da3cf.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ab6cab4c9efd068a8615d397d5f957b5 1x" loading="lazy"></a></p>

<p>コンソールアプリ（.NET Core）を選択し、次へをクリックします。</p>

<p><a href="https://camo.qiitausercontent.com/d44ee403de28cec613ba00a5cf6b2da230fe77da/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f65663032363162302d383162652d636135392d353863352d3736323464326133646632362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fef0261b0-81be-ca59-58c5-7624d2a3df26.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ba14bb68fe35f1d3150b80a7fa9546fd" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/ef0261b0-81be-ca59-58c5-7624d2a3df26.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fef0261b0-81be-ca59-58c5-7624d2a3df26.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e0ef58f20b4a8e89c1aa8ca87f90ad7d 1x" loading="lazy"></a></p>

<p>任意のプロジェクト名を入力します。（ここでは Sample.Server としました）<br>
場所はプロジェクトのルートを指定してください。<br>
<a href="https://camo.qiitausercontent.com/6769162bc0380a814537604a7004ee90a3a1a1d0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f65326231323366362d303462352d633738372d313633352d6561376530356331653037302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fe2b123f6-04b5-c787-1635-ea7e05c1e070.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b4b22365b06b5002d7aafe65d17b4e51" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/e2b123f6-04b5-c787-1635-ea7e05c1e070.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fe2b123f6-04b5-c787-1635-ea7e05c1e070.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1f3359807059f2e0dadc07337fafedf9 1x" loading="lazy"></a></p>

<h3>
<span id="32-magiconion-のインストール" class="fragment"></span><a href="#32-magiconion-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>3.2. MagicOnion のインストール</h3>

<p>NuGet から MagicOnion をインストールします。<br>
ツール -&gt; NuGet パッケージマネージャー -&gt; ソリューションの NuGet パッケージの管理 を開きます。<br>
<a href="https://camo.qiitausercontent.com/76d992637278eec15342f1452c9c92f129deab04/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f35616161653661302d343665362d353737632d643435302d3439383933306430656232362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5aaae6a0-46e6-577c-d450-498930d0eb26.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4a757646fc725d1c0fbbfa5b141854cc" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/5aaae6a0-46e6-577c-d450-498930d0eb26.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5aaae6a0-46e6-577c-d450-498930d0eb26.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=13607e879a9af58c348225a841880a81 1x" loading="lazy"></a></p>

<p>参照 をクリックし、 MagicOnion を検索します。<br>
検索結果から MagicOnion.Hosting を選択し、Sample.Server にチェックをいれます。<br>
バージョンは 3.0.12 を選択し、インストールします。<br>
<a href="https://camo.qiitausercontent.com/21b6a2efd2076a14b5c3d4e83f0cd2bd6b377915/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f61333337376662362d343336332d356235302d306362622d3139363030623731326464322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa3377fb6-4363-5b50-0cbb-19600b712dd2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c3b4cb39f93648c6a79fa58749e49f29" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/a3377fb6-4363-5b50-0cbb-19600b712dd2.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa3377fb6-4363-5b50-0cbb-19600b712dd2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ff98cf23c31564d8c820dc53d12b1a92 1x" loading="lazy"></a></p>

<p>変更のプレビューが表示されるので OK を押します。<br>
<a href="https://camo.qiitausercontent.com/17c230a303977cca98517db66a25809bbc2f91ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f63626664313030312d326164662d393231312d313431652d3033636264346263393339322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcbfd1001-2adf-9211-141e-03cbd4bc9392.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=47fa192bb19eb08d3d6c717b0ac7136d" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/cbfd1001-2adf-9211-141e-03cbd4bc9392.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcbfd1001-2adf-9211-141e-03cbd4bc9392.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=03a703b2eb010bf1afd0cd7968318d43 1x" loading="lazy"></a></p>

<p>ライセンスへの同意を求められるので同意します。<br>
<a href="https://camo.qiitausercontent.com/33751b7686e4e7c3d09744487742830b7633c139/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f30313365366561372d383634352d663361362d303736362d6565626362376439323366302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F013e6ea7-8645-f3a6-0766-eebcb7d923f0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=24977041bfacd9e8c248b7e24a2cf739" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/013e6ea7-8645-f3a6-0766-eebcb7d923f0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F013e6ea7-8645-f3a6-0766-eebcb7d923f0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=51d2dc43a8b01fd96f23a00da8e67fe0 1x" loading="lazy"></a></p>

<h3>
<span id="33-programcs-の編集" class="fragment"></span><a href="#33-programcs-%E3%81%AE%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>3.3. Program.cs の編集</h3>

<p>Program.cs を下記の内容で上書き保存します。<br>
これでサーバー側のプロジェクトを起動すると MagicOnion が起動するようになります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">MagicOnion.Hosting</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.Extensions.Hosting</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Sample.Server</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">await</span> <span class="n">MagicOnionHost</span><span class="p">.</span><span class="nf">CreateDefaultBuilder</span><span class="p">()</span>
                <span class="p">.</span><span class="nf">UseMagicOnion</span><span class="p">()</span>
                <span class="p">.</span><span class="nf">RunConsoleAsync</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="34-ソリューションへクラスライブラリのプロジェクトを追加" class="fragment"></span><a href="#34-%E3%82%BD%E3%83%AA%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%B8%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>3.4. ソリューションへクラスライブラリのプロジェクトを追加</h3>

<p>このクラスライブラリを使って Unity 側とサーバー側のコード共有を行います。</p>

<p>ソリューションを右クリックして、新しいプロジェクトを追加します。<br>
<a href="https://camo.qiitausercontent.com/7803a5869ef61d7575f119b7f64de3b9835390f5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f61363433623061302d373131642d626539382d376465392d3533323131376638613634642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa643b0a0-711d-be98-7de9-532117f8a64d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1e86aa8ac1d0cf02251f6144422267f2" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/a643b0a0-711d-be98-7de9-532117f8a64d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa643b0a0-711d-be98-7de9-532117f8a64d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7890c5f9e34cebd2fdb6063dee9a85e9 1x" loading="lazy"></a></p>

<p>クラスライブラリ(C# .NET Standard)を選択します。<br>
<a href="https://camo.qiitausercontent.com/85ad3675f36418000dea4487ff1ba75f40d6f85a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f38386330623136352d386234312d343138612d646530352d3035303738376162623362612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F88c0b165-8b41-418a-de05-050787abb3ba.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=bea2942e2fd687f2851e2657351999a8" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/88c0b165-8b41-418a-de05-050787abb3ba.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F88c0b165-8b41-418a-de05-050787abb3ba.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=855e22ed276aeab986e5000131bb9fa0 1x" loading="lazy"></a></p>

<p>任意のプロジェクト名を入力します。（ここでは Sample.Shared としました）<br>
場所はプロジェクトのルートを指定してください。<br>
<a href="https://camo.qiitausercontent.com/814d6010ffbb5b995dd41e36b067eaf7cec7d23f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f33653165353262372d343261392d303932632d383535632d3035323463613337336131382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F3e1e52b7-42a9-092c-855c-0524ca373a18.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=44911c04705fce31975389345693e059" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/3e1e52b7-42a9-092c-855c-0524ca373a18.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F3e1e52b7-42a9-092c-855c-0524ca373a18.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6258e7c6f95b2b4e71fd9c5edc0218f3 1x" loading="lazy"></a></p>

<p>自動的に作成される Class1.cs は不要なので削除します。<br>
<a href="https://camo.qiitausercontent.com/e3f9d5f11b901dd212a1a33d022d9d328f7dd061/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f39306631393863392d336665302d613664612d626432352d6138623934633431663833372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F90f198c9-3fe0-a6da-bd25-a8b94c41f837.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=cc88743f5ad15720abb47daf1e6aee95" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/90f198c9-3fe0-a6da-bd25-a8b94c41f837.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F90f198c9-3fe0-a6da-bd25-a8b94c41f837.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=79018ad81f4548e08b7982c8f9083234 1x" loading="lazy"></a></p>

<h3>
<span id="35-クラスライブラリへ-magiconionabstractions-をインストール" class="fragment"></span><a href="#35-%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%B8-magiconionabstractions-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>3.5. クラスライブラリへ MagicOnion.Abstractions をインストール</h3>

<p>先ほどの MagicOnion のインストールと同じ要領で、NuGet から MagicOnion.Abstractions を検索してインストールします。<br>
対象のプロジェクトは Sample.Shared を選択し、バージョンは 3.0.12 を選択します。<br>
<a href="https://camo.qiitausercontent.com/ee685fc3dd73c25775dfee7a4400efdff9a3f6d2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f34653732663631622d303630332d316361342d643635322d6332656638343531303732662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F4e72f61b-0603-1ca4-d652-c2ef8451072f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=62fc3a5509084583287a72aea03419a9" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/4e72f61b-0603-1ca4-d652-c2ef8451072f.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F4e72f61b-0603-1ca4-d652-c2ef8451072f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=112aaacd49d1d97d68493961cd0bda17 1x" loading="lazy"></a></p>

<h3>
<span id="36-クラスライブラリへ-messagepackunityshims-をインストール" class="fragment"></span><a href="#36-%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%B8-messagepackunityshims-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>3.6. クラスライブラリへ MessagePack.UnityShims をインストール</h3>

<p>同じ要領で Sample.Shared へ MessagePack.UnityShims をインストールします。<br>
<a href="https://camo.qiitausercontent.com/0c15d82bb57a71e4e1165394b160ad6c508845a8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f63633632323765322d376539362d656637392d326435332d3863346135353739393062662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcc6227e2-7e96-ef79-2d53-8c4a557990bf.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3c2ef25c333b451997ee92462fb31f97" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/cc6227e2-7e96-ef79-2d53-8c4a557990bf.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcc6227e2-7e96-ef79-2d53-8c4a557990bf.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=674147569d04683bce1d821dba14e5b9 1x" loading="lazy"></a></p>

<h3>
<span id="37-クラスライブラリから-unity-側のコードを参照する" class="fragment"></span><a href="#37-%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%8B%E3%82%89-unity-%E5%81%B4%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>3.7. クラスライブラリから Unity 側のコードを参照する</h3>

<p>Sample.Shared をダブルクリックして Sample.Shared.csproj を開き、赤枠部分の設定を追加します。<br>
<a href="https://camo.qiitausercontent.com/b3dc4c0fbfcc795737475fd1adcc7a84d2ea3b8e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f62373439373563652d626561322d343430332d313637372d3034633233613063633363362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fb74975ce-bea2-4403-1677-04c23a0cc3c6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=cbb71dc043850cca31f335e91e76bba6" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/b74975ce-bea2-4403-1677-04c23a0cc3c6.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fb74975ce-bea2-4403-1677-04c23a0cc3c6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=776cf8252081b342b4a16b4a6d294444 1x" loading="lazy"></a></p>

<p>追加する設定はこちらをコピペしてください。<br>
※Sample.Unity の部分は自分の Unity 側のプロジェクト名に読み替えてください。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="p">&lt;</span><span class="n">ItemGroup</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="n">Compile</span> <span class="n">Include</span><span class="p">=</span><span class="s">"..\Sample.Unity\Assets\Scripts\ServerShared\**\*.cs"</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="n">ItemGroup</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>この状態でソリューションエクスプローラーを見てみると、Unity 側で用意した ServerShared フォルダ以下のファイルがクラスライブラリに読み込めたことがわかります。<br>
<a href="https://camo.qiitausercontent.com/9e64110d2219e2c31050e76890cd70732e3c3403/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f30383637396430342d613730332d366362382d336163352d3232633165313566346466302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F08679d04-a703-6cb8-3ac5-22c1e15f4df0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=12971fec7a9c6dc211ef8976815ba112" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/08679d04-a703-6cb8-3ac5-22c1e15f4df0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F08679d04-a703-6cb8-3ac5-22c1e15f4df0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7c37475356b906bc8f20811d28c9562c 1x" loading="lazy"></a></p>

<h3>
<span id="38-サーバー側のプロジェクトからクラスライブラリを参照する" class="fragment"></span><a href="#38-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%8B%E3%82%89%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>3.8. サーバー側のプロジェクトからクラスライブラリを参照する</h3>

<p>Sample.Server を右クリックし、追加、プロジェクト参照を選択します。<br>
<a href="https://camo.qiitausercontent.com/248f8495ecf520cd893a5db8b53513a3d96507e8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f32383536636163632d336561632d646336332d316230352d6361336438363364306235642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F2856cacc-3eac-dc63-1b05-ca3d863d0b5d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=749493cb6a6908ddccb513fa25c4ffd4" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/2856cacc-3eac-dc63-1b05-ca3d863d0b5d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F2856cacc-3eac-dc63-1b05-ca3d863d0b5d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=bed3bff96e82c24c744bfb3ee1faeaf2 1x" loading="lazy"></a></p>

<p>Sample.Shared を選択して OK を押します。<br>
<a href="https://camo.qiitausercontent.com/d4efeb16cd1d103cc382aa36085e0cbc85259f09/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f34386635316231332d386262662d316434662d373233392d6533373532356239363933372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F48f51b13-8bbf-1d4f-7239-e37525b96937.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1ca5fab894a7f54b3c8853724d42e5e4" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/48f51b13-8bbf-1d4f-7239-e37525b96937.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F48f51b13-8bbf-1d4f-7239-e37525b96937.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=08515a82384577c4af608d9a4d846bbe 1x" loading="lazy"></a></p>

<p>これで Unity とコード共有したサーバーの用意ができました。</p>

<h2>
<span id="4-api-の実装と動作確認" class="fragment"></span><a href="#4-api-%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%A8%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>4. API の実装と動作確認</h2>

<p>ここからは API の実装と動作確認を行います。<br>
MagicOnion は普通の API 通信とリアルタイム通信の2種類の通信が利用できますので、それぞれをテストしてみます。</p>

<h3>
<span id="41-普通の-api通信" class="fragment"></span><a href="#41-%E6%99%AE%E9%80%9A%E3%81%AE-api%E9%80%9A%E4%BF%A1"><i class="fa fa-link"></i></a>4.1. 普通の API通信</h3>

<p>まずは普通の API 通信から試してみます。</p>

<h4>
<span id="411-unity-側で-api-の定義を作る" class="fragment"></span><a href="#411-unity-%E5%81%B4%E3%81%A7-api-%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>4.1.1. Unity 側で API の定義を作る</h4>

<p>Assets\Scripts\ServerShared\Services 以下に SampleService スクリプトを作ります。<br>
<a href="https://camo.qiitausercontent.com/5c53fc6ec6924fb5e0bee52c797a52d6b7aada79/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f62393930663863352d306134392d613530312d326235352d3963643939626637343436322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fb990f8c5-0a49-a501-2b55-9cd99bf74462.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=402336db9f6cf0ee7766383388b9200b" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/b990f8c5-0a49-a501-2b55-9cd99bf74462.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fb990f8c5-0a49-a501-2b55-9cd99bf74462.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=60486d02585d05d207cc248f4b8157a4 1x" loading="lazy"></a></p>

<p>SampleService の中身は以下をコピペして保存してください。<br>
今回は足し算をしてくれる API と掛け算をしてくれる API を定義してみます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">MagicOnion</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Sample.Shared.Services</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">ISampleService</span> <span class="p">:</span> <span class="n">IService</span><span class="p">&lt;</span><span class="n">ISampleService</span><span class="p">&gt;</span>
    <span class="p">{</span>
        <span class="n">UnaryResult</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="nf">SumAsync</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>
        <span class="n">UnaryResult</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="nf">ProductAsync</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4>
<span id="412-サーバー側で-api-を実装する" class="fragment"></span><a href="#412-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%A7-api-%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>4.1.2. サーバー側で API を実装する</h4>

<p>Sample.Server を右クリックして、新しいフォルダを追加します。<br>
名前は Services とします。</p>

<p><a href="https://camo.qiitausercontent.com/566bcf46f4383ce84013e572834ef5cf58c8576a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f39373863383765312d363464372d653764632d323036612d3431383335623739383664372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F978c87e1-64d7-e7dc-206a-41835b7986d7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c0d20706c89406bf7ac35ea13832f13a" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/978c87e1-64d7-e7dc-206a-41835b7986d7.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F978c87e1-64d7-e7dc-206a-41835b7986d7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b32bde545b90b3bb61a275a45618bf51 1x" loading="lazy"></a></p>

<p><a href="https://camo.qiitausercontent.com/b324fa6e68f8e083234e9c24e49ae2039f0034a8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f65626337363061662d663364332d393364302d373536322d3233666437623430636663302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Febc760af-f3d3-93d0-7562-23fd7b40cfc0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=230e6caba9c1d57d79e2a4470d7d43ac" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/ebc760af-f3d3-93d0-7562-23fd7b40cfc0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Febc760af-f3d3-93d0-7562-23fd7b40cfc0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=178cadee85da16ee5886362e45389578 1x" loading="lazy"></a></p>

<p>次に Services フォルダ内にクラスを追加します。</p>

<p><a href="https://camo.qiitausercontent.com/dd8133ccafe9e1d513acad22a31607a539a48937/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f32333733336433352d653833342d383034632d383238632d3434303763613561346238382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F23733d35-e834-804c-828c-4407ca5a4b88.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f92d6355e37b1818a1e844621f286c0c" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/23733d35-e834-804c-828c-4407ca5a4b88.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F23733d35-e834-804c-828c-4407ca5a4b88.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7418221fdef1b4b658bb550066e4a488 1x" loading="lazy"></a></p>

<p>名前は SampleService.cs とします。<br>
<a href="https://camo.qiitausercontent.com/cb43b0e5767a87ebf5dc24edcdd8007cfff50d27/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f61376561336261662d323638392d346363622d336266332d6537616134646130646138382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa7ea3baf-2689-4ccb-3bf3-e7aa4da0da88.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9a6f06bb81116f23a6f05b8438608044" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/a7ea3baf-2689-4ccb-3bf3-e7aa4da0da88.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa7ea3baf-2689-4ccb-3bf3-e7aa4da0da88.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=18f76db7c26ba6c987a2a12684d59a52 1x" loading="lazy"></a></p>

<p>SampleService.cs の中身は以下をコピペして保存してください。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">MagicOnion</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MagicOnion.Server</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Sample.Shared.Services</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Sample.Server.Services</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SampleService</span> <span class="p">:</span> <span class="n">ServiceBase</span><span class="p">&lt;</span><span class="n">ISampleService</span><span class="p">&gt;,</span> <span class="n">ISampleService</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">UnaryResult</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="nf">SumAsync</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">UnaryResult</span><span class="p">(</span><span class="n">x</span> <span class="p">+</span> <span class="n">y</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">UnaryResult</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="nf">ProductAsync</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">UnaryResult</span><span class="p">(</span><span class="n">x</span> <span class="p">*</span> <span class="n">y</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4>
<span id="413-unity-側で-api-を呼ぶコードを実装する" class="fragment"></span><a href="#413-unity-%E5%81%B4%E3%81%A7-api-%E3%82%92%E5%91%BC%E3%81%B6%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>4.1.3. Unity 側で API を呼ぶコードを実装する</h4>

<p>SampleController に SampleService を呼び出すコードを追加します。<br>
下記のコードをコピペして上書きしてください。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Grpc.Core</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MagicOnion.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Sample.Shared.Services</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">SampleController</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">Channel</span> <span class="n">channel</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">ISampleService</span> <span class="n">sampleService</span><span class="p">;</span>

    <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">channel</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Channel</span><span class="p">(</span><span class="s">"localhost:12345"</span><span class="p">,</span> <span class="n">ChannelCredentials</span><span class="p">.</span><span class="n">Insecure</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="n">sampleService</span> <span class="p">=</span> <span class="n">MagicOnionClient</span><span class="p">.</span><span class="n">Create</span><span class="p">&lt;</span><span class="n">ISampleService</span><span class="p">&gt;(</span><span class="n">channel</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nf">SampleServiceTest</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="k">void</span> <span class="nf">OnDestroy</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">channel</span><span class="p">.</span><span class="nf">ShutdownAsync</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="k">void</span> <span class="nf">SampleServiceTest</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">sumReuslt</span> <span class="p">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">sampleService</span><span class="p">.</span><span class="nf">SumAsync</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">sumReuslt</span><span class="p">)}</span><span class="s">: </span><span class="p">{</span><span class="n">sumReuslt</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>

        <span class="kt">var</span> <span class="n">productResult</span> <span class="p">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">sampleService</span><span class="p">.</span><span class="nf">ProductAsync</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">);</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">productResult</span><span class="p">)}</span><span class="s">: </span><span class="p">{</span><span class="n">productResult</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4>
<span id="414-api-通信の動作確認" class="fragment"></span><a href="#414-api-%E9%80%9A%E4%BF%A1%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>4.1.4. API 通信の動作確認</h4>

<p>まずはサーバーを起動します。</p>

<p>Sample.Server を右クリックして、<code>スタートアッププロジェクトに設定</code> をクリックします。<br>
<a href="https://camo.qiitausercontent.com/5ad60e7aa7c325ce05e9f1199cc9346d3abcd743/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f35646138386631652d353937382d313037642d393562302d6665363537363365333664622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5da88f1e-5978-107d-95b0-fe65763e36db.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a31cc7c5e37f4ce195e5b85ca5dcb8f6" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/5da88f1e-5978-107d-95b0-fe65763e36db.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5da88f1e-5978-107d-95b0-fe65763e36db.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=58c2c207db15ae5beec2493fd86e2e5b 1x" loading="lazy"></a></p>

<p>これによって、普段は <code>Unity にアタッチ</code> と表示されていたボタンが <code>Sample.Server</code> の表示に変わります。<br>
<a href="https://camo.qiitausercontent.com/4cad169d773d10ed61238b3a193820ca1d2c6891/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f64353264643063332d396639312d343965352d316631612d6337336463313137663036632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fd52dd0c3-9f91-49e5-1f1a-c73dc117f06c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=218cebf717bde7a504ddce3ec3ae79f1" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/d52dd0c3-9f91-49e5-1f1a-c73dc117f06c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fd52dd0c3-9f91-49e5-1f1a-c73dc117f06c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=07170a249c31cbccc208a640a6f7f556 1x" loading="lazy"></a></p>

<p>このボタンを押すとサーバーを起動することができます。</p>

<p><a href="https://camo.qiitausercontent.com/37fc926aa4b8f4e12c7acad2a8e50628af18a8cf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f66303933313338342d346435642d356361302d323939652d3532616361326238316636302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Ff0931384-4d5d-5ca0-299e-52aca2b81f60.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7429b5f7d3a83333fc38340ea2ca291f" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/f0931384-4d5d-5ca0-299e-52aca2b81f60.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Ff0931384-4d5d-5ca0-299e-52aca2b81f60.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=fcf162ead0fc4c487e3cbe0efe9fdde8 1x" loading="lazy"></a></p>

<p>※スタートアッププロジェクトを元に戻す場合は <code>Assembly-CSharp</code> を右クリックしてスタートアッププロジェクトに指定します。<br>
※Unity にアタッチしつつサーバーを起動したい場合は <code>マルチスタートアッププロジェクト</code> を使用します。（後述）</p>

<p>続いてサーバーを起動した状態で Unity の Scene を再生します。</p>

<p>Unity の Console にログが表示されました。<br>
<a href="https://camo.qiitausercontent.com/3deb83b18acdc9fdd4e7fb50187f6e091a92b050/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f33323665373436312d366161312d333432362d653833382d3263383137313064643662622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F326e7461-6aa1-3426-e838-2c81710dd6bb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3900895a0245c7a12c6a46b19cecf09b" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/326e7461-6aa1-3426-e838-2c81710dd6bb.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F326e7461-6aa1-3426-e838-2c81710dd6bb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=dbaeb8d1f810d16a7b8ee7b917377e22 1x" loading="lazy"></a></p>

<h3>
<span id="42-リアルタイム通信" class="fragment"></span><a href="#42-%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E9%80%9A%E4%BF%A1"><i class="fa fa-link"></i></a>4.2. リアルタイム通信</h3>

<p>続いてリアルタイム通信を試してみます。</p>

<h4>
<span id="421-unity-側で-api-の定義を作る" class="fragment"></span><a href="#421-unity-%E5%81%B4%E3%81%A7-api-%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>4.2.1. Unity 側で API の定義を作る</h4>

<p>普通の API 通信と同じく、まずは API の定義から作ります。<br>
Assets\Scripts\ServerShared\Hubs 以下に SampleHub スクリプトを作ります。</p>

<p><a href="https://camo.qiitausercontent.com/ff5e1fbd0cc5e5992118945f311d18c074f0d426/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f64353030356263652d313734642d353535662d386364322d3461643666303034346639342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fd5005bce-174d-555f-8cd2-4ad6f0044f94.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=89c0225537a60466a95c7209f673bf19" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/d5005bce-174d-555f-8cd2-4ad6f0044f94.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fd5005bce-174d-555f-8cd2-4ad6f0044f94.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=fcb55bbf1f239260616e6add74123a70 1x" loading="lazy"></a></p>

<p>SampleHub の中身は以下をコピペして保存してください。<br>
今回はゲームにログイン、チャットで発言、位置情報を更新、ゲームから切断、という4つの API を作ります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">MagicOnion</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Sample.Shared.MessagePackObjects</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Sample.Shared.Hubs</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// CLient -&gt; ServerのAPI</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">ISampleHub</span> <span class="p">:</span> <span class="n">IStreamingHub</span><span class="p">&lt;</span><span class="n">ISampleHub</span><span class="p">,</span> <span class="n">ISampleHubReceiver</span><span class="p">&gt;</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// ゲームに接続することをサーバに伝える</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="n">Task</span> <span class="nf">JoinAsync</span><span class="p">(</span><span class="n">Player</span> <span class="n">player</span><span class="p">);</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// ゲームから切断することをサーバに伝える</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="n">Task</span> <span class="nf">LeaveAsync</span><span class="p">();</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// メッセージをサーバに伝える</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="n">Task</span> <span class="nf">SendMessageAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">);</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 移動したことをサーバに伝える</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="n">Task</span> <span class="nf">MovePositionAsync</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">position</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// Server -&gt; ClientのAPI</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">ISampleHubReceiver</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 誰かがゲームに接続したことをクライアントに伝える</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">void</span> <span class="nf">OnJoin</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">);</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 誰かがゲームから切断したことをクライアントに伝える</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">void</span> <span class="nf">OnLeave</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">);</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 誰かが発言した事をクライアントに伝える</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">void</span> <span class="nf">OnSendMessage</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">string</span> <span class="n">message</span><span class="p">);</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 誰かが移動した事をクライアントに伝える</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">void</span> <span class="nf">OnMovePosition</span><span class="p">(</span><span class="n">Player</span> <span class="n">player</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4>
<span id="422-サーバー側で-api-を実装する" class="fragment"></span><a href="#422-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%A7-api-%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>4.2.2 サーバー側で API を実装する</h4>

<p>普通の API の実装の時と同じ要領で、Sample.Server 以下に Hubs フォルダを作り、その中に SampleHub.cs を作ります。<br>
<a href="https://camo.qiitausercontent.com/6e65f4b1070409981d2d832a1da80183227f9a88/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f35303731393534652d613439642d393536632d383761302d6236386232613835353834312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5071954e-a49d-956c-87a0-b68b2a855841.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=fa35ad625abf685647126dd18cb19d35" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/5071954e-a49d-956c-87a0-b68b2a855841.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5071954e-a49d-956c-87a0-b68b2a855841.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=25f53bb4d4a91be91895eec6f9c0e239 1x" loading="lazy"></a></p>

<p>SampleHub.cs の中身は以下をコピペして保存してください。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">MagicOnion.Server.Hubs</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Sample.Shared.Hubs</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Sample.Shared.MessagePackObjects</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">SampleHub</span> <span class="p">:</span> <span class="n">StreamingHubBase</span><span class="p">&lt;</span><span class="n">ISampleHub</span><span class="p">,</span> <span class="n">ISampleHubReceiver</span><span class="p">&gt;,</span> <span class="n">ISampleHub</span>
<span class="p">{</span>
    <span class="n">IGroup</span> <span class="n">room</span><span class="p">;</span>
    <span class="n">Player</span> <span class="n">me</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">JoinAsync</span><span class="p">(</span><span class="n">Player</span> <span class="n">player</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//ルームは全員固定</span>
        <span class="k">const</span> <span class="kt">string</span> <span class="n">roomName</span> <span class="p">=</span> <span class="s">"SampleRoom"</span><span class="p">;</span>
        <span class="c1">//ルームに参加&amp;ルームを保持</span>
        <span class="k">this</span><span class="p">.</span><span class="n">room</span> <span class="p">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">Group</span><span class="p">.</span><span class="nf">AddAsync</span><span class="p">(</span><span class="n">roomName</span><span class="p">);</span>
        <span class="c1">//自分の情報も保持</span>
        <span class="n">me</span> <span class="p">=</span> <span class="n">player</span><span class="p">;</span>
        <span class="c1">//参加したことをルームに参加している全メンバーに通知</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">Broadcast</span><span class="p">(</span><span class="n">room</span><span class="p">).</span><span class="nf">OnJoin</span><span class="p">(</span><span class="n">me</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">LeaveAsync</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//ルーム内のメンバーから自分を削除</span>
        <span class="k">await</span> <span class="n">room</span><span class="p">.</span><span class="nf">RemoveAsync</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">);</span>
        <span class="c1">//退室したことを全メンバーに通知</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">Broadcast</span><span class="p">(</span><span class="n">room</span><span class="p">).</span><span class="nf">OnLeave</span><span class="p">(</span><span class="n">me</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">SendMessageAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//発言した内容を全メンバーに通知</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">Broadcast</span><span class="p">(</span><span class="n">room</span><span class="p">).</span><span class="nf">OnSendMessage</span><span class="p">(</span><span class="n">me</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>

        <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="n">CompletedTask</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">MovePositionAsync</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">position</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// サーバー上の情報を更新</span>
        <span class="n">me</span><span class="p">.</span><span class="n">Position</span> <span class="p">=</span> <span class="n">position</span><span class="p">;</span>

        <span class="c1">//更新したプレイヤーの情報を全メンバーに通知</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">Broadcast</span><span class="p">(</span><span class="n">room</span><span class="p">).</span><span class="nf">OnMovePosition</span><span class="p">(</span><span class="n">me</span><span class="p">);</span>

        <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="n">CompletedTask</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="n">ValueTask</span> <span class="nf">OnConnecting</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// handle connection if needed.</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"client connected </span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">.</span><span class="n">ContextId</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">CompletedTask</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="n">ValueTask</span> <span class="nf">OnDisconnected</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// handle disconnection if needed.</span>
        <span class="c1">// on disconnecting, if automatically removed this connection from group.</span>
        <span class="k">return</span> <span class="n">CompletedTask</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4>
<span id="423-unity-側で-api-を呼ぶコードを実装する" class="fragment"></span><a href="#423-unity-%E5%81%B4%E3%81%A7-api-%E3%82%92%E5%91%BC%E3%81%B6%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>4.2.3. Unity 側で API を呼ぶコードを実装する</h4>

<p>SampleController に SampleHub の各 API を呼び出すコードを追加します。<br>
下記のコードをコピペして上書きしてください。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Grpc.Core</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MagicOnion.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Sample.Shared.Hubs</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Sample.Shared.MessagePackObjects</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Sample.Shared.Services</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">SampleController</span> <span class="p">:</span> <span class="n">MonoBehaviour</span><span class="p">,</span> <span class="n">ISampleHubReceiver</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">Channel</span> <span class="n">channel</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">ISampleService</span> <span class="n">sampleService</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">ISampleHub</span> <span class="n">sampleHub</span><span class="p">;</span>

    <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">channel</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Channel</span><span class="p">(</span><span class="s">"localhost:12345"</span><span class="p">,</span> <span class="n">ChannelCredentials</span><span class="p">.</span><span class="n">Insecure</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="n">sampleService</span> <span class="p">=</span> <span class="n">MagicOnionClient</span><span class="p">.</span><span class="n">Create</span><span class="p">&lt;</span><span class="n">ISampleService</span><span class="p">&gt;(</span><span class="n">channel</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="n">sampleHub</span> <span class="p">=</span> <span class="n">StreamingHubClient</span><span class="p">.</span><span class="n">Connect</span><span class="p">&lt;</span><span class="n">ISampleHub</span><span class="p">,</span> <span class="n">ISampleHubReceiver</span><span class="p">&gt;(</span><span class="k">this</span><span class="p">.</span><span class="n">channel</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

        <span class="c1">// 普通の API の呼び出しはコメントアウトしておきます</span>
        <span class="c1">// 残しておいても問題はないです（リアルタイム通信と両方動きます）</span>
        <span class="c1">//this.SampleServiceTest(1, 2);</span>

        <span class="k">this</span><span class="p">.</span><span class="nf">SampleHubTest</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="k">void</span> <span class="nf">OnDestroy</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">sampleHub</span><span class="p">.</span><span class="nf">DisposeAsync</span><span class="p">();</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">channel</span><span class="p">.</span><span class="nf">ShutdownAsync</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 普通のAPI通信のテスト用のメソッド</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">async</span> <span class="k">void</span> <span class="nf">SampleServiceTest</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">sumReuslt</span> <span class="p">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">sampleService</span><span class="p">.</span><span class="nf">SumAsync</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">sumReuslt</span><span class="p">)}</span><span class="s">: </span><span class="p">{</span><span class="n">sumReuslt</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>

        <span class="kt">var</span> <span class="n">productResult</span> <span class="p">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">sampleService</span><span class="p">.</span><span class="nf">ProductAsync</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">);</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">productResult</span><span class="p">)}</span><span class="s">: </span><span class="p">{</span><span class="n">productResult</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// リアルタイム通信のテスト用のメソッド</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">async</span> <span class="k">void</span> <span class="nf">SampleHubTest</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 自分のプレイヤー情報を作ってみる</span>
        <span class="kt">var</span> <span class="n">player</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Player</span>
        <span class="p">{</span>
            <span class="n">Name</span> <span class="p">=</span> <span class="s">"Minami"</span><span class="p">,</span>
            <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
            <span class="n">Rotation</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Quaternion</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">};</span>

        <span class="c1">// ゲームに接続する</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">sampleHub</span><span class="p">.</span><span class="nf">JoinAsync</span><span class="p">(</span><span class="n">player</span><span class="p">);</span>

        <span class="c1">// チャットで発言してみる</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">sampleHub</span><span class="p">.</span><span class="nf">SendMessageAsync</span><span class="p">(</span><span class="s">"こんにちは！"</span><span class="p">);</span>

        <span class="c1">// 位置情報を更新してみる</span>
        <span class="n">player</span><span class="p">.</span><span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">sampleHub</span><span class="p">.</span><span class="nf">MovePositionAsync</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">Position</span><span class="p">);</span>

        <span class="c1">// ゲームから切断してみる</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">sampleHub</span><span class="p">.</span><span class="nf">LeaveAsync</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="err">#</span><span class="n">region</span> <span class="err">リアルタイム通信でサーバーから呼ばれるメソッド群</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnJoin</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">name</span><span class="p">}</span><span class="s">さんが入室しました"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnLeave</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">name</span><span class="p">}</span><span class="s">さんが退室しました"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnSendMessage</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnMovePosition</span><span class="p">(</span><span class="n">Player</span> <span class="n">player</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">player</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="s">さんが移動しました: </span><span class="p">{{</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span><span class="n">player</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span><span class="p">},</span> <span class="n">y</span><span class="p">:</span> <span class="p">{</span><span class="n">player</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">y</span><span class="p">},</span> <span class="n">z</span><span class="p">:</span> <span class="p">{</span><span class="n">player</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">z</span><span class="p">}</span> <span class="p">}}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="err">#</span><span class="n">endregion</span>
<span class="p">}</span>
</code></pre></div></div>

<h4>
<span id="424-リアルタイム通信の動作確認" class="fragment"></span><a href="#424-%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E9%80%9A%E4%BF%A1%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>4.2.4. リアルタイム通信の動作確認</h4>

<p>普通の API 通信の動作確認と同じ要領でサーバーを起動し、その後で Unity で Scene を再生します。</p>

<p>Unity の Console にログが表示されました。<br>
<a href="https://camo.qiitausercontent.com/09e347e36b5d1b6f16e544f9bdf0d9aff7b95285/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f63656130386533652d363133342d376535382d646238312d3838353730646561653864392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcea08e3e-6134-7e58-db81-88570deae8d9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ec26ddbbeaa7121e49ac9c7d8bfa07f6" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/cea08e3e-6134-7e58-db81-88570deae8d9.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcea08e3e-6134-7e58-db81-88570deae8d9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=acb1b73e51c8d4dd67caf4b711196bba 1x" loading="lazy"></a></p>

<p>これで普通の API 通信とリアルタイム通信の両方の動作確認ができました。</p>

<h2>
<span id="5-il2cpp-対応コードジェネレーターによるコード生成" class="fragment"></span><a href="#5-il2cpp-%E5%AF%BE%E5%BF%9C%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AC%E3%83%BC%E3%82%BF%E3%83%BC%E3%81%AB%E3%82%88%E3%82%8B%E3%82%B3%E3%83%BC%E3%83%89%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>5. IL2CPP 対応（コードジェネレーターによるコード生成）</h2>

<p>UnityEditor 上で動かすなら今のままでも問題ないのですが、IL2CPP を使う場合（例えば Platform を iOS にしたとき）はこのようなエラーが発生します。</p>

<p><a href="https://camo.qiitausercontent.com/78dae975c90be7ade2f596af3557024955b06bbb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f65366263326330652d393032332d666661632d653431382d6438633330303737616537632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fe6bc2c0e-9023-ffac-e418-d8c30077ae7c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8cb872febfd4dcd3cee967817001568b" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/e6bc2c0e-9023-ffac-e418-d8c30077ae7c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fe6bc2c0e-9023-ffac-e418-d8c30077ae7c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=cd7999a303c50748e3439b0649103076 1x" loading="lazy"></a></p>

<p>IL2CPP は動的なコード生成に対応していないため、コードジェネレーターを使用して事前に必要なコードを生成する必要があります。</p>

<h3>
<span id="51-magiconionmsbuildtasks-のインストール" class="fragment"></span><a href="#51-magiconionmsbuildtasks-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>5.1. MagicOnion.MSBuild.Tasks のインストール</h3>

<p>NuGet で MagicOnion.MSBuild.Tasks をインストールします。<br>
プロジェクトは Sample.Shared を選択し、バージョンは 3.0.12 を選択します。<br>
<a href="https://camo.qiitausercontent.com/48f15c34acd81d52cd3e5ca8dbc653420af9866b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f32313362303531632d383539352d323732382d373537362d6338653039343239626261632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F213b051c-8595-2728-7576-c8e09429bbac.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=138ab9c60b45fc6a1ce053f1d098a61b" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/213b051c-8595-2728-7576-c8e09429bbac.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F213b051c-8595-2728-7576-c8e09429bbac.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=09cdceacef106be8c293c2244a04661d 1x" loading="lazy"></a></p>

<h3>
<span id="52-messagepackmsbuildtasks-のインストール" class="fragment"></span><a href="#52-messagepackmsbuildtasks-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>5.2. MessagePack.MSBuild.Tasks のインストール</h3>

<p>同じ要領で MessagePack.MSBuild.Tasks もインストールします。<br>
<a href="https://camo.qiitausercontent.com/1b7426ee3cbb836a98ccffcdcf733d3cdb92ccd5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f63333966393563302d636234312d326330302d643234392d6265643135346564363532312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fc39f95c0-cb41-2c00-d249-bed154ed6521.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=87a7a18d0ecb370abc99a0a22b21d07d" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/c39f95c0-cb41-2c00-d249-bed154ed6521.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fc39f95c0-cb41-2c00-d249-bed154ed6521.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5b15477e7c0bf840df03cfcca983ddd9 1x" loading="lazy"></a></p>

<h3>
<span id="53-samplesharedcsproj-の編集" class="fragment"></span><a href="#53-samplesharedcsproj-%E3%81%AE%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>5.3. Sample.Shared.csproj の編集</h3>

<p>Sample.Shared をダブルクリックし、Sample.Shared.csproj を開きます。<br>
赤枠部分のコードを追加して保存します。<br>
コードは以下をコピペしてください。</p>

<p><a href="https://camo.qiitausercontent.com/e5927da1d3c01e20330a2a0a4719ab4061da13c2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f65653637656662312d396432372d323933612d316431652d3163313833623539333031332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fee67efb1-9d27-293a-1d1e-1c183b593013.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b60847ae7c5a1c6c661a576f842e6680" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/ee67efb1-9d27-293a-1d1e-1c183b593013.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fee67efb1-9d27-293a-1d1e-1c183b593013.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b99250fc1a5002154526982ba0bcd8b6 1x" loading="lazy"></a></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="p">&lt;</span><span class="n">Target</span> <span class="n">Name</span><span class="p">=</span><span class="s">"GenerateMessagePack"</span> <span class="n">AfterTargets</span><span class="p">=</span><span class="s">"Compile"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="n">MessagePackGenerator</span> <span class="n">Input</span><span class="p">=</span><span class="s">".\Sample.Shared.csproj"</span> <span class="n">Output</span><span class="p">=</span><span class="s">"..\Sample.Unity\Assets\Scripts\Generated\MessagePack.Generated.cs"</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="n">Target</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="n">Target</span> <span class="n">Name</span><span class="p">=</span><span class="s">"GenerateMagicOnion"</span> <span class="n">AfterTargets</span><span class="p">=</span><span class="s">"Compile"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="n">MagicOnionGenerator</span> <span class="n">Input</span><span class="p">=</span><span class="s">".\Sample.Shared.csproj"</span> <span class="n">Output</span><span class="p">=</span><span class="s">"..\Sample.Unity\Assets\Scripts\Generated\MagicOnion.Generated.cs"</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="n">Target</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>この状態で Sample.Server をビルドすると Sample.Unity\Assets\Scripts\Generated 以下にコードジェネレーターによってコードが生成されます。</p>

<p><a href="https://camo.qiitausercontent.com/ae76072563656978f770d84ba1e1099aa1df5d4a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f35356164313964352d643565382d633034342d663661352d3831616234623339633633392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F55ad19d5-d5e8-c044-f6a5-81ab4b39c639.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1001aab7bf59571c70f9292aea6ddea8" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/55ad19d5-d5e8-c044-f6a5-81ab4b39c639.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F55ad19d5-d5e8-c044-f6a5-81ab4b39c639.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1a1e76830b5b7c5694a433c3780b137f 1x" loading="lazy"></a></p>

<h3>
<span id="54-生成されたコードの使用" class="fragment"></span><a href="#54-%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%81%9F%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E4%BD%BF%E7%94%A8"><i class="fa fa-link"></i></a>5.4. 生成されたコードの使用</h3>

<p>次にこのコードを使用する設定を行います。<br>
Scripts フォルダに C# Script を作り、名前を InitialSettings とします。</p>

<p><a href="https://camo.qiitausercontent.com/81d6544a4111ed091cc443b2175f7f4b9d87ba3e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f36336264356463662d373662392d663036392d343362362d3438636438663661663865392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F63bd5dcf-76b9-f069-43b6-48cd8f6af8e9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5ea16c696721b2deb22d7af748ee5e95" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/63bd5dcf-76b9-f069-43b6-48cd8f6af8e9.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F63bd5dcf-76b9-f069-43b6-48cd8f6af8e9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5300935f2acef2fdfebe8edb2e47fad7 1x" loading="lazy"></a></p>

<p>InitialSettings のコードは下記をコピペして保存します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">MessagePack</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MessagePack.Resolvers</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Assets.Scripts</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">InitialSettings</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">RuntimeInitializeOnLoadMethod</span><span class="p">(</span><span class="n">RuntimeInitializeLoadType</span><span class="p">.</span><span class="n">BeforeSceneLoad</span><span class="p">)]</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">RegisterResolvers</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// NOTE: Currently, CompositeResolver doesn't work on Unity IL2CPP build. Use StaticCompositeResolver instead of it.</span>
            <span class="n">StaticCompositeResolver</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span>
                <span class="n">MagicOnion</span><span class="p">.</span><span class="n">Resolvers</span><span class="p">.</span><span class="n">MagicOnionResolver</span><span class="p">.</span><span class="n">Instance</span><span class="p">,</span>
                <span class="n">MessagePack</span><span class="p">.</span><span class="n">Resolvers</span><span class="p">.</span><span class="n">GeneratedResolver</span><span class="p">.</span><span class="n">Instance</span><span class="p">,</span>
                <span class="n">BuiltinResolver</span><span class="p">.</span><span class="n">Instance</span><span class="p">,</span>
                <span class="n">PrimitiveObjectResolver</span><span class="p">.</span><span class="n">Instance</span><span class="p">,</span>
                <span class="n">MessagePack</span><span class="p">.</span><span class="n">Unity</span><span class="p">.</span><span class="n">UnityResolver</span><span class="p">.</span><span class="n">Instance</span>
            <span class="p">);</span>

            <span class="n">MessagePackSerializer</span><span class="p">.</span><span class="n">DefaultOptions</span> <span class="p">=</span> <span class="n">MessagePackSerializer</span><span class="p">.</span><span class="n">DefaultOptions</span>
                <span class="p">.</span><span class="nf">WithResolver</span><span class="p">(</span><span class="n">StaticCompositeResolver</span><span class="p">.</span><span class="n">Instance</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これで IL2CPP の環境でも動作するようになりました。</p>

<h2>
<span id="6-ios-ビルド対応" class="fragment"></span><a href="#6-ios-%E3%83%93%E3%83%AB%E3%83%89%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>6. iOS ビルド対応</h2>

<p>iOS 用のビルドではさらに以下の追加作業が必要です。</p>

<ul>
<li>Disable Bitcode</li>
<li>Add libz.tbd</li>
</ul>

<p>Assets\Editor に C# Script を追加し、名前を BuildIos とします。<br>
<a href="https://camo.qiitausercontent.com/0361ddd1b3a1898c3cf2781c98ec3fb65b9661e9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f66383834343937642d656330642d356662352d306639622d3163656465376364313338312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Ff884497d-ec0d-5fb5-0f9b-1cede7cd1381.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1cdc992b2448ced48e6dba76b69e4fb3" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/f884497d-ec0d-5fb5-0f9b-1cede7cd1381.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Ff884497d-ec0d-5fb5-0f9b-1cede7cd1381.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=dd4aee6ac487d88fd9a90aaa00a39786 1x" loading="lazy"></a></p>

<p>BuildIos のコードは以下をコピペします。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="cp">#if UNITY_IPHONE
</span><span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEditor.Callbacks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEditor.iOS.Xcode</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">BuildIos</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// Handle libgrpc project settings.</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="c1">/// &lt;param name="target"&gt;&lt;/param&gt;</span>
    <span class="c1">/// &lt;param name="path"&gt;&lt;/param&gt;</span>
    <span class="p">[</span><span class="nf">PostProcessBuild</span><span class="p">(</span><span class="m">1</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">OnPostProcessBuild</span><span class="p">(</span><span class="n">BuildTarget</span> <span class="n">target</span><span class="p">,</span> <span class="kt">string</span> <span class="n">path</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">projectPath</span> <span class="p">=</span> <span class="n">PBXProject</span><span class="p">.</span><span class="nf">GetPBXProjectPath</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">project</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PBXProject</span><span class="p">();</span>
        <span class="n">project</span><span class="p">.</span><span class="nf">ReadFromString</span><span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="nf">ReadAllText</span><span class="p">(</span><span class="n">projectPath</span><span class="p">));</span>
        <span class="kt">var</span> <span class="n">targetGuid</span> <span class="p">=</span> <span class="n">project</span><span class="p">.</span><span class="nf">GetUnityFrameworkTargetGuid</span><span class="p">();</span>

        <span class="c1">// libz.tbd for grpc ios build</span>
        <span class="n">project</span><span class="p">.</span><span class="nf">AddFrameworkToProject</span><span class="p">(</span><span class="n">targetGuid</span><span class="p">,</span> <span class="s">"libz.tbd"</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>

        <span class="c1">// libgrpc_csharp_ext missing bitcode. as BITCODE exand binary size to 250MB.</span>
        <span class="n">project</span><span class="p">.</span><span class="nf">SetBuildProperty</span><span class="p">(</span><span class="n">targetGuid</span><span class="p">,</span> <span class="s">"ENABLE_BITCODE"</span><span class="p">,</span> <span class="s">"NO"</span><span class="p">);</span>

        <span class="n">File</span><span class="p">.</span><span class="nf">WriteAllText</span><span class="p">(</span><span class="n">projectPath</span><span class="p">,</span> <span class="n">project</span><span class="p">.</span><span class="nf">WriteToString</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">#endif
</span></code></pre></div></div>

<p>環境構築は以上で終了です。お疲れさまでした。</p>

<h2>
<span id="7-マルチスタートアッププロジェクトについて" class="fragment"></span><a href="#7-%E3%83%9E%E3%83%AB%E3%83%81%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>7. マルチスタートアッププロジェクトについて</h2>

<p>途中で説明を割愛したマルチスタートアッププロジェクトの利用方法です。<br>
ソリューションを右クリックして、<code>スタートアッププロジェクトの設定</code> をクリックします。</p>

<p><a href="https://camo.qiitausercontent.com/9107e5388fe4f26bd0d5ba521177414fdbbe4e1e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f64633432396230362d383433332d366336622d323736322d3863646564376238626131342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fdc429b06-8433-6c6b-2762-8cded7b8ba14.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=92b51386be023eff92dfaef48ccf5884" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/dc429b06-8433-6c6b-2762-8cded7b8ba14.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fdc429b06-8433-6c6b-2762-8cded7b8ba14.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=35d1674b969bb10d613d3b144063dc91 1x" loading="lazy"></a></p>

<p><code>マルチスタートアッププロジェクト</code> にチェックをいれ、<code>Assembly-CSharp</code> と <code>Sample.Server</code> のアクションを <code>開始</code> にして OK を押します。</p>

<p>この状態で <code>開始</code> を押すとデバッガーを Unity にアタッチしながらサーバーを起動することができます。<br>
<a href="https://camo.qiitausercontent.com/2d5b7415cbbc45dd96fd24f68916a381673cd4a5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f30343263643336382d633137362d643732632d613730352d6264383464373761356237612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F042cd368-c176-d72c-a705-bd84d77a5b7a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e85e1fa1669a72850f39af1cc7a7297a" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/042cd368-c176-d72c-a705-bd84d77a5b7a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F042cd368-c176-d72c-a705-bd84d77a5b7a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=11e618129f598bab8c8e82d4147f748b 1x" loading="lazy"></a></p>

<h2>
<span id="8-後書きと参考にさせていただいた記事などへのリンク" class="fragment"></span><a href="#8-%E5%BE%8C%E6%9B%B8%E3%81%8D%E3%81%A8%E5%8F%82%E8%80%83%E3%81%AB%E3%81%95%E3%81%9B%E3%81%A6%E3%81%84%E3%81%9F%E3%81%A0%E3%81%84%E3%81%9F%E8%A8%98%E4%BA%8B%E3%81%AA%E3%81%A9%E3%81%B8%E3%81%AE%E3%83%AA%E3%83%B3%E3%82%AF"><i class="fa fa-link"></i></a>8. 後書きと参考にさせていただいた記事などへのリンク</h2>

<p>こんなに長い記事を最後まで読んでいただいてありがとうございます。<br>
少しでも役に立つことがあれば幸いです。</p>

<p>環境構築に成功して、より技術的な内容や実践的なコードが必要になった際は下記の記事などがおすすめです。</p>

<ul>
<li><a href="https://github.com/Cysharp/MagicOnion" rel="nofollow noopener" target="_blank">GitHub の MagicOnion の README</a></li>
<li><a href="https://github.com/Cysharp/MagicOnion/tree/master/samples" rel="nofollow noopener" target="_blank">公式の MagicOnion の Sample</a></li>
<li><a href="http://tech.cygames.co.jp/archives/3181/" rel="nofollow noopener" target="_blank">Cygames Engineers' Blog MagicOnion – C#による .NET Core/Unity 用のリアルタイム通信フレームワーク</a></li>
<li><a href="https://qiita.com/mitchydeath/items/cecf01493d1efeb4ae55" id="reference-405401379e510df0f2d2">Unity+MagicOnionで超絶手軽にリアルタイム通信を実装してみた</a></li>
<li><a href="https://qiita.com/yKimisaki/items/1d55b08f3e7bcae46585" id="reference-ec80272cbd1a2c12635d">MagicOnion v2を使ってUnity IL2CPPでgRPC通信をする</a></li>
</ul>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2F_y_minami%2Fitems%2Fdb7b19eb5979ef1d6fe9&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2F_y_minami%2Fitems%2Fdb7b19eb5979ef1d6fe9&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/_y_minami/items/db7b19eb5979ef1d6fe9/likers" class="css-1iupg5d">25</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">25</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/db7b19eb5979ef1d6fe9/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/_y_minami/items/db7b19eb5979ef1d6fe9/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/_y_minami/items/db7b19eb5979ef1d6fe9/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/_y_minami/items/db7b19eb5979ef1d6fe9/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/_y_minami/items/db7b19eb5979ef1d6fe9.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-1c2cdd90-f767-4e0a-b444-a7938ab54478">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-8c776f96-eb5d-4c7f-805b-8202b9af60bf"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-8c776f96-eb5d-4c7f-805b-8202b9af60bf">{}</script>
      
<div id="LoginModal-react-component-064d80eb-3e01-44fd-85e7-56159f7555bf"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-064d80eb-3e01-44fd-85e7-56159f7555bf">{}</script>
      
<div id="StockModal-react-component-ef5d1580-8885-4ae9-8866-62b9e8f2421b"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-ef5d1580-8885-4ae9-8866-62b9e8f2421b">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;goWKyGFfQVn6FZyg0pQatpshS48UYSfB5gfy0unBct8iLmJlqkeTZO/XMmm2XswPs18Xh3j1nw9T0RIDuCvX9w==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch2\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h2\u003e\n\n\u003cp\u003eMagicOnion は一度環境を構築してしまえば、触り心地が良くてとても使いやすいフレームワークだと思います。\u003c/p\u003e\n\n\u003cp\u003eしかし初期構築がやや複雑で、特に Unity と サーバー(.NET Core) の両方の経験が無い方が挑戦した場合はどこかでつまづいてしまうことも多いのではないかと思いました。\u003c/p\u003e\n\n\u003cp\u003eそこで、どちらかの経験が無い方でもつまずかずにポチポチと環境構築できる資料を目指して書いたのがこの記事になります。\u003c/p\u003e\n\n\u003cp\u003eもし途中でつまづくところがありましたら Twitter で教えていただけると喜びます。\u003c/p\u003e\n\n\u003cp\u003eハンズオンの所要時間は Unity と VisualStudio をインストール済みの状態から開始して、30分～1時間程度です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"目次\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%AE%E6%AC%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e目次\u003c/h2\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-環境について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E7%92%B0%E5%A2%83%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. 環境について\u003c/h2\u003e\n\n\u003cp\u003e本記事を書くにあたって使用した OS、ツール、ソフトウェアのバージョンです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eWindows 10\u003c/li\u003e\n\u003cli\u003eUnity 2019.4.7f1\u003c/li\u003e\n\u003cli\u003eVisual Studio 2019 16.7\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Cysharp/MagicOnion/releases/tag/3.0.12\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMagicOnion 3.0.12\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/neuecc/MessagePack-CSharp/releases/tag/v2.1.152\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMessagePack 2.1.152\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://packages.grpc.io/archive/2019/08/e14154481baf7e23710b60b78a1e91299985ec80-41fb322e-6416-4509-9a6f-2b17085b6272/index.xml\" rel=\"nofollow noopener\" target=\"_blank\"\u003egRPC 2.23.0\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-unity-側の構築\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-unity-%E5%81%B4%E3%81%AE%E6%A7%8B%E7%AF%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. Unity 側の構築\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"21-プロジェクトの新規作成playersettings-の変更各種フォルダの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#21-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E6%96%B0%E8%A6%8F%E4%BD%9C%E6%88%90playersettings-%E3%81%AE%E5%A4%89%E6%9B%B4%E5%90%84%E7%A8%AE%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.1. プロジェクトの新規作成、PlayerSettings の変更、各種フォルダの作成\u003c/h3\u003e\n\n\u003cp\u003e今回は 3D プロジェクトを作成します。\u003cbr\u003e\nプロジェクト名は任意ですが、サーバーサイドのプロジェクトと見分けやすいように \u003ccode\u003eSample.Unity\u003c/code\u003e とします。\u003c/p\u003e\n\n\u003cp\u003e保存先は任意の保存先を入力してください。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/eddf655cd83612a88e467f6ea5011fc3d0e18bc8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f35653738663534332d363065362d366665322d663238342d3236323366333633396539322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5e78f543-60e6-6fe2-f284-2623f3639e92.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f9b1f119ea904117ee8374bda6814d4a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/5e78f543-60e6-6fe2-f284-2623f3639e92.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5e78f543-60e6-6fe2-f284-2623f3639e92.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f4106ef96ea8100c62258fa7d453bad6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eUnity が起動したら \u003ccode\u003ePlayerSettings\u003c/code\u003e を開きます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/1e940dc510e9ce45b6caf153d00168c0a29143bf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f61623963643632652d336436662d363534612d623339652d6137623964366361336133632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fab9cd62e-3d6f-654a-b39e-a7b9d6ca3a3c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6ccea44d1a28a116fc77d90022e98130\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/ab9cd62e-3d6f-654a-b39e-a7b9d6ca3a3c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fab9cd62e-3d6f-654a-b39e-a7b9d6ca3a3c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=462293825927008b79a65445dea5dd59 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003ePlayer\u003c/code\u003e を選択して、下記の2箇所を変更します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eAPICompatibilityLevel を \u003ccode\u003e.NET 4.x\u003c/code\u003e に変更する\u003c/li\u003e\n\u003cli\u003eAllow unsafe Code にチェックをいれる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/4f0e3c9204421d4faaf6cf7ada1ec14ecae08fd3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f66306364623336622d636663372d643236642d323164312d3966373861333530336431622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Ff0cdb36b-cfc7-d26d-21d1-9f78a3503d1b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d93ff12511ce0f713b06329a68a0f206\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/f0cdb36b-cfc7-d26d-21d1-9f78a3503d1b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Ff0cdb36b-cfc7-d26d-21d1-9f78a3503d1b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=10901ecd86757a394088a7058c00d57e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e次に下記のフォルダを作成します。\u003cbr\u003e\n※Sample.Unity は自分のプロジェクト名に読み替えてください。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSample.Unity\\Assets\\Editor\u003c/li\u003e\n\u003cli\u003eSample.Unity\\Assets\\Plugins\u003c/li\u003e\n\u003cli\u003eSample.Unity\\Assets\\Scripts\u003c/li\u003e\n\u003cli\u003eSample.Unity\\Assets\\Scripts\\Generated\u003c/li\u003e\n\u003cli\u003eSample.Unity\\Assets\\Scripts\\ServerShared\u003c/li\u003e\n\u003cli\u003eSample.Unity\\Assets\\Scripts\\ServerShared\\Hubs\u003c/li\u003e\n\u003cli\u003eSample.Unity\\Assets\\Scripts\\ServerShared\\MessagePackObjects\u003c/li\u003e\n\u003cli\u003eSample.Unity\\Assets\\Scripts\\ServerShared\\Services\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eフォルダ構成が下記のようになっていることを確認します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/0cb323d4fdb312840aad5baab37a77d3eaf26443/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f65303461393130382d373737302d393738642d303334352d6330336266666665663630632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fe04a9108-7770-978d-0345-c03bfffef60c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=dabfd6ae2d51ef22d355abfd98bcadb1\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/e04a9108-7770-978d-0345-c03bfffef60c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fe04a9108-7770-978d-0345-c03bfffef60c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fbc2ce56d81eabe3bee2567e591ea962 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"22-magiconion-のインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#22-magiconion-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.2. MagicOnion のインストール\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/Cysharp/MagicOnion/releases/tag/3.0.12\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGitHub\u003c/a\u003e から \u003ccode\u003eMagicOnion.Client.Unity.unitypackage\u003c/code\u003e をダウンロードします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/2e1518a41f0a351a7bdd3b613a7e240207fc1b79/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f63666665313131642d366665392d306261662d313365662d6132336637303539653438392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcffe111d-6fe9-0baf-13ef-a23f7059e489.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=31d45e7552d80b022c0292573ea26e1c\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/cffe111d-6fe9-0baf-13ef-a23f7059e489.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcffe111d-6fe9-0baf-13ef-a23f7059e489.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6b6f37b6433bea02a367335a815a8fab 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eダウンロードが終わったらダブルクリックしてインポートします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/24a1c7a7195dd9e4b658719088ff30f0b1455804/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f34303130306235322d313133632d376630632d393865652d3239316138313234353065382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F40100b52-113c-7f0c-98ee-291a812450e8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=fee83e53bba9e0ae720ade6fe032629d\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/40100b52-113c-7f0c-98ee-291a812450e8.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F40100b52-113c-7f0c-98ee-291a812450e8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=45ce8a78e48f193520eb445caeb9022c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"23-messagepack-for-c-のインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#23-messagepack-for-c-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.3. MessagePack for C# のインストール\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/neuecc/MessagePack-CSharp/releases/tag/v2.1.152\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGitHub\u003c/a\u003e から \u003ccode\u003eMessagePack.Unity.2.1.152.unitypackage\u003c/code\u003e をダウンロードします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/7c6167e6d514b657f150a0ac149f60d773914c58/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f64636234316231312d656662322d303736332d363339372d3166303239633164636637632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fdcb41b11-efb2-0763-6397-1f029c1dcf7c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7f72baedf8de45ebfea04b33f3670564\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/dcb41b11-efb2-0763-6397-1f029c1dcf7c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fdcb41b11-efb2-0763-6397-1f029c1dcf7c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5e484523c7877e5528fc111acfc22b2b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eダウンロードが終わったらダブルクリックしてインポートします。\u003cbr\u003e\nMagicOnion と重複するファイルがあるため警告が表示されますがこのままインポートします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/dc58141f8a50d6d91604e6c91819422090330002/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f32613835343936372d353162642d323539382d303661632d3038616235336336343363622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F2a854967-51bd-2598-06ac-08ab53c643cb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ed436be8ab42c3d23d69bfeb35010348\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/2a854967-51bd-2598-06ac-08ab53c643cb.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F2a854967-51bd-2598-06ac-08ab53c643cb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=38d7f2e90e143b09f92954e22f80ee46 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"24-grpc-のインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#24-grpc-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.4. gRPC のインストール\u003c/h3\u003e\n\n\u003cp\u003egRPC の \u003ca href=\"https://packages.grpc.io/archive/2019/08/e14154481baf7e23710b60b78a1e91299985ec80-41fb322e-6416-4509-9a6f-2b17085b6272/index.xml\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDaily Builds(2019/08/01)\u003c/a\u003e から \u003ccode\u003egrpc_unity_package.2.23.0-dev.zip\u003c/code\u003e をダウンロードします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/249335dde7d452b9f4fdb0033a2b972b364003c3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f39663830653536352d663537642d323132332d633936352d6263306363366461333166652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F9f80e565-f57d-2123-c965-bc0cc6da31fe.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=feac7b11ba3c3a7fe4498690c81a12d3\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/9f80e565-f57d-2123-c965-bc0cc6da31fe.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F9f80e565-f57d-2123-c965-bc0cc6da31fe.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=03059f60bd42ed2d2b53da5d1aa5ad7b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eダウンロードが終わったら展開し、以下のフォルダを \u003ccode\u003eSample.Unity\\Assets\\Plugins\u003c/code\u003e にコピーします。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eGoogle.Protobuf\u003c/li\u003e\n\u003cli\u003eGrpc.Core\u003c/li\u003e\n\u003cli\u003eGrpc.Core.Api\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/c1e239f6b024560624feb1a9ded1b84b45414b8d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f36376432643132342d663761372d653335352d393935392d3832316365633335353030322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F67d2d124-f7a7-e355-9959-821cec355002.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9e156b959f566854c946811526300f4a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/67d2d124-f7a7-e355-9959-821cec355002.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F67d2d124-f7a7-e355-9959-821cec355002.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c500a8a6410deb2079948c8edf824c68 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"25-サーバーへ接続するスクリプトの用意\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#25-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%B8%E6%8E%A5%E7%B6%9A%E3%81%99%E3%82%8B%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E7%94%A8%E6%84%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.5. サーバーへ接続するスクリプトの用意\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eAssets\\Scenes\u003c/code\u003e に \u003ccode\u003eSampleController\u003c/code\u003e スクリプトを作成します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/25773d0de6d2c7d0af44e3d7eefed62033e15894/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f61613166346431332d626331332d646564372d303331662d3239373835363166313166642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Faa1f4d13-bc13-ded7-031f-2978561f11fd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4bf2e70dd9dfcbfae0899faf390665d9\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/aa1f4d13-bc13-ded7-031f-2978561f11fd.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Faa1f4d13-bc13-ded7-031f-2978561f11fd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c7464b874c95527d19007053dc1adb6d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSampleController のコードは以下をコピペしてください。\u003cbr\u003e\nStart() でサーバーへ接続し、OnDestroy() で切断するようになっています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eGrpc.Core\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSampleController\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonoBehaviour\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eChannel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"localhost:12345\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eChannelCredentials\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInsecure\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShutdownAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eSampleScene へ空の GameObject を追加します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/64040ff05d75ec17468beef827b6a711796eab89/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f64373633373233312d376434322d363530652d656435382d3166636631656564623032612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fd7637231-7d42-650e-ed58-1fcf1eedb02a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8feaa4b1e6243e5d0f26f091591931d4\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/d7637231-7d42-650e-ed58-1fcf1eedb02a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fd7637231-7d42-650e-ed58-1fcf1eedb02a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4ede8c9ba7b38f59e40bf4fc0b3c5252 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e追加した GameObject に SampleController を AddComponent します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/43b1c559a5cce70e25736b068542ed2347a6a5b4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f61333137343930382d356330362d393039352d353339322d3230376462356131663861302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa3174908-5c06-9095-5392-207db5a1f8a0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9920e8b8770b73a2fa7409d3ead0be0a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/a3174908-5c06-9095-5392-207db5a1f8a0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa3174908-5c06-9095-5392-207db5a1f8a0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2975cd5376c7a5cc5d5de96c5fd99f5a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"26-unity--サーバー間のコード共有の動作確認用のクラスの用意\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#26-unity--%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E9%96%93%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E5%85%B1%E6%9C%89%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D%E7%94%A8%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E7%94%A8%E6%84%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.6. Unity ⇔ サーバー間のコード共有の動作確認用のクラスの用意\u003c/h3\u003e\n\n\u003cp\u003eMagicOnion を利用する際は Unity 側で作成したクラスなどをサーバーサイドと共有して使うことが一般的です。\u003cbr\u003e\n今回は Assets\\Scripts\\ServerShared 以下に作成したスクリプトをすべて共有する設定を行います。\u003cbr\u003e\nコード共有の設定は後でサーバー側で設定を行いますが、先に動作確認用のクラスを用意しておきます。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eAssets\\ServerShared\\MessagePackObjects\u003c/code\u003e に \u003ccode\u003ePlayer\u003c/code\u003e スクリプトを作成します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/272ea54d966c220937c42318b5ec6b2aa6d4f3cf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f64633236623832352d366465302d376235632d333361342d3965663434653961336232332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fdc26b825-6de0-7b5c-33a4-9ef44e9a3b23.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3baef6b9ef1e39fe14b28bcc137870f2\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/dc26b825-6de0-7b5c-33a4-9ef44e9a3b23.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fdc26b825-6de0-7b5c-33a4-9ef44e9a3b23.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c37a8cbe17fa35f006775f3a186b4af1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePlayer のコードは以下をコピペしてください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMessagePack\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSample.Shared.MessagePackObjects\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eMessagePackObject\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ePlayer\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eKey\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eKey\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003ePosition\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eKey\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e \u003cspan class=\"n\"\u003eRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eMagicOnion を使用する場合、Client ⇔ サーバー間の通信で使用するクラスはこのような MessagePackObject として定義します。\u003c/p\u003e\n\n\u003cp\u003eMessagePackObject として定義するために必要なことは下記の2つだけですので覚えておきましょう。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eclass に MessagePackObjectAttribute を付与する\u003c/li\u003e\n\u003cli\u003e各プロパティに KeyAttribute を付与して番号を順番にふる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eUnity 側の構築はここまでです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"3-サーバー側の構築\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%AE%E6%A7%8B%E7%AF%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. サーバー側の構築\u003c/h2\u003e\n\n\u003cp\u003e続いてサーバー側の構築作業を進めます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"31-ソリューションへサーバー側のプロジェクトを追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#31-%E3%82%BD%E3%83%AA%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%B8%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.1. ソリューションへサーバー側のプロジェクトを追加\u003c/h3\u003e\n\n\u003cp\u003eソリューションを右クリックして、新しいプロジェクトを追加します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/bbfffc2d0152ab62c48d6150c2dc3d5220445a51/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f39663962646565352d613865342d643737312d383438372d3939653133633764613363662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F9f9bdee5-a8e4-d771-8487-99e13c7da3cf.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ff3a8c1fc5c78d87a617f1ed15283fbe\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/9f9bdee5-a8e4-d771-8487-99e13c7da3cf.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F9f9bdee5-a8e4-d771-8487-99e13c7da3cf.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ab6cab4c9efd068a8615d397d5f957b5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eコンソールアプリ（.NET Core）を選択し、次へをクリックします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/d44ee403de28cec613ba00a5cf6b2da230fe77da/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f65663032363162302d383162652d636135392d353863352d3736323464326133646632362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fef0261b0-81be-ca59-58c5-7624d2a3df26.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ba14bb68fe35f1d3150b80a7fa9546fd\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/ef0261b0-81be-ca59-58c5-7624d2a3df26.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fef0261b0-81be-ca59-58c5-7624d2a3df26.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e0ef58f20b4a8e89c1aa8ca87f90ad7d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e任意のプロジェクト名を入力します。（ここでは Sample.Server としました）\u003cbr\u003e\n場所はプロジェクトのルートを指定してください。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6769162bc0380a814537604a7004ee90a3a1a1d0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f65326231323366362d303462352d633738372d313633352d6561376530356331653037302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fe2b123f6-04b5-c787-1635-ea7e05c1e070.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b4b22365b06b5002d7aafe65d17b4e51\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/e2b123f6-04b5-c787-1635-ea7e05c1e070.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fe2b123f6-04b5-c787-1635-ea7e05c1e070.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1f3359807059f2e0dadc07337fafedf9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"32-magiconion-のインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#32-magiconion-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.2. MagicOnion のインストール\u003c/h3\u003e\n\n\u003cp\u003eNuGet から MagicOnion をインストールします。\u003cbr\u003e\nツール -\u0026gt; NuGet パッケージマネージャー -\u0026gt; ソリューションの NuGet パッケージの管理 を開きます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/76d992637278eec15342f1452c9c92f129deab04/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f35616161653661302d343665362d353737632d643435302d3439383933306430656232362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5aaae6a0-46e6-577c-d450-498930d0eb26.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4a757646fc725d1c0fbbfa5b141854cc\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/5aaae6a0-46e6-577c-d450-498930d0eb26.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5aaae6a0-46e6-577c-d450-498930d0eb26.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=13607e879a9af58c348225a841880a81 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e参照 をクリックし、 MagicOnion を検索します。\u003cbr\u003e\n検索結果から MagicOnion.Hosting を選択し、Sample.Server にチェックをいれます。\u003cbr\u003e\nバージョンは 3.0.12 を選択し、インストールします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/21b6a2efd2076a14b5c3d4e83f0cd2bd6b377915/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f61333337376662362d343336332d356235302d306362622d3139363030623731326464322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa3377fb6-4363-5b50-0cbb-19600b712dd2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c3b4cb39f93648c6a79fa58749e49f29\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/a3377fb6-4363-5b50-0cbb-19600b712dd2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa3377fb6-4363-5b50-0cbb-19600b712dd2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ff98cf23c31564d8c820dc53d12b1a92 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e変更のプレビューが表示されるので OK を押します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/17c230a303977cca98517db66a25809bbc2f91ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f63626664313030312d326164662d393231312d313431652d3033636264346263393339322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcbfd1001-2adf-9211-141e-03cbd4bc9392.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=47fa192bb19eb08d3d6c717b0ac7136d\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/cbfd1001-2adf-9211-141e-03cbd4bc9392.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcbfd1001-2adf-9211-141e-03cbd4bc9392.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=03a703b2eb010bf1afd0cd7968318d43 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eライセンスへの同意を求められるので同意します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/33751b7686e4e7c3d09744487742830b7633c139/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f30313365366561372d383634352d663361362d303736362d6565626362376439323366302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F013e6ea7-8645-f3a6-0766-eebcb7d923f0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=24977041bfacd9e8c248b7e24a2cf739\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/013e6ea7-8645-f3a6-0766-eebcb7d923f0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F013e6ea7-8645-f3a6-0766-eebcb7d923f0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=51d2dc43a8b01fd96f23a00da8e67fe0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"33-programcs-の編集\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#33-programcs-%E3%81%AE%E7%B7%A8%E9%9B%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.3. Program.cs の編集\u003c/h3\u003e\n\n\u003cp\u003eProgram.cs を下記の内容で上書き保存します。\u003cbr\u003e\nこれでサーバー側のプロジェクトを起動すると MagicOnion が起動するようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMagicOnion.Hosting\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.Extensions.Hosting\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSample.Server\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eMagicOnionHost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateDefaultBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUseMagicOnion\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunConsoleAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"34-ソリューションへクラスライブラリのプロジェクトを追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#34-%E3%82%BD%E3%83%AA%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%B8%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.4. ソリューションへクラスライブラリのプロジェクトを追加\u003c/h3\u003e\n\n\u003cp\u003eこのクラスライブラリを使って Unity 側とサーバー側のコード共有を行います。\u003c/p\u003e\n\n\u003cp\u003eソリューションを右クリックして、新しいプロジェクトを追加します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/7803a5869ef61d7575f119b7f64de3b9835390f5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f61363433623061302d373131642d626539382d376465392d3533323131376638613634642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa643b0a0-711d-be98-7de9-532117f8a64d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1e86aa8ac1d0cf02251f6144422267f2\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/a643b0a0-711d-be98-7de9-532117f8a64d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa643b0a0-711d-be98-7de9-532117f8a64d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7890c5f9e34cebd2fdb6063dee9a85e9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eクラスライブラリ(C# .NET Standard)を選択します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/85ad3675f36418000dea4487ff1ba75f40d6f85a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f38386330623136352d386234312d343138612d646530352d3035303738376162623362612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F88c0b165-8b41-418a-de05-050787abb3ba.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bea2942e2fd687f2851e2657351999a8\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/88c0b165-8b41-418a-de05-050787abb3ba.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F88c0b165-8b41-418a-de05-050787abb3ba.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=855e22ed276aeab986e5000131bb9fa0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e任意のプロジェクト名を入力します。（ここでは Sample.Shared としました）\u003cbr\u003e\n場所はプロジェクトのルートを指定してください。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/814d6010ffbb5b995dd41e36b067eaf7cec7d23f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f33653165353262372d343261392d303932632d383535632d3035323463613337336131382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F3e1e52b7-42a9-092c-855c-0524ca373a18.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=44911c04705fce31975389345693e059\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/3e1e52b7-42a9-092c-855c-0524ca373a18.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F3e1e52b7-42a9-092c-855c-0524ca373a18.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6258e7c6f95b2b4e71fd9c5edc0218f3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e自動的に作成される Class1.cs は不要なので削除します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e3f9d5f11b901dd212a1a33d022d9d328f7dd061/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f39306631393863392d336665302d613664612d626432352d6138623934633431663833372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F90f198c9-3fe0-a6da-bd25-a8b94c41f837.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=cc88743f5ad15720abb47daf1e6aee95\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/90f198c9-3fe0-a6da-bd25-a8b94c41f837.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F90f198c9-3fe0-a6da-bd25-a8b94c41f837.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=79018ad81f4548e08b7982c8f9083234 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"35-クラスライブラリへ-magiconionabstractions-をインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#35-%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%B8-magiconionabstractions-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.5. クラスライブラリへ MagicOnion.Abstractions をインストール\u003c/h3\u003e\n\n\u003cp\u003e先ほどの MagicOnion のインストールと同じ要領で、NuGet から MagicOnion.Abstractions を検索してインストールします。\u003cbr\u003e\n対象のプロジェクトは Sample.Shared を選択し、バージョンは 3.0.12 を選択します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ee685fc3dd73c25775dfee7a4400efdff9a3f6d2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f34653732663631622d303630332d316361342d643635322d6332656638343531303732662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F4e72f61b-0603-1ca4-d652-c2ef8451072f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=62fc3a5509084583287a72aea03419a9\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/4e72f61b-0603-1ca4-d652-c2ef8451072f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F4e72f61b-0603-1ca4-d652-c2ef8451072f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=112aaacd49d1d97d68493961cd0bda17 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"36-クラスライブラリへ-messagepackunityshims-をインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#36-%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%B8-messagepackunityshims-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.6. クラスライブラリへ MessagePack.UnityShims をインストール\u003c/h3\u003e\n\n\u003cp\u003e同じ要領で Sample.Shared へ MessagePack.UnityShims をインストールします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/0c15d82bb57a71e4e1165394b160ad6c508845a8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f63633632323765322d376539362d656637392d326435332d3863346135353739393062662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcc6227e2-7e96-ef79-2d53-8c4a557990bf.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3c2ef25c333b451997ee92462fb31f97\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/cc6227e2-7e96-ef79-2d53-8c4a557990bf.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcc6227e2-7e96-ef79-2d53-8c4a557990bf.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=674147569d04683bce1d821dba14e5b9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"37-クラスライブラリから-unity-側のコードを参照する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#37-%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%8B%E3%82%89-unity-%E5%81%B4%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.7. クラスライブラリから Unity 側のコードを参照する\u003c/h3\u003e\n\n\u003cp\u003eSample.Shared をダブルクリックして Sample.Shared.csproj を開き、赤枠部分の設定を追加します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b3dc4c0fbfcc795737475fd1adcc7a84d2ea3b8e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f62373439373563652d626561322d343430332d313637372d3034633233613063633363362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fb74975ce-bea2-4403-1677-04c23a0cc3c6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=cbb71dc043850cca31f335e91e76bba6\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/b74975ce-bea2-4403-1677-04c23a0cc3c6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fb74975ce-bea2-4403-1677-04c23a0cc3c6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=776cf8252081b342b4a16b4a6d294444 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e追加する設定はこちらをコピペしてください。\u003cbr\u003e\n※Sample.Unity の部分は自分の Unity 側のプロジェクト名に読み替えてください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eItemGroup\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCompile\u003c/span\u003e \u003cspan class=\"n\"\u003eInclude\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"..\\Sample.Unity\\Assets\\Scripts\\ServerShared\\**\\*.cs\"\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eItemGroup\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの状態でソリューションエクスプローラーを見てみると、Unity 側で用意した ServerShared フォルダ以下のファイルがクラスライブラリに読み込めたことがわかります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/9e64110d2219e2c31050e76890cd70732e3c3403/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f30383637396430342d613730332d366362382d336163352d3232633165313566346466302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F08679d04-a703-6cb8-3ac5-22c1e15f4df0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=12971fec7a9c6dc211ef8976815ba112\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/08679d04-a703-6cb8-3ac5-22c1e15f4df0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F08679d04-a703-6cb8-3ac5-22c1e15f4df0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7c37475356b906bc8f20811d28c9562c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"38-サーバー側のプロジェクトからクラスライブラリを参照する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#38-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%8B%E3%82%89%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.8. サーバー側のプロジェクトからクラスライブラリを参照する\u003c/h3\u003e\n\n\u003cp\u003eSample.Server を右クリックし、追加、プロジェクト参照を選択します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/248f8495ecf520cd893a5db8b53513a3d96507e8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f32383536636163632d336561632d646336332d316230352d6361336438363364306235642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F2856cacc-3eac-dc63-1b05-ca3d863d0b5d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=749493cb6a6908ddccb513fa25c4ffd4\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/2856cacc-3eac-dc63-1b05-ca3d863d0b5d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F2856cacc-3eac-dc63-1b05-ca3d863d0b5d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bed3bff96e82c24c744bfb3ee1faeaf2 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSample.Shared を選択して OK を押します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/d4efeb16cd1d103cc382aa36085e0cbc85259f09/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f34386635316231332d386262662d316434662d373233392d6533373532356239363933372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F48f51b13-8bbf-1d4f-7239-e37525b96937.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1ca5fab894a7f54b3c8853724d42e5e4\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/48f51b13-8bbf-1d4f-7239-e37525b96937.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F48f51b13-8bbf-1d4f-7239-e37525b96937.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=08515a82384577c4af608d9a4d846bbe 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれで Unity とコード共有したサーバーの用意ができました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"4-api-の実装と動作確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-api-%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%A8%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4. API の実装と動作確認\u003c/h2\u003e\n\n\u003cp\u003eここからは API の実装と動作確認を行います。\u003cbr\u003e\nMagicOnion は普通の API 通信とリアルタイム通信の2種類の通信が利用できますので、それぞれをテストしてみます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"41-普通の-api通信\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#41-%E6%99%AE%E9%80%9A%E3%81%AE-api%E9%80%9A%E4%BF%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.1. 普通の API通信\u003c/h3\u003e\n\n\u003cp\u003eまずは普通の API 通信から試してみます。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"411-unity-側で-api-の定義を作る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#411-unity-%E5%81%B4%E3%81%A7-api-%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.1.1. Unity 側で API の定義を作る\u003c/h4\u003e\n\n\u003cp\u003eAssets\\Scripts\\ServerShared\\Services 以下に SampleService スクリプトを作ります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/5c53fc6ec6924fb5e0bee52c797a52d6b7aada79/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f62393930663863352d306134392d613530312d326235352d3963643939626637343436322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fb990f8c5-0a49-a501-2b55-9cd99bf74462.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=402336db9f6cf0ee7766383388b9200b\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/b990f8c5-0a49-a501-2b55-9cd99bf74462.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fb990f8c5-0a49-a501-2b55-9cd99bf74462.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=60486d02585d05d207cc248f4b8157a4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSampleService の中身は以下をコピペして保存してください。\u003cbr\u003e\n今回は足し算をしてくれる API と掛け算をしてくれる API を定義してみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMagicOnion\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSample.Shared.Services\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eISampleService\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIService\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eISampleService\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eUnaryResult\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eSumAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eUnaryResult\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eProductAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"412-サーバー側で-api-を実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#412-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%A7-api-%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.1.2. サーバー側で API を実装する\u003c/h4\u003e\n\n\u003cp\u003eSample.Server を右クリックして、新しいフォルダを追加します。\u003cbr\u003e\n名前は Services とします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/566bcf46f4383ce84013e572834ef5cf58c8576a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f39373863383765312d363464372d653764632d323036612d3431383335623739383664372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F978c87e1-64d7-e7dc-206a-41835b7986d7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c0d20706c89406bf7ac35ea13832f13a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/978c87e1-64d7-e7dc-206a-41835b7986d7.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F978c87e1-64d7-e7dc-206a-41835b7986d7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b32bde545b90b3bb61a275a45618bf51 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/b324fa6e68f8e083234e9c24e49ae2039f0034a8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f65626337363061662d663364332d393364302d373536322d3233666437623430636663302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Febc760af-f3d3-93d0-7562-23fd7b40cfc0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=230e6caba9c1d57d79e2a4470d7d43ac\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/ebc760af-f3d3-93d0-7562-23fd7b40cfc0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Febc760af-f3d3-93d0-7562-23fd7b40cfc0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=178cadee85da16ee5886362e45389578 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e次に Services フォルダ内にクラスを追加します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/dd8133ccafe9e1d513acad22a31607a539a48937/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f32333733336433352d653833342d383034632d383238632d3434303763613561346238382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F23733d35-e834-804c-828c-4407ca5a4b88.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f92d6355e37b1818a1e844621f286c0c\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/23733d35-e834-804c-828c-4407ca5a4b88.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F23733d35-e834-804c-828c-4407ca5a4b88.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7418221fdef1b4b658bb550066e4a488 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e名前は SampleService.cs とします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/cb43b0e5767a87ebf5dc24edcdd8007cfff50d27/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f61376561336261662d323638392d346363622d336266332d6537616134646130646138382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa7ea3baf-2689-4ccb-3bf3-e7aa4da0da88.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9a6f06bb81116f23a6f05b8438608044\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/a7ea3baf-2689-4ccb-3bf3-e7aa4da0da88.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fa7ea3baf-2689-4ccb-3bf3-e7aa4da0da88.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=18f76db7c26ba6c987a2a12684d59a52 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSampleService.cs の中身は以下をコピペして保存してください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMagicOnion\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMagicOnion.Server\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSample.Shared.Services\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSample.Server.Services\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSampleService\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eServiceBase\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eISampleService\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;,\u003c/span\u003e \u003cspan class=\"n\"\u003eISampleService\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eUnaryResult\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eSumAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eUnaryResult\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eUnaryResult\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eProductAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eUnaryResult\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"413-unity-側で-api-を呼ぶコードを実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#413-unity-%E5%81%B4%E3%81%A7-api-%E3%82%92%E5%91%BC%E3%81%B6%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.1.3. Unity 側で API を呼ぶコードを実装する\u003c/h4\u003e\n\n\u003cp\u003eSampleController に SampleService を呼び出すコードを追加します。\u003cbr\u003e\n下記のコードをコピペして上書きしてください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eGrpc.Core\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMagicOnion.Client\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSample.Shared.Services\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSampleController\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonoBehaviour\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eChannel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eISampleService\u003c/span\u003e \u003cspan class=\"n\"\u003esampleService\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"localhost:12345\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eChannelCredentials\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInsecure\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esampleService\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMagicOnionClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eISampleService\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSampleServiceTest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShutdownAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSampleServiceTest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esumReuslt\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esampleService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSumAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"k\"\u003enameof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esumReuslt\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s\"\u003e: \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003esumReuslt\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eproductResult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esampleService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eProductAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"k\"\u003enameof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eproductResult\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s\"\u003e: \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eproductResult\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"414-api-通信の動作確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#414-api-%E9%80%9A%E4%BF%A1%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.1.4. API 通信の動作確認\u003c/h4\u003e\n\n\u003cp\u003eまずはサーバーを起動します。\u003c/p\u003e\n\n\u003cp\u003eSample.Server を右クリックして、\u003ccode\u003eスタートアッププロジェクトに設定\u003c/code\u003e をクリックします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/5ad60e7aa7c325ce05e9f1199cc9346d3abcd743/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f35646138386631652d353937382d313037642d393562302d6665363537363365333664622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5da88f1e-5978-107d-95b0-fe65763e36db.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a31cc7c5e37f4ce195e5b85ca5dcb8f6\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/5da88f1e-5978-107d-95b0-fe65763e36db.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5da88f1e-5978-107d-95b0-fe65763e36db.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=58c2c207db15ae5beec2493fd86e2e5b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれによって、普段は \u003ccode\u003eUnity にアタッチ\u003c/code\u003e と表示されていたボタンが \u003ccode\u003eSample.Server\u003c/code\u003e の表示に変わります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/4cad169d773d10ed61238b3a193820ca1d2c6891/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f64353264643063332d396639312d343965352d316631612d6337336463313137663036632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fd52dd0c3-9f91-49e5-1f1a-c73dc117f06c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=218cebf717bde7a504ddce3ec3ae79f1\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/d52dd0c3-9f91-49e5-1f1a-c73dc117f06c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fd52dd0c3-9f91-49e5-1f1a-c73dc117f06c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=07170a249c31cbccc208a640a6f7f556 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこのボタンを押すとサーバーを起動することができます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/37fc926aa4b8f4e12c7acad2a8e50628af18a8cf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f66303933313338342d346435642d356361302d323939652d3532616361326238316636302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Ff0931384-4d5d-5ca0-299e-52aca2b81f60.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7429b5f7d3a83333fc38340ea2ca291f\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/f0931384-4d5d-5ca0-299e-52aca2b81f60.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Ff0931384-4d5d-5ca0-299e-52aca2b81f60.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fcf162ead0fc4c487e3cbe0efe9fdde8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e※スタートアッププロジェクトを元に戻す場合は \u003ccode\u003eAssembly-CSharp\u003c/code\u003e を右クリックしてスタートアッププロジェクトに指定します。\u003cbr\u003e\n※Unity にアタッチしつつサーバーを起動したい場合は \u003ccode\u003eマルチスタートアッププロジェクト\u003c/code\u003e を使用します。（後述）\u003c/p\u003e\n\n\u003cp\u003e続いてサーバーを起動した状態で Unity の Scene を再生します。\u003c/p\u003e\n\n\u003cp\u003eUnity の Console にログが表示されました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/3deb83b18acdc9fdd4e7fb50187f6e091a92b050/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f33323665373436312d366161312d333432362d653833382d3263383137313064643662622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F326e7461-6aa1-3426-e838-2c81710dd6bb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3900895a0245c7a12c6a46b19cecf09b\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/326e7461-6aa1-3426-e838-2c81710dd6bb.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F326e7461-6aa1-3426-e838-2c81710dd6bb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=dbaeb8d1f810d16a7b8ee7b917377e22 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"42-リアルタイム通信\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#42-%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E9%80%9A%E4%BF%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.2. リアルタイム通信\u003c/h3\u003e\n\n\u003cp\u003e続いてリアルタイム通信を試してみます。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"421-unity-側で-api-の定義を作る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#421-unity-%E5%81%B4%E3%81%A7-api-%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.2.1. Unity 側で API の定義を作る\u003c/h4\u003e\n\n\u003cp\u003e普通の API 通信と同じく、まずは API の定義から作ります。\u003cbr\u003e\nAssets\\Scripts\\ServerShared\\Hubs 以下に SampleHub スクリプトを作ります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ff5e1fbd0cc5e5992118945f311d18c074f0d426/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f64353030356263652d313734642d353535662d386364322d3461643666303034346639342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fd5005bce-174d-555f-8cd2-4ad6f0044f94.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=89c0225537a60466a95c7209f673bf19\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/d5005bce-174d-555f-8cd2-4ad6f0044f94.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fd5005bce-174d-555f-8cd2-4ad6f0044f94.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fcb55bbf1f239260616e6add74123a70 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSampleHub の中身は以下をコピペして保存してください。\u003cbr\u003e\n今回はゲームにログイン、チャットで発言、位置情報を更新、ゲームから切断、という4つの API を作ります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMagicOnion\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSample.Shared.MessagePackObjects\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSample.Shared.Hubs\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// CLient -\u0026gt; ServerのAPI\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eISampleHub\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIStreamingHub\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eISampleHub\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eISampleHubReceiver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// ゲームに接続することをサーバに伝える\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eJoinAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// ゲームから切断することをサーバに伝える\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeaveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// メッセージをサーバに伝える\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendMessageAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 移動したことをサーバに伝える\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eMovePositionAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// Server -\u0026gt; ClientのAPI\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eISampleHubReceiver\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 誰かがゲームに接続したことをクライアントに伝える\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnJoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 誰かがゲームから切断したことをクライアントに伝える\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnLeave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 誰かが発言した事をクライアントに伝える\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnSendMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 誰かが移動した事をクライアントに伝える\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnMovePosition\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"422-サーバー側で-api-を実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#422-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%A7-api-%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.2.2 サーバー側で API を実装する\u003c/h4\u003e\n\n\u003cp\u003e普通の API の実装の時と同じ要領で、Sample.Server 以下に Hubs フォルダを作り、その中に SampleHub.cs を作ります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6e65f4b1070409981d2d832a1da80183227f9a88/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f35303731393534652d613439642d393536632d383761302d6236386232613835353834312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5071954e-a49d-956c-87a0-b68b2a855841.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=fa35ad625abf685647126dd18cb19d35\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/5071954e-a49d-956c-87a0-b68b2a855841.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F5071954e-a49d-956c-87a0-b68b2a855841.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=25f53bb4d4a91be91895eec6f9c0e239 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSampleHub.cs の中身は以下をコピペして保存してください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMagicOnion.Server.Hubs\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSample.Shared.Hubs\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSample.Shared.MessagePackObjects\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSampleHub\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eStreamingHubBase\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eISampleHub\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eISampleHubReceiver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;,\u003c/span\u003e \u003cspan class=\"n\"\u003eISampleHub\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIGroup\u003c/span\u003e \u003cspan class=\"n\"\u003eroom\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"n\"\u003eme\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eJoinAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//ルームは全員固定\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eroomName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"SampleRoom\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//ルームに参加\u0026amp;ルームを保持\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eroom\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGroup\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroomName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//自分の情報も保持\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eme\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//参加したことをルームに参加している全メンバーに通知\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBroadcast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroom\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnJoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eme\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeaveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//ルーム内のメンバーから自分を削除\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eroom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRemoveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContext\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//退室したことを全メンバーに通知\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBroadcast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroom\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnLeave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eme\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendMessageAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//発言した内容を全メンバーに通知\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBroadcast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroom\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnSendMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eme\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompletedTask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eMovePositionAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// サーバー上の情報を更新\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eme\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//更新したプレイヤーの情報を全メンバーに通知\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBroadcast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroom\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnMovePosition\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eme\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompletedTask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eValueTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnConnecting\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// handle connection if needed.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"client connected \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContextId\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eCompletedTask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eValueTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnDisconnected\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// handle disconnection if needed.\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// on disconnecting, if automatically removed this connection from group.\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eCompletedTask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"423-unity-側で-api-を呼ぶコードを実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#423-unity-%E5%81%B4%E3%81%A7-api-%E3%82%92%E5%91%BC%E3%81%B6%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.2.3. Unity 側で API を呼ぶコードを実装する\u003c/h4\u003e\n\n\u003cp\u003eSampleController に SampleHub の各 API を呼び出すコードを追加します。\u003cbr\u003e\n下記のコードをコピペして上書きしてください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eGrpc.Core\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMagicOnion.Client\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSample.Shared.Hubs\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSample.Shared.MessagePackObjects\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSample.Shared.Services\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSampleController\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonoBehaviour\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eISampleHubReceiver\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eChannel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eISampleService\u003c/span\u003e \u003cspan class=\"n\"\u003esampleService\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eISampleHub\u003c/span\u003e \u003cspan class=\"n\"\u003esampleHub\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"localhost:12345\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eChannelCredentials\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInsecure\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esampleService\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMagicOnionClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eISampleService\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esampleHub\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eStreamingHubClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eISampleHub\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eISampleHubReceiver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 普通の API の呼び出しはコメントアウトしておきます\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 残しておいても問題はないです（リアルタイム通信と両方動きます）\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//this.SampleServiceTest(1, 2);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSampleHubTest\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esampleHub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDisposeAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShutdownAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 普通のAPI通信のテスト用のメソッド\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSampleServiceTest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esumReuslt\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esampleService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSumAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"k\"\u003enameof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esumReuslt\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s\"\u003e: \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003esumReuslt\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eproductResult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esampleService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eProductAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"k\"\u003enameof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eproductResult\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s\"\u003e: \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eproductResult\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// リアルタイム通信のテスト用のメソッド\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSampleHubTest\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 自分のプレイヤー情報を作ってみる\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Minami\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ePosition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eQuaternion\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// ゲームに接続する\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esampleHub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eJoinAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// チャットで発言してみる\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esampleHub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSendMessageAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"こんにちは！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 位置情報を更新してみる\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esampleHub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMovePositionAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// ゲームから切断してみる\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esampleHub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLeaveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003eregion\u003c/span\u003e \u003cspan class=\"err\"\u003eリアルタイム通信でサーバーから呼ばれるメソッド群\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnJoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eさんが入室しました\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnLeave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eさんが退室しました\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnSendMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e: \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnMovePosition\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eさんが移動しました: \u003c/span\u003e\u003cspan class=\"p\"\u003e{{\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003eendregion\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"424-リアルタイム通信の動作確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#424-%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E9%80%9A%E4%BF%A1%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.2.4. リアルタイム通信の動作確認\u003c/h4\u003e\n\n\u003cp\u003e普通の API 通信の動作確認と同じ要領でサーバーを起動し、その後で Unity で Scene を再生します。\u003c/p\u003e\n\n\u003cp\u003eUnity の Console にログが表示されました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/09e347e36b5d1b6f16e544f9bdf0d9aff7b95285/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f63656130386533652d363133342d376535382d646238312d3838353730646561653864392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcea08e3e-6134-7e58-db81-88570deae8d9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ec26ddbbeaa7121e49ac9c7d8bfa07f6\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/cea08e3e-6134-7e58-db81-88570deae8d9.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fcea08e3e-6134-7e58-db81-88570deae8d9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=acb1b73e51c8d4dd67caf4b711196bba 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれで普通の API 通信とリアルタイム通信の両方の動作確認ができました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"5-il2cpp-対応コードジェネレーターによるコード生成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-il2cpp-%E5%AF%BE%E5%BF%9C%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AC%E3%83%BC%E3%82%BF%E3%83%BC%E3%81%AB%E3%82%88%E3%82%8B%E3%82%B3%E3%83%BC%E3%83%89%E7%94%9F%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5. IL2CPP 対応（コードジェネレーターによるコード生成）\u003c/h2\u003e\n\n\u003cp\u003eUnityEditor 上で動かすなら今のままでも問題ないのですが、IL2CPP を使う場合（例えば Platform を iOS にしたとき）はこのようなエラーが発生します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/78dae975c90be7ade2f596af3557024955b06bbb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f65366263326330652d393032332d666661632d653431382d6438633330303737616537632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fe6bc2c0e-9023-ffac-e418-d8c30077ae7c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8cb872febfd4dcd3cee967817001568b\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/e6bc2c0e-9023-ffac-e418-d8c30077ae7c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fe6bc2c0e-9023-ffac-e418-d8c30077ae7c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cd7999a303c50748e3439b0649103076 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eIL2CPP は動的なコード生成に対応していないため、コードジェネレーターを使用して事前に必要なコードを生成する必要があります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"51-magiconionmsbuildtasks-のインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#51-magiconionmsbuildtasks-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5.1. MagicOnion.MSBuild.Tasks のインストール\u003c/h3\u003e\n\n\u003cp\u003eNuGet で MagicOnion.MSBuild.Tasks をインストールします。\u003cbr\u003e\nプロジェクトは Sample.Shared を選択し、バージョンは 3.0.12 を選択します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/48f15c34acd81d52cd3e5ca8dbc653420af9866b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f32313362303531632d383539352d323732382d373537362d6338653039343239626261632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F213b051c-8595-2728-7576-c8e09429bbac.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=138ab9c60b45fc6a1ce053f1d098a61b\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/213b051c-8595-2728-7576-c8e09429bbac.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F213b051c-8595-2728-7576-c8e09429bbac.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=09cdceacef106be8c293c2244a04661d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"52-messagepackmsbuildtasks-のインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#52-messagepackmsbuildtasks-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5.2. MessagePack.MSBuild.Tasks のインストール\u003c/h3\u003e\n\n\u003cp\u003e同じ要領で MessagePack.MSBuild.Tasks もインストールします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/1b7426ee3cbb836a98ccffcdcf733d3cdb92ccd5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f63333966393563302d636234312d326330302d643234392d6265643135346564363532312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fc39f95c0-cb41-2c00-d249-bed154ed6521.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=87a7a18d0ecb370abc99a0a22b21d07d\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/c39f95c0-cb41-2c00-d249-bed154ed6521.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fc39f95c0-cb41-2c00-d249-bed154ed6521.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5b15477e7c0bf840df03cfcca983ddd9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"53-samplesharedcsproj-の編集\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#53-samplesharedcsproj-%E3%81%AE%E7%B7%A8%E9%9B%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5.3. Sample.Shared.csproj の編集\u003c/h3\u003e\n\n\u003cp\u003eSample.Shared をダブルクリックし、Sample.Shared.csproj を開きます。\u003cbr\u003e\n赤枠部分のコードを追加して保存します。\u003cbr\u003e\nコードは以下をコピペしてください。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/e5927da1d3c01e20330a2a0a4719ab4061da13c2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f65653637656662312d396432372d323933612d316431652d3163313833623539333031332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fee67efb1-9d27-293a-1d1e-1c183b593013.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b60847ae7c5a1c6c661a576f842e6680\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/ee67efb1-9d27-293a-1d1e-1c183b593013.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fee67efb1-9d27-293a-1d1e-1c183b593013.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b99250fc1a5002154526982ba0bcd8b6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTarget\u003c/span\u003e \u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"GenerateMessagePack\"\u003c/span\u003e \u003cspan class=\"n\"\u003eAfterTargets\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Compile\"\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMessagePackGenerator\u003c/span\u003e \u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\".\\Sample.Shared.csproj\"\u003c/span\u003e \u003cspan class=\"n\"\u003eOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"..\\Sample.Unity\\Assets\\Scripts\\Generated\\MessagePack.Generated.cs\"\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eTarget\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTarget\u003c/span\u003e \u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"GenerateMagicOnion\"\u003c/span\u003e \u003cspan class=\"n\"\u003eAfterTargets\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Compile\"\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMagicOnionGenerator\u003c/span\u003e \u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\".\\Sample.Shared.csproj\"\u003c/span\u003e \u003cspan class=\"n\"\u003eOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"..\\Sample.Unity\\Assets\\Scripts\\Generated\\MagicOnion.Generated.cs\"\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eTarget\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの状態で Sample.Server をビルドすると Sample.Unity\\Assets\\Scripts\\Generated 以下にコードジェネレーターによってコードが生成されます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ae76072563656978f770d84ba1e1099aa1df5d4a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f35356164313964352d643565382d633034342d663661352d3831616234623339633633392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F55ad19d5-d5e8-c044-f6a5-81ab4b39c639.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1001aab7bf59571c70f9292aea6ddea8\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/55ad19d5-d5e8-c044-f6a5-81ab4b39c639.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F55ad19d5-d5e8-c044-f6a5-81ab4b39c639.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1a1e76830b5b7c5694a433c3780b137f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"54-生成されたコードの使用\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#54-%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%81%9F%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E4%BD%BF%E7%94%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5.4. 生成されたコードの使用\u003c/h3\u003e\n\n\u003cp\u003e次にこのコードを使用する設定を行います。\u003cbr\u003e\nScripts フォルダに C# Script を作り、名前を InitialSettings とします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/81d6544a4111ed091cc443b2175f7f4b9d87ba3e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f36336264356463662d373662392d663036392d343362362d3438636438663661663865392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F63bd5dcf-76b9-f069-43b6-48cd8f6af8e9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5ea16c696721b2deb22d7af748ee5e95\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/63bd5dcf-76b9-f069-43b6-48cd8f6af8e9.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F63bd5dcf-76b9-f069-43b6-48cd8f6af8e9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5300935f2acef2fdfebe8edb2e47fad7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eInitialSettings のコードは下記をコピペして保存します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMessagePack\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMessagePack.Resolvers\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eAssets.Scripts\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eInitialSettings\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eRuntimeInitializeOnLoadMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRuntimeInitializeLoadType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBeforeSceneLoad\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eRegisterResolvers\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// NOTE: Currently, CompositeResolver doesn't work on Unity IL2CPP build. Use StaticCompositeResolver instead of it.\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eStaticCompositeResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRegister\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMagicOnion\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResolvers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMagicOnionResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMessagePack\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResolvers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGeneratedResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eBuiltinResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ePrimitiveObjectResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMessagePack\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUnity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUnityResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eMessagePackSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultOptions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMessagePackSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultOptions\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eStaticCompositeResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれで IL2CPP の環境でも動作するようになりました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"6-ios-ビルド対応\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6-ios-%E3%83%93%E3%83%AB%E3%83%89%E5%AF%BE%E5%BF%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6. iOS ビルド対応\u003c/h2\u003e\n\n\u003cp\u003eiOS 用のビルドではさらに以下の追加作業が必要です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eDisable Bitcode\u003c/li\u003e\n\u003cli\u003eAdd libz.tbd\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAssets\\Editor に C# Script を追加し、名前を BuildIos とします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/0361ddd1b3a1898c3cf2781c98ec3fb65b9661e9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f66383834343937642d656330642d356662352d306639622d3163656465376364313338312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Ff884497d-ec0d-5fb5-0f9b-1cede7cd1381.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1cdc992b2448ced48e6dba76b69e4fb3\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/f884497d-ec0d-5fb5-0f9b-1cede7cd1381.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Ff884497d-ec0d-5fb5-0f9b-1cede7cd1381.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=dd4aee6ac487d88fd9a90aaa00a39786 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eBuildIos のコードは以下をコピペします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#if UNITY_IPHONE\n\u003c/span\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.IO\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEditor\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEditor.Callbacks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEditor.iOS.Xcode\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBuildIos\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// Handle libgrpc project settings.\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"target\"\u0026gt;\u0026lt;/param\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"path\"\u0026gt;\u0026lt;/param\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003ePostProcessBuild\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnPostProcessBuild\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBuildTarget\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eprojectPath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePBXProject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetPBXProjectPath\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eproject\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePBXProject\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eproject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadFromString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadAllText\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprojectPath\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etargetGuid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eproject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetUnityFrameworkTargetGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// libz.tbd for grpc ios build\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eproject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddFrameworkToProject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etargetGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"libz.tbd\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// libgrpc_csharp_ext missing bitcode. as BITCODE exand binary size to 250MB.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eproject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetBuildProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etargetGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ENABLE_BITCODE\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"NO\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteAllText\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprojectPath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eproject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e環境構築は以上で終了です。お疲れさまでした。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"7-マルチスタートアッププロジェクトについて\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#7-%E3%83%9E%E3%83%AB%E3%83%81%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e7. マルチスタートアッププロジェクトについて\u003c/h2\u003e\n\n\u003cp\u003e途中で説明を割愛したマルチスタートアッププロジェクトの利用方法です。\u003cbr\u003e\nソリューションを右クリックして、\u003ccode\u003eスタートアッププロジェクトの設定\u003c/code\u003e をクリックします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/9107e5388fe4f26bd0d5ba521177414fdbbe4e1e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f64633432396230362d383433332d366336622d323736322d3863646564376238626131342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fdc429b06-8433-6c6b-2762-8cded7b8ba14.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=92b51386be023eff92dfaef48ccf5884\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/dc429b06-8433-6c6b-2762-8cded7b8ba14.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fdc429b06-8433-6c6b-2762-8cded7b8ba14.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=35d1674b969bb10d613d3b144063dc91 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eマルチスタートアッププロジェクト\u003c/code\u003e にチェックをいれ、\u003ccode\u003eAssembly-CSharp\u003c/code\u003e と \u003ccode\u003eSample.Server\u003c/code\u003e のアクションを \u003ccode\u003e開始\u003c/code\u003e にして OK を押します。\u003c/p\u003e\n\n\u003cp\u003eこの状態で \u003ccode\u003e開始\u003c/code\u003e を押すとデバッガーを Unity にアタッチしながらサーバーを起動することができます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/2d5b7415cbbc45dd96fd24f68916a381673cd4a5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39373139332f30343263643336382d633137362d643732632d613730352d6264383464373761356237612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F042cd368-c176-d72c-a705-bd84d77a5b7a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e85e1fa1669a72850f39af1cc7a7297a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/042cd368-c176-d72c-a705-bd84d77a5b7a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2F042cd368-c176-d72c-a705-bd84d77a5b7a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=11e618129f598bab8c8e82d4147f748b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"8-後書きと参考にさせていただいた記事などへのリンク\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#8-%E5%BE%8C%E6%9B%B8%E3%81%8D%E3%81%A8%E5%8F%82%E8%80%83%E3%81%AB%E3%81%95%E3%81%9B%E3%81%A6%E3%81%84%E3%81%9F%E3%81%A0%E3%81%84%E3%81%9F%E8%A8%98%E4%BA%8B%E3%81%AA%E3%81%A9%E3%81%B8%E3%81%AE%E3%83%AA%E3%83%B3%E3%82%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e8. 後書きと参考にさせていただいた記事などへのリンク\u003c/h2\u003e\n\n\u003cp\u003eこんなに長い記事を最後まで読んでいただいてありがとうございます。\u003cbr\u003e\n少しでも役に立つことがあれば幸いです。\u003c/p\u003e\n\n\u003cp\u003e環境構築に成功して、より技術的な内容や実践的なコードが必要になった際は下記の記事などがおすすめです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Cysharp/MagicOnion\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGitHub の MagicOnion の README\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Cysharp/MagicOnion/tree/master/samples\" rel=\"nofollow noopener\" target=\"_blank\"\u003e公式の MagicOnion の Sample\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://tech.cygames.co.jp/archives/3181/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCygames Engineers' Blog MagicOnion – C#による .NET Core/Unity 用のリアルタイム通信フレームワーク\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/mitchydeath/items/cecf01493d1efeb4ae55\" id=\"reference-405401379e510df0f2d2\"\u003eUnity+MagicOnionで超絶手軽にリアルタイム通信を実装してみた\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/yKimisaki/items/1d55b08f3e7bcae46585\" id=\"reference-ec80272cbd1a2c12635d\"\u003eMagicOnion v2を使ってUnity IL2CPPでgRPC通信をする\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","createdAt":"2020-08-08T06:11:21Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"zXJ2ZTfdM3/N7Dw6x7Um5PmAD3YsUDY9xA==--qHuhT98mSAG1h0nD--LYJGA/6QAPwD1Rx/StA7+g==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-08-11T01:11:50Z","likesCount":25,"linkUrl":"https://qiita.com/_y_minami/items/db7b19eb5979ef1d6fe9","organization":null,"originalId":1278256,"stockedCount":25,"title":"Unity + .NET Core + MagicOnion v3 環境構築ハンズオン","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%9B%AE%E6%AC%A1\"\u003e目次\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1-%E7%92%B0%E5%A2%83%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e1. 環境について\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-unity-%E5%81%B4%E3%81%AE%E6%A7%8B%E7%AF%89\"\u003e2. Unity 側の構築\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#21-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E6%96%B0%E8%A6%8F%E4%BD%9C%E6%88%90playersettings-%E3%81%AE%E5%A4%89%E6%9B%B4%E5%90%84%E7%A8%AE%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e2.1. プロジェクトの新規作成、PlayerSettings の変更、各種フォルダの作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#22-magiconion-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e2.2. MagicOnion のインストール\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#23-messagepack-for-c-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e2.3. MessagePack for C# のインストール\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#24-grpc-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e2.4. gRPC のインストール\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#25-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%B8%E6%8E%A5%E7%B6%9A%E3%81%99%E3%82%8B%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E7%94%A8%E6%84%8F\"\u003e2.5. サーバーへ接続するスクリプトの用意\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#26-unity--%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E9%96%93%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E5%85%B1%E6%9C%89%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D%E7%94%A8%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E7%94%A8%E6%84%8F\"\u003e2.6. Unity ⇔ サーバー間のコード共有の動作確認用のクラスの用意\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%AE%E6%A7%8B%E7%AF%89\"\u003e3. サーバー側の構築\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#31-%E3%82%BD%E3%83%AA%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%B8%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e3.1. ソリューションへサーバー側のプロジェクトを追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#32-magiconion-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e3.2. MagicOnion のインストール\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#33-programcs-%E3%81%AE%E7%B7%A8%E9%9B%86\"\u003e3.3. Program.cs の編集\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#34-%E3%82%BD%E3%83%AA%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%B8%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e3.4. ソリューションへクラスライブラリのプロジェクトを追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#35-%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%B8-magiconionabstractions-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e3.5. クラスライブラリへ MagicOnion.Abstractions をインストール\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#36-%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%B8-messagepackunityshims-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e3.6. クラスライブラリへ MessagePack.UnityShims をインストール\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#37-%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%8B%E3%82%89-unity-%E5%81%B4%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B\"\u003e3.7. クラスライブラリから Unity 側のコードを参照する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#38-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%8B%E3%82%89%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B\"\u003e3.8. サーバー側のプロジェクトからクラスライブラリを参照する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4-api-%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%A8%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e4. API の実装と動作確認\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#41-%E6%99%AE%E9%80%9A%E3%81%AE-api%E9%80%9A%E4%BF%A1\"\u003e4.1. 普通の API通信\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#411-unity-%E5%81%B4%E3%81%A7-api-%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e4.1.1. Unity 側で API の定義を作る\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#412-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%A7-api-%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e4.1.2. サーバー側で API を実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#413-unity-%E5%81%B4%E3%81%A7-api-%E3%82%92%E5%91%BC%E3%81%B6%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e4.1.3. Unity 側で API を呼ぶコードを実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#414-api-%E9%80%9A%E4%BF%A1%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e4.1.4. API 通信の動作確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#42-%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E9%80%9A%E4%BF%A1\"\u003e4.2. リアルタイム通信\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#421-unity-%E5%81%B4%E3%81%A7-api-%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e4.2.1. Unity 側で API の定義を作る\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#422-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%A7-api-%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e4.2.2 サーバー側で API を実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#423-unity-%E5%81%B4%E3%81%A7-api-%E3%82%92%E5%91%BC%E3%81%B6%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e4.2.3. Unity 側で API を呼ぶコードを実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#424-%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E9%80%9A%E4%BF%A1%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e4.2.4. リアルタイム通信の動作確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#5-il2cpp-%E5%AF%BE%E5%BF%9C%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AC%E3%83%BC%E3%82%BF%E3%83%BC%E3%81%AB%E3%82%88%E3%82%8B%E3%82%B3%E3%83%BC%E3%83%89%E7%94%9F%E6%88%90\"\u003e5. IL2CPP 対応（コードジェネレーターによるコード生成）\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#51-magiconionmsbuildtasks-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e5.1. MagicOnion.MSBuild.Tasks のインストール\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#52-messagepackmsbuildtasks-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e5.2. MessagePack.MSBuild.Tasks のインストール\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#53-samplesharedcsproj-%E3%81%AE%E7%B7%A8%E9%9B%86\"\u003e5.3. Sample.Shared.csproj の編集\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#54-%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%81%9F%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E4%BD%BF%E7%94%A8\"\u003e5.4. 生成されたコードの使用\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#6-ios-%E3%83%93%E3%83%AB%E3%83%89%E5%AF%BE%E5%BF%9C\"\u003e6. iOS ビルド対応\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#7-%E3%83%9E%E3%83%AB%E3%83%81%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e7. マルチスタートアッププロジェクトについて\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#8-%E5%BE%8C%E6%9B%B8%E3%81%8D%E3%81%A8%E5%8F%82%E8%80%83%E3%81%AB%E3%81%95%E3%81%9B%E3%81%A6%E3%81%84%E3%81%9F%E3%81%A0%E3%81%84%E3%81%9F%E8%A8%98%E4%BA%8B%E3%81%AA%E3%81%A9%E3%81%B8%E3%81%AE%E3%83%AA%E3%83%B3%E3%82%AF\"\u003e8. 後書きと参考にさせていただいた記事などへのリンク\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":5130,"uuid":"db7b19eb5979ef1d6fe9","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"MTbRvMu8G0zoZ3gSSP3XRB+AvXk=--TkR866qhn4UpafGs--kdKloyRkpfYeI1HGX6MA5g==","originalId":97193,"description":"C# .NET Unity Azureが好きでその辺りのお仕事をしてます。\r\n趣味はゲーム制作とお菓子作りと紅茶。\r\n日本紅茶協会認定ティーアドバイザー。","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"南","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/97193/profile-images/1558851334","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fprofile-images%2F1558851334?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=01d1555f140c6975cd34ea51b7e9610b","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F97193%2Fprofile-images%2F1558851334?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=4b08510aff92369a0369f8e4db973360","urlName":"_y_minami","websiteUrl":"","twitterUrl":"https://twitter.com/_y_minami","twitterUrlName":"_y_minami","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":".NET","urlName":".net"},{"name":"Unity","urlName":"unity"},{"name":"gRPC","urlName":"grpc"},{"name":"MagicOnion","urlName":"magiconion"}],"followingLikers":{"edges":[]},"comments":{"totalCount":1}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

More than 3 years have passed since last update.Excel主義者はともかくきれいな表が好き。きれいというのは、単に見かけだけで、セル結合したり、罫線で囲った表は、再利用がほとんど不可能だ。そもそも罫線なのか図形なのか不明。
罫線で囲んだ文字を移動しようとすると、罫線がついてこない。
罫線で囲んだ文字がフォントを変更すると一部見えなくなるが、罫線を拡大できない。
罫線のある表を拡大縮小できない。
罫線のある表を無理に拡大縮小すると、枠の罫線がでこでこになる。
30ピクセルのExcel方眼紙を突如20ピクセルに変更することになり、図が全部縦長に。シネスコの映画をスタンダードにしたみたい。
結合してあるので、一部だけを移動できない。謎のメッセージ。
結合してある表を選択してコピーしてもコピーできない…。コピーできないっていったいどういうことだ!そこにとなりからExcel主義者の軽快なキーボード操作(単調なコピーペーストと移動)の繰り返しがリズミカルに響いてくる。
この単調なリズムは、究極の手作業をしている感じ。さて、そう歎いていてもしかたない。プログラムでなんとかできることはしようということで、やってみた。ユーザー管理(変更画面)の仕様書と思ってほしい。
ほとんどは平文だが、ごく少量マークアップの文字を使っている。そもそも「見出し」とテーブルがあり、それぞれは改行ふたつで区切る。
見出しは「見出し」タブと書く。テーブルは、1行目がヘッダ行となる。
ヘッダ行は、/2で結合するセルの数を示す。/2ならふたつのセルを結合するという意味。
この結合数をマーキングするために、「/」を使っているので、本文では/を使用できない。このあたりはすこし検討の余地がある。
セル内改行(\n)に☆を使っている。たとえば見出しを####にすれば、Markdownにそっくりになる。
とはいえ、このテキスト、ほとんどテキストといっていいと思う。タブ区切りで素性もいいと思う。
これを下記のコードを通すと、じゃーん! Excelの表のできあがりである。できた表はぜひご自分で確かめられたい。これを拡張すれば、txt2xlsxとなるなと思っている。使用には、ClosedXMLが必要。
別途。Cellクラスというクラスを作っている。セル文字と行を管理しているだけなので、なくても動く。やっているのは、テキストを行のかたまり=tableにわけ、見出しとテーブルとで処理をわけている。テーブルは、1行目をヘッダ行として特別扱いし、結合するセルの個数をもって、テーブルぜんたいに適応している。テキストをレイアウトしたあとに、セルを結合し、周囲に罫線を引いている。
という感じ。これで業務でじっさいに表を作って、かなり省力化できた。ともかく表を作り直すのが楽。検索もできるし、置換もしやすい。
いや作ってよかった。
感覚的にはTeXみたいな感じ。今後の、ほぼやらないけど課題と感じていることを、いちおう書き出しておこう。見出しを####に対応して、Markdown的に拡張することを検討。
コードを整理。リファクタリング。
「/」を区切り文字に使うのをやめる。
セルのheightに対応する。
結合セル数を自動指定。これができれば/2のような指定も不要。
セルによってセンタリングと左寄せを使い分け。仕様書は書き終わったので目的は達成しているので、よほど気が向いて時間があって、ほかにすることがなければ。



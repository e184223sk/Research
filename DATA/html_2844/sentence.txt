More than 1 year has passed since last update.Context Menuとは、右クリックすると出てくるMenuのことです。
それをカスタマイズしてみよう、という話しです。Inventorの場合は、ユーザー(AddIn開発者)がContext Menuを表示するには、予めMenuを作っておき右クリックEventでそれを表示するのではありません。
特に何も設定していなくても、右クリックをすればMenuが表示されます。

上の画像は、自作AddInでInteractionEvents実行中に右クリックをしたものです。
空に近い、最低限のMenuが自動で用意されて表示されます。
自前のMenuを表示するには、動的にこのMenuをカスタマイズします。Context Menuが表示される前に、次のEventが発生します。これをHookして、表示内容を動的に書き換えるわけです。似たようなものに、UserInputEvents.OnContextMenuがありますが、これは互換のためなのか、現在のAPIドキュメントには記載されていません。マーキングメニューの導入と同時に、改定されたのでしょう。
なお、名前にMarkingMenuとありますが、カスタマイズ → マーキング メニュー → クラッシク右クリック メニューを使用にチェックを入れていても、このEventでHookできます。さて、Menuに1行追加するには、次のようなcodeになります。シンプルにMenuに1行追加するにはAddButton()を使います。他にも色々ありますが、それらについてはAPI Helpを参照してください。
さて、このAddButton()の引数は、ButtonDefinitionです。つまり、Menuに項目を追加するためには、1項目(1行)ずつButtonDefinitionを作る(Inventor.CommandManager.ControlDefinitions.AddButtonDefinition()を実行する)必要があります。これらは一度作っておけば、使いまわしできます。
なんとも邪魔くさい話ですが、逆を言えば、Inventorで使える大よそ全ての機能をContextMenuに追加出来ます。Menuに表示されているのは、ButtonDefinitionですので、選択されるとOnExecuteEventが発生します。Ribbon上でButtonが押されたのと同じですね。さて、実際に追加してみました。

1行目の投影するがそれです。ここで、テキストの左にチェックが入っていることに注目してください。
これをどのように実装するのかで結構悩んだのですが、答えは簡単でした。これで、チェックが入ります。選択する度にトグルしたいのなら、OnExecuteは次のようになるでしょう。UserInputEvents.OnLinearMarkingMenuはグローバルなEventなので、Inventor実行中は常に有効です。
自作コマンドの実行中だけHookしたいのであれば、InteractionEvents.OnActivate()/InteractionEvents.OnTerminate()でEventを追加/削除すると良いでしょう。Autodesk Inventor API Hacking (概略)



More than 5 years have passed since last update.ある所に、C言語でドライバとかメンテしていれば良かったおっさんがいました。彼は紆余曲折の末、IoT系の部署に放り込まれ、やれAWSだデータ収集だと新しい仕事でテンぱっています。その流れで機械学習とか面白そうだと感じた彼は、とりあえず流行りのニューラルネット系でもいじってみようかなと考えました。この分野は画像処理が進んでますので、手始めに時崎狂三と鳶一折紙の区別でもさせてみようかと彼は思いました。が、どうも元データをどう集めるか結構面倒である事に気がついたのです。あっちこっちググりまくると、今（2016/7月）だとBingのWebAPIをC#から扱うのがまぁ簡単そうに見えました。なので、実際にやってみたのがこれです。本家の説明はここです
Azure系のWebWPIですね。要は。これを使うと検索が出来ますというもの。sadapon2008さんのPHPからBing Search APIを使って画像を収集するという記事がとても良くまとまっていますので、是非ご一読下さい。注意点は以下。ちなみにAzure Marketplaceサービス自体はここ、で今回使うBingは「データ」をクリックすると行きます。以下のリンクを見たり、ダウンロードしたりでやっていく感じと思います。Migrating Bing Search API Applicationsを見ると分かりますがC#のライブラリを使うと割と簡単に必要なデータが集められそうですが、以下の点に注意が必要です（これはdocxにも記述があります）あと、私の環境だけかもしれませんが、VisualStudio2015では以下の箇所でエラーが出たので少しいじりました。これで動きますが・・Bingでは1回の検索で50件までの応答が戻ります。50件でディープラーニングを名乗るのはさすがに恥ずかしいため（※）、もう少し欲しくなるじゃないですか。でもその方法が分からない・・
→※　まぁ学習済データを使って20件でディープラーニングしたとかいう話も聞いた事はありますが。。そこでカスな私がググるとこんなのが。Bing search api returns only 50 results per request ↑にもありますがこっちのADM_SCHEMA_GUIDEに記載があって、これに従った記述が必要です。具体的には以下ですね。以下は51件目からよこせと指示しているコードです。ちなみにこれはBing Search APIデータからリンクされているFAQでも記載がありました。良く見ろって事ですねごめなさい。という事で実際に書いてみました。さすがにライブラリを使えば非常に簡単でこんなので動きました。ほぼほぼサンプルのままですが。これは実際に動かしたアプリから該当部分を抜粋して、コピペしたものです。オプション系は一切使っていませんので、使う際はdocx系など見ながら設定すれば良いのかなと思っています。コードではタイトル（ブラウザでBIng検索した際に出るアレです）と画像へのURLのみ取り出していますが、もちろん他の情報を取り出す事も出来ます。上記の確認が行える動作確認用にアプリを、これの宣伝もかねて作ってみました。以下の機能を持ちます。CuiHelperを使っていますので、まずはHTML系のコンテンツが必要です。2.各項目を入力します。3.後はVisualStudioでビルドすればBingImageSearch.exeが出来ます。まず最初に謝罪。大変申し訳ございませんが、この確認で何回かトランザクションを消費してしまいます。ご理解の上、進んで戴ければ幸いです。10.ここでトランザクションが消費されます。51枚目以降が欲しければ、ComboBoxからNextをサーチすれば、続いて検索します。必要ならば繰り返して下さい。これは次にSearchを選択するまで続けることが出来ます。
11.複数回繰り返した後、例えば60枚目の確認がしたい場合は下図のようにTextBoxに数値を入れてENTERキーを押します。

12.このように出てきます(実際にはTOP画面が出ます。これはスクロールしたのをキャプチャしてます）この操作ではトランザクションは消費されません。

13.ここでトランザクションが消費されます。別のキーワードで画像を検索する際には、TextBoxに再び検索したい単語を入れて「Seach」を選択してください。
14.後は上記の操作を必要なだけ繰り返す感じです。また、「HOME」を選択すると最初のAPIの画面に戻ります。注意が必要な事として、例えば「プロ生ちゃん」で200枚検索した後に「くいなちゃん」で検索しますと、内部情報をクリアして、一覧画面（具体的にはhtml）を上書きしますので、プロ生ちゃんの一覧画面を見る事が出来なくなります。これに対してJSONファイルは検索単語を変更しても元のデータが消える事はありません。但し同じ単語で再検索した場合は上書きされます。SearchApplication.cs辺りを見てもらいますと、BingのAPI使った処理が記述されています。今はJSONで結果出力していますが、CSVに変えるのとかもここで割合簡単に出来るかと思います。以下使わせて戴きました。素晴らしいソフトウェアを提供して下さり、ありがとうございます。以上です。



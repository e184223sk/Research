<!DOCTYPE html><html><head><meta charset="utf-8" /><title>「IEnumerableの遅延評価」と「IObservableのCold-Hot」の共通点についてまとめた - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/yutorisan/items/fc566d8afe9ce9eb4f6d" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="1td1sNrmtyoJ0xZym1cExhpPQh4Beov4+jhND0F49KVhUkwKZ9F1NqJGDyDBCgpBL61ziSbSz/8NGyJV+B5PJw==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@yutorisan19" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="「IEnumerableの遅延評価」と「IObservableのCold-Hot」の共通点についてまとめた - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENNU1VWdWRXMWxjbUZpYkdYamdhN3BnWVhsdTdib3FaWGt2cUhqZ0kzamdhampnSXhKVDJKelpYSjJZV0pzWmVPQnJrTnZiR1F0U0c5MDQ0Q040NEd1NVlXeDZZQ2E1NEs1NDRHcjQ0R2s0NEdFNDRHbTQ0Ry00NEdvNDRLQjQ0R2YmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MjExNzJmOGJkMTg2ZDRjMjFlNDdmOTJjMjQ5ZWIwMTM&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGwxZEc5eWFYTmhiZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTgxODZjNmQyOWMyMjMwNjA0NDYxZjBhZTI0ODQ3YzI4&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=7600d015fe1e093402974c7c53c9ea8d"><meta property="og:description" content="

はじめに

LINQの「IEnumerableの遅延評価」と、ReactiveExtensionsの「IObservableのHod-Cold」は、どちらもLINQやRxを使い始めてしばらくするとぶち当たる壁ですね。避けては通れな..."><meta content="https://qiita.com/yutorisan/items/fc566d8afe9ce9eb4f6d" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,LINQ,ReactiveExtensions,遅延評価,UniRx" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-ca928d8e-bfc0-479b-8f6e-a8ef519db468"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fyutorisan%2Fitems%2Ffc566d8afe9ce9eb4f6d">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fyutorisan%2Fitems%2Ffc566d8afe9ce9eb4f6d">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-ca928d8e-bfc0-479b-8f6e-a8ef519db468">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2021-03-22T01:30:13.000+09:00","dateModified":"2021-03-22T10:10:42.000+09:00","headline":"「IEnumerableの遅延評価」と「IObservableのCold-Hot」の共通点についてまとめた","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENNU1VWdWRXMWxjbUZpYkdYamdhN3BnWVhsdTdib3FaWGt2cUhqZ0kzamdhampnSXhKVDJKelpYSjJZV0pzWmVPQnJrTnZiR1F0U0c5MDQ0Q040NEd1NVlXeDZZQ2E1NEs1NDRHcjQ0R2s0NEdFNDRHbTQ0Ry00NEdvNDRLQjQ0R2YmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MjExNzJmOGJkMTg2ZDRjMjFlNDdmOTJjMjQ5ZWIwMTM\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGwxZEc5eWFYTmhiZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTgxODZjNmQyOWMyMjMwNjA0NDYxZjBhZTI0ODQ3YzI4\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=7600d015fe1e093402974c7c53c9ea8d","mainEntityOfPage":"https://qiita.com/yutorisan/items/fc566d8afe9ce9eb4f6d","author":{"@type":"Person","address":"","email":null,"identifier":"yutorisan","name":"yutorisan","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F1274400166120812544%2FDAWcpHec_bigger.jpg?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=754be610f489085be0fdfc48de5585a9","url":"https://qiita.com/yutorisan","description":"C#が好きです","memberOf":[{"@type":"Organization","address":"オンライン@Slack","legalName":"Unityゲーム開発者ギルド","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/5e3ba3bb442371003e6b5d4618ef627b9b478357/original.jpg?1570216541","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","identifier":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yutorisan","type":"items","id":"fc566d8afe9ce9eb4f6d"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yutorisan","type":"items","id":"fc566d8afe9ce9eb4f6d"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yutorisan","type":"items","id":"fc566d8afe9ce9eb4f6d"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/yutorisan/items/fc566d8afe9ce9eb4f6d","location":"/yutorisan/items/fc566d8afe9ce9eb4f6d","scheme":"https","host":"qiita.com","port":null,"pathname":"/yutorisan/items/fc566d8afe9ce9eb4f6d","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"JmW25aEv3vK9IU3E6RE7//9aCXf1cCFIToKuJeaqkGuR4I9fHBgc7ha0VJazTDV4yrg44NLYZU+5ocF/X8wr6Q==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-b71b1a99-36a0-49ed-a671-d0b5b903140b"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yutorisan/items/fc566d8afe9ce9eb4f6d/likers" class="css-1iupg5d">5</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">4</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/fc566d8afe9ce9eb4f6d/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yutorisan/items/fc566d8afe9ce9eb4f6d/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yutorisan/items/fc566d8afe9ce9eb4f6d/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yutorisan/items/fc566d8afe9ce9eb4f6d/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yutorisan/items/fc566d8afe9ce9eb4f6d.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/yutorisan"><img class="css-100alwu eyfquo10" src="https://pbs.twimg.com/profile_images/1274400166120812544/DAWcpHec_bigger.jpg" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/yutorisan" class="css-10ougpm">@<!-- -->yutorisan</a><div class="css-1ay9vb9"><span><meta content="2021-03-21T16:30:13Z"/><time dateTime="2021-03-22T01:10:42Z" class="css-m19uds">updated at 2021-03-22</time></span></div></div></div></div></div><h1 class="css-cgzq40">「IEnumerableの遅延評価」と「IObservableのCold-Hot」の共通点についてまとめた</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/linq" class="css-4czcte">LINQ</a><a href="/tags/reactiveextensions" class="css-4czcte">ReactiveExtensions</a><a href="/tags/%e9%81%85%e5%bb%b6%e8%a9%95%e4%be%a1" class="css-4czcte">遅延評価</a><a href="/tags/unirx" class="css-4czcte">UniRx</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>LINQの「<strong><code>IEnumerable</code>の遅延評価</strong>」と、ReactiveExtensionsの「<strong><code>IObservable</code>のHod-Cold</strong>」は、どちらもLINQやRxを使い始めてしばらくするとぶち当たる壁ですね。避けては通れない道です。</p>

<p>先日、この両者にとある共通点を発見したので、記事にしてまとめました。</p>

<h2>
<span id="想定読者" class="fragment"></span><a href="#%E6%83%B3%E5%AE%9A%E8%AA%AD%E8%80%85"><i class="fa fa-link"></i></a>想定読者</h2>

<p>この記事は次のような方をターゲットにしています。</p>

<ul>
<li>LINQとRxをある程度使っている</li>
<li>遅延評価やHot-Coldについての理解が曖昧</li>
</ul>

<h1>
<span id="ienumerable" class="fragment"></span><a href="#ienumerable"><i class="fa fa-link"></i></a><code>IEnumerable</code>
</h1>

<p>まずは<code>IEnumerable</code>です。<br>
コレクションクラスが必ず実装する必要があるインターフェイスですね。</p>

<h2>
<span id="ienumerableの遅延評価" class="fragment"></span><a href="#ienumerable%E3%81%AE%E9%81%85%E5%BB%B6%E8%A9%95%E4%BE%A1"><i class="fa fa-link"></i></a><code>IEnumerable</code>の遅延評価</h2>

<p><code>IEnumerable</code>の遅延評価とは、「<strong>必要になるときまで計算しない</strong>」という<code>IEnumerable&lt;T&gt;</code>インターフェイスがもつ性質のことです。</p>

<p>例えば、以下のようなコードがあるとします。<br>
1~10までの整数のうち偶数のみを各2倍にして変数<code>enumerable</code>に格納して、それを<code>foreach</code>で回して出力するコードです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">enumerable</span> <span class="p">=</span>           <span class="c1">//変数「enumerable」に</span>
    <span class="n">Enumerable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>             <span class="c1">//1~10までのうち</span>
              <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>   <span class="c1">//偶数に絞り込んだものを</span>
              <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">*</span> <span class="m">2</span><span class="p">);</span>      <span class="c1">//2倍にしたものを代入する</span>

<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">num</span> <span class="k">in</span> <span class="n">enumerable</span><span class="p">)</span>
<span class="p">{</span> <span class="c1">//結果を出力</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">num</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>もちろん結果は「4, 8, 12, 16, 20」の順に出力されるのですが、この「4, 8, 12, 16, 20」という結果は、<strong>実は<code>foreach</code>で回したときに初めて計算されています</strong>。</p>

<p>普通の感覚だと、変数<code>enumerable</code>にLINQメソッドチェーンを代入した時点で、<code>enumerable</code>には「4, 8, 12, 16, 20」という計算結果が入っていると考えがちです。<br>
しかし、実際には<strong><code>enumerable</code>に代入した時点では、「4, 8, 12, 16, 20」という計算結果は入っていません</strong>。<br>
では何が入っているのかというと、<strong>「1〜10のうち偶数に絞り込んでそれらを2倍にしてね」という「命令」が入っています</strong>。</p>

<p>「命令」なので、計算自体はまだ実行しません。<br>
ではいつ実行するのかというと、必要になったときに初めて計算を実行します。<br>
つまり、<strong><code>foreach</code>で回したときになって初めて</strong>、「1〜10のうち偶数に絞り込んでそれらを2倍にする」という命令が実行され、結果が出力されることになります。</p>

<p>これが、「<strong>必要になるときまで計算しない</strong>」という<code>IEnumerable</code>の遅延評価の特性です。</p>

<h3>
<span id="遅延評価の注意点" class="fragment"></span><a href="#%E9%81%85%E5%BB%B6%E8%A9%95%E4%BE%A1%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>遅延評価の注意点</h3>

<p>さてこの遅延評価の注意点ですが、まだ評価されていない「命令」が入った<code>IEnumerable</code>を複数回<code>foreach</code>すると、<strong>「命令」が複数回実行されてしまう</strong>という点です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">enumerable</span> <span class="p">=</span>   <span class="c1">//「命令」を代入</span>
    <span class="n">Enumerable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>             
              <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>   
              <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">*</span> <span class="m">2</span><span class="p">);</span>      

<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">num</span> <span class="k">in</span> <span class="n">enumerable</span><span class="p">)</span> <span class="c1">//「命令」を実行</span>
<span class="p">{</span> 
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">num</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">num</span> <span class="k">in</span> <span class="n">enumerable</span><span class="p">)</span> <span class="c1">//「命令」を実行</span>
<span class="p">{</span> 
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">num</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code>enumerable</code>に入っているのはあくまで「<strong>命令</strong>」なので、2回<code>foreach</code>すると、命令が2回実行されてしまいます。<br>
これは明らかに無駄な処理ですね。本来であれば、この「命令」は1回実行すれば十分で、2回目以降は最初の実行結果を流用することができるはずです。</p>

<p>この特性を理解していないと、無駄な処理が走るだけではなく、思わぬバグの原因となります。<br>
次の例を見てください。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Hoge</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">Hoge</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Fugas</span> <span class="p">=</span> <span class="n">Enumerable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
                          <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">Fuga</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Fuga</span><span class="p">&gt;</span> <span class="n">Fugas</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>この例では、<code>IEnumerable&lt;Fuga&gt;</code>を外部に公開しています。<br>
もうお気づきとは思いますが、外部から<code>Fugas</code>プロパティが読まれるたびに、<code>Fuga</code>インスタンスが新しく10個生成されます。</p>

<p>これが意図した動作ならば良いのですが、「最初に生成した10個の<code>Fuga</code>インスタンスを使いまわしたい」という場合はこのコードではうまく動かないことになります。</p>

<h2>
<span id="即時評価" class="fragment"></span><a href="#%E5%8D%B3%E6%99%82%E8%A9%95%E4%BE%A1"><i class="fa fa-link"></i></a>即時評価</h2>

<p><code>IEnumerable</code>の遅延評価の紹介を行いましたが、それと対極となる言葉が「<strong>即時評価</strong>」です。</p>

<p>「遅延評価」は「<strong>必要になるときまで評価しない</strong>」という考え方でしたが、<br>
「即時評価」の場合はその名の通り「<strong>即座に評価する</strong>」となります。</p>

<p>遅延評価のように、「本当に必要になるときまで演算を実行しない」のではなく、「<strong>将来必要になるかどうかは分からないけど、とりあえずすべて計算して、計算した結果をキャッシュしておく</strong>」というのが即時評価の特徴です。<br>
事前にすべての計算を完了させ、その計算結果をキャッシュするので、前述のような「無駄な処理が走る」「意図せずインスタンスが大量生成されてしまう」などといった遅延評価の懸念点は、即時評価に変更することで解決することができます。</p>

<p>即時評価するには、<code>List&lt;T&gt;</code>や<code>T[]</code>などの具象オブジェクトに変換する作業が必要になります。<br>
とは言っても、<code>ToList()</code>や<code>ToArray()</code>などの拡張メソッドが用意されているため、LINQメソッドチェーンの最後にこれらを付けるだけで、即時評価に変更することができます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">enumerable</span> <span class="p">=</span>
    <span class="n">Enumerable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
              <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
              <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">*</span> <span class="m">2</span><span class="p">)</span>
              <span class="p">.</span><span class="nf">ToList</span><span class="p">();</span> <span class="c1">//即時評価。即命令が実行されenumerableには計算結果が入る</span>

<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">num</span> <span class="k">in</span> <span class="n">enumerable</span><span class="p">)</span>
<span class="p">{</span> 
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">num</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">num</span> <span class="k">in</span> <span class="n">enumerable</span><span class="p">)</span>
<span class="p">{</span> <span class="c1">//評価済みなので2回foreachしても無駄な処理は走らない</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">num</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>このように、遅延評価によって引き起こされる懸念を解消するためには、即時評価を適度に利用することが必要になります。</p>

<p>ここまでが<code>IEnumerable</code>の遅延評価のお話でした。<br>
続いて、<code>IObservable</code>のCold-Hotのお話です。</p>

<h1>
<span id="iobservable" class="fragment"></span><a href="#iobservable"><i class="fa fa-link"></i></a><code>IObservable</code>
</h1>

<p>みんな大好きRx。Rxといえば<code>IObservable&lt;T&gt;</code>。<br>
しかし、一口に<code>IObservable&lt;T&gt;</code>といっても「<strong>Cold</strong>」と「<strong>Hot</strong>」があります。<br>
ちょうど、<strong><code>IEnumerable&lt;T&gt;</code>にも「遅延評価」と「即時評価」があるように</strong>。</p>

<h2>
<span id="hotとcold" class="fragment"></span><a href="#hot%E3%81%A8cold"><i class="fa fa-link"></i></a>HotとCold</h2>

<p>まずは簡単にHotとColdの説明をします。</p>

<h3>
<span id="hot" class="fragment"></span><a href="#hot"><i class="fa fa-link"></i></a>Hot</h3>

<p>Hotな<code>IObservable</code>とは、<strong>購読者（Observer）を複数もつことができる<code>IObservable</code>のこと</strong>を言います。</p>

<p>Hotな<code>IObservable</code>は、<code>Subscribe</code>されたときに、その購読者を購読者リストに保持します。<br>
そして、値を発行するときには、購読者リストにあるすべての購読者に対して、一斉に値を発行します。</p>

<p>Observable（発行者）とObserver（購読者）が<strong>1:多</strong>の関係になるような<code>IObservable</code>と言えます。</p>

<h3>
<span id="cold" class="fragment"></span><a href="#cold"><i class="fa fa-link"></i></a>Cold</h3>

<p>対してColdな<code>IObservable</code>とは、<strong>購読者（Observer）を1つしか持つことができない<code>IObservable</code></strong>を指します。<br>
Coldな<code>IObservable</code>は、購読者リストを保持する機能がなく、ただ一つの購読者しか管理することができないのが特徴です。</p>

<p>Observable（発行者）とObserver（購読者）が<strong>1:1</strong>の関係になるような<code>IObservable</code>と言えます。</p>

<h3>
<span id="hotとcoldの見分け方" class="fragment"></span><a href="#hot%E3%81%A8cold%E3%81%AE%E8%A6%8B%E5%88%86%E3%81%91%E6%96%B9"><i class="fa fa-link"></i></a>HotとColdの見分け方</h3>

<p>HotとColdの見分け方は、<strong>値が<code>Subject&lt;T&gt;</code>クラスから送出されているかどうか</strong>で判断することができます。</p>

<p>Hotな<code>IObservable</code>は複数の購読者を管理することができると書きましたが、<code>Subject&lt;T&gt;</code>クラスはまさにこの、複数の購読者（Observer）を保持し、すべての購読者に対して同時に値を発行することができる機能を持っています。<br>
<strong>Hotな<code>IObservable&lt;T&gt;</code>とは、実質的には<code>Subject&lt;T&gt;</code>クラスそのものを指す</strong>のです。<br>
したがって、<strong>自分で<code>Subject&lt;T&gt;</code>クラスを用意するなどして公開した<code>IObservable</code>は、Hotである</strong>と判断することができます。</p>

<p>対して、Rxに用意されている各種オペレータやファクトリメソッドの多くは、<code>Subject&lt;T&gt;</code>クラスを利用していません。<br>
そのため、後述する一部を除き、<strong>Rxのオペレータやファクトリメソッドから生成された<code>IObservable</code>はColdである</strong>と判断することができます。</p>

<h2>
<span id="coldなiobservable" class="fragment"></span><a href="#cold%E3%81%AAiobservable"><i class="fa fa-link"></i></a>Coldな<code>IObservable</code>
</h2>

<p>前述したように、Coldな<code>IObservable</code>とは、<strong>購読者（Observer）を1つしか持てないような<code>IObservable</code></strong>です。<br>
値の発行者（Observable）と値の購読者（Observer）が<strong>1対1の関係</strong>になるような<code>IObservable</code>とも言えます。</p>

<p>例えば、以下のコードを見てください。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">//変数「observable」に1〜10までの値を発行するIObservableを代入</span>
<span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">observable</span> <span class="p">=</span> 
    <span class="n">Observable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">);</span>

<span class="c1">//observableを購読</span>
<span class="n">observable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">);</span>
</code></pre></div></div>

<p><code>Observable.Range</code>ファクトリメソッドから生成される<code>IObservable</code>はColdです。<br>
Coldなので、<strong>購読者は1つしか持てません</strong>。<br>
この場合、購読(<code>Subscribe</code>)しているのは1つのみのため、何も問題なく購読することができます。</p>

<p>では、次のように<strong>複数の購読者</strong>がいた場合はどうなるのでしょうか。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">//変数「observable」に1〜10までの値を発行するIObservableを代入</span>
<span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">observable</span> <span class="p">=</span> 
    <span class="n">Observable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">);</span>

<span class="c1">//observableを複数の購読者が購読</span>
<span class="n">observable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">);</span>
<span class="n">observable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">);</span>
</code></pre></div></div>

<p>Coldな<code>IObservable</code>なのに複数回<code>Subscribe</code>されています。<br>
しかしながら、この場合でも、Coldだから1回しか<code>Subscribe</code>を受け付けないということはなく、きちんと<code>Subscribe</code>した分だけ購読することができます。</p>

<p>Coldな<code>IObservable</code>は1つしか購読者が持てないのに、複数回<code>Subscribe</code>ができるのは矛盾しているように感じます。<br>
なぜ、Coldな<code>IObservable</code>なのに複数の購読者を登録できるのかというと、<strong>Observableソースが<code>Subscribe</code>された分だけ生成されている</strong>からです。<br>
結果的には、<strong>Observableソースと購読者は1対1</strong>となるため、Coldな<code>IObservable</code>の要件は満たすというわけです。</p>

<h3>
<span id="coldなiobservableの注意点" class="fragment"></span><a href="#cold%E3%81%AAiobservable%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>Coldな<code>IObservable</code>の注意点</h3>

<p><code>Subscribe</code>した分だけObservableソースが生成されるとはいえ、Coldな<code>IObservable</code>でも複数購読が可能であれば、何が問題なのか？と思うかもしれませんが、次のような場合に注意が必要になってきます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>
<span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">observable</span> <span class="p">=</span>       <span class="c1">//変数「observable」に、</span>
    <span class="n">Observable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>         <span class="c1">//「1~10までの整数を発行するObservableソースを生成して</span>
              <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">%</span> <span class="m">2</span><span class="p">)</span>    <span class="c1">//そのうち偶数のものだけを次に通し、</span>
              <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">*</span> <span class="m">2</span><span class="p">);</span>  <span class="c1">//2倍にしたものを発行する命令」を格納</span>

<span class="c1">//observableを複数の購読者が購読</span>
<span class="n">observable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">);</span>
<span class="n">observable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">);</span>
</code></pre></div></div>

<p>このコードでは、「1~10までの整数を発行するObservableソースを生成して、そのソースから発行された値を偶数で絞り込んで、絞り込んだ結果に対して2倍したものを発行する命令」を変数<code>observable</code>に代入しています。<br>
そして、その<code>observable</code>を複数回<code>Subscribe</code>しています。</p>

<p>変数<code>observable</code>には、「1~10までの整数を発行するObservableソースを生成して、そのソースから発行された値を偶数で絞り込んで、絞り込んだ結果に対して2倍したものを発行する命令」が入っているのでした。<br>
これを複数回<code>Subscribe</code>すれば、「1~10までの整数を発行して、それを偶数で絞り込んで、その絞り込み結果を2倍したものを発行する<code>IObservable</code>」が複数個複製されてしまうことになります。</p>

<p>つまり、<strong>Observableソースの生成処理とLINQオペレータの処理が、Subscribeされた回数分だけ走る</strong>ことになってしまいます。</p>

<p>これが意図した動作ならば良いのですが、そうでない場合（1個のObservableソースを共有したい場合）には、無駄な処理が走ってしまったり、場合によってはバグの原因となってしまうため、注意が必要です。</p>

<h2>
<span id="hotなiobservable" class="fragment"></span><a href="#hot%E3%81%AAiobservable"><i class="fa fa-link"></i></a>Hotな<code>IObservable</code>
</h2>

<p>Coldの対極となるのがHotです。</p>

<p>Coldな<code>IObservable</code>が1つの購読者しか持てないのに対して、<br>
Hotな<code>IObservable</code>は<strong>複数の購読者を同時に持つことができます</strong>。</p>

<p>つまり、Hotな<code>IObservable</code>ならば、<strong>複数回<code>Subscribe</code>されても、Observableソースを複製することなく</strong>、各購読者に対して値を発行することができます。<br>
したがって、前述したようなColdな<code>IObservable</code>の問題点は、<strong>Hotな<code>IObservable</code>に変換することで解決する</strong>ということになります。</p>

<p>幸い、RxにはColdをHotに変換するオペレータが用意されているため、Hot変換したいタイミングで簡単にHot変換することができます。<br>
<strong>その代表例が、<code>Publish()</code>メソッドです。</strong></p>

<p><code>Publish()</code>メソッドの役割を簡単に説明すると、次のようになります。</p>

<ol>
<li>入力となる<code>IObservable&lt;T&gt;</code>と<code>Subject&lt;T&gt;</code>を内部に保持する。</li>
<li>
<code>Connect()</code>メソッドが呼ばれると、入力の<code>IObservable</code>を<code>Subscribe</code>して、得た通知をそのまま<code>Subject&lt;T&gt;</code>に伝達する。</li>
<li>
<code>Subject&lt;T&gt;</code>の<code>IObservable&lt;T&gt;</code>を外部に公開する。</li>
</ol>

<p>つまり、入力となるColdな<code>IObservable</code>から発せられる通知を、<strong>複数の購読者を管理する機能を持つ<code>Subject&lt;T&gt;</code>に仲介させる</strong>ことによって、複数の購読者を受付可能なHotな<code>Observable</code>に変換するという仕組みとなっています。</p>

<p>また、<code>Connect()</code>メソッドを呼び出す必要がありますので、<code>Publish()</code>メソッドの戻り値は<strong><code>IConnectableObservable</code>インターフェイス</strong>となります。</p>

<p>使用例としては次のようになります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>
<span class="n">IConnectableObservable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">observable</span> <span class="p">=</span> 
    <span class="n">Observable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
              <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">%</span> <span class="m">2</span><span class="p">)</span>
              <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">*</span> <span class="m">2</span><span class="p">)</span>
              <span class="p">.</span><span class="nf">Publish</span><span class="p">();</span> <span class="c1">//Publish以前のIObservableを保持したIConnectableObservableにする</span>

<span class="c1">//Publishの内部が持つSubjectを購読</span>
<span class="n">observable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">);</span>
<span class="n">observable</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">);</span>

<span class="c1">//Publish以前のIObservableをSubscribeして、Subjectに伝える</span>
<span class="n">observable</span><span class="p">.</span><span class="nf">Connect</span><span class="p">();</span>

</code></pre></div></div>

<p>詳しい使い方については他記事で紹介されているため、そちらを参照ください。</p>

<p><qiita-embed-ogp src="https://qiita.com/acple@github/items/8d3a4d3414fa59adff70#hot%E3%81%AAobservablecold%E3%81%AAobservable"></qiita-embed-ogp></p>

<h1>
<span id="ienumerableの遅延評価とiobservableのhotcoldの関係性" class="fragment"></span><a href="#ienumerable%E3%81%AE%E9%81%85%E5%BB%B6%E8%A9%95%E4%BE%A1%E3%81%A8iobservable%E3%81%AEhotcold%E3%81%AE%E9%96%A2%E4%BF%82%E6%80%A7"><i class="fa fa-link"></i></a><code>IEnumerable</code>の遅延評価と<code>IObservable</code>のHotColdの関係性</h1>

<p>前置きが非常に長くなりここからが本題ですが、「<code>IEnumerable</code>の遅延評価・即時評価」と「<code>IObservable</code>のHot・Cold」って、似ているものがある思いませんか？<br>
違いを以下の表にまとめてみました。</p>

<table>
<thead>
<tr>
<th></th>
<th><code>IEnumerable</code></th>
<th><code>IEnumerable</code></th>
<th><code>IObservable</code></th>
<th><code>IObservable</code></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><strong>遅延評価</strong></td>
<td><strong>即時評価</strong></td>
<td><strong>Cold</strong></td>
<td><strong>Hot</strong></td>
</tr>
<tr>
<td>使用する命令</td>
<td><code>foreach</code></td>
<td><code>foreach</code></td>
<td><code>Subscribe</code></td>
<td><code>Subscribe</code></td>
</tr>
<tr>
<td>変数に入っているもの</td>
<td>コレクション<strong>操作の命令</strong>が入っている</td>
<td>コレクションの操作済みの<strong>値そのもの</strong>が入っている</td>
<td>
<code>IObservable</code>からの通知結果を<strong>操作する命令</strong>が入っている</td>
<td>
<strong>Observableソースそのもの</strong>が入っている</td>
</tr>
<tr>
<td>特徴</td>
<td>複数回<code>foreach</code>されると<strong>命令が毎回実行</strong>される</td>
<td>複数回<code>foreach</code>されても<strong>命令の実行は1回</strong>だけ</td>
<td>
<strong>単一</strong>の購読者しか持てない。<br>複数回<code>Subscribe</code>されるとObservableソースから複製される</td>
<td>
<strong>複数</strong>の購読者を持てる</td>
</tr>
<tr>
<td>変換</td>
<td>
<strong>即時評価に変換</strong>：<br><code>ToList()</code>, <code>ToArray()</code>など</td>
<td>-</td>
<td>
<strong>Hotに変換</strong>：<br><code>Publish()</code>, <code>Multicast()</code>など</td>
<td>-</td>
</tr>
</tbody>
</table>

<h2>
<span id="変数に命令が入っているかそのものが入っているか" class="fragment"></span><a href="#%E5%A4%89%E6%95%B0%E3%81%AB%E5%91%BD%E4%BB%A4%E3%81%8C%E5%85%A5%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B%E3%81%9D%E3%81%AE%E3%82%82%E3%81%AE%E3%81%8C%E5%85%A5%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>変数に「命令」が入っているか「そのもの」が入っているか</h2>

<p>１つ目の共通点として、変数に入っているものの特性が挙げられます。</p>

<h3>
<span id="遅延評価とcoldは命令が入っている" class="fragment"></span><a href="#%E9%81%85%E5%BB%B6%E8%A9%95%E4%BE%A1%E3%81%A8cold%E3%81%AF%E5%91%BD%E4%BB%A4%E3%81%8C%E5%85%A5%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B"><i class="fa fa-link"></i></a>「遅延評価」と「Cold」は「命令」が入っている</h3>

<p>表からもわかるように、「IEnumerableの遅延評価」と「IObservableのCold」は、どちらも変数に「<strong>命令</strong>」が入っているということがわかります。</p>

<p>ここでいう「命令」というのは、具体的にはLINQオペレータによる操作のことです。<br>
変数に「命令」、すなわちLINQオペレータによる操作が入っているということは、複数回使用するとLINQオペレータによる操作がその分毎回実行されることを意味します。</p>

<p>すでに挙げた例ですが、以下のような例で考えます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>
<span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">enumerable</span> <span class="p">=</span>
    <span class="n">Enumerable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
              <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
              <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">*</span> <span class="m">2</span><span class="p">);</span>
</code></pre></div></div>

<p>このとき、遅延評価<code>IEnumerable&lt;int&gt;</code>型の変数「enumerable」には、1〜10までの整数のコレクションを作って、偶数で絞り込んで、2倍して、という「<strong>命令</strong>」が入ります。<br>
「命令」が入っているので、複数回使用すれば、当然「命令」も複数回実行されてしまいます。</p>

<p>Cold Observableの場合も同様です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">observable</span> <span class="p">=</span>
    <span class="n">Observable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
              <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
              <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">*</span> <span class="m">2</span><span class="p">);</span>
</code></pre></div></div>

<p>Coldな<code>IObservable&lt;int&gt;</code>型の変数「observable」には、1〜10までの整数を発行するObservableソースを作って、偶数で絞り込んで、2倍して、という「<strong>命令</strong>」が入ります。<br>
「命令」が入っているので、複数回購読すれば、当然「命令」も複数回実行されます。</p>

<h3>
<span id="即時評価とhotはそのものが入っている" class="fragment"></span><a href="#%E5%8D%B3%E6%99%82%E8%A9%95%E4%BE%A1%E3%81%A8hot%E3%81%AF%E3%81%9D%E3%81%AE%E3%82%82%E3%81%AE%E3%81%8C%E5%85%A5%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B"><i class="fa fa-link"></i></a>「即時評価」と「Hot」は「そのもの」が入っている</h3>

<p>「そのもの」とは、その変数から最終的に得られる情報のことです。<br>
<code>IEnumerable</code>であれば、Enumerableソースから情報を受け取ってLINQによる演算をした結果そのものであるし、<br>
<code>IObservable</code>であれば、Observableソースからの通知を受けてLINQによる演算を行った結果に対する購読権のことです。</p>

<p>最終的に得られる情報そのものが入っているので、複数回<code>foreach</code>しようが、複数回<code>Subscribe</code>しようが、LINQによる操作は重複して実行されることはありません。<br>
最初の１回だけ実行され、あとは、計算済みの値を使い回すことができます。</p>

<h2>
<span id="命令からそのものへの変換は可能ただし逆は不可能" class="fragment"></span><a href="#%E5%91%BD%E4%BB%A4%E3%81%8B%E3%82%89%E3%81%9D%E3%81%AE%E3%82%82%E3%81%AE%E3%81%B8%E3%81%AE%E5%A4%89%E6%8F%9B%E3%81%AF%E5%8F%AF%E8%83%BD%E3%81%9F%E3%81%A0%E3%81%97%E9%80%86%E3%81%AF%E4%B8%8D%E5%8F%AF%E8%83%BD"><i class="fa fa-link"></i></a>「命令」から「そのもの」への変換は可能、ただし逆は不可能</h2>

<p>２つ目の共通点として、「命令」から「そのもの」への変換は可能だが、逆は不可能という点があります。</p>

<p><code>IEnumerable</code>ならば<code>ToArray()</code>や<code>ToList()</code>、<br>
<code>IObservable</code>ならば<code>Publish()</code>や<code>Multicast()</code>といった、「命令」から「そのもの」への変換メソッドが用意されています。<br>
どちらも、LINQメソッドチェーンの末尾に付けるだけで、簡単に変換することが可能です。</p>

<p>ただし、逆は不可能です。<br>
一度「そのもの」、つまり演算結果になってしまったものを、「命令」、つまり演算する方法に戻すことはできないからです。</p>

<h2>
<span id="つまり何が言いたいのか" class="fragment"></span><a href="#%E3%81%A4%E3%81%BE%E3%82%8A%E4%BD%95%E3%81%8C%E8%A8%80%E3%81%84%E3%81%9F%E3%81%84%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>つまり何が言いたいのか</h2>

<ul>
<li>コレクション版LINQもRx版LINQも、ひとつのソースを複数で共有して使うことがあったら、遅延評価とColdには気をつけましょう。</li>
<li>遅延評価やColdのまま複数箇所で共有して使用すると、ソースまで遡ってLINQ演算命令が複製されてしまいます。</li>
<li>回避するには即時評価・Hot変換を行いましょう。</li>
</ul>

<h1>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h1>

<p>「<code>IEnumerable</code>の遅延評価・即時評価」と「<code>IObservable</code>のCold・Hot」は関係が薄いように見えても、本質的な部分を見ると意外と関係があるのではないか？と思えてきたので記事にして投稿してみました。</p>

<p>やはり他人に説明できるように記事にすると、理解が曖昧だった部分を強制的に勉強することになるので理解が深まって良いですね。<br>
異論やご指摘はもちろん受け付けますので、是非コメントお寄せください。</p>

<p>最後までありがというございました。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fyutorisan%2Fitems%2Ffc566d8afe9ce9eb4f6d&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fyutorisan%2Fitems%2Ffc566d8afe9ce9eb4f6d&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yutorisan/items/fc566d8afe9ce9eb4f6d/likers" class="css-1iupg5d">5</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">4</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/fc566d8afe9ce9eb4f6d/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yutorisan/items/fc566d8afe9ce9eb4f6d/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yutorisan/items/fc566d8afe9ce9eb4f6d/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yutorisan/items/fc566d8afe9ce9eb4f6d/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yutorisan/items/fc566d8afe9ce9eb4f6d.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-b71b1a99-36a0-49ed-a671-d0b5b903140b">{"authorAnalyticsTrackingId":"UA-135447292-3","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-acf6559a-7d7b-4453-9ded-b0cf231ee1b1"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-acf6559a-7d7b-4453-9ded-b0cf231ee1b1">{}</script>
      
<div id="LoginModal-react-component-5dbf4353-47d5-4b14-a821-c83b017917c1"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-5dbf4353-47d5-4b14-a821-c83b017917c1">{}</script>
      
<div id="StockModal-react-component-033a4e89-c1c4-4567-b800-d10b4019d756"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-033a4e89-c1c4-4567-b800-d10b4019d756">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;c2G7V7IO1x081dCzfUYY6CdOix0bCQ/eHf9abjlLuc3E5ILtDzkVAZdAyeEnGxZvEqy6ijyhS9nq3DU0gC0CTw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eLINQの「\u003cstrong\u003e\u003ccode\u003eIEnumerable\u003c/code\u003eの遅延評価\u003c/strong\u003e」と、ReactiveExtensionsの「\u003cstrong\u003e\u003ccode\u003eIObservable\u003c/code\u003eのHod-Cold\u003c/strong\u003e」は、どちらもLINQやRxを使い始めてしばらくするとぶち当たる壁ですね。避けては通れない道です。\u003c/p\u003e\n\n\u003cp\u003e先日、この両者にとある共通点を発見したので、記事にしてまとめました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"想定読者\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%83%B3%E5%AE%9A%E8%AA%AD%E8%80%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e想定読者\u003c/h2\u003e\n\n\u003cp\u003eこの記事は次のような方をターゲットにしています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eLINQとRxをある程度使っている\u003c/li\u003e\n\u003cli\u003e遅延評価やHot-Coldについての理解が曖昧\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ienumerable\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ienumerable\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eIEnumerable\u003c/code\u003e\n\u003c/h1\u003e\n\n\u003cp\u003eまずは\u003ccode\u003eIEnumerable\u003c/code\u003eです。\u003cbr\u003e\nコレクションクラスが必ず実装する必要があるインターフェイスですね。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ienumerableの遅延評価\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ienumerable%E3%81%AE%E9%81%85%E5%BB%B6%E8%A9%95%E4%BE%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eIEnumerable\u003c/code\u003eの遅延評価\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eIEnumerable\u003c/code\u003eの遅延評価とは、「\u003cstrong\u003e必要になるときまで計算しない\u003c/strong\u003e」という\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスがもつ性質のことです。\u003c/p\u003e\n\n\u003cp\u003e例えば、以下のようなコードがあるとします。\u003cbr\u003e\n1~10までの整数のうち偶数のみを各2倍にして変数\u003ccode\u003eenumerable\u003c/code\u003eに格納して、それを\u003ccode\u003eforeach\u003c/code\u003eで回して出力するコードです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e           \u003cspan class=\"c1\"\u003e//変数「enumerable」に\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e             \u003cspan class=\"c1\"\u003e//1~10までのうち\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e   \u003cspan class=\"c1\"\u003e//偶数に絞り込んだものを\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e      \u003cspan class=\"c1\"\u003e//2倍にしたものを代入する\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e//結果を出力\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eもちろん結果は「4, 8, 12, 16, 20」の順に出力されるのですが、この「4, 8, 12, 16, 20」という結果は、\u003cstrong\u003e実は\u003ccode\u003eforeach\u003c/code\u003eで回したときに初めて計算されています\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003e普通の感覚だと、変数\u003ccode\u003eenumerable\u003c/code\u003eにLINQメソッドチェーンを代入した時点で、\u003ccode\u003eenumerable\u003c/code\u003eには「4, 8, 12, 16, 20」という計算結果が入っていると考えがちです。\u003cbr\u003e\nしかし、実際には\u003cstrong\u003e\u003ccode\u003eenumerable\u003c/code\u003eに代入した時点では、「4, 8, 12, 16, 20」という計算結果は入っていません\u003c/strong\u003e。\u003cbr\u003e\nでは何が入っているのかというと、\u003cstrong\u003e「1〜10のうち偶数に絞り込んでそれらを2倍にしてね」という「命令」が入っています\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003e「命令」なので、計算自体はまだ実行しません。\u003cbr\u003e\nではいつ実行するのかというと、必要になったときに初めて計算を実行します。\u003cbr\u003e\nつまり、\u003cstrong\u003e\u003ccode\u003eforeach\u003c/code\u003eで回したときになって初めて\u003c/strong\u003e、「1〜10のうち偶数に絞り込んでそれらを2倍にする」という命令が実行され、結果が出力されることになります。\u003c/p\u003e\n\n\u003cp\u003eこれが、「\u003cstrong\u003e必要になるときまで計算しない\u003c/strong\u003e」という\u003ccode\u003eIEnumerable\u003c/code\u003eの遅延評価の特性です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"遅延評価の注意点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%81%85%E5%BB%B6%E8%A9%95%E4%BE%A1%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e遅延評価の注意点\u003c/h3\u003e\n\n\u003cp\u003eさてこの遅延評価の注意点ですが、まだ評価されていない「命令」が入った\u003ccode\u003eIEnumerable\u003c/code\u003eを複数回\u003ccode\u003eforeach\u003c/code\u003eすると、\u003cstrong\u003e「命令」が複数回実行されてしまう\u003c/strong\u003eという点です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e   \u003cspan class=\"c1\"\u003e//「命令」を代入\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e             \n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e   \n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e      \n\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e//「命令」を実行\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e//「命令」を実行\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eenumerable\u003c/code\u003eに入っているのはあくまで「\u003cstrong\u003e命令\u003c/strong\u003e」なので、2回\u003ccode\u003eforeach\u003c/code\u003eすると、命令が2回実行されてしまいます。\u003cbr\u003e\nこれは明らかに無駄な処理ですね。本来であれば、この「命令」は1回実行すれば十分で、2回目以降は最初の実行結果を流用することができるはずです。\u003c/p\u003e\n\n\u003cp\u003eこの特性を理解していないと、無駄な処理が走るだけではなく、思わぬバグの原因となります。\u003cbr\u003e\n次の例を見てください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eHoge\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eFugas\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                          \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFuga\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFuga\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eFugas\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの例では、\u003ccode\u003eIEnumerable\u0026lt;Fuga\u0026gt;\u003c/code\u003eを外部に公開しています。\u003cbr\u003e\nもうお気づきとは思いますが、外部から\u003ccode\u003eFugas\u003c/code\u003eプロパティが読まれるたびに、\u003ccode\u003eFuga\u003c/code\u003eインスタンスが新しく10個生成されます。\u003c/p\u003e\n\n\u003cp\u003eこれが意図した動作ならば良いのですが、「最初に生成した10個の\u003ccode\u003eFuga\u003c/code\u003eインスタンスを使いまわしたい」という場合はこのコードではうまく動かないことになります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"即時評価\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8D%B3%E6%99%82%E8%A9%95%E4%BE%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e即時評価\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eIEnumerable\u003c/code\u003eの遅延評価の紹介を行いましたが、それと対極となる言葉が「\u003cstrong\u003e即時評価\u003c/strong\u003e」です。\u003c/p\u003e\n\n\u003cp\u003e「遅延評価」は「\u003cstrong\u003e必要になるときまで評価しない\u003c/strong\u003e」という考え方でしたが、\u003cbr\u003e\n「即時評価」の場合はその名の通り「\u003cstrong\u003e即座に評価する\u003c/strong\u003e」となります。\u003c/p\u003e\n\n\u003cp\u003e遅延評価のように、「本当に必要になるときまで演算を実行しない」のではなく、「\u003cstrong\u003e将来必要になるかどうかは分からないけど、とりあえずすべて計算して、計算した結果をキャッシュしておく\u003c/strong\u003e」というのが即時評価の特徴です。\u003cbr\u003e\n事前にすべての計算を完了させ、その計算結果をキャッシュするので、前述のような「無駄な処理が走る」「意図せずインスタンスが大量生成されてしまう」などといった遅延評価の懸念点は、即時評価に変更することで解決することができます。\u003c/p\u003e\n\n\u003cp\u003e即時評価するには、\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eや\u003ccode\u003eT[]\u003c/code\u003eなどの具象オブジェクトに変換する作業が必要になります。\u003cbr\u003e\nとは言っても、\u003ccode\u003eToList()\u003c/code\u003eや\u003ccode\u003eToArray()\u003c/code\u003eなどの拡張メソッドが用意されているため、LINQメソッドチェーンの最後にこれらを付けるだけで、即時評価に変更することができます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToList\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e//即時評価。即命令が実行されenumerableには計算結果が入る\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e//評価済みなので2回foreachしても無駄な処理は走らない\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのように、遅延評価によって引き起こされる懸念を解消するためには、即時評価を適度に利用することが必要になります。\u003c/p\u003e\n\n\u003cp\u003eここまでが\u003ccode\u003eIEnumerable\u003c/code\u003eの遅延評価のお話でした。\u003cbr\u003e\n続いて、\u003ccode\u003eIObservable\u003c/code\u003eのCold-Hotのお話です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"iobservable\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#iobservable\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eIObservable\u003c/code\u003e\n\u003c/h1\u003e\n\n\u003cp\u003eみんな大好きRx。Rxといえば\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003e。\u003cbr\u003e\nしかし、一口に\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eといっても「\u003cstrong\u003eCold\u003c/strong\u003e」と「\u003cstrong\u003eHot\u003c/strong\u003e」があります。\u003cbr\u003e\nちょうど、\u003cstrong\u003e\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eにも「遅延評価」と「即時評価」があるように\u003c/strong\u003e。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"hotとcold\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#hot%E3%81%A8cold\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHotとCold\u003c/h2\u003e\n\n\u003cp\u003eまずは簡単にHotとColdの説明をします。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"hot\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#hot\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHot\u003c/h3\u003e\n\n\u003cp\u003eHotな\u003ccode\u003eIObservable\u003c/code\u003eとは、\u003cstrong\u003e購読者（Observer）を複数もつことができる\u003ccode\u003eIObservable\u003c/code\u003eのこと\u003c/strong\u003eを言います。\u003c/p\u003e\n\n\u003cp\u003eHotな\u003ccode\u003eIObservable\u003c/code\u003eは、\u003ccode\u003eSubscribe\u003c/code\u003eされたときに、その購読者を購読者リストに保持します。\u003cbr\u003e\nそして、値を発行するときには、購読者リストにあるすべての購読者に対して、一斉に値を発行します。\u003c/p\u003e\n\n\u003cp\u003eObservable（発行者）とObserver（購読者）が\u003cstrong\u003e1:多\u003c/strong\u003eの関係になるような\u003ccode\u003eIObservable\u003c/code\u003eと言えます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"cold\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cold\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCold\u003c/h3\u003e\n\n\u003cp\u003e対してColdな\u003ccode\u003eIObservable\u003c/code\u003eとは、\u003cstrong\u003e購読者（Observer）を1つしか持つことができない\u003ccode\u003eIObservable\u003c/code\u003e\u003c/strong\u003eを指します。\u003cbr\u003e\nColdな\u003ccode\u003eIObservable\u003c/code\u003eは、購読者リストを保持する機能がなく、ただ一つの購読者しか管理することができないのが特徴です。\u003c/p\u003e\n\n\u003cp\u003eObservable（発行者）とObserver（購読者）が\u003cstrong\u003e1:1\u003c/strong\u003eの関係になるような\u003ccode\u003eIObservable\u003c/code\u003eと言えます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"hotとcoldの見分け方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#hot%E3%81%A8cold%E3%81%AE%E8%A6%8B%E5%88%86%E3%81%91%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHotとColdの見分け方\u003c/h3\u003e\n\n\u003cp\u003eHotとColdの見分け方は、\u003cstrong\u003e値が\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスから送出されているかどうか\u003c/strong\u003eで判断することができます。\u003c/p\u003e\n\n\u003cp\u003eHotな\u003ccode\u003eIObservable\u003c/code\u003eは複数の購読者を管理することができると書きましたが、\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスはまさにこの、複数の購読者（Observer）を保持し、すべての購読者に対して同時に値を発行することができる機能を持っています。\u003cbr\u003e\n\u003cstrong\u003eHotな\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eとは、実質的には\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスそのものを指す\u003c/strong\u003eのです。\u003cbr\u003e\nしたがって、\u003cstrong\u003e自分で\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスを用意するなどして公開した\u003ccode\u003eIObservable\u003c/code\u003eは、Hotである\u003c/strong\u003eと判断することができます。\u003c/p\u003e\n\n\u003cp\u003e対して、Rxに用意されている各種オペレータやファクトリメソッドの多くは、\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eクラスを利用していません。\u003cbr\u003e\nそのため、後述する一部を除き、\u003cstrong\u003eRxのオペレータやファクトリメソッドから生成された\u003ccode\u003eIObservable\u003c/code\u003eはColdである\u003c/strong\u003eと判断することができます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"coldなiobservable\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cold%E3%81%AAiobservable\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eColdな\u003ccode\u003eIObservable\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e前述したように、Coldな\u003ccode\u003eIObservable\u003c/code\u003eとは、\u003cstrong\u003e購読者（Observer）を1つしか持てないような\u003ccode\u003eIObservable\u003c/code\u003e\u003c/strong\u003eです。\u003cbr\u003e\n値の発行者（Observable）と値の購読者（Observer）が\u003cstrong\u003e1対1の関係\u003c/strong\u003eになるような\u003ccode\u003eIObservable\u003c/code\u003eとも言えます。\u003c/p\u003e\n\n\u003cp\u003e例えば、以下のコードを見てください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//変数「observable」に1〜10までの値を発行するIObservableを代入\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//observableを購読\u003c/span\u003e\n\u003cspan class=\"n\"\u003eobservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eObservable.Range\u003c/code\u003eファクトリメソッドから生成される\u003ccode\u003eIObservable\u003c/code\u003eはColdです。\u003cbr\u003e\nColdなので、\u003cstrong\u003e購読者は1つしか持てません\u003c/strong\u003e。\u003cbr\u003e\nこの場合、購読(\u003ccode\u003eSubscribe\u003c/code\u003e)しているのは1つのみのため、何も問題なく購読することができます。\u003c/p\u003e\n\n\u003cp\u003eでは、次のように\u003cstrong\u003e複数の購読者\u003c/strong\u003eがいた場合はどうなるのでしょうか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//変数「observable」に1〜10までの値を発行するIObservableを代入\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//observableを複数の購読者が購読\u003c/span\u003e\n\u003cspan class=\"n\"\u003eobservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eobservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eColdな\u003ccode\u003eIObservable\u003c/code\u003eなのに複数回\u003ccode\u003eSubscribe\u003c/code\u003eされています。\u003cbr\u003e\nしかしながら、この場合でも、Coldだから1回しか\u003ccode\u003eSubscribe\u003c/code\u003eを受け付けないということはなく、きちんと\u003ccode\u003eSubscribe\u003c/code\u003eした分だけ購読することができます。\u003c/p\u003e\n\n\u003cp\u003eColdな\u003ccode\u003eIObservable\u003c/code\u003eは1つしか購読者が持てないのに、複数回\u003ccode\u003eSubscribe\u003c/code\u003eができるのは矛盾しているように感じます。\u003cbr\u003e\nなぜ、Coldな\u003ccode\u003eIObservable\u003c/code\u003eなのに複数の購読者を登録できるのかというと、\u003cstrong\u003eObservableソースが\u003ccode\u003eSubscribe\u003c/code\u003eされた分だけ生成されている\u003c/strong\u003eからです。\u003cbr\u003e\n結果的には、\u003cstrong\u003eObservableソースと購読者は1対1\u003c/strong\u003eとなるため、Coldな\u003ccode\u003eIObservable\u003c/code\u003eの要件は満たすというわけです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"coldなiobservableの注意点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cold%E3%81%AAiobservable%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eColdな\u003ccode\u003eIObservable\u003c/code\u003eの注意点\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eSubscribe\u003c/code\u003eした分だけObservableソースが生成されるとはいえ、Coldな\u003ccode\u003eIObservable\u003c/code\u003eでも複数購読が可能であれば、何が問題なのか？と思うかもしれませんが、次のような場合に注意が必要になってきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e       \u003cspan class=\"c1\"\u003e//変数「observable」に、\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e         \u003cspan class=\"c1\"\u003e//「1~10までの整数を発行するObservableソースを生成して\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e    \u003cspan class=\"c1\"\u003e//そのうち偶数のものだけを次に通し、\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e  \u003cspan class=\"c1\"\u003e//2倍にしたものを発行する命令」を格納\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//observableを複数の購読者が購読\u003c/span\u003e\n\u003cspan class=\"n\"\u003eobservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eobservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのコードでは、「1~10までの整数を発行するObservableソースを生成して、そのソースから発行された値を偶数で絞り込んで、絞り込んだ結果に対して2倍したものを発行する命令」を変数\u003ccode\u003eobservable\u003c/code\u003eに代入しています。\u003cbr\u003e\nそして、その\u003ccode\u003eobservable\u003c/code\u003eを複数回\u003ccode\u003eSubscribe\u003c/code\u003eしています。\u003c/p\u003e\n\n\u003cp\u003e変数\u003ccode\u003eobservable\u003c/code\u003eには、「1~10までの整数を発行するObservableソースを生成して、そのソースから発行された値を偶数で絞り込んで、絞り込んだ結果に対して2倍したものを発行する命令」が入っているのでした。\u003cbr\u003e\nこれを複数回\u003ccode\u003eSubscribe\u003c/code\u003eすれば、「1~10までの整数を発行して、それを偶数で絞り込んで、その絞り込み結果を2倍したものを発行する\u003ccode\u003eIObservable\u003c/code\u003e」が複数個複製されてしまうことになります。\u003c/p\u003e\n\n\u003cp\u003eつまり、\u003cstrong\u003eObservableソースの生成処理とLINQオペレータの処理が、Subscribeされた回数分だけ走る\u003c/strong\u003eことになってしまいます。\u003c/p\u003e\n\n\u003cp\u003eこれが意図した動作ならば良いのですが、そうでない場合（1個のObservableソースを共有したい場合）には、無駄な処理が走ってしまったり、場合によってはバグの原因となってしまうため、注意が必要です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"hotなiobservable\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#hot%E3%81%AAiobservable\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHotな\u003ccode\u003eIObservable\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eColdの対極となるのがHotです。\u003c/p\u003e\n\n\u003cp\u003eColdな\u003ccode\u003eIObservable\u003c/code\u003eが1つの購読者しか持てないのに対して、\u003cbr\u003e\nHotな\u003ccode\u003eIObservable\u003c/code\u003eは\u003cstrong\u003e複数の購読者を同時に持つことができます\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003eつまり、Hotな\u003ccode\u003eIObservable\u003c/code\u003eならば、\u003cstrong\u003e複数回\u003ccode\u003eSubscribe\u003c/code\u003eされても、Observableソースを複製することなく\u003c/strong\u003e、各購読者に対して値を発行することができます。\u003cbr\u003e\nしたがって、前述したようなColdな\u003ccode\u003eIObservable\u003c/code\u003eの問題点は、\u003cstrong\u003eHotな\u003ccode\u003eIObservable\u003c/code\u003eに変換することで解決する\u003c/strong\u003eということになります。\u003c/p\u003e\n\n\u003cp\u003e幸い、RxにはColdをHotに変換するオペレータが用意されているため、Hot変換したいタイミングで簡単にHot変換することができます。\u003cbr\u003e\n\u003cstrong\u003eその代表例が、\u003ccode\u003ePublish()\u003c/code\u003eメソッドです。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003ePublish()\u003c/code\u003eメソッドの役割を簡単に説明すると、次のようになります。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e入力となる\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eと\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eを内部に保持する。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eConnect()\u003c/code\u003eメソッドが呼ばれると、入力の\u003ccode\u003eIObservable\u003c/code\u003eを\u003ccode\u003eSubscribe\u003c/code\u003eして、得た通知をそのまま\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eに伝達する。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eの\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eを外部に公開する。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eつまり、入力となるColdな\u003ccode\u003eIObservable\u003c/code\u003eから発せられる通知を、\u003cstrong\u003e複数の購読者を管理する機能を持つ\u003ccode\u003eSubject\u0026lt;T\u0026gt;\u003c/code\u003eに仲介させる\u003c/strong\u003eことによって、複数の購読者を受付可能なHotな\u003ccode\u003eObservable\u003c/code\u003eに変換するという仕組みとなっています。\u003c/p\u003e\n\n\u003cp\u003eまた、\u003ccode\u003eConnect()\u003c/code\u003eメソッドを呼び出す必要がありますので、\u003ccode\u003ePublish()\u003c/code\u003eメソッドの戻り値は\u003cstrong\u003e\u003ccode\u003eIConnectableObservable\u003c/code\u003eインターフェイス\u003c/strong\u003eとなります。\u003c/p\u003e\n\n\u003cp\u003e使用例としては次のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"n\"\u003eIConnectableObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePublish\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e//Publish以前のIObservableを保持したIConnectableObservableにする\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//Publishの内部が持つSubjectを購読\u003c/span\u003e\n\u003cspan class=\"n\"\u003eobservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eobservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//Publish以前のIObservableをSubscribeして、Subjectに伝える\u003c/span\u003e\n\u003cspan class=\"n\"\u003eobservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e詳しい使い方については他記事で紹介されているため、そちらを参照ください。\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/acple@github/items/8d3a4d3414fa59adff70#hot%E3%81%AAobservablecold%E3%81%AAobservable\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ienumerableの遅延評価とiobservableのhotcoldの関係性\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ienumerable%E3%81%AE%E9%81%85%E5%BB%B6%E8%A9%95%E4%BE%A1%E3%81%A8iobservable%E3%81%AEhotcold%E3%81%AE%E9%96%A2%E4%BF%82%E6%80%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eIEnumerable\u003c/code\u003eの遅延評価と\u003ccode\u003eIObservable\u003c/code\u003eのHotColdの関係性\u003c/h1\u003e\n\n\u003cp\u003e前置きが非常に長くなりここからが本題ですが、「\u003ccode\u003eIEnumerable\u003c/code\u003eの遅延評価・即時評価」と「\u003ccode\u003eIObservable\u003c/code\u003eのHot・Cold」って、似ているものがある思いませんか？\u003cbr\u003e\n違いを以下の表にまとめてみました。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e\u003c/th\u003e\n\u003cth\u003e\u003ccode\u003eIEnumerable\u003c/code\u003e\u003c/th\u003e\n\u003cth\u003e\u003ccode\u003eIEnumerable\u003c/code\u003e\u003c/th\u003e\n\u003cth\u003e\u003ccode\u003eIObservable\u003c/code\u003e\u003c/th\u003e\n\u003cth\u003e\u003ccode\u003eIObservable\u003c/code\u003e\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003cstrong\u003e遅延評価\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e\u003cstrong\u003e即時評価\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e\u003cstrong\u003eCold\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e\u003cstrong\u003eHot\u003c/strong\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e使用する命令\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003eforeach\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003eforeach\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003eSubscribe\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003eSubscribe\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e変数に入っているもの\u003c/td\u003e\n\u003ctd\u003eコレクション\u003cstrong\u003e操作の命令\u003c/strong\u003eが入っている\u003c/td\u003e\n\u003ctd\u003eコレクションの操作済みの\u003cstrong\u003e値そのもの\u003c/strong\u003eが入っている\u003c/td\u003e\n\u003ctd\u003e\n\u003ccode\u003eIObservable\u003c/code\u003eからの通知結果を\u003cstrong\u003e操作する命令\u003c/strong\u003eが入っている\u003c/td\u003e\n\u003ctd\u003e\n\u003cstrong\u003eObservableソースそのもの\u003c/strong\u003eが入っている\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e特徴\u003c/td\u003e\n\u003ctd\u003e複数回\u003ccode\u003eforeach\u003c/code\u003eされると\u003cstrong\u003e命令が毎回実行\u003c/strong\u003eされる\u003c/td\u003e\n\u003ctd\u003e複数回\u003ccode\u003eforeach\u003c/code\u003eされても\u003cstrong\u003e命令の実行は1回\u003c/strong\u003eだけ\u003c/td\u003e\n\u003ctd\u003e\n\u003cstrong\u003e単一\u003c/strong\u003eの購読者しか持てない。\u003cbr\u003e複数回\u003ccode\u003eSubscribe\u003c/code\u003eされるとObservableソースから複製される\u003c/td\u003e\n\u003ctd\u003e\n\u003cstrong\u003e複数\u003c/strong\u003eの購読者を持てる\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e変換\u003c/td\u003e\n\u003ctd\u003e\n\u003cstrong\u003e即時評価に変換\u003c/strong\u003e：\u003cbr\u003e\u003ccode\u003eToList()\u003c/code\u003e, \u003ccode\u003eToArray()\u003c/code\u003eなど\u003c/td\u003e\n\u003ctd\u003e-\u003c/td\u003e\n\u003ctd\u003e\n\u003cstrong\u003eHotに変換\u003c/strong\u003e：\u003cbr\u003e\u003ccode\u003ePublish()\u003c/code\u003e, \u003ccode\u003eMulticast()\u003c/code\u003eなど\u003c/td\u003e\n\u003ctd\u003e-\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"変数に命令が入っているかそのものが入っているか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%A4%89%E6%95%B0%E3%81%AB%E5%91%BD%E4%BB%A4%E3%81%8C%E5%85%A5%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B%E3%81%9D%E3%81%AE%E3%82%82%E3%81%AE%E3%81%8C%E5%85%A5%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e変数に「命令」が入っているか「そのもの」が入っているか\u003c/h2\u003e\n\n\u003cp\u003e１つ目の共通点として、変数に入っているものの特性が挙げられます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"遅延評価とcoldは命令が入っている\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%81%85%E5%BB%B6%E8%A9%95%E4%BE%A1%E3%81%A8cold%E3%81%AF%E5%91%BD%E4%BB%A4%E3%81%8C%E5%85%A5%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「遅延評価」と「Cold」は「命令」が入っている\u003c/h3\u003e\n\n\u003cp\u003e表からもわかるように、「IEnumerableの遅延評価」と「IObservableのCold」は、どちらも変数に「\u003cstrong\u003e命令\u003c/strong\u003e」が入っているということがわかります。\u003c/p\u003e\n\n\u003cp\u003eここでいう「命令」というのは、具体的にはLINQオペレータによる操作のことです。\u003cbr\u003e\n変数に「命令」、すなわちLINQオペレータによる操作が入っているということは、複数回使用するとLINQオペレータによる操作がその分毎回実行されることを意味します。\u003c/p\u003e\n\n\u003cp\u003eすでに挙げた例ですが、以下のような例で考えます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eenumerable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのとき、遅延評価\u003ccode\u003eIEnumerable\u0026lt;int\u0026gt;\u003c/code\u003e型の変数「enumerable」には、1〜10までの整数のコレクションを作って、偶数で絞り込んで、2倍して、という「\u003cstrong\u003e命令\u003c/strong\u003e」が入ります。\u003cbr\u003e\n「命令」が入っているので、複数回使用すれば、当然「命令」も複数回実行されてしまいます。\u003c/p\u003e\n\n\u003cp\u003eCold Observableの場合も同様です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eobservable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eColdな\u003ccode\u003eIObservable\u0026lt;int\u0026gt;\u003c/code\u003e型の変数「observable」には、1〜10までの整数を発行するObservableソースを作って、偶数で絞り込んで、2倍して、という「\u003cstrong\u003e命令\u003c/strong\u003e」が入ります。\u003cbr\u003e\n「命令」が入っているので、複数回購読すれば、当然「命令」も複数回実行されます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"即時評価とhotはそのものが入っている\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8D%B3%E6%99%82%E8%A9%95%E4%BE%A1%E3%81%A8hot%E3%81%AF%E3%81%9D%E3%81%AE%E3%82%82%E3%81%AE%E3%81%8C%E5%85%A5%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「即時評価」と「Hot」は「そのもの」が入っている\u003c/h3\u003e\n\n\u003cp\u003e「そのもの」とは、その変数から最終的に得られる情報のことです。\u003cbr\u003e\n\u003ccode\u003eIEnumerable\u003c/code\u003eであれば、Enumerableソースから情報を受け取ってLINQによる演算をした結果そのものであるし、\u003cbr\u003e\n\u003ccode\u003eIObservable\u003c/code\u003eであれば、Observableソースからの通知を受けてLINQによる演算を行った結果に対する購読権のことです。\u003c/p\u003e\n\n\u003cp\u003e最終的に得られる情報そのものが入っているので、複数回\u003ccode\u003eforeach\u003c/code\u003eしようが、複数回\u003ccode\u003eSubscribe\u003c/code\u003eしようが、LINQによる操作は重複して実行されることはありません。\u003cbr\u003e\n最初の１回だけ実行され、あとは、計算済みの値を使い回すことができます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"命令からそのものへの変換は可能ただし逆は不可能\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%91%BD%E4%BB%A4%E3%81%8B%E3%82%89%E3%81%9D%E3%81%AE%E3%82%82%E3%81%AE%E3%81%B8%E3%81%AE%E5%A4%89%E6%8F%9B%E3%81%AF%E5%8F%AF%E8%83%BD%E3%81%9F%E3%81%A0%E3%81%97%E9%80%86%E3%81%AF%E4%B8%8D%E5%8F%AF%E8%83%BD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「命令」から「そのもの」への変換は可能、ただし逆は不可能\u003c/h2\u003e\n\n\u003cp\u003e２つ目の共通点として、「命令」から「そのもの」への変換は可能だが、逆は不可能という点があります。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eIEnumerable\u003c/code\u003eならば\u003ccode\u003eToArray()\u003c/code\u003eや\u003ccode\u003eToList()\u003c/code\u003e、\u003cbr\u003e\n\u003ccode\u003eIObservable\u003c/code\u003eならば\u003ccode\u003ePublish()\u003c/code\u003eや\u003ccode\u003eMulticast()\u003c/code\u003eといった、「命令」から「そのもの」への変換メソッドが用意されています。\u003cbr\u003e\nどちらも、LINQメソッドチェーンの末尾に付けるだけで、簡単に変換することが可能です。\u003c/p\u003e\n\n\u003cp\u003eただし、逆は不可能です。\u003cbr\u003e\n一度「そのもの」、つまり演算結果になってしまったものを、「命令」、つまり演算する方法に戻すことはできないからです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"つまり何が言いたいのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A4%E3%81%BE%E3%82%8A%E4%BD%95%E3%81%8C%E8%A8%80%E3%81%84%E3%81%9F%E3%81%84%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eつまり何が言いたいのか\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eコレクション版LINQもRx版LINQも、ひとつのソースを複数で共有して使うことがあったら、遅延評価とColdには気をつけましょう。\u003c/li\u003e\n\u003cli\u003e遅延評価やColdのまま複数箇所で共有して使用すると、ソースまで遡ってLINQ演算命令が複製されてしまいます。\u003c/li\u003e\n\u003cli\u003e回避するには即時評価・Hot変換を行いましょう。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h1\u003e\n\n\u003cp\u003e「\u003ccode\u003eIEnumerable\u003c/code\u003eの遅延評価・即時評価」と「\u003ccode\u003eIObservable\u003c/code\u003eのCold・Hot」は関係が薄いように見えても、本質的な部分を見ると意外と関係があるのではないか？と思えてきたので記事にして投稿してみました。\u003c/p\u003e\n\n\u003cp\u003eやはり他人に説明できるように記事にすると、理解が曖昧だった部分を強制的に勉強することになるので理解が深まって良いですね。\u003cbr\u003e\n異論やご指摘はもちろん受け付けますので、是非コメントお寄せください。\u003c/p\u003e\n\n\u003cp\u003e最後までありがというございました。\u003c/p\u003e\n","createdAt":"2021-03-21T16:30:13Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"39vGpZyuGAzTCseQ9wuRiPE87U+ccYUzjg==--uiEvSyO7nUu9sCKd--zc19WE21lgkwBttJb58Crg==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2021-03-22T01:10:42Z","likesCount":5,"linkUrl":"https://qiita.com/yutorisan/items/fc566d8afe9ce9eb4f6d","organization":null,"originalId":1409890,"stockedCount":4,"title":"「IEnumerableの遅延評価」と「IObservableのCold-Hot」の共通点についてまとめた","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%83%B3%E5%AE%9A%E8%AA%AD%E8%80%85\"\u003e想定読者\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ienumerable\"\u003eIEnumerable\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#ienumerable%E3%81%AE%E9%81%85%E5%BB%B6%E8%A9%95%E4%BE%A1\"\u003eIEnumerableの遅延評価\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%81%85%E5%BB%B6%E8%A9%95%E4%BE%A1%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e遅延評価の注意点\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8D%B3%E6%99%82%E8%A9%95%E4%BE%A1\"\u003e即時評価\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#iobservable\"\u003eIObservable\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#hot%E3%81%A8cold\"\u003eHotとCold\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#hot\"\u003eHot\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#cold\"\u003eCold\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#hot%E3%81%A8cold%E3%81%AE%E8%A6%8B%E5%88%86%E3%81%91%E6%96%B9\"\u003eHotとColdの見分け方\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#cold%E3%81%AAiobservable\"\u003eColdなIObservable\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#cold%E3%81%AAiobservable%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003eColdなIObservableの注意点\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#hot%E3%81%AAiobservable\"\u003eHotなIObservable\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ienumerable%E3%81%AE%E9%81%85%E5%BB%B6%E8%A9%95%E4%BE%A1%E3%81%A8iobservable%E3%81%AEhotcold%E3%81%AE%E9%96%A2%E4%BF%82%E6%80%A7\"\u003eIEnumerableの遅延評価とIObservableのHotColdの関係性\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%A4%89%E6%95%B0%E3%81%AB%E5%91%BD%E4%BB%A4%E3%81%8C%E5%85%A5%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B%E3%81%9D%E3%81%AE%E3%82%82%E3%81%AE%E3%81%8C%E5%85%A5%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B\"\u003e変数に「命令」が入っているか「そのもの」が入っているか\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%81%85%E5%BB%B6%E8%A9%95%E4%BE%A1%E3%81%A8cold%E3%81%AF%E5%91%BD%E4%BB%A4%E3%81%8C%E5%85%A5%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B\"\u003e「遅延評価」と「Cold」は「命令」が入っている\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8D%B3%E6%99%82%E8%A9%95%E4%BE%A1%E3%81%A8hot%E3%81%AF%E3%81%9D%E3%81%AE%E3%82%82%E3%81%AE%E3%81%8C%E5%85%A5%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B\"\u003e「即時評価」と「Hot」は「そのもの」が入っている\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%91%BD%E4%BB%A4%E3%81%8B%E3%82%89%E3%81%9D%E3%81%AE%E3%82%82%E3%81%AE%E3%81%B8%E3%81%AE%E5%A4%89%E6%8F%9B%E3%81%AF%E5%8F%AF%E8%83%BD%E3%81%9F%E3%81%A0%E3%81%97%E9%80%86%E3%81%AF%E4%B8%8D%E5%8F%AF%E8%83%BD\"\u003e「命令」から「そのもの」への変換は可能、ただし逆は不可能\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%A4%E3%81%BE%E3%82%8A%E4%BD%95%E3%81%8C%E8%A8%80%E3%81%84%E3%81%9F%E3%81%84%E3%81%AE%E3%81%8B\"\u003eつまり何が言いたいのか\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e最後に\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":1052,"uuid":"fc566d8afe9ce9eb4f6d","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"IjgGQO8k8OaXPeeKk5YMESxvMr8h--K3lLXi3giTHfTcN9--CBUnswjsS+T0vz8SzrFxYQ==","originalId":697830,"description":"C#が好きです","facebookUrl":null,"githubUrl":"https://github.com/yutorisan","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://pbs.twimg.com/profile_images/1274400166120812544/DAWcpHec_bigger.jpg","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F1274400166120812544%2FDAWcpHec_bigger.jpg?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=b517115d0e848c54aa4fe1fc93bfa0ff","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F1274400166120812544%2FDAWcpHec_bigger.jpg?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=754be610f489085be0fdfc48de5585a9","urlName":"yutorisan","websiteUrl":"","twitterUrl":"https://twitter.com/yutorisan19","twitterUrlName":"yutorisan19","revealedOrganizations":{"edges":[{"node":{"encryptedId":"H0wcfnNEh1G85U5aT0YpDKWnnGJ4cgP3gJA=--eYeSlfWPhPm0qq/Z--y9Vzx9zIF5rEWI4AdYnVIw==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"Unityゲーム開発者ギルド","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","urlName":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。","url":"https://unity-game-dev-guild.github.io/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"LINQ","urlName":"linq"},{"name":"ReactiveExtensions","urlName":"reactiveextensions"},{"name":"遅延評価","urlName":"%e9%81%85%e5%bb%b6%e8%a9%95%e4%be%a1"},{"name":"UniRx","urlName":"unirx"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

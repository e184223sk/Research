<!DOCTYPE html><html><head><meta charset="utf-8" /><title>CefSharpでカスタムWebブラウザを作る - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/masahiro-furuichi/items/ff3a1abf25a64cef7cdd" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="j5AV/fXl3InugGHMgofXoAQJbZ+gudnDBcqJr2ozhze3P9+KW98hJi4yp0uA1vKCOR10MNPVChd4zEy4a57zjQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="CefSharpでカスタムWebブラウザを作る - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1RMlZtVTJoaGNuRGpnYWZqZ3F2amdybmpncl9qZzZCWFpXTGpnNWJqZzZuamdxYmpncmJqZ3BMa3Zaempnb3MmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MDVjMTczMTA1ZDMzMDYyODEwZmE1MjQxM2JkZmRkN2I&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzFoYzJGb2FYSnZMV1oxY25WcFkyaHAmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1iOGIxY2EwM2Q4YWM5N2YxZTI0YzY4MGQ5MTg2MDg1NA&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=4d17ed33e76f371a006a7a86bde4c184"><meta property="og:description" content="

1. 目的

CefSharpでカスタムWebブラウザを作成します。
CefSharpはChromiumをコアとするOpenSourceのWebViewです。
CefはChromiumをコアとしているので、ほぼChromeと同等の..."><meta content="https://qiita.com/masahiro-furuichi/items/ff3a1abf25a64cef7cdd" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Chromium,browser,WinForms,CefSharp" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-12fc74c6-3a5a-4b77-88db-9ec3cd322192"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fmasahiro-furuichi%2Fitems%2Fff3a1abf25a64cef7cdd">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fmasahiro-furuichi%2Fitems%2Fff3a1abf25a64cef7cdd">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-12fc74c6-3a5a-4b77-88db-9ec3cd322192">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-11-17T09:11:21.000+09:00","dateModified":"2020-11-20T17:13:13.000+09:00","headline":"CefSharpでカスタムWebブラウザを作る","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1RMlZtVTJoaGNuRGpnYWZqZ3F2amdybmpncl9qZzZCWFpXTGpnNWJqZzZuamdxYmpncmJqZ3BMa3Zaempnb3MmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MDVjMTczMTA1ZDMzMDYyODEwZmE1MjQxM2JkZmRkN2I\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzFoYzJGb2FYSnZMV1oxY25WcFkyaHAmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1iOGIxY2EwM2Q4YWM5N2YxZTI0YzY4MGQ5MTg2MDg1NA\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=4d17ed33e76f371a006a7a86bde4c184","mainEntityOfPage":"https://qiita.com/masahiro-furuichi/items/ff3a1abf25a64cef7cdd","author":{"@type":"Person","address":"","email":null,"identifier":"masahiro-furuichi","name":"masahiro-furuichi","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Flh6.googleusercontent.com%2F-alAsth0eG_I%2FAAAAAAAAAAI%2FAAAAAAAAAAA%2FACevoQMQWL9cEo5JVt6DPhm58dO1w5e8nQ%2Fmo%2Fphoto.jpg%3Fsz%3D50?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1d242b516f13a97a499b47bcbe60a611","url":"https://qiita.com/masahiro-furuichi","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"masahiro-furuichi","type":"items","id":"ff3a1abf25a64cef7cdd"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"masahiro-furuichi","type":"items","id":"ff3a1abf25a64cef7cdd"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"masahiro-furuichi","type":"items","id":"ff3a1abf25a64cef7cdd"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/masahiro-furuichi/items/ff3a1abf25a64cef7cdd","location":"/masahiro-furuichi/items/ff3a1abf25a64cef7cdd","scheme":"https","host":"qiita.com","port":null,"pathname":"/masahiro-furuichi/items/ff3a1abf25a64cef7cdd","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"Voc4kQ6yQLyK/VTzgK3u8Y4Y20PXfEy4WYfxaU2PIohuKPLmoIi9E0pPknSC/MvTswzC7KQQn2wkgTR+TCJWMg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-e2992ea6-a919-40c3-bbd3-e71a3ef55176"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/masahiro-furuichi/items/ff3a1abf25a64cef7cdd/likers" class="css-1iupg5d">9</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">11</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ff3a1abf25a64cef7cdd/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/masahiro-furuichi/items/ff3a1abf25a64cef7cdd/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/masahiro-furuichi/items/ff3a1abf25a64cef7cdd/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/masahiro-furuichi/items/ff3a1abf25a64cef7cdd/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/masahiro-furuichi/items/ff3a1abf25a64cef7cdd.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/masahiro-furuichi"><img class="css-100alwu eyfquo10" src="https://lh6.googleusercontent.com/-alAsth0eG_I/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMQWL9cEo5JVt6DPhm58dO1w5e8nQ/mo/photo.jpg?sz=50" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/masahiro-furuichi" class="css-10ougpm">@<!-- -->masahiro-furuichi</a><div class="css-1ay9vb9"><span><meta content="2020-11-17T00:11:21Z"/><time dateTime="2020-11-20T08:13:13Z" class="css-m19uds">updated at 2020-11-20</time></span></div></div></div></div></div><h1 class="css-cgzq40">CefSharpでカスタムWebブラウザを作る</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/chromium" class="css-4czcte">Chromium</a><a href="/tags/browser" class="css-4czcte">browser</a><a href="/tags/winforms" class="css-4czcte">WinForms</a><a href="/tags/cefsharp" class="css-4czcte">CefSharp</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="1-目的" class="fragment"></span><a href="#1-%E7%9B%AE%E7%9A%84"><i class="fa fa-link"></i></a>1. 目的</h1>

<p>CefSharpでカスタムWebブラウザを作成します。<br>
CefSharpはChromiumをコアとするOpenSourceのWebViewです。<br>
CefはChromiumをコアとしているので、ほぼChromeと同等のWebブラウザを作成することができます。</p>

<p><a href="https://github.com/cefsharp/CefSharp" rel="nofollow noopener" target="_blank">https://github.com/cefsharp/CefSharp</a></p>

<p>.NET FrameworkのWPFとWinformsで利用可能なコントロールとして提供されていますが、今回はWinforms版でカスタムWebブラウザを作ります。言語はC#を使います。</p>

<h1>
<span id="2-最初の最初" class="fragment"></span><a href="#2-%E6%9C%80%E5%88%9D%E3%81%AE%E6%9C%80%E5%88%9D"><i class="fa fa-link"></i></a>2. 最初の最初</h1>

<p>以下の流れでWinformプロジェクトを作成して、一番シンプルなカスタムWebブラウザを作成します。</p>

<ol>
<li>新規プロジェクト作成する</li>
<li>Nugetパッケージの取り込む</li>
<li>WebViewを貼り付ける</li>
</ol>

<p>まだVisual Studioをインストールしていない場合は、以下のサイトから<code>Visual Studio Express</code>(無料)のインストーラをダウンロードして、インストールしましょう。<br>
<a href="https://visualstudio.microsoft.com/ja/vs/express/" rel="nofollow noopener" target="_blank">Visual Studio Express</a></p>

<h2>
<span id="21-新規プロジェクトの作成する" class="fragment"></span><a href="#21-%E6%96%B0%E8%A6%8F%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>2.1 新規プロジェクトの作成する</h2>

<p>C#のWinformsのプロジェクトを新規作成します。<br>
以下は、Visual Studio 2019 Expressでのやり方になります。</p>

<ol>
<li>「新しいプロジェクトの作成」をクリックします。</li>
<li>「Windowsフォームアプリケーションの作成(.NET Framework)」を選択して「次へ」をクリックします。</li>
<li>プロジェクト名と場所を指定して、「作成」をクリックします。<br>
ここでは、「SimpleBrowser」としました。</li>
<li><p>作成されるプロジェクトのフォームの名称がデフォルトで「Form1.cs」とカッコ悪いので、「ソリューション エクスプローラ」で「Form1.cs」を選択して、コンテキストメニューから「名前の変更」を選択して、適当な名前に変更します。<br>
ここでは、「SimpleBrowserFrame.cs」としました。<br>
<a href="https://camo.qiitausercontent.com/f4da792a3449a67e6de52798e7acf36b413678d6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f36623233353532662d356230362d393436372d643038392d6561613531383763306435652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F6b23552f-5b06-9467-d089-eaa5187c0d5e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8d0df71ffe6f10a386f9c60506c7ac8d" alt="ソリューションエクスプローラ.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/6b23552f-5b06-9467-d089-eaa5187c0d5e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F6b23552f-5b06-9467-d089-eaa5187c0d5e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=eee9604dd6984a68b56ce7ba9d49af7d 1x" loading="lazy"></a></p></li>
<li><p>CefSharpは「AnyCPU」でビルドできないので、構成マネージャで「AnyCPU」を削除して「x64」と「x86」を追加します。<br>
※「x64」と「x86」のいずれか1つでももちろんOKです。<br>
ソリューションエクスプローラでソリューションを選択して、コンテキストメニューから「バッチビルド」を選択すると、以下のような構成に見えるはずです。<br>
<a href="https://camo.qiitausercontent.com/47ebb2c2801ba205fb0ea7414166025438690250/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f35303865336338662d666331312d316464362d386531392d6334306566316333653862652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F508e3c8f-fc11-1dd6-8e19-c40ef1c3e8be.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=23ba04250d4ea2084d5bb23a91865ba6" alt="構成.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/508e3c8f-fc11-1dd6-8e19-c40ef1c3e8be.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F508e3c8f-fc11-1dd6-8e19-c40ef1c3e8be.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a53784249ff919eb276e614653bb87cf 1x" loading="lazy"></a></p></li>
</ol>

<h2>
<span id="22-nugetパッケージの取り込む" class="fragment"></span><a href="#22-nuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E5%8F%96%E3%82%8A%E8%BE%BC%E3%82%80"><i class="fa fa-link"></i></a>2.2 Nugetパッケージの取り込む</h2>

<p>CefSharpのNugetパッケージを取り込みます。</p>

<ol>
<li>ソリューションエクスプローラで「SimpleBrowser」を選択して、コンテキストメニューから「NuGetパッケージの管理」を選択します。</li>
<li>NuGetパッケージマネージャで、「参照」タブを選択します。</li>
<li><p>検索ボックスに「CefSharp」と入力して検索を実行すると、CefSharp関連のNugetパッケージが表示されます。<br>
<a href="https://camo.qiitausercontent.com/b431531156b300109d57d2df293e095e7607873a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f38653732316633362d393163302d313064642d656130312d3164393032666530336331642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F8e721f36-91c0-10dd-ea01-1d902fe03c1d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=57aec898cc592802e0a0b56008f7a131" alt="Nuget.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/8e721f36-91c0-10dd-ea01-1d902fe03c1d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F8e721f36-91c0-10dd-ea01-1d902fe03c1d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=00f01cac2b1947fd5dd34bcf035edd9a 1x" loading="lazy"></a></p></li>
<li>
<p>以下のNugetパッケージをインストールします。 <br>
※CefSharp.WinFormsをインストールすると、芋ずる式にすべてインストールされます。</p>

<ul>
<li>CefSharp.WinForms</li>
<li>CefSharp.Common</li>
<li>cef.redist.x64</li>
<li>cef.redist.x86</li>
</ul>
</li>
</ol>

<p>表示されているバージョン「v85.3.130」は、chromiumのバージョンとほぼ一致しています。<br>
もし特定のバージョンのchromiumを使いたい場合は、バージョンを指定してNugetを取り込みます。</p>

<h2>
<span id="23-webviewを貼り付ける" class="fragment"></span><a href="#23-webview%E3%82%92%E8%B2%BC%E3%82%8A%E4%BB%98%E3%81%91%E3%82%8B"><i class="fa fa-link"></i></a>2.3 WebViewを貼り付ける</h2>

<p>CefSharpのWebViewであるChromiumWebBrowserコントロールをフォームに貼り付けます。<br>
ChromiumWebBrowserはツールボックスにも表示されますが、ツールボックスからはコントロールを貼り付けできないので、フォームのコード(SimpleBrowserFrame.cs)に直接以下を記述します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">SimpleBrowserFrame.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.ComponentModel</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Data</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Drawing</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows.Forms</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp.WinForms</span><span class="p">;</span> <span class="c1">// &lt;- 追加</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">SimpleBrowserFrame</span> <span class="p">:</span> <span class="n">Form</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// CefSharpのWebViewのインスタンス</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="n">ChromiumWebBrowser</span> <span class="n">WebBrowser</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">SimpleBrowserFrame</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>

            <span class="c1">// CefSharpのWebViewを作成する。</span>
            <span class="c1">// 初期ページはgoogleにする。</span>
            <span class="n">WebBrowser</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ChromiumWebBrowser</span><span class="p">(</span><span class="s">"https://www.google.co.jp"</span><span class="p">);</span>

            <span class="c1">// コントロールを追加する。</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">WebBrowser</span><span class="p">);</span>
            <span class="n">WebBrowser</span><span class="p">.</span><span class="n">Dock</span> <span class="p">=</span> <span class="n">DockStyle</span><span class="p">.</span><span class="n">Fill</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="24-ビルドして実行する" class="fragment"></span><a href="#24-%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>2.4 ビルドして実行する</h2>

<p>何も考えずに実行すると、以下の様な非常にシンプルなWebブラウザが表示されます。<br>
  <a href="https://camo.qiitausercontent.com/edfaf243860cdbf3bb0a2a9810af07f4886f0b10/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f39663762336238662d353639612d633966622d323063312d3734366432303337303564342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F9f7b3b8f-569a-c9fb-20c1-746d203705d4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b85961391e9a142c4412c28ac3ec2686" alt="browser01.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/9f7b3b8f-569a-c9fb-20c1-746d203705d4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F9f7b3b8f-569a-c9fb-20c1-746d203705d4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d1d7ca688cb4d30117995734bfe86410 1x" loading="lazy"></a></p>

<h2>
<span id="25-バージョンを確認する" class="fragment"></span><a href="#25-%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>2.5 バージョンを確認する</h2>

<p>初期URLを以下のように<code>chrome://version</code>に変更して実行してみると、バージョンのページが表示されます。<br><br>
このようにchromeのカスタムスキーマの一部も表示させることができます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">chromeのバージョン確認</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">//WebBrowser = new ChromiumWebBrowser("https://www.google.co.jp");</span>
<span class="n">WebBrowser</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ChromiumWebBrowser</span><span class="p">(</span><span class="s">"chrome://version"</span><span class="p">);</span>    <span class="c1">// 変更する。</span>
</code></pre></div>
</div>

<p><a href="https://camo.qiitausercontent.com/15286d63355535be21d0f7247a8938c89924dd93/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f33386637616462632d313839362d623261372d616661332d3937333233393661386535622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F38f7adbc-1896-b2a7-afa3-9732396a8e5b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=07d738001e4ee0c2f820dedd2b84c373" alt="browser02.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/38f7adbc-1896-b2a7-afa3-9732396a8e5b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F38f7adbc-1896-b2a7-afa3-9732396a8e5b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=31305d84a3c40dde63d151b059155668 1x" loading="lazy"></a></p>

<h1>
<span id="3-最低限の設定" class="fragment"></span><a href="#3-%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>3. 最低限の設定</h1>

<p>ChromiumWebBrowserをnewして貼り付けるだけでも、Webコンテンツを表示することができますが、幾つかの最低限の設定をしておきます。<br>
具体的には、以下の2つの方法で設定します。</p>

<ul>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_Cef_Initialize_3.htm" rel="nofollow noopener" target="_blank">Cef.Initialize</a>メソッド<br>
ChromiumWebBrowserをnewする前に、一度だけ実行します。<br>
ChromiumWebBrowserを作成した後は、呼び出して設定を変更することはできません。<br>
</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_WinForms_ChromiumWebBrowser_BrowserSettings.htm" rel="nofollow noopener" target="_blank">ChromiumWebBrowser.BrowserSettings</a>プロパティ<br>
ChromiumWebBrowserのインスタンスを作成した後に、インスタンス毎に設定します。</li>
</ul>

<h2>
<span id="31-cefinitializeメソッドによる初期化" class="fragment"></span><a href="#31-cefinitialize%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AB%E3%82%88%E3%82%8B%E5%88%9D%E6%9C%9F%E5%8C%96"><i class="fa fa-link"></i></a>3.1 Cef.Initializeメソッドによる初期化</h2>

<p>Cef.Initializeメソッドでは、以下の設定を行います。</p>

<h3>
<span id="キャッシュ用ディレクトリのパス" class="fragment"></span><a href="#%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E7%94%A8%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AE%E3%83%91%E3%82%B9"><i class="fa fa-link"></i></a>キャッシュ用ディレクトリのパス</h3>

<p>キャッシュ用ディレクトリは、ブラウザコンテンツのキャッシュのほかに以下の情報が格納されます。</p>

<ul>
<li>history</li>
<li>cookie</li>
<li>indexedDB</li>
<li>localStorage</li>
<li>sessionStorage</li>
<li>application cache<br>
</li>
</ul>

<p>キャッシュ用ディレクトリを設定するには、<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_CefSettingsBase_CachePath.htm" rel="nofollow noopener" target="_blank">CefSettingsBase.CachePath</a>プロパティに絶対パスでキャッシュ用ディレクトリのパスを指定します。<br>
<code>null</code>を指定した場合は、キャッシュが作成されないインメモリモード(incognito mode)になります。インメモリモードの場合、indexedDB、localStorageおよびapplication cacheは、もちろん保存されなくなります。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">キャッシュ用ディレクトリの設定方法</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">CefSettings</span> <span class="n">settings</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CefSettings</span><span class="p">();</span>

<span class="c1">// キャッシュディレクトリの設定</span>
<span class="n">setting</span><span class="p">.</span><span class="n">settings</span> <span class="p">=</span> <span class="s">@"c:\temp\cache"</span><span class="p">;</span>
</code></pre></div>
</div>

<h3>
<span id="useragent文字列設定" class="fragment"></span><a href="#useragent%E6%96%87%E5%AD%97%E5%88%97%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>UserAgent文字列設定</h3>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_CefSettingsBase_UserAgent.htm" rel="nofollow noopener" target="_blank">CefSettingsBase.UserAgent</a>で、UserAgent文字列を自由に設定することができます。<br>
しかし、デフォルトのUserAgent文字列を取得することはできません。<br>
デフォルトのUserAgent文字列を確認するには、開発者ツールでHTTPリクエストヘッダを確認する必要があります。<br>
ちなみに、デフォルトのUserAgent文字列はx86とx64で異なっています。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">UserAgentの設定方法</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">CefSettings</span> <span class="n">settings</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CefSettings</span><span class="p">();</span>

<span class="c1">// 独自のUserAgent文字列を指定する</span>
<span class="n">settings</span><span class="p">.</span><span class="n">UserAgent</span> <span class="p">=</span> <span class="s">@"Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36 SimpleBroser/1.0.0.0"</span><span class="p">;</span>
</code></pre></div>
</div>

<h3>
<span id="言語の設定" class="fragment"></span><a href="#%E8%A8%80%E8%AA%9E%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>言語の設定</h3>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_CefSettingsBase_AcceptLanguageList.htm" rel="nofollow noopener" target="_blank">CefSettingsBase.AcceptLanguageList</a>に、受け入れる<a href="https://ja.wikipedia.org/wiki/IETF%E8%A8%80%E8%AA%9E%E3%82%BF%E3%82%B0" rel="nofollow noopener" target="_blank">言語</a>をカンマ区切りのリストで指定します<br>
ここで指定した言語リストは、HTTPリクエストヘッダの<code>Accept-Language</code>に指定されます。<br>
chromeのリクエストヘッダを見ると、<code>ja,en-US;q=0.9,en;q=0.8</code>と設定されており、日本語とアメリカ英語と英語が重み付けを含めて指定されていることが確認できます。<br>
ここではchromeと同じ設定にしてみます。  </p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">言語の設定方法</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">CefSettings</span> <span class="n">settings</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CefSettings</span><span class="p">();</span>

<span class="c1">// 受け入れる言語リストを指定する</span>
<span class="n">settings</span><span class="p">.</span><span class="n">AcceptLanguageList</span> <span class="p">=</span> <span class="s">"ja,en-US;q=0.9,en;q=0.8"</span><span class="p">;</span>
</code></pre></div>
</div>

<h3>
<span id="ログレベルの設定" class="fragment"></span><a href="#%E3%83%AD%E3%82%B0%E3%83%AC%E3%83%99%E3%83%AB%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>ログレベルの設定</h3>

<p>デフォルトでChromiumのデバッグログ(<code>debug.log</code>)が出力されます。<br>
<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_CefSettingsBase_LogSeverity.htm" rel="nofollow noopener" target="_blank">CefSettingsBase.LogSeverity</a>でログのレベルを変更することで、ログ出力の内容を増やしたり、ログを出力しないようにすることができます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ログの設定方法</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">CefSettings</span> <span class="n">settings</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CefSettings</span><span class="p">();</span>

<span class="c1">// ログレベルを指定する。</span>
<span class="n">settings</span><span class="p">.</span><span class="n">LogSeverity</span> <span class="p">=</span> <span class="n">LogSeverity</span><span class="p">.</span><span class="n">Verbose</span><span class="p">;</span>
</code></pre></div>
</div>

<h3>
<span id="コマンドライン引数設定" class="fragment"></span><a href="#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E5%BC%95%E6%95%B0%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>コマンドライン引数設定</h3>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_CefSettingsBase_CefCommandLineArgs.htm" rel="nofollow noopener" target="_blank">CefSettingsBase.CefCommandLineArgs</a>に、Chromeのコマンドライン引数を追加することができます。ただし、Chromiumのコマンドラインオプションはあまりドキュメント化されておらず、また実際に機能するかは、試してみないと分からないです。<br>
ここでは、<a href="https://developer.mozilla.org/ja/docs/Web/API/MediaDevices/getUserMedia" rel="nofollow noopener" target="_blank">MediaDevices.getUserMedia()</a>メソッドで、カメラにアクセスできるようにするために、<code>enable-media-stream</code>オプションを設定します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">コマンドライン引数の設定方法</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">CefSettings</span> <span class="n">settings</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CefSettings</span><span class="p">();</span>

<span class="c1">// カメラにアクセスできるようにする</span>
<span class="n">settings</span><span class="p">.</span><span class="n">CefCommandLineArgs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"enable-media-stream"</span><span class="p">,</span> <span class="s">"1"</span><span class="p">);</span>
</code></pre></div>
</div>

<p>以上の設定をまとめると、以下のようになります。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Cef.Initializeによる初期化の例</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">CefSettings</span> <span class="n">settings</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CefSettings</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">AcceptLanguageList</span> <span class="p">=</span> <span class="s">"ja,en-US;q=0.9,en;q=0.8"</span><span class="p">,</span>
    <span class="n">CachePath</span> <span class="p">=</span> <span class="s">@"c:\temp\cache"</span><span class="p">,</span>
    <span class="n">UserAgent</span> <span class="p">=</span> <span class="s">@"Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36 SimpleBroser/1.0.0.0"</span><span class="p">,</span>
    <span class="n">LogSeverity</span> <span class="p">=</span> <span class="n">LogSeverity</span><span class="p">.</span><span class="n">Verbose</span>
<span class="p">}</span>

<span class="c1">// カメラにアクセスできるようにする</span>
<span class="n">settings</span><span class="p">.</span><span class="n">CefCommandLineArgs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"enable-media-stream"</span><span class="p">,</span> <span class="s">"1"</span><span class="p">);</span>

<span class="c1">// Application.Runの前に初期化を呼び出す。</span>
<span class="n">Cef</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">(</span><span class="n">settings</span><span class="p">);</span>

<span class="n">Application</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="k">new</span> <span class="nf">SimpleBrowserFrame</span><span class="p">());</span>
</code></pre></div>
</div>

<h3>
<span id="cookie用ディレクトリの設定おまけ" class="fragment"></span><a href="#cookie%E7%94%A8%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%8A%E3%81%BE%E3%81%91"><i class="fa fa-link"></i></a>Cookie用ディレクトリの設定(おまけ)</h3>

<p>バージョン73.1.xまでは、Cookie用のディレクトリはキャッシュ用フォルダと別に指定することができましたが、75.1.x以降はキャッシュ用ディレクトリ配下にCookieが作成されるようになり、cookie用ディレクトリは個別に設定することはできなくなりました。バージョン73.1.x以前を使用する場合は、<a href="https://cefsharp.github.io/api/73.1.x/html/M_CefSharp_ICookieManager_SetStoragePath.htm" rel="nofollow noopener" target="_blank">ICookieManager.SetStoragePath</a>を呼び出して、cookieのパスを指定します。呼び出しのタイミングは<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IBrowserProcessHandler_OnContextInitialized.htm" rel="nofollow noopener" target="_blank">IBrowserProcessHandler.OnContextInitialized</a>になります。<br>
参考のために、設定例を以下に示します。※このメソッドは、75.1.x以降は使用できません。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Cookie用ディレクトリの設定方法</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">BrowserProcessHandler</span> <span class="p">:</span> <span class="n">IBrowserProcessHandler</span>
    <span class="p">{</span>
        <span class="k">void</span> <span class="n">IDisposable</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">()</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">void</span> <span class="n">IBrowserProcessHandler</span><span class="p">.</span><span class="nf">OnContextInitialized</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// グローバールCookieマネージャを取得して、Cookieのパスを設定する。</span>
            <span class="n">ICookieManager</span> <span class="n">cookieManager</span> <span class="p">=</span> <span class="n">Cef</span><span class="p">.</span><span class="nf">GetGlobalCookieManager</span><span class="p">();</span>
            <span class="n">cookieManager</span><span class="p">.</span><span class="nf">SetStoragePath</span><span class="p">(</span><span class="s">@"c:\temp\cookie"</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">void</span> <span class="n">IBrowserProcessHandler</span><span class="p">.</span><span class="nf">OnScheduleMessagePumpWork</span><span class="p">(</span><span class="kt">long</span> <span class="n">delay</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="32-chromiumwebbrowserbrowsersettingsによる初期化" class="fragment"></span><a href="#32-chromiumwebbrowserbrowsersettings%E3%81%AB%E3%82%88%E3%82%8B%E5%88%9D%E6%9C%9F%E5%8C%96"><i class="fa fa-link"></i></a>3.2 ChromiumWebBrowser.BrowserSettingsによる初期化</h2>

<p>ChromiumWebBrowserインスタンスをnewした後、<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_WinForms_ChromiumWebBrowser_BrowserSettings.htm" rel="nofollow noopener" target="_blank">ChromiumWebBrowser.BrowserSettings</a>プロパティで主に以下の項目を設定することができます。</p>

<ul>
<li>Application cacheの使用許可</li>
<li>フォントファミリー</li>
<li>フォントサイズ</li>
<li>Javascriptの使用許可</li>
<li>Javascriptでdocument.execCommandを使ったcopy&amp;pasteの使用許可</li>
<li>LocalStorageの使用許可</li>
</ul>

<p>これらを設定する例を以下に示します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">BrowserSettingsの設定による初期化方法</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="nf">SimpleBrowserFrame</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">InitializeComponent</span><span class="p">();</span>

    <span class="c1">// CefSharpのWebViewを作成する。</span>
    <span class="n">WebBrowser</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ChromiumWebBrowser</span><span class="p">(</span><span class="s">"https://www.google.co.jp"</span><span class="p">);</span>

    <span class="c1">// コントロールを追加する。</span>
    <span class="k">this</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">WebBrowser</span><span class="p">);</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">Dock</span> <span class="p">=</span> <span class="n">DockStyle</span><span class="p">.</span><span class="n">Fill</span><span class="p">;</span>

    <span class="c1">// javascriptを有効にする。（書かなくても有効です）</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">BrowserSettings</span><span class="p">.</span><span class="n">Javascript</span> <span class="p">=</span> <span class="n">CefState</span><span class="p">.</span><span class="n">Enabled</span><span class="p">;</span>
    <span class="c1">// document.execCommandでのcopy&amp;pasteを有効にする。</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">BrowserSettings</span><span class="p">.</span><span class="n">JavascriptDomPaste</span> <span class="p">=</span> <span class="n">CefState</span><span class="p">.</span><span class="n">Enabled</span><span class="p">;</span>
    <span class="c1">// ApplicationCacheを有効にする。</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">BrowserSettings</span><span class="p">.</span><span class="n">ApplicationCache</span> <span class="p">=</span> <span class="n">CefState</span><span class="p">.</span><span class="n">Enabled</span><span class="p">;</span>
    <span class="c1">// localStorageを有効にする。</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">BrowserSettings</span><span class="p">.</span><span class="n">LocalStorage</span> <span class="p">=</span> <span class="n">CefState</span><span class="p">.</span><span class="n">Enabled</span><span class="p">;</span>
    <span class="c1">// フォントサイズを設定する。(レイアウトがずれる場合があるので注意)</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">BrowserSettings</span><span class="p">.</span><span class="n">DefaultFontSize</span> <span class="p">=</span> <span class="m">16</span><span class="p">;</span> 
<span class="p">}</span>

</code></pre></div>
</div>

<p>なお、ドキュメントに書かれていても、実際には機能しない設定もあるので注意が必要です。<br>
具体的には、以下は機能しませんでした。  </p>

<ul>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_IBrowserSettings_Databases.htm" rel="nofollow noopener" target="_blank">IBrowserSettings.Databases</a><br>
indexedDBの使用許可・禁止ができると書かれていますが、indexedDBを使用禁止にすることはできませんでした。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_IBrowserSettings_JavascriptAccessClipboard.htm" rel="nofollow noopener" target="_blank">IBrowserSettings.JavascriptAccessClipboard</a><br>
javascriptからclipboardを操作できるように書かれていますが、有効になるように設定しても、<code>navigator.clipboard.writetext</code>等のclipboard APIはアクセス拒否されます。</li>
</ul>

<h1>
<span id="4-proxyの設定" class="fragment"></span><a href="#4-proxy%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>4. Proxyの設定</h1>

<p>デフォルトでは、システムのインターネットオプションで指定しているProxy設定が使用されますが、システムのインターネットオプションと別に、独自のProxy設定を行うことができます。Proxy設定の方法は、以下のいずれかの方法で行います。  </p>

<ul>
<li>(方法1)CefSharpSettings.Proxyで設定</li>
<li>(方法2)コマンドラインオプションで指定</li>
<li>(方法3)WebViewのリクエストコンテキストで指定</li>
<li>(方法4)プログラム全体のリクエストコンテキストで指定</li>
</ul>

<h2>
<span id="41-方法1cefsharpsettingsproxyで設定" class="fragment"></span><a href="#41-%E6%96%B9%E6%B3%951cefsharpsettingsproxy%E3%81%A7%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>4.1 (方法1)CefSharpSettings.Proxyで設定</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_CefSharpSettings_Proxy.htm" rel="nofollow noopener" target="_blank">CefSharpSettings.Proxy</a>スタティックメソッドを使用します。<br>
IP、Port、UserName、Password、BypassListを設定することで、自動的にProxyサーバの認証処理も行うようになります。<br>
この方法の場合は、ユーザに認証情報の入力を求めることができません。<br>
また、一度設定すると、プロセスが終了するまで変更することができません。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Proxyの設定方法1</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// Cef.Initializeの前に呼び出す。</span>
<span class="n">CefSharpSettings</span><span class="p">.</span><span class="n">Proxy</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ProxyOptions</span><span class="p">(</span><span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="s">"8080"</span><span class="p">,</span> <span class="s">"UserName"</span><span class="p">,</span> <span class="s">"Password"</span><span class="p">,</span> <span class="s">"192.168.0.*;*.test.com"</span><span class="p">);</span>
<span class="n">Cef</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">(</span><span class="n">settings</span><span class="p">);</span>
</code></pre></div>
</div>

<h2>
<span id="42-方法2コマンドラインオプションで指定" class="fragment"></span><a href="#42-%E6%96%B9%E6%B3%952%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E6%8C%87%E5%AE%9A"><i class="fa fa-link"></i></a>4.2 (方法2)コマンドラインオプションで指定</h2>

<p>以下のコマンドラインオプションを指定します。<br>
これが一番簡単です。</p>

<ul>
<li>
<code>proxy-server</code>オプションでIPとPORTを指定する。</li>
<li>
<code>proxy-bypass-list</code>オプションでBypassListを指定する。</li>
</ul>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Proxyの設定方法2</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">CefSettings</span> <span class="n">settings</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CefSettings</span><span class="p">();</span>

<span class="c1">// プロキシ情報を設定する。</span>
<span class="n">settings</span><span class="p">.</span><span class="n">CefCommandLineArgs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"proxy-server"</span><span class="p">,</span> <span class="s">"127.0.0.1:8080"</span><span class="p">);</span>
<span class="n">settings</span><span class="p">.</span><span class="n">CefCommandLineArgs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"proxy-bypass-list"</span><span class="p">,</span> <span class="s">"192.168.0.*;*.test.com"</span><span class="p">);</span>

<span class="n">Cef</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">(</span><span class="n">settings</span><span class="p">);</span>
</code></pre></div>
</div>

<p>この方法の場合、ユーザに認証情報の入力を求める処理を実装することができます。<br>
認証情報が必要になると自動的に認証処理が呼び出されます(詳細は「<a href="#9-%E8%AA%8D%E8%A8%BC">9. 認証</a>」を参照)。<br>
この方法も一度設定すると、プロセスが終了するまで変更することができません。</p>

<h2>
<span id="43-方法3webviewのリクエストコンテキストで指定" class="fragment"></span><a href="#43-%E6%96%B9%E6%B3%953webview%E3%81%AE%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%A7%E6%8C%87%E5%AE%9A"><i class="fa fa-link"></i></a>4.3 (方法3)WebViewのリクエストコンテキストで指定</h2>

<p>WebViewのリクエストコンテキスト(<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_IBrowserHost_RequestContext.htm" rel="nofollow noopener" target="_blank">IBrowserHost.RequestContext</a>)に対して、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestContext_SetPreference.htm" rel="nofollow noopener" target="_blank">IRequestContext.SetPreference</a>メソッドを呼び出して、プロキシの情報を設定します。最も細かくProxyを設定できる方法で、複数のWebViewがある場合でも、それぞれのWebViewで別々のProxyを設定することができます。<br><br>
この方法の場合も、ユーザに認証情報の入力を求める処理を実装することができます。<br>
認証情報が必要になると自動的に認証処理が呼び出されます(詳細は「<a href="#9-%E8%AA%8D%E8%A8%BC">9. 認証</a>」を参照)。<br>
また、途中でプロキシ設定を変更することもできます。</p>

<p>第一引数に<code>"proxy"</code>という文字列、第二引数に以下のKey&amp;Valueを持つDictionaryインスタンスを指定して、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestContext_SetPreference.htm" rel="nofollow noopener" target="_blank">IRequestContext.SetPreference</a>メソッドを呼び出します。※この部分はドキュメントが少ないです。</p>

<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>mode</td>
<td>"fixed_servers"を指定します</td>
</tr>
<tr>
<td>server</td>
<td>プロキシサーバとポート番号を指定します</td>
</tr>
<tr>
<td>bypass_list</td>
<td>プロキシサーバをバイパスするURLのリストを指定します</td>
</tr>
</tbody>
</table>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Proxyの設定方法3</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">Cef</span><span class="p">.</span><span class="n">UIThreadTaskFactory</span><span class="p">.</span><span class="nf">StartNew</span><span class="p">(</span><span class="k">new</span> <span class="nf">Action</span><span class="p">(()</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="c1">// プロキシに設定する内容をDictionaryオブジェクトで設定する</span>
    <span class="kt">var</span> <span class="n">v</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;();</span>
    <span class="n">v</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"mode"</span><span class="p">,</span> <span class="s">"fixed_servers"</span><span class="p">);</span>
    <span class="n">v</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"server"</span><span class="p">,</span> <span class="s">"localhost:8080"</span><span class="p">);</span>
    <span class="n">v</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"bypass_list"</span><span class="p">,</span> <span class="s">"*.google.co.jp;*.nikkei.com"</span><span class="p">);</span>

    <span class="c1">// proxyを設定する</span>
    <span class="n">String</span> <span class="n">error</span><span class="p">;</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="nf">GetBrowserHost</span><span class="p">().</span><span class="n">RequestContext</span><span class="p">.</span><span class="nf">SetPreference</span><span class="p">(</span><span class="s">"proxy"</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="k">out</span> <span class="n">error</span><span class="p">);</span>
<span class="p">}));</span>
</code></pre></div>
</div>

<p>なお、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestContext_SetPreference.htm" rel="nofollow noopener" target="_blank">IRequestContext.SetPreference</a>メソッドは必ずCef UI Threadのコンテキストで呼び出す必要があるため、<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_Cef_UIThreadTaskFactory.htm" rel="nofollow noopener" target="_blank">Cef.UIThreadTaskFactory</a>スタティックメソッドを使って、呼び出しのコンテキストを強制する必要があります。</p>

<h2>
<span id="44-方法4プログラム全体のリクエストコンテキストで指定" class="fragment"></span><a href="#44-%E6%96%B9%E6%B3%954%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E5%85%A8%E4%BD%93%E3%81%AE%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%A7%E6%8C%87%E5%AE%9A"><i class="fa fa-link"></i></a>4.4 (方法4)プログラム全体のリクエストコンテキストで指定</h2>

<p>(方式3)とほぼ同じですが、WebView単位ではなく、プログラム全体でのリクエストコンテキストに対して、Proxy設定を行う方法になります。プログラム全体のリクエストコンテキストは<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_Cef_GetGlobalRequestContext.htm" rel="nofollow noopener" target="_blank">Cef.GetGlobalRequestContext</a>メソッドで取得することができます。取得したRequestContextに対して、(方法3)と同じ処理を行います。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Proxyの設定方法4</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">Cef</span><span class="p">.</span><span class="n">UIThreadTaskFactory</span><span class="p">.</span><span class="nf">StartNew</span><span class="p">(</span><span class="k">new</span> <span class="nf">Action</span><span class="p">(()</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="c1">// プロキシに設定する内容をDictionaryオブジェクトで設定する</span>
    <span class="kt">var</span> <span class="n">v</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;();</span>
    <span class="n">v</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"mode"</span><span class="p">,</span> <span class="s">"fixed_servers"</span><span class="p">);</span>
    <span class="n">v</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"server"</span><span class="p">,</span> <span class="s">"localhost:8080"</span><span class="p">);</span>
    <span class="n">v</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"bypass_list"</span><span class="p">,</span> <span class="s">"*.google.co.jp;*.nikkei.com"</span><span class="p">);</span>

    <span class="c1">// グローバルなRequestContextに対してproxyを設定する</span>
    <span class="n">String</span> <span class="n">error</span><span class="p">;</span>
    <span class="n">Cef</span><span class="p">.</span><span class="nf">GetGlobalRequestContext</span><span class="p">().</span><span class="nf">SetPreference</span><span class="p">(</span><span class="s">"proxy"</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="k">out</span> <span class="n">error</span><span class="p">);</span>
<span class="p">}));</span>
</code></pre></div>
</div>

<h1>
<span id="5-開発者ツール" class="fragment"></span><a href="#5-%E9%96%8B%E7%99%BA%E8%80%85%E3%83%84%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>5. 開発者ツール</h1>

<p>実験を行うには開発者ツールが便利です。<br>
CefSharpでは<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_WebBrowserExtensions_ShowDevTools.htm" rel="nofollow noopener" target="_blank">WebBrowserExtensions.ShowDevTools</a>メソッドを呼び出すだけで、Chromeでおなじみの開発者ツールを表示することができます。<br>
ここでは、Chromeと同じように、F12キーが押下されると、開発者ツールを表示するようにします。  </p>

<h2>
<span id="51-ikeyboardhandlerインタフェースを実装するクラスを作成する" class="fragment"></span><a href="#51-ikeyboardhandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>5.1 IKeyboardHandlerインタフェースを実装するクラスを作成する</h2>

<p>キー押下をハンドリングするためには、<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IKeyboardHandler.htm" rel="nofollow noopener" target="_blank">IKeyboardHandler</a>インタフェースを実装するクラスを作成する必要があります。Visual Studioのソリューションエクスプローラで、コンテキストメニューから「追加」ー「クラス」を選択します。<br>
ここではクラス名を<code>KeyboardHandler</code>にします。また、今後ハンドラが増えるので、ハンドラを実装するクラスを「Handlers」フォルダにまとめておきます。</p>

<h2>
<span id="52-作成したクラスでikeyboardhandlerを実装する" class="fragment"></span><a href="#52-%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7ikeyboardhandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>5.2 作成したクラスでIKeyboardHandlerを実装する</h2>

<p>以下のように、<code>IKeyboardHandler</code>を実装させます。  </p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IKeyboardHandlerを実装するクラス</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">KeyboardHandler</span> <span class="p">:</span> <span class="n">IKeyboardHandler</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>次に、<code>IKeyboardHandler</code>の文字列を選択すると電球マークが出るので、電球マークをクリックして、コンテキストメニューから「すべてのメンバーを明示的に実装する」を選択します。これで、Visual Studioが自動でインタフェースのメソッドのスケルトンを実装してくれます。  </p>

<h2>
<span id="53-f12キー押下時の処理を追加する" class="fragment"></span><a href="#53-f12%E3%82%AD%E3%83%BC%E6%8A%BC%E4%B8%8B%E6%99%82%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>5.3 F12キー押下時の処理を追加する。</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IKeyboardHandler.htm" rel="nofollow noopener" target="_blank">IKeyboardHandler</a>インタフェースは<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IKeyboardHandler_OnKeyEvent.htm" rel="nofollow noopener" target="_blank">OnKeyEvent</a>と<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IKeyboardHandler_OnPreKeyEvent.htm" rel="nofollow noopener" target="_blank">OnPreKeyEvent</a>の2つのメソッドを持ちます。  </p>

<ul>
<li>
<code>OnKeyEvent</code><br>
キーが押下されてページの描画処理やページ内のjavascriptがキーを受け取った<strong><em>後に</em></strong>呼び出されるハンドラです。</li>
<li>
<code>OnPreKeyEvent</code><br>
キーが押下されてページの描画処理やページ内のjavascriptにキーが通知される<strong><em>前に</em></strong>呼び出されるハンドラです。<br>
ここでは、<code>OnPreKeyEvent</code>でF12キーの押下をハンドリングして、開発者ツールを表示します。<br>
</li>
</ul>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">キー押下処理の追加方法</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">KeyboardHandler</span> <span class="p">:</span> <span class="n">IKeyboardHandler</span>
    <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">IKeyboardHandler</span><span class="p">.</span><span class="nf">OnKeyEvent</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">KeyType</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">windowsKeyCode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nativeKeyCode</span><span class="p">,</span> <span class="n">CefEventFlags</span> <span class="n">modifiers</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isSystemKey</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">bool</span> <span class="n">IKeyboardHandler</span><span class="p">.</span><span class="nf">OnPreKeyEvent</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">KeyType</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">windowsKeyCode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nativeKeyCode</span><span class="p">,</span> <span class="n">CefEventFlags</span> <span class="n">modifiers</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isSystemKey</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">bool</span> <span class="n">isKeyboardShortcut</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="p">==</span> <span class="n">KeyType</span><span class="p">.</span><span class="n">RawKeyDown</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// VK_F12キー押下</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">windowsKeyCode</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Keys</span><span class="p">.</span><span class="n">F12</span> <span class="p">&amp;&amp;</span> <span class="n">modifiers</span> <span class="p">==</span> <span class="n">CefEventFlags</span><span class="p">.</span><span class="n">None</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// 開発者ツールを表示する</span>
                    <span class="n">browser</span><span class="p">.</span><span class="nf">ShowDevTools</span><span class="p">();</span>
                    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>                    
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="54-webviewにハンドラを設定する" class="fragment"></span><a href="#54-webview%E3%81%AB%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>5.4 WebViewにハンドラを設定する。</h2>

<p>作成したキー押下時のハンドラを、<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_OffScreen_ChromiumWebBrowser_KeyboardHandler.htm" rel="nofollow noopener" target="_blank">ChromiumWebBrowser.KeyboardHandler</a>プロパティに設定します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ChromiumWebBrowserへのIKeyboardHandlerインタフェースの設定</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">SimpleBrowserFrame</span> <span class="p">:</span> <span class="n">Form</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// CefSharpのWebViewのインスタンス</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">private</span> <span class="n">ChromiumWebBrowser</span> <span class="n">WebBrowser</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">SimpleBrowserFrame</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">InitializeComponent</span><span class="p">();</span>

        <span class="c1">// CefSharpのWebViewを作成する。</span>
        <span class="n">WebBrowser</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ChromiumWebBrowser</span><span class="p">(</span><span class="s">"https://www.google.co.jp"</span><span class="p">);</span>

        <span class="c1">// いろいろと初期化処理</span>
        <span class="c1">//     :</span>
        <span class="c1">//     :</span>

        <span class="c1">// キーボードハンドラを設定する</span>
        <span class="n">WebBrowser</span><span class="p">.</span><span class="n">KeyboardHandler</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Handlers</span><span class="p">.</span><span class="nf">KeyboardHandler</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="55-カスタムwebブラウザを起動してf12キー押下をしてみる" class="fragment"></span><a href="#55-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0web%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%A6f12%E3%82%AD%E3%83%BC%E6%8A%BC%E4%B8%8B%E3%82%92%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>5.5 カスタムWebブラウザを起動して、F12キー押下をしてみる。</h2>

<p>うまく行くと、以下の様なおなじみの開発者ツールが起動します。<br>
  <a href="https://camo.qiitausercontent.com/97cdfe73657b29d42522551ad4c4e6a0c1d24caf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f65323134346537392d373534632d353239632d376266352d3032353630323537316234332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fe2144e79-754c-529c-7bf5-025602571b43.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=40ce265a24931589990caac268532e42" alt="開発者ツール.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/e2144e79-754c-529c-7bf5-025602571b43.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fe2144e79-754c-529c-7bf5-025602571b43.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ae6f787cfb481a2808f29f430cfc02a1 1x" loading="lazy"></a></p>

<p>おー！表示されました。</p>

<h1>
<span id="6-戻る進む更新ロード" class="fragment"></span><a href="#6-%E6%88%BB%E3%82%8B%E9%80%B2%E3%82%80%E6%9B%B4%E6%96%B0%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>6. 戻る、進む、更新、ロード</h1>

<p>一般的なブラウジング操作として、戻る、進む、更新、ロードを実装します。<br>
まず、最初にショートカットキーの処理を実装して、次にUI操作からの処理を実装します。</p>

<h2>
<span id="61-ショートカットキー押下時の処理追加" class="fragment"></span><a href="#61-%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%82%AD%E3%83%BC%E6%8A%BC%E4%B8%8B%E6%99%82%E3%81%AE%E5%87%A6%E7%90%86%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>6.1 ショートカットキー押下時の処理追加</h2>

<p>ショートカットキーの処理を実装するには、「<a href="#5-%E9%96%8B%E7%99%BA%E8%80%85%E3%83%84%E3%83%BC%E3%83%AB">5. 開発者ツール</a>」で説明した<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IKeyboardHandler_OnPreKeyEvent.htm" rel="nofollow noopener" target="_blank">OnPreKeyEvent</a>に処理を追加します。</p>

<ul>
<li>ALT+[←] 戻る<br>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IBrowser_GoBack.htm" rel="nofollow noopener" target="_blank">IBrowser.GoBack</a>メソッドを呼び出します。<br>
戻ることが可能な状況かどうかは、<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_IBrowser_CanGoBack.htm" rel="nofollow noopener" target="_blank">IBrowser.CanGoBack</a>プロパティを確認することで判断します。</li>
<li>ALT+[→]進む<br>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IBrowser_GoForward.htm" rel="nofollow noopener" target="_blank">IBrowser.GoForward</a>メソッドを呼び出します。<br>
進むことが可能な状況かどうかは、<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_IBrowser_CanGoForward.htm" rel="nofollow noopener" target="_blank">IBrowser.CanGoForward</a>プロパティを確認することで判断します。</li>
<li>F5 更新<br>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IBrowser_Reload.htm" rel="nofollow noopener" target="_blank">IBrowser.Reload</a>メソッドを呼び出します。<br>
なお、ロード中に更新を許可させない場合は、<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_IBrowser_IsLoading.htm" rel="nofollow noopener" target="_blank">IBrowser.IsLoading</a>を参照して、ロード中かどうかを判断します。</li>
</ul>

<p>以下は実装例です。  </p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">キー押下処理の追加</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">bool</span> <span class="n">IKeyboardHandler</span><span class="p">.</span><span class="nf">OnPreKeyEvent</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">KeyType</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">windowsKeyCode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nativeKeyCode</span><span class="p">,</span> <span class="n">CefEventFlags</span> <span class="n">modifiers</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isSystemKey</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">bool</span> <span class="n">isKeyboardShortcut</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="p">==</span> <span class="n">KeyType</span><span class="p">.</span><span class="n">RawKeyDown</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ALT+VK_LEFT</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">windowsKeyCode</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Keys</span><span class="p">.</span><span class="n">Left</span> <span class="p">&amp;&amp;</span>  <span class="n">modifiers</span> <span class="p">==</span> <span class="n">CefEventFlags</span><span class="p">.</span><span class="n">AltDown</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">CanGoBack</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// 戻る</span>
                <span class="n">browser</span><span class="p">.</span><span class="nf">GoBack</span><span class="p">();</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">// ALT+VK_RIHGT</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">windowsKeyCode</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Keys</span><span class="p">.</span><span class="n">Right</span> <span class="p">&amp;&amp;</span> <span class="n">modifiers</span> <span class="p">==</span> <span class="n">CefEventFlags</span><span class="p">.</span><span class="n">AltDown</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">CanGoForward</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// 進む</span>
                <span class="n">browser</span><span class="p">.</span><span class="nf">GoForward</span><span class="p">();</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">// VK_F5</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">windowsKeyCode</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Keys</span><span class="p">.</span><span class="n">F5</span> <span class="p">&amp;&amp;</span> <span class="n">modifiers</span> <span class="p">==</span> <span class="n">CefEventFlags</span><span class="p">.</span><span class="n">None</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 更新する</span>
            <span class="n">browser</span><span class="p">.</span><span class="nf">Reload</span><span class="p">();</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// (省略)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>これで、戻る、進む、更新の操作がショートカットキーでできるようになりました。</p>

<h2>
<span id="62-ボタンとinputの配置" class="fragment"></span><a href="#62-%E3%83%9C%E3%82%BF%E3%83%B3%E3%81%A8input%E3%81%AE%E9%85%8D%E7%BD%AE"><i class="fa fa-link"></i></a>6.2 ボタンとINPUTの配置</h2>

<p>ショートカットと同じ処理を、UI操作からもできるようにします。<br>
まず、ユーザ操作を受け付けるために、「戻る」「進む」「更新」「アドレスバー」を配置します。<br>
GUIの編集ですので、以下で紹介するやり方にとらわれず、自由に作成しても問題ありません。</p>

<h3>
<span id="tablelayoutpanelを配置する" class="fragment"></span><a href="#tablelayoutpanel%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>TableLayoutPanelを配置する。</h3>

<p>フォームにツールボックスから<code>TableLayoutPanel</code>を選んでドラッグ&amp;ドロップします。</p>

<ul>
<li>
<code>TableLayoutPanel</code>のDockをFillにして、フォーム全体をカバーするようにします。</li>
<li>
<code>TableLayoutPanel</code>の行と列を適当に配置します。</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/c3dab38c2a0b8548b7160f8e2ca38db3c5a35b76/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f65343538643566642d326431652d633834642d316436342d3734333064376635376134332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fe458d5fd-2d1e-c84d-1d64-7430d7f57a43.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=77983d26f67e6e4612784d1353b8af87" alt="レイアウト1.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/e458d5fd-2d1e-c84d-1d64-7430d7f57a43.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fe458d5fd-2d1e-c84d-1d64-7430d7f57a43.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0e34bf517457692eb84a47b488e97244 1x" loading="lazy"></a></p>

<h3>
<span id="webviewのコンテナを配置する" class="fragment"></span><a href="#webview%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>WebViewのコンテナを配置する。</h3>

<p>WebViewを配置する部分に、コンテナ用のPanelを配置します。  </p>

<ul>
<li>Panelは(0,1)の位置から、ColumnSpan=4で複数セルをカバーさせています。<br>
</li>
<li>PanelPanelのDockをFillにして、連結したセル全体をカバーさせます。</li>
<li>PanelPanelのNameを<code>webViewContainer</code>としておきます。</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/c74591f1d1c432ad3e1a249414095ee4855dbaa7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f32303765373063322d396664312d323765622d656261652d6565616235653432306537622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F207e70c2-9fd1-27eb-ebae-eeab5e420e7b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2fa128cb670139b6973053365812d864" alt="レイアウト2.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/207e70c2-9fd1-27eb-ebae-eeab5e420e7b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F207e70c2-9fd1-27eb-ebae-eeab5e420e7b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=79407321ceed6fc04fd8db900291b906 1x" loading="lazy"></a></p>

<h3>
<span id="アドレスバーを配置する" class="fragment"></span><a href="#%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>アドレスバーを配置する。</h3>

<p>アドレスバーを配置します。</p>

<ul>
<li>TextBoxを(3,0)の位置に配置します。</li>
<li>TextBoxをのDockをFillにして、セル全体をカバーさせます。</li>
<li>TextBoxをのMarginやFontを適当の変更して、見た目を調整する。</li>
<li>TextBoxのNameを<code>addressBar</code>としておきます。</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/acb12462e5110e9a6ec90723472486d786a55563/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f65613535633333332d336534342d323064622d393932362d3161633265356238393633382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fea55c333-3e44-20db-9926-1ac2e5b89638.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=bb47a3858c7ca1655c78ee8884645cc1" alt="レイアウト3.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/ea55c333-3e44-20db-9926-1ac2e5b89638.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fea55c333-3e44-20db-9926-1ac2e5b89638.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=11bdd054eccbdfee86496707999b241b 1x" loading="lazy"></a></p>

<h3>
<span id="ボタンを配置する" class="fragment"></span><a href="#%E3%83%9C%E3%82%BF%E3%83%B3%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ボタンを配置する。</h3>

<p>戻る、進む、更新のボタンを配置します。</p>

<ul>
<li>Buttonを3つ配置します。</li>
<li>それぞれのButtonでDockをFillにして、セル全体をカバーさせます。</li>
<li>それぞれのButtonのイメージを適当に設定します。</li>
<li>それぞれのButtonのNameを<code>backBtn</code>、<code>forwardBtn</code>、<code>reloadBtn</code>としておきます。</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/f32d0b575bcd6278f1fe14e87a22639879a4291b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f61626336633030342d643761372d653638612d353137352d3539613435373163653337662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fabc6c004-d7a7-e68a-5175-59a4571ce37f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=62478aa9f71fd545a62aa6eec179c67f" alt="レイアウト4.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/abc6c004-d7a7-e68a-5175-59a4571ce37f.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fabc6c004-d7a7-e68a-5175-59a4571ce37f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=71af30c34fa980c13e9a4ccd4fbb58c3 1x" loading="lazy"></a></p>

<h3>
<span id="webviewの作成処理を変更する" class="fragment"></span><a href="#webview%E3%81%AE%E4%BD%9C%E6%88%90%E5%87%A6%E7%90%86%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>WebViewの作成処理を変更する。</h3>

<p><code>ChromiumWebBrowser</code>の配置場所を、先ほど作ったPanelに変更します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">WebViewのコンテナ変更</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// CefSharpのWebViewを作成する。</span>
<span class="n">WebBrowser</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ChromiumWebBrowser</span><span class="p">(</span><span class="s">"https://www.google.co.jp"</span><span class="p">);</span>

<span class="c1">// コントロールをPanelに配置する</span>
<span class="k">this</span><span class="p">.</span><span class="n">webViewContainer</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">WebBrowser</span><span class="p">);</span>
<span class="n">WebBrowser</span><span class="p">.</span><span class="n">Dock</span> <span class="p">=</span> <span class="n">DockStyle</span><span class="p">.</span><span class="n">Fill</span><span class="p">;</span>
</code></pre></div>
</div>

<p>以上で、戻る、進む、更新のボタンとアドレスバーを持つシンプルなWebブラウザのUIが完成しました。</p>

<h2>
<span id="63-ボタンクリック時の処理追加" class="fragment"></span><a href="#63-%E3%83%9C%E3%82%BF%E3%83%B3%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E6%99%82%E3%81%AE%E5%87%A6%E7%90%86%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>6.3 ボタンクリック時の処理追加</h2>

<p>戻る、進む、更新のボタンクリックの処理を追加します。<br>
フォームのデザインビューで、それぞれのボタンをダブルクリックして、click時のハンドラを追加します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">戻る、進む、更新のボタンクリックの処理ハンドリング</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">backBtn_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">WebBrowser</span><span class="p">.</span><span class="n">CanGoBack</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 戻る</span>
        <span class="n">WebBrowser</span><span class="p">.</span><span class="nf">Back</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">forwardBtn_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">WebBrowser</span><span class="p">.</span><span class="n">CanGoForward</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 進む</span>
        <span class="n">WebBrowser</span><span class="p">.</span><span class="nf">Forward</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">reloadBtn_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 更新する</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="nf">Reload</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="64-アドレスバーでの処理追加" class="fragment"></span><a href="#64-%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%81%A7%E3%81%AE%E5%87%A6%E7%90%86%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>6.4 アドレスバーでの処理追加</h2>

<p>アドレスバーでEnterキーが押下された時に、アドレスバーに入力されているURLをロードするようにします。<br>
アドレスバーのKeyDownイベントのハンドラとして、addressBar_KeyDownメソッドを追加して、以下の処理を追加します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">アドレスバーでの入力ハンドリング</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">addressBar_KeyDown</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">KeyEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">KeyCode</span> <span class="p">==</span> <span class="n">Keys</span><span class="p">.</span><span class="n">Enter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// アドレスバーに入力があれば、ロードする</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">String</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">addressBar</span><span class="p">.</span><span class="n">Text</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// アドレスバーに入力されているURLをロードする。</span>
            <span class="n">WebBrowser</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="n">addressBar</span><span class="p">.</span><span class="n">Text</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="65-実行してみる" class="fragment"></span><a href="#65-%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>6.5 実行してみる</h2>

<p>ビルドして実行してみます。<br>
正しく実装されていると、以下のようなブラウザが表示されるはずです。<br>
<a href="https://camo.qiitausercontent.com/750260cdb1b694d10b657aac6673c31a731b55f5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f62333633626361362d643234302d373862642d623165392d6136376666333466353366642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fb363bca6-d240-78bd-b1e9-a67ff34f53fd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a12613bcaf3f5cd2c404ca710fe26856" alt="基本UI.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/b363bca6-d240-78bd-b1e9-a67ff34f53fd.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fb363bca6-d240-78bd-b1e9-a67ff34f53fd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0e7f3a59d3087fd591148b707b0b4225 1x" loading="lazy"></a></p>

<p>ALT＋[→]、ALT+[←]、F5のショートカットキーが有効になっていることも確認できます。<br>
ボタンやアドレスバーも操作可能になっています。</p>

<h2>
<span id="65-操作対象についての注意" class="fragment"></span><a href="#65-%E6%93%8D%E4%BD%9C%E5%AF%BE%E8%B1%A1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E6%B3%A8%E6%84%8F"><i class="fa fa-link"></i></a>6.5 操作対象についての注意</h2>

<p><code>IKeyboardHandler</code>ハンドラでの戻る、進む、更新の処理は、<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IWebBrowser.htm" rel="nofollow noopener" target="_blank">IWebBrowser</a>ではなく<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IBrowser.htm" rel="nofollow noopener" target="_blank">IBrowser</a>に対して行っています。<br>
IWebBrowserとIBrowserは同じWebViewを指しているように思われるかもしれませんが、window.openメソッドで開いた子ウィンドウの場合など、明示的に<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_WinForms_ChromiumWebBrowser.htm" rel="nofollow noopener" target="_blank">ChromiumWebBrowser</a>をnewして作成していないWebViewの場合は、IWebBrowserとIBrowserは同じWebViewを指していないので注意が必要です。</p>

<ul>
<li>
<p>ChromiumWebBrowserをnew作成した場合<br>
以下の様に<code>ChromiumWebBrowser</code>、<code>IWebBrowser</code>、<code>IBrowser</code>は同じWebViewと関連しています。<br>
<code>IKeyboardHandler</code>等のCefSharpのハンドラのメソッドは、これらの引数にして呼び出されることになります。<br>
この場合は、<code>IWebBrowser</code>、<code>IBrowser</code>のどちらを操作しても、結果は同じになります。</p>

<p><a href="https://camo.qiitausercontent.com/ea58d540d4d21f67d07681e5b94cea296b33a1be/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f62333732616239632d393930662d373066652d396131322d3237323530623562383263332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fb372ab9c-990f-70fe-9a12-27250b5b82c3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=17b008ae5290cb46dd3c2cf494ecb71b" alt="UML1.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/b372ab9c-990f-70fe-9a12-27250b5b82c3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fb372ab9c-990f-70fe-9a12-27250b5b82c3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=bf2a5b4426024e46eb1d58efa5b06ad1 1x" loading="lazy"></a></p>
</li>
<li>
<p>a要素のクリックやwindow.openにより子ウィンドウが自動的に作成された場合<br>
CefSharpにより自動作成されたWebViewでは、<code>ChromiumWebBrowser</code>や<code>IWebBrowser</code>は存在しておらず、参照を取得することができません。<br>
<code>IKeyboardHandler</code>等のCefSharpのハンドラのメソッドでは、親ウィンドウの<code>IWebBrowser</code>インタフェースが引数として渡されます。<br>
この場合は、<code>IWebBrowser</code>を操作すると親ウィンドウのWebViewが操作されてしまうことになります。</p>

<p><a href="https://camo.qiitausercontent.com/19fc90d04b4400e9f98dc21adc34fd2be5be3d81/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f33343262616132652d376635642d636632652d623165302d6139386430616166616436352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F342baa2e-7f5d-cf2e-b1e0-a98d0aafad65.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=966a690aa3069e9982876f3a3d846315" alt="UML2.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/342baa2e-7f5d-cf2e-b1e0-a98d0aafad65.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F342baa2e-7f5d-cf2e-b1e0-a98d0aafad65.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=67f529412e7d3ccaa2bbc45ec1caade6 1x" loading="lazy"></a></p>
</li>
</ul>

<p>まとめると、<code>ChromiumWebBrowser</code>を明示的にnewして作ったWebView以外のWebViewが存在する場合(子ウィンドをサポートする場合)は、<strong><em>WebViewに対する操作は、<code>IWebBrowser</code>に対してではなく、必ず<code>IBrowser</code>に対して行うようにします。</em></strong></p>

<p>なお、上の「<a href="#63-%E3%83%9C%E3%82%BF%E3%83%B3%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E6%99%82%E3%81%AE%E5%87%A6%E7%90%86%E8%BF%BD%E5%8A%A0">6.3 ボタンクリック時の処理追加</a>」と「<a href="#64-%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%81%A7%E3%81%AE%E5%87%A6%E7%90%86%E8%BF%BD%E5%8A%A0">6.4 アドレスバーでの処理追加</a>」では、<code>IBrowser</code>ではなく<code>ChromiumWebBrowser</code>に対して、<code>GoBack</code>等のメソッドを呼び出しています。これらについては、「<a href="#22-%E5%AD%90%E3%82%A6%E3%82%A3%E3%83%B3%E3%83%89%E3%82%A6%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3">22. 子ウィンドウオープン</a>」で<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILifeSpanHandler.htm" rel="nofollow noopener" target="_blank">ILifeSpanHandler</a>を実装した後に、<code>IBrowser</code>インタフェースを操作する様に変更します。</p>

<h1>
<span id="7-拡大縮小" class="fragment"></span><a href="#7-%E6%8B%A1%E5%A4%A7%E7%B8%AE%E5%B0%8F"><i class="fa fa-link"></i></a>7. 拡大・縮小</h1>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_WebBrowserExtensions_SetZoomLevel.htm" rel="nofollow noopener" target="_blank">WebBrowserExtensions.SetZoomLevel</a>メソッドを呼び出すことで、拡大率を適用します。<br>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_WebBrowserExtensions_GetZoomLevelAsync.htm" rel="nofollow noopener" target="_blank">WebBrowserExtensions.GetZoomLevelAsync</a>メソッドを呼び出すことで、現在の拡大率を取得することができます。</p>

<h2>
<span id="71-拡大率とzoomlevelの関係" class="fragment"></span><a href="#71-%E6%8B%A1%E5%A4%A7%E7%8E%87%E3%81%A8zoomlevel%E3%81%AE%E9%96%A2%E4%BF%82"><i class="fa fa-link"></i></a>7.1 拡大率とZoomLevelの関係</h2>

<p>両メソッドともに<code>double</code>値の<code>ZoomLevel</code>で拡大・縮小のレベルを使用します。<br>
<code>ZoomLevel</code>と拡大率(等倍を1.0とする倍率)には、以下の関係があります。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>\begin{align}
1.2^{ZoomLevel} &amp;= 拡大率\\
ZoomLevel &amp;= \log_{1.2} 拡大率 = \frac{\log 拡大率}{\log 1.2}
\end{align}
</code></pre></div></div>

<p>Chromの拡大率は以下のようになっています。<br>
- 拡大は、110%、125%、150%、175%、200%、250%、300%、400%、500%<br>
- 縮小は、90%、80%、75%、67%、50%、33%、25%</p>

<p>これらの拡大率をZoomLevelに直すと以下のようになります。</p>

<table>
<thead>
<tr>
<th style="text-align: left">拡大率</th>
<th style="text-align: left">計算式</th>
<th style="text-align: left">ZoomLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">500%</td>
<td style="text-align: left">$\log_{1.2} 5 = \frac{\log 5}{\log 1.2}$</td>
<td style="text-align: left">8.827</td>
</tr>
<tr>
<td style="text-align: left">400%</td>
<td style="text-align: left">$\log_{1.2} 4 = \frac{\log 4}{\log 1.2}$</td>
<td style="text-align: left">7.604</td>
</tr>
<tr>
<td style="text-align: left">300%</td>
<td style="text-align: left">$\log_{1.2} 3 = \frac{\log 3}{\log 1.2}$</td>
<td style="text-align: left">6.026</td>
</tr>
<tr>
<td style="text-align: left">250%</td>
<td style="text-align: left">$\log_{1.2} 2.5 = \frac{\log 2.5}{\log 1.2}$</td>
<td style="text-align: left">5.026</td>
</tr>
<tr>
<td style="text-align: left">200%</td>
<td style="text-align: left">$\log_{1.2} 2 = \frac{\log 2}{\log 1.2}$</td>
<td style="text-align: left">3.802</td>
</tr>
<tr>
<td style="text-align: left">175%</td>
<td style="text-align: left">$\log_{1.2} 1.75 = \frac{\log 1.75}{\log 1.2}$</td>
<td style="text-align: left">3.069</td>
</tr>
<tr>
<td style="text-align: left">125%</td>
<td style="text-align: left">$\log_{1.2} 1.25 = \frac{\log 1.25}{\log 1.2}$</td>
<td style="text-align: left">1.224</td>
</tr>
<tr>
<td style="text-align: left">110%</td>
<td style="text-align: left">$\log_{1.2} 1.1 = \frac{\log 1.1}{\log 1.2}$</td>
<td style="text-align: left">0.523</td>
</tr>
<tr>
<td style="text-align: left">90%</td>
<td style="text-align: left">$\log_{1.2} 0.9 = \frac{\log 0.9}{\log 1.2}$</td>
<td style="text-align: left">-0.578</td>
</tr>
<tr>
<td style="text-align: left">80%</td>
<td style="text-align: left">$\log_{1.2} 0.8 = \frac{\log 0.8}{\log 1.2}$</td>
<td style="text-align: left">-1.224</td>
</tr>
<tr>
<td style="text-align: left">75%</td>
<td style="text-align: left">$\log_{1.2} 0.75 = \frac{\log 0.75}{\log 1.2}$</td>
<td style="text-align: left">-1.578</td>
</tr>
<tr>
<td style="text-align: left">67%</td>
<td style="text-align: left">$\log_{1.2} 0.67 = \frac{\log 0.67}{\log 1.2}$</td>
<td style="text-align: left">-2.197</td>
</tr>
<tr>
<td style="text-align: left">50%</td>
<td style="text-align: left">$\log_{1.2} 0.5 = \frac{\log 0.5}{\log 1.2}$</td>
<td style="text-align: left">-3.802</td>
</tr>
<tr>
<td style="text-align: left">33%</td>
<td style="text-align: left">$\log_{1.2} 0.33 = \frac{\log 0.33}{\log 1.2}$</td>
<td style="text-align: left">-6.081</td>
</tr>
<tr>
<td style="text-align: left">25%</td>
<td style="text-align: left">$\log_{1.2} 0.25 = \frac{\log 0.25}{\log 1.2}$</td>
<td style="text-align: left">-7.604</td>
</tr>
</tbody>
</table>

<h2>
<span id="72-ショートカットキーで拡大縮小等倍の処理を追加する" class="fragment"></span><a href="#72-%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%82%AD%E3%83%BC%E3%81%A7%E6%8B%A1%E5%A4%A7%E7%B8%AE%E5%B0%8F%E7%AD%89%E5%80%8D%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>7.2 ショートカットキーで拡大・縮小・等倍の処理を追加する</h2>

<p>ショートカットキーをハンドリングするために、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IKeyboardHandler_OnPreKeyEvent.htm" rel="nofollow noopener" target="_blank">IKeyboardHandler.OnPreKeyEvent</a>に処理を追加します。</p>

<ul>
<li>Ctrl + [+]<br>
現在の拡大率を取得して、現在の拡大率より一つ大きい拡大率を適用します。</li>
<li>Ctrl + [-]<br>
現在の拡大率を取得して、現在の拡大率より一つ小さい拡大率を適用します。</li>
<li>Ctrl + [0]<br>
等倍にします。</li>
</ul>

<p>以下の様なコードになります。<br>
なお、[+][-][0]のキーはキーボード本体とテンキーの2つにあり、それぞれキーコードが区別されているで、複数の条件を指定する必要があります。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">拡大縮小のショートカットキーのハンドリング方法</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">KeyboardHandler</span> <span class="p">:</span> <span class="n">IKeyboardHandler</span>
<span class="p">{</span>
    <span class="c1">// ZoomLevelの定義</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;</span> <span class="n">ZOOM_LEVLES</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;{</span> <span class="p">-</span><span class="m">7.604</span><span class="p">,</span> <span class="p">-</span><span class="m">6.081</span><span class="p">,</span> <span class="p">-</span><span class="m">3.802</span><span class="p">,</span> <span class="p">-</span><span class="m">2.197</span><span class="p">,</span> <span class="p">-</span><span class="m">1.578</span><span class="p">,</span> <span class="p">-</span><span class="m">1.224</span><span class="p">,</span> <span class="p">-</span><span class="m">0.578</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0.523</span><span class="p">,</span> <span class="m">1.224</span><span class="p">,</span> <span class="m">3.069</span><span class="p">,</span> <span class="m">3.802</span><span class="p">,</span> <span class="m">5.026</span><span class="p">,</span> <span class="m">6.026</span><span class="p">,</span> <span class="m">7.604</span><span class="p">,</span> <span class="m">8.827</span> <span class="p">};</span>

    <span class="c1">//　(省略)</span>

    <span class="kt">bool</span> <span class="n">IKeyboardHandler</span><span class="p">.</span><span class="nf">OnPreKeyEvent</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">KeyType</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">windowsKeyCode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nativeKeyCode</span><span class="p">,</span> <span class="n">CefEventFlags</span> <span class="n">modifiers</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isSystemKey</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">bool</span> <span class="n">isKeyboardShortcut</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="p">==</span> <span class="n">KeyType</span><span class="p">.</span><span class="n">RawKeyDown</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Ctrl + NumberPad_Add</span>
            <span class="c1">// Ctrl + Add</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">windowsKeyCode</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Keys</span><span class="p">.</span><span class="n">Add</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">modifiers</span> <span class="p">==</span> <span class="p">(</span><span class="n">CefEventFlags</span><span class="p">.</span><span class="n">ControlDown</span> <span class="p">|</span> <span class="n">CefEventFlags</span><span class="p">.</span><span class="n">IsKeyPad</span><span class="p">)))</span> <span class="p">||</span>
                <span class="p">(</span><span class="n">windowsKeyCode</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Keys</span><span class="p">.</span><span class="n">Oemplus</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">modifiers</span> <span class="p">==</span> <span class="p">(</span><span class="n">CefEventFlags</span><span class="p">.</span><span class="n">ControlDown</span> <span class="p">|</span> <span class="n">CefEventFlags</span><span class="p">.</span><span class="n">ShiftDown</span><span class="p">))))</span>
            <span class="p">{</span>
                <span class="c1">// 現在のZoomLevelを取得する</span>
                <span class="n">browser</span><span class="p">.</span><span class="nf">GetZoomLevelAsync</span><span class="p">().</span><span class="nf">ContinueWith</span><span class="p">((</span><span class="n">t</span><span class="p">)</span> <span class="p">=&gt;</span>
                <span class="p">{</span>
                    <span class="c1">// 現在のZoomLevelの次に大きなZoomLevelを求めて設定する</span>
                    <span class="kt">int</span> <span class="n">index</span> <span class="p">=</span> <span class="n">ZOOM_LEVLES</span><span class="p">.</span><span class="nf">IndexOf</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">Result</span><span class="p">);</span>
                    <span class="n">index</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Min</span><span class="p">(++</span><span class="n">index</span><span class="p">,</span> <span class="n">ZOOM_LEVLES</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">);</span>
                    <span class="n">browser</span><span class="p">.</span><span class="nf">SetZoomLevel</span><span class="p">(</span><span class="n">ZOOM_LEVLES</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span>
                <span class="p">});</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1">// Ctrl + NumberPad_Minus</span>
            <span class="c1">// Ctrl + Minus</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">windowsKeyCode</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Keys</span><span class="p">.</span><span class="n">Subtract</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">modifiers</span> <span class="p">==</span> <span class="p">(</span><span class="n">CefEventFlags</span><span class="p">.</span><span class="n">ControlDown</span> <span class="p">|</span> <span class="n">CefEventFlags</span><span class="p">.</span><span class="n">IsKeyPad</span><span class="p">)))</span> <span class="p">||</span>
                <span class="p">(</span><span class="n">windowsKeyCode</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Keys</span><span class="p">.</span><span class="n">OemMinus</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">modifiers</span> <span class="p">==</span> <span class="p">(</span><span class="n">CefEventFlags</span><span class="p">.</span><span class="n">ControlDown</span> <span class="p">|</span> <span class="n">CefEventFlags</span><span class="p">.</span><span class="n">ShiftDown</span><span class="p">))))</span>
            <span class="p">{</span>
                <span class="c1">// 現在のZoomLevelを取得する</span>
                <span class="n">browser</span><span class="p">.</span><span class="nf">GetZoomLevelAsync</span><span class="p">().</span><span class="nf">ContinueWith</span><span class="p">((</span><span class="n">t</span><span class="p">)</span> <span class="p">=&gt;</span>
                <span class="p">{</span>
                    <span class="c1">// 現在のZoomLevelの次に小さいZoomLevelを求めて設定する</span>
                    <span class="kt">int</span> <span class="n">index</span> <span class="p">=</span> <span class="n">ZOOM_LEVLES</span><span class="p">.</span><span class="nf">IndexOf</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">Result</span><span class="p">);</span>
                    <span class="n">index</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Max</span><span class="p">(--</span><span class="n">index</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
                    <span class="n">browser</span><span class="p">.</span><span class="nf">SetZoomLevel</span><span class="p">(</span><span class="n">ZOOM_LEVLES</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span>
                <span class="p">});</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1">// Ctrl + NumberPad_0</span>
            <span class="c1">// Ctrl + 0</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">windowsKeyCode</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Keys</span><span class="p">.</span><span class="n">D0</span> <span class="p">&amp;&amp;</span> <span class="n">modifiers</span> <span class="p">==</span> <span class="n">CefEventFlags</span><span class="p">.</span><span class="n">ControlDown</span><span class="p">)</span> <span class="p">||</span>
                <span class="p">(</span><span class="n">windowsKeyCode</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Keys</span><span class="p">.</span><span class="n">NumPad0</span> <span class="p">&amp;&amp;</span> <span class="n">modifiers</span> <span class="p">==</span> <span class="p">(</span><span class="n">CefEventFlags</span><span class="p">.</span><span class="n">ControlDown</span> <span class="p">|</span> <span class="n">CefEventFlags</span><span class="p">.</span><span class="n">IsKeyPad</span><span class="p">)))</span>
            <span class="p">{</span>
                <span class="c1">// 100%の倍率に戻す</span>
                <span class="n">browser</span><span class="p">.</span><span class="nf">SetZoomLevel</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>以上で、拡大、縮小、等倍の操作がショートカットキーからできるようになりました。</p>

<h1>
<span id="8-印刷" class="fragment"></span><a href="#8-%E5%8D%B0%E5%88%B7"><i class="fa fa-link"></i></a>8. 印刷</h1>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_WebBrowserExtensions_Print.htm" rel="nofollow noopener" target="_blank">WebBrowserExtensions.Print</a>メソッドを呼び出すことで、簡単にWebViewの印刷ができます。<br>
ここでは、Ctrl+[P]ショートカットキーに、印刷処理を割りあてます。</p>

<h2>
<span id="81-ショートカットキーの追加" class="fragment"></span><a href="#81-%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%82%AD%E3%83%BC%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>8.1 ショートカットキーの追加</h2>

<p>ショートカットキーをハンドリングするために、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IKeyboardHandler_OnPreKeyEvent.htm" rel="nofollow noopener" target="_blank">IKeyboardHandler.OnPreKeyEvent</a>に処理を追加します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">印刷のショートカットキーのハンドリング</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">bool</span> <span class="n">IKeyboardHandler</span><span class="p">.</span><span class="nf">OnPreKeyEvent</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">KeyType</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">windowsKeyCode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nativeKeyCode</span><span class="p">,</span> <span class="n">CefEventFlags</span> <span class="n">modifiers</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isSystemKey</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">bool</span> <span class="n">isKeyboardShortcut</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="p">==</span> <span class="n">KeyType</span><span class="p">.</span><span class="n">RawKeyDown</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// CTRL＋[P]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">windowsKeyCode</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Keys</span><span class="p">.</span><span class="n">P</span> <span class="p">&amp;&amp;</span> <span class="n">modifiers</span> <span class="p">==</span> <span class="n">CefEventFlags</span><span class="p">.</span><span class="n">ControlDown</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 印刷する</span>
            <span class="n">browser</span><span class="p">.</span><span class="nf">Print</span><span class="p">();</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// ほかのショートカットキーの処理</span>
        <span class="c1">//         :</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="82-印刷の確認" class="fragment"></span><a href="#82-%E5%8D%B0%E5%88%B7%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>8.2 印刷の確認</h2>

<p>ビルドして実行してみます。<br>
Ctrl+[P]を押下すると、印刷ダイアログが表示されます。<br>
なお、PDFに印刷したい場合は、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_WebBrowserExtensions_PrintToPdfAsync.htm" rel="nofollow noopener" target="_blank">WebBrowserExtensions.PrintToPdfAsync</a>メソッドを呼び出すことで、PDFファイルに保存することができます。</p>

<h1>
<span id="9-認証" class="fragment"></span><a href="#9-%E8%AA%8D%E8%A8%BC"><i class="fa fa-link"></i></a>9. 認証</h1>

<p>Basic認証やDigest認証が求められる場合に、認証情報を入力するための仕組みを実装することができます。Proxyサーバで認証が必要な場合にも、この仕組みで認証情報の入力をユーザに求めることができます。<br>
認証情報が必要になると、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_GetAuthCredentials.htm" rel="nofollow noopener" target="_blank">IRequestHandler.GetAuthCredentials</a>メソッドがCefSharpから呼び出されます。<br>
なお、HTMLの仕様では一度Basic認証やDigest認証で認証に成功しても、それ以降同じホストに対するHTTPリクエストの度に認証が要求されます。一般的なブラウザはこの認証要求を、入力済みの認証情報を使って自動的に認証処理を行っています。 <br>
CefSharpでも同様に一度認証に成功すると、それ以降同じホストからの認証要求は自動的に処理されるため、2回目以降はこのハンドラは呼び出されなくなります。</p>

<h2>
<span id="91-irequesthandlerを実装するクラスの作成" class="fragment"></span><a href="#91-irequesthandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>9.1 IRequestHandlerを実装するクラスの作成</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IRequestHandler.htm" rel="nofollow noopener" target="_blank">IRequestHandler</a>インタフェースは、CefSharpを使うアプリケーションで最も重要なインタフェースです。<br>
ここでは、このインタフェースを実装するクラスとして、RequestHandlerクラスを追加します。<br>
「<a href="#5-%E9%96%8B%E7%99%BA%E8%80%85%E3%83%84%E3%83%BC%E3%83%AB">5. 開発者ツール</a>」でのやり方と同様に、ソリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に<code>RequestHandler</code>を指定します。そして、以下のように<code>IRequestHandler</code>を実装させます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IRequestHandlerを実装するクラス</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">RequestHandler</span><span class="p">:</span> <span class="n">IRequestHandler</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>その後、<code>IRequestHandler</code>を選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。</p>

<h2>
<span id="92-irequesthandlerインタフェースのデフォルト処理の実装" class="fragment"></span><a href="#92-irequesthandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%AE%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E5%87%A6%E7%90%86%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>9.2 IRequestHandlerインタフェースのデフォルト処理の実装</h2>

<p>Visual Studioで自動実装したメンバーは例外をスローするようになっているので、以下のデフォルト処理を実装します。</p>

<ul>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_GetAuthCredentials.htm" rel="nofollow noopener" target="_blank">IRequestHandler.GetAuthCredentials</a><br>
サーバが認証を要求した時に呼び出されるハンドラです。<br>
一般的な実装としては、ダイアログボックスを表示して、ユーザにユーザ名とパスワードを入力させる処理を行います。<br>
この部分は「<a href="#94-getauthcredentials%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85">9.4 GetAuthCredentialsメソッドの実装</a>」で実装していきます。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_GetResourceRequestHandler.htm" rel="nofollow noopener" target="_blank">IRequestHandler.GetResourceRequestHandler</a><br>
リソースのリクエストを行う前に呼び出されるハンドラで、主に以下の処理を行うためのインタフェースを返却します。

<ul>
<li>Cookieの送信や受け入れの許可と禁止</li>
<li>HTTPレスポンスの内容を変更するためのフィルタの返却</li>
<li>リソースのロード許可と禁止</li>
<li>HTTPレスポンス受信、HTTPのリダイレクト、ロード完了のハンドリング<br>
ここでは、デフォルトの動作をさせるために、<code>null</code>を返却しておきます。</li>
</ul>
</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnBeforeBrowse.htm" rel="nofollow noopener" target="_blank">IRequestHandler.OnBeforeBrowse</a><br>
ナビゲーションを許可するかどうかを判断するハンドラです。<br>
ここでは、<code>true</code>を返却して、ナビゲーションを許可します。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnCertificateError.htm" rel="nofollow noopener" target="_blank">IRequestHandler.OnCertificateError</a><br>
SSLの証明書でエラーが発生した場合(オレオレ証明書など)に、処理を継続するかどうかを判断するためのハンドラです。<br>
一般的な実装としては、証明書エラーのページを一度表示して、ユーザに表示を継続するかどうかを問い合わせて、その結果に応じて処理を行うことになります。<br>
ここでは、常に処理を継続するようにするため、引数で指定されているcallbackの<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IRequestCallback.htm" rel="nofollow noopener" target="_blank">IRequestCallback.Continue</a>メソッドを<code>true</code>を指定して呼び出して<code>true</code>を返却します。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnDocumentAvailableInMainFrame.htm" rel="nofollow noopener" target="_blank">IRequestHandler.OnDocumentAvailableInMainFrame</a><br>
<code>window.document</code>オブジェクトが作成されたときに呼び出されるハンドラです。<br>
ここでは特に何もしません。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnOpenUrlFromTab.htm" rel="nofollow noopener" target="_blank">IRequestHandler.OnOpenUrlFromTab</a><br>
Ctrl+左クリックでアンカーをクリックした際に、新しいタブでナビゲーションを開始するかを判断するためのハンドラです。 
ここでは、このタイプのナビゲーションを許可しないように<code>false</code>を返却するようにします。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnPluginCrashed.htm" rel="nofollow noopener" target="_blank">IRequestHandler.OnPluginCrashed</a><br>
Pluginがクラッシュしたときに呼び出されるハンドラですが、特に何もしません。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnQuotaRequest.htm" rel="nofollow noopener" target="_blank">IRequestHandler.OnQuotaRequest</a><br>
<code>webkitStorageInfo.requestQuota</code>メソッドでクオータの要求があった場合のハンドラです。<br>
一般的な実装としては、ダイアログボックスを表示してユーザに許可するかどうかを問い合わせて、その結果で許可または禁止するように実装します。<br>
ここでは常に許可する動作として、引数で指定されているcallbackの<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IRequestCallback.htm" rel="nofollow noopener" target="_blank">IRequestCallback.Continue</a>メソッドを<code>true</code>を指定して呼び出して<code>true</code>を返却します。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnRenderProcessTerminated.htm" rel="nofollow noopener" target="_blank">IRequestHandler.OnRenderProcessTerminated</a><br>
予期せずレンダープロセスが終了した場合のハンドラです。<br>
一般的な実装の場合、ユーザに故障発生のダイアログを出したり、ブラウザを再起動する処理を行うことになります。<br>
ここでは特に何もしません。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnRenderViewReady.htm" rel="nofollow noopener" target="_blank">IRequestHandler.OnRenderViewReady</a><br>
レンダーのViewが準備できた時のハンドラです。<br>
ここでは特に何もしません。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnSelectClientCertificate.htm" rel="nofollow noopener" target="_blank">IRequestHandler.OnSelectClientCertificate</a><br>
SSLでサーバがクライアント証明書を要求する時に、クライアント証明書を選択するために呼び出されるハンドラです。<br>
一般的な実装では、クライアント証明書の一覧を表示して、ユーザに選択させる処理になります。<br>
ここでは<code>false</code>を返却して、クライアント証明書リストの先頭の証明書を使用するデフォルトの動作をさせます。</li>
</ul>

<h2>
<span id="93-認証用ダイアログボックスの実装" class="fragment"></span><a href="#93-%E8%AA%8D%E8%A8%BC%E7%94%A8%E3%83%80%E3%82%A4%E3%82%A2%E3%83%AD%E3%82%B0%E3%83%9C%E3%83%83%E3%82%AF%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>9.3 認証用ダイアログボックスの実装</h2>

<p>ソリューションエクスプローラでコンテキストメニューから「追加」－「フォーム(Windows フォーム)」を選択して、新しいフォームを追加します。フォームの名前はここでは<code>AuthDialog</code>としました。<br>
そして、以下のようにユーザ名とパスワードのTextInputとOKとCANCELボタンを持つダイアログボックスをデザインします。<br>
※GetAuthCredentialsメソッドでは、認証を要求しているhostの情報、ポート番号、サーバが返却したrealm文字列等の情報も受け取るので、これらの情報も表示するようにすることもできます。</p>

<p><a href="https://camo.qiitausercontent.com/bc1ec7135613b91afd17d4385812e3050d10b1e4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f35636232333939622d646134632d383766342d393332352d6566633761633936343739352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F5cb2399b-da4c-87f4-9325-efc7ac964795.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=23956095eb60b2444cf80daa97dcd08a" alt="ログオン.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/5cb2399b-da4c-87f4-9325-efc7ac964795.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F5cb2399b-da4c-87f4-9325-efc7ac964795.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d5f7df45f322feca4e50b32f52c5ccb6 1x" loading="lazy"></a></p>

<p>また、AuthDialogクラスに以下を実装します。</p>

<ul>
<li>入力されたユーザ名を保持するUserNameプロパティを追加します。</li>
<li>入力されたパスワードを保持するPasswordプロパティを追加します。</li>
<li>OKボタンがクイックされたときに、UserNameとPasswordプロパティに入力値を設定します。</li>
<li>OKボタンが選択されたときに<code>DialogResult.OK</code>が返却されるように、フォームのAcceptButtonに割り当てます。</li>
<li>CANCELボタンが選択されたときに<code>DialogResult.Cancel</code>が返却されるように、フォームのCancelButtonに割り当てます。</li>
<li>Topmostで表示するようにします。</li>
</ul>

<p>以下のようなコードになります。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">認証情報入力ダイアログ</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows.Forms</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">AuthDialog</span> <span class="p">:</span> <span class="n">Form</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// ダイアログに入力されたユーザ名</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="n">String</span> <span class="n">UserName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// ダイアログに入力されたパスワード</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="n">String</span> <span class="n">Password</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="nf">AuthDialog</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">ConfirmBtn_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 確定したユーザ名とパスワードをプロパティに設定する。</span>
            <span class="n">UserName</span> <span class="p">=</span> <span class="n">userNameTxt</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>
            <span class="n">Password</span> <span class="p">=</span> <span class="n">passwordTxt</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="94-getauthcredentialsメソッドの実装" class="fragment"></span><a href="#94-getauthcredentials%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>9.4 GetAuthCredentialsメソッドの実装</h2>

<p>いよいよGetAuthCredentialsメソッドを実装します。<br>
このメソッドはアプリケーションのUIスレッドとは異なる<code>CEF IO thread</code>と呼ばれるスレッドから呼び出されていますが、<strong><em>このスレッドを絶対にブロックしてはいけません。</em></strong><br>
そこで、WebViewの親コントロールのコンテキス(UIスレッドのコンテキスト)で、ダイアログを表示してユーザにユーザ名とパスワードの入力を促すようにして、このメソッド自体はすぐに<code>true</code>を返却するようにします。そして、ユーザが入力を確定した時点で、引数で指定された<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IAuthCallback.htm" rel="nofollow noopener" target="_blank">IAuthCallback</a>インタフェースを使用して、入力されたユーザ名とパスワードをCefSharpに通知するようにします。  </p>

<p>なお、「<a href="#5-%E6%93%8D%E4%BD%9C%E5%AF%BE%E8%B1%A1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E6%B3%A8%E6%84%8F">5. 操作対象についての注意</a>」で説明したように、<code>IWebBrowser</code>ではなく<code>IBrowser</code>を常に操作対象と考える必要があります。少し汚くなりますが<code>PInvoke</code>でWin32の<code>GetParent</code>を使って、<code>IBrowser</code>に関連したWebViewの親ウィンドウを取得します。この処理は今後も使うことになるため、以下のようなユーティリティ関数を作成します。</p>

<p>具体的には、以下のようになります。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IBrowserからTopLevelのフォームの取り出しメソッド</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">SimpleBrowser</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">SimpleBrowserFrame</span> <span class="p">:</span> <span class="n">Form</span>
    <span class="p">{</span>
        <span class="c1">// (省略)</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// IBrowserからメインフレームを取得する</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="browser"&gt;&lt;/param&gt;</span>
        <span class="c1">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">SimpleBrowserFrame</span> <span class="nf">getMainFrame</span><span class="p">(</span><span class="n">IBrowser</span> <span class="n">browser</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// browserのウィンドウハンドル</span>
            <span class="n">IntPtr</span> <span class="n">hWnd</span> <span class="p">=</span> <span class="n">browser</span><span class="p">.</span><span class="nf">GetHost</span><span class="p">().</span><span class="nf">GetWindowHandle</span><span class="p">();</span>

            <span class="c1">// browserの親コントロール(webViewContainer)</span>
            <span class="n">Control</span> <span class="n">container</span> <span class="p">=</span> <span class="n">Control</span><span class="p">.</span><span class="nf">FromHandle</span><span class="p">(</span><span class="nf">GetParent</span><span class="p">(</span><span class="n">hWnd</span><span class="p">));</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">container</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">container</span><span class="p">.</span><span class="n">TopLevelControl</span> <span class="k">is</span> <span class="n">SimpleBrowserFrame</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// コントロールのトップレベルのコントロールを取得して返却する</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">SimpleBrowserFrame</span><span class="p">)</span><span class="n">container</span><span class="p">.</span><span class="n">TopLevelControl</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Win32のGetParent</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">ExactSpelling</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Auto</span><span class="p">)]</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="n">IntPtr</span> <span class="nf">GetParent</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hWnd</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>このユーティリティメソッドを使用して、GetAuthCredentialsメソッドを実装します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">GetAuthCredentialsメソッドの実装</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography.X509Certificates</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows.Forms</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">RequestHandler</span> <span class="p">:</span> <span class="n">IRequestHandler</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">GetAuthCredentials</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="kt">string</span> <span class="n">originUrl</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isProxy</span><span class="p">,</span> <span class="kt">string</span> <span class="n">host</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span><span class="p">,</span> <span class="kt">string</span> <span class="n">realm</span><span class="p">,</span> <span class="kt">string</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">IAuthCallback</span> <span class="n">callback</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// コントロールのトップレベルのコントロールを取得（SimpleBrowserFrame）</span>
            <span class="n">SimpleBrowserFrame</span> <span class="n">mainFrame</span> <span class="p">=</span> <span class="n">SimpleBrowserFrame</span><span class="p">.</span><span class="nf">getMainFrame</span><span class="p">(</span><span class="n">browser</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">mainFrame</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// 親コントロールのコンテキストで非同期にダイアログを表示する。</span>
                <span class="n">mainFrame</span><span class="p">.</span><span class="nf">BeginInvoke</span><span class="p">(</span><span class="k">new</span> <span class="nf">Action</span><span class="p">(()</span> <span class="p">=&gt;</span>
                <span class="p">{</span>
                    <span class="c1">// ログオンダイアログを表示する</span>
                    <span class="n">AuthDialog</span> <span class="n">dlg</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AuthDialog</span><span class="p">();</span>
                    <span class="n">DialogResult</span> <span class="n">ret</span> <span class="p">=</span> <span class="n">dlg</span><span class="p">.</span><span class="nf">ShowDialog</span><span class="p">();</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="p">==</span> <span class="n">DialogResult</span><span class="p">.</span><span class="n">OK</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="c1">// 入力されたユーザ名とパスワードで認証を継続する。</span>
                        <span class="n">callback</span><span class="p">.</span><span class="nf">Continue</span><span class="p">(</span><span class="n">dlg</span><span class="p">.</span><span class="n">UserName</span><span class="p">,</span> <span class="n">dlg</span><span class="p">.</span><span class="n">Password</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">else</span>
                    <span class="p">{</span>
                        <span class="c1">// 認証処理をキャンセルする。</span>
                        <span class="n">callback</span><span class="p">.</span><span class="nf">Cancel</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">}));</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="c1">// 認証処理をキャンセルする。</span>
                <span class="n">callback</span><span class="p">.</span><span class="nf">Cancel</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IResourceRequestHandler</span> <span class="nf">GetResourceRequestHandler</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isNavigation</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isDownload</span><span class="p">,</span> <span class="kt">string</span> <span class="n">requestInitiator</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">bool</span> <span class="n">disableDefaultHandling</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">OnBeforeBrowse</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">userGesture</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isRedirect</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// ナビゲーションを許可する</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">OnCertificateError</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">CefErrorCode</span> <span class="n">errorCode</span><span class="p">,</span> <span class="kt">string</span> <span class="n">requestUrl</span><span class="p">,</span> <span class="n">ISslInfo</span> <span class="n">sslInfo</span><span class="p">,</span> <span class="n">IRequestCallback</span> <span class="n">callback</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 証明書エラーでも継続する</span>
            <span class="n">callback</span><span class="p">.</span><span class="nf">Continue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnDocumentAvailableInMainFrame</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">OnOpenUrlFromTab</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="kt">string</span> <span class="n">targetUrl</span><span class="p">,</span> <span class="n">WindowOpenDisposition</span> <span class="n">targetDisposition</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">userGesture</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Ctrl+左クリックでの別Tab表示は許可しない。</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnPluginCrashed</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="kt">string</span> <span class="n">pluginPath</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">OnQuotaRequest</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="kt">string</span> <span class="n">originUrl</span><span class="p">,</span> <span class="kt">long</span> <span class="n">newSize</span><span class="p">,</span> <span class="n">IRequestCallback</span> <span class="n">callback</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// クオータの要求は常に許可する。</span>
            <span class="n">callback</span><span class="p">.</span><span class="nf">Continue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnRenderProcessTerminated</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">CefTerminationStatus</span> <span class="n">status</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnRenderViewReady</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">OnSelectClientCertificate</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isProxy</span><span class="p">,</span> <span class="kt">string</span> <span class="n">host</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span><span class="p">,</span> <span class="n">X509Certificate2Collection</span> <span class="n">certificates</span><span class="p">,</span> <span class="n">ISelectClientCertificateCallback</span> <span class="n">callback</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// デフォルトのクライアント証明書の選択方法とする。</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="95-irequesthandlerをchromiumwebbrowserに設定する" class="fragment"></span><a href="#95-irequesthandler%E3%82%92chromiumwebbrowser%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>9.5 IRequestHandlerをChromiumWebBrowserに設定する</h2>

<p>作成した<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IRequestHandler.htm" rel="nofollow noopener" target="_blank">IRequestHandler</a>インタフェースを<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_WinForms_ChromiumWebBrowser_RequestHandler.htm" rel="nofollow noopener" target="_blank">ChromiumWebBrowser.RequestHandler</a>プロパティに設定します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ChromiumWebBrowserのIRequestHandlerを設定</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">SimpleBrowserFrame</span> <span class="p">:</span> <span class="n">Form</span>
<span class="p">{</span>
    <span class="c1">// （省略）</span>
    <span class="k">public</span> <span class="nf">SimpleBrowserFrame</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// いろいろと初期化処理</span>
        <span class="c1">//     :</span>
        <span class="c1">//     :</span>

        <span class="c1">// キーボードハンドラを設定する</span>
        <span class="n">WebBrowser</span><span class="p">.</span><span class="n">KeyboardHandler</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Handlers</span><span class="p">.</span><span class="nf">KeyboardHandler</span><span class="p">();</span>

        <span class="c1">// リクエストハンドラを設定する</span>
        <span class="n">WebBrowser</span><span class="p">.</span><span class="n">RequestHandler</span><span class="p">=</span> <span class="k">new</span> <span class="n">Handlers</span><span class="p">.</span><span class="nf">RequestHandler</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="96-認証の確認" class="fragment"></span><a href="#96-%E8%AA%8D%E8%A8%BC%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>9.6 認証の確認</h2>

<p>認証が正しく実装できているか確認してみましょう。<br>
BASIC認証を行う簡単なサーバを用意する必要があります。<br>
ここでは、node.jsで動作する<a href="https://www.npmjs.com/package/http-server" rel="nofollow noopener" target="_blank">http-server</a>を使ってみます。</p>

<p>よく使うので、グローバルにインストールしておきます。</p>

<div class="code-frame" data-lang="batch">
<div class="code-lang"><span class="bold">http-serverのインストール</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kd">npm</span> <span class="kd">install</span> <span class="na">-g </span><span class="kd">http</span><span class="na">-server
</span></code></pre></div>
</div>

<p>適当なディレクトリに移動して、以下のコマンドを実行すれば、BASIC認証を行うHTTPサーバが起動されます。<br>
ポート番号を<code>8081</code>、ユーザ名を<code>test</code>、パスワードを<code>p@ssword</code>としています。</p>

<div class="code-frame" data-lang="batch">
<div class="code-lang"><span class="bold">テスト用サーバの起動</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nb">cd</span> <span class="kd">c</span>:\temp
<span class="kd">http</span><span class="na">-server -p </span><span class="m">8081</span> <span class="na">--user </span><span class="kd">test</span> <span class="na">--password </span><span class="kd">p</span>@ssword
</code></pre></div>
</div>

<p>これで、ポート<code>8081</code>でHTTPサーバが起動するので、さっそく確認してみましょう。<br><br>
カスタムWebブラウザのアドレスバーに<a href="http://localhost:8081" rel="nofollow noopener" target="_blank">http://localhost:8081</a>を入力してENTERを押下すると、作成した認証用ダイアログボックスが表示されます。正しいユーザ名とパスワードを入力するとページが表示されます。</p>

<p>その後、F5キーでページを更新すると、認証ダイアログボックスは表示されないことが確認できます。これは一度認証に使ったユーザ名とパスワードの情報をCefSharpの内部で保持していて、二回目以降は自動で認証処理を行ってくれるからです。</p>

<h1>
<span id="10-タイトルの表示" class="fragment"></span><a href="#10-%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E3%81%AE%E8%A1%A8%E7%A4%BA"><i class="fa fa-link"></i></a>10. タイトルの表示</h1>

<p>Webコンテンツが指定するタイトル文字列を表示します。<br>
これを行うためには、<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IDisplayHandler.htm" rel="nofollow noopener" target="_blank">IDisplayHandler</a>インターフェースを実装する必要があります。タイトル文字列が変更すると、CefSharpによってこのインタフェースの<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnTitleChanged.htm" rel="nofollow noopener" target="_blank">IDisplayHandler.OnTitleChanged</a>メソッドが呼び出されます。</p>

<h2>
<span id="101-idisplayhandlerを実装するクラスを追加" class="fragment"></span><a href="#101-idisplayhandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>10.1 IDisplayHandlerを実装するクラスを追加</h2>

<p>まず、<code>IDisplayHandler</code>インタフェースを実装するクラスを新規に作成します。 <br>
リューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に<code>DisplayHandler</code>を指定します。<br>
そして、以下のように<code>IDisplayHandler</code>を実装させます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IDisplayHandlerインタフェースを実装するクラス</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows.Forms</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">DisplayHandler</span><span class="p">:</span><span class="n">IDisplayHandler</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="102-idisplayhandlerのメソッドを仮実装" class="fragment"></span><a href="#102-idisplayhandler%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BB%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>10.2 IDisplayHandlerのメソッドを仮実装</h2>

<p>その後、<code>IDisplayHandler</code>を選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。<br>
自動実装されたメンバーは例外をスローするようになっているので、以下の様にデフォルト実装します。</p>

<ul>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnAddressChanged.htm" rel="nofollow noopener" target="_blank">OnAddressChanged</a><br>
WebコンテンツのURLが変わったタイミングで呼び出されます。<br>
URLをロードすると何度かリダイレクトが発生する場合がありますが、通常はそのたびにアドレスバーに表示するURL文字列を更新することになります。これを実現するには、このメソッドが呼び出されるタイミングで、アドレスバーを更新します。<br>
「<a href="#11-%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%81%AE%E6%9B%B4%E6%96%B0">11. アドレスバーの更新</a>」でこの部分を実装しますので、ここでは特にないもしません。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnAutoResize.htm" rel="nofollow noopener" target="_blank">OnAutoResize</a><br>
コンテンツがリサイズされたときに呼び出されるメソッドですが、<code>false</code>を返却してブラウザのデフォルトの動作をさせます。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnConsoleMessage.htm" rel="nofollow noopener" target="_blank">OnConsoleMessage</a><br>
javascriptで<code>console.log</code>や<code>console.error</code>等のメソッドが呼び出されて、コンソールログ出力が行われるタイミングで呼び出されます。<br>
ここでは、開発者ツールのコンソールログに出力するデフォルトの動作を行うように、<code>false</code>を返却します。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnFaviconUrlChange.htm" rel="nofollow noopener" target="_blank">OnFaviconUrlChange</a><br>
FAVIONアイコンが変わるタイミングで呼び出されます。<br>
一般的な実装としては、引数で渡されたアイコンのURLでアイコンをダウンロードして表示します。<br>
ここでは、仮実装として特に何もしないようにします。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnFullscreenModeChange.htm" rel="nofollow noopener" target="_blank">OnFullscreenModeChange</a><br>
Webコンテンツで<a href="https://developer.mozilla.org/ja/docs/Web/API/Fullscreen_API" rel="nofollow noopener" target="_blank">Fullscreen API</a>が呼び出されて、フルスクリーンモードが変わるタイミングで呼び出されます。<br>
Fullscreen APIをサポートする場合は、このタイミングでキオスクモードにするなど表示を変更することになります。<br>
ここでは、仮実装として特に何もしません。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnLoadingProgressChange.htm" rel="nofollow noopener" target="_blank">OnLoadingProgressChange</a><br>
Webページロードの進捗率が変わるタイミングで呼び出されます。<br>
プログレスバーの進捗率を更新するなどのUIを実装することができます。<br>
ここでは、仮実装として特に何もしません。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnStatusMessage.htm" rel="nofollow noopener" target="_blank">OnStatusMessage</a><br>
Webコンテンツにより<a href="https://developer.mozilla.org/ja/docs/Web/API/Window/status" rel="nofollow noopener" target="_blank">window.status</a>プロパティが変更されて、
ステータスバーのメッセージが変更されるタイミングで呼び出されます。ステータスバーを表示している場合は、ステータスバーに表示する文字列を変更することができます。<br>
ここでは、仮実装として特に何もしません。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnTitleChanged.htm" rel="nofollow noopener" target="_blank">OnTitleChanged</a><br>
Webコンテンツのtitle要素や<a href="https://developer.mozilla.org/ja/docs/Web/API/Document/title" rel="nofollow noopener" target="_blank">document.title</a>でタイトル文字列が変更されるタイミングで呼び出されます。<br>
以下の「<a href="#103-%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E5%A4%89%E6%9B%B4%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%82%92%E5%AE%9F%E8%A3%85">10.3 タイトル変更のハンドラを実装</a>」でこのメソッドを実装します。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnTooltipChanged.htm" rel="nofollow noopener" target="_blank">OnTooltipChanged</a><br>
ツールチップを表示するタイミングで呼び出されます。<br>
Winforms版では呼び出されないことになっていますが、ここでは<code>false</code>を返却してデフォルトの処理を行うようにします。</li>
</ul>

<h2>
<span id="103-タイトル変更のハンドラを実装" class="fragment"></span><a href="#103-%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E5%A4%89%E6%9B%B4%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%82%92%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>10.3 タイトル変更のハンドラを実装</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnTitleChanged.htm" rel="nofollow noopener" target="_blank">OnTitleChanged</a>メソッドを実装します。<br>
このメソッドの引数は、第一引数が<code>IWebBrowser</code>となっていますが、実際にタイトル文字列が変更されたWebViewは第二引数の<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_TitleChangedEventArgs_Browser.htm" rel="nofollow noopener" target="_blank">TitleChangedEventArgs.Browser</a>プロパティで指定されるWebViewですので注意が必要です。<br>
※「<a href="#65-%E6%93%8D%E4%BD%9C%E5%AF%BE%E8%B1%A1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E6%B3%A8%E6%84%8F">6.5 操作対象についての注意</a>」で説明したように、第一引数の<code>IWebBrowser</code>と第二引数のプロパティで指定される<code>IBrowser</code>が異なるWebViewを指している可能性があります。</p>

<p>まず、第二引数のプロパティで指定される<code>IBrowser</code>から、タイトルを変更する対象のウィンドウを特定します。タブ形式のブラウザにしている場合は、<code>IBrowser</code>を表示しているタブの文字列を変更することになるでしょう。<br>
今回はタブ形式のブラウザでないため、メインウィンドウのタイトルを変更対象とします。<br>
これには、「<a href="#94-getauthcredentials%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85">9.4 GetAuthCredentialsメソッドの実装</a>」で実装してユーティリティメソッドを使って、<code>IBrowser</code>からWebViewを表示しているTopLevelのフレームを取得します。</p>

<p>次に、対象ウィンドウのタイトルを変更しますが、<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IDisplayHandler.htm" rel="nofollow noopener" target="_blank">IDisplayHandler</a>の各メソッドは、ブラウザのアプリケーションUIスレッドのコンテキストで呼び出されていないため、必ずメインウィンドウのコンテキストでタイトル文字列を変更されるようにします。</p>

<p>以下は、実装例になります。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IDisplayHandlerインタフェースの実装</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp.Structs</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">SimpleBrowser</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">DisplayHandler</span> <span class="p">:</span> <span class="n">IDisplayHandler</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnAddressChanged</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">AddressChangedEventArgs</span> <span class="n">addressChangedArgs</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">OnAutoResize</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">Size</span> <span class="n">newSize</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// ブラウザのデフォルト処理を行う</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">OnConsoleMessage</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">ConsoleMessageEventArgs</span> <span class="n">consoleMessageArgs</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// コンソールにメッセージを出力する</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnFaviconUrlChange</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IList</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">urls</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnFullscreenModeChange</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">fullscreen</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnLoadingProgressChange</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="kt">double</span> <span class="n">progress</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnStatusMessage</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">StatusMessageEventArgs</span> <span class="n">statusMessageArgs</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnTitleChanged</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">TitleChangedEventArgs</span> <span class="n">titleChangedArgs</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// コントロールのトップレベルのコントロールを取得（SimpleBrowserFrame）</span>
            <span class="n">SimpleBrowserFrame</span> <span class="n">mainFrame</span> <span class="p">=</span> <span class="n">SimpleBrowserFrame</span><span class="p">.</span><span class="nf">getMainFrame</span><span class="p">(</span><span class="n">titleChangedArgs</span><span class="p">.</span><span class="n">Browser</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">mainFrame</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// 親コントロールのコンテキストでタイトル文字列を変更する。</span>
                <span class="n">mainFrame</span><span class="p">.</span><span class="nf">BeginInvoke</span><span class="p">(</span><span class="k">new</span> <span class="nf">Action</span><span class="p">(()</span> <span class="p">=&gt;</span>
                <span class="p">{</span>
                    <span class="c1">// タイトル文字列を変更する</span>
                    <span class="n">mainFrame</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">titleChangedArgs</span><span class="p">.</span><span class="n">Title</span><span class="p">;</span>
                <span class="p">}));</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">OnTooltipChanged</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">string</span> <span class="n">text</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="104-idisplayhandlerをchromiumwebbrowserに設定する" class="fragment"></span><a href="#104-idisplayhandler%E3%82%92chromiumwebbrowser%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>10.4 IDisplayHandlerをChromiumWebBrowserに設定する</h2>

<p>作成した<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IDisplayHandler.htm" rel="nofollow noopener" target="_blank">IDisplayHandler</a>インタフェースを<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_WinForms_ChromiumWebBrowser_DisplayHandler.htm" rel="nofollow noopener" target="_blank">ChromiumWebBrowser.DisplayHandler</a>プロパティに設定します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ChromiumWebBrowserにIDisplayHandlerを設定</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">SimpleBrowserFrame</span> <span class="p">:</span> <span class="n">Form</span>
<span class="p">{</span>
    <span class="c1">// （省略）</span>
    <span class="k">public</span> <span class="nf">SimpleBrowserFrame</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// いろいろと初期化処理</span>
        <span class="c1">//     :</span>

        <span class="c1">// ディスプレイハンドラを設定する</span>
        <span class="n">WebBrowser</span><span class="p">.</span><span class="n">DisplayHandler</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Handlers</span><span class="p">.</span><span class="nf">DisplayHandler</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>以上でタイトル文字列がタイトルバーに表示されるようになりました。</p>

<h1>
<span id="11-アドレスバーの更新" class="fragment"></span><a href="#11-%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%81%AE%E6%9B%B4%E6%96%B0"><i class="fa fa-link"></i></a>11. アドレスバーの更新</h1>

<p>WebコンテンツのURLが変わったタイミングで、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnAddressChanged.htm" rel="nofollow noopener" target="_blank">OnAddressChanged</a>メソッドがCefSharpから呼び出されるので、ここで受け取ったURL文字列をアドレスバーに表示します。これだけです。</p>

<p>「<a href="#10-%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E3%81%AE%E8%A1%A8%E7%A4%BA">10. タイトルの表示</a>」で<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IDisplayHandler.htm" rel="nofollow noopener" target="_blank">IDisplayHandler</a>インタフェースを実装しているので、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnAddressChanged.htm" rel="nofollow noopener" target="_blank">OnAddressChanged</a>メソッドの中身を実装していきます。</p>

<h2>
<span id="111-アドレスバーの文字列変更のメソッドを追加" class="fragment"></span><a href="#111-%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%81%AE%E6%96%87%E5%AD%97%E5%88%97%E5%A4%89%E6%9B%B4%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>11.1 アドレスバーの文字列変更のメソッドを追加</h2>

<p>まず、メインフレームのクラスSimpleBrowserFrameにアドレスバー変更のメソッドを追加します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">アドレスバー更新用メソッド</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">updateAddressBar</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">addressBar</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">url</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="112-onaddresschangedを実装" class="fragment"></span><a href="#112-onaddresschanged%E3%82%92%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>11.2 OnAddressChangedを実装</h2>

<p>以下の様に、アドレスが変更になった<code>IBrowser</code>からSimpleBrowserFrameを取得して、アドレスバーの更新をします。<br>
※今回はタブ表示でないためアドレスバーは１つしかないので、<code>chromiumWebBrowser</code>の親ウィンドウをたどってSimpleBrowserFrameを取得して操作するのと変わりませんが、複数タブを持つことを想定してこの実装にしています。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">OnAddressChangedの実装</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">OnAddressChanged</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">AddressChangedEventArgs</span> <span class="n">addressChangedArgs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// アドレスバーを持つフォームを取得する。</span>
    <span class="n">SimpleBrowserFrame</span> <span class="n">mainFrame</span> <span class="p">=</span> <span class="n">SimpleBrowserFrame</span><span class="p">.</span><span class="nf">getMainFrame</span><span class="p">(</span><span class="n">addressChangedArgs</span><span class="p">.</span><span class="n">Browser</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mainFrame</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// UIスレッドのコンテキストで、アドレスバーの表示内容を更新する。</span>
        <span class="n">mainFrame</span><span class="p">.</span><span class="nf">BeginInvoke</span><span class="p">(</span><span class="k">new</span> <span class="nf">Action</span><span class="p">(()</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="n">mainFrame</span><span class="p">.</span><span class="nf">updateAddressBar</span><span class="p">(</span><span class="n">addressChangedArgs</span><span class="p">.</span><span class="n">Address</span><span class="p">);</span>
        <span class="p">}));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>以上でアドレスバーの文字列が更新されるようになりました。</p>

<h1>
<span id="12-コンソールログ" class="fragment"></span><a href="#12-%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%83%AD%E3%82%B0"><i class="fa fa-link"></i></a>12. コンソールログ</h1>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnConsoleMessage.htm" rel="nofollow noopener" target="_blank">OnConsoleMessage</a>メソッドは、Webコンテンツから<code>console.log</code>メソッドや<code>console.error</code>メソッドでコンソールログを出力する時に呼びされるメソッドです。このメソッドを実装することで、コンソールログを保存するような処理を作ることができます。</p>

<h2>
<span id="121-log4netのnugetパッケージを追加" class="fragment"></span><a href="#121-log4net%E3%81%AEnuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>12.1 Log4NetのNugetパッケージを追加</h2>

<p>ログのライブラリは何を使ってもよいですが、ここでは人気にある<a href="https://logging.apache.org/log4net/" rel="nofollow noopener" target="_blank">Log4net</a>を使うことにします。</p>

<ol>
<li>ソリューションエクスプローラで「SimpleBrowser」を選択して、コンテキストメニューから「NuGetパッケージの管理」を選択します。</li>
<li>NuGetパッケージマネージャで、「参照」タブを選択します。</li>
<li>検索ボックスに「Log4Net」と入力して検索を実行すると、Log4net関連のNugetパッケージが表示されます。
<a href="https://camo.qiitausercontent.com/f4743c79b0a0d9297402ca90dd1a8a1520e92bd4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f61376534336364302d343731642d393763312d383037302d6430363734653838383133342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fa7e43cd0-471d-97c1-8070-d0674e888134.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=72bc3cec070320e56340b05c59d512da" alt="Nuget2.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/a7e43cd0-471d-97c1-8070-d0674e888134.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fa7e43cd0-471d-97c1-8070-d0674e888134.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=209d70562bac0be37ef63d56698bddf3 1x" loading="lazy"></a>
</li>
<li>Log4netのnugetパッケージをインストールします。 </li>
</ol>

<p>以上で、Log4Netのパッケージ取り込み完了です。</p>

<h2>
<span id="122-log4netのコンフィグの追加" class="fragment"></span><a href="#122-log4net%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%95%E3%82%A3%E3%82%B0%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>12.2 Log4netのコンフィグの追加</h2>

<h3>
<span id="appconfigの変更" class="fragment"></span><a href="#appconfig%E3%81%AE%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>App.configの変更</h3>

<p><code>App.config</code>に以下の定義を追加します。<br><br>
この定義は以下の意味です。  </p>

<ul>
<li>実行ファイルと同じディレクトリの<code>console.log</code>ファイルにログが記録される。</li>
<li>プログラムが何度再起動しても、同じログファイルに追加書き込みされる。</li>
<li>ログのフォーマットは、「日付時刻 スレッド番号 レベル メッセージ」の形式である。</li>
</ul>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">App.config</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;configSections&gt;</span>
        <span class="nt">&lt;section</span> <span class="na">name=</span><span class="s">"log4net"</span> <span class="na">type=</span><span class="s">"log4net.Config.Log4NetConfigurationSectionHandler,Log4net"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/configSections&gt;</span>
    <span class="nt">&lt;log4net&gt;</span>
        <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"ConsoleLog"</span> <span class="na">type=</span><span class="s">"log4net.Appender.FileAppender"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;File</span> <span class="na">value=</span><span class="s">".\\console.log"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;AppendToFile</span> <span class="na">value=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;layout</span> <span class="na">type=</span><span class="s">"log4net.Layout.PatternLayout"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;ConversionPattern</span> <span class="na">value=</span><span class="s">"%date [%thread] [%-5level] - %message%n"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/layout&gt;</span>
        <span class="nt">&lt;/appender&gt;</span>
        <span class="nt">&lt;root&gt;</span>
            <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">"ALL"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"ConsoleLog"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/root&gt;</span>
    <span class="nt">&lt;/log4net&gt;</span>
    <span class="nt">&lt;startup&gt;</span>
        <span class="nt">&lt;supportedRuntime</span> <span class="na">version=</span><span class="s">"v4.0"</span> <span class="na">sku=</span><span class="s">".NETFramework,Version=v4.7.2"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/startup&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div>
</div>

<h3>
<span id="assemblyinfocsの変更" class="fragment"></span><a href="#assemblyinfocs%E3%81%AE%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>AssemblyInfo.csの変更</h3>

<p><code>AssemblyInfo.cs</code>ファイルに以下の定義を追加する。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">AssemblyInfo.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="n">log4net</span><span class="p">.</span><span class="n">Config</span><span class="p">.</span><span class="nf">XmlConfigurator</span><span class="p">(</span><span class="n">Watch</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
</code></pre></div>
</div>

<h2>
<span id="123-onconsolemessageメソッドの実装" class="fragment"></span><a href="#123-onconsolemessage%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>12.3 OnConsoleMessageメソッドの実装</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnConsoleMessage.htm" rel="nofollow noopener" target="_blank">OnConsoleMessage</a>メソッドを実装して、Log4Netを使ってjavascriptのconsole.XXXメソッドの内容をログファイルに出力します。</p>

<p>具体的には、以下の様に実装します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">OnConsoleMessageメソッドの実装</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp.Structs</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">SimpleBrowser</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">log4net</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">DisplayHandler</span> <span class="p">:</span> <span class="n">IDisplayHandler</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// Logger</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="k">static</span> <span class="n">ILog</span> <span class="n">logger</span> <span class="p">=</span> <span class="n">LogManager</span><span class="p">.</span><span class="nf">GetLogger</span><span class="p">(</span><span class="s">"ConsoleLog"</span><span class="p">);</span>

        <span class="c1">// 省略</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">OnConsoleMessage</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">ConsoleMessageEventArgs</span> <span class="n">consoleMessageArgs</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// ログレベルに合わせてLog4Netを呼び出してログを保存する。</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">consoleMessageArgs</span><span class="p">.</span><span class="n">Level</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">case</span> <span class="n">LogSeverity</span><span class="p">.</span><span class="n">Error</span><span class="p">:</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="n">consoleMessageArgs</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="n">LogSeverity</span><span class="p">.</span><span class="n">Fatal</span><span class="p">:</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="n">consoleMessageArgs</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="n">LogSeverity</span><span class="p">.</span><span class="n">Info</span><span class="p">:</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">Info</span><span class="p">(</span><span class="n">consoleMessageArgs</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="n">LogSeverity</span><span class="p">.</span><span class="n">Warning</span><span class="p">:</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">Warn</span><span class="p">(</span><span class="n">consoleMessageArgs</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="n">LogSeverity</span><span class="p">.</span><span class="n">Verbose</span><span class="p">:</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">Debug</span><span class="p">(</span><span class="n">consoleMessageArgs</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// コンソールにもメッセージを出力する</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>※<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnConsoleMessage.htm" rel="nofollow noopener" target="_blank">OnConsoleMessage</a>メソッドのドキュメントには、<code>true</code>を返却するとコンソールにログを出力しなくなると書かれていますが、実際には<code>true</code>を返却してもコンソールにログが出力されているようです（CefSharpのバージョンも関係するかもしれません）。</p>

<h2>
<span id="124-ログファイルの確認" class="fragment"></span><a href="#124-%E3%83%AD%E3%82%B0%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>12.4 ログファイルの確認</h2>

<p>プログラムを起動するとプログラムと同じディレクトリに<code>console.log</code>ファイルができます。<br>
中身を見ると、コンソールログが出力されていることが確認できます。</p>

<div class="code-frame" data-lang="batch">
<div class="code-lang"><span class="bold">ログファイルの内容</span></div>
<div class="highlight"><pre class="with-code"><code><span class="m">2020</span><span class="o">-</span><span class="m">11</span><span class="o">-</span><span class="m">05</span> <span class="m">20</span>:19:35<span class="o">,</span><span class="m">861</span> <span class="o">[</span><span class="m">4</span><span class="o">]</span> <span class="o">[</span><span class="kd">DEBUG</span><span class="o">]</span> <span class="o">-</span> <span class="kd">Main</span>._createAppUI: <span class="m">16</span>.732177734375 <span class="kd">ms</span>
<span class="m">2020</span><span class="o">-</span><span class="m">11</span><span class="o">-</span><span class="m">05</span> <span class="m">20</span>:19:35<span class="o">,</span><span class="m">873</span> <span class="o">[</span><span class="m">4</span><span class="o">]</span> <span class="o">[</span><span class="kd">DEBUG</span><span class="o">]</span> <span class="o">-</span> <span class="kd">Main</span>._showAppUI: <span class="m">11</span>.036865234375 <span class="kd">ms</span>
<span class="m">2020</span><span class="o">-</span><span class="m">11</span><span class="o">-</span><span class="m">05</span> <span class="m">20</span>:19:35<span class="o">,</span><span class="m">908</span> <span class="o">[</span><span class="m">4</span><span class="o">]</span> <span class="o">[</span><span class="kd">DEBUG</span><span class="o">]</span> <span class="o">-</span> <span class="kd">Main</span>._initializeTarget: <span class="m">9</span>.383056640625 <span class="kd">ms</span>
<span class="m">2020</span><span class="o">-</span><span class="m">11</span><span class="o">-</span><span class="m">05</span> <span class="m">20</span>:19:36<span class="o">,</span><span class="m">051</span> <span class="o">[</span><span class="m">4</span><span class="o">]</span> <span class="o">[</span><span class="kd">DEBUG</span><span class="o">]</span> <span class="o">-</span> <span class="kd">Main</span>._lateInitialization: <span class="m">0</span>.58984375 <span class="kd">ms</span>
<span class="m">2020</span><span class="o">-</span><span class="m">11</span><span class="o">-</span><span class="m">05</span> <span class="m">20</span>:19:52<span class="o">,</span><span class="m">115</span> <span class="o">[</span><span class="m">4</span><span class="o">]</span> <span class="o">[</span><span class="kd">INFO</span> <span class="o">]</span> <span class="o">-</span> <span class="kd">abc</span>
</code></pre></div>
</div>

<h1>
<span id="13-ダウンロード" class="fragment"></span><a href="#13-%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>13. ダウンロード</h1>

<p>ファイルのダウンロード機能を実装することができます。<br>
<code>download</code>属性を持つ<code>a</code>要素をクリックした場合など、ブラウザがダウンロードと判断した場合に、ファイルのダウンロードが行われます。</p>

<h2>
<span id="131-idownloadhandlerを実装するクラスを追加" class="fragment"></span><a href="#131-idownloadhandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>13.1 IDownloadHandlerを実装するクラスを追加</h2>

<p>まず、<a href="https://cefsharp.github.io/api/85.3.x/html/Methods_T_CefSharp_IDownloadHandler.htm" rel="nofollow noopener" target="_blank">IDownloadHandler</a>インタフェースを実装するクラスを新規に作成します。 <br>
リューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に<code>DownloadHandler</code>を指定します。そして、以下のように<code>IDownloadHandler</code>を実装させます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IDownloadHandlerを実装するクラス</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Download</span><span class="p">:</span><span class="n">IDownloadHandler</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>その後、<code>IDownloadHandler</code>を選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択する。<br>
すると、<code>IDownloadHandler</code>インタフェースの以下のメソッドが仮実装されます。</p>

<ul>
<li>OnBeforeDownload</li>
<li>OnDownloadUpdated</li>
</ul>

<h2>
<span id="132-onbeforedownloadの実装" class="fragment"></span><a href="#132-onbeforedownload%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>13.2 OnBeforeDownloadの実装</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadHandler_OnBeforeDownload.htm" rel="nofollow noopener" target="_blank">OnBeforeDownload</a>メソッドは、ダウンロードするファイルの保存先やファイル名を決めるためのメソッドです。<br>
プログラムで保存場所を決めることも、ユーザにファイルの保存先を問い合わせることができます。</p>

<p>CefSharpのドキュメントにはダウンロードが開始される前に呼び出されると書かれています。<br>
しかし、実際にはdownload属性のあるa要素をクリックすると、即座にダウンロードが開始され、最初に<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadHandler_OnDownloadUpdated.htm" rel="nofollow noopener" target="_blank">OnDownloadUpdated</a>メソッドが呼び出されます。そして、次にこのメソッドが呼び出されますが、バックグラウンドではダウンロード処理が進行しています。</p>

<p>ここでは、ユーザに保存場所を問い合わせるようにします。<br>
これを行うためには、引数で渡される<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadHandler_OnBeforeDownload.htm" rel="nofollow noopener" target="_blank">IBeforeDownloadCallback</a>インタフェースの<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IBeforeDownloadCallback_Continue.htm" rel="nofollow noopener" target="_blank">Continue</a>メソッドを呼び出します。</p>

<p>以下の例では、デフォルトのファイル保存ダイアログが表示されます。<br>
※第二引数を<code>true</code>にするとCefSharpがファイル保存ダイアログを出してくれます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">OnBeforeDownloadの実装(その1)</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">void</span> <span class="n">IDownloadHandler</span><span class="p">.</span><span class="nf">OnBeforeDownload</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">DownloadItem</span> <span class="n">downloadItem</span><span class="p">,</span> <span class="n">IBeforeDownloadCallback</span> <span class="n">callback</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ファイル保存ダイアログを表示する。</span>
    <span class="c1">// 最初に表示される保存先とファイル名はCefSharpに任せる。</span>
    <span class="n">callback</span><span class="p">.</span><span class="nf">Continue</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>もちろん以下の様に書けば、ユーザに問い合わせることなく、自動的に指定したファイルに保存することもできます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">OnBeforeDownloadの実装(その2)</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">void</span> <span class="n">IDownloadHandler</span><span class="p">.</span><span class="nf">OnBeforeDownload</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">DownloadItem</span> <span class="n">downloadItem</span><span class="p">,</span> <span class="n">IBeforeDownloadCallback</span> <span class="n">callback</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// c:\temp配下時自動的に保存する。</span>
    <span class="n">callback</span><span class="p">.</span><span class="nf">Continue</span><span class="p">(</span><span class="s">@"c:\temp\"</span> <span class="p">+</span> <span class="n">downloadItem</span><span class="p">.</span><span class="n">SuggestedFileName</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="133-ondownloadupdatedの実装" class="fragment"></span><a href="#133-ondownloadupdated%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>13.3 OnDownloadUpdatedの実装</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadHandler_OnDownloadUpdated.htm" rel="nofollow noopener" target="_blank">OnDownloadUpdated</a>メソッドはダウンロードが開始すると最初に呼び出され、その後ダウンロードの進捗に合わせて繰り返し呼び出されます。<br>
このメソッドでは、ダウンロードのキャンセル・中断・再開ができます。<br>
また、ダウンロードの進捗率が通知されるので、ユーザに進捗状況を表示する処理も実装可能です。</p>

<ul>
<li>ダウンロードを継続する場合<br>
特に何もしなければ、ダウンロードが継続されます。</li>
<li>ダウンロードをキャンセルする場合<br>
引数で指定される<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IDownloadItemCallback.htm" rel="nofollow noopener" target="_blank">IDownloadItemCallback</a>インタフェースの<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadItemCallback_Cancel.htm" rel="nofollow noopener" target="_blank">Cancel</a>メソッドを呼び出します。なお、ダウンロード処理はバックグラウンドで継続しているので、一度キャンセルを行っても即座に中断されずに何度かOnDownloadUpdatedメソッドが呼び出される場合があるので注意が必要です。</li>
<li>ダウンロードを中断する場合<br>
引数で指定される<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IDownloadItemCallback.htm" rel="nofollow noopener" target="_blank">IDownloadItemCallback</a>インタフェースの<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadItemCallback_Pause.htm" rel="nofollow noopener" target="_blank">Pause</a>メソッドを呼び出します。</li>
<li>ダウンロードを再開する場合<br>
引数で指定される<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IDownloadItemCallback.htm" rel="nofollow noopener" target="_blank">IDownloadItemCallback</a>インタフェースの<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadItemCallback_Resume.htm" rel="nofollow noopener" target="_blank">Resume</a>メソッドを呼び出します。</li>
</ul>

<p>ここでは、キャンセルも中断も行わないため、特に何も実装しません。</p>

<h2>
<span id="134-idownloadhandlerの指定" class="fragment"></span><a href="#134-idownloadhandler%E3%81%AE%E6%8C%87%E5%AE%9A"><i class="fa fa-link"></i></a>13.4 IDownloadHandlerの指定</h2>

<p>最後に<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_WinForms_ChromiumWebBrowser_DownloadHandler.htm" rel="nofollow noopener" target="_blank">ChromiumWebBrowser.DownloadHandler</a>プロパティに、実装した<a href="https://cefsharp.github.io/api/85.3.x/html/Methods_T_CefSharp_IDownloadHandler.htm" rel="nofollow noopener" target="_blank">IDownloadHandler</a>インタフェースを設定することで、CefSharpがこのインタフェースを呼び出すようになります。</p>

<p>具体的には、以下の様に指定します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ChromiumWebBrowserにIDownloadHandlerを設定</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="nf">SimpleBrowserFrame</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// (省略)</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">DownloadHandler</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Handlers</span><span class="p">.</span><span class="nf">DownloadHandler</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="135-ダウンロード処理の確認" class="fragment"></span><a href="#135-%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E5%87%A6%E7%90%86%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>13.5 ダウンロード処理の確認</h2>

<p>例えば<a href="https://nodejs.org/en/" rel="nofollow noopener" target="_blank">https://nodejs.org/en/</a>にアクセスして、node.jsのインストーラをダウンロードしてみましょう。<br>
正しく実装できていると「Save File」ダイアログが表示され、保存ボタンをクリックすると、指定した場所にファイルが保存されることが確認できます。</p>

<h1>
<span id="14-faviconの表示" class="fragment"></span><a href="#14-favicon%E3%81%AE%E8%A1%A8%E7%A4%BA"><i class="fa fa-link"></i></a>14. faviconの表示</h1>

<p>faviconはHTMLで指定されているサイトのアイコンです。<br>
ここでは、faviconの表示方法を説明します。</p>

<h2>
<span id="141-faviconの仕様" class="fragment"></span><a href="#141-favicon%E3%81%AE%E4%BB%95%E6%A7%98"><i class="fa fa-link"></i></a>14.1 faviconの仕様</h2>

<p>faviconの仕様は少しゆるい仕様で、faviconの表示を厳密に実装するのは少し大変です。  </p>

<p>指定できるイメージの形式は、<a href="https://www.w3.org/2005/10/howto-favicon" rel="nofollow noopener" target="_blank">W3C</a>ではPNG、GIF、ICOのいずれかとしていますが、実際にはJPEGやSVGもサポートしているブラウザも多いです。また、<code>type</code>属性でのファイルタイプの指定は強制ではないため、<code>type</code>属性を指定していないサイトも多くあります。また、複数のfaviconを設定することもできます。</p>

<p>以下はHTMLでのfaviconの指定例です。</p>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">HTMLでのfaviconの指定例</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c">&lt;!-- イメージの型を指定しない --&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"shortcut icon"</span> <span class="na">href=</span><span class="s">"https://example.com/myicon.ico"</span><span class="nt">&gt;</span>

<span class="c">&lt;!-- イメージの型を指定する --&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"icon"</span> <span class="na">type=</span><span class="s">"image/gif"</span> <span class="na">href=</span><span class="s">"https://example.com/image.gif"</span><span class="nt">&gt;</span>
</code></pre></div>
</div>

<p>以上の様にfaviconを扱うのは少し面倒ですが、ここでは以下の方針とします。</p>

<ul>
<li>どのファイルタイプまでサポートするのか？<br>
PNG、GIF、ICOをサポートする様にします。</li>
<li>イメージ形式か分からない場合に、どのように表示するのか？<br>
イメージの形式を判断するために、サーバが指定するMimeTypeをを使用するようにします。<br>
なお、<code>type</code>属性が指定されていても、CefSharpではその属性値を受け取ることができません。<br>
</li>
</ul>

<h2>
<span id="142-faviconの表示処理を追加" class="fragment"></span><a href="#142-favicon%E3%81%AE%E8%A1%A8%E7%A4%BA%E5%87%A6%E7%90%86%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>14.2 faviconの表示処理を追加</h2>

<p>まず、フォームのアイコンをfaviconに変更する処理を追加します。<br>
以下の様にfaviconファイルのパスとMimeTypeを引数に持つメソッドを追加して、指定されたファイルパスのfaviconをフォームのアイコンとして表示します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">favicon更新処理の例</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">SimpleBrowserFrame</span> <span class="p">:</span> <span class="n">Form</span>
<span class="p">{</span>
    <span class="c1">// (省略)</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">updateFavicon</span><span class="p">(</span><span class="n">String</span> <span class="n">path</span><span class="p">,</span> <span class="n">String</span> <span class="n">mimeType</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="c1">// MIME-Typeに応じて、Iconオブジェクトを作成する。</span>
            <span class="n">Icon</span> <span class="n">icon</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">mimeType</span><span class="p">.</span><span class="nf">ToLower</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="c1">// pngとgifの場合</span>
                <span class="k">case</span> <span class="s">"image/png"</span><span class="p">:</span>
                <span class="k">case</span> <span class="s">"image/gif"</span><span class="p">:</span>
                    <span class="n">Bitmap</span> <span class="n">bitmap</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Bitmap</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nf">FromFile</span><span class="p">(</span><span class="n">path</span><span class="p">));</span>
                    <span class="n">icon</span> <span class="p">=</span> <span class="n">Icon</span><span class="p">.</span><span class="nf">FromHandle</span><span class="p">(</span><span class="n">bitmap</span><span class="p">.</span><span class="nf">GetHicon</span><span class="p">());</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="c1">// iconの場合</span>
                <span class="k">case</span> <span class="s">"image/vnd.microsoft.icon"</span><span class="p">:</span>
                <span class="k">case</span> <span class="s">"image/x-icon"</span><span class="p">:</span>
                    <span class="n">icon</span> <span class="p">=</span> <span class="n">Icon</span><span class="p">.</span><span class="nf">ExtractAssociatedIcon</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">default</span><span class="p">:</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// ファビコンを表示する</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">icon</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="n">Icon</span> <span class="p">=</span> <span class="n">icon</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// FVICONファイルを削除する。</span>
            <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">File</span><span class="p">.</span><span class="nf">Delete</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span>
        <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// (省略)</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="143-faviconのダウンロード" class="fragment"></span><a href="#143-favicon%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>14.3 faviconのダウンロード</h2>

<p>CefSharpではfaviconが変わるタイミングで、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnFaviconUrlChange.htm" rel="nofollow noopener" target="_blank">IDisplayHandler.OnFaviconUrlChange</a>メソッドが呼び出されます。<br>
しかし、faviconの取得はアプリ開発者に任されています。<br>
faviconを取得するには、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IBrowserHost_StartDownload.htm" rel="nofollow noopener" target="_blank">IBrowserHost.StartDownload</a>メソッドでダウンロードします。<br>
※このメソッドを使うと任意のファイルをダウンロードすることができます。</p>

<p>ダウンロードが行われると、「<a href="#13-%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89">13. ダウンロード</a>」で説明したように、<a href="https://cefsharp.github.io/api/85.3.x/html/Methods_T_CefSharp_IDownloadHandler.htm" rel="nofollow noopener" target="_blank">IDownloadHandler</a>インタフェースのメソッドが呼び出されることになります。<br>
このインタフェースはユーザがファイルのダウンロードを行う際にも呼び出されるため、ユーザがダウンロードしたファイルなのか、faviconとしてプログラムでダウンロードしたものなのかを判断する必要がでてきます。<br>
このため、ダウンロード中のfaviconを管理するリストをもうけます。</p>

<h3>
<span id="ダウンロード中のfaviconのリストを作成" class="fragment"></span><a href="#%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E4%B8%AD%E3%81%AEfavicon%E3%81%AE%E3%83%AA%E3%82%B9%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>ダウンロード中のfaviconのリストを作成</h3>

<p>ダウンロード中のfaviconを管理するリストを以下の様に作成します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ダウンロード中のfaviconのリスト</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">SimpleBrowserFrame</span> <span class="p">:</span> <span class="n">Form</span>
<span class="p">{</span>
    <span class="c1">// (省略)</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// ダウンロード中のfaviconのリスト</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;</span> <span class="n">Favicons</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>

    <span class="c1">// (省略)</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h3>
<span id="faviconをダウンロードする" class="fragment"></span><a href="#favicon%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>faviconをダウンロードする</h3>

<p>ダウンロードする前にダウンロード中のfaviconリストにfaviconのURLを追加して、その後faviconをダウンロードします。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">OnFaviconUrlChangeメソッドの実装</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">OnFaviconUrlChange</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IList</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">urls</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// コントロールのトップレベルのコントロールを取得（SimpleBrowserFrame）</span>
    <span class="n">SimpleBrowserFrame</span> <span class="n">mainFrame</span> <span class="p">=</span> <span class="n">SimpleBrowserFrame</span><span class="p">.</span><span class="nf">getMainFrame</span><span class="p">(</span><span class="n">browser</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mainFrame</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ロード中のFaviconを登録する</span>
        <span class="n">mainFrame</span><span class="p">.</span><span class="n">Favicons</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">urls</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>

        <span class="c1">// Faviconをロードする。</span>
        <span class="n">browser</span><span class="p">.</span><span class="nf">GetHost</span><span class="p">().</span><span class="nf">StartDownload</span><span class="p">(</span><span class="n">urls</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="144-onbeforedownloadの変更" class="fragment"></span><a href="#144-onbeforedownload%E3%81%AE%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>14.4 OnBeforeDownloadの変更</h2>

<p>「<a href="#13-%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89">13. ダウンロード</a>」で実装した<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadHandler_OnBeforeDownload.htm" rel="nofollow noopener" target="_blank">OnBeforeDownload</a>メソッドを、適当なパスにfaviconを自動保存するように変更します。</p>

<p>以下の様に、ダウンロードしている対象のURLがダウンロード中のfaviconのリストに含まれている場合は、ランダムなファイル名で保存するように変更します。それ以外のURLの場合は、これまで通りファイル保存ダイアログを表示して、保存場所をユーザに問い合わせるようにします。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">OnBeforeDownloadの実装</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">void</span> <span class="n">IDownloadHandler</span><span class="p">.</span><span class="nf">OnBeforeDownload</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">DownloadItem</span> <span class="n">downloadItem</span><span class="p">,</span> <span class="n">IBeforeDownloadCallback</span> <span class="n">callback</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// コントロールのトップレベルのコントロールを取得（SimpleBrowserFrame）</span>
    <span class="n">SimpleBrowserFrame</span> <span class="n">mainFrame</span> <span class="p">=</span> <span class="n">SimpleBrowserFrame</span><span class="p">.</span><span class="nf">getMainFrame</span><span class="p">(</span><span class="n">browser</span><span class="p">);</span>

    <span class="c1">// faviconの場合は、ランダムなファイル名で保存</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mainFrame</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">mainFrame</span><span class="p">.</span><span class="n">Favicons</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">downloadItem</span><span class="p">.</span><span class="n">Url</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">callback</span><span class="p">.</span><span class="nf">Continue</span><span class="p">(</span><span class="s">$"c:\\temp\\</span><span class="p">{</span><span class="n">Path</span><span class="p">.</span><span class="nf">GetRandomFileName</span><span class="p">()}</span><span class="s">"</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// それ以外の場合は、ファイル保存ダイアログを表示して保存する。</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">callback</span><span class="p">.</span><span class="nf">Continue</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="145-ondownloadupdatedの変更" class="fragment"></span><a href="#145-ondownloadupdated%E3%81%AE%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>14.5 OnDownloadUpdatedの変更</h2>

<p>「<a href="#13-%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89">13. ダウンロード</a>」で実装した<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadHandler_OnDownloadUpdated.htm" rel="nofollow noopener" target="_blank">OnDownloadUpdated</a>メソッドで、faviconのダウンロードが完了した時にフォームのアイコンを変更するように変更します。</p>

<p>以下の様に、ファイルのダウンロードが完了した場合で、且つダウンロードした対象がfaviconの場合に、フォームのアイコンを更新するようにします。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">OnDownloadUpdatedの実装</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">void</span> <span class="n">IDownloadHandler</span><span class="p">.</span><span class="nf">OnDownloadUpdated</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">DownloadItem</span> <span class="n">downloadItem</span><span class="p">,</span> <span class="n">IDownloadItemCallback</span> <span class="n">callback</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ダウンロードが完了した場合</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">downloadItem</span><span class="p">.</span><span class="n">IsComplete</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// コントロールのトップレベルのコントロールを取得（SimpleBrowserFrame）</span>
        <span class="n">SimpleBrowserFrame</span> <span class="n">mainFrame</span> <span class="p">=</span> <span class="n">SimpleBrowserFrame</span><span class="p">.</span><span class="nf">getMainFrame</span><span class="p">(</span><span class="n">browser</span><span class="p">);</span>

        <span class="c1">// faviconの場合</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mainFrame</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">mainFrame</span><span class="p">.</span><span class="n">Favicons</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">downloadItem</span><span class="p">.</span><span class="n">Url</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// ロード中のfaviconファイルのリストから取り除く</span>
            <span class="n">mainFrame</span><span class="p">.</span><span class="n">Favicons</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">downloadItem</span><span class="p">.</span><span class="n">Url</span><span class="p">);</span>

            <span class="c1">// フォームのアイコンを更新する。</span>
            <span class="n">mainFrame</span><span class="p">.</span><span class="nf">BeginInvoke</span><span class="p">(</span><span class="k">new</span> <span class="nf">Action</span><span class="p">(()</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">mainFrame</span><span class="p">.</span><span class="nf">updateFavicon</span><span class="p">(</span><span class="n">downloadItem</span><span class="p">.</span><span class="n">FullPath</span><span class="p">,</span> <span class="n">downloadItem</span><span class="p">.</span><span class="n">MimeType</span><span class="p">);</span>
            <span class="p">}));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="146-faviconの確認" class="fragment"></span><a href="#146-favicon%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>14.6 faviconの確認</h2>

<p>以上でfaviconが表示されるようになったはずです。<br>
<a href="https://camo.qiitausercontent.com/b5bb223cf0f7c4b2aa2d6091e699bcc790702a0d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f32616265626134352d663633632d383033372d323034312d3431653461343361323739382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F2abeba45-f63c-8037-2041-41e4a43a2798.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=42b4f23275ba45de58974181be1ad3f5" alt="favicon.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/2abeba45-f63c-8037-2041-41e4a43a2798.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F2abeba45-f63c-8037-2041-41e4a43a2798.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5d564dc192d1d8fb580830ed3a4dc74c 1x" loading="lazy"></a><br>
おー、faviconが表示されています。</p>

<h1>
<span id="15-pdf表示" class="fragment"></span><a href="#15-pdf%E8%A1%A8%E7%A4%BA"><i class="fa fa-link"></i></a>15. pdf表示</h1>

<p>特に何もコードを書かなくても、pdfをロードすると、chromeのエクステンションによってPDFが表示されます。  </p>

<h1>
<span id="16-特定サイトのブロック" class="fragment"></span><a href="#16-%E7%89%B9%E5%AE%9A%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AE%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>16. 特定サイトのブロック</h1>

<p>特定のサイトのナビゲーションをブロックするには、<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IRequestHandler.htm" rel="nofollow noopener" target="_blank">IRequestHandler</a>インタフェースの<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnBeforeBrowse.htm" rel="nofollow noopener" target="_blank">OnBeforeBrowse</a>メソッドで<code>true</code>を返却するだけです。このメソッドはフレームにURLがロードされることをブロックします。Webサイトの個々のリソース（image、javascript、css、ajaxで取得されるリソース等）のロードを個別にブロックする場合、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_OnBeforeResourceLoad.htm" rel="nofollow noopener" target="_blank">IResourceRequestHandler.OnBeforeResourceLoad</a>メソッドでブロックすることができます。</p>

<p>ここでは、<a href="https://www.yahoo.co.jp/" rel="nofollow noopener" target="_blank">https://www.yahoo.co.jp/</a>へのナビゲーションを禁止してみます。</p>

<h2>
<span id="161-onbeforebrowseメソッドの実装" class="fragment"></span><a href="#161-onbeforebrowse%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>16.1 OnBeforeBrowseメソッドの実装</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnBeforeBrowse.htm" rel="nofollow noopener" target="_blank">OnBeforeBrowse</a>メソッドを実装します。<br>
実装は非常に簡単です。 </p>

<ul>
<li>
<code>true</code>を返却すると、ナビゲーションが中止されます。</li>
<li>
<code>false</code>を返却すると、ナビゲーションが継続します。</li>
</ul>

<p>以下は実装例です。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">OnBeforeBrowseメソッドの実装</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">RequestHandler</span> <span class="p">:</span> <span class="n">IRequestHandler</span>
<span class="p">{</span>
    <span class="c1">// (省略)</span>

    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">OnBeforeBrowse</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">userGesture</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isRedirect</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">Url</span><span class="p">.</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s">"https://www.yahoo.co.jp/"</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// ナビゲーションを中止する</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="c1">// ナビゲーションを許可する</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="162-表示がブロックされるか確認" class="fragment"></span><a href="#162-%E8%A1%A8%E7%A4%BA%E3%81%8C%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%81%95%E3%82%8C%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>16.2 表示がブロックされるか確認</h2>

<p>ビルドしてブラウザを起動して、アドレスバーに<a href="https://www.yahoo.co.jp/" rel="nofollow noopener" target="_blank">https://www.yahoo.co.jp/</a>を入力してみます。<br>
正しく実装できていると、ページがロードされないはずです。</p>

<p>以上、非常に簡単だったと思います。</p>

<h1>
<span id="17-cookie" class="fragment"></span><a href="#17-cookie"><i class="fa fa-link"></i></a>17. Cookie</h1>

<p>Cookieは保存と送信をそれぞれ許可またはブロックすることができます。<br>
ここでは、Cookieの保存と送信の制御の方法を説明します。</p>

<h1>
<span id="171-icookieaccessfilterインタフェースを実装するクラスを追加" class="fragment"></span><a href="#171-icookieaccessfilter%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>17.1 ICookieAccessFilterインタフェースを実装するクラスを追加</h1>

<p>まず、クッキーをコントロールするために、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetCookieAccessFilter.htm" rel="nofollow noopener" target="_blank">ICookieAccessFilter</a>インタフェースを実装するクラスを新たに追加します。<br>
ソリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に<code>CookieAccessFilter</code>を指定します。そして、以下のように<code>ICookieAccessFilter</code>を実装させます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ICookieAccessFilterを実装するクラス</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">CookieAccessFilter</span><span class="p">:</span> <span class="n">ICookieAccessFilter</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>その後、<code>ICookieAccessFilter</code>を選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。すると<code>ICookieAccessFilter</code>インタフェースのメソッドがすべて仮実装されます。</p>

<h1>
<span id="172-cansavecookieメソッドの実装" class="fragment"></span><a href="#172-cansavecookie%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>17.2 CanSaveCookieメソッドの実装</h1>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ICookieAccessFilter_CanSaveCookie.htm" rel="nofollow noopener" target="_blank">CanSaveCookie</a>メソッドは、レスポンスヘッダに<code>Set-Cookie</code>が設定されている場合に、cookieを保存するかどうかを判断するためにリソース毎に呼び出されます。<br>
このメソッドではcookieを受け入れるかどうかを返却値で決定します。</p>

<ul>
<li>
<code>true</code>を返却すると、cookieが保存されます。</li>
<li>
<code>false</code>を返却すると、cookieが保存されません。<br>
</li>
</ul>

<p>ここでは、すべてのサイトでCookieを保存しないようにしてみます。  </p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">CanSaveCookieメソッドの実装</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">bool</span> <span class="n">ICookieAccessFilter</span><span class="p">.</span><span class="nf">CanSaveCookie</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">,</span> <span class="n">IResponse</span> <span class="n">response</span><span class="p">,</span> <span class="n">Cookie</span> <span class="n">cookie</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// cookieを保存しないようにする。</span>
    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h1>
<span id="173-cansendcookieメソッドの実装" class="fragment"></span><a href="#173-cansendcookie%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>17.3 CanSendCookieメソッドの実装</h1>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ICookieAccessFilter_CanSendCookie.htm" rel="nofollow noopener" target="_blank">CanSendCookie</a>メソッドは、リソース毎にリクエストヘッダに<code>Cookie</code>を設定するかどうか判断するために呼び出されます。<br>
このメソッドではcookieを送信するかどうかを返却値で決定します。</p>

<ul>
<li>
<code>true</code>を返却すると、cookieが送信されます。</li>
<li>
<code>false</code>を返却すると、cookieが送信されません。<br>
</li>
</ul>

<p>ここでは、すべてのサイトでCookieを送信しないようにしてみます。  </p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">CanSendCookieメソッドの実装</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">bool</span> <span class="n">ICookieAccessFilter</span><span class="p">.</span><span class="nf">CanSendCookie</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">,</span> <span class="n">Cookie</span> <span class="n">cookie</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// cookieを送信しないようにする。</span>
    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h1>
<span id="173-iresourcerequesthandlerインタフェースを実装するクラスの追加" class="fragment"></span><a href="#173-iresourcerequesthandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>17.3 IResourceRequestHandlerインタフェースを実装するクラスの追加</h1>

<p>先ほど作成した<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetCookieAccessFilter.htm" rel="nofollow noopener" target="_blank">ICookieAccessFilter</a>インタフェースを実装したクラスを利用するために、<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IResourceRequestHandler.htm" rel="nofollow noopener" target="_blank">IResourceRequestHandler</a>インタフェースを実装するクラスが必要になります。以下の流れで新しいクラスを追加します。</p>

<p>ソリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に<code>ResourceRequestHandler</code>を指定します。そして、以下のように<code>IResourceRequestHandler</code>を実装させます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IResourceRequestHandlerを実装するクラス</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">ResourceRequestHandler</span> <span class="p">:</span> <span class="n">IResourceRequestHandler</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>その後、<code>IResourceRequestHandler</code>を選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。すると<code>IResourceRequestHandler</code>インタフェースのメソッドがすべて仮実装されます。</p>

<h1>
<span id="174-iresourcerequesthandlerインタフェースのメソッドを仮実装" class="fragment"></span><a href="#174-iresourcerequesthandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BB%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>17.4 IResourceRequestHandlerインタフェースのメソッドを仮実装</h1>

<ul>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetCookieAccessFilter.htm" rel="nofollow noopener" target="_blank">GetCookieAccessFilter</a><br>
独自のCookieの制御を行う場合は<code>ICookieAccessFilter</code>を返却します。<br>
今回はCookieを制御するため、先程作成した<code>CookieAccessFilter</code>クラスのインスタンスを返却するようにします。</p></li>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetResourceHandler.htm" rel="nofollow noopener" target="_blank">GetResourceHandler</a><br>
独自のリソースハンドラを返却します。<br>
ここでは独自のリソースハンドラは実装しないため<code>null</code>を返却します。</p></li>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetResourceResponseFilter.htm" rel="nofollow noopener" target="_blank">GetResourceResponseFilter</a><br>
独自のリソースフィルタを返却します。<br>
リソースフィルタはサーバからのレスポンスを変更するための機能で非常に便利です。<br>
ここでは独自のリソースフィルタを実装しないため<code>null</code>を返却します。</p></li>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_OnBeforeResourceLoad.htm" rel="nofollow noopener" target="_blank">OnBeforeResourceLoad</a><br>
リソースがロードする前に呼び出されるメソッドです。<br>
リソースのロードをブロックしたい場合は、このメソッドを実装します。<br>
ここではリソースのロードをブロックしないため、<code>CefReturnValue.Continue</code>をリターンします。</p></li>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_OnProtocolExecution.htm" rel="nofollow noopener" target="_blank">OnProtocolExecution</a><br>
不明なプロトコルを持つURLが処理されるときに呼び出されます。<br>
OSで登録されているプロトコルの呼び出しを試みる場合は<code>true</code>を返却します。<br>
ここでは何もしないように<code>false</code>を返却します。</p></li>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_OnResourceLoadComplete.htm" rel="nofollow noopener" target="_blank">OnResourceLoadComplete</a><br>
リソースのロードが完了した時に呼び出されます。<br>
ここでは特に何もしません。</p></li>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_OnResourceRedirect.htm" rel="nofollow noopener" target="_blank">OnResourceRedirect</a><br>
リソースがリダイレクトされるときに呼び出されます。<br>
ここでは特に何もしません。</p></li>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_OnResourceResponse.htm" rel="nofollow noopener" target="_blank">OnResourceResponse</a><br>
リソースのレスポンスを受信したときに呼び出されます。<br>
リソースをリダイレクトさせることができるようですが、この機能は将来廃止されるようです。<br>
ここでは特に処理を行わないため<code>false</code>を返却します。</p></li>
</ul>

<p>以下に実装例を示します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IResourceRequestHandlerインタフェースの実装</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">ResourceRequestHandler</span> <span class="p">:</span> <span class="n">IResourceRequestHandler</span>
    <span class="p">{</span>
        <span class="k">void</span> <span class="n">IDisposable</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">()</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="n">ICookieAccessFilter</span> <span class="n">IResourceRequestHandler</span><span class="p">.</span><span class="nf">GetCookieAccessFilter</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 独自のCookieの制御を行います。</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">CookieAccessFilter</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">IResourceHandler</span> <span class="n">IResourceRequestHandler</span><span class="p">.</span><span class="nf">GetResourceHandler</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">IResponseFilter</span> <span class="n">IResourceRequestHandler</span><span class="p">.</span><span class="nf">GetResourceResponseFilter</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">,</span> <span class="n">IResponse</span> <span class="n">response</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">CefReturnValue</span> <span class="n">IResourceRequestHandler</span><span class="p">.</span><span class="nf">OnBeforeResourceLoad</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">,</span> <span class="n">IRequestCallback</span> <span class="n">callback</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">CefReturnValue</span><span class="p">.</span><span class="n">Continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">bool</span> <span class="n">IResourceRequestHandler</span><span class="p">.</span><span class="nf">OnProtocolExecution</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">void</span> <span class="n">IResourceRequestHandler</span><span class="p">.</span><span class="nf">OnResourceLoadComplete</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">,</span> <span class="n">IResponse</span> <span class="n">response</span><span class="p">,</span> <span class="n">UrlRequestStatus</span> <span class="n">status</span><span class="p">,</span> <span class="kt">long</span> <span class="n">receivedContentLength</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">void</span> <span class="n">IResourceRequestHandler</span><span class="p">.</span><span class="nf">OnResourceRedirect</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">,</span> <span class="n">IResponse</span> <span class="n">response</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">string</span> <span class="n">newUrl</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="kt">bool</span> <span class="n">IResourceRequestHandler</span><span class="p">.</span><span class="nf">OnResourceResponse</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">,</span> <span class="n">IResponse</span> <span class="n">response</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
</div>

<h1>
<span id="175-irequesthandlergetresourcerequesthandlerメソッドを実装" class="fragment"></span><a href="#175-irequesthandlergetresourcerequesthandler%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>17.5 IRequestHandler.GetResourceRequestHandlerメソッドを実装</h1>

<p>作成した<code>IResourceRequestHandler</code>インタフェースを実装したクラスが使われるように、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_GetResourceRequestHandler.htm" rel="nofollow noopener" target="_blank">IRequestHandler.GetResourceRequestHandler</a>メソッドを実装します。</p>

<p>以下の様に、<code>GetResourceRequestHandler</code>メソッドで<code>IResourceRequestHandler</code>インタフェースを返却する様にします。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">GetResourceRequestHandlerメソッドを実装</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">RequestHandler</span> <span class="p">:</span> <span class="n">IRequestHandler</span>
<span class="p">{</span>
    <span class="c1">// (省略)</span>

    <span class="k">public</span> <span class="n">IResourceRequestHandler</span> <span class="nf">GetResourceRequestHandler</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isNavigation</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isDownload</span><span class="p">,</span> <span class="kt">string</span> <span class="n">requestInitiator</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">bool</span> <span class="n">disableDefaultHandling</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 独自のIResourceRequestHandlerを返却する。</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ResourceRequestHandler</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h1>
<span id="176-cookieがブロックされることを確認" class="fragment"></span><a href="#176-cookie%E3%81%8C%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%81%95%E3%82%8C%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>17.6 Cookieがブロックされることを確認</h1>

<p>以上の実装で全てのCookieがブロックされるようになりました。<br>
確認のために、開発者ツールを起動してみます。</p>

<ol>
<li>ブラウザを起動する. </li>
<li>F12キーを押下して開発者ツールを立ち上げる。</li>
<li><p>Applicationを選択して「Clear Site Data」ボタンをクリックして<code>Cookie</code>を削除する。<br>
<a href="https://camo.qiitausercontent.com/a865d5e394818e6a1f0504d6d2d46c2e300db8c2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f31346333616332612d343831382d356437632d663838312d3865626561316663613634612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F14c3ac2a-4818-5d7c-f881-8ebea1fca64a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b9871bc89039193021426090c7e52eb1" alt="Cookie削除.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/14c3ac2a-4818-5d7c-f881-8ebea1fca64a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F14c3ac2a-4818-5d7c-f881-8ebea1fca64a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3ad2898b9c193508e3bd03b1391bbc8a 1x" loading="lazy"></a></p></li>
<li><p>F5でページをリロードする。</p></li>
<li><p>レスポンスを確認する。<br>
開発者ツールのnetworkを選択して、リクエストの内容を確認してみると<code>Cookie</code>がないことが確認できます。<br>
つまり、<code>Cookie</code>は送信されていません。<br>
<a href="https://camo.qiitausercontent.com/9db26007649abebd41671c164a2760fc28b75050/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f38663738373566362d383564652d383030302d326266372d6438303538633735343130302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F8f7875f6-85de-8000-2bf7-d8058c754100.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7ec53d25487c4aada3a630d8bdd78144" alt="response1.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/8f7875f6-85de-8000-2bf7-d8058c754100.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F8f7875f6-85de-8000-2bf7-d8058c754100.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=fccaaf855793a15375563a23eccd1aae 1x" loading="lazy"></a></p></li>
<li><p>Cookieを確認する。<br>
ApplicationのCookieを選択すると、以下の様にCookieが保存されていないことが確認できます。<br>
つまり、<code>Cookie</code>は保存されていません。<br>
<a href="https://camo.qiitausercontent.com/356fcc15a6db53e8f61660ec976de8eb64c43635/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f63386565353262632d326434392d323261392d396362302d3564643465323466656236302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fc8ee52bc-2d49-22a9-9cb0-5dd4e24feb60.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3860b82e58e660300ada8a2bcbb73938" alt="cookie.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/c8ee52bc-2d49-22a9-9cb0-5dd4e24feb60.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fc8ee52bc-2d49-22a9-9cb0-5dd4e24feb60.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=600e48a1039e21bebd04f9a1b993fb56 1x" loading="lazy"></a></p></li>
</ol>

<p>以上でCookieを保存と送信が制御できることが確認できました。</p>

<h1>
<span id="18-スクリプト実行" class="fragment"></span><a href="#18-%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>18. スクリプト実行</h1>

<p>表示しているWebページで任意のスクリプトを実行することができます。<br>
例えば、ページのロードが完了した時点で、<code>body</code>の背景色を赤色にするスクリプトを実行することができます。<br>
ここでは、まず初めにWebページのロード完了をハンドリングするために、<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILoadHandler.htm" rel="nofollow noopener" target="_blank">ILoadHandler</a>インタフェースを実装します。<br>
次に、ロード完了時にスクリプトを実行して、<code>body</code>の背景色を設定してみます。</p>

<h2>
<span id="181-iloadhandlerを実装するクラスを追加" class="fragment"></span><a href="#181-iloadhandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>18.1 ILoadHandlerを実装するクラスを追加</h2>

<p>まず、<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILoadHandler.htm" rel="nofollow noopener" target="_blank">ILoadHandler</a>インタフェースを実装するクラスを新規に作成します。 <br>
リューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に<code>LoadHandler</code>を指定します。そして、以下のように<code>ILoadHandler</code>インタフェースを実装させます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ILoadHandlerを実装するクラス</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">LoadHandler</span><span class="p">:</span> <span class="n">ILoadHandler</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>その後、<code>ILoadHandler</code>を選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。すると<code>ILoadHandler</code>インタフェースのメソッドがすべて仮実装されます。</p>

<h2>
<span id="182-iloadhandlerのメソッドを仮実装" class="fragment"></span><a href="#182-iloadhandler%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BB%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>18.2 ILoadHandlerのメソッドを仮実装</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILoadHandler.htm" rel="nofollow noopener" target="_blank">ILoadHandler</a>インタフェースの各メソッドを仮実装します。</p>

<ul>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILoadHandler_OnFrameLoadEnd.htm" rel="nofollow noopener" target="_blank">ILoadHandler.OnFrameLoadEnd</a><br>
ブラウザがフレーム(iframeやframeのこと)のロードを終了した時点で呼び出されます。<br>
ここでは特に何もしません。</li>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILoadHandler_OnFrameLoadStart.htm" rel="nofollow noopener" target="_blank">ILoadHandler.OnFrameLoadStart</a><br>
ブラウザがフレーム(iframeやframeのこと)のロードを開始した時点で呼び出されます。<br>
ここでは特に何もしません。</p></li>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILoadHandler_OnLoadError.htm" rel="nofollow noopener" target="_blank">ILoadHandler.OnLoadError</a><br>
ナビゲーションの失敗やキャンセルによりエラーになった時点で呼び出されます。<br>
ここでは特に何もしません。</p></li>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILoadHandler_OnLoadingStateChange.htm" rel="nofollow noopener" target="_blank">ILoadHandler.OnLoadingStateChange</a><br>
ロードの状態が変化した時点で呼び出されます。<br>
以下の「<a href="#183-iloadhandleronloadingstatechange%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85">18.3 ILoadHandler.OnLoadingStateChangeメソッドの実装</a>」で、ドキュメントのロード完了をハンドリングして、スクリプトを実行するようにしていきます。  </p></li>
</ul>

<h2>
<span id="183-iloadhandleronloadingstatechangeメソッドの実装" class="fragment"></span><a href="#183-iloadhandleronloadingstatechange%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>18.3 ILoadHandler.OnLoadingStateChangeメソッドの実装</h2>

<p>引数で渡される<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_LoadingStateChangedEventArgs.htm" rel="nofollow noopener" target="_blank">LoadingStateChangedEventArgs</a>の<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_LoadingStateChangedEventArgs_IsLoading.htm" rel="nofollow noopener" target="_blank">IsLoading</a>プロパティを参照することでロードが完了したかどうかを判断することができます。そして、ロードが完了していれば、スクリプトを実行することにします。<br>
スクリプトを実行するためには、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IFrame_EvaluateScriptAsync.htm" rel="nofollow noopener" target="_blank">IFrame.EvaluateScriptAsync</a>を呼び出します。</p>

<p>以下は実装例です。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">OnLoadingStateChangeメソッドでスクリプトを実行する例</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">LoadHandler</span> <span class="p">:</span> <span class="n">ILoadHandler</span>
    <span class="p">{</span>
        <span class="k">void</span> <span class="n">ILoadHandler</span><span class="p">.</span><span class="nf">OnFrameLoadEnd</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">FrameLoadEndEventArgs</span> <span class="n">frameLoadEndArgs</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">void</span> <span class="n">ILoadHandler</span><span class="p">.</span><span class="nf">OnFrameLoadStart</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">FrameLoadStartEventArgs</span> <span class="n">frameLoadStartArgs</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">void</span> <span class="n">ILoadHandler</span><span class="p">.</span><span class="nf">OnLoadError</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">LoadErrorEventArgs</span> <span class="n">loadErrorArgs</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">void</span> <span class="n">ILoadHandler</span><span class="p">.</span><span class="nf">OnLoadingStateChange</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">LoadingStateChangedEventArgs</span> <span class="n">loadingStateChangedArgs</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// ロードが完了した場合</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">loadingStateChangedArgs</span><span class="p">.</span><span class="n">IsLoading</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// Javascriptを実行する。</span>
                <span class="n">loadingStateChangedArgs</span><span class="p">.</span><span class="n">Browser</span><span class="p">.</span><span class="n">MainFrame</span><span class="p">.</span><span class="nf">EvaluateScriptAsync</span><span class="p">(</span><span class="s">@"document.body.setAttribute('style', 'background-color:red;')"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
</div>

<h2>
<span id="184-iloadhandlerの指定" class="fragment"></span><a href="#184-iloadhandler%E3%81%AE%E6%8C%87%E5%AE%9A"><i class="fa fa-link"></i></a>18.4 ILoadHandlerの指定</h2>

<p>最後に<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_WinForms_ChromiumWebBrowser_LoadHandler.htm" rel="nofollow noopener" target="_blank">ChromiumWebBrowser.LoadHandler</a>プロパティに、実装した<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILoadHandler.htm" rel="nofollow noopener" target="_blank">ILoadHandler</a>インタフェースを設定することで、CefSharpがこのインタフェースを呼び出すようになります。</p>

<p>具体的には、以下の様に指定します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ChromiumWebBrowserにILoadHandlerインタフェースを設定</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="nf">SimpleBrowserFrame</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// (省略)</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">LoadHandler</span><span class="p">=</span> <span class="k">new</span> <span class="n">Handlers</span><span class="p">.</span><span class="nf">LoadHandler</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="185-スクリプト実行の確認" class="fragment"></span><a href="#185-%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E5%AE%9F%E8%A1%8C%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>18.5 スクリプト実行の確認</h2>

<p>ビルドして実行してみます。<br>
正しく実装できるていると、以下の様に<code>body</code>の背景色が赤色になっているはずです。<br>
<a href="https://camo.qiitausercontent.com/885507e34fef90a1293f8cdc74873b7cf9b4d226/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f62636132313762632d373063622d626561362d396639632d3039316264363339313036632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fbca217bc-70cb-bea6-9f9c-091bd639106c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1ecfc123314ae7042b39e644d5884255" alt="スクリプト実行.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/bca217bc-70cb-bea6-9f9c-091bd639106c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fbca217bc-70cb-bea6-9f9c-091bd639106c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1897f70bca0df5dbd7d473d139b19dec 1x" loading="lazy"></a></p>

<h2>
<span id="186-スクリプトの実行して結果を受け取る" class="fragment"></span><a href="#186-%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E7%B5%90%E6%9E%9C%E3%82%92%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8B"><i class="fa fa-link"></i></a>18.6 スクリプトの実行して結果を受け取る</h2>

<p>先ほどの例では<code>body</code>の背景色を変更するスクリプトを実行するだけですが、Webページでスクリプトを実行して、その結果を受け取ることもできます。例えば、Webページのタイトル文字列を取得するスクリプトを実行する場合は以下の様に書きます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">スクリプトを実行して結果を受け取る方法</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">loadingStateChangedArgs</span><span class="p">.</span><span class="n">Browser</span><span class="p">.</span><span class="n">MainFrame</span><span class="p">.</span><span class="nf">EvaluateScriptAsync</span><span class="p">(</span><span class="s">@"(()=&gt;{return document.title;})();"</span><span class="p">).</span><span class="nf">ContinueWith</span><span class="p">((</span><span class="n">reponse</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">String</span> <span class="n">title</span> <span class="p">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="n">reponse</span><span class="p">.</span><span class="n">Result</span><span class="p">.</span><span class="n">Result</span><span class="p">;</span>
  <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">$"document.title = </span><span class="p">{</span><span class="n">title</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
<span class="p">});</span>

</code></pre></div>
</div>

<h1>
<span id="19-独自オブジェクトの公開" class="fragment"></span><a href="#19-%E7%8B%AC%E8%87%AA%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E5%85%AC%E9%96%8B"><i class="fa fa-link"></i></a>19. 独自オブジェクトの公開</h1>

<p>任意のクラスを作成してjavascriptから呼び出せるようにできます。 <br>
ここでは、任意のコマンドを実行するクラスを作成して、javascriptから呼び出せるようにしてみます。</p>

<h2>
<span id="191-公開するクラスの作成" class="fragment"></span><a href="#191-%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>19.1 公開するクラスの作成</h2>

<p>任意のクラスを公開することができますが、以下の注意が必要です。</p>

<ul>
<li>公開されるすべてのメソッドはPromiseを返すメソッドとしてjavascriptに公開されます。<br>
つまり、javascript側から呼び出されると、即座にPromiseが返却されて、メソッドの実行結果をfullfill時に受け取ることになります。</li>
<li>メソッドを実行するスレッドは一つだけ。<br>
時間のかかる処理を行っても構いませんが、独自オブジェクトのメソッドを実行するスレッドは１つだけなので、javascript側から複数回呼びされると、キューイングされて実行されることになります。この場合でもjavascript側には呼び出すとすぐにPromiseが返却されます。
したがって、時間のかかる処理を行う場合は、明示的に別スレッドで実行して、次に示すコールバックを呼び出す方法をお勧めします。</li>
<li>マーシャリングの仕様が明確でない。<br>
<code>int</code>や<code>String</code>ようなprimitve型を引数として渡すのは問題ありません。<br>
<code>int[]</code>のようなprimitve型の配列を返却する場合も問題なく動作します。<br>
しかし、<code>int[]</code>を引数で受け受け取ろうとするとうまく受け取れません。<br>
このため原則的にprimitive型だけを使う様にするべきです。</li>
<li>非完了型の場合はコールバックを利用する。<br>
C#のクラスのメソッドは、javascript側が指定するコールバックを、<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IJavascriptCallback.htm" rel="nofollow noopener" target="_blank">IJavascriptCallback</a>型の引数で受け取ることができます。<br>
時間のかかる非完了処理では、完了時のこのコールバックを呼び出す方法が良いです。</li>
</ul>

<p>callback無しですぐに完了するメソッドと完了時にcallbackを呼び出すメソッドの例を以下に示します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">javascriptに公開するオブジェクト</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Diagnostics</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Test</span>
    <span class="p">{</span>
        <span class="c1">// callbackを使わない例</span>
        <span class="k">public</span> <span class="n">String</span> <span class="nf">exec</span><span class="p">(</span><span class="n">String</span> <span class="n">exePath</span><span class="p">,</span> <span class="n">String</span> <span class="n">arguments</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// プロセスを起動する</span>
            <span class="n">Process</span> <span class="n">ps</span> <span class="p">=</span> <span class="n">Process</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="n">exePath</span><span class="p">,</span> <span class="n">arguments</span><span class="p">);</span>
            <span class="c1">// 文字列を返却する。</span>
            <span class="k">return</span> <span class="s">"Hello!"</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// javascript側のcallbackを呼び出す例</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">wait</span><span class="p">(</span><span class="kt">int</span> <span class="n">millisecond</span><span class="p">,</span> <span class="n">IJavascriptCallback</span> <span class="n">callback</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 別スレッドで処理を実行する。</span>
            <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="n">millisecond</span><span class="p">).</span><span class="nf">ContinueWith</span><span class="p">((</span><span class="n">o</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="c1">// callbackメソッドが呼び出せるか必ず確認する</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">callback</span><span class="p">.</span><span class="n">CanExecute</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// コールバックを呼び出す。</span>
                    <span class="c1">// c＃-&gt;javascriptはint配列のマーシャリングがうまく動作する</span>
                    <span class="n">callback</span><span class="p">.</span><span class="nf">ExecuteAsync</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">5</span><span class="p">]</span> <span class="p">{</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span> <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="192-作成したクラスのインスタンスを公開する" class="fragment"></span><a href="#192-%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%82%92%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>19.2 作成したクラスのインスタンスを公開する</h2>

<p>作成した独自クラスのインスタンスをjavascriptから利用できるように公開します。<br>
これには、<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IWebBrowser.htm" rel="nofollow noopener" target="_blank">IWebBrowser </a>インタフェースの<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_IWebBrowser_JavascriptObjectRepository.htm" rel="nofollow noopener" target="_blank">JavascriptObjectRepository</a>プロパティで公開されている<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IJavascriptObjectRepository.htm" rel="nofollow noopener" target="_blank">IJavascriptObjectRepository</a>インタフェースの<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IJavascriptObjectRepository_Register.htm" rel="nofollow noopener" target="_blank">Registe</a>メソッドを呼び出します。<br>
<code>IWebBrowser</code>に対して操作していますが、ここで登録した独自オブジェクトは、子ウィンドウでも参照可能になります。</p>

<ul>
<li>第一引数はjavascript側に公開するオブジェクト名前(大文字小文字が区別されるので注意)</li>
<li>第二引数は公開するオブジェト（ChromiumWebBrowser単位で１つのオブジェクトであることに注意）</li>
<li>第三引数は非同期にするかどうかであるが、ブロッキングされないように、非同期型にすることをお勧めします。</li>
</ul>

<p>以下の例では<code>Test</code>という名称で、先ほどのTestクラスのオブジェクトを公開しています。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">独自オブジェクトの公開</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="nf">SimpleBrowserFrame</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">InitializeComponent</span><span class="p">();</span>
    <span class="n">WebBrowser</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ChromiumWebBrowser</span><span class="p">(</span><span class="s">"https://www.google.co.jp"</span><span class="p">);</span>

    <span class="c1">// (省略)</span>

    <span class="c1">// 独自オブジェクトをTestという名称で公開する</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">JavascriptObjectRepository</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="s">"Test"</span><span class="p">,</span> <span class="k">new</span> <span class="n">SimpleBrowser</span><span class="p">.</span><span class="nf">Test</span><span class="p">(),</span> <span class="k">true</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="193-公開されたオブジェクトを使用する" class="fragment"></span><a href="#193-%E5%85%AC%E9%96%8B%E3%81%95%E3%82%8C%E3%81%9F%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>19.3 公開されたオブジェクトを使用する</h2>

<p>javascriptでは、<code>CefSharp.BindObjectAsync</code>メソッドを呼び出すことで、公開されたオブジェクトが使えるようになります。<br><br>
このメソッドは非同期型(Promiseを返却する)ですので、完了を待つ必要があります。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">公開されたオブジェクトをjavascriptから参照可能にする方法</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nx">CefSharp</span><span class="p">.</span><span class="nx">BindObjectAsync</span><span class="p">(</span><span class="dl">"</span><span class="s2">Test</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div>
</div>

<h2>
<span id="194-確認してみる" class="fragment"></span><a href="#194-%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>19.4 確認してみる</h2>

<p>ビルド＆実行して、F12キーで開発者ツールを起動します。<br>
次にコンソールを選択して、以下を入力して実行します。<br>
これで、Testオブジェクトが参照可能になります。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">公開されたオブジェクトをjavascriptから参照可能にする方法</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nx">CefSharp</span><span class="p">.</span><span class="nx">BindObjectAsync</span><span class="p">(</span><span class="dl">"</span><span class="s2">Test</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div>
</div>

<p>続いて、以下をコンソールに入力して実行します。<br>
すると、電卓が起動することが確認できます。  </p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">公開されたオブジェクトのメソッドを実行</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nx">Test</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="dl">"</span><span class="s2">calc.exe</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div>
</div>

<p>続いて、callbackの確認として、以下をコンソールに入力して実行します。<br>
すると、10秒後にコンソールにint型の配列が出力されます。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">公開されたオブジェクトのメソッド(callbackあり)を実行</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nx">Test</span><span class="p">.</span><span class="nx">wait</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="p">(</span><span class="nx">ret</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ret</span><span class="p">);});</span>
</code></pre></div>
</div>

<p>このようにC#のオブジェクトをjavascriptに公開する機能は、CefSharpの非常に便利な機能です。</p>

<h1>
<span id="20-レスポンス内容の変更" class="fragment"></span><a href="#20-%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E5%86%85%E5%AE%B9%E3%81%AE%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>20. レスポンス内容の変更</h1>

<p>CefSharpではHTTPのレスポンス内容をカスタマイズすることができます。<br>
※レスポンスヘッダは変更することはできません。<br>
この機能を使うことで、任意のスクリプトをレスポンスに埋め込むことなどができます。</p>

<p>CefSharpは<strong><em>1つのリソースを受信する毎に</em></strong><a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IResourceRequestHandler.htm" rel="nofollow noopener" target="_blank">IResourceRequestHandler</a>インタフェースの<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetResourceResponseFilter.htm" rel="nofollow noopener" target="_blank">GetResourceResponseFilter</a>メソッドを呼び出します。レスポンス内容のカスタマイズが必要な場合には、<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IResponseFilter.htm" rel="nofollow noopener" target="_blank">IResponseFilter</a>インタフェースを返却するようにします。<br>
そして、返却した<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IResponseFilter.htm" rel="nofollow noopener" target="_blank">IResponseFilter</a>でレスポンスの内容を変更します。</p>

<h2>
<span id="201-iresponsefilterを実装するクラスを追加" class="fragment"></span><a href="#201-iresponsefilter%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>20.1 IResponseFilterを実装するクラスを追加</h2>

<p>まず、<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IResponseFilter.htm" rel="nofollow noopener" target="_blank">IResponseFilter</a>インタフェースを実装するクラスを新規に作成します。 <br>
ソリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に<code>ResponseFilter</code>を指定します。そして、以下のように<code>IResponseFilter</code>を実装させます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IResponseFilterを実装するクラス</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">ResponseFilter</span><span class="p">:</span> <span class="n">IResponseFilter</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>その後、<code>IResponseFilter</code>を選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。すると<code>IResponseFilter</code>インタフェースのメソッドがすべて仮実装されます。</p>

<h2>
<span id="202-iresponsefilterのメソッドを実装" class="fragment"></span><a href="#202-iresponsefilter%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>20.2 IResponseFilterのメソッドを実装</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IResponseFilter.htm" rel="nofollow noopener" target="_blank">IResponseFilter</a>インタフェースの各メソッドを実装します。</p>

<ul>
<li><p>コンストラクタ<br>
コンストラクタは、<code>ResponseFilter</code>のインスタンスを作成するために<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetResourceResponseFilter.htm" rel="nofollow noopener" target="_blank">GetResourceResponseFilter</a>メソッドが呼び出すことになります。このメソッドではレスポンスヘッダを参照することができるため、レスポンスの文字コードを取得することができます。<br>
文字コードは後の処理で使用するために、コンストラクタの引数でを受け取るようにします。  </p></li>
<li>
<p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResponseFilter_Filter.htm" rel="nofollow noopener" target="_blank">Filter</a><br>
このメソッドでレスポンス内容を変更しますが、バイト配列を操作する必要がるため、実装が少し複雑になります。<br>
1つのリソースのレスポンスは分割されて受信する場合があるため、このメソッドは複数回呼び出されることになります。<br>
基本的には、以下の流れになります。</p>

<ol>
<li>第一引数<a href="https://docs.microsoft.com/ja-jp/dotnet/api/system.io.stream?view=netcore-3.1" rel="nofollow noopener" target="_blank">Stream</a>で受けたオリジナルのレスポンス内容を読み取る。</li>
<li>内容を自由に変更する。</li>
<li>第三引数の<a href="https://docs.microsoft.com/ja-jp/dotnet/api/system.io.stream?view=netcore-3.1" rel="nofollow noopener" target="_blank">Stream</a>に変更した内容を書き込む。</li>
<li>変更した内容を書き込む際に第三引数の<code>Stream</code>のサイズが不足する場合は、次回の<code>Filter</code>メソッド呼び出し時に書き込めるように書き込めなかった内容を保存します。</li>
</ol>
</li>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResponseFilter_InitFilter.htm" rel="nofollow noopener" target="_blank">InitFilter</a><br>
<code>IResponseFilter</code>を初期化するために、一回だけ(1つのリソースの処理で一回だけ)呼びだされます。<br>
<code>false</code>を返却すると<code>IResponseFilter</code>が使用されなくなります。<br>
ここでは常に<code>true</code>を返却して<code>IResponseFilter</code>が使われるようにします。</p></li>
<li><p>Dispose<br>
解放が必要なリソースは特にありませんので、何も行いません。</p></li>
</ul>

<p>以下の例では、最初に現れた<code>&lt;script&gt;</code>タグの前に、以下のスクリプトを埋め込むことにします。  </p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">埋め込むスクリプト</span></div>
<div class="highlight"><pre class="with-code"><code><span class="p">&lt;</span><span class="n">script</span><span class="p">&gt;</span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s">"injected"</span><span class="p">);&lt;/</span><span class="n">script</span><span class="p">&gt;</span>
</code></pre></div>
</div>

<p>少し、複雑ですが参考にしてください。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IResponseFilterの実装</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">ResponseFilter</span> <span class="p">:</span> <span class="n">IResponseFilter</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 埋め込み位置の文字列</span>
        <span class="c1">/// ここでは、最初に現れる"&lt;script"の直前に埋め込む。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">String</span> <span class="n">SEARCH_TARGET</span> <span class="p">=</span> <span class="s">"&lt;script"</span><span class="p">;</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 埋め込むコード</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">String</span> <span class="n">INJECTED_CODE</span> <span class="p">=</span> <span class="s">"&lt;script&gt;console.log('injected');&lt;/script&gt;"</span><span class="p">;</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 出力ストリームに未書き込みのデータ</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="kt">byte</span><span class="p">[]</span> <span class="n">remainData</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// コード埋め込み済みのフラグ</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="kt">bool</span> <span class="n">bInjected</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// レスポンスで指定されているエンコーディング</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="n">Encoding</span> <span class="n">encoding</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">;</span>


        <span class="k">public</span> <span class="nf">ResponseFilter</span><span class="p">(</span><span class="n">String</span> <span class="n">charset</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">String</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">charset</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">try</span>
                <span class="p">{</span>
                    <span class="c1">// responseの文字コードからエンコーディングを作成</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">encoding</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="nf">GetEncoding</span><span class="p">(</span><span class="n">charset</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">catch</span>
                <span class="p">{</span>
                    <span class="c1">// 不正な文字コード指定の場合はUTF8とする。</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">encoding</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">void</span> <span class="n">IDisposable</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">()</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="n">FilterStatus</span> <span class="n">IResponseFilter</span><span class="p">.</span><span class="nf">Filter</span><span class="p">(</span><span class="n">Stream</span> <span class="n">dataIn</span><span class="p">,</span> <span class="k">out</span> <span class="kt">long</span> <span class="n">dataInRead</span><span class="p">,</span> <span class="n">Stream</span> <span class="n">dataOut</span><span class="p">,</span> <span class="k">out</span> <span class="kt">long</span> <span class="n">dataOutWritten</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dataIn</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// 書き出すデータ</span>
                <span class="kt">byte</span><span class="p">[]</span> <span class="n">modifiedContent</span><span class="p">;</span>

                <span class="c1">// 入力ストリームのサイズ</span>
                <span class="kt">long</span> <span class="n">lDataSize</span> <span class="p">=</span> <span class="n">dataIn</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>

                <span class="c1">// 出力トリームのサイズ</span>
                <span class="kt">long</span> <span class="n">lCapacity</span> <span class="p">=</span> <span class="n">dataOut</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>

                <span class="c1">// 入力ストリームから全て読み込む</span>
                <span class="kt">byte</span><span class="p">[]</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="n">lDataSize</span><span class="p">];</span>
                <span class="n">dataIn</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">lDataSize</span><span class="p">);</span>

                <span class="c1">// 読み取ったサイズを返却</span>
                <span class="n">dataInRead</span> <span class="p">=</span> <span class="n">lDataSize</span><span class="p">;</span>

                <span class="c1">// 1つのリソースに一度だけ埋め込むため、埋め込み済みフラグを確認する。</span>
                <span class="k">if</span> <span class="p">(!</span><span class="n">bInjected</span><span class="p">)</span> 
                <span class="p">{</span>
                    <span class="c1">// 検索する文字列をバイト配列に変換する</span>
                    <span class="kt">byte</span><span class="p">[]</span> <span class="n">pattern</span> <span class="p">=</span> <span class="n">encoding</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">SEARCH_TARGET</span><span class="p">);</span>

                    <span class="c1">// コードを埋め込む位置を探す</span>
                    <span class="kt">int</span> <span class="n">injectionPoint</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">lDataSize</span> <span class="p">-</span> <span class="n">pattern</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="p">++</span><span class="n">i</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="c1">// 埋め込む位置のパターンと一致するかチェックする</span>
                        <span class="kt">bool</span> <span class="n">bMatch</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">pattern</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="p">++</span> <span class="n">j</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">pattern</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">!=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="n">j</span><span class="p">])</span>
                            <span class="p">{</span>
                                <span class="n">bMatch</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                                <span class="k">break</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>

                        <span class="c1">// 埋め込む位置が特定できた場合</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">bMatch</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">injectionPoint</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="c1">// コードを埋め込む位置が見つかった</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">injectionPoint</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="c1">// 埋め込んだことをマークする。</span>
                        <span class="n">bInjected</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

                        <span class="c1">// 入力データをコード埋め込み位置で2つに分割する。</span>
                        <span class="kt">byte</span><span class="p">[]</span> <span class="n">firstPart</span> <span class="p">=</span> <span class="n">buffer</span><span class="p">.</span><span class="nf">Take</span><span class="p">(</span><span class="n">injectionPoint</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">();</span>
                        <span class="kt">byte</span><span class="p">[]</span> <span class="n">secondPart</span> <span class="p">=</span> <span class="n">buffer</span><span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="n">injectionPoint</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">();</span>

                        <span class="c1">// 出力ストリームに書き込むデータを作成する。</span>
                        <span class="c1">// 前回の書き込めなかったデータ＋入力データの前半＋埋め込むデータ＋入力データの後半</span>
                        <span class="kt">byte</span><span class="p">[]</span> <span class="n">code</span> <span class="p">=</span> <span class="n">encoding</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">INJECTED_CODE</span><span class="p">);</span>
                        <span class="n">modifiedContent</span> <span class="p">=</span> <span class="n">remainData</span><span class="p">.</span><span class="nf">Concat</span><span class="p">(</span><span class="n">firstPart</span><span class="p">).</span><span class="nf">Concat</span><span class="p">(</span><span class="n">code</span><span class="p">).</span><span class="nf">Concat</span><span class="p">(</span><span class="n">secondPart</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">();</span>
                    <span class="p">}</span>
                    <span class="c1">// コードを埋め込む位置が見つからなかった</span>
                    <span class="k">else</span>
                    <span class="p">{</span>
                        <span class="c1">// 入力データを書き込むデータとする。</span>
                        <span class="n">modifiedContent</span> <span class="p">=</span> <span class="n">buffer</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="c1">// 入力データを書き込むデータとする。</span>
                    <span class="n">modifiedContent</span> <span class="p">=</span> <span class="n">buffer</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="c1">// 出力ストリームに編集したコンテンツを書き出す。</span>
                <span class="c1">// ※出力ストリームのサイズ以上は書き込めない。</span>
                <span class="n">dataOutWritten</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Min</span><span class="p">(</span><span class="n">lCapacity</span><span class="p">,</span> <span class="n">modifiedContent</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
                <span class="n">dataOut</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">modifiedContent</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">dataOutWritten</span><span class="p">);</span>

                <span class="c1">// 書き込むデータが出力ストリームのサイズよりも場合</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">modifiedContent</span><span class="p">.</span><span class="n">Length</span> <span class="p">&gt;</span> <span class="n">lCapacity</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// 書き込むない部分を、次回書き込むデータとして保存しておく</span>
                    <span class="n">remainData</span> <span class="p">=</span> <span class="n">modifiedContent</span><span class="p">.</span><span class="nf">Skip</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">lCapacity</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">();</span>

                    <span class="c1">// バッファ不足であることを返却する</span>
                    <span class="k">return</span> <span class="n">FilterStatus</span><span class="p">.</span><span class="n">NeedMoreData</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="c1">// 全てのデータを出力ストリームに書き込めた場合</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="c1">// 全て書き込めているので、未書き込みデータは空にする。</span>
                    <span class="n">remainData</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
                    <span class="c1">// 処理が完了したことを返却する。</span>
                    <span class="k">return</span> <span class="n">FilterStatus</span><span class="p">.</span><span class="n">Done</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="c1">// 入力データがないため、何も書き込んでいないが、処理は完了とする。</span>
                <span class="n">dataInRead</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                <span class="n">dataOutWritten</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">FilterStatus</span><span class="p">.</span><span class="n">Done</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">bool</span> <span class="n">IResponseFilter</span><span class="p">.</span><span class="nf">InitFilter</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="203-iresourcerequesthandlergetresourceresponsefilterメソッドの実装" class="fragment"></span><a href="#203-iresourcerequesthandlergetresourceresponsefilter%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>20.3 IResourceRequestHandler.GetResourceResponseFilterメソッドの実装</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetResourceResponseFilter.htm" rel="nofollow noopener" target="_blank">IResourceRequestHandler.GetResourceResponseFilter</a>メソッドは1つのHTTPレスポンスを受信する度に呼び出されます。HTMLだけでなく、CSS、Javascript、PDF、イメージ等のすべてのリソースのHTTPレスポンスで呼び出されます。また、開発者ツールなどのカスタムスキーマ(devtools://など)の場合でも、このメソッドが呼び出されます。<br>
したがって、レスポンス内容を変更する対象のリソースを絞る必要があります。</p>

<p>例えば、以下の条件のレスポンスだけを編集対象とします。</p>

<ul>
<li>メインフレームかサブフレーム(iframeとframe)にロードされるリソースだけを対象する。</li>
<li>http://とhttps://のスキマーだけを対象とする。</li>
</ul>

<p>ほかにもMimeTypeを見る方法もあります。<br>
以下は実装例です。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">GetResourceResponseFilterメソッドの実装</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">IResponseFilter</span> <span class="n">IResourceRequestHandler</span><span class="p">.</span><span class="nf">GetResourceResponseFilter</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">,</span> <span class="n">IResponse</span> <span class="n">response</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// メインフレームとサブフレームのリソースの場合だけリソースを改変する。</span>
    <span class="c1">// 注意：pdfや開発者ツールの場合には、フィルターが適用されないように、httpとhttpsプロトコルだけに限定する。</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">request</span><span class="p">.</span><span class="n">ResourceType</span> <span class="p">==</span> <span class="n">ResourceType</span><span class="p">.</span><span class="n">MainFrame</span> <span class="p">||</span> <span class="n">request</span><span class="p">.</span><span class="n">ResourceType</span> <span class="p">==</span> <span class="n">ResourceType</span><span class="p">.</span><span class="n">SubFrame</span><span class="p">)</span> <span class="p">&amp;&amp;</span>
        <span class="n">Regex</span><span class="p">.</span><span class="nf">IsMatch</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">Url</span><span class="p">,</span> <span class="s">"^(http|https)://.*$"</span><span class="p">,</span> <span class="n">RegexOptions</span><span class="p">.</span><span class="n">IgnoreCase</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// レスポンス内容を変更する。</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ResponseFilter</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">Charset</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// レスポンス内容は変更しない。</span>
    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="204-iresponsefilterの確認" class="fragment"></span><a href="#204-iresponsefilter%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>20.4 IResponseFilterの確認</h2>

<p>ビルドして実行して開発者ツールを立ち上げてみます。<br>
すると、コンソールに<code>injected</code>と出力されていることが確認できます。<br>
また、Elementを確認すると、スクリプト要素が埋め込まれていることが確認できます。</p>

<p><a href="https://camo.qiitausercontent.com/4d7d401aeb5ee87e36fe3ef1339c4a22a78e0714/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f30303831626464322d323164662d656530312d393835622d6431646464626561383935332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F0081bdd2-21df-ee01-985b-d1dddbea8953.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7746f319dc4308a81eee66f08a57ed41" alt="injection.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/0081bdd2-21df-ee01-985b-d1dddbea8953.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F0081bdd2-21df-ee01-985b-d1dddbea8953.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c7422a94164922349332f0c56f6125da 1x" loading="lazy"></a></p>

<p>なお、上で実装したコードでは、最初のscriptとして追加されるようにしていますが、このように最初のscriptにならない場合があります。<br>
これは、変更したWebコンテンツがブラウザにロードされた後に、内部のスクリプトによって追加のスクリプトがロードされてるためだと考えられます。</p>

<p>また、<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy" rel="nofollow noopener" target="_blank">Content-Security-Policy(CSP)</a>を突破することはできないため、<code>Content-Security-Policy</code>の<code>script-src</code>の設定によっては、このように直接埋め込んだスクリプトは実行されないことにも注意が必要です。<br>
CSPを突破するためには、<a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_CefCustomScheme_IsCSPBypassing.htm" rel="nofollow noopener" target="_blank">IsCSPBypassing</a>でCSPをバイパスする指定のカスタムスキーマ作成してスクリプトをロード必要があります。カスタムスキーマについては次章で説明します。</p>

<h1>
<span id="21-カスタムスキーマ" class="fragment"></span><a href="#21-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E"><i class="fa fa-link"></i></a>21. カスタムスキーマ</h1>

<p>カスタムスキーマとは、chromeでの<code>chrome://version</code>のようなURLでの<code>chrome://</code>の部分のことです。<code>http://</code>や<code>https://</code>以外に独自のスキーマを提供することができます。<br>
また、カスタムスキーマは<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy" rel="nofollow noopener" target="_blank">Content-Security-Policy(CSP)</a>を突破することができるため、「<a href="#20-%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E5%86%85%E5%AE%B9%E3%81%AE%E5%A4%89%E6%9B%B4"># 20. レスポンス内容の変更</a>」で説明したレスポンスで<code>script</code>の<code>src</code>にカスタムスキーマのリソースを埋め込むと、任意のコードを実行できるようになります。<br>
他にも通常のスキーマではできない、特殊なことを行うスキーマを提供することができます。</p>

<p>ここでは、ローカルの任意のファイルの中身を取り出すスキーマを実装してみます。</p>

<h2>
<span id="211-ischemehandlerfactoryインタフェースを実装するクラスの追加" class="fragment"></span><a href="#211-ischemehandlerfactory%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>21.1 ISchemeHandlerFactoryインタフェースを実装するクラスの追加</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ISchemeHandlerFactory.htm" rel="nofollow noopener" target="_blank">ISchemeHandlerFactory</a>インタフェースを実装するクラスを新規に追加します。</p>

<p>ソリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に<code>LocalFileSchemeHandlerFactory</code>を指定します。そして、以下のように<code>ISchemeHandlerFactory</code>インタフェースを実装させます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ISchemeHandlerFactoryを実装するクラス</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">LocalFileSchemeHandlerFactory</span><span class="p">:</span> <span class="n">ISchemeHandlerFactory</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>その後、<code>ISchemeHandlerFactory</code>を選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。すると<code>ISchemeHandlerFactory</code>インタフェースのメソッドがすべて仮実装されます。</p>

<h2>
<span id="212-ischemehandlerfactoryのメソッドを実装" class="fragment"></span><a href="#212-ischemehandlerfactory%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>21.2 ISchemeHandlerFactoryのメソッドを実装</h2>

<p><code>ISchemeHandlerFactory</code>インターフェースには<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ISchemeHandlerFactory_Create.htm" rel="nofollow noopener" target="_blank">Create</a>メソッドしかありません。<br>
このメソッドでは、カスタムスキーマをサポートするために、<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IResourceHandler.htm" rel="nofollow noopener" target="_blank">IResourceHandler</a>インタフェースを返却する必要があります。<br><br>
この<code>IResourceHandler</code>インタフェースを実装するクラスを作成するのもよいですが、以下の便利なスタティックメソッドが用意されていますので、これを使うことで簡単に<code>IResourceHandler</code>インタフェースを用意することができます。</p>

<ul>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ResourceHandler_FromFilePath.htm" rel="nofollow noopener" target="_blank">FromFilePath</a>メソッド<br>
指定されたファイルの内容を返却する<code>IResourceHandler</code>インタフェースを作成します。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/Overload_CefSharp_ResourceHandler_FromString.htm" rel="nofollow noopener" target="_blank">FromString</a>メソッド<br>
指定された文字列内容を返却する<code>IResourceHandler</code>インタフェースを作成します。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ResourceHandler_ForErrorMessage.htm" rel="nofollow noopener" target="_blank">ForErrorMessage</a>メソッド<br>
指定された文字列内容とStatusコードを返却する<code>IResourceHandler</code>インタフェースを作成します。</li>
<li>
<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ResourceHandler_FromByteArray.htm" rel="nofollow noopener" target="_blank">FromByteArray </a>メソッド<br>
指定されたバイト配列の内容を返却する<code>IResourceHandler</code>インタフェースを作成します。</li>
</ul>

<p>ここでは、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ResourceHandler_FromFilePath.htm" rel="nofollow noopener" target="_blank">FromFilePath</a>メソッドと<a href="https://cefsharp.github.io/api/85.3.x/html/Overload_CefSharp_ResourceHandler_FromString.htm" rel="nofollow noopener" target="_blank">FromString</a>メソッドを使って、カスタムスキーマのメソッドを実装します。</p>

<ol>
<li>URLからファイルパスを取得する(※URLでファイルパスが参照される仕様とする)。</li>
<li>指定されたファイルが存在する場合、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ResourceHandler_FromFilePath.htm" rel="nofollow noopener" target="_blank">FromFilePath</a>メソッドでファイルの内容を返却する。</li>
<li>指定されたファイルが存在しない場合、<a href="https://cefsharp.github.io/api/85.3.x/html/Overload_CefSharp_ResourceHandler_FromString.htm" rel="nofollow noopener" target="_blank">FromString</a>メソッドでエラー文言を返却する。</li>
</ol>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ISchemeHandlerFactoryのメソッドを実装例</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">LocalFileSchemeHandlerFactory</span> <span class="p">:</span> <span class="n">ISchemeHandlerFactory</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// カスタムスキーマ名</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">String</span> <span class="n">SCHEME_NAME</span> <span class="p">=</span> <span class="s">"localfile"</span><span class="p">;</span>

        <span class="k">public</span> <span class="n">IResourceHandler</span> <span class="nf">Create</span><span class="p">(</span><span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="kt">string</span> <span class="n">schemeName</span><span class="p">,</span> <span class="n">IRequest</span> <span class="n">request</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// スキーマ名がLocalFileの場合</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">schemeName</span> <span class="p">==</span> <span class="n">SCHEME_NAME</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// urlでc:\からのファイルパスが指定されているとして、絶対パスを作成する。</span>
                <span class="n">String</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"c:\\"</span> <span class="p">+</span> <span class="n">request</span><span class="p">.</span><span class="n">Url</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">SCHEME_NAME</span><span class="p">}</span><span class="s">://"</span><span class="p">,</span> <span class="s">""</span><span class="p">).</span><span class="nf">Replace</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="s">"\\"</span><span class="p">);</span>

                <span class="c1">// 指定されたファイルがあれば、その内容を返却する。</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">File</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="c1">// 指定されたファイルの中身を返却する</span>
                    <span class="k">return</span> <span class="n">ResourceHandler</span><span class="p">.</span><span class="nf">FromFilePath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">"text/plain"</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="c1">// エラーメッセージを返却する</span>
                    <span class="k">return</span> <span class="n">ResourceHandler</span><span class="p">.</span><span class="nf">FromString</span><span class="p">(</span><span class="s">"Such file dose NOT exist."</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>なお、カスタムスキーマは常に小文字として扱われます。<br>
アドレスバーに大文字のカスタムスキーマ(LOCALFILE://xxx)と入れても、上のCreateメソッドには(localfile://xxx)と渡ってきます。</p>

<h2>
<span id="213-カスタムスキーマの登録" class="fragment"></span><a href="#213-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%AE%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>21.3 カスタムスキーマの登録</h2>

<p>カスタムスキーマを利用できるように登録します。<br><br>
これには、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_CefSettingsBase_RegisterScheme.htm" rel="nofollow noopener" target="_blank">CefSettingsBase.RegisterScheme</a>メソッドを使用します。<br>
<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_CefSettingsBase.htm" rel="nofollow noopener" target="_blank">CefSettingsBase</a>クラスは、「<a href="#31-cefinitialize%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AB%E3%82%88%E3%82%8B%E5%88%9D%E6%9C%9F%E5%8C%96">3.1 Cef.Initializeメソッドによる初期化</a>」で説明している初期化のための<code>Cef.Initialize</code>メソッドに指定するオブジェクトのクラスです。<br>
<code>CefSettingsBase.RegisterScheme</code>では以下の項目を設定します。</p>

<ul>
<li>
<code>SchemeName</code> - スキーマ名</li>
<li>
<code>IsCSPBypassing</code> - CSPをバイパスするかどうか</li>
<li>
<code>IsSecure</code> - HTTPSとして扱うかどうか</li>
<li>
<code>SchemeHandlerFactory</code> - スキーマを実装する<code>SchemeHandlerFactory</code>
</li>
</ul>

<p>以下に実装例を示します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">カスタムスキーマの登録</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">SimpleBrowser.Handlers</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">SimpleBrowser.UI</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// アプリケーションのメイン エントリ ポイントです。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="p">[</span><span class="n">STAThread</span><span class="p">]</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// （省略）</span>

            <span class="c1">// カスタムスキーマを登録する</span>
            <span class="n">settings</span><span class="p">.</span><span class="nf">RegisterScheme</span><span class="p">(</span><span class="k">new</span> <span class="nf">CefCustomScheme</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">SchemeName</span> <span class="p">=</span> <span class="s">"localfile"</span><span class="p">,</span>   <span class="c1">// スキーマ名はlocalfile</span>
                <span class="n">IsCSPBypassing</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>      <span class="c1">// CSPはバイパス</span>
                <span class="n">IsSecure</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>            <span class="c1">// HTTPSとして扱う</span>
                <span class="n">SchemeHandlerFactory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Handlers</span><span class="p">.</span><span class="nf">LocalFileSchemeHandlerFactory</span><span class="p">()</span>
            <span class="p">});</span>

            <span class="c1">// CefSharpを初期化する</span>
            <span class="n">Cef</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">new</span> <span class="nf">BrowserProcessHandler</span><span class="p">());</span>

            <span class="n">Application</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="k">new</span> <span class="nf">SimpleBrowserFrame</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
</div>

<h2>
<span id="214-カスタムスキーマの確認" class="fragment"></span><a href="#214-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>21.4 カスタムスキーマの確認</h2>

<p>ビルドして実行してみます。</p>

<p>アドレスバーに「localfile://temp/console.log」と入力して、ENTERキーを押下してみます。<br>
※c:\temp\console.logがある前提。<br>
すると以下の様に<code>c:\temp\console.log</code>ファイルの内容が表示されるはずです。<br>
<a href="https://camo.qiitausercontent.com/ad9fe58263d57720067bfbfe10de1ede56c304a6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f32363365633331312d613830642d363331332d653466332d6236346634343262636137612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F263ec311-a80d-6313-e4f3-b64f442bca7a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=db54e07867746cd4e3623023c5306589" alt="カスタムスキーマ.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/263ec311-a80d-6313-e4f3-b64f442bca7a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F263ec311-a80d-6313-e4f3-b64f442bca7a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f6e43ba29b214fa9d72a8c4eb0d1f0dc 1x" loading="lazy"></a></p>

<p>アドレスバーに「localfile://aaaaa」と入力して、ENTERキーを押下してみます。<br>
※c:\aaaaaがない前提。<br>
すると以下の様にエラーメッセージが表示されます。<br>
<a href="https://camo.qiitausercontent.com/d7c6e6a8555f3f404afb643796407feebc172439/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f61613765376664322d643365622d636536372d393132322d3637313939326530386132332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Faa7e7fd2-d3eb-ce67-9122-671992e08a23.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1d657bf701ff0f86878a45e6661965fe" alt="カスタムスキーマ2.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/aa7e7fd2-d3eb-ce67-9122-671992e08a23.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Faa7e7fd2-d3eb-ce67-9122-671992e08a23.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3b5bb9fac92516fc135a7c759df15817 1x" loading="lazy"></a></p>

<p>以上、カスタムスキーマはブラウザ独自の機能を作りこむときに非常に便利です。</p>

<h1>
<span id="22-子ウィンドウオープン" class="fragment"></span><a href="#22-%E5%AD%90%E3%82%A6%E3%82%A3%E3%83%B3%E3%83%89%E3%82%A6%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3"><i class="fa fa-link"></i></a>22. 子ウィンドウオープン</h1>

<p>A要素のクリックや<code>window.open</code>メソッドで作成される子ウィンドウの管理は<code>CefSharp</code>で最も難しい部分です。<br>
実は<code>ChromiumWebBrowser</code>のインスタンスをフォームに張り付けただけの状態でも、必要に応じて子ウィンドウは自動的に作成されます。これは<code>CefSharp</code>内部の処理で行われていますが、自動作成される子ウィンドウではWebViewのコンテナであるウィンドウも自動作成されてしまいます。</p>

<p>例えば、タブ表示で子ウィンドウを表示したい場合は、この動作は変えないといけないです。また、子ウィンドウが閉じられるタイミングもハンドリングして、すべてのウィンドウが閉じられたときに、アプリケーションを終了するような動作にする必要もあります。</p>

<p>これを行うには、<a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILifeSpanHandler.htm" rel="nofollow noopener" target="_blank">ILifeSpanHandler</a>インタフェースを作成して、自動作成されるWebViewも含めてインスタンスの管理を行う必要があります。この<code>ILifeSpanHandler</code>インタフェースは最も実装に気を使わなくてはいけないインタフェースです。</p>

<h2>
<span id="221-ilifespanhandlerインタフェースを実装するクラス" class="fragment"></span><a href="#221-ilifespanhandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>22.1 ILifeSpanHandlerインタフェースを実装するクラス</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILifeSpanHandler.htm" rel="nofollow noopener" target="_blank">ILifeSpanHandler</a>インタフェースを実装するクラスを新規に追加します。</p>

<p>ソリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に<code>LifeSpanHandler</code>を指定します。そして、以下のように<code>ILifeSpanHandler</code>インタフェースを実装させます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ILifeSpanHandlerを実装するクラス</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CefSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SimpleBrowser.Handlers</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">LifeSpanHandler</span><span class="p">:</span> <span class="n">ILifeSpanHandler</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>その後、<code>ILifeSpanHandler</code>を選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。すると<code>ILifeSpanHandler</code>インタフェースのメソッドがすべて仮実装されます。</p>

<h2>
<span id="222-ilifespanhandlerインタフェースを実装のメソッドを仮実装する" class="fragment"></span><a href="#222-ilifespanhandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BB%AE%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>22.2 ILifeSpanHandlerインタフェースを実装のメソッドを仮実装する</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILifeSpanHandler.htm" rel="nofollow noopener" target="_blank">ILifeSpanHandler</a>インタフェースには、次の4つのメソッドがあります。</p>

<ul>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILifeSpanHandler_DoClose.htm" rel="nofollow noopener" target="_blank">DoClose</a><br>
WebViewが閉じられようとするときに呼び出されます。<br>
ChromeなどのWebブラウザでは、タブの×ボタンでタブを閉じようとした場合、Webコンテンツでjavascriptの<a href="https://developer.mozilla.org/ja/docs/Web/API/WindowEventHandlers/onbeforeunload" rel="nofollow noopener" target="_blank">onbeforeunload</a>イベントハンドラが呼び出されます。そこで、<code>preventDefault()</code>が呼び出されると、このページを離れても良いかを確認するためダイアログを表示されて、ユーザが了承した場合にタブのクローズ処理が実行されます。そして、ユーザがタブを閉じることを了承すると、javascriptの<code>onunload</code>イベントハンドラが実行されて、最終的にタブが閉じられれることになります。<br>
これと同じ終了時の動作を実現するためは、WebViewのコンテナウィンドウが閉じられようとするときに、一旦ウィンドウを閉じる動作を拒否して、<a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IBrowser_CloseBrowser.htm" rel="nofollow noopener" target="_blank">IBrowser.CloseBrowser</a>メソッドを呼び出す様にします。すると、<code>onbeforeunload</code>イベントハンドラが呼び出されるようになります。そして、最終的にウィンドウを閉じることが許可された場合に、本メソッドが呼び出されます。その後、本メソッドで<code>false</code>を返却すると、再度WebViewのコンテナウィンドウのクローズのために、OSからWM_CLOSEメッセージが通知されるので、フォームで終了処理を行うことになります。<br>
今回は特に実装しませんが、<code>onbeforeunload</code>の仕様を実現するためには、必ず実装が必要になります。</p></li>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILifeSpanHandler_OnAfterCreated.htm" rel="nofollow noopener" target="_blank">OnAfterCreated</a><br>
WebViewが作成されて<code>IBrowser</code>インタフェースが利用可能になった時点で呼び出されるハンドラです。<br>
<code>new ChromiumWebBrowser()</code>で明示的にWebViewを作成した場合も、<code>OnBeforePopup</code>が呼び出された後に<code>CefSharp</code>が自動的にWebViewを作成した場合も、その後このメソッドが呼びされることになります。<br>
ここでは、<code>CefSharp</code>が自動的にWebViewを作成する場合に、そのコンテナであるフォームに新たに作成されたWebViewの情報を設定する様にします。<br>
この部分はこの後の章で実装していきます。</p></li>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILifeSpanHandler_OnBeforeClose.htm" rel="nofollow noopener" target="_blank">OnBeforeClose</a><br>
WebViewが閉じられるタイミングで呼び出されます。<br>
タブ形式で表示している場合は、ここでWebViewのインスタンス数をデクリメントして、すべてのWebViewのインスタンス数がゼロになった時点でアプリケーションを終了するような実装にすることもできます。<br>
今回は特に何も実装しません。</p></li>
<li><p><a href="https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILifeSpanHandler_OnBeforePopup.htm" rel="nofollow noopener" target="_blank">OnBeforePopup</a><br>
<code>A</code>要素のクリックや<code>window.open</code>により子ウィンドウがオープンされる前に呼び出されます。ユーザ操作によるものかどうかを判断することができますので、ここでポップアップブロック機能を実現することもできます。<br>
ここでは<code>CefSharp</code>が自動的に作成するWebViewの親ウィンドウの情報を設定します。<br>
この部分は以降の章で解説します。</p></li>
</ul>

<h2>
<span id="223-onbeforepopupメソッドの実装" class="fragment"></span><a href="#223-onbeforepopup%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>22.3 OnBeforePopupメソッドの実装</h2>

<p>基本的には<code>false</code>を返却してCefSharpにWebViewの作成を任せますが、<code>true</code>を返却してCefSharpにWebViewを作成させない様にすることもできます。CefSharpにWebViewの作成を任せずに、自分でWebViewを作成する場合は、<code>new ChromiumWebBrowser()</code>を呼び出してWebViewを作成した後、<code>true</code>を返却することになります。</p>

<p><strong><em>しかし、自動で作成されたWebViewと明示的にnewして作成したWebViewとでは、動作に大きな違いがあるので注意が必要です。</em></strong>  </p>

<p>アプリケーションが<code>window.open()</code>メソッドで作成したウィンドウの場合、javascriptの<code>postMessage</code>メソッドを使ってメッセージの送信ができたり、<code>window.opener</code>プロパティでオープンしたウィンドウの情報を子ウィンドウ側で取得するできる必要があります。しかし、明示的にnewして作成したWebViewの場合は、このようなウィンドウの親子関係がないため、これらの操作ができません。</p>

<p><strong><em>従って、このハンドラが呼び出される場合は、CefSharpにWebViewの作成をお任せすることをお勧めします。</em></strong></p>

<p>このメソッドでは、アプリケーションで新しいWebViewのコンテナとなるウィンドウを用意して、そのコンテナウィンドウの情報をCefSharpに通知します。もし、タブ形式のブラウザにする場合は、新しいタブを追加して、WebViewのコンテナとなるウィンドウを用意することになるでしょう。<br>
ここでは、親ウィンドウと同じフォームを作成して、それをコンテナとする様にします。</p>

<p>まず、コンテナとなるフォーム<code>SimpleBrowserFrame</code>クラスのコンストラクタを変更して、WebView無しでフォームを作れるようにします。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">コンストラクタの変更</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="nf">SimpleBrowserFrame</span><span class="p">(</span><span class="kt">bool</span> <span class="n">bCreateWebView</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nf">InitializeComponent</span><span class="p">();</span>

    <span class="c1">// WebView作成の指定がある場合は、WebViewを作成する</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bCreateWebView</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">InitializeWebBrowser</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">InitializeWebBrowser</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// CefSharpのWebViewを作成する。</span>
    <span class="n">WebBrowser</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ChromiumWebBrowser</span><span class="p">(</span><span class="s">"https://www.google.co.jp"</span><span class="p">);</span>

    <span class="c1">// コントロールを追加する。</span>
    <span class="k">this</span><span class="p">.</span><span class="n">webViewContainer</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">WebBrowser</span><span class="p">);</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">Dock</span> <span class="p">=</span> <span class="n">DockStyle</span><span class="p">.</span><span class="n">Fill</span><span class="p">;</span>

    <span class="c1">// WebViewの各種オプションを設定する</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">BrowserSettings</span><span class="p">.</span><span class="n">Javascript</span> <span class="p">=</span> <span class="n">CefState</span><span class="p">.</span><span class="n">Enabled</span><span class="p">;</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">BrowserSettings</span><span class="p">.</span><span class="n">JavascriptDomPaste</span> <span class="p">=</span> <span class="n">CefState</span><span class="p">.</span><span class="n">Enabled</span><span class="p">;</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">BrowserSettings</span><span class="p">.</span><span class="n">ApplicationCache</span> <span class="p">=</span> <span class="n">CefState</span><span class="p">.</span><span class="n">Enabled</span><span class="p">;</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">BrowserSettings</span><span class="p">.</span><span class="n">LocalStorage</span> <span class="p">=</span> <span class="n">CefState</span><span class="p">.</span><span class="n">Enabled</span><span class="p">;</span>

    <span class="c1">// CefSharpの各種ハンドラを設定する</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">KeyboardHandler</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Handlers</span><span class="p">.</span><span class="nf">KeyboardHandler</span><span class="p">();</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">RequestHandler</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Handlers</span><span class="p">.</span><span class="nf">RequestHandler</span><span class="p">();</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">DisplayHandler</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Handlers</span><span class="p">.</span><span class="nf">DisplayHandler</span><span class="p">();</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">DownloadHandler</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Handlers</span><span class="p">.</span><span class="nf">DownloadHandler</span><span class="p">();</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">LoadHandler</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Handlers</span><span class="p">.</span><span class="nf">LoadHandler</span><span class="p">();</span>

    <span class="c1">// 独自オブジェクトを公開する</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">JavascriptObjectRepository</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="s">"Test"</span><span class="p">,</span> <span class="k">new</span> <span class="n">SimpleBrowser</span><span class="p">.</span><span class="n">Util</span><span class="p">.</span><span class="nf">Test</span><span class="p">(),</span> <span class="k">true</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>次に、<code>OnBeforePopup</code>メソッドを実装します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">OnBeforePopup</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">bool</span> <span class="n">ILifeSpanHandler</span><span class="p">.</span><span class="nf">OnBeforePopup</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">,</span> <span class="n">IFrame</span> <span class="n">frame</span><span class="p">,</span> <span class="kt">string</span> <span class="n">targetUrl</span><span class="p">,</span> <span class="kt">string</span> <span class="n">targetFrameName</span><span class="p">,</span> <span class="n">WindowOpenDisposition</span> <span class="n">targetDisposition</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">userGesture</span><span class="p">,</span> <span class="n">IPopupFeatures</span> <span class="n">popupFeatures</span><span class="p">,</span> <span class="n">IWindowInfo</span> <span class="n">windowInfo</span><span class="p">,</span> <span class="n">IBrowserSettings</span> <span class="n">browserSettings</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">bool</span> <span class="n">noJavascriptAccess</span><span class="p">,</span> <span class="k">out</span> <span class="n">IWebBrowser</span> <span class="n">newBrowser</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 親のbrowserからフォームを取得する</span>
    <span class="n">SimpleBrowserFrame</span> <span class="n">parent</span> <span class="p">=</span> <span class="n">SimpleBrowserFrame</span><span class="p">.</span><span class="nf">getMainFrame</span><span class="p">(</span><span class="n">browser</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">parent</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 親フォームのコンテキストで実行させる</span>
        <span class="n">parent</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">new</span> <span class="nf">Action</span><span class="p">(()</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="c1">// WebView無しの空のコンテナフォームを作成する。</span>
            <span class="n">SimpleBrowserFrame</span> <span class="n">newWindows</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SimpleBrowserFrame</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

            <span class="c1">// WebViewのコンテナ（親ウィンドウ）の情報を設定する。</span>
            <span class="n">Rectangle</span> <span class="n">rect</span> <span class="p">=</span> <span class="n">newWindows</span><span class="p">.</span><span class="n">ClientRectangle</span><span class="p">;</span>
            <span class="n">windowInfo</span><span class="p">.</span><span class="nf">SetAsChild</span><span class="p">(</span><span class="n">newWindows</span><span class="p">.</span><span class="n">WebBrowserContainer</span><span class="p">.</span><span class="n">Handle</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">Left</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">Top</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">Right</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">Bottom</span><span class="p">);</span>

            <span class="c1">// フォームを表示する</span>
            <span class="n">newWindows</span><span class="p">.</span><span class="nf">Show</span><span class="p">();</span>
        <span class="p">}));</span>
    <span class="p">}</span>

    <span class="c1">// この引数は実験的な引数の用ですがNULLを設定する</span>
    <span class="n">newBrowser</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="c1">// CefSharpにWebViewの作成を任せるためにfalseを返却する</span>
    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>以上で、子ウィンドウが作成されるときに、アプリケーションで用意したコンテナ用のフォームにCefSharpが自動的に作成するWevViewが表示されるようになりました。</p>

<h2>
<span id="224-onaftercreatedメソッドの実装" class="fragment"></span><a href="#224-onaftercreated%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>22.4 OnAfterCreatedメソッドの実装</h2>

<p>このメソッドでは、新しく作成されたWebViewの<code>IBrowser</code>インタフェースをコンテナウィンドウであるフォームに設定します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">OnAfterCreated</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">void</span> <span class="n">ILifeSpanHandler</span><span class="p">.</span><span class="nf">OnAfterCreated</span><span class="p">(</span><span class="n">IWebBrowser</span> <span class="n">chromiumWebBrowser</span><span class="p">,</span> <span class="n">IBrowser</span> <span class="n">browser</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 新しく作成されたbrowserからコンテナのフォームを取得する</span>
    <span class="n">SimpleBrowserFrame</span> <span class="n">parent</span> <span class="p">=</span> <span class="n">SimpleBrowserFrame</span><span class="p">.</span><span class="nf">getMainFrame</span><span class="p">(</span><span class="n">browser</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">parent</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// コンテナフォームのコンテキストで実行</span>
        <span class="n">parent</span><span class="p">.</span><span class="nf">BeginInvoke</span><span class="p">(</span><span class="k">new</span> <span class="nf">Action</span><span class="p">(()</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="c1">// 親フォームにIBrowserインスタンスの情報を設定する</span>
            <span class="n">parent</span><span class="p">.</span><span class="n">Browser</span> <span class="p">=</span> <span class="n">browser</span><span class="p">;</span>
        <span class="p">}));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>次に、コンテナフォームである<code>SimpleBrowserFrame</code>に<code>IBrowser</code>インスタンスを保持するためのプロパティを追加します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IBrowserのプロパティ</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">SimpleBrowserFrame</span> <span class="p">:</span> <span class="n">Form</span>
<span class="p">{</span>
    <span class="c1">// (省略)</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// ホストしているWebViewのIBrowserインタフェース</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="n">IBrowser</span> <span class="n">Browser</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="c1">// (省略)</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>次に、コンテナフォームである<code>SimpleBrowserFrame</code>のすべてのメソッドで、<code>ChromiumWebBrowser</code>ではなく<code>IBrowser</code>を使用する様に変更します。<br>
※CefSharpが自動的に作成したWebViewの場合、<code>ChromiumWebBrowser</code>インスタンスが存在しないため、戻るや進むといった操作は<code>IBrowser</code>を使用する様にする必要があります。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">SimpleBrowserFrameのメソッド変更</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">backBtn_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Browser</span><span class="p">.</span><span class="n">CanGoBack</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Browser</span><span class="p">.</span><span class="nf">GoBack</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">forwardBtn_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Browser</span><span class="p">.</span><span class="n">CanGoForward</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Browser</span><span class="p">.</span><span class="nf">GoForward</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">reloadBtn_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Browser</span><span class="p">.</span><span class="nf">Reload</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>以上で、新しく作成されたWebViewのインスタンスの情報を親フォームが受け取り、その後の各種操作ができるようになりました。</p>

<h2>
<span id="225-chromiumwebbrowserlifespanhandlerにilifespanhandlerを設定" class="fragment"></span><a href="#225-chromiumwebbrowserlifespanhandler%E3%81%ABilifespanhandler%E3%82%92%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>22.5 ChromiumWebBrowser.LifeSpanHandlerにILifeSpanHandlerを設定</h2>

<p><a href="https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_WinForms_ChromiumWebBrowser_LifeSpanHandler.htm" rel="nofollow noopener" target="_blank">ChromiumWebBrowser.LifeSpanHandler</a></p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ILifeSapbHandlerの設定</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">InitializeWebBrowser</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// （省略）</span>

    <span class="c1">// LifeSpanHandlerをWebViewに設定する</span>
    <span class="n">WebBrowser</span><span class="p">.</span><span class="n">LifeSpanHandler</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Handlers</span><span class="p">.</span><span class="nf">LifeSpanHandler</span><span class="p">();</span>

    <span class="c1">// （省略）</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>以上で、子ウィンドウの作成をコントロールできるようになりました。</p>

<h2>
<span id="226-リサイズの対応" class="fragment"></span><a href="#226-%E3%83%AA%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AE%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>22.6 リサイズの対応</h2>

<p>これまでの実装で子ウィンドウの作成ができるようになっていますが、現状では子ウィンドウをリサイズした時にWebViewのサイズがそのままになってしまっています。そこで、リサイズに対応させます。<br>
具体的には、<code>SimpleBrowserFrame</code>フォームの<code>Resize</code>イベントのイベントハンドラを追加して、その中でWebViewのサイズを変更することになります。しかし、WebViewのウィンドウは<code>Native</code>ウィンドウですので、<code>Pinvoke</code>を使う必要があります。少し汚いですが、以下の様になります。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Resizeに対応</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">SimpleBrowserFrame</span> <span class="p">:</span> <span class="n">Form</span>
<span class="p">{</span>
    <span class="c1">// (省略)</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">SimpleBrowserFrame_Resize</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Browser</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// WebViewのウィンドウハンドルを取得する</span>
            <span class="n">IntPtr</span> <span class="n">hWnd</span> <span class="p">=</span> <span class="n">Browser</span><span class="p">.</span><span class="nf">GetHost</span><span class="p">().</span><span class="nf">GetWindowHandle</span><span class="p">();</span>

            <span class="c1">// WebViewのサイズを変更する。</span>
            <span class="nf">SetWindowPos</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">HWND_TOP</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">webViewContainer</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span> <span class="n">webViewContainer</span><span class="p">.</span><span class="n">Height</span><span class="p">,</span> <span class="n">SetWindowPosFlags</span><span class="p">.</span><span class="n">SWP_NOMOVE</span> <span class="p">|</span> <span class="n">SetWindowPosFlags</span><span class="p">.</span><span class="n">SWP_NOZORDER</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">SetLastError</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">bool</span> <span class="nf">SetWindowPos</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hWnd</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">hWndInsertAfter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">X</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cy</span><span class="p">,</span> <span class="n">SetWindowPosFlags</span> <span class="n">uFlags</span><span class="p">);</span>

    <span class="p">[</span><span class="n">Flags</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">enum</span> <span class="n">SetWindowPosFlags</span> <span class="p">:</span> <span class="kt">uint</span>
    <span class="p">{</span>
        <span class="n">SWP_ASYNCWINDOWPOS</span> <span class="p">=</span> <span class="m">0x4000</span><span class="p">,</span>
        <span class="n">SWP_DEFERERASE</span> <span class="p">=</span> <span class="m">0x2000</span><span class="p">,</span>
        <span class="n">SWP_DRAWFRAME</span> <span class="p">=</span> <span class="m">0x0020</span><span class="p">,</span>
        <span class="n">SWP_FRAMECHANGED</span> <span class="p">=</span> <span class="m">0x0020</span><span class="p">,</span>
        <span class="n">SWP_HIDEWINDOW</span> <span class="p">=</span> <span class="m">0x0080</span><span class="p">,</span>
        <span class="n">SWP_NOACTIVATE</span> <span class="p">=</span> <span class="m">0x0010</span><span class="p">,</span>
        <span class="n">SWP_NOCOPYBITS</span> <span class="p">=</span> <span class="m">0x0100</span><span class="p">,</span>
        <span class="n">SWP_NOMOVE</span> <span class="p">=</span> <span class="m">0x0002</span><span class="p">,</span>
        <span class="n">SWP_NOOWNERZORDER</span> <span class="p">=</span> <span class="m">0x0200</span><span class="p">,</span>
        <span class="n">SWP_NOREDRAW</span> <span class="p">=</span> <span class="m">0x0008</span><span class="p">,</span>
        <span class="n">SWP_NOREPOSITION</span> <span class="p">=</span> <span class="m">0x0200</span><span class="p">,</span>
        <span class="n">SWP_NOSENDCHANGING</span> <span class="p">=</span> <span class="m">0x0400</span><span class="p">,</span>
        <span class="n">SWP_NOSIZE</span> <span class="p">=</span> <span class="m">0x0001</span><span class="p">,</span>
        <span class="n">SWP_NOZORDER</span> <span class="p">=</span> <span class="m">0x0004</span><span class="p">,</span>
        <span class="n">SWP_SHOWWINDOW</span> <span class="p">=</span> <span class="m">0x0040</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">IntPtr</span> <span class="n">HWND_TOP</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">IntPtr</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">IntPtr</span> <span class="n">HWND_BOTTOM</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">IntPtr</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">IntPtr</span> <span class="n">HWND_TOPMOST</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">IntPtr</span><span class="p">(-</span><span class="m">1</span><span class="p">);</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">IntPtr</span> <span class="n">HWND_NOTOPMOST</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">IntPtr</span><span class="p">(-</span><span class="m">2</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="227-動作確認" class="fragment"></span><a href="#227-%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>22.7 動作確認</h2>

<p>ビルドして実行してみます。<br>
ポップアップウィンドウの例として、Windows update catalogを使ってみます。<br>
アドレスバーに<a href="https://www.catalog.update.microsoft.com/Search.aspx?q=KB4589208" rel="nofollow noopener" target="_blank">https://www.catalog.update.microsoft.com/Search.aspx?q=KB4589208</a>を入力してENTERを押下します。そして、適当なアップテートをクリックすると、新しい子ウィンドウが作成されることが確認できます。<br>
その後、新しい子ウィンドウのアドレスバーで<a href="https://www.google.co.jp/" rel="nofollow noopener" target="_blank">https://www.google.co.jp/</a>を入力してENTERを押下した後、戻るボタンや進むボタンをクリックすると、子ウィンドウのナビゲートができていることが確認できると思います。</p>

<p>ただし、現在の実装では、最初のウィンドウを閉じると、すべての子ウィンドウが閉じられる動作になっています。本格的なブラウザを作成する場合は、タブを収容するフレームを親ウィンドウにして、子ウィンドウをタブ表示にする方式が良いです。</p>

<h1>
<span id="23-cefsharpの特徴" class="fragment"></span><a href="#23-cefsharp%E3%81%AE%E7%89%B9%E5%BE%B4"><i class="fa fa-link"></i></a>23. CefSharpの特徴</h1>

<p>個人的な感想ですが、良い点と悪い点をまとめます。</p>

<h2>
<span id="231-良い点" class="fragment"></span><a href="#231-%E8%89%AF%E3%81%84%E7%82%B9"><i class="fa fa-link"></i></a>23.1 良い点</h2>

<ul>
<li><p>chromiumベースのWebViewアプリが簡単に作れる<br>
少ないコードで完全なchromiumベースのWebViewを持つアプリケーションが作成できる。<br>
chromiumベースなので、HTML5、CSS5の最新仕様に準拠している。  </p></li>
<li><p>ブラウジングの様々な契機をハンドリングできる</p></li>
<li><p>コンテンツの変更やscriptの埋め込みが簡単にできる</p></li>
<li><p>独自機能を組み込んで、javascriptから利用させることができる</p></li>
<li><p>開発者ツールも起動できる<br>
F12キーで表示される開発者ツールも、簡単に表示することができる。<br>
アプリケーションのデバッグもChromeと全く同じようにできる。</p></li>
<li><p>chrome driverで試験もできる<br>
seleniumもappiumも使用することができる。<br>
テストに関してはchromeと同じようにすることができる。</p></li>
</ul>

<h2>
<span id="232-悪い点" class="fragment"></span><a href="#232-%E6%82%AA%E3%81%84%E7%82%B9"><i class="fa fa-link"></i></a>23.2 悪い点</h2>

<ul>
<li><p>バージョンアップにより仕様が変わりすぎる<br>
chromiumのバージョンに追従しているので、バージョンアップの頻度が非常に高い。<br>
また、バージョンアップの度に、<code>breaking changes</code>という致命的な変更が行われるために、改造しないとビルドが通らなくなってしまう。</p></li>
<li><p>ファイルサイズが大きい<br>
chromiumのライブラリが含まれるため、小さく作っても150MB以上のファイルサイズになってしまう。<br>
企業で使用する場合、端末へファイルを配布する方法を考える必要がある。</p></li>
<li><p>動かないオプションがある<br>
CefSharpのAPIマニュアルに書かれているオプションでも動作しないものがある。<br>
実際に動作するかどうかは動かしてみないと分からない。</p></li>
<li><p>コマンドラインオプションの仕様が明確でない<br>
非公式なサイトに様々なコマンドラインオプションが紹介されていますが、実際に動作するかどうかは確認してみないと分からない。<br>
また、バージョンによって、動作したり、動作しなかったりもする。</p></li>
<li><p>geolocation APIや3rd-party Cookieのブロックなど、Chromeにあるのに利用できない機能がある<br>
geolocation APIは、独自で作成して公開することで対応することはできる。<br>
3rd-party Cookieは、自分で判断してブロックすることはできる。</p></li>
</ul>

<h2>
<span id="233-まとめ" class="fragment"></span><a href="#233-%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>23.3 まとめ</h2>

<p>UWP用のEdgeのWebViewもありますが、Windowsで高度なカスタマイズを行えるWebViewとなると、今のところCefSharp一択ではないかと思います。</p>

<p>最後まで読んでいただき、ありがとうございました。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fmasahiro-furuichi%2Fitems%2Fff3a1abf25a64cef7cdd&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fmasahiro-furuichi%2Fitems%2Fff3a1abf25a64cef7cdd&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/masahiro-furuichi/items/ff3a1abf25a64cef7cdd/likers" class="css-1iupg5d">9</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">11</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ff3a1abf25a64cef7cdd/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/masahiro-furuichi/items/ff3a1abf25a64cef7cdd/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/masahiro-furuichi/items/ff3a1abf25a64cef7cdd/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/masahiro-furuichi/items/ff3a1abf25a64cef7cdd/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/masahiro-furuichi/items/ff3a1abf25a64cef7cdd.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-e2992ea6-a919-40c3-bbd3-e71a3ef55176">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-f6cad6c4-5178-4719-a06c-755babb83b96"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-f6cad6c4-5178-4719-a06c-755babb83b96">{}</script>
      
<div id="LoginModal-react-component-ac5c6cec-e7a4-405e-b6e2-d317e9e5af90"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-ac5c6cec-e7a4-405e-b6e2-d317e9e5af90">{}</script>
      
<div id="StockModal-react-component-2afdfd67-2434-4e1d-bb2a-dd4f5095ca5b"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-2afdfd67-2434-4e1d-bb2a-dd4f5095ca5b">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;W0c9WG99lp1h1ScB73Ip7tHzUOc4tI3eEdq+LYY1iLBj6PcvwUdrMqFn4YbtIwzM7OdJSEvYXgps3Hs6h5j8Cg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"1-目的\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E7%9B%AE%E7%9A%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. 目的\u003c/h1\u003e\n\n\u003cp\u003eCefSharpでカスタムWebブラウザを作成します。\u003cbr\u003e\nCefSharpはChromiumをコアとするOpenSourceのWebViewです。\u003cbr\u003e\nCefはChromiumをコアとしているので、ほぼChromeと同等のWebブラウザを作成することができます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/cefsharp/CefSharp\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/cefsharp/CefSharp\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e.NET FrameworkのWPFとWinformsで利用可能なコントロールとして提供されていますが、今回はWinforms版でカスタムWebブラウザを作ります。言語はC#を使います。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"2-最初の最初\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-%E6%9C%80%E5%88%9D%E3%81%AE%E6%9C%80%E5%88%9D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. 最初の最初\u003c/h1\u003e\n\n\u003cp\u003e以下の流れでWinformプロジェクトを作成して、一番シンプルなカスタムWebブラウザを作成します。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e新規プロジェクト作成する\u003c/li\u003e\n\u003cli\u003eNugetパッケージの取り込む\u003c/li\u003e\n\u003cli\u003eWebViewを貼り付ける\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eまだVisual Studioをインストールしていない場合は、以下のサイトから\u003ccode\u003eVisual Studio Express\u003c/code\u003e(無料)のインストーラをダウンロードして、インストールしましょう。\u003cbr\u003e\n\u003ca href=\"https://visualstudio.microsoft.com/ja/vs/express/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVisual Studio Express\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"21-新規プロジェクトの作成する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#21-%E6%96%B0%E8%A6%8F%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.1 新規プロジェクトの作成する\u003c/h2\u003e\n\n\u003cp\u003eC#のWinformsのプロジェクトを新規作成します。\u003cbr\u003e\n以下は、Visual Studio 2019 Expressでのやり方になります。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e「新しいプロジェクトの作成」をクリックします。\u003c/li\u003e\n\u003cli\u003e「Windowsフォームアプリケーションの作成(.NET Framework)」を選択して「次へ」をクリックします。\u003c/li\u003e\n\u003cli\u003eプロジェクト名と場所を指定して、「作成」をクリックします。\u003cbr\u003e\nここでは、「SimpleBrowser」としました。\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e作成されるプロジェクトのフォームの名称がデフォルトで「Form1.cs」とカッコ悪いので、「ソリューション エクスプローラ」で「Form1.cs」を選択して、コンテキストメニューから「名前の変更」を選択して、適当な名前に変更します。\u003cbr\u003e\nここでは、「SimpleBrowserFrame.cs」としました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f4da792a3449a67e6de52798e7acf36b413678d6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f36623233353532662d356230362d393436372d643038392d6561613531383763306435652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F6b23552f-5b06-9467-d089-eaa5187c0d5e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8d0df71ffe6f10a386f9c60506c7ac8d\" alt=\"ソリューションエクスプローラ.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/6b23552f-5b06-9467-d089-eaa5187c0d5e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F6b23552f-5b06-9467-d089-eaa5187c0d5e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=eee9604dd6984a68b56ce7ba9d49af7d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eCefSharpは「AnyCPU」でビルドできないので、構成マネージャで「AnyCPU」を削除して「x64」と「x86」を追加します。\u003cbr\u003e\n※「x64」と「x86」のいずれか1つでももちろんOKです。\u003cbr\u003e\nソリューションエクスプローラでソリューションを選択して、コンテキストメニューから「バッチビルド」を選択すると、以下のような構成に見えるはずです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/47ebb2c2801ba205fb0ea7414166025438690250/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f35303865336338662d666331312d316464362d386531392d6334306566316333653862652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F508e3c8f-fc11-1dd6-8e19-c40ef1c3e8be.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=23ba04250d4ea2084d5bb23a91865ba6\" alt=\"構成.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/508e3c8f-fc11-1dd6-8e19-c40ef1c3e8be.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F508e3c8f-fc11-1dd6-8e19-c40ef1c3e8be.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a53784249ff919eb276e614653bb87cf 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"22-nugetパッケージの取り込む\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#22-nuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E5%8F%96%E3%82%8A%E8%BE%BC%E3%82%80\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.2 Nugetパッケージの取り込む\u003c/h2\u003e\n\n\u003cp\u003eCefSharpのNugetパッケージを取り込みます。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eソリューションエクスプローラで「SimpleBrowser」を選択して、コンテキストメニューから「NuGetパッケージの管理」を選択します。\u003c/li\u003e\n\u003cli\u003eNuGetパッケージマネージャで、「参照」タブを選択します。\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e検索ボックスに「CefSharp」と入力して検索を実行すると、CefSharp関連のNugetパッケージが表示されます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b431531156b300109d57d2df293e095e7607873a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f38653732316633362d393163302d313064642d656130312d3164393032666530336331642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F8e721f36-91c0-10dd-ea01-1d902fe03c1d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=57aec898cc592802e0a0b56008f7a131\" alt=\"Nuget.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/8e721f36-91c0-10dd-ea01-1d902fe03c1d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F8e721f36-91c0-10dd-ea01-1d902fe03c1d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=00f01cac2b1947fd5dd34bcf035edd9a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e以下のNugetパッケージをインストールします。 \u003cbr\u003e\n※CefSharp.WinFormsをインストールすると、芋ずる式にすべてインストールされます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eCefSharp.WinForms\u003c/li\u003e\n\u003cli\u003eCefSharp.Common\u003c/li\u003e\n\u003cli\u003ecef.redist.x64\u003c/li\u003e\n\u003cli\u003ecef.redist.x86\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e表示されているバージョン「v85.3.130」は、chromiumのバージョンとほぼ一致しています。\u003cbr\u003e\nもし特定のバージョンのchromiumを使いたい場合は、バージョンを指定してNugetを取り込みます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"23-webviewを貼り付ける\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#23-webview%E3%82%92%E8%B2%BC%E3%82%8A%E4%BB%98%E3%81%91%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.3 WebViewを貼り付ける\u003c/h2\u003e\n\n\u003cp\u003eCefSharpのWebViewであるChromiumWebBrowserコントロールをフォームに貼り付けます。\u003cbr\u003e\nChromiumWebBrowserはツールボックスにも表示されますが、ツールボックスからはコントロールを貼り付けできないので、フォームのコード(SimpleBrowserFrame.cs)に直接以下を記述します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSimpleBrowserFrame.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.ComponentModel\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Data\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Drawing\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Text\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Windows.Forms\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp.WinForms\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \u0026lt;- 追加\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eForm\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// CefSharpのWebViewのインスタンス\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eChromiumWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eInitializeComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// CefSharpのWebViewを作成する。\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 初期ページはgoogleにする。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eChromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"https://www.google.co.jp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// コントロールを追加する。\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eControls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDock\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDockStyle\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFill\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"24-ビルドして実行する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#24-%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.4 ビルドして実行する\u003c/h2\u003e\n\n\u003cp\u003e何も考えずに実行すると、以下の様な非常にシンプルなWebブラウザが表示されます。\u003cbr\u003e\n  \u003ca href=\"https://camo.qiitausercontent.com/edfaf243860cdbf3bb0a2a9810af07f4886f0b10/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f39663762336238662d353639612d633966622d323063312d3734366432303337303564342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F9f7b3b8f-569a-c9fb-20c1-746d203705d4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b85961391e9a142c4412c28ac3ec2686\" alt=\"browser01.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/9f7b3b8f-569a-c9fb-20c1-746d203705d4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F9f7b3b8f-569a-c9fb-20c1-746d203705d4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d1d7ca688cb4d30117995734bfe86410 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"25-バージョンを確認する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#25-%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.5 バージョンを確認する\u003c/h2\u003e\n\n\u003cp\u003e初期URLを以下のように\u003ccode\u003echrome://version\u003c/code\u003eに変更して実行してみると、バージョンのページが表示されます。\u003cbr\u003e\u003cbr\u003e\nこのようにchromeのカスタムスキーマの一部も表示させることができます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003echromeのバージョン確認\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//WebBrowser = new ChromiumWebBrowser(\"https://www.google.co.jp\");\u003c/span\u003e\n\u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eChromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"chrome://version\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e    \u003cspan class=\"c1\"\u003e// 変更する。\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/15286d63355535be21d0f7247a8938c89924dd93/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f33386637616462632d313839362d623261372d616661332d3937333233393661386535622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F38f7adbc-1896-b2a7-afa3-9732396a8e5b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=07d738001e4ee0c2f820dedd2b84c373\" alt=\"browser02.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/38f7adbc-1896-b2a7-afa3-9732396a8e5b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F38f7adbc-1896-b2a7-afa3-9732396a8e5b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=31305d84a3c40dde63d151b059155668 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"3-最低限の設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. 最低限の設定\u003c/h1\u003e\n\n\u003cp\u003eChromiumWebBrowserをnewして貼り付けるだけでも、Webコンテンツを表示することができますが、幾つかの最低限の設定をしておきます。\u003cbr\u003e\n具体的には、以下の2つの方法で設定します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_Cef_Initialize_3.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCef.Initialize\u003c/a\u003eメソッド\u003cbr\u003e\nChromiumWebBrowserをnewする前に、一度だけ実行します。\u003cbr\u003e\nChromiumWebBrowserを作成した後は、呼び出して設定を変更することはできません。\u003cbr\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_WinForms_ChromiumWebBrowser_BrowserSettings.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eChromiumWebBrowser.BrowserSettings\u003c/a\u003eプロパティ\u003cbr\u003e\nChromiumWebBrowserのインスタンスを作成した後に、インスタンス毎に設定します。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"31-cefinitializeメソッドによる初期化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#31-cefinitialize%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AB%E3%82%88%E3%82%8B%E5%88%9D%E6%9C%9F%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.1 Cef.Initializeメソッドによる初期化\u003c/h2\u003e\n\n\u003cp\u003eCef.Initializeメソッドでは、以下の設定を行います。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"キャッシュ用ディレクトリのパス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E7%94%A8%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AE%E3%83%91%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eキャッシュ用ディレクトリのパス\u003c/h3\u003e\n\n\u003cp\u003eキャッシュ用ディレクトリは、ブラウザコンテンツのキャッシュのほかに以下の情報が格納されます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ehistory\u003c/li\u003e\n\u003cli\u003ecookie\u003c/li\u003e\n\u003cli\u003eindexedDB\u003c/li\u003e\n\u003cli\u003elocalStorage\u003c/li\u003e\n\u003cli\u003esessionStorage\u003c/li\u003e\n\u003cli\u003eapplication cache\u003cbr\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eキャッシュ用ディレクトリを設定するには、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_CefSettingsBase_CachePath.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCefSettingsBase.CachePath\u003c/a\u003eプロパティに絶対パスでキャッシュ用ディレクトリのパスを指定します。\u003cbr\u003e\n\u003ccode\u003enull\u003c/code\u003eを指定した場合は、キャッシュが作成されないインメモリモード(incognito mode)になります。インメモリモードの場合、indexedDB、localStorageおよびapplication cacheは、もちろん保存されなくなります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eキャッシュ用ディレクトリの設定方法\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eCefSettings\u003c/span\u003e \u003cspan class=\"n\"\u003esettings\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCefSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// キャッシュディレクトリの設定\u003c/span\u003e\n\u003cspan class=\"n\"\u003esetting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esettings\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"c:\\temp\\cache\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"useragent文字列設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#useragent%E6%96%87%E5%AD%97%E5%88%97%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUserAgent文字列設定\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_CefSettingsBase_UserAgent.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCefSettingsBase.UserAgent\u003c/a\u003eで、UserAgent文字列を自由に設定することができます。\u003cbr\u003e\nしかし、デフォルトのUserAgent文字列を取得することはできません。\u003cbr\u003e\nデフォルトのUserAgent文字列を確認するには、開発者ツールでHTTPリクエストヘッダを確認する必要があります。\u003cbr\u003e\nちなみに、デフォルトのUserAgent文字列はx86とx64で異なっています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eUserAgentの設定方法\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eCefSettings\u003c/span\u003e \u003cspan class=\"n\"\u003esettings\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCefSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 独自のUserAgent文字列を指定する\u003c/span\u003e\n\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserAgent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36 SimpleBroser/1.0.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"言語の設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%80%E8%AA%9E%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e言語の設定\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_CefSettingsBase_AcceptLanguageList.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCefSettingsBase.AcceptLanguageList\u003c/a\u003eに、受け入れる\u003ca href=\"https://ja.wikipedia.org/wiki/IETF%E8%A8%80%E8%AA%9E%E3%82%BF%E3%82%B0\" rel=\"nofollow noopener\" target=\"_blank\"\u003e言語\u003c/a\u003eをカンマ区切りのリストで指定します\u003cbr\u003e\nここで指定した言語リストは、HTTPリクエストヘッダの\u003ccode\u003eAccept-Language\u003c/code\u003eに指定されます。\u003cbr\u003e\nchromeのリクエストヘッダを見ると、\u003ccode\u003eja,en-US;q=0.9,en;q=0.8\u003c/code\u003eと設定されており、日本語とアメリカ英語と英語が重み付けを含めて指定されていることが確認できます。\u003cbr\u003e\nここではchromeと同じ設定にしてみます。  \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e言語の設定方法\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eCefSettings\u003c/span\u003e \u003cspan class=\"n\"\u003esettings\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCefSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 受け入れる言語リストを指定する\u003c/span\u003e\n\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAcceptLanguageList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ja,en-US;q=0.9,en;q=0.8\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ログレベルの設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AD%E3%82%B0%E3%83%AC%E3%83%99%E3%83%AB%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eログレベルの設定\u003c/h3\u003e\n\n\u003cp\u003eデフォルトでChromiumのデバッグログ(\u003ccode\u003edebug.log\u003c/code\u003e)が出力されます。\u003cbr\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_CefSettingsBase_LogSeverity.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCefSettingsBase.LogSeverity\u003c/a\u003eでログのレベルを変更することで、ログ出力の内容を増やしたり、ログを出力しないようにすることができます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eログの設定方法\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eCefSettings\u003c/span\u003e \u003cspan class=\"n\"\u003esettings\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCefSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// ログレベルを指定する。\u003c/span\u003e\n\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLogSeverity\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eLogSeverity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVerbose\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"コマンドライン引数設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E5%BC%95%E6%95%B0%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコマンドライン引数設定\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_CefSettingsBase_CefCommandLineArgs.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCefSettingsBase.CefCommandLineArgs\u003c/a\u003eに、Chromeのコマンドライン引数を追加することができます。ただし、Chromiumのコマンドラインオプションはあまりドキュメント化されておらず、また実際に機能するかは、試してみないと分からないです。\u003cbr\u003e\nここでは、\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/API/MediaDevices/getUserMedia\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMediaDevices.getUserMedia()\u003c/a\u003eメソッドで、カメラにアクセスできるようにするために、\u003ccode\u003eenable-media-stream\u003c/code\u003eオプションを設定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eコマンドライン引数の設定方法\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eCefSettings\u003c/span\u003e \u003cspan class=\"n\"\u003esettings\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCefSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// カメラにアクセスできるようにする\u003c/span\u003e\n\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCefCommandLineArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"enable-media-stream\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e以上の設定をまとめると、以下のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCef.Initializeによる初期化の例\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eCefSettings\u003c/span\u003e \u003cspan class=\"n\"\u003esettings\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCefSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAcceptLanguageList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ja,en-US;q=0.9,en;q=0.8\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eCachePath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"c:\\temp\\cache\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eUserAgent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36 SimpleBroser/1.0.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eLogSeverity\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eLogSeverity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVerbose\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// カメラにアクセスできるようにする\u003c/span\u003e\n\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCefCommandLineArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"enable-media-stream\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Application.Runの前に初期化を呼び出す。\u003c/span\u003e\n\u003cspan class=\"n\"\u003eCef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInitialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"cookie用ディレクトリの設定おまけ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cookie%E7%94%A8%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%8A%E3%81%BE%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCookie用ディレクトリの設定(おまけ)\u003c/h3\u003e\n\n\u003cp\u003eバージョン73.1.xまでは、Cookie用のディレクトリはキャッシュ用フォルダと別に指定することができましたが、75.1.x以降はキャッシュ用ディレクトリ配下にCookieが作成されるようになり、cookie用ディレクトリは個別に設定することはできなくなりました。バージョン73.1.x以前を使用する場合は、\u003ca href=\"https://cefsharp.github.io/api/73.1.x/html/M_CefSharp_ICookieManager_SetStoragePath.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eICookieManager.SetStoragePath\u003c/a\u003eを呼び出して、cookieのパスを指定します。呼び出しのタイミングは\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IBrowserProcessHandler_OnContextInitialized.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIBrowserProcessHandler.OnContextInitialized\u003c/a\u003eになります。\u003cbr\u003e\n参考のために、設定例を以下に示します。※このメソッドは、75.1.x以降は使用できません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCookie用ディレクトリの設定方法\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBrowserProcessHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowserProcessHandler\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowserProcessHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnContextInitialized\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// グローバールCookieマネージャを取得して、Cookieのパスを設定する。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eICookieManager\u003c/span\u003e \u003cspan class=\"n\"\u003ecookieManager\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetGlobalCookieManager\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecookieManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetStoragePath\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"c:\\temp\\cookie\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowserProcessHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnScheduleMessagePumpWork\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003edelay\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"32-chromiumwebbrowserbrowsersettingsによる初期化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#32-chromiumwebbrowserbrowsersettings%E3%81%AB%E3%82%88%E3%82%8B%E5%88%9D%E6%9C%9F%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.2 ChromiumWebBrowser.BrowserSettingsによる初期化\u003c/h2\u003e\n\n\u003cp\u003eChromiumWebBrowserインスタンスをnewした後、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_WinForms_ChromiumWebBrowser_BrowserSettings.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eChromiumWebBrowser.BrowserSettings\u003c/a\u003eプロパティで主に以下の項目を設定することができます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eApplication cacheの使用許可\u003c/li\u003e\n\u003cli\u003eフォントファミリー\u003c/li\u003e\n\u003cli\u003eフォントサイズ\u003c/li\u003e\n\u003cli\u003eJavascriptの使用許可\u003c/li\u003e\n\u003cli\u003eJavascriptでdocument.execCommandを使ったcopy\u0026amp;pasteの使用許可\u003c/li\u003e\n\u003cli\u003eLocalStorageの使用許可\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこれらを設定する例を以下に示します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eBrowserSettingsの設定による初期化方法\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eInitializeComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// CefSharpのWebViewを作成する。\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eChromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"https://www.google.co.jp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// コントロールを追加する。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eControls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDock\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDockStyle\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFill\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// javascriptを有効にする。（書かなくても有効です）\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eJavascript\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCefState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// document.execCommandでのcopy\u0026amp;pasteを有効にする。\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eJavascriptDomPaste\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCefState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ApplicationCacheを有効にする。\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eApplicationCache\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCefState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// localStorageを有効にする。\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLocalStorage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCefState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// フォントサイズを設定する。(レイアウトがずれる場合があるので注意)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultFontSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eなお、ドキュメントに書かれていても、実際には機能しない設定もあるので注意が必要です。\u003cbr\u003e\n具体的には、以下は機能しませんでした。  \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_IBrowserSettings_Databases.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIBrowserSettings.Databases\u003c/a\u003e\u003cbr\u003e\nindexedDBの使用許可・禁止ができると書かれていますが、indexedDBを使用禁止にすることはできませんでした。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_IBrowserSettings_JavascriptAccessClipboard.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIBrowserSettings.JavascriptAccessClipboard\u003c/a\u003e\u003cbr\u003e\njavascriptからclipboardを操作できるように書かれていますが、有効になるように設定しても、\u003ccode\u003enavigator.clipboard.writetext\u003c/code\u003e等のclipboard APIはアクセス拒否されます。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"4-proxyの設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-proxy%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4. Proxyの設定\u003c/h1\u003e\n\n\u003cp\u003eデフォルトでは、システムのインターネットオプションで指定しているProxy設定が使用されますが、システムのインターネットオプションと別に、独自のProxy設定を行うことができます。Proxy設定の方法は、以下のいずれかの方法で行います。  \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e(方法1)CefSharpSettings.Proxyで設定\u003c/li\u003e\n\u003cli\u003e(方法2)コマンドラインオプションで指定\u003c/li\u003e\n\u003cli\u003e(方法3)WebViewのリクエストコンテキストで指定\u003c/li\u003e\n\u003cli\u003e(方法4)プログラム全体のリクエストコンテキストで指定\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"41-方法1cefsharpsettingsproxyで設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#41-%E6%96%B9%E6%B3%951cefsharpsettingsproxy%E3%81%A7%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.1 (方法1)CefSharpSettings.Proxyで設定\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_CefSharpSettings_Proxy.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCefSharpSettings.Proxy\u003c/a\u003eスタティックメソッドを使用します。\u003cbr\u003e\nIP、Port、UserName、Password、BypassListを設定することで、自動的にProxyサーバの認証処理も行うようになります。\u003cbr\u003e\nこの方法の場合は、ユーザに認証情報の入力を求めることができません。\u003cbr\u003e\nまた、一度設定すると、プロセスが終了するまで変更することができません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eProxyの設定方法1\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Cef.Initializeの前に呼び出す。\u003c/span\u003e\n\u003cspan class=\"n\"\u003eCefSharpSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eProxy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eProxyOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"127.0.0.1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"8080\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"UserName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Password\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"192.168.0.*;*.test.com\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eCef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInitialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"42-方法2コマンドラインオプションで指定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#42-%E6%96%B9%E6%B3%952%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E6%8C%87%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.2 (方法2)コマンドラインオプションで指定\u003c/h2\u003e\n\n\u003cp\u003e以下のコマンドラインオプションを指定します。\u003cbr\u003e\nこれが一番簡単です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eproxy-server\u003c/code\u003eオプションでIPとPORTを指定する。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eproxy-bypass-list\u003c/code\u003eオプションでBypassListを指定する。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eProxyの設定方法2\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eCefSettings\u003c/span\u003e \u003cspan class=\"n\"\u003esettings\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCefSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// プロキシ情報を設定する。\u003c/span\u003e\n\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCefCommandLineArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"proxy-server\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"127.0.0.1:8080\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCefCommandLineArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"proxy-bypass-list\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"192.168.0.*;*.test.com\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eCef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInitialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの方法の場合、ユーザに認証情報の入力を求める処理を実装することができます。\u003cbr\u003e\n認証情報が必要になると自動的に認証処理が呼び出されます(詳細は「\u003ca href=\"#9-%E8%AA%8D%E8%A8%BC\"\u003e9. 認証\u003c/a\u003e」を参照)。\u003cbr\u003e\nこの方法も一度設定すると、プロセスが終了するまで変更することができません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"43-方法3webviewのリクエストコンテキストで指定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#43-%E6%96%B9%E6%B3%953webview%E3%81%AE%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%A7%E6%8C%87%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.3 (方法3)WebViewのリクエストコンテキストで指定\u003c/h2\u003e\n\n\u003cp\u003eWebViewのリクエストコンテキスト(\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_IBrowserHost_RequestContext.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIBrowserHost.RequestContext\u003c/a\u003e)に対して、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestContext_SetPreference.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestContext.SetPreference\u003c/a\u003eメソッドを呼び出して、プロキシの情報を設定します。最も細かくProxyを設定できる方法で、複数のWebViewがある場合でも、それぞれのWebViewで別々のProxyを設定することができます。\u003cbr\u003e\u003cbr\u003e\nこの方法の場合も、ユーザに認証情報の入力を求める処理を実装することができます。\u003cbr\u003e\n認証情報が必要になると自動的に認証処理が呼び出されます(詳細は「\u003ca href=\"#9-%E8%AA%8D%E8%A8%BC\"\u003e9. 認証\u003c/a\u003e」を参照)。\u003cbr\u003e\nまた、途中でプロキシ設定を変更することもできます。\u003c/p\u003e\n\n\u003cp\u003e第一引数に\u003ccode\u003e\"proxy\"\u003c/code\u003eという文字列、第二引数に以下のKey\u0026amp;Valueを持つDictionaryインスタンスを指定して、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestContext_SetPreference.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestContext.SetPreference\u003c/a\u003eメソッドを呼び出します。※この部分はドキュメントが少ないです。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eKey\u003c/th\u003e\n\u003cth\u003eValue\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003emode\u003c/td\u003e\n\u003ctd\u003e\"fixed_servers\"を指定します\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eserver\u003c/td\u003e\n\u003ctd\u003eプロキシサーバとポート番号を指定します\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ebypass_list\u003c/td\u003e\n\u003ctd\u003eプロキシサーバをバイパスするURLのリストを指定します\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eProxyの設定方法3\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eCef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUIThreadTaskFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStartNew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// プロキシに設定する内容をDictionaryオブジェクトで設定する\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"mode\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"fixed_servers\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"server\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"localhost:8080\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"bypass_list\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"*.google.co.jp;*.nikkei.com\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// proxyを設定する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBrowserHost\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eRequestContext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetPreference\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"proxy\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eなお、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestContext_SetPreference.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestContext.SetPreference\u003c/a\u003eメソッドは必ずCef UI Threadのコンテキストで呼び出す必要があるため、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_Cef_UIThreadTaskFactory.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCef.UIThreadTaskFactory\u003c/a\u003eスタティックメソッドを使って、呼び出しのコンテキストを強制する必要があります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"44-方法4プログラム全体のリクエストコンテキストで指定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#44-%E6%96%B9%E6%B3%954%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E5%85%A8%E4%BD%93%E3%81%AE%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%A7%E6%8C%87%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.4 (方法4)プログラム全体のリクエストコンテキストで指定\u003c/h2\u003e\n\n\u003cp\u003e(方式3)とほぼ同じですが、WebView単位ではなく、プログラム全体でのリクエストコンテキストに対して、Proxy設定を行う方法になります。プログラム全体のリクエストコンテキストは\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_Cef_GetGlobalRequestContext.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCef.GetGlobalRequestContext\u003c/a\u003eメソッドで取得することができます。取得したRequestContextに対して、(方法3)と同じ処理を行います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eProxyの設定方法4\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eCef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUIThreadTaskFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStartNew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// プロキシに設定する内容をDictionaryオブジェクトで設定する\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"mode\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"fixed_servers\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"server\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"localhost:8080\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"bypass_list\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"*.google.co.jp;*.nikkei.com\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// グローバルなRequestContextに対してproxyを設定する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eCef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetGlobalRequestContext\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetPreference\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"proxy\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"5-開発者ツール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-%E9%96%8B%E7%99%BA%E8%80%85%E3%83%84%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5. 開発者ツール\u003c/h1\u003e\n\n\u003cp\u003e実験を行うには開発者ツールが便利です。\u003cbr\u003e\nCefSharpでは\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_WebBrowserExtensions_ShowDevTools.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWebBrowserExtensions.ShowDevTools\u003c/a\u003eメソッドを呼び出すだけで、Chromeでおなじみの開発者ツールを表示することができます。\u003cbr\u003e\nここでは、Chromeと同じように、F12キーが押下されると、開発者ツールを表示するようにします。  \u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"51-ikeyboardhandlerインタフェースを実装するクラスを作成する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#51-ikeyboardhandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5.1 IKeyboardHandlerインタフェースを実装するクラスを作成する\u003c/h2\u003e\n\n\u003cp\u003eキー押下をハンドリングするためには、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IKeyboardHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIKeyboardHandler\u003c/a\u003eインタフェースを実装するクラスを作成する必要があります。Visual Studioのソリューションエクスプローラで、コンテキストメニューから「追加」ー「クラス」を選択します。\u003cbr\u003e\nここではクラス名を\u003ccode\u003eKeyboardHandler\u003c/code\u003eにします。また、今後ハンドラが増えるので、ハンドラを実装するクラスを「Handlers」フォルダにまとめておきます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"52-作成したクラスでikeyboardhandlerを実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#52-%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7ikeyboardhandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5.2 作成したクラスでIKeyboardHandlerを実装する\u003c/h2\u003e\n\n\u003cp\u003e以下のように、\u003ccode\u003eIKeyboardHandler\u003c/code\u003eを実装させます。  \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIKeyboardHandlerを実装するクラス\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eKeyboardHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIKeyboardHandler\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e次に、\u003ccode\u003eIKeyboardHandler\u003c/code\u003eの文字列を選択すると電球マークが出るので、電球マークをクリックして、コンテキストメニューから「すべてのメンバーを明示的に実装する」を選択します。これで、Visual Studioが自動でインタフェースのメソッドのスケルトンを実装してくれます。  \u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"53-f12キー押下時の処理を追加する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#53-f12%E3%82%AD%E3%83%BC%E6%8A%BC%E4%B8%8B%E6%99%82%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5.3 F12キー押下時の処理を追加する。\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IKeyboardHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIKeyboardHandler\u003c/a\u003eインタフェースは\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IKeyboardHandler_OnKeyEvent.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnKeyEvent\u003c/a\u003eと\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IKeyboardHandler_OnPreKeyEvent.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnPreKeyEvent\u003c/a\u003eの2つのメソッドを持ちます。  \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eOnKeyEvent\u003c/code\u003e\u003cbr\u003e\nキーが押下されてページの描画処理やページ内のjavascriptがキーを受け取った\u003cstrong\u003e\u003cem\u003e後に\u003c/em\u003e\u003c/strong\u003e呼び出されるハンドラです。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eOnPreKeyEvent\u003c/code\u003e\u003cbr\u003e\nキーが押下されてページの描画処理やページ内のjavascriptにキーが通知される\u003cstrong\u003e\u003cem\u003e前に\u003c/em\u003e\u003c/strong\u003e呼び出されるハンドラです。\u003cbr\u003e\nここでは、\u003ccode\u003eOnPreKeyEvent\u003c/code\u003eでF12キーの押下をハンドリングして、開発者ツールを表示します。\u003cbr\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eキー押下処理の追加方法\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eKeyboardHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIKeyboardHandler\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eIKeyboardHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnKeyEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eKeyType\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enativeKeyCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e \u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisSystemKey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eIKeyboardHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnPreKeyEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eKeyType\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enativeKeyCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e \u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisSystemKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisKeyboardShortcut\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eKeyType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRawKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// VK_F12キー押下\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eF12\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 開発者ツールを表示する\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShowDevTools\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e                    \n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"54-webviewにハンドラを設定する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#54-webview%E3%81%AB%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5.4 WebViewにハンドラを設定する。\u003c/h2\u003e\n\n\u003cp\u003e作成したキー押下時のハンドラを、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_OffScreen_ChromiumWebBrowser_KeyboardHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eChromiumWebBrowser.KeyboardHandler\u003c/a\u003eプロパティに設定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eChromiumWebBrowserへのIKeyboardHandlerインタフェースの設定\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eForm\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// CefSharpのWebViewのインスタンス\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eChromiumWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eInitializeComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// CefSharpのWebViewを作成する。\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eChromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"https://www.google.co.jp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// いろいろと初期化処理\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//     :\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//     :\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// キーボードハンドラを設定する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eKeyboardHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eKeyboardHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"55-カスタムwebブラウザを起動してf12キー押下をしてみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#55-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0web%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%A6f12%E3%82%AD%E3%83%BC%E6%8A%BC%E4%B8%8B%E3%82%92%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5.5 カスタムWebブラウザを起動して、F12キー押下をしてみる。\u003c/h2\u003e\n\n\u003cp\u003eうまく行くと、以下の様なおなじみの開発者ツールが起動します。\u003cbr\u003e\n  \u003ca href=\"https://camo.qiitausercontent.com/97cdfe73657b29d42522551ad4c4e6a0c1d24caf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f65323134346537392d373534632d353239632d376266352d3032353630323537316234332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fe2144e79-754c-529c-7bf5-025602571b43.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=40ce265a24931589990caac268532e42\" alt=\"開発者ツール.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/e2144e79-754c-529c-7bf5-025602571b43.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fe2144e79-754c-529c-7bf5-025602571b43.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ae6f787cfb481a2808f29f430cfc02a1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eおー！表示されました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"6-戻る進む更新ロード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6-%E6%88%BB%E3%82%8B%E9%80%B2%E3%82%80%E6%9B%B4%E6%96%B0%E3%83%AD%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6. 戻る、進む、更新、ロード\u003c/h1\u003e\n\n\u003cp\u003e一般的なブラウジング操作として、戻る、進む、更新、ロードを実装します。\u003cbr\u003e\nまず、最初にショートカットキーの処理を実装して、次にUI操作からの処理を実装します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"61-ショートカットキー押下時の処理追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#61-%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%82%AD%E3%83%BC%E6%8A%BC%E4%B8%8B%E6%99%82%E3%81%AE%E5%87%A6%E7%90%86%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6.1 ショートカットキー押下時の処理追加\u003c/h2\u003e\n\n\u003cp\u003eショートカットキーの処理を実装するには、「\u003ca href=\"#5-%E9%96%8B%E7%99%BA%E8%80%85%E3%83%84%E3%83%BC%E3%83%AB\"\u003e5. 開発者ツール\u003c/a\u003e」で説明した\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IKeyboardHandler_OnPreKeyEvent.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnPreKeyEvent\u003c/a\u003eに処理を追加します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eALT+[←] 戻る\u003cbr\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IBrowser_GoBack.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIBrowser.GoBack\u003c/a\u003eメソッドを呼び出します。\u003cbr\u003e\n戻ることが可能な状況かどうかは、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_IBrowser_CanGoBack.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIBrowser.CanGoBack\u003c/a\u003eプロパティを確認することで判断します。\u003c/li\u003e\n\u003cli\u003eALT+[→]進む\u003cbr\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IBrowser_GoForward.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIBrowser.GoForward\u003c/a\u003eメソッドを呼び出します。\u003cbr\u003e\n進むことが可能な状況かどうかは、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_IBrowser_CanGoForward.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIBrowser.CanGoForward\u003c/a\u003eプロパティを確認することで判断します。\u003c/li\u003e\n\u003cli\u003eF5 更新\u003cbr\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IBrowser_Reload.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIBrowser.Reload\u003c/a\u003eメソッドを呼び出します。\u003cbr\u003e\nなお、ロード中に更新を許可させない場合は、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_IBrowser_IsLoading.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIBrowser.IsLoading\u003c/a\u003eを参照して、ロード中かどうかを判断します。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e以下は実装例です。  \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eキー押下処理の追加\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eIKeyboardHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnPreKeyEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eKeyType\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enativeKeyCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e \u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisSystemKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisKeyboardShortcut\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eKeyType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRawKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ALT+VK_LEFT\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLeft\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e  \u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAltDown\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCanGoBack\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 戻る\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGoBack\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ALT+VK_RIHGT\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRight\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAltDown\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCanGoForward\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 進む\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGoForward\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// VK_F5\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eF5\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 更新する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReload\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// (省略)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれで、戻る、進む、更新の操作がショートカットキーでできるようになりました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"62-ボタンとinputの配置\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#62-%E3%83%9C%E3%82%BF%E3%83%B3%E3%81%A8input%E3%81%AE%E9%85%8D%E7%BD%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6.2 ボタンとINPUTの配置\u003c/h2\u003e\n\n\u003cp\u003eショートカットと同じ処理を、UI操作からもできるようにします。\u003cbr\u003e\nまず、ユーザ操作を受け付けるために、「戻る」「進む」「更新」「アドレスバー」を配置します。\u003cbr\u003e\nGUIの編集ですので、以下で紹介するやり方にとらわれず、自由に作成しても問題ありません。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"tablelayoutpanelを配置する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tablelayoutpanel%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTableLayoutPanelを配置する。\u003c/h3\u003e\n\n\u003cp\u003eフォームにツールボックスから\u003ccode\u003eTableLayoutPanel\u003c/code\u003eを選んでドラッグ\u0026amp;ドロップします。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eTableLayoutPanel\u003c/code\u003eのDockをFillにして、フォーム全体をカバーするようにします。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eTableLayoutPanel\u003c/code\u003eの行と列を適当に配置します。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/c3dab38c2a0b8548b7160f8e2ca38db3c5a35b76/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f65343538643566642d326431652d633834642d316436342d3734333064376635376134332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fe458d5fd-2d1e-c84d-1d64-7430d7f57a43.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=77983d26f67e6e4612784d1353b8af87\" alt=\"レイアウト1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/e458d5fd-2d1e-c84d-1d64-7430d7f57a43.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fe458d5fd-2d1e-c84d-1d64-7430d7f57a43.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0e34bf517457692eb84a47b488e97244 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"webviewのコンテナを配置する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#webview%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWebViewのコンテナを配置する。\u003c/h3\u003e\n\n\u003cp\u003eWebViewを配置する部分に、コンテナ用のPanelを配置します。  \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ePanelは(0,1)の位置から、ColumnSpan=4で複数セルをカバーさせています。\u003cbr\u003e\n\u003c/li\u003e\n\u003cli\u003ePanelPanelのDockをFillにして、連結したセル全体をカバーさせます。\u003c/li\u003e\n\u003cli\u003ePanelPanelのNameを\u003ccode\u003ewebViewContainer\u003c/code\u003eとしておきます。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/c74591f1d1c432ad3e1a249414095ee4855dbaa7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f32303765373063322d396664312d323765622d656261652d6565616235653432306537622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F207e70c2-9fd1-27eb-ebae-eeab5e420e7b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2fa128cb670139b6973053365812d864\" alt=\"レイアウト2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/207e70c2-9fd1-27eb-ebae-eeab5e420e7b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F207e70c2-9fd1-27eb-ebae-eeab5e420e7b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=79407321ceed6fc04fd8db900291b906 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"アドレスバーを配置する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアドレスバーを配置する。\u003c/h3\u003e\n\n\u003cp\u003eアドレスバーを配置します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eTextBoxを(3,0)の位置に配置します。\u003c/li\u003e\n\u003cli\u003eTextBoxをのDockをFillにして、セル全体をカバーさせます。\u003c/li\u003e\n\u003cli\u003eTextBoxをのMarginやFontを適当の変更して、見た目を調整する。\u003c/li\u003e\n\u003cli\u003eTextBoxのNameを\u003ccode\u003eaddressBar\u003c/code\u003eとしておきます。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/acb12462e5110e9a6ec90723472486d786a55563/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f65613535633333332d336534342d323064622d393932362d3161633265356238393633382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fea55c333-3e44-20db-9926-1ac2e5b89638.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bb47a3858c7ca1655c78ee8884645cc1\" alt=\"レイアウト3.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/ea55c333-3e44-20db-9926-1ac2e5b89638.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fea55c333-3e44-20db-9926-1ac2e5b89638.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=11bdd054eccbdfee86496707999b241b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ボタンを配置する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9C%E3%82%BF%E3%83%B3%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eボタンを配置する。\u003c/h3\u003e\n\n\u003cp\u003e戻る、進む、更新のボタンを配置します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eButtonを3つ配置します。\u003c/li\u003e\n\u003cli\u003eそれぞれのButtonでDockをFillにして、セル全体をカバーさせます。\u003c/li\u003e\n\u003cli\u003eそれぞれのButtonのイメージを適当に設定します。\u003c/li\u003e\n\u003cli\u003eそれぞれのButtonのNameを\u003ccode\u003ebackBtn\u003c/code\u003e、\u003ccode\u003eforwardBtn\u003c/code\u003e、\u003ccode\u003ereloadBtn\u003c/code\u003eとしておきます。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/f32d0b575bcd6278f1fe14e87a22639879a4291b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f61626336633030342d643761372d653638612d353137352d3539613435373163653337662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fabc6c004-d7a7-e68a-5175-59a4571ce37f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=62478aa9f71fd545a62aa6eec179c67f\" alt=\"レイアウト4.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/abc6c004-d7a7-e68a-5175-59a4571ce37f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fabc6c004-d7a7-e68a-5175-59a4571ce37f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=71af30c34fa980c13e9a4ccd4fbb58c3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"webviewの作成処理を変更する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#webview%E3%81%AE%E4%BD%9C%E6%88%90%E5%87%A6%E7%90%86%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWebViewの作成処理を変更する。\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eChromiumWebBrowser\u003c/code\u003eの配置場所を、先ほど作ったPanelに変更します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eWebViewのコンテナ変更\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// CefSharpのWebViewを作成する。\u003c/span\u003e\n\u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eChromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"https://www.google.co.jp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// コントロールをPanelに配置する\u003c/span\u003e\n\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewebViewContainer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eControls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDock\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDockStyle\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFill\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e以上で、戻る、進む、更新のボタンとアドレスバーを持つシンプルなWebブラウザのUIが完成しました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"63-ボタンクリック時の処理追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#63-%E3%83%9C%E3%82%BF%E3%83%B3%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E6%99%82%E3%81%AE%E5%87%A6%E7%90%86%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6.3 ボタンクリック時の処理追加\u003c/h2\u003e\n\n\u003cp\u003e戻る、進む、更新のボタンクリックの処理を追加します。\u003cbr\u003e\nフォームのデザインビューで、それぞれのボタンをダブルクリックして、click時のハンドラを追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e戻る、進む、更新のボタンクリックの処理ハンドリング\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ebackBtn_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCanGoBack\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 戻る\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBack\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eforwardBtn_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCanGoForward\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 進む\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eForward\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ereloadBtn_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 更新する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReload\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"64-アドレスバーでの処理追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#64-%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%81%A7%E3%81%AE%E5%87%A6%E7%90%86%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6.4 アドレスバーでの処理追加\u003c/h2\u003e\n\n\u003cp\u003eアドレスバーでEnterキーが押下された時に、アドレスバーに入力されているURLをロードするようにします。\u003cbr\u003e\nアドレスバーのKeyDownイベントのハンドラとして、addressBar_KeyDownメソッドを追加して、以下の処理を追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eアドレスバーでの入力ハンドリング\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eaddressBar_KeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eKeyEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eKeyCode\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnter\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// アドレスバーに入力があれば、ロードする\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsNullOrEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaddressBar\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// アドレスバーに入力されているURLをロードする。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoad\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaddressBar\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"65-実行してみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#65-%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6.5 実行してみる\u003c/h2\u003e\n\n\u003cp\u003eビルドして実行してみます。\u003cbr\u003e\n正しく実装されていると、以下のようなブラウザが表示されるはずです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/750260cdb1b694d10b657aac6673c31a731b55f5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f62333633626361362d643234302d373862642d623165392d6136376666333466353366642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fb363bca6-d240-78bd-b1e9-a67ff34f53fd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a12613bcaf3f5cd2c404ca710fe26856\" alt=\"基本UI.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/b363bca6-d240-78bd-b1e9-a67ff34f53fd.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fb363bca6-d240-78bd-b1e9-a67ff34f53fd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0e7f3a59d3087fd591148b707b0b4225 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eALT＋[→]、ALT+[←]、F5のショートカットキーが有効になっていることも確認できます。\u003cbr\u003e\nボタンやアドレスバーも操作可能になっています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"65-操作対象についての注意\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#65-%E6%93%8D%E4%BD%9C%E5%AF%BE%E8%B1%A1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E6%B3%A8%E6%84%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6.5 操作対象についての注意\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eIKeyboardHandler\u003c/code\u003eハンドラでの戻る、進む、更新の処理は、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IWebBrowser.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIWebBrowser\u003c/a\u003eではなく\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IBrowser.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIBrowser\u003c/a\u003eに対して行っています。\u003cbr\u003e\nIWebBrowserとIBrowserは同じWebViewを指しているように思われるかもしれませんが、window.openメソッドで開いた子ウィンドウの場合など、明示的に\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_WinForms_ChromiumWebBrowser.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eChromiumWebBrowser\u003c/a\u003eをnewして作成していないWebViewの場合は、IWebBrowserとIBrowserは同じWebViewを指していないので注意が必要です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eChromiumWebBrowserをnew作成した場合\u003cbr\u003e\n以下の様に\u003ccode\u003eChromiumWebBrowser\u003c/code\u003e、\u003ccode\u003eIWebBrowser\u003c/code\u003e、\u003ccode\u003eIBrowser\u003c/code\u003eは同じWebViewと関連しています。\u003cbr\u003e\n\u003ccode\u003eIKeyboardHandler\u003c/code\u003e等のCefSharpのハンドラのメソッドは、これらの引数にして呼び出されることになります。\u003cbr\u003e\nこの場合は、\u003ccode\u003eIWebBrowser\u003c/code\u003e、\u003ccode\u003eIBrowser\u003c/code\u003eのどちらを操作しても、結果は同じになります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ea58d540d4d21f67d07681e5b94cea296b33a1be/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f62333732616239632d393930662d373066652d396131322d3237323530623562383263332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fb372ab9c-990f-70fe-9a12-27250b5b82c3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=17b008ae5290cb46dd3c2cf494ecb71b\" alt=\"UML1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/b372ab9c-990f-70fe-9a12-27250b5b82c3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fb372ab9c-990f-70fe-9a12-27250b5b82c3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bf2a5b4426024e46eb1d58efa5b06ad1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ea要素のクリックやwindow.openにより子ウィンドウが自動的に作成された場合\u003cbr\u003e\nCefSharpにより自動作成されたWebViewでは、\u003ccode\u003eChromiumWebBrowser\u003c/code\u003eや\u003ccode\u003eIWebBrowser\u003c/code\u003eは存在しておらず、参照を取得することができません。\u003cbr\u003e\n\u003ccode\u003eIKeyboardHandler\u003c/code\u003e等のCefSharpのハンドラのメソッドでは、親ウィンドウの\u003ccode\u003eIWebBrowser\u003c/code\u003eインタフェースが引数として渡されます。\u003cbr\u003e\nこの場合は、\u003ccode\u003eIWebBrowser\u003c/code\u003eを操作すると親ウィンドウのWebViewが操作されてしまうことになります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/19fc90d04b4400e9f98dc21adc34fd2be5be3d81/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f33343262616132652d376635642d636632652d623165302d6139386430616166616436352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F342baa2e-7f5d-cf2e-b1e0-a98d0aafad65.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=966a690aa3069e9982876f3a3d846315\" alt=\"UML2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/342baa2e-7f5d-cf2e-b1e0-a98d0aafad65.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F342baa2e-7f5d-cf2e-b1e0-a98d0aafad65.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=67f529412e7d3ccaa2bbc45ec1caade6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eまとめると、\u003ccode\u003eChromiumWebBrowser\u003c/code\u003eを明示的にnewして作ったWebView以外のWebViewが存在する場合(子ウィンドをサポートする場合)は、\u003cstrong\u003e\u003cem\u003eWebViewに対する操作は、\u003ccode\u003eIWebBrowser\u003c/code\u003eに対してではなく、必ず\u003ccode\u003eIBrowser\u003c/code\u003eに対して行うようにします。\u003c/em\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eなお、上の「\u003ca href=\"#63-%E3%83%9C%E3%82%BF%E3%83%B3%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E6%99%82%E3%81%AE%E5%87%A6%E7%90%86%E8%BF%BD%E5%8A%A0\"\u003e6.3 ボタンクリック時の処理追加\u003c/a\u003e」と「\u003ca href=\"#64-%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%81%A7%E3%81%AE%E5%87%A6%E7%90%86%E8%BF%BD%E5%8A%A0\"\u003e6.4 アドレスバーでの処理追加\u003c/a\u003e」では、\u003ccode\u003eIBrowser\u003c/code\u003eではなく\u003ccode\u003eChromiumWebBrowser\u003c/code\u003eに対して、\u003ccode\u003eGoBack\u003c/code\u003e等のメソッドを呼び出しています。これらについては、「\u003ca href=\"#22-%E5%AD%90%E3%82%A6%E3%82%A3%E3%83%B3%E3%83%89%E3%82%A6%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3\"\u003e22. 子ウィンドウオープン\u003c/a\u003e」で\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILifeSpanHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eILifeSpanHandler\u003c/a\u003eを実装した後に、\u003ccode\u003eIBrowser\u003c/code\u003eインタフェースを操作する様に変更します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"7-拡大縮小\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#7-%E6%8B%A1%E5%A4%A7%E7%B8%AE%E5%B0%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e7. 拡大・縮小\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_WebBrowserExtensions_SetZoomLevel.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWebBrowserExtensions.SetZoomLevel\u003c/a\u003eメソッドを呼び出すことで、拡大率を適用します。\u003cbr\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_WebBrowserExtensions_GetZoomLevelAsync.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWebBrowserExtensions.GetZoomLevelAsync\u003c/a\u003eメソッドを呼び出すことで、現在の拡大率を取得することができます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"71-拡大率とzoomlevelの関係\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#71-%E6%8B%A1%E5%A4%A7%E7%8E%87%E3%81%A8zoomlevel%E3%81%AE%E9%96%A2%E4%BF%82\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e7.1 拡大率とZoomLevelの関係\u003c/h2\u003e\n\n\u003cp\u003e両メソッドともに\u003ccode\u003edouble\u003c/code\u003e値の\u003ccode\u003eZoomLevel\u003c/code\u003eで拡大・縮小のレベルを使用します。\u003cbr\u003e\n\u003ccode\u003eZoomLevel\u003c/code\u003eと拡大率(等倍を1.0とする倍率)には、以下の関係があります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\\begin{align}\n1.2^{ZoomLevel} \u0026amp;= 拡大率\\\\\nZoomLevel \u0026amp;= \\log_{1.2} 拡大率 = \\frac{\\log 拡大率}{\\log 1.2}\n\\end{align}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eChromの拡大率は以下のようになっています。\u003cbr\u003e\n- 拡大は、110%、125%、150%、175%、200%、250%、300%、400%、500%\u003cbr\u003e\n- 縮小は、90%、80%、75%、67%、50%、33%、25%\u003c/p\u003e\n\n\u003cp\u003eこれらの拡大率をZoomLevelに直すと以下のようになります。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003e拡大率\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e計算式\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eZoomLevel\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e500%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 5 = \\frac{\\log 5}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e8.827\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e400%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 4 = \\frac{\\log 4}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e7.604\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e300%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 3 = \\frac{\\log 3}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e6.026\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e250%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 2.5 = \\frac{\\log 2.5}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e5.026\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e200%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 2 = \\frac{\\log 2}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e3.802\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e175%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 1.75 = \\frac{\\log 1.75}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e3.069\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e125%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 1.25 = \\frac{\\log 1.25}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e1.224\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e110%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 1.1 = \\frac{\\log 1.1}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0.523\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e90%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 0.9 = \\frac{\\log 0.9}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e-0.578\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e80%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 0.8 = \\frac{\\log 0.8}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e-1.224\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e75%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 0.75 = \\frac{\\log 0.75}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e-1.578\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e67%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 0.67 = \\frac{\\log 0.67}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e-2.197\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e50%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 0.5 = \\frac{\\log 0.5}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e-3.802\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e33%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 0.33 = \\frac{\\log 0.33}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e-6.081\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e25%\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e$\\log_{1.2} 0.25 = \\frac{\\log 0.25}{\\log 1.2}$\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e-7.604\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"72-ショートカットキーで拡大縮小等倍の処理を追加する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#72-%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%82%AD%E3%83%BC%E3%81%A7%E6%8B%A1%E5%A4%A7%E7%B8%AE%E5%B0%8F%E7%AD%89%E5%80%8D%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e7.2 ショートカットキーで拡大・縮小・等倍の処理を追加する\u003c/h2\u003e\n\n\u003cp\u003eショートカットキーをハンドリングするために、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IKeyboardHandler_OnPreKeyEvent.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIKeyboardHandler.OnPreKeyEvent\u003c/a\u003eに処理を追加します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eCtrl + [+]\u003cbr\u003e\n現在の拡大率を取得して、現在の拡大率より一つ大きい拡大率を適用します。\u003c/li\u003e\n\u003cli\u003eCtrl + [-]\u003cbr\u003e\n現在の拡大率を取得して、現在の拡大率より一つ小さい拡大率を適用します。\u003c/li\u003e\n\u003cli\u003eCtrl + [0]\u003cbr\u003e\n等倍にします。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e以下の様なコードになります。\u003cbr\u003e\nなお、[+][-][0]のキーはキーボード本体とテンキーの2つにあり、それぞれキーコードが区別されているで、複数の条件を指定する必要があります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e拡大縮小のショートカットキーのハンドリング方法\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eKeyboardHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIKeyboardHandler\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ZoomLevelの定義\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eZOOM_LEVLES\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;{\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e7.604\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e6.081\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e3.802\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e2.197\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1.578\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1.224\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e0.578\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0.523\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1.224\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3.069\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3.802\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e5.026\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e6.026\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e7.604\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e8.827\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//　(省略)\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eIKeyboardHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnPreKeyEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eKeyType\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enativeKeyCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e \u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisSystemKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisKeyboardShortcut\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eKeyType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRawKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Ctrl + NumberPad_Add\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Ctrl + Add\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAdd\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eControlDown\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsKeyPad\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOemplus\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eControlDown\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eShiftDown\u003c/span\u003e\u003cspan class=\"p\"\u003e))))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 現在のZoomLevelを取得する\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetZoomLevelAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eContinueWith\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 現在のZoomLevelの次に大きなZoomLevelを求めて設定する\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eZOOM_LEVLES\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIndexOf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMin\u003c/span\u003e\u003cspan class=\"p\"\u003e(++\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eZOOM_LEVLES\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetZoomLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eZOOM_LEVLES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Ctrl + NumberPad_Minus\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Ctrl + Minus\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSubtract\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eControlDown\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsKeyPad\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOemMinus\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eControlDown\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eShiftDown\u003c/span\u003e\u003cspan class=\"p\"\u003e))))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 現在のZoomLevelを取得する\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetZoomLevelAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eContinueWith\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 現在のZoomLevelの次に小さいZoomLevelを求めて設定する\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eZOOM_LEVLES\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIndexOf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMax\u003c/span\u003e\u003cspan class=\"p\"\u003e(--\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetZoomLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eZOOM_LEVLES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Ctrl + NumberPad_0\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Ctrl + 0\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eD0\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eControlDown\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNumPad0\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eControlDown\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsKeyPad\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 100%の倍率に戻す\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetZoomLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e以上で、拡大、縮小、等倍の操作がショートカットキーからできるようになりました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"8-印刷\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#8-%E5%8D%B0%E5%88%B7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e8. 印刷\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_WebBrowserExtensions_Print.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWebBrowserExtensions.Print\u003c/a\u003eメソッドを呼び出すことで、簡単にWebViewの印刷ができます。\u003cbr\u003e\nここでは、Ctrl+[P]ショートカットキーに、印刷処理を割りあてます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"81-ショートカットキーの追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#81-%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%82%AD%E3%83%BC%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e8.1 ショートカットキーの追加\u003c/h2\u003e\n\n\u003cp\u003eショートカットキーをハンドリングするために、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IKeyboardHandler_OnPreKeyEvent.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIKeyboardHandler.OnPreKeyEvent\u003c/a\u003eに処理を追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e印刷のショートカットキーのハンドリング\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eIKeyboardHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnPreKeyEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eKeyType\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enativeKeyCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e \u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisSystemKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisKeyboardShortcut\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eKeyType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRawKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// CTRL＋[P]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewindowsKeyCode\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eP\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003emodifiers\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eCefEventFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eControlDown\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 印刷する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrint\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ほかのショートカットキーの処理\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//         :\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"82-印刷の確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#82-%E5%8D%B0%E5%88%B7%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e8.2 印刷の確認\u003c/h2\u003e\n\n\u003cp\u003eビルドして実行してみます。\u003cbr\u003e\nCtrl+[P]を押下すると、印刷ダイアログが表示されます。\u003cbr\u003e\nなお、PDFに印刷したい場合は、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_WebBrowserExtensions_PrintToPdfAsync.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWebBrowserExtensions.PrintToPdfAsync\u003c/a\u003eメソッドを呼び出すことで、PDFファイルに保存することができます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"9-認証\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#9-%E8%AA%8D%E8%A8%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e9. 認証\u003c/h1\u003e\n\n\u003cp\u003eBasic認証やDigest認証が求められる場合に、認証情報を入力するための仕組みを実装することができます。Proxyサーバで認証が必要な場合にも、この仕組みで認証情報の入力をユーザに求めることができます。\u003cbr\u003e\n認証情報が必要になると、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_GetAuthCredentials.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler.GetAuthCredentials\u003c/a\u003eメソッドがCefSharpから呼び出されます。\u003cbr\u003e\nなお、HTMLの仕様では一度Basic認証やDigest認証で認証に成功しても、それ以降同じホストに対するHTTPリクエストの度に認証が要求されます。一般的なブラウザはこの認証要求を、入力済みの認証情報を使って自動的に認証処理を行っています。 \u003cbr\u003e\nCefSharpでも同様に一度認証に成功すると、それ以降同じホストからの認証要求は自動的に処理されるため、2回目以降はこのハンドラは呼び出されなくなります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"91-irequesthandlerを実装するクラスの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#91-irequesthandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e9.1 IRequestHandlerを実装するクラスの作成\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IRequestHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler\u003c/a\u003eインタフェースは、CefSharpを使うアプリケーションで最も重要なインタフェースです。\u003cbr\u003e\nここでは、このインタフェースを実装するクラスとして、RequestHandlerクラスを追加します。\u003cbr\u003e\n「\u003ca href=\"#5-%E9%96%8B%E7%99%BA%E8%80%85%E3%83%84%E3%83%BC%E3%83%AB\"\u003e5. 開発者ツール\u003c/a\u003e」でのやり方と同様に、ソリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に\u003ccode\u003eRequestHandler\u003c/code\u003eを指定します。そして、以下のように\u003ccode\u003eIRequestHandler\u003c/code\u003eを実装させます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIRequestHandlerを実装するクラス\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequestHandler\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eその後、\u003ccode\u003eIRequestHandler\u003c/code\u003eを選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"92-irequesthandlerインタフェースのデフォルト処理の実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#92-irequesthandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%AE%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E5%87%A6%E7%90%86%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e9.2 IRequestHandlerインタフェースのデフォルト処理の実装\u003c/h2\u003e\n\n\u003cp\u003eVisual Studioで自動実装したメンバーは例外をスローするようになっているので、以下のデフォルト処理を実装します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_GetAuthCredentials.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler.GetAuthCredentials\u003c/a\u003e\u003cbr\u003e\nサーバが認証を要求した時に呼び出されるハンドラです。\u003cbr\u003e\n一般的な実装としては、ダイアログボックスを表示して、ユーザにユーザ名とパスワードを入力させる処理を行います。\u003cbr\u003e\nこの部分は「\u003ca href=\"#94-getauthcredentials%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e9.4 GetAuthCredentialsメソッドの実装\u003c/a\u003e」で実装していきます。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_GetResourceRequestHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler.GetResourceRequestHandler\u003c/a\u003e\u003cbr\u003e\nリソースのリクエストを行う前に呼び出されるハンドラで、主に以下の処理を行うためのインタフェースを返却します。\n\n\u003cul\u003e\n\u003cli\u003eCookieの送信や受け入れの許可と禁止\u003c/li\u003e\n\u003cli\u003eHTTPレスポンスの内容を変更するためのフィルタの返却\u003c/li\u003e\n\u003cli\u003eリソースのロード許可と禁止\u003c/li\u003e\n\u003cli\u003eHTTPレスポンス受信、HTTPのリダイレクト、ロード完了のハンドリング\u003cbr\u003e\nここでは、デフォルトの動作をさせるために、\u003ccode\u003enull\u003c/code\u003eを返却しておきます。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnBeforeBrowse.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler.OnBeforeBrowse\u003c/a\u003e\u003cbr\u003e\nナビゲーションを許可するかどうかを判断するハンドラです。\u003cbr\u003e\nここでは、\u003ccode\u003etrue\u003c/code\u003eを返却して、ナビゲーションを許可します。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnCertificateError.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler.OnCertificateError\u003c/a\u003e\u003cbr\u003e\nSSLの証明書でエラーが発生した場合(オレオレ証明書など)に、処理を継続するかどうかを判断するためのハンドラです。\u003cbr\u003e\n一般的な実装としては、証明書エラーのページを一度表示して、ユーザに表示を継続するかどうかを問い合わせて、その結果に応じて処理を行うことになります。\u003cbr\u003e\nここでは、常に処理を継続するようにするため、引数で指定されているcallbackの\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IRequestCallback.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestCallback.Continue\u003c/a\u003eメソッドを\u003ccode\u003etrue\u003c/code\u003eを指定して呼び出して\u003ccode\u003etrue\u003c/code\u003eを返却します。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnDocumentAvailableInMainFrame.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler.OnDocumentAvailableInMainFrame\u003c/a\u003e\u003cbr\u003e\n\u003ccode\u003ewindow.document\u003c/code\u003eオブジェクトが作成されたときに呼び出されるハンドラです。\u003cbr\u003e\nここでは特に何もしません。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnOpenUrlFromTab.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler.OnOpenUrlFromTab\u003c/a\u003e\u003cbr\u003e\nCtrl+左クリックでアンカーをクリックした際に、新しいタブでナビゲーションを開始するかを判断するためのハンドラです。 \nここでは、このタイプのナビゲーションを許可しないように\u003ccode\u003efalse\u003c/code\u003eを返却するようにします。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnPluginCrashed.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler.OnPluginCrashed\u003c/a\u003e\u003cbr\u003e\nPluginがクラッシュしたときに呼び出されるハンドラですが、特に何もしません。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnQuotaRequest.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler.OnQuotaRequest\u003c/a\u003e\u003cbr\u003e\n\u003ccode\u003ewebkitStorageInfo.requestQuota\u003c/code\u003eメソッドでクオータの要求があった場合のハンドラです。\u003cbr\u003e\n一般的な実装としては、ダイアログボックスを表示してユーザに許可するかどうかを問い合わせて、その結果で許可または禁止するように実装します。\u003cbr\u003e\nここでは常に許可する動作として、引数で指定されているcallbackの\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IRequestCallback.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestCallback.Continue\u003c/a\u003eメソッドを\u003ccode\u003etrue\u003c/code\u003eを指定して呼び出して\u003ccode\u003etrue\u003c/code\u003eを返却します。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnRenderProcessTerminated.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler.OnRenderProcessTerminated\u003c/a\u003e\u003cbr\u003e\n予期せずレンダープロセスが終了した場合のハンドラです。\u003cbr\u003e\n一般的な実装の場合、ユーザに故障発生のダイアログを出したり、ブラウザを再起動する処理を行うことになります。\u003cbr\u003e\nここでは特に何もしません。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnRenderViewReady.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler.OnRenderViewReady\u003c/a\u003e\u003cbr\u003e\nレンダーのViewが準備できた時のハンドラです。\u003cbr\u003e\nここでは特に何もしません。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnSelectClientCertificate.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler.OnSelectClientCertificate\u003c/a\u003e\u003cbr\u003e\nSSLでサーバがクライアント証明書を要求する時に、クライアント証明書を選択するために呼び出されるハンドラです。\u003cbr\u003e\n一般的な実装では、クライアント証明書の一覧を表示して、ユーザに選択させる処理になります。\u003cbr\u003e\nここでは\u003ccode\u003efalse\u003c/code\u003eを返却して、クライアント証明書リストの先頭の証明書を使用するデフォルトの動作をさせます。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"93-認証用ダイアログボックスの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#93-%E8%AA%8D%E8%A8%BC%E7%94%A8%E3%83%80%E3%82%A4%E3%82%A2%E3%83%AD%E3%82%B0%E3%83%9C%E3%83%83%E3%82%AF%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e9.3 認証用ダイアログボックスの実装\u003c/h2\u003e\n\n\u003cp\u003eソリューションエクスプローラでコンテキストメニューから「追加」－「フォーム(Windows フォーム)」を選択して、新しいフォームを追加します。フォームの名前はここでは\u003ccode\u003eAuthDialog\u003c/code\u003eとしました。\u003cbr\u003e\nそして、以下のようにユーザ名とパスワードのTextInputとOKとCANCELボタンを持つダイアログボックスをデザインします。\u003cbr\u003e\n※GetAuthCredentialsメソッドでは、認証を要求しているhostの情報、ポート番号、サーバが返却したrealm文字列等の情報も受け取るので、これらの情報も表示するようにすることもできます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/bc1ec7135613b91afd17d4385812e3050d10b1e4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f35636232333939622d646134632d383766342d393332352d6566633761633936343739352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F5cb2399b-da4c-87f4-9325-efc7ac964795.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=23956095eb60b2444cf80daa97dcd08a\" alt=\"ログオン.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/5cb2399b-da4c-87f4-9325-efc7ac964795.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F5cb2399b-da4c-87f4-9325-efc7ac964795.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d5f7df45f322feca4e50b32f52c5ccb6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eまた、AuthDialogクラスに以下を実装します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e入力されたユーザ名を保持するUserNameプロパティを追加します。\u003c/li\u003e\n\u003cli\u003e入力されたパスワードを保持するPasswordプロパティを追加します。\u003c/li\u003e\n\u003cli\u003eOKボタンがクイックされたときに、UserNameとPasswordプロパティに入力値を設定します。\u003c/li\u003e\n\u003cli\u003eOKボタンが選択されたときに\u003ccode\u003eDialogResult.OK\u003c/code\u003eが返却されるように、フォームのAcceptButtonに割り当てます。\u003c/li\u003e\n\u003cli\u003eCANCELボタンが選択されたときに\u003ccode\u003eDialogResult.Cancel\u003c/code\u003eが返却されるように、フォームのCancelButtonに割り当てます。\u003c/li\u003e\n\u003cli\u003eTopmostで表示するようにします。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e以下のようなコードになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e認証情報入力ダイアログ\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Windows.Forms\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAuthDialog\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eForm\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// ダイアログに入力されたユーザ名\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eUserName\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// ダイアログに入力されたパスワード\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003ePassword\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eAuthDialog\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eInitializeComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eConfirmBtn_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 確定したユーザ名とパスワードをプロパティに設定する。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eUserName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003euserNameTxt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ePassword\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epasswordTxt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"94-getauthcredentialsメソッドの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#94-getauthcredentials%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e9.4 GetAuthCredentialsメソッドの実装\u003c/h2\u003e\n\n\u003cp\u003eいよいよGetAuthCredentialsメソッドを実装します。\u003cbr\u003e\nこのメソッドはアプリケーションのUIスレッドとは異なる\u003ccode\u003eCEF IO thread\u003c/code\u003eと呼ばれるスレッドから呼び出されていますが、\u003cstrong\u003e\u003cem\u003eこのスレッドを絶対にブロックしてはいけません。\u003c/em\u003e\u003c/strong\u003e\u003cbr\u003e\nそこで、WebViewの親コントロールのコンテキス(UIスレッドのコンテキスト)で、ダイアログを表示してユーザにユーザ名とパスワードの入力を促すようにして、このメソッド自体はすぐに\u003ccode\u003etrue\u003c/code\u003eを返却するようにします。そして、ユーザが入力を確定した時点で、引数で指定された\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IAuthCallback.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIAuthCallback\u003c/a\u003eインタフェースを使用して、入力されたユーザ名とパスワードをCefSharpに通知するようにします。  \u003c/p\u003e\n\n\u003cp\u003eなお、「\u003ca href=\"#5-%E6%93%8D%E4%BD%9C%E5%AF%BE%E8%B1%A1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E6%B3%A8%E6%84%8F\"\u003e5. 操作対象についての注意\u003c/a\u003e」で説明したように、\u003ccode\u003eIWebBrowser\u003c/code\u003eではなく\u003ccode\u003eIBrowser\u003c/code\u003eを常に操作対象と考える必要があります。少し汚くなりますが\u003ccode\u003ePInvoke\u003c/code\u003eでWin32の\u003ccode\u003eGetParent\u003c/code\u003eを使って、\u003ccode\u003eIBrowser\u003c/code\u003eに関連したWebViewの親ウィンドウを取得します。この処理は今後も使うことになるため、以下のようなユーティリティ関数を作成します。\u003c/p\u003e\n\n\u003cp\u003e具体的には、以下のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIBrowserからTopLevelのフォームの取り出しメソッド\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.InteropServices\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eForm\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// (省略)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// IBrowserからメインフレームを取得する\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"browser\"\u0026gt;\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;returns\u0026gt;\u0026lt;/returns\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"nf\"\u003egetMainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// browserのウィンドウハンドル\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehWnd\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetHost\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetWindowHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// browserの親コントロール(webViewContainer)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eControl\u003c/span\u003e \u003cspan class=\"n\"\u003econtainer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eControl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetParent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehWnd\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtainer\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003econtainer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTopLevelControl\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// コントロールのトップレベルのコントロールを取得して返却する\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003econtainer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTopLevelControl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// Win32のGetParent\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"user32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eExactSpelling\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCharSet\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCharSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAuto\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetParent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehWnd\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこのユーティリティメソッドを使用して、GetAuthCredentialsメソッドを実装します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eGetAuthCredentialsメソッドの実装\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Security.Cryptography.X509Certificates\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Windows.Forms\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequestHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequestHandler\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetAuthCredentials\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eoriginUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisProxy\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003erealm\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003escheme\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIAuthCallback\u003c/span\u003e \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// コントロールのトップレベルのコントロールを取得（SimpleBrowserFrame）\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetMainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 親コントロールのコンテキストで非同期にダイアログを表示する。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBeginInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// ログオンダイアログを表示する\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eAuthDialog\u003c/span\u003e \u003cspan class=\"n\"\u003edlg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAuthDialog\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eDialogResult\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edlg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShowDialog\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eDialogResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOK\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// 入力されたユーザ名とパスワードで認証を継続する。\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContinue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edlg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edlg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassword\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// 認証処理をキャンセルする。\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCancel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 認証処理をキャンセルする。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCancel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIResourceRequestHandler\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetResourceRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisNavigation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisDownload\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003erequestInitiator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003edisableDefaultHandling\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnBeforeBrowse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003euserGesture\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisRedirect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// ナビゲーションを許可する\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnCertificateError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCefErrorCode\u003c/span\u003e \u003cspan class=\"n\"\u003eerrorCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003erequestUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eISslInfo\u003c/span\u003e \u003cspan class=\"n\"\u003esslInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequestCallback\u003c/span\u003e \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 証明書エラーでも継続する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContinue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnDocumentAvailableInMainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnOpenUrlFromTab\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etargetUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowOpenDisposition\u003c/span\u003e \u003cspan class=\"n\"\u003etargetDisposition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003euserGesture\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Ctrl+左クリックでの別Tab表示は許可しない。\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnPluginCrashed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003epluginPath\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnQuotaRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eoriginUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003enewSize\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequestCallback\u003c/span\u003e \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// クオータの要求は常に許可する。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContinue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnRenderProcessTerminated\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCefTerminationStatus\u003c/span\u003e \u003cspan class=\"n\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnRenderViewReady\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnSelectClientCertificate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisProxy\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eX509Certificate2Collection\u003c/span\u003e \u003cspan class=\"n\"\u003ecertificates\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eISelectClientCertificateCallback\u003c/span\u003e \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// デフォルトのクライアント証明書の選択方法とする。\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"95-irequesthandlerをchromiumwebbrowserに設定する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#95-irequesthandler%E3%82%92chromiumwebbrowser%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e9.5 IRequestHandlerをChromiumWebBrowserに設定する\u003c/h2\u003e\n\n\u003cp\u003e作成した\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IRequestHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler\u003c/a\u003eインタフェースを\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_WinForms_ChromiumWebBrowser_RequestHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eChromiumWebBrowser.RequestHandler\u003c/a\u003eプロパティに設定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eChromiumWebBrowserのIRequestHandlerを設定\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eForm\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// （省略）\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// いろいろと初期化処理\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//     :\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//     :\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// キーボードハンドラを設定する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eKeyboardHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eKeyboardHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// リクエストハンドラを設定する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"96-認証の確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#96-%E8%AA%8D%E8%A8%BC%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e9.6 認証の確認\u003c/h2\u003e\n\n\u003cp\u003e認証が正しく実装できているか確認してみましょう。\u003cbr\u003e\nBASIC認証を行う簡単なサーバを用意する必要があります。\u003cbr\u003e\nここでは、node.jsで動作する\u003ca href=\"https://www.npmjs.com/package/http-server\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp-server\u003c/a\u003eを使ってみます。\u003c/p\u003e\n\n\u003cp\u003eよく使うので、グローバルにインストールしておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"batch\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ehttp-serverのインストール\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003enpm\u003c/span\u003e \u003cspan class=\"kd\"\u003einstall\u003c/span\u003e \u003cspan class=\"na\"\u003e-g \u003c/span\u003e\u003cspan class=\"kd\"\u003ehttp\u003c/span\u003e\u003cspan class=\"na\"\u003e-server\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e適当なディレクトリに移動して、以下のコマンドを実行すれば、BASIC認証を行うHTTPサーバが起動されます。\u003cbr\u003e\nポート番号を\u003ccode\u003e8081\u003c/code\u003e、ユーザ名を\u003ccode\u003etest\u003c/code\u003e、パスワードを\u003ccode\u003ep@ssword\u003c/code\u003eとしています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"batch\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eテスト用サーバの起動\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e \u003cspan class=\"kd\"\u003ec\u003c/span\u003e:\\temp\n\u003cspan class=\"kd\"\u003ehttp\u003c/span\u003e\u003cspan class=\"na\"\u003e-server -p \u003c/span\u003e\u003cspan class=\"m\"\u003e8081\u003c/span\u003e \u003cspan class=\"na\"\u003e--user \u003c/span\u003e\u003cspan class=\"kd\"\u003etest\u003c/span\u003e \u003cspan class=\"na\"\u003e--password \u003c/span\u003e\u003cspan class=\"kd\"\u003ep\u003c/span\u003e@ssword\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれで、ポート\u003ccode\u003e8081\u003c/code\u003eでHTTPサーバが起動するので、さっそく確認してみましょう。\u003cbr\u003e\u003cbr\u003e\nカスタムWebブラウザのアドレスバーに\u003ca href=\"http://localhost:8081\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://localhost:8081\u003c/a\u003eを入力してENTERを押下すると、作成した認証用ダイアログボックスが表示されます。正しいユーザ名とパスワードを入力するとページが表示されます。\u003c/p\u003e\n\n\u003cp\u003eその後、F5キーでページを更新すると、認証ダイアログボックスは表示されないことが確認できます。これは一度認証に使ったユーザ名とパスワードの情報をCefSharpの内部で保持していて、二回目以降は自動で認証処理を行ってくれるからです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"10-タイトルの表示\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#10-%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E3%81%AE%E8%A1%A8%E7%A4%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e10. タイトルの表示\u003c/h1\u003e\n\n\u003cp\u003eWebコンテンツが指定するタイトル文字列を表示します。\u003cbr\u003e\nこれを行うためには、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IDisplayHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIDisplayHandler\u003c/a\u003eインターフェースを実装する必要があります。タイトル文字列が変更すると、CefSharpによってこのインタフェースの\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnTitleChanged.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIDisplayHandler.OnTitleChanged\u003c/a\u003eメソッドが呼び出されます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"101-idisplayhandlerを実装するクラスを追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#101-idisplayhandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e10.1 IDisplayHandlerを実装するクラスを追加\u003c/h2\u003e\n\n\u003cp\u003eまず、\u003ccode\u003eIDisplayHandler\u003c/code\u003eインタフェースを実装するクラスを新規に作成します。 \u003cbr\u003e\nリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に\u003ccode\u003eDisplayHandler\u003c/code\u003eを指定します。\u003cbr\u003e\nそして、以下のように\u003ccode\u003eIDisplayHandler\u003c/code\u003eを実装させます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIDisplayHandlerインタフェースを実装するクラス\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Windows.Forms\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDisplayHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eIDisplayHandler\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"102-idisplayhandlerのメソッドを仮実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#102-idisplayhandler%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BB%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e10.2 IDisplayHandlerのメソッドを仮実装\u003c/h2\u003e\n\n\u003cp\u003eその後、\u003ccode\u003eIDisplayHandler\u003c/code\u003eを選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。\u003cbr\u003e\n自動実装されたメンバーは例外をスローするようになっているので、以下の様にデフォルト実装します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnAddressChanged.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnAddressChanged\u003c/a\u003e\u003cbr\u003e\nWebコンテンツのURLが変わったタイミングで呼び出されます。\u003cbr\u003e\nURLをロードすると何度かリダイレクトが発生する場合がありますが、通常はそのたびにアドレスバーに表示するURL文字列を更新することになります。これを実現するには、このメソッドが呼び出されるタイミングで、アドレスバーを更新します。\u003cbr\u003e\n「\u003ca href=\"#11-%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%81%AE%E6%9B%B4%E6%96%B0\"\u003e11. アドレスバーの更新\u003c/a\u003e」でこの部分を実装しますので、ここでは特にないもしません。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnAutoResize.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnAutoResize\u003c/a\u003e\u003cbr\u003e\nコンテンツがリサイズされたときに呼び出されるメソッドですが、\u003ccode\u003efalse\u003c/code\u003eを返却してブラウザのデフォルトの動作をさせます。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnConsoleMessage.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnConsoleMessage\u003c/a\u003e\u003cbr\u003e\njavascriptで\u003ccode\u003econsole.log\u003c/code\u003eや\u003ccode\u003econsole.error\u003c/code\u003e等のメソッドが呼び出されて、コンソールログ出力が行われるタイミングで呼び出されます。\u003cbr\u003e\nここでは、開発者ツールのコンソールログに出力するデフォルトの動作を行うように、\u003ccode\u003efalse\u003c/code\u003eを返却します。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnFaviconUrlChange.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnFaviconUrlChange\u003c/a\u003e\u003cbr\u003e\nFAVIONアイコンが変わるタイミングで呼び出されます。\u003cbr\u003e\n一般的な実装としては、引数で渡されたアイコンのURLでアイコンをダウンロードして表示します。\u003cbr\u003e\nここでは、仮実装として特に何もしないようにします。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnFullscreenModeChange.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnFullscreenModeChange\u003c/a\u003e\u003cbr\u003e\nWebコンテンツで\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/API/Fullscreen_API\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFullscreen API\u003c/a\u003eが呼び出されて、フルスクリーンモードが変わるタイミングで呼び出されます。\u003cbr\u003e\nFullscreen APIをサポートする場合は、このタイミングでキオスクモードにするなど表示を変更することになります。\u003cbr\u003e\nここでは、仮実装として特に何もしません。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnLoadingProgressChange.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnLoadingProgressChange\u003c/a\u003e\u003cbr\u003e\nWebページロードの進捗率が変わるタイミングで呼び出されます。\u003cbr\u003e\nプログレスバーの進捗率を更新するなどのUIを実装することができます。\u003cbr\u003e\nここでは、仮実装として特に何もしません。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnStatusMessage.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnStatusMessage\u003c/a\u003e\u003cbr\u003e\nWebコンテンツにより\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/API/Window/status\" rel=\"nofollow noopener\" target=\"_blank\"\u003ewindow.status\u003c/a\u003eプロパティが変更されて、\nステータスバーのメッセージが変更されるタイミングで呼び出されます。ステータスバーを表示している場合は、ステータスバーに表示する文字列を変更することができます。\u003cbr\u003e\nここでは、仮実装として特に何もしません。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnTitleChanged.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnTitleChanged\u003c/a\u003e\u003cbr\u003e\nWebコンテンツのtitle要素や\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/API/Document/title\" rel=\"nofollow noopener\" target=\"_blank\"\u003edocument.title\u003c/a\u003eでタイトル文字列が変更されるタイミングで呼び出されます。\u003cbr\u003e\n以下の「\u003ca href=\"#103-%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E5%A4%89%E6%9B%B4%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e10.3 タイトル変更のハンドラを実装\u003c/a\u003e」でこのメソッドを実装します。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnTooltipChanged.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnTooltipChanged\u003c/a\u003e\u003cbr\u003e\nツールチップを表示するタイミングで呼び出されます。\u003cbr\u003e\nWinforms版では呼び出されないことになっていますが、ここでは\u003ccode\u003efalse\u003c/code\u003eを返却してデフォルトの処理を行うようにします。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"103-タイトル変更のハンドラを実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#103-%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E5%A4%89%E6%9B%B4%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e10.3 タイトル変更のハンドラを実装\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnTitleChanged.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnTitleChanged\u003c/a\u003eメソッドを実装します。\u003cbr\u003e\nこのメソッドの引数は、第一引数が\u003ccode\u003eIWebBrowser\u003c/code\u003eとなっていますが、実際にタイトル文字列が変更されたWebViewは第二引数の\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_TitleChangedEventArgs_Browser.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eTitleChangedEventArgs.Browser\u003c/a\u003eプロパティで指定されるWebViewですので注意が必要です。\u003cbr\u003e\n※「\u003ca href=\"#65-%E6%93%8D%E4%BD%9C%E5%AF%BE%E8%B1%A1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E6%B3%A8%E6%84%8F\"\u003e6.5 操作対象についての注意\u003c/a\u003e」で説明したように、第一引数の\u003ccode\u003eIWebBrowser\u003c/code\u003eと第二引数のプロパティで指定される\u003ccode\u003eIBrowser\u003c/code\u003eが異なるWebViewを指している可能性があります。\u003c/p\u003e\n\n\u003cp\u003eまず、第二引数のプロパティで指定される\u003ccode\u003eIBrowser\u003c/code\u003eから、タイトルを変更する対象のウィンドウを特定します。タブ形式のブラウザにしている場合は、\u003ccode\u003eIBrowser\u003c/code\u003eを表示しているタブの文字列を変更することになるでしょう。\u003cbr\u003e\n今回はタブ形式のブラウザでないため、メインウィンドウのタイトルを変更対象とします。\u003cbr\u003e\nこれには、「\u003ca href=\"#94-getauthcredentials%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e9.4 GetAuthCredentialsメソッドの実装\u003c/a\u003e」で実装してユーティリティメソッドを使って、\u003ccode\u003eIBrowser\u003c/code\u003eからWebViewを表示しているTopLevelのフレームを取得します。\u003c/p\u003e\n\n\u003cp\u003e次に、対象ウィンドウのタイトルを変更しますが、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IDisplayHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIDisplayHandler\u003c/a\u003eの各メソッドは、ブラウザのアプリケーションUIスレッドのコンテキストで呼び出されていないため、必ずメインウィンドウのコンテキストでタイトル文字列を変更されるようにします。\u003c/p\u003e\n\n\u003cp\u003e以下は、実装例になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIDisplayHandlerインタフェースの実装\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp.Structs\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDisplayHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisplayHandler\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnAddressChanged\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAddressChangedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003eaddressChangedArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnAutoResize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSize\u003c/span\u003e \u003cspan class=\"n\"\u003enewSize\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// ブラウザのデフォルト処理を行う\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnConsoleMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eConsoleMessageEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003econsoleMessageArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// コンソールにメッセージを出力する\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnFaviconUrlChange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eurls\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnFullscreenModeChange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003efullscreen\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnLoadingProgressChange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003eprogress\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnStatusMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eStatusMessageEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003estatusMessageArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnTitleChanged\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTitleChangedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003etitleChangedArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// コントロールのトップレベルのコントロールを取得（SimpleBrowserFrame）\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetMainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etitleChangedArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 親コントロールのコンテキストでタイトル文字列を変更する。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBeginInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// タイトル文字列を変更する\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etitleChangedArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTitle\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnTooltipChanged\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"104-idisplayhandlerをchromiumwebbrowserに設定する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#104-idisplayhandler%E3%82%92chromiumwebbrowser%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e10.4 IDisplayHandlerをChromiumWebBrowserに設定する\u003c/h2\u003e\n\n\u003cp\u003e作成した\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IDisplayHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIDisplayHandler\u003c/a\u003eインタフェースを\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_WinForms_ChromiumWebBrowser_DisplayHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eChromiumWebBrowser.DisplayHandler\u003c/a\u003eプロパティに設定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eChromiumWebBrowserにIDisplayHandlerを設定\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eForm\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// （省略）\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// いろいろと初期化処理\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//     :\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// ディスプレイハンドラを設定する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDisplayHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDisplayHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e以上でタイトル文字列がタイトルバーに表示されるようになりました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"11-アドレスバーの更新\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#11-%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%81%AE%E6%9B%B4%E6%96%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e11. アドレスバーの更新\u003c/h1\u003e\n\n\u003cp\u003eWebコンテンツのURLが変わったタイミングで、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnAddressChanged.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnAddressChanged\u003c/a\u003eメソッドがCefSharpから呼び出されるので、ここで受け取ったURL文字列をアドレスバーに表示します。これだけです。\u003c/p\u003e\n\n\u003cp\u003e「\u003ca href=\"#10-%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E3%81%AE%E8%A1%A8%E7%A4%BA\"\u003e10. タイトルの表示\u003c/a\u003e」で\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IDisplayHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIDisplayHandler\u003c/a\u003eインタフェースを実装しているので、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnAddressChanged.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnAddressChanged\u003c/a\u003eメソッドの中身を実装していきます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"111-アドレスバーの文字列変更のメソッドを追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#111-%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%81%AE%E6%96%87%E5%AD%97%E5%88%97%E5%A4%89%E6%9B%B4%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e11.1 アドレスバーの文字列変更のメソッドを追加\u003c/h2\u003e\n\n\u003cp\u003eまず、メインフレームのクラスSimpleBrowserFrameにアドレスバー変更のメソッドを追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eアドレスバー更新用メソッド\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eupdateAddressBar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaddressBar\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"112-onaddresschangedを実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#112-onaddresschanged%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e11.2 OnAddressChangedを実装\u003c/h2\u003e\n\n\u003cp\u003e以下の様に、アドレスが変更になった\u003ccode\u003eIBrowser\u003c/code\u003eからSimpleBrowserFrameを取得して、アドレスバーの更新をします。\u003cbr\u003e\n※今回はタブ表示でないためアドレスバーは１つしかないので、\u003ccode\u003echromiumWebBrowser\u003c/code\u003eの親ウィンドウをたどってSimpleBrowserFrameを取得して操作するのと変わりませんが、複数タブを持つことを想定してこの実装にしています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOnAddressChangedの実装\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnAddressChanged\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAddressChangedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003eaddressChangedArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// アドレスバーを持つフォームを取得する。\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetMainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaddressChangedArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// UIスレッドのコンテキストで、アドレスバーの表示内容を更新する。\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBeginInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eupdateAddressBar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaddressChangedArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAddress\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e以上でアドレスバーの文字列が更新されるようになりました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"12-コンソールログ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#12-%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%83%AD%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e12. コンソールログ\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnConsoleMessage.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnConsoleMessage\u003c/a\u003eメソッドは、Webコンテンツから\u003ccode\u003econsole.log\u003c/code\u003eメソッドや\u003ccode\u003econsole.error\u003c/code\u003eメソッドでコンソールログを出力する時に呼びされるメソッドです。このメソッドを実装することで、コンソールログを保存するような処理を作ることができます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"121-log4netのnugetパッケージを追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#121-log4net%E3%81%AEnuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e12.1 Log4NetのNugetパッケージを追加\u003c/h2\u003e\n\n\u003cp\u003eログのライブラリは何を使ってもよいですが、ここでは人気にある\u003ca href=\"https://logging.apache.org/log4net/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eLog4net\u003c/a\u003eを使うことにします。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eソリューションエクスプローラで「SimpleBrowser」を選択して、コンテキストメニューから「NuGetパッケージの管理」を選択します。\u003c/li\u003e\n\u003cli\u003eNuGetパッケージマネージャで、「参照」タブを選択します。\u003c/li\u003e\n\u003cli\u003e検索ボックスに「Log4Net」と入力して検索を実行すると、Log4net関連のNugetパッケージが表示されます。\n\u003ca href=\"https://camo.qiitausercontent.com/f4743c79b0a0d9297402ca90dd1a8a1520e92bd4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f61376534336364302d343731642d393763312d383037302d6430363734653838383133342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fa7e43cd0-471d-97c1-8070-d0674e888134.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=72bc3cec070320e56340b05c59d512da\" alt=\"Nuget2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/a7e43cd0-471d-97c1-8070-d0674e888134.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fa7e43cd0-471d-97c1-8070-d0674e888134.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=209d70562bac0be37ef63d56698bddf3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eLog4netのnugetパッケージをインストールします。 \u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e以上で、Log4Netのパッケージ取り込み完了です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"122-log4netのコンフィグの追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#122-log4net%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%95%E3%82%A3%E3%82%B0%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e12.2 Log4netのコンフィグの追加\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"appconfigの変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#appconfig%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eApp.configの変更\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eApp.config\u003c/code\u003eに以下の定義を追加します。\u003cbr\u003e\u003cbr\u003e\nこの定義は以下の意味です。  \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e実行ファイルと同じディレクトリの\u003ccode\u003econsole.log\u003c/code\u003eファイルにログが記録される。\u003c/li\u003e\n\u003cli\u003eプログラムが何度再起動しても、同じログファイルに追加書き込みされる。\u003c/li\u003e\n\u003cli\u003eログのフォーマットは、「日付時刻 スレッド番号 レベル メッセージ」の形式である。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eApp.config\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?xml version=\"1.0\" encoding=\"utf-8\" ?\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;configuration\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;configSections\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;section\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"log4net\"\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"log4net.Config.Log4NetConfigurationSectionHandler,Log4net\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/configSections\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;log4net\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;appender\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ConsoleLog\"\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"log4net.Appender.FileAppender\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;File\u003c/span\u003e \u003cspan class=\"na\"\u003evalue=\u003c/span\u003e\u003cspan class=\"s\"\u003e\".\\\\console.log\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;AppendToFile\u003c/span\u003e \u003cspan class=\"na\"\u003evalue=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"true\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;layout\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"log4net.Layout.PatternLayout\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"nt\"\u003e\u0026lt;ConversionPattern\u003c/span\u003e \u003cspan class=\"na\"\u003evalue=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"%date [%thread] [%-5level] - %message%n\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;/layout\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/appender\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;root\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;level\u003c/span\u003e \u003cspan class=\"na\"\u003evalue=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ALL\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;appender-ref\u003c/span\u003e \u003cspan class=\"na\"\u003eref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ConsoleLog\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/root\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/log4net\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;startup\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;supportedRuntime\u003c/span\u003e \u003cspan class=\"na\"\u003eversion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"v4.0\"\u003c/span\u003e \u003cspan class=\"na\"\u003esku=\u003c/span\u003e\u003cspan class=\"s\"\u003e\".NETFramework,Version=v4.7.2\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/startup\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/configuration\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"assemblyinfocsの変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#assemblyinfocs%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAssemblyInfo.csの変更\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eAssemblyInfo.cs\u003c/code\u003eファイルに以下の定義を追加する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eAssemblyInfo.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003elog4net\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eXmlConfigurator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWatch\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"123-onconsolemessageメソッドの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#123-onconsolemessage%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e12.3 OnConsoleMessageメソッドの実装\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnConsoleMessage.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnConsoleMessage\u003c/a\u003eメソッドを実装して、Log4Netを使ってjavascriptのconsole.XXXメソッドの内容をログファイルに出力します。\u003c/p\u003e\n\n\u003cp\u003e具体的には、以下の様に実装します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOnConsoleMessageメソッドの実装\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp.Structs\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003elog4net\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDisplayHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisplayHandler\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// Logger\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eILog\u003c/span\u003e \u003cspan class=\"n\"\u003elogger\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eLogManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetLogger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ConsoleLog\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 省略\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnConsoleMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eConsoleMessageEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003econsoleMessageArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// ログレベルに合わせてLog4Netを呼び出してログを保存する。\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econsoleMessageArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eLogSeverity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econsoleMessageArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eLogSeverity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFatal\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFatal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econsoleMessageArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eLogSeverity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econsoleMessageArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eLogSeverity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWarning\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWarn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econsoleMessageArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eLogSeverity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVerbose\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econsoleMessageArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// コンソールにもメッセージを出力する\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e※\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnConsoleMessage.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnConsoleMessage\u003c/a\u003eメソッドのドキュメントには、\u003ccode\u003etrue\u003c/code\u003eを返却するとコンソールにログを出力しなくなると書かれていますが、実際には\u003ccode\u003etrue\u003c/code\u003eを返却してもコンソールにログが出力されているようです（CefSharpのバージョンも関係するかもしれません）。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"124-ログファイルの確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#124-%E3%83%AD%E3%82%B0%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e12.4 ログファイルの確認\u003c/h2\u003e\n\n\u003cp\u003eプログラムを起動するとプログラムと同じディレクトリに\u003ccode\u003econsole.log\u003c/code\u003eファイルができます。\u003cbr\u003e\n中身を見ると、コンソールログが出力されていることが確認できます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"batch\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eログファイルの内容\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"m\"\u003e2020\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e11\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e05\u003c/span\u003e \u003cspan class=\"m\"\u003e20\u003c/span\u003e:19:35\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"m\"\u003e861\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kd\"\u003eDEBUG\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"kd\"\u003eMain\u003c/span\u003e._createAppUI: \u003cspan class=\"m\"\u003e16\u003c/span\u003e.732177734375 \u003cspan class=\"kd\"\u003ems\u003c/span\u003e\n\u003cspan class=\"m\"\u003e2020\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e11\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e05\u003c/span\u003e \u003cspan class=\"m\"\u003e20\u003c/span\u003e:19:35\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"m\"\u003e873\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kd\"\u003eDEBUG\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"kd\"\u003eMain\u003c/span\u003e._showAppUI: \u003cspan class=\"m\"\u003e11\u003c/span\u003e.036865234375 \u003cspan class=\"kd\"\u003ems\u003c/span\u003e\n\u003cspan class=\"m\"\u003e2020\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e11\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e05\u003c/span\u003e \u003cspan class=\"m\"\u003e20\u003c/span\u003e:19:35\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"m\"\u003e908\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kd\"\u003eDEBUG\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"kd\"\u003eMain\u003c/span\u003e._initializeTarget: \u003cspan class=\"m\"\u003e9\u003c/span\u003e.383056640625 \u003cspan class=\"kd\"\u003ems\u003c/span\u003e\n\u003cspan class=\"m\"\u003e2020\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e11\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e05\u003c/span\u003e \u003cspan class=\"m\"\u003e20\u003c/span\u003e:19:36\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"m\"\u003e051\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kd\"\u003eDEBUG\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"kd\"\u003eMain\u003c/span\u003e._lateInitialization: \u003cspan class=\"m\"\u003e0\u003c/span\u003e.58984375 \u003cspan class=\"kd\"\u003ems\u003c/span\u003e\n\u003cspan class=\"m\"\u003e2020\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e11\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e05\u003c/span\u003e \u003cspan class=\"m\"\u003e20\u003c/span\u003e:19:52\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"m\"\u003e115\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kd\"\u003eINFO\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"kd\"\u003eabc\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"13-ダウンロード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#13-%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e13. ダウンロード\u003c/h1\u003e\n\n\u003cp\u003eファイルのダウンロード機能を実装することができます。\u003cbr\u003e\n\u003ccode\u003edownload\u003c/code\u003e属性を持つ\u003ccode\u003ea\u003c/code\u003e要素をクリックした場合など、ブラウザがダウンロードと判断した場合に、ファイルのダウンロードが行われます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"131-idownloadhandlerを実装するクラスを追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#131-idownloadhandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e13.1 IDownloadHandlerを実装するクラスを追加\u003c/h2\u003e\n\n\u003cp\u003eまず、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/Methods_T_CefSharp_IDownloadHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIDownloadHandler\u003c/a\u003eインタフェースを実装するクラスを新規に作成します。 \u003cbr\u003e\nリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に\u003ccode\u003eDownloadHandler\u003c/code\u003eを指定します。そして、以下のように\u003ccode\u003eIDownloadHandler\u003c/code\u003eを実装させます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIDownloadHandlerを実装するクラス\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDownload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eIDownloadHandler\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eその後、\u003ccode\u003eIDownloadHandler\u003c/code\u003eを選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択する。\u003cbr\u003e\nすると、\u003ccode\u003eIDownloadHandler\u003c/code\u003eインタフェースの以下のメソッドが仮実装されます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eOnBeforeDownload\u003c/li\u003e\n\u003cli\u003eOnDownloadUpdated\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"132-onbeforedownloadの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#132-onbeforedownload%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e13.2 OnBeforeDownloadの実装\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadHandler_OnBeforeDownload.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnBeforeDownload\u003c/a\u003eメソッドは、ダウンロードするファイルの保存先やファイル名を決めるためのメソッドです。\u003cbr\u003e\nプログラムで保存場所を決めることも、ユーザにファイルの保存先を問い合わせることができます。\u003c/p\u003e\n\n\u003cp\u003eCefSharpのドキュメントにはダウンロードが開始される前に呼び出されると書かれています。\u003cbr\u003e\nしかし、実際にはdownload属性のあるa要素をクリックすると、即座にダウンロードが開始され、最初に\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadHandler_OnDownloadUpdated.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnDownloadUpdated\u003c/a\u003eメソッドが呼び出されます。そして、次にこのメソッドが呼び出されますが、バックグラウンドではダウンロード処理が進行しています。\u003c/p\u003e\n\n\u003cp\u003eここでは、ユーザに保存場所を問い合わせるようにします。\u003cbr\u003e\nこれを行うためには、引数で渡される\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadHandler_OnBeforeDownload.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIBeforeDownloadCallback\u003c/a\u003eインタフェースの\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IBeforeDownloadCallback_Continue.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eContinue\u003c/a\u003eメソッドを呼び出します。\u003c/p\u003e\n\n\u003cp\u003e以下の例では、デフォルトのファイル保存ダイアログが表示されます。\u003cbr\u003e\n※第二引数を\u003ccode\u003etrue\u003c/code\u003eにするとCefSharpがファイル保存ダイアログを出してくれます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOnBeforeDownloadの実装(その1)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIDownloadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnBeforeDownload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDownloadItem\u003c/span\u003e \u003cspan class=\"n\"\u003edownloadItem\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBeforeDownloadCallback\u003c/span\u003e \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ファイル保存ダイアログを表示する。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 最初に表示される保存先とファイル名はCefSharpに任せる。\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContinue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eもちろん以下の様に書けば、ユーザに問い合わせることなく、自動的に指定したファイルに保存することもできます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOnBeforeDownloadの実装(その2)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIDownloadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnBeforeDownload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDownloadItem\u003c/span\u003e \u003cspan class=\"n\"\u003edownloadItem\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBeforeDownloadCallback\u003c/span\u003e \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// c:\\temp配下時自動的に保存する。\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContinue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"c:\\temp\\\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003edownloadItem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSuggestedFileName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"133-ondownloadupdatedの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#133-ondownloadupdated%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e13.3 OnDownloadUpdatedの実装\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadHandler_OnDownloadUpdated.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnDownloadUpdated\u003c/a\u003eメソッドはダウンロードが開始すると最初に呼び出され、その後ダウンロードの進捗に合わせて繰り返し呼び出されます。\u003cbr\u003e\nこのメソッドでは、ダウンロードのキャンセル・中断・再開ができます。\u003cbr\u003e\nまた、ダウンロードの進捗率が通知されるので、ユーザに進捗状況を表示する処理も実装可能です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eダウンロードを継続する場合\u003cbr\u003e\n特に何もしなければ、ダウンロードが継続されます。\u003c/li\u003e\n\u003cli\u003eダウンロードをキャンセルする場合\u003cbr\u003e\n引数で指定される\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IDownloadItemCallback.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIDownloadItemCallback\u003c/a\u003eインタフェースの\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadItemCallback_Cancel.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCancel\u003c/a\u003eメソッドを呼び出します。なお、ダウンロード処理はバックグラウンドで継続しているので、一度キャンセルを行っても即座に中断されずに何度かOnDownloadUpdatedメソッドが呼び出される場合があるので注意が必要です。\u003c/li\u003e\n\u003cli\u003eダウンロードを中断する場合\u003cbr\u003e\n引数で指定される\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IDownloadItemCallback.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIDownloadItemCallback\u003c/a\u003eインタフェースの\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadItemCallback_Pause.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003ePause\u003c/a\u003eメソッドを呼び出します。\u003c/li\u003e\n\u003cli\u003eダウンロードを再開する場合\u003cbr\u003e\n引数で指定される\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IDownloadItemCallback.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIDownloadItemCallback\u003c/a\u003eインタフェースの\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadItemCallback_Resume.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eResume\u003c/a\u003eメソッドを呼び出します。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eここでは、キャンセルも中断も行わないため、特に何も実装しません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"134-idownloadhandlerの指定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#134-idownloadhandler%E3%81%AE%E6%8C%87%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e13.4 IDownloadHandlerの指定\u003c/h2\u003e\n\n\u003cp\u003e最後に\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_WinForms_ChromiumWebBrowser_DownloadHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eChromiumWebBrowser.DownloadHandler\u003c/a\u003eプロパティに、実装した\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/Methods_T_CefSharp_IDownloadHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIDownloadHandler\u003c/a\u003eインタフェースを設定することで、CefSharpがこのインタフェースを呼び出すようになります。\u003c/p\u003e\n\n\u003cp\u003e具体的には、以下の様に指定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eChromiumWebBrowserにIDownloadHandlerを設定\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// (省略)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDownloadHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDownloadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"135-ダウンロード処理の確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#135-%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E5%87%A6%E7%90%86%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e13.5 ダウンロード処理の確認\u003c/h2\u003e\n\n\u003cp\u003e例えば\u003ca href=\"https://nodejs.org/en/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://nodejs.org/en/\u003c/a\u003eにアクセスして、node.jsのインストーラをダウンロードしてみましょう。\u003cbr\u003e\n正しく実装できていると「Save File」ダイアログが表示され、保存ボタンをクリックすると、指定した場所にファイルが保存されることが確認できます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"14-faviconの表示\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#14-favicon%E3%81%AE%E8%A1%A8%E7%A4%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e14. faviconの表示\u003c/h1\u003e\n\n\u003cp\u003efaviconはHTMLで指定されているサイトのアイコンです。\u003cbr\u003e\nここでは、faviconの表示方法を説明します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"141-faviconの仕様\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#141-favicon%E3%81%AE%E4%BB%95%E6%A7%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e14.1 faviconの仕様\u003c/h2\u003e\n\n\u003cp\u003efaviconの仕様は少しゆるい仕様で、faviconの表示を厳密に実装するのは少し大変です。  \u003c/p\u003e\n\n\u003cp\u003e指定できるイメージの形式は、\u003ca href=\"https://www.w3.org/2005/10/howto-favicon\" rel=\"nofollow noopener\" target=\"_blank\"\u003eW3C\u003c/a\u003eではPNG、GIF、ICOのいずれかとしていますが、実際にはJPEGやSVGもサポートしているブラウザも多いです。また、\u003ccode\u003etype\u003c/code\u003e属性でのファイルタイプの指定は強制ではないため、\u003ccode\u003etype\u003c/code\u003e属性を指定していないサイトも多くあります。また、複数のfaviconを設定することもできます。\u003c/p\u003e\n\n\u003cp\u003e以下はHTMLでのfaviconの指定例です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eHTMLでのfaviconの指定例\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e\u0026lt;!-- イメージの型を指定しない --\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;link\u003c/span\u003e \u003cspan class=\"na\"\u003erel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"shortcut icon\"\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"https://example.com/myicon.ico\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e\u0026lt;!-- イメージの型を指定する --\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;link\u003c/span\u003e \u003cspan class=\"na\"\u003erel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"icon\"\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"image/gif\"\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"https://example.com/image.gif\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e以上の様にfaviconを扱うのは少し面倒ですが、ここでは以下の方針とします。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eどのファイルタイプまでサポートするのか？\u003cbr\u003e\nPNG、GIF、ICOをサポートする様にします。\u003c/li\u003e\n\u003cli\u003eイメージ形式か分からない場合に、どのように表示するのか？\u003cbr\u003e\nイメージの形式を判断するために、サーバが指定するMimeTypeをを使用するようにします。\u003cbr\u003e\nなお、\u003ccode\u003etype\u003c/code\u003e属性が指定されていても、CefSharpではその属性値を受け取ることができません。\u003cbr\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"142-faviconの表示処理を追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#142-favicon%E3%81%AE%E8%A1%A8%E7%A4%BA%E5%87%A6%E7%90%86%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e14.2 faviconの表示処理を追加\u003c/h2\u003e\n\n\u003cp\u003eまず、フォームのアイコンをfaviconに変更する処理を追加します。\u003cbr\u003e\n以下の様にfaviconファイルのパスとMimeTypeを引数に持つメソッドを追加して、指定されたファイルパスのfaviconをフォームのアイコンとして表示します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003efavicon更新処理の例\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eForm\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// (省略)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eupdateFavicon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003emimeType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// MIME-Typeに応じて、Iconオブジェクトを作成する。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eIcon\u003c/span\u003e \u003cspan class=\"n\"\u003eicon\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emimeType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToLower\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// pngとgifの場合\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"image/png\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"image/gif\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eBitmap\u003c/span\u003e \u003cspan class=\"n\"\u003ebitmap\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eImage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eicon\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eIcon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetHicon\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// iconの場合\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"image/vnd.microsoft.icon\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"image/x-icon\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eicon\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eIcon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExtractAssociatedIcon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// ファビコンを表示する\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eicon\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIcon\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eicon\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// FVICONファイルを削除する。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIO\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// (省略)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"143-faviconのダウンロード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#143-favicon%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e14.3 faviconのダウンロード\u003c/h2\u003e\n\n\u003cp\u003eCefSharpではfaviconが変わるタイミングで、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDisplayHandler_OnFaviconUrlChange.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIDisplayHandler.OnFaviconUrlChange\u003c/a\u003eメソッドが呼び出されます。\u003cbr\u003e\nしかし、faviconの取得はアプリ開発者に任されています。\u003cbr\u003e\nfaviconを取得するには、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IBrowserHost_StartDownload.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIBrowserHost.StartDownload\u003c/a\u003eメソッドでダウンロードします。\u003cbr\u003e\n※このメソッドを使うと任意のファイルをダウンロードすることができます。\u003c/p\u003e\n\n\u003cp\u003eダウンロードが行われると、「\u003ca href=\"#13-%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\"\u003e13. ダウンロード\u003c/a\u003e」で説明したように、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/Methods_T_CefSharp_IDownloadHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIDownloadHandler\u003c/a\u003eインタフェースのメソッドが呼び出されることになります。\u003cbr\u003e\nこのインタフェースはユーザがファイルのダウンロードを行う際にも呼び出されるため、ユーザがダウンロードしたファイルなのか、faviconとしてプログラムでダウンロードしたものなのかを判断する必要がでてきます。\u003cbr\u003e\nこのため、ダウンロード中のfaviconを管理するリストをもうけます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ダウンロード中のfaviconのリストを作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E4%B8%AD%E3%81%AEfavicon%E3%81%AE%E3%83%AA%E3%82%B9%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eダウンロード中のfaviconのリストを作成\u003c/h3\u003e\n\n\u003cp\u003eダウンロード中のfaviconを管理するリストを以下の様に作成します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eダウンロード中のfaviconのリスト\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eForm\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// (省略)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// ダウンロード中のfaviconのリスト\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eFavicons\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// (省略)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"faviconをダウンロードする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#favicon%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003efaviconをダウンロードする\u003c/h3\u003e\n\n\u003cp\u003eダウンロードする前にダウンロード中のfaviconリストにfaviconのURLを追加して、その後faviconをダウンロードします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOnFaviconUrlChangeメソッドの実装\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnFaviconUrlChange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eurls\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// コントロールのトップレベルのコントロールを取得（SimpleBrowserFrame）\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetMainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ロード中のFaviconを登録する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFavicons\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurls\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// Faviconをロードする。\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetHost\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eStartDownload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurls\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"144-onbeforedownloadの変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#144-onbeforedownload%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e14.4 OnBeforeDownloadの変更\u003c/h2\u003e\n\n\u003cp\u003e「\u003ca href=\"#13-%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\"\u003e13. ダウンロード\u003c/a\u003e」で実装した\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadHandler_OnBeforeDownload.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnBeforeDownload\u003c/a\u003eメソッドを、適当なパスにfaviconを自動保存するように変更します。\u003c/p\u003e\n\n\u003cp\u003e以下の様に、ダウンロードしている対象のURLがダウンロード中のfaviconのリストに含まれている場合は、ランダムなファイル名で保存するように変更します。それ以外のURLの場合は、これまで通りファイル保存ダイアログを表示して、保存場所をユーザに問い合わせるようにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOnBeforeDownloadの実装\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIDownloadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnBeforeDownload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDownloadItem\u003c/span\u003e \u003cspan class=\"n\"\u003edownloadItem\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBeforeDownloadCallback\u003c/span\u003e \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// コントロールのトップレベルのコントロールを取得（SimpleBrowserFrame）\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetMainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// faviconの場合は、ランダムなファイル名で保存\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFavicons\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edownloadItem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContinue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"c:\\\\temp\\\\\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetRandomFileName\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// それ以外の場合は、ファイル保存ダイアログを表示して保存する。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContinue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"145-ondownloadupdatedの変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#145-ondownloadupdated%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e14.5 OnDownloadUpdatedの変更\u003c/h2\u003e\n\n\u003cp\u003e「\u003ca href=\"#13-%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\"\u003e13. ダウンロード\u003c/a\u003e」で実装した\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IDownloadHandler_OnDownloadUpdated.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnDownloadUpdated\u003c/a\u003eメソッドで、faviconのダウンロードが完了した時にフォームのアイコンを変更するように変更します。\u003c/p\u003e\n\n\u003cp\u003e以下の様に、ファイルのダウンロードが完了した場合で、且つダウンロードした対象がfaviconの場合に、フォームのアイコンを更新するようにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOnDownloadUpdatedの実装\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIDownloadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnDownloadUpdated\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDownloadItem\u003c/span\u003e \u003cspan class=\"n\"\u003edownloadItem\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIDownloadItemCallback\u003c/span\u003e \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ダウンロードが完了した場合\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edownloadItem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsComplete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// コントロールのトップレベルのコントロールを取得（SimpleBrowserFrame）\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetMainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// faviconの場合\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFavicons\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edownloadItem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// ロード中のfaviconファイルのリストから取り除く\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFavicons\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRemove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edownloadItem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// フォームのアイコンを更新する。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBeginInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003emainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eupdateFavicon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edownloadItem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullPath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edownloadItem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMimeType\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"146-faviconの確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#146-favicon%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e14.6 faviconの確認\u003c/h2\u003e\n\n\u003cp\u003e以上でfaviconが表示されるようになったはずです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b5bb223cf0f7c4b2aa2d6091e699bcc790702a0d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f32616265626134352d663633632d383033372d323034312d3431653461343361323739382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F2abeba45-f63c-8037-2041-41e4a43a2798.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=42b4f23275ba45de58974181be1ad3f5\" alt=\"favicon.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/2abeba45-f63c-8037-2041-41e4a43a2798.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F2abeba45-f63c-8037-2041-41e4a43a2798.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5d564dc192d1d8fb580830ed3a4dc74c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nおー、faviconが表示されています。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"15-pdf表示\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#15-pdf%E8%A1%A8%E7%A4%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e15. pdf表示\u003c/h1\u003e\n\n\u003cp\u003e特に何もコードを書かなくても、pdfをロードすると、chromeのエクステンションによってPDFが表示されます。  \u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"16-特定サイトのブロック\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#16-%E7%89%B9%E5%AE%9A%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AE%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e16. 特定サイトのブロック\u003c/h1\u003e\n\n\u003cp\u003e特定のサイトのナビゲーションをブロックするには、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IRequestHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler\u003c/a\u003eインタフェースの\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnBeforeBrowse.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnBeforeBrowse\u003c/a\u003eメソッドで\u003ccode\u003etrue\u003c/code\u003eを返却するだけです。このメソッドはフレームにURLがロードされることをブロックします。Webサイトの個々のリソース（image、javascript、css、ajaxで取得されるリソース等）のロードを個別にブロックする場合、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_OnBeforeResourceLoad.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIResourceRequestHandler.OnBeforeResourceLoad\u003c/a\u003eメソッドでブロックすることができます。\u003c/p\u003e\n\n\u003cp\u003eここでは、\u003ca href=\"https://www.yahoo.co.jp/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.yahoo.co.jp/\u003c/a\u003eへのナビゲーションを禁止してみます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"161-onbeforebrowseメソッドの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#161-onbeforebrowse%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e16.1 OnBeforeBrowseメソッドの実装\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_OnBeforeBrowse.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnBeforeBrowse\u003c/a\u003eメソッドを実装します。\u003cbr\u003e\n実装は非常に簡単です。 \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003etrue\u003c/code\u003eを返却すると、ナビゲーションが中止されます。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003efalse\u003c/code\u003eを返却すると、ナビゲーションが継続します。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e以下は実装例です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOnBeforeBrowseメソッドの実装\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequestHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequestHandler\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// (省略)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnBeforeBrowse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003euserGesture\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisRedirect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStartsWith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"https://www.yahoo.co.jp/\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// ナビゲーションを中止する\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// ナビゲーションを許可する\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"162-表示がブロックされるか確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#162-%E8%A1%A8%E7%A4%BA%E3%81%8C%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%81%95%E3%82%8C%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e16.2 表示がブロックされるか確認\u003c/h2\u003e\n\n\u003cp\u003eビルドしてブラウザを起動して、アドレスバーに\u003ca href=\"https://www.yahoo.co.jp/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.yahoo.co.jp/\u003c/a\u003eを入力してみます。\u003cbr\u003e\n正しく実装できていると、ページがロードされないはずです。\u003c/p\u003e\n\n\u003cp\u003e以上、非常に簡単だったと思います。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"17-cookie\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#17-cookie\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e17. Cookie\u003c/h1\u003e\n\n\u003cp\u003eCookieは保存と送信をそれぞれ許可またはブロックすることができます。\u003cbr\u003e\nここでは、Cookieの保存と送信の制御の方法を説明します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"171-icookieaccessfilterインタフェースを実装するクラスを追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#171-icookieaccessfilter%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e17.1 ICookieAccessFilterインタフェースを実装するクラスを追加\u003c/h1\u003e\n\n\u003cp\u003eまず、クッキーをコントロールするために、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetCookieAccessFilter.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eICookieAccessFilter\u003c/a\u003eインタフェースを実装するクラスを新たに追加します。\u003cbr\u003e\nソリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に\u003ccode\u003eCookieAccessFilter\u003c/code\u003eを指定します。そして、以下のように\u003ccode\u003eICookieAccessFilter\u003c/code\u003eを実装させます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eICookieAccessFilterを実装するクラス\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eCookieAccessFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eICookieAccessFilter\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eその後、\u003ccode\u003eICookieAccessFilter\u003c/code\u003eを選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。すると\u003ccode\u003eICookieAccessFilter\u003c/code\u003eインタフェースのメソッドがすべて仮実装されます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"172-cansavecookieメソッドの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#172-cansavecookie%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e17.2 CanSaveCookieメソッドの実装\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ICookieAccessFilter_CanSaveCookie.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCanSaveCookie\u003c/a\u003eメソッドは、レスポンスヘッダに\u003ccode\u003eSet-Cookie\u003c/code\u003eが設定されている場合に、cookieを保存するかどうかを判断するためにリソース毎に呼び出されます。\u003cbr\u003e\nこのメソッドではcookieを受け入れるかどうかを返却値で決定します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003etrue\u003c/code\u003eを返却すると、cookieが保存されます。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003efalse\u003c/code\u003eを返却すると、cookieが保存されません。\u003cbr\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eここでは、すべてのサイトでCookieを保存しないようにしてみます。  \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCanSaveCookieメソッドの実装\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eICookieAccessFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCanSaveCookie\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIResponse\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCookie\u003c/span\u003e \u003cspan class=\"n\"\u003ecookie\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// cookieを保存しないようにする。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"173-cansendcookieメソッドの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#173-cansendcookie%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e17.3 CanSendCookieメソッドの実装\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ICookieAccessFilter_CanSendCookie.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCanSendCookie\u003c/a\u003eメソッドは、リソース毎にリクエストヘッダに\u003ccode\u003eCookie\u003c/code\u003eを設定するかどうか判断するために呼び出されます。\u003cbr\u003e\nこのメソッドではcookieを送信するかどうかを返却値で決定します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003etrue\u003c/code\u003eを返却すると、cookieが送信されます。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003efalse\u003c/code\u003eを返却すると、cookieが送信されません。\u003cbr\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eここでは、すべてのサイトでCookieを送信しないようにしてみます。  \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCanSendCookieメソッドの実装\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eICookieAccessFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCanSendCookie\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCookie\u003c/span\u003e \u003cspan class=\"n\"\u003ecookie\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// cookieを送信しないようにする。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"173-iresourcerequesthandlerインタフェースを実装するクラスの追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#173-iresourcerequesthandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e17.3 IResourceRequestHandlerインタフェースを実装するクラスの追加\u003c/h1\u003e\n\n\u003cp\u003e先ほど作成した\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetCookieAccessFilter.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eICookieAccessFilter\u003c/a\u003eインタフェースを実装したクラスを利用するために、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IResourceRequestHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIResourceRequestHandler\u003c/a\u003eインタフェースを実装するクラスが必要になります。以下の流れで新しいクラスを追加します。\u003c/p\u003e\n\n\u003cp\u003eソリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に\u003ccode\u003eResourceRequestHandler\u003c/code\u003eを指定します。そして、以下のように\u003ccode\u003eIResourceRequestHandler\u003c/code\u003eを実装させます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIResourceRequestHandlerを実装するクラス\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eResourceRequestHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIResourceRequestHandler\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eその後、\u003ccode\u003eIResourceRequestHandler\u003c/code\u003eを選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。すると\u003ccode\u003eIResourceRequestHandler\u003c/code\u003eインタフェースのメソッドがすべて仮実装されます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"174-iresourcerequesthandlerインタフェースのメソッドを仮実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#174-iresourcerequesthandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BB%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e17.4 IResourceRequestHandlerインタフェースのメソッドを仮実装\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetCookieAccessFilter.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGetCookieAccessFilter\u003c/a\u003e\u003cbr\u003e\n独自のCookieの制御を行う場合は\u003ccode\u003eICookieAccessFilter\u003c/code\u003eを返却します。\u003cbr\u003e\n今回はCookieを制御するため、先程作成した\u003ccode\u003eCookieAccessFilter\u003c/code\u003eクラスのインスタンスを返却するようにします。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetResourceHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGetResourceHandler\u003c/a\u003e\u003cbr\u003e\n独自のリソースハンドラを返却します。\u003cbr\u003e\nここでは独自のリソースハンドラは実装しないため\u003ccode\u003enull\u003c/code\u003eを返却します。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetResourceResponseFilter.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGetResourceResponseFilter\u003c/a\u003e\u003cbr\u003e\n独自のリソースフィルタを返却します。\u003cbr\u003e\nリソースフィルタはサーバからのレスポンスを変更するための機能で非常に便利です。\u003cbr\u003e\nここでは独自のリソースフィルタを実装しないため\u003ccode\u003enull\u003c/code\u003eを返却します。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_OnBeforeResourceLoad.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnBeforeResourceLoad\u003c/a\u003e\u003cbr\u003e\nリソースがロードする前に呼び出されるメソッドです。\u003cbr\u003e\nリソースのロードをブロックしたい場合は、このメソッドを実装します。\u003cbr\u003e\nここではリソースのロードをブロックしないため、\u003ccode\u003eCefReturnValue.Continue\u003c/code\u003eをリターンします。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_OnProtocolExecution.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnProtocolExecution\u003c/a\u003e\u003cbr\u003e\n不明なプロトコルを持つURLが処理されるときに呼び出されます。\u003cbr\u003e\nOSで登録されているプロトコルの呼び出しを試みる場合は\u003ccode\u003etrue\u003c/code\u003eを返却します。\u003cbr\u003e\nここでは何もしないように\u003ccode\u003efalse\u003c/code\u003eを返却します。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_OnResourceLoadComplete.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnResourceLoadComplete\u003c/a\u003e\u003cbr\u003e\nリソースのロードが完了した時に呼び出されます。\u003cbr\u003e\nここでは特に何もしません。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_OnResourceRedirect.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnResourceRedirect\u003c/a\u003e\u003cbr\u003e\nリソースがリダイレクトされるときに呼び出されます。\u003cbr\u003e\nここでは特に何もしません。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_OnResourceResponse.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnResourceResponse\u003c/a\u003e\u003cbr\u003e\nリソースのレスポンスを受信したときに呼び出されます。\u003cbr\u003e\nリソースをリダイレクトさせることができるようですが、この機能は将来廃止されるようです。\u003cbr\u003e\nここでは特に処理を行わないため\u003ccode\u003efalse\u003c/code\u003eを返却します。\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e以下に実装例を示します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIResourceRequestHandlerインタフェースの実装\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eResourceRequestHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIResourceRequestHandler\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eICookieAccessFilter\u003c/span\u003e \u003cspan class=\"n\"\u003eIResourceRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCookieAccessFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 独自のCookieの制御を行います。\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCookieAccessFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eIResourceHandler\u003c/span\u003e \u003cspan class=\"n\"\u003eIResourceRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetResourceHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eIResponseFilter\u003c/span\u003e \u003cspan class=\"n\"\u003eIResourceRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetResourceResponseFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIResponse\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eCefReturnValue\u003c/span\u003e \u003cspan class=\"n\"\u003eIResourceRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnBeforeResourceLoad\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequestCallback\u003c/span\u003e \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eCefReturnValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eIResourceRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnProtocolExecution\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIResourceRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnResourceLoadComplete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIResponse\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUrlRequestStatus\u003c/span\u003e \u003cspan class=\"n\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ereceivedContentLength\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIResourceRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnResourceRedirect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIResponse\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003enewUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eIResourceRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnResourceResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIResponse\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"175-irequesthandlergetresourcerequesthandlerメソッドを実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#175-irequesthandlergetresourcerequesthandler%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e17.5 IRequestHandler.GetResourceRequestHandlerメソッドを実装\u003c/h1\u003e\n\n\u003cp\u003e作成した\u003ccode\u003eIResourceRequestHandler\u003c/code\u003eインタフェースを実装したクラスが使われるように、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IRequestHandler_GetResourceRequestHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIRequestHandler.GetResourceRequestHandler\u003c/a\u003eメソッドを実装します。\u003c/p\u003e\n\n\u003cp\u003e以下の様に、\u003ccode\u003eGetResourceRequestHandler\u003c/code\u003eメソッドで\u003ccode\u003eIResourceRequestHandler\u003c/code\u003eインタフェースを返却する様にします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eGetResourceRequestHandlerメソッドを実装\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequestHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequestHandler\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// (省略)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIResourceRequestHandler\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetResourceRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisNavigation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisDownload\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003erequestInitiator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003edisableDefaultHandling\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 独自のIResourceRequestHandlerを返却する。\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eResourceRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"176-cookieがブロックされることを確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#176-cookie%E3%81%8C%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%81%95%E3%82%8C%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e17.6 Cookieがブロックされることを確認\u003c/h1\u003e\n\n\u003cp\u003e以上の実装で全てのCookieがブロックされるようになりました。\u003cbr\u003e\n確認のために、開発者ツールを起動してみます。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eブラウザを起動する. \u003c/li\u003e\n\u003cli\u003eF12キーを押下して開発者ツールを立ち上げる。\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eApplicationを選択して「Clear Site Data」ボタンをクリックして\u003ccode\u003eCookie\u003c/code\u003eを削除する。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/a865d5e394818e6a1f0504d6d2d46c2e300db8c2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f31346333616332612d343831382d356437632d663838312d3865626561316663613634612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F14c3ac2a-4818-5d7c-f881-8ebea1fca64a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b9871bc89039193021426090c7e52eb1\" alt=\"Cookie削除.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/14c3ac2a-4818-5d7c-f881-8ebea1fca64a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F14c3ac2a-4818-5d7c-f881-8ebea1fca64a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3ad2898b9c193508e3bd03b1391bbc8a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eF5でページをリロードする。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eレスポンスを確認する。\u003cbr\u003e\n開発者ツールのnetworkを選択して、リクエストの内容を確認してみると\u003ccode\u003eCookie\u003c/code\u003eがないことが確認できます。\u003cbr\u003e\nつまり、\u003ccode\u003eCookie\u003c/code\u003eは送信されていません。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/9db26007649abebd41671c164a2760fc28b75050/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f38663738373566362d383564652d383030302d326266372d6438303538633735343130302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F8f7875f6-85de-8000-2bf7-d8058c754100.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7ec53d25487c4aada3a630d8bdd78144\" alt=\"response1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/8f7875f6-85de-8000-2bf7-d8058c754100.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F8f7875f6-85de-8000-2bf7-d8058c754100.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fccaaf855793a15375563a23eccd1aae 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eCookieを確認する。\u003cbr\u003e\nApplicationのCookieを選択すると、以下の様にCookieが保存されていないことが確認できます。\u003cbr\u003e\nつまり、\u003ccode\u003eCookie\u003c/code\u003eは保存されていません。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/356fcc15a6db53e8f61660ec976de8eb64c43635/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f63386565353262632d326434392d323261392d396362302d3564643465323466656236302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fc8ee52bc-2d49-22a9-9cb0-5dd4e24feb60.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3860b82e58e660300ada8a2bcbb73938\" alt=\"cookie.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/c8ee52bc-2d49-22a9-9cb0-5dd4e24feb60.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fc8ee52bc-2d49-22a9-9cb0-5dd4e24feb60.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=600e48a1039e21bebd04f9a1b993fb56 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e以上でCookieを保存と送信が制御できることが確認できました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"18-スクリプト実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#18-%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e18. スクリプト実行\u003c/h1\u003e\n\n\u003cp\u003e表示しているWebページで任意のスクリプトを実行することができます。\u003cbr\u003e\n例えば、ページのロードが完了した時点で、\u003ccode\u003ebody\u003c/code\u003eの背景色を赤色にするスクリプトを実行することができます。\u003cbr\u003e\nここでは、まず初めにWebページのロード完了をハンドリングするために、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILoadHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eILoadHandler\u003c/a\u003eインタフェースを実装します。\u003cbr\u003e\n次に、ロード完了時にスクリプトを実行して、\u003ccode\u003ebody\u003c/code\u003eの背景色を設定してみます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"181-iloadhandlerを実装するクラスを追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#181-iloadhandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e18.1 ILoadHandlerを実装するクラスを追加\u003c/h2\u003e\n\n\u003cp\u003eまず、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILoadHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eILoadHandler\u003c/a\u003eインタフェースを実装するクラスを新規に作成します。 \u003cbr\u003e\nリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に\u003ccode\u003eLoadHandler\u003c/code\u003eを指定します。そして、以下のように\u003ccode\u003eILoadHandler\u003c/code\u003eインタフェースを実装させます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eILoadHandlerを実装するクラス\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLoadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eILoadHandler\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eその後、\u003ccode\u003eILoadHandler\u003c/code\u003eを選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。すると\u003ccode\u003eILoadHandler\u003c/code\u003eインタフェースのメソッドがすべて仮実装されます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"182-iloadhandlerのメソッドを仮実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#182-iloadhandler%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BB%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e18.2 ILoadHandlerのメソッドを仮実装\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILoadHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eILoadHandler\u003c/a\u003eインタフェースの各メソッドを仮実装します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILoadHandler_OnFrameLoadEnd.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eILoadHandler.OnFrameLoadEnd\u003c/a\u003e\u003cbr\u003e\nブラウザがフレーム(iframeやframeのこと)のロードを終了した時点で呼び出されます。\u003cbr\u003e\nここでは特に何もしません。\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILoadHandler_OnFrameLoadStart.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eILoadHandler.OnFrameLoadStart\u003c/a\u003e\u003cbr\u003e\nブラウザがフレーム(iframeやframeのこと)のロードを開始した時点で呼び出されます。\u003cbr\u003e\nここでは特に何もしません。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILoadHandler_OnLoadError.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eILoadHandler.OnLoadError\u003c/a\u003e\u003cbr\u003e\nナビゲーションの失敗やキャンセルによりエラーになった時点で呼び出されます。\u003cbr\u003e\nここでは特に何もしません。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILoadHandler_OnLoadingStateChange.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eILoadHandler.OnLoadingStateChange\u003c/a\u003e\u003cbr\u003e\nロードの状態が変化した時点で呼び出されます。\u003cbr\u003e\n以下の「\u003ca href=\"#183-iloadhandleronloadingstatechange%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e18.3 ILoadHandler.OnLoadingStateChangeメソッドの実装\u003c/a\u003e」で、ドキュメントのロード完了をハンドリングして、スクリプトを実行するようにしていきます。  \u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"183-iloadhandleronloadingstatechangeメソッドの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#183-iloadhandleronloadingstatechange%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e18.3 ILoadHandler.OnLoadingStateChangeメソッドの実装\u003c/h2\u003e\n\n\u003cp\u003e引数で渡される\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_LoadingStateChangedEventArgs.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eLoadingStateChangedEventArgs\u003c/a\u003eの\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_LoadingStateChangedEventArgs_IsLoading.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIsLoading\u003c/a\u003eプロパティを参照することでロードが完了したかどうかを判断することができます。そして、ロードが完了していれば、スクリプトを実行することにします。\u003cbr\u003e\nスクリプトを実行するためには、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IFrame_EvaluateScriptAsync.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIFrame.EvaluateScriptAsync\u003c/a\u003eを呼び出します。\u003c/p\u003e\n\n\u003cp\u003e以下は実装例です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOnLoadingStateChangeメソッドでスクリプトを実行する例\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLoadHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eILoadHandler\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eILoadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnFrameLoadEnd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFrameLoadEndEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003eframeLoadEndArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eILoadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnFrameLoadStart\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFrameLoadStartEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003eframeLoadStartArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eILoadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnLoadError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLoadErrorEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003eloadErrorArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eILoadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnLoadingStateChange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLoadingStateChangedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003eloadingStateChangedArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// ロードが完了した場合\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003eloadingStateChangedArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsLoading\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// Javascriptを実行する。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eloadingStateChangedArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEvaluateScriptAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"document.body.setAttribute('style', 'background-color:red;')\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"184-iloadhandlerの指定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#184-iloadhandler%E3%81%AE%E6%8C%87%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e18.4 ILoadHandlerの指定\u003c/h2\u003e\n\n\u003cp\u003e最後に\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_WinForms_ChromiumWebBrowser_LoadHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eChromiumWebBrowser.LoadHandler\u003c/a\u003eプロパティに、実装した\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILoadHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eILoadHandler\u003c/a\u003eインタフェースを設定することで、CefSharpがこのインタフェースを呼び出すようになります。\u003c/p\u003e\n\n\u003cp\u003e具体的には、以下の様に指定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eChromiumWebBrowserにILoadHandlerインタフェースを設定\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// (省略)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLoadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"185-スクリプト実行の確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#185-%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E5%AE%9F%E8%A1%8C%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e18.5 スクリプト実行の確認\u003c/h2\u003e\n\n\u003cp\u003eビルドして実行してみます。\u003cbr\u003e\n正しく実装できるていると、以下の様に\u003ccode\u003ebody\u003c/code\u003eの背景色が赤色になっているはずです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/885507e34fef90a1293f8cdc74873b7cf9b4d226/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f62636132313762632d373063622d626561362d396639632d3039316264363339313036632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fbca217bc-70cb-bea6-9f9c-091bd639106c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1ecfc123314ae7042b39e644d5884255\" alt=\"スクリプト実行.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/bca217bc-70cb-bea6-9f9c-091bd639106c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Fbca217bc-70cb-bea6-9f9c-091bd639106c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1897f70bca0df5dbd7d473d139b19dec 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"186-スクリプトの実行して結果を受け取る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#186-%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E7%B5%90%E6%9E%9C%E3%82%92%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e18.6 スクリプトの実行して結果を受け取る\u003c/h2\u003e\n\n\u003cp\u003e先ほどの例では\u003ccode\u003ebody\u003c/code\u003eの背景色を変更するスクリプトを実行するだけですが、Webページでスクリプトを実行して、その結果を受け取ることもできます。例えば、Webページのタイトル文字列を取得するスクリプトを実行する場合は以下の様に書きます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eスクリプトを実行して結果を受け取る方法\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eloadingStateChangedArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEvaluateScriptAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"(()=\u0026gt;{return document.title;})();\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eContinueWith\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ereponse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003etitle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ereponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"document.title = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"19-独自オブジェクトの公開\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#19-%E7%8B%AC%E8%87%AA%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E5%85%AC%E9%96%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e19. 独自オブジェクトの公開\u003c/h1\u003e\n\n\u003cp\u003e任意のクラスを作成してjavascriptから呼び出せるようにできます。 \u003cbr\u003e\nここでは、任意のコマンドを実行するクラスを作成して、javascriptから呼び出せるようにしてみます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"191-公開するクラスの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#191-%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e19.1 公開するクラスの作成\u003c/h2\u003e\n\n\u003cp\u003e任意のクラスを公開することができますが、以下の注意が必要です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e公開されるすべてのメソッドはPromiseを返すメソッドとしてjavascriptに公開されます。\u003cbr\u003e\nつまり、javascript側から呼び出されると、即座にPromiseが返却されて、メソッドの実行結果をfullfill時に受け取ることになります。\u003c/li\u003e\n\u003cli\u003eメソッドを実行するスレッドは一つだけ。\u003cbr\u003e\n時間のかかる処理を行っても構いませんが、独自オブジェクトのメソッドを実行するスレッドは１つだけなので、javascript側から複数回呼びされると、キューイングされて実行されることになります。この場合でもjavascript側には呼び出すとすぐにPromiseが返却されます。\nしたがって、時間のかかる処理を行う場合は、明示的に別スレッドで実行して、次に示すコールバックを呼び出す方法をお勧めします。\u003c/li\u003e\n\u003cli\u003eマーシャリングの仕様が明確でない。\u003cbr\u003e\n\u003ccode\u003eint\u003c/code\u003eや\u003ccode\u003eString\u003c/code\u003eようなprimitve型を引数として渡すのは問題ありません。\u003cbr\u003e\n\u003ccode\u003eint[]\u003c/code\u003eのようなprimitve型の配列を返却する場合も問題なく動作します。\u003cbr\u003e\nしかし、\u003ccode\u003eint[]\u003c/code\u003eを引数で受け受け取ろうとするとうまく受け取れません。\u003cbr\u003e\nこのため原則的にprimitive型だけを使う様にするべきです。\u003c/li\u003e\n\u003cli\u003e非完了型の場合はコールバックを利用する。\u003cbr\u003e\nC#のクラスのメソッドは、javascript側が指定するコールバックを、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IJavascriptCallback.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIJavascriptCallback\u003c/a\u003e型の引数で受け取ることができます。\u003cbr\u003e\n時間のかかる非完了処理では、完了時のこのコールバックを呼び出す方法が良いです。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003ecallback無しですぐに完了するメソッドと完了時にcallbackを呼び出すメソッドの例を以下に示します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ejavascriptに公開するオブジェクト\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Diagnostics\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTest\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// callbackを使わない例\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"nf\"\u003eexec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eexePath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003earguments\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// プロセスを起動する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eProcess\u003c/span\u003e \u003cspan class=\"n\"\u003eps\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eProcess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexePath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003earguments\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 文字列を返却する。\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Hello!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// javascript側のcallbackを呼び出す例\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ewait\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003emillisecond\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIJavascriptCallback\u003c/span\u003e \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 別スレッドで処理を実行する。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emillisecond\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eContinueWith\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// callbackメソッドが呼び出せるか必ず確認する\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCanExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// コールバックを呼び出す。\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// c＃-\u0026gt;javascriptはint配列のマーシャリングがうまく動作する\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"192-作成したクラスのインスタンスを公開する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#192-%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%82%92%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e19.2 作成したクラスのインスタンスを公開する\u003c/h2\u003e\n\n\u003cp\u003e作成した独自クラスのインスタンスをjavascriptから利用できるように公開します。\u003cbr\u003e\nこれには、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IWebBrowser.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIWebBrowser \u003c/a\u003eインタフェースの\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_IWebBrowser_JavascriptObjectRepository.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eJavascriptObjectRepository\u003c/a\u003eプロパティで公開されている\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IJavascriptObjectRepository.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIJavascriptObjectRepository\u003c/a\u003eインタフェースの\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IJavascriptObjectRepository_Register.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRegiste\u003c/a\u003eメソッドを呼び出します。\u003cbr\u003e\n\u003ccode\u003eIWebBrowser\u003c/code\u003eに対して操作していますが、ここで登録した独自オブジェクトは、子ウィンドウでも参照可能になります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e第一引数はjavascript側に公開するオブジェクト名前(大文字小文字が区別されるので注意)\u003c/li\u003e\n\u003cli\u003e第二引数は公開するオブジェト（ChromiumWebBrowser単位で１つのオブジェクトであることに注意）\u003c/li\u003e\n\u003cli\u003e第三引数は非同期にするかどうかであるが、ブロッキングされないように、非同期型にすることをお勧めします。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e以下の例では\u003ccode\u003eTest\u003c/code\u003eという名称で、先ほどのTestクラスのオブジェクトを公開しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e独自オブジェクトの公開\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eInitializeComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eChromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"https://www.google.co.jp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// (省略)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 独自オブジェクトをTestという名称で公開する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eJavascriptObjectRepository\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRegister\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Test\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSimpleBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTest\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"193-公開されたオブジェクトを使用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#193-%E5%85%AC%E9%96%8B%E3%81%95%E3%82%8C%E3%81%9F%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e19.3 公開されたオブジェクトを使用する\u003c/h2\u003e\n\n\u003cp\u003ejavascriptでは、\u003ccode\u003eCefSharp.BindObjectAsync\u003c/code\u003eメソッドを呼び出すことで、公開されたオブジェクトが使えるようになります。\u003cbr\u003e\u003cbr\u003e\nこのメソッドは非同期型(Promiseを返却する)ですので、完了を待つ必要があります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e公開されたオブジェクトをjavascriptから参照可能にする方法\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eBindObjectAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eTest\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"194-確認してみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#194-%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e19.4 確認してみる\u003c/h2\u003e\n\n\u003cp\u003eビルド＆実行して、F12キーで開発者ツールを起動します。\u003cbr\u003e\n次にコンソールを選択して、以下を入力して実行します。\u003cbr\u003e\nこれで、Testオブジェクトが参照可能になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e公開されたオブジェクトをjavascriptから参照可能にする方法\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eBindObjectAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eTest\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e続いて、以下をコンソールに入力して実行します。\u003cbr\u003e\nすると、電卓が起動することが確認できます。  \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e公開されたオブジェクトのメソッドを実行\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003eTest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ecalc.exe\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e続いて、callbackの確認として、以下をコンソールに入力して実行します。\u003cbr\u003e\nすると、10秒後にコンソールにint型の配列が出力されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e公開されたオブジェクトのメソッド(callbackあり)を実行\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003eTest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewait\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e10000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eret\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eret\u003c/span\u003e\u003cspan class=\"p\"\u003e);});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこのようにC#のオブジェクトをjavascriptに公開する機能は、CefSharpの非常に便利な機能です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"20-レスポンス内容の変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#20-%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E5%86%85%E5%AE%B9%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e20. レスポンス内容の変更\u003c/h1\u003e\n\n\u003cp\u003eCefSharpではHTTPのレスポンス内容をカスタマイズすることができます。\u003cbr\u003e\n※レスポンスヘッダは変更することはできません。\u003cbr\u003e\nこの機能を使うことで、任意のスクリプトをレスポンスに埋め込むことなどができます。\u003c/p\u003e\n\n\u003cp\u003eCefSharpは\u003cstrong\u003e\u003cem\u003e1つのリソースを受信する毎に\u003c/em\u003e\u003c/strong\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IResourceRequestHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIResourceRequestHandler\u003c/a\u003eインタフェースの\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetResourceResponseFilter.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGetResourceResponseFilter\u003c/a\u003eメソッドを呼び出します。レスポンス内容のカスタマイズが必要な場合には、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IResponseFilter.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIResponseFilter\u003c/a\u003eインタフェースを返却するようにします。\u003cbr\u003e\nそして、返却した\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IResponseFilter.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIResponseFilter\u003c/a\u003eでレスポンスの内容を変更します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"201-iresponsefilterを実装するクラスを追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#201-iresponsefilter%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e20.1 IResponseFilterを実装するクラスを追加\u003c/h2\u003e\n\n\u003cp\u003eまず、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IResponseFilter.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIResponseFilter\u003c/a\u003eインタフェースを実装するクラスを新規に作成します。 \u003cbr\u003e\nソリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に\u003ccode\u003eResponseFilter\u003c/code\u003eを指定します。そして、以下のように\u003ccode\u003eIResponseFilter\u003c/code\u003eを実装させます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIResponseFilterを実装するクラス\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eResponseFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIResponseFilter\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eその後、\u003ccode\u003eIResponseFilter\u003c/code\u003eを選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。すると\u003ccode\u003eIResponseFilter\u003c/code\u003eインタフェースのメソッドがすべて仮実装されます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"202-iresponsefilterのメソッドを実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#202-iresponsefilter%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e20.2 IResponseFilterのメソッドを実装\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IResponseFilter.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIResponseFilter\u003c/a\u003eインタフェースの各メソッドを実装します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eコンストラクタ\u003cbr\u003e\nコンストラクタは、\u003ccode\u003eResponseFilter\u003c/code\u003eのインスタンスを作成するために\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetResourceResponseFilter.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGetResourceResponseFilter\u003c/a\u003eメソッドが呼び出すことになります。このメソッドではレスポンスヘッダを参照することができるため、レスポンスの文字コードを取得することができます。\u003cbr\u003e\n文字コードは後の処理で使用するために、コンストラクタの引数でを受け取るようにします。  \u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResponseFilter_Filter.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFilter\u003c/a\u003e\u003cbr\u003e\nこのメソッドでレスポンス内容を変更しますが、バイト配列を操作する必要がるため、実装が少し複雑になります。\u003cbr\u003e\n1つのリソースのレスポンスは分割されて受信する場合があるため、このメソッドは複数回呼び出されることになります。\u003cbr\u003e\n基本的には、以下の流れになります。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e第一引数\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/api/system.io.stream?view=netcore-3.1\" rel=\"nofollow noopener\" target=\"_blank\"\u003eStream\u003c/a\u003eで受けたオリジナルのレスポンス内容を読み取る。\u003c/li\u003e\n\u003cli\u003e内容を自由に変更する。\u003c/li\u003e\n\u003cli\u003e第三引数の\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/api/system.io.stream?view=netcore-3.1\" rel=\"nofollow noopener\" target=\"_blank\"\u003eStream\u003c/a\u003eに変更した内容を書き込む。\u003c/li\u003e\n\u003cli\u003e変更した内容を書き込む際に第三引数の\u003ccode\u003eStream\u003c/code\u003eのサイズが不足する場合は、次回の\u003ccode\u003eFilter\u003c/code\u003eメソッド呼び出し時に書き込めるように書き込めなかった内容を保存します。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResponseFilter_InitFilter.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eInitFilter\u003c/a\u003e\u003cbr\u003e\n\u003ccode\u003eIResponseFilter\u003c/code\u003eを初期化するために、一回だけ(1つのリソースの処理で一回だけ)呼びだされます。\u003cbr\u003e\n\u003ccode\u003efalse\u003c/code\u003eを返却すると\u003ccode\u003eIResponseFilter\u003c/code\u003eが使用されなくなります。\u003cbr\u003e\nここでは常に\u003ccode\u003etrue\u003c/code\u003eを返却して\u003ccode\u003eIResponseFilter\u003c/code\u003eが使われるようにします。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eDispose\u003cbr\u003e\n解放が必要なリソースは特にありませんので、何も行いません。\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e以下の例では、最初に現れた\u003ccode\u003e\u0026lt;script\u0026gt;\u003c/code\u003eタグの前に、以下のスクリプトを埋め込むことにします。  \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e埋め込むスクリプト\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"injected\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e少し、複雑ですが参考にしてください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIResponseFilterの実装\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.IO\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Text\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eResponseFilter\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIResponseFilter\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 埋め込み位置の文字列\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// ここでは、最初に現れる\"\u0026lt;script\"の直前に埋め込む。\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eSEARCH_TARGET\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\u0026lt;script\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 埋め込むコード\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eINJECTED_CODE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\u0026lt;script\u0026gt;console.log('injected');\u0026lt;/script\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 出力ストリームに未書き込みのデータ\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eremainData\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// コード埋め込み済みのフラグ\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003ebInjected\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// レスポンスで指定されているエンコーディング\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e \u003cspan class=\"n\"\u003eencoding\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eResponseFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003echarset\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsNullOrEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003echarset\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// responseの文字コードからエンコーディングを作成\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eencoding\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003echarset\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 不正な文字コード指定の場合はUTF8とする。\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eencoding\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eFilterStatus\u003c/span\u003e \u003cspan class=\"n\"\u003eIResponseFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eStream\u003c/span\u003e \u003cspan class=\"n\"\u003edataIn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003edataInRead\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eStream\u003c/span\u003e \u003cspan class=\"n\"\u003edataOut\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003edataOutWritten\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edataIn\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 書き出すデータ\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003emodifiedContent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 入力ストリームのサイズ\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003elDataSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edataIn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 出力トリームのサイズ\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003elCapacity\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edataOut\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 入力ストリームから全て読み込む\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003elDataSize\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                \u003cspan class=\"n\"\u003edataIn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elDataSize\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 読み取ったサイズを返却\u003c/span\u003e\n                \u003cspan class=\"n\"\u003edataInRead\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elDataSize\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 1つのリソースに一度だけ埋め込むため、埋め込み済みフラグを確認する。\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003ebInjected\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 検索する文字列をバイト配列に変換する\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003epattern\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eencoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSEARCH_TARGET\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                    \u003cspan class=\"c1\"\u003e// コードを埋め込む位置を探す\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003einjectionPoint\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003elDataSize\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003epattern\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// 埋め込む位置のパターンと一致するかチェックする\u003c/span\u003e\n                        \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003ebMatch\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003epattern\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e++\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epattern\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n                            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                                \u003cspan class=\"n\"\u003ebMatch\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n                        \u003cspan class=\"c1\"\u003e// 埋め込む位置が特定できた場合\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebMatch\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003einjectionPoint\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                            \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n                    \u003cspan class=\"c1\"\u003e// コードを埋め込む位置が見つかった\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einjectionPoint\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// 埋め込んだことをマークする。\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003ebInjected\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                        \u003cspan class=\"c1\"\u003e// 入力データをコード埋め込み位置で2つに分割する。\u003c/span\u003e\n                        \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003efirstPart\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTake\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einjectionPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                        \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003esecondPart\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSkip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einjectionPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n                        \u003cspan class=\"c1\"\u003e// 出力ストリームに書き込むデータを作成する。\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// 前回の書き込めなかったデータ＋入力データの前半＋埋め込むデータ＋入力データの後半\u003c/span\u003e\n                        \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eencoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eINJECTED_CODE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003emodifiedContent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eremainData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConcat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efirstPart\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eConcat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eConcat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esecondPart\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// コードを埋め込む位置が見つからなかった\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// 入力データを書き込むデータとする。\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003emodifiedContent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 入力データを書き込むデータとする。\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003emodifiedContent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 出力ストリームに編集したコンテンツを書き出す。\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// ※出力ストリームのサイズ以上は書き込めない。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003edataOutWritten\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elCapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emodifiedContent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003edataOut\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodifiedContent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003edataOutWritten\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 書き込むデータが出力ストリームのサイズよりも場合\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodifiedContent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elCapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 書き込むない部分を、次回書き込むデータとして保存しておく\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eremainData\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emodifiedContent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSkip\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elCapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n                    \u003cspan class=\"c1\"\u003e// バッファ不足であることを返却する\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eFilterStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNeedMoreData\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 全てのデータを出力ストリームに書き込めた場合\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 全て書き込めているので、未書き込みデータは空にする。\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eremainData\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 処理が完了したことを返却する。\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eFilterStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDone\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 入力データがないため、何も書き込んでいないが、処理は完了とする。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003edataInRead\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003edataOutWritten\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eFilterStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDone\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eIResponseFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInitFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"203-iresourcerequesthandlergetresourceresponsefilterメソッドの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#203-iresourcerequesthandlergetresourceresponsefilter%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e20.3 IResourceRequestHandler.GetResourceResponseFilterメソッドの実装\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IResourceRequestHandler_GetResourceResponseFilter.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIResourceRequestHandler.GetResourceResponseFilter\u003c/a\u003eメソッドは1つのHTTPレスポンスを受信する度に呼び出されます。HTMLだけでなく、CSS、Javascript、PDF、イメージ等のすべてのリソースのHTTPレスポンスで呼び出されます。また、開発者ツールなどのカスタムスキーマ(devtools://など)の場合でも、このメソッドが呼び出されます。\u003cbr\u003e\nしたがって、レスポンス内容を変更する対象のリソースを絞る必要があります。\u003c/p\u003e\n\n\u003cp\u003e例えば、以下の条件のレスポンスだけを編集対象とします。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eメインフレームかサブフレーム(iframeとframe)にロードされるリソースだけを対象する。\u003c/li\u003e\n\u003cli\u003ehttp://とhttps://のスキマーだけを対象とする。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eほかにもMimeTypeを見る方法もあります。\u003cbr\u003e\n以下は実装例です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eGetResourceResponseFilterメソッドの実装\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIResponseFilter\u003c/span\u003e \u003cspan class=\"n\"\u003eIResourceRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetResourceResponseFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIResponse\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// メインフレームとサブフレームのリソースの場合だけリソースを改変する。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 注意：pdfや開発者ツールの場合には、フィルターが適用されないように、httpとhttpsプロトコルだけに限定する。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResourceType\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eResourceType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMainFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResourceType\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eResourceType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSubFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eRegex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsMatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"^(http|https)://.*$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRegexOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIgnoreCase\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// レスポンス内容を変更する。\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eResponseFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCharset\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// レスポンス内容は変更しない。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"204-iresponsefilterの確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#204-iresponsefilter%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e20.4 IResponseFilterの確認\u003c/h2\u003e\n\n\u003cp\u003eビルドして実行して開発者ツールを立ち上げてみます。\u003cbr\u003e\nすると、コンソールに\u003ccode\u003einjected\u003c/code\u003eと出力されていることが確認できます。\u003cbr\u003e\nまた、Elementを確認すると、スクリプト要素が埋め込まれていることが確認できます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/4d7d401aeb5ee87e36fe3ef1339c4a22a78e0714/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f30303831626464322d323164662d656530312d393835622d6431646464626561383935332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F0081bdd2-21df-ee01-985b-d1dddbea8953.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7746f319dc4308a81eee66f08a57ed41\" alt=\"injection.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/0081bdd2-21df-ee01-985b-d1dddbea8953.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F0081bdd2-21df-ee01-985b-d1dddbea8953.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c7422a94164922349332f0c56f6125da 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eなお、上で実装したコードでは、最初のscriptとして追加されるようにしていますが、このように最初のscriptにならない場合があります。\u003cbr\u003e\nこれは、変更したWebコンテンツがブラウザにロードされた後に、内部のスクリプトによって追加のスクリプトがロードされてるためだと考えられます。\u003c/p\u003e\n\n\u003cp\u003eまた、\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy\" rel=\"nofollow noopener\" target=\"_blank\"\u003eContent-Security-Policy(CSP)\u003c/a\u003eを突破することはできないため、\u003ccode\u003eContent-Security-Policy\u003c/code\u003eの\u003ccode\u003escript-src\u003c/code\u003eの設定によっては、このように直接埋め込んだスクリプトは実行されないことにも注意が必要です。\u003cbr\u003e\nCSPを突破するためには、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_CefCustomScheme_IsCSPBypassing.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIsCSPBypassing\u003c/a\u003eでCSPをバイパスする指定のカスタムスキーマ作成してスクリプトをロード必要があります。カスタムスキーマについては次章で説明します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"21-カスタムスキーマ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#21-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e21. カスタムスキーマ\u003c/h1\u003e\n\n\u003cp\u003eカスタムスキーマとは、chromeでの\u003ccode\u003echrome://version\u003c/code\u003eのようなURLでの\u003ccode\u003echrome://\u003c/code\u003eの部分のことです。\u003ccode\u003ehttp://\u003c/code\u003eや\u003ccode\u003ehttps://\u003c/code\u003e以外に独自のスキーマを提供することができます。\u003cbr\u003e\nまた、カスタムスキーマは\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy\" rel=\"nofollow noopener\" target=\"_blank\"\u003eContent-Security-Policy(CSP)\u003c/a\u003eを突破することができるため、「\u003ca href=\"#20-%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E5%86%85%E5%AE%B9%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e# 20. レスポンス内容の変更\u003c/a\u003e」で説明したレスポンスで\u003ccode\u003escript\u003c/code\u003eの\u003ccode\u003esrc\u003c/code\u003eにカスタムスキーマのリソースを埋め込むと、任意のコードを実行できるようになります。\u003cbr\u003e\n他にも通常のスキーマではできない、特殊なことを行うスキーマを提供することができます。\u003c/p\u003e\n\n\u003cp\u003eここでは、ローカルの任意のファイルの中身を取り出すスキーマを実装してみます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"211-ischemehandlerfactoryインタフェースを実装するクラスの追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#211-ischemehandlerfactory%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e21.1 ISchemeHandlerFactoryインタフェースを実装するクラスの追加\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ISchemeHandlerFactory.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eISchemeHandlerFactory\u003c/a\u003eインタフェースを実装するクラスを新規に追加します。\u003c/p\u003e\n\n\u003cp\u003eソリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に\u003ccode\u003eLocalFileSchemeHandlerFactory\u003c/code\u003eを指定します。そして、以下のように\u003ccode\u003eISchemeHandlerFactory\u003c/code\u003eインタフェースを実装させます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eISchemeHandlerFactoryを実装するクラス\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLocalFileSchemeHandlerFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eISchemeHandlerFactory\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eその後、\u003ccode\u003eISchemeHandlerFactory\u003c/code\u003eを選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。すると\u003ccode\u003eISchemeHandlerFactory\u003c/code\u003eインタフェースのメソッドがすべて仮実装されます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"212-ischemehandlerfactoryのメソッドを実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#212-ischemehandlerfactory%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e21.2 ISchemeHandlerFactoryのメソッドを実装\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eISchemeHandlerFactory\u003c/code\u003eインターフェースには\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ISchemeHandlerFactory_Create.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCreate\u003c/a\u003eメソッドしかありません。\u003cbr\u003e\nこのメソッドでは、カスタムスキーマをサポートするために、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_IResourceHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIResourceHandler\u003c/a\u003eインタフェースを返却する必要があります。\u003cbr\u003e\u003cbr\u003e\nこの\u003ccode\u003eIResourceHandler\u003c/code\u003eインタフェースを実装するクラスを作成するのもよいですが、以下の便利なスタティックメソッドが用意されていますので、これを使うことで簡単に\u003ccode\u003eIResourceHandler\u003c/code\u003eインタフェースを用意することができます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ResourceHandler_FromFilePath.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFromFilePath\u003c/a\u003eメソッド\u003cbr\u003e\n指定されたファイルの内容を返却する\u003ccode\u003eIResourceHandler\u003c/code\u003eインタフェースを作成します。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/Overload_CefSharp_ResourceHandler_FromString.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFromString\u003c/a\u003eメソッド\u003cbr\u003e\n指定された文字列内容を返却する\u003ccode\u003eIResourceHandler\u003c/code\u003eインタフェースを作成します。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ResourceHandler_ForErrorMessage.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eForErrorMessage\u003c/a\u003eメソッド\u003cbr\u003e\n指定された文字列内容とStatusコードを返却する\u003ccode\u003eIResourceHandler\u003c/code\u003eインタフェースを作成します。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ResourceHandler_FromByteArray.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFromByteArray \u003c/a\u003eメソッド\u003cbr\u003e\n指定されたバイト配列の内容を返却する\u003ccode\u003eIResourceHandler\u003c/code\u003eインタフェースを作成します。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eここでは、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ResourceHandler_FromFilePath.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFromFilePath\u003c/a\u003eメソッドと\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/Overload_CefSharp_ResourceHandler_FromString.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFromString\u003c/a\u003eメソッドを使って、カスタムスキーマのメソッドを実装します。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eURLからファイルパスを取得する(※URLでファイルパスが参照される仕様とする)。\u003c/li\u003e\n\u003cli\u003e指定されたファイルが存在する場合、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ResourceHandler_FromFilePath.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFromFilePath\u003c/a\u003eメソッドでファイルの内容を返却する。\u003c/li\u003e\n\u003cli\u003e指定されたファイルが存在しない場合、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/Overload_CefSharp_ResourceHandler_FromString.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFromString\u003c/a\u003eメソッドでエラー文言を返却する。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eISchemeHandlerFactoryのメソッドを実装例\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLocalFileSchemeHandlerFactory\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eISchemeHandlerFactory\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// カスタムスキーマ名\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eSCHEME_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"localfile\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIResourceHandler\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eschemeName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIRequest\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// スキーマ名がLocalFileの場合\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eschemeName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eSCHEME_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// urlでc:\\からのファイルパスが指定されているとして、絶対パスを作成する。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"c:\\\\\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSCHEME_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e://\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eReplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\\\\\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 指定されたファイルがあれば、その内容を返却する。\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIO\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 指定されたファイルの中身を返却する\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eResourceHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromFilePath\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"text/plain\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// エラーメッセージを返却する\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eResourceHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Such file dose NOT exist.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eなお、カスタムスキーマは常に小文字として扱われます。\u003cbr\u003e\nアドレスバーに大文字のカスタムスキーマ(LOCALFILE://xxx)と入れても、上のCreateメソッドには(localfile://xxx)と渡ってきます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"213-カスタムスキーマの登録\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#213-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%AE%E7%99%BB%E9%8C%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e21.3 カスタムスキーマの登録\u003c/h2\u003e\n\n\u003cp\u003eカスタムスキーマを利用できるように登録します。\u003cbr\u003e\u003cbr\u003e\nこれには、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_CefSettingsBase_RegisterScheme.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCefSettingsBase.RegisterScheme\u003c/a\u003eメソッドを使用します。\u003cbr\u003e\n\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_CefSettingsBase.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCefSettingsBase\u003c/a\u003eクラスは、「\u003ca href=\"#31-cefinitialize%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AB%E3%82%88%E3%82%8B%E5%88%9D%E6%9C%9F%E5%8C%96\"\u003e3.1 Cef.Initializeメソッドによる初期化\u003c/a\u003e」で説明している初期化のための\u003ccode\u003eCef.Initialize\u003c/code\u003eメソッドに指定するオブジェクトのクラスです。\u003cbr\u003e\n\u003ccode\u003eCefSettingsBase.RegisterScheme\u003c/code\u003eでは以下の項目を設定します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eSchemeName\u003c/code\u003e - スキーマ名\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eIsCSPBypassing\u003c/code\u003e - CSPをバイパスするかどうか\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eIsSecure\u003c/code\u003e - HTTPSとして扱うかどうか\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eSchemeHandlerFactory\u003c/code\u003e - スキーマを実装する\u003ccode\u003eSchemeHandlerFactory\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e以下に実装例を示します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eカスタムスキーマの登録\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.UI\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// アプリケーションのメイン エントリ ポイントです。\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSTAThread\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// （省略）\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// カスタムスキーマを登録する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRegisterScheme\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCefCustomScheme\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eSchemeName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"localfile\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// スキーマ名はlocalfile\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eIsCSPBypassing\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// CSPはバイパス\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eIsSecure\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e            \u003cspan class=\"c1\"\u003e// HTTPSとして扱う\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eSchemeHandlerFactory\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLocalFileSchemeHandlerFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// CefSharpを初期化する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInitialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBrowserProcessHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"214-カスタムスキーマの確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#214-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e21.4 カスタムスキーマの確認\u003c/h2\u003e\n\n\u003cp\u003eビルドして実行してみます。\u003c/p\u003e\n\n\u003cp\u003eアドレスバーに「localfile://temp/console.log」と入力して、ENTERキーを押下してみます。\u003cbr\u003e\n※c:\\temp\\console.logがある前提。\u003cbr\u003e\nすると以下の様に\u003ccode\u003ec:\\temp\\console.log\u003c/code\u003eファイルの内容が表示されるはずです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ad9fe58263d57720067bfbfe10de1ede56c304a6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f32363365633331312d613830642d363331332d653466332d6236346634343262636137612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F263ec311-a80d-6313-e4f3-b64f442bca7a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=db54e07867746cd4e3623023c5306589\" alt=\"カスタムスキーマ.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/263ec311-a80d-6313-e4f3-b64f442bca7a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2F263ec311-a80d-6313-e4f3-b64f442bca7a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f6e43ba29b214fa9d72a8c4eb0d1f0dc 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eアドレスバーに「localfile://aaaaa」と入力して、ENTERキーを押下してみます。\u003cbr\u003e\n※c:\\aaaaaがない前提。\u003cbr\u003e\nすると以下の様にエラーメッセージが表示されます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/d7c6e6a8555f3f404afb643796407feebc172439/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335343538382f61613765376664322d643365622d636536372d393132322d3637313939326530386132332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Faa7e7fd2-d3eb-ce67-9122-671992e08a23.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1d657bf701ff0f86878a45e6661965fe\" alt=\"カスタムスキーマ2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/354588/aa7e7fd2-d3eb-ce67-9122-671992e08a23.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F354588%2Faa7e7fd2-d3eb-ce67-9122-671992e08a23.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3b5bb9fac92516fc135a7c759df15817 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e以上、カスタムスキーマはブラウザ独自の機能を作りこむときに非常に便利です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"22-子ウィンドウオープン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#22-%E5%AD%90%E3%82%A6%E3%82%A3%E3%83%B3%E3%83%89%E3%82%A6%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e22. 子ウィンドウオープン\u003c/h1\u003e\n\n\u003cp\u003eA要素のクリックや\u003ccode\u003ewindow.open\u003c/code\u003eメソッドで作成される子ウィンドウの管理は\u003ccode\u003eCefSharp\u003c/code\u003eで最も難しい部分です。\u003cbr\u003e\n実は\u003ccode\u003eChromiumWebBrowser\u003c/code\u003eのインスタンスをフォームに張り付けただけの状態でも、必要に応じて子ウィンドウは自動的に作成されます。これは\u003ccode\u003eCefSharp\u003c/code\u003e内部の処理で行われていますが、自動作成される子ウィンドウではWebViewのコンテナであるウィンドウも自動作成されてしまいます。\u003c/p\u003e\n\n\u003cp\u003e例えば、タブ表示で子ウィンドウを表示したい場合は、この動作は変えないといけないです。また、子ウィンドウが閉じられるタイミングもハンドリングして、すべてのウィンドウが閉じられたときに、アプリケーションを終了するような動作にする必要もあります。\u003c/p\u003e\n\n\u003cp\u003eこれを行うには、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILifeSpanHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eILifeSpanHandler\u003c/a\u003eインタフェースを作成して、自動作成されるWebViewも含めてインスタンスの管理を行う必要があります。この\u003ccode\u003eILifeSpanHandler\u003c/code\u003eインタフェースは最も実装に気を使わなくてはいけないインタフェースです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"221-ilifespanhandlerインタフェースを実装するクラス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#221-ilifespanhandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e22.1 ILifeSpanHandlerインタフェースを実装するクラス\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILifeSpanHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eILifeSpanHandler\u003c/a\u003eインタフェースを実装するクラスを新規に追加します。\u003c/p\u003e\n\n\u003cp\u003eソリューションエクスプローラでコンテキストメニューを出して、「追加」－「クラス」を選択して、クラス名に\u003ccode\u003eLifeSpanHandler\u003c/code\u003eを指定します。そして、以下のように\u003ccode\u003eILifeSpanHandler\u003c/code\u003eインタフェースを実装させます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eILifeSpanHandlerを実装するクラス\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCefSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSimpleBrowser.Handlers\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLifeSpanHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eILifeSpanHandler\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eその後、\u003ccode\u003eILifeSpanHandler\u003c/code\u003eを選択して電球マークのコンテキストメニューから、「すべてのメンバーを明示的に実装する」を選択します。すると\u003ccode\u003eILifeSpanHandler\u003c/code\u003eインタフェースのメソッドがすべて仮実装されます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"222-ilifespanhandlerインタフェースを実装のメソッドを仮実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#222-ilifespanhandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BB%AE%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e22.2 ILifeSpanHandlerインタフェースを実装のメソッドを仮実装する\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/T_CefSharp_ILifeSpanHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eILifeSpanHandler\u003c/a\u003eインタフェースには、次の4つのメソッドがあります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILifeSpanHandler_DoClose.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDoClose\u003c/a\u003e\u003cbr\u003e\nWebViewが閉じられようとするときに呼び出されます。\u003cbr\u003e\nChromeなどのWebブラウザでは、タブの×ボタンでタブを閉じようとした場合、Webコンテンツでjavascriptの\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/API/WindowEventHandlers/onbeforeunload\" rel=\"nofollow noopener\" target=\"_blank\"\u003eonbeforeunload\u003c/a\u003eイベントハンドラが呼び出されます。そこで、\u003ccode\u003epreventDefault()\u003c/code\u003eが呼び出されると、このページを離れても良いかを確認するためダイアログを表示されて、ユーザが了承した場合にタブのクローズ処理が実行されます。そして、ユーザがタブを閉じることを了承すると、javascriptの\u003ccode\u003eonunload\u003c/code\u003eイベントハンドラが実行されて、最終的にタブが閉じられれることになります。\u003cbr\u003e\nこれと同じ終了時の動作を実現するためは、WebViewのコンテナウィンドウが閉じられようとするときに、一旦ウィンドウを閉じる動作を拒否して、\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_IBrowser_CloseBrowser.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIBrowser.CloseBrowser\u003c/a\u003eメソッドを呼び出す様にします。すると、\u003ccode\u003eonbeforeunload\u003c/code\u003eイベントハンドラが呼び出されるようになります。そして、最終的にウィンドウを閉じることが許可された場合に、本メソッドが呼び出されます。その後、本メソッドで\u003ccode\u003efalse\u003c/code\u003eを返却すると、再度WebViewのコンテナウィンドウのクローズのために、OSからWM_CLOSEメッセージが通知されるので、フォームで終了処理を行うことになります。\u003cbr\u003e\n今回は特に実装しませんが、\u003ccode\u003eonbeforeunload\u003c/code\u003eの仕様を実現するためには、必ず実装が必要になります。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILifeSpanHandler_OnAfterCreated.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnAfterCreated\u003c/a\u003e\u003cbr\u003e\nWebViewが作成されて\u003ccode\u003eIBrowser\u003c/code\u003eインタフェースが利用可能になった時点で呼び出されるハンドラです。\u003cbr\u003e\n\u003ccode\u003enew ChromiumWebBrowser()\u003c/code\u003eで明示的にWebViewを作成した場合も、\u003ccode\u003eOnBeforePopup\u003c/code\u003eが呼び出された後に\u003ccode\u003eCefSharp\u003c/code\u003eが自動的にWebViewを作成した場合も、その後このメソッドが呼びされることになります。\u003cbr\u003e\nここでは、\u003ccode\u003eCefSharp\u003c/code\u003eが自動的にWebViewを作成する場合に、そのコンテナであるフォームに新たに作成されたWebViewの情報を設定する様にします。\u003cbr\u003e\nこの部分はこの後の章で実装していきます。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILifeSpanHandler_OnBeforeClose.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnBeforeClose\u003c/a\u003e\u003cbr\u003e\nWebViewが閉じられるタイミングで呼び出されます。\u003cbr\u003e\nタブ形式で表示している場合は、ここでWebViewのインスタンス数をデクリメントして、すべてのWebViewのインスタンス数がゼロになった時点でアプリケーションを終了するような実装にすることもできます。\u003cbr\u003e\n今回は特に何も実装しません。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/M_CefSharp_ILifeSpanHandler_OnBeforePopup.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnBeforePopup\u003c/a\u003e\u003cbr\u003e\n\u003ccode\u003eA\u003c/code\u003e要素のクリックや\u003ccode\u003ewindow.open\u003c/code\u003eにより子ウィンドウがオープンされる前に呼び出されます。ユーザ操作によるものかどうかを判断することができますので、ここでポップアップブロック機能を実現することもできます。\u003cbr\u003e\nここでは\u003ccode\u003eCefSharp\u003c/code\u003eが自動的に作成するWebViewの親ウィンドウの情報を設定します。\u003cbr\u003e\nこの部分は以降の章で解説します。\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"223-onbeforepopupメソッドの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#223-onbeforepopup%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e22.3 OnBeforePopupメソッドの実装\u003c/h2\u003e\n\n\u003cp\u003e基本的には\u003ccode\u003efalse\u003c/code\u003eを返却してCefSharpにWebViewの作成を任せますが、\u003ccode\u003etrue\u003c/code\u003eを返却してCefSharpにWebViewを作成させない様にすることもできます。CefSharpにWebViewの作成を任せずに、自分でWebViewを作成する場合は、\u003ccode\u003enew ChromiumWebBrowser()\u003c/code\u003eを呼び出してWebViewを作成した後、\u003ccode\u003etrue\u003c/code\u003eを返却することになります。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003cem\u003eしかし、自動で作成されたWebViewと明示的にnewして作成したWebViewとでは、動作に大きな違いがあるので注意が必要です。\u003c/em\u003e\u003c/strong\u003e  \u003c/p\u003e\n\n\u003cp\u003eアプリケーションが\u003ccode\u003ewindow.open()\u003c/code\u003eメソッドで作成したウィンドウの場合、javascriptの\u003ccode\u003epostMessage\u003c/code\u003eメソッドを使ってメッセージの送信ができたり、\u003ccode\u003ewindow.opener\u003c/code\u003eプロパティでオープンしたウィンドウの情報を子ウィンドウ側で取得するできる必要があります。しかし、明示的にnewして作成したWebViewの場合は、このようなウィンドウの親子関係がないため、これらの操作ができません。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003cem\u003e従って、このハンドラが呼び出される場合は、CefSharpにWebViewの作成をお任せすることをお勧めします。\u003c/em\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eこのメソッドでは、アプリケーションで新しいWebViewのコンテナとなるウィンドウを用意して、そのコンテナウィンドウの情報をCefSharpに通知します。もし、タブ形式のブラウザにする場合は、新しいタブを追加して、WebViewのコンテナとなるウィンドウを用意することになるでしょう。\u003cbr\u003e\nここでは、親ウィンドウと同じフォームを作成して、それをコンテナとする様にします。\u003c/p\u003e\n\n\u003cp\u003eまず、コンテナとなるフォーム\u003ccode\u003eSimpleBrowserFrame\u003c/code\u003eクラスのコンストラクタを変更して、WebView無しでフォームを作れるようにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eコンストラクタの変更\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003ebCreateWebView\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eInitializeComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// WebView作成の指定がある場合は、WebViewを作成する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebCreateWebView\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eInitializeWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInitializeWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// CefSharpのWebViewを作成する。\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eChromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"https://www.google.co.jp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// コントロールを追加する。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewebViewContainer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eControls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDock\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDockStyle\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFill\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// WebViewの各種オプションを設定する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eJavascript\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCefState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eJavascriptDomPaste\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCefState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eApplicationCache\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCefState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowserSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLocalStorage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCefState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// CefSharpの各種ハンドラを設定する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eKeyboardHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eKeyboardHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRequestHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRequestHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDisplayHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDisplayHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDownloadHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDownloadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLoadHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 独自オブジェクトを公開する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eJavascriptObjectRepository\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRegister\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Test\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSimpleBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUtil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTest\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e次に、\u003ccode\u003eOnBeforePopup\u003c/code\u003eメソッドを実装します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOnBeforePopup\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eILifeSpanHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnBeforePopup\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etargetUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etargetFrameName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eWindowOpenDisposition\u003c/span\u003e \u003cspan class=\"n\"\u003etargetDisposition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003euserGesture\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIPopupFeatures\u003c/span\u003e \u003cspan class=\"n\"\u003epopupFeatures\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIWindowInfo\u003c/span\u003e \u003cspan class=\"n\"\u003ewindowInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowserSettings\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowserSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003enoJavascriptAccess\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003enewBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 親のbrowserからフォームを取得する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetMainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparent\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 親フォームのコンテキストで実行させる\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// WebView無しの空のコンテナフォームを作成する。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"n\"\u003enewWindows\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// WebViewのコンテナ（親ウィンドウ）の情報を設定する。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eRectangle\u003c/span\u003e \u003cspan class=\"n\"\u003erect\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enewWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClientRectangle\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ewindowInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetAsChild\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enewWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWebBrowserContainer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRight\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBottom\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// フォームを表示する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003enewWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// この引数は実験的な引数の用ですがNULLを設定する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003enewBrowser\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// CefSharpにWebViewの作成を任せるためにfalseを返却する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e以上で、子ウィンドウが作成されるときに、アプリケーションで用意したコンテナ用のフォームにCefSharpが自動的に作成するWevViewが表示されるようになりました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"224-onaftercreatedメソッドの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#224-onaftercreated%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e22.4 OnAfterCreatedメソッドの実装\u003c/h2\u003e\n\n\u003cp\u003eこのメソッドでは、新しく作成されたWebViewの\u003ccode\u003eIBrowser\u003c/code\u003eインタフェースをコンテナウィンドウであるフォームに設定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOnAfterCreated\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eILifeSpanHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnAfterCreated\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIWebBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003echromiumWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 新しく作成されたbrowserからコンテナのフォームを取得する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"n\"\u003eparent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSimpleBrowserFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetMainFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparent\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// コンテナフォームのコンテキストで実行\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBeginInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 親フォームにIBrowserインスタンスの情報を設定する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowser\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e次に、コンテナフォームである\u003ccode\u003eSimpleBrowserFrame\u003c/code\u003eに\u003ccode\u003eIBrowser\u003c/code\u003eインスタンスを保持するためのプロパティを追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIBrowserのプロパティ\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eForm\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// (省略)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// ホストしているWebViewのIBrowserインタフェース\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIBrowser\u003c/span\u003e \u003cspan class=\"n\"\u003eBrowser\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// (省略)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e次に、コンテナフォームである\u003ccode\u003eSimpleBrowserFrame\u003c/code\u003eのすべてのメソッドで、\u003ccode\u003eChromiumWebBrowser\u003c/code\u003eではなく\u003ccode\u003eIBrowser\u003c/code\u003eを使用する様に変更します。\u003cbr\u003e\n※CefSharpが自動的に作成したWebViewの場合、\u003ccode\u003eChromiumWebBrowser\u003c/code\u003eインスタンスが存在しないため、戻るや進むといった操作は\u003ccode\u003eIBrowser\u003c/code\u003eを使用する様にする必要があります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSimpleBrowserFrameのメソッド変更\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ebackBtn_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCanGoBack\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGoBack\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eforwardBtn_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCanGoForward\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGoForward\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ereloadBtn_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReload\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e以上で、新しく作成されたWebViewのインスタンスの情報を親フォームが受け取り、その後の各種操作ができるようになりました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"225-chromiumwebbrowserlifespanhandlerにilifespanhandlerを設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#225-chromiumwebbrowserlifespanhandler%E3%81%ABilifespanhandler%E3%82%92%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e22.5 ChromiumWebBrowser.LifeSpanHandlerにILifeSpanHandlerを設定\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cefsharp.github.io/api/85.3.x/html/P_CefSharp_WinForms_ChromiumWebBrowser_LifeSpanHandler.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eChromiumWebBrowser.LifeSpanHandler\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eILifeSapbHandlerの設定\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInitializeWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// （省略）\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// LifeSpanHandlerをWebViewに設定する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLifeSpanHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// （省略）\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e以上で、子ウィンドウの作成をコントロールできるようになりました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"226-リサイズの対応\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#226-%E3%83%AA%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AE%E5%AF%BE%E5%BF%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e22.6 リサイズの対応\u003c/h2\u003e\n\n\u003cp\u003eこれまでの実装で子ウィンドウの作成ができるようになっていますが、現状では子ウィンドウをリサイズした時にWebViewのサイズがそのままになってしまっています。そこで、リサイズに対応させます。\u003cbr\u003e\n具体的には、\u003ccode\u003eSimpleBrowserFrame\u003c/code\u003eフォームの\u003ccode\u003eResize\u003c/code\u003eイベントのイベントハンドラを追加して、その中でWebViewのサイズを変更することになります。しかし、WebViewのウィンドウは\u003ccode\u003eNative\u003c/code\u003eウィンドウですので、\u003ccode\u003ePinvoke\u003c/code\u003eを使う必要があります。少し汚いですが、以下の様になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eResizeに対応\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSimpleBrowserFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eForm\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// (省略)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSimpleBrowserFrame_Resize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBrowser\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// WebViewのウィンドウハンドルを取得する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehWnd\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBrowser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetHost\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetWindowHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// WebViewのサイズを変更する。\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eSetWindowPos\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehWnd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eHWND_TOP\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewebViewContainer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWidth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewebViewContainer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHeight\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSetWindowPosFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSWP_NOMOVE\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eSetWindowPosFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSWP_NOZORDER\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"user32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSetLastError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetWindowPos\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehWnd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehWndInsertAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecy\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSetWindowPosFlags\u003c/span\u003e \u003cspan class=\"n\"\u003euFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eSetWindowPosFlags\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_ASYNCWINDOWPOS\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x4000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_DEFERERASE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x2000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_DRAWFRAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0020\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_FRAMECHANGED\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0020\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_HIDEWINDOW\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0080\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_NOACTIVATE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0010\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_NOCOPYBITS\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_NOMOVE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0002\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_NOOWNERZORDER\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0200\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_NOREDRAW\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0008\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_NOREPOSITION\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0200\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_NOSENDCHANGING\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0400\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_NOSIZE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0001\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_NOZORDER\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0004\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSWP_SHOWWINDOW\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0040\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003eHWND_TOP\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eIntPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003eHWND_BOTTOM\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eIntPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003eHWND_TOPMOST\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eIntPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003eHWND_NOTOPMOST\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eIntPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(-\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"227-動作確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#227-%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e22.7 動作確認\u003c/h2\u003e\n\n\u003cp\u003eビルドして実行してみます。\u003cbr\u003e\nポップアップウィンドウの例として、Windows update catalogを使ってみます。\u003cbr\u003e\nアドレスバーに\u003ca href=\"https://www.catalog.update.microsoft.com/Search.aspx?q=KB4589208\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.catalog.update.microsoft.com/Search.aspx?q=KB4589208\u003c/a\u003eを入力してENTERを押下します。そして、適当なアップテートをクリックすると、新しい子ウィンドウが作成されることが確認できます。\u003cbr\u003e\nその後、新しい子ウィンドウのアドレスバーで\u003ca href=\"https://www.google.co.jp/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.google.co.jp/\u003c/a\u003eを入力してENTERを押下した後、戻るボタンや進むボタンをクリックすると、子ウィンドウのナビゲートができていることが確認できると思います。\u003c/p\u003e\n\n\u003cp\u003eただし、現在の実装では、最初のウィンドウを閉じると、すべての子ウィンドウが閉じられる動作になっています。本格的なブラウザを作成する場合は、タブを収容するフレームを親ウィンドウにして、子ウィンドウをタブ表示にする方式が良いです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"23-cefsharpの特徴\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#23-cefsharp%E3%81%AE%E7%89%B9%E5%BE%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e23. CefSharpの特徴\u003c/h1\u003e\n\n\u003cp\u003e個人的な感想ですが、良い点と悪い点をまとめます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"231-良い点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#231-%E8%89%AF%E3%81%84%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e23.1 良い点\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003echromiumベースのWebViewアプリが簡単に作れる\u003cbr\u003e\n少ないコードで完全なchromiumベースのWebViewを持つアプリケーションが作成できる。\u003cbr\u003e\nchromiumベースなので、HTML5、CSS5の最新仕様に準拠している。  \u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eブラウジングの様々な契機をハンドリングできる\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eコンテンツの変更やscriptの埋め込みが簡単にできる\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e独自機能を組み込んで、javascriptから利用させることができる\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e開発者ツールも起動できる\u003cbr\u003e\nF12キーで表示される開発者ツールも、簡単に表示することができる。\u003cbr\u003e\nアプリケーションのデバッグもChromeと全く同じようにできる。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003echrome driverで試験もできる\u003cbr\u003e\nseleniumもappiumも使用することができる。\u003cbr\u003e\nテストに関してはchromeと同じようにすることができる。\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"232-悪い点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#232-%E6%82%AA%E3%81%84%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e23.2 悪い点\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eバージョンアップにより仕様が変わりすぎる\u003cbr\u003e\nchromiumのバージョンに追従しているので、バージョンアップの頻度が非常に高い。\u003cbr\u003e\nまた、バージョンアップの度に、\u003ccode\u003ebreaking changes\u003c/code\u003eという致命的な変更が行われるために、改造しないとビルドが通らなくなってしまう。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eファイルサイズが大きい\u003cbr\u003e\nchromiumのライブラリが含まれるため、小さく作っても150MB以上のファイルサイズになってしまう。\u003cbr\u003e\n企業で使用する場合、端末へファイルを配布する方法を考える必要がある。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e動かないオプションがある\u003cbr\u003e\nCefSharpのAPIマニュアルに書かれているオプションでも動作しないものがある。\u003cbr\u003e\n実際に動作するかどうかは動かしてみないと分からない。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eコマンドラインオプションの仕様が明確でない\u003cbr\u003e\n非公式なサイトに様々なコマンドラインオプションが紹介されていますが、実際に動作するかどうかは確認してみないと分からない。\u003cbr\u003e\nまた、バージョンによって、動作したり、動作しなかったりもする。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003egeolocation APIや3rd-party Cookieのブロックなど、Chromeにあるのに利用できない機能がある\u003cbr\u003e\ngeolocation APIは、独自で作成して公開することで対応することはできる。\u003cbr\u003e\n3rd-party Cookieは、自分で判断してブロックすることはできる。\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"233-まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#233-%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e23.3 まとめ\u003c/h2\u003e\n\n\u003cp\u003eUWP用のEdgeのWebViewもありますが、Windowsで高度なカスタマイズを行えるWebViewとなると、今のところCefSharp一択ではないかと思います。\u003c/p\u003e\n\n\u003cp\u003e最後まで読んでいただき、ありがとうございました。\u003c/p\u003e\n","createdAt":"2020-11-17T00:11:21Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"7lbzZe81YwbFHY7eDlFiCikPK9K98kiWiQ==--cjiClr2OjTTfs9ua--sANCS2hj5dGGOzT/Kzzhww==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-11-20T08:13:13Z","likesCount":9,"linkUrl":"https://qiita.com/masahiro-furuichi/items/ff3a1abf25a64cef7cdd","organization":null,"originalId":1338650,"stockedCount":11,"title":"CefSharpでカスタムWebブラウザを作る","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1-%E7%9B%AE%E7%9A%84\"\u003e1. 目的\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-%E6%9C%80%E5%88%9D%E3%81%AE%E6%9C%80%E5%88%9D\"\u003e2. 最初の最初\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#21-%E6%96%B0%E8%A6%8F%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"\u003e2.1 新規プロジェクトの作成する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#22-nuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E5%8F%96%E3%82%8A%E8%BE%BC%E3%82%80\"\u003e2.2 Nugetパッケージの取り込む\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#23-webview%E3%82%92%E8%B2%BC%E3%82%8A%E4%BB%98%E3%81%91%E3%82%8B\"\u003e2.3 WebViewを貼り付ける\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#24-%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B\"\u003e2.4 ビルドして実行する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#25-%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\"\u003e2.5 バージョンを確認する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3-%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e3. 最低限の設定\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#31-cefinitialize%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AB%E3%82%88%E3%82%8B%E5%88%9D%E6%9C%9F%E5%8C%96\"\u003e3.1 Cef.Initializeメソッドによる初期化\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E7%94%A8%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AE%E3%83%91%E3%82%B9\"\u003eキャッシュ用ディレクトリのパス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#useragent%E6%96%87%E5%AD%97%E5%88%97%E8%A8%AD%E5%AE%9A\"\u003eUserAgent文字列設定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A8%80%E8%AA%9E%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e言語の設定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AD%E3%82%B0%E3%83%AC%E3%83%99%E3%83%AB%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003eログレベルの設定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E5%BC%95%E6%95%B0%E8%A8%AD%E5%AE%9A\"\u003eコマンドライン引数設定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#cookie%E7%94%A8%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%8A%E3%81%BE%E3%81%91\"\u003eCookie用ディレクトリの設定(おまけ)\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#32-chromiumwebbrowserbrowsersettings%E3%81%AB%E3%82%88%E3%82%8B%E5%88%9D%E6%9C%9F%E5%8C%96\"\u003e3.2 ChromiumWebBrowser.BrowserSettingsによる初期化\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4-proxy%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e4. Proxyの設定\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#41-%E6%96%B9%E6%B3%951cefsharpsettingsproxy%E3%81%A7%E8%A8%AD%E5%AE%9A\"\u003e4.1 (方法1)CefSharpSettings.Proxyで設定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#42-%E6%96%B9%E6%B3%952%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E6%8C%87%E5%AE%9A\"\u003e4.2 (方法2)コマンドラインオプションで指定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#43-%E6%96%B9%E6%B3%953webview%E3%81%AE%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%A7%E6%8C%87%E5%AE%9A\"\u003e4.3 (方法3)WebViewのリクエストコンテキストで指定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#44-%E6%96%B9%E6%B3%954%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E5%85%A8%E4%BD%93%E3%81%AE%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%A7%E6%8C%87%E5%AE%9A\"\u003e4.4 (方法4)プログラム全体のリクエストコンテキストで指定\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#5-%E9%96%8B%E7%99%BA%E8%80%85%E3%83%84%E3%83%BC%E3%83%AB\"\u003e5. 開発者ツール\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#51-ikeyboardhandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"\u003e5.1 IKeyboardHandlerインタフェースを実装するクラスを作成する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#52-%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7ikeyboardhandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e5.2 作成したクラスでIKeyboardHandlerを実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#53-f12%E3%82%AD%E3%83%BC%E6%8A%BC%E4%B8%8B%E6%99%82%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B\"\u003e5.3 F12キー押下時の処理を追加する。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#54-webview%E3%81%AB%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\"\u003e5.4 WebViewにハンドラを設定する。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#55-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0web%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%A6f12%E3%82%AD%E3%83%BC%E6%8A%BC%E4%B8%8B%E3%82%92%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e5.5 カスタムWebブラウザを起動して、F12キー押下をしてみる。\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#6-%E6%88%BB%E3%82%8B%E9%80%B2%E3%82%80%E6%9B%B4%E6%96%B0%E3%83%AD%E3%83%BC%E3%83%89\"\u003e6. 戻る、進む、更新、ロード\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#61-%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%82%AD%E3%83%BC%E6%8A%BC%E4%B8%8B%E6%99%82%E3%81%AE%E5%87%A6%E7%90%86%E8%BF%BD%E5%8A%A0\"\u003e6.1 ショートカットキー押下時の処理追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#62-%E3%83%9C%E3%82%BF%E3%83%B3%E3%81%A8input%E3%81%AE%E9%85%8D%E7%BD%AE\"\u003e6.2 ボタンとINPUTの配置\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#tablelayoutpanel%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B\"\u003eTableLayoutPanelを配置する。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#webview%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B\"\u003eWebViewのコンテナを配置する。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B\"\u003eアドレスバーを配置する。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9C%E3%82%BF%E3%83%B3%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B\"\u003eボタンを配置する。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#webview%E3%81%AE%E4%BD%9C%E6%88%90%E5%87%A6%E7%90%86%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B\"\u003eWebViewの作成処理を変更する。\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#63-%E3%83%9C%E3%82%BF%E3%83%B3%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E6%99%82%E3%81%AE%E5%87%A6%E7%90%86%E8%BF%BD%E5%8A%A0\"\u003e6.3 ボタンクリック時の処理追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#64-%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%81%A7%E3%81%AE%E5%87%A6%E7%90%86%E8%BF%BD%E5%8A%A0\"\u003e6.4 アドレスバーでの処理追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#65-%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e6.5 実行してみる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#65-%E6%93%8D%E4%BD%9C%E5%AF%BE%E8%B1%A1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E6%B3%A8%E6%84%8F\"\u003e6.5 操作対象についての注意\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#7-%E6%8B%A1%E5%A4%A7%E7%B8%AE%E5%B0%8F\"\u003e7. 拡大・縮小\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#71-%E6%8B%A1%E5%A4%A7%E7%8E%87%E3%81%A8zoomlevel%E3%81%AE%E9%96%A2%E4%BF%82\"\u003e7.1 拡大率とZoomLevelの関係\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#72-%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%82%AD%E3%83%BC%E3%81%A7%E6%8B%A1%E5%A4%A7%E7%B8%AE%E5%B0%8F%E7%AD%89%E5%80%8D%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B\"\u003e7.2 ショートカットキーで拡大・縮小・等倍の処理を追加する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#8-%E5%8D%B0%E5%88%B7\"\u003e8. 印刷\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#81-%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%82%AD%E3%83%BC%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e8.1 ショートカットキーの追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#82-%E5%8D%B0%E5%88%B7%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e8.2 印刷の確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#9-%E8%AA%8D%E8%A8%BC\"\u003e9. 認証\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#91-irequesthandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e9.1 IRequestHandlerを実装するクラスの作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#92-irequesthandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%AE%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E5%87%A6%E7%90%86%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e9.2 IRequestHandlerインタフェースのデフォルト処理の実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#93-%E8%AA%8D%E8%A8%BC%E7%94%A8%E3%83%80%E3%82%A4%E3%82%A2%E3%83%AD%E3%82%B0%E3%83%9C%E3%83%83%E3%82%AF%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e9.3 認証用ダイアログボックスの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#94-getauthcredentials%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e9.4 GetAuthCredentialsメソッドの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#95-irequesthandler%E3%82%92chromiumwebbrowser%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\"\u003e9.5 IRequestHandlerをChromiumWebBrowserに設定する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#96-%E8%AA%8D%E8%A8%BC%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e9.6 認証の確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#10-%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E3%81%AE%E8%A1%A8%E7%A4%BA\"\u003e10. タイトルの表示\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#101-idisplayhandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e10.1 IDisplayHandlerを実装するクラスを追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#102-idisplayhandler%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BB%AE%E5%AE%9F%E8%A3%85\"\u003e10.2 IDisplayHandlerのメソッドを仮実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#103-%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E5%A4%89%E6%9B%B4%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e10.3 タイトル変更のハンドラを実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#104-idisplayhandler%E3%82%92chromiumwebbrowser%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\"\u003e10.4 IDisplayHandlerをChromiumWebBrowserに設定する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#11-%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%81%AE%E6%9B%B4%E6%96%B0\"\u003e11. アドレスバーの更新\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#111-%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%83%90%E3%83%BC%E3%81%AE%E6%96%87%E5%AD%97%E5%88%97%E5%A4%89%E6%9B%B4%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e11.1 アドレスバーの文字列変更のメソッドを追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#112-onaddresschanged%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e11.2 OnAddressChangedを実装\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#12-%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%83%AD%E3%82%B0\"\u003e12. コンソールログ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#121-log4net%E3%81%AEnuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e12.1 Log4NetのNugetパッケージを追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#122-log4net%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%95%E3%82%A3%E3%82%B0%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e12.2 Log4netのコンフィグの追加\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#appconfig%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003eApp.configの変更\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#assemblyinfocs%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003eAssemblyInfo.csの変更\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#123-onconsolemessage%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e12.3 OnConsoleMessageメソッドの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#124-%E3%83%AD%E3%82%B0%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e12.4 ログファイルの確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#13-%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\"\u003e13. ダウンロード\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#131-idownloadhandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e13.1 IDownloadHandlerを実装するクラスを追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#132-onbeforedownload%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e13.2 OnBeforeDownloadの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#133-ondownloadupdated%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e13.3 OnDownloadUpdatedの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#134-idownloadhandler%E3%81%AE%E6%8C%87%E5%AE%9A\"\u003e13.4 IDownloadHandlerの指定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#135-%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E5%87%A6%E7%90%86%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e13.5 ダウンロード処理の確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#14-favicon%E3%81%AE%E8%A1%A8%E7%A4%BA\"\u003e14. faviconの表示\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#141-favicon%E3%81%AE%E4%BB%95%E6%A7%98\"\u003e14.1 faviconの仕様\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#142-favicon%E3%81%AE%E8%A1%A8%E7%A4%BA%E5%87%A6%E7%90%86%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e14.2 faviconの表示処理を追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#143-favicon%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\"\u003e14.3 faviconのダウンロード\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E4%B8%AD%E3%81%AEfavicon%E3%81%AE%E3%83%AA%E3%82%B9%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90\"\u003eダウンロード中のfaviconのリストを作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#favicon%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B\"\u003efaviconをダウンロードする\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#144-onbeforedownload%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e14.4 OnBeforeDownloadの変更\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#145-ondownloadupdated%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e14.5 OnDownloadUpdatedの変更\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#146-favicon%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e14.6 faviconの確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#15-pdf%E8%A1%A8%E7%A4%BA\"\u003e15. pdf表示\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#16-%E7%89%B9%E5%AE%9A%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AE%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF\"\u003e16. 特定サイトのブロック\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#161-onbeforebrowse%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e16.1 OnBeforeBrowseメソッドの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#162-%E8%A1%A8%E7%A4%BA%E3%81%8C%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%81%95%E3%82%8C%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D\"\u003e16.2 表示がブロックされるか確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#17-cookie\"\u003e17. Cookie\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#171-icookieaccessfilter%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e17.1 ICookieAccessFilterインタフェースを実装するクラスを追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#172-cansavecookie%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e17.2 CanSaveCookieメソッドの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#173-cansendcookie%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e17.3 CanSendCookieメソッドの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#173-iresourcerequesthandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e17.3 IResourceRequestHandlerインタフェースを実装するクラスの追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#174-iresourcerequesthandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BB%AE%E5%AE%9F%E8%A3%85\"\u003e17.4 IResourceRequestHandlerインタフェースのメソッドを仮実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#175-irequesthandlergetresourcerequesthandler%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e17.5 IRequestHandler.GetResourceRequestHandlerメソッドを実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#176-cookie%E3%81%8C%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%81%95%E3%82%8C%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D\"\u003e17.6 Cookieがブロックされることを確認\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#18-%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E5%AE%9F%E8%A1%8C\"\u003e18. スクリプト実行\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#181-iloadhandler%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e18.1 ILoadHandlerを実装するクラスを追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#182-iloadhandler%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BB%AE%E5%AE%9F%E8%A3%85\"\u003e18.2 ILoadHandlerのメソッドを仮実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#183-iloadhandleronloadingstatechange%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e18.3 ILoadHandler.OnLoadingStateChangeメソッドの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#184-iloadhandler%E3%81%AE%E6%8C%87%E5%AE%9A\"\u003e18.4 ILoadHandlerの指定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#185-%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E5%AE%9F%E8%A1%8C%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e18.5 スクリプト実行の確認\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#186-%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E7%B5%90%E6%9E%9C%E3%82%92%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8B\"\u003e18.6 スクリプトの実行して結果を受け取る\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#19-%E7%8B%AC%E8%87%AA%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E5%85%AC%E9%96%8B\"\u003e19. 独自オブジェクトの公開\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#191-%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e19.1 公開するクラスの作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#192-%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%82%92%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B\"\u003e19.2 作成したクラスのインスタンスを公開する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#193-%E5%85%AC%E9%96%8B%E3%81%95%E3%82%8C%E3%81%9F%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003e19.3 公開されたオブジェクトを使用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#194-%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e19.4 確認してみる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#20-%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E5%86%85%E5%AE%B9%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e20. レスポンス内容の変更\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#201-iresponsefilter%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e20.1 IResponseFilterを実装するクラスを追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#202-iresponsefilter%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e20.2 IResponseFilterのメソッドを実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#203-iresourcerequesthandlergetresourceresponsefilter%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e20.3 IResourceRequestHandler.GetResourceResponseFilterメソッドの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#204-iresponsefilter%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e20.4 IResponseFilterの確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#21-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E\"\u003e21. カスタムスキーマ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#211-ischemehandlerfactory%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e21.1 ISchemeHandlerFactoryインタフェースを実装するクラスの追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#212-ischemehandlerfactory%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e21.2 ISchemeHandlerFactoryのメソッドを実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#213-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%AE%E7%99%BB%E9%8C%B2\"\u003e21.3 カスタムスキーマの登録\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#214-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e21.4 カスタムスキーマの確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#22-%E5%AD%90%E3%82%A6%E3%82%A3%E3%83%B3%E3%83%89%E3%82%A6%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3\"\u003e22. 子ウィンドウオープン\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#221-ilifespanhandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e22.1 ILifeSpanHandlerインタフェースを実装するクラス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#222-ilifespanhandler%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BB%AE%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e22.2 ILifeSpanHandlerインタフェースを実装のメソッドを仮実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#223-onbeforepopup%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e22.3 OnBeforePopupメソッドの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#224-onaftercreated%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e22.4 OnAfterCreatedメソッドの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#225-chromiumwebbrowserlifespanhandler%E3%81%ABilifespanhandler%E3%82%92%E8%A8%AD%E5%AE%9A\"\u003e22.5 ChromiumWebBrowser.LifeSpanHandlerにILifeSpanHandlerを設定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#226-%E3%83%AA%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AE%E5%AF%BE%E5%BF%9C\"\u003e22.6 リサイズの対応\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#227-%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e22.7 動作確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#23-cefsharp%E3%81%AE%E7%89%B9%E5%BE%B4\"\u003e23. CefSharpの特徴\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#231-%E8%89%AF%E3%81%84%E7%82%B9\"\u003e23.1 良い点\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#232-%E6%82%AA%E3%81%84%E7%82%B9\"\u003e23.2 悪い点\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#233-%E3%81%BE%E3%81%A8%E3%82%81\"\u003e23.3 まとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":4732,"uuid":"ff3a1abf25a64cef7cdd","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"Uq4xDb220o/VtdMI71XlK5ouDPu3--F9MpC49f72AyCEhy--omABdaHiUYZgTZxMG9EhpQ==","originalId":354588,"description":"","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"古市 昌弘","profileImageUrl":"https://lh6.googleusercontent.com/-alAsth0eG_I/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMQWL9cEo5JVt6DPhm58dO1w5e8nQ/mo/photo.jpg?sz=50","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Flh6.googleusercontent.com%2F-alAsth0eG_I%2FAAAAAAAAAAI%2FAAAAAAAAAAA%2FACevoQMQWL9cEo5JVt6DPhm58dO1w5e8nQ%2Fmo%2Fphoto.jpg%3Fsz%3D50?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=1356bf7cb0a296ccba24686afbd570eb","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Flh6.googleusercontent.com%2F-alAsth0eG_I%2FAAAAAAAAAAI%2FAAAAAAAAAAA%2FACevoQMQWL9cEo5JVt6DPhm58dO1w5e8nQ%2Fmo%2Fphoto.jpg%3Fsz%3D50?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1d242b516f13a97a499b47bcbe60a611","urlName":"masahiro-furuichi","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Chromium","urlName":"chromium"},{"name":"browser","urlName":"browser"},{"name":"WinForms","urlName":"winforms"},{"name":"CefSharp","urlName":"cefsharp"}],"followingLikers":{"edges":[]},"comments":{"totalCount":2}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

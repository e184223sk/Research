<!DOCTYPE html><html><head><meta charset="utf-8" /><title>C#でプログラミング言語っぽいものを作ってみる - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/fff-n/items/0192a892436cc69b2006" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="Pradzt2kdYUGaNRH4H13rW62dLl90iFT/GEAYHI3GvU5aNksrn19rtki3fdAKxQz88T+kbrvmPulq/J5ZzgKMA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="C#でプログラミング言語っぽいものを作ってみる - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1ReVBqZ2Fmamc1ZmpnNjNqZ3JEamc2bmpnNV9qZzdQamdyRG9xSURvcXA3amdhUGpnYjNqZ1lUamdvTGpnYTdqZ3BMa3ZaempnYVBqZ2FiamdiX2pnb3MmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9OWZjZjc4ODE2NDgzMmJmNmFmYzgxZDRiODkxMWQ2NDI&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR1ptWmkxdSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWQ2MWM1NWFiZjgyMWFhMWQ4ZTVkMTY3YjVjYjFiMDNk&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=f6a473b6a96bf469847e0836a2a257d3"><meta property="og:description" content="この記事は、Akatsuki Advent Calendarの17日目の記事です。


はじめに

こんにちは。
株式会社アカツキの方でエンジニアをやっておりますfff-nと申します。
この年末年始はC#上で動くプログラミング言語を作..."><meta content="https://qiita.com/fff-n/items/0192a892436cc69b2006" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,構文解析,字句解析,プログラミング言語入門" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-057b5a46-b590-4ec6-a158-bf31beee85ee"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Ffff-n%2Fitems%2F0192a892436cc69b2006">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Ffff-n%2Fitems%2F0192a892436cc69b2006">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-057b5a46-b590-4ec6-a158-bf31beee85ee">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-12-18T02:56:09.000+09:00","dateModified":"2019-02-14T13:54:28.000+09:00","headline":"C#でプログラミング言語っぽいものを作ってみる","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1ReVBqZ2Fmamc1ZmpnNjNqZ3JEamc2bmpnNV9qZzdQamdyRG9xSURvcXA3amdhUGpnYjNqZ1lUamdvTGpnYTdqZ3BMa3ZaempnYVBqZ2FiamdiX2pnb3MmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9OWZjZjc4ODE2NDgzMmJmNmFmYzgxZDRiODkxMWQ2NDI\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR1ptWmkxdSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWQ2MWM1NWFiZjgyMWFhMWQ4ZTVkMTY3YjVjYjFiMDNk\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=f6a473b6a96bf469847e0836a2a257d3","mainEntityOfPage":"https://qiita.com/fff-n/items/0192a892436cc69b2006","author":{"@type":"Person","address":"Tokyo, Japan","email":null,"identifier":"fff-n","name":"fff-n","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F14069489%3Fv%3D3?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=221b55da3469bb9c270d5b3707b577c6","url":"https://qiita.com/fff-n","description":"","memberOf":[{"@type":"Organization","address":"東京都品川区上大崎2-13-30 oak meguro","legalName":"株式会社アカツキ","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/6b9078539946826ea9b0365ebdbc50b888d83d37/original.jpg?1462502511","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/077ebe6bfb994e8a881a54e6443fce69b41a385c/original.jpg?1462502511","identifier":"aktsk","description":"株式会社アカツキは、スマートフォンゲームの企画開発を中心に事業を展開しております。創業以来全てのゲームを内製しているため、高い技術ノウハウが蓄積されています。今後は、新規事業の立ち上げも行ってまいります。"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita&amp;utm_medium=header-banner">「最高の開発者体験」を目指す NewsPicks開発チーム</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"fff-n","type":"items","id":"0192a892436cc69b2006"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「最高の開発者体験」を目指す NewsPicks開発チーム","url":"https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"fff-n","type":"items","id":"0192a892436cc69b2006"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「最高の開発者体験」を目指す NewsPicks開発チーム","url":"https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"fff-n","type":"items","id":"0192a892436cc69b2006"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「最高の開発者体験」を目指す NewsPicks開発チーム","url":"https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/fff-n/items/0192a892436cc69b2006","location":"/fff-n/items/0192a892436cc69b2006","scheme":"https","host":"qiita.com","port":null,"pathname":"/fff-n/items/0192a892436cc69b2006","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"AoE8eTywXF47MNWa7Ap7zGBv7aRqsV4i4Wnne55rBcMFX3ibT2lUdeR63CpMXBhS/R1njK2M54q4oxVii2QVBg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-0cd1f4be-329c-420e-9d0f-365e0557b127"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/fff-n/items/0192a892436cc69b2006/likers" class="css-1iupg5d">28</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">21</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/0192a892436cc69b2006/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/fff-n/items/0192a892436cc69b2006/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/fff-n/items/0192a892436cc69b2006/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/fff-n/items/0192a892436cc69b2006/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/fff-n/items/0192a892436cc69b2006.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><a href="/organizations/aktsk"><img src="https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/077ebe6bfb994e8a881a54e6443fce69b41a385c/original.jpg?1462502511" class="it-AdcalRibbon_orgImage"/></a><span><a href="/advent-calendar/2017/aktsk" class="it-AdcalRibbon_title">Akatsuki<!-- --> Advent Calendar<!-- --> <!-- -->2017</a>Day 17</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/fff-n"><img class="css-100alwu eyfquo10" src="https://avatars.githubusercontent.com/u/14069489?v=3" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/fff-n" class="css-10ougpm">@<!-- -->fff-n</a><div class="css-1ay9vb9"><span><meta content="2017-12-17T17:56:09Z"/><time dateTime="2019-02-14T04:54:28Z" class="css-m19uds">updated at 2019-02-14</time></span></div></div></div></div></div><h1 class="css-cgzq40">C#でプログラミング言語っぽいものを作ってみる</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/%e6%a7%8b%e6%96%87%e8%a7%a3%e6%9e%90" class="css-4czcte">構文解析</a><a href="/tags/%e5%ad%97%e5%8f%a5%e8%a7%a3%e6%9e%90" class="css-4czcte">字句解析</a><a href="/tags/%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e%e5%85%a5%e9%96%80" class="css-4czcte">プログラミング言語入門</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>この記事は、Akatsuki Advent Calendarの17日目の記事です。</p>

<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>こんにちは。<br>
株式会社アカツキの方でエンジニアをやっておりますfff-nと申します。<br>
この年末年始はC#上で動くプログラミング言語を作ってみようと思ったので、今回はプログラミング言語を作る上での考え方、作り方および実装にあたって便利なツールについて書いてみようと思います。</p>

<p>この記事ではツールの紹介と、とりあえず動く物を作る事の2点に注力しています。<br>
本来はこの手の分野の話題には言語処理関係の知識が必要ですが、この記事ではそれらの解説は行いませんし用語も極力使わないようにしています。<br>
解説するにしてもかなりざっくりとしているので、しっかりとした知識が必要な方は専門のサイトや書籍を読むのがいいと思います。</p>

<h1>
<span id="なぜcで作るのか" class="fragment"></span><a href="#%E3%81%AA%E3%81%9Cc%E3%81%A7%E4%BD%9C%E3%82%8B%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>なぜC#で作るのか</h1>

<p>Unityに容易に組み込めるからです。<br>
まあ、実際に作った言語をUnityに組み込むみたいな事はやらないと思います。 <br>
実装が複数の言語に跨るとそれだけ管理のコストがかかってしまうので。<br>
ですが、今回の内容はプログラミング言語レベルに複雑な物を作るだけでなく、ちょっとした文法に従って文字列を処理するプログラム（HTMLパーサっぽいものとか）を書くためにも使えるのでやろうと思えばいくらでも応用が効くと思います。 </p>

<h1>
<span id="今回作るもの" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9E%E4%BD%9C%E3%82%8B%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>今回作るもの</h1>

<p>この記事では「スクリプト（式）を文字列として受け取り、それを評価した結果を出力する」プログラムを作ります。<br>
とても単純なインタプリタの一種になります。<br>
インタプリタとは、超ざっくり説明するとスクリプトを読み込んでその場で実行するプログラムです。<br>
rubyとかがそうですね。</p>

<p>今回実装する機能の範囲についてですが、単純に四則演算ができるまでとします。<br>
それではプログラミング言語とは言えませんね。<br>
というのも、今回の記事の主軸は後述の字句解析と構文解析をC#上でどう楽して作るかに寄せているためです（実際、パフォーマンスとか抜きにすると一番大変なのは文字列処理なので）<br>
なので、入力文字列を解析して計算するところまでできたら後はこの記事の範囲外とします。</p>

<p>では早速作っていきましょう。</p>

<h1>
<span id="インタプリタの考え方" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%97%E3%83%AA%E3%82%BF%E3%81%AE%E8%80%83%E3%81%88%E6%96%B9"><i class="fa fa-link"></i></a>インタプリタの考え方</h1>

<p>まずインタプリタを作るために、インタプリタが何をしているのかを考えます。<br>
今回作るインタプリタは <br>
1. 文字列としてスクリプトを受け取り<br>
2. スクリプトの評価結果を出力する</p>

<p>という処理をします。</p>

<p>問題はこの1と2の間にどのような処理が必要となるかです。<br>
「評価結果を出力する」ためには、「スクリプトを評価する」必要があります。<br>
「スクリプトを評価する」ためには、「文字列として渡されたスクリプトを評価が可能な形式に変換する」必要があります。<br>
それでは、「文字列として渡されたスクリプトを評価が可能な形式に変換する」ためにはどのような処理が必要なのでしょうか？</p>

<h2>
<span id="式を評価する" class="fragment"></span><a href="#%E5%BC%8F%E3%82%92%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>式を評価する</h2>

<p>まず、評価が可能な形式とは何かについて考えてみます。<br>
今回実行させたいスクリプトを以下のようにするとします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>1+1
1+1*3
1*(1-1)
</code></pre></div></div>

<p>まずは<code>1+1</code>に着目します。<br>
素直に計算すると結果は<code>2</code>ですが、これを計算するためにはどのようなプログラムが必要になるかを考えます。<br>
<code>System.Console.WriteLine(1 + 1);</code>とかではないです。数字が変わってもいいような形にする必要があります。<br>
まあぶっちゃけるとデザインパターンの1つ、Interpreterパターンを真似ればいいだけなのですが。<br>
Interpreterパターンの解説はDRY原則に則り別のサイトにお任せするとして、これそのままズバリな名前してますよね。<br>
要はこのような処理を実現するのに適したパターンなのです。</p>

<p>まずは基底インターフェースとなる<code>IExpression</code>を作ります。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IExpression</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="nf">Evaluate</span> <span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>唯一のメソッド<code>Evaluate()</code>は評価するという意味を持ち、そのExpressionを評価した結果を返します。<br>
で、次は数字を表すクラスを作ります。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">NumberExpression</span> <span class="p">:</span> <span class="n">IExpression</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">double</span> <span class="n">_num</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">NumberExpression</span> <span class="p">(</span><span class="kt">double</span> <span class="n">num</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">_num</span> <span class="p">=</span> <span class="n">num</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">double</span> <span class="nf">Evaluate</span> <span class="p">()</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="n">_num</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>シンプルですね。コンストラクタで渡されたnumを<code>Evaluate()</code>でそのまま返しているだけです。<br>
では次は加算記号を表すクラスを作ります。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">OpAddExpression</span> <span class="p">:</span> <span class="n">IExpression</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">IExpression</span> <span class="n">_left</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">IExpression</span> <span class="n">_right</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">OpAddExpression</span> <span class="p">(</span><span class="n">IExpression</span> <span class="n">left</span><span class="p">,</span> <span class="n">IExpression</span> <span class="n">right</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">_left</span>  <span class="p">=</span> <span class="n">left</span><span class="p">;</span>
      <span class="n">_right</span> <span class="p">=</span> <span class="n">right</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">double</span> <span class="nf">Evaluate</span> <span class="p">()</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="n">_left</span><span class="p">.</span><span class="nf">Evaluate</span><span class="p">()</span> <span class="p">+</span> <span class="n">_right</span><span class="p">.</span><span class="nf">Evaluate</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>はい。これもシンプルですね。コンストラクタで2つのIExpressionを受け取り、<code>Evaluate()</code>ではそれらを<code>Evaluate()</code>した結果を足し合わせています。<br>
これで加算演算が表せるわけですね。<br>
では、これらのクラスで<code>1+1</code>の計算をしてみます。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">left</span>  <span class="p">=</span> <span class="k">new</span> <span class="nf">NumberExpression</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">right</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">NumberExpression</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">opAdd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">OpAddExpression</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">);</span>

<span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">opAdd</span><span class="p">.</span><span class="nf">Evaluate</span><span class="p">());</span> <span class="c1">// =&gt; "2"</span>
</code></pre></div></div>

<p>この<code>addOp</code>というものが<code>1+1</code>の評価可能な形であり、このインスタンスの<code>Evaluate()</code>を実行することで<code>1+1</code>の結果が計算できます。<br>
では次の式に行ってみましょう。</p>

<p>次は、<code>1+1*3</code>です。<br>
乗算が出てきましたね。乗算を表すクラスは<code>OpMulExpression</code>としましょう。実装は省略します。<br>
<code>1+1*3</code>は次のように表せます。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">addLeft</span>  <span class="p">=</span> <span class="k">new</span> <span class="nf">NumberExpression</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">mulLeft</span>  <span class="p">=</span> <span class="k">new</span> <span class="nf">NumberExpression</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">mulRight</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">NumberExpression</span><span class="p">(</span><span class="m">3</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">addRight</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">OpMulExpression</span><span class="p">(</span><span class="n">mulLeft</span><span class="p">,</span> <span class="n">mulRight</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">opAdd</span>    <span class="p">=</span> <span class="k">new</span> <span class="nf">OpAddExpression</span><span class="p">(</span><span class="n">addLeft</span><span class="p">,</span> <span class="n">addRight</span><span class="p">);</span>

<span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">opAdd</span><span class="p">.</span><span class="nf">Evaluate</span><span class="p">());</span> <span class="c1">// =&gt; "4"</span>
</code></pre></div></div>

<p>はい。ちょっとややこしくなってきましたが、opAddのrightが<code>OpMulExpression</code>のインスタンスとなっています。<br>
<code>OpMulExpression</code>も<code>IExpression</code>の実装ですので、<code>NumberExpression</code>と同様<code>OpAddExpression</code>のコンストラクタに渡すことができます。<br>
そして、<code>OpMulExpression</code>の<code>Evaluate()</code>はleftとrightを乗算した結果を返すので、<code>opAdd.Evaluate()</code>は<code>1+1*3</code>を計算することになります。</p>

<p>それでは最後の式に行ってみましょう。<br>
最後は<code>1*(1-1)</code>です。<br>
減算のクラスは<code>OpSubExpression</code>としましょう。<code>()</code>については新しくクラスを作る必要はありません。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">mulLeft</span>  <span class="p">=</span> <span class="k">new</span> <span class="nf">NumberExpression</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">subLeft</span>  <span class="p">=</span> <span class="k">new</span> <span class="nf">NumberExpression</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">subRight</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">NumberExpression</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">mulRight</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">OpSubExpression</span><span class="p">(</span><span class="n">subLeft</span><span class="p">,</span> <span class="n">subRight</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">opMul</span>    <span class="p">=</span> <span class="k">new</span> <span class="nf">OpMulExpression</span><span class="p">(</span><span class="n">mulLeft</span><span class="p">,</span> <span class="n">mulRight</span><span class="p">);</span>

<span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">opMul</span><span class="p">.</span><span class="nf">Evaluate</span><span class="p">());</span> <span class="c1">// =&gt; "0"</span>
</code></pre></div></div>

<p>このように、<code>()</code>はどのような構造でExpressionを作るかによって対応することができます。<br>
これで評価が可能な形式についてはイメージが掴めたと思います。<br>
では、文字列からどのようにしてこの形に変換すればよいのでしょうか？</p>

<h2>
<span id="字句解析と構文解析" class="fragment"></span><a href="#%E5%AD%97%E5%8F%A5%E8%A7%A3%E6%9E%90%E3%81%A8%E6%A7%8B%E6%96%87%E8%A7%A3%E6%9E%90"><i class="fa fa-link"></i></a>字句解析と構文解析</h2>

<p>IExpressionインターフェースとそれを実装するクラスを使うことで、式をクラスで表現することができました。<br>
次の課題は、文字列をIExpressionに変換する処理をどう実現するかということになります。</p>

<p>これには明確な解決方法があります。</p>

<p>この問題を解決するキーワードは、字句解析と構文解析です。<br>
これらについて、この記事ではざっくりとしたことしか説明しません。<br>
詳しい解説はDRY原則に則り別のサイトにお任せすることにします。</p>

<p>字句解析は文字列をトークン列と呼ばれる物に変換する処理です。<br>
ざっくりとしたイメージとして、<code>1+1</code>という文字列が渡されたら<code>NUM OP_ADD NUM</code>というトークン列（この<code>NUM</code>と<code>OP_ADD</code>がトークン）を返すものと考えてもらってよいです。</p>

<p>構文解析はこのトークンから文法を読み解く処理です。<br>
<code>NUM OP_ADD NUM</code>というトークン列を受け取ったら、「これは加算演算である」と判定するようなものです。</p>

<p>で、構文解析において「これは加算演算である」ということが分かったら、先程の<code>1+1</code>の時のように<code>OpAddExpression</code>のインスタンスを作れば、スクリプトを評価可能な形に変換できるというわけですね。</p>

<p>この字句解析と構文解析ですが、1から全部実装しようとすると大変なので、それぞれツールを使って実装します。<br>
どのくらい大変かについてイメージが掴めない方は、この年末年始にでも字句解析と構文解析のアルゴリズムを一通り学んだ上でぜひ一度実装に取り組んでみるといいと思います。</p>

<h3>
<span id="字句解析機生成ツールre2c" class="fragment"></span><a href="#%E5%AD%97%E5%8F%A5%E8%A7%A3%E6%9E%90%E6%A9%9F%E7%94%9F%E6%88%90%E3%83%84%E3%83%BC%E3%83%ABre2c"><i class="fa fa-link"></i></a>字句解析機生成ツールre2c</h3>

<p>字句解析するプログラムは<code>re2c</code>というツールを使って生成します。<br>
インストールは<code>pacman -S re2c</code>とか<code>brew install re2c</code>とかすればできますが、公式サイトのドキュメントを読んだほうがいいと思います。</p>

<p><a href="http://re2c.org/" rel="nofollow noopener" target="_blank">re2c公式サイト</a></p>

<p><code>re2c</code>は本来C/C++向けのツールなのですが、生成コードの内容を設定で変更できるためC#でも使えます。<br>
<code>re2c</code>が生成するコードは<code>goto</code>を多用していますが、C#は<code>goto</code>をサポートしているので問題ありません。</p>

<h3>
<span id="構文解析機生成ツールjay" class="fragment"></span><a href="#%E6%A7%8B%E6%96%87%E8%A7%A3%E6%9E%90%E6%A9%9F%E7%94%9F%E6%88%90%E3%83%84%E3%83%BC%E3%83%ABjay"><i class="fa fa-link"></i></a>構文解析機生成ツールjay</h3>

<p>構文解析するプログラムは<code>jay</code>というツールを使って生成します。<br>
<code>jay</code>は<code>mono</code>が使っているC#向けの構文解析機生成ツールで、<code>mono</code>のgitリポジトリに<code>jay</code>のプロジェクトも入っているので、リポジトリをcloneしてプロジェクトをビルドすれば<code>jay</code>が使えます。<br>
（<code>make</code>する場合、事前に<code>mono/mcs/build/platforms/</code>にある<code>.make</code>ファイル群から、自分の環境にあったものを<code>.make</code>にリネームする必要があります）</p>

<p><a href="https://github.com/mono/mono" rel="nofollow noopener" target="_blank">monoのリポジトリ</a></p>

<h3>
<span id="構文解析機を作る" class="fragment"></span><a href="#%E6%A7%8B%E6%96%87%E8%A7%A3%E6%9E%90%E6%A9%9F%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>構文解析機を作る</h3>

<p>それではコードを書いていきます。</p>

<p>まずはjayから使います。<br>
jayはパーサを生成します。<code>Parser.jay</code>というファイルを作り次の内容を書き込みます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>%{
using System;
using SampleLanguage.Expression;

namespace SampleLanguage.Interpreter
{
    public class Parser
    {
        private int yacc_verbose_flag = 0;

%}

%token &lt;string&gt; LP
%token &lt;string&gt; RP
%token &lt;string&gt; OP_ADD
%token &lt;string&gt; OP_SUB
%token &lt;string&gt; OP_MUL
%token &lt;string&gt; OP_DIV
%token &lt;string&gt; OP_DIV
%token &lt;double&gt; NUM

%type &lt;IExpression&gt; Formula
%type &lt;IExpression&gt; Term
%type &lt;IExpression&gt; Num

%left LP RP
%left OP_ADD OP_SUB
%left OP_MUL OP_DIV

%start Sentence

%%

Sentence
  : Formula

Formula
  : Term
  {
    $$ = $1;
  }
  | Formula OP_ADD Term
  {
    $$ = new OpAddExpression($1, $3);
  }
  | Formula OP_SUB Term
  {
    $$ = new OpSubExpression($1, $3);
  }

Term
  : Num
  {
    $$ = $1;
  }
  | Term OP_MUL Num
  {
    $$ = new OpMulExpression($1, $3);
  }
  | Term OP_DIV Num
  {
    $$ = new OpDivExpression($1, $3);
  }

Num
  : NUM
  {
    $$ = new NumberExpression($1);
  }
  | LP Formula RP
  {
    $$ = $2;
  }

%%
}
</code></pre></div></div>

<p>書き方はなんとなく分かると思います。<br>
使われるトークン、演算子の順序を定義してから、BNF記法チックな書き方で文法を書き連ねていきます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>Num
  : NUM
  {
    $$ = new NumberExpression($1);
  }
</code></pre></div></div>

<p>例えば上記のこの部分はNumはNUMであるという定義をしています。<br>
波括弧の中ではNUMからNumへ還元する際の処理をC#で書きます。<br>
還元という言葉の意味が分からない場合は「文法 還元」あたりで検索するといいと思います。<br>
要はNUMをNumへと置き換えることです。<br>
ここでは、NUMは数値ですので<code>NumberExpression</code>をnewしています。<br>
<code>$1</code>というのはトークンの実際の値です。文法の左端から<code>$1,$2 ...</code>という風に参照できます。<br>
ここでは<code>$1</code>はNUMのことであり、NUMは型がdoubleなのでdouble型の値が入ります。<br>
<code>$$</code>はNumの実際の値となります。なので、Numは値としては<code>NumberExpression</code>のインスタンスを持つことになります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>Term

...

| Term OP_MUL Num
{
  $$ = new OpMulExpression($1, $3);
}
</code></pre></div></div>

<p>ここは乗算処理の文法を定義し、還元の際には<code>OpMulExpression</code>を作っています。<br>
StatementもNumも<code>IExpression</code>型なので、そのまま<code>OpMulExpression</code>のコンストラクタに渡せます。</p>

<p>それではこの<code>Parser.jay</code>からC#のファイルを生成します。<br>
cloneしてきたmonoから先程ビルドしたjayの実行ファイルと、<code>mono/mcs/jay/skeleton.cs</code>を<code>Parser.jay</code>と同じディレクトリにコピーし、そのディレクトリ上でターミナルを開き<code>jay -c Parser.jay &lt; skeleton.cs &gt; Parser.cs</code>を実行してください。<br>
<code>Parser.cs</code>が生成されると思います。これが構文解析を行うコードになります。</p>

<h3>
<span id="字句解析機を作る" class="fragment"></span><a href="#%E5%AD%97%E5%8F%A5%E8%A7%A3%E6%9E%90%E6%A9%9F%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>字句解析機を作る</h3>

<p>次は<code>re2c</code>を使って字句解析機を作ります。<br>
プログラムの実行順は字句解析 =&gt; 構文解析ですが、コードを作るのは構文解析機が先になります。<br>
なぜなら、字句解析機のインターフェースと構文解析機が返すべきトークンが<code>Parser.cs</code>にて定義されるからです。</p>

<p><code>Lexer.re</code>というファイルを作り内容は次のようにします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>namespace SampleLanguage.Interpreter
{
    public class Lexer : yyParser.yyInput
    {
        private string _script;
        private string _value;
        private int    _index;
        private int    _token;
        private int    _cursor;
        private int    _marker; public Lexer (string script)
        {
            _script = script;
        } public bool advance ()
        {
            if ( _script.Length &lt;= _index )
            {
                _token = Token.yyErrorCode;
                _value = "";
                return false;
            }

            _token = Lex(_index);
            _value = _script.Substring(_index, (_cursor - _index));
            _index = _cursor;

            return true;
        }

        public int token ()
        {
            return _token;
        }

        public object value ()
        {
            switch (_token)
            {
                case Token.NUM: 
                    return double.Parse(_value);

                default:
                    return _value;
            }
        }

        private int YYPEEK ()
        {
            if (_cursor == _script.Length)
            {
                return 0;
            }

            return (int)_script[_cursor];
        }

        private void YYSKIP ()
        {
            _cursor++;
        }

        private void YYBACKUP ()
        {
            _marker = _cursor;
        }

        private void YYRESTORE()
        {
            _cursor = _marker;
        }

        private int Lex (int startIndex)
        {
            _cursor = startIndex;
            YYBACKUP();
loop:
            /*!re2c
              re2c:define:YYCTYPE = int;
              re2c:yyfill:enable = 0;

              WSP         = [ \t\v\n\r];
              WHITE_SPACE = WSP+;

              OP_ADD      = "+";
              OP_SUB      = "-";
              OP_MUL      = "*";
              OP_DIV      = "/";
              LP          = "(";
              RP          = ")";

              DIGIT       = [0-9];
              DIGITNZ     = [1-9];
              U_INTEGER   = "0" | DIGITNZ DIGIT*;
              DOUBLE      = U_INTEGER "." DIGIT+;
              NUM         = U_INTEGER | DOUBLE;

              WHITE_SPACE   { _index = _cursor; goto loop; }
              OP_ADD        { return Token.OP_ADD;  }
              OP_SUB        { return Token.OP_SUB;  }
              OP_MUL        { return Token.OP_MUL;  }
              OP_DIV        { return Token.OP_DIV;  }
              LP            { return Token.LP;  }
              RP            { return Token.RP;  }
              NUM           { return Token.NUM;  }
            */
        }
    }
}
</code></pre></div></div>

<p>キモになるのは<code>/*!re2c</code>から始まるコメントの部分です。<br>
ここで、<code>re2c</code>に作ってもらいたい字句解析機を定義します。<br>
内容としては、単に正規表現の定義と、正規表現にマッチした際に適切なトークンを返す処理をしているくらいです。<br>
<code>YYPEEK()</code>とか<code>YYSKIP()</code>は<code>re2c</code>で生成されるコードのためのメソッドです。<br>
<code>yyParser.yyInput</code>は<code>Parser.cs</code>で定義されるインターフェースで、jayで生成した構文解析機を動かすのに必要です。</p>

<p>それでは字句解析機のcsファイルも作りましょう。<br>
<code>Lexere.re</code>と同じディレクトリ上でターミナルを開き、<code>re2c -i --input custom Lexer.re -o Lexer.cs</code>を実行します。<br>
<code>Lexer.cs</code>が生成されます。<br>
これで、構文解析機と字句解析機ができました。</p>

<h2>
<span id="実際に使ってみる" class="fragment"></span><a href="#%E5%AE%9F%E9%9A%9B%E3%81%AB%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>実際に使ってみる</h2>

<p>これで四則演算ができるようになりました。<br>
実際にコードを書いて試してみましょう。</p>

<p>なんでもいいのでクラスを作り、次のメソッドを定義します。<br>
ここでは<code>SampleInterpreter</code>とでもしましょうか。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">SampleInterpreter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Execute</span> <span class="p">(</span><span class="kt">string</span> <span class="n">script</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">lexer</span>       <span class="p">=</span> <span class="k">new</span> <span class="nf">Lexer</span><span class="p">(</span><span class="n">script</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">parser</span>      <span class="p">=</span> <span class="k">new</span> <span class="nf">Parser</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">expression</span>  <span class="p">=</span> <span class="p">(</span><span class="n">IExpression</span><span class="p">)</span><span class="n">parser</span><span class="p">.</span><span class="nf">yyparse</span><span class="p">(</span><span class="n">lexer</span><span class="p">);</span>

        <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">expression</span><span class="p">.</span><span class="nf">Evaluate</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これが今回の目標としていた「スクリプト（式）を文字列として受け取り、それを評価した結果を出力する」処理を実現するメソッドです。<br>
これをMainメソッドから呼びます。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span> <span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SampleInterpreter</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="s">"1+1"</span><span class="p">);</span>     <span class="c1">// =&gt; "2"</span>
    <span class="n">SampleInterpreter</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="s">"1+1*3"</span><span class="p">);</span>   <span class="c1">// =&gt; "4"</span>
    <span class="n">SampleInterpreter</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="s">"1*(1-1)"</span><span class="p">);</span> <span class="c1">// =&gt; "0"</span>
<span class="p">}</span>
</code></pre></div></div>

<p>実行するとちゃんと計算結果が出力されたと思います。</p>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>無事文字列を解析して四則演算するプログラムが実装できました。<br>
プログラミング言語を作る上で最大の鬼門であろうスクリプトの解析がこれでできるようになったので、後はいくらでも拡張ができると思います。<br>
次のステップとしては「複数の行に対応」「intやboolなどの型の実装」「関数の実装」「if文の実装」あたりでしょうか。<br>
これらの実装についてはこの記事では扱いません。長くなる上に実現方法はいくらでもあるので。</p>

<p>いかがでしたでしょうか。<br>
皆様もこの機にオレオレ言語を作ってみるのもいいと思います。</p>

<p>それではよい年末を。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Ffff-n%2Fitems%2F0192a892436cc69b2006&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Ffff-n%2Fitems%2F0192a892436cc69b2006&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/fff-n/items/0192a892436cc69b2006/likers" class="css-1iupg5d">28</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">21</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/0192a892436cc69b2006/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/fff-n/items/0192a892436cc69b2006/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/fff-n/items/0192a892436cc69b2006/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/fff-n/items/0192a892436cc69b2006/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/fff-n/items/0192a892436cc69b2006.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-0cd1f4be-329c-420e-9d0f-365e0557b127">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-435c9683-590d-48d2-99d7-a421bd7c92a1"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-435c9683-590d-48d2-99d7-a421bd7c92a1">{}</script>
      
<div id="LoginModal-react-component-9e01655e-3457-4d0c-8b5d-398f557dcac9"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-9e01655e-3457-4d0c-8b5d-398f557dcac9">{}</script>
      
<div id="StockModal-react-component-577a28d4-9c4b-4ce2-ad5e-1653b9648524"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-577a28d4-9c4b-4ce2-ad5e-1653b9648524">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;WrG5JnI5co0giY0yQShoLScAAlgC6kwhdoByovUcztBdb/3EAeB6pv/DhILhfguzunKIcMXX9YkvSoC74BPeFQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003eこの記事は、Akatsuki Advent Calendarの17日目の記事です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eこんにちは。\u003cbr\u003e\n株式会社アカツキの方でエンジニアをやっておりますfff-nと申します。\u003cbr\u003e\nこの年末年始はC#上で動くプログラミング言語を作ってみようと思ったので、今回はプログラミング言語を作る上での考え方、作り方および実装にあたって便利なツールについて書いてみようと思います。\u003c/p\u003e\n\n\u003cp\u003eこの記事ではツールの紹介と、とりあえず動く物を作る事の2点に注力しています。\u003cbr\u003e\n本来はこの手の分野の話題には言語処理関係の知識が必要ですが、この記事ではそれらの解説は行いませんし用語も極力使わないようにしています。\u003cbr\u003e\n解説するにしてもかなりざっくりとしているので、しっかりとした知識が必要な方は専門のサイトや書籍を読むのがいいと思います。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"なぜcで作るのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AA%E3%81%9Cc%E3%81%A7%E4%BD%9C%E3%82%8B%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eなぜC#で作るのか\u003c/h1\u003e\n\n\u003cp\u003eUnityに容易に組み込めるからです。\u003cbr\u003e\nまあ、実際に作った言語をUnityに組み込むみたいな事はやらないと思います。 \u003cbr\u003e\n実装が複数の言語に跨るとそれだけ管理のコストがかかってしまうので。\u003cbr\u003e\nですが、今回の内容はプログラミング言語レベルに複雑な物を作るだけでなく、ちょっとした文法に従って文字列を処理するプログラム（HTMLパーサっぽいものとか）を書くためにも使えるのでやろうと思えばいくらでも応用が効くと思います。 \u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"今回作るもの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E4%BD%9C%E3%82%8B%E3%82%82%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今回作るもの\u003c/h1\u003e\n\n\u003cp\u003eこの記事では「スクリプト（式）を文字列として受け取り、それを評価した結果を出力する」プログラムを作ります。\u003cbr\u003e\nとても単純なインタプリタの一種になります。\u003cbr\u003e\nインタプリタとは、超ざっくり説明するとスクリプトを読み込んでその場で実行するプログラムです。\u003cbr\u003e\nrubyとかがそうですね。\u003c/p\u003e\n\n\u003cp\u003e今回実装する機能の範囲についてですが、単純に四則演算ができるまでとします。\u003cbr\u003e\nそれではプログラミング言語とは言えませんね。\u003cbr\u003e\nというのも、今回の記事の主軸は後述の字句解析と構文解析をC#上でどう楽して作るかに寄せているためです（実際、パフォーマンスとか抜きにすると一番大変なのは文字列処理なので）\u003cbr\u003e\nなので、入力文字列を解析して計算するところまでできたら後はこの記事の範囲外とします。\u003c/p\u003e\n\n\u003cp\u003eでは早速作っていきましょう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"インタプリタの考え方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%97%E3%83%AA%E3%82%BF%E3%81%AE%E8%80%83%E3%81%88%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eインタプリタの考え方\u003c/h1\u003e\n\n\u003cp\u003eまずインタプリタを作るために、インタプリタが何をしているのかを考えます。\u003cbr\u003e\n今回作るインタプリタは \u003cbr\u003e\n1. 文字列としてスクリプトを受け取り\u003cbr\u003e\n2. スクリプトの評価結果を出力する\u003c/p\u003e\n\n\u003cp\u003eという処理をします。\u003c/p\u003e\n\n\u003cp\u003e問題はこの1と2の間にどのような処理が必要となるかです。\u003cbr\u003e\n「評価結果を出力する」ためには、「スクリプトを評価する」必要があります。\u003cbr\u003e\n「スクリプトを評価する」ためには、「文字列として渡されたスクリプトを評価が可能な形式に変換する」必要があります。\u003cbr\u003e\nそれでは、「文字列として渡されたスクリプトを評価が可能な形式に変換する」ためにはどのような処理が必要なのでしょうか？\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"式を評価する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BC%8F%E3%82%92%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e式を評価する\u003c/h2\u003e\n\n\u003cp\u003eまず、評価が可能な形式とは何かについて考えてみます。\u003cbr\u003e\n今回実行させたいスクリプトを以下のようにするとします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e1+1\n1+1*3\n1*(1-1)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまずは\u003ccode\u003e1+1\u003c/code\u003eに着目します。\u003cbr\u003e\n素直に計算すると結果は\u003ccode\u003e2\u003c/code\u003eですが、これを計算するためにはどのようなプログラムが必要になるかを考えます。\u003cbr\u003e\n\u003ccode\u003eSystem.Console.WriteLine(1 + 1);\u003c/code\u003eとかではないです。数字が変わってもいいような形にする必要があります。\u003cbr\u003e\nまあぶっちゃけるとデザインパターンの1つ、Interpreterパターンを真似ればいいだけなのですが。\u003cbr\u003e\nInterpreterパターンの解説はDRY原則に則り別のサイトにお任せするとして、これそのままズバリな名前してますよね。\u003cbr\u003e\n要はこのような処理を実現するのに適したパターンなのです。\u003c/p\u003e\n\n\u003cp\u003eまずは基底インターフェースとなる\u003ccode\u003eIExpression\u003c/code\u003eを作ります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIExpression\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"nf\"\u003eEvaluate\u003c/span\u003e \u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e唯一のメソッド\u003ccode\u003eEvaluate()\u003c/code\u003eは評価するという意味を持ち、そのExpressionを評価した結果を返します。\u003cbr\u003e\nで、次は数字を表すクラスを作ります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNumberExpression\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIExpression\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003e_num\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eNumberExpression\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003e_num\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"nf\"\u003eEvaluate\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003e_num\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eシンプルですね。コンストラクタで渡されたnumを\u003ccode\u003eEvaluate()\u003c/code\u003eでそのまま返しているだけです。\u003cbr\u003e\nでは次は加算記号を表すクラスを作ります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eOpAddExpression\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIExpression\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIExpression\u003c/span\u003e \u003cspan class=\"n\"\u003e_left\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIExpression\u003c/span\u003e \u003cspan class=\"n\"\u003e_right\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eOpAddExpression\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIExpression\u003c/span\u003e \u003cspan class=\"n\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIExpression\u003c/span\u003e \u003cspan class=\"n\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003e_left\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003e_right\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"nf\"\u003eEvaluate\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003e_left\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEvaluate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003e_right\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEvaluate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eはい。これもシンプルですね。コンストラクタで2つのIExpressionを受け取り、\u003ccode\u003eEvaluate()\u003c/code\u003eではそれらを\u003ccode\u003eEvaluate()\u003c/code\u003eした結果を足し合わせています。\u003cbr\u003e\nこれで加算演算が表せるわけですね。\u003cbr\u003e\nでは、これらのクラスで\u003ccode\u003e1+1\u003c/code\u003eの計算をしてみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eleft\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNumberExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eright\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNumberExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eopAdd\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eOpAddExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eopAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEvaluate\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e \u003cspan class=\"c1\"\u003e// =\u0026gt; \"2\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの\u003ccode\u003eaddOp\u003c/code\u003eというものが\u003ccode\u003e1+1\u003c/code\u003eの評価可能な形であり、このインスタンスの\u003ccode\u003eEvaluate()\u003c/code\u003eを実行することで\u003ccode\u003e1+1\u003c/code\u003eの結果が計算できます。\u003cbr\u003e\nでは次の式に行ってみましょう。\u003c/p\u003e\n\n\u003cp\u003e次は、\u003ccode\u003e1+1*3\u003c/code\u003eです。\u003cbr\u003e\n乗算が出てきましたね。乗算を表すクラスは\u003ccode\u003eOpMulExpression\u003c/code\u003eとしましょう。実装は省略します。\u003cbr\u003e\n\u003ccode\u003e1+1*3\u003c/code\u003eは次のように表せます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eaddLeft\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNumberExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emulLeft\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNumberExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emulRight\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNumberExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eaddRight\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eOpMulExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emulLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emulRight\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eopAdd\u003c/span\u003e    \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eOpAddExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaddLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eaddRight\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eopAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEvaluate\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e \u003cspan class=\"c1\"\u003e// =\u0026gt; \"4\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eはい。ちょっとややこしくなってきましたが、opAddのrightが\u003ccode\u003eOpMulExpression\u003c/code\u003eのインスタンスとなっています。\u003cbr\u003e\n\u003ccode\u003eOpMulExpression\u003c/code\u003eも\u003ccode\u003eIExpression\u003c/code\u003eの実装ですので、\u003ccode\u003eNumberExpression\u003c/code\u003eと同様\u003ccode\u003eOpAddExpression\u003c/code\u003eのコンストラクタに渡すことができます。\u003cbr\u003e\nそして、\u003ccode\u003eOpMulExpression\u003c/code\u003eの\u003ccode\u003eEvaluate()\u003c/code\u003eはleftとrightを乗算した結果を返すので、\u003ccode\u003eopAdd.Evaluate()\u003c/code\u003eは\u003ccode\u003e1+1*3\u003c/code\u003eを計算することになります。\u003c/p\u003e\n\n\u003cp\u003eそれでは最後の式に行ってみましょう。\u003cbr\u003e\n最後は\u003ccode\u003e1*(1-1)\u003c/code\u003eです。\u003cbr\u003e\n減算のクラスは\u003ccode\u003eOpSubExpression\u003c/code\u003eとしましょう。\u003ccode\u003e()\u003c/code\u003eについては新しくクラスを作る必要はありません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emulLeft\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNumberExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esubLeft\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNumberExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esubRight\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNumberExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emulRight\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eOpSubExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esubLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esubRight\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eopMul\u003c/span\u003e    \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eOpMulExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emulLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emulRight\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eopMul\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEvaluate\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e \u003cspan class=\"c1\"\u003e// =\u0026gt; \"0\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのように、\u003ccode\u003e()\u003c/code\u003eはどのような構造でExpressionを作るかによって対応することができます。\u003cbr\u003e\nこれで評価が可能な形式についてはイメージが掴めたと思います。\u003cbr\u003e\nでは、文字列からどのようにしてこの形に変換すればよいのでしょうか？\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"字句解析と構文解析\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AD%97%E5%8F%A5%E8%A7%A3%E6%9E%90%E3%81%A8%E6%A7%8B%E6%96%87%E8%A7%A3%E6%9E%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e字句解析と構文解析\u003c/h2\u003e\n\n\u003cp\u003eIExpressionインターフェースとそれを実装するクラスを使うことで、式をクラスで表現することができました。\u003cbr\u003e\n次の課題は、文字列をIExpressionに変換する処理をどう実現するかということになります。\u003c/p\u003e\n\n\u003cp\u003eこれには明確な解決方法があります。\u003c/p\u003e\n\n\u003cp\u003eこの問題を解決するキーワードは、字句解析と構文解析です。\u003cbr\u003e\nこれらについて、この記事ではざっくりとしたことしか説明しません。\u003cbr\u003e\n詳しい解説はDRY原則に則り別のサイトにお任せすることにします。\u003c/p\u003e\n\n\u003cp\u003e字句解析は文字列をトークン列と呼ばれる物に変換する処理です。\u003cbr\u003e\nざっくりとしたイメージとして、\u003ccode\u003e1+1\u003c/code\u003eという文字列が渡されたら\u003ccode\u003eNUM OP_ADD NUM\u003c/code\u003eというトークン列（この\u003ccode\u003eNUM\u003c/code\u003eと\u003ccode\u003eOP_ADD\u003c/code\u003eがトークン）を返すものと考えてもらってよいです。\u003c/p\u003e\n\n\u003cp\u003e構文解析はこのトークンから文法を読み解く処理です。\u003cbr\u003e\n\u003ccode\u003eNUM OP_ADD NUM\u003c/code\u003eというトークン列を受け取ったら、「これは加算演算である」と判定するようなものです。\u003c/p\u003e\n\n\u003cp\u003eで、構文解析において「これは加算演算である」ということが分かったら、先程の\u003ccode\u003e1+1\u003c/code\u003eの時のように\u003ccode\u003eOpAddExpression\u003c/code\u003eのインスタンスを作れば、スクリプトを評価可能な形に変換できるというわけですね。\u003c/p\u003e\n\n\u003cp\u003eこの字句解析と構文解析ですが、1から全部実装しようとすると大変なので、それぞれツールを使って実装します。\u003cbr\u003e\nどのくらい大変かについてイメージが掴めない方は、この年末年始にでも字句解析と構文解析のアルゴリズムを一通り学んだ上でぜひ一度実装に取り組んでみるといいと思います。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"字句解析機生成ツールre2c\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AD%97%E5%8F%A5%E8%A7%A3%E6%9E%90%E6%A9%9F%E7%94%9F%E6%88%90%E3%83%84%E3%83%BC%E3%83%ABre2c\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e字句解析機生成ツールre2c\u003c/h3\u003e\n\n\u003cp\u003e字句解析するプログラムは\u003ccode\u003ere2c\u003c/code\u003eというツールを使って生成します。\u003cbr\u003e\nインストールは\u003ccode\u003epacman -S re2c\u003c/code\u003eとか\u003ccode\u003ebrew install re2c\u003c/code\u003eとかすればできますが、公式サイトのドキュメントを読んだほうがいいと思います。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://re2c.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ere2c公式サイト\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003ere2c\u003c/code\u003eは本来C/C++向けのツールなのですが、生成コードの内容を設定で変更できるためC#でも使えます。\u003cbr\u003e\n\u003ccode\u003ere2c\u003c/code\u003eが生成するコードは\u003ccode\u003egoto\u003c/code\u003eを多用していますが、C#は\u003ccode\u003egoto\u003c/code\u003eをサポートしているので問題ありません。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"構文解析機生成ツールjay\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A7%8B%E6%96%87%E8%A7%A3%E6%9E%90%E6%A9%9F%E7%94%9F%E6%88%90%E3%83%84%E3%83%BC%E3%83%ABjay\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e構文解析機生成ツールjay\u003c/h3\u003e\n\n\u003cp\u003e構文解析するプログラムは\u003ccode\u003ejay\u003c/code\u003eというツールを使って生成します。\u003cbr\u003e\n\u003ccode\u003ejay\u003c/code\u003eは\u003ccode\u003emono\u003c/code\u003eが使っているC#向けの構文解析機生成ツールで、\u003ccode\u003emono\u003c/code\u003eのgitリポジトリに\u003ccode\u003ejay\u003c/code\u003eのプロジェクトも入っているので、リポジトリをcloneしてプロジェクトをビルドすれば\u003ccode\u003ejay\u003c/code\u003eが使えます。\u003cbr\u003e\n（\u003ccode\u003emake\u003c/code\u003eする場合、事前に\u003ccode\u003emono/mcs/build/platforms/\u003c/code\u003eにある\u003ccode\u003e.make\u003c/code\u003eファイル群から、自分の環境にあったものを\u003ccode\u003e.make\u003c/code\u003eにリネームする必要があります）\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/mono/mono\" rel=\"nofollow noopener\" target=\"_blank\"\u003emonoのリポジトリ\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"構文解析機を作る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A7%8B%E6%96%87%E8%A7%A3%E6%9E%90%E6%A9%9F%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e構文解析機を作る\u003c/h3\u003e\n\n\u003cp\u003eそれではコードを書いていきます。\u003c/p\u003e\n\n\u003cp\u003eまずはjayから使います。\u003cbr\u003e\njayはパーサを生成します。\u003ccode\u003eParser.jay\u003c/code\u003eというファイルを作り次の内容を書き込みます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e%{\nusing System;\nusing SampleLanguage.Expression;\n\nnamespace SampleLanguage.Interpreter\n{\n    public class Parser\n    {\n        private int yacc_verbose_flag = 0;\n\n%}\n\n%token \u0026lt;string\u0026gt; LP\n%token \u0026lt;string\u0026gt; RP\n%token \u0026lt;string\u0026gt; OP_ADD\n%token \u0026lt;string\u0026gt; OP_SUB\n%token \u0026lt;string\u0026gt; OP_MUL\n%token \u0026lt;string\u0026gt; OP_DIV\n%token \u0026lt;string\u0026gt; OP_DIV\n%token \u0026lt;double\u0026gt; NUM\n\n%type \u0026lt;IExpression\u0026gt; Formula\n%type \u0026lt;IExpression\u0026gt; Term\n%type \u0026lt;IExpression\u0026gt; Num\n\n%left LP RP\n%left OP_ADD OP_SUB\n%left OP_MUL OP_DIV\n\n%start Sentence\n\n%%\n\nSentence\n  : Formula\n\nFormula\n  : Term\n  {\n    $$ = $1;\n  }\n  | Formula OP_ADD Term\n  {\n    $$ = new OpAddExpression($1, $3);\n  }\n  | Formula OP_SUB Term\n  {\n    $$ = new OpSubExpression($1, $3);\n  }\n\nTerm\n  : Num\n  {\n    $$ = $1;\n  }\n  | Term OP_MUL Num\n  {\n    $$ = new OpMulExpression($1, $3);\n  }\n  | Term OP_DIV Num\n  {\n    $$ = new OpDivExpression($1, $3);\n  }\n\nNum\n  : NUM\n  {\n    $$ = new NumberExpression($1);\n  }\n  | LP Formula RP\n  {\n    $$ = $2;\n  }\n\n%%\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e書き方はなんとなく分かると思います。\u003cbr\u003e\n使われるトークン、演算子の順序を定義してから、BNF記法チックな書き方で文法を書き連ねていきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eNum\n  : NUM\n  {\n    $$ = new NumberExpression($1);\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e例えば上記のこの部分はNumはNUMであるという定義をしています。\u003cbr\u003e\n波括弧の中ではNUMからNumへ還元する際の処理をC#で書きます。\u003cbr\u003e\n還元という言葉の意味が分からない場合は「文法 還元」あたりで検索するといいと思います。\u003cbr\u003e\n要はNUMをNumへと置き換えることです。\u003cbr\u003e\nここでは、NUMは数値ですので\u003ccode\u003eNumberExpression\u003c/code\u003eをnewしています。\u003cbr\u003e\n\u003ccode\u003e$1\u003c/code\u003eというのはトークンの実際の値です。文法の左端から\u003ccode\u003e$1,$2 ...\u003c/code\u003eという風に参照できます。\u003cbr\u003e\nここでは\u003ccode\u003e$1\u003c/code\u003eはNUMのことであり、NUMは型がdoubleなのでdouble型の値が入ります。\u003cbr\u003e\n\u003ccode\u003e$$\u003c/code\u003eはNumの実際の値となります。なので、Numは値としては\u003ccode\u003eNumberExpression\u003c/code\u003eのインスタンスを持つことになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eTerm\n\n...\n\n| Term OP_MUL Num\n{\n  $$ = new OpMulExpression($1, $3);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eここは乗算処理の文法を定義し、還元の際には\u003ccode\u003eOpMulExpression\u003c/code\u003eを作っています。\u003cbr\u003e\nStatementもNumも\u003ccode\u003eIExpression\u003c/code\u003e型なので、そのまま\u003ccode\u003eOpMulExpression\u003c/code\u003eのコンストラクタに渡せます。\u003c/p\u003e\n\n\u003cp\u003eそれではこの\u003ccode\u003eParser.jay\u003c/code\u003eからC#のファイルを生成します。\u003cbr\u003e\ncloneしてきたmonoから先程ビルドしたjayの実行ファイルと、\u003ccode\u003emono/mcs/jay/skeleton.cs\u003c/code\u003eを\u003ccode\u003eParser.jay\u003c/code\u003eと同じディレクトリにコピーし、そのディレクトリ上でターミナルを開き\u003ccode\u003ejay -c Parser.jay \u0026lt; skeleton.cs \u0026gt; Parser.cs\u003c/code\u003eを実行してください。\u003cbr\u003e\n\u003ccode\u003eParser.cs\u003c/code\u003eが生成されると思います。これが構文解析を行うコードになります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"字句解析機を作る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AD%97%E5%8F%A5%E8%A7%A3%E6%9E%90%E6%A9%9F%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e字句解析機を作る\u003c/h3\u003e\n\n\u003cp\u003e次は\u003ccode\u003ere2c\u003c/code\u003eを使って字句解析機を作ります。\u003cbr\u003e\nプログラムの実行順は字句解析 =\u0026gt; 構文解析ですが、コードを作るのは構文解析機が先になります。\u003cbr\u003e\nなぜなら、字句解析機のインターフェースと構文解析機が返すべきトークンが\u003ccode\u003eParser.cs\u003c/code\u003eにて定義されるからです。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eLexer.re\u003c/code\u003eというファイルを作り内容は次のようにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003enamespace SampleLanguage.Interpreter\n{\n    public class Lexer : yyParser.yyInput\n    {\n        private string _script;\n        private string _value;\n        private int    _index;\n        private int    _token;\n        private int    _cursor;\n        private int    _marker; public Lexer (string script)\n        {\n            _script = script;\n        } public bool advance ()\n        {\n            if ( _script.Length \u0026lt;= _index )\n            {\n                _token = Token.yyErrorCode;\n                _value = \"\";\n                return false;\n            }\n\n            _token = Lex(_index);\n            _value = _script.Substring(_index, (_cursor - _index));\n            _index = _cursor;\n\n            return true;\n        }\n\n        public int token ()\n        {\n            return _token;\n        }\n\n        public object value ()\n        {\n            switch (_token)\n            {\n                case Token.NUM: \n                    return double.Parse(_value);\n\n                default:\n                    return _value;\n            }\n        }\n\n        private int YYPEEK ()\n        {\n            if (_cursor == _script.Length)\n            {\n                return 0;\n            }\n\n            return (int)_script[_cursor];\n        }\n\n        private void YYSKIP ()\n        {\n            _cursor++;\n        }\n\n        private void YYBACKUP ()\n        {\n            _marker = _cursor;\n        }\n\n        private void YYRESTORE()\n        {\n            _cursor = _marker;\n        }\n\n        private int Lex (int startIndex)\n        {\n            _cursor = startIndex;\n            YYBACKUP();\nloop:\n            /*!re2c\n              re2c:define:YYCTYPE = int;\n              re2c:yyfill:enable = 0;\n\n              WSP         = [ \\t\\v\\n\\r];\n              WHITE_SPACE = WSP+;\n\n              OP_ADD      = \"+\";\n              OP_SUB      = \"-\";\n              OP_MUL      = \"*\";\n              OP_DIV      = \"/\";\n              LP          = \"(\";\n              RP          = \")\";\n\n              DIGIT       = [0-9];\n              DIGITNZ     = [1-9];\n              U_INTEGER   = \"0\" | DIGITNZ DIGIT*;\n              DOUBLE      = U_INTEGER \".\" DIGIT+;\n              NUM         = U_INTEGER | DOUBLE;\n\n              WHITE_SPACE   { _index = _cursor; goto loop; }\n              OP_ADD        { return Token.OP_ADD;  }\n              OP_SUB        { return Token.OP_SUB;  }\n              OP_MUL        { return Token.OP_MUL;  }\n              OP_DIV        { return Token.OP_DIV;  }\n              LP            { return Token.LP;  }\n              RP            { return Token.RP;  }\n              NUM           { return Token.NUM;  }\n            */\n        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eキモになるのは\u003ccode\u003e/*!re2c\u003c/code\u003eから始まるコメントの部分です。\u003cbr\u003e\nここで、\u003ccode\u003ere2c\u003c/code\u003eに作ってもらいたい字句解析機を定義します。\u003cbr\u003e\n内容としては、単に正規表現の定義と、正規表現にマッチした際に適切なトークンを返す処理をしているくらいです。\u003cbr\u003e\n\u003ccode\u003eYYPEEK()\u003c/code\u003eとか\u003ccode\u003eYYSKIP()\u003c/code\u003eは\u003ccode\u003ere2c\u003c/code\u003eで生成されるコードのためのメソッドです。\u003cbr\u003e\n\u003ccode\u003eyyParser.yyInput\u003c/code\u003eは\u003ccode\u003eParser.cs\u003c/code\u003eで定義されるインターフェースで、jayで生成した構文解析機を動かすのに必要です。\u003c/p\u003e\n\n\u003cp\u003eそれでは字句解析機のcsファイルも作りましょう。\u003cbr\u003e\n\u003ccode\u003eLexere.re\u003c/code\u003eと同じディレクトリ上でターミナルを開き、\u003ccode\u003ere2c -i --input custom Lexer.re -o Lexer.cs\u003c/code\u003eを実行します。\u003cbr\u003e\n\u003ccode\u003eLexer.cs\u003c/code\u003eが生成されます。\u003cbr\u003e\nこれで、構文解析機と字句解析機ができました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"実際に使ってみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AB%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実際に使ってみる\u003c/h2\u003e\n\n\u003cp\u003eこれで四則演算ができるようになりました。\u003cbr\u003e\n実際にコードを書いて試してみましょう。\u003c/p\u003e\n\n\u003cp\u003eなんでもいいのでクラスを作り、次のメソッドを定義します。\u003cbr\u003e\nここでは\u003ccode\u003eSampleInterpreter\u003c/code\u003eとでもしましょうか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSampleInterpreter\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elexer\u003c/span\u003e       \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eLexer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eparser\u003c/span\u003e      \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eParser\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eexpression\u003c/span\u003e  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eparser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eyyparse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elexer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexpression\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEvaluate\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれが今回の目標としていた「スクリプト（式）を文字列として受け取り、それを評価した結果を出力する」処理を実現するメソッドです。\u003cbr\u003e\nこれをMainメソッドから呼びます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSampleInterpreter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"1+1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// =\u0026gt; \"2\"\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSampleInterpreter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"1+1*3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// =\u0026gt; \"4\"\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSampleInterpreter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"1*(1-1)\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// =\u0026gt; \"0\"\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e実行するとちゃんと計算結果が出力されたと思います。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h1\u003e\n\n\u003cp\u003e無事文字列を解析して四則演算するプログラムが実装できました。\u003cbr\u003e\nプログラミング言語を作る上で最大の鬼門であろうスクリプトの解析がこれでできるようになったので、後はいくらでも拡張ができると思います。\u003cbr\u003e\n次のステップとしては「複数の行に対応」「intやboolなどの型の実装」「関数の実装」「if文の実装」あたりでしょうか。\u003cbr\u003e\nこれらの実装についてはこの記事では扱いません。長くなる上に実現方法はいくらでもあるので。\u003c/p\u003e\n\n\u003cp\u003eいかがでしたでしょうか。\u003cbr\u003e\n皆様もこの機にオレオレ言語を作ってみるのもいいと思います。\u003c/p\u003e\n\n\u003cp\u003eそれではよい年末を。\u003c/p\u003e\n","createdAt":"2017-12-17T17:56:09Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"APFEdji3zjyk8fUr7obQcxmrwXjsAaKV--DZF5W7bXUcjKtB25--UqlRUKSSnSSCnNTPSt9XGw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2019-02-14T04:54:28Z","likesCount":28,"linkUrl":"https://qiita.com/fff-n/items/0192a892436cc69b2006","organization":null,"originalId":590112,"stockedCount":21,"title":"C#でプログラミング言語っぽいものを作ってみる","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AA%E3%81%9Cc%E3%81%A7%E4%BD%9C%E3%82%8B%E3%81%AE%E3%81%8B\"\u003eなぜC#で作るのか\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E4%BD%9C%E3%82%8B%E3%82%82%E3%81%AE\"\u003e今回作るもの\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%97%E3%83%AA%E3%82%BF%E3%81%AE%E8%80%83%E3%81%88%E6%96%B9\"\u003eインタプリタの考え方\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BC%8F%E3%82%92%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B\"\u003e式を評価する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AD%97%E5%8F%A5%E8%A7%A3%E6%9E%90%E3%81%A8%E6%A7%8B%E6%96%87%E8%A7%A3%E6%9E%90\"\u003e字句解析と構文解析\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AD%97%E5%8F%A5%E8%A7%A3%E6%9E%90%E6%A9%9F%E7%94%9F%E6%88%90%E3%83%84%E3%83%BC%E3%83%ABre2c\"\u003e字句解析機生成ツールre2c\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A7%8B%E6%96%87%E8%A7%A3%E6%9E%90%E6%A9%9F%E7%94%9F%E6%88%90%E3%83%84%E3%83%BC%E3%83%ABjay\"\u003e構文解析機生成ツールjay\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A7%8B%E6%96%87%E8%A7%A3%E6%9E%90%E6%A9%9F%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e構文解析機を作る\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AD%97%E5%8F%A5%E8%A7%A3%E6%9E%90%E6%A9%9F%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e字句解析機を作る\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AB%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e実際に使ってみる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003eおわりに\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":7894,"uuid":"0192a892436cc69b2006","banReason":null,"adventCalendarItem":{"day":17,"calendar":{"name":"Akatsuki","urlName":"aktsk","year":2017,"organization":{"logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/077ebe6bfb994e8a881a54e6443fce69b41a385c/original.jpg?1462502511","urlName":"aktsk"}}},"author":{"encryptedId":"6nsWrZBl4bV6znohhxzXFSgM01vB--0gSG4/NYS4JbLJy0--J17ltlfT3l8/0jSxABjhcQ==","originalId":143083,"description":"","facebookUrl":null,"githubUrl":"https://github.com/fff-n","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"Norihiro Funakoshi","profileImageUrl":"https://avatars.githubusercontent.com/u/14069489?v=3","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F14069489%3Fv%3D3?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=8014882a50e363869922976c4de1d615","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F14069489%3Fv%3D3?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=221b55da3469bb9c270d5b3707b577c6","urlName":"fff-n","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[{"node":{"encryptedId":"V51BGZOD0U9XbQvuDd6NsPTRBfKhM0iG6tE=--Ce6IY87ErJrIksP8--c9IJ2/kwBUysNHU2aCe2tw==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"株式会社アカツキ","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/077ebe6bfb994e8a881a54e6443fce69b41a385c/original.jpg?1462502511","urlName":"aktsk","description":"株式会社アカツキは、スマートフォンゲームの企画開発を中心に事業を展開しております。創業以来全てのゲームを内製しているため、高い技術ノウハウが蓄積されています。今後は、新規事業の立ち上げも行ってまいります。","url":"http://aktsk.jp/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"構文解析","urlName":"%e6%a7%8b%e6%96%87%e8%a7%a3%e6%9e%90"},{"name":"字句解析","urlName":"%e5%ad%97%e5%8f%a5%e8%a7%a3%e6%9e%90"},{"name":"プログラミング言語入門","urlName":"%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e%e5%85%a5%e9%96%80"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

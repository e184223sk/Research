<!DOCTYPE html><html><head><meta charset="utf-8" /><title>ClovaとLINE Botの一味違う２つの連携手法～タイミング同期＆無限セッション～ - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/himarin269/items/675c6619bfb32acfd9c3" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="Olr78CZn2LKUIAvudJLvvWlFyctdYagYBn4TlYregxQ1ThtneeKcO0fHmq1XYqCQgkeOaBag2tW5lcCqbu3tHA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="ClovaとLINE Botの一味違う２つの連携手法～タイミング同期＆無限セッション～ - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1RMnh2ZG1IamdhaE1TVTVGSUVKdmRPT0JydVM0Z09XUnMtbUJsZU9CaHUtOGt1T0JwT09CcnVtQW8tYVF1dWFKaS1hemxlLTludU9Ddi1PQ3BPT0RuLU9Ecy1PQ3NPV1FqT2Fjbi0tOGh1ZUVvZW1aa09PQ3UtT0RnLU9DdC1PRHAtT0RzLS05bmcmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NDFjZTkyNDExZTFhZDlhNTUzNGIzZWQ3OWUyMDYyZGQ&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR2hwYldGeWFXNHlOamsmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz03NDA4NjVkZjk3YjZmYjA1N2MyMzlkMTE2MTQwODRmZQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=1edb753a991a0a54f797efba5802d726"><meta property="og:description" content="

はじめに

本記事は LINEBot&amp;amp;Clova Advent Calendar 2018 の23日目の記事です。

Clovaの特徴であり最大のメリットは、LINE Botとの連携ですね。
ClovaとLINE Botで..."><meta content="https://qiita.com/himarin269/items/675c6619bfb32acfd9c3" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,linebot,Clova,vui" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-34f28317-151d-4098-a0ae-c6ccb8c76c5d"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fhimarin269%2Fitems%2F675c6619bfb32acfd9c3">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fhimarin269%2Fitems%2F675c6619bfb32acfd9c3">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-34f28317-151d-4098-a0ae-c6ccb8c76c5d">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-12-23T10:46:09.000+09:00","dateModified":"2018-12-24T12:34:27.000+09:00","headline":"ClovaとLINE Botの一味違う２つの連携手法～タイミング同期＆無限セッション～","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1RMnh2ZG1IamdhaE1TVTVGSUVKdmRPT0JydVM0Z09XUnMtbUJsZU9CaHUtOGt1T0JwT09CcnVtQW8tYVF1dWFKaS1hemxlLTludU9Ddi1PQ3BPT0RuLU9Ecy1PQ3NPV1FqT2Fjbi0tOGh1ZUVvZW1aa09PQ3UtT0RnLU9DdC1PRHAtT0RzLS05bmcmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NDFjZTkyNDExZTFhZDlhNTUzNGIzZWQ3OWUyMDYyZGQ\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR2hwYldGeWFXNHlOamsmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz03NDA4NjVkZjk3YjZmYjA1N2MyMzlkMTE2MTQwODRmZQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=1edb753a991a0a54f797efba5802d726","mainEntityOfPage":"https://qiita.com/himarin269/items/675c6619bfb32acfd9c3","author":{"@type":"Person","address":"","email":null,"identifier":"himarin269","name":"himarin269","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F194664%2Fprofile-images%2F1552263738?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=b11808da71429a4e19aca7000eba4cdd","url":"https://qiita.com/himarin269","description":"開発や研修・講座講師などをしています。C#/Azure/LINE API/スマートスピーカーなど。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202104-ga-technologies/?utm_source=qiita&amp;utm_medium=header-banner">社内改善＝業界革新。GA technologiesの一石三鳥な社内プロダクト開発とは</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202104-ga-technologies/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"himarin269","type":"items","id":"675c6619bfb32acfd9c3"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"社内改善＝業界革新。GA technologiesの一石三鳥な社内プロダクト開発とは","url":"https://zine.qiita.com/interview/202104-ga-technologies/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"himarin269","type":"items","id":"675c6619bfb32acfd9c3"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"社内改善＝業界革新。GA technologiesの一石三鳥な社内プロダクト開発とは","url":"https://zine.qiita.com/interview/202104-ga-technologies/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"himarin269","type":"items","id":"675c6619bfb32acfd9c3"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"社内改善＝業界革新。GA technologiesの一石三鳥な社内プロダクト開発とは","url":"https://zine.qiita.com/interview/202104-ga-technologies/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/himarin269/items/675c6619bfb32acfd9c3","location":"/himarin269/items/675c6619bfb32acfd9c3","scheme":"https","host":"qiita.com","port":null,"pathname":"/himarin269/items/675c6619bfb32acfd9c3","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"cXOwRYmiF9mAlNvggWaulGOtuxHhWxNm/gRoVdvfVGZ+Z1DS1idTUFNzSqOiluG5iK/8sqqaYatB77tqP+w6bg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-caf74430-3324-42e3-80ff-28efe1856545"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/himarin269/items/675c6619bfb32acfd9c3/likers" class="css-1iupg5d">11</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">2</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/675c6619bfb32acfd9c3/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/himarin269/items/675c6619bfb32acfd9c3/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/himarin269/items/675c6619bfb32acfd9c3/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/himarin269/items/675c6619bfb32acfd9c3/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/himarin269/items/675c6619bfb32acfd9c3.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><span><a href="/advent-calendar/2018/linebot" class="it-AdcalRibbon_title">LINEBot&amp;Clova<!-- --> Advent Calendar<!-- --> <!-- -->2018</a>Day 23</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/himarin269"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/194664/profile-images/1552263738" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/himarin269" class="css-10ougpm">@<!-- -->himarin269</a><div class="css-1ay9vb9"><span><meta content="2018-12-23T01:46:09Z"/><time dateTime="2018-12-24T03:34:27Z" class="css-m19uds">updated at 2018-12-24</time></span></div></div></div></div></div><h1 class="css-cgzq40">ClovaとLINE Botの一味違う２つの連携手法～タイミング同期＆無限セッション～</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/linebot" class="css-4czcte">linebot</a><a href="/tags/clova" class="css-4czcte">Clova</a><a href="/tags/vui" class="css-4czcte">vui</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>本記事は <a href="https://qiita.com/advent-calendar/2018/linebot">LINEBot&amp;Clova Advent Calendar 2018</a> の23日目の記事です。</p>

<p>Clovaの特徴であり最大のメリットは、LINE Botとの連携ですね。<br>
ClovaとLINE Botでは、それぞれ同一のLINEアカウントであれば同一のユーザーIDを使うので、簡単に連携したサービスを作ることができます。<br>
しかし、ClovaのAPIの使い方を工夫することで、ClovaとLINE Botを一味違ったレベルで連携させることができます。<br>
この記事では、単純なデータのやりとりにとどまらない、Clovaの音声とBotの連動方法を２つ、実際の活用例をもとにご紹介します。</p>

<h2>
<span id="本記事で紹介すること" class="fragment"></span><a href="#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%81%A7%E7%B4%B9%E4%BB%8B%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>本記事で紹介すること</h2>

<p>ClovaとLINE Botを「音声」の観点で連動させる、以下の２つの手法です。</p>

<h3>
<span id="-clova音声とlineメッセージ送信のタイミング同期" class="fragment"></span><a href="#-clova%E9%9F%B3%E5%A3%B0%E3%81%A8line%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E9%80%81%E4%BF%A1%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E5%90%8C%E6%9C%9F"><i class="fa fa-link"></i></a>① Clova音声とLINEメッセージ送信の「タイミング同期」</h3>

<p>これは、 <strong>Clovaから連続して再生される複数の音声に合わせて、LINEに対してメッセージを送信する</strong> というものです。<br>
Clovaから再生される音声や音楽に合わせて、タイミングよくLINEにメッセージを送ることができます。</p>

<h3>
<span id="-clovaスキルを一時停止させlineからの操作待ち状態を継続させる無限セッション" class="fragment"></span><a href="#-clova%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E4%B8%80%E6%99%82%E5%81%9C%E6%AD%A2%E3%81%95%E3%81%9Bline%E3%81%8B%E3%82%89%E3%81%AE%E6%93%8D%E4%BD%9C%E5%BE%85%E3%81%A1%E7%8A%B6%E6%85%8B%E3%82%92%E7%B6%99%E7%B6%9A%E3%81%95%E3%81%9B%E3%82%8B%E7%84%A1%E9%99%90%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>② Clovaスキルを一時停止させLINEからの操作待ち状態を継続させる「無限セッション」</h3>

<p>スマートスピーカースキルとしては斬新かつ裏技的な手法なのではないかと思いますが、これは <strong>Clovaスキル起動中に一時停止を行い、LINEからClovaスキルに対してさまざまな入力・指示を行う機能を提供する</strong> ということができるというものです。<br>
これを使うと、「ユーザーとの対話の中で音声アシスタントはいつまでもユーザーの発話を待ってくれない」というVUIの常識を覆す、スキルの <strong>無限セッション</strong> を得ることができます。</p>

<h2>
<span id="実装例と前提" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E4%BE%8B%E3%81%A8%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>実装例と前提</h2>

<p>「Clova＆LINEで絵本読み聞かせ」のスキルを実装例とします。<br>
こちらはLINE BOOT AWARDS 2018にエントリーしファイナルまで進んだものです。<br>
この作品づくりの中で使った手法なので、これをそのまま例に解説させてください。</p>

<p>参考：<a href="https://www.line-community.me/awards/workdetail/5bb572e04016908c8d8ea020" rel="nofollow noopener" target="_blank">作品紹介</a> ＆ <a href="https://qiita.com/himarin269/private/e707cf68bd07452610b9">技術解説</a></p>

<p>今回紹介する手法では、ClovaのAPIのうち、mp3のオーディオ再生を指示する機能である「<a href="https://clova-developers.line.biz/guide/CEK/Guides/Build_Custom_Extension.md#ProvideAudioContent" rel="nofollow noopener" target="_blank">AudioPlayer</a>」を使います。<br>
この機能は音楽や録音済みの音声などを再生させるほか、各種text-to-speechのAPIを使ってmp3ファイルを合成することで、テキストの読み上げを行うこともできます。<br>
※上記スキルでは<a href="https://www.ai-j.jp/cloud/webapi/" rel="nofollow noopener" target="_blank">AITalk WebAPI</a>を使いました</p>

<h2>
<span id="詳細解説clova音声とlineメッセージ送信のタイミング同期" class="fragment"></span><a href="#%E8%A9%B3%E7%B4%B0%E8%A7%A3%E8%AA%ACclova%E9%9F%B3%E5%A3%B0%E3%81%A8line%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E9%80%81%E4%BF%A1%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E5%90%8C%E6%9C%9F"><i class="fa fa-link"></i></a>詳細解説①：Clova音声とLINEメッセージ送信の「タイミング同期」</h2>

<h3>
<span id="実装例" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E4%BE%8B"><i class="fa fa-link"></i></a>実装例</h3>

<p>まずは実装例です。<br>
※動画です。クリックするとYouTubeに飛びます<br>
<a href="https://www.youtube.com/watch?v=m7r-yhAgOAc" rel="nofollow noopener" target="_blank"><img src="https://qiita-user-contents.imgix.net/http%3A%2F%2Fimg.youtube.com%2Fvi%2Fm7r-yhAgOAc%2F0.jpg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1f3a66fbdd9d7f1ad9bcc704f660c6ad" alt="実装例①" data-canonical-src="http://img.youtube.com/vi/m7r-yhAgOAc/0.jpg" srcset="https://qiita-user-contents.imgix.net/http%3A%2F%2Fimg.youtube.com%2Fvi%2Fm7r-yhAgOAc%2F0.jpg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=31cc5d795752b004f8282574ab96913a 1x" loading="lazy"></a></p>

<h3>
<span id="解説" class="fragment"></span><a href="#%E8%A7%A3%E8%AA%AC"><i class="fa fa-link"></i></a>解説</h3>

<p>Clovaから読み上げられる音声に合わせ、タイミングよくLINE Botへメッセージ（ここではイメージマップ）が送られてきます。</p>

<p>音声は、AudioPlayerの機能を使っているのですが（テキストをmp3に合成したものを再生している）、Clovaではオーディオ再生時に様々なイベントを通知してくれます。</p>

<ul>
<li><a href="https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#PlayStarted" rel="nofollow noopener" target="_blank">AudioPlayer.PlayStartedイベント</a></li>
<li><a href="https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#PlayPaused" rel="nofollow noopener" target="_blank">AudioPlayer.PlayPausedイベント</a></li>
<li><a href="https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#PlayResumed" rel="nofollow noopener" target="_blank">AudioPlayer.PlayResumedイベント</a></li>
<li><a href="https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#PlayStopped" rel="nofollow noopener" target="_blank">AudioPlayer.PlayStoppedイベント</a></li>
<li><a href="https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#PlayFinished" rel="nofollow noopener" target="_blank">AudioPlayer.PlayFinishedイベント</a></li>
</ul>

<p>このうち、 <code>AudioPlayer.PlayFinished</code> イベントが鍵になります。</p>

<p>仕組みはこうです。</p>

<p><a href="https://camo.qiitausercontent.com/fb9649e8a54fa0742d6a7011efadb2d30b810b50/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3139343636342f39343139383138642d306435322d373664372d333266392d3335626631356534663935362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F194664%2F9419818d-0d52-76d7-32f9-35bf15e4f956.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d8e59b4d9dc2aabf556cab35e9c48555" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/194664/9419818d-0d52-76d7-32f9-35bf15e4f956.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F194664%2F9419818d-0d52-76d7-32f9-35bf15e4f956.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=729fa63a36e5b9e7bcb185f308c17e02 1x" loading="lazy"></a></p>

<p>オーディオファイルの再生がClova側で終了すると、 <code>AudioPlayer.PlayFinished</code> イベントが <code>EventRequest</code> としてサーバーに送信されるので、そのタイミングで次のオーディオ再生指示をClovaへのレスポンスとして返し、それと同時に連携しているLINE BotでClovaスキルを使用中のユーザー宛にPushメッセージを送ります。</p>

<h3>
<span id="応用例" class="fragment"></span><a href="#%E5%BF%9C%E7%94%A8%E4%BE%8B"><i class="fa fa-link"></i></a>応用例</h3>

<p>また、終了時以外にも、</p>

<ul>
<li>
<a href="https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#ProgressReportDelayPassed" rel="nofollow noopener" target="_blank">AudioPlayer.ProgressReportDelayPassedイベント</a>：再生が開始してから特定の時間が経過した後、再生の進行状況をレポートする</li>
<li>
<a href="https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#ProgressReportPositionPassed" rel="nofollow noopener" target="_blank">AudioPlayer.ProgressReportPositionPassedイベント</a>：オーディオコンテンツの特定の位置(オフセット)を再生するときに、進行状況をレポートする</li>
<li>
<a href="https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#ProgressReportIntervalPassed" rel="nofollow noopener" target="_blank">AudioPlayer.ProgressReportIntervalPassedイベント</a>：再生中の場合、特定の間隔で繰り返し進行状況をレポートする</li>
</ul>

<p>といったイベントが用意されているので、これらを利用し、長めのオーディオファイルの任意のタイミングでPushメッセージを出すといった応用も可能なので、いろいろな活用例が考えられます。</p>

<p>特に <code>AudioPlayer.ProgressReportIntervalPassed</code> を利用すると、短い間隔でイベントを受け取るようにすれば、その中に含まれる現在の再生位置情報（<code>offsetInMilliseconds</code>）をもとにかなり細かい精度でオーディオ再生位置に合わせたPushメッセージを送ることができるので、たとえばアイディアの一例として</p>

<ul>
<li>演奏に合わせて歌詞が送られるカラオケスキル</li>
<li>英語スピーチに合わせて字幕や単語訳が送られる英語学習スキル</li>
</ul>

<p>などが実現できるかと思います。</p>

<p>ただし、この手法はLINE Bot（Messaging API）の <code>Push API</code> を前提とするので、友だち50人限定・お試し用の「Developer Trial」プランか月32,400円の「プロ(API)」でしか使えない点で注意が必要です。</p>

<h2>
<span id="詳細解説clovaスキルを一時停止させlineからの操作待ち状態を継続させる無限セッション" class="fragment"></span><a href="#%E8%A9%B3%E7%B4%B0%E8%A7%A3%E8%AA%ACclova%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E4%B8%80%E6%99%82%E5%81%9C%E6%AD%A2%E3%81%95%E3%81%9Bline%E3%81%8B%E3%82%89%E3%81%AE%E6%93%8D%E4%BD%9C%E5%BE%85%E3%81%A1%E7%8A%B6%E6%85%8B%E3%82%92%E7%B6%99%E7%B6%9A%E3%81%95%E3%81%9B%E3%82%8B%E7%84%A1%E9%99%90%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>詳細解説②：Clovaスキルを一時停止させLINEからの操作待ち状態を継続させる「無限セッション」</h2>

<p>続いて２つめです。こちらもまずは実装例の動画から。<br>
<a href="https://www.youtube.com/watch?v=Q_kaIyEdBW8" rel="nofollow noopener" target="_blank"><img src="https://qiita-user-contents.imgix.net/http%3A%2F%2Fimg.youtube.com%2Fvi%2FQ_kaIyEdBW8%2F0.jpg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=19ceb83665ca70b35faa885ed29621d0" alt="実装例②" data-canonical-src="http://img.youtube.com/vi/Q_kaIyEdBW8/0.jpg" srcset="https://qiita-user-contents.imgix.net/http%3A%2F%2Fimg.youtube.com%2Fvi%2FQ_kaIyEdBW8%2F0.jpg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3e1f6195a5de96c6ea15eacd4c42f854 1x" loading="lazy"></a></p>

<h2>
<span id="解説-1" class="fragment"></span><a href="#%E8%A7%A3%E8%AA%AC-1"><i class="fa fa-link"></i></a>解説</h2>

<p>こちらも、さきほどの手法と同様に <code>AudioPlayer.PlayFinished</code> イベントを利用しています。<br>
無限セッションを得るためにごく短い長さの“無音のmp3ファイル”を利用しています。<br>
無限ループさせるかどうかの値をサーバー（DBなど）に持たせておき、それがtrueである間、「PlayFinishedのEventRequest」「無音mp3の再生」を連続で行わせます。</p>

<p><a href="https://camo.qiitausercontent.com/c14959845920724eebf5de52587e95d8de12b931/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3139343636342f39383838326633652d393661352d333833322d323331632d3665353736333265643632612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F194664%2F98882f3e-96a5-3832-231c-6e57632ed62a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1270433a782eac2fec609938967acfc6" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/194664/98882f3e-96a5-3832-231c-6e57632ed62a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F194664%2F98882f3e-96a5-3832-231c-6e57632ed62a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d2ec23fa1f01c6912cb75e6668cdbc6b 1x" loading="lazy"></a></p>

<p>これにより、Clovaスキルを待機状態にし、理論上無限のセッションを得ることができます。</p>

<p>無音無限ループによる「無限セッション」を作り出すことで、「絵本読み聞かせ」で行ったように一時停止・再開の機能を提供したりすることができるほか（再開指示でフラグをfalseに変えてあげればいいだけ）、ユーザーにLINE Botから複雑で時間のかかる入力を行わせることができるようにもなります（フラグをfalseにしつつ入力データの登録処理も実行）。<br>
もちろん、無限セッションといえど音声でClovaに指示をすることもできるので、音声のみでスキルを終了させることもできます（逆にいえば、実際にこれを使ったスキルを作成する場合は無限ループ中にスキルを終了された際の考慮も必要ということになります）。</p>

<h3>
<span id="応用例-1" class="fragment"></span><a href="#%E5%BF%9C%E7%94%A8%E4%BE%8B-1"><i class="fa fa-link"></i></a>応用例</h3>

<p>たとえば「絵本読み聞かせ」スキルへの応用で、たとえば、「ウォーリーをさがせ！」のようなこともできます。<br>
「ウォーリーを探してね」という音声とともにイメージマップでLINEに画像を送り、無音無限ループの無限セッションに入ります。</p>

<p>ユーザーはイメージマップの中から探すべきウォーリーの部分を探すための時間が与えられ、見つけたら該当箇所をタップ、あらかじめその位置に設定しておいたタップイベントで正誤判定を行います。<br>
また、無限ループとせず無音mp3の最大再生回数を決めておけば、解答までの制限時間を設けることもできます。<br>
ちなみに「絵本読み聞かせ」スキルですが、現在開発中の公開版ではこんな感じの「仕掛け絵本」が楽しめるような機能をつけていく予定です（アワードに出したものは一時停止＆再開のためにしかにこれは使ってません）。</p>

<h2>
<span id="サンプルコード" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>サンプルコード</h2>

<p>手法に関する説明は以上です。<br>
Azure Functions＋C#での実装となりますが、「Clova＆LINEで絵本読み聞かせ」のLINE BOOT AWARDS 2018バージョンのコードはGitHubですべて公開しています。<br>
<a href="https://github.com/himanago/ClovaLinePictureBookLineBootAwards2018ver" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/himanago/ClovaLinePictureBookLineBootAwards2018ver</a></p>

<p>本記事に関係あるのは主に <a href="https://github.com/himanago/ClovaLinePictureBookLineBootAwards2018ver/blob/master/ClovaLinePictureBookLineBootAwards2018ver/ClovaExtensionFunction.cs" rel="nofollow noopener" target="_blank">ClovaExtensionFunction.cs</a> です。<br>
<code>AudioPlayer.PlayFinished</code> イベントの処理で、一時停止フラグ（DBの値）をもとに ①次の再生＋Push / ②無音無限ループ を分岐させています。<br>
なお、<a href="https://github.com/kenakamu/clova-cek-sdk-csharp" rel="nofollow noopener" target="_blank">ClovaのC# SDK（コミュニティ製）</a>はオーディオ関連の機能に対応していなかったため、この部分は直接JSONを解析して処理しています。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">ClovaExtensionFunction.cs（抜粋）</span></div>
<div class="highlight"><pre><code><span class="c1">// オーディオイベントの制御</span>
<span class="c1">// Clovaでのオーディオ再生が終わった際に呼び出される</span>
<span class="k">if</span> <span class="p">(</span><span class="n">reqObj</span><span class="p">[</span><span class="s">"event"</span><span class="p">][</span><span class="s">"namespace"</span><span class="p">].</span><span class="n">Value</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;()</span> <span class="p">==</span> <span class="s">"AudioPlayer"</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">userId</span> <span class="p">=</span> <span class="n">reqJson</span><span class="p">[</span><span class="s">"session"</span><span class="p">][</span><span class="s">"user"</span><span class="p">][</span><span class="s">"userId"</span><span class="p">].</span><span class="n">Value</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
    <span class="kt">var</span> <span class="n">beforeId</span> <span class="p">=</span> <span class="n">reqObj</span><span class="p">[</span><span class="s">"event"</span><span class="p">][</span><span class="s">"payload"</span><span class="p">][</span><span class="s">"token"</span><span class="p">].</span><span class="n">Value</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
    <span class="kt">var</span> <span class="n">eventName</span> <span class="p">=</span> <span class="n">reqObj</span><span class="p">[</span><span class="s">"event"</span><span class="p">][</span><span class="s">"name"</span><span class="p">].</span><span class="n">Value</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
    <span class="kt">var</span> <span class="n">cache</span> <span class="p">=</span> <span class="k">await</span> <span class="n">PlayStatusService</span><span class="p">.</span><span class="nf">FindCacheAsync</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">eventName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">case</span> <span class="s">"PlayFinished"</span><span class="p">:</span>
            <span class="c1">// LINE Botのメニューから停止要求がされていれば呼び出さない</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cache</span><span class="p">?.</span><span class="n">StopRequest</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">cache</span><span class="p">.</span><span class="n">StopRequest</span><span class="p">.</span><span class="n">IsStopped</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// DBに存在する停止レコードに、直近の再生済みオーディオのIDを更新する</span>
                <span class="n">cache</span><span class="p">.</span><span class="n">StopRequest</span><span class="p">.</span><span class="n">BeforId</span> <span class="p">=</span> <span class="n">beforeId</span><span class="p">;</span>
                <span class="n">cache</span><span class="p">.</span><span class="n">StopRequest</span><span class="p">.</span><span class="n">IsPaused</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                <span class="k">await</span> <span class="n">PlayStatusService</span><span class="p">.</span><span class="nf">SaveAsync</span><span class="p">(</span><span class="n">cache</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cache</span><span class="p">?.</span><span class="n">StopRequest</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">cache</span><span class="p">.</span><span class="n">StopRequest</span><span class="p">.</span><span class="n">IsPaused</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// 一時停止状態の場合は無音を流す（無限ループ）</span>
                <span class="n">response</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="n">Directives</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nf">GetAudioResponseDirective</span><span class="p">(</span><span class="n">beforeId</span><span class="p">,</span> <span class="s">"一時停止中"</span><span class="p">,</span> <span class="n">Consts</span><span class="p">.</span><span class="n">SilentAudioFileUrl</span><span class="p">));</span>
                <span class="n">response</span><span class="p">.</span><span class="n">ShouldEndSession</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="c1">// キャッシュ削除</span>
                <span class="k">await</span> <span class="n">PlayStatusService</span><span class="p">.</span><span class="nf">DeleteAsync</span><span class="p">(</span><span class="n">cache</span><span class="p">);</span>

                <span class="c1">// 次のオーディオ再生（画像送付があればそれも）を実施</span>
                <span class="k">await</span> <span class="nf">AddAudioPlayAndPushPictureAsync</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">userId</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">beforeId</span><span class="p">,</span> <span class="n">log</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="s">"PlayPaused"</span><span class="p">:</span>
            <span class="c1">// 再生中断された場合</span>
            <span class="n">cache</span><span class="p">.</span><span class="n">StopRequest</span><span class="p">.</span><span class="n">IsStopped</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="k">await</span> <span class="n">PlayStatusService</span><span class="p">.</span><span class="nf">SaveAsync</span><span class="p">(</span><span class="n">cache</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="s">"PlayStarted"</span><span class="p">:</span>
            <span class="c1">// 再生開始OK：DBに記録</span>
            <span class="c1">// 再生開始時はStopped=falseで登録</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cache</span><span class="p">?.</span><span class="n">StopRequest</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">await</span> <span class="n">PlayStatusService</span><span class="p">.</span><span class="nf">AddCacheAsync</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span> <span class="n">beforeId</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">cache</span><span class="p">.</span><span class="n">StopRequest</span><span class="p">.</span><span class="n">BeforId</span> <span class="p">=</span> <span class="n">beforeId</span><span class="p">;</span>
                <span class="k">await</span> <span class="n">PlayStatusService</span><span class="p">.</span><span class="nf">SaveAsync</span><span class="p">(</span><span class="n">cache</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h2>

<p>今回は、LINE BOOT AWARDS 2018での開発を通して確立したAPI応用方法を紹介させていただきました。<br>
「絵本読み聞かせ」も、アワード向けのものから大幅リニューアルしてストア公開を目指すことにしました。<br>
アワード向けに開発した「絵本読み聞かせ」では、自動で再生させる音声にあわせてメッセージを送る＋好きなタイミングで一時停止・再開というかたちで、自分のペースで絵本の読み聞かせを楽しむことができる機能を提供しましたが、Push APIを前提とする実装方法であったため、個人開発して一般公開するにはハードルが高くなってしまいました。</p>

<p>そこで無音無限ループの無限セッションを利用し、絵本のページ送りをBotから手動で操作するようにすることで、Reply APIのみでほぼ同様の機能を実現できるよう考えています（LINE Botからの次ページ要求操作に対する返信として絵を送るようにすればフリープラン内で実装可能）。</p>

<p>とはいえ、そこまでいくと一見「音声で操作する」というスマートスピーカーの特徴・存在意義を放棄しているかのようにも思えてしまいます。<br>
「VUI」ではなく「GUI」での操作であり、それならば同様のゲームや読み上げをアプリとして提供し、わざわざスマートスピーカーを使わせずスマートフォン/タブレットのみで完結すべきと考えることもできるでしょう。<br>
しかし、普通のスマートスピーカーではなく、顔のついたスマートスピーカーである「Clova Friends」や「Clova Friends mini」を持つClovaなら、こういったスキルの提供も意味を持つのではないか？と考えています。<br>
あえて音声による案内を流すのをスマートフォン/タブレットから切り離し、ブラウンやサリーなどのかわいらしいキャラクターをかたどったデバイスが話してくれることで、まるでそのキャラクターとともに遊んでいるような体験を得られるはずです。<br>
先に述べた仕掛け絵本のような機能とともに、Clova/スマートスピーカーでしか実現できないようなスキルといえるようなものを目指して設計・開発を進めていきたいと思っています。<br>
VUIやスマートスピーカーはまだ新しい技術なので、もしその中でまた新しい手法が見つけられたら、どんどん共有していきたいと思います。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fhimarin269%2Fitems%2F675c6619bfb32acfd9c3&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fhimarin269%2Fitems%2F675c6619bfb32acfd9c3&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/himarin269/items/675c6619bfb32acfd9c3/likers" class="css-1iupg5d">11</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">2</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/675c6619bfb32acfd9c3/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/himarin269/items/675c6619bfb32acfd9c3/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/himarin269/items/675c6619bfb32acfd9c3/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/himarin269/items/675c6619bfb32acfd9c3/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/himarin269/items/675c6619bfb32acfd9c3.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-caf74430-3324-42e3-80ff-28efe1856545">{"authorAnalyticsTrackingId":"UA-105733242-2","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-9f02976f-ad95-4813-958a-63fcb08a7f52"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-9f02976f-ad95-4813-958a-63fcb08a7f52">{}</script>
      
<div id="LoginModal-react-component-ddaf33ce-6d04-4fdc-90ea-e7b159b747ae"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-ddaf33ce-6d04-4fdc-90ea-e7b159b747ae">{}</script>
      
<div id="StockModal-react-component-f109b189-7253-4cff-bafb-2139d0e68805"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-f109b189-7253-4cff-bafb-2139d0e68805">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;oUVs9CN9gITk89+4rmYgL4w8t9pMz9B5MnvWYLUbDLOuUYxjfPjEDTcUTvuNlm8CZz7weQcOorSNkAVfUShiuw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch2\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h2\u003e\n\n\u003cp\u003e本記事は \u003ca href=\"https://qiita.com/advent-calendar/2018/linebot\"\u003eLINEBot\u0026amp;Clova Advent Calendar 2018\u003c/a\u003e の23日目の記事です。\u003c/p\u003e\n\n\u003cp\u003eClovaの特徴であり最大のメリットは、LINE Botとの連携ですね。\u003cbr\u003e\nClovaとLINE Botでは、それぞれ同一のLINEアカウントであれば同一のユーザーIDを使うので、簡単に連携したサービスを作ることができます。\u003cbr\u003e\nしかし、ClovaのAPIの使い方を工夫することで、ClovaとLINE Botを一味違ったレベルで連携させることができます。\u003cbr\u003e\nこの記事では、単純なデータのやりとりにとどまらない、Clovaの音声とBotの連動方法を２つ、実際の活用例をもとにご紹介します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"本記事で紹介すること\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%81%A7%E7%B4%B9%E4%BB%8B%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e本記事で紹介すること\u003c/h2\u003e\n\n\u003cp\u003eClovaとLINE Botを「音声」の観点で連動させる、以下の２つの手法です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"-clova音声とlineメッセージ送信のタイミング同期\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-clova%E9%9F%B3%E5%A3%B0%E3%81%A8line%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E9%80%81%E4%BF%A1%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E5%90%8C%E6%9C%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e① Clova音声とLINEメッセージ送信の「タイミング同期」\u003c/h3\u003e\n\n\u003cp\u003eこれは、 \u003cstrong\u003eClovaから連続して再生される複数の音声に合わせて、LINEに対してメッセージを送信する\u003c/strong\u003e というものです。\u003cbr\u003e\nClovaから再生される音声や音楽に合わせて、タイミングよくLINEにメッセージを送ることができます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"-clovaスキルを一時停止させlineからの操作待ち状態を継続させる無限セッション\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-clova%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E4%B8%80%E6%99%82%E5%81%9C%E6%AD%A2%E3%81%95%E3%81%9Bline%E3%81%8B%E3%82%89%E3%81%AE%E6%93%8D%E4%BD%9C%E5%BE%85%E3%81%A1%E7%8A%B6%E6%85%8B%E3%82%92%E7%B6%99%E7%B6%9A%E3%81%95%E3%81%9B%E3%82%8B%E7%84%A1%E9%99%90%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e② Clovaスキルを一時停止させLINEからの操作待ち状態を継続させる「無限セッション」\u003c/h3\u003e\n\n\u003cp\u003eスマートスピーカースキルとしては斬新かつ裏技的な手法なのではないかと思いますが、これは \u003cstrong\u003eClovaスキル起動中に一時停止を行い、LINEからClovaスキルに対してさまざまな入力・指示を行う機能を提供する\u003c/strong\u003e ということができるというものです。\u003cbr\u003e\nこれを使うと、「ユーザーとの対話の中で音声アシスタントはいつまでもユーザーの発話を待ってくれない」というVUIの常識を覆す、スキルの \u003cstrong\u003e無限セッション\u003c/strong\u003e を得ることができます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"実装例と前提\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85%E4%BE%8B%E3%81%A8%E5%89%8D%E6%8F%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装例と前提\u003c/h2\u003e\n\n\u003cp\u003e「Clova＆LINEで絵本読み聞かせ」のスキルを実装例とします。\u003cbr\u003e\nこちらはLINE BOOT AWARDS 2018にエントリーしファイナルまで進んだものです。\u003cbr\u003e\nこの作品づくりの中で使った手法なので、これをそのまま例に解説させてください。\u003c/p\u003e\n\n\u003cp\u003e参考：\u003ca href=\"https://www.line-community.me/awards/workdetail/5bb572e04016908c8d8ea020\" rel=\"nofollow noopener\" target=\"_blank\"\u003e作品紹介\u003c/a\u003e ＆ \u003ca href=\"https://qiita.com/himarin269/private/e707cf68bd07452610b9\"\u003e技術解説\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e今回紹介する手法では、ClovaのAPIのうち、mp3のオーディオ再生を指示する機能である「\u003ca href=\"https://clova-developers.line.biz/guide/CEK/Guides/Build_Custom_Extension.md#ProvideAudioContent\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAudioPlayer\u003c/a\u003e」を使います。\u003cbr\u003e\nこの機能は音楽や録音済みの音声などを再生させるほか、各種text-to-speechのAPIを使ってmp3ファイルを合成することで、テキストの読み上げを行うこともできます。\u003cbr\u003e\n※上記スキルでは\u003ca href=\"https://www.ai-j.jp/cloud/webapi/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAITalk WebAPI\u003c/a\u003eを使いました\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"詳細解説clova音声とlineメッセージ送信のタイミング同期\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A9%B3%E7%B4%B0%E8%A7%A3%E8%AA%ACclova%E9%9F%B3%E5%A3%B0%E3%81%A8line%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E9%80%81%E4%BF%A1%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E5%90%8C%E6%9C%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e詳細解説①：Clova音声とLINEメッセージ送信の「タイミング同期」\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"実装例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装例\u003c/h3\u003e\n\n\u003cp\u003eまずは実装例です。\u003cbr\u003e\n※動画です。クリックするとYouTubeに飛びます\u003cbr\u003e\n\u003ca href=\"https://www.youtube.com/watch?v=m7r-yhAgOAc\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/http%3A%2F%2Fimg.youtube.com%2Fvi%2Fm7r-yhAgOAc%2F0.jpg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1f3a66fbdd9d7f1ad9bcc704f660c6ad\" alt=\"実装例①\" data-canonical-src=\"http://img.youtube.com/vi/m7r-yhAgOAc/0.jpg\" srcset=\"https://qiita-user-contents.imgix.net/http%3A%2F%2Fimg.youtube.com%2Fvi%2Fm7r-yhAgOAc%2F0.jpg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=31cc5d795752b004f8282574ab96913a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"解説\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E8%AA%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解説\u003c/h3\u003e\n\n\u003cp\u003eClovaから読み上げられる音声に合わせ、タイミングよくLINE Botへメッセージ（ここではイメージマップ）が送られてきます。\u003c/p\u003e\n\n\u003cp\u003e音声は、AudioPlayerの機能を使っているのですが（テキストをmp3に合成したものを再生している）、Clovaではオーディオ再生時に様々なイベントを通知してくれます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#PlayStarted\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAudioPlayer.PlayStartedイベント\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#PlayPaused\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAudioPlayer.PlayPausedイベント\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#PlayResumed\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAudioPlayer.PlayResumedイベント\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#PlayStopped\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAudioPlayer.PlayStoppedイベント\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#PlayFinished\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAudioPlayer.PlayFinishedイベント\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこのうち、 \u003ccode\u003eAudioPlayer.PlayFinished\u003c/code\u003e イベントが鍵になります。\u003c/p\u003e\n\n\u003cp\u003e仕組みはこうです。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/fb9649e8a54fa0742d6a7011efadb2d30b810b50/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3139343636342f39343139383138642d306435322d373664372d333266392d3335626631356534663935362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F194664%2F9419818d-0d52-76d7-32f9-35bf15e4f956.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d8e59b4d9dc2aabf556cab35e9c48555\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/194664/9419818d-0d52-76d7-32f9-35bf15e4f956.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F194664%2F9419818d-0d52-76d7-32f9-35bf15e4f956.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=729fa63a36e5b9e7bcb185f308c17e02 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eオーディオファイルの再生がClova側で終了すると、 \u003ccode\u003eAudioPlayer.PlayFinished\u003c/code\u003e イベントが \u003ccode\u003eEventRequest\u003c/code\u003e としてサーバーに送信されるので、そのタイミングで次のオーディオ再生指示をClovaへのレスポンスとして返し、それと同時に連携しているLINE BotでClovaスキルを使用中のユーザー宛にPushメッセージを送ります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"応用例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%9C%E7%94%A8%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e応用例\u003c/h3\u003e\n\n\u003cp\u003eまた、終了時以外にも、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#ProgressReportDelayPassed\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAudioPlayer.ProgressReportDelayPassedイベント\u003c/a\u003e：再生が開始してから特定の時間が経過した後、再生の進行状況をレポートする\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#ProgressReportPositionPassed\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAudioPlayer.ProgressReportPositionPassedイベント\u003c/a\u003e：オーディオコンテンツの特定の位置(オフセット)を再生するときに、進行状況をレポートする\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://clova-developers.line.biz/guide/CEK/References/CEK_API.md#ProgressReportIntervalPassed\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAudioPlayer.ProgressReportIntervalPassedイベント\u003c/a\u003e：再生中の場合、特定の間隔で繰り返し進行状況をレポートする\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eといったイベントが用意されているので、これらを利用し、長めのオーディオファイルの任意のタイミングでPushメッセージを出すといった応用も可能なので、いろいろな活用例が考えられます。\u003c/p\u003e\n\n\u003cp\u003e特に \u003ccode\u003eAudioPlayer.ProgressReportIntervalPassed\u003c/code\u003e を利用すると、短い間隔でイベントを受け取るようにすれば、その中に含まれる現在の再生位置情報（\u003ccode\u003eoffsetInMilliseconds\u003c/code\u003e）をもとにかなり細かい精度でオーディオ再生位置に合わせたPushメッセージを送ることができるので、たとえばアイディアの一例として\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e演奏に合わせて歌詞が送られるカラオケスキル\u003c/li\u003e\n\u003cli\u003e英語スピーチに合わせて字幕や単語訳が送られる英語学習スキル\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eなどが実現できるかと思います。\u003c/p\u003e\n\n\u003cp\u003eただし、この手法はLINE Bot（Messaging API）の \u003ccode\u003ePush API\u003c/code\u003e を前提とするので、友だち50人限定・お試し用の「Developer Trial」プランか月32,400円の「プロ(API)」でしか使えない点で注意が必要です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"詳細解説clovaスキルを一時停止させlineからの操作待ち状態を継続させる無限セッション\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A9%B3%E7%B4%B0%E8%A7%A3%E8%AA%ACclova%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E4%B8%80%E6%99%82%E5%81%9C%E6%AD%A2%E3%81%95%E3%81%9Bline%E3%81%8B%E3%82%89%E3%81%AE%E6%93%8D%E4%BD%9C%E5%BE%85%E3%81%A1%E7%8A%B6%E6%85%8B%E3%82%92%E7%B6%99%E7%B6%9A%E3%81%95%E3%81%9B%E3%82%8B%E7%84%A1%E9%99%90%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e詳細解説②：Clovaスキルを一時停止させLINEからの操作待ち状態を継続させる「無限セッション」\u003c/h2\u003e\n\n\u003cp\u003e続いて２つめです。こちらもまずは実装例の動画から。\u003cbr\u003e\n\u003ca href=\"https://www.youtube.com/watch?v=Q_kaIyEdBW8\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/http%3A%2F%2Fimg.youtube.com%2Fvi%2FQ_kaIyEdBW8%2F0.jpg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=19ceb83665ca70b35faa885ed29621d0\" alt=\"実装例②\" data-canonical-src=\"http://img.youtube.com/vi/Q_kaIyEdBW8/0.jpg\" srcset=\"https://qiita-user-contents.imgix.net/http%3A%2F%2Fimg.youtube.com%2Fvi%2FQ_kaIyEdBW8%2F0.jpg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3e1f6195a5de96c6ea15eacd4c42f854 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"解説-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E8%AA%AC-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解説\u003c/h2\u003e\n\n\u003cp\u003eこちらも、さきほどの手法と同様に \u003ccode\u003eAudioPlayer.PlayFinished\u003c/code\u003e イベントを利用しています。\u003cbr\u003e\n無限セッションを得るためにごく短い長さの“無音のmp3ファイル”を利用しています。\u003cbr\u003e\n無限ループさせるかどうかの値をサーバー（DBなど）に持たせておき、それがtrueである間、「PlayFinishedのEventRequest」「無音mp3の再生」を連続で行わせます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/c14959845920724eebf5de52587e95d8de12b931/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3139343636342f39383838326633652d393661352d333833322d323331632d3665353736333265643632612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F194664%2F98882f3e-96a5-3832-231c-6e57632ed62a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1270433a782eac2fec609938967acfc6\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/194664/98882f3e-96a5-3832-231c-6e57632ed62a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F194664%2F98882f3e-96a5-3832-231c-6e57632ed62a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d2ec23fa1f01c6912cb75e6668cdbc6b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれにより、Clovaスキルを待機状態にし、理論上無限のセッションを得ることができます。\u003c/p\u003e\n\n\u003cp\u003e無音無限ループによる「無限セッション」を作り出すことで、「絵本読み聞かせ」で行ったように一時停止・再開の機能を提供したりすることができるほか（再開指示でフラグをfalseに変えてあげればいいだけ）、ユーザーにLINE Botから複雑で時間のかかる入力を行わせることができるようにもなります（フラグをfalseにしつつ入力データの登録処理も実行）。\u003cbr\u003e\nもちろん、無限セッションといえど音声でClovaに指示をすることもできるので、音声のみでスキルを終了させることもできます（逆にいえば、実際にこれを使ったスキルを作成する場合は無限ループ中にスキルを終了された際の考慮も必要ということになります）。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"応用例-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%9C%E7%94%A8%E4%BE%8B-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e応用例\u003c/h3\u003e\n\n\u003cp\u003eたとえば「絵本読み聞かせ」スキルへの応用で、たとえば、「ウォーリーをさがせ！」のようなこともできます。\u003cbr\u003e\n「ウォーリーを探してね」という音声とともにイメージマップでLINEに画像を送り、無音無限ループの無限セッションに入ります。\u003c/p\u003e\n\n\u003cp\u003eユーザーはイメージマップの中から探すべきウォーリーの部分を探すための時間が与えられ、見つけたら該当箇所をタップ、あらかじめその位置に設定しておいたタップイベントで正誤判定を行います。\u003cbr\u003e\nまた、無限ループとせず無音mp3の最大再生回数を決めておけば、解答までの制限時間を設けることもできます。\u003cbr\u003e\nちなみに「絵本読み聞かせ」スキルですが、現在開発中の公開版ではこんな感じの「仕掛け絵本」が楽しめるような機能をつけていく予定です（アワードに出したものは一時停止＆再開のためにしかにこれは使ってません）。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"サンプルコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサンプルコード\u003c/h2\u003e\n\n\u003cp\u003e手法に関する説明は以上です。\u003cbr\u003e\nAzure Functions＋C#での実装となりますが、「Clova＆LINEで絵本読み聞かせ」のLINE BOOT AWARDS 2018バージョンのコードはGitHubですべて公開しています。\u003cbr\u003e\n\u003ca href=\"https://github.com/himanago/ClovaLinePictureBookLineBootAwards2018ver\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/himanago/ClovaLinePictureBookLineBootAwards2018ver\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e本記事に関係あるのは主に \u003ca href=\"https://github.com/himanago/ClovaLinePictureBookLineBootAwards2018ver/blob/master/ClovaLinePictureBookLineBootAwards2018ver/ClovaExtensionFunction.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eClovaExtensionFunction.cs\u003c/a\u003e です。\u003cbr\u003e\n\u003ccode\u003eAudioPlayer.PlayFinished\u003c/code\u003e イベントの処理で、一時停止フラグ（DBの値）をもとに ①次の再生＋Push / ②無音無限ループ を分岐させています。\u003cbr\u003e\nなお、\u003ca href=\"https://github.com/kenakamu/clova-cek-sdk-csharp\" rel=\"nofollow noopener\" target=\"_blank\"\u003eClovaのC# SDK（コミュニティ製）\u003c/a\u003eはオーディオ関連の機能に対応していなかったため、この部分は直接JSONを解析して処理しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eClovaExtensionFunction.cs（抜粋）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// オーディオイベントの制御\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Clovaでのオーディオ再生が終わった際に呼び出される\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereqObj\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"event\"\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s\"\u003e\"namespace\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"AudioPlayer\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003euserId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereqJson\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"session\"\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s\"\u003e\"user\"\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s\"\u003e\"userId\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebeforeId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereqObj\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"event\"\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s\"\u003e\"payload\"\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s\"\u003e\"token\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eeventName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereqObj\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"event\"\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecache\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayStatusService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindCacheAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euserId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eeventName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"PlayFinished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// LINE Botのメニューから停止要求がされていれば呼び出さない\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003eStopRequest\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStopRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsStopped\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// DBに存在する停止レコードに、直近の再生済みオーディオのIDを更新する\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStopRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBeforId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebeforeId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStopRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsPaused\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayStatusService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSaveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003eStopRequest\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStopRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsPaused\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 一時停止状態の場合は無音を流す（無限ループ）\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDirectives\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAudioResponseDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebeforeId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"一時停止中\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eConsts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSilentAudioFileUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eShouldEndSession\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// キャッシュ削除\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayStatusService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeleteAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 次のオーディオ再生（画像送付があればそれも）を実施\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nf\"\u003eAddAudioPlayAndPushPictureAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euserId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebeforeId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"PlayPaused\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 再生中断された場合\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStopRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsStopped\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayStatusService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSaveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"PlayStarted\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 再生開始OK：DBに記録\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 再生開始時はStopped=falseで登録\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003eStopRequest\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayStatusService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddCacheAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euserId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebeforeId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStopRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBeforId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebeforeId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayStatusService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSaveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h2\u003e\n\n\u003cp\u003e今回は、LINE BOOT AWARDS 2018での開発を通して確立したAPI応用方法を紹介させていただきました。\u003cbr\u003e\n「絵本読み聞かせ」も、アワード向けのものから大幅リニューアルしてストア公開を目指すことにしました。\u003cbr\u003e\nアワード向けに開発した「絵本読み聞かせ」では、自動で再生させる音声にあわせてメッセージを送る＋好きなタイミングで一時停止・再開というかたちで、自分のペースで絵本の読み聞かせを楽しむことができる機能を提供しましたが、Push APIを前提とする実装方法であったため、個人開発して一般公開するにはハードルが高くなってしまいました。\u003c/p\u003e\n\n\u003cp\u003eそこで無音無限ループの無限セッションを利用し、絵本のページ送りをBotから手動で操作するようにすることで、Reply APIのみでほぼ同様の機能を実現できるよう考えています（LINE Botからの次ページ要求操作に対する返信として絵を送るようにすればフリープラン内で実装可能）。\u003c/p\u003e\n\n\u003cp\u003eとはいえ、そこまでいくと一見「音声で操作する」というスマートスピーカーの特徴・存在意義を放棄しているかのようにも思えてしまいます。\u003cbr\u003e\n「VUI」ではなく「GUI」での操作であり、それならば同様のゲームや読み上げをアプリとして提供し、わざわざスマートスピーカーを使わせずスマートフォン/タブレットのみで完結すべきと考えることもできるでしょう。\u003cbr\u003e\nしかし、普通のスマートスピーカーではなく、顔のついたスマートスピーカーである「Clova Friends」や「Clova Friends mini」を持つClovaなら、こういったスキルの提供も意味を持つのではないか？と考えています。\u003cbr\u003e\nあえて音声による案内を流すのをスマートフォン/タブレットから切り離し、ブラウンやサリーなどのかわいらしいキャラクターをかたどったデバイスが話してくれることで、まるでそのキャラクターとともに遊んでいるような体験を得られるはずです。\u003cbr\u003e\n先に述べた仕掛け絵本のような機能とともに、Clova/スマートスピーカーでしか実現できないようなスキルといえるようなものを目指して設計・開発を進めていきたいと思っています。\u003cbr\u003e\nVUIやスマートスピーカーはまだ新しい技術なので、もしその中でまた新しい手法が見つけられたら、どんどん共有していきたいと思います。\u003c/p\u003e\n","createdAt":"2018-12-23T01:46:09Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"LR80a2oj0cZA9Wdy137NzzvKZKbr040r--fcOhhYVn61XofcLQ--LK/poXWh151HRu2pIKM1Iw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-12-24T03:34:27Z","likesCount":11,"linkUrl":"https://qiita.com/himarin269/items/675c6619bfb32acfd9c3","organization":null,"originalId":748056,"stockedCount":2,"title":"ClovaとLINE Botの一味違う２つの連携手法～タイミング同期＆無限セッション～","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%81%A7%E7%B4%B9%E4%BB%8B%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8\"\u003e本記事で紹介すること\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#-clova%E9%9F%B3%E5%A3%B0%E3%81%A8line%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E9%80%81%E4%BF%A1%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E5%90%8C%E6%9C%9F\"\u003e① Clova音声とLINEメッセージ送信の「タイミング同期」\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#-clova%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E4%B8%80%E6%99%82%E5%81%9C%E6%AD%A2%E3%81%95%E3%81%9Bline%E3%81%8B%E3%82%89%E3%81%AE%E6%93%8D%E4%BD%9C%E5%BE%85%E3%81%A1%E7%8A%B6%E6%85%8B%E3%82%92%E7%B6%99%E7%B6%9A%E3%81%95%E3%81%9B%E3%82%8B%E7%84%A1%E9%99%90%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e② Clovaスキルを一時停止させLINEからの操作待ち状態を継続させる「無限セッション」\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85%E4%BE%8B%E3%81%A8%E5%89%8D%E6%8F%90\"\u003e実装例と前提\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A9%B3%E7%B4%B0%E8%A7%A3%E8%AA%ACclova%E9%9F%B3%E5%A3%B0%E3%81%A8line%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E9%80%81%E4%BF%A1%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E5%90%8C%E6%9C%9F\"\u003e詳細解説①：Clova音声とLINEメッセージ送信の「タイミング同期」\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85%E4%BE%8B\"\u003e実装例\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A7%A3%E8%AA%AC\"\u003e解説\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BF%9C%E7%94%A8%E4%BE%8B\"\u003e応用例\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A9%B3%E7%B4%B0%E8%A7%A3%E8%AA%ACclova%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%92%E4%B8%80%E6%99%82%E5%81%9C%E6%AD%A2%E3%81%95%E3%81%9Bline%E3%81%8B%E3%82%89%E3%81%AE%E6%93%8D%E4%BD%9C%E5%BE%85%E3%81%A1%E7%8A%B6%E6%85%8B%E3%82%92%E7%B6%99%E7%B6%9A%E3%81%95%E3%81%9B%E3%82%8B%E7%84%A1%E9%99%90%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e詳細解説②：Clovaスキルを一時停止させLINEからの操作待ち状態を継続させる「無限セッション」\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A7%A3%E8%AA%AC-1\"\u003e解説\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BF%9C%E7%94%A8%E4%BE%8B-1\"\u003e応用例\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89\"\u003eサンプルコード\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003eおわりに\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":1634,"uuid":"675c6619bfb32acfd9c3","banReason":null,"adventCalendarItem":{"day":23,"calendar":{"name":"LINEBot\u0026Clova","urlName":"linebot","year":2018,"organization":null}},"author":{"encryptedId":"Uk9qTa8L6yo6p/Mcl2K4vwBTvKoV--8Aow8X4tGe9HTcNF--sogxzQW0h8aJbkbz5BiMHw==","originalId":194664,"description":"開発や研修・講座講師などをしています。C#/Azure/LINE API/スマートスピーカーなど。","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/194664/profile-images/1552263738","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F194664%2Fprofile-images%2F1552263738?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=8d5a9b03a3e8753e9b1292463f358be3","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F194664%2Fprofile-images%2F1552263738?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=b11808da71429a4e19aca7000eba4cdd","urlName":"himarin269","websiteUrl":"http://himanago.hatenablog.com/","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"linebot","urlName":"linebot"},{"name":"Clova","urlName":"clova"},{"name":"vui","urlName":"vui"}],"followingLikers":{"edges":[]},"comments":{"totalCount":1}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

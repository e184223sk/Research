More than 1 year has passed since last update.最初の記事はこちら今回はカスタマイズ方法についての紹介です。このカスタマイズ方法は公式で紹介されているものではなく、私が独自で行っているものです。あらかじめご注意ください。InsertやUpdateにおいてパラメータに空文字列が含まれていた場合、これをnullに変換して登録する。
(「複数DBベンダー対応をする際にOracleの挙動に合わせるため」 などが動機として考えられます。
というか私はそれでした😀)一つ目の方法は Database クラスそのものを継承し、AddParameter クラスの挙動を変更します。実行コード実行ログp1, p2が[DBNull] となっていることからnull で登録されていることが確認できます。IMapper というインターフェースが用意されており、これを利用すると、データベースから結果を取り出すときや、データベースへ登録するときに 変換処理などを行うことが可能です。今回はこのIMapper の GetParameterConverter メソッドを利用します。このメソッドは前述のDatabase.AddParameter で実行されています。またIMapper を直接実装するのではなく、あらかじめ用意されたDefaultMapperを継承して作成します。実行コード実行ログDatabase.AddParameter と同様の結果になっています。これらの方法ですが、全てのパラメータマッピング時に実行されるため、SELECTを実行する場合でも呼び出されてしまいます。
(アプリの仕様によってはこれが害になる可能性もあります。)またSELECT + INSERT, SELECT + UPDATE のようなパラメータを介さないものについてはこれらのメソッドが実行されてないので、変換は行われません。



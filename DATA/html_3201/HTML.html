<!DOCTYPE html><html><head><meta charset="utf-8" /><title>[Unity] MagicOnion で StreamingHub のサンプルを動かしてみた on Mac - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/nikaera/items/3d2a9d6015b13840097f" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="RLGX/l9Z/ABtjQzan68F6w8u7E0o7fqV6igItxmcxEf3HTIrtwu1JGqdkMeC5/WFbXBN8PcgAs9n9iMptKyMsA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@n1kaera" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="[Unity] MagicOnion で StreamingHub のサンプルを動かしてみた on Mac - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XMVZ1YVhSNVhTQk5ZV2RwWTA5dWFXOXVJT09CcHlCVGRISmxZVzFwYm1kSWRXSWc0NEd1NDRLMTQ0T3o0NE9YNDRPcjQ0S1M1WXVWNDRHTDQ0R1g0NEdtNDRHXzQ0R2ZJRzl1SUUxaFl3JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWJkMzhhODYzMDU4NGU2ZjI2NDY2OGYyNzQzNGM4ZGRj&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzVwYTJGbGNtRSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWIyY2Q4ZmI5ZGM4YmU5NDFkOTY1ZTc4OTExOTVhOGEx&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=3102b46aba7d1e2c2b020211e2d394a8"><meta property="og:description" content="

はじめに

マルチプレイ可能な VR ゲームを作ることに興味が湧いてきたので、
C# の勉強も兼ねて MagicOnion を使用して開発していくことにしました

MagicOnion を調査したところ、どうやら Streamin..."><meta content="https://qiita.com/nikaera/items/3d2a9d6015b13840097f" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,.NET,Unity,gRPC,MagicOnion" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-9cb29205-ad0d-4904-a1bd-d3f312a6b602"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fnikaera%2Fitems%2F3d2a9d6015b13840097f">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fnikaera%2Fitems%2F3d2a9d6015b13840097f">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-9cb29205-ad0d-4904-a1bd-d3f312a6b602">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-06-18T22:45:20.000+09:00","dateModified":"2019-06-19T01:08:25.000+09:00","headline":"[Unity] MagicOnion で StreamingHub のサンプルを動かしてみた on Mac","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XMVZ1YVhSNVhTQk5ZV2RwWTA5dWFXOXVJT09CcHlCVGRISmxZVzFwYm1kSWRXSWc0NEd1NDRLMTQ0T3o0NE9YNDRPcjQ0S1M1WXVWNDRHTDQ0R1g0NEdtNDRHXzQ0R2ZJRzl1SUUxaFl3JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWJkMzhhODYzMDU4NGU2ZjI2NDY2OGYyNzQzNGM4ZGRj\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzVwYTJGbGNtRSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWIyY2Q4ZmI5ZGM4YmU5NDFkOTY1ZTc4OTExOTVhOGEx\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=3102b46aba7d1e2c2b020211e2d394a8","mainEntityOfPage":"https://qiita.com/nikaera/items/3d2a9d6015b13840097f","author":{"@type":"Person","address":"","email":null,"identifier":"nikaera","name":"nikaera","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2Fprofile-images%2F1589826426?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=41b1b75ea8bde517f4f1795a94e23ef8","url":"https://qiita.com/nikaera","description":"様々な技術領域に関心のある雑食系エンジニアです。自分の記事が誰かのお役に立てば幸いです。Babylon.js/Serverless/TypeScript/React/Amplify/Unity","memberOf":[{"@type":"Organization","address":"オンライン@Slack","legalName":"Unityゲーム開発者ギルド","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/5e3ba3bb442371003e6b5d4618ef627b9b478357/original.jpg?1570216541","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","identifier":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。"},{"@type":"Organization","address":"東京都品川区小山6-5-10 千代田ビル 2F","legalName":"カディンチェ株式会社","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/01e87fb860054d464b4f3cda6de69aee9989b35e/original.jpg?1570665553","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/2f6875f5cd25e44bd343396a4b59bc1c379f764c/original.jpg?1570665178","identifier":"kadinche","description":"弊社では 2008年の会社設立当初から、一貫して VR ソリューションの研究開発に取り組んでいます。"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"nikaera","type":"items","id":"3d2a9d6015b13840097f"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"nikaera","type":"items","id":"3d2a9d6015b13840097f"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"nikaera","type":"items","id":"3d2a9d6015b13840097f"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/nikaera/items/3d2a9d6015b13840097f","location":"/nikaera/items/3d2a9d6015b13840097f","scheme":"https","host":"qiita.com","port":null,"pathname":"/nikaera/items/3d2a9d6015b13840097f","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"8SXCJTeF2i3GVGK1ILxzYDJ6Imyi7E/+k4JAHkcOUsxCiWfw39eTCcFE/qg99IMOUCSD0X0ht6QeXGuA6j4aOw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-bd2d3a17-a93d-423c-a8ba-a876c6cdf881"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/nikaera/items/3d2a9d6015b13840097f/likers" class="css-1iupg5d">19</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">16</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3d2a9d6015b13840097f/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/nikaera/items/3d2a9d6015b13840097f/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/nikaera/items/3d2a9d6015b13840097f/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/nikaera/items/3d2a9d6015b13840097f/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/nikaera/items/3d2a9d6015b13840097f.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/nikaera"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/86070/profile-images/1589826426" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/nikaera" class="css-10ougpm">@<!-- -->nikaera</a><div class="css-1ay9vb9"><span><meta content="2019-06-18T13:45:20Z"/><time dateTime="2019-06-18T16:08:25Z" class="css-m19uds">updated at 2019-06-18</time></span></div></div></div></div></div><h1 class="css-cgzq40">[Unity] MagicOnion で StreamingHub のサンプルを動かしてみた on Mac</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/.net" class="css-4czcte">.NET</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/grpc" class="css-4czcte">gRPC</a><a href="/tags/magiconion" class="css-4czcte">MagicOnion</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>マルチプレイ可能な VR ゲームを作ることに興味が湧いてきたので、<br>
C# の勉強も兼ねて MagicOnion を使用して開発していくことにしました<img alt=":metal:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f918.png" title=":metal:" width="20" loading="lazy"></p>

<p>MagicOnion を調査したところ、どうやら StreamingHub を使うことで、<br>
サーバークライアント間でのリアルタイム通信を簡単に実装出来そうなことが分かりました。</p>

<p>そこで MagicOnion の README にある <a href="https://github.com/Cysharp/MagicOnion#streaminghub" rel="nofollow noopener" target="_blank">StreamingHub のサンプル</a> を動かしてみました ↓</p>

<p><a href="https://camo.qiitausercontent.com/5ec3e86480da28e9f49de2f6181a7933e6215da7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f38363037302f33656538633332392d373635302d663035622d373035652d6161636330633962366132352e676966" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2F3ee8c329-7650-f05b-705e-aacc0c9b6a25.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=30787f8b010e3cab778e00960c5b940b" alt="output.gif" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/86070/3ee8c329-7650-f05b-705e-aacc0c9b6a25.gif" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2F3ee8c329-7650-f05b-705e-aacc0c9b6a25.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b0dc605104afa1b7e4fef7e0c7c6d0a3 1x" loading="lazy"></a></p>

<p>余談ですが、今まで C# でサーバサイドのプログラミング経験が無く、先入観で、<br>
「C# で作ったプログラムは Windows OS 環境でないと気軽に動かせないのでは？」と思ってしまっていました。。。</p>

<p>しかし、MagicOnion の開発環境を構築していく過程で、全然 Mac でも気軽に開発を進めていけることが分かりました。<br>
そのため、例え Mac 使ってても C# の開発に億劫になる必要は全く無いよと伝えたく記事を書くことにしました。（めっちゃ今更感あるかもしれませんが。。）</p>

<p>記事の中で間違っている部分/表現等あれば、有識者の方々にご指摘いただけると非常にありがたいです <img alt=":bow:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f647.png" title=":bow:" width="20" loading="lazy"> (特に記事内で紹介しているソースコード内のコメントアウトの内容とか。。。)</p>

<p>ちなみに MagicOnion + Unity + VRM でマルチプレイを実現するためのやりかたは、<br>
既に素晴らしい記事が存在していますので <a href="/simplestar" class="user-mention js-hovercard" title="simplestar" data-hovercard-target-type="user" data-hovercard-target-name="simplestar">@simplestar</a> さんの <a href="https://simplestar-tech.hatenablog.com/entry/2019/05/19/192801" rel="nofollow noopener" target="_blank">こちらの記事</a> を見たほうが圧倒的に良いです。</p>

<p>本記事では初心者も詰まらずシンプルに StreamingHub のサンプルが動かせて、<br>
とにかくマルチプレイのサンプルが動かせるようにすることを目指しています。</p>

<h1>
<span id="動作環境" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>動作環境</h1>

<p>今回は ↓ の環境で作業を行いました。</p>

<ul>
<li>StreamingHub サーバ

<ul>
<li>.NET Core 2.2.300</li>
<li>MagicOnion 2.1.2</li>
<li>MagicOnion.Hosting 2.1.2</li>
<li>MessagePack.UnityShims 1.7.3.7</li>
</ul>
</li>
<li>StreamingHub クライアント

<ul>
<li>Unity 2019.1.4f1</li>
<li>MagicOnion 2.1.2</li>
<li>gRPC 1.22.0</li>
<li>MessagePack 1.7.3.5</li>
</ul>
</li>
</ul>

<h1>
<span id="c-の開発環境を構築する" class="fragment"></span><a href="#c-%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>C# の開発環境を構築する</h1>

<p>まずは ↓ のリンクから .NET SDK をダウンロードしてきます。<br>
<a href="https://dotnet.microsoft.com/download" class="autolink" rel="nofollow noopener" target="_blank">https://dotnet.microsoft.com/download</a><br>
<a href="https://camo.qiitausercontent.com/7130907e03d25c486bfbfc1067759754d2c01739/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f38363037302f37356230643732632d353435382d313532372d623565642d3734383261366336373234612e706e67" target="_blank" rel="nofollow noopener"><img width="1302" alt="スクリーンショット 2019-06-18 14.14.06.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2F75b0d72c-5458-1527-b5ed-7482a6c6724a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d0ad0db966f8af6235f334adce991d04" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/86070/75b0d72c-5458-1527-b5ed-7482a6c6724a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2F75b0d72c-5458-1527-b5ed-7482a6c6724a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0f149a2fe1dd3e7b9df1d60f99e7b19d 1x" loading="lazy"></a></p>

<p>ダウンロードが完了したら、<code>dotnet-sdk-X.X.XXX-osx-x64.pkg</code> を開いて .NET SDK をインストールします。</p>

<p>正常にインストールが完了したら、ターミナルを開き <code>dotnet</code> コマンドが実行可能な状態か確認します</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre class="with-code"><code><span class="c"># .NET の SDK バージョンを出力</span>
dotnet <span class="nt">--version</span>
2.2.300
</code></pre></div></div>

<p>上記の通りバージョン情報が標準出力されれば、開発のための準備は完了です。</p>

<h1>
<span id="net-のプロジェクトで-streaminghub-サーバを作る" class="fragment"></span><a href="#net-%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7-streaminghub-%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>.NET のプロジェクトで StreamingHub サーバを作る</h1>

<p><a href="/rookx" class="user-mention js-hovercard" title="rookx" data-hovercard-target-type="user" data-hovercard-target-name="rookx">@rookx</a> さんの <a href="https://qiita.com/rookx/items/6086b9426f3138a4b700" id="reference-52884fcae2cb84a7a52e">.NET CoreでMagicOnionを動かしてみた</a> を参考にプロジェクトのセットアップを行います。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre class="with-code"><code><span class="nb">mkdir </span>Server
<span class="nb">cd </span>Server
<span class="c"># .NET のコンソールアプリケーションを作成</span>
dotnet new console
<span class="c"># 本記事の内容を動かすのに必要な MagicOnion 関連パッケージを追加</span>
dotnet add package MagicOnion
dotnet add package MagicOnion.Hosting
<span class="c"># MessagePack で Unity の Vector3 や Quaternion を扱う際に必要となるパッケージを追加</span>
dotnet add package MessagePack.UnityShims
</code></pre></div></div>

<p>これだけで今回のプロジェクトのセットアップは完了です。</p>

<p>あとは MagicOnion 関連のソースコードを書きながら、<br>
都度 <code>dotnet run</code> コマンドで動作検証を進めていける状態です。</p>

<p>現状の Server フォルダの中身は ↓ の構成になっているはずです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>.
└── Server
    ├── Program.cs
    ├── Server.csproj
    ├── Server.sln
    ├── bin
    └── obj
</code></pre></div></div>

<p>まずは Program.cs の中身を MagicOnion の <a href="https://nuget.pkg.github.com/Cysharp/MagicOnion/blob/master/README.md#hosting" rel="nofollow noopener" target="_blank">README の内容</a> に従って書き換えます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Server/Program.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Microsoft.Extensions.Hosting</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MagicOnion.Hosting</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MagicOnion.Server</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Grpc.Core</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="c1">// MagicOnion を await で起動するため、非同期 Main で定義</span>
    <span class="c1">// await でサーバーを起動しないと、即 Main 関数が終了してしまうため</span>
    <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// gRPC のログをコンソールに出力するよう設定</span>
        <span class="n">GrpcEnvironment</span><span class="p">.</span><span class="nf">SetLogger</span><span class="p">(</span><span class="k">new</span> <span class="n">Grpc</span><span class="p">.</span><span class="n">Core</span><span class="p">.</span><span class="n">Logging</span><span class="p">.</span><span class="nf">ConsoleLogger</span><span class="p">());</span>

        <span class="c1">// isReturnExceptionStackTraceInErrorDetail に true を設定して</span>
        <span class="c1">// エラー発生時のメッセージがコンソールに出力されるようにする</span>
        <span class="c1">// MagicOnion サーバーが localhost:12345 で Listen する</span>
        <span class="k">await</span> <span class="n">MagicOnionHost</span><span class="p">.</span><span class="nf">CreateDefaultBuilder</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">UseMagicOnion</span><span class="p">(</span>
                <span class="k">new</span> <span class="nf">MagicOnionOptions</span><span class="p">(</span><span class="n">isReturnExceptionStackTraceInErrorDetail</span><span class="p">:</span> <span class="k">true</span><span class="p">),</span>
                <span class="k">new</span> <span class="nf">ServerPort</span><span class="p">(</span><span class="s">"localhost"</span><span class="p">,</span> <span class="m">12345</span><span class="p">,</span> <span class="n">ServerCredentials</span><span class="p">.</span><span class="n">Insecure</span><span class="p">))</span>
            <span class="p">.</span><span class="nf">RunConsoleAsync</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>あとは実際にサーバークライアント間でリアルタイム通信を行うために必要なソースコードを追加していきます。<br>
まずは StreamingHub の通信周りの定義を記述した <code>IGamingHub.cs</code> を追加します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Server/IGamingHub.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">MagicOnion</span><span class="p">;</span>

<span class="c1">// MessagePack.UnityShims を利用することで、</span>
<span class="c1">// Unity の Vector3 や Quaternion を通信でやり取りすることが可能になる</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">MessagePack</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="c1">// サーバで gRPC が実行された際に、</span>
<span class="c1">// 実行結果をクライアントに返すためのコールバック関数を定義する</span>
<span class="k">public</span> <span class="k">interface</span> <span class="nc">IGamingHubReceiver</span>
<span class="p">{</span>
    <span class="k">void</span> <span class="nf">OnJoin</span><span class="p">(</span><span class="n">Player</span> <span class="n">player</span><span class="p">);</span>
    <span class="k">void</span> <span class="nf">OnLeave</span><span class="p">(</span><span class="n">Player</span> <span class="n">player</span><span class="p">);</span>
    <span class="k">void</span> <span class="nf">OnMove</span><span class="p">(</span><span class="n">Player</span> <span class="n">player</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// クライアントがサーバ側で gRPC 実行可能な関数を定義する</span>
<span class="k">public</span> <span class="k">interface</span> <span class="nc">IGamingHub</span> <span class="p">:</span> <span class="n">IStreamingHub</span><span class="p">&lt;</span><span class="n">IGamingHub</span><span class="p">,</span> <span class="n">IGamingHubReceiver</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="n">Task</span><span class="p">&lt;</span><span class="n">Player</span><span class="p">[</span><span class="k">]&gt;</span> <span class="nf">JoinAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">roomName</span><span class="p">,</span> <span class="kt">string</span> <span class="n">userName</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">position</span><span class="p">,</span> <span class="n">Quaternion</span> <span class="n">rotation</span><span class="p">);</span>
    <span class="n">Task</span> <span class="nf">LeaveAsync</span><span class="p">();</span>
    <span class="n">Task</span> <span class="nf">MoveAsync</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">position</span><span class="p">,</span> <span class="n">Quaternion</span> <span class="n">rotation</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// gRPC 通信で独自に定義したメッセージ Player を扱うための宣言</span>
<span class="c1">// Player はプレイヤー名, 位置(Vector3), 回転(Quaternion) の変数を所持している</span>
<span class="p">[</span><span class="n">MessagePackObject</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Player</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Key</span><span class="p">(</span><span class="m">0</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">[</span><span class="nf">Key</span><span class="p">(</span><span class="m">1</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">Vector3</span> <span class="n">Position</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">[</span><span class="nf">Key</span><span class="p">(</span><span class="m">2</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">Quaternion</span> <span class="n">Rotation</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>次に <code>IGamingHub.cs</code> の定義内容のサーバ側を実装した <code>GamingHub.cs</code> を追加します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Server/GamingHub.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MagicOnion.Server.Hubs</span><span class="p">;</span>

<span class="c1">// IGamingHub の実装が記述された GamingHub クラス</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">GamingHub</span> <span class="p">:</span> <span class="n">StreamingHubBase</span><span class="p">&lt;</span><span class="n">IGamingHub</span><span class="p">,</span> <span class="n">IGamingHubReceiver</span><span class="p">&gt;,</span> <span class="n">IGamingHub</span>
<span class="p">{</span>
    <span class="c1">// IGroup を使用することで同一のグループに所属している他ユーザ全員に対して</span>
    <span class="c1">// 一斉にブロードキャスト送信を行うことが出来る (オンラインゲームで言うルームの概念)</span>
    <span class="n">IGroup</span> <span class="n">room</span><span class="p">;</span>

    <span class="c1">// ルーム内での自分の情報 (IGamingHub.cs で定義した Player の情報)</span>
    <span class="n">Player</span> <span class="n">self</span><span class="p">;</span>

    <span class="c1">// ルームに入室しているユーザ全員（自分も含む）の情報を保持して扱うための変数</span>
    <span class="n">IInMemoryStorage</span><span class="p">&lt;</span><span class="n">Player</span><span class="p">&gt;</span> <span class="n">storage</span><span class="p">;</span>

    <span class="c1">// 指定したルームに入室するための関数</span>
    <span class="c1">// 入室するルーム名及び、ユーザ自身の情報(ユーザ名,位置(Vector3),回転(Quaternion)) を引数に取る</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Player</span><span class="p">[</span><span class="k">]&gt;</span> <span class="nf">JoinAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">roomName</span><span class="p">,</span> <span class="kt">string</span> <span class="n">userName</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">position</span><span class="p">,</span> <span class="n">Quaternion</span> <span class="n">rotation</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">self</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Player</span><span class="p">()</span> <span class="p">{</span> <span class="n">Name</span> <span class="p">=</span> <span class="n">userName</span><span class="p">,</span> <span class="n">Position</span> <span class="p">=</span> <span class="n">position</span><span class="p">,</span> <span class="n">Rotation</span> <span class="p">=</span> <span class="n">rotation</span> <span class="p">};</span>

        <span class="c1">// ルームにユーザが入室する</span>
        <span class="p">(</span><span class="n">room</span><span class="p">,</span> <span class="n">storage</span><span class="p">)</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Group</span><span class="p">.</span><span class="nf">AddAsync</span><span class="p">(</span><span class="n">roomName</span><span class="p">,</span> <span class="n">self</span><span class="p">);</span>

        <span class="c1">// ルームに入室している他ユーザ全員に</span>
        <span class="c1">// 入室したユーザの情報をブロードキャスト送信する</span>
        <span class="nf">Broadcast</span><span class="p">(</span><span class="n">room</span><span class="p">).</span><span class="nf">OnJoin</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>

        <span class="c1">// ルームに入室している他ユーザ全員の情報を配列で取得する</span>
        <span class="k">return</span> <span class="n">storage</span><span class="p">.</span><span class="n">AllValues</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// ユーザがルームから退出する</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">LeaveAsync</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="n">room</span><span class="p">.</span><span class="nf">RemoveAsync</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">);</span>

        <span class="c1">// ルームに入室している他ユーザ全員に</span>
        <span class="c1">// ルームから退出したことをユーザの情報と共にブロードキャスト送信する</span>
        <span class="nf">Broadcast</span><span class="p">(</span><span class="n">room</span><span class="p">).</span><span class="nf">OnLeave</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// ユーザがルームの中で動く</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">MoveAsync</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">position</span><span class="p">,</span> <span class="n">Quaternion</span> <span class="n">rotation</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 動いたユーザの位置(xyz) と回転(quaternion) を設定する</span>
        <span class="n">self</span><span class="p">.</span><span class="n">Position</span> <span class="p">=</span> <span class="n">position</span><span class="p">;</span>
        <span class="n">self</span><span class="p">.</span><span class="n">Rotation</span> <span class="p">=</span> <span class="n">rotation</span><span class="p">;</span>

        <span class="c1">// 動いたユーザの最新の位置(Vector3)と回転(Quaternion) を</span>
        <span class="c1">// ルームに入室している他ユーザ全員にユーザの最新情報 (Player) をブロードキャスト送信する</span>
        <span class="nf">Broadcast</span><span class="p">(</span><span class="n">room</span><span class="p">).</span><span class="nf">OnMove</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
</div>

<p>現状の Server フォルダの中身は ↓ の構成になっているはずです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>.
└── Server
    ├── GamingHub.cs
    ├── IGamingHub.cs
    ├── Program.cs
    ├── Server.csproj
    ├── Server.sln
    ├── bin
    └── obj
</code></pre></div></div>

<p>この状態で Server フォルダ上で <code>dotnet run</code> を実行してみます。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre class="with-code"><code>dotnet run

GamingHub.cs<span class="o">(</span>37,23<span class="o">)</span>: warning CS1998: この非同期メソッドには <span class="s1">'await'</span> 演算子がないため、同期的に実行されます。<span class="s1">'await'</span> 演算子を使用して非ブロッキング API 呼び出しを待機するか、<span class="s1">'await Task.Run(...)'</span> を使用してバックグラウンドのスレッドに対して CPU 主体の処理を実行することを検討してください。 <span class="o">[</span>/Users/nika/Desktop/MagicOnion/Server/Server.csproj]
D0618 19:33:16.355504 Grpc.Core.Internal.UnmanagedLibrary Attempting to load native library <span class="s2">"/Users/nika/.nuget/packages/grpc.core/1.20.1/lib/netstandard2.0/../../runtimes/osx/native/libgrpc_csharp_ext.x64.dylib"</span>
D0618 19:33:16.400266 Grpc.Core.Internal.NativeExtension gRPC native library loaded successfully.
Application started. Press Ctrl+C to shut down.
Hosting environment: Production
Content root path: /Users/nika/.nuget/packages/magiconion.hosting/2.1.2/lib/netstandard2.0
</code></pre></div></div>

<p>警告が出てきましたが、<a href="http://neue.cc/2017/04/06_551.html" rel="nofollow noopener" target="_blank">これは無視で大丈夫です</a><br>
正常に実行されればエラーは発生せず、ターミナルが待機状態になるはずです。</p>

<h1>
<span id="unity-プロジェクトで-streaminghub-クライアントを作る" class="fragment"></span><a href="#unity-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7-streaminghub-%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>Unity プロジェクトで StreamingHub クライアントを作る</h1>

<p><a href="/mitchydeath" class="user-mention js-hovercard" title="mitchydeath" data-hovercard-target-type="user" data-hovercard-target-name="mitchydeath">@mitchydeath</a> さんの <a href="https://qiita.com/mitchydeath/items/cecf01493d1efeb4ae55#1unity%E5%81%B4%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89" id="reference-e63a95646cdb119659da">Unity+MagicOnionで超絶手軽にリアルタイム通信を実装してみた</a> に沿って Unity プロジェクトに MagicOnion をセットアップしておきます。</p>

<p>セットアップ完了次第、Unity プロジェクトの Assets/Scripts フォルダに StreamingHub クライアント用のスクリプトを追加していきます。<code>IGamingHub.cs</code> は Unity 側でもクライアント側の実装を行うために必要になるので、Assets/Scripts フォルダに追加しておきます。</p>

<p>また <code>IGamingHub.cs</code> の定義内容のクライアント側を実装した <code>GamingHubClient.cs</code> を追加します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Assets/Scripts/GamingHubClient.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Grpc.Core</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MagicOnion.Client</span><span class="p">;</span>

<span class="c1">// IGamingHubReceiver の実装が記述された GamingHubClient クラス</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">GamingHubClient</span> <span class="p">:</span> <span class="n">IGamingHubReceiver</span>
<span class="p">{</span>
    <span class="c1">// 部屋に参加しているユーザ全員の GameObject (アバター)を保持する</span>
    <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">GameObject</span><span class="p">&gt;</span> <span class="n">players</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">GameObject</span><span class="p">&gt;();</span>

    <span class="c1">// サーバ側の関数を実行するための変数</span>
    <span class="n">IGamingHub</span> <span class="n">client</span><span class="p">;</span>

    <span class="c1">// 指定したルームに入室するための関数</span>
    <span class="c1">// StreamingHubClient で使用する gRPC チャネル及び、参加したい部屋名、使用するユーザ名を引数に指定する</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;</span> <span class="nf">ConnectAsync</span><span class="p">(</span><span class="n">Channel</span> <span class="n">grpcChannel</span><span class="p">,</span> <span class="kt">string</span> <span class="n">roomName</span><span class="p">,</span> <span class="kt">string</span> <span class="n">playerName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// サーバ側の関数を実行するための StreamingHubClient を生成する</span>
        <span class="n">client</span> <span class="p">=</span> <span class="n">StreamingHubClient</span><span class="p">.</span><span class="n">Connect</span><span class="p">&lt;</span><span class="n">IGamingHub</span><span class="p">,</span> <span class="n">IGamingHubReceiver</span><span class="p">&gt;(</span><span class="n">grpcChannel</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

        <span class="c1">// JoinAsync 関数を実行して部屋に入室すると同時に、</span>
        <span class="c1">// 既に入室済みのユーザ全員の情報を配列で取得する</span>
        <span class="kt">var</span> <span class="n">roomPlayers</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">JoinAsync</span><span class="p">(</span><span class="n">roomName</span><span class="p">,</span> <span class="n">playerName</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">.</span><span class="n">identity</span><span class="p">);</span>

        <span class="c1">// 自ユーザ以外を OnJoin 関数に渡して、</span>
        <span class="c1">// this.players に部屋の他ユーザ全員の情報をセットする</span>
        <span class="c1">// 自ユーザの情報は await で JoinAsync を実行した段階で、</span>
        <span class="c1">// OnJoin がコールバックで呼ばれているためセット済みの状態となっている</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">player</span> <span class="k">in</span> <span class="n">roomPlayers</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">Name</span> <span class="p">!=</span> <span class="n">playerName</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="p">(</span><span class="k">this</span> <span class="k">as</span> <span class="n">IGamingHubReceiver</span><span class="p">).</span><span class="nf">OnJoin</span><span class="p">(</span><span class="n">player</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// 自ユーザの情報を返却する</span>
        <span class="k">return</span> <span class="n">players</span><span class="p">[</span><span class="n">playerName</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// 部屋から退出し、部屋の他ユーザ全員に退出したことをブロードキャスト送信する</span>
    <span class="k">public</span> <span class="n">Task</span> <span class="nf">LeaveAsync</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">client</span><span class="p">.</span><span class="nf">LeaveAsync</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// 自ユーザの位置(Vector3) と回転(Quaternion) を更新すると同時に</span>
    <span class="c1">// 部屋の他ユーザ全員にブロードキャスト送信する</span>
    <span class="k">public</span> <span class="n">Task</span> <span class="nf">MoveAsync</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">position</span><span class="p">,</span> <span class="n">Quaternion</span> <span class="n">rotation</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">client</span><span class="p">.</span><span class="nf">MoveAsync</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">rotation</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// StreamingHubClient の解放処理</span>
    <span class="c1">// gRPC のチャネルを破棄する前に実行する必要がある</span>
    <span class="k">public</span> <span class="n">Task</span> <span class="nf">DisposeAsync</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">client</span><span class="p">.</span><span class="nf">DisposeAsync</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// 部屋に新しいユーザが入室したときに呼び出される関数</span>
    <span class="c1">// または ConnectAsync 関数を実行したときに呼び出される関数</span>
    <span class="k">void</span> <span class="n">IGamingHubReceiver</span><span class="p">.</span><span class="nf">OnJoin</span><span class="p">(</span><span class="n">Player</span> <span class="n">player</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ユーザの GameObject (アバター)を Player 情報を元に生成して</span>
        <span class="c1">// this.players に player.Name をキーにして保持する</span>
        <span class="c1">// 部屋に入室しているユーザの数だけワールド上にキューブを出現する</span>
        <span class="kt">var</span> <span class="n">cube</span> <span class="p">=</span> <span class="n">GameObject</span><span class="p">.</span><span class="nf">CreatePrimitive</span><span class="p">(</span><span class="n">PrimitiveType</span><span class="p">.</span><span class="n">Cube</span><span class="p">);</span>
        <span class="n">cube</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">player</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
        <span class="n">cube</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">SetPositionAndRotation</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span> <span class="n">player</span><span class="p">.</span><span class="n">Rotation</span><span class="p">);</span>
        <span class="n">players</span><span class="p">[</span><span class="n">player</span><span class="p">.</span><span class="n">Name</span><span class="p">]</span> <span class="p">=</span> <span class="n">cube</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 他ユーザが部屋から退出した際に呼び出される関数</span>
    <span class="k">void</span> <span class="n">IGamingHubReceiver</span><span class="p">.</span><span class="nf">OnLeave</span><span class="p">(</span><span class="n">Player</span> <span class="n">player</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// this.players に保持していた GameObject (アバター)を破棄する</span>
        <span class="c1">// ワールド上から該当する GameObject (アバター)のキューブが消滅する</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">players</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">cube</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">GameObject</span><span class="p">.</span><span class="nf">Destroy</span><span class="p">(</span><span class="n">cube</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 部屋の中でいずれかのユーザが動いたときに呼び出される関数</span>
    <span class="k">void</span> <span class="n">IGamingHubReceiver</span><span class="p">.</span><span class="nf">OnMove</span><span class="p">(</span><span class="n">Player</span> <span class="n">player</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 引数の player の Name を元に this.players 内から GameObject を取得する</span>
        <span class="c1">// ワールド上の該当する GameObject (アバター)の位置(Vector3)と回転(Quaternion) の値を最新のものに更新する</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">players</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">cube</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">cube</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">SetPositionAndRotation</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span> <span class="n">player</span><span class="p">.</span><span class="n">Rotation</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>最後に <code>GamingHubClient.cs</code> の StreamingHub クライアントを使用することで、StreamingHub サーバ経由でルームに参加したユーザ同士交流が出来るようにします。<br>
そのために <code>GameClient.cs</code> を追加します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Assets/Scripts/GameClient.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Grpc.Core</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">GameClient</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="c1">// プレイヤーの Transform (今回はメインカメラの Transform を指定)</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span>
    <span class="n">Transform</span> <span class="n">m_PlayerTransform</span><span class="p">;</span>

    <span class="c1">// 部屋に参加するときに使用するユーザ名 (何でも設定可)</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span>
    <span class="kt">string</span> <span class="n">m_UserName</span><span class="p">;</span>

    <span class="c1">// 参加したい部屋のルーム名</span>
    <span class="c1">// (StreamingHub クライアント同士で交流したい場合は、</span>
    <span class="c1">// 各クライアントで同一の名前を設定する必要がある)</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span>
    <span class="kt">string</span> <span class="n">m_RoomName</span><span class="p">;</span>

    <span class="c1">// StreamingHub クライアントで使用する gRPC チャネルを生成</span>
    <span class="k">private</span> <span class="n">Channel</span> <span class="n">channel</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Channel</span><span class="p">(</span><span class="s">"localhost"</span><span class="p">,</span> <span class="m">12345</span><span class="p">,</span> <span class="n">ChannelCredentials</span><span class="p">.</span><span class="n">Insecure</span><span class="p">);</span>

    <span class="c1">// StreamingHub サーバと通信を行うためのクライアント生成</span>
    <span class="k">private</span> <span class="n">GamingHubClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GamingHubClient</span><span class="p">();</span>

    <span class="k">async</span> <span class="n">Task</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ゲーム起動時に設定した部屋名のルームに設定したユーザ名で入室する。</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">ConnectAsync</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">channel</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">m_RoomName</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">m_UserName</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Update is called once per frame</span>
    <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 毎フレームプレイヤーの位置(Vector3) と回転(Quaternion) を更新し、</span>
        <span class="c1">// ルームに入室している他ユーザ全員にブロードキャスト送信する</span>
        <span class="n">client</span><span class="p">.</span><span class="nf">MoveAsync</span><span class="p">(</span><span class="n">m_PlayerTransform</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">m_PlayerTransform</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="n">Task</span> <span class="nf">OnDestroy</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// GameClient が破棄される際の StreamingHub クライアント及び gRPC チャネルの解放処理</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">LeaveAsync</span><span class="p">();</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">DisposeAsync</span><span class="p">();</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">channel</span><span class="p">.</span><span class="nf">ShutdownAsync</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
</div>

<p>あとは <code>GameClient.cs</code> をメインカメラにアタッチして <code>SerializeField</code> の中身をお好みで設定していただければ完成です！ <sup id="fnref1"><a href="#fn1" title="具体的に言うと StreamingHub クライアント同士で m_RoomName は同一のものを設定します。m_UserName には好きな名前を設定していただいて構いません。m_PlayerTransform にはメインカメラで無くてもプレイヤーとして振る舞う GameObject のTransform を設定していただければ構いません。">1</a></sup></p>

<p>.NET で作成した StreamingHub サーバを動かした状態で、<br>
Unity プロジェクトを複製して、<br>
元の Unity プロジェクトと複製後の Unity プロジェクトを開いて両方 Run すると、<br>
<code>はじめに</code> で貼った gif のように動作するはずです。</p>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>C# は Unity アプリケーションを作成するときには触っていたのですが、<br>
C# でサーバサイドを書いた経験は初めてでした。(MagicOnion に完全に乗っかった形ですが。。)</p>

<p>感想としては、環境構築も楽でクロスプラットフォームでライブラリも充実している印象を受けたので、引き続き勉強を続けていきたいと思います。（少なくともマルチプレイの VR ゲームを作り終えるまでは。。<img alt=":fire:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f525.png" title=":fire:" width="20" loading="lazy">）</p>

<p>この記事が誰かのお役に立てれば幸いです。</p>

<h1>
<span id="余談-c-ライブラリの探し方" class="fragment"></span><a href="#%E4%BD%99%E8%AB%87-c-%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E6%8E%A2%E3%81%97%E6%96%B9"><i class="fa fa-link"></i></a>余談: C# ライブラリの探し方</h1>

<p>C# で開発中に自分が使用したいライブラリが出てきたら、<br>
<code>dotnet add package &lt;パッケージ名&gt;</code> でプロジェクトに追加していくことが可能です。</p>

<p>使用したいライブラリを検索する際は <a href="https://www.nuget.org/" rel="nofollow noopener" target="_blank">nuget</a> を使用します。<br>
<code>Search for packages...</code> の検索欄からライブラリを検索することが可能です。<br>
実際にプロジェクトに追加する際の <code>&lt;パッケージ名&gt;</code> はライブラリを選択後に出てくる、<br>
<code>.NET CLI</code> タブをクリックすることで確認出来ます。↓ は MagicOnion の例。<br>
<a href="https://camo.qiitausercontent.com/04a1859cb66a8e69f38b5cc4752f48ede8a8026c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f38363037302f31386230653066332d336366652d363233662d663735622d6230646634323538396535392e706e67" target="_blank" rel="nofollow noopener"><img width="1301" alt="スクリーンショット 2019-06-18 16.05.17.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2F18b0e0f3-3cfe-623f-f75b-b0df42589e59.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5bd30bea105b4ae2e7343379482c14c3" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/86070/18b0e0f3-3cfe-623f-f75b-b0df42589e59.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2F18b0e0f3-3cfe-623f-f75b-b0df42589e59.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e2e16462c37c75e18fae483ac91c57ed 1x" loading="lazy"></a></p>

<h1>
<span id="参考リンク" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF"><i class="fa fa-link"></i></a>参考リンク</h1>

<p><a href="https://qiita.com/rookx/items/6086b9426f3138a4b700" class="autolink">https://qiita.com/rookx/items/6086b9426f3138a4b700</a><br>
<a href="http://ryuichi111std.hatenablog.com/entry/2017/08/15/153804" class="autolink" rel="nofollow noopener" target="_blank">http://ryuichi111std.hatenablog.com/entry/2017/08/15/153804</a><br>
<a href="https://simplestar-tech.hatenablog.com/entry/2019/05/19/192801" class="autolink" rel="nofollow noopener" target="_blank">https://simplestar-tech.hatenablog.com/entry/2019/05/19/192801</a><br>
<a href="http://tech.cygames.co.jp/archives/3181/" class="autolink" rel="nofollow noopener" target="_blank">http://tech.cygames.co.jp/archives/3181/</a><br>
<a href="https://qiita.com/mitchydeath/items/cecf01493d1efeb4ae55" class="autolink" id="reference-e63a95646cdb119659da">https://qiita.com/mitchydeath/items/cecf01493d1efeb4ae55</a></p>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>具体的に言うと StreamingHub クライアント同士で m_RoomName は同一のものを設定します。m_UserName には好きな名前を設定していただいて構いません。m_PlayerTransform にはメインカメラで無くてもプレイヤーとして振る舞う GameObject のTransform を設定していただければ構いません。 <a href="#fnref1">↩</a></p>
</li>

</ol>
</div>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fnikaera%2Fitems%2F3d2a9d6015b13840097f&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fnikaera%2Fitems%2F3d2a9d6015b13840097f&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/nikaera/items/3d2a9d6015b13840097f/likers" class="css-1iupg5d">19</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">16</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3d2a9d6015b13840097f/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/nikaera/items/3d2a9d6015b13840097f/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/nikaera/items/3d2a9d6015b13840097f/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/nikaera/items/3d2a9d6015b13840097f/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/nikaera/items/3d2a9d6015b13840097f.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-bd2d3a17-a93d-423c-a8ba-a876c6cdf881">{"authorAnalyticsTrackingId":"UA-33707296-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-b0fe19f1-bc39-47ec-9606-c80340274e75"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-b0fe19f1-bc39-47ec-9606-c80340274e75">{}</script>
      
<div id="LoginModal-react-component-121cbc00-d725-4b39-887e-640c65a6ae86"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-121cbc00-d725-4b39-887e-640c65a6ae86">{}</script>
      
<div id="StockModal-react-component-4d30df00-7cf3-4a84-b6f2-26d288587666"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-4d30df00-7cf3-4a84-b6f2-26d288587666">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;0tp5GWhrQ4czxysCgwugQYIdAl/jnchZglZu0tttKQ1hdtzMgDkKozTXtx+eQ1Av4EOj4jxQMAMPiEVMdl1h+g==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eマルチプレイ可能な VR ゲームを作ることに興味が湧いてきたので、\u003cbr\u003e\nC# の勉強も兼ねて MagicOnion を使用して開発していくことにしました\u003cimg alt=\":metal:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f918.png\" title=\":metal:\" width=\"20\" loading=\"lazy\"\u003e\u003c/p\u003e\n\n\u003cp\u003eMagicOnion を調査したところ、どうやら StreamingHub を使うことで、\u003cbr\u003e\nサーバークライアント間でのリアルタイム通信を簡単に実装出来そうなことが分かりました。\u003c/p\u003e\n\n\u003cp\u003eそこで MagicOnion の README にある \u003ca href=\"https://github.com/Cysharp/MagicOnion#streaminghub\" rel=\"nofollow noopener\" target=\"_blank\"\u003eStreamingHub のサンプル\u003c/a\u003e を動かしてみました ↓\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/5ec3e86480da28e9f49de2f6181a7933e6215da7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f38363037302f33656538633332392d373635302d663035622d373035652d6161636330633962366132352e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2F3ee8c329-7650-f05b-705e-aacc0c9b6a25.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=30787f8b010e3cab778e00960c5b940b\" alt=\"output.gif\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/86070/3ee8c329-7650-f05b-705e-aacc0c9b6a25.gif\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2F3ee8c329-7650-f05b-705e-aacc0c9b6a25.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b0dc605104afa1b7e4fef7e0c7c6d0a3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e余談ですが、今まで C# でサーバサイドのプログラミング経験が無く、先入観で、\u003cbr\u003e\n「C# で作ったプログラムは Windows OS 環境でないと気軽に動かせないのでは？」と思ってしまっていました。。。\u003c/p\u003e\n\n\u003cp\u003eしかし、MagicOnion の開発環境を構築していく過程で、全然 Mac でも気軽に開発を進めていけることが分かりました。\u003cbr\u003e\nそのため、例え Mac 使ってても C# の開発に億劫になる必要は全く無いよと伝えたく記事を書くことにしました。（めっちゃ今更感あるかもしれませんが。。）\u003c/p\u003e\n\n\u003cp\u003e記事の中で間違っている部分/表現等あれば、有識者の方々にご指摘いただけると非常にありがたいです \u003cimg alt=\":bow:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f647.png\" title=\":bow:\" width=\"20\" loading=\"lazy\"\u003e (特に記事内で紹介しているソースコード内のコメントアウトの内容とか。。。)\u003c/p\u003e\n\n\u003cp\u003eちなみに MagicOnion + Unity + VRM でマルチプレイを実現するためのやりかたは、\u003cbr\u003e\n既に素晴らしい記事が存在していますので \u003ca href=\"/simplestar\" class=\"user-mention js-hovercard\" title=\"simplestar\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"simplestar\"\u003e@simplestar\u003c/a\u003e さんの \u003ca href=\"https://simplestar-tech.hatenablog.com/entry/2019/05/19/192801\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちらの記事\u003c/a\u003e を見たほうが圧倒的に良いです。\u003c/p\u003e\n\n\u003cp\u003e本記事では初心者も詰まらずシンプルに StreamingHub のサンプルが動かせて、\u003cbr\u003e\nとにかくマルチプレイのサンプルが動かせるようにすることを目指しています。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"動作環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8B%95%E4%BD%9C%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e動作環境\u003c/h1\u003e\n\n\u003cp\u003e今回は ↓ の環境で作業を行いました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eStreamingHub サーバ\n\n\u003cul\u003e\n\u003cli\u003e.NET Core 2.2.300\u003c/li\u003e\n\u003cli\u003eMagicOnion 2.1.2\u003c/li\u003e\n\u003cli\u003eMagicOnion.Hosting 2.1.2\u003c/li\u003e\n\u003cli\u003eMessagePack.UnityShims 1.7.3.7\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eStreamingHub クライアント\n\n\u003cul\u003e\n\u003cli\u003eUnity 2019.1.4f1\u003c/li\u003e\n\u003cli\u003eMagicOnion 2.1.2\u003c/li\u003e\n\u003cli\u003egRPC 1.22.0\u003c/li\u003e\n\u003cli\u003eMessagePack 1.7.3.5\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"c-の開発環境を構築する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c-%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC# の開発環境を構築する\u003c/h1\u003e\n\n\u003cp\u003eまずは ↓ のリンクから .NET SDK をダウンロードしてきます。\u003cbr\u003e\n\u003ca href=\"https://dotnet.microsoft.com/download\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://dotnet.microsoft.com/download\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/7130907e03d25c486bfbfc1067759754d2c01739/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f38363037302f37356230643732632d353435382d313532372d623565642d3734383261366336373234612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"1302\" alt=\"スクリーンショット 2019-06-18 14.14.06.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2F75b0d72c-5458-1527-b5ed-7482a6c6724a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d0ad0db966f8af6235f334adce991d04\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/86070/75b0d72c-5458-1527-b5ed-7482a6c6724a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2F75b0d72c-5458-1527-b5ed-7482a6c6724a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0f149a2fe1dd3e7b9df1d60f99e7b19d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eダウンロードが完了したら、\u003ccode\u003edotnet-sdk-X.X.XXX-osx-x64.pkg\u003c/code\u003e を開いて .NET SDK をインストールします。\u003c/p\u003e\n\n\u003cp\u003e正常にインストールが完了したら、ターミナルを開き \u003ccode\u003edotnet\u003c/code\u003e コマンドが実行可能な状態か確認します\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e# .NET の SDK バージョンを出力\u003c/span\u003e\ndotnet \u003cspan class=\"nt\"\u003e--version\u003c/span\u003e\n2.2.300\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e上記の通りバージョン情報が標準出力されれば、開発のための準備は完了です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"net-のプロジェクトで-streaminghub-サーバを作る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#net-%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7-streaminghub-%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e.NET のプロジェクトで StreamingHub サーバを作る\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"/rookx\" class=\"user-mention js-hovercard\" title=\"rookx\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"rookx\"\u003e@rookx\u003c/a\u003e さんの \u003ca href=\"https://qiita.com/rookx/items/6086b9426f3138a4b700\" id=\"reference-52884fcae2cb84a7a52e\"\u003e.NET CoreでMagicOnionを動かしてみた\u003c/a\u003e を参考にプロジェクトのセットアップを行います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003emkdir \u003c/span\u003eServer\n\u003cspan class=\"nb\"\u003ecd \u003c/span\u003eServer\n\u003cspan class=\"c\"\u003e# .NET のコンソールアプリケーションを作成\u003c/span\u003e\ndotnet new console\n\u003cspan class=\"c\"\u003e# 本記事の内容を動かすのに必要な MagicOnion 関連パッケージを追加\u003c/span\u003e\ndotnet add package MagicOnion\ndotnet add package MagicOnion.Hosting\n\u003cspan class=\"c\"\u003e# MessagePack で Unity の Vector3 や Quaternion を扱う際に必要となるパッケージを追加\u003c/span\u003e\ndotnet add package MessagePack.UnityShims\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれだけで今回のプロジェクトのセットアップは完了です。\u003c/p\u003e\n\n\u003cp\u003eあとは MagicOnion 関連のソースコードを書きながら、\u003cbr\u003e\n都度 \u003ccode\u003edotnet run\u003c/code\u003e コマンドで動作検証を進めていける状態です。\u003c/p\u003e\n\n\u003cp\u003e現状の Server フォルダの中身は ↓ の構成になっているはずです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e.\n└── Server\n    ├── Program.cs\n    ├── Server.csproj\n    ├── Server.sln\n    ├── bin\n    └── obj\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまずは Program.cs の中身を MagicOnion の \u003ca href=\"https://nuget.pkg.github.com/Cysharp/MagicOnion/blob/master/README.md#hosting\" rel=\"nofollow noopener\" target=\"_blank\"\u003eREADME の内容\u003c/a\u003e に従って書き換えます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eServer/Program.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.Extensions.Hosting\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMagicOnion.Hosting\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMagicOnion.Server\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eGrpc.Core\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// MagicOnion を await で起動するため、非同期 Main で定義\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// await でサーバーを起動しないと、即 Main 関数が終了してしまうため\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// gRPC のログをコンソールに出力するよう設定\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eGrpcEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetLogger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eGrpc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLogging\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConsoleLogger\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// isReturnExceptionStackTraceInErrorDetail に true を設定して\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// エラー発生時のメッセージがコンソールに出力されるようにする\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// MagicOnion サーバーが localhost:12345 で Listen する\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eMagicOnionHost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateDefaultBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUseMagicOnion\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMagicOnionOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eisReturnExceptionStackTraceInErrorDetail\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eServerPort\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"localhost\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e12345\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eServerCredentials\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInsecure\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunConsoleAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eあとは実際にサーバークライアント間でリアルタイム通信を行うために必要なソースコードを追加していきます。\u003cbr\u003e\nまずは StreamingHub の通信周りの定義を記述した \u003ccode\u003eIGamingHub.cs\u003c/code\u003e を追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eServer/IGamingHub.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMagicOnion\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// MessagePack.UnityShims を利用することで、\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Unity の Vector3 や Quaternion を通信でやり取りすることが可能になる\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMessagePack\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// サーバで gRPC が実行された際に、\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 実行結果をクライアントに返すためのコールバック関数を定義する\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIGamingHubReceiver\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnJoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnLeave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnMove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// クライアントがサーバ側で gRPC 実行可能な関数を定義する\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIGamingHub\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIStreamingHub\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIGamingHub\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIGamingHubReceiver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003e]\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eJoinAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eroomName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euserName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e \u003cspan class=\"n\"\u003erotation\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeaveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e \u003cspan class=\"n\"\u003erotation\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// gRPC 通信で独自に定義したメッセージ Player を扱うための宣言\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Player はプレイヤー名, 位置(Vector3), 回転(Quaternion) の変数を所持している\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eMessagePackObject\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ePlayer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eKey\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eKey\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003ePosition\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eKey\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e \u003cspan class=\"n\"\u003eRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e次に \u003ccode\u003eIGamingHub.cs\u003c/code\u003e の定義内容のサーバ側を実装した \u003ccode\u003eGamingHub.cs\u003c/code\u003e を追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eServer/GamingHub.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMagicOnion.Server.Hubs\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// IGamingHub の実装が記述された GamingHub クラス\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eGamingHub\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eStreamingHubBase\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIGamingHub\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIGamingHubReceiver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;,\u003c/span\u003e \u003cspan class=\"n\"\u003eIGamingHub\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// IGroup を使用することで同一のグループに所属している他ユーザ全員に対して\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 一斉にブロードキャスト送信を行うことが出来る (オンラインゲームで言うルームの概念)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIGroup\u003c/span\u003e \u003cspan class=\"n\"\u003eroom\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// ルーム内での自分の情報 (IGamingHub.cs で定義した Player の情報)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"n\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// ルームに入室しているユーザ全員（自分も含む）の情報を保持して扱うための変数\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIInMemoryStorage\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003estorage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 指定したルームに入室するための関数\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 入室するルーム名及び、ユーザ自身の情報(ユーザ名,位置(Vector3),回転(Quaternion)) を引数に取る\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003e]\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eJoinAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eroomName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euserName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e \u003cspan class=\"n\"\u003erotation\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eself\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePlayer\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003euserName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePosition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erotation\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// ルームにユーザが入室する\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estorage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eGroup\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroomName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// ルームに入室している他ユーザ全員に\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 入室したユーザの情報をブロードキャスト送信する\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eBroadcast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroom\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnJoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// ルームに入室している他ユーザ全員の情報を配列で取得する\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003estorage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAllValues\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// ユーザがルームから退出する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeaveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eroom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRemoveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContext\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// ルームに入室している他ユーザ全員に\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ルームから退出したことをユーザの情報と共にブロードキャスト送信する\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eBroadcast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroom\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnLeave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// ユーザがルームの中で動く\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e \u003cspan class=\"n\"\u003erotation\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 動いたユーザの位置(xyz) と回転(quaternion) を設定する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRotation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erotation\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 動いたユーザの最新の位置(Vector3)と回転(Quaternion) を\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ルームに入室している他ユーザ全員にユーザの最新情報 (Player) をブロードキャスト送信する\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eBroadcast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroom\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnMove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e現状の Server フォルダの中身は ↓ の構成になっているはずです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e.\n└── Server\n    ├── GamingHub.cs\n    ├── IGamingHub.cs\n    ├── Program.cs\n    ├── Server.csproj\n    ├── Server.sln\n    ├── bin\n    └── obj\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの状態で Server フォルダ上で \u003ccode\u003edotnet run\u003c/code\u003e を実行してみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003edotnet run\n\nGamingHub.cs\u003cspan class=\"o\"\u003e(\u003c/span\u003e37,23\u003cspan class=\"o\"\u003e)\u003c/span\u003e: warning CS1998: この非同期メソッドには \u003cspan class=\"s1\"\u003e'await'\u003c/span\u003e 演算子がないため、同期的に実行されます。\u003cspan class=\"s1\"\u003e'await'\u003c/span\u003e 演算子を使用して非ブロッキング API 呼び出しを待機するか、\u003cspan class=\"s1\"\u003e'await Task.Run(...)'\u003c/span\u003e を使用してバックグラウンドのスレッドに対して CPU 主体の処理を実行することを検討してください。 \u003cspan class=\"o\"\u003e[\u003c/span\u003e/Users/nika/Desktop/MagicOnion/Server/Server.csproj]\nD0618 19:33:16.355504 Grpc.Core.Internal.UnmanagedLibrary Attempting to load native library \u003cspan class=\"s2\"\u003e\"/Users/nika/.nuget/packages/grpc.core/1.20.1/lib/netstandard2.0/../../runtimes/osx/native/libgrpc_csharp_ext.x64.dylib\"\u003c/span\u003e\nD0618 19:33:16.400266 Grpc.Core.Internal.NativeExtension gRPC native library loaded successfully.\nApplication started. Press Ctrl+C to shut down.\nHosting environment: Production\nContent root path: /Users/nika/.nuget/packages/magiconion.hosting/2.1.2/lib/netstandard2.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e警告が出てきましたが、\u003ca href=\"http://neue.cc/2017/04/06_551.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこれは無視で大丈夫です\u003c/a\u003e\u003cbr\u003e\n正常に実行されればエラーは発生せず、ターミナルが待機状態になるはずです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"unity-プロジェクトで-streaminghub-クライアントを作る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unity-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7-streaminghub-%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUnity プロジェクトで StreamingHub クライアントを作る\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"/mitchydeath\" class=\"user-mention js-hovercard\" title=\"mitchydeath\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"mitchydeath\"\u003e@mitchydeath\u003c/a\u003e さんの \u003ca href=\"https://qiita.com/mitchydeath/items/cecf01493d1efeb4ae55#1unity%E5%81%B4%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89\" id=\"reference-e63a95646cdb119659da\"\u003eUnity+MagicOnionで超絶手軽にリアルタイム通信を実装してみた\u003c/a\u003e に沿って Unity プロジェクトに MagicOnion をセットアップしておきます。\u003c/p\u003e\n\n\u003cp\u003eセットアップ完了次第、Unity プロジェクトの Assets/Scripts フォルダに StreamingHub クライアント用のスクリプトを追加していきます。\u003ccode\u003eIGamingHub.cs\u003c/code\u003e は Unity 側でもクライアント側の実装を行うために必要になるので、Assets/Scripts フォルダに追加しておきます。\u003c/p\u003e\n\n\u003cp\u003eまた \u003ccode\u003eIGamingHub.cs\u003c/code\u003e の定義内容のクライアント側を実装した \u003ccode\u003eGamingHubClient.cs\u003c/code\u003e を追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eAssets/Scripts/GamingHubClient.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eGrpc.Core\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMagicOnion.Client\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// IGamingHubReceiver の実装が記述された GamingHubClient クラス\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eGamingHubClient\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIGamingHubReceiver\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 部屋に参加しているユーザ全員の GameObject (アバター)を保持する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eGameObject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eplayers\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eGameObject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// サーバ側の関数を実行するための変数\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIGamingHub\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 指定したルームに入室するための関数\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// StreamingHubClient で使用する gRPC チャネル及び、参加したい部屋名、使用するユーザ名を引数に指定する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eGameObject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eConnectAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eChannel\u003c/span\u003e \u003cspan class=\"n\"\u003egrpcChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eroomName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// サーバ側の関数を実行するための StreamingHubClient を生成する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eclient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eStreamingHubClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIGamingHub\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIGamingHubReceiver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003egrpcChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// JoinAsync 関数を実行して部屋に入室すると同時に、\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 既に入室済みのユーザ全員の情報を配列で取得する\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eroomPlayers\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eJoinAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroomName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eidentity\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 自ユーザ以外を OnJoin 関数に渡して、\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// this.players に部屋の他ユーザ全員の情報をセットする\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 自ユーザの情報は await で JoinAsync を実行した段階で、\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// OnJoin がコールバックで呼ばれているためセット済みの状態となっている\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eroomPlayers\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eIGamingHubReceiver\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnJoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 自ユーザの情報を返却する\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eplayers\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eplayerName\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 部屋から退出し、部屋の他ユーザ全員に退出したことをブロードキャスト送信する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeaveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLeaveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 自ユーザの位置(Vector3) と回転(Quaternion) を更新すると同時に\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 部屋の他ユーザ全員にブロードキャスト送信する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e \u003cspan class=\"n\"\u003erotation\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMoveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erotation\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// StreamingHubClient の解放処理\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// gRPC のチャネルを破棄する前に実行する必要がある\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eDisposeAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDisposeAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 部屋に新しいユーザが入室したときに呼び出される関数\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// または ConnectAsync 関数を実行したときに呼び出される関数\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIGamingHubReceiver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnJoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ユーザの GameObject (アバター)を Player 情報を元に生成して\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// this.players に player.Name をキーにして保持する\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 部屋に入室しているユーザの数だけワールド上にキューブを出現する\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecube\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGameObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreatePrimitive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePrimitiveType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCube\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecube\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecube\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetPositionAndRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eplayers\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecube\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 他ユーザが部屋から退出した際に呼び出される関数\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIGamingHubReceiver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnLeave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// this.players に保持していた GameObject (アバター)を破棄する\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ワールド上から該当する GameObject (アバター)のキューブが消滅する\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecube\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eGameObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecube\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 部屋の中でいずれかのユーザが動いたときに呼び出される関数\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIGamingHubReceiver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnMove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 引数の player の Name を元に this.players 内から GameObject を取得する\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ワールド上の該当する GameObject (アバター)の位置(Vector3)と回転(Quaternion) の値を最新のものに更新する\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecube\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecube\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetPositionAndRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e最後に \u003ccode\u003eGamingHubClient.cs\u003c/code\u003e の StreamingHub クライアントを使用することで、StreamingHub サーバ経由でルームに参加したユーザ同士交流が出来るようにします。\u003cbr\u003e\nそのために \u003ccode\u003eGameClient.cs\u003c/code\u003e を追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eAssets/Scripts/GameClient.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eGrpc.Core\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eGameClient\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonoBehaviour\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// プレイヤーの Transform (今回はメインカメラの Transform を指定)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eTransform\u003c/span\u003e \u003cspan class=\"n\"\u003em_PlayerTransform\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 部屋に参加するときに使用するユーザ名 (何でも設定可)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003em_UserName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 参加したい部屋のルーム名\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// (StreamingHub クライアント同士で交流したい場合は、\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 各クライアントで同一の名前を設定する必要がある)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003em_RoomName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// StreamingHub クライアントで使用する gRPC チャネルを生成\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eChannel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"localhost\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e12345\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eChannelCredentials\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInsecure\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// StreamingHub サーバと通信を行うためのクライアント生成\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eGamingHubClient\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eGamingHubClient\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ゲーム起動時に設定した部屋名のルームに設定したユーザ名で入室する。\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnectAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003em_RoomName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003em_UserName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Update is called once per frame\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 毎フレームプレイヤーの位置(Vector3) と回転(Quaternion) を更新し、\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ルームに入室している他ユーザ全員にブロードキャスト送信する\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMoveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em_PlayerTransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003em_PlayerTransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erotation\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// GameClient が破棄される際の StreamingHub クライアント及び gRPC チャネルの解放処理\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLeaveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDisposeAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShutdownAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eあとは \u003ccode\u003eGameClient.cs\u003c/code\u003e をメインカメラにアタッチして \u003ccode\u003eSerializeField\u003c/code\u003e の中身をお好みで設定していただければ完成です！ \u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"具体的に言うと StreamingHub クライアント同士で m_RoomName は同一のものを設定します。m_UserName には好きな名前を設定していただいて構いません。m_PlayerTransform にはメインカメラで無くてもプレイヤーとして振る舞う GameObject のTransform を設定していただければ構いません。\"\u003e1\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\n\u003cp\u003e.NET で作成した StreamingHub サーバを動かした状態で、\u003cbr\u003e\nUnity プロジェクトを複製して、\u003cbr\u003e\n元の Unity プロジェクトと複製後の Unity プロジェクトを開いて両方 Run すると、\u003cbr\u003e\n\u003ccode\u003eはじめに\u003c/code\u003e で貼った gif のように動作するはずです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h1\u003e\n\n\u003cp\u003eC# は Unity アプリケーションを作成するときには触っていたのですが、\u003cbr\u003e\nC# でサーバサイドを書いた経験は初めてでした。(MagicOnion に完全に乗っかった形ですが。。)\u003c/p\u003e\n\n\u003cp\u003e感想としては、環境構築も楽でクロスプラットフォームでライブラリも充実している印象を受けたので、引き続き勉強を続けていきたいと思います。（少なくともマルチプレイの VR ゲームを作り終えるまでは。。\u003cimg alt=\":fire:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f525.png\" title=\":fire:\" width=\"20\" loading=\"lazy\"\u003e）\u003c/p\u003e\n\n\u003cp\u003eこの記事が誰かのお役に立てれば幸いです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"余談-c-ライブラリの探し方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%99%E8%AB%87-c-%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E6%8E%A2%E3%81%97%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e余談: C# ライブラリの探し方\u003c/h1\u003e\n\n\u003cp\u003eC# で開発中に自分が使用したいライブラリが出てきたら、\u003cbr\u003e\n\u003ccode\u003edotnet add package \u0026lt;パッケージ名\u0026gt;\u003c/code\u003e でプロジェクトに追加していくことが可能です。\u003c/p\u003e\n\n\u003cp\u003e使用したいライブラリを検索する際は \u003ca href=\"https://www.nuget.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003enuget\u003c/a\u003e を使用します。\u003cbr\u003e\n\u003ccode\u003eSearch for packages...\u003c/code\u003e の検索欄からライブラリを検索することが可能です。\u003cbr\u003e\n実際にプロジェクトに追加する際の \u003ccode\u003e\u0026lt;パッケージ名\u0026gt;\u003c/code\u003e はライブラリを選択後に出てくる、\u003cbr\u003e\n\u003ccode\u003e.NET CLI\u003c/code\u003e タブをクリックすることで確認出来ます。↓ は MagicOnion の例。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/04a1859cb66a8e69f38b5cc4752f48ede8a8026c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f38363037302f31386230653066332d336366652d363233662d663735622d6230646634323538396535392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"1301\" alt=\"スクリーンショット 2019-06-18 16.05.17.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2F18b0e0f3-3cfe-623f-f75b-b0df42589e59.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5bd30bea105b4ae2e7343379482c14c3\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/86070/18b0e0f3-3cfe-623f-f75b-b0df42589e59.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2F18b0e0f3-3cfe-623f-f75b-b0df42589e59.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e2e16462c37c75e18fae483ac91c57ed 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考リンク\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考リンク\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/rookx/items/6086b9426f3138a4b700\" class=\"autolink\"\u003ehttps://qiita.com/rookx/items/6086b9426f3138a4b700\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"http://ryuichi111std.hatenablog.com/entry/2017/08/15/153804\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://ryuichi111std.hatenablog.com/entry/2017/08/15/153804\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://simplestar-tech.hatenablog.com/entry/2019/05/19/192801\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://simplestar-tech.hatenablog.com/entry/2019/05/19/192801\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"http://tech.cygames.co.jp/archives/3181/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://tech.cygames.co.jp/archives/3181/\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/mitchydeath/items/cecf01493d1efeb4ae55\" class=\"autolink\" id=\"reference-e63a95646cdb119659da\"\u003ehttps://qiita.com/mitchydeath/items/cecf01493d1efeb4ae55\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003e具体的に言うと StreamingHub クライアント同士で m_RoomName は同一のものを設定します。m_UserName には好きな名前を設定していただいて構いません。m_PlayerTransform にはメインカメラで無くてもプレイヤーとして振る舞う GameObject のTransform を設定していただければ構いません。 \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","createdAt":"2019-06-18T13:45:20Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"F4oFZiVcvkuCInHMkgwqvdLW8/sUSYkk--7gYenSW4pl+S95di--h8s2G5yhWZ51KVZeGY4IDQ==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2019-06-18T16:08:25Z","likesCount":19,"linkUrl":"https://qiita.com/nikaera/items/3d2a9d6015b13840097f","organization":null,"originalId":932350,"stockedCount":16,"title":"[Unity] MagicOnion で StreamingHub のサンプルを動かしてみた on Mac","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8B%95%E4%BD%9C%E7%92%B0%E5%A2%83\"\u003e動作環境\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#c-%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B\"\u003eC# の開発環境を構築する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#net-%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7-streaminghub-%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e.NET のプロジェクトで StreamingHub サーバを作る\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unity-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7-streaminghub-%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B\"\u003eUnity プロジェクトで StreamingHub クライアントを作る\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003eおわりに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%99%E8%AB%87-c-%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E6%8E%A2%E3%81%97%E6%96%B9\"\u003e余談: C# ライブラリの探し方\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF\"\u003e参考リンク\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":4587,"uuid":"3d2a9d6015b13840097f","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"atVbBwO2SO2+7l2m9e9pe3qdmwc=--M4la7uLjCDSQqTax--lNCLqtKxYkF5ioK+IgS0dA==","originalId":86070,"description":"様々な技術領域に関心のある雑食系エンジニアです。自分の記事が誰かのお役に立てば幸いです。Babylon.js/Serverless/TypeScript/React/Amplify/Unity","facebookUrl":null,"githubUrl":"https://github.com/nikaera","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/86070/profile-images/1589826426","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2Fprofile-images%2F1589826426?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=00f37d4b0133f3645f1a341cd524df4a","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F86070%2Fprofile-images%2F1589826426?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=41b1b75ea8bde517f4f1795a94e23ef8","urlName":"nikaera","websiteUrl":"https://nikaera.com","twitterUrl":"https://twitter.com/n1kaera","twitterUrlName":"n1kaera","revealedOrganizations":{"edges":[{"node":{"encryptedId":"B9NvHn5ru7LY8yYsgePM7VMlC4xSZKQbNOs=--Ku8nNZJpSxiaqFvq--vhZwBse+CnaGyjN3F6TgWA==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"Unityゲーム開発者ギルド","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","urlName":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。","url":"https://unity-game-dev-guild.github.io/"}},{"node":{"encryptedId":"dUmUkF9DZZeWg5bGJF+g31Y8+T5lCAYjqek=--+u7wPb9no8E09Z39--vPplMAGK03aEBj5WasPydg==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"カディンチェ株式会社","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/2f6875f5cd25e44bd343396a4b59bc1c379f764c/original.jpg?1570665178","urlName":"kadinche","description":"弊社では 2008年の会社設立当初から、一貫して VR ソリューションの研究開発に取り組んでいます。","url":"https://www.kadinche.com/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":".NET","urlName":".net"},{"name":"Unity","urlName":"unity"},{"name":"gRPC","urlName":"grpc"},{"name":"MagicOnion","urlName":"magiconion"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

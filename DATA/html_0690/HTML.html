<!DOCTYPE html><html><head><meta charset="utf-8" /><title>[C#] C++/WinRTのブリッジを作ってC#から呼び出す方法 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/everylittle/items/cb95b24eb9462ddb3cfc" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="o9o+AMtaICWqKfjk6+ttpq8Z02EKEtHe3n9LuPFtGRjVYiTrKu8c6bf+XZVD446RtVbNnQpTu303MXiGQ3LqTQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@hira_elt" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="[C#] C++/WinRTのブリッジを作ってC#から呼び出す方法 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XME1qWFNCREt5c3ZWMmx1VWxUamdhN2pnNWJqZzZyamc0UGpncmpqZ3BMa3ZaempnYVBqZ2FaREktT0JpLU9DaWVXUnZPT0JzLVdIdXVPQm1lYVd1ZWF6bFEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MTcwYWVkZjlkNWM4YjA5NTJmZjRhOGI0OTEwYjI5M2Q&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR1YyWlhKNWJHbDBkR3hsJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9MjY4ZWJmMjM2ZmMxYzQyZjc5ZDQ3ZjhhM2E2MjZkY2Q&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=2069112904ea66fb8996a855c894c8a1"><meta property="og:description" content="

はじめに

Windows 10では、UWP（ストアアプリ、ネイティブアプリ）から使えるいろいろな新しいAPI (WinRT) が追加されています。
強力な機能は魅力的ですが、UWPアプリはサンドボックス内で実行されるので、セキュ..."><meta content="https://qiita.com/everylittle/items/cb95b24eb9462ddb3cfc" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C++,C#,WinRT" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-0221a514-1ce0-48e5-a546-1481fb9fee46"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Feverylittle%2Fitems%2Fcb95b24eb9462ddb3cfc">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Feverylittle%2Fitems%2Fcb95b24eb9462ddb3cfc">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-0221a514-1ce0-48e5-a546-1481fb9fee46">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/cpp","name":"C++"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-09-27T16:29:52.000+09:00","dateModified":"2020-10-01T23:19:30.000+09:00","headline":"[C#] C++/WinRTのブリッジを作ってC#から呼び出す方法","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XME1qWFNCREt5c3ZWMmx1VWxUamdhN2pnNWJqZzZyamc0UGpncmpqZ3BMa3ZaempnYVBqZ2FaREktT0JpLU9DaWVXUnZPT0JzLVdIdXVPQm1lYVd1ZWF6bFEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MTcwYWVkZjlkNWM4YjA5NTJmZjRhOGI0OTEwYjI5M2Q\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR1YyWlhKNWJHbDBkR3hsJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9MjY4ZWJmMjM2ZmMxYzQyZjc5ZDQ3ZjhhM2E2MjZkY2Q\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=2069112904ea66fb8996a855c894c8a1","mainEntityOfPage":"https://qiita.com/everylittle/items/cb95b24eb9462ddb3cfc","author":{"@type":"Person","address":"","email":null,"identifier":"everylittle","name":"everylittle","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F204084%2Fprofile-images%2F1544604030?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=ca805aa914ba8d1c5bf5ab7a497a739f","url":"https://qiita.com/everylittle","description":"PythonやWebプログラミングなどのTipsをメモ代わりに投稿しています。たまに機械学習の話題もあります。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"everylittle","type":"items","id":"cb95b24eb9462ddb3cfc"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"everylittle","type":"items","id":"cb95b24eb9462ddb3cfc"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"everylittle","type":"items","id":"cb95b24eb9462ddb3cfc"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/everylittle/items/cb95b24eb9462ddb3cfc","location":"/everylittle/items/cb95b24eb9462ddb3cfc","scheme":"https","host":"qiita.com","port":null,"pathname":"/everylittle/items/cb95b24eb9462ddb3cfc","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"tK+yYl5Gz7pqfmVxIIIosrwazj3iSEll/ZSpnOUAiJ7CF6iJv/PzdnepwACIisuFplXQweIJI8YU2pqiVx97yw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-6bd8ac3c-803f-41db-81e5-cd278ef71681"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/everylittle/items/cb95b24eb9462ddb3cfc/likers" class="css-1iupg5d">4</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">6</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/cb95b24eb9462ddb3cfc/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/everylittle/items/cb95b24eb9462ddb3cfc/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/everylittle/items/cb95b24eb9462ddb3cfc/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/everylittle/items/cb95b24eb9462ddb3cfc/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/everylittle/items/cb95b24eb9462ddb3cfc.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/everylittle"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/204084/profile-images/1544604030" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/everylittle" class="css-10ougpm">@<!-- -->everylittle</a><div class="css-1ay9vb9"><span><meta content="2020-09-27T07:29:52Z"/><time dateTime="2020-10-01T14:19:30Z" class="css-m19uds">updated at 2020-10-01</time></span></div></div></div></div></div><h1 class="css-cgzq40">[C#] C++/WinRTのブリッジを作ってC#から呼び出す方法</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/cpp" class="css-4czcte">C++</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/winrt" class="css-4czcte">WinRT</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>Windows 10では、UWP（ストアアプリ、ネイティブアプリ）から使えるいろいろな新しいAPI (WinRT) が追加されています。<br>
強力な機能は魅力的ですが、UWPアプリはサンドボックス内で実行されるので、セキュリティによって実装に制約が生じたり、スタートメニューからしか起動できない、社内などの他の人への配布が大変（ストア経由でないアプリを使うためには設定が必要）と、少々使いづらい点もあります。<br>
そこで、<strong>Windowsの普通の（exeをダブルクリックして起動できる）デスクトップアプリから、WinRTの機能を「つまみ食い」できると便利だと思います。</strong></p>

<p>そのための仕組みとして「C++/WinRT」があります。</p>

<ul>
<li><a href="https://docs.microsoft.com/ja-jp/windows/uwp/cpp-and-winrt-apis/intro-to-using-cpp-with-winrt" rel="nofollow noopener" target="_blank">C++/WinRT の概要 - UWP applications | Microsoft Docs</a></li>
<li><a href="https://blog.okazuki.jp/entry/2018/10/16/144556" rel="nofollow noopener" target="_blank">ネイティブの C++ から UWP の API を呼ぶ (C++/WinRT を使って) - かずきのBlog@hatena</a></li>
<li><a href="https://qiita.com/yottui/items/390bf7582fa1abb42766" id="reference-367c365faef5f3a4a5e0">C++/WinRTの始め方 - Qiita</a></li>
</ul>

<p>しかし、アプリをUI部分も含めて全部ネイティブのC++で書くのは大変なので、C#のフォームアプリから呼び出せると都合がよいと思うわけです。<br>
そこで、<strong>C++/WinRTでブリッジのライブラリを作成し、C#からそのクラスを参照させることによって、C#からWinRTの恩恵にあずかる方法を紹介します。</strong></p>

<p>後の公式サンプルのreadmeによると、この機能が使えるのは「new feature in Windows Builds 18309+」ということなので、<strong>Windows 10 バージョン1903以降</strong>で使える機能ということになります。</p>

<h1>
<span id="開発環境" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>開発環境</h1>

<ul>
<li>Windows 10 Home 1903</li>
<li>Visual Studio Community 2019</li>
</ul>

<h1>
<span id="事前準備" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>事前準備</h1>

<p>Visual Studio Installerからコンポーネントを追加します。</p>

<ul>
<li>ワークロード: 以下の3つにチェック

<ul>
<li>.NETデスクトップ開発</li>
<li>C++によるデスクトップ開発</li>
<li>ユニバーサルWindowsプラットフォーム開発</li>
</ul>
</li>
<li>個別のコンポーネント

<ul>
<li>Windows 10 SDK (10.0.18362.0以降を1つ以上)</li>
<li>（他にもあったかどうか忘れました…）</li>
</ul>
</li>
</ul>

<p>さらに、C++/WinRT開発のためのVSIXをインストールしておきます。<br>
<a href="https://marketplace.visualstudio.com/items?itemName=CppWinRTTeam.cppwinrt101804264" rel="nofollow noopener" target="_blank">C++/WinRT - Visual Studio Marketplace</a></p>

<h1>
<span id="公式サンプルの動作確認" class="fragment"></span><a href="#%E5%85%AC%E5%BC%8F%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>公式サンプルの動作確認</h1>

<p>C++/WinRTブリッジを介したC#フォームアプリの作成方法については、Microsoftから公式サンプルが提供されています。<br>
<a href="https://github.com/microsoft/RegFree_WinRT" rel="nofollow noopener" target="_blank">microsoft/RegFree_WinRT: Sample Code showing use of Registration-free WinRT to access a 3rd party native WinRT Component from a non-packaged Desktop app</a></p>

<p>まずは RegFree_WinRT/CS/RegFree_WinRT.sln をビルド・実行できることを確認しましょう。<br>
<a href="https://camo.qiitausercontent.com/31a8b6c4734ec11ba7a47a6bfe4d2593795d6196/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3230343038342f35343239636664612d613333302d646535632d623237312d6339633830663264363932382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F5429cfda-a330-de5c-b271-c9c80f2d6928.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=813dbd65f268b062a447a408fd95cda1" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/204084/5429cfda-a330-de5c-b271-c9c80f2d6928.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F5429cfda-a330-de5c-b271-c9c80f2d6928.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=49aef7a5b63bc27371e3307ef2479c46 1x" loading="lazy"></a></p>

<h1>
<span id="自分でブリッジを書く" class="fragment"></span><a href="#%E8%87%AA%E5%88%86%E3%81%A7%E3%83%96%E3%83%AA%E3%83%83%E3%82%B8%E3%82%92%E6%9B%B8%E3%81%8F"><i class="fa fa-link"></i></a>自分でブリッジを書く</h1>

<p>いよいよここからが本番です。以下がMS公式のドキュメント。<br>
<a href="https://blogs.windows.com/windowsdeveloper/2019/04/30/enhancing-non-packaged-desktop-apps-using-windows-runtime-components/" rel="nofollow noopener" target="_blank">Enhancing Non-packaged Desktop Apps using Windows Runtime Components - Windows Developer Blog</a></p>

<p>新しいソリューションに、以下2つのプロジェクトを追加します。</p>

<ul>
<li>Windows Runtime Component (C++/WinRT)

<ul>
<li>ブリッジを書くためのプロジェクトになります。</li>
<li>名前はとりあえずデフォルトの RuntimeComponent1</li>
<li>Windowsのターゲットバージョンは1903以降で。</li>
</ul>
</li>
<li>WPF アプリ (.NET Framework) または Windows フォーム アプリケーション (.NET Framework)

<ul>
<li>アプリのメインのプロジェクトになります。</li>
<li>名前はとりあえずデフォルトの WpfApp1</li>
<li>対象のフレームワークは .NET Framework 4.7.2</li>
</ul>
</li>
</ul>

<h2>
<span id="cwinrt側" class="fragment"></span><a href="#cwinrt%E5%81%B4"><i class="fa fa-link"></i></a>C++/WinRT側</h2>

<p>最初に何も変更せずに一度ビルドしておきます。するといくつかのファイルが自動生成されます。<br>
IntelliSenseのエラーが気になりますが、ソリューションを開き直すと改善します。</p>

<p>ここで自分のコードを記述するときに変更する必要があるのが、以下の4ファイルです。</p>

<ul>
<li>Class.h</li>
<li>Class.cpp</li>
<li>Class.idl</li>
<li>pch.h</li>
</ul>

<h3>
<span id="classh-classcpp" class="fragment"></span><a href="#classh-classcpp"><i class="fa fa-link"></i></a>Class.h, Class.cpp</h3>

<p>これは普通のC++のクラスを書くときにもおなじみのペアですね。<br>
基本的にはデフォルトで書かれているコードを真似してメソッドやプロパティを追加していけばよいです。<br>
サンプルの <code>MyProperty</code> を改造してプロパティを実装し、さらにメソッドを新しく1つ追加しておきます。</p>

<div class="code-frame" data-lang="c++">
<div class="code-lang"><span class="bold">Class.h</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cp">#pragma once
</span>
<span class="cp">#include "Class.g.h"
</span>
<span class="k">namespace</span> <span class="n">winrt</span><span class="o">::</span><span class="n">RuntimeComponent1</span><span class="o">::</span><span class="n">implementation</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="nc">Class</span> <span class="o">:</span> <span class="n">ClassT</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&gt;</span>
    <span class="p">{</span>
        <span class="n">Class</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">initial</span><span class="p">);</span> <span class="c1">// 変更</span>
        <span class="kt">int32_t</span> <span class="n">MyProperty</span><span class="p">();</span>
        <span class="kt">void</span> <span class="n">MyProperty</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">value</span><span class="p">);</span>
        <span class="kt">int32_t</span> <span class="n">MyMethod</span><span class="p">();</span>     <span class="c1">// 追加</span>
    <span class="nl">private:</span>
        <span class="kt">int32_t</span> <span class="n">_value</span><span class="p">;</span>         <span class="c1">// 追加</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// この中は触らなくてOK</span>
<span class="k">namespace</span> <span class="n">winrt</span><span class="o">::</span><span class="n">RuntimeComponent1</span><span class="o">::</span><span class="n">factory_implementation</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="nc">Class</span> <span class="o">:</span> <span class="n">ClassT</span><span class="o">&lt;</span><span class="n">Class</span><span class="p">,</span> <span class="n">implementation</span><span class="o">::</span><span class="n">Class</span><span class="o">&gt;</span>
    <span class="p">{</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="c++">
<div class="code-lang"><span class="bold">Class.cpp</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cp">#include "pch.h"
#include "Class.h"
#include "Class.g.cpp"
</span>
<span class="k">namespace</span> <span class="n">winrt</span><span class="o">::</span><span class="n">RuntimeComponent1</span><span class="o">::</span><span class="n">implementation</span>
<span class="p">{</span>
    <span class="c1">// コンストラクタ</span>
    <span class="n">Class</span><span class="o">::</span><span class="n">Class</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">initial</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_value</span> <span class="o">=</span> <span class="n">initial</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// プロパティ (get)</span>
    <span class="kt">int32_t</span> <span class="n">Class</span><span class="o">::</span><span class="n">MyProperty</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_value</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// プロパティ (set)</span>
    <span class="kt">void</span> <span class="n">Class</span><span class="o">::</span><span class="n">MyProperty</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_value</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// メソッド</span>
    <span class="kt">int32_t</span> <span class="n">Class</span><span class="o">::</span><span class="n">MyMethod</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_value</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h3>
<span id="classidl" class="fragment"></span><a href="#classidl"><i class="fa fa-link"></i></a>Class.idl</h3>

<p>Microsoft インターフェイス定義言語 (MIDL) で書かれているファイルです。<br>
C#のアプリからブリッジを参照したときにIntelliSenseで表示されるクラス定義を、このファイルによって与えるということのようです。<br>
（Class.cpp, Class.h だけだと普通のネイティブC++のクラスなので、C#から参照するための情報は入っていないみたいです）<br>
<a href="https://docs.microsoft.com/ja-jp/uwp/midl-3/intro" rel="nofollow noopener" target="_blank">Microsoft インターフェイス定義言語3.0 の概要 - Windows UWP applications | Microsoft Docs</a></p>

<p>書き方はC++に似ています。</p>

<div class="code-frame" data-lang="c++">
<div class="code-lang"><span class="bold">Class.idl</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="n">RuntimeComponent1</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">default_interface</span><span class="p">]</span>
    <span class="n">runtimeclass</span> <span class="n">Class</span>
    <span class="p">{</span>
        <span class="n">Class</span><span class="p">(</span><span class="n">Int32</span> <span class="n">initial</span><span class="p">);</span> <span class="c1">// 変更</span>
        <span class="n">Int32</span> <span class="n">MyProperty</span><span class="p">;</span>
        <span class="n">Int32</span> <span class="n">MyMethod</span><span class="p">();</span>     <span class="c1">// 追加</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<ul>
<li>
<code>Class(Int32 initial);</code>

<ul>
<li>コンストラクタ（引数名を value にするとエラーになったので名前を変えました）</li>
</ul>
</li>
<li>
<code>Int32 MyProperty;</code>

<ul>
<li>引数リストをつけないとプロパティ扱い</li>
</ul>
</li>
<li>
<code>Int32 MyMethod();</code>

<ul>
<li>引数リストをつけるとメソッド扱い</li>
</ul>
</li>
</ul>

<p>引数と戻り値のデータ型は、C++で使われるものとは違っていますが、名前から直感的に対応が類推できます。基本の数値データ型には以下があります。（前記公式ドキュメントより）</p>

<ul>
<li>Int16</li>
<li>Int32</li>
<li>Int64</li>
<li>UInt8</li>
<li>UInt16</li>
<li>UInt32</li>
<li>UInt64</li>
<li>Single</li>
<li>Double</li>
</ul>

<h3>
<span id="pchh" class="fragment"></span><a href="#pchh"><i class="fa fa-link"></i></a>pch.h</h3>

<p>WinRTなどのヘッダファイルを追加する必要があるときに、このファイルに <code>#include</code> 文を追加します。<br>
今回はデフォルトのまま置いておきます。</p>

<p>ここまでの変更を加えたあと、ビルドができることを確認します。</p>

<h2>
<span id="c側" class="fragment"></span><a href="#c%E5%81%B4"><i class="fa fa-link"></i></a>C#側</h2>

<p>C#プロジェクトのデフォルトのプラットフォームは Any CPU になっていますが、x64 または Win32 に変えておいてください。RuntimeComponent1と合わせておきます（RuntimeComponent1がx86の場合は、WpfApp1側はWin32）。<br>
<a href="https://camo.qiitausercontent.com/149eb67b4fe69b9a9e37cc4372062f4d72e6497a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3230343038342f65623330393662302d323133342d646463312d343664632d6630653436636135643466352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2Feb3096b0-2134-ddc1-46dc-f0e46ca5d4f5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d94d735712ef989088093626b77cafeb" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/204084/eb3096b0-2134-ddc1-46dc-f0e46ca5d4f5.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2Feb3096b0-2134-ddc1-46dc-f0e46ca5d4f5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9edc2ef33fb929380d80b825d587b166 1x" loading="lazy"></a><br>
WpfApp1から、先ほど作成したRuntimeComponent1を参照します。<br>
<a href="https://camo.qiitausercontent.com/17dc9beb4b656c8b673542906294407fb7d28e71/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3230343038342f38346436656239332d656338382d656635362d613230612d3633393938346466393431612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F84d6eb93-ec88-ef56-a20a-639984df941a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=54106771f14a4b78fa9706332c0c5e57" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/204084/84d6eb93-ec88-ef56-a20a-639984df941a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F84d6eb93-ec88-ef56-a20a-639984df941a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9b91a9a845cf27ca74fb0ca35acc0e41 1x" loading="lazy"></a><br>
これによって <code>RuntimeComponent1</code> という名前空間が見えるようになり、その下にある <code>Class</code> というクラスにアクセスできるはずです。</p>

<p>フォームに適当にボタンを配置し、ボタンを押したらクラスを使って何か処理させてみます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">MainWindows.xaml.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cm">/* Button_Click() 以外のコードは省略 */</span>
        <span class="k">private</span> <span class="k">void</span> <span class="nf">Button_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">cls</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RuntimeComponent1</span><span class="p">.</span><span class="nf">Class</span><span class="p">(</span><span class="m">100</span><span class="p">);</span>
            <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="n">cls</span><span class="p">.</span><span class="n">MyProperty</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
            <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="n">cls</span><span class="p">.</span><span class="nf">MyMethod</span><span class="p">().</span><span class="nf">ToString</span><span class="p">());</span>
            <span class="n">cls</span><span class="p">.</span><span class="n">MyProperty</span> <span class="p">=</span> <span class="m">200</span><span class="p">;</span>
            <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="n">cls</span><span class="p">.</span><span class="n">MyProperty</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
            <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="n">cls</span><span class="p">.</span><span class="nf">MyMethod</span><span class="p">().</span><span class="nf">ToString</span><span class="p">());</span>
        <span class="p">}</span>
</code></pre></div>
</div>

<p>確かに <code>RuntimeComponent1.Class</code> が見えるようになりました。</p>

<p>しかし、この状態ではビルドは通りますが、実行時にエラーが発生します。</p>

<blockquote>
<p>System.TypeLoadException: '要求された Windows ランタイム型 'RuntimeComponent1.Class' は登録されていません。'</p>
</blockquote>

<p>MSのサンプルを見ればわかりますが、実はC#側にも「<code>RuntimeComponent1.Class</code> の実装はこのDLLに入っていますよ」という情報を追加してあげないといけません。<br>
プロジェクトに「アプリケーション マニフェスト ファイル」を追加します。<br>
<a href="https://camo.qiitausercontent.com/1396aa0c278334602a4431399195e6d82985b27d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3230343038342f32373063653566392d313962342d373166652d653235352d6438353233646531353039302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F270ce5f9-19b4-71fe-e255-d8523de15090.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=29efb479dda32e59571b5c9ac91b18ad" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/204084/270ce5f9-19b4-71fe-e255-d8523de15090.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F270ce5f9-19b4-71fe-e255-d8523de15090.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4282d6a139215e86ed6af912c4af11d3 1x" loading="lazy"></a></p>

<p>今回作成したブリッジと、そこに含まれているクラスの情報を追加します。</p>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">app.manifest</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;assembly</span> <span class="na">manifestVersion=</span><span class="s">"1.0"</span> <span class="na">xmlns=</span><span class="s">"urn:schemas-microsoft-com:asm.v1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;assemblyIdentity</span> <span class="na">version=</span><span class="s">"1.0.0.0"</span> <span class="na">name=</span><span class="s">"MyApplication.app"</span><span class="nt">/&gt;</span>
  （略）
    <span class="nt">&lt;file</span> <span class="na">name=</span><span class="s">"RuntimeComponent1.dll"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;activatableClass</span>
            <span class="na">name=</span><span class="s">"RuntimeComponent1.Class"</span>
            <span class="na">threadingModel=</span><span class="s">"both"</span>
            <span class="na">xmlns=</span><span class="s">"urn:schemas-microsoft-com:winrt.v1"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/file&gt;</span>
<span class="nt">&lt;/assembly&gt;</span>
</code></pre></div>
</div>

<ul>
<li>複数のブリッジライブラリがある場合は、その数だけ <code>&lt;file&gt;...&lt;/file&gt;</code> を追加</li>
<li>1つのライブラリの中に複数のクラスがある場合は、<code>&lt;activatableClass&gt;</code> を追加</li>
</ul>

<p>さらに、C++側で作ったDLLは「VCRT Forwarders」を参照して動くので、C#のexeと同じ場所にこれらのDLLがないといけません。<br>
NuGetパッケージマネージャーから「Microsoft.VCRTForwarders.140」を追加しておくと、C#側のビルド時にexeと同じ場所に必要なDLLがコピーされるようになります。</p>

<h2>
<span id="実行" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>実行</h2>

<p>ウィンドウに配置したボタンを押して 100, 200, 200, 400 の順にメッセージが表示されたら成功です。</p>

<h1>
<span id="応用例" class="fragment"></span><a href="#%E5%BF%9C%E7%94%A8%E4%BE%8B"><i class="fa fa-link"></i></a>応用例</h1>

<p>ここまでの例では、C++/WinRTのブリッジと言いながら、WinRTの機能を全く使っていませんでした。<br>
ということで、実際にWinRTを呼び出す例も見てみましょう。</p>

<p>日本語の形態素解析（文章を単語単位に分割する）APIがあるので、それを使ってみます。<br>
<a href="https://docs.microsoft.com/ja-jp/uwp/api/windows.globalization.japanesephoneticanalyzer?view=winrt-19041" rel="nofollow noopener" target="_blank">JapanesePhoneticAnalyzer Class (Windows.Globalization) - Windows UWP applications | Microsoft Docs</a></p>

<p>与えられた文章に対して、単語リストを返すようなメソッドを作ります。</p>

<h2>
<span id="cwinrt側-1" class="fragment"></span><a href="#cwinrt%E5%81%B4-1"><i class="fa fa-link"></i></a>C++/WinRT側</h2>

<h3>
<span id="classh" class="fragment"></span><a href="#classh"><i class="fa fa-link"></i></a>Class.h</h3>

<div class="code-frame" data-lang="c++">
<div class="code-lang"><span class="bold">Class.h</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cp">#pragma once
</span>
<span class="cp">#include "Class.g.h"
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">winrt</span><span class="o">::</span><span class="n">Windows</span><span class="o">::</span><span class="n">Foundation</span><span class="o">::</span><span class="n">Collections</span><span class="p">;</span>

<span class="k">namespace</span> <span class="n">winrt</span><span class="o">::</span><span class="n">RuntimeComponent1</span><span class="o">::</span><span class="n">implementation</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="nc">Class</span> <span class="o">:</span> <span class="n">ClassT</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&gt;</span>
    <span class="p">{</span>
        <span class="n">Class</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> <span class="c1">// デフォルトコンストラクタ</span>
        <span class="k">static</span> <span class="n">IVectorView</span><span class="o">&lt;</span><span class="n">hstring</span><span class="o">&gt;</span> <span class="n">Class</span><span class="o">::</span><span class="n">Analyze</span><span class="p">(</span><span class="n">hstring</span> <span class="n">text</span><span class="p">);</span> <span class="c1">// static指定も可能</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="n">winrt</span><span class="o">::</span><span class="n">RuntimeComponent1</span><span class="o">::</span><span class="n">factory_implementation</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="nc">Class</span> <span class="o">:</span> <span class="n">ClassT</span><span class="o">&lt;</span><span class="n">Class</span><span class="p">,</span> <span class="n">implementation</span><span class="o">::</span><span class="n">Class</span><span class="o">&gt;</span>
    <span class="p">{</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>Class.h で <code>Class() = default;</code> と書いておくと、処理のないデフォルトコンストラクタを使うことができます。Class.cpp にもコンストラクタの記述は必要ありません。<br>
リストを返すには <code>using namespace winrt::Windows::Foundation::Collections;</code> を書いた上で <code>IVectorView&lt;T&gt;</code> インターフェイスを使うことができます。これはC# (.NET) 側から参照すると <code>IReadOnlyList&lt;T&gt;</code> に見えます。<sup id="fnref1"><a href="#fn1" title="Windows.Foundation.Collections Namespace - Windows UWP applications | Microsoft Docs">1</a></sup><br>
また、Unicode文字列を扱うときは <code>hstring</code> 型を使います。C# (.NET) 側から参照すると <code>string</code> に見えます。</p>

<h3>
<span id="classcpp" class="fragment"></span><a href="#classcpp"><i class="fa fa-link"></i></a>Class.cpp</h3>

<div class="code-frame" data-lang="c++">
<div class="code-lang"><span class="bold">Class.cpp</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cp">#include "pch.h"
#include "Class.h"
#include "Class.g.cpp"
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">winrt</span><span class="o">::</span><span class="n">Windows</span><span class="o">::</span><span class="n">Foundation</span><span class="o">::</span><span class="n">Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">winrt</span><span class="o">::</span><span class="n">Windows</span><span class="o">::</span><span class="n">Globalization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="n">winrt</span><span class="o">::</span><span class="n">RuntimeComponent1</span><span class="o">::</span><span class="n">implementation</span>
<span class="p">{</span>
    <span class="n">IVectorView</span><span class="o">&lt;</span><span class="n">hstring</span><span class="o">&gt;</span> <span class="n">Class</span><span class="o">::</span><span class="n">Analyze</span><span class="p">(</span><span class="n">hstring</span> <span class="n">text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">words</span> <span class="o">=</span> <span class="n">JapanesePhoneticAnalyzer</span><span class="o">::</span><span class="n">GetWords</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">winrt</span><span class="o">::</span><span class="n">single_threaded_vector</span><span class="o">&lt;</span><span class="n">hstring</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">word</span> <span class="o">=</span> <span class="n">words</span><span class="p">.</span><span class="n">First</span><span class="p">();</span> <span class="n">word</span><span class="p">.</span><span class="n">HasCurrent</span><span class="p">();</span> <span class="n">word</span><span class="p">.</span><span class="n">MoveNext</span><span class="p">()){</span>
            <span class="n">result</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span><span class="n">word</span><span class="p">.</span><span class="n">Current</span><span class="p">().</span><span class="n">DisplayText</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="n">GetView</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>使用したい機能に合わせて適切に <code>using namespace</code> を記述してください。<br>
また <code>winrt::single_threaded_vector&lt;hstring&gt;()</code> を使って <code>IVector</code> オブジェクトの実体を作っています。これを忘れると、NULLポインタアクセスになってアクセス違反となります。</p>

<h3>
<span id="classidl-1" class="fragment"></span><a href="#classidl-1"><i class="fa fa-link"></i></a>Class.idl</h3>

<div class="code-frame" data-lang="c++">
<div class="code-lang"><span class="bold">Class.idl</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="n">RuntimeComponent1</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">default_interface</span><span class="p">]</span>
    <span class="n">runtimeclass</span> <span class="n">Class</span>
    <span class="p">{</span>
        <span class="n">Class</span><span class="p">();</span>
        <span class="k">static</span> <span class="n">Windows</span><span class="p">.</span><span class="n">Foundation</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">IVectorView</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">Analyze</span><span class="p">(</span><span class="n">String</span> <span class="n">text</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>idlでクラスの名前空間を書くときはドット区切り (<code>Windows.Foundation.Collections.IVectorView</code>) になります。<br>
また、文字列型はidlでは <code>String</code> となります。</p>

<h3>
<span id="pchh-1" class="fragment"></span><a href="#pchh-1"><i class="fa fa-link"></i></a>pch.h</h3>

<div class="code-frame" data-lang="c++">
<div class="code-lang"><span class="bold">pch.h</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cp">#pragma once
#include &lt;unknwn.h&gt;
#include &lt;winrt/Windows.Foundation.h&gt;
#include &lt;winrt/Windows.Foundation.Collections.h&gt;
#include &lt;winrt/Windows.Globalization.h&gt;
</span></code></pre></div>
</div>

<p>使いたい機能に合わせてヘッダファイルの記述を追加します。</p>

<h2>
<span id="c側-1" class="fragment"></span><a href="#c%E5%81%B4-1"><i class="fa fa-link"></i></a>C#側</h2>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">MainWindows.xaml.cs</span></div>
<div class="highlight"><pre class="with-code"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">Button_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">RuntimeComponent1</span><span class="p">.</span><span class="n">Class</span><span class="p">.</span><span class="nf">Analyze</span><span class="p">(</span><span class="s">"本日は晴天なり"</span><span class="p">);</span>
            <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="s">","</span><span class="p">,</span> <span class="n">result</span><span class="p">));</span>
        <span class="p">}</span>
</code></pre></div>
</div>

<p>C#側のプロジェクトで、参照にC++側のプロジェクトを追加してビルド・実行し、「本日,は,晴天,なり」と単語単位で区切られたメッセージが出たら成功です。<br>
<a href="https://camo.qiitausercontent.com/c81e7769f977ffa31b74849b5b2ad3e39df8515b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3230343038342f66643463373332302d393634662d616266332d623439372d3062353633643665306131392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2Ffd4c7320-964f-abf3-b497-0b563d6e0a19.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8f807ab364166f7988b631794ffae79c" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/204084/fd4c7320-964f-abf3-b497-0b563d6e0a19.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2Ffd4c7320-964f-abf3-b497-0b563d6e0a19.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d74d9c665bdf442b50eccd244f55be84 1x" loading="lazy"></a></p>

<h2>
<span id="身も蓋もない話" class="fragment"></span><a href="#%E8%BA%AB%E3%82%82%E8%93%8B%E3%82%82%E3%81%AA%E3%81%84%E8%A9%B1"><i class="fa fa-link"></i></a>身も蓋もない話</h2>

<p>正直この程度だったらブリッジを作るまでもなくて、以下の方法でもっと手軽にできたりします。<br>
<a href="https://qiita.com/everylittle/items/62ce313fe09883c6da5f" id="reference-75dfe8a388340aea548f">[C#] デスクトップアプリ (WPF) から手軽にWinRT APIを活用しよう - Qiita</a></p>

<p>ただポインタやATLなど色々触り出すと、下手にC#で書くよりC++でブリッジを作ったほうがたぶん楽です。</p>

<h1>
<span id="トラブルシューティング" class="fragment"></span><a href="#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>トラブルシューティング</h1>

<h2>
<span id="ブリッジクラスがc側から見えない" class="fragment"></span><a href="#%E3%83%96%E3%83%AA%E3%83%83%E3%82%B8%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%8Cc%E5%81%B4%E3%81%8B%E3%82%89%E8%A6%8B%E3%81%88%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>ブリッジクラスがC#側から見えない</h2>

<p>C#側から参照にC++プロジェクトを追加していても見えない場合は、idlファイルの記述をご確認ください。<br>
idlファイルを編集したら「リビルド」したほうが良いです。</p>

<h2>
<span id="エラー-c2660-winrtruntimecomponent1implementationclassmymethod-関数に-1-個の引数を指定できません" class="fragment"></span><a href="#%E3%82%A8%E3%83%A9%E3%83%BC-c2660-winrtruntimecomponent1implementationclassmymethod-%E9%96%A2%E6%95%B0%E3%81%AB-1-%E5%80%8B%E3%81%AE%E5%BC%95%E6%95%B0%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%9B%E3%82%93"><i class="fa fa-link"></i></a>エラー C2660 'winrt::RuntimeComponent1::implementation::Class::MyMethod': 関数に 1 個の引数を指定できません。</h2>

<p>Class.idl に書いた名前と引数で呼び出せるメソッドが、Class.cpp, Class.h 側に定義されていないと思われます。（オーバーロードは可能ですが、idlの記述に不足がないようにご注意ください）</p>

<h2>
<span id="systemtypeloadexception-要求された-windows-ランタイム型-runtimecomponent1class-は登録されていません" class="fragment"></span><a href="#systemtypeloadexception-%E8%A6%81%E6%B1%82%E3%81%95%E3%82%8C%E3%81%9F-windows-%E3%83%A9%E3%83%B3%E3%82%BF%E3%82%A4%E3%83%A0%E5%9E%8B-runtimecomponent1class-%E3%81%AF%E7%99%BB%E9%8C%B2%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%BE%E3%81%9B%E3%82%93"><i class="fa fa-link"></i></a>System.TypeLoadException: '要求された Windows ランタイム型 'RuntimeComponent1.Class' は登録されていません。'</h2>

<p>app.manifest の <code>&lt;file&gt;</code> や <code>&lt;activatableClass&gt;</code> の記述が不足しているようです。</p>

<h2>
<span id="systembadimageformatexception--は有効な-win32-アプリケーションではありません-hresult-からの例外0x800700c1" class="fragment"></span><a href="#systembadimageformatexception--%E3%81%AF%E6%9C%89%E5%8A%B9%E3%81%AA-win32-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E3%81%AF%E3%81%82%E3%82%8A%E3%81%BE%E3%81%9B%E3%82%93-hresult-%E3%81%8B%E3%82%89%E3%81%AE%E4%BE%8B%E5%A4%960x800700c1"><i class="fa fa-link"></i></a>System.BadImageFormatException: ' は有効な Win32 アプリケーションではありません。 (HRESULT からの例外:0x800700C1)'</h2>

<p>C++側とC#側のプラットフォーム設定が合っていないみたいです。x64同士、またはx86/Win32の組み合わせであることを確認してください。前述のように Any CPU はダメです。</p>

<h2>
<span id="systemiofilenotfoundexception-指定されたモジュールが見つかりません-hresult-からの例外0x8007007e" class="fragment"></span><a href="#systemiofilenotfoundexception-%E6%8C%87%E5%AE%9A%E3%81%95%E3%82%8C%E3%81%9F%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%8C%E8%A6%8B%E3%81%A4%E3%81%8B%E3%82%8A%E3%81%BE%E3%81%9B%E3%82%93-hresult-%E3%81%8B%E3%82%89%E3%81%AE%E4%BE%8B%E5%A4%960x8007007e"><i class="fa fa-link"></i></a>System.IO.FileNotFoundException: '指定されたモジュールが見つかりません。 (HRESULT からの例外:0x8007007E)'</h2>

<p>まずは RuntimeComponent1 のビルドが成功していて、C#側のプロジェクトで指定したexeの出力先と同じ場所に RuntimeComponent1.dll がコピーされているか確認してください。<br>
もし RuntimeComponent1.dll があるのにこのエラーが出るときは、VCRT ForwardersのDLLが見つからないのが原因と思われます。</p>

<ul>
<li>NuGetパッケージマネージャーの設定で、既定のパッケージ管理方法を「Packages.config」にする</li>
<li>C#側のプロジェクトに Microsoft.VCRTForwarders.140 を追加する（既に追加されている場合で、後からPackages.configの設定を変えたときは、VCRTForwardersを一度削除して再度追加する）</li>
</ul>

<p>ビルドしたあとに <code>bin\x64\Debug</code> の下などに <code>msvcp140</code> や <code>vcruntime140</code> などの名前で始まるDLLが大量にコピーされたら成功です。<br>
<a href="https://camo.qiitausercontent.com/bedd8c993f3fc7edd8c698a28220532f50a5aec4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3230343038342f30663735653163632d383731352d663362612d306439652d3665666366663565633864382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F0f75e1cc-8715-f3ba-0d9e-6efcff5ec8d8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8d9d9646f94a900997076a7211aefe45" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/204084/0f75e1cc-8715-f3ba-0d9e-6efcff5ec8d8.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F0f75e1cc-8715-f3ba-0d9e-6efcff5ec8d8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f28c052a74ed264d2f1e19228af5aaf1 1x" loading="lazy"></a></p>

<h2>
<span id="0x00007ff90cd1dd44-runtimecomponent1dll-で例外がスローされました-wpfapp1exe-内-0xc0000005-場所-0x0000000000000000-の読み取り中にアクセス違反が発生しました" class="fragment"></span><a href="#0x00007ff90cd1dd44-runtimecomponent1dll-%E3%81%A7%E4%BE%8B%E5%A4%96%E3%81%8C%E3%82%B9%E3%83%AD%E3%83%BC%E3%81%95%E3%82%8C%E3%81%BE%E3%81%97%E3%81%9F-wpfapp1exe-%E5%86%85-0xc0000005-%E5%A0%B4%E6%89%80-0x0000000000000000-%E3%81%AE%E8%AA%AD%E3%81%BF%E5%8F%96%E3%82%8A%E4%B8%AD%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E9%81%95%E5%8F%8D%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F"><i class="fa fa-link"></i></a>0x00007FF90CD1DD44 (RuntimeComponent1.dll) で例外がスローされました (WpfApp1.exe 内): 0xC0000005: 場所 0x0000000000000000 の読み取り中にアクセス違反が発生しました</h2>

<p><code>IVector</code> の初期化ができているかご確認ください。<code>winrt::single_threaded_vector</code> をお忘れなく。</p>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p><a href="https://docs.microsoft.com/en-us/uwp/api/windows.foundation.collections?view=winrt-19041" rel="nofollow noopener" target="_blank">Windows.Foundation.Collections Namespace - Windows UWP applications | Microsoft Docs</a> <a href="#fnref1">↩</a></p>
</li>

</ol>
</div>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Feverylittle%2Fitems%2Fcb95b24eb9462ddb3cfc&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Feverylittle%2Fitems%2Fcb95b24eb9462ddb3cfc&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/everylittle/items/cb95b24eb9462ddb3cfc/likers" class="css-1iupg5d">4</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">6</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/cb95b24eb9462ddb3cfc/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/everylittle/items/cb95b24eb9462ddb3cfc/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/everylittle/items/cb95b24eb9462ddb3cfc/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/everylittle/items/cb95b24eb9462ddb3cfc/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/everylittle/items/cb95b24eb9462ddb3cfc.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-6bd8ac3c-803f-41db-81e5-cd278ef71681">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-e1b43b98-c6ed-4845-864a-3a89d68ed50e"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-e1b43b98-c6ed-4845-864a-3a89d68ed50e">{}</script>
      
<div id="LoginModal-react-component-63e56039-0844-4193-9fea-e6632ad98d1d"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-63e56039-0844-4193-9fea-e6632ad98d1d">{}</script>
      
<div id="StockModal-react-component-bf1d0b35-8f9b-4f6c-88fb-24fc4d5c389c"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-bf1d0b35-8f9b-4f6c-88fb-24fc4d5c389c">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;LQ+X13qBniAnkUWYKzPvIOw5lflza5jhxQWWPSA4R9pbt408mzSi7DpG4OmDOwwX9naLBXMq8kIsS6UDkie0jw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eWindows 10では、UWP（ストアアプリ、ネイティブアプリ）から使えるいろいろな新しいAPI (WinRT) が追加されています。\u003cbr\u003e\n強力な機能は魅力的ですが、UWPアプリはサンドボックス内で実行されるので、セキュリティによって実装に制約が生じたり、スタートメニューからしか起動できない、社内などの他の人への配布が大変（ストア経由でないアプリを使うためには設定が必要）と、少々使いづらい点もあります。\u003cbr\u003e\nそこで、\u003cstrong\u003eWindowsの普通の（exeをダブルクリックして起動できる）デスクトップアプリから、WinRTの機能を「つまみ食い」できると便利だと思います。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eそのための仕組みとして「C++/WinRT」があります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.microsoft.com/ja-jp/windows/uwp/cpp-and-winrt-apis/intro-to-using-cpp-with-winrt\" rel=\"nofollow noopener\" target=\"_blank\"\u003eC++/WinRT の概要 - UWP applications | Microsoft Docs\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.okazuki.jp/entry/2018/10/16/144556\" rel=\"nofollow noopener\" target=\"_blank\"\u003eネイティブの C++ から UWP の API を呼ぶ (C++/WinRT を使って) - かずきのBlog@hatena\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/yottui/items/390bf7582fa1abb42766\" id=\"reference-367c365faef5f3a4a5e0\"\u003eC++/WinRTの始め方 - Qiita\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eしかし、アプリをUI部分も含めて全部ネイティブのC++で書くのは大変なので、C#のフォームアプリから呼び出せると都合がよいと思うわけです。\u003cbr\u003e\nそこで、\u003cstrong\u003eC++/WinRTでブリッジのライブラリを作成し、C#からそのクラスを参照させることによって、C#からWinRTの恩恵にあずかる方法を紹介します。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e後の公式サンプルのreadmeによると、この機能が使えるのは「new feature in Windows Builds 18309+」ということなので、\u003cstrong\u003eWindows 10 バージョン1903以降\u003c/strong\u003eで使える機能ということになります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"開発環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e開発環境\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eWindows 10 Home 1903\u003c/li\u003e\n\u003cli\u003eVisual Studio Community 2019\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"事前準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e事前準備\u003c/h1\u003e\n\n\u003cp\u003eVisual Studio Installerからコンポーネントを追加します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eワークロード: 以下の3つにチェック\n\n\u003cul\u003e\n\u003cli\u003e.NETデスクトップ開発\u003c/li\u003e\n\u003cli\u003eC++によるデスクトップ開発\u003c/li\u003e\n\u003cli\u003eユニバーサルWindowsプラットフォーム開発\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e個別のコンポーネント\n\n\u003cul\u003e\n\u003cli\u003eWindows 10 SDK (10.0.18362.0以降を1つ以上)\u003c/li\u003e\n\u003cli\u003e（他にもあったかどうか忘れました…）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eさらに、C++/WinRT開発のためのVSIXをインストールしておきます。\u003cbr\u003e\n\u003ca href=\"https://marketplace.visualstudio.com/items?itemName=CppWinRTTeam.cppwinrt101804264\" rel=\"nofollow noopener\" target=\"_blank\"\u003eC++/WinRT - Visual Studio Marketplace\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"公式サンプルの動作確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%AC%E5%BC%8F%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e公式サンプルの動作確認\u003c/h1\u003e\n\n\u003cp\u003eC++/WinRTブリッジを介したC#フォームアプリの作成方法については、Microsoftから公式サンプルが提供されています。\u003cbr\u003e\n\u003ca href=\"https://github.com/microsoft/RegFree_WinRT\" rel=\"nofollow noopener\" target=\"_blank\"\u003emicrosoft/RegFree_WinRT: Sample Code showing use of Registration-free WinRT to access a 3rd party native WinRT Component from a non-packaged Desktop app\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eまずは RegFree_WinRT/CS/RegFree_WinRT.sln をビルド・実行できることを確認しましょう。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/31a8b6c4734ec11ba7a47a6bfe4d2593795d6196/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3230343038342f35343239636664612d613333302d646535632d623237312d6339633830663264363932382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F5429cfda-a330-de5c-b271-c9c80f2d6928.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=813dbd65f268b062a447a408fd95cda1\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/204084/5429cfda-a330-de5c-b271-c9c80f2d6928.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F5429cfda-a330-de5c-b271-c9c80f2d6928.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=49aef7a5b63bc27371e3307ef2479c46 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"自分でブリッジを書く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E5%88%86%E3%81%A7%E3%83%96%E3%83%AA%E3%83%83%E3%82%B8%E3%82%92%E6%9B%B8%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自分でブリッジを書く\u003c/h1\u003e\n\n\u003cp\u003eいよいよここからが本番です。以下がMS公式のドキュメント。\u003cbr\u003e\n\u003ca href=\"https://blogs.windows.com/windowsdeveloper/2019/04/30/enhancing-non-packaged-desktop-apps-using-windows-runtime-components/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eEnhancing Non-packaged Desktop Apps using Windows Runtime Components - Windows Developer Blog\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e新しいソリューションに、以下2つのプロジェクトを追加します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eWindows Runtime Component (C++/WinRT)\n\n\u003cul\u003e\n\u003cli\u003eブリッジを書くためのプロジェクトになります。\u003c/li\u003e\n\u003cli\u003e名前はとりあえずデフォルトの RuntimeComponent1\u003c/li\u003e\n\u003cli\u003eWindowsのターゲットバージョンは1903以降で。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eWPF アプリ (.NET Framework) または Windows フォーム アプリケーション (.NET Framework)\n\n\u003cul\u003e\n\u003cli\u003eアプリのメインのプロジェクトになります。\u003c/li\u003e\n\u003cli\u003e名前はとりあえずデフォルトの WpfApp1\u003c/li\u003e\n\u003cli\u003e対象のフレームワークは .NET Framework 4.7.2\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"cwinrt側\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cwinrt%E5%81%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC++/WinRT側\u003c/h2\u003e\n\n\u003cp\u003e最初に何も変更せずに一度ビルドしておきます。するといくつかのファイルが自動生成されます。\u003cbr\u003e\nIntelliSenseのエラーが気になりますが、ソリューションを開き直すと改善します。\u003c/p\u003e\n\n\u003cp\u003eここで自分のコードを記述するときに変更する必要があるのが、以下の4ファイルです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eClass.h\u003c/li\u003e\n\u003cli\u003eClass.cpp\u003c/li\u003e\n\u003cli\u003eClass.idl\u003c/li\u003e\n\u003cli\u003epch.h\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"classh-classcpp\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#classh-classcpp\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClass.h, Class.cpp\u003c/h3\u003e\n\n\u003cp\u003eこれは普通のC++のクラスを書くときにもおなじみのペアですね。\u003cbr\u003e\n基本的にはデフォルトで書かれているコードを真似してメソッドやプロパティを追加していけばよいです。\u003cbr\u003e\nサンプルの \u003ccode\u003eMyProperty\u003c/code\u003e を改造してプロパティを実装し、さらにメソッドを新しく1つ追加しておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c++\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eClass.h\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#pragma once\n\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#include \"Class.g.h\"\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eRuntimeComponent1\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eimplementation\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eClass\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eClassT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003einitial\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 変更\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003eMyProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eMyProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003eMyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// 追加\u003c/span\u003e\n    \u003cspan class=\"nl\"\u003eprivate:\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003e_value\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e         \u003cspan class=\"c1\"\u003e// 追加\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// この中は触らなくてOK\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eRuntimeComponent1\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003efactory_implementation\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eClass\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eClassT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eimplementation\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c++\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eClass.cpp\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#include \"pch.h\"\n#include \"Class.h\"\n#include \"Class.g.cpp\"\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eRuntimeComponent1\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eimplementation\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// コンストラクタ\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003einitial\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_value\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einitial\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// プロパティ (get)\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMyProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003e_value\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// プロパティ (set)\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMyProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_value\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// メソッド\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003e_value\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"classidl\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#classidl\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClass.idl\u003c/h3\u003e\n\n\u003cp\u003eMicrosoft インターフェイス定義言語 (MIDL) で書かれているファイルです。\u003cbr\u003e\nC#のアプリからブリッジを参照したときにIntelliSenseで表示されるクラス定義を、このファイルによって与えるということのようです。\u003cbr\u003e\n（Class.cpp, Class.h だけだと普通のネイティブC++のクラスなので、C#から参照するための情報は入っていないみたいです）\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/uwp/midl-3/intro\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMicrosoft インターフェイス定義言語3.0 の概要 - Windows UWP applications | Microsoft Docs\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e書き方はC++に似ています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c++\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eClass.idl\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003eRuntimeComponent1\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003edefault_interface\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eruntimeclass\u003c/span\u003e \u003cspan class=\"n\"\u003eClass\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInt32\u003c/span\u003e \u003cspan class=\"n\"\u003einitial\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 変更\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eInt32\u003c/span\u003e \u003cspan class=\"n\"\u003eMyProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eInt32\u003c/span\u003e \u003cspan class=\"n\"\u003eMyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// 追加\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eClass(Int32 initial);\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003eコンストラクタ（引数名を value にするとエラーになったので名前を変えました）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eInt32 MyProperty;\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003e引数リストをつけないとプロパティ扱い\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eInt32 MyMethod();\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003e引数リストをつけるとメソッド扱い\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e引数と戻り値のデータ型は、C++で使われるものとは違っていますが、名前から直感的に対応が類推できます。基本の数値データ型には以下があります。（前記公式ドキュメントより）\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eInt16\u003c/li\u003e\n\u003cli\u003eInt32\u003c/li\u003e\n\u003cli\u003eInt64\u003c/li\u003e\n\u003cli\u003eUInt8\u003c/li\u003e\n\u003cli\u003eUInt16\u003c/li\u003e\n\u003cli\u003eUInt32\u003c/li\u003e\n\u003cli\u003eUInt64\u003c/li\u003e\n\u003cli\u003eSingle\u003c/li\u003e\n\u003cli\u003eDouble\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"pchh\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pchh\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003epch.h\u003c/h3\u003e\n\n\u003cp\u003eWinRTなどのヘッダファイルを追加する必要があるときに、このファイルに \u003ccode\u003e#include\u003c/code\u003e 文を追加します。\u003cbr\u003e\n今回はデフォルトのまま置いておきます。\u003c/p\u003e\n\n\u003cp\u003eここまでの変更を加えたあと、ビルドができることを確認します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"c側\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E5%81%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC#側\u003c/h2\u003e\n\n\u003cp\u003eC#プロジェクトのデフォルトのプラットフォームは Any CPU になっていますが、x64 または Win32 に変えておいてください。RuntimeComponent1と合わせておきます（RuntimeComponent1がx86の場合は、WpfApp1側はWin32）。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/149eb67b4fe69b9a9e37cc4372062f4d72e6497a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3230343038342f65623330393662302d323133342d646463312d343664632d6630653436636135643466352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2Feb3096b0-2134-ddc1-46dc-f0e46ca5d4f5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d94d735712ef989088093626b77cafeb\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/204084/eb3096b0-2134-ddc1-46dc-f0e46ca5d4f5.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2Feb3096b0-2134-ddc1-46dc-f0e46ca5d4f5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9edc2ef33fb929380d80b825d587b166 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nWpfApp1から、先ほど作成したRuntimeComponent1を参照します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/17dc9beb4b656c8b673542906294407fb7d28e71/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3230343038342f38346436656239332d656338382d656635362d613230612d3633393938346466393431612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F84d6eb93-ec88-ef56-a20a-639984df941a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=54106771f14a4b78fa9706332c0c5e57\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/204084/84d6eb93-ec88-ef56-a20a-639984df941a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F84d6eb93-ec88-ef56-a20a-639984df941a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9b91a9a845cf27ca74fb0ca35acc0e41 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nこれによって \u003ccode\u003eRuntimeComponent1\u003c/code\u003e という名前空間が見えるようになり、その下にある \u003ccode\u003eClass\u003c/code\u003e というクラスにアクセスできるはずです。\u003c/p\u003e\n\n\u003cp\u003eフォームに適当にボタンを配置し、ボタンを押したらクラスを使って何か処理させてみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainWindows.xaml.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cm\"\u003e/* Button_Click() 以外のコードは省略 */\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eButton_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecls\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eRuntimeComponent1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClass\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMyProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMyProperty\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e200\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMyProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e確かに \u003ccode\u003eRuntimeComponent1.Class\u003c/code\u003e が見えるようになりました。\u003c/p\u003e\n\n\u003cp\u003eしかし、この状態ではビルドは通りますが、実行時にエラーが発生します。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eSystem.TypeLoadException: '要求された Windows ランタイム型 'RuntimeComponent1.Class' は登録されていません。'\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eMSのサンプルを見ればわかりますが、実はC#側にも「\u003ccode\u003eRuntimeComponent1.Class\u003c/code\u003e の実装はこのDLLに入っていますよ」という情報を追加してあげないといけません。\u003cbr\u003e\nプロジェクトに「アプリケーション マニフェスト ファイル」を追加します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/1396aa0c278334602a4431399195e6d82985b27d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3230343038342f32373063653566392d313962342d373166652d653235352d6438353233646531353039302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F270ce5f9-19b4-71fe-e255-d8523de15090.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=29efb479dda32e59571b5c9ac91b18ad\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/204084/270ce5f9-19b4-71fe-e255-d8523de15090.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F270ce5f9-19b4-71fe-e255-d8523de15090.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4282d6a139215e86ed6af912c4af11d3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e今回作成したブリッジと、そこに含まれているクラスの情報を追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp.manifest\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?xml version=\"1.0\" encoding=\"utf-8\"?\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;assembly\u003c/span\u003e \u003cspan class=\"na\"\u003emanifestVersion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"1.0\"\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"urn:schemas-microsoft-com:asm.v1\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;assemblyIdentity\u003c/span\u003e \u003cspan class=\"na\"\u003eversion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"1.0.0.0\"\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MyApplication.app\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  （略）\n    \u003cspan class=\"nt\"\u003e\u0026lt;file\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RuntimeComponent1.dll\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;activatableClass\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RuntimeComponent1.Class\"\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ethreadingModel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"both\"\u003c/span\u003e\n            \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"urn:schemas-microsoft-com:winrt.v1\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/file\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/assembly\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e複数のブリッジライブラリがある場合は、その数だけ \u003ccode\u003e\u0026lt;file\u0026gt;...\u0026lt;/file\u0026gt;\u003c/code\u003e を追加\u003c/li\u003e\n\u003cli\u003e1つのライブラリの中に複数のクラスがある場合は、\u003ccode\u003e\u0026lt;activatableClass\u0026gt;\u003c/code\u003e を追加\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eさらに、C++側で作ったDLLは「VCRT Forwarders」を参照して動くので、C#のexeと同じ場所にこれらのDLLがないといけません。\u003cbr\u003e\nNuGetパッケージマネージャーから「Microsoft.VCRTForwarders.140」を追加しておくと、C#側のビルド時にexeと同じ場所に必要なDLLがコピーされるようになります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行\u003c/h2\u003e\n\n\u003cp\u003eウィンドウに配置したボタンを押して 100, 200, 200, 400 の順にメッセージが表示されたら成功です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"応用例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%9C%E7%94%A8%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e応用例\u003c/h1\u003e\n\n\u003cp\u003eここまでの例では、C++/WinRTのブリッジと言いながら、WinRTの機能を全く使っていませんでした。\u003cbr\u003e\nということで、実際にWinRTを呼び出す例も見てみましょう。\u003c/p\u003e\n\n\u003cp\u003e日本語の形態素解析（文章を単語単位に分割する）APIがあるので、それを使ってみます。\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/uwp/api/windows.globalization.japanesephoneticanalyzer?view=winrt-19041\" rel=\"nofollow noopener\" target=\"_blank\"\u003eJapanesePhoneticAnalyzer Class (Windows.Globalization) - Windows UWP applications | Microsoft Docs\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e与えられた文章に対して、単語リストを返すようなメソッドを作ります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"cwinrt側-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cwinrt%E5%81%B4-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC++/WinRT側\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"classh\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#classh\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClass.h\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c++\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eClass.h\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#pragma once\n\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#include \"Class.g.h\"\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eFoundation\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eRuntimeComponent1\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eimplementation\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eClass\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eClassT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// デフォルトコンストラクタ\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIVectorView\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehstring\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eAnalyze\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehstring\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// static指定も可能\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eRuntimeComponent1\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003efactory_implementation\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eClass\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eClassT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eimplementation\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eClass.h で \u003ccode\u003eClass() = default;\u003c/code\u003e と書いておくと、処理のないデフォルトコンストラクタを使うことができます。Class.cpp にもコンストラクタの記述は必要ありません。\u003cbr\u003e\nリストを返すには \u003ccode\u003eusing namespace winrt::Windows::Foundation::Collections;\u003c/code\u003e を書いた上で \u003ccode\u003eIVectorView\u0026lt;T\u0026gt;\u003c/code\u003e インターフェイスを使うことができます。これはC# (.NET) 側から参照すると \u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003e に見えます。\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"Windows.Foundation.Collections Namespace - Windows UWP applications | Microsoft Docs\"\u003e1\u003c/a\u003e\u003c/sup\u003e\u003cbr\u003e\nまた、Unicode文字列を扱うときは \u003ccode\u003ehstring\u003c/code\u003e 型を使います。C# (.NET) 側から参照すると \u003ccode\u003estring\u003c/code\u003e に見えます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"classcpp\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#classcpp\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClass.cpp\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c++\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eClass.cpp\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#include \"pch.h\"\n#include \"Class.h\"\n#include \"Class.g.cpp\"\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eFoundation\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eGlobalization\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eRuntimeComponent1\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eimplementation\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIVectorView\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehstring\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eAnalyze\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehstring\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003ewords\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eJapanesePhoneticAnalyzer\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eGetWords\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003esingle_threaded_vector\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehstring\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ewords\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHasCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMoveNext\u003c/span\u003e\u003cspan class=\"p\"\u003e()){\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eword\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eDisplayText\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetView\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e使用したい機能に合わせて適切に \u003ccode\u003eusing namespace\u003c/code\u003e を記述してください。\u003cbr\u003e\nまた \u003ccode\u003ewinrt::single_threaded_vector\u0026lt;hstring\u0026gt;()\u003c/code\u003e を使って \u003ccode\u003eIVector\u003c/code\u003e オブジェクトの実体を作っています。これを忘れると、NULLポインタアクセスになってアクセス違反となります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"classidl-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#classidl-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClass.idl\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c++\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eClass.idl\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003eRuntimeComponent1\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003edefault_interface\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eruntimeclass\u003c/span\u003e \u003cspan class=\"n\"\u003eClass\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFoundation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIVectorView\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eAnalyze\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eidlでクラスの名前空間を書くときはドット区切り (\u003ccode\u003eWindows.Foundation.Collections.IVectorView\u003c/code\u003e) になります。\u003cbr\u003e\nまた、文字列型はidlでは \u003ccode\u003eString\u003c/code\u003e となります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"pchh-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pchh-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003epch.h\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c++\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epch.h\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#pragma once\n#include \u0026lt;unknwn.h\u0026gt;\n#include \u0026lt;winrt/Windows.Foundation.h\u0026gt;\n#include \u0026lt;winrt/Windows.Foundation.Collections.h\u0026gt;\n#include \u0026lt;winrt/Windows.Globalization.h\u0026gt;\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e使いたい機能に合わせてヘッダファイルの記述を追加します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"c側-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E5%81%B4-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC#側\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainWindows.xaml.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eButton_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eRuntimeComponent1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAnalyze\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"本日は晴天なり\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eJoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\",\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eC#側のプロジェクトで、参照にC++側のプロジェクトを追加してビルド・実行し、「本日,は,晴天,なり」と単語単位で区切られたメッセージが出たら成功です。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c81e7769f977ffa31b74849b5b2ad3e39df8515b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3230343038342f66643463373332302d393634662d616266332d623439372d3062353633643665306131392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2Ffd4c7320-964f-abf3-b497-0b563d6e0a19.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8f807ab364166f7988b631794ffae79c\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/204084/fd4c7320-964f-abf3-b497-0b563d6e0a19.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2Ffd4c7320-964f-abf3-b497-0b563d6e0a19.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d74d9c665bdf442b50eccd244f55be84 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"身も蓋もない話\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%BA%AB%E3%82%82%E8%93%8B%E3%82%82%E3%81%AA%E3%81%84%E8%A9%B1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e身も蓋もない話\u003c/h2\u003e\n\n\u003cp\u003e正直この程度だったらブリッジを作るまでもなくて、以下の方法でもっと手軽にできたりします。\u003cbr\u003e\n\u003ca href=\"https://qiita.com/everylittle/items/62ce313fe09883c6da5f\" id=\"reference-75dfe8a388340aea548f\"\u003e[C#] デスクトップアプリ (WPF) から手軽にWinRT APIを活用しよう - Qiita\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eただポインタやATLなど色々触り出すと、下手にC#で書くよりC++でブリッジを作ったほうがたぶん楽です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"トラブルシューティング\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eトラブルシューティング\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ブリッジクラスがc側から見えない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%96%E3%83%AA%E3%83%83%E3%82%B8%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%8Cc%E5%81%B4%E3%81%8B%E3%82%89%E8%A6%8B%E3%81%88%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eブリッジクラスがC#側から見えない\u003c/h2\u003e\n\n\u003cp\u003eC#側から参照にC++プロジェクトを追加していても見えない場合は、idlファイルの記述をご確認ください。\u003cbr\u003e\nidlファイルを編集したら「リビルド」したほうが良いです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"エラー-c2660-winrtruntimecomponent1implementationclassmymethod-関数に-1-個の引数を指定できません\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A8%E3%83%A9%E3%83%BC-c2660-winrtruntimecomponent1implementationclassmymethod-%E9%96%A2%E6%95%B0%E3%81%AB-1-%E5%80%8B%E3%81%AE%E5%BC%95%E6%95%B0%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%9B%E3%82%93\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eエラー C2660 'winrt::RuntimeComponent1::implementation::Class::MyMethod': 関数に 1 個の引数を指定できません。\u003c/h2\u003e\n\n\u003cp\u003eClass.idl に書いた名前と引数で呼び出せるメソッドが、Class.cpp, Class.h 側に定義されていないと思われます。（オーバーロードは可能ですが、idlの記述に不足がないようにご注意ください）\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"systemtypeloadexception-要求された-windows-ランタイム型-runtimecomponent1class-は登録されていません\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#systemtypeloadexception-%E8%A6%81%E6%B1%82%E3%81%95%E3%82%8C%E3%81%9F-windows-%E3%83%A9%E3%83%B3%E3%82%BF%E3%82%A4%E3%83%A0%E5%9E%8B-runtimecomponent1class-%E3%81%AF%E7%99%BB%E9%8C%B2%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%BE%E3%81%9B%E3%82%93\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSystem.TypeLoadException: '要求された Windows ランタイム型 'RuntimeComponent1.Class' は登録されていません。'\u003c/h2\u003e\n\n\u003cp\u003eapp.manifest の \u003ccode\u003e\u0026lt;file\u0026gt;\u003c/code\u003e や \u003ccode\u003e\u0026lt;activatableClass\u0026gt;\u003c/code\u003e の記述が不足しているようです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"systembadimageformatexception--は有効な-win32-アプリケーションではありません-hresult-からの例外0x800700c1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#systembadimageformatexception--%E3%81%AF%E6%9C%89%E5%8A%B9%E3%81%AA-win32-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E3%81%AF%E3%81%82%E3%82%8A%E3%81%BE%E3%81%9B%E3%82%93-hresult-%E3%81%8B%E3%82%89%E3%81%AE%E4%BE%8B%E5%A4%960x800700c1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSystem.BadImageFormatException: ' は有効な Win32 アプリケーションではありません。 (HRESULT からの例外:0x800700C1)'\u003c/h2\u003e\n\n\u003cp\u003eC++側とC#側のプラットフォーム設定が合っていないみたいです。x64同士、またはx86/Win32の組み合わせであることを確認してください。前述のように Any CPU はダメです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"systemiofilenotfoundexception-指定されたモジュールが見つかりません-hresult-からの例外0x8007007e\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#systemiofilenotfoundexception-%E6%8C%87%E5%AE%9A%E3%81%95%E3%82%8C%E3%81%9F%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%8C%E8%A6%8B%E3%81%A4%E3%81%8B%E3%82%8A%E3%81%BE%E3%81%9B%E3%82%93-hresult-%E3%81%8B%E3%82%89%E3%81%AE%E4%BE%8B%E5%A4%960x8007007e\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSystem.IO.FileNotFoundException: '指定されたモジュールが見つかりません。 (HRESULT からの例外:0x8007007E)'\u003c/h2\u003e\n\n\u003cp\u003eまずは RuntimeComponent1 のビルドが成功していて、C#側のプロジェクトで指定したexeの出力先と同じ場所に RuntimeComponent1.dll がコピーされているか確認してください。\u003cbr\u003e\nもし RuntimeComponent1.dll があるのにこのエラーが出るときは、VCRT ForwardersのDLLが見つからないのが原因と思われます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eNuGetパッケージマネージャーの設定で、既定のパッケージ管理方法を「Packages.config」にする\u003c/li\u003e\n\u003cli\u003eC#側のプロジェクトに Microsoft.VCRTForwarders.140 を追加する（既に追加されている場合で、後からPackages.configの設定を変えたときは、VCRTForwardersを一度削除して再度追加する）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eビルドしたあとに \u003ccode\u003ebin\\x64\\Debug\u003c/code\u003e の下などに \u003ccode\u003emsvcp140\u003c/code\u003e や \u003ccode\u003evcruntime140\u003c/code\u003e などの名前で始まるDLLが大量にコピーされたら成功です。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/bedd8c993f3fc7edd8c698a28220532f50a5aec4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3230343038342f30663735653163632d383731352d663362612d306439652d3665666366663565633864382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F0f75e1cc-8715-f3ba-0d9e-6efcff5ec8d8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8d9d9646f94a900997076a7211aefe45\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/204084/0f75e1cc-8715-f3ba-0d9e-6efcff5ec8d8.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204084%2F0f75e1cc-8715-f3ba-0d9e-6efcff5ec8d8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f28c052a74ed264d2f1e19228af5aaf1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"0x00007ff90cd1dd44-runtimecomponent1dll-で例外がスローされました-wpfapp1exe-内-0xc0000005-場所-0x0000000000000000-の読み取り中にアクセス違反が発生しました\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#0x00007ff90cd1dd44-runtimecomponent1dll-%E3%81%A7%E4%BE%8B%E5%A4%96%E3%81%8C%E3%82%B9%E3%83%AD%E3%83%BC%E3%81%95%E3%82%8C%E3%81%BE%E3%81%97%E3%81%9F-wpfapp1exe-%E5%86%85-0xc0000005-%E5%A0%B4%E6%89%80-0x0000000000000000-%E3%81%AE%E8%AA%AD%E3%81%BF%E5%8F%96%E3%82%8A%E4%B8%AD%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E9%81%95%E5%8F%8D%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e0x00007FF90CD1DD44 (RuntimeComponent1.dll) で例外がスローされました (WpfApp1.exe 内): 0xC0000005: 場所 0x0000000000000000 の読み取り中にアクセス違反が発生しました\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eIVector\u003c/code\u003e の初期化ができているかご確認ください。\u003ccode\u003ewinrt::single_threaded_vector\u003c/code\u003e をお忘れなく。\u003c/p\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003e\u003ca href=\"https://docs.microsoft.com/en-us/uwp/api/windows.foundation.collections?view=winrt-19041\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWindows.Foundation.Collections Namespace - Windows UWP applications | Microsoft Docs\u003c/a\u003e \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","createdAt":"2020-09-27T07:29:52Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"tv7Yhf3ugJ8roxTpxKeyd95IFyAMISuQWg==--yaiNr2hwsImbGV7f--CTOVZC2hXGp3fz9kX7bm2g==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-10-01T14:19:30Z","likesCount":4,"linkUrl":"https://qiita.com/everylittle/items/cb95b24eb9462ddb3cfc","organization":null,"originalId":1309614,"stockedCount":6,"title":"[C#] C++/WinRTのブリッジを作ってC#から呼び出す方法","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\"\u003e開発環境\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99\"\u003e事前準備\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%85%AC%E5%BC%8F%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e公式サンプルの動作確認\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%87%AA%E5%88%86%E3%81%A7%E3%83%96%E3%83%AA%E3%83%83%E3%82%B8%E3%82%92%E6%9B%B8%E3%81%8F\"\u003e自分でブリッジを書く\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#cwinrt%E5%81%B4\"\u003eC++/WinRT側\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#classh-classcpp\"\u003eClass.h, Class.cpp\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#classidl\"\u003eClass.idl\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#pchh\"\u003epch.h\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#c%E5%81%B4\"\u003eC#側\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A1%8C\"\u003e実行\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BF%9C%E7%94%A8%E4%BE%8B\"\u003e応用例\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#cwinrt%E5%81%B4-1\"\u003eC++/WinRT側\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#classh\"\u003eClass.h\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#classcpp\"\u003eClass.cpp\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#classidl-1\"\u003eClass.idl\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#pchh-1\"\u003epch.h\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#c%E5%81%B4-1\"\u003eC#側\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%BA%AB%E3%82%82%E8%93%8B%E3%82%82%E3%81%AA%E3%81%84%E8%A9%B1\"\u003e身も蓋もない話\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\"\u003eトラブルシューティング\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%96%E3%83%AA%E3%83%83%E3%82%B8%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%8Cc%E5%81%B4%E3%81%8B%E3%82%89%E8%A6%8B%E3%81%88%E3%81%AA%E3%81%84\"\u003eブリッジクラスがC#側から見えない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A8%E3%83%A9%E3%83%BC-c2660-winrtruntimecomponent1implementationclassmymethod-%E9%96%A2%E6%95%B0%E3%81%AB-1-%E5%80%8B%E3%81%AE%E5%BC%95%E6%95%B0%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%9B%E3%82%93\"\u003eエラー C2660 'winrt::RuntimeComponent1::implementation::Class::MyMethod': 関数に 1 個の引数を指定できません。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#systemtypeloadexception-%E8%A6%81%E6%B1%82%E3%81%95%E3%82%8C%E3%81%9F-windows-%E3%83%A9%E3%83%B3%E3%82%BF%E3%82%A4%E3%83%A0%E5%9E%8B-runtimecomponent1class-%E3%81%AF%E7%99%BB%E9%8C%B2%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%BE%E3%81%9B%E3%82%93\"\u003eSystem.TypeLoadException: '要求された Windows ランタイム型 'RuntimeComponent1.Class' は登録されていません。'\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#systembadimageformatexception--%E3%81%AF%E6%9C%89%E5%8A%B9%E3%81%AA-win32-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E3%81%AF%E3%81%82%E3%82%8A%E3%81%BE%E3%81%9B%E3%82%93-hresult-%E3%81%8B%E3%82%89%E3%81%AE%E4%BE%8B%E5%A4%960x800700c1\"\u003eSystem.BadImageFormatException: ' は有効な Win32 アプリケーションではありません。 (HRESULT からの例外:0x800700C1)'\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#systemiofilenotfoundexception-%E6%8C%87%E5%AE%9A%E3%81%95%E3%82%8C%E3%81%9F%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%8C%E8%A6%8B%E3%81%A4%E3%81%8B%E3%82%8A%E3%81%BE%E3%81%9B%E3%82%93-hresult-%E3%81%8B%E3%82%89%E3%81%AE%E4%BE%8B%E5%A4%960x8007007e\"\u003eSystem.IO.FileNotFoundException: '指定されたモジュールが見つかりません。 (HRESULT からの例外:0x8007007E)'\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#0x00007ff90cd1dd44-runtimecomponent1dll-%E3%81%A7%E4%BE%8B%E5%A4%96%E3%81%8C%E3%82%B9%E3%83%AD%E3%83%BC%E3%81%95%E3%82%8C%E3%81%BE%E3%81%97%E3%81%9F-wpfapp1exe-%E5%86%85-0xc0000005-%E5%A0%B4%E6%89%80-0x0000000000000000-%E3%81%AE%E8%AA%AD%E3%81%BF%E5%8F%96%E3%82%8A%E4%B8%AD%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E9%81%95%E5%8F%8D%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F\"\u003e0x00007FF90CD1DD44 (RuntimeComponent1.dll) で例外がスローされました (WpfApp1.exe 内): 0xC0000005: 場所 0x0000000000000000 の読み取り中にアクセス違反が発生しました\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":2544,"uuid":"cb95b24eb9462ddb3cfc","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"rCZH5yc0KC7/MNQ6hrixG26gnvcj--/A7mfJtzF/iXLxVB--pIFrSm45JW/Q0Mh4EGZwVg==","originalId":204084,"description":"PythonやWebプログラミングなどのTipsをメモ代わりに投稿しています。たまに機械学習の話題もあります。","facebookUrl":null,"githubUrl":"https://github.com/build1024","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/204084/profile-images/1544604030","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F204084%2Fprofile-images%2F1544604030?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=09d12ee189ba32bac935afcf9b8ca435","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F204084%2Fprofile-images%2F1544604030?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=ca805aa914ba8d1c5bf5ab7a497a739f","urlName":"everylittle","websiteUrl":"https://www.every-little.com/","twitterUrl":"https://twitter.com/hira_elt","twitterUrlName":"hira_elt","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C++","urlName":"cpp"},{"name":"C#","urlName":"csharp"},{"name":"WinRT","urlName":"winrt"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

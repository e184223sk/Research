More than 3 years have passed since last update.Microsoft HoloLens
Unity 2017.1
Visual Studio 2017Unityの勉強を始めて2週間たった頃、HoloLensで空間認識をして壁に動画を貼りたいなーって思いました。Mixed Reality ToolkitのSpatial Mapping機能を使えば、便利なことに自動で壁を認識してオブジェクトを作ってくれます。
このときUnity上では"SurfacePlane"というMixed Reality toolkit内に存在するプレハブのコピーが作られますが、これはUnityのCubeオブジェクトをただ変形しただけのものです(たぶん)。つまり、HoloLens上で壁に動画を貼るということはUnityおなじみのCubeオブジェクトに動画を貼るのと同じタスクなわけです。Unity5.6からVideoPlayerという機能が追加されたそうなので、それを使ってCubeオブジェクトに動画を貼ってみました。
こちらの記事などを参考にするとよいと思います。
https://qiita.com/gshirato/items/1500f61b408e7af69453すると、一部の面では動画が回転されて表示されてしまいました。
これはおそらく、動画の向きが頂点のインデックスの呼び出される順番に依存して決まるからだと思います。
実際、平面を表すPlaneオブジェクトやQuadオブジェクトでは正しい向きで表示してくれます。※この記事でいう動画の「正しい向き」とはオブジェクトのZ軸周りの回転角が0°のときに動画が逆さに表示されていない状態だと定義します。Cubeの頂点インデックスの順番を変えればうまくいくと思いますが、そもそも壁をCubeで表したくない(2面だけで十分なのに6面も描画されてしまう)ので壁のオブジェクトをCubeからQuadに変換するコードを書きました。流れはこんな感じです。
1. Cubeのワールド座標変換前のローカル座標系において、変換後に壁として使われる(つまり最も面積の大きい)2面を6面から探索する。
2. ローカル座標系においてその2面と同じ座標になるようにQuadオブジェクトを生成して動かす。
3. Cubeのマテリアルやワールド変換行列などをQuadに適用する。急いで書いたので汚いコードになりましたが、とりあえずこれで上手くいきます。あとはZ軸周りの回転角を0度にすれば正しい向きで表示されます。そのコードはここでは省略します。rotation.z = 0fにしてlocalScaleをいじるだけです。



先日リリースされた MessagePipe をWindowsフォームアプリケーションで利用する方法を説明します。
Windowsフォームアプリケーションでは DI が利用されるケースは多くはないため、DI に関する記事が少ないのが現状です。
MessagePipe そのものの説明ではなく、MessagePipe を利用するために DI 環境を整える方法になります。Nuget で次のパッケージをインストールしてください。Microsoft.Extensions.DependencyInjection では、DI でインスタンスを生成したい型をあらかじめ ServiceCollection に登録しておく必要があります。ServiceCollection から生成された ServiceProvider を通じてインスタンスを生成することができるようになります。MessagePipe で提供される拡張メソッド AddMessagePipe を呼び出せば標準的な型が登録されますが、Windowsフォームアプリケーションの場合は IPublisher などの型は登録されません。使用したい型を登録する必要があります。フォームのコンストラクタに DI で生成したインスタンスを渡したい場合、フォームも ServiceCollection に登録します。



<!DOCTYPE html><html><head><meta charset="utf-8" /><title>空中に図形を描いて物体を生成するアプリを作ってみた - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/divideby_zero/items/e62e7c536b2fff84a8bc" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="K9sr9KIfn+htSQI5kjgHOqGnS65bbNJdWqQBhp+tXQsbOzGsBw0o7bgOKLHkCPb/oYgQLj7oF0kOrCCafRhYiQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@divideby_zero" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="空中に図形を描いて物体を生成するアプリを作ってみた - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND01Nm02NUxpdDQ0R3I1WnV6NWIyaTQ0S1M1by1QNDRHRTQ0R201NG1wNUwyVDQ0S1M1NVNmNW9pUTQ0R1o0NEtMNDRLaTQ0T1g0NE9xNDRLUzVMMmM0NEdqNDRHbTQ0R180NEdmJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWUxMzI3ODlkNjlkOWZhMmJhMDkyYWU2NzY5YmJmYWNm&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR1JwZG1sa1pXSjVYM3BsY204JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9YWUyZjYwY2U2NmM0MzkxNzk0MmRlMDJlNDFjZTBjNjQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=0dd29d219d7397e7f8d047815f161ff8"><meta property="og:description" content="

はじめに

OculusQuest によって、(正しくはもっともっと前からでしょうけども）VR空間に「手」が持ち込めるようになりました。
OculusQuest購入以前はGearVR開発しかまともにしたことのなかった僕からするとそ..."><meta content="https://qiita.com/divideby_zero/items/e62e7c536b2fff84a8bc" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Unity3D,VR,OculusQuest" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-233c4a47-dfb9-40df-bc71-b2bb32a714da"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fdivideby_zero%2Fitems%2Fe62e7c536b2fff84a8bc">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fdivideby_zero%2Fitems%2Fe62e7c536b2fff84a8bc">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-233c4a47-dfb9-40df-bc71-b2bb32a714da">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-07-02T15:46:36.000+09:00","dateModified":"2019-07-04T02:31:25.000+09:00","headline":"空中に図形を描いて物体を生成するアプリを作ってみた","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND01Nm02NUxpdDQ0R3I1WnV6NWIyaTQ0S1M1by1QNDRHRTQ0R201NG1wNUwyVDQ0S1M1NVNmNW9pUTQ0R1o0NEtMNDRLaTQ0T1g0NE9xNDRLUzVMMmM0NEdqNDRHbTQ0R180NEdmJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWUxMzI3ODlkNjlkOWZhMmJhMDkyYWU2NzY5YmJmYWNm\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR1JwZG1sa1pXSjVYM3BsY204JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9YWUyZjYwY2U2NmM0MzkxNzk0MmRlMDJlNDFjZTBjNjQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=0dd29d219d7397e7f8d047815f161ff8","mainEntityOfPage":"https://qiita.com/divideby_zero/items/e62e7c536b2fff84a8bc","author":{"@type":"Person","address":"","email":null,"identifier":"divideby_zero","name":"divideby_zero","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F37184%2Fprofile-images%2F1523411235?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=23e17839943e7fa660fbe097d0b218ac","url":"https://qiita.com/divideby_zero","description":"プログラマやったり、専門学校教員やったり、ゲーム業界叩いてみたりしましたが、結局またプログラマやってます。\r\nXamarinとUnityが好き。というよりC#が好きっぽい。\r\n","memberOf":[{"@type":"Organization","address":"オンライン@Slack","legalName":"Unityゲーム開発者ギルド","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/5e3ba3bb442371003e6b5d4618ef627b9b478357/original.jpg?1570216541","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","identifier":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita&amp;utm_medium=header-banner">常にメンバーが開発しやすい環境を作るNewsPicksの組織作りとは</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"divideby_zero","type":"items","id":"e62e7c536b2fff84a8bc"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"常にメンバーが開発しやすい環境を作るNewsPicksの組織作りとは","url":"https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"divideby_zero","type":"items","id":"e62e7c536b2fff84a8bc"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"常にメンバーが開発しやすい環境を作るNewsPicksの組織作りとは","url":"https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"divideby_zero","type":"items","id":"e62e7c536b2fff84a8bc"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"常にメンバーが開発しやすい環境を作るNewsPicksの組織作りとは","url":"https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/divideby_zero/items/e62e7c536b2fff84a8bc","location":"/divideby_zero/items/e62e7c536b2fff84a8bc","scheme":"https","host":"qiita.com","port":null,"pathname":"/divideby_zero/items/e62e7c536b2fff84a8bc","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"1YmDemo65qig4qQh1E6+EDYdIuNg7+yc6wTtGyDt+CDlaZkizyhRrXWljqmifk/VNjJ5YwVrKYi/DMwHwlj9og==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-1ad8a303-b6ce-40b7-af19-bdb8fbc9e7e6"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/divideby_zero/items/e62e7c536b2fff84a8bc/likers" class="css-1iupg5d">20</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">14</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/e62e7c536b2fff84a8bc/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/divideby_zero/items/e62e7c536b2fff84a8bc/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/divideby_zero/items/e62e7c536b2fff84a8bc/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/divideby_zero/items/e62e7c536b2fff84a8bc/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/divideby_zero/items/e62e7c536b2fff84a8bc.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/divideby_zero"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/37184/profile-images/1523411235" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/divideby_zero" class="css-10ougpm">@<!-- -->divideby_zero</a><div class="css-1ay9vb9"><span><meta content="2019-07-02T06:46:36Z"/><time dateTime="2019-07-03T17:31:25Z" class="css-m19uds">updated at 2019-07-03</time></span></div></div></div></div></div><h1 class="css-cgzq40">空中に図形を描いて物体を生成するアプリを作ってみた</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/unity3d" class="css-4czcte">Unity3D</a><a href="/tags/vr" class="css-4czcte">VR</a><a href="/tags/oculusquest" class="css-4czcte">OculusQuest</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>OculusQuest によって、(正しくはもっともっと前からでしょうけども）VR空間に「手」が持ち込めるようになりました。<br>
OculusQuest購入以前はGearVR開発しかまともにしたことのなかった僕からするとそれはとんでもない衝撃です。<br>
何でもできる！なんでもできるじゃないか！（何でもではない）</p>

<p>感動のあまり、何番煎じかわかりませんが、このようなアプリを作ってみました。</p>

<blockquote class="twitter-tweet">
<p>ようやく納得できる頂点検出＋頂点パターンからのオブジェクト生成出来るようになったーー。やったーーー！！大変だったー！<br><br>・四角→Cube<br>・円→Sphere<br>・リボン→Unityちゃん<br>・星→もちろんアレですよ。<br><br>もうちょっとまとまったらAPKと一緒にQiita記事書きます。<a href="https://twitter.com/hashtag/OculusQuest?src=hash&amp;ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">#OculusQuest</a> <a href="https://twitter.com/hashtag/unity3d?src=hash&amp;ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">#unity3d</a> <a href="https://t.co/OV12b3BcG9" rel="nofollow noopener" target="_blank">pic.twitter.com/OV12b3BcG9</a></p>— すずきかつーき (@divideby_zero) <a href="https://twitter.com/divideby_zero/status/1142591851184177152?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">2019年6月23日</a>
</blockquote>

<script async src="https://platform.twitter.com/widgets.js"></script>

<p>というわけで、実行ファイル(APK)と解説になります。<br>
APKファイルはこちらです。 <a href="https://github.com/divide-by-zero/divide-by-zero.github.io/releases" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/divide-by-zero/divide-by-zero.github.io/releases</a><br>
<strong>OculusQuestFirstStep.apk</strong> をダウンロードして、よしなにお手元のOculusQuestに入れてください。<br>
なお、野良APKファイルをインストールするのには</p>

<p>①OculusQuestを開発者モードにする<br>
②ADB.exeの準備<br>
③APKファイルをADBコマンドで直接インストール</p>

<p>等々が必要です。要らぬハードル・・・！</p>

<p><del>あんまりお勧めして良いかわかりませんが、 sidequest （参考: <a href="https://vr-maniacs.com/entry/sidequest/" class="autolink" rel="nofollow noopener" target="_blank">https://vr-maniacs.com/entry/sidequest/</a> )なんかが全部をカバーしてるんじゃないかなぁ。どうかなぁ（モニョモニョ</del></p>

<hr>

<p>ここから↓は技術解説になります。　興味がない方はお疲れ様でした。</p>

<h2>
<span id="流れ" class="fragment"></span><a href="#%E6%B5%81%E3%82%8C"><i class="fa fa-link"></i></a>流れ</h2>

<p>ハンドコントローラが作る軌跡の頂点生データを加工していって、最終的に図形を判断できるぐらいまで情報を加工・そぎ落としていきます。</p>

<p>①コントローラーの毎フレームの3次元位置(Vector3[])をShapePointListに追加(Add)<br>
↓<br>
②手ブレを加味した3次元位置(ShapePoint)に<br>
↓<br>
③ShapePointが角かどうか判断(isCorner)<br>
↓<br>
④角(ShapeCorner)のリスト作成<br>
↓<br>
⑤各ShapeCornerの数や前後関係から図形認識情報返却(ResolveShapeInfo:位置・向き(法線)・横幅縦幅)<br>
↓<br>
⑥図形認識情報(ResolverShapeInfo)に従い、prefab生成などを行う</p>

<p>こんな流れです。</p>

<h1>
<span id="コントローラーの毎フレームの3次元位置vector3" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%83%BC%E3%81%AE%E6%AF%8E%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AE3%E6%AC%A1%E5%85%83%E4%BD%8D%E7%BD%AEvector3"><i class="fa fa-link"></i></a>①コントローラーの毎フレームの3次元位置(Vector3[])</h1>

<p>まず<br>
トリガーを押している間だけ、コントローラの位置を取得していきます。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">shapeDetect.cs</span></div>
<div class="highlight"><pre><code>            <span class="k">if</span> <span class="p">(</span><span class="n">OVRInput</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="n">OVRInput</span><span class="p">.</span><span class="n">RawButton</span><span class="p">.</span><span class="n">RIndexTrigger</span><span class="p">))</span> <span class="c1">//GETがHOLD、GETDOWNが押した瞬間GetUpが離した瞬間</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">list</span><span class="p">.</span><span class="nf">AddPoint</span><span class="p">(</span><span class="n">_targetTransform</span><span class="p">.</span><span class="n">position</span><span class="p">))</span>
                <span class="p">{</span>

</code></pre></div>
</div>

<p>そして、人間、何の指標も無しに空中でキレイに四角とか描けないので、実際にはLineRendererを使って実線を引いてます。</p>

<h1>
<span id="手ブレを加味した3次元位置shapepointを集めたリストshapepointlist作成" class="fragment"></span><a href="#%E6%89%8B%E3%83%96%E3%83%AC%E3%82%92%E5%8A%A0%E5%91%B3%E3%81%97%E3%81%9F3%E6%AC%A1%E5%85%83%E4%BD%8D%E7%BD%AEshapepoint%E3%82%92%E9%9B%86%E3%82%81%E3%81%9F%E3%83%AA%E3%82%B9%E3%83%88shapepointlist%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>②手ブレを加味した3次元位置(ShapePoint)を集めたリスト(ShapePointList)作成</h1>

<p>やってみると分かるのですが、人間、空中でピタっと手を止めているつもりでも実際のところ数センチレベルで手がプルプルしちゃいます。手ブレですね。<br>
なので、<strong>「前回位置から、今回位置の移動(<code>currentVec</code>がごく小さい場合は、頂点とみなさない」</strong>ルールにしました。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">ShapePointList.cs</span></div>
<div class="highlight"><pre><code>                <span class="kt">var</span> <span class="n">currentVec</span> <span class="p">=</span> <span class="p">(</span><span class="n">p</span> <span class="p">-</span> <span class="n">lastAddPoint</span><span class="p">.</span><span class="n">Pos</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">currentVec</span><span class="p">.</span><span class="n">sqrMagnitude</span> <span class="p">&lt;=</span> <span class="n">_nearPointDetectValue</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">lastAddPoint</span><span class="p">.</span><span class="nf">AddNearPointCount</span><span class="p">();</span>
                    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
                <span class="p">}</span>
</code></pre></div>
</div>

<p>なお、デバッグ情報の意味を込めて頂点を追加しない場合は前回ShapePointのNearCountを足していくようにしています。<br>
何かに利用できるかな。と思って作ったプロパティですが、今の所出番がありません。不憫な子。</p>

<h1>
<span id="図形認識の頂点角の3次元位置shapecorner認識" class="fragment"></span><a href="#%E5%9B%B3%E5%BD%A2%E8%AA%8D%E8%AD%98%E3%81%AE%E9%A0%82%E7%82%B9%E8%A7%92%E3%81%AE3%E6%AC%A1%E5%85%83%E4%BD%8D%E7%BD%AEshapecorner%E8%AA%8D%E8%AD%98"><i class="fa fa-link"></i></a>③図形認識の頂点(角)の3次元位置(ShapeCorner)認識</h1>

<p>さて。コントローラーが描く軌跡の頂点を若干削りましたが、本当に欲しいのは<strong>「角」</strong>です。<br>
<strong>「角」</strong>とは<strong>「急に進行方向が変わった所」</strong>です。<br>
今までの頂点の並びから、軌跡がどの方向に進んでいるかを求め(<code>lineVec</code>)<br>
それに対して、今回の線(前回頂点から今回頂点のベクトル:<code>currentVec</code>)はどれぐらい沿っているかを求めます。</p>

<p>この二つのベクトルがどれぐらい似通っているかを表すのは。そう <strong>内積</strong>です。</p>

<p>ベクトルの内積は直角（一番似通っていない)場合は０<br>
全く同じ場合は+1<br>
全く逆方向の場合は-1です</p>

<p>「なんとなくまっすぐっぽかったらまっすぐだとみなす」なので、具体的な数値は要調整ですが今回のアプリ内では <strong>"0.8f"</strong> にしました。一応角度に直すと 36.8698976°です。 結構曲がってても「直線」と見なし、それ以上に曲がっている場合は「角」としています。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">ShapePointList.cs</span></div>
<div class="highlight"><pre><code>                <span class="kt">var</span> <span class="n">isCorner</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

                <span class="c1">//前回の角からのベクトル足しこみ</span>
                <span class="n">lineVec</span> <span class="p">+=</span> <span class="n">currentVec</span><span class="p">;</span>

                <span class="c1">//角度チェック</span>
                <span class="kt">var</span> <span class="n">dot</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">lineVec</span><span class="p">.</span><span class="n">normalized</span><span class="p">,</span> <span class="n">currentVec</span><span class="p">.</span><span class="n">normalized</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">dot</span> <span class="p">&lt;=</span> <span class="n">_cornerDetectDot</span><span class="p">)</span>
                <span class="p">{</span>
</code></pre></div>
</div>

<p>よし、これで良いじゃないか。<br>
と思うんですが、もう一つ問題があります。</p>

<p>ここで有名な標語を貴方に<br>
<strong>「危ないよ車は急に止まれない」</strong></p>

<p>例えば手を左から右に水平に動かして、あるポイントで急に真下に振ろうとしても、<strong>大体真下にはいきません</strong><br>
というか、大体の人はそこで一旦ブレーキをかけます。　今まで水平に動かしていたべクトルに真反対のベクトルをぶつけ、相殺させて一瞬止め、そこから手を下におろしているはずです（大抵は無意識なはず）</p>

<p>なので、例えば先ほどの「左から右に水平に動かし、90度真下へ」の角近辺のベクトルの流れは<br>
①→<br>
②←<br>
③↓<br>
の3つがグチャグチャします。<br>
しかもブレーキかけすぎたり（戻し過ぎたり）ブレーキが足りなかったり、そして無意識にそれを補正したりするので、「角」と認識した後しばらくは数値上は「角」だとしても意図してないことがほとんどです。<br>
なので、もう一つ条件<br>
<strong>「前の頂点(Point)からの距離が想定より短い場合は角とみなさない」</strong><br>
を追加しています。（今回は5cmにしました。）</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">ShapePointList.cs</span></div>
<div class="highlight"><pre><code>                    <span class="c1">//長さが足りない場合は、角近辺でごちゃごちゃしてる可能性</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">lineVec</span><span class="p">.</span><span class="n">sqrMagnitude</span> <span class="p">&gt;</span> <span class="n">_lineDetectValue</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">isCorner</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                        <span class="n">lineVec</span> <span class="p">=</span> <span class="n">currentVec</span><span class="p">;</span>
                    <span class="p">}</span>
</code></pre></div>
</div>

<p>なお、そのままベクトル間の距離を取得して5cm(Unityは単位メートルなので、0.05f)と比較しても良いですが、ベクトルの長さ(magnitude)は内部的には平方根が使われます(三平方の定理より）そのためそれなりに計算コストがかかるため、<code>sqrMagnitude</code>を使って比較を行っています。<br>
　こっちのプロパティは、ベクトル間の距離の二乗が入っており（平方根を使っていない）大小比較だけなら同じように比較対象である5cm(0.05f)を二乗してあげれば良いです。若干の高速化小細工でした。</p>

<p>以下、ハンドコントローラの頂点情報を毎フレーム渡して、角検出している所全体像(抜粋）です</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">ShapePointList.cs</span></div>
<div class="highlight"><pre><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">ShapePointList</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="kt">float</span> <span class="n">_nearPointDetectValue</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">float</span> <span class="n">_lineDetectValue</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">float</span> <span class="n">_cornerDetectDot</span><span class="p">;</span>

        <span class="k">private</span> <span class="n">ShapePoint</span> <span class="n">lastAddPoint</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">Vector3</span> <span class="n">lineVec</span><span class="p">;</span><span class="c1">//現在描いてる線の偏向</span>
        <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ShapePoint</span><span class="p">&gt;</span> <span class="n">_points</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ShapePoint</span><span class="p">&gt;();</span>

        <span class="k">public</span> <span class="nf">ShapePointList</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_nearPointDetectValue</span> <span class="p">=</span> <span class="m">0.01f</span> <span class="p">*</span> <span class="m">0.01f</span><span class="p">;</span> <span class="c1">//1cm以下は手の震えとみなす</span>
            <span class="n">_lineDetectValue</span> <span class="p">=</span> <span class="m">0.05f</span> <span class="p">*</span> <span class="m">0.05f</span><span class="p">;</span>   <span class="c1">//直線は5cmぐらいは欲しい</span>
            <span class="n">_cornerDetectDot</span> <span class="p">=</span> <span class="m">0.8f</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">AddPoint</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">p</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lastAddPoint</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">lastAddPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ShapePoint</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                <span class="n">lineVec</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">currentVec</span> <span class="p">=</span> <span class="p">(</span><span class="n">p</span> <span class="p">-</span> <span class="n">lastAddPoint</span><span class="p">.</span><span class="n">Pos</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">currentVec</span><span class="p">.</span><span class="n">sqrMagnitude</span> <span class="p">&lt;=</span> <span class="n">_nearPointDetectValue</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">lastAddPoint</span><span class="p">.</span><span class="nf">AddNearPointCount</span><span class="p">();</span>
                    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="kt">var</span> <span class="n">isCorner</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

                <span class="c1">//前回の角からのベクトル足しこみ</span>
                <span class="n">lineVec</span> <span class="p">+=</span> <span class="n">currentVec</span><span class="p">;</span>

                <span class="c1">//角度チェック</span>
                <span class="kt">var</span> <span class="n">dot</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Dot</span><span class="p">(</span><span class="n">lineVec</span><span class="p">.</span><span class="n">normalized</span><span class="p">,</span> <span class="n">currentVec</span><span class="p">.</span><span class="n">normalized</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">dot</span> <span class="p">&lt;=</span> <span class="n">_cornerDetectDot</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">//長さが足りない場合は、角近辺でごちゃごちゃしてる可能性</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">lineVec</span><span class="p">.</span><span class="n">sqrMagnitude</span> <span class="p">&gt;</span> <span class="n">_lineDetectValue</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">isCorner</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                        <span class="n">lineVec</span> <span class="p">=</span> <span class="n">currentVec</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="n">lastAddPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ShapePoint</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">isCorner</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">_points</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">lastAddPoint</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
</div>

<p>紆余曲折あり、大分時間をかけた箇所なんですが、こう見るとシンプルですね。</p>

<h1>
<span id="角shapecornerのリスト作成" class="fragment"></span><a href="#%E8%A7%92shapecorner%E3%81%AE%E3%83%AA%E3%82%B9%E3%83%88%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>④角(ShapeCorner)のリスト作成</h1>

<p>自分の納得のいく線が描けたら、トリガーを離します。このタイミングで一旦ShapeListを締めます(<code>Finalized()</code>)</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">ShapeDetect.cs</span></div>
<div class="highlight"><pre><code>            <span class="k">if</span> <span class="p">(</span><span class="n">OVRInput</span><span class="p">.</span><span class="nf">GetUp</span><span class="p">(</span><span class="n">OVRInput</span><span class="p">.</span><span class="n">RawButton</span><span class="p">.</span><span class="n">RIndexTrigger</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="c1">//頂点を確定</span>
                <span class="n">list</span><span class="p">.</span><span class="nf">Finalized</span><span class="p">();</span>
</code></pre></div>
</div>

<p><code>Finalized()</code> では、収集した頂点(ShapePoint)の角(isCorner)フラグが立っているものから、<code>ShapeCorner</code> の配列を作っています。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">ShapePointList.cs</span></div>
<div class="highlight"><pre><code>        <span class="k">private</span> <span class="kt">bool</span> <span class="n">isFinalize</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">ShapeCorner</span><span class="p">[]</span> <span class="n">corners</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Finalized</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">corners</span> <span class="p">=</span> <span class="n">_points</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">point</span> <span class="p">=&gt;</span> <span class="n">point</span><span class="p">.</span><span class="n">IsCorner</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">corners</span><span class="p">.</span><span class="n">Length</span> <span class="p">&lt;=</span> <span class="m">2</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>    <span class="c1">//Shape作りようがない</span>
            <span class="n">isFinalize</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="c1">//配列範囲外が巡回するように小細工</span>
            <span class="n">Corners</span> <span class="p">=</span> <span class="n">corners</span><span class="p">.</span><span class="nf">Select</span><span class="p">((</span><span class="n">point</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">ShapeCorner</span><span class="p">(</span><span class="n">corners</span><span class="p">[(</span><span class="n">i</span> <span class="p">+</span> <span class="n">corners</span><span class="p">.</span><span class="n">Length</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">%</span> <span class="n">corners</span><span class="p">.</span><span class="n">Length</span><span class="p">],</span> <span class="n">point</span><span class="p">,</span> <span class="n">corners</span><span class="p">[(</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span> <span class="p">%</span> <span class="n">corners</span><span class="p">.</span><span class="n">Length</span><span class="p">])).</span><span class="nf">ToArray</span><span class="p">();</span>
        <span class="p">}</span>
</code></pre></div>
</div>

<p>角(ShapeCorner)は、「前の角、今の角、次の角」を持たせています。これにより、角の向き(法線)と、角度が求められます。</p>

<p>なお、仮に4角形の場合ShapeCornerは、0,1,2 で一つ、　1,2,3 で一つ、 2,3,0 で一つ、3,0,1 で一つです。<br>
このように配列が巡回する場合、if文書いたり、三項演算子使ったりしますが、<strong>補数</strong>と<strong>余算</strong>によって、プラス方向にもマイナス方向にも巡回するようにしています。(暇な人はどうなっているかじっくり見ても面白いかもです）</p>

<h1>
<span id="各shapecornerの数や前後関係から図形認識情報返却resolveshapeinfo位置向き法線横幅縦幅" class="fragment"></span><a href="#%E5%90%84shapecorner%E3%81%AE%E6%95%B0%E3%82%84%E5%89%8D%E5%BE%8C%E9%96%A2%E4%BF%82%E3%81%8B%E3%82%89%E5%9B%B3%E5%BD%A2%E8%AA%8D%E8%AD%98%E6%83%85%E5%A0%B1%E8%BF%94%E5%8D%B4resolveshapeinfo%E4%BD%8D%E7%BD%AE%E5%90%91%E3%81%8D%E6%B3%95%E7%B7%9A%E6%A8%AA%E5%B9%85%E7%B8%A6%E5%B9%85"><i class="fa fa-link"></i></a>⑤各ShapeCornerの数や前後関係から図形認識情報返却(ResolveShapeInfo:位置・向き(法線)・横幅縦幅)</h1>

<p>ここから後は大分力業です。<br>
ShapeCornerの配列を見て(PointListがShapeCornerの配列を持っているので、それを渡す）、それがどんな形なのか四角形なのか、星型なのか、リボン型なのかを泥臭く検出します（円は特殊）。</p>

<p>例えば、4角形の検出は</p>

<ul>
<li>角が4つであること</li>
<li>すべての角が90度　と言いたいが、遊びを持たせて90±20度 であること</li>
</ul>

<p>で、検出してます。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">BoxShapeResolver.cs</span></div>
<div class="highlight"><pre><code>        <span class="k">public</span> <span class="n">ResolveShapeInfo</span> <span class="nf">Check</span><span class="p">(</span><span class="n">ShapePointList</span> <span class="n">pointList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pointList</span><span class="p">.</span><span class="n">Corners</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pointList</span><span class="p">.</span><span class="n">Corners</span><span class="p">.</span><span class="n">Length</span> <span class="p">!=</span> <span class="m">4</span><span class="p">)</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span> <span class="c1">//そもそも頂点が足りない</span>

            <span class="c1">//角度が90度±20のものだけを配列化</span>
            <span class="kt">var</span> <span class="n">corners</span> <span class="p">=</span> <span class="n">pointList</span><span class="p">.</span><span class="n">Corners</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">corner</span> <span class="p">=&gt;</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">corner</span><span class="p">.</span><span class="n">Angle</span> <span class="p">-</span> <span class="m">90</span><span class="p">)</span> <span class="p">&lt;</span> <span class="n">angleThreshould</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">();</span>

            <span class="c1">//4つ以外なら4角形ではない</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">corners</span><span class="p">.</span><span class="n">Length</span> <span class="p">!=</span> <span class="m">4</span><span class="p">)</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>

            <span class="c1">//中心点計算</span>
            <span class="kt">var</span> <span class="n">centerPos</span> <span class="p">=</span> <span class="n">corners</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">corner</span> <span class="p">=&gt;</span> <span class="n">corner</span><span class="p">.</span><span class="n">CurrentPoint</span><span class="p">.</span><span class="n">Pos</span><span class="p">).</span><span class="nf">Average</span><span class="p">();</span>

            <span class="c1">//向き（法線）計算</span>
            <span class="kt">var</span> <span class="n">normal</span> <span class="p">=</span> <span class="n">corners</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">corner</span> <span class="p">=&gt;</span> <span class="n">corner</span><span class="p">.</span><span class="n">Normal</span><span class="p">).</span><span class="nf">Sum</span><span class="p">().</span><span class="n">normalized</span><span class="p">;</span>

            <span class="c1">//四角形のどこから描き出すかわからないし、ユーザーがどの方向を向いてい描いたかもわからないので、ともかく決め打ちで(0-1,3-2)を右方向と(3-0,2-1)を上方向のベクトルと見なす</span>
            <span class="kt">var</span> <span class="n">rightVec</span> <span class="p">=</span> <span class="p">((</span><span class="n">corners</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">CurrentPoint</span><span class="p">.</span><span class="n">Pos</span> <span class="p">-</span> <span class="n">corners</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">CurrentPoint</span><span class="p">.</span><span class="n">Pos</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">CurrentPoint</span><span class="p">.</span><span class="n">Pos</span> <span class="p">-</span> <span class="n">corners</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">CurrentPoint</span><span class="p">.</span><span class="n">Pos</span><span class="p">))</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">upVec</span> <span class="p">=</span> <span class="p">((</span><span class="n">corners</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">CurrentPoint</span><span class="p">.</span><span class="n">Pos</span> <span class="p">-</span> <span class="n">corners</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">CurrentPoint</span><span class="p">.</span><span class="n">Pos</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">CurrentPoint</span><span class="p">.</span><span class="n">Pos</span> <span class="p">-</span> <span class="n">corners</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">CurrentPoint</span><span class="p">.</span><span class="n">Pos</span><span class="p">))</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">;</span>

            <span class="kt">var</span> <span class="n">scaleX</span> <span class="p">=</span> <span class="n">rightVec</span><span class="p">.</span><span class="n">magnitude</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">scaleY</span> <span class="p">=</span> <span class="n">upVec</span><span class="p">.</span><span class="n">magnitude</span><span class="p">;</span>

            <span class="k">return</span> <span class="k">new</span> <span class="nf">ResolveShapeInfo</span><span class="p">(</span>
                <span class="n">centerPos</span><span class="p">,</span>                                                  <span class="c1">//中心</span>
                <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">scaleX</span><span class="p">,</span> <span class="n">scaleY</span><span class="p">,</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Min</span><span class="p">(</span><span class="n">scaleX</span> <span class="p">,</span> <span class="n">scaleY</span><span class="p">)</span> <span class="p">),</span>   <span class="c1">//奥行きは適当。今回は横幅と縦幅の小さいほうにしている</span>
                <span class="n">normal</span><span class="p">,</span>                                                     <span class="c1">//描いた図形の大体の向き</span>
                <span class="n">Quaternion</span><span class="p">.</span><span class="nf">LookRotation</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">upVec</span><span class="p">.</span><span class="n">normalized</span><span class="p">)</span>           <span class="c1">//法線方向に向かうQuaternion取得 上方向ベクトルは ↑ の決め打ちで作ったupVec</span>
            <span class="p">);</span>
        <span class="p">}</span>
</code></pre></div>
</div>

<p>なお、認識させたい図形はこれから増えていくかもしれません。　なので、</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">IShapeResolver.cs</span></div>
<div class="highlight"><pre><code>    <span class="k">public</span> <span class="k">interface</span> <span class="nc">IShapeResolver</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 名前</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 判定 解決出来ない場合はnullを返却</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="n">ResolveShapeInfo</span> <span class="nf">Check</span><span class="p">(</span><span class="n">ShapePointList</span> <span class="k">set</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div>
</div>

<p>こんな感じでinterfaceを作っておいて、認識したい図形毎にこのinterfaceを実装したクラスを作っています。<br>
既出の四角形検出も実際にはIShapeResolverを実装してますし、<br>
星（五芒星）型検出クラスもこんな感じです。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">StarShapeResolver.cs</span></div>
<div class="highlight"><pre><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">StarShapeResolver</span> <span class="p">:</span> <span class="n">IShapeResolver</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">=&gt;</span> <span class="s">"星"</span><span class="p">;</span>

        <span class="k">private</span> <span class="kt">float</span> <span class="n">angleThreshould</span> <span class="p">=</span> <span class="m">20</span><span class="p">;</span>

        <span class="k">public</span> <span class="n">ResolveShapeInfo</span> <span class="nf">Check</span><span class="p">(</span><span class="n">ShapePointList</span> <span class="n">pointList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pointList</span><span class="p">.</span><span class="n">Corners</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pointList</span><span class="p">.</span><span class="n">Corners</span><span class="p">.</span><span class="n">Length</span> <span class="p">&lt;</span> <span class="m">5</span><span class="p">)</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span> <span class="c1">//そもそも頂点が足りない</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">pointList</span><span class="p">.</span><span class="n">Corners</span><span class="p">.</span><span class="nf">Sum</span><span class="p">(</span><span class="n">corner</span> <span class="p">=&gt;</span> <span class="n">corner</span><span class="p">.</span><span class="n">Angle</span><span class="p">)</span> <span class="p">-</span> <span class="m">180</span><span class="p">)</span> <span class="p">&gt;</span> <span class="n">angleThreshould</span><span class="p">)</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>

            <span class="kt">var</span> <span class="n">corners</span> <span class="p">=</span> <span class="n">pointList</span><span class="p">.</span><span class="n">Corners</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>

            <span class="kt">var</span> <span class="n">centerPos</span> <span class="p">=</span> <span class="n">corners</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">corner</span> <span class="p">=&gt;</span> <span class="n">corner</span><span class="p">.</span><span class="n">CurrentPoint</span><span class="p">.</span><span class="n">Pos</span><span class="p">).</span><span class="nf">Average</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">normal</span> <span class="p">=</span> <span class="n">corners</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">corner</span> <span class="p">=&gt;</span> <span class="n">corner</span><span class="p">.</span><span class="n">Normal</span><span class="p">).</span><span class="nf">Sum</span><span class="p">().</span><span class="n">normalized</span><span class="p">;</span>

            <span class="k">return</span> <span class="k">new</span> <span class="nf">ResolveShapeInfo</span><span class="p">(</span><span class="n">centerPos</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">one</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">.</span><span class="n">identity</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
</div>

<p>ちなみに「五芒星」は内角の和が180度になるので、</p>

<ul>
<li>角が5つであること</li>
<li>すべての角の和が180度　と言いたいが、遊びを持たせて180±20度 であること</li>
</ul>

<p>で、検出してます。<br>
（星はメテオなので、モデルの向きやサイズを取る必要がなかったのでちょっと手抜きです）</p>

<hr>

<p>後はこの <code>IShapeResolver</code> を実装した複数クラスをまとめた <code>ShapeDetectService</code> クラスを作ってあげて(Facadeパターン？？）、検出された<code>ResolveShapeInfo</code> に従いPrefabをInstantiateしているだけです。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">ShapeDetectService.cs</span></div>
<div class="highlight"><pre><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">ShapeDetectService</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">ShapeType</span><span class="p">,</span> <span class="n">IShapeResolver</span><span class="p">&gt;</span> <span class="n">_resolvers</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">ShapeDetectService</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_resolvers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">ShapeType</span><span class="p">,</span> <span class="n">IShapeResolver</span><span class="p">&gt;{</span>
                <span class="p">{</span><span class="n">ShapeType</span><span class="p">.</span><span class="n">BOX</span><span class="p">,</span> <span class="k">new</span> <span class="nf">BoxShapeResolver</span><span class="p">()},</span>
                <span class="p">{</span><span class="n">ShapeType</span><span class="p">.</span><span class="n">STAR</span><span class="p">,</span> <span class="k">new</span> <span class="nf">StarShapeResolver</span><span class="p">()},</span>
                <span class="p">{</span><span class="n">ShapeType</span><span class="p">.</span><span class="n">RIBBON</span><span class="p">,</span> <span class="k">new</span> <span class="nf">RibbonShapeResolver</span><span class="p">()},</span>
                <span class="p">{</span><span class="n">ShapeType</span><span class="p">.</span><span class="n">CROSS</span><span class="p">,</span> <span class="k">new</span> <span class="nf">CrossShapeResolver</span><span class="p">()},</span>
                <span class="p">{</span><span class="n">ShapeType</span><span class="p">.</span><span class="n">CIRCLE</span><span class="p">,</span> <span class="k">new</span> <span class="nf">CircleShapeResolver</span><span class="p">()}</span>
            <span class="p">};</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">Check</span><span class="p">(</span><span class="n">ShapePointList</span> <span class="n">pointList</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ShapeType</span><span class="p">,</span> <span class="n">IShapeResolver</span><span class="p">,</span> <span class="n">ResolveShapeInfo</span><span class="p">&gt;</span> <span class="n">callback</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ResolveShapeInfo</span> <span class="n">shape</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">shapeResolver</span> <span class="k">in</span> <span class="n">_resolvers</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">shape</span> <span class="p">=</span> <span class="n">shapeResolver</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="nf">Check</span><span class="p">(</span><span class="n">pointList</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">shape</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">callback</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="n">shapeResolver</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span><span class="n">shapeResolver</span><span class="p">.</span><span class="n">Value</span><span class="p">,</span><span class="n">shape</span><span class="p">);</span>
                    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
</div>

<p>簡単ですね！</p>

<h2>
<span id="おまけ" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91"><i class="fa fa-link"></i></a>おまけ</h2>

<p>複数の <code>Vector3</code> の<strong>合計</strong>や<strong>平均</strong>が取りたい場合、Linqで行けるかと思いきや出来ないんですよね。（加算オペレータがオーバーライドされているかどうかは知る由もないため？？？）<br>
まぁ合計は <code>.Aggregate(Vector3.zero, (v1, v2) =&gt; v1 + v2);</code> ってやっても良いと言えば良いんですが。直感的ではないので、こんな拡張クラスを作っておくとちょっと便利です。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">Vector3Extensions.cs</span></div>
<div class="highlight"><pre><code>    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Vector3Extensions</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">Vector3</span> <span class="nf">Average</span><span class="p">(</span><span class="k">this</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;</span> <span class="n">vectors</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">vectors</span><span class="p">.</span><span class="nf">Sum</span><span class="p">()</span> <span class="p">/</span> <span class="n">vectors</span><span class="p">.</span><span class="nf">Count</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">Vector3</span> <span class="nf">Sum</span><span class="p">(</span><span class="k">this</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;</span> <span class="n">vectors</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">sum</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">v</span> <span class="k">in</span> <span class="n">vectors</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">sum</span> <span class="p">+=</span> <span class="n">v</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">sum</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="あとがき" class="fragment"></span><a href="#%E3%81%82%E3%81%A8%E3%81%8C%E3%81%8D"><i class="fa fa-link"></i></a>あとがき</h2>

<p>本当はソースコードもgithubでさらそうかとも思ったんですが、生成時の演出用にうっかり<em>DoTween Pro</em>入れてしまって、抜くの面倒なのでソース公開は無しで・・・。<br>
まぁコアな部分は大体書いてしまったし、需要もそんなにないでしょう。<br>
もし要望があれば直接私までどうぞ。</p>

<p>しかし。こんな素敵デバイスが400$って言うんだからすごいですよね！（日本円を避ける事で安く見せる作戦）<br>
今年こそ、今年こそ真のVR元年かもしれません。　</p>

<p>ではでは。</p>

<h2>
<span id="スペシャルサンクス" class="fragment"></span><a href="#%E3%82%B9%E3%83%9A%E3%82%B7%E3%83%A3%E3%83%AB%E3%82%B5%E3%83%B3%E3%82%AF%E3%82%B9"><i class="fa fa-link"></i></a>スペシャルサンクス</h2>

<p>今回の検出処理実装にあたり、Unityゲーム開発者ギルド（ <a href="https://scrapbox.io/unity-game-dev-guild-pr/Unity%E3%82%B2%E3%83%BC%E3%83%A0%E9%96%8B%E7%99%BA%E8%80%85%E3%82%AE%E3%83%AB%E3%83%89" class="autolink" rel="nofollow noopener" target="_blank">https://scrapbox.io/unity-game-dev-guild-pr/Unity%E3%82%B2%E3%83%BC%E3%83%A0%E9%96%8B%E7%99%BA%E8%80%85%E3%82%AE%E3%83%AB%E3%83%89</a> ）の皆様（naichi様・ドリフターズ / 神の詰将棋様）のご協力を頂きました。　まったく最高のギルドだぜ。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fdivideby_zero%2Fitems%2Fe62e7c536b2fff84a8bc&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fdivideby_zero%2Fitems%2Fe62e7c536b2fff84a8bc&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/divideby_zero/items/e62e7c536b2fff84a8bc/likers" class="css-1iupg5d">20</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">14</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/e62e7c536b2fff84a8bc/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/divideby_zero/items/e62e7c536b2fff84a8bc/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/divideby_zero/items/e62e7c536b2fff84a8bc/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/divideby_zero/items/e62e7c536b2fff84a8bc/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/divideby_zero/items/e62e7c536b2fff84a8bc.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-1ad8a303-b6ce-40b7-af19-bdb8fbc9e7e6">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-f0b5fb6e-c21d-4038-a8dc-41c138174b41"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-f0b5fb6e-c21d-4038-a8dc-41c138174b41">{}</script>
      
<div id="LoginModal-react-component-0f1492a3-5679-4f1a-badb-782e3f2f286a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-0f1492a3-5679-4f1a-badb-782e3f2f286a">{}</script>
      
<div id="StockModal-react-component-dbf2b6d8-248e-4ef1-9ecc-b19bd9e8112f"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-dbf2b6d8-248e-4ef1-9ecc-b19bd9e8112f">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;ZsCwk7eVJ+95f5A0ao7PjA5HwHUPkCaDFR/5+C3xt51WIKrLEoeQ6qw4urwcvj5JDmib9WoU45dBF9jkz0SyHw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eOculusQuest によって、(正しくはもっともっと前からでしょうけども）VR空間に「手」が持ち込めるようになりました。\u003cbr\u003e\nOculusQuest購入以前はGearVR開発しかまともにしたことのなかった僕からするとそれはとんでもない衝撃です。\u003cbr\u003e\n何でもできる！なんでもできるじゃないか！（何でもではない）\u003c/p\u003e\n\n\u003cp\u003e感動のあまり、何番煎じかわかりませんが、このようなアプリを作ってみました。\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eようやく納得できる頂点検出＋頂点パターンからのオブジェクト生成出来るようになったーー。やったーーー！！大変だったー！\u003cbr\u003e\u003cbr\u003e・四角→Cube\u003cbr\u003e・円→Sphere\u003cbr\u003e・リボン→Unityちゃん\u003cbr\u003e・星→もちろんアレですよ。\u003cbr\u003e\u003cbr\u003eもうちょっとまとまったらAPKと一緒にQiita記事書きます。\u003ca href=\"https://twitter.com/hashtag/OculusQuest?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#OculusQuest\u003c/a\u003e \u003ca href=\"https://twitter.com/hashtag/unity3d?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#unity3d\u003c/a\u003e \u003ca href=\"https://t.co/OV12b3BcG9\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/OV12b3BcG9\u003c/a\u003e\u003c/p\u003e— すずきかつーき (@divideby_zero) \u003ca href=\"https://twitter.com/divideby_zero/status/1142591851184177152?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2019年6月23日\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cscript async src=\"https://platform.twitter.com/widgets.js\"\u003e\u003c/script\u003e\n\n\u003cp\u003eというわけで、実行ファイル(APK)と解説になります。\u003cbr\u003e\nAPKファイルはこちらです。 \u003ca href=\"https://github.com/divide-by-zero/divide-by-zero.github.io/releases\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/divide-by-zero/divide-by-zero.github.io/releases\u003c/a\u003e\u003cbr\u003e\n\u003cstrong\u003eOculusQuestFirstStep.apk\u003c/strong\u003e をダウンロードして、よしなにお手元のOculusQuestに入れてください。\u003cbr\u003e\nなお、野良APKファイルをインストールするのには\u003c/p\u003e\n\n\u003cp\u003e①OculusQuestを開発者モードにする\u003cbr\u003e\n②ADB.exeの準備\u003cbr\u003e\n③APKファイルをADBコマンドで直接インストール\u003c/p\u003e\n\n\u003cp\u003e等々が必要です。要らぬハードル・・・！\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003eあんまりお勧めして良いかわかりませんが、 sidequest （参考: \u003ca href=\"https://vr-maniacs.com/entry/sidequest/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://vr-maniacs.com/entry/sidequest/\u003c/a\u003e )なんかが全部をカバーしてるんじゃないかなぁ。どうかなぁ（モニョモニョ\u003c/del\u003e\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eここから↓は技術解説になります。　興味がない方はお疲れ様でした。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"流れ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B5%81%E3%82%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e流れ\u003c/h2\u003e\n\n\u003cp\u003eハンドコントローラが作る軌跡の頂点生データを加工していって、最終的に図形を判断できるぐらいまで情報を加工・そぎ落としていきます。\u003c/p\u003e\n\n\u003cp\u003e①コントローラーの毎フレームの3次元位置(Vector3[])をShapePointListに追加(Add)\u003cbr\u003e\n↓\u003cbr\u003e\n②手ブレを加味した3次元位置(ShapePoint)に\u003cbr\u003e\n↓\u003cbr\u003e\n③ShapePointが角かどうか判断(isCorner)\u003cbr\u003e\n↓\u003cbr\u003e\n④角(ShapeCorner)のリスト作成\u003cbr\u003e\n↓\u003cbr\u003e\n⑤各ShapeCornerの数や前後関係から図形認識情報返却(ResolveShapeInfo:位置・向き(法線)・横幅縦幅)\u003cbr\u003e\n↓\u003cbr\u003e\n⑥図形認識情報(ResolverShapeInfo)に従い、prefab生成などを行う\u003c/p\u003e\n\n\u003cp\u003eこんな流れです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"コントローラーの毎フレームの3次元位置vector3\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%83%BC%E3%81%AE%E6%AF%8E%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AE3%E6%AC%A1%E5%85%83%E4%BD%8D%E7%BD%AEvector3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e①コントローラーの毎フレームの3次元位置(Vector3[])\u003c/h1\u003e\n\n\u003cp\u003eまず\u003cbr\u003e\nトリガーを押している間だけ、コントローラの位置を取得していきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eshapeDetect.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOVRInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOVRInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRawButton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRIndexTrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e//GETがHOLD、GETDOWNが押した瞬間GetUpが離した瞬間\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_targetTransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eそして、人間、何の指標も無しに空中でキレイに四角とか描けないので、実際にはLineRendererを使って実線を引いてます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"手ブレを加味した3次元位置shapepointを集めたリストshapepointlist作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%89%8B%E3%83%96%E3%83%AC%E3%82%92%E5%8A%A0%E5%91%B3%E3%81%97%E3%81%9F3%E6%AC%A1%E5%85%83%E4%BD%8D%E7%BD%AEshapepoint%E3%82%92%E9%9B%86%E3%82%81%E3%81%9F%E3%83%AA%E3%82%B9%E3%83%88shapepointlist%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e②手ブレを加味した3次元位置(ShapePoint)を集めたリスト(ShapePointList)作成\u003c/h1\u003e\n\n\u003cp\u003eやってみると分かるのですが、人間、空中でピタっと手を止めているつもりでも実際のところ数センチレベルで手がプルプルしちゃいます。手ブレですね。\u003cbr\u003e\nなので、\u003cstrong\u003e「前回位置から、今回位置の移動(\u003ccode\u003ecurrentVec\u003c/code\u003eがごく小さい場合は、頂点とみなさない」\u003c/strong\u003eルールにしました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eShapePointList.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentVec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003elastAddPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePos\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrentVec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esqrMagnitude\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003e_nearPointDetectValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003elastAddPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddNearPointCount\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eなお、デバッグ情報の意味を込めて頂点を追加しない場合は前回ShapePointのNearCountを足していくようにしています。\u003cbr\u003e\n何かに利用できるかな。と思って作ったプロパティですが、今の所出番がありません。不憫な子。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"図形認識の頂点角の3次元位置shapecorner認識\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9B%B3%E5%BD%A2%E8%AA%8D%E8%AD%98%E3%81%AE%E9%A0%82%E7%82%B9%E8%A7%92%E3%81%AE3%E6%AC%A1%E5%85%83%E4%BD%8D%E7%BD%AEshapecorner%E8%AA%8D%E8%AD%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e③図形認識の頂点(角)の3次元位置(ShapeCorner)認識\u003c/h1\u003e\n\n\u003cp\u003eさて。コントローラーが描く軌跡の頂点を若干削りましたが、本当に欲しいのは\u003cstrong\u003e「角」\u003c/strong\u003eです。\u003cbr\u003e\n\u003cstrong\u003e「角」\u003c/strong\u003eとは\u003cstrong\u003e「急に進行方向が変わった所」\u003c/strong\u003eです。\u003cbr\u003e\n今までの頂点の並びから、軌跡がどの方向に進んでいるかを求め(\u003ccode\u003elineVec\u003c/code\u003e)\u003cbr\u003e\nそれに対して、今回の線(前回頂点から今回頂点のベクトル:\u003ccode\u003ecurrentVec\u003c/code\u003e)はどれぐらい沿っているかを求めます。\u003c/p\u003e\n\n\u003cp\u003eこの二つのベクトルがどれぐらい似通っているかを表すのは。そう \u003cstrong\u003e内積\u003c/strong\u003eです。\u003c/p\u003e\n\n\u003cp\u003eベクトルの内積は直角（一番似通っていない)場合は０\u003cbr\u003e\n全く同じ場合は+1\u003cbr\u003e\n全く逆方向の場合は-1です\u003c/p\u003e\n\n\u003cp\u003e「なんとなくまっすぐっぽかったらまっすぐだとみなす」なので、具体的な数値は要調整ですが今回のアプリ内では \u003cstrong\u003e\"0.8f\"\u003c/strong\u003e にしました。一応角度に直すと 36.8698976°です。 結構曲がってても「直線」と見なし、それ以上に曲がっている場合は「角」としています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eShapePointList.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eisCorner\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e//前回の角からのベクトル足しこみ\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineVec\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentVec\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e//角度チェック\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edot\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elineVec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentVec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edot\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003e_cornerDetectDot\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eよし、これで良いじゃないか。\u003cbr\u003e\nと思うんですが、もう一つ問題があります。\u003c/p\u003e\n\n\u003cp\u003eここで有名な標語を貴方に\u003cbr\u003e\n\u003cstrong\u003e「危ないよ車は急に止まれない」\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e例えば手を左から右に水平に動かして、あるポイントで急に真下に振ろうとしても、\u003cstrong\u003e大体真下にはいきません\u003c/strong\u003e\u003cbr\u003e\nというか、大体の人はそこで一旦ブレーキをかけます。　今まで水平に動かしていたべクトルに真反対のベクトルをぶつけ、相殺させて一瞬止め、そこから手を下におろしているはずです（大抵は無意識なはず）\u003c/p\u003e\n\n\u003cp\u003eなので、例えば先ほどの「左から右に水平に動かし、90度真下へ」の角近辺のベクトルの流れは\u003cbr\u003e\n①→\u003cbr\u003e\n②←\u003cbr\u003e\n③↓\u003cbr\u003e\nの3つがグチャグチャします。\u003cbr\u003e\nしかもブレーキかけすぎたり（戻し過ぎたり）ブレーキが足りなかったり、そして無意識にそれを補正したりするので、「角」と認識した後しばらくは数値上は「角」だとしても意図してないことがほとんどです。\u003cbr\u003e\nなので、もう一つ条件\u003cbr\u003e\n\u003cstrong\u003e「前の頂点(Point)からの距離が想定より短い場合は角とみなさない」\u003c/strong\u003e\u003cbr\u003e\nを追加しています。（今回は5cmにしました。）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eShapePointList.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e                    \u003cspan class=\"c1\"\u003e//長さが足りない場合は、角近辺でごちゃごちゃしてる可能性\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elineVec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esqrMagnitude\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_lineDetectValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eisCorner\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003elineVec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentVec\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eなお、そのままベクトル間の距離を取得して5cm(Unityは単位メートルなので、0.05f)と比較しても良いですが、ベクトルの長さ(magnitude)は内部的には平方根が使われます(三平方の定理より）そのためそれなりに計算コストがかかるため、\u003ccode\u003esqrMagnitude\u003c/code\u003eを使って比較を行っています。\u003cbr\u003e\n　こっちのプロパティは、ベクトル間の距離の二乗が入っており（平方根を使っていない）大小比較だけなら同じように比較対象である5cm(0.05f)を二乗してあげれば良いです。若干の高速化小細工でした。\u003c/p\u003e\n\n\u003cp\u003e以下、ハンドコントローラの頂点情報を毎フレーム渡して、角検出している所全体像(抜粋）です\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eShapePointList.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eShapePointList\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003e_nearPointDetectValue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003e_lineDetectValue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003e_cornerDetectDot\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eShapePoint\u003c/span\u003e \u003cspan class=\"n\"\u003elastAddPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003elineVec\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e//現在描いてる線の偏向\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eShapePoint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_points\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eShapePoint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eShapePointList\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003e_nearPointDetectValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.01f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e0.01f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//1cm以下は手の震えとみなす\u003c/span\u003e\n            \u003cspan class=\"n\"\u003e_lineDetectValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.05f\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e0.05f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e   \u003cspan class=\"c1\"\u003e//直線は5cmぐらいは欲しい\u003c/span\u003e\n            \u003cspan class=\"n\"\u003e_cornerDetectDot\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0.8f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eAddPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elastAddPoint\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elastAddPoint\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eShapePoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineVec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentVec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003elastAddPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePos\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrentVec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esqrMagnitude\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003e_nearPointDetectValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003elastAddPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddNearPointCount\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eisCorner\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e//前回の角からのベクトル足しこみ\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elineVec\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentVec\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e//角度チェック\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edot\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elineVec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentVec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edot\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003e_cornerDetectDot\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e//長さが足りない場合は、角近辺でごちゃごちゃしてる可能性\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elineVec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esqrMagnitude\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_lineDetectValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eisCorner\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003elineVec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentVec\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003elastAddPoint\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eShapePoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eisCorner\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003e_points\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elastAddPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e紆余曲折あり、大分時間をかけた箇所なんですが、こう見るとシンプルですね。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"角shapecornerのリスト作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%92shapecorner%E3%81%AE%E3%83%AA%E3%82%B9%E3%83%88%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e④角(ShapeCorner)のリスト作成\u003c/h1\u003e\n\n\u003cp\u003e自分の納得のいく線が描けたら、トリガーを離します。このタイミングで一旦ShapeListを締めます(\u003ccode\u003eFinalized()\u003c/code\u003e)\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eShapeDetect.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOVRInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetUp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOVRInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRawButton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRIndexTrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e//頂点を確定\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFinalized\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eFinalized()\u003c/code\u003e では、収集した頂点(ShapePoint)の角(isCorner)フラグが立っているものから、\u003ccode\u003eShapeCorner\u003c/code\u003e の配列を作っています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eShapePointList.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisFinalize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eShapeCorner\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eFinalized\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_points\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsCorner\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e    \u003cspan class=\"c1\"\u003e//Shape作りようがない\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eisFinalize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//配列範囲外が巡回するように小細工\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCorners\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eShapeCorner\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003epoint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e])).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e角(ShapeCorner)は、「前の角、今の角、次の角」を持たせています。これにより、角の向き(法線)と、角度が求められます。\u003c/p\u003e\n\n\u003cp\u003eなお、仮に4角形の場合ShapeCornerは、0,1,2 で一つ、　1,2,3 で一つ、 2,3,0 で一つ、3,0,1 で一つです。\u003cbr\u003e\nこのように配列が巡回する場合、if文書いたり、三項演算子使ったりしますが、\u003cstrong\u003e補数\u003c/strong\u003eと\u003cstrong\u003e余算\u003c/strong\u003eによって、プラス方向にもマイナス方向にも巡回するようにしています。(暇な人はどうなっているかじっくり見ても面白いかもです）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"各shapecornerの数や前後関係から図形認識情報返却resolveshapeinfo位置向き法線横幅縦幅\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%90%84shapecorner%E3%81%AE%E6%95%B0%E3%82%84%E5%89%8D%E5%BE%8C%E9%96%A2%E4%BF%82%E3%81%8B%E3%82%89%E5%9B%B3%E5%BD%A2%E8%AA%8D%E8%AD%98%E6%83%85%E5%A0%B1%E8%BF%94%E5%8D%B4resolveshapeinfo%E4%BD%8D%E7%BD%AE%E5%90%91%E3%81%8D%E6%B3%95%E7%B7%9A%E6%A8%AA%E5%B9%85%E7%B8%A6%E5%B9%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e⑤各ShapeCornerの数や前後関係から図形認識情報返却(ResolveShapeInfo:位置・向き(法線)・横幅縦幅)\u003c/h1\u003e\n\n\u003cp\u003eここから後は大分力業です。\u003cbr\u003e\nShapeCornerの配列を見て(PointListがShapeCornerの配列を持っているので、それを渡す）、それがどんな形なのか四角形なのか、星型なのか、リボン型なのかを泥臭く検出します（円は特殊）。\u003c/p\u003e\n\n\u003cp\u003e例えば、4角形の検出は\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e角が4つであること\u003c/li\u003e\n\u003cli\u003eすべての角が90度　と言いたいが、遊びを持たせて90±20度 であること\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eで、検出してます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eBoxShapeResolver.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eResolveShapeInfo\u003c/span\u003e \u003cspan class=\"nf\"\u003eCheck\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eShapePointList\u003c/span\u003e \u003cspan class=\"n\"\u003epointList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epointList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCorners\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epointList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//そもそも頂点が足りない\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//角度が90度±20のものだけを配列化\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epointList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecorner\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAbs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecorner\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAngle\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e90\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eangleThreshould\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//4つ以外なら4角形ではない\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//中心点計算\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecenterPos\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecorner\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecorner\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePos\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAverage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//向き（法線）計算\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enormal\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecorner\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecorner\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNormal\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eSum\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//四角形のどこから描き出すかわからないし、ユーザーがどの方向を向いてい描いたかもわからないので、ともかく決め打ちで(0-1,3-2)を右方向と(3-0,2-1)を上方向のベクトルと見なす\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003erightVec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePos\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePos\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePos\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePos\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eupVec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePos\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePos\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePos\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePos\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003escaleX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erightVec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emagnitude\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003escaleY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eupVec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emagnitude\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eResolveShapeInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecenterPos\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                                  \u003cspan class=\"c1\"\u003e//中心\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escaleX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003escaleY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMathf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escaleX\u003c/span\u003e \u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003escaleY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e),\u003c/span\u003e   \u003cspan class=\"c1\"\u003e//奥行きは適当。今回は横幅と縦幅の小さいほうにしている\u003c/span\u003e\n                \u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                                     \u003cspan class=\"c1\"\u003e//描いた図形の大体の向き\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLookRotation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eupVec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e           \u003cspan class=\"c1\"\u003e//法線方向に向かうQuaternion取得 上方向ベクトルは ↑ の決め打ちで作ったupVec\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eなお、認識させたい図形はこれから増えていくかもしれません。　なので、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIShapeResolver.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIShapeResolver\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 名前\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 判定 解決出来ない場合はnullを返却\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;returns\u0026gt;\u0026lt;/returns\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eResolveShapeInfo\u003c/span\u003e \u003cspan class=\"nf\"\u003eCheck\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eShapePointList\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこんな感じでinterfaceを作っておいて、認識したい図形毎にこのinterfaceを実装したクラスを作っています。\u003cbr\u003e\n既出の四角形検出も実際にはIShapeResolverを実装してますし、\u003cbr\u003e\n星（五芒星）型検出クラスもこんな感じです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eStarShapeResolver.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eStarShapeResolver\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIShapeResolver\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"星\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eangleThreshould\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eResolveShapeInfo\u003c/span\u003e \u003cspan class=\"nf\"\u003eCheck\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eShapePointList\u003c/span\u003e \u003cspan class=\"n\"\u003epointList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epointList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCorners\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epointList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//そもそも頂点が足りない\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAbs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epointList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecorner\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecorner\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAngle\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e180\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eangleThreshould\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epointList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecenterPos\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecorner\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecorner\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePos\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAverage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enormal\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecorners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecorner\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecorner\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNormal\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eSum\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eResolveShapeInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecenterPos\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eone\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eQuaternion\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eidentity\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eちなみに「五芒星」は内角の和が180度になるので、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e角が5つであること\u003c/li\u003e\n\u003cli\u003eすべての角の和が180度　と言いたいが、遊びを持たせて180±20度 であること\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eで、検出してます。\u003cbr\u003e\n（星はメテオなので、モデルの向きやサイズを取る必要がなかったのでちょっと手抜きです）\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e後はこの \u003ccode\u003eIShapeResolver\u003c/code\u003e を実装した複数クラスをまとめた \u003ccode\u003eShapeDetectService\u003c/code\u003e クラスを作ってあげて(Facadeパターン？？）、検出された\u003ccode\u003eResolveShapeInfo\u003c/code\u003e に従いPrefabをInstantiateしているだけです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eShapeDetectService.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eShapeDetectService\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eShapeType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIShapeResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_resolvers\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eShapeDetectService\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003e_resolvers\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eShapeType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIShapeResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;{\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eShapeType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBOX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBoxShapeResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e()},\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eShapeType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSTAR\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStarShapeResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e()},\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eShapeType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRIBBON\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRibbonShapeResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e()},\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eShapeType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCROSS\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCrossShapeResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e()},\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eShapeType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCIRCLE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCircleShapeResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eCheck\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eShapePointList\u003c/span\u003e \u003cspan class=\"n\"\u003epointList\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eShapeType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIShapeResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eResolveShapeInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eResolveShapeInfo\u003c/span\u003e \u003cspan class=\"n\"\u003eshape\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eshapeResolver\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003e_resolvers\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eshape\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eshapeResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCheck\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epointList\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eshapeResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eshapeResolver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e簡単ですね！\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"おまけ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおまけ\u003c/h2\u003e\n\n\u003cp\u003e複数の \u003ccode\u003eVector3\u003c/code\u003e の\u003cstrong\u003e合計\u003c/strong\u003eや\u003cstrong\u003e平均\u003c/strong\u003eが取りたい場合、Linqで行けるかと思いきや出来ないんですよね。（加算オペレータがオーバーライドされているかどうかは知る由もないため？？？）\u003cbr\u003e\nまぁ合計は \u003ccode\u003e.Aggregate(Vector3.zero, (v1, v2) =\u0026gt; v1 + v2);\u003c/code\u003e ってやっても良いと言えば良いんですが。直感的ではないので、こんな拡張クラスを作っておくとちょっと便利です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eVector3Extensions.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eVector3Extensions\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"nf\"\u003eAverage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003evectors\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003evectors\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSum\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003evectors\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e \u003cspan class=\"nf\"\u003eSum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003evectors\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esum\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003evectors\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esum\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esum\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"あとがき\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%82%E3%81%A8%E3%81%8C%E3%81%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eあとがき\u003c/h2\u003e\n\n\u003cp\u003e本当はソースコードもgithubでさらそうかとも思ったんですが、生成時の演出用にうっかり\u003cem\u003eDoTween Pro\u003c/em\u003e入れてしまって、抜くの面倒なのでソース公開は無しで・・・。\u003cbr\u003e\nまぁコアな部分は大体書いてしまったし、需要もそんなにないでしょう。\u003cbr\u003e\nもし要望があれば直接私までどうぞ。\u003c/p\u003e\n\n\u003cp\u003eしかし。こんな素敵デバイスが400$って言うんだからすごいですよね！（日本円を避ける事で安く見せる作戦）\u003cbr\u003e\n今年こそ、今年こそ真のVR元年かもしれません。　\u003c/p\u003e\n\n\u003cp\u003eではでは。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"スペシャルサンクス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%83%9A%E3%82%B7%E3%83%A3%E3%83%AB%E3%82%B5%E3%83%B3%E3%82%AF%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスペシャルサンクス\u003c/h2\u003e\n\n\u003cp\u003e今回の検出処理実装にあたり、Unityゲーム開発者ギルド（ \u003ca href=\"https://scrapbox.io/unity-game-dev-guild-pr/Unity%E3%82%B2%E3%83%BC%E3%83%A0%E9%96%8B%E7%99%BA%E8%80%85%E3%82%AE%E3%83%AB%E3%83%89\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://scrapbox.io/unity-game-dev-guild-pr/Unity%E3%82%B2%E3%83%BC%E3%83%A0%E9%96%8B%E7%99%BA%E8%80%85%E3%82%AE%E3%83%AB%E3%83%89\u003c/a\u003e ）の皆様（naichi様・ドリフターズ / 神の詰将棋様）のご協力を頂きました。　まったく最高のギルドだぜ。\u003c/p\u003e\n","createdAt":"2019-07-02T06:46:36Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"wN3s9Zn2oDuG0YpT8OxEgSnFVAL2ch0a--dV+FnfUyw7ol946X--iQuMu8OKB31z1cw+Hrr9xg==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2019-07-03T17:31:25Z","likesCount":20,"linkUrl":"https://qiita.com/divideby_zero/items/e62e7c536b2fff84a8bc","organization":null,"originalId":952193,"stockedCount":14,"title":"空中に図形を描いて物体を生成するアプリを作ってみた","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B5%81%E3%82%8C\"\u003e流れ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%83%BC%E3%81%AE%E6%AF%8E%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AE3%E6%AC%A1%E5%85%83%E4%BD%8D%E7%BD%AEvector3\"\u003e①コントローラーの毎フレームの3次元位置(Vector3[])\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%89%8B%E3%83%96%E3%83%AC%E3%82%92%E5%8A%A0%E5%91%B3%E3%81%97%E3%81%9F3%E6%AC%A1%E5%85%83%E4%BD%8D%E7%BD%AEshapepoint%E3%82%92%E9%9B%86%E3%82%81%E3%81%9F%E3%83%AA%E3%82%B9%E3%83%88shapepointlist%E4%BD%9C%E6%88%90\"\u003e②手ブレを加味した3次元位置(ShapePoint)を集めたリスト(ShapePointList)作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%9B%B3%E5%BD%A2%E8%AA%8D%E8%AD%98%E3%81%AE%E9%A0%82%E7%82%B9%E8%A7%92%E3%81%AE3%E6%AC%A1%E5%85%83%E4%BD%8D%E7%BD%AEshapecorner%E8%AA%8D%E8%AD%98\"\u003e③図形認識の頂点(角)の3次元位置(ShapeCorner)認識\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A7%92shapecorner%E3%81%AE%E3%83%AA%E3%82%B9%E3%83%88%E4%BD%9C%E6%88%90\"\u003e④角(ShapeCorner)のリスト作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%90%84shapecorner%E3%81%AE%E6%95%B0%E3%82%84%E5%89%8D%E5%BE%8C%E9%96%A2%E4%BF%82%E3%81%8B%E3%82%89%E5%9B%B3%E5%BD%A2%E8%AA%8D%E8%AD%98%E6%83%85%E5%A0%B1%E8%BF%94%E5%8D%B4resolveshapeinfo%E4%BD%8D%E7%BD%AE%E5%90%91%E3%81%8D%E6%B3%95%E7%B7%9A%E6%A8%AA%E5%B9%85%E7%B8%A6%E5%B9%85\"\u003e⑤各ShapeCornerの数や前後関係から図形認識情報返却(ResolveShapeInfo:位置・向き(法線)・横幅縦幅)\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91\"\u003eおまけ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%82%E3%81%A8%E3%81%8C%E3%81%8D\"\u003eあとがき\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B9%E3%83%9A%E3%82%B7%E3%83%A3%E3%83%AB%E3%82%B5%E3%83%B3%E3%82%AF%E3%82%B9\"\u003eスペシャルサンクス\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":2249,"uuid":"e62e7c536b2fff84a8bc","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"diEFOsCWk1xAp32+W0UcRKBDZuQ=--mjgg7sAwNtid/Vjy--mqZ27YvJf3hTW3RqZZ2b/Q==","originalId":37184,"description":"プログラマやったり、専門学校教員やったり、ゲーム業界叩いてみたりしましたが、結局またプログラマやってます。\r\nXamarinとUnityが好き。というよりC#が好きっぽい。\r\n","facebookUrl":null,"githubUrl":"https://github.com/divide-by-zero","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"かつーき すずき","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/37184/profile-images/1523411235","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F37184%2Fprofile-images%2F1523411235?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=3c6fae84c17df17658a0be4acc59dfec","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F37184%2Fprofile-images%2F1523411235?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=23e17839943e7fa660fbe097d0b218ac","urlName":"divideby_zero","websiteUrl":"","twitterUrl":"https://twitter.com/divideby_zero","twitterUrlName":"divideby_zero","revealedOrganizations":{"edges":[{"node":{"encryptedId":"6qmtipg/0BT9y79z06CJj1s2/2Oy0ir7Yto=--3N6Do9zRvL7GPWtS--pRysjb9i6IYaXzLTfSzRaw==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"Unityゲーム開発者ギルド","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","urlName":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。","url":"https://unity-game-dev-guild.github.io/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Unity3D","urlName":"unity3d"},{"name":"VR","urlName":"vr"},{"name":"OculusQuest","urlName":"oculusquest"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

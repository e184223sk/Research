<!DOCTYPE html><html><head><meta charset="utf-8" /><title>[VisualStudio/ダンプ] ProcDumpを使ったダンプファイルの作成と解析 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/tera1707/items/26b7d19e7ae1b4978f9f" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="EKGU/jCI5YXW8CECX045qcyj82jytzUn/tw3SkQQAYpw82/0kRbKo5HS+TNSxeki1ZINg++d7s7ckUAiY37qow==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="[VisualStudio/ダンプ] ProcDumpを使ったダンプファイルの作成と解析 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XMVpwYzNWaGJGTjBkV1JwYnlfamc0RGpnN1BqZzVkZElGQnliMk5FZFcxdzQ0S1M1TDJfNDRHajQ0R2Y0NE9BNDRPejQ0T1g0NE9WNDRLaDQ0S2s0NE9yNDRHdTVMMmM1b2lRNDRHbzZLZWo1cDZRJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTBiOGQ0NTk2Y2M5YTIyYjc5YjQ0ZmQ5ODNhMjEyZTMz&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJsY21FeE56QTMmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01OTFjMWUwZjM2MjIxODZiYTQzMTViMmZjOTU0MDFiYg&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=d3af2bbd4a41016a83a1030cabd08bf1"><meta property="og:description" content="もくじ
→https://qiita.com/tera1707/items/4fda73d86eded283ec4f

ダンプ関連記事
https://qiita.com/tera1707/items/4fda73d86eded283..."><meta content="https://qiita.com/tera1707/items/26b7d19e7ae1b4978f9f" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C++,C#,VisualStudio,ダンプ,procdump" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-68dcca40-275c-441e-bf6f-bd8b58bf0da9"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Ftera1707%2Fitems%2F26b7d19e7ae1b4978f9f">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Ftera1707%2Fitems%2F26b7d19e7ae1b4978f9f">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-68dcca40-275c-441e-bf6f-bd8b58bf0da9">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/cpp","name":"C++"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-08-24T17:39:16.000+09:00","dateModified":"2021-03-11T08:45:22.000+09:00","headline":"[VisualStudio/ダンプ] ProcDumpを使ったダンプファイルの作成と解析","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XMVpwYzNWaGJGTjBkV1JwYnlfamc0RGpnN1BqZzVkZElGQnliMk5FZFcxdzQ0S1M1TDJfNDRHajQ0R2Y0NE9BNDRPejQ0T1g0NE9WNDRLaDQ0S2s0NE9yNDRHdTVMMmM1b2lRNDRHbzZLZWo1cDZRJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTBiOGQ0NTk2Y2M5YTIyYjc5YjQ0ZmQ5ODNhMjEyZTMz\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJsY21FeE56QTMmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01OTFjMWUwZjM2MjIxODZiYTQzMTViMmZjOTU0MDFiYg\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=d3af2bbd4a41016a83a1030cabd08bf1","mainEntityOfPage":"https://qiita.com/tera1707/items/26b7d19e7ae1b4978f9f","author":{"@type":"Person","address":"大阪","email":"tera1707@gmail.com","identifier":"tera1707","name":"tera1707","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F19180456%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1ddd4d18cb0c4d9ee77ed7cff93f4ae1","url":"https://qiita.com/tera1707","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita&amp;utm_medium=header-banner">運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tera1707","type":"items","id":"26b7d19e7ae1b4978f9f"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tera1707","type":"items","id":"26b7d19e7ae1b4978f9f"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tera1707","type":"items","id":"26b7d19e7ae1b4978f9f"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/tera1707/items/26b7d19e7ae1b4978f9f","location":"/tera1707/items/26b7d19e7ae1b4978f9f","scheme":"https","host":"qiita.com","port":null,"pathname":"/tera1707/items/26b7d19e7ae1b4978f9f","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"8XlgxPFgEPEMp8BBsMvS7pugiYGa3EeqtKrMAx2kv22RK5vOUP4/10uFGHC9QAJlgpF3aof2nEOW57trOspURA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-846f0f46-c3f4-4362-be84-2d99bf7f85bf"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tera1707/items/26b7d19e7ae1b4978f9f/likers" class="css-1iupg5d">1</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">0</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/26b7d19e7ae1b4978f9f/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tera1707/items/26b7d19e7ae1b4978f9f/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tera1707/items/26b7d19e7ae1b4978f9f/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tera1707/items/26b7d19e7ae1b4978f9f/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tera1707/items/26b7d19e7ae1b4978f9f.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/tera1707"><img class="css-100alwu eyfquo10" src="https://avatars0.githubusercontent.com/u/19180456?v=4" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/tera1707" class="css-10ougpm">@<!-- -->tera1707</a><div class="css-1ay9vb9"><span><meta content="2020-08-24T08:39:16Z"/><time dateTime="2021-03-10T23:45:22Z" class="css-m19uds">updated at 2021-03-10</time></span></div></div></div></div></div><h1 class="css-cgzq40">[VisualStudio/ダンプ] ProcDumpを使ったダンプファイルの作成と解析</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/cpp" class="css-4czcte">C++</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/visualstudio" class="css-4czcte">VisualStudio</a><a href="/tags/%e3%83%80%e3%83%b3%e3%83%97" class="css-4czcte">ダンプ</a><a href="/tags/procdump" class="css-4czcte">procdump</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p><strong>もくじ</strong><br>
→<a href="https://qiita.com/tera1707/items/4fda73d86eded283ec4f" class="autolink" id="reference-8c71f210c4618e82bb42">https://qiita.com/tera1707/items/4fda73d86eded283ec4f</a></p>

<p><strong>ダンプ関連記事</strong><br>
<a href="https://qiita.com/tera1707/items/4fda73d86eded283ec4f#%E3%83%80%E3%83%B3%E3%83%97%E3%81%AE%E6%8E%A1%E5%8F%96%E3%81%A8%E3%81%9D%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0" class="autolink" id="reference-8c71f210c4618e82bb42">https://qiita.com/tera1707/items/4fda73d86eded283ec4f#%E3%83%80%E3%83%B3%E3%83%97%E3%81%AE%E6%8E%A1%E5%8F%96%E3%81%A8%E3%81%9D%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0</a></p>

<h1>
<span id="やりたいこと" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>やりたいこと</h1>

<p>自分が作成したあるアプリが、他の人のPCで動かしたときに例外を吐いてクラッシュしてしまう。<br>
その原因を調べたい。できれば自分のPCでVisualStudioでデバッグ実行して、落ちた部分でbreakさせて調査をしたいが、自分のPCでは起きてくれず、リモートデバッグも出来ない状況だが、なんとかして手がかりを得たい。</p>

<h1>
<span id="やること" class="fragment"></span><a href="#%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>やること</h1>

<p>ダンプを採取して、VisualStudio(2019)で、落ちた時の状況を再現する。<br>
ダンプの採取には、Microsoftのツール「Proc Dump」を使用する。</p>

<h1>
<span id="前提" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>前提</h1>

<p>今回ダンプのやり方を調べるきっかけとなった、アプリがクラッシュしてこまった時の状況は下記のようなものだった。</p>

<ul>
<li>状況

<ul>
<li>アプリは、VisualStudio2019、C#、.netFramework4.0で作成している。</li>
<li>アプリで特定の操作を、かなりの回数行ったときにアプリがクラッシュする。(BSODではない)</li>
<li>起きている例外は「AccessViolationException」だった。</li>
<li>自分の(開発用の)PCでは起きない。</li>
<li>テスターの方のPCでのみ起きる。</li>
<li>最初、起きた時はReleaseビルドだったが、試した結果Debugビルドでも起きる。</li>
<li>テスターの方のPCで、Debugビルドで再現させてもらうことは可能。</li>
</ul>
</li>
</ul>

<p>そのため、この状況に対してなにか情報を得られるようなProcDumpの使い方を調べる。<br>
ProcDumpは、ここで調べたやり方以外にもいろいろなことができる様子。</p>

<h3>
<span id="サンプルプログラム" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0"><i class="fa fa-link"></i></a>サンプルプログラム</h3>

<p>調べるきっかけになったことは上記のようなことだが、実験的にアプリをクラッシュさせて、どういう動きをするのかを実験したかったので、実験の際は下記のサンプルプログラムでヒープの0番地にデータをコピーする、ということを行って、「<strong>System.AccessViolationException</strong>」でクラッシュするようにした。<br>
このプログラムで、だいたい同じようなシチュエーションになっているはず。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">AccessViolationExceptionでクラッシュ.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">WpfApp48</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">unsafe</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MainWindow</span> <span class="p">:</span> <span class="n">Window</span>
    <span class="p">{</span>
        <span class="k">internal</span> <span class="k">class</span> <span class="nc">NativeMethods</span>
        <span class="p">{</span>
            <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"kernel32.dll"</span><span class="p">)]</span>
            <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="k">unsafe</span> <span class="k">void</span> <span class="nf">CopyMemory</span><span class="p">(</span><span class="k">void</span><span class="p">*</span> <span class="n">dst</span><span class="p">,</span> <span class="k">void</span><span class="p">*</span> <span class="n">src</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="k">unsafe</span> <span class="k">void</span> <span class="nf">Button_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">realsrc</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="p">{</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">};</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">realdest</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="m">3</span><span class="p">];</span>

            <span class="k">fixed</span> <span class="p">(</span><span class="k">void</span><span class="p">*</span> <span class="n">src</span> <span class="p">=</span> <span class="n">realsrc</span><span class="p">)</span>
            <span class="k">fixed</span> <span class="p">(</span><span class="k">void</span><span class="p">*</span> <span class="n">dest</span> <span class="p">=</span> <span class="n">realdest</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// ここで無理やり0番地にデータをコピーするようにした</span>
                <span class="n">NativeMethods</span><span class="p">.</span><span class="nf">CopyMemory</span><span class="p">((</span><span class="k">void</span><span class="p">*)</span><span class="m">0</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">realsrc</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h1>
<span id="やり方" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E6%96%B9"><i class="fa fa-link"></i></a>やり方</h1>

<h2>
<span id="何の例外で落ちたかを調べる" class="fragment"></span><a href="#%E4%BD%95%E3%81%AE%E4%BE%8B%E5%A4%96%E3%81%A7%E8%90%BD%E3%81%A1%E3%81%9F%E3%81%8B%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B"><i class="fa fa-link"></i></a>何の例外で落ちたかを調べる</h2>

<p>アプリが落ちた時に、何の例外で落ちたか？を確認する。</p>

<h3>
<span id="一般的なクラッシュ原因の例外が何だったかの調べ方" class="fragment"></span><a href="#%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E5%8E%9F%E5%9B%A0%E3%81%AE%E4%BE%8B%E5%A4%96%E3%81%8C%E4%BD%95%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%8B%E3%81%AE%E8%AA%BF%E3%81%B9%E6%96%B9"><i class="fa fa-link"></i></a>一般的な、クラッシュ原因の例外が何だったかの調べ方</h3>

<p>イベントログに、該当のアプリがなぜクラッシュしたかが残るので、それを見て調べる。</p>

<ul>
<li>イベントログの開き方

<ul>
<li>[Windowsキー + R]を押す</li>
<li>eventvwrと入力し、Enterを押す</li>
<li>[Windowsログ]の中の[Application]を開く</li>
</ul>
</li>
</ul>

<p>上のサンプルプログラムがクラッシュした際には、下記のようなイベントログが残る。<br>
<a href="https://camo.qiitausercontent.com/abe3a3fcce64c4b9267d98613fa963df541e2d23/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f61636361363665312d356632372d373432302d323831662d6666366564616532346635312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Facca66e1-5f27-7420-281f-ff6edae24f51.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=92ab040b88b792020f626e4a03cfac6c" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/acca66e1-5f27-7420-281f-ff6edae24f51.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Facca66e1-5f27-7420-281f-ff6edae24f51.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=fb7879eb0bae0be4d313811cf1fc6852 1x" loading="lazy"></a><br>
これで、<br>
「<strong>System.AccessViolationException</strong>」でクラッシュしたのだ、とわかる。</p>

<h2>
<span id="procdumpを使ってダンプファイルを作成する" class="fragment"></span><a href="#procdump%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%80%E3%83%B3%E3%83%97%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ProcDumpを使ってダンプファイルを作成する</h2>

<h3>
<span id="procdumpをダウンロード" class="fragment"></span><a href="#procdump%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>ProcDumpをダウンロード</h3>

<p>ProcDumpとは、指定したアプリが、指定した例外で落ちた時にダンプファイルを作成してくれるツール。<br>
(色々な指定をして、ダンプを作成できる。詳しくは下記のページを参照)</p>

<p>下記のMicrosoftのページの「Downliad ProcDump」をクリックして、ProcDumpをダウンロードしてくる。<br>
<a href="https://docs.microsoft.com/ja-jp/sysinternals/downloads/procdump" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/sysinternals/downloads/procdump</a></p>

<p><a href="https://camo.qiitausercontent.com/f38af656e39501804882a7178ccce4ab2b86f109/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f31666235616366632d643630372d653831622d373063612d3462326239336431343236372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F1fb5acfc-d607-e81b-70ca-4b2b93d14267.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6264cae1bc87b7bb1158babf8e25b1cc" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/1fb5acfc-d607-e81b-70ca-4b2b93d14267.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F1fb5acfc-d607-e81b-70ca-4b2b93d14267.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=13945ca7fcabdda932aeb25b5bed8c42 1x" loading="lazy"></a><br>
※調べた時点では、バージョンはv9.0。</p>

<p>ダウンロードしたzipを解凍すると、下記のようなファイルがある。<br>
ここにある「<strong>procdump.exe</strong>」がツール本体。</p>

<h3>
<span id="procdump実行のためのパラメータを決める" class="fragment"></span><a href="#procdump%E5%AE%9F%E8%A1%8C%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%82%92%E6%B1%BA%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>ProcDump実行のためのパラメータを決める</h3>

<p>こいつを実行する際に渡すパラメータで、何のアプリの、何の例外を取るか、というのを指定できる。<br>
下記の欄に詳しく書かれている。<br>
<a href="https://docs.microsoft.com/ja-jp/sysinternals/downloads/procdump#using-procdump" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/sysinternals/downloads/procdump#using-procdump</a><br>
<a href="https://camo.qiitausercontent.com/aeaacd82e41c3fda6f5728d4563c8978995c7b73/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f64633061613266652d333930372d633431392d616533332d3335366263623261383363352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fdc0aa2fe-3907-c419-ae33-356bcb2a83c5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=88233a8773cdb9496e6021cb7a71fa88" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/dc0aa2fe-3907-c419-ae33-356bcb2a83c5.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fdc0aa2fe-3907-c419-ae33-356bcb2a83c5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=cb6726b92c2622adb74eea8f1c9678e6 1x" loading="lazy"></a></p>

<p>今回の、上の「前提」のところに書いた状況を鑑みて、ProcDumpには下記のパラメータを渡してダンプ作成させることにした。(動かす、クラッシュするアプリは実験用コードのものを使う)</p>

<ul>
<li>ProcDump実行のためのコマンド

<ul>
<li><code>procdump -w -ma -e -f *Violation* WpfApp48.exe</code></li>
</ul>
</li>
</ul>

<table>
<thead>
<tr>
<th style="text-align: left">パラメータ</th>
<th style="text-align: left">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">-w</td>
<td style="text-align: left">対象のプロセスが起動するまで待つ。<br>指定しないと、procdump起動時「そんなプロセス起動してないよ」と言ってprocdump終わってまう</td>
</tr>
<tr>
<td style="text-align: left">-e</td>
<td style="text-align: left">例外が起きた時にダンプファイルを取るようにする。※</td>
</tr>
<tr>
<td style="text-align: left">-f &lt;例外の名前&gt;</td>
<td style="text-align: left">ダンプをとる例外を指定する。<br>指定の際は「*」も使える。上記のように指定すると、AccessViolationExceptionも対象になってくれる。</td>
</tr>
<tr>
<td style="text-align: left">-ma</td>
<td style="text-align: left">フルダンプ。<br>プロセスの仮想アドレス空間をすべて含む。※</td>
</tr>
</tbody>
</table>

<p>※<strong>その他のパラメータについては、<a href="https://docs.microsoft.com/ja-jp/sysinternals/downloads/procdump#using-procdump" rel="nofollow noopener" target="_blank">こちら</a>を参照。</strong></p>

<p><strong>※<code>-e</code>パラメータについて</strong><br>
<code>-e 1</code>などとして、1を付けるとファーストチャンス例外をとる、とか公式に説明があるが、要するに、<br>
1を付けるとtry catchで自前の例外処理をしてる部分でもダンプをとる、ということをする。<br>
(1がないと、try catchしてるとこではダンプしない)<br>
今回は、trycatchできていない(アプリがクラッシュしてしまう)例外のときにダンプしたいので、1は付けない。</p>

<p><strong>※<code>-ma</code>フルダンプについて</strong><br>
<code>-ma</code>のほかに、<code>-mm</code>や<code>-mp</code>がある様子だが、msdocsにある説明だけではそれらがどう異なるのかよくわからないので別途実験をしてみた。→<a href="https://qiita.com/tera1707/items/112b491a196acd6d24ec" id="reference-2e4b22001fd058bfde9a">こちら参照。</a></p>

<h1>
<span id="procdumpを実行する" class="fragment"></span><a href="#procdump%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ProcDumpを実行する</h1>

<p>コマンドプロンプトから、上で決めたパラメータを渡してProcDumpを実行する。<br>
※毎回コマンドプロンプトを開いてコマンド入力したくないので、バッチファイルを作って行う。</p>

<p>同じ階層に<strong>godebug.bat</strong>というファイルを作成し、下記のように書く。<br>
<a href="https://camo.qiitausercontent.com/2f5e8440180580b805d2f9697a29c19b88457662/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f35356663306337382d363532362d316431652d663735632d6438613863303630346333362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F55fc0c78-6526-1d1e-f75c-d8a8c0604c36.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=61a32fd03201792fbade9c2bd9b6842b" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/55fc0c78-6526-1d1e-f75c-d8a8c0604c36.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F55fc0c78-6526-1d1e-f75c-d8a8c0604c36.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=213b09f07779cf4ea7f7e1e694b5ad29 1x" loading="lazy"></a></p>

<div class="code-frame" data-lang="batchfile">
<div class="code-lang"><span class="bold">godebug.bat</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nb">procdump</span> <span class="na">-w -ma -e -f </span><span class="o">*</span><span class="kd">Violation</span><span class="o">*</span> <span class="kd">WpfApp48</span><span class="err">.exe</span>
<span class="nb">pause</span>
</code></pre></div>
</div>

<p>このバッチファイルをダブルクリックして実行すると、下記のような画面が開く。<br>
※コマンドプロンプト中の<code>WpfApp48.exe</code>というのは、今回の実験のためのクラッシュさせるアプリの名前</p>

<p><a href="https://camo.qiitausercontent.com/0a75cfba3568ad5921aa3569d5740d4bd20df915/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f31303734626630312d393164302d386561362d626261352d3938303061323964313665662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F1074bf01-91d0-8ea6-bba5-9800a29d16ef.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ee2eb378b0d4e1aea20efb939ddfafb0" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/1074bf01-91d0-8ea6-bba5-9800a29d16ef.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F1074bf01-91d0-8ea6-bba5-9800a29d16ef.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4a81fe2b9546c6ac3210fce5f9668e2f 1x" loading="lazy"></a></p>

<p>これで、対象のアプリが動き出すのを待っている状態になった。</p>

<h2>
<span id="対象アプリを起動し例外が起きる操作を行う" class="fragment"></span><a href="#%E5%AF%BE%E8%B1%A1%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%97%E4%BE%8B%E5%A4%96%E3%81%8C%E8%B5%B7%E3%81%8D%E3%82%8B%E6%93%8D%E4%BD%9C%E3%82%92%E8%A1%8C%E3%81%86"><i class="fa fa-link"></i></a>対象アプリを起動し、例外が起きる操作を行う</h2>

<p>対象のアプリを起動すると、コマンドプロンプトのの表示が下記のように変化する。<br>
<a href="https://camo.qiitausercontent.com/62e218bb3aeee95c51f1d5098b6dc9f4d236b12b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f38353564386230652d376438642d356338352d623433322d6236353730623165343439372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F855d8b0e-7d8d-5c85-b432-b6570b1e4497.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=816b8f89fc71e9507d91376fbcf720a8" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/855d8b0e-7d8d-5c85-b432-b6570b1e4497.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F855d8b0e-7d8d-5c85-b432-b6570b1e4497.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ba533fc8a2baf2feb1ac819663a1f1bb 1x" loading="lazy"></a><br>
※対象のアプリのexeパスや、指定した例外の名前(<em>Violation</em>)、出力するダンプの名前などいろんな情報が載っている。</p>

<p>さらに、その状態で指定の例外が発生すると、下記のような表示になる。<br>
<a href="https://camo.qiitausercontent.com/9869cee613ff2970a4d96fd317f02dd5fa7e3949/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f65653736306365362d353631362d313363342d303936392d3162303065636136353061362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fee760ce6-5616-13c4-0969-1b00eca650a6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=bab3e37ca9a41d0754174700a7913ce4" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/ee760ce6-5616-13c4-0969-1b00eca650a6.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fee760ce6-5616-13c4-0969-1b00eca650a6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3ab45813f03c6947ae4a5b8d0d901bd6 1x" loading="lazy"></a></p>

<p>上記表示がでると、例外が発生したのでダンプを出力した状態。<br>
ProcDump.exeのフォルダに、ダンプファイルが出力されている。<br>
<a href="https://camo.qiitausercontent.com/c767c795d992d1f6e0a52403687655146d16cee4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f33393335613562322d316630382d356638382d393433372d3731343736353635613839652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F3935a5b2-1f08-5f88-9437-71476565a89e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=043e8f58dfdcb3a31440b1f6f84ad0f7" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/3935a5b2-1f08-5f88-9437-71476565a89e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F3935a5b2-1f08-5f88-9437-71476565a89e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d5a2cf7049f5be6cf455e8e7e279315f 1x" loading="lazy"></a></p>

<h2>
<span id="visualstudio2019でダンプのデバッグを行う" class="fragment"></span><a href="#visualstudio2019%E3%81%A7%E3%83%80%E3%83%B3%E3%83%97%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%82%92%E8%A1%8C%E3%81%86"><i class="fa fa-link"></i></a>VisualStudio2019でダンプのデバッグを行う</h2>

<h3>
<span id="開く" class="fragment"></span><a href="#%E9%96%8B%E3%81%8F"><i class="fa fa-link"></i></a>開く</h3>

<p>作成されたダンプファイルをVisualStudio2019で開く。<br>
VisualStudio2019のメニューから、<br>
- [ファイル]<br>
- [開く]<br>
- [ファイル] <br>
- →作成されたダンプファイルを選択する。</p>

<p><a href="https://camo.qiitausercontent.com/703c0887b7cf08489b992332e0d7a08cf9dccb22/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f64356335656465652d636265622d326432642d393434642d3135346364373766393162632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fd5c5edee-cbeb-2d2d-944d-154cd77f91bc.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=149e52d8c1d9031ff7473d841672e4d1" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/d5c5edee-cbeb-2d2d-944d-154cd77f91bc.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fd5c5edee-cbeb-2d2d-944d-154cd77f91bc.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0488d0ccfef1420289f6444d5c23c334 1x" loading="lazy"></a><br>
※.dmpファイルがVisualStudio2019に関連づけられているのなら、ダブルクリックするだけでもOK。</p>

<p>ダンプファイルを開くと、下記のような画面になる。<br>
<a href="https://camo.qiitausercontent.com/54f3b48900fdafa936c3c18f44a64247d1ce14f4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f30663266366133662d643830382d303966352d656161352d6439613638373731393864662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F0f2f6a3f-d808-09f5-eaa5-d9a6877198df.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a05c8610c3e77c1e056b404c9f24823e" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/0f2f6a3f-d808-09f5-eaa5-d9a6877198df.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F0f2f6a3f-d808-09f5-eaa5-d9a6877198df.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=40c8fe33f4dc26e3d81bbe5766bbf124 1x" loading="lazy"></a></p>

<p>ここで、右上のほうの「マネージドのみでデバッグ」をクリックする。<br>
もし開発を行ったPCで、ソースコードが開発(コードを書いてビルドした)ときと同じパスに置いてあるなら、下記のように、クラッシュしたときのコード上の位置が表示される。<br>
<a href="https://camo.qiitausercontent.com/ffa0f5c6b902c7ddaf2c1e425e3a0b5e761c101c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f35613465336130392d336231362d656266322d616438302d3262393663393131643930302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F5a4e3a09-3b16-ebf2-ad80-2b96c911d900.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=471d0e2b2536c200cfbb771c1a80cc2e" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/5a4e3a09-3b16-ebf2-ad80-2b96c911d900.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F5a4e3a09-3b16-ebf2-ad80-2b96c911d900.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6ed0d077b5310abbbbd139b4e0e6c185 1x" loading="lazy"></a></p>

<p>※もし開発用のPCではなく、ソースコードがビルド時のパスに無い場合は、下記のような画面になる。<br>
<a href="https://camo.qiitausercontent.com/967ebc28e2e61ba6c29a0c9b15bacdcdf3812abc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f36343038623438332d643634662d336635302d666233612d3066626563623539633735362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F6408b483-d64f-3f50-fb3a-0fbecb59c756.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=bbc9dcbc1d8445766603f26079a331ac" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/6408b483-d64f-3f50-fb3a-0fbecb59c756.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F6408b483-d64f-3f50-fb3a-0fbecb59c756.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=45215fa8a54f4be2f82caa1bd1ca2c34 1x" loading="lazy"></a><br>
これは、ダンプファイルの中に実装時のコードのパスや、実行時のexeのパスの情報を覚えていて、そのパスにコードやexeが見つからないから出ているエラーっぽい。そのあたり、別ページで実験してみたので<a href="https://qiita.com/tera1707/items/112b491a196acd6d24ec">こちら参照</a>。</p>

<h3>
<span id="デバッグする" class="fragment"></span><a href="#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>デバッグする</h3>

<p>これで、VisualStudioでデバッグ実行中にbreakを貼って、そこで止めたときと似たことができる。<br>
つまり、クラッシュしたときに、プロパティにどういう値が入っていたのか、とか、スタックフレームを遡ったりできる。(さかのぼった先で、そこのプロパティがどういう値なのか、も見ることができる)</p>

<p>こんな感じ<br>
<a href="https://camo.qiitausercontent.com/c66bab2cc351d49a4609aa9425727e7bee36261f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f65323839666461342d643234322d643837302d306563322d3564383062346336373439372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fe289fda4-d242-d870-0ec2-5d80b4c67497.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e9ce3a88d137e220553335f58a917a94" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/e289fda4-d242-d870-0ec2-5d80b4c67497.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fe289fda4-d242-d870-0ec2-5d80b4c67497.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c6aa11a7b8092ab254839286f5c88529 1x" loading="lazy"></a><br>
ただし、デバッグ実行の時のように、F5を押して続きを実行するということはできない。</p>

<h3>
<span id="注意点" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>注意点</h3>

<p>今回はDebugビルドのexeを実行して、そのダンプファイルを作成し解析したが、Releaseビルドだと、できることに制限がある。</p>

<p>今回試した限りでは、最適化がかかっているために、クラッシュ箇所で止まった時のプロパティの値が見れないものがあった。(メソッド内のローカル変数は見れなかった。クラスのプロパティは見れるっぽい)</p>

<p><a href="https://camo.qiitausercontent.com/52f0bb077100d717c1fffc45e4c36aab5a712901/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f37646332363932652d376131322d613762632d656461372d3338313431376663656231612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F7dc2692e-7a12-a7bc-eda7-381417fceb1a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5b67970cf51dd4f3089925c36ade9b5f" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/7dc2692e-7a12-a7bc-eda7-381417fceb1a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F7dc2692e-7a12-a7bc-eda7-381417fceb1a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=56e3db04754933e00c82df912364eb33 1x" loading="lazy"></a></p>

<h2>
<span id="以上" class="fragment"></span><a href="#%E4%BB%A5%E4%B8%8A"><i class="fa fa-link"></i></a>以上</h2>

<p>以上が、ProcDunpを使ったダンプファイルの取得とVisualStudio2019での解析のやり方。<br>
アンマネージドのコードで同じことをしたいときなどはまた別の手順があるかもしれないが、それはそういう場面に出会ったらまた調べる。</p>

<h1>
<span id="参照" class="fragment"></span><a href="#%E5%8F%82%E7%85%A7"><i class="fa fa-link"></i></a>参照</h1>

<p>procdumpの仕様（コマンドのパラメータなど）<br>
<a href="https://docs.microsoft.com/ja-jp/sysinternals/downloads/procdump" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/sysinternals/downloads/procdump</a></p>

<p>VisualStudioでのダンプについて<br>
<a href="https://docs.microsoft.com/ja-jp/visualstudio/debugger/using-dump-files?view=vs-2019" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/visualstudio/debugger/using-dump-files?view=vs-2019</a></p>

<p>-mm、-ma、-mpの違い<br>
<a href="https://docs.microsoft.com/ja-jp/archive/msdn-magazine/2011/december/sysinternals-procdump-v4-0-writing-a-plug-in-for-sysinternals-procdump-v4-0#%E7%94%A8%E8%AA%9E" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/archive/msdn-magazine/2011/december/sysinternals-procdump-v4-0-writing-a-plug-in-for-sysinternals-procdump-v4-0#%E7%94%A8%E8%AA%9E</a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Ftera1707%2Fitems%2F26b7d19e7ae1b4978f9f&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Ftera1707%2Fitems%2F26b7d19e7ae1b4978f9f&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tera1707/items/26b7d19e7ae1b4978f9f/likers" class="css-1iupg5d">1</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">0</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/26b7d19e7ae1b4978f9f/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tera1707/items/26b7d19e7ae1b4978f9f/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tera1707/items/26b7d19e7ae1b4978f9f/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tera1707/items/26b7d19e7ae1b4978f9f/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tera1707/items/26b7d19e7ae1b4978f9f.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-846f0f46-c3f4-4362-be84-2d99bf7f85bf">{"authorAnalyticsTrackingId":"UA-140152640-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-063c3c7e-e6ec-4e5d-b79b-e60626f1c42a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-063c3c7e-e6ec-4e5d-b79b-e60626f1c42a">{}</script>
      
<div id="LoginModal-react-component-322fc319-57b6-449a-b955-5172b85fa3ac"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-322fc319-57b6-449a-b955-5172b85fa3ac">{}</script>
      
<div id="StockModal-react-component-139df8cd-9477-4624-8764-2d51458136f9"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-139df8cd-9477-4624-8764-2d51458136f9">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;YGpP4xSKmcAfD+/oPHF/JsV4sKGQWgfKWRL5sV2mGd8AOLTptRS25lgtN9kx+q+t3ElOSo1w3CN7X47Zesjy9g==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e\u003cstrong\u003eもくじ\u003c/strong\u003e\u003cbr\u003e\n→\u003ca href=\"https://qiita.com/tera1707/items/4fda73d86eded283ec4f\" class=\"autolink\" id=\"reference-8c71f210c4618e82bb42\"\u003ehttps://qiita.com/tera1707/items/4fda73d86eded283ec4f\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eダンプ関連記事\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/tera1707/items/4fda73d86eded283ec4f#%E3%83%80%E3%83%B3%E3%83%97%E3%81%AE%E6%8E%A1%E5%8F%96%E3%81%A8%E3%81%9D%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0\" class=\"autolink\" id=\"reference-8c71f210c4618e82bb42\"\u003ehttps://qiita.com/tera1707/items/4fda73d86eded283ec4f#%E3%83%80%E3%83%B3%E3%83%97%E3%81%AE%E6%8E%A1%E5%8F%96%E3%81%A8%E3%81%9D%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"やりたいこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやりたいこと\u003c/h1\u003e\n\n\u003cp\u003e自分が作成したあるアプリが、他の人のPCで動かしたときに例外を吐いてクラッシュしてしまう。\u003cbr\u003e\nその原因を調べたい。できれば自分のPCでVisualStudioでデバッグ実行して、落ちた部分でbreakさせて調査をしたいが、自分のPCでは起きてくれず、リモートデバッグも出来ない状況だが、なんとかして手がかりを得たい。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"やること\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやること\u003c/h1\u003e\n\n\u003cp\u003eダンプを採取して、VisualStudio(2019)で、落ちた時の状況を再現する。\u003cbr\u003e\nダンプの採取には、Microsoftのツール「Proc Dump」を使用する。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"前提\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E6%8F%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前提\u003c/h1\u003e\n\n\u003cp\u003e今回ダンプのやり方を調べるきっかけとなった、アプリがクラッシュしてこまった時の状況は下記のようなものだった。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e状況\n\n\u003cul\u003e\n\u003cli\u003eアプリは、VisualStudio2019、C#、.netFramework4.0で作成している。\u003c/li\u003e\n\u003cli\u003eアプリで特定の操作を、かなりの回数行ったときにアプリがクラッシュする。(BSODではない)\u003c/li\u003e\n\u003cli\u003e起きている例外は「AccessViolationException」だった。\u003c/li\u003e\n\u003cli\u003e自分の(開発用の)PCでは起きない。\u003c/li\u003e\n\u003cli\u003eテスターの方のPCでのみ起きる。\u003c/li\u003e\n\u003cli\u003e最初、起きた時はReleaseビルドだったが、試した結果Debugビルドでも起きる。\u003c/li\u003e\n\u003cli\u003eテスターの方のPCで、Debugビルドで再現させてもらうことは可能。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eそのため、この状況に対してなにか情報を得られるようなProcDumpの使い方を調べる。\u003cbr\u003e\nProcDumpは、ここで調べたやり方以外にもいろいろなことができる様子。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"サンプルプログラム\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサンプルプログラム\u003c/h3\u003e\n\n\u003cp\u003e調べるきっかけになったことは上記のようなことだが、実験的にアプリをクラッシュさせて、どういう動きをするのかを実験したかったので、実験の際は下記のサンプルプログラムでヒープの0番地にデータをコピーする、ということを行って、「\u003cstrong\u003eSystem.AccessViolationException\u003c/strong\u003e」でクラッシュするようにした。\u003cbr\u003e\nこのプログラムで、だいたい同じようなシチュエーションになっているはず。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eAccessViolationExceptionでクラッシュ.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.InteropServices\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Windows\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eWpfApp48\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMainWindow\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eWindow\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNativeMethods\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"kernel32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n            \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCopyMemory\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003edst\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eMainWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eInitializeComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eButton_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003erealsrc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003erealdest\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003efixed\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erealsrc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efixed\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003edest\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erealdest\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// ここで無理やり0番地にデータをコピーするようにした\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eNativeMethods\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCopyMemory\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e*)\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erealsrc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"やり方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやり方\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"何の例外で落ちたかを調べる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%95%E3%81%AE%E4%BE%8B%E5%A4%96%E3%81%A7%E8%90%BD%E3%81%A1%E3%81%9F%E3%81%8B%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e何の例外で落ちたかを調べる\u003c/h2\u003e\n\n\u003cp\u003eアプリが落ちた時に、何の例外で落ちたか？を確認する。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"一般的なクラッシュ原因の例外が何だったかの調べ方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E5%8E%9F%E5%9B%A0%E3%81%AE%E4%BE%8B%E5%A4%96%E3%81%8C%E4%BD%95%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%8B%E3%81%AE%E8%AA%BF%E3%81%B9%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e一般的な、クラッシュ原因の例外が何だったかの調べ方\u003c/h3\u003e\n\n\u003cp\u003eイベントログに、該当のアプリがなぜクラッシュしたかが残るので、それを見て調べる。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eイベントログの開き方\n\n\u003cul\u003e\n\u003cli\u003e[Windowsキー + R]を押す\u003c/li\u003e\n\u003cli\u003eeventvwrと入力し、Enterを押す\u003c/li\u003e\n\u003cli\u003e[Windowsログ]の中の[Application]を開く\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e上のサンプルプログラムがクラッシュした際には、下記のようなイベントログが残る。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/abe3a3fcce64c4b9267d98613fa963df541e2d23/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f61636361363665312d356632372d373432302d323831662d6666366564616532346635312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Facca66e1-5f27-7420-281f-ff6edae24f51.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=92ab040b88b792020f626e4a03cfac6c\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/acca66e1-5f27-7420-281f-ff6edae24f51.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Facca66e1-5f27-7420-281f-ff6edae24f51.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fb7879eb0bae0be4d313811cf1fc6852 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nこれで、\u003cbr\u003e\n「\u003cstrong\u003eSystem.AccessViolationException\u003c/strong\u003e」でクラッシュしたのだ、とわかる。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"procdumpを使ってダンプファイルを作成する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#procdump%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%80%E3%83%B3%E3%83%97%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eProcDumpを使ってダンプファイルを作成する\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"procdumpをダウンロード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#procdump%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eProcDumpをダウンロード\u003c/h3\u003e\n\n\u003cp\u003eProcDumpとは、指定したアプリが、指定した例外で落ちた時にダンプファイルを作成してくれるツール。\u003cbr\u003e\n(色々な指定をして、ダンプを作成できる。詳しくは下記のページを参照)\u003c/p\u003e\n\n\u003cp\u003e下記のMicrosoftのページの「Downliad ProcDump」をクリックして、ProcDumpをダウンロードしてくる。\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/sysinternals/downloads/procdump\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/sysinternals/downloads/procdump\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/f38af656e39501804882a7178ccce4ab2b86f109/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f31666235616366632d643630372d653831622d373063612d3462326239336431343236372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F1fb5acfc-d607-e81b-70ca-4b2b93d14267.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6264cae1bc87b7bb1158babf8e25b1cc\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/1fb5acfc-d607-e81b-70ca-4b2b93d14267.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F1fb5acfc-d607-e81b-70ca-4b2b93d14267.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=13945ca7fcabdda932aeb25b5bed8c42 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n※調べた時点では、バージョンはv9.0。\u003c/p\u003e\n\n\u003cp\u003eダウンロードしたzipを解凍すると、下記のようなファイルがある。\u003cbr\u003e\nここにある「\u003cstrong\u003eprocdump.exe\u003c/strong\u003e」がツール本体。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"procdump実行のためのパラメータを決める\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#procdump%E5%AE%9F%E8%A1%8C%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%82%92%E6%B1%BA%E3%82%81%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eProcDump実行のためのパラメータを決める\u003c/h3\u003e\n\n\u003cp\u003eこいつを実行する際に渡すパラメータで、何のアプリの、何の例外を取るか、というのを指定できる。\u003cbr\u003e\n下記の欄に詳しく書かれている。\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/sysinternals/downloads/procdump#using-procdump\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/sysinternals/downloads/procdump#using-procdump\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/aeaacd82e41c3fda6f5728d4563c8978995c7b73/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f64633061613266652d333930372d633431392d616533332d3335366263623261383363352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fdc0aa2fe-3907-c419-ae33-356bcb2a83c5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=88233a8773cdb9496e6021cb7a71fa88\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/dc0aa2fe-3907-c419-ae33-356bcb2a83c5.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fdc0aa2fe-3907-c419-ae33-356bcb2a83c5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cb6726b92c2622adb74eea8f1c9678e6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e今回の、上の「前提」のところに書いた状況を鑑みて、ProcDumpには下記のパラメータを渡してダンプ作成させることにした。(動かす、クラッシュするアプリは実験用コードのものを使う)\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eProcDump実行のためのコマンド\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eprocdump -w -ma -e -f *Violation* WpfApp48.exe\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003eパラメータ\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e説明\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e-w\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e対象のプロセスが起動するまで待つ。\u003cbr\u003e指定しないと、procdump起動時「そんなプロセス起動してないよ」と言ってprocdump終わってまう\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e-e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e例外が起きた時にダンプファイルを取るようにする。※\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e-f \u0026lt;例外の名前\u0026gt;\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eダンプをとる例外を指定する。\u003cbr\u003e指定の際は「*」も使える。上記のように指定すると、AccessViolationExceptionも対象になってくれる。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e-ma\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eフルダンプ。\u003cbr\u003eプロセスの仮想アドレス空間をすべて含む。※\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e※\u003cstrong\u003eその他のパラメータについては、\u003ca href=\"https://docs.microsoft.com/ja-jp/sysinternals/downloads/procdump#using-procdump\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003eを参照。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e※\u003ccode\u003e-e\u003c/code\u003eパラメータについて\u003c/strong\u003e\u003cbr\u003e\n\u003ccode\u003e-e 1\u003c/code\u003eなどとして、1を付けるとファーストチャンス例外をとる、とか公式に説明があるが、要するに、\u003cbr\u003e\n1を付けるとtry catchで自前の例外処理をしてる部分でもダンプをとる、ということをする。\u003cbr\u003e\n(1がないと、try catchしてるとこではダンプしない)\u003cbr\u003e\n今回は、trycatchできていない(アプリがクラッシュしてしまう)例外のときにダンプしたいので、1は付けない。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e※\u003ccode\u003e-ma\u003c/code\u003eフルダンプについて\u003c/strong\u003e\u003cbr\u003e\n\u003ccode\u003e-ma\u003c/code\u003eのほかに、\u003ccode\u003e-mm\u003c/code\u003eや\u003ccode\u003e-mp\u003c/code\u003eがある様子だが、msdocsにある説明だけではそれらがどう異なるのかよくわからないので別途実験をしてみた。→\u003ca href=\"https://qiita.com/tera1707/items/112b491a196acd6d24ec\" id=\"reference-2e4b22001fd058bfde9a\"\u003eこちら参照。\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"procdumpを実行する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#procdump%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eProcDumpを実行する\u003c/h1\u003e\n\n\u003cp\u003eコマンドプロンプトから、上で決めたパラメータを渡してProcDumpを実行する。\u003cbr\u003e\n※毎回コマンドプロンプトを開いてコマンド入力したくないので、バッチファイルを作って行う。\u003c/p\u003e\n\n\u003cp\u003e同じ階層に\u003cstrong\u003egodebug.bat\u003c/strong\u003eというファイルを作成し、下記のように書く。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/2f5e8440180580b805d2f9697a29c19b88457662/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f35356663306337382d363532362d316431652d663735632d6438613863303630346333362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F55fc0c78-6526-1d1e-f75c-d8a8c0604c36.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=61a32fd03201792fbade9c2bd9b6842b\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/55fc0c78-6526-1d1e-f75c-d8a8c0604c36.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F55fc0c78-6526-1d1e-f75c-d8a8c0604c36.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=213b09f07779cf4ea7f7e1e694b5ad29 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"batchfile\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003egodebug.bat\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003eprocdump\u003c/span\u003e \u003cspan class=\"na\"\u003e-w -ma -e -f \u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"kd\"\u003eViolation\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"kd\"\u003eWpfApp48\u003c/span\u003e\u003cspan class=\"err\"\u003e.exe\u003c/span\u003e\n\u003cspan class=\"nb\"\u003epause\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこのバッチファイルをダブルクリックして実行すると、下記のような画面が開く。\u003cbr\u003e\n※コマンドプロンプト中の\u003ccode\u003eWpfApp48.exe\u003c/code\u003eというのは、今回の実験のためのクラッシュさせるアプリの名前\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/0a75cfba3568ad5921aa3569d5740d4bd20df915/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f31303734626630312d393164302d386561362d626261352d3938303061323964313665662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F1074bf01-91d0-8ea6-bba5-9800a29d16ef.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ee2eb378b0d4e1aea20efb939ddfafb0\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/1074bf01-91d0-8ea6-bba5-9800a29d16ef.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F1074bf01-91d0-8ea6-bba5-9800a29d16ef.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4a81fe2b9546c6ac3210fce5f9668e2f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれで、対象のアプリが動き出すのを待っている状態になった。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"対象アプリを起動し例外が起きる操作を行う\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AF%BE%E8%B1%A1%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%97%E4%BE%8B%E5%A4%96%E3%81%8C%E8%B5%B7%E3%81%8D%E3%82%8B%E6%93%8D%E4%BD%9C%E3%82%92%E8%A1%8C%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e対象アプリを起動し、例外が起きる操作を行う\u003c/h2\u003e\n\n\u003cp\u003e対象のアプリを起動すると、コマンドプロンプトのの表示が下記のように変化する。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/62e218bb3aeee95c51f1d5098b6dc9f4d236b12b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f38353564386230652d376438642d356338352d623433322d6236353730623165343439372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F855d8b0e-7d8d-5c85-b432-b6570b1e4497.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=816b8f89fc71e9507d91376fbcf720a8\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/855d8b0e-7d8d-5c85-b432-b6570b1e4497.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F855d8b0e-7d8d-5c85-b432-b6570b1e4497.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ba533fc8a2baf2feb1ac819663a1f1bb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n※対象のアプリのexeパスや、指定した例外の名前(\u003cem\u003eViolation\u003c/em\u003e)、出力するダンプの名前などいろんな情報が載っている。\u003c/p\u003e\n\n\u003cp\u003eさらに、その状態で指定の例外が発生すると、下記のような表示になる。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/9869cee613ff2970a4d96fd317f02dd5fa7e3949/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f65653736306365362d353631362d313363342d303936392d3162303065636136353061362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fee760ce6-5616-13c4-0969-1b00eca650a6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bab3e37ca9a41d0754174700a7913ce4\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/ee760ce6-5616-13c4-0969-1b00eca650a6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fee760ce6-5616-13c4-0969-1b00eca650a6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3ab45813f03c6947ae4a5b8d0d901bd6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e上記表示がでると、例外が発生したのでダンプを出力した状態。\u003cbr\u003e\nProcDump.exeのフォルダに、ダンプファイルが出力されている。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c767c795d992d1f6e0a52403687655146d16cee4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f33393335613562322d316630382d356638382d393433372d3731343736353635613839652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F3935a5b2-1f08-5f88-9437-71476565a89e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=043e8f58dfdcb3a31440b1f6f84ad0f7\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/3935a5b2-1f08-5f88-9437-71476565a89e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F3935a5b2-1f08-5f88-9437-71476565a89e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d5a2cf7049f5be6cf455e8e7e279315f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"visualstudio2019でダンプのデバッグを行う\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#visualstudio2019%E3%81%A7%E3%83%80%E3%83%B3%E3%83%97%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%82%92%E8%A1%8C%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVisualStudio2019でダンプのデバッグを行う\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"開く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%8B%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e開く\u003c/h3\u003e\n\n\u003cp\u003e作成されたダンプファイルをVisualStudio2019で開く。\u003cbr\u003e\nVisualStudio2019のメニューから、\u003cbr\u003e\n- [ファイル]\u003cbr\u003e\n- [開く]\u003cbr\u003e\n- [ファイル] \u003cbr\u003e\n- →作成されたダンプファイルを選択する。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/703c0887b7cf08489b992332e0d7a08cf9dccb22/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f64356335656465652d636265622d326432642d393434642d3135346364373766393162632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fd5c5edee-cbeb-2d2d-944d-154cd77f91bc.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=149e52d8c1d9031ff7473d841672e4d1\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/d5c5edee-cbeb-2d2d-944d-154cd77f91bc.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fd5c5edee-cbeb-2d2d-944d-154cd77f91bc.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0488d0ccfef1420289f6444d5c23c334 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n※.dmpファイルがVisualStudio2019に関連づけられているのなら、ダブルクリックするだけでもOK。\u003c/p\u003e\n\n\u003cp\u003eダンプファイルを開くと、下記のような画面になる。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/54f3b48900fdafa936c3c18f44a64247d1ce14f4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f30663266366133662d643830382d303966352d656161352d6439613638373731393864662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F0f2f6a3f-d808-09f5-eaa5-d9a6877198df.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a05c8610c3e77c1e056b404c9f24823e\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/0f2f6a3f-d808-09f5-eaa5-d9a6877198df.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F0f2f6a3f-d808-09f5-eaa5-d9a6877198df.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=40c8fe33f4dc26e3d81bbe5766bbf124 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eここで、右上のほうの「マネージドのみでデバッグ」をクリックする。\u003cbr\u003e\nもし開発を行ったPCで、ソースコードが開発(コードを書いてビルドした)ときと同じパスに置いてあるなら、下記のように、クラッシュしたときのコード上の位置が表示される。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ffa0f5c6b902c7ddaf2c1e425e3a0b5e761c101c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f35613465336130392d336231362d656266322d616438302d3262393663393131643930302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F5a4e3a09-3b16-ebf2-ad80-2b96c911d900.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=471d0e2b2536c200cfbb771c1a80cc2e\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/5a4e3a09-3b16-ebf2-ad80-2b96c911d900.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F5a4e3a09-3b16-ebf2-ad80-2b96c911d900.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6ed0d077b5310abbbbd139b4e0e6c185 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e※もし開発用のPCではなく、ソースコードがビルド時のパスに無い場合は、下記のような画面になる。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/967ebc28e2e61ba6c29a0c9b15bacdcdf3812abc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f36343038623438332d643634662d336635302d666233612d3066626563623539633735362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F6408b483-d64f-3f50-fb3a-0fbecb59c756.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bbc9dcbc1d8445766603f26079a331ac\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/6408b483-d64f-3f50-fb3a-0fbecb59c756.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F6408b483-d64f-3f50-fb3a-0fbecb59c756.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=45215fa8a54f4be2f82caa1bd1ca2c34 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nこれは、ダンプファイルの中に実装時のコードのパスや、実行時のexeのパスの情報を覚えていて、そのパスにコードやexeが見つからないから出ているエラーっぽい。そのあたり、別ページで実験してみたので\u003ca href=\"https://qiita.com/tera1707/items/112b491a196acd6d24ec\"\u003eこちら参照\u003c/a\u003e。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"デバッグする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデバッグする\u003c/h3\u003e\n\n\u003cp\u003eこれで、VisualStudioでデバッグ実行中にbreakを貼って、そこで止めたときと似たことができる。\u003cbr\u003e\nつまり、クラッシュしたときに、プロパティにどういう値が入っていたのか、とか、スタックフレームを遡ったりできる。(さかのぼった先で、そこのプロパティがどういう値なのか、も見ることができる)\u003c/p\u003e\n\n\u003cp\u003eこんな感じ\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c66bab2cc351d49a4609aa9425727e7bee36261f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f65323839666461342d643234322d643837302d306563322d3564383062346336373439372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fe289fda4-d242-d870-0ec2-5d80b4c67497.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e9ce3a88d137e220553335f58a917a94\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/e289fda4-d242-d870-0ec2-5d80b4c67497.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fe289fda4-d242-d870-0ec2-5d80b4c67497.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c6aa11a7b8092ab254839286f5c88529 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nただし、デバッグ実行の時のように、F5を押して続きを実行するということはできない。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"注意点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e注意点\u003c/h3\u003e\n\n\u003cp\u003e今回はDebugビルドのexeを実行して、そのダンプファイルを作成し解析したが、Releaseビルドだと、できることに制限がある。\u003c/p\u003e\n\n\u003cp\u003e今回試した限りでは、最適化がかかっているために、クラッシュ箇所で止まった時のプロパティの値が見れないものがあった。(メソッド内のローカル変数は見れなかった。クラスのプロパティは見れるっぽい)\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/52f0bb077100d717c1fffc45e4c36aab5a712901/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f37646332363932652d376131322d613762632d656461372d3338313431376663656231612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F7dc2692e-7a12-a7bc-eda7-381417fceb1a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5b67970cf51dd4f3089925c36ade9b5f\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/7dc2692e-7a12-a7bc-eda7-381417fceb1a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F7dc2692e-7a12-a7bc-eda7-381417fceb1a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=56e3db04754933e00c82df912364eb33 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"以上\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%A5%E4%B8%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e以上\u003c/h2\u003e\n\n\u003cp\u003e以上が、ProcDunpを使ったダンプファイルの取得とVisualStudio2019での解析のやり方。\u003cbr\u003e\nアンマネージドのコードで同じことをしたいときなどはまた別の手順があるかもしれないが、それはそういう場面に出会ったらまた調べる。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参照\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E7%85%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参照\u003c/h1\u003e\n\n\u003cp\u003eprocdumpの仕様（コマンドのパラメータなど）\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/sysinternals/downloads/procdump\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/sysinternals/downloads/procdump\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eVisualStudioでのダンプについて\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/visualstudio/debugger/using-dump-files?view=vs-2019\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/visualstudio/debugger/using-dump-files?view=vs-2019\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e-mm、-ma、-mpの違い\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/archive/msdn-magazine/2011/december/sysinternals-procdump-v4-0-writing-a-plug-in-for-sysinternals-procdump-v4-0#%E7%94%A8%E8%AA%9E\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/archive/msdn-magazine/2011/december/sysinternals-procdump-v4-0-writing-a-plug-in-for-sysinternals-procdump-v4-0#%E7%94%A8%E8%AA%9E\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2020-08-24T08:39:16Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"Y7DO4eIrPzei9hl5K0HiUGzwntsMhrTplQ==--4J6Sbet5OYoMNMY5--dWqopgzi2KF3wJVjad7sKw==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2021-03-10T23:45:22Z","likesCount":1,"linkUrl":"https://qiita.com/tera1707/items/26b7d19e7ae1b4978f9f","organization":null,"originalId":1288083,"stockedCount":0,"title":"[VisualStudio/ダンプ] ProcDumpを使ったダンプファイルの作成と解析","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003eやりたいこと\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8\"\u003eやること\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%89%8D%E6%8F%90\"\u003e前提\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0\"\u003eサンプルプログラム\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cli\u003e\n\u003ca href=\"#%E3%82%84%E3%82%8A%E6%96%B9\"\u003eやり方\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%95%E3%81%AE%E4%BE%8B%E5%A4%96%E3%81%A7%E8%90%BD%E3%81%A1%E3%81%9F%E3%81%8B%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B\"\u003e何の例外で落ちたかを調べる\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E5%8E%9F%E5%9B%A0%E3%81%AE%E4%BE%8B%E5%A4%96%E3%81%8C%E4%BD%95%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%8B%E3%81%AE%E8%AA%BF%E3%81%B9%E6%96%B9\"\u003e一般的な、クラッシュ原因の例外が何だったかの調べ方\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#procdump%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%80%E3%83%B3%E3%83%97%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"\u003eProcDumpを使ってダンプファイルを作成する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#procdump%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\"\u003eProcDumpをダウンロード\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#procdump%E5%AE%9F%E8%A1%8C%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%82%92%E6%B1%BA%E3%82%81%E3%82%8B\"\u003eProcDump実行のためのパラメータを決める\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#procdump%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B\"\u003eProcDumpを実行する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AF%BE%E8%B1%A1%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%97%E4%BE%8B%E5%A4%96%E3%81%8C%E8%B5%B7%E3%81%8D%E3%82%8B%E6%93%8D%E4%BD%9C%E3%82%92%E8%A1%8C%E3%81%86\"\u003e対象アプリを起動し、例外が起きる操作を行う\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#visualstudio2019%E3%81%A7%E3%83%80%E3%83%B3%E3%83%97%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%82%92%E8%A1%8C%E3%81%86\"\u003eVisualStudio2019でダンプのデバッグを行う\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%96%8B%E3%81%8F\"\u003e開く\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B\"\u003eデバッグする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e注意点\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%A5%E4%B8%8A\"\u003e以上\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E7%85%A7\"\u003e参照\u003c/a\u003e\n\u003c/li\u003e\n\n","totalPv":2678,"uuid":"26b7d19e7ae1b4978f9f","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"tyc+I9d0NmYgw2KZVNgU70i5nS1k--+YZfPe8/TgNjTw1q--x1oWDpCDOY1T5fLvFBk0rg==","originalId":352601,"description":"","facebookUrl":null,"githubUrl":"https://github.com/tera1707","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://avatars0.githubusercontent.com/u/19180456?v=4","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F19180456%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=d374ef2a13106c43b12251ae9f724ca0","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F19180456%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1ddd4d18cb0c4d9ee77ed7cff93f4ae1","urlName":"tera1707","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C++","urlName":"cpp"},{"name":"C#","urlName":"csharp"},{"name":"VisualStudio","urlName":"visualstudio"},{"name":"ダンプ","urlName":"%e3%83%80%e3%83%b3%e3%83%97"},{"name":"procdump","urlName":"procdump"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

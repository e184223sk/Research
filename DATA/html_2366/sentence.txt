More than 1 year has passed since last update.string配列でドット絵を表現していて、BitmapへSetPixelで描画し、GetHiconメソッドでIconへのポインタを取得し、Icon.FromHandleメソッドで取得したハンドルをFormのIconプロパティにセットしている。HandleCreatedイベントが発生したときにGetHiconExampleを呼んでいるのは、以下の理由のため。最初は、FormのコンストラクタでGetHiconExampleを呼ぶコードを書いていた。それで実行すると、下記の例外が発生した。どうやらDestroyIconしたあとにIconが生成されているようである。ILSpyで色々調べてみたところ、FormのIconプロパティに代入(setアクセス)したときに、内部でUpdateWindowIconが呼ばれるのだが、IsHandleCreatedがtrueでないと、このときにIconが生成(WM_SETICON)されないようになっている。なので、以下の順になっていないといけない。
1. HandleCreatedイベント発生
2. Form.Iconへのハンドルのset
3. DestroyIconの実行参考サイト 1 のサンプルコードは一部しかかかれておらず、そのままでは実行できないため、
GetHicon_ExampleメソッドとDestroyIcon以外を付け足した。DestroyIconのWindowsAPIの説明を見ても.Netでの使用を考慮していない説明になっており、このコードのDestroyIconを呼び出しているとこのコメントが参考になった。



アカウント認証の実装の続きです。前回の状態で一度起動すると、エラーになってしまい起動できませんでした。
そこで下記2つの修正を行いました。①Startup.csのConfigureServicesにAddRazorPagesを追加②_LoginPartial.cshtmlを修正起動するとこのような画面になります。アカウント登録してみます。
URLは変わったんですが何も画面遷移しませんでした。
対応するビューとかコントローラーがないからですね。
デフォルトだとASP.NET Core Identityのライブラリにそのあたりが含まれているようで、
独自クラスを使ったとたんそれらが使えなくなったってことですね…
で、ライブラリに含まれているコントローラやらビューやらはスキャフォールディングで作れる機能があります。
プロジェクトを右クリックして、追加→新規スキャフォールディングアイテムでIDを選び、追加ボタンを押します。
自分に合った設定をします。オーバーライドはよくわからないので全部にしておきます。
（おそらくオーバーライドしたいもの（編集したい画面とか機能）をチェックすると、実体ができるのだと思いました。）
はいエラー。どうやらDbContextはIdentityDbContextを継承しないといけないようです。
なので前回の修正を戻します。もう一度やってみます。ユーザークラスが選べねぇ。
謎のテキストファイルが表示されました。うまくいったようです？
ユーザクラスが選べなかった（デフォルト：IdentityUserから変更できなかった）のは、DbContextの書き方がおかしかったようです。もう一度スキャフォールディング…ユーザクラスは選べない。
追加を押すと、既にありますと言われますがOk。
さらにStartup.csを修正します。登録画面には遷移するようになりました。ただ、入力項目等があるべき形になっていないので、修正する必要があります。
登録画面のロジックを修正していきます。
まずはコードビハインド。
（そもそもASP.NETはコードビハインドって言わない？WPFだけの話なのかな…）次にビュー。ほかにちょっとだけ直すところがあります。
_ManageNav.cshtml内で自作ユーザクラスを使っていますが、usingがないのでエラーになってしまいます。
なので、usingを追加しておきます。下記のような画面になります。
適当に入力してみます。
Usernameが入ってないといわれました。
Register.cshtml.csをちょっと修正。不本意ながら使わないUserNameを設定。どうやら日本語はだめらしい。こちらを参考に日本語対応する。
登録を押すとエラー。DBを更新せよと。
とりあえず指示通りAdd-MigrationとUpdate-Databaseする。
Add-Migrationで警告が出るがまあなんでもいいので無視。登録できました。右上にユーザー名も表示されました。
DBを見ると、SMSUserテーブルではなく、AspNetUsersに登録されていました。ナンデ！？
ちなみに独自項目はAspNetUsersテーブルにできていました。UserName1ってなに…
次回はログインします。



ついに登場したC#9.0ですが、皆さんはもう使いこなしていますか？
9.0の目玉機能といえば、Record型やSource Generatorだと思います。ですが、ほかにも便利な機能が追加されたので個人的にいいなと思ったものをピックアップして紹介したいと思います！
NEXT SCAPE Advent Calenderの14日目の記事でもC#9.0について紹介しているのでぜひ見てみて下さい。パターンマッチングの機能が強化されました。
中でもnotはかなり使える場面が多いでしょう。andやorも使えるようになりました。switch式と組み合わせて以下のように書けるようにもなりました。例があまりよくないですが、andやor 、notとも組み合わせることができます。ラムダ式を書くときにパラメーターを使わない場合がかなりあると思います。.NETのライブラリのイベントは大体(object sender,EventArgs e)で定義されていますしね。
使わないという意図を明示して書きたい。そんなあなたにいい機能が入りました。
パラメーター定義をすべてアンダースコアにすることで、未使用ではなく破棄されることになります。最近のC#はパフォーマンス改善と、といかに状態を排除するコードを書けるようにするかにご執心です。個人的にはいいことだと思います。
LINQに渡すラムダ式等でラムダ式の外の変数を使おうとするとコピーが発生していました。以下のように、ラムダ式の直前にstaticをつけることで無駄にヒープを使うことを回避できます。ILを見ると上の例ではラムダ式と一緒に作られるクラスのフィールドに1をセットしているのがわかります。
下の例では単純に定数の1をスタックにプッシュするようになります。
パフォーマンスを気にしたい場合は検討してみましょう。.NET 5は長期サポートされません。お仕事で使う方は.NET 6への移行を視野に使いましょう。
自分も早くお仕事で使いたいな。



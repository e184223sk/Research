<!DOCTYPE html><html><head><meta charset="utf-8" /><title>C++で作成したdllにSwigを使ってC#向けのインターフェースを追加する方法 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/fan2tamo/items/31376e0ce43c9a6a8feb" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="hUcZqhy6u4a6dk+aoX5+nlipTetejcuXJ0yYv9SFf3QJ3kMj+ohHN27fDzstE6vPYyXzq+bRaCvS/hFyCUY9OQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@yasu_fan2tamo" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="C++で作成したdllにSwigを使ってC#向けのインターフェースを追加する方法 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1ReXNyNDRHbjVMMmM1b2lRNDRHWDQ0R2ZaR3hzNDRHclUzZHBaLU9Da3VTOXYtT0JvLU9CcGtNajVaQ1I0NEdSNDRHdTQ0S2s0NE96NDRLXzQ0Tzg0NE9WNDRLbjQ0Tzg0NEs1NDRLUzZMLTk1WXFnNDRHWjQ0S0w1cGE1NXJPViZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1iMThiOTQ3MjNmYTNhZDY5MjgzMGM4YzkyOTI1MTE1Nw&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR1poYmpKMFlXMXYmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz02OGJiNjE4OGJmZTVjZjM2MzFhODI1NjM0OWFkODgxZQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=247fcfd6fd00f4319bec75c019e43fda"><meta property="og:description" content="

はじめに

C++向けのインターフェースはあるのにC#向けのインターフェースがないSDKを使いたいと思っていたところ、Swigに出会いました。
去年にSwigの使い方が少し分かったので以下記事を書きましたが、あまり出来がよろしくあ..."><meta content="https://qiita.com/fan2tamo/items/31376e0ce43c9a6a8feb" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C++,C#,swig,dll,Wrapper" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-bf25f3e7-5891-4310-8841-b6d8e58be0eb"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Ffan2tamo%2Fitems%2F31376e0ce43c9a6a8feb">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Ffan2tamo%2Fitems%2F31376e0ce43c9a6a8feb">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-bf25f3e7-5891-4310-8841-b6d8e58be0eb">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/cpp","name":"C++"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2021-02-14T17:44:05.000+09:00","dateModified":"2021-02-17T14:15:32.000+09:00","headline":"C++で作成したdllにSwigを使ってC#向けのインターフェースを追加する方法","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1ReXNyNDRHbjVMMmM1b2lRNDRHWDQ0R2ZaR3hzNDRHclUzZHBaLU9Da3VTOXYtT0JvLU9CcGtNajVaQ1I0NEdSNDRHdTQ0S2s0NE96NDRLXzQ0Tzg0NE9WNDRLbjQ0Tzg0NEs1NDRLUzZMLTk1WXFnNDRHWjQ0S0w1cGE1NXJPViZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1iMThiOTQ3MjNmYTNhZDY5MjgzMGM4YzkyOTI1MTE1Nw\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR1poYmpKMFlXMXYmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz02OGJiNjE4OGJmZTVjZjM2MzFhODI1NjM0OWFkODgxZQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=247fcfd6fd00f4319bec75c019e43fda","mainEntityOfPage":"https://qiita.com/fan2tamo/items/31376e0ce43c9a6a8feb","author":{"@type":"Person","address":"Tokyo, Japan","email":null,"identifier":"fan2tamo","name":"fan2tamo","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F329392%2Fe08b0f5411e5c1b79a59ecf87b6112d72f41d954%2Fx_large.png%3F1611727425?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=6c7acf933b897bd632982f6915d2ce71","url":"https://qiita.com/fan2tamo","description":"メインはC#、次がC++、Pythonという感じです。\r\nDeep Learningに興味があり、なんとかC#で使えないかと試行錯誤中。\r\n\r\n今まで触った言語は、C, C++, Prolog, Perl, Octave, C#, Pythonぐらい。\r\n学生の頃はFreeBSDを使っていたので、cshかtcshだったけど、今はzshです。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"fan2tamo","type":"items","id":"31376e0ce43c9a6a8feb"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"fan2tamo","type":"items","id":"31376e0ce43c9a6a8feb"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"fan2tamo","type":"items","id":"31376e0ce43c9a6a8feb"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/fan2tamo/items/31376e0ce43c9a6a8feb","location":"/fan2tamo/items/31376e0ce43c9a6a8feb","scheme":"https","host":"qiita.com","port":null,"pathname":"/fan2tamo/items/31376e0ce43c9a6a8feb","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"SHhDc9R+BO8Jdg6ZD02DqcFUjfs9jBbdxEPzrkoaddHE4Rn6Mkz4Xt3fTjiDIFb4+tgzu4XQtWEx8Xpjl9k3nA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-cb0f5c90-b2f4-403f-9d6f-48a7d2550940"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/fan2tamo/items/31376e0ce43c9a6a8feb/likers" class="css-1iupg5d">1</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">0</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/31376e0ce43c9a6a8feb/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/fan2tamo/items/31376e0ce43c9a6a8feb/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/fan2tamo/items/31376e0ce43c9a6a8feb/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/fan2tamo/items/31376e0ce43c9a6a8feb/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/fan2tamo/items/31376e0ce43c9a6a8feb.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/fan2tamo"><img class="css-100alwu eyfquo10" src="https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/329392/e08b0f5411e5c1b79a59ecf87b6112d72f41d954/x_large.png?1611727425" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/fan2tamo" class="css-10ougpm">@<!-- -->fan2tamo</a><div class="css-1ay9vb9"><span><meta content="2021-02-14T08:44:05Z"/><time dateTime="2021-02-17T05:15:32Z" class="css-m19uds">updated at 2021-02-17</time></span></div></div></div></div></div><h1 class="css-cgzq40">C++で作成したdllにSwigを使ってC#向けのインターフェースを追加する方法</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/cpp" class="css-4czcte">C++</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/swig" class="css-4czcte">swig</a><a href="/tags/dll" class="css-4czcte">dll</a><a href="/tags/wrapper" class="css-4czcte">Wrapper</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>C++向けのインターフェースはあるのにC#向けのインターフェースがないSDKを使いたいと思っていたところ、Swigに出会いました。<br>
去年にSwigの使い方が少し分かったので以下記事を書きましたが、あまり出来がよろしくありません。<br>
<a href="https://qiita.com/fan2tamo/items/2604b6f2edf8e918ee34" id="reference-909db7508a50394430ea">C++で作成したdllをSwigで作ったWrapper経由でC#から呼び出す方法</a></p>

<p>というか自分で言うのもなんですが、上記記事を見ても以下3つのことしか出来ないため、実用的な物を作ることが出来ません。</p>

<ul>
<li>C++側のAPIの引数がint</li>
<li>C++側のAPIの戻り値がbool</li>
<li>C++側のAPIの戻り値がクラス</li>
</ul>

<p>C++で作ったdllをC#で使うことを考える際、最低限以下はサポートしたいと個人的には思っています。</p>

<ul>
<li>C++側のAPIの引数に文字列</li>
<li>C++側のAPIの引数にvector</li>
<li>C++側のAPIの引数にクラス</li>
<li>C++側のAPIの戻り値が文字列</li>
<li>C++側のAPIの戻り値がvector</li>
<li>C++側のAPIの戻り値がクラス</li>
<li>C++からC#へコールバックで通知</li>
<li>コールバックの引数に文字列</li>
<li>コールバックの引数にvector</li>
</ul>

<p>ようやく動かすことが出来ましたので、手順を本記事にまとめます。</p>

<p>ソースコードは<a href="https://github.com/fan2tamo/SwigApp2" rel="nofollow noopener" target="_blank"><strong>ここ</strong></a>に格納しています。<br>
プロジェクトとしては以下2つです。<br>
- MyDLL<br>
　C/C++で作成するdllのプロジェクトです。<br>
- CsharpApp<br>
　作成したdllをC#から呼び出すことが出来るのかテスト用のプロジェクトです。</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<p>今回の環境は以下です。</p>

<ul>
<li>Windows10 Pro(x64)</li>
<li>Visual Studio 2019 Professional</li>
<li>Swig 4.0.2</li>
</ul>

<h2>
<span id="目次" class="fragment"></span><a href="#%E7%9B%AE%E6%AC%A1"><i class="fa fa-link"></i></a>目次</h2>

<ol>
<li>
<a href="#1-c%E3%81%A7dll%E4%BD%9C%E6%88%90">C++でdll作成</a><br>
1-1. <a href="#1-1-h%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90">.hファイル作成</a><br>
1-2. <a href="#1-2-cpp%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90">.cppファイル作成</a><br>
1-3. <a href="#1-3-%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6dll%E3%82%92%E4%BD%9C%E6%88%90">ビルドしてdllを作成</a><br>
</li>
<li>
<a href="#2-swig%E3%81%A7dll%E3%81%ABc%E5%90%91%E3%81%91%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0">SwigでdllにC#向けインターフェースを追加</a><br>
2-1. <a href="#2-1-windows%E5%AF%BE%E5%BF%9C">Windows対応</a><br>
2-2. <a href="#2-2-%E6%96%87%E5%AD%97%E5%88%97%E3%81%A8vector%E5%AF%BE%E5%BF%9C">文字列とvector対応</a><br>
2-3. <a href="#2-3-%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E5%AF%BE%E5%BF%9C">コールバック対応</a><br>
2-4. <a href="#2-4-%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6dll%E3%82%92%E4%BD%9C%E6%88%90">ビルドしてdllを作成</a><br>
</li>
<li>
<a href="#3-c%E3%81%A7dll%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99">C#でdllを呼び出す</a><br>
</li>
</ol>

<h1>
<span id="1-cでdll作成" class="fragment"></span><a href="#1-c%E3%81%A7dll%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>1. C++でdll作成</h1>

<p>ダイナミック リンク ライブラリ(DLL)のテンプレート選択して、プロジェクト名を入力してください。<br>
今回はプロジェクト名をMyDLLとしています。</p>

<h2>
<span id="1-1-hファイル作成" class="fragment"></span><a href="#1-1-h%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>1-1. .hファイル作成</h2>

<p>Header.hというヘッダファイルに下記2のクラスを定義しています。</p>

<ul>
<li><p>CallbackBase<br>
C#側がこのクラスを継承して、CppClassのSetCallback()で渡すことを想定しています。</p></li>
<li><p>CppClass<br>
文字列と配列のやり取りをするクラスになります。</p></li>
</ul>

<p>さっそく中身を見てみましょう。</p>

<div class="code-frame" data-lang="C++"><div class="highlight"><pre class="with-code"><code><span class="cp">#include &lt;string&gt;
#include &lt;vector&gt;
</span>
<span class="k">class</span> <span class="nc">CallbackBase</span>
<span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">Callback</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">str</span><span class="p">,</span> <span class="k">const</span>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&amp;</span> <span class="n">fVect</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">CppClass</span>
<span class="p">{</span>
<span class="nl">public:</span>
    <span class="kt">void</span> <span class="n">SetString</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">str</span><span class="p">);</span> 
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetString</span><span class="p">();</span>

    <span class="kt">void</span> <span class="n">SetVector</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&amp;</span> <span class="n">fVect</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">GetVector</span><span class="p">();</span>

    <span class="kt">void</span> <span class="n">SetCallback</span><span class="p">(</span><span class="n">CallbackBase</span><span class="o">&amp;</span> <span class="n">callbackObject</span><span class="p">);</span>
    <span class="kt">void</span> <span class="n">ExeCallback</span><span class="p">();</span>

<span class="nl">private:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">string</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span>  <span class="n">floatVector</span><span class="p">;</span>
    <span class="n">CallbackBase</span><span class="o">*</span> <span class="n">pCallbackObj</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="kt">void</span> <span class="n">InvokeCallback</span><span class="p">();</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="n">CppClass</span><span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">GetInstanceFuncPointer</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>

<span class="k">extern</span> <span class="s">"C"</span> <span class="kr">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="n">CppClass</span> <span class="o">*</span> <span class="nf">CreateInstance</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</code></pre></div></div>

<p>特に躓く部分はないと思います。<br>
CppClassのPrivateで定義されている部分は、本来なら見せたくないのでCppClassを抽象クラスとしたいですが今回のテーマはSwigなので省いています。</p>

<h2>
<span id="1-2-cppファイル作成" class="fragment"></span><a href="#1-2-cpp%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>1-2. .cppファイル作成</h2>

<p>CallbackBaseは今回作るdllを使う側が継承して作ることになるので、作るのはCppClassということになります。<br>
今回は下記のように実装しています。</p>

<div class="code-frame" data-lang="c++"><div class="highlight"><pre class="with-code"><code><span class="cp">#include &lt;thread&gt;
#include "Header.h"
</span>
<span class="kt">void</span> <span class="n">CppClass</span><span class="o">::</span><span class="n">SetString</span><span class="p">(</span><span class="k">const</span>  <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">str</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">CppClass</span><span class="o">::</span><span class="n">GetString</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">CppClass</span><span class="o">::</span><span class="n">SetVector</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&amp;</span> <span class="n">fVect</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">floatVector</span> <span class="o">=</span> <span class="n">fVect</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">CppClass</span><span class="o">::</span><span class="n">GetVector</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">floatVector</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">CppClass</span><span class="o">::</span><span class="n">SetCallback</span><span class="p">(</span><span class="n">CallbackBase</span> <span class="o">&amp;</span><span class="n">callbackObj</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">pCallbackObj</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">callbackObj</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">CppClass</span><span class="o">::</span><span class="n">ExeCallback</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="kr">thread</span> <span class="o">*</span><span class="n">th</span> <span class="o">=</span> <span class="k">new</span> <span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CppClass</span><span class="o">::</span><span class="n">InvokeCallback</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="n">th</span><span class="o">-&gt;</span><span class="n">join</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">CppClass</span><span class="o">::</span><span class="n">InvokeCallback</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pCallbackObj</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">pCallbackObj</span><span class="o">-&gt;</span><span class="n">Callback</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">floatVector</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="n">CppClass</span><span class="o">*</span> <span class="nf">CreateInstance</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">CppClass</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="1-3-ビルドしてdllを作成" class="fragment"></span><a href="#1-3-%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6dll%E3%82%92%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>1-3. ビルドしてdllを作成</h2>

<p>.hと.cppを作成で来たのでVisual Studio上でビルドしてください。<br>
特に問題なくビルド出来ると思います。<br>
このタイミングで、作成されたdllが公開しているAPIを見てみることにします。<br>
Visual Studioに付属するDeveloper Command Prompt For VS2019を起動してください。<br>
日本語環境下では名前が開発者プロンプトなどかもです。<br>
プロンプト上で、作成されたdllがある場所までcdコマンドで移動して以下コマンドを打ってください。</p>

<div class="code-frame" data-lang="console"><div class="highlight"><pre class="with-code"><code><span class="go">bumpbin /exports MyDLL.dll
</span></code></pre></div></div>

<p>実行すると下の画像のようにCreateInstanceだけが表示されていると思います。<br>
<a href="https://camo.qiitausercontent.com/2797b3e67b3d6cbef18f4e06543cf71d6c0c83e9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3332393339322f39613639653961352d643431382d396461322d313562632d3331316335303466623931612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F329392%2F9a69e9a5-d418-9da2-15bc-311c504fb91a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=38cd8669ad01930be08d411c34385f47" alt="before_Swig.png" title="Swigを実行する前のdll" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329392/9a69e9a5-d418-9da2-15bc-311c504fb91a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F329392%2F9a69e9a5-d418-9da2-15bc-311c504fb91a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f079e1c391b14c9220db045923244263 1x" loading="lazy"></a></p>

<p>これはGetProcAddress()で取得できる関数のポインタがCreateInstance()しかないことを示しており、意図通りです。</p>

<h1>
<span id="2-swigでdllにc向けインターフェースを追加" class="fragment"></span><a href="#2-swig%E3%81%A7dll%E3%81%ABc%E5%90%91%E3%81%91%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>2. SwigでdllにC#向けインターフェースを追加</h1>

<p>Swigを使うためにはインターフェースファイルと呼ばれる.iファイルを作る必要があります。<br>
 書き方の詳細は<a href="http://www.swig.org/" rel="nofollow noopener" target="_blank">本家のページ</a>を見ていただくとして、それ以外に参考になったページを挙げておきます。</p>

<ul>
<li><a href="https://ja.osdn.net/projects/irrlichtnet/wiki/SWIG" rel="nofollow noopener" target="_blank">Irrlicht.NET by SWIG : SWIGの使い方</a></li>
<li><a href="https://sh-sawada.hatenadiary.org/entry/20110322/1300774275" rel="nofollow noopener" target="_blank">似非AC雑記 : 任意の型の使用</a></li>
</ul>

<h2>
<span id="2-1-windows対応" class="fragment"></span><a href="#2-1-windows%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>2-1. Windows対応</h2>

<p>では早速.iファイルを作成していきます。</p>

<p>最も基本的なインターフェイスファイルは以下になります。</p>

<div class="code-frame" data-lang="console"><div class="highlight"><pre class="with-code"><code><span class="go">%module "MyDLL"  //(1)

%{
</span><span class="gp">#</span>include <span class="s2">"Header.h"</span>  //<span class="o">(</span>2<span class="o">)</span>
<span class="go">%}

%include "Header.h"  //(3)
</span></code></pre></div></div>

<p>(1)には作成するDLL名を、(2)と(3)にはDLLを使う上で必要な情報が記載されているヘッダを書きます。<br>
具体的に(2)(3)に何を指定するのかは <a href="https://sh-sawada.hatenadiary.org/entry/20110322/1300774275" rel="nofollow noopener" target="_blank">似非AC雑記 : 任意の型の使用</a>に素晴らしい説明がありますので引用します。</p>

<blockquote>
<p>%{、%}で囲まれた部分は生成される*.cppファイルにそのまま出力される。ここでは型の名前解決のためにヘッダファイルを指定している。<br>
%includeでSWIGが解析を行うファイルを指定する。<br>
このようなインターフェイスファイルを作ったら、以下のようにSWIGに食わせるとラッパの.cppと.hとCSファイルが出力される。</p>
</blockquote>

<div class="code-frame" data-lang="console"><div class="highlight"><pre class="with-code"><code><span class="go">swig.exe -csharp -c++ -cppext cpp Swig.i
</span></code></pre></div></div>

<p>.iファイルの役割と書き方が分かったのでさっそく上記コマンドを実行して.cppと.hと.csを出力してみましょう。<br>
(なお、swig.exeを実行するbatをexecSwig.batというファイル名でGithub上位置いていますので、それをダブルクリックしても良いです。)</p>

<div class="code-frame" data-lang="console"><div class="highlight"><pre class="with-code"><code><span class="gp">&gt;</span><span class="w"> </span>swig.exe <span class="nt">-c</span>++ <span class="nt">-csharp</span> <span class="nt">-cppext</span> cpp Swig.i
<span class="go">Header.h(31) : Error: Syntax error in input(1).
</span></code></pre></div></div>

<p>エラーが発生してしまいました。<br>
どうやらHeader.hの31行目がまずいようです。<br>
色々調べると<a href="http://www.swig.org/Doc3.0/Windows.html#Windows_interface_file" rel="nofollow noopener" target="_blank">公式ページ</a>に下記説明を見つけました。</p>

<blockquote>
<p>A common problem when using SWIG on Windows are the Microsoft function calling conventions which are not in the C++ standard. SWIG parses ISO C/C++ so cannot deal with proprietary conventions such as __declspec(dllimport), __stdcall etc. There is a Windows interface file, windows.i, to deal with these calling conventions though. The file also contains typemaps for handling commonly used Windows specific types such as __int64, BOOL, DWORD etc.</p>
</blockquote>

<p>上記に従って、windows.iをincludeするようにしましょう。</p>

<div class="code-frame" data-lang="console"><div class="highlight"><pre class="with-code"><code><span class="go">%module "MyDLL"

%{
</span><span class="gp">#</span>include <span class="s2">"Header.h"</span>
<span class="go">%}

</span><span class="gp">%include &lt;windows.i&gt;</span><span class="w">
</span><span class="go">%include "Header.h"
</span></code></pre></div></div>

<p>これで再度swig.exeを実行するとエラーは発生しませんでした。</p>

<h2>
<span id="2-2-文字列とvector対応" class="fragment"></span><a href="#2-2-%E6%96%87%E5%AD%97%E5%88%97%E3%81%A8vector%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>2-2. 文字列とvector対応</h2>

<p>先ほどWidnows.iを加えることで無事swig.exeを実行することが出来、以下ファイルが生成されます。</p>

<ul>
<li>Swig_wrap.cpp</li>
<li>CallbackBase.cs</li>
<li>CppClass.cs</li>
<li>MyDLL.cs</li>
<li>MyDLLPINVOKE.cs</li>
<li>SWIGTYPE_p_std__string.cs</li>
<li>SWIGTYPE_p_std__vectorT_float_t.cs</li>
</ul>

<p>CppClass.csを開くとCppClassが公開しているAPI名が見えます。<br>
以下はCppClass.csの一部です。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code>  <span class="k">public</span> <span class="k">void</span> <span class="nf">SetString</span><span class="p">(</span><span class="n">SWIGTYPE_p_std__string</span> <span class="n">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">MyDLLPINVOKE</span><span class="p">.</span><span class="nf">CppClass_SetString</span><span class="p">(</span><span class="n">swigCPtr</span><span class="p">,</span> <span class="n">SWIGTYPE_p_std__string</span><span class="p">.</span><span class="nf">getCPtr</span><span class="p">(</span><span class="n">str</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">MyDLLPINVOKE</span><span class="p">.</span><span class="n">SWIGPendingException</span><span class="p">.</span><span class="n">Pending</span><span class="p">)</span> <span class="k">throw</span> <span class="n">MyDLLPINVOKE</span><span class="p">.</span><span class="n">SWIGPendingException</span><span class="p">.</span><span class="nf">Retrieve</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="n">SWIGTYPE_p_std__string</span> <span class="nf">GetString</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">SWIGTYPE_p_std__string</span> <span class="n">ret</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SWIGTYPE_p_std__string</span><span class="p">(</span><span class="n">MyDLLPINVOKE</span><span class="p">.</span><span class="nf">CppClass_GetString</span><span class="p">(</span><span class="n">swigCPtr</span><span class="p">),</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">void</span> <span class="nf">SetVector</span><span class="p">(</span><span class="n">SWIGTYPE_p_std__vectorT_float_t</span> <span class="n">fVect</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">MyDLLPINVOKE</span><span class="p">.</span><span class="nf">CppClass_SetVector</span><span class="p">(</span><span class="n">swigCPtr</span><span class="p">,</span> <span class="n">SWIGTYPE_p_std__vectorT_float_t</span><span class="p">.</span><span class="nf">getCPtr</span><span class="p">(</span><span class="n">fVect</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">MyDLLPINVOKE</span><span class="p">.</span><span class="n">SWIGPendingException</span><span class="p">.</span><span class="n">Pending</span><span class="p">)</span> <span class="k">throw</span> <span class="n">MyDLLPINVOKE</span><span class="p">.</span><span class="n">SWIGPendingException</span><span class="p">.</span><span class="nf">Retrieve</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="n">SWIGTYPE_p_std__vectorT_float_t</span> <span class="nf">GetVector</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">SWIGTYPE_p_std__vectorT_float_t</span> <span class="n">ret</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SWIGTYPE_p_std__vectorT_float_t</span><span class="p">(</span><span class="n">MyDLLPINVOKE</span><span class="p">.</span><span class="nf">CppClass_GetVector</span><span class="p">(</span><span class="n">swigCPtr</span><span class="p">),</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>SetString()の引数がSWIGTYPE_p_std_<em>stringという型になっています。<br>
同様に、SetVector()の引数はSWIGTYPE_p_std</em>_vectorT_float_t型になっています。<br>
SetString()はstring型を使いたいし、SetVector()はListやfloat[]を使いたいのに、何その型？？？<br>
このままでは使いにくいので、.iファイルを以下のようにします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>%module "MyDLL"

%{
#include "Header.h"
%}

%include &lt;windows.i&gt;
%include &lt;std_string.i&gt;
%include &lt;std_vector.i&gt;

/* std::vector&lt;float&gt;をC#側ではFloatVectorというクラスとして扱う */
%template(FloatVector) std::vector&lt;float&gt;;
%include "Header.h"
</code></pre></div></div>

<p>これで再度swig.exeを実行するとCppClass.csで定義されているSetString()やSetVector()の引数が、stringやFloatVectorになっていることが分かります。<br>
FloatVectorはListみたいなものです。<br>
詳細な定義はFloatVector.csに書いてありますが、初見でも問題なく扱えると思います。</p>

<h2>
<span id="2-3-コールバック対応" class="fragment"></span><a href="#2-3-%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>2-3. コールバック対応</h2>

<p>現状の.iファイルを使ってswig.exeを実行するとファイルが作られました。</p>

<ul>
<li>Swig_wrap.cpp</li>
<li>CallbackBase.cs</li>
<li>CppClass.cs</li>
<li>FloatVector.cs  &lt;- New</li>
<li>MyDLL.cs</li>
<li>MyDLLPINVOKE.cs</li>
</ul>

<p>これで.iファイルは完成だ！と思いきや実はコールバックをするためにはまだ細工が必要です。<br>
<a href="http://www.swig.org/Doc3.0/SWIGDocumentation.html#CSharp_directors" rel="nofollow noopener" target="_blank">公式のページ</a>に詳細の説明があるのでそちらを参照していただくとして、最終的な.iファイルは下記のようになります。</p>

<div class="code-frame" data-lang="console"><div class="highlight"><pre class="with-code"><code><span class="go">/* 変更 */
%module (directors="1") MyDLL 

%{
</span><span class="gp">#</span>include <span class="s2">"Header.h"</span>
<span class="go">%}

</span><span class="gp">%include &lt;windows.i&gt;</span><span class="w"> 
</span><span class="gp">%include &lt;std_string.i&gt;</span><span class="w">
</span><span class="gp">%include &lt;std_vector.i&gt;</span><span class="w">
</span><span class="go">
</span><span class="gp">/* std::vector&lt;float&gt;</span>をC#側ではFloatVectorというクラスとして扱う <span class="k">*</span>/
<span class="gp">%template(FloatVector) std::vector&lt;float&gt;</span><span class="p">;</span>
<span class="go">
/* 追加 */
</span><span class="gp">%feature("director") CallbackBase;</span><span class="w">
</span><span class="go">
%include "Header.h"
</span></code></pre></div></div>

<p>上記.iファイルを使用してSwig.exeを実行すると以下のファイルが作られます。</p>

<ul>
<li>Swig_wrap.cpp</li>
<li>Swig_wrap.h     &lt;- New</li>
<li>CallbackBase.cs</li>
<li>CppClass.cs</li>
<li>FloatVector.cs</li>
<li>MyDLL.cs</li>
<li>MyDLLPINVOKE.cs</li>
</ul>

<h2>
<span id="2-4-ビルドしてdllを作成" class="fragment"></span><a href="#2-4-%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6dll%E3%82%92%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>2-4. ビルドしてdllを作成</h2>

<p>ではdllにC#向けインターフェースを追加してみます。<br>
手順としては、先ほどSwig.exeを実行して作成されたSwig_wrap.cppをプロジェクトのソースファイルに追加して改めてビルドするだけです。<br>
はい、これだけでC#向けのインターフェースが作成されます。<br>
.iファイルさえ作ることが出来ればC#向けのインターフェースを作るのは簡単ですね！</p>

<p>実際にビルドして作られたdllにdumpbinを実行して本当にAPIが増えたのか見てみましょう。</p>

<div class="code-frame" data-lang="console"><div class="highlight"><pre class="with-code"><code><span class="go">bumpbin /exports MyDLL.dll
</span></code></pre></div></div>

<p>実行すると下の画像のようにCreateInstance以外も表示されていると思います。<br>
<a href="https://camo.qiitausercontent.com/c4ac3e29bbbb36d4f4c69c77cac0850e99ce0c61/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3332393339322f30313835333131622d323562662d323437622d633462302d6266316662323334333865302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F329392%2F0185311b-25bf-247b-c4b0-bf1fb23438e0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e221200a16cbcd0ffc35a595a46c8b08" alt="after_Swig.png" title="Swigを実行した後のdll" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329392/0185311b-25bf-247b-c4b0-bf1fb23438e0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F329392%2F0185311b-25bf-247b-c4b0-bf1fb23438e0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1121211a4e9557026ab87d2cfd3014bb 1x" loading="lazy"></a></p>

<p>APIがすごく増えていますね。<br>
C#側はこの増えたAPIを経由して、CppClassにアクセスすることになります。<br>
増えたAPIですが、C++側でGetProcAddress()で取得することが出来るはずです。<br>
やる意味ないですが...</p>

<h1>
<span id="3-cでdllを呼び出す" class="fragment"></span><a href="#3-c%E3%81%A7dll%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99"><i class="fa fa-link"></i></a>3. C#でdllを呼び出す</h1>

<p>C#で作成するコンソールプログラムから作成したdllが呼び出せるか確認します。<br>
プロジェクト名は<strong>CSharpApp</strong>です。</p>

<p>することは3つだけです。</p>

<ol>
<li>Swig.exeが作成した.csファイルをプロジェクトに加える</li>
<li>CallbackBaseを継承したクラスを作成</li>
<li>dllが提供するAPIを呼び出す</li>
</ol>

<p>特に説明も不要だと思いますのでコードを貼り付けます。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code>
<span class="k">using</span> <span class="nn">System.Diagnostics</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">CsharpApp</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">MyCallback</span> <span class="p">:</span> <span class="n">CallbackBase</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Callback</span><span class="p">(</span><span class="kt">string</span> <span class="n">str</span><span class="p">,</span> <span class="n">FloatVector</span> <span class="n">fVect</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"str = </span><span class="p">{</span><span class="n">str</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">float</span> <span class="k">value</span> <span class="k">in</span> <span class="n">fVect</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"[</span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">] :value = </span><span class="p">{</span><span class="k">value</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                <span class="n">i</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>        

    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
             <span class="n">MyCallback</span> <span class="n">myCallbackObj</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyCallback</span><span class="p">();</span>
            <span class="n">CppClass</span> <span class="n">instance</span> <span class="p">=</span> <span class="n">MyDLL</span><span class="p">.</span><span class="nf">CreateInstance</span><span class="p">();</span>

            <span class="kt">string</span> <span class="n">str</span> <span class="p">=</span> <span class="s">"テストHello World!"</span><span class="p">;</span>
            <span class="n">instance</span><span class="p">.</span><span class="nf">SetString</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"str = </span><span class="p">{</span><span class="n">instance</span><span class="p">.</span><span class="nf">GetString</span><span class="p">()}</span><span class="s">"</span><span class="p">);</span>

            <span class="n">FloatVector</span> <span class="n">v</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FloatVector</span><span class="p">();</span>
            <span class="n">v</span><span class="p">.</span><span class="nf">Add</span><span class="p">((</span><span class="kt">float</span><span class="p">)-</span><span class="m">0.1</span><span class="p">);</span>
            <span class="n">v</span><span class="p">.</span><span class="nf">Add</span><span class="p">((</span><span class="kt">float</span><span class="p">)-</span><span class="m">1</span><span class="p">);</span>
            <span class="n">v</span><span class="p">.</span><span class="nf">Add</span><span class="p">((</span><span class="kt">float</span><span class="p">)-</span><span class="m">10</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="n">instance</span><span class="p">.</span><span class="nf">SetVector</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
            <span class="n">FloatVector</span> <span class="n">buf</span> <span class="p">=</span> <span class="n">instance</span><span class="p">.</span><span class="nf">GetVector</span><span class="p">();</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">float</span> <span class="k">value</span> <span class="k">in</span> <span class="n">buf</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"[</span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">] :value = </span><span class="p">{</span><span class="k">value</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                <span class="n">i</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">instance</span><span class="p">.</span><span class="nf">SetCallback</span><span class="p">(</span><span class="n">myCallbackObj</span><span class="p">);</span>
            <span class="n">instance</span><span class="p">.</span><span class="nf">ExeCallback</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>では実際に動作するか見てみましょう！</p>

<div class="code-frame" data-lang="console"><div class="highlight"><pre class="with-code"><code><span class="go">str = テストHello World!
[0] :value = -0.1
[1] :value = -1
[2] :value = -10
callback : str = テストHello World!
callback :  [0] :value = -0.1
callback :  [1] :value = -1
callback :  [2] :value = -10
</span></code></pre></div></div>

<p>意図した通りに動いていますね！</p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>この記事ではSwigの使い方と、実際にdllにC#向けのインターフェースが追加されることを確認しました。<br>
期待した通りに追加され、C#側で問題なく使用できることを確認しました。</p>

<p>本当は配列を受け取る、配列を返すというものをやりたかったのですが配列を返す方法が分からなかったので断念しています。<br>
誤字脱字や認識間違い等あればご指摘ください。</p>

<h1>
<span id="参考リンク" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF"><i class="fa fa-link"></i></a>参考リンク</h1>

<ul>
<li><a href="http://www.swig.org/Doc3.0/Windows.html#Windows_interface_file" rel="nofollow noopener" target="_blank">Microsoft extensions and other Windows quirks</a></li>
<li><a href="http://www.swig.org/Doc3.0/SWIGDocumentation.html#CSharp_directors" rel="nofollow noopener" target="_blank">C# Directors</a></li>
<li><a href="https://ja.osdn.net/projects/irrlichtnet/wiki/SWIG" rel="nofollow noopener" target="_blank">Irrlicht.NET by SWIG : SWIGの使い方</a></li>
<li><a href="https://sh-sawada.hatenadiary.org/entry/20110322/1300774275" rel="nofollow noopener" target="_blank">似非AC雑記 : 任意の型の使用</a></li>
<li><a href="https://qiita.com/fan2tamo/items/2604b6f2edf8e918ee34">C++で作成したdllをSwigで作ったWrapper経由でC#から呼び出す方法</a></li>
</ul>

<h1>
<span id="ソースコード" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>ソースコード</h1>

<p><qiita-embed-ogp src="https://github.com/fan2tamo/SwigApp2"></qiita-embed-ogp></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Ffan2tamo%2Fitems%2F31376e0ce43c9a6a8feb&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Ffan2tamo%2Fitems%2F31376e0ce43c9a6a8feb&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/fan2tamo/items/31376e0ce43c9a6a8feb/likers" class="css-1iupg5d">1</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">0</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/31376e0ce43c9a6a8feb/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/fan2tamo/items/31376e0ce43c9a6a8feb/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/fan2tamo/items/31376e0ce43c9a6a8feb/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/fan2tamo/items/31376e0ce43c9a6a8feb/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/fan2tamo/items/31376e0ce43c9a6a8feb.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-cb0f5c90-b2f4-403f-9d6f-48a7d2550940">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-e8684ce1-0919-4acf-bf81-e8d853768db1"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-e8684ce1-0919-4acf-bf81-e8d853768db1">{}</script>
      
<div id="LoginModal-react-component-1749ae40-853f-49f6-89f3-9878ad14d066"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-1749ae40-853f-49f6-89f3-9878ad14d066">{}</script>
      
<div id="StockModal-react-component-9aac7c6b-b111-4912-9c76-8f91cfacf0aa"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-9aac7c6b-b111-4912-9c76-8f91cfacf0aa">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;OLpg9i4SyQLY8A7By0Dj8aLUNLdDZJTVlTxSb1EcYRy0Izp/yCA1swxZTmBHLTagmViK9/s4N2lgjtuijN8jUQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eC++向けのインターフェースはあるのにC#向けのインターフェースがないSDKを使いたいと思っていたところ、Swigに出会いました。\u003cbr\u003e\n去年にSwigの使い方が少し分かったので以下記事を書きましたが、あまり出来がよろしくありません。\u003cbr\u003e\n\u003ca href=\"https://qiita.com/fan2tamo/items/2604b6f2edf8e918ee34\" id=\"reference-909db7508a50394430ea\"\u003eC++で作成したdllをSwigで作ったWrapper経由でC#から呼び出す方法\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eというか自分で言うのもなんですが、上記記事を見ても以下3つのことしか出来ないため、実用的な物を作ることが出来ません。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eC++側のAPIの引数がint\u003c/li\u003e\n\u003cli\u003eC++側のAPIの戻り値がbool\u003c/li\u003e\n\u003cli\u003eC++側のAPIの戻り値がクラス\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eC++で作ったdllをC#で使うことを考える際、最低限以下はサポートしたいと個人的には思っています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eC++側のAPIの引数に文字列\u003c/li\u003e\n\u003cli\u003eC++側のAPIの引数にvector\u003c/li\u003e\n\u003cli\u003eC++側のAPIの引数にクラス\u003c/li\u003e\n\u003cli\u003eC++側のAPIの戻り値が文字列\u003c/li\u003e\n\u003cli\u003eC++側のAPIの戻り値がvector\u003c/li\u003e\n\u003cli\u003eC++側のAPIの戻り値がクラス\u003c/li\u003e\n\u003cli\u003eC++からC#へコールバックで通知\u003c/li\u003e\n\u003cli\u003eコールバックの引数に文字列\u003c/li\u003e\n\u003cli\u003eコールバックの引数にvector\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eようやく動かすことが出来ましたので、手順を本記事にまとめます。\u003c/p\u003e\n\n\u003cp\u003eソースコードは\u003ca href=\"https://github.com/fan2tamo/SwigApp2\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cstrong\u003eここ\u003c/strong\u003e\u003c/a\u003eに格納しています。\u003cbr\u003e\nプロジェクトとしては以下2つです。\u003cbr\u003e\n- MyDLL\u003cbr\u003e\n　C/C++で作成するdllのプロジェクトです。\u003cbr\u003e\n- CsharpApp\u003cbr\u003e\n　作成したdllをC#から呼び出すことが出来るのかテスト用のプロジェクトです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境\u003c/h2\u003e\n\n\u003cp\u003e今回の環境は以下です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eWindows10 Pro(x64)\u003c/li\u003e\n\u003cli\u003eVisual Studio 2019 Professional\u003c/li\u003e\n\u003cli\u003eSwig 4.0.2\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"目次\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%AE%E6%AC%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e目次\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ca href=\"#1-c%E3%81%A7dll%E4%BD%9C%E6%88%90\"\u003eC++でdll作成\u003c/a\u003e\u003cbr\u003e\n1-1. \u003ca href=\"#1-1-h%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90\"\u003e.hファイル作成\u003c/a\u003e\u003cbr\u003e\n1-2. \u003ca href=\"#1-2-cpp%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90\"\u003e.cppファイル作成\u003c/a\u003e\u003cbr\u003e\n1-3. \u003ca href=\"#1-3-%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6dll%E3%82%92%E4%BD%9C%E6%88%90\"\u003eビルドしてdllを作成\u003c/a\u003e\u003cbr\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-swig%E3%81%A7dll%E3%81%ABc%E5%90%91%E3%81%91%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003eSwigでdllにC#向けインターフェースを追加\u003c/a\u003e\u003cbr\u003e\n2-1. \u003ca href=\"#2-1-windows%E5%AF%BE%E5%BF%9C\"\u003eWindows対応\u003c/a\u003e\u003cbr\u003e\n2-2. \u003ca href=\"#2-2-%E6%96%87%E5%AD%97%E5%88%97%E3%81%A8vector%E5%AF%BE%E5%BF%9C\"\u003e文字列とvector対応\u003c/a\u003e\u003cbr\u003e\n2-3. \u003ca href=\"#2-3-%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E5%AF%BE%E5%BF%9C\"\u003eコールバック対応\u003c/a\u003e\u003cbr\u003e\n2-4. \u003ca href=\"#2-4-%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6dll%E3%82%92%E4%BD%9C%E6%88%90\"\u003eビルドしてdllを作成\u003c/a\u003e\u003cbr\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3-c%E3%81%A7dll%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99\"\u003eC#でdllを呼び出す\u003c/a\u003e\u003cbr\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"1-cでdll作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-c%E3%81%A7dll%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. C++でdll作成\u003c/h1\u003e\n\n\u003cp\u003eダイナミック リンク ライブラリ(DLL)のテンプレート選択して、プロジェクト名を入力してください。\u003cbr\u003e\n今回はプロジェクト名をMyDLLとしています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-1-hファイル作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-1-h%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1-1. .hファイル作成\u003c/h2\u003e\n\n\u003cp\u003eHeader.hというヘッダファイルに下記2のクラスを定義しています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eCallbackBase\u003cbr\u003e\nC#側がこのクラスを継承して、CppClassのSetCallback()で渡すことを想定しています。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eCppClass\u003cbr\u003e\n文字列と配列のやり取りをするクラスになります。\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eさっそく中身を見てみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C++\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#include \u0026lt;string\u0026gt;\n#include \u0026lt;vector\u0026gt;\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eCallbackBase\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"nl\"\u003epublic:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e  \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003evector\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003efVect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eCppClass\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"nl\"\u003epublic:\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eSetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eSetVector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003evector\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003efVect\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003evector\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eGetVector\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eSetCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCallbackBase\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ecallbackObject\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eExeCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"nl\"\u003eprivate:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003evector\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e  \u003cspan class=\"n\"\u003efloatVector\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eCallbackBase\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003epCallbackObj\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eInvokeCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"n\"\u003eCppClass\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eGetInstanceFuncPointer\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"s\"\u003e\"C\"\u003c/span\u003e \u003cspan class=\"kr\"\u003e__declspec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edllexport\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eCppClass\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e特に躓く部分はないと思います。\u003cbr\u003e\nCppClassのPrivateで定義されている部分は、本来なら見せたくないのでCppClassを抽象クラスとしたいですが今回のテーマはSwigなので省いています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-2-cppファイル作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-2-cpp%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1-2. .cppファイル作成\u003c/h2\u003e\n\n\u003cp\u003eCallbackBaseは今回作るdllを使う側が継承して作ることになるので、作るのはCppClassということになります。\u003cbr\u003e\n今回は下記のように実装しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c++\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#include \u0026lt;thread\u0026gt;\n#include \"Header.h\"\n\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eCppClass\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eSetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e  \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eCppClass\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eCppClass\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eSetVector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003evector\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003efVect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efloatVector\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efVect\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003evector\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eCppClass\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eGetVector\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efloatVector\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eCppClass\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eSetCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCallbackBase\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecallbackObj\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epCallbackObj\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecallbackObj\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eCppClass\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eExeCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kr\"\u003ethread\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eth\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kr\"\u003ethread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eCppClass\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eInvokeCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eth\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eCppClass\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eInvokeCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epCallbackObj\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003epCallbackObj\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efloatVector\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kr\"\u003e__declspec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edllexport\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eCppClass\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eCppClass\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-3-ビルドしてdllを作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-3-%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6dll%E3%82%92%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1-3. ビルドしてdllを作成\u003c/h2\u003e\n\n\u003cp\u003e.hと.cppを作成で来たのでVisual Studio上でビルドしてください。\u003cbr\u003e\n特に問題なくビルド出来ると思います。\u003cbr\u003e\nこのタイミングで、作成されたdllが公開しているAPIを見てみることにします。\u003cbr\u003e\nVisual Studioに付属するDeveloper Command Prompt For VS2019を起動してください。\u003cbr\u003e\n日本語環境下では名前が開発者プロンプトなどかもです。\u003cbr\u003e\nプロンプト上で、作成されたdllがある場所までcdコマンドで移動して以下コマンドを打ってください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"go\"\u003ebumpbin /exports MyDLL.dll\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e実行すると下の画像のようにCreateInstanceだけが表示されていると思います。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/2797b3e67b3d6cbef18f4e06543cf71d6c0c83e9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3332393339322f39613639653961352d643431382d396461322d313562632d3331316335303466623931612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F329392%2F9a69e9a5-d418-9da2-15bc-311c504fb91a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=38cd8669ad01930be08d411c34385f47\" alt=\"before_Swig.png\" title=\"Swigを実行する前のdll\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329392/9a69e9a5-d418-9da2-15bc-311c504fb91a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F329392%2F9a69e9a5-d418-9da2-15bc-311c504fb91a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f079e1c391b14c9220db045923244263 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれはGetProcAddress()で取得できる関数のポインタがCreateInstance()しかないことを示しており、意図通りです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"2-swigでdllにc向けインターフェースを追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-swig%E3%81%A7dll%E3%81%ABc%E5%90%91%E3%81%91%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. SwigでdllにC#向けインターフェースを追加\u003c/h1\u003e\n\n\u003cp\u003eSwigを使うためにはインターフェースファイルと呼ばれる.iファイルを作る必要があります。\u003cbr\u003e\n 書き方の詳細は\u003ca href=\"http://www.swig.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e本家のページ\u003c/a\u003eを見ていただくとして、それ以外に参考になったページを挙げておきます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://ja.osdn.net/projects/irrlichtnet/wiki/SWIG\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIrrlicht.NET by SWIG : SWIGの使い方\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://sh-sawada.hatenadiary.org/entry/20110322/1300774275\" rel=\"nofollow noopener\" target=\"_blank\"\u003e似非AC雑記 : 任意の型の使用\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-1-windows対応\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-1-windows%E5%AF%BE%E5%BF%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-1. Windows対応\u003c/h2\u003e\n\n\u003cp\u003eでは早速.iファイルを作成していきます。\u003c/p\u003e\n\n\u003cp\u003e最も基本的なインターフェイスファイルは以下になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"go\"\u003e%module \"MyDLL\"  //(1)\n\n%{\n\u003c/span\u003e\u003cspan class=\"gp\"\u003e#\u003c/span\u003einclude \u003cspan class=\"s2\"\u003e\"Header.h\"\u003c/span\u003e  //\u003cspan class=\"o\"\u003e(\u003c/span\u003e2\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003cspan class=\"go\"\u003e%}\n\n%include \"Header.h\"  //(3)\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(1)には作成するDLL名を、(2)と(3)にはDLLを使う上で必要な情報が記載されているヘッダを書きます。\u003cbr\u003e\n具体的に(2)(3)に何を指定するのかは \u003ca href=\"https://sh-sawada.hatenadiary.org/entry/20110322/1300774275\" rel=\"nofollow noopener\" target=\"_blank\"\u003e似非AC雑記 : 任意の型の使用\u003c/a\u003eに素晴らしい説明がありますので引用します。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e%{、%}で囲まれた部分は生成される*.cppファイルにそのまま出力される。ここでは型の名前解決のためにヘッダファイルを指定している。\u003cbr\u003e\n%includeでSWIGが解析を行うファイルを指定する。\u003cbr\u003e\nこのようなインターフェイスファイルを作ったら、以下のようにSWIGに食わせるとラッパの.cppと.hとCSファイルが出力される。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"go\"\u003eswig.exe -csharp -c++ -cppext cpp Swig.i\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e.iファイルの役割と書き方が分かったのでさっそく上記コマンドを実行して.cppと.hと.csを出力してみましょう。\u003cbr\u003e\n(なお、swig.exeを実行するbatをexecSwig.batというファイル名でGithub上位置いていますので、それをダブルクリックしても良いです。)\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"gp\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003eswig.exe \u003cspan class=\"nt\"\u003e-c\u003c/span\u003e++ \u003cspan class=\"nt\"\u003e-csharp\u003c/span\u003e \u003cspan class=\"nt\"\u003e-cppext\u003c/span\u003e cpp Swig.i\n\u003cspan class=\"go\"\u003eHeader.h(31) : Error: Syntax error in input(1).\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eエラーが発生してしまいました。\u003cbr\u003e\nどうやらHeader.hの31行目がまずいようです。\u003cbr\u003e\n色々調べると\u003ca href=\"http://www.swig.org/Doc3.0/Windows.html#Windows_interface_file\" rel=\"nofollow noopener\" target=\"_blank\"\u003e公式ページ\u003c/a\u003eに下記説明を見つけました。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eA common problem when using SWIG on Windows are the Microsoft function calling conventions which are not in the C++ standard. SWIG parses ISO C/C++ so cannot deal with proprietary conventions such as __declspec(dllimport), __stdcall etc. There is a Windows interface file, windows.i, to deal with these calling conventions though. The file also contains typemaps for handling commonly used Windows specific types such as __int64, BOOL, DWORD etc.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e上記に従って、windows.iをincludeするようにしましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"go\"\u003e%module \"MyDLL\"\n\n%{\n\u003c/span\u003e\u003cspan class=\"gp\"\u003e#\u003c/span\u003einclude \u003cspan class=\"s2\"\u003e\"Header.h\"\u003c/span\u003e\n\u003cspan class=\"go\"\u003e%}\n\n\u003c/span\u003e\u003cspan class=\"gp\"\u003e%include \u0026lt;windows.i\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"go\"\u003e%include \"Header.h\"\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれで再度swig.exeを実行するとエラーは発生しませんでした。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-2-文字列とvector対応\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-2-%E6%96%87%E5%AD%97%E5%88%97%E3%81%A8vector%E5%AF%BE%E5%BF%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-2. 文字列とvector対応\u003c/h2\u003e\n\n\u003cp\u003e先ほどWidnows.iを加えることで無事swig.exeを実行することが出来、以下ファイルが生成されます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSwig_wrap.cpp\u003c/li\u003e\n\u003cli\u003eCallbackBase.cs\u003c/li\u003e\n\u003cli\u003eCppClass.cs\u003c/li\u003e\n\u003cli\u003eMyDLL.cs\u003c/li\u003e\n\u003cli\u003eMyDLLPINVOKE.cs\u003c/li\u003e\n\u003cli\u003eSWIGTYPE_p_std__string.cs\u003c/li\u003e\n\u003cli\u003eSWIGTYPE_p_std__vectorT_float_t.cs\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eCppClass.csを開くとCppClassが公開しているAPI名が見えます。\u003cbr\u003e\n以下はCppClass.csの一部です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSWIGTYPE_p_std__string\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMyDLLPINVOKE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCppClass_SetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eswigCPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSWIGTYPE_p_std__string\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetCPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyDLLPINVOKE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSWIGPendingException\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePending\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"n\"\u003eMyDLLPINVOKE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSWIGPendingException\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRetrieve\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eSWIGTYPE_p_std__string\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSWIGTYPE_p_std__string\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSWIGTYPE_p_std__string\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyDLLPINVOKE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCppClass_GetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eswigCPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetVector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSWIGTYPE_p_std__vectorT_float_t\u003c/span\u003e \u003cspan class=\"n\"\u003efVect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMyDLLPINVOKE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCppClass_SetVector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eswigCPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSWIGTYPE_p_std__vectorT_float_t\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetCPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efVect\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyDLLPINVOKE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSWIGPendingException\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePending\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"n\"\u003eMyDLLPINVOKE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSWIGPendingException\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRetrieve\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eSWIGTYPE_p_std__vectorT_float_t\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetVector\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eSWIGTYPE_p_std__vectorT_float_t\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSWIGTYPE_p_std__vectorT_float_t\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyDLLPINVOKE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCppClass_GetVector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eswigCPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eSetString()の引数がSWIGTYPE_p_std_\u003cem\u003estringという型になっています。\u003cbr\u003e\n同様に、SetVector()の引数はSWIGTYPE_p_std\u003c/em\u003e_vectorT_float_t型になっています。\u003cbr\u003e\nSetString()はstring型を使いたいし、SetVector()はListやfloat[]を使いたいのに、何その型？？？\u003cbr\u003e\nこのままでは使いにくいので、.iファイルを以下のようにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e%module \"MyDLL\"\n\n%{\n#include \"Header.h\"\n%}\n\n%include \u0026lt;windows.i\u0026gt;\n%include \u0026lt;std_string.i\u0026gt;\n%include \u0026lt;std_vector.i\u0026gt;\n\n/* std::vector\u0026lt;float\u0026gt;をC#側ではFloatVectorというクラスとして扱う */\n%template(FloatVector) std::vector\u0026lt;float\u0026gt;;\n%include \"Header.h\"\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれで再度swig.exeを実行するとCppClass.csで定義されているSetString()やSetVector()の引数が、stringやFloatVectorになっていることが分かります。\u003cbr\u003e\nFloatVectorはListみたいなものです。\u003cbr\u003e\n詳細な定義はFloatVector.csに書いてありますが、初見でも問題なく扱えると思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-3-コールバック対応\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-3-%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E5%AF%BE%E5%BF%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-3. コールバック対応\u003c/h2\u003e\n\n\u003cp\u003e現状の.iファイルを使ってswig.exeを実行するとファイルが作られました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSwig_wrap.cpp\u003c/li\u003e\n\u003cli\u003eCallbackBase.cs\u003c/li\u003e\n\u003cli\u003eCppClass.cs\u003c/li\u003e\n\u003cli\u003eFloatVector.cs  \u0026lt;- New\u003c/li\u003e\n\u003cli\u003eMyDLL.cs\u003c/li\u003e\n\u003cli\u003eMyDLLPINVOKE.cs\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこれで.iファイルは完成だ！と思いきや実はコールバックをするためにはまだ細工が必要です。\u003cbr\u003e\n\u003ca href=\"http://www.swig.org/Doc3.0/SWIGDocumentation.html#CSharp_directors\" rel=\"nofollow noopener\" target=\"_blank\"\u003e公式のページ\u003c/a\u003eに詳細の説明があるのでそちらを参照していただくとして、最終的な.iファイルは下記のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"go\"\u003e/* 変更 */\n%module (directors=\"1\") MyDLL \n\n%{\n\u003c/span\u003e\u003cspan class=\"gp\"\u003e#\u003c/span\u003einclude \u003cspan class=\"s2\"\u003e\"Header.h\"\u003c/span\u003e\n\u003cspan class=\"go\"\u003e%}\n\n\u003c/span\u003e\u003cspan class=\"gp\"\u003e%include \u0026lt;windows.i\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003cspan class=\"gp\"\u003e%include \u0026lt;std_string.i\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"gp\"\u003e%include \u0026lt;std_vector.i\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"go\"\u003e\n\u003c/span\u003e\u003cspan class=\"gp\"\u003e/* std::vector\u0026lt;float\u0026gt;\u003c/span\u003eをC#側ではFloatVectorというクラスとして扱う \u003cspan class=\"k\"\u003e*\u003c/span\u003e/\n\u003cspan class=\"gp\"\u003e%template(FloatVector) std::vector\u0026lt;float\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"go\"\u003e\n/* 追加 */\n\u003c/span\u003e\u003cspan class=\"gp\"\u003e%feature(\"director\") CallbackBase;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"go\"\u003e\n%include \"Header.h\"\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e上記.iファイルを使用してSwig.exeを実行すると以下のファイルが作られます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSwig_wrap.cpp\u003c/li\u003e\n\u003cli\u003eSwig_wrap.h     \u0026lt;- New\u003c/li\u003e\n\u003cli\u003eCallbackBase.cs\u003c/li\u003e\n\u003cli\u003eCppClass.cs\u003c/li\u003e\n\u003cli\u003eFloatVector.cs\u003c/li\u003e\n\u003cli\u003eMyDLL.cs\u003c/li\u003e\n\u003cli\u003eMyDLLPINVOKE.cs\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-4-ビルドしてdllを作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-4-%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6dll%E3%82%92%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-4. ビルドしてdllを作成\u003c/h2\u003e\n\n\u003cp\u003eではdllにC#向けインターフェースを追加してみます。\u003cbr\u003e\n手順としては、先ほどSwig.exeを実行して作成されたSwig_wrap.cppをプロジェクトのソースファイルに追加して改めてビルドするだけです。\u003cbr\u003e\nはい、これだけでC#向けのインターフェースが作成されます。\u003cbr\u003e\n.iファイルさえ作ることが出来ればC#向けのインターフェースを作るのは簡単ですね！\u003c/p\u003e\n\n\u003cp\u003e実際にビルドして作られたdllにdumpbinを実行して本当にAPIが増えたのか見てみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"go\"\u003ebumpbin /exports MyDLL.dll\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e実行すると下の画像のようにCreateInstance以外も表示されていると思います。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c4ac3e29bbbb36d4f4c69c77cac0850e99ce0c61/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3332393339322f30313835333131622d323562662d323437622d633462302d6266316662323334333865302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F329392%2F0185311b-25bf-247b-c4b0-bf1fb23438e0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e221200a16cbcd0ffc35a595a46c8b08\" alt=\"after_Swig.png\" title=\"Swigを実行した後のdll\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329392/0185311b-25bf-247b-c4b0-bf1fb23438e0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F329392%2F0185311b-25bf-247b-c4b0-bf1fb23438e0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1121211a4e9557026ab87d2cfd3014bb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAPIがすごく増えていますね。\u003cbr\u003e\nC#側はこの増えたAPIを経由して、CppClassにアクセスすることになります。\u003cbr\u003e\n増えたAPIですが、C++側でGetProcAddress()で取得することが出来るはずです。\u003cbr\u003e\nやる意味ないですが...\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"3-cでdllを呼び出す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-c%E3%81%A7dll%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. C#でdllを呼び出す\u003c/h1\u003e\n\n\u003cp\u003eC#で作成するコンソールプログラムから作成したdllが呼び出せるか確認します。\u003cbr\u003e\nプロジェクト名は\u003cstrong\u003eCSharpApp\u003c/strong\u003eです。\u003c/p\u003e\n\n\u003cp\u003eすることは3つだけです。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eSwig.exeが作成した.csファイルをプロジェクトに加える\u003c/li\u003e\n\u003cli\u003eCallbackBaseを継承したクラスを作成\u003c/li\u003e\n\u003cli\u003edllが提供するAPIを呼び出す\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e特に説明も不要だと思いますのでコードを貼り付けます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Diagnostics\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eCsharpApp\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMyCallback\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCallbackBase\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFloatVector\u003c/span\u003e \u003cspan class=\"n\"\u003efVect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"str = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003efVect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"[\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e] :value = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e        \n\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n             \u003cspan class=\"n\"\u003eMyCallback\u003c/span\u003e \u003cspan class=\"n\"\u003emyCallbackObj\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCppClass\u003c/span\u003e \u003cspan class=\"n\"\u003einstance\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMyDLL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"テストHello World!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"str = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eFloatVector\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFloatVector\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e)-\u003c/span\u003e\u003cspan class=\"m\"\u003e0.1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e)-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e)-\u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetVector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eFloatVector\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetVector\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"[\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e] :value = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emyCallbackObj\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExeCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eでは実際に動作するか見てみましょう！\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"go\"\u003estr = テストHello World!\n[0] :value = -0.1\n[1] :value = -1\n[2] :value = -10\ncallback : str = テストHello World!\ncallback :  [0] :value = -0.1\ncallback :  [1] :value = -1\ncallback :  [2] :value = -10\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e意図した通りに動いていますね！\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003eこの記事ではSwigの使い方と、実際にdllにC#向けのインターフェースが追加されることを確認しました。\u003cbr\u003e\n期待した通りに追加され、C#側で問題なく使用できることを確認しました。\u003c/p\u003e\n\n\u003cp\u003e本当は配列を受け取る、配列を返すというものをやりたかったのですが配列を返す方法が分からなかったので断念しています。\u003cbr\u003e\n誤字脱字や認識間違い等あればご指摘ください。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考リンク\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考リンク\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://www.swig.org/Doc3.0/Windows.html#Windows_interface_file\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMicrosoft extensions and other Windows quirks\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.swig.org/Doc3.0/SWIGDocumentation.html#CSharp_directors\" rel=\"nofollow noopener\" target=\"_blank\"\u003eC# Directors\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://ja.osdn.net/projects/irrlichtnet/wiki/SWIG\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIrrlicht.NET by SWIG : SWIGの使い方\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://sh-sawada.hatenadiary.org/entry/20110322/1300774275\" rel=\"nofollow noopener\" target=\"_blank\"\u003e似非AC雑記 : 任意の型の使用\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/fan2tamo/items/2604b6f2edf8e918ee34\"\u003eC++で作成したdllをSwigで作ったWrapper経由でC#から呼び出す方法\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ソースコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eソースコード\u003c/h1\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/fan2tamo/SwigApp2\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n","createdAt":"2021-02-14T08:44:05Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"lywSZ3H4eYZpsEbMQEG6bZtIBmpRWVvvng==--SlDj7MIDoSMfX1rW--ULNmT3MEvufgUhA2FJe0wA==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2021-02-17T05:15:32Z","likesCount":1,"linkUrl":"https://qiita.com/fan2tamo/items/31376e0ce43c9a6a8feb","organization":null,"originalId":1392390,"stockedCount":0,"title":"C++で作成したdllにSwigを使ってC#向けのインターフェースを追加する方法","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%92%B0%E5%A2%83\"\u003e環境\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%9B%AE%E6%AC%A1\"\u003e目次\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1-c%E3%81%A7dll%E4%BD%9C%E6%88%90\"\u003e1. C++でdll作成\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1-1-h%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90\"\u003e1-1. .hファイル作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1-2-cpp%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90\"\u003e1-2. .cppファイル作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1-3-%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6dll%E3%82%92%E4%BD%9C%E6%88%90\"\u003e1-3. ビルドしてdllを作成\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-swig%E3%81%A7dll%E3%81%ABc%E5%90%91%E3%81%91%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e2. SwigでdllにC#向けインターフェースを追加\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#2-1-windows%E5%AF%BE%E5%BF%9C\"\u003e2-1. Windows対応\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-2-%E6%96%87%E5%AD%97%E5%88%97%E3%81%A8vector%E5%AF%BE%E5%BF%9C\"\u003e2-2. 文字列とvector対応\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-3-%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E5%AF%BE%E5%BF%9C\"\u003e2-3. コールバック対応\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-4-%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6dll%E3%82%92%E4%BD%9C%E6%88%90\"\u003e2-4. ビルドしてdllを作成\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3-c%E3%81%A7dll%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99\"\u003e3. C#でdllを呼び出す\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF\"\u003e参考リンク\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89\"\u003eソースコード\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":976,"uuid":"31376e0ce43c9a6a8feb","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"gzXW7HLBbX23UCDCG/J0xeeMRUYG--MSF4/i4y5e7XUt+9--pYn1ljjY/eqaJQZb29ekdA==","originalId":329392,"description":"メインはC#、次がC++、Pythonという感じです。\r\nDeep Learningに興味があり、なんとかC#で使えないかと試行錯誤中。\r\n\r\n今まで触った言語は、C, C++, Prolog, Perl, Octave, C#, Pythonぐらい。\r\n学生の頃はFreeBSDを使っていたので、cshかtcshだったけど、今はzshです。","facebookUrl":null,"githubUrl":"https://github.com/tfukushima1","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"Tamo Fanfan","profileImageUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/329392/e08b0f5411e5c1b79a59ecf87b6112d72f41d954/x_large.png?1611727425","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F329392%2Fe08b0f5411e5c1b79a59ecf87b6112d72f41d954%2Fx_large.png%3F1611727425?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=353284fc9d35d5cc1899e4be3b0e07e9","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F329392%2Fe08b0f5411e5c1b79a59ecf87b6112d72f41d954%2Fx_large.png%3F1611727425?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=6c7acf933b897bd632982f6915d2ce71","urlName":"fan2tamo","websiteUrl":"","twitterUrl":"https://twitter.com/yasu_fan2tamo","twitterUrlName":"yasu_fan2tamo","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C++","urlName":"cpp"},{"name":"C#","urlName":"csharp"},{"name":"swig","urlName":"swig"},{"name":"dll","urlName":"dll"},{"name":"Wrapper","urlName":"wrapper"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

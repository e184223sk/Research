C# 9.0のソースジェネレーターの実例としてよく挙げられるのが、INotifyPropertyChangedです。
そこで実際にWPFに組み込もうとしたところ、結構苦労したので、その注意点を説明します。INotifyPropertyChangedを実装するソースジェネレータは 公式サンプルもありますが、より多機能な@okazukiさんのプロジェクトを組み込みます。題材とするテストアプリです。ViewModelは上記の記事のままです。ソースジェネレータを組み込んでいないので、まだビルドすることはできません。コンソールアプリケーションではプロジェクト参照でも動きますが、現時点（2021/04/11）ではWPFでは動きません。まず、ソースジェネレータプロジェクトをnugetパッケージ化する必要があります。
通常のパッケージとは違うので、いくつか変更するところがあります。TargetsForTfmSpecificContentInPackageから下記のカスタムターゲットを指定します。.csprojファイルの編集後ビルドして、.nupkgファイルを作成します。作成したnupkgファイルの中を見てみると、通常のnupkgファイルとは異なった構成になっているのが分かります。作成したパッケージはnuget.orgを使用してもいいですが、自分が簡単に使うだけなら、ローカルフォルダに置いてnugetレポジトリとして、VisualStudioに登録することで使えるようになります。詳しいやり方は以下を参照してください。作成したnugetパッケージをWPFプロジェクトに追加します。
ここでも.csprojファイルの修正が必要です。&lt;IncludePackageReferencesDuringMarkupCompilation&gt;をtrueに設定します。この長いプロパティは最近追加されたもののようで、まだMicrosoft Docsにも含まれていません。この状態でビルドして動作させます。2つのTextBoxに入力された内容が、下のTextBlockに反映されることから、INotifyPropertyChangedが正しく実装されていることが分かります。https://github.com/ufcpp/ValueChangedGenerator/
https://zenn.dev/naminodarie/articles/32973a36fcbe99今回の完全なソースコードをGithubにおいておきます。okazukiさんの記事のレポジトリをフォークしたものです。
https://github.com/soi013/MvvmGeneratorVisualStudio 2019 Version 16.9.3
.NET 5
C# 9.0WPFで組み込もうとしたところ、うまく動かなかったので、@okazukiさんに助けてもらいました。ありがとうございました。



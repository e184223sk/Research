More than 1 year has passed since last update.同一セッション内でデータを保持する方法を学んだ公式チュートリアル第3回でしたが、そこから第4回に至るまでは思いの外長い道のりでした。C#からDynamoDBにアクセスする方法を基礎から調べ、やっとできた、と思ったら低レベルAPIを使っていることがわかり、高レベルAPIでのやり方に変え、最終的にはAlexaスキルでの用途に限定したクラスを作ってそれをNuGetギャラリーに公開、と。やっと、公式チュートリアル第4回をC#で実装する準備が整いました。Visual StudioでNuGetパッケージマネージャーを使ってAlexaPersistentAttributesManagerをインストールしてください。Alexaスキル特化ですが、DynamoDBにデータを追加したり、データを取得したりするのがほんの数ステップでできます。attrManagerにキーバリューペアの形でデータを追加していく。SavePersistentAttributesメソッドでデータをDynamoDB内のテーブルに追加します。GetPersistentAttributesメソッドでテーブル上のidカラムがuserIdであるレコードのattributesカラムの値を取得します。
取得したデータはキーバリューペアなのでキーを指定すると、対応する値を取得することができます。HoroscopeIntentHandler内で「星座」の情報を取得して、それをセッションアトリビュートと永続アトリビュート（DynamoDB）に格納します。そしてLuckyColorIntentHandlerではセッションアトリビュートまたは永続アトリビュートを取得しています。公式チュートリアル第4回と同じ手順で試してみましょう。
同じ結果が返ってきています。
セッションが一度終了した後、直接ラッキーカラーを訊くと、前回DynamoDBに格納した星座情報を取得して使ってくれています。
ちゃんと動いているようですね。



More than 3 years have passed since last update.この記事はTCU-CTRL場外乱闘 Advent Calendar 2017 12日目の記事ですゲーム開発においてキャラクターの台詞や、敵のパラメーターなどを全てソースコード内に記述することは後の変更が難しくなるため、テキストファイルとして保存しておき読み込む方法がよくあるパターンです。
Unityにおいてもそのパターンは当てはまります。しかし、Unityのファイル読み込みでググるとResourcesフォルダを使った方法が多く出てきます。
Resourcesフォルダを用いたファイル読み込みはシンプルですが、アプリの起動時間やビルド時間が伸びたりコンテンツの更新が難しくなるなどの理由から公式チュートリアルでは推奨されていません。その為今回はAssetBundleからTextファイルを読み込む方法を検証します。AssetStoreからAssetBundleManagerをインポートします
インポートが終了したら、Assets-&gt;AssetBundlesからSimulation Modeがオンになっていることを確認します
読み込むためのAssetBundleを用意します。
今回はTestData.txtを作成しました。
適当なTextファイルを作り、右下に有るAssetLabelからAssetBundleNameを設定します。今回は新しくtest/dataというAssetBundleNameを作成し設定しました。AsettBundleNameを設定したら、Assets-&gt;AssetBundlesからBuildAssetBundlesを選択してビルドを行います。
これでAssetBundleが生成されました。
AssetBundleManagerによるファイルの読み込みはゲーム内の様々な場所で行われるのでシングルトンにしておくと楽ができます。
テラシュールブログさん(Unityで少しだけ高速なシングルトン)のシングルトンをもらってきて継承し、ファイルを読み込むためのメソッドを持つクラスを作ります。
LoadASync&lt;T&gt;(string assetBundleName, string assetName, Action&lt;T&gt; callback)のassetBundleNameは2つ前の節で付けた名前、assetNameはファイルの名前になります。
このクラスをシーン上の適当なGameObjectにアタッチしておきます。Textファイルの読み込みを開始するためのButtonと、読み込んだテキストを表示するためのTextをシーンに配置します。
そして以下のようなクラスを作成して、Buttonにアタッチします。
LoadASyncは非同期でAssetBundleを読み込むので、読み込んだデータの受取はコールバックで行います。しっかりとAssetBundleからジュースハゲコピペが読み込まれているのが確認できます。
今回はAssetBundleからTextファイルを読み込む方法を検証しました。
実はAssetBundleのことをまともに調べたのは今回が初めてで、結果としてTextファイルの読み込みには成功しましたが、正直まだよくわかってないことが多いのでこれからも好きあらば調べていきたいところです。
てか公式のAssetBundleManager情報がこれしか見つからなかったので結構辛い。リファレンスどこ？？？？次回はまくらんく君(@cap_pepsi)です。よろしくお願いします



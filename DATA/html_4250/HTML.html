<!DOCTYPE html><html><head><meta charset="utf-8" /><title>IEquatableを完全に理解する - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/cactuaroid/items/f277a097ecf51eb247c0" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="oSEYtF7Hbmk+qqZQYPzO4pnpLkknoE2XiKvXYgXZ4A7VJ6KNWQpoXrSOHo/VLsnS8uXOwx3qyHZGdJbOEGvthw==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@cactuaroid" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="IEquatableを完全に理解する - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1TVVZ4ZFdGMFlXSnNaZU9Da3VXdWpPV0ZxT09CcS1lUWh1aW5vLU9CbWVPQ2l3JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWNjMzVhZTZkNzBiYjY4ZWNhNWUzYjdkZTc1ZDBmMWFh&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR05oWTNSMVlYSnZhV1EmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz02MzA2YzgzMmI0OTA5M2U2NWEzYzBmYzBiMzQ4YTkxZQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=5a1f98eca190721a762c9c0494ceb2d6"><meta property="og:description" content="等価性判定のためのインターフェースIEquatable&amp;lt;T&amp;gt;についてガイドラインを示し、完全に理解できるよう解説します。

public interface IEquatable&amp;lt;T&amp;gt;
{
    bool E..."><meta content="https://qiita.com/cactuaroid/items/f277a097ecf51eb247c0" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-1c3f78ed-6324-4fdc-a859-718de4cdaa39"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fcactuaroid%2Fitems%2Ff277a097ecf51eb247c0">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fcactuaroid%2Fitems%2Ff277a097ecf51eb247c0">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-1c3f78ed-6324-4fdc-a859-718de4cdaa39">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-12-09T00:30:06.000+09:00","dateModified":"2020-09-25T22:23:20.000+09:00","headline":"IEquatableを完全に理解する","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1TVVZ4ZFdGMFlXSnNaZU9Da3VXdWpPV0ZxT09CcS1lUWh1aW5vLU9CbWVPQ2l3JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWNjMzVhZTZkNzBiYjY4ZWNhNWUzYjdkZTc1ZDBmMWFh\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR05oWTNSMVlYSnZhV1EmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz02MzA2YzgzMmI0OTA5M2U2NWEzYzBmYzBiMzQ4YTkxZQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=5a1f98eca190721a762c9c0494ceb2d6","mainEntityOfPage":"https://qiita.com/cactuaroid/items/f277a097ecf51eb247c0","author":{"@type":"Person","address":null,"email":null,"identifier":"cactuaroid","name":"cactuaroid","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F17759160%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=7760d477201b632ef2560f220a53558a","url":"https://qiita.com/cactuaroid","description":null,"memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"cactuaroid","type":"items","id":"f277a097ecf51eb247c0"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"cactuaroid","type":"items","id":"f277a097ecf51eb247c0"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"cactuaroid","type":"items","id":"f277a097ecf51eb247c0"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/cactuaroid/items/f277a097ecf51eb247c0","location":"/cactuaroid/items/f277a097ecf51eb247c0","scheme":"https","host":"qiita.com","port":null,"pathname":"/cactuaroid/items/f277a097ecf51eb247c0","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"690/FfoQsVX6f9oAUOJBpYAnTbeuy2MEqs0bb9r9hhGf24Us/d23YnBbYt/lMEaV6yutPZSB5uVkElrDz0+LmA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-8d822b87-482a-4b5e-8998-0d6b13f58572"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/cactuaroid/items/f277a097ecf51eb247c0/likers" class="css-1iupg5d">111</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">87</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/f277a097ecf51eb247c0/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/cactuaroid/items/f277a097ecf51eb247c0/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/cactuaroid/items/f277a097ecf51eb247c0/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/cactuaroid/items/f277a097ecf51eb247c0/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/cactuaroid/items/f277a097ecf51eb247c0.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><span><a href="/advent-calendar/2018/c-sharp" class="it-AdcalRibbon_title">C#<!-- --> Advent Calendar<!-- --> <!-- -->2018</a>Day 9</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/cactuaroid"><img class="css-100alwu eyfquo10" src="https://avatars0.githubusercontent.com/u/17759160?v=4" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/cactuaroid" class="css-10ougpm">@<!-- -->cactuaroid</a><div class="css-1ay9vb9"><span><meta content="2018-12-08T15:30:06Z"/><time dateTime="2020-09-25T13:23:20Z" class="css-m19uds">updated at 2020-09-25</time></span></div></div></div></div></div><h1 class="css-cgzq40">IEquatableを完全に理解する</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>等価性判定のためのインターフェース<code>IEquatable&lt;T&gt;</code>についてガイドラインを示し、完全に理解できるよう解説します。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IEquatable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="n">T</span> <span class="n">other</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ref.<br>
<a href="https://docs.microsoft.com/ja-jp/dotnet/api/system.iequatable-1?view=netframework-4.7.2" rel="nofollow noopener" target="_blank">IEquatable Interface</a></p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<h3>
<span id="本記事中の用語" class="fragment"></span><a href="#%E6%9C%AC%E8%A8%98%E4%BA%8B%E4%B8%AD%E3%81%AE%E7%94%A8%E8%AA%9E"><i class="fa fa-link"></i></a>本記事中の用語</h3>

<ul>
<li>
<strong>等価性（Equality）</strong><sup id="fnref1"><a href="#fn1" title="「2つのインスタンスの」等価性・同一性・同値性という書き方が正確だが、IEquatable&lt;T&gt;は2つのインスタンスを比較するためのインターフェースであり本記事中では文脈から明らかと思われるので省略する。">1</a></sup>: 2つのインスタンスが等しいこと。<code>Equals()</code>。

<ul>
<li>
<strong>同一性（Identity）</strong>: 2つのインスタンスが同じインスタンスであること。<code>ReferenceEquals()</code>。参照の等価性（Reference Equality）。</li>
<li>
<strong>同値性（Value Equality）</strong>: 2つのインスタンスの値が等しいこと。同じインスタンスとは限らない。値の等価性。</li>
</ul>
</li>
</ul>

<p>クラス・構造体は可変型と不変型に分けられます。</p>

<ul>
<li>
<strong>可変（Mutable）型</strong>: インスタンスを生成した後に状態を変更できる型。</li>
<li>
<strong>不変（Immutable）型</strong>: 一度インスタンスを生成したら状態を変更できないようにしてある型。</li>
</ul>

<h3>
<span id="クラスでのガイドライン" class="fragment"></span><a href="#%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7%E3%81%AE%E3%82%AC%E3%82%A4%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3"><i class="fa fa-link"></i></a>クラスでのガイドライン</h3>

<p>クラスは参照型であり、既定の<code>Equals()</code>では同一性判定が行われます。（= <code>ReferenceEquals()</code>）</p>

<ul>
<li>
<strong>可変型</strong>:
<code>IEquatable&lt;T&gt;</code>を実装しない（実装したいならクラスを不変型にする）</li>
<li>
<strong>不変型</strong><strong>で値を表す（値オブジェクト）</strong>: <code>IEquatable&lt;T&gt;</code>を実装することを検討し、実装するなら<code>Equals()</code>・<code>GetHashCode()</code>・<code>==</code>/<code>!=</code>演算子を全て実装する<sup id="fnref2"><a href="#fn2" title="Object.Equals MethodやEffective C#によると、Equals()をオーバーライドしたとしても==/!=演算子をオーバーロードすべきケースは非常に少ないと説明されている。一方、方法: 型の値の等価性を定義する (C# プログラミング ガイド)では==/!=演算子をオーバーロードすることが推奨されている。矛盾しているようにも思え非常に混乱するが、前者は値オブジェクト以外でEquals()をオーバーライドすることを想定しているように読める。値オブジェクト以外ならば本記事中で説明しているように==/!=演算子をオーバーロードすべきでないが、そもそも値オブジェクト以外でEquals()をオーバーライドすべきでなく、良い設計へ導くためのガイドラインとしては不適切ではないだろうか。">2</a></sup>
</li>
<li>
<strong>不変型</strong><strong>で値以外を表す</strong>: <code>IEquatable&lt;T&gt;</code>を実装しない方が無難だが、実装するなら<code>Equals()</code>・<code>GetHashCode()</code>を実装し、<code>==</code>/<code>!=</code>演算子は実装しない</li>
</ul>

<h3>
<span id="構造体でのガイドライン" class="fragment"></span><a href="#%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%A7%E3%81%AE%E3%82%AC%E3%82%A4%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3"><i class="fa fa-link"></i></a>構造体でのガイドライン</h3>

<p>構造体は値型であり、既定の<code>Equals()</code>では同値性判定が行われます。</p>

<ul>
<li>
<strong>可変型</strong>: <a href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/struct" rel="nofollow noopener" target="_blank">構造体は不変型にすべき</a>なので検討外</li>
<li>
<strong>不変型</strong>: 常に<code>IEquatable&lt;T&gt;</code>を実装して、<code>Equals()</code>・<code>GetHashCode()</code>・<code>==</code>/<code>!=</code>演算子を全て実装する</li>
</ul>

<h3>
<span id="実装方法" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>実装方法</h3>

<p>Visual Studio 2017では<code>IEquatable&lt;T&gt;.Equals(T)</code>・<code>Object.Equals(Object)</code>のオーバーライド・<code>GetHashCode()</code>・<code>==</code>/<code>!=</code>演算子を全て<a href="https://docs.microsoft.com/en-us/visualstudio/ide/reference/generate-equals-gethashcode-methods?view=vs-2017" rel="nofollow noopener" target="_blank"><strong>自動生成</strong>できるようになりました</a>（<a href="https://www.jetbrains.com/help/resharper/Code_Generation__Equality_Members.html" rel="nofollow noopener" target="_blank">ReSharperでもできます</a>）。バグを埋め込まないよう、原則として手書きではなく自動生成するのが良いでしょう。本記事では自動生成する前提で、詳細なコーディングについては省略します。</p>

<p>※VSCodeでの生成方法がもしあれば教えてください。</p>

<h1>
<span id="完全に理解する" class="fragment"></span><a href="#%E5%AE%8C%E5%85%A8%E3%81%AB%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>完全に理解する</h1>

<h3>
<span id="iequatabletを実装するメリット" class="fragment"></span><a href="#iequatablet%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a><code>IEquatable&lt;T&gt;</code>を実装するメリット</h3>

<p>等価性判定のカスタマイズを考えた時、そもそも全てのクラス・構造体には<code>Object</code>クラスで定義された<code>Object.Equals(Object)</code>が既にあります。これを単にオーバーライドするだけと、<code>IEquatable&lt;T&gt;.Equals(T)</code>を実装するのとでは何が違うのでしょうか。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Object</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="n">Object</span> <span class="n">obj</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IEquatable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="n">T</span> <span class="n">other</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
<li>
<code>IEquatable&lt;T&gt;.Equals(T)</code>では無関係な型との等価性判定という意味のないコード（おそらく書き間違い）をコンパイルエラーとして検出できます。</li>
<li>構造体に対して<code>Object.Equals(Object)</code>を呼び出すと<code>Object</code>型へキャストすることによるボックス化<sup id="fnref3"><a href="#fn3" title="ボックス化とは、値型のインスタンスを参照型の入れ物にコピーして、参照型として扱えるようにすること。値型を参照型の変数に代入したりキャストしたりすると発生する。">3</a></sup>が発生します。また既定で構造体用にオーバーライド済みの<code>ValueType.Equals(Object)</code>の実装は、リフレクションにより同値性判定を行う<sup id="fnref4"><a href="#fn4" title="リフレクションとは、型自体の情報を取得すること。参照型のメンバを含まない場合リフレクションは発生せず高速に動作するが、メンテナンス性の観点からもIEquatable&lt;T&gt;を実装しておいた方が良いだろう。また、リフレクションによる同値性判定ではすべてのフィールド・プロパティの比較が行われるが、構造体が意味する値に期待される挙動とは異なる可能性がある。">4</a></sup>ため、非常に時間がかかってしまいます。これを避けるために<code>IEquatable&lt;T&gt;</code>を常に実装します。</li>
<li>
<code>Object.Equals(Object)</code>を呼び出すと、<code>Object</code>型を経由した仮想メソッド呼び出しになりパラメータのキャストが必要です。型付けされた<code>IEquatable&lt;T&gt;.Equals(T)</code>を呼び出すのに比べ、若干ですが余計なコストがかかります。</li>
</ul>

<p>念のため<a href="https://gist.github.com/cactuaroid/5106f3e45d2b1494238e421e85a3668d" rel="nofollow noopener" target="_blank">こちらのコードで</a>パフォーマンス比較してみました。<sup id="fnref5"><a href="#fn5" title="生成されたIEquatable&lt;T&gt;.Equals(T)のnullチェックが!=演算子を使用しているため、!=演算子も生成してあると同値性判定になってしまい遅いのでis nullに書き換えて計測した。修正依頼済みで、マイルストーンに含まれているのでそのうち直る？（Issue #31283）。">5</a></sup></p>

<table>
<thead>
<tr>
<th>Method</th>
<th style="text-align: right">Mean</th>
<th style="text-align: right">Error</th>
<th style="text-align: right">StdDev</th>
</tr>
</thead>
<tbody>
<tr>
<td>'構造体 Object.Equals(Object) 既定'</td>
<td style="text-align: right">419.431 ns</td>
<td style="text-align: right">1.1720 ns</td>
<td style="text-align: right">1.0963 ns</td>
</tr>
<tr>
<td>'構造体 Object.Equals(Object) オーバーライド'</td>
<td style="text-align: right">9.504 ns</td>
<td style="text-align: right">0.0675 ns</td>
<td style="text-align: right">0.0631 ns</td>
</tr>
<tr>
<td>'構造体 IEquatable&lt;T&gt;.Equals(T) 直接呼出し'</td>
<td style="text-align: right">2.464 ns</td>
<td style="text-align: right">0.0136 ns</td>
<td style="text-align: right">0.0128 ns</td>
</tr>
<tr>
<td>'構造体 IEquatable&lt;T&gt;.Equals(T) インターフェース呼び出し'</td>
<td style="text-align: right">3.462 ns</td>
<td style="text-align: right">0.0171 ns</td>
<td style="text-align: right">0.0160 ns</td>
</tr>
<tr>
<td>'クラス Object.Equals(Object) オーバーライド'</td>
<td style="text-align: right">4.106 ns</td>
<td style="text-align: right">0.0263 ns</td>
<td style="text-align: right">0.0246 ns</td>
</tr>
<tr>
<td>'クラス IEquatable&lt;T&gt;.Equals(T) 直接呼出し'</td>
<td style="text-align: right">2.519 ns</td>
<td style="text-align: right">0.0123 ns</td>
<td style="text-align: right">0.0115 ns</td>
</tr>
<tr>
<td>'クラス IEquatable&lt;T&gt;.Equals(T) インターフェース呼び出し'</td>
<td style="text-align: right">2.955 ns</td>
<td style="text-align: right">0.0112 ns</td>
<td style="text-align: right">0.0105 ns</td>
</tr>
</tbody>
</table>

<p>構造体・クラス共にIEquatable.Equals(T)直接呼出しが最も速く、次いで<code>IEquatable&lt;T&gt;.Equals(T)</code>インターフェース呼び出し、<code>Object.Equals(Object)</code>仮想メソッド呼び出しの順となり、構造体の既定実装であるリフレクションは2桁遅い結果となりました。</p>

<p>このようにパフォーマンス上の理由があるため、<code>Dictionary&lt;TKey, TValue&gt;</code>や<code>List&lt;T&gt;</code>といった多くのクラスの等価性判定を伴う処理では、<code>IEquatable&lt;T&gt;</code>を実装している型については<code>Object.Equals(Object)</code>ではなく<code>IEquatable&lt;T&gt;.Equals(T)</code>を呼ぶように最適化されています。<code>IEquatable&lt;T&gt;</code>を実装するデメリットは特にないので、<code>Equals()</code>をオーバーライドしたいなら常に<code>IEquatable&lt;T&gt;</code>を実装することをお勧めします。</p>

<p>なお、<code>IEquatable&lt;T&gt;</code>を実装する場合、以下のように<code>Object.Equals(Object)</code>は定型パターンでオーバーライドして<code>IEquatable&lt;T&gt;.Equals(T)</code>を呼び出すようにします（自動生成されます）。本記事中ではこれらを特に区別せず<code>Equals()</code>と表現します。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">)</span> <span class="c1">// Object.Equals(Object)のオーバーライド</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nf">Equals</span><span class="p">(</span><span class="n">obj</span> <span class="k">as</span> <span class="n">MyClass</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="n">MyClass</span> <span class="n">other</span><span class="p">)</span> <span class="c1">// IEquatable&lt;T&gt;.Equals(T)の実装</span>
<span class="p">{</span>
    <span class="c1">// 比較処理</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ref.<br>
<a href="https://stackoverflow.com/questions/2734914/whats-the-difference-between-iequatable-and-just-overriding-object-equals" rel="nofollow noopener" target="_blank">What's the difference between IEquatable and just overriding Object.Equals()?</a></p>

<h3>
<span id="値を表さないクラスにiequatabletを実装しないほうが良いワケ" class="fragment"></span><a href="#%E5%80%A4%E3%82%92%E8%A1%A8%E3%81%95%E3%81%AA%E3%81%84%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%ABiequatablet%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%AA%E3%81%84%E3%81%BB%E3%81%86%E3%81%8C%E8%89%AF%E3%81%84%E3%83%AF%E3%82%B1"><i class="fa fa-link"></i></a>値を表さないクラスに<code>IEquatable&lt;T&gt;</code>を実装しないほうが良いワケ</h3>

<ul>
<li>クラスに<code>IEquatable&lt;T&gt;</code>を実装するということは<code>Equals()</code>を同値性判定でオーバーライドすることを意味します。これは「このクラスの等価性とは同値性のことだ」と宣言することになります。なぜ同値性判定が分かりやすく有用なのかというと、値を表すクラスだからです。</li>
<li>値を表さないクラスでも<code>IEquatable&lt;T&gt;</code>を実装したり<code>Equals()</code>をオーバーライドできますが、避けた方が無難でしょう。代わりに例えば、<code>IEquatable&lt;T&gt;</code>を実装せず<code>Equals()</code>よりも説明的な名前で同値性判定メソッドを定義する<sup id="fnref6"><a href="#fn6" title="StringBuilderにはEquals()があり内部の文字列の同値性を比較できるが、これを悪い例として紹介する。可変型なのでIEquatable&lt;T&gt;は実装されていないしObject.Equals()もGetHashCode()もオーバーライドされていないのでルール違反ではないが、この挙動が直観と一致する人はどれだけいるのだろうか。例えばValueEquals()という名前だったらはるかに分かりやすく混乱しなかっただろう。">6</a></sup>という手があります。</li>
</ul>

<h3>
<span id="可変型クラスにiequatabletを実装してはいけないワケ" class="fragment"></span><a href="#%E5%8F%AF%E5%A4%89%E5%9E%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%ABiequatablet%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%AF%E3%81%84%E3%81%91%E3%81%AA%E3%81%84%E3%83%AF%E3%82%B1"><i class="fa fa-link"></i></a>可変型クラスに<code>IEquatable&lt;T&gt;</code>を実装してはいけないワケ</h3>

<ul>
<li>2つのインスタンスについて<code>Equals()</code>が<code>true</code>を返すなら<code>GetHashCode()</code>が返すハッシュ値も同じでなければなりません<sup id="fnref7"><a href="#fn7" title="2つのインスタンスのハッシュ値が同じであってもEquals()がtrueを返すとは限らない。ハッシュ値の等価性はインスタンスの等価性を表すわけではない。">7</a></sup>。ハッシュ値を利用する辞書などでは<code>Equals()</code>と<code>GetHashCode()</code>の両方が使用されており、このルールを破ると期待通りに動作しません。<code>Equals()</code>をオーバーライドする場合はその動作に合わせて<code>GetHashCode()</code>もオーバーライドする必要があります。</li>
<li>ハッシュ値はインスタンスの生存期間中、不変でなければなりません。もし辞書に登録しておいたインスタンスのハッシュ値が変わると行方不明になってしまいます。したがって、可変型では<code>IEquatable&lt;T&gt;</code>を実装してはいけません。</li>
<li>可変型で同値性判定が必要な場合は、<code>IEquatable&lt;T&gt;</code>を実装せずに普通のメソッドとして実装してください。</li>
</ul>

<p>辞書等に入れないなら可変型クラスに<code>IEquatable&lt;T&gt;</code>を実装していいのか？</p>

<ul>
<li>そのクラスのハッシュ値が永久に絶対に使われないと言い切るのは大変難しいです。原則として避けてください。パフォーマンスチューニングなどやむを得ない事情で原則に違反した実装をする場合、クラスの可視性を制限したりコメントで注意喚起するなど十分警戒してください。</li>
</ul>

<p>値を表す不変型はプリミティブ型のように簡単に扱うことができ、<strong>値オブジェクト</strong>と呼ばれます。ここまでをまとめると、値オブジェクトには<code>IEquatable&lt;T&gt;</code>を実装し、値オブジェクトでなければ<code>IEquatable&lt;T&gt;</code>は実装しない方が無難ということになります。</p>

<h3>
<span id="値を表さないクラスに演算子を実装しないほうが良いワケ" class="fragment"></span><a href="#%E5%80%A4%E3%82%92%E8%A1%A8%E3%81%95%E3%81%AA%E3%81%84%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AB%E6%BC%94%E7%AE%97%E5%AD%90%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%AA%E3%81%84%E3%81%BB%E3%81%86%E3%81%8C%E8%89%AF%E3%81%84%E3%83%AF%E3%82%B1"><i class="fa fa-link"></i></a>値を表さないクラスに<code>==</code>/<code>!=</code>演算子を実装しないほうが良いワケ</h3>

<ul>
<li>演算子による演算結果は自明でなければなりません。例えば<code>String</code>クラスでは<code>"abc" + "def"</code>は結合されることが自明ですし、<code>"abc" == "abc"</code>は<code>true</code>になることが自明です。値以外を表すクラスで演算子をオーバーロードしてしまうと、演算結果が自明ではなくなってしまいます。</li>
<li>
<code>==</code>/<code>!=</code>演算子は、値の比較では同値性判定、値以外の比較では同一性判定が期待されます。構造体は値を意味しますが、クラスは値を表すことも、値以外を表すこともあります。値以外を表すクラスで<code>==</code>/<code>!=</code>演算子をオーバーロードして同値性判定にしてしまうと期待と動作が一致しません。</li>
</ul>

<p>例えば<code>StringBuilder</code>クラス<sup id="fnref6"><a href="#fn6" title="StringBuilderにはEquals()があり内部の文字列の同値性を比較できるが、これを悪い例として紹介する。可変型なのでIEquatable&lt;T&gt;は実装されていないしObject.Equals()もGetHashCode()もオーバーライドされていないのでルール違反ではないが、この挙動が直観と一致する人はどれだけいるのだろうか。例えばValueEquals()という名前だったらはるかに分かりやすく混乱しなかっただろう。">6</a></sup>を考えると</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">builder1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">builder2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">builder1</span> <span class="p">==</span> <span class="n">builder2</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="c1">// "false" もしこれが内部状態を比較してtrueになったとすると直感に反する</span>
</code></pre></div></div>

<p>一方で、参照型であっても値を表す不変なクラスであれば、値型と同等に<code>==</code>/<code>!=</code>演算子で比較できると直感に一致します。例えば構造体である<a href="https://docs.microsoft.com/en-us/dotnet/api/system.guid" rel="nofollow noopener" target="_blank">Guid</a>とクラスである<a href="https://docs.microsoft.com/en-us/dotnet/api/system.version" rel="nofollow noopener" target="_blank">Version</a>は同じ感覚で使えます。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">guid1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Guid</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">guid2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Guid</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">guid1</span> <span class="p">==</span> <span class="n">guid2</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="c1">// "true"</span>
</code></pre></div></div>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">version1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Version</span><span class="p">(</span><span class="s">"1.0.0.0"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">version2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Version</span><span class="p">(</span><span class="s">"1.0.0.0"</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">version1</span> <span class="p">==</span> <span class="n">version2</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="c1">// "true" もしこれがfalseになったとすると直感に反する</span>
</code></pre></div></div>

<p>ref.<br>
<a href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/operator-overloads" rel="nofollow noopener" target="_blank">Operator Overloads</a><br>
<a href="https://docs.microsoft.com/ja-jp/dotnet/csharp/programming-guide/statements-expressions-operators/how-to-define-value-equality-for-a-type" rel="nofollow noopener" target="_blank">方法: 型の値の等価性を定義する (C# プログラミング ガイド)</a><br>
<a href="http://www.atmarkit.co.jp/ait/articles/1802/28/news028.html" rel="nofollow noopener" target="_blank">==演算子とEqualsメソッドの違いとは？［C#］</a></p>

<h3>
<span id="継承でのiequatabletに注意" class="fragment"></span><a href="#%E7%B6%99%E6%89%BF%E3%81%A7%E3%81%AEiequatablet%E3%81%AB%E6%B3%A8%E6%84%8F"><i class="fa fa-link"></i></a>継承での<code>IEquatable&lt;T&gt;</code>に注意</h3>

<p><code>MyBase</code>クラスと、その派生クラス<code>MySub</code>があったとします。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">myBase1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyBase</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">myBase2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MySub</span><span class="p">()</span> <span class="k">as</span> <span class="n">MyBase</span><span class="p">;</span>
<span class="c1">// ...</span>
<span class="k">if</span> <span class="p">(</span><span class="n">myBase1</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">myBase2</span><span class="p">))</span> <span class="p">{</span> <span class="p">}</span> <span class="c1">// MyBase.Equals()で期待通りに判定されますか？</span>
</code></pre></div></div>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">myBase1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MySub</span><span class="p">()</span> <span class="k">as</span> <span class="n">MyBase</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">myBase2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MySub</span><span class="p">()</span> <span class="k">as</span> <span class="n">MyBase</span><span class="p">;</span>
<span class="c1">// ...</span>
<span class="k">if</span> <span class="p">(</span><span class="n">myBase1</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">myBase2</span><span class="p">))</span> <span class="p">{</span> <span class="p">}</span> <span class="c1">// MyBase.Equals()で期待通りに判定されますか？</span>
</code></pre></div></div>

<p><code>Equals()</code>に期待される動作は何でしょうか。基底クラスの情報だけで同値性判定すべきなのか、派生クラスの情報も含めるべきなのか、クラスの意味と等価性判定する文脈によって異なり、そのどちらを期待するかも人によって異なるでしょう。</p>

<p>継承関係にあるクラスの同値性判定には意味が自明ではないケースがあります。<code>IEquatable&lt;T&gt;</code>を実装するかわりに<code>Equals()</code>よりも説明的な名前のメソッドを別に用意することを検討してください。</p>

<h3>
<span id="配列等に注意" class="fragment"></span><a href="#%E9%85%8D%E5%88%97%E7%AD%89%E3%81%AB%E6%B3%A8%E6%84%8F"><i class="fa fa-link"></i></a>配列等に注意</h3>

<p>例えば配列をメンバに含むクラスの場合、<code>Equals()</code>はどう判定すべきでしょうか。配列の各要素それぞれについての同値性判定が期待されるはずです。しかしVisual StudioもReSharperも自動生成された<code>Equals()</code>はそのような実装になっておらず、配列自体を比較してしまいますので、配列の要素が同値であっても<code>false</code>になってしまいます。これを解決するには手で書き換える必要があります。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">Values</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

<span class="k">public</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="n">MyClass</span> <span class="n">other</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">other</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span>
           <span class="c1">// EqualityComparer&lt;string[]&gt;.Default.Equals(Value, other.Value); 自動生成されたコード</span>
           <span class="c1">// 期待されるのは要素ごとの同値性判定なので以下のようになる</span>
           <span class="p">(</span><span class="n">Values</span> <span class="p">==</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">other</span><span class="p">.</span><span class="n">Values</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">||</span>
           <span class="p">(</span><span class="n">Values</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">other</span><span class="p">.</span><span class="n">Values</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">Values</span><span class="p">.</span><span class="nf">SequenceEqual</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">Values</span><span class="p">));</span> 
<span class="p">}</span>
</code></pre></div></div>

<p>配列に限らず<code>IEnumerable&lt;T&gt;</code>を実装するあらゆる型について言えることです。</p>

<h3>
<span id="visual-studioが生成したobjectequalsは型チェックしないの" class="fragment"></span><a href="#visual-studio%E3%81%8C%E7%94%9F%E6%88%90%E3%81%97%E3%81%9Fobjectequals%E3%81%AF%E5%9E%8B%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%97%E3%81%AA%E3%81%84%E3%81%AE"><i class="fa fa-link"></i></a>Visual Studioが生成した<code>Object.Equals()</code>は型チェックしないの？</h3>

<p>Visual Studioが生成したコードはシンプルにこうなっています。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nf">Equals</span><span class="p">(</span><span class="n">obj</span> <span class="k">as</span> <span class="n">MyClass</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>一方、MSDNやEffective C#のサンプルやReSharperが生成したコードはこんな感じです。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nf">ReferenceEquals</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nf">ReferenceEquals</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span> <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="nf">GetType</span><span class="p">()</span> <span class="p">!=</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetType</span><span class="p">())</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="k">return</span> <span class="nf">Equals</span><span class="p">((</span><span class="n">MyClass</span><span class="p">)</span> <span class="n">obj</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>nullチェックと同一性判定は良いとして、<code>GetType()</code>で実行時の型チェックしているところがVisual Studioの生成したコードと大きく違います。以下のコードで動作が異なります。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="p">((</span><span class="kt">object</span><span class="p">)</span><span class="n">myBase</span><span class="p">).</span><span class="nf">Equals</span><span class="p">(</span><span class="n">mySub</span><span class="p">)</span>
</code></pre></div></div>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="kt">object</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">myBase</span><span class="p">,</span> <span class="n">mySub1</span><span class="p">)</span> <span class="c1">// 内部でObject.Equals()が呼ばれる</span>
</code></pre></div></div>

<p>Visual Studio版では実行時の型チェックをしないので<code>true</code>になりますが、MSDN版では<code>false</code>になります。ただ、どちらが正しいと言い切るのは難しく、同値性判定で実行時の型チェックが期待されるか？という問題です。これは前項の継承の話と同類の問題なので、そもそもこのコードの違いが動作の違いとして現れる設計は避けたいところです。</p>

<h3>
<span id="gethashcodeのハッシュアルゴリズム" class="fragment"></span><a href="#gethashcode%E3%81%AE%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0"><i class="fa fa-link"></i></a><code>GetHashCode()</code>のハッシュアルゴリズム</h3>

<p><code>GetHashCode()</code>はよく分散したハッシュ値を素早く返すことが求められます。</p>

<p>XORハッシュ（<code>Value1.GetHashCode() ^ Value2.GetHashCode()</code>みたいなの）を目にしたことがあるかもしれませんが、例えば<code>Value1</code>と<code>Value2</code>の値が同じ場合、値に関わらず計算結果はすべて0になり、結果が偏ってしまうので良くありません。</p>

<p>Visual Studioが生成する<code>GetHashCode()</code>のハッシュアルゴリズムはBernsteinハッシュです。ReSharperならFNVハッシュです。ちなみに<code>ValueTuple</code>の内部実装では<code>HashHelpers.Combine()</code>が使われており、Modified Bernsteinハッシュで実装されています。いずれも十分に分散したハッシュ値を比較的素早く得られるアルゴリズムのようです。</p>

<p>ref.<br>
<a href="http://eternallyconfuzzled.com/tuts/algorithms/jsw_tut_hashing.aspx" class="autolink" rel="nofollow noopener" target="_blank">http://eternallyconfuzzled.com/tuts/algorithms/jsw_tut_hashing.aspx</a><br>
<a href="https://stackoverflow.com/questions/263400/what-is-the-best-algorithm-for-an-overridden-system-object-gethashcode" rel="nofollow noopener" target="_blank">What is the best algorithm for an overridden System.Object.GetHashCode?</a><br>
<a href="https://stackoverflow.com/questions/102742/why-is-397-used-for-resharper-gethashcode-override" rel="nofollow noopener" target="_blank">Why is '397' used for ReSharper GetHashCode override?</a></p>

<h1>
<span id="リファレンス" class="fragment"></span><a href="#%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>リファレンス</h1>

<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.object.equals" rel="nofollow noopener" target="_blank">Object.Equals Method</a><br>
<a href="https://docs.microsoft.com/en-us/dotnet/api/system.valuetype.equals" rel="nofollow noopener" target="_blank">ValueType.Equals(Object) Method</a><br>
<a href="https://docs.microsoft.com/ja-jp/dotnet/csharp/programming-guide/statements-expressions-operators/equality-comparisons" rel="nofollow noopener" target="_blank">等価比較 (C# プログラミング ガイド)</a></p>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>「2つのインスタンスの」等価性・同一性・同値性という書き方が正確だが、<code>IEquatable&lt;T&gt;</code>は2つのインスタンスを比較するためのインターフェースであり本記事中では文脈から明らかと思われるので省略する。 <a href="#fnref1">↩</a></p>
</li>

<li id="fn2">
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.object.equals" rel="nofollow noopener" target="_blank">Object.Equals Method</a>やEffective C#によると、<code>Equals()</code>をオーバーライドしたとしても<code>==</code>/<code>!=</code>演算子をオーバーロードすべきケースは非常に少ないと説明されている。一方、<a href="https://docs.microsoft.com/ja-jp/dotnet/csharp/programming-guide/statements-expressions-operators/how-to-define-value-equality-for-a-type" rel="nofollow noopener" target="_blank">方法: 型の値の等価性を定義する (C# プログラミング ガイド)</a>では<code>==</code>/<code>!=</code>演算子をオーバーロードすることが推奨されている。矛盾しているようにも思え非常に混乱するが、前者は値オブジェクト以外で<code>Equals()</code>をオーバーライドすることを想定しているように読める。値オブジェクト以外ならば本記事中で説明しているように<code>==</code>/<code>!=</code>演算子をオーバーロードすべきでないが、そもそも値オブジェクト以外で<code>Equals()</code>をオーバーライドすべきでなく、良い設計へ導くためのガイドラインとしては不適切ではないだろうか。 <a href="#fnref2">↩</a></p>
</li>

<li id="fn3">
<p>ボックス化とは、値型のインスタンスを参照型の入れ物にコピーして、参照型として扱えるようにすること。値型を参照型の変数に代入したりキャストしたりすると発生する。 <a href="#fnref3">↩</a></p>
</li>

<li id="fn4">
<p>リフレクションとは、型自体の情報を取得すること。参照型のメンバを含まない場合リフレクションは発生せず高速に動作するが、メンテナンス性の観点からも<code>IEquatable&lt;T&gt;</code>を実装しておいた方が良いだろう。また、リフレクションによる同値性判定ではすべてのフィールド・プロパティの比較が行われるが、構造体が意味する値に期待される挙動とは異なる可能性がある。 <a href="#fnref4">↩</a></p>
</li>

<li id="fn5">
<p>生成された<code>IEquatable&lt;T&gt;.Equals(T)</code>のnullチェックが<code>!=</code>演算子を使用しているため、<code>!=</code>演算子も生成してあると同値性判定になってしまい遅いので<code>is null</code>に書き換えて計測した。修正依頼済みで、マイルストーンに含まれているのでそのうち直る？（<a href="https://github.com/dotnet/roslyn/issues/31283" rel="nofollow noopener" target="_blank">Issue #31283</a>）。 <a href="#fnref5">↩</a></p>
</li>

<li id="fn6">
<p><code>StringBuilder</code>には<code>Equals()</code>があり内部の文字列の同値性を比較できるが、これを悪い例として紹介する。可変型なので<code>IEquatable&lt;T&gt;</code>は実装されていないし<code>Object.Equals()</code>も<code>GetHashCode()</code>もオーバーライドされていないのでルール違反ではないが、この挙動が直観と一致する人はどれだけいるのだろうか。例えば<code>ValueEquals()</code>という名前だったらはるかに分かりやすく混乱しなかっただろう。 <a href="#fnref6">↩</a></p>
</li>

<li id="fn7">
<p>2つのインスタンスのハッシュ値が同じであっても<code>Equals()</code>が<code>true</code>を返すとは限らない。ハッシュ値の等価性はインスタンスの等価性を表すわけではない。 <a href="#fnref7">↩</a></p>
</li>

</ol>
</div>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fcactuaroid%2Fitems%2Ff277a097ecf51eb247c0&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fcactuaroid%2Fitems%2Ff277a097ecf51eb247c0&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/cactuaroid/items/f277a097ecf51eb247c0/likers" class="css-1iupg5d">111</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">87</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/f277a097ecf51eb247c0/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/cactuaroid/items/f277a097ecf51eb247c0/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/cactuaroid/items/f277a097ecf51eb247c0/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/cactuaroid/items/f277a097ecf51eb247c0/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/cactuaroid/items/f277a097ecf51eb247c0.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-8d822b87-482a-4b5e-8998-0d6b13f58572">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-67cc4b69-5fad-4b29-bd8b-867ba34fa3cd"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-67cc4b69-5fad-4b29-bd8b-867ba34fa3cd">{}</script>
      
<div id="LoginModal-react-component-8740ab84-42b9-4f43-b7f3-5f82785c5339"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-8740ab84-42b9-4f43-b7f3-5f82785c5339">{}</script>
      
<div id="StockModal-react-component-dfcc6d91-04d7-4987-9434-31dfd9e5f041"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-dfcc6d91-04d7-4987-9434-31dfd9e5f041">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;CE08e+GdgcXcC3UgmNVDXuMTVlCybRhoxO9txkFebet8S4ZC5lCH8lYvzf8tB0RuiB+22ognnYkKMCxqVOxgYg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e等価性判定のためのインターフェース\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eについてガイドラインを示し、完全に理解できるよう解説します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIEquatable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eref.\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/api/system.iequatable-1?view=netframework-4.7.2\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIEquatable Interface\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"本記事中の用語\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AC%E8%A8%98%E4%BA%8B%E4%B8%AD%E3%81%AE%E7%94%A8%E8%AA%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e本記事中の用語\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e等価性（Equality）\u003c/strong\u003e\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"「2つのインスタンスの」等価性・同一性・同値性という書き方が正確だが、IEquatable\u0026lt;T\u0026gt;は2つのインスタンスを比較するためのインターフェースであり本記事中では文脈から明らかと思われるので省略する。\"\u003e1\u003c/a\u003e\u003c/sup\u003e: 2つのインスタンスが等しいこと。\u003ccode\u003eEquals()\u003c/code\u003e。\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e同一性（Identity）\u003c/strong\u003e: 2つのインスタンスが同じインスタンスであること。\u003ccode\u003eReferenceEquals()\u003c/code\u003e。参照の等価性（Reference Equality）。\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003e同値性（Value Equality）\u003c/strong\u003e: 2つのインスタンスの値が等しいこと。同じインスタンスとは限らない。値の等価性。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eクラス・構造体は可変型と不変型に分けられます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e可変（Mutable）型\u003c/strong\u003e: インスタンスを生成した後に状態を変更できる型。\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003e不変（Immutable）型\u003c/strong\u003e: 一度インスタンスを生成したら状態を変更できないようにしてある型。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"クラスでのガイドライン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7%E3%81%AE%E3%82%AC%E3%82%A4%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eクラスでのガイドライン\u003c/h3\u003e\n\n\u003cp\u003eクラスは参照型であり、既定の\u003ccode\u003eEquals()\u003c/code\u003eでは同一性判定が行われます。（= \u003ccode\u003eReferenceEquals()\u003c/code\u003e）\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e可変型\u003c/strong\u003e:\n\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装しない（実装したいならクラスを不変型にする）\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003e不変型\u003c/strong\u003e\u003cstrong\u003eで値を表す（値オブジェクト）\u003c/strong\u003e: \u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装することを検討し、実装するなら\u003ccode\u003eEquals()\u003c/code\u003e・\u003ccode\u003eGetHashCode()\u003c/code\u003e・\u003ccode\u003e==\u003c/code\u003e/\u003ccode\u003e!=\u003c/code\u003e演算子を全て実装する\u003csup id=\"fnref2\"\u003e\u003ca href=\"#fn2\" title=\"Object.Equals MethodやEffective C#によると、Equals()をオーバーライドしたとしても==/!=演算子をオーバーロードすべきケースは非常に少ないと説明されている。一方、方法: 型の値の等価性を定義する (C# プログラミング ガイド)では==/!=演算子をオーバーロードすることが推奨されている。矛盾しているようにも思え非常に混乱するが、前者は値オブジェクト以外でEquals()をオーバーライドすることを想定しているように読める。値オブジェクト以外ならば本記事中で説明しているように==/!=演算子をオーバーロードすべきでないが、そもそも値オブジェクト以外でEquals()をオーバーライドすべきでなく、良い設計へ導くためのガイドラインとしては不適切ではないだろうか。\"\u003e2\u003c/a\u003e\u003c/sup\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003e不変型\u003c/strong\u003e\u003cstrong\u003eで値以外を表す\u003c/strong\u003e: \u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装しない方が無難だが、実装するなら\u003ccode\u003eEquals()\u003c/code\u003e・\u003ccode\u003eGetHashCode()\u003c/code\u003eを実装し、\u003ccode\u003e==\u003c/code\u003e/\u003ccode\u003e!=\u003c/code\u003e演算子は実装しない\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"構造体でのガイドライン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%A7%E3%81%AE%E3%82%AC%E3%82%A4%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e構造体でのガイドライン\u003c/h3\u003e\n\n\u003cp\u003e構造体は値型であり、既定の\u003ccode\u003eEquals()\u003c/code\u003eでは同値性判定が行われます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e可変型\u003c/strong\u003e: \u003ca href=\"https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/struct\" rel=\"nofollow noopener\" target=\"_blank\"\u003e構造体は不変型にすべき\u003c/a\u003eなので検討外\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003e不変型\u003c/strong\u003e: 常に\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装して、\u003ccode\u003eEquals()\u003c/code\u003e・\u003ccode\u003eGetHashCode()\u003c/code\u003e・\u003ccode\u003e==\u003c/code\u003e/\u003ccode\u003e!=\u003c/code\u003e演算子を全て実装する\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"実装方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装方法\u003c/h3\u003e\n\n\u003cp\u003eVisual Studio 2017では\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;.Equals(T)\u003c/code\u003e・\u003ccode\u003eObject.Equals(Object)\u003c/code\u003eのオーバーライド・\u003ccode\u003eGetHashCode()\u003c/code\u003e・\u003ccode\u003e==\u003c/code\u003e/\u003ccode\u003e!=\u003c/code\u003e演算子を全て\u003ca href=\"https://docs.microsoft.com/en-us/visualstudio/ide/reference/generate-equals-gethashcode-methods?view=vs-2017\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cstrong\u003e自動生成\u003c/strong\u003eできるようになりました\u003c/a\u003e（\u003ca href=\"https://www.jetbrains.com/help/resharper/Code_Generation__Equality_Members.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eReSharperでもできます\u003c/a\u003e）。バグを埋め込まないよう、原則として手書きではなく自動生成するのが良いでしょう。本記事では自動生成する前提で、詳細なコーディングについては省略します。\u003c/p\u003e\n\n\u003cp\u003e※VSCodeでの生成方法がもしあれば教えてください。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"完全に理解する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%8C%E5%85%A8%E3%81%AB%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e完全に理解する\u003c/h1\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"iequatabletを実装するメリット\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#iequatablet%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装するメリット\u003c/h3\u003e\n\n\u003cp\u003e等価性判定のカスタマイズを考えた時、そもそも全てのクラス・構造体には\u003ccode\u003eObject\u003c/code\u003eクラスで定義された\u003ccode\u003eObject.Equals(Object)\u003c/code\u003eが既にあります。これを単にオーバーライドするだけと、\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;.Equals(T)\u003c/code\u003eを実装するのとでは何が違うのでしょうか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eObject\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eObject\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIEquatable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;.Equals(T)\u003c/code\u003eでは無関係な型との等価性判定という意味のないコード（おそらく書き間違い）をコンパイルエラーとして検出できます。\u003c/li\u003e\n\u003cli\u003e構造体に対して\u003ccode\u003eObject.Equals(Object)\u003c/code\u003eを呼び出すと\u003ccode\u003eObject\u003c/code\u003e型へキャストすることによるボックス化\u003csup id=\"fnref3\"\u003e\u003ca href=\"#fn3\" title=\"ボックス化とは、値型のインスタンスを参照型の入れ物にコピーして、参照型として扱えるようにすること。値型を参照型の変数に代入したりキャストしたりすると発生する。\"\u003e3\u003c/a\u003e\u003c/sup\u003eが発生します。また既定で構造体用にオーバーライド済みの\u003ccode\u003eValueType.Equals(Object)\u003c/code\u003eの実装は、リフレクションにより同値性判定を行う\u003csup id=\"fnref4\"\u003e\u003ca href=\"#fn4\" title=\"リフレクションとは、型自体の情報を取得すること。参照型のメンバを含まない場合リフレクションは発生せず高速に動作するが、メンテナンス性の観点からもIEquatable\u0026lt;T\u0026gt;を実装しておいた方が良いだろう。また、リフレクションによる同値性判定ではすべてのフィールド・プロパティの比較が行われるが、構造体が意味する値に期待される挙動とは異なる可能性がある。\"\u003e4\u003c/a\u003e\u003c/sup\u003eため、非常に時間がかかってしまいます。これを避けるために\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを常に実装します。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eObject.Equals(Object)\u003c/code\u003eを呼び出すと、\u003ccode\u003eObject\u003c/code\u003e型を経由した仮想メソッド呼び出しになりパラメータのキャストが必要です。型付けされた\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;.Equals(T)\u003c/code\u003eを呼び出すのに比べ、若干ですが余計なコストがかかります。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e念のため\u003ca href=\"https://gist.github.com/cactuaroid/5106f3e45d2b1494238e421e85a3668d\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちらのコードで\u003c/a\u003eパフォーマンス比較してみました。\u003csup id=\"fnref5\"\u003e\u003ca href=\"#fn5\" title=\"生成されたIEquatable\u0026lt;T\u0026gt;.Equals(T)のnullチェックが!=演算子を使用しているため、!=演算子も生成してあると同値性判定になってしまい遅いのでis nullに書き換えて計測した。修正依頼済みで、マイルストーンに含まれているのでそのうち直る？（Issue #31283）。\"\u003e5\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eMethod\u003c/th\u003e\n\u003cth style=\"text-align: right\"\u003eMean\u003c/th\u003e\n\u003cth style=\"text-align: right\"\u003eError\u003c/th\u003e\n\u003cth style=\"text-align: right\"\u003eStdDev\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e'構造体 Object.Equals(Object) 既定'\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e419.431 ns\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e1.1720 ns\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e1.0963 ns\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e'構造体 Object.Equals(Object) オーバーライド'\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e9.504 ns\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.0675 ns\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.0631 ns\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e'構造体 IEquatable\u0026lt;T\u0026gt;.Equals(T) 直接呼出し'\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e2.464 ns\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.0136 ns\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.0128 ns\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e'構造体 IEquatable\u0026lt;T\u0026gt;.Equals(T) インターフェース呼び出し'\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e3.462 ns\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.0171 ns\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.0160 ns\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e'クラス Object.Equals(Object) オーバーライド'\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e4.106 ns\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.0263 ns\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.0246 ns\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e'クラス IEquatable\u0026lt;T\u0026gt;.Equals(T) 直接呼出し'\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e2.519 ns\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.0123 ns\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.0115 ns\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e'クラス IEquatable\u0026lt;T\u0026gt;.Equals(T) インターフェース呼び出し'\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e2.955 ns\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.0112 ns\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.0105 ns\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e構造体・クラス共にIEquatable.Equals(T)直接呼出しが最も速く、次いで\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;.Equals(T)\u003c/code\u003eインターフェース呼び出し、\u003ccode\u003eObject.Equals(Object)\u003c/code\u003e仮想メソッド呼び出しの順となり、構造体の既定実装であるリフレクションは2桁遅い結果となりました。\u003c/p\u003e\n\n\u003cp\u003eこのようにパフォーマンス上の理由があるため、\u003ccode\u003eDictionary\u0026lt;TKey, TValue\u0026gt;\u003c/code\u003eや\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eといった多くのクラスの等価性判定を伴う処理では、\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装している型については\u003ccode\u003eObject.Equals(Object)\u003c/code\u003eではなく\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;.Equals(T)\u003c/code\u003eを呼ぶように最適化されています。\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装するデメリットは特にないので、\u003ccode\u003eEquals()\u003c/code\u003eをオーバーライドしたいなら常に\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装することをお勧めします。\u003c/p\u003e\n\n\u003cp\u003eなお、\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装する場合、以下のように\u003ccode\u003eObject.Equals(Object)\u003c/code\u003eは定型パターンでオーバーライドして\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;.Equals(T)\u003c/code\u003eを呼び出すようにします（自動生成されます）。本記事中ではこれらを特に区別せず\u003ccode\u003eEquals()\u003c/code\u003eと表現します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Object.Equals(Object)のオーバーライド\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eMyClass\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyClass\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// IEquatable\u0026lt;T\u0026gt;.Equals(T)の実装\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 比較処理\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eref.\u003cbr\u003e\n\u003ca href=\"https://stackoverflow.com/questions/2734914/whats-the-difference-between-iequatable-and-just-overriding-object-equals\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWhat's the difference between IEquatable and just overriding Object.Equals()?\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"値を表さないクラスにiequatabletを実装しないほうが良いワケ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%80%A4%E3%82%92%E8%A1%A8%E3%81%95%E3%81%AA%E3%81%84%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%ABiequatablet%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%AA%E3%81%84%E3%81%BB%E3%81%86%E3%81%8C%E8%89%AF%E3%81%84%E3%83%AF%E3%82%B1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e値を表さないクラスに\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装しないほうが良いワケ\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eクラスに\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装するということは\u003ccode\u003eEquals()\u003c/code\u003eを同値性判定でオーバーライドすることを意味します。これは「このクラスの等価性とは同値性のことだ」と宣言することになります。なぜ同値性判定が分かりやすく有用なのかというと、値を表すクラスだからです。\u003c/li\u003e\n\u003cli\u003e値を表さないクラスでも\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装したり\u003ccode\u003eEquals()\u003c/code\u003eをオーバーライドできますが、避けた方が無難でしょう。代わりに例えば、\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装せず\u003ccode\u003eEquals()\u003c/code\u003eよりも説明的な名前で同値性判定メソッドを定義する\u003csup id=\"fnref6\"\u003e\u003ca href=\"#fn6\" title=\"StringBuilderにはEquals()があり内部の文字列の同値性を比較できるが、これを悪い例として紹介する。可変型なのでIEquatable\u0026lt;T\u0026gt;は実装されていないしObject.Equals()もGetHashCode()もオーバーライドされていないのでルール違反ではないが、この挙動が直観と一致する人はどれだけいるのだろうか。例えばValueEquals()という名前だったらはるかに分かりやすく混乱しなかっただろう。\"\u003e6\u003c/a\u003e\u003c/sup\u003eという手があります。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"可変型クラスにiequatabletを実装してはいけないワケ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%AF%E5%A4%89%E5%9E%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%ABiequatablet%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%AF%E3%81%84%E3%81%91%E3%81%AA%E3%81%84%E3%83%AF%E3%82%B1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e可変型クラスに\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装してはいけないワケ\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e2つのインスタンスについて\u003ccode\u003eEquals()\u003c/code\u003eが\u003ccode\u003etrue\u003c/code\u003eを返すなら\u003ccode\u003eGetHashCode()\u003c/code\u003eが返すハッシュ値も同じでなければなりません\u003csup id=\"fnref7\"\u003e\u003ca href=\"#fn7\" title=\"2つのインスタンスのハッシュ値が同じであってもEquals()がtrueを返すとは限らない。ハッシュ値の等価性はインスタンスの等価性を表すわけではない。\"\u003e7\u003c/a\u003e\u003c/sup\u003e。ハッシュ値を利用する辞書などでは\u003ccode\u003eEquals()\u003c/code\u003eと\u003ccode\u003eGetHashCode()\u003c/code\u003eの両方が使用されており、このルールを破ると期待通りに動作しません。\u003ccode\u003eEquals()\u003c/code\u003eをオーバーライドする場合はその動作に合わせて\u003ccode\u003eGetHashCode()\u003c/code\u003eもオーバーライドする必要があります。\u003c/li\u003e\n\u003cli\u003eハッシュ値はインスタンスの生存期間中、不変でなければなりません。もし辞書に登録しておいたインスタンスのハッシュ値が変わると行方不明になってしまいます。したがって、可変型では\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装してはいけません。\u003c/li\u003e\n\u003cli\u003e可変型で同値性判定が必要な場合は、\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装せずに普通のメソッドとして実装してください。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e辞書等に入れないなら可変型クラスに\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装していいのか？\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eそのクラスのハッシュ値が永久に絶対に使われないと言い切るのは大変難しいです。原則として避けてください。パフォーマンスチューニングなどやむを得ない事情で原則に違反した実装をする場合、クラスの可視性を制限したりコメントで注意喚起するなど十分警戒してください。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e値を表す不変型はプリミティブ型のように簡単に扱うことができ、\u003cstrong\u003e値オブジェクト\u003c/strong\u003eと呼ばれます。ここまでをまとめると、値オブジェクトには\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装し、値オブジェクトでなければ\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eは実装しない方が無難ということになります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"値を表さないクラスに演算子を実装しないほうが良いワケ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%80%A4%E3%82%92%E8%A1%A8%E3%81%95%E3%81%AA%E3%81%84%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AB%E6%BC%94%E7%AE%97%E5%AD%90%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%AA%E3%81%84%E3%81%BB%E3%81%86%E3%81%8C%E8%89%AF%E3%81%84%E3%83%AF%E3%82%B1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e値を表さないクラスに\u003ccode\u003e==\u003c/code\u003e/\u003ccode\u003e!=\u003c/code\u003e演算子を実装しないほうが良いワケ\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e演算子による演算結果は自明でなければなりません。例えば\u003ccode\u003eString\u003c/code\u003eクラスでは\u003ccode\u003e\"abc\" + \"def\"\u003c/code\u003eは結合されることが自明ですし、\u003ccode\u003e\"abc\" == \"abc\"\u003c/code\u003eは\u003ccode\u003etrue\u003c/code\u003eになることが自明です。値以外を表すクラスで演算子をオーバーロードしてしまうと、演算結果が自明ではなくなってしまいます。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e==\u003c/code\u003e/\u003ccode\u003e!=\u003c/code\u003e演算子は、値の比較では同値性判定、値以外の比較では同一性判定が期待されます。構造体は値を意味しますが、クラスは値を表すことも、値以外を表すこともあります。値以外を表すクラスで\u003ccode\u003e==\u003c/code\u003e/\u003ccode\u003e!=\u003c/code\u003e演算子をオーバーロードして同値性判定にしてしまうと期待と動作が一致しません。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e例えば\u003ccode\u003eStringBuilder\u003c/code\u003eクラス\u003csup id=\"fnref6\"\u003e\u003ca href=\"#fn6\" title=\"StringBuilderにはEquals()があり内部の文字列の同値性を比較できるが、これを悪い例として紹介する。可変型なのでIEquatable\u0026lt;T\u0026gt;は実装されていないしObject.Equals()もGetHashCode()もオーバーライドされていないのでルール違反ではないが、この挙動が直観と一致する人はどれだけいるのだろうか。例えばValueEquals()という名前だったらはるかに分かりやすく混乱しなかっただろう。\"\u003e6\u003c/a\u003e\u003c/sup\u003eを考えると\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebuilder1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStringBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebuilder2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStringBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuilder1\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ebuilder2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \"false\" もしこれが内部状態を比較してtrueになったとすると直感に反する\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e一方で、参照型であっても値を表す不変なクラスであれば、値型と同等に\u003ccode\u003e==\u003c/code\u003e/\u003ccode\u003e!=\u003c/code\u003e演算子で比較できると直感に一致します。例えば構造体である\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/api/system.guid\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGuid\u003c/a\u003eとクラスである\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/api/system.version\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVersion\u003c/a\u003eは同じ感覚で使えます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eguid1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eguid2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eguid1\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eguid2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \"true\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eversion1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"1.0.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eversion2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"1.0.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eversion1\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eversion2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \"true\" もしこれがfalseになったとすると直感に反する\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eref.\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/operator-overloads\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOperator Overloads\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/csharp/programming-guide/statements-expressions-operators/how-to-define-value-equality-for-a-type\" rel=\"nofollow noopener\" target=\"_blank\"\u003e方法: 型の値の等価性を定義する (C# プログラミング ガイド)\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"http://www.atmarkit.co.jp/ait/articles/1802/28/news028.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e==演算子とEqualsメソッドの違いとは？［C#］\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"継承でのiequatabletに注意\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B6%99%E6%89%BF%E3%81%A7%E3%81%AEiequatablet%E3%81%AB%E6%B3%A8%E6%84%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e継承での\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eに注意\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eMyBase\u003c/code\u003eクラスと、その派生クラス\u003ccode\u003eMySub\u003c/code\u003eがあったとします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emyBase1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyBase\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emyBase2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMySub\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eMyBase\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emyBase1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emyBase2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// MyBase.Equals()で期待通りに判定されますか？\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emyBase1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMySub\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eMyBase\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emyBase2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMySub\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eMyBase\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emyBase1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emyBase2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// MyBase.Equals()で期待通りに判定されますか？\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eEquals()\u003c/code\u003eに期待される動作は何でしょうか。基底クラスの情報だけで同値性判定すべきなのか、派生クラスの情報も含めるべきなのか、クラスの意味と等価性判定する文脈によって異なり、そのどちらを期待するかも人によって異なるでしょう。\u003c/p\u003e\n\n\u003cp\u003e継承関係にあるクラスの同値性判定には意味が自明ではないケースがあります。\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装するかわりに\u003ccode\u003eEquals()\u003c/code\u003eよりも説明的な名前のメソッドを別に用意することを検討してください。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"配列等に注意\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%85%8D%E5%88%97%E7%AD%89%E3%81%AB%E6%B3%A8%E6%84%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e配列等に注意\u003c/h3\u003e\n\n\u003cp\u003e例えば配列をメンバに含むクラスの場合、\u003ccode\u003eEquals()\u003c/code\u003eはどう判定すべきでしょうか。配列の各要素それぞれについての同値性判定が期待されるはずです。しかしVisual StudioもReSharperも自動生成された\u003ccode\u003eEquals()\u003c/code\u003eはそのような実装になっておらず、配列自体を比較してしまいますので、配列の要素が同値であっても\u003ccode\u003efalse\u003c/code\u003eになってしまいます。これを解決するには手で書き換える必要があります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eValues\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyClass\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n           \u003cspan class=\"c1\"\u003e// EqualityComparer\u0026lt;string[]\u0026gt;.Default.Equals(Value, other.Value); 自動生成されたコード\u003c/span\u003e\n           \u003cspan class=\"c1\"\u003e// 期待されるのは要素ごとの同値性判定なので以下のようになる\u003c/span\u003e\n           \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eValues\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValues\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e\n           \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eValues\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValues\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eValues\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSequenceEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValues\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e \n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e配列に限らず\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eを実装するあらゆる型について言えることです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"visual-studioが生成したobjectequalsは型チェックしないの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#visual-studio%E3%81%8C%E7%94%9F%E6%88%90%E3%81%97%E3%81%9Fobjectequals%E3%81%AF%E5%9E%8B%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%97%E3%81%AA%E3%81%84%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVisual Studioが生成した\u003ccode\u003eObject.Equals()\u003c/code\u003eは型チェックしないの？\u003c/h3\u003e\n\n\u003cp\u003eVisual Studioが生成したコードはシンプルにこうなっています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eMyClass\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e一方、MSDNやEffective C#のサンプルやReSharperが生成したコードはこんな感じです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eReferenceEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eReferenceEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eMyClass\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003enullチェックと同一性判定は良いとして、\u003ccode\u003eGetType()\u003c/code\u003eで実行時の型チェックしているところがVisual Studioの生成したコードと大きく違います。以下のコードで動作が異なります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003emyBase\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emySub\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emyBase\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emySub1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 内部でObject.Equals()が呼ばれる\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eVisual Studio版では実行時の型チェックをしないので\u003ccode\u003etrue\u003c/code\u003eになりますが、MSDN版では\u003ccode\u003efalse\u003c/code\u003eになります。ただ、どちらが正しいと言い切るのは難しく、同値性判定で実行時の型チェックが期待されるか？という問題です。これは前項の継承の話と同類の問題なので、そもそもこのコードの違いが動作の違いとして現れる設計は避けたいところです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"gethashcodeのハッシュアルゴリズム\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gethashcode%E3%81%AE%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eGetHashCode()\u003c/code\u003eのハッシュアルゴリズム\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eGetHashCode()\u003c/code\u003eはよく分散したハッシュ値を素早く返すことが求められます。\u003c/p\u003e\n\n\u003cp\u003eXORハッシュ（\u003ccode\u003eValue1.GetHashCode() ^ Value2.GetHashCode()\u003c/code\u003eみたいなの）を目にしたことがあるかもしれませんが、例えば\u003ccode\u003eValue1\u003c/code\u003eと\u003ccode\u003eValue2\u003c/code\u003eの値が同じ場合、値に関わらず計算結果はすべて0になり、結果が偏ってしまうので良くありません。\u003c/p\u003e\n\n\u003cp\u003eVisual Studioが生成する\u003ccode\u003eGetHashCode()\u003c/code\u003eのハッシュアルゴリズムはBernsteinハッシュです。ReSharperならFNVハッシュです。ちなみに\u003ccode\u003eValueTuple\u003c/code\u003eの内部実装では\u003ccode\u003eHashHelpers.Combine()\u003c/code\u003eが使われており、Modified Bernsteinハッシュで実装されています。いずれも十分に分散したハッシュ値を比較的素早く得られるアルゴリズムのようです。\u003c/p\u003e\n\n\u003cp\u003eref.\u003cbr\u003e\n\u003ca href=\"http://eternallyconfuzzled.com/tuts/algorithms/jsw_tut_hashing.aspx\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://eternallyconfuzzled.com/tuts/algorithms/jsw_tut_hashing.aspx\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://stackoverflow.com/questions/263400/what-is-the-best-algorithm-for-an-overridden-system-object-gethashcode\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWhat is the best algorithm for an overridden System.Object.GetHashCode?\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://stackoverflow.com/questions/102742/why-is-397-used-for-resharper-gethashcode-override\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWhy is '397' used for ReSharper GetHashCode override?\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"リファレンス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eリファレンス\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/api/system.object.equals\" rel=\"nofollow noopener\" target=\"_blank\"\u003eObject.Equals Method\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/api/system.valuetype.equals\" rel=\"nofollow noopener\" target=\"_blank\"\u003eValueType.Equals(Object) Method\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/csharp/programming-guide/statements-expressions-operators/equality-comparisons\" rel=\"nofollow noopener\" target=\"_blank\"\u003e等価比較 (C# プログラミング ガイド)\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003e「2つのインスタンスの」等価性・同一性・同値性という書き方が正確だが、\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eは2つのインスタンスを比較するためのインターフェースであり本記事中では文脈から明らかと思われるので省略する。 \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn2\"\u003e\n\u003cp\u003e\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/api/system.object.equals\" rel=\"nofollow noopener\" target=\"_blank\"\u003eObject.Equals Method\u003c/a\u003eやEffective C#によると、\u003ccode\u003eEquals()\u003c/code\u003eをオーバーライドしたとしても\u003ccode\u003e==\u003c/code\u003e/\u003ccode\u003e!=\u003c/code\u003e演算子をオーバーロードすべきケースは非常に少ないと説明されている。一方、\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/csharp/programming-guide/statements-expressions-operators/how-to-define-value-equality-for-a-type\" rel=\"nofollow noopener\" target=\"_blank\"\u003e方法: 型の値の等価性を定義する (C# プログラミング ガイド)\u003c/a\u003eでは\u003ccode\u003e==\u003c/code\u003e/\u003ccode\u003e!=\u003c/code\u003e演算子をオーバーロードすることが推奨されている。矛盾しているようにも思え非常に混乱するが、前者は値オブジェクト以外で\u003ccode\u003eEquals()\u003c/code\u003eをオーバーライドすることを想定しているように読める。値オブジェクト以外ならば本記事中で説明しているように\u003ccode\u003e==\u003c/code\u003e/\u003ccode\u003e!=\u003c/code\u003e演算子をオーバーロードすべきでないが、そもそも値オブジェクト以外で\u003ccode\u003eEquals()\u003c/code\u003eをオーバーライドすべきでなく、良い設計へ導くためのガイドラインとしては不適切ではないだろうか。 \u003ca href=\"#fnref2\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn3\"\u003e\n\u003cp\u003eボックス化とは、値型のインスタンスを参照型の入れ物にコピーして、参照型として扱えるようにすること。値型を参照型の変数に代入したりキャストしたりすると発生する。 \u003ca href=\"#fnref3\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn4\"\u003e\n\u003cp\u003eリフレクションとは、型自体の情報を取得すること。参照型のメンバを含まない場合リフレクションは発生せず高速に動作するが、メンテナンス性の観点からも\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eを実装しておいた方が良いだろう。また、リフレクションによる同値性判定ではすべてのフィールド・プロパティの比較が行われるが、構造体が意味する値に期待される挙動とは異なる可能性がある。 \u003ca href=\"#fnref4\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn5\"\u003e\n\u003cp\u003e生成された\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;.Equals(T)\u003c/code\u003eのnullチェックが\u003ccode\u003e!=\u003c/code\u003e演算子を使用しているため、\u003ccode\u003e!=\u003c/code\u003e演算子も生成してあると同値性判定になってしまい遅いので\u003ccode\u003eis null\u003c/code\u003eに書き換えて計測した。修正依頼済みで、マイルストーンに含まれているのでそのうち直る？（\u003ca href=\"https://github.com/dotnet/roslyn/issues/31283\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIssue #31283\u003c/a\u003e）。 \u003ca href=\"#fnref5\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn6\"\u003e\n\u003cp\u003e\u003ccode\u003eStringBuilder\u003c/code\u003eには\u003ccode\u003eEquals()\u003c/code\u003eがあり内部の文字列の同値性を比較できるが、これを悪い例として紹介する。可変型なので\u003ccode\u003eIEquatable\u0026lt;T\u0026gt;\u003c/code\u003eは実装されていないし\u003ccode\u003eObject.Equals()\u003c/code\u003eも\u003ccode\u003eGetHashCode()\u003c/code\u003eもオーバーライドされていないのでルール違反ではないが、この挙動が直観と一致する人はどれだけいるのだろうか。例えば\u003ccode\u003eValueEquals()\u003c/code\u003eという名前だったらはるかに分かりやすく混乱しなかっただろう。 \u003ca href=\"#fnref6\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn7\"\u003e\n\u003cp\u003e2つのインスタンスのハッシュ値が同じであっても\u003ccode\u003eEquals()\u003c/code\u003eが\u003ccode\u003etrue\u003c/code\u003eを返すとは限らない。ハッシュ値の等価性はインスタンスの等価性を表すわけではない。 \u003ca href=\"#fnref7\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","createdAt":"2018-12-08T15:30:06Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"zYYVoSR/8RuH4iRGr1luBowW7kVzjnjd--IZnQvcxlGkZ0L4Mx--rrpXqbLGmvCy7TjylJW/QQ==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-09-25T13:23:20Z","likesCount":111,"linkUrl":"https://qiita.com/cactuaroid/items/f277a097ecf51eb247c0","organization":null,"originalId":735854,"stockedCount":87,"title":"IEquatableを完全に理解する","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%9C%AC%E8%A8%98%E4%BA%8B%E4%B8%AD%E3%81%AE%E7%94%A8%E8%AA%9E\"\u003e本記事中の用語\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7%E3%81%AE%E3%82%AC%E3%82%A4%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3\"\u003eクラスでのガイドライン\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%A7%E3%81%AE%E3%82%AC%E3%82%A4%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3\"\u003e構造体でのガイドライン\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85%E6%96%B9%E6%B3%95\"\u003e実装方法\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%8C%E5%85%A8%E3%81%AB%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B\"\u003e完全に理解する\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#iequatablet%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88\"\u003eIEquatable\u0026lt;T\u0026gt;を実装するメリット\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%80%A4%E3%82%92%E8%A1%A8%E3%81%95%E3%81%AA%E3%81%84%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%ABiequatablet%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%AA%E3%81%84%E3%81%BB%E3%81%86%E3%81%8C%E8%89%AF%E3%81%84%E3%83%AF%E3%82%B1\"\u003e値を表さないクラスにIEquatable\u0026lt;T\u0026gt;を実装しないほうが良いワケ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%AF%E5%A4%89%E5%9E%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%ABiequatablet%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%AF%E3%81%84%E3%81%91%E3%81%AA%E3%81%84%E3%83%AF%E3%82%B1\"\u003e可変型クラスにIEquatable\u0026lt;T\u0026gt;を実装してはいけないワケ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%80%A4%E3%82%92%E8%A1%A8%E3%81%95%E3%81%AA%E3%81%84%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AB%E6%BC%94%E7%AE%97%E5%AD%90%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%AA%E3%81%84%E3%81%BB%E3%81%86%E3%81%8C%E8%89%AF%E3%81%84%E3%83%AF%E3%82%B1\"\u003e値を表さないクラスに==/!=演算子を実装しないほうが良いワケ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B6%99%E6%89%BF%E3%81%A7%E3%81%AEiequatablet%E3%81%AB%E6%B3%A8%E6%84%8F\"\u003e継承でのIEquatable\u0026lt;T\u0026gt;に注意\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%85%8D%E5%88%97%E7%AD%89%E3%81%AB%E6%B3%A8%E6%84%8F\"\u003e配列等に注意\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#visual-studio%E3%81%8C%E7%94%9F%E6%88%90%E3%81%97%E3%81%9Fobjectequals%E3%81%AF%E5%9E%8B%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%97%E3%81%AA%E3%81%84%E3%81%AE\"\u003eVisual Studioが生成したObject.Equals()は型チェックしないの？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#gethashcode%E3%81%AE%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0\"\u003eGetHashCode()のハッシュアルゴリズム\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9\"\u003eリファレンス\u003c/a\u003e\n\u003c/li\u003e\n\n","totalPv":17844,"uuid":"f277a097ecf51eb247c0","banReason":null,"adventCalendarItem":{"day":9,"calendar":{"name":"C#","urlName":"c-sharp","year":2018,"organization":null}},"author":{"encryptedId":"JwlF853uCzhnzZFv8YXJVxYBuK6F--QGcNI/d5Ehk4ZybL--06Ox0BWsvJynSZl96qPP7g==","originalId":256657,"description":"","facebookUrl":null,"githubUrl":"https://github.com/cactuaroid","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://avatars0.githubusercontent.com/u/17759160?v=4","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F17759160%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=9bab253f75626e3daefc369adb0beb8d","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F17759160%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=7760d477201b632ef2560f220a53558a","urlName":"cactuaroid","websiteUrl":null,"twitterUrl":"https://twitter.com/cactuaroid","twitterUrlName":"cactuaroid","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

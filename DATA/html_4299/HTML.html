<!DOCTYPE html><html><head><meta charset="utf-8" /><title>サーバーレスでsftpファイル転送 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/tsukashusan/items/239bfa161dbc958f7232" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="LzjWrPlF7syU+fGBXD3b8MKiCipifVzU9Wty/drNM7DB8rDb7jB1FqzfGWcMArmo7nqixZf0HwrsS9mEMmWgjw==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="サーバーレスでsftpファイル転送 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEsxNDRPODQ0T1E0NE84NDRPczQ0SzU0NEduYzJaMGNPT0RsZU9Db2VPQ3BPT0RxLWk3b3VtQWdRJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTk0NDY5YzZmMmYwYjcxYzZmYjNmOWIyYWE5YzNiMDBj&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJ6ZFd0aGMyaDFjMkZ1JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9OTA3NGUyMDNjZDE1NzJhMzNlMTM2ZWY2MmE5ZWQzZTI&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=4b6ae92cffcea858fd09115373b85df4"><meta property="og:description" content="

AzureBlobStorageからsftpを使ってファイル転送

こちらの記事は、Qiita に掲載した Microsoft Azure Tech Advent Calendar 2018 の企画に基づき、執筆した 内容となりま..."><meta content="https://qiita.com/tsukashusan/items/239bfa161dbc958f7232" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Azure,.NETCore,AzureFunctions,AzureEventGrid" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-77ab3f85-2385-4393-90d8-4d40e3b3c14e"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Ftsukashusan%2Fitems%2F239bfa161dbc958f7232">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Ftsukashusan%2Fitems%2F239bfa161dbc958f7232">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-77ab3f85-2385-4393-90d8-4d40e3b3c14e">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-12-02T15:45:12.000+09:00","dateModified":"2018-12-02T15:50:53.000+09:00","headline":"サーバーレスでsftpファイル転送","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEsxNDRPODQ0T1E0NE84NDRPczQ0SzU0NEduYzJaMGNPT0RsZU9Db2VPQ3BPT0RxLWk3b3VtQWdRJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTk0NDY5YzZmMmYwYjcxYzZmYjNmOWIyYWE5YzNiMDBj\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJ6ZFd0aGMyaDFjMkZ1JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9OTA3NGUyMDNjZDE1NzJhMzNlMTM2ZWY2MmE5ZWQzZTI\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=4b6ae92cffcea858fd09115373b85df4","mainEntityOfPage":"https://qiita.com/tsukashusan/items/239bfa161dbc958f7232","author":{"@type":"Person","address":"Tokyo, Japan","email":"shtsukam@outlook.com","identifier":"tsukashusan","name":"tsukashusan","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fprofile-images%2F1498546125?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=901f859c945fb9c521336704804bab4b","url":"https://qiita.com/tsukashusan","description":"日本マイクロソフト株式会社でパートナーさん向けのクラウドソリューションアーキテクトという仕事をしております!","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202106-uzabase-3/">社員の行動の基盤となるユーザベースのミッション・バリュー</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202106-uzabase-3/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tsukashusan","type":"items","id":"239bfa161dbc958f7232"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"社員の行動の基盤となるユーザベースのミッション・バリュー","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tsukashusan","type":"items","id":"239bfa161dbc958f7232"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"社員の行動の基盤となるユーザベースのミッション・バリュー","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tsukashusan","type":"items","id":"239bfa161dbc958f7232"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"社員の行動の基盤となるユーザベースのミッション・バリュー","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/tsukashusan/items/239bfa161dbc958f7232","location":"/tsukashusan/items/239bfa161dbc958f7232","scheme":"https","host":"qiita.com","port":null,"pathname":"/tsukashusan/items/239bfa161dbc958f7232","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"DEENUK007Rtw/HRXVUhs8NIUkXAuqUIR7bXesEi1dM7ii2snukF2wUjanLEFdw6o/sw5n9sgAc/0lXXJoB3n8Q==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-f75dcfff-3e29-4954-848b-e40e5df4028e"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tsukashusan/items/239bfa161dbc958f7232/likers" class="css-1iupg5d">5</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">5</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/239bfa161dbc958f7232/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tsukashusan/items/239bfa161dbc958f7232/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tsukashusan/items/239bfa161dbc958f7232/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tsukashusan/items/239bfa161dbc958f7232/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tsukashusan/items/239bfa161dbc958f7232.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><span><a href="/advent-calendar/2018/microsoft-azure-tech" class="it-AdcalRibbon_title">Microsoft Azure Tech<!-- --> Advent Calendar<!-- --> <!-- -->2018</a>Day 2</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/tsukashusan"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/167352/profile-images/1498546125" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/tsukashusan" class="css-10ougpm">@<!-- -->tsukashusan</a><div class="css-1ay9vb9"><span><meta content="2018-12-02T06:45:12Z"/><time dateTime="2018-12-02T06:50:53Z" class="css-m19uds">updated at 2018-12-02</time></span></div></div></div></div></div><h1 class="css-cgzq40">サーバーレスでsftpファイル転送</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/azure" class="css-4czcte">Azure</a><a href="/tags/.netcore" class="css-4czcte">.NETCore</a><a href="/tags/azurefunctions" class="css-4czcte">AzureFunctions</a><a href="/tags/azureeventgrid" class="css-4czcte">AzureEventGrid</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="azureblobstorageからsftpを使ってファイル転送" class="fragment"></span><a href="#azureblobstorage%E3%81%8B%E3%82%89sftp%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E8%BB%A2%E9%80%81"><i class="fa fa-link"></i></a>AzureBlobStorageからsftpを使ってファイル転送</h1>

<p>こちらの記事は、Qiita に掲載した <a href="https://qiita.com/advent-calendar/2018/microsoft-azure-tech" title="Microsoft Azure Tech Advent Calendar 2018">Microsoft Azure Tech Advent Calendar 2018</a> の企画に基づき、執筆した 内容となります。(2 日目)</p>

<p>Azure Functionsを使ってAzure BlobStorageのアップロードしたファイルを直ちにSFTPサーバーへアップロードするコードを書いてみました。<br>
勿論、最新版の<strong>Functions 2.0</strong><code>C#</code>を使って書きますよ。</p>

<h2>
<span id="functionsのプロジェクト作成" class="fragment"></span><a href="#functions%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>Functionsのプロジェクト作成</h2>

<h3>
<span id="portalへfunctionsをデプロイ" class="fragment"></span><a href="#portal%E3%81%B8functions%E3%82%92%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4"><i class="fa fa-link"></i></a>PortalへFunctionsをデプロイ</h3>

<p>ポチポチとFunctions作りますよ。</p>

<h4>
<span id="まずはここから" class="fragment"></span><a href="#%E3%81%BE%E3%81%9A%E3%81%AF%E3%81%93%E3%81%93%E3%81%8B%E3%82%89"><i class="fa fa-link"></i></a>まずはここから、</h4>

<p><a href="https://camo.qiitausercontent.com/6b4cc1a753166809aadee268373471878ee8ac4a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f65613931663565352d616136372d366533372d306362632d3234623137363534333261392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fea91f5e5-aa67-6e37-0cbc-24b1765432a9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8a6014ff0f55ac75b86f70a77c1ce859" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/ea91f5e5-aa67-6e37-0cbc-24b1765432a9.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fea91f5e5-aa67-6e37-0cbc-24b1765432a9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=32a41792d708b86c596cc2dd0f561801 1x" loading="lazy"></a></p>

<p><code>Function</code>と入力して、<br>
<a href="https://camo.qiitausercontent.com/526b7ffe2861d912baed11e20fa91548dfee301a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f33623434383737302d633736302d643466362d343465652d3135373733643532373266362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F3b448770-c760-d4f6-44ee-15773d5272f6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=72fc62738c9f63bbd9d5582584e86238" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/3b448770-c760-d4f6-44ee-15773d5272f6.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F3b448770-c760-d4f6-44ee-15773d5272f6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a79bdd020d1fdb08e8e23bdaad52678d 1x" loading="lazy"></a><br>
<code>Functions App</code>を選択</p>

<p><a href="https://camo.qiitausercontent.com/bd2ee8b47d13905947cfceca7778dd466e5d81ee/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f37393964643162332d383662632d363063372d353638302d3937393538643233346561382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F799dd1b3-86bc-60c7-5680-97958d234ea8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0074fa16831c461abe875f6baad20c49" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/799dd1b3-86bc-60c7-5680-97958d234ea8.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F799dd1b3-86bc-60c7-5680-97958d234ea8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0aeb1bfbcb0ff0087e8a3b53790d8bbc 1x" loading="lazy"></a><br>
<code>作成</code>を押下</p>

<p><strong>リージョン</strong>,<strong>ランタイム</strong>を選んでポチっと<br>
<a href="https://camo.qiitausercontent.com/f9fd6f6174badc4f12b0c49af6aa37093a1e397d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f66383735643939362d646239342d366338622d666431312d3336343135336634646130652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Ff875d996-db94-6c8b-fd11-364153f4da0e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=02fab3ae83bb6556a910bf89b02c1e18" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/f875d996-db94-6c8b-fd11-364153f4da0e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Ff875d996-db94-6c8b-fd11-364153f4da0e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=12a288ec483790c45d98f4a80ecee950 1x" loading="lazy"></a></p>

<p>立ち上がりました。簡単ですね。<br>
<a href="https://camo.qiitausercontent.com/e8855229c56688cbd6bec6f8e0a61e55bbe4f2cc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f36336665663064372d356637302d343832352d323934632d6234333435343239353735632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F63fef0d7-5f70-4825-294c-b4345429575c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=893255f284de0e72df263bc5c3e8c29f" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/63fef0d7-5f70-4825-294c-b4345429575c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F63fef0d7-5f70-4825-294c-b4345429575c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d3f4925f84e51b7f542152d48e2ef91b 1x" loading="lazy"></a><br>
ここでこのまま<code>Visula Editor</code>で作成もできますが、<br>
今回は地味ですが、BlobからダウンロードしたファイルをSFTPで別のサーバーにアップロードするプログラムなので、<code>Visual Studio</code>で作成してみます。</p>

<h4>
<span id="visual-studioでfunctionsを作成" class="fragment"></span><a href="#visual-studio%E3%81%A7functions%E3%82%92%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a><code>Visual Studio</code>で<code>Functions</code>を作成</h4>

<p>新規作成-&gt;プロジェクト<br>
<a href="https://camo.qiitausercontent.com/895f35f57b06b04694ff3eb5f5475c9a566a66fb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f61376262383732622d333666332d386139332d613564632d6564366665383465346539652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fa7bb872b-36f3-8a93-a5dc-ed6fe84e4e9e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f81d908aa8541ab31433e6d9bcc666fa" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/a7bb872b-36f3-8a93-a5dc-ed6fe84e4e9e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fa7bb872b-36f3-8a93-a5dc-ed6fe84e4e9e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f922c03ad5b29fbdd32f53df6bbf6fb7 1x" loading="lazy"></a></p>

<p><code>Azure Functions</code>を選択<br>
<a href="https://camo.qiitausercontent.com/b8085236f7076775a4ce8e0fdea7f30c34c7e0f9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f39623338333438652d656532322d313665652d353637372d6634343837313234353464642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F9b38348e-ee22-16ee-5677-f448712454dd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=49db6225299541e31526f3563b31df22" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/9b38348e-ee22-16ee-5677-f448712454dd.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F9b38348e-ee22-16ee-5677-f448712454dd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1ad0964afbd2399f5305a4864e576a12 1x" loading="lazy"></a></p>

<p><code>Azure Functions V2</code>、<code>Http trigger</code>を選択、<br>
<a href="https://camo.qiitausercontent.com/42f3eaa91f41a2eb18583796af5940f057a7c177/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f34613032326131322d373235312d313038382d376663342d3234373463353036303032302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F4a022a12-7251-1088-7fc4-2474c5060020.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a14692013197d67226d80cb4c699cd8a" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/4a022a12-7251-1088-7fc4-2474c5060020.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F4a022a12-7251-1088-7fc4-2474c5060020.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=56d1b286cf4121ff8a16295a09a1ad23 1x" loading="lazy"></a></p>

<p>ストレージアカウントは任意のものを選択します。<br>
<a href="https://camo.qiitausercontent.com/ebad3e1d76c04364f5f791ad7b7114419893060a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f62396461666634312d383233302d333039382d376535332d3861633337313136303537372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fb9daff41-8230-3098-7e53-8ac371160577.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9223112fafd9f40fd04ef4979c2a3e46" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/b9daff41-8230-3098-7e53-8ac371160577.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fb9daff41-8230-3098-7e53-8ac371160577.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=115654202b045385872ddbcd96e4daae 1x" loading="lazy"></a></p>

<p>作成完了!<br>
<a href="https://camo.qiitausercontent.com/1b5253ef1bcd24478ebe17d3784b011260002ff4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f65653432613836312d396530332d376538642d653730312d3166326264356366323231632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fee42a861-9e03-7e8d-e701-1f2bd5cf221c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0104f6d124b838408b04adfa624e2778" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/ee42a861-9e03-7e8d-e701-1f2bd5cf221c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fee42a861-9e03-7e8d-e701-1f2bd5cf221c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c4a855384106b6ec70085e4fd0cb4ebe 1x" loading="lazy"></a></p>

<p>まずは<code>デプロイ</code>してみます。<br>
<code>発行</code>を押下し、<br>
<a href="https://camo.qiitausercontent.com/01314428b59e646283f848d5b8208567f747cec0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f31383466666238632d386330322d356566332d623466332d3036616634373133356666332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F184ffb8c-8c02-5ef3-b4f3-06af47135ff3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0d833bc81655b27152f1ba010bd748ef" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/184ffb8c-8c02-5ef3-b4f3-06af47135ff3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F184ffb8c-8c02-5ef3-b4f3-06af47135ff3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9caeaf1c710696beffc9ceb2eac1438a 1x" loading="lazy"></a></p>

<p><code>既存のものを選択</code>、<code>発行</code>を押下する。<br>
<a href="https://camo.qiitausercontent.com/0474fecd8b642bf67148e39d99166f4940e5296a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f30643164633834622d633231352d363636612d383165322d3964373731343866376139352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F0d1dc84b-c215-666a-81e2-9d77148f7a95.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9d9b78c8783856ea08e44d72273c03c9" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/0d1dc84b-c215-666a-81e2-9d77148f7a95.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F0d1dc84b-c215-666a-81e2-9d77148f7a95.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=bff644b09fc9657c1da6f40d0d99245f 1x" loading="lazy"></a></p>

<p>先ほど<code>Azure</code>で作成した、<code>Functions</code>が選択できます。<br>
<a href="https://camo.qiitausercontent.com/be0b261229b480c2ce51c4a239c7b9f08ecf8a4c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f31353034653165362d616461322d323663642d363535372d6563613232346636353666652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F1504e1e6-ada2-26cd-6557-eca224f656fe.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3150730a7eb632eac3c119e65227eff0" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/1504e1e6-ada2-26cd-6557-eca224f656fe.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F1504e1e6-ada2-26cd-6557-eca224f656fe.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=44ae4ca2c238199ffc893633ffa5864d 1x" loading="lazy"></a></p>

<p>くるくる発行中のプロセスが回り、<br>
<a href="https://camo.qiitausercontent.com/258294588d020d0ae41a47497c7b05a23c2a8dbe/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f64653334653138652d386133362d333038372d663730312d6162376562386630393432382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fde34e18e-8a36-3087-f701-ab7eb8f09428.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8db6144827b9e6acdd4e5f6665cf9e28" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/de34e18e-8a36-3087-f701-ab7eb8f09428.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fde34e18e-8a36-3087-f701-ab7eb8f09428.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0cc1b327aed229a5acd5dfa53e8b5e56 1x" loading="lazy"></a></p>

<p>無事発行完了です😊<br>
<a href="https://camo.qiitausercontent.com/ccd05a9ac204c33cf005dd1374fd7a428a7e2f88/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f33373137373362652d323266362d316564332d333738392d6166366263623637363833372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F371773be-22f6-1ed3-3789-af6bcb676837.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=aace76ab0004c0f5bcd9ea8a4880a279" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/371773be-22f6-1ed3-3789-af6bcb676837.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F371773be-22f6-1ed3-3789-af6bcb676837.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=df3efc364449cda88fce5f424d638be7 1x" loading="lazy"></a></p>

<p>早速見てましょう。<br>
<code>Azure Portal</code>にログインしてみます。<br>
先ほどの<code>blob2sftp.dll</code>で<code>Functions</code>が生成されていることがわかります。<br>
<a href="https://camo.qiitausercontent.com/131ab9a322f07bdf6ca8f3278ccea83834900f81/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f63336462383539302d356532352d343562342d613962342d3464343435383363313931622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fc3db8590-5e25-45b4-a9b4-4d44583c191b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=cdb71763ff8ad85f197ff4a5d1ce5bec" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/c3db8590-5e25-45b4-a9b4-4d44583c191b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fc3db8590-5e25-45b4-a9b4-4d44583c191b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=40ce51b8341347a49fd8ce62644d78f3 1x" loading="lazy"></a></p>

<p>ちょっとした<code>Azure</code>の<strong>便利</strong>機能です。<br>
画面を見てみると、右側に<code>テスト</code>がありますね。<br>
<a href="https://camo.qiitausercontent.com/d0dd343e7664bd25a84b37724c96c0012f44ca6b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f36363132323835612d613135312d373533302d363665622d3965326534353238366138632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F6612285a-a151-7530-66eb-9e2e45286a8c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=56a91fe87ed570c63c3075ea4a8735f6" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/6612285a-a151-7530-66eb-9e2e45286a8c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F6612285a-a151-7530-66eb-9e2e45286a8c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=80eb5a68de0506682f3e615bacfd41be 1x" loading="lazy"></a><br>
そうなんです。<code>Http Trigger</code>ですので、今回作成したFunctionsは<code>Webhook</code>のになりますが、そのテストが<code>Portal</code>だけでできるんですね。<code>CURL</code>や、<code>Postman</code>でテストする必要がないですね。</p>

<h2>
<span id="implementation実装" class="fragment"></span><a href="#implementation%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>Implementation(実装)</h2>

<p>これで実装開始です。<br>
私個人的には実装とデバック(他人の)の仕事が大好きです。<br>
wktkしながら実装します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>実装の手順は簡単ですね。
1.Azure Blobのイベント情報を取得ダウンロード
2.ダウンロードしたファイルをSFTPでアップロード
</code></pre></div></div>

<p>Blobをダウンロードのロジックをダイジェストで解説</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span> <span class="n">requestBody</span> <span class="p">=</span> <span class="k">await</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="n">Body</span><span class="p">).</span><span class="nf">ReadToEndAsync</span><span class="p">();</span>
<span class="c1">//dynamicで型が取れるのはC#は便利ですねー</span>
<span class="kt">dynamic</span> <span class="n">data</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">DeserializeObject</span><span class="p">(</span><span class="n">requestBody</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">data0</span> <span class="p">=</span> <span class="n">data</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>

<span class="c1">//BlobのURLを解析は少し厄介です...</span>
<span class="kt">var</span> <span class="n">url</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="n">data0</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">url</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
<span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="n">url</span><span class="p">.</span><span class="n">AbsolutePath</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">'/'</span><span class="p">)[</span><span class="m">1</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">startIndex</span> <span class="p">=</span> <span class="s">"/"</span><span class="p">.</span><span class="n">Length</span> <span class="p">+</span> <span class="n">container</span><span class="p">.</span><span class="n">Length</span> <span class="p">+</span> <span class="s">"/"</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">length</span> <span class="p">=</span> <span class="n">url</span><span class="p">.</span><span class="n">AbsolutePath</span><span class="p">.</span><span class="n">Length</span> <span class="p">-</span> <span class="n">startIndex</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">blobname</span> <span class="p">=</span> <span class="n">url</span><span class="p">.</span><span class="n">AbsolutePath</span><span class="p">.</span><span class="nf">Substring</span><span class="p">(</span><span class="n">startIndex</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">blobNameArray</span> <span class="p">=</span> <span class="n">blobname</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">'/'</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">blobFileName</span> <span class="p">=</span> <span class="n">blobNameArray</span><span class="p">[</span><span class="n">blobNameArray</span><span class="p">.</span><span class="n">Length</span> <span class="p">-</span> <span class="m">1</span><span class="p">];</span>
<span class="kt">var</span> <span class="n">tempPath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">GetTempPath</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">tempFilePath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">Combine</span><span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="nf">GetTempPath</span><span class="p">(),</span> <span class="n">blobFileName</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">accountName</span> <span class="p">=</span> <span class="n">url</span><span class="p">.</span><span class="n">Host</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">'.'</span><span class="p">)[</span><span class="m">0</span><span class="p">];</span>
<span class="k">const</span> <span class="kt">string</span> <span class="n">accessKey</span> <span class="p">=</span> <span class="s">"&lt;Blob AccessKey&gt;"</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">credential</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StorageCredentials</span><span class="p">(</span><span class="n">accountName</span><span class="p">,</span> <span class="n">accessKey</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">storageAccount</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CloudStorageAccount</span><span class="p">(</span><span class="n">credential</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="c1">//blob</span>
<span class="n">CloudBlobClient</span> <span class="n">blobClient</span> <span class="p">=</span> <span class="n">storageAccount</span><span class="p">.</span><span class="nf">CreateCloudBlobClient</span><span class="p">();</span>
<span class="c1">//container</span>
<span class="n">CloudBlobContainer</span> <span class="n">blobcontainer</span> <span class="p">=</span> <span class="n">blobClient</span><span class="p">.</span><span class="nf">GetContainerReference</span><span class="p">(</span><span class="n">container</span><span class="p">);</span>
<span class="c1">//ダウンロードするファイル名を指定</span>
<span class="n">CloudBlockBlob</span> <span class="n">blockBlob_download</span> <span class="p">=</span> <span class="n">blobcontainer</span><span class="p">.</span><span class="nf">GetBlockBlobReference</span><span class="p">(</span><span class="n">blobname</span><span class="p">);</span>
<span class="c1">//ダウンロード処理</span>
<span class="c1">//ダウンロード後のパスとファイル名を指定。</span>
<span class="kt">var</span> <span class="n">downloadFile</span> <span class="p">=</span> <span class="s">$"</span><span class="p">{</span><span class="n">tempFilePath</span><span class="p">}</span><span class="s">"</span> <span class="p">;</span>
<span class="k">await</span> <span class="n">blockBlob_download</span><span class="p">.</span><span class="nf">DownloadToFileAsync</span><span class="p">(</span><span class="n">downloadFile</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">FileMode</span><span class="p">.</span><span class="n">OpenOrCreate</span><span class="p">);</span>
<span class="n">log</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"blob download successful."</span><span class="p">);</span>
</code></pre></div></div>

<p>SFTPのアップロードをダイジェクトで紹介</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">//setup client</span>
<span class="c1">//clientを作成して</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SftpClient</span><span class="p">(</span><span class="s">"&lt;SFTPサーバ アドレス&gt;"</span><span class="p">,</span> <span class="s">"&lt;userid&gt;"</span><span class="p">,</span> <span class="s">"&lt;password&gt;"</span><span class="p">))</span>
<span class="p">{</span>
    <span class="n">client</span><span class="p">.</span><span class="nf">Connect</span><span class="p">();</span>
    <span class="c1">// await a file upload</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">localStream</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="nf">OpenRead</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">client</span><span class="p">.</span><span class="nf">ChangeDirectory</span><span class="p">(</span><span class="s">"&lt;アップロードパス&gt;"</span><span class="p">);</span>
        <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">UploadAsync</span><span class="p">(</span><span class="n">localStream</span><span class="p">,</span> <span class="s">$"</span><span class="p">{</span><span class="n">fileName</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="c1">// disconnect like you normally would</span>
        <span class="n">client</span><span class="p">.</span><span class="nf">Disconnect</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>SFTPのモジュールは.NET core標準にはなさそうなので、<br>
を使って実装します。<br>
<a href="https://github.com/JohnTheGr8/Renci.SshNet.Async" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/JohnTheGr8/Renci.SshNet.Async</a></p>

<div class="code-frame" data-lang="powershell"><div class="highlight"><pre class="with-code"><code><span class="n">PM</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Install-Package</span><span class="w"> </span><span class="nx">Renci.SshNet.Async</span><span class="w">
</span></code></pre></div></div>

<p>他のNuGetを入れたとすると、<br>
<code>WindowsAzure.Storage</code>ですね。</p>

<p>で完成です。<br>
これであとはデバックです。<br>
デバックはローカル実行してみます。<br>
<code>Visula Studio</code>は最強の開発環境です。<br>
すぐにデバックもできますね。</p>

<p><a href="https://camo.qiitausercontent.com/34eec0412c662081c29388566a9dd1bacfa14973/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f61663235383530312d656365352d343930312d373166612d6264316662313662343336622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Faf258501-ece5-4901-71fa-bd1fb16b436b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f12660886d2cf501fe20c7792c10b2f5" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/af258501-ece5-4901-71fa-bd1fb16b436b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Faf258501-ece5-4901-71fa-bd1fb16b436b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1d5ab6f90c046f2195da8bfdf3feb0f2 1x" loading="lazy"></a></p>

<p><a href="https://camo.qiitausercontent.com/81c808aae79527279ea4b55467fc77e0f06e22e7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f63376635316430342d396434642d623461312d366665342d3139393132353435633836342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fc7f51d04-9d4d-b4a1-6fe4-19912545c864.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=68ad28e19a58b57f3f193a8473e54787" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/c7f51d04-9d4d-b4a1-6fe4-19912545c864.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fc7f51d04-9d4d-b4a1-6fe4-19912545c864.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=058b5aa99b751c603fede6ed4f51f95b 1x" loading="lazy"></a></p>

<p><code>Functions</code>がローカルにhttpで立ち上がります。お世辞抜きに素晴らしいです。<br>
この場合は、<code>Postman</code>でPOSTしてみましょう。</p>

<p><a href="https://camo.qiitausercontent.com/db41bd503029297fc1487de32bff6c71c9743096/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f62316630303763392d643835652d623037612d613863352d3338306532316635633063652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fb1f007c9-d85e-b07a-a8c5-380e21f5c0ce.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b2af848d253f6729d0ef8ec3897f779e" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/b1f007c9-d85e-b07a-a8c5-380e21f5c0ce.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fb1f007c9-d85e-b07a-a8c5-380e21f5c0ce.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=92d361a7ebbdba4ac948dd021f333ee1 1x" loading="lazy"></a></p>

<h3>
<span id="イベントハンドラの登録です" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%81%AE%E7%99%BB%E9%8C%B2%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>イベントハンドラの登録です。</h3>

<p>実装が終わってテストが完了したら、<code>Blob Storage</code>へイベントハンドラの登録です。<br>
ハンドラはStorageアカウントの画面から登録です。<br>
<a href="https://camo.qiitausercontent.com/68bbc3d72166b9c8e80b269bcd5d10e576109a53/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f34333932366530332d346264342d373439652d646662632d3838343234336237376265622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F43926e03-4bd4-749e-dfbc-884243b77beb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6fdfcb3dd7078058eefb8ff7c6348c31" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/43926e03-4bd4-749e-dfbc-884243b77beb.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F43926e03-4bd4-749e-dfbc-884243b77beb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c811dafa31ed52ef54e73dd1841b0228 1x" loading="lazy"></a></p>

<p>その他のオプションからwebhookを選択<br>
<a href="https://camo.qiitausercontent.com/ed20f7d06b398da253d3ffd219a57120ac707ac0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f38613435656531362d366632392d663930642d333264312d6564376632343661336534642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F8a45ee16-6f29-f90d-32d1-ed7f246a3e4d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6c3d32dc65a041ed4a81f7c3a10fa3a7" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/8a45ee16-6f29-f90d-32d1-ed7f246a3e4d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F8a45ee16-6f29-f90d-32d1-ed7f246a3e4d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4e56734eac14ee23b20e8b7101f5ef49 1x" loading="lazy"></a></p>

<p>エンドポイントのタイプをwebhookに選択し、エンドポイントを選択します。<br>
イベント サブスクリプションの詳細、名前<code>任意</code>、イベントのスキーマ―は<code>イベント グリッド スキーマ</code><br>
サブスクライバー エンドポイントで<code>FunctionsのURL</code>を入力します。<br>
<a href="https://camo.qiitausercontent.com/9e53e242abd8ca275a2007d2f710ae9845215f05/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f37303637633865372d653939352d306437302d636262312d3730393531623936303732352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F7067c8e7-e995-0d70-cbb1-70951b960725.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7b01af4f63eb198908ed4f6ec15a14f8" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/7067c8e7-e995-0d70-cbb1-70951b960725.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F7067c8e7-e995-0d70-cbb1-70951b960725.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=216b97a6b82103e5f1ca27b7b131fc38 1x" loading="lazy"></a></p>

<p><code>作成</code>を押下すると、<br>
設定がはじまりますwktk<br>
<a href="https://camo.qiitausercontent.com/f62484ea2ff9c9d2a0a0ad4aca4885f485dbf1d1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f62613266623762372d663363362d636336322d356238342d3764343631323165333762362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fba2fb7b7-f3c6-cc62-5b84-7d46121e37b6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7b200674347fd610c0ec9b1dd52fbcfc" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/ba2fb7b7-f3c6-cc62-5b84-7d46121e37b6.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fba2fb7b7-f3c6-cc62-5b84-7d46121e37b6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=dbdfe1ed2f131aa08cdb466b64eeba78 1x" loading="lazy"></a></p>

<p>ｶﾞ━━(ﾟдﾟ；)━━ﾝ!! <br>
<a href="https://camo.qiitausercontent.com/6866dd33752b6d27ec3ad387e090300b66f4890e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f64393530636231302d663838612d353936342d353736662d3363633861343964333432372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fd950cb10-f88a-5964-576f-3cc8a49d3427.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c2d3028f43281241d17e7459d62f9a38" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/d950cb10-f88a-5964-576f-3cc8a49d3427.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fd950cb10-f88a-5964-576f-3cc8a49d3427.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5cb26e6843e3343d6256a1a166dccf07 1x" loading="lazy"></a></p>

<h4>
<span id="ハマリポイント" class="fragment"></span><a href="#%E3%83%8F%E3%83%9E%E3%83%AA%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>ハマリポイント①</h4>

<p>来ました。<br>
しかも通知で出るメッセージと後から見るメッセージが違うのも何とも😥</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre class="with-code"><code>デプロイが次のエラーで失敗しました: <span class="o">{</span><span class="s2">"code"</span>:<span class="s2">"Url validation"</span>,<span class="s2">"message"</span>:<span class="s2">"The attempt to validate the provided endpoint https://blob2sftp.azurewebsites.net/api/Function1 failed. For more details, visit https://aka.ms/esvalidation."</span><span class="o">}</span>

デプロイが次のエラーで失敗しました: <span class="o">{</span><span class="s2">"code"</span>:<span class="s2">"Provider Registration"</span>,<span class="s2">"message"</span>:<span class="s2">"The Microsoft.EventGrid resource provider is not registered in subscription 11a6b8e7-8fbc-4fe3-b887-3209d285cfad. To resolve this, register the provider in the subscription and retry the operation."</span><span class="o">}</span>
</code></pre></div></div>

<p>結局調査の過程は割愛しますが、以下のページの初めのエラーメッセージある、<br>
<a href="https://aka.ms/esvalidation" class="autolink" rel="nofollow noopener" target="_blank">https://aka.ms/esvalidation</a></p>

<p>日本語詳細サイト<br>
<a href="https://docs.microsoft.com/ja-jp/azure/event-grid/security-authentication#validation-details" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/azure/event-grid/security-authentication#validation-details</a><br>
へアクセスし確認して解決できました。</p>

<h5>
<span id="結論" class="fragment"></span><a href="#%E7%B5%90%E8%AB%96"><i class="fa fa-link"></i></a>結論</h5>

<p>以下のwebhookは以下のリクエストのJSONを返し、検証する必要があるようです。</p>

<p>リクエスト</p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre class="with-code"><code><span class="p">[{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2d1781af-3a4c-4d7c-bd0c-e34b19da4e66"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"topic"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"subject"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"validationCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;ここの値をオウム返しする&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"validationUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://rp-eastus2.eventgrid.azure.net:553/eventsubscriptions/estest/validate?id=B2E34264-7D71-453A-B5FB-B62D0FDC85EE&amp;t=2018-04-26T20:30:54.4538837Z&amp;apiVersion=2018-05-01-preview&amp;token=1BNqCxBBSSE9OnNSfZM4%2b5H9zDegKMY6uJ%2fO2DFRkwQ%3d"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"eventType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.EventGrid.SubscriptionValidationEvent"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"eventTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-01-25T22:12:19.4556811Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"metadataVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"dataVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
</span><span class="p">}]</span><span class="w">
</span></code></pre></div></div>

<p>結果応答</p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre class="with-code"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"validationResponse"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;Requestから取得&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>なるほど。<br>
一旦以下のように関数を修正して、発行してみます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">log</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"C# HTTP trigger function processed a request."</span><span class="p">);</span>
<span class="kt">string</span> <span class="n">requestBody</span> <span class="p">=</span> <span class="k">await</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="n">Body</span><span class="p">).</span><span class="nf">ReadToEndAsync</span><span class="p">();</span>
<span class="kt">dynamic</span> <span class="n">data</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">DeserializeObject</span><span class="p">(</span><span class="n">requestBody</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">data0</span> <span class="p">=</span> <span class="n">data</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
<span class="k">try</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">validationCode</span> <span class="p">=</span> <span class="n">data</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">data</span><span class="p">.</span><span class="n">validationCode</span><span class="p">;</span>
    <span class="kt">string</span> <span class="n">s</span> <span class="p">=</span> <span class="n">validationCode</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
    <span class="kt">var</span> <span class="n">r</span> <span class="p">=</span> <span class="s">$"</span><span class="p">{{</span><span class="err">\</span><span class="s">"validationResponse\":\"{validationCode}\"}}"</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">validationCode</span> <span class="p">!=</span> <span class="k">null</span>
        <span class="p">?</span> <span class="p">(</span><span class="n">ActionResult</span><span class="p">)</span><span class="k">new</span> <span class="nf">OkObjectResult</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">new</span> <span class="nf">BadRequestObjectResult</span><span class="p">(</span><span class="s">"Please pass a name on the query string or in the request body"</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">log</span><span class="p">.</span><span class="nf">LogCritical</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">return</span> <span class="p">(</span><span class="n">ActionResult</span><span class="p">)</span><span class="k">new</span> <span class="nf">OkObjectResult</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
</code></pre></div></div>

<p>ｶﾞ━━(ﾟдﾟ；)━━ﾝ!! <br>
<a href="https://camo.qiitausercontent.com/2a173c279e0f5ce37b612fb111f7422fa48c0c65/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f33633565613736652d643837372d643230632d383533392d6661646239653331663831352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F3c5ea76e-d877-d20c-8539-fadb9e31f815.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=376bb087c3909b6ac54f19b60b676d55" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/3c5ea76e-d877-d20c-8539-fadb9e31f815.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F3c5ea76e-d877-d20c-8539-fadb9e31f815.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=066c359877d078288f6be64a35d4d021 1x" loading="lazy"></a></p>

<h4>
<span id="ハマリポイント-1" class="fragment"></span><a href="#%E3%83%8F%E3%83%9E%E3%83%AA%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88-1"><i class="fa fa-link"></i></a>ハマリポイント②</h4>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>C:\Program Files\dotnet\sdk\2.1.402\Sdks\Microsoft.NET.Sdk.Publish\build\netstandard1.0\PublishTargets\Microsoft.NET.Sdk.Publish.MSDeploy.targets(139,5): error : Web deployment task failed. (発行先にあるファイル 'blob2sftp.dll' は、外部プロセスによってロックされているため変更できません。発行操作を正常に完了するには、アプリケーションを再起動してロックを解除するか、.Net アプリケーションに対する AppOffline 規則ハンドラーを次回の発行時に使用する必要があります。  詳細情報の参照先: http://go.microsoft.com/fwlink/?LinkId=221672#ERROR_FILE_IN_USE) [C:\Users\shtsukam\source\repos\blob2sftp\blob2sftp\blob2sftp.csproj]
  Publish failed to deploy.
</code></pre></div></div>

<p>無論、これくらいで挫けてはいけないです。<br>
ちゃんと調べると載ってます。<br>
<a href="https://github.com/projectkudu/kudu/wiki/Dealing-with-locked-files-during-deployment#for-msdeploy-there-is-another-option-to-rename-locked-files" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/projectkudu/kudu/wiki/Dealing-with-locked-files-during-deployment#for-msdeploy-there-is-another-option-to-rename-locked-files</a></p>

<p>アプリケーション設定に以下の設定が必要でした。<br>
<code>MSDEPLOY_RENAME_LOCKED_FILES=1</code></p>

<p><a href="https://camo.qiitausercontent.com/d3f796aad8edce835a314a87837a55f603e893a1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f39383263306637312d633333612d623963662d616638612d3263636534666465303830372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F982c0f71-c33a-b9cf-af8a-2cce4fde0807.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4158e886b081a6810c688aaea3828a2a" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/982c0f71-c33a-b9cf-af8a-2cce4fde0807.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F982c0f71-c33a-b9cf-af8a-2cce4fde0807.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a43e0aec59cb843875cd3a6cc1394df7 1x" loading="lazy"></a></p>

<h5>
<span id="気を取り直して発行" class="fragment"></span><a href="#%E6%B0%97%E3%82%92%E5%8F%96%E3%82%8A%E7%9B%B4%E3%81%97%E3%81%A6%E7%99%BA%E8%A1%8C"><i class="fa fa-link"></i></a>気を取り直して発行</h5>

<p><a href="https://camo.qiitausercontent.com/9170594627fc757912d1feb184d22b47d3c1eca1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f38646139356334372d653939622d643939302d643864632d3231626130656365386132322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F8da95c47-e99b-d990-d8dc-21ba0ece8a22.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b6d95b69e7e06fff93082bb6c16bf742" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/8da95c47-e99b-d990-d8dc-21ba0ece8a22.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F8da95c47-e99b-d990-d8dc-21ba0ece8a22.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0f46267e2818760fbc4297e980acb3c3 1x" loading="lazy"></a></p>

<p>無事完了</p>

<h5>
<span id="改めてイベント登録" class="fragment"></span><a href="#%E6%94%B9%E3%82%81%E3%81%A6%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>改めてイベント登録</h5>

<p>完了<br>
<a href="https://camo.qiitausercontent.com/456eeb3d01d4bc6f819fbd358b96cbb866550570/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f38343936663039652d636437342d646639342d653230642d6137366162656663373566622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F8496f09e-cd74-df94-e20d-a76abefc75fb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=733136589282068bc6f81c080cacf164" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/8496f09e-cd74-df94-e20d-a76abefc75fb.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F8496f09e-cd74-df94-e20d-a76abefc75fb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0e5bcf86af7d425c49b41058e47aa666 1x" loading="lazy"></a></p>

<h3>
<span id="blob2sftpのロジックを張り付ける" class="fragment"></span><a href="#blob2sftp%E3%81%AE%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E3%82%92%E5%BC%B5%E3%82%8A%E4%BB%98%E3%81%91%E3%82%8B"><i class="fa fa-link"></i></a>blob2sftpのロジックを張り付ける</h3>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="p">[</span><span class="nf">FunctionName</span><span class="p">(</span><span class="s">"Function1"</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">updatesftp</span><span class="p">(</span>
    <span class="p">[</span><span class="nf">HttpTrigger</span><span class="p">(</span><span class="n">AuthorizationLevel</span><span class="p">.</span><span class="n">Function</span><span class="p">,</span> <span class="s">"get"</span><span class="p">,</span> <span class="s">"post"</span><span class="p">,</span> <span class="n">Route</span> <span class="p">=</span> <span class="k">null</span><span class="p">)]</span> <span class="n">HttpRequest</span> <span class="n">req</span><span class="p">,</span>
    <span class="n">ILogger</span> <span class="n">log</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">log</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"C# HTTP trigger function processed a request."</span><span class="p">);</span>
    <span class="kt">string</span> <span class="n">requestBody</span> <span class="p">=</span> <span class="k">await</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="n">Body</span><span class="p">).</span><span class="nf">ReadToEndAsync</span><span class="p">();</span>
    <span class="kt">dynamic</span> <span class="n">data</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">DeserializeObject</span><span class="p">(</span><span class="n">requestBody</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">data0</span> <span class="p">=</span> <span class="n">data</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">url</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="n">data0</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">url</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
        <span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="n">url</span><span class="p">.</span><span class="n">AbsolutePath</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">'/'</span><span class="p">)[</span><span class="m">1</span><span class="p">];</span>
        <span class="kt">int</span> <span class="n">startIndex</span> <span class="p">=</span> <span class="s">"/"</span><span class="p">.</span><span class="n">Length</span> <span class="p">+</span> <span class="n">container</span><span class="p">.</span><span class="n">Length</span> <span class="p">+</span> <span class="s">"/"</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">length</span> <span class="p">=</span> <span class="n">url</span><span class="p">.</span><span class="n">AbsolutePath</span><span class="p">.</span><span class="n">Length</span> <span class="p">-</span> <span class="n">startIndex</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">blobname</span> <span class="p">=</span> <span class="n">url</span><span class="p">.</span><span class="n">AbsolutePath</span><span class="p">.</span><span class="nf">Substring</span><span class="p">(</span><span class="n">startIndex</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">blobNameArray</span> <span class="p">=</span> <span class="n">blobname</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">'/'</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">blobFileName</span> <span class="p">=</span> <span class="n">blobNameArray</span><span class="p">[</span><span class="n">blobNameArray</span><span class="p">.</span><span class="n">Length</span> <span class="p">-</span> <span class="m">1</span><span class="p">];</span>
        <span class="kt">var</span> <span class="n">tempPath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">GetTempPath</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">tempFilePath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">Combine</span><span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="nf">GetTempPath</span><span class="p">(),</span> <span class="n">blobFileName</span><span class="p">);</span>
        <span class="c1">//blob</span>
        <span class="n">CloudBlobClient</span> <span class="n">blobClient</span> <span class="p">=</span> <span class="n">storageAccount</span><span class="p">.</span><span class="nf">CreateCloudBlobClient</span><span class="p">();</span>
        <span class="c1">//container</span>
        <span class="kt">var</span> <span class="n">containername</span> <span class="p">=</span> <span class="n">url</span><span class="p">.</span><span class="n">Host</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">'.'</span><span class="p">)[</span><span class="m">0</span><span class="p">];</span>
        <span class="n">CloudBlobContainer</span> <span class="n">blobcontainer</span> <span class="p">=</span> <span class="n">blobClient</span><span class="p">.</span><span class="nf">GetContainerReference</span><span class="p">(</span><span class="n">containername</span><span class="p">);</span>
        <span class="c1">//ダウンロードするファイル名を指定</span>
        <span class="n">CloudBlockBlob</span> <span class="n">blockBlob_download</span> <span class="p">=</span> <span class="n">blobcontainer</span><span class="p">.</span><span class="nf">GetBlockBlobReference</span><span class="p">(</span><span class="n">blobname</span><span class="p">);</span>
        <span class="c1">//ダウンロード処理</span>
        <span class="c1">//ダウンロード後のパスとファイル名を指定。</span>
        <span class="kt">var</span> <span class="n">downloadFile</span> <span class="p">=</span> <span class="s">$"</span><span class="p">{</span><span class="n">tempFilePath</span><span class="p">}</span><span class="s">"</span> <span class="p">;</span>
        <span class="k">await</span> <span class="n">blockBlob_download</span><span class="p">.</span><span class="nf">DownloadToFileAsync</span><span class="p">(</span><span class="n">downloadFile</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">FileMode</span><span class="p">.</span><span class="n">OpenOrCreate</span><span class="p">);</span>
        <span class="n">log</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"blob download successful."</span><span class="p">);</span>

        <span class="k">await</span> <span class="nf">UploadSFTP</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">downloadFile</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">blobFileName</span><span class="p">,</span> <span class="n">log</span><span class="p">);</span>
        <span class="n">File</span><span class="p">.</span><span class="nf">Delete</span><span class="p">(</span><span class="n">downloadFile</span><span class="p">);</span>
        <span class="n">log</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"sftp upload successful."</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">log</span><span class="p">.</span><span class="nf">LogCritical</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ActionResult</span><span class="p">)</span><span class="k">new</span> <span class="nf">OkObjectResult</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">UploadSFTP</span><span class="p">(</span><span class="kt">string</span> <span class="n">filePath</span><span class="p">,</span> <span class="kt">string</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">ILogger</span> <span class="n">log</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//setup client</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SftpClient</span><span class="p">(</span><span class="s">"&lt;ホストIP or FQDN&gt;"</span><span class="p">,</span> <span class="s">"&lt;ユーザ&gt;"</span><span class="p">,</span> <span class="s">"&lt;パスワード&gt;"</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">client</span><span class="p">.</span><span class="nf">Connect</span><span class="p">();</span>
        <span class="c1">// await a file upload</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">localStream</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="nf">OpenRead</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">client</span><span class="p">.</span><span class="nf">ChangeDirectory</span><span class="p">(</span><span class="s">"/home/ubuntu/sftp"</span><span class="p">);</span>
            <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">UploadAsync</span><span class="p">(</span><span class="n">localStream</span><span class="p">,</span> <span class="s">$"</span><span class="p">{</span><span class="n">fileName</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="c1">// disconnect like you normally would</span>
            <span class="n">client</span><span class="p">.</span><span class="nf">Disconnect</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>発行</p>

<h3>
<span id="試験" class="fragment"></span><a href="#%E8%A9%A6%E9%A8%93"><i class="fa fa-link"></i></a>試験</h3>

<h4>
<span id="blobストレージの状態" class="fragment"></span><a href="#blob%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8%E3%81%AE%E7%8A%B6%E6%85%8B"><i class="fa fa-link"></i></a>Blobストレージの状態</h4>

<p>空っぽですね<br>
<a href="https://camo.qiitausercontent.com/6e45610718b080be0fda80bbb7ecad4323389a9d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f31376463656130332d316666312d323266662d366261612d6466306437616162666461622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F17dcea03-1ff1-22ff-6baa-df0d7aabfdab.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=399ac854c611ca8ff80a220ebcb7c9ba" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/17dcea03-1ff1-22ff-6baa-df0d7aabfdab.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F17dcea03-1ff1-22ff-6baa-df0d7aabfdab.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=bdc39cb85416e1b270b96d417b67318a 1x" loading="lazy"></a></p>

<h4>
<span id="sftpサーバの状態" class="fragment"></span><a href="#sftp%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AE%E7%8A%B6%E6%85%8B"><i class="fa fa-link"></i></a>SFTPサーバの状態</h4>

<p>こちらも空っぽ<br>
<a href="https://camo.qiitausercontent.com/ff549e3725c824dacdf975116f9a5ab60dcbbee1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f31336334666561302d363434322d613063632d326532392d3162323731666235626661322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F13c4fea0-6442-a0cc-2e29-1b271fb5bfa2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=20faa2da457a5b8591d0fbe6590cc9de" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/13c4fea0-6442-a0cc-2e29-1b271fb5bfa2.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F13c4fea0-6442-a0cc-2e29-1b271fb5bfa2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ea65172c6aa50bdf103941a043155565 1x" loading="lazy"></a></p>

<h4>
<span id="blobへファイルをアップロード" class="fragment"></span><a href="#blob%E3%81%B8%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>Blobへファイルをアップロード</h4>

<p>testfile1.txtをアップロードしました。<br>
<a href="https://camo.qiitausercontent.com/3a50ec38691dfa0a98c08bf3063dbd2a42ff5085/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f61636537303231372d313432642d336561382d626339632d6262656331313637356365382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Face70217-142d-3ea8-bc9c-bbec11675ce8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0736db5664a5c277bfb161e2c9130e0a" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/ace70217-142d-3ea8-bc9c-bbec11675ce8.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Face70217-142d-3ea8-bc9c-bbec11675ce8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=18c4070790b323585384a853a78a1969 1x" loading="lazy"></a></p>

<p>SFTPのサーバの状態<br>
ヮ─ヾ(#＾∀＾#)ﾉ─ｨ☆彡<br>
アップロードできました🤣<br>
<a href="https://camo.qiitausercontent.com/39286914eb2c4ab3998735686e655e0c1a5f420c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f33643766653765612d383832372d613339642d346562382d6463323231616239303337322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F3d7fe7ea-8827-a39d-4eb8-dc221ab90372.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=cd6c9459d5854ef103790b0b0cb62f3c" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/167352/3d7fe7ea-8827-a39d-4eb8-dc221ab90372.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F3d7fe7ea-8827-a39d-4eb8-dc221ab90372.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f7c60a861a2c5270549c6801fe9da03e 1x" loading="lazy"></a></p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>Functionsを使ってファイル連携のプログラムを作りました。<br>
I/FとしてBlobは大変活用しやすいオブジェクトストレージですね。<br>
Blob+EventGrid+Functionsを使ったサーバーレスシステム間連携は簡単に実現可能です。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Ftsukashusan%2Fitems%2F239bfa161dbc958f7232&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Ftsukashusan%2Fitems%2F239bfa161dbc958f7232&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tsukashusan/items/239bfa161dbc958f7232/likers" class="css-1iupg5d">5</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">5</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/239bfa161dbc958f7232/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tsukashusan/items/239bfa161dbc958f7232/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tsukashusan/items/239bfa161dbc958f7232/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tsukashusan/items/239bfa161dbc958f7232/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tsukashusan/items/239bfa161dbc958f7232.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-f75dcfff-3e29-4954-848b-e40e5df4028e">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-84b73346-951e-4001-b8d7-41d08473cf51"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-84b73346-951e-4001-b8d7-41d08473cf51">{}</script>
      
<div id="LoginModal-react-component-e7593bb8-dc1d-4b68-af27-eab26d8ddfb8"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-e7593bb8-dc1d-4b68-af27-eab26d8ddfb8">{}</script>
      
<div id="StockModal-react-component-3ed519ce-0ce3-4d24-be83-24f86278e1cc"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-3ed519ce-0ce3-4d24-be83-24f86278e1cc">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;YNQogWvd5xagqSA6tyKu3e+Sfx7bkL4+5zQSVZ1/gVKOHk72fKh8zJiPyNznHcyFw0rX8S4Z/eD+FLksddcSbQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"azureblobstorageからsftpを使ってファイル転送\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#azureblobstorage%E3%81%8B%E3%82%89sftp%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E8%BB%A2%E9%80%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAzureBlobStorageからsftpを使ってファイル転送\u003c/h1\u003e\n\n\u003cp\u003eこちらの記事は、Qiita に掲載した \u003ca href=\"https://qiita.com/advent-calendar/2018/microsoft-azure-tech\" title=\"Microsoft Azure Tech Advent Calendar 2018\"\u003eMicrosoft Azure Tech Advent Calendar 2018\u003c/a\u003e の企画に基づき、執筆した 内容となります。(2 日目)\u003c/p\u003e\n\n\u003cp\u003eAzure Functionsを使ってAzure BlobStorageのアップロードしたファイルを直ちにSFTPサーバーへアップロードするコードを書いてみました。\u003cbr\u003e\n勿論、最新版の\u003cstrong\u003eFunctions 2.0\u003c/strong\u003e\u003ccode\u003eC#\u003c/code\u003eを使って書きますよ。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"functionsのプロジェクト作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#functions%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eFunctionsのプロジェクト作成\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"portalへfunctionsをデプロイ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#portal%E3%81%B8functions%E3%82%92%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePortalへFunctionsをデプロイ\u003c/h3\u003e\n\n\u003cp\u003eポチポチとFunctions作りますよ。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"まずはここから\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%9A%E3%81%AF%E3%81%93%E3%81%93%E3%81%8B%E3%82%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまずはここから、\u003c/h4\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/6b4cc1a753166809aadee268373471878ee8ac4a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f65613931663565352d616136372d366533372d306362632d3234623137363534333261392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fea91f5e5-aa67-6e37-0cbc-24b1765432a9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8a6014ff0f55ac75b86f70a77c1ce859\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/ea91f5e5-aa67-6e37-0cbc-24b1765432a9.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fea91f5e5-aa67-6e37-0cbc-24b1765432a9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=32a41792d708b86c596cc2dd0f561801 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eFunction\u003c/code\u003eと入力して、\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/526b7ffe2861d912baed11e20fa91548dfee301a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f33623434383737302d633736302d643466362d343465652d3135373733643532373266362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F3b448770-c760-d4f6-44ee-15773d5272f6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=72fc62738c9f63bbd9d5582584e86238\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/3b448770-c760-d4f6-44ee-15773d5272f6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F3b448770-c760-d4f6-44ee-15773d5272f6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a79bdd020d1fdb08e8e23bdaad52678d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ccode\u003eFunctions App\u003c/code\u003eを選択\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/bd2ee8b47d13905947cfceca7778dd466e5d81ee/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f37393964643162332d383662632d363063372d353638302d3937393538643233346561382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F799dd1b3-86bc-60c7-5680-97958d234ea8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0074fa16831c461abe875f6baad20c49\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/799dd1b3-86bc-60c7-5680-97958d234ea8.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F799dd1b3-86bc-60c7-5680-97958d234ea8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0aeb1bfbcb0ff0087e8a3b53790d8bbc 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ccode\u003e作成\u003c/code\u003eを押下\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eリージョン\u003c/strong\u003e,\u003cstrong\u003eランタイム\u003c/strong\u003eを選んでポチっと\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f9fd6f6174badc4f12b0c49af6aa37093a1e397d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f66383735643939362d646239342d366338622d666431312d3336343135336634646130652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Ff875d996-db94-6c8b-fd11-364153f4da0e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=02fab3ae83bb6556a910bf89b02c1e18\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/f875d996-db94-6c8b-fd11-364153f4da0e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Ff875d996-db94-6c8b-fd11-364153f4da0e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=12a288ec483790c45d98f4a80ecee950 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e立ち上がりました。簡単ですね。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e8855229c56688cbd6bec6f8e0a61e55bbe4f2cc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f36336665663064372d356637302d343832352d323934632d6234333435343239353735632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F63fef0d7-5f70-4825-294c-b4345429575c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=893255f284de0e72df263bc5c3e8c29f\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/63fef0d7-5f70-4825-294c-b4345429575c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F63fef0d7-5f70-4825-294c-b4345429575c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d3f4925f84e51b7f542152d48e2ef91b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nここでこのまま\u003ccode\u003eVisula Editor\u003c/code\u003eで作成もできますが、\u003cbr\u003e\n今回は地味ですが、BlobからダウンロードしたファイルをSFTPで別のサーバーにアップロードするプログラムなので、\u003ccode\u003eVisual Studio\u003c/code\u003eで作成してみます。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"visual-studioでfunctionsを作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#visual-studio%E3%81%A7functions%E3%82%92%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eVisual Studio\u003c/code\u003eで\u003ccode\u003eFunctions\u003c/code\u003eを作成\u003c/h4\u003e\n\n\u003cp\u003e新規作成-\u0026gt;プロジェクト\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/895f35f57b06b04694ff3eb5f5475c9a566a66fb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f61376262383732622d333666332d386139332d613564632d6564366665383465346539652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fa7bb872b-36f3-8a93-a5dc-ed6fe84e4e9e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f81d908aa8541ab31433e6d9bcc666fa\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/a7bb872b-36f3-8a93-a5dc-ed6fe84e4e9e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fa7bb872b-36f3-8a93-a5dc-ed6fe84e4e9e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f922c03ad5b29fbdd32f53df6bbf6fb7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eAzure Functions\u003c/code\u003eを選択\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b8085236f7076775a4ce8e0fdea7f30c34c7e0f9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f39623338333438652d656532322d313665652d353637372d6634343837313234353464642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F9b38348e-ee22-16ee-5677-f448712454dd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=49db6225299541e31526f3563b31df22\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/9b38348e-ee22-16ee-5677-f448712454dd.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F9b38348e-ee22-16ee-5677-f448712454dd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1ad0964afbd2399f5305a4864e576a12 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eAzure Functions V2\u003c/code\u003e、\u003ccode\u003eHttp trigger\u003c/code\u003eを選択、\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/42f3eaa91f41a2eb18583796af5940f057a7c177/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f34613032326131322d373235312d313038382d376663342d3234373463353036303032302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F4a022a12-7251-1088-7fc4-2474c5060020.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a14692013197d67226d80cb4c699cd8a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/4a022a12-7251-1088-7fc4-2474c5060020.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F4a022a12-7251-1088-7fc4-2474c5060020.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=56d1b286cf4121ff8a16295a09a1ad23 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eストレージアカウントは任意のものを選択します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ebad3e1d76c04364f5f791ad7b7114419893060a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f62396461666634312d383233302d333039382d376535332d3861633337313136303537372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fb9daff41-8230-3098-7e53-8ac371160577.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9223112fafd9f40fd04ef4979c2a3e46\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/b9daff41-8230-3098-7e53-8ac371160577.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fb9daff41-8230-3098-7e53-8ac371160577.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=115654202b045385872ddbcd96e4daae 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e作成完了!\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/1b5253ef1bcd24478ebe17d3784b011260002ff4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f65653432613836312d396530332d376538642d653730312d3166326264356366323231632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fee42a861-9e03-7e8d-e701-1f2bd5cf221c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0104f6d124b838408b04adfa624e2778\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/ee42a861-9e03-7e8d-e701-1f2bd5cf221c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fee42a861-9e03-7e8d-e701-1f2bd5cf221c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c4a855384106b6ec70085e4fd0cb4ebe 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eまずは\u003ccode\u003eデプロイ\u003c/code\u003eしてみます。\u003cbr\u003e\n\u003ccode\u003e発行\u003c/code\u003eを押下し、\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/01314428b59e646283f848d5b8208567f747cec0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f31383466666238632d386330322d356566332d623466332d3036616634373133356666332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F184ffb8c-8c02-5ef3-b4f3-06af47135ff3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0d833bc81655b27152f1ba010bd748ef\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/184ffb8c-8c02-5ef3-b4f3-06af47135ff3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F184ffb8c-8c02-5ef3-b4f3-06af47135ff3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9caeaf1c710696beffc9ceb2eac1438a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e既存のものを選択\u003c/code\u003e、\u003ccode\u003e発行\u003c/code\u003eを押下する。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/0474fecd8b642bf67148e39d99166f4940e5296a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f30643164633834622d633231352d363636612d383165322d3964373731343866376139352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F0d1dc84b-c215-666a-81e2-9d77148f7a95.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9d9b78c8783856ea08e44d72273c03c9\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/0d1dc84b-c215-666a-81e2-9d77148f7a95.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F0d1dc84b-c215-666a-81e2-9d77148f7a95.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bff644b09fc9657c1da6f40d0d99245f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e先ほど\u003ccode\u003eAzure\u003c/code\u003eで作成した、\u003ccode\u003eFunctions\u003c/code\u003eが選択できます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/be0b261229b480c2ce51c4a239c7b9f08ecf8a4c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f31353034653165362d616461322d323663642d363535372d6563613232346636353666652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F1504e1e6-ada2-26cd-6557-eca224f656fe.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3150730a7eb632eac3c119e65227eff0\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/1504e1e6-ada2-26cd-6557-eca224f656fe.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F1504e1e6-ada2-26cd-6557-eca224f656fe.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=44ae4ca2c238199ffc893633ffa5864d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eくるくる発行中のプロセスが回り、\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/258294588d020d0ae41a47497c7b05a23c2a8dbe/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f64653334653138652d386133362d333038372d663730312d6162376562386630393432382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fde34e18e-8a36-3087-f701-ab7eb8f09428.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8db6144827b9e6acdd4e5f6665cf9e28\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/de34e18e-8a36-3087-f701-ab7eb8f09428.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fde34e18e-8a36-3087-f701-ab7eb8f09428.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0cc1b327aed229a5acd5dfa53e8b5e56 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e無事発行完了です😊\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ccd05a9ac204c33cf005dd1374fd7a428a7e2f88/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f33373137373362652d323266362d316564332d333738392d6166366263623637363833372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F371773be-22f6-1ed3-3789-af6bcb676837.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=aace76ab0004c0f5bcd9ea8a4880a279\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/371773be-22f6-1ed3-3789-af6bcb676837.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F371773be-22f6-1ed3-3789-af6bcb676837.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=df3efc364449cda88fce5f424d638be7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e早速見てましょう。\u003cbr\u003e\n\u003ccode\u003eAzure Portal\u003c/code\u003eにログインしてみます。\u003cbr\u003e\n先ほどの\u003ccode\u003eblob2sftp.dll\u003c/code\u003eで\u003ccode\u003eFunctions\u003c/code\u003eが生成されていることがわかります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/131ab9a322f07bdf6ca8f3278ccea83834900f81/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f63336462383539302d356532352d343562342d613962342d3464343435383363313931622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fc3db8590-5e25-45b4-a9b4-4d44583c191b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=cdb71763ff8ad85f197ff4a5d1ce5bec\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/c3db8590-5e25-45b4-a9b4-4d44583c191b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fc3db8590-5e25-45b4-a9b4-4d44583c191b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=40ce51b8341347a49fd8ce62644d78f3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eちょっとした\u003ccode\u003eAzure\u003c/code\u003eの\u003cstrong\u003e便利\u003c/strong\u003e機能です。\u003cbr\u003e\n画面を見てみると、右側に\u003ccode\u003eテスト\u003c/code\u003eがありますね。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/d0dd343e7664bd25a84b37724c96c0012f44ca6b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f36363132323835612d613135312d373533302d363665622d3965326534353238366138632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F6612285a-a151-7530-66eb-9e2e45286a8c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=56a91fe87ed570c63c3075ea4a8735f6\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/6612285a-a151-7530-66eb-9e2e45286a8c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F6612285a-a151-7530-66eb-9e2e45286a8c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=80eb5a68de0506682f3e615bacfd41be 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nそうなんです。\u003ccode\u003eHttp Trigger\u003c/code\u003eですので、今回作成したFunctionsは\u003ccode\u003eWebhook\u003c/code\u003eのになりますが、そのテストが\u003ccode\u003ePortal\u003c/code\u003eだけでできるんですね。\u003ccode\u003eCURL\u003c/code\u003eや、\u003ccode\u003ePostman\u003c/code\u003eでテストする必要がないですね。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"implementation実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#implementation%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eImplementation(実装)\u003c/h2\u003e\n\n\u003cp\u003eこれで実装開始です。\u003cbr\u003e\n私個人的には実装とデバック(他人の)の仕事が大好きです。\u003cbr\u003e\nwktkしながら実装します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e実装の手順は簡単ですね。\n1.Azure Blobのイベント情報を取得ダウンロード\n2.ダウンロードしたファイルをSFTPでアップロード\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eBlobをダウンロードのロジックをダイジェストで解説\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003erequestBody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStreamReader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBody\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadToEndAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//dynamicで型が取れるのはC#は便利ですねー\u003c/span\u003e\n\u003cspan class=\"kt\"\u003edynamic\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eJsonConvert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserializeObject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erequestBody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edata0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//BlobのURLを解析は少し厄介です...\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eUri\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econtainer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAbsolutePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003estartIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003econtainer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAbsolutePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003estartIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eblobname\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAbsolutePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubstring\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estartIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eblobNameArray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblobname\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eblobFileName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblobNameArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eblobNameArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etempPath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetTempPath\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etempFilePath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCombine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetTempPath\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003eblobFileName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eaccountName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'.'\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eaccessKey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\u0026lt;Blob AccessKey\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecredential\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStorageCredentials\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaccountName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eaccessKey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estorageAccount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCloudStorageAccount\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecredential\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//blob\u003c/span\u003e\n\u003cspan class=\"n\"\u003eCloudBlobClient\u003c/span\u003e \u003cspan class=\"n\"\u003eblobClient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estorageAccount\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateCloudBlobClient\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//container\u003c/span\u003e\n\u003cspan class=\"n\"\u003eCloudBlobContainer\u003c/span\u003e \u003cspan class=\"n\"\u003eblobcontainer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblobClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetContainerReference\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtainer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//ダウンロードするファイル名を指定\u003c/span\u003e\n\u003cspan class=\"n\"\u003eCloudBlockBlob\u003c/span\u003e \u003cspan class=\"n\"\u003eblockBlob_download\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblobcontainer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBlockBlobReference\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eblobname\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//ダウンロード処理\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//ダウンロード後のパスとファイル名を指定。\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edownloadFile\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003etempFilePath\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eblockBlob_download\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDownloadToFileAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edownloadFile\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIO\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFileMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOpenOrCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLogInformation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"blob download successful.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eSFTPのアップロードをダイジェクトで紹介\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//setup client\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//clientを作成して\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSftpClient\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026lt;SFTPサーバ アドレス\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\u0026lt;userid\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\u0026lt;password\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// await a file upload\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elocalStream\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpenRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efilePath\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eChangeDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026lt;アップロードパス\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUploadAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elocalStream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003efileName\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// disconnect like you normally would\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDisconnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eSFTPのモジュールは.NET core標準にはなさそうなので、\u003cbr\u003e\nを使って実装します。\u003cbr\u003e\n\u003ca href=\"https://github.com/JohnTheGr8/Renci.SshNet.Async\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/JohnTheGr8/Renci.SshNet.Async\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ePM\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eInstall-Package\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eRenci.SshNet.Async\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e他のNuGetを入れたとすると、\u003cbr\u003e\n\u003ccode\u003eWindowsAzure.Storage\u003c/code\u003eですね。\u003c/p\u003e\n\n\u003cp\u003eで完成です。\u003cbr\u003e\nこれであとはデバックです。\u003cbr\u003e\nデバックはローカル実行してみます。\u003cbr\u003e\n\u003ccode\u003eVisula Studio\u003c/code\u003eは最強の開発環境です。\u003cbr\u003e\nすぐにデバックもできますね。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/34eec0412c662081c29388566a9dd1bacfa14973/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f61663235383530312d656365352d343930312d373166612d6264316662313662343336622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Faf258501-ece5-4901-71fa-bd1fb16b436b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f12660886d2cf501fe20c7792c10b2f5\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/af258501-ece5-4901-71fa-bd1fb16b436b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Faf258501-ece5-4901-71fa-bd1fb16b436b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1d5ab6f90c046f2195da8bfdf3feb0f2 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/81c808aae79527279ea4b55467fc77e0f06e22e7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f63376635316430342d396434642d623461312d366665342d3139393132353435633836342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fc7f51d04-9d4d-b4a1-6fe4-19912545c864.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=68ad28e19a58b57f3f193a8473e54787\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/c7f51d04-9d4d-b4a1-6fe4-19912545c864.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fc7f51d04-9d4d-b4a1-6fe4-19912545c864.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=058b5aa99b751c603fede6ed4f51f95b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eFunctions\u003c/code\u003eがローカルにhttpで立ち上がります。お世辞抜きに素晴らしいです。\u003cbr\u003e\nこの場合は、\u003ccode\u003ePostman\u003c/code\u003eでPOSTしてみましょう。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/db41bd503029297fc1487de32bff6c71c9743096/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f62316630303763392d643835652d623037612d613863352d3338306532316635633063652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fb1f007c9-d85e-b07a-a8c5-380e21f5c0ce.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b2af848d253f6729d0ef8ec3897f779e\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/b1f007c9-d85e-b07a-a8c5-380e21f5c0ce.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fb1f007c9-d85e-b07a-a8c5-380e21f5c0ce.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=92d361a7ebbdba4ac948dd021f333ee1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"イベントハンドラの登録です\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%81%AE%E7%99%BB%E9%8C%B2%E3%81%A7%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイベントハンドラの登録です。\u003c/h3\u003e\n\n\u003cp\u003e実装が終わってテストが完了したら、\u003ccode\u003eBlob Storage\u003c/code\u003eへイベントハンドラの登録です。\u003cbr\u003e\nハンドラはStorageアカウントの画面から登録です。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/68bbc3d72166b9c8e80b269bcd5d10e576109a53/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f34333932366530332d346264342d373439652d646662632d3838343234336237376265622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F43926e03-4bd4-749e-dfbc-884243b77beb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6fdfcb3dd7078058eefb8ff7c6348c31\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/43926e03-4bd4-749e-dfbc-884243b77beb.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F43926e03-4bd4-749e-dfbc-884243b77beb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c811dafa31ed52ef54e73dd1841b0228 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eその他のオプションからwebhookを選択\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ed20f7d06b398da253d3ffd219a57120ac707ac0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f38613435656531362d366632392d663930642d333264312d6564376632343661336534642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F8a45ee16-6f29-f90d-32d1-ed7f246a3e4d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6c3d32dc65a041ed4a81f7c3a10fa3a7\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/8a45ee16-6f29-f90d-32d1-ed7f246a3e4d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F8a45ee16-6f29-f90d-32d1-ed7f246a3e4d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4e56734eac14ee23b20e8b7101f5ef49 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eエンドポイントのタイプをwebhookに選択し、エンドポイントを選択します。\u003cbr\u003e\nイベント サブスクリプションの詳細、名前\u003ccode\u003e任意\u003c/code\u003e、イベントのスキーマ―は\u003ccode\u003eイベント グリッド スキーマ\u003c/code\u003e\u003cbr\u003e\nサブスクライバー エンドポイントで\u003ccode\u003eFunctionsのURL\u003c/code\u003eを入力します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/9e53e242abd8ca275a2007d2f710ae9845215f05/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f37303637633865372d653939352d306437302d636262312d3730393531623936303732352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F7067c8e7-e995-0d70-cbb1-70951b960725.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7b01af4f63eb198908ed4f6ec15a14f8\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/7067c8e7-e995-0d70-cbb1-70951b960725.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F7067c8e7-e995-0d70-cbb1-70951b960725.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=216b97a6b82103e5f1ca27b7b131fc38 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e作成\u003c/code\u003eを押下すると、\u003cbr\u003e\n設定がはじまりますwktk\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f62484ea2ff9c9d2a0a0ad4aca4885f485dbf1d1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f62613266623762372d663363362d636336322d356238342d3764343631323165333762362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fba2fb7b7-f3c6-cc62-5b84-7d46121e37b6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7b200674347fd610c0ec9b1dd52fbcfc\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/ba2fb7b7-f3c6-cc62-5b84-7d46121e37b6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fba2fb7b7-f3c6-cc62-5b84-7d46121e37b6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=dbdfe1ed2f131aa08cdb466b64eeba78 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eｶﾞ━━(ﾟдﾟ；)━━ﾝ!! \u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6866dd33752b6d27ec3ad387e090300b66f4890e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f64393530636231302d663838612d353936342d353736662d3363633861343964333432372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fd950cb10-f88a-5964-576f-3cc8a49d3427.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c2d3028f43281241d17e7459d62f9a38\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/d950cb10-f88a-5964-576f-3cc8a49d3427.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fd950cb10-f88a-5964-576f-3cc8a49d3427.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5cb26e6843e3343d6256a1a166dccf07 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"ハマリポイント\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%8F%E3%83%9E%E3%83%AA%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eハマリポイント①\u003c/h4\u003e\n\n\u003cp\u003e来ました。\u003cbr\u003e\nしかも通知で出るメッセージと後から見るメッセージが違うのも何とも😥\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eデプロイが次のエラーで失敗しました: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"code\"\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\"Url validation\"\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\"message\"\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\"The attempt to validate the provided endpoint https://blob2sftp.azurewebsites.net/api/Function1 failed. For more details, visit https://aka.ms/esvalidation.\"\u003c/span\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\nデプロイが次のエラーで失敗しました: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"code\"\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\"Provider Registration\"\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\"message\"\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\"The Microsoft.EventGrid resource provider is not registered in subscription 11a6b8e7-8fbc-4fe3-b887-3209d285cfad. To resolve this, register the provider in the subscription and retry the operation.\"\u003c/span\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e結局調査の過程は割愛しますが、以下のページの初めのエラーメッセージある、\u003cbr\u003e\n\u003ca href=\"https://aka.ms/esvalidation\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://aka.ms/esvalidation\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e日本語詳細サイト\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/azure/event-grid/security-authentication#validation-details\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/azure/event-grid/security-authentication#validation-details\u003c/a\u003e\u003cbr\u003e\nへアクセスし確認して解決できました。\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"結論\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E8%AB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結論\u003c/h5\u003e\n\n\u003cp\u003e以下のwebhookは以下のリクエストのJSONを返し、検証する必要があるようです。\u003c/p\u003e\n\n\u003cp\u003eリクエスト\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"2d1781af-3a4c-4d7c-bd0c-e34b19da4e66\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"topic\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"subject\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"data\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"validationCode\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u0026lt;ここの値をオウム返しする\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"validationUrl\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"https://rp-eastus2.eventgrid.azure.net:553/eventsubscriptions/estest/validate?id=B2E34264-7D71-453A-B5FB-B62D0FDC85EE\u0026amp;t=2018-04-26T20:30:54.4538837Z\u0026amp;apiVersion=2018-05-01-preview\u0026amp;token=1BNqCxBBSSE9OnNSfZM4%2b5H9zDegKMY6uJ%2fO2DFRkwQ%3d\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"eventType\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Microsoft.EventGrid.SubscriptionValidationEvent\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"eventTime\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"2018-01-25T22:12:19.4556811Z\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"metadataVersion\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"dataVersion\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e結果応答\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"validationResponse\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u0026lt;Requestから取得\u0026gt;\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなるほど。\u003cbr\u003e\n一旦以下のように関数を修正して、発行してみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLogInformation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"C# HTTP trigger function processed a request.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003erequestBody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStreamReader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBody\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadToEndAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kt\"\u003edynamic\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eJsonConvert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserializeObject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erequestBody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edata0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"k\"\u003etry\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003evalidationCode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalidationCode\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evalidationCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{{\u003c/span\u003e\u003cspan class=\"err\"\u003e\\\u003c/span\u003e\u003cspan class=\"s\"\u003e\"validationResponse\\\":\\\"{validationCode}\\\"}}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003evalidationCode\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eActionResult\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eOkObjectResult\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBadRequestObjectResult\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Please pass a name on the query string or in the request body\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLogCritical\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eActionResult\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eOkObjectResult\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eｶﾞ━━(ﾟдﾟ；)━━ﾝ!! \u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/2a173c279e0f5ce37b612fb111f7422fa48c0c65/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f33633565613736652d643837372d643230632d383533392d6661646239653331663831352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F3c5ea76e-d877-d20c-8539-fadb9e31f815.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=376bb087c3909b6ac54f19b60b676d55\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/3c5ea76e-d877-d20c-8539-fadb9e31f815.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F3c5ea76e-d877-d20c-8539-fadb9e31f815.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=066c359877d078288f6be64a35d4d021 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"ハマリポイント-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%8F%E3%83%9E%E3%83%AA%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eハマリポイント②\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eC:\\Program Files\\dotnet\\sdk\\2.1.402\\Sdks\\Microsoft.NET.Sdk.Publish\\build\\netstandard1.0\\PublishTargets\\Microsoft.NET.Sdk.Publish.MSDeploy.targets(139,5): error : Web deployment task failed. (発行先にあるファイル 'blob2sftp.dll' は、外部プロセスによってロックされているため変更できません。発行操作を正常に完了するには、アプリケーションを再起動してロックを解除するか、.Net アプリケーションに対する AppOffline 規則ハンドラーを次回の発行時に使用する必要があります。  詳細情報の参照先: http://go.microsoft.com/fwlink/?LinkId=221672#ERROR_FILE_IN_USE) [C:\\Users\\shtsukam\\source\\repos\\blob2sftp\\blob2sftp\\blob2sftp.csproj]\n  Publish failed to deploy.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e無論、これくらいで挫けてはいけないです。\u003cbr\u003e\nちゃんと調べると載ってます。\u003cbr\u003e\n\u003ca href=\"https://github.com/projectkudu/kudu/wiki/Dealing-with-locked-files-during-deployment#for-msdeploy-there-is-another-option-to-rename-locked-files\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/projectkudu/kudu/wiki/Dealing-with-locked-files-during-deployment#for-msdeploy-there-is-another-option-to-rename-locked-files\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eアプリケーション設定に以下の設定が必要でした。\u003cbr\u003e\n\u003ccode\u003eMSDEPLOY_RENAME_LOCKED_FILES=1\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/d3f796aad8edce835a314a87837a55f603e893a1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f39383263306637312d633333612d623963662d616638612d3263636534666465303830372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F982c0f71-c33a-b9cf-af8a-2cce4fde0807.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4158e886b081a6810c688aaea3828a2a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/982c0f71-c33a-b9cf-af8a-2cce4fde0807.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F982c0f71-c33a-b9cf-af8a-2cce4fde0807.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a43e0aec59cb843875cd3a6cc1394df7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"気を取り直して発行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B0%97%E3%82%92%E5%8F%96%E3%82%8A%E7%9B%B4%E3%81%97%E3%81%A6%E7%99%BA%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e気を取り直して発行\u003c/h5\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/9170594627fc757912d1feb184d22b47d3c1eca1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f38646139356334372d653939622d643939302d643864632d3231626130656365386132322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F8da95c47-e99b-d990-d8dc-21ba0ece8a22.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b6d95b69e7e06fff93082bb6c16bf742\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/8da95c47-e99b-d990-d8dc-21ba0ece8a22.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F8da95c47-e99b-d990-d8dc-21ba0ece8a22.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0f46267e2818760fbc4297e980acb3c3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e無事完了\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"改めてイベント登録\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%94%B9%E3%82%81%E3%81%A6%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E7%99%BB%E9%8C%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e改めてイベント登録\u003c/h5\u003e\n\n\u003cp\u003e完了\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/456eeb3d01d4bc6f819fbd358b96cbb866550570/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f38343936663039652d636437342d646639342d653230642d6137366162656663373566622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F8496f09e-cd74-df94-e20d-a76abefc75fb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=733136589282068bc6f81c080cacf164\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/8496f09e-cd74-df94-e20d-a76abefc75fb.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F8496f09e-cd74-df94-e20d-a76abefc75fb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0e5bcf86af7d425c49b41058e47aa666 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"blob2sftpのロジックを張り付ける\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#blob2sftp%E3%81%AE%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E3%82%92%E5%BC%B5%E3%82%8A%E4%BB%98%E3%81%91%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eblob2sftpのロジックを張り付ける\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eFunctionName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Function1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIActionResult\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eupdatesftp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eHttpTrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAuthorizationLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFunction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"get\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"post\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoute\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"n\"\u003eHttpRequest\u003c/span\u003e \u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eILogger\u003c/span\u003e \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLogInformation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"C# HTTP trigger function processed a request.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003erequestBody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStreamReader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBody\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadToEndAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003edynamic\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eJsonConvert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserializeObject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erequestBody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edata0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eUri\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econtainer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAbsolutePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003estartIndex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003econtainer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAbsolutePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003estartIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eblobname\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAbsolutePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubstring\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estartIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eblobNameArray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblobname\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eblobFileName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblobNameArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eblobNameArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etempPath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetTempPath\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etempFilePath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCombine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetTempPath\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003eblobFileName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//blob\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCloudBlobClient\u003c/span\u003e \u003cspan class=\"n\"\u003eblobClient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estorageAccount\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateCloudBlobClient\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//container\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econtainername\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHost\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'.'\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCloudBlobContainer\u003c/span\u003e \u003cspan class=\"n\"\u003eblobcontainer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblobClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetContainerReference\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtainername\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//ダウンロードするファイル名を指定\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCloudBlockBlob\u003c/span\u003e \u003cspan class=\"n\"\u003eblockBlob_download\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblobcontainer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBlockBlobReference\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eblobname\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//ダウンロード処理\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//ダウンロード後のパスとファイル名を指定。\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edownloadFile\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003etempFilePath\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eblockBlob_download\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDownloadToFileAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edownloadFile\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIO\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFileMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOpenOrCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLogInformation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"blob download successful.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nf\"\u003eUploadSFTP\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003edownloadFile\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblobFileName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edownloadFile\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLogInformation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"sftp upload successful.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLogCritical\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eActionResult\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eOkObjectResult\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eUploadSFTP\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003efilePath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003efileName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eILogger\u003c/span\u003e \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//setup client\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSftpClient\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026lt;ホストIP or FQDN\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\u0026lt;ユーザ\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\u0026lt;パスワード\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// await a file upload\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elocalStream\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpenRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efilePath\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eChangeDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"/home/ubuntu/sftp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUploadAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elocalStream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003efileName\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// disconnect like you normally would\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDisconnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e発行\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"試験\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A9%A6%E9%A8%93\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e試験\u003c/h3\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"blobストレージの状態\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#blob%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8%E3%81%AE%E7%8A%B6%E6%85%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBlobストレージの状態\u003c/h4\u003e\n\n\u003cp\u003e空っぽですね\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6e45610718b080be0fda80bbb7ecad4323389a9d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f31376463656130332d316666312d323266662d366261612d6466306437616162666461622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F17dcea03-1ff1-22ff-6baa-df0d7aabfdab.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=399ac854c611ca8ff80a220ebcb7c9ba\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/17dcea03-1ff1-22ff-6baa-df0d7aabfdab.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F17dcea03-1ff1-22ff-6baa-df0d7aabfdab.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bdc39cb85416e1b270b96d417b67318a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"sftpサーバの状態\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sftp%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AE%E7%8A%B6%E6%85%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSFTPサーバの状態\u003c/h4\u003e\n\n\u003cp\u003eこちらも空っぽ\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ff549e3725c824dacdf975116f9a5ab60dcbbee1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f31336334666561302d363434322d613063632d326532392d3162323731666235626661322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F13c4fea0-6442-a0cc-2e29-1b271fb5bfa2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=20faa2da457a5b8591d0fbe6590cc9de\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/13c4fea0-6442-a0cc-2e29-1b271fb5bfa2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F13c4fea0-6442-a0cc-2e29-1b271fb5bfa2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ea65172c6aa50bdf103941a043155565 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"blobへファイルをアップロード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#blob%E3%81%B8%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBlobへファイルをアップロード\u003c/h4\u003e\n\n\u003cp\u003etestfile1.txtをアップロードしました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/3a50ec38691dfa0a98c08bf3063dbd2a42ff5085/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f61636537303231372d313432642d336561382d626339632d6262656331313637356365382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Face70217-142d-3ea8-bc9c-bbec11675ce8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0736db5664a5c277bfb161e2c9130e0a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/ace70217-142d-3ea8-bc9c-bbec11675ce8.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Face70217-142d-3ea8-bc9c-bbec11675ce8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=18c4070790b323585384a853a78a1969 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSFTPのサーバの状態\u003cbr\u003e\nヮ─ヾ(#＾∀＾#)ﾉ─ｨ☆彡\u003cbr\u003e\nアップロードできました🤣\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/39286914eb2c4ab3998735686e655e0c1a5f420c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3136373335322f33643766653765612d383832372d613339642d346562382d6463323231616239303337322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F3d7fe7ea-8827-a39d-4eb8-dc221ab90372.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=cd6c9459d5854ef103790b0b0cb62f3c\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/167352/3d7fe7ea-8827-a39d-4eb8-dc221ab90372.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2F3d7fe7ea-8827-a39d-4eb8-dc221ab90372.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f7c60a861a2c5270549c6801fe9da03e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h2\u003e\n\n\u003cp\u003eFunctionsを使ってファイル連携のプログラムを作りました。\u003cbr\u003e\nI/FとしてBlobは大変活用しやすいオブジェクトストレージですね。\u003cbr\u003e\nBlob+EventGrid+Functionsを使ったサーバーレスシステム間連携は簡単に実現可能です。\u003c/p\u003e\n","createdAt":"2018-12-02T06:45:12Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"eLVQ74Za/CgDl/58ez20RBbo7i04aeer--eOrlD76F/5LYNJsA--gI4xvMTkybmuyKszEGNQ3A==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-12-02T06:50:53Z","likesCount":5,"linkUrl":"https://qiita.com/tsukashusan/items/239bfa161dbc958f7232","organization":null,"originalId":731236,"stockedCount":5,"title":"サーバーレスでsftpファイル転送","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#azureblobstorage%E3%81%8B%E3%82%89sftp%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E8%BB%A2%E9%80%81\"\u003eAzureBlobStorageからsftpを使ってファイル転送\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#functions%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E4%BD%9C%E6%88%90\"\u003eFunctionsのプロジェクト作成\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#portal%E3%81%B8functions%E3%82%92%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4\"\u003ePortalへFunctionsをデプロイ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%9A%E3%81%AF%E3%81%93%E3%81%93%E3%81%8B%E3%82%89\"\u003eまずはここから、\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#visual-studio%E3%81%A7functions%E3%82%92%E4%BD%9C%E6%88%90\"\u003eVisual StudioでFunctionsを作成\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#implementation%E5%AE%9F%E8%A3%85\"\u003eImplementation(実装)\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%81%AE%E7%99%BB%E9%8C%B2%E3%81%A7%E3%81%99\"\u003eイベントハンドラの登録です。\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%8F%E3%83%9E%E3%83%AA%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88\"\u003eハマリポイント①\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B5%90%E8%AB%96\"\u003e結論\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%8F%E3%83%9E%E3%83%AA%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88-1\"\u003eハマリポイント②\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B0%97%E3%82%92%E5%8F%96%E3%82%8A%E7%9B%B4%E3%81%97%E3%81%A6%E7%99%BA%E8%A1%8C\"\u003e気を取り直して発行\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%94%B9%E3%82%81%E3%81%A6%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E7%99%BB%E9%8C%B2\"\u003e改めてイベント登録\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#blob2sftp%E3%81%AE%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E3%82%92%E5%BC%B5%E3%82%8A%E4%BB%98%E3%81%91%E3%82%8B\"\u003eblob2sftpのロジックを張り付ける\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A9%A6%E9%A8%93\"\u003e試験\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#blob%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8%E3%81%AE%E7%8A%B6%E6%85%8B\"\u003eBlobストレージの状態\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#sftp%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AE%E7%8A%B6%E6%85%8B\"\u003eSFTPサーバの状態\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#blob%E3%81%B8%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89\"\u003eBlobへファイルをアップロード\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":4488,"uuid":"239bfa161dbc958f7232","banReason":null,"adventCalendarItem":{"day":2,"calendar":{"name":"Microsoft Azure Tech","urlName":"microsoft-azure-tech","year":2018,"organization":null}},"author":{"encryptedId":"sg4z2zbn/K3wSVMnLPdB9m1E8fk5--dl0CwDNZ/jYuSQgk--Svv2sd/6InrfnkpR09ijKw==","originalId":167352,"description":"日本マイクロソフト株式会社でパートナーさん向けのクラウドソリューションアーキテクトという仕事をしております!","facebookUrl":null,"githubUrl":"https://github.com/tsukashusan","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"塚本 修一","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/167352/profile-images/1498546125","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fprofile-images%2F1498546125?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=d06ce8e1813c96208300ead298e93e60","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F167352%2Fprofile-images%2F1498546125?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=901f859c945fb9c521336704804bab4b","urlName":"tsukashusan","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Azure","urlName":"azure"},{"name":".NETCore","urlName":".netcore"},{"name":"AzureFunctions","urlName":"azurefunctions"},{"name":"AzureEventGrid","urlName":"azureeventgrid"}],"followingLikers":{"edges":[]},"comments":{"totalCount":1}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

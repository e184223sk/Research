More than 5 years have passed since last update.マネージドコードとアンマネージドコードの間で、構造化されたデータをやりとりしたい事がたまにあるのですが、残念ながら UnitySendMessage は有効な文字列しか扱うことができません。 UnitySendMessage の為だけにデータを文字列にシリアライズするのも大げさな気がします。構造体をやりとりするだけなら、構造体を返すエントリーポイントを作れば良いのですが、安全に Unity のメインスレッドに返すには、やはり UnitySendMessage を使いたいところです。文字列しか使えないからといって諦めるのはエンジニアとして負けた気がするので、ちょっと頑張ってみます。構造体のアドレスを文字列として UnitySendMessage に渡し、Unity 側で構造体を取得しています。また UnitySendMessage を呼ぶ際に、コード上、構造体のメモリをダングリング状態にすることで、スレッドセーフな実装を省略できます。（ new して UnitySendMesssage に渡してしまえば、以降 Unity のメインスレッドからしか該当メモリにアクセスされないはず。）注意点は UnitySendMessage は様々な理由でメッセージが届かない場合があるので、その場合はメモリがリークすること。また、構造体の定義時には下記の点を意識した方がよい。



<!DOCTYPE html><html><head><meta charset="utf-8" /><title>FIDOキーをWindowsデスクトップアプリで使うためのライブラリ CTAPcs - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/gebo/items/13fa8092f83ba92ba193" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="1gTREtx1qMxB0jkxCf2duU3LQD1fph1boA+9ELdbA+fmm90IvlnrjtcPqXRxE7z9RpyzXaoZRL31zg2fNdZCdA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@gebogebogeboge" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="FIDOキーをWindowsデスクトップアプリで使うためのライブラリ CTAPcs - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1Sa2xFVC1PQ3JlT0R2T09Da2xkcGJtUnZkM1BqZzRmamdybmpncV9qZzRqamc0UGpnNWZqZ3FMamc1ZmpnNnJqZ2Fma3ZiX2pnWWJqZ1pfamdvSGpnYTdqZzZuamdxVGpnNWJqZzZuamc2b2dRMVJCVUdOeiZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1hMWE2YWVhMDNjNjI4ZGNhZjQxMTU1MDcyYTE5YzBlNw&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR2RsWW04JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9ZTBmMDZhMGJmNmUzYjI2ZmZlMzllOGNhMzkzZDI0ZGQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=b4dd65c55d8b271ab97366f3a1c8a201"><meta property="og:description" content="

はじめに

ずいぶん前に WebAuthnぽいことができるWinデスクトップアプリ用ライブラリWebAuthnModokiDesktopβ を作ったんですけど、それを全体的に見直して作り替えました。
この記事ではCTAPcsの基本..."><meta content="https://qiita.com/gebo/items/13fa8092f83ba92ba193" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="Windows,C#,FIDO,CTAP" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-339a5969-2308-42aa-9302-59c5b55a755d"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fgebo%2Fitems%2F13fa8092f83ba92ba193">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fgebo%2Fitems%2F13fa8092f83ba92ba193">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-339a5969-2308-42aa-9302-59c5b55a755d">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/windows","name":"Windows"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-03-22T10:18:12.000+09:00","dateModified":"2020-03-22T10:18:12.000+09:00","headline":"FIDOキーをWindowsデスクトップアプリで使うためのライブラリ CTAPcs","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1Sa2xFVC1PQ3JlT0R2T09Da2xkcGJtUnZkM1BqZzRmamdybmpncV9qZzRqamc0UGpnNWZqZ3FMamc1ZmpnNnJqZ2Fma3ZiX2pnWWJqZ1pfamdvSGpnYTdqZzZuamdxVGpnNWJqZzZuamc2b2dRMVJCVUdOeiZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1hMWE2YWVhMDNjNjI4ZGNhZjQxMTU1MDcyYTE5YzBlNw\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR2RsWW04JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9ZTBmMDZhMGJmNmUzYjI2ZmZlMzllOGNhMzkzZDI0ZGQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=b4dd65c55d8b271ab97366f3a1c8a201","mainEntityOfPage":"https://qiita.com/gebo/items/13fa8092f83ba92ba193","author":{"@type":"Person","address":"","email":null,"identifier":"gebo","name":"gebo","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F252291%2F259049ef3da2854c57fc30166d776b5ac272df00%2Fx_large.png%3F1614046902?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=5099eac7ef4c965d458c7a95649b4f8d","url":"https://qiita.com/gebo","description":"認証,認可,FIDO,CTAP,NFC,BLE,c,c++,c#,Rust,ねこのげぼく","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"gebo","type":"items","id":"13fa8092f83ba92ba193"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"gebo","type":"items","id":"13fa8092f83ba92ba193"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"gebo","type":"items","id":"13fa8092f83ba92ba193"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/gebo/items/13fa8092f83ba92ba193","location":"/gebo/items/13fa8092f83ba92ba193","scheme":"https","host":"qiita.com","port":null,"pathname":"/gebo/items/13fa8092f83ba92ba193","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"jY7zuuk6/OJ+SM0LhuX6es3Pm5S0zenEnkpSGwQJNUa9Ef+gixa/oOiVXU7+C9s+xpho9EFysCLLi+KUhoR01Q==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-1ae95980-7b7f-4f2e-9aea-00299776a5a8"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/gebo/items/13fa8092f83ba92ba193/likers" class="css-1iupg5d">5</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">3</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/13fa8092f83ba92ba193/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/gebo/items/13fa8092f83ba92ba193/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/gebo/items/13fa8092f83ba92ba193/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/gebo/items/13fa8092f83ba92ba193/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/gebo/items/13fa8092f83ba92ba193.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/gebo"><img class="css-100alwu eyfquo10" src="https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/252291/259049ef3da2854c57fc30166d776b5ac272df00/x_large.png?1614046902" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/gebo" class="css-10ougpm">@<!-- -->gebo</a><div class="css-1ay9vb9"><time dateTime="2020-03-22T01:18:12Z" class="css-m19uds">posted at 2020-03-22</time></div></div></div></div></div><h1 class="css-cgzq40">FIDOキーをWindowsデスクトップアプリで使うためのライブラリ CTAPcs</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/windows" class="css-4czcte">Windows</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/fido" class="css-4czcte">FIDO</a><a href="/tags/ctap" class="css-4czcte">CTAP</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>ずいぶん前に <a href="https://qiita.com/gebo/items/f6d3024f7e164ac0a195" id="reference-6582cb6762bcbdbc80a2">WebAuthnぽいことができるWinデスクトップアプリ用ライブラリWebAuthnModokiDesktopβ</a> を作ったんですけど、それを全体的に見直して作り替えました。<br>
この記事では<strong>CTAPcs</strong>の基本的な使い方を紹介したいと思います。</p>

<p><strong>gebogebogebo/CTAPcs</strong><br>
<a href="https://github.com/gebogebogebo/CTAPcs" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/gebogebogebo/CTAPcs</a></p>

<ul>
<li><strong>CTAP(シータップ)です。</strong></li>
<li>本ライブラリ・デモプログラムはWebAuthn、CTAPを勉強しながら作成した検証プログラムです。</li>
<li>サンプルレベルの品質なので重要なクレデンシャル情報が入っているFIDOキーは使わないことをお勧めします。</li>
<li>本ライブラリ・デモプログラムを利用することによって生じるいかなる問題についても、その責任を負いません。</li>
</ul>

<h1>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h1>

<ul>
<li>Windows10 1903,1909</li>
<li>Visual Studio 2017,2019</li>
<li>C# Desktop Applicaion</li>
<li>.Net Framework 4.6.1</li>
</ul>

<h1>
<span id="どんなものか" class="fragment"></span><a href="#%E3%81%A9%E3%82%93%E3%81%AA%E3%82%82%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>どんなものか</h1>

<ul>
<li>YubikeyなどのFIDOキーをデスクトップアプリから使うためのDllです。

<ul>
<li>g.FIDO2.dll</li>
<li>g.FIDO2.CTAP.dll</li>
<li>g.FIDO2.CTAP.HID.dll</li>
<li>g.FIDO2.CTAP.NFC.dll</li>
<li>g.FIDO2.CTAP.BLE.dll</li>
<li>g.FIDO2.Util.dll</li>
</ul>
</li>
<li><strong>FIDOキーはFIDO2対応しているものだけ使えます。U2Fは使えません。</strong></li>
<li>JavaScriptのWebAuthnみたいなもので、似たようなことをデスクトップアプリからできます。</li>
<li>FIDOキーとの通信は<a href="https://fidoalliance.org/specs/fido-v2.0-ps-20190130/fido-client-to-authenticator-protocol-v2.0-ps-20190130.html" rel="nofollow noopener" target="_blank">CTAPの仕様</a>で行っています。

<ul>
<li>HID(USB)</li>
<li>NFC</li>
<li>BLE</li>
</ul>
</li>
<li>CTAP以外に、FIDOサーバー的な機能も実装しています。

<ul>
<li>チャレンジ生成</li>
<li>登録結果（Attestation）の署名検証</li>
<li>認証結果（Assertion）の署名検証</li>
</ul>
</li>
</ul>

<h1>
<span id="ソース" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>ソース</h1>

<ul>
<li>
<a href="https://github.com/gebogebogebo/CTAPcs" rel="nofollow noopener" target="_blank">GitHub</a>に公開しています。

<ul>
<li><strong>gebogebogebo/CTAPcs</strong></li>
<li><a href="https://github.com/gebogebogebo/CTAPcs" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/gebogebogebo/CTAPcs</a></li>
</ul>
</li>
<li>ライセンスはMITです。</li>
<li>OSSをいくつか使っています。</li>
</ul>

<h1>
<span id="とりあえず使ってみる" class="fragment"></span><a href="#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>とりあえず使ってみる</h1>

<ul>
<li>HID(USB)タイプのFIDOキーを使います。</li>
<li>以下のAPIを使います。

<ul>
<li>GetInfoAsync - FIDOキーの情報の取得</li>
<li>MakeCredentialAsync - 登録</li>
<li>GetAssertionAsync - 認証</li>
<li>ClientPINgetRetriesAsync - PINリトライ回数を調べる</li>
<li>WinkAsync - FIDOキーのLEDを光らせる</li>
</ul>
</li>
<li>PIN認証でResidentKey無しのシンプルな利用です。</li>
</ul>

<h3>
<span id="注意事項" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85"><i class="fa fa-link"></i></a>注意事項</h3>

<p>USBタイプのFIDOキーはHID（ヒューマンインタフェースデバイス）でWindowsに認識されるので、専用のドライバが不要ですべてのアプリから取り扱い可能、という点が良いところだったのですが、Windowsさんはいつの間にか（たぶん1903から）制限をかけるようになり、アクセスに<strong>Administratorの権限が必要</strong>になりました。これは手軽に使うことができなくなったという点で非常に残念ですが、Windows Helloなどセキュリティに関わる部分のポリシーに基づく対応なのかもしれません。この権限に関わる仕様変更について、Microsoftのドキュメント等の公式情報は見つけられていないのですが、そういう制限があるのでご注意ください。この時点で一般のアプリではつかえねーもの化しちゃっているのではと個人的には思います。</p>

<h2>
<span id="プロジェクト作成" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>プロジェクト作成</h2>

<p><a href="https://github.com/gebogebogebo/CTAPcs/blob/master/readme/CTAPcs_ReadMe_01.md#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E6%96%B0%E8%A6%8F%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95" rel="nofollow noopener" target="_blank">プロジェクトを新規作成する方法</a>をみてプロジェクトを作成します。</p>

<h2>
<span id="getinfoasync---fidoキーの情報を取得する" class="fragment"></span><a href="#getinfoasync---fido%E3%82%AD%E3%83%BC%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>GetInfoAsync - FIDOキーの情報を取得する</h2>

<p>FIDOキーをUSBに挿して以下のコードを実行します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">g.FIDO2.CTAP.HID</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">g.FIDO2.Util</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">g.FIDO2</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">HIDTest02</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MainWindow</span> <span class="p">:</span> <span class="n">Window</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">HIDAuthenticatorConnector</span> <span class="n">con</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
            <span class="n">con</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HIDAuthenticatorConnector</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">async</span> <span class="k">void</span> <span class="nf">ButtonGetInfo_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">res</span> <span class="p">=</span> <span class="k">await</span> <span class="n">con</span><span class="p">.</span><span class="nf">GetInfoAsync</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">DeviceStatus</span> <span class="p">==</span> <span class="n">g</span><span class="p">.</span><span class="n">FIDO2</span><span class="p">.</span><span class="n">CTAP</span><span class="p">.</span><span class="n">DeviceStatus</span><span class="p">.</span><span class="n">Unauthorized</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">"Excute Administrator ?"</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">DeviceStatus</span> <span class="p">==</span> <span class="n">g</span><span class="p">.</span><span class="n">FIDO2</span><span class="p">.</span><span class="n">CTAP</span><span class="p">.</span><span class="n">DeviceStatus</span><span class="p">.</span><span class="n">NotConnected</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">"FIDO Key Not Connected"</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">DeviceStatus</span> <span class="p">==</span> <span class="n">g</span><span class="p">.</span><span class="n">FIDO2</span><span class="p">.</span><span class="n">CTAP</span><span class="p">.</span><span class="n">DeviceStatus</span><span class="p">.</span><span class="n">Ok</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">$"GetInfoAsync\r\n- Status = </span><span class="p">{</span><span class="n">res</span><span class="p">.</span><span class="n">CTAPResponse</span><span class="p">.</span><span class="n">Status</span><span class="p">}</span><span class="s">\r\n- StatusMsg = </span><span class="p">{</span><span class="n">res</span><span class="p">.</span><span class="n">CTAPResponse</span><span class="p">.</span><span class="n">StatusMsg</span><span class="p">}</span><span class="s">"</span><span class="p">);</span> <span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">"Error"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="処理概要" class="fragment"></span><a href="#%E5%87%A6%E7%90%86%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>処理概要</h3>

<ul>
<li>
<code>HIDAuthenticatorConnector</code> クラスの <code>GetInfoAsync</code> メソッドでUSB FIDOキーの情報を取得します。</li>
<li>正常に終了すると <code>ResponseGetInfo</code> クラスが戻り値で返ってきます。</li>
<li>
<code>ResponseGetInfo</code> クラスは <code>DeviceStatus</code> メンバと <code>CTAPResponse</code> メンバで構成されていて、<code>DeviceStatus</code> にHIDレイヤのステータス、<code>CTAPResponse</code> にCTAPレイヤのステータスを持っています。</li>
<li>FIDOキーを正常に認識してCTAPコマンドが通った場合は <code>DeviceStatus</code> に <code>g.FIDO2.CTAP.DeviceStatus.Ok</code> がセットされ、<code>CTAPResponse.Status</code> に <code>0</code> がセットされます。</li>
</ul>

<h4>
<span id="responsegetinfoについて" class="fragment"></span><a href="#responsegetinfo%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>ResponseGetInfoについて</h4>

<p>さて、FIDOキーの情報ですが、以下のような情報が取れます。</p>

<ul>
<li>Versions

<ul>
<li>FIDOキーが対応しているバージョンです。<code>U2F_V2,FIDO_2_0</code>などどセットされてきます。</li>
<li>本DllはU2Fには対応していないので、<code>FIDO_2_0</code> がないと正常に動作しません。</li>
</ul>
</li>
<li>Aaguid

<ul>
<li>Authenticator Attestation GUID。FIDOキーの製品を識別するためのIDです。個体識別情報ではありませんので注意。</li>
</ul>
</li>
<li>Option_rk

<ul>
<li>Resident Key機能を持っているかどうか。通常 <code>present_and_set_to_true</code> です。</li>
</ul>
</li>
<li>Option_up

<ul>
<li>User Presence機能を持っているかどうか。通常 <code>present_and_set_to_true</code> です。</li>
</ul>
</li>
<li>Option_clientPin

<ul>
<li>PINの機能を持っているかどうか。PINがセットされているかどうかもわかります。

<ul>
<li>PINの機能を持っていないってことはないので、<code>absent</code> はありません。</li>
<li>PINがまだ設定されていない場合、<code>present_and_set_to_false</code> となります。</li>
<li>PINが設定されていれば、<code>present_and_set_to_true</code> となります。</li>
</ul>
</li>
</ul>
</li>
<li>Option_uv

<ul>
<li>User Verification機能（生体認証機能）を持っているかどうか。Feitian BioPassは指紋センサが付いているので <code>present_and_set_to_true</code> となりますが、Yubikeyは <code>absent</code> となります。</li>
</ul>
</li>
</ul>

<h2>
<span id="makecredentialasync---登録" class="fragment"></span><a href="#makecredentialasync---%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>MakeCredentialAsync - 登録</h2>

<p>FIDOキーにユーザー情報を登録します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">g.FIDO2.CTAP.HID</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">g.FIDO2.Util</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">g.FIDO2</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">HIDTest02</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MainWindow</span> <span class="p">:</span> <span class="n">Window</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">HIDAuthenticatorConnector</span> <span class="n">con</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">byte</span><span class="p">[]</span> <span class="n">creid</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">string</span> <span class="n">pubkey</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
            <span class="n">con</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HIDAuthenticatorConnector</span><span class="p">();</span>
            <span class="n">con</span><span class="p">.</span><span class="n">KeepAlive</span> <span class="p">+=</span> <span class="n">OnKeepAlive</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">OnKeepAlive</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// MakeCredentialAsync()、GetAssertionAsync()で</span>
            <span class="c1">// PIN認証が通ってFIDOキーのタッチ待ちになるとこのイベントが発生します</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">async</span> <span class="k">void</span> <span class="nf">ButtonMakeCredential_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">rpid</span> <span class="p">=</span> <span class="s">"test.com"</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">challenge</span> <span class="p">=</span> <span class="n">AttestationVerifier</span><span class="p">.</span><span class="nf">CreateChallenge</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">param</span> <span class="p">=</span> <span class="k">new</span> <span class="n">g</span><span class="p">.</span><span class="n">FIDO2</span><span class="p">.</span><span class="n">CTAP</span><span class="p">.</span><span class="nf">CTAPCommandMakeCredentialParam</span><span class="p">(</span><span class="n">rpid</span><span class="p">,</span> <span class="n">challenge</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">res</span> <span class="p">=</span> <span class="k">await</span> <span class="n">con</span><span class="p">.</span><span class="nf">MakeCredentialAsync</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="s">"1234"</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">DeviceStatus</span> <span class="p">==</span> <span class="n">g</span><span class="p">.</span><span class="n">FIDO2</span><span class="p">.</span><span class="n">CTAP</span><span class="p">.</span><span class="n">DeviceStatus</span><span class="p">.</span><span class="n">NotConnected</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// FIDOキーが接続されていない場合</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">DeviceStatus</span> <span class="p">==</span> <span class="n">g</span><span class="p">.</span><span class="n">FIDO2</span><span class="p">.</span><span class="n">CTAP</span><span class="p">.</span><span class="n">DeviceStatus</span><span class="p">.</span><span class="n">Timeout</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// FIDOキーのタッチ待ちでTimeoutした場合</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">DeviceStatus</span> <span class="p">==</span> <span class="n">g</span><span class="p">.</span><span class="n">FIDO2</span><span class="p">.</span><span class="n">CTAP</span><span class="p">.</span><span class="n">DeviceStatus</span><span class="p">.</span><span class="n">Ok</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">string</span> <span class="n">verifyResult</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">CTAPResponse</span><span class="p">.</span><span class="n">Status</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">CTAPResponse</span><span class="p">.</span><span class="n">Attestation</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// verify</span>
                        <span class="kt">var</span> <span class="n">v</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AttestationVerifier</span><span class="p">();</span>
                        <span class="kt">var</span> <span class="n">verify</span> <span class="p">=</span> <span class="n">v</span><span class="p">.</span><span class="nf">Verify</span><span class="p">(</span><span class="n">rpid</span><span class="p">,</span><span class="n">challenge</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">CTAPResponse</span><span class="p">.</span><span class="n">Attestation</span><span class="p">);</span>
                        <span class="n">verifyResult</span> <span class="p">=</span> <span class="s">$"- Verify = </span><span class="p">{</span><span class="n">verify</span><span class="p">.</span><span class="n">IsSuccess</span><span class="p">}</span><span class="s">\r\n- CredentialID = </span><span class="p">{</span><span class="n">Common</span><span class="p">.</span><span class="nf">BytesToHexString</span><span class="p">(</span><span class="n">verify</span><span class="p">.</span><span class="n">CredentialID</span><span class="p">)}</span><span class="s">\r\n- PublicKey = </span><span class="p">{</span><span class="n">verify</span><span class="p">.</span><span class="n">PublicKeyPem</span><span class="p">}</span><span class="s">"</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">verify</span><span class="p">.</span><span class="n">IsSuccess</span><span class="p">)</span> <span class="p">{</span>
                            <span class="c1">// store</span>
                            <span class="n">creid</span> <span class="p">=</span> <span class="n">verify</span><span class="p">.</span><span class="n">CredentialID</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
                            <span class="n">pubkey</span> <span class="p">=</span> <span class="n">verify</span><span class="p">.</span><span class="n">PublicKeyPem</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">$"MakeCredentialAsync\r\n- Status = </span><span class="p">{</span><span class="n">res</span><span class="p">.</span><span class="n">CTAPResponse</span><span class="p">.</span><span class="n">Status</span><span class="p">}</span><span class="s">\r\n- StatusMsg = </span><span class="p">{</span><span class="n">res</span><span class="p">.</span><span class="n">CTAPResponse</span><span class="p">.</span><span class="n">StatusMsg</span><span class="p">}</span><span class="s">\r\n</span><span class="p">{</span><span class="n">verifyResult</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="処理概要-1" class="fragment"></span><a href="#%E5%87%A6%E7%90%86%E6%A6%82%E8%A6%81-1"><i class="fa fa-link"></i></a>処理概要</h3>

<ul>
<li>
<code>HIDAuthenticatorConnector</code> クラスの <code>MakeCredentialAsync</code> メソッドでUSB FIDOキーの登録を実行します。</li>
<li>
<code>MakeCredentialAsync</code> には以下の情報を渡します。

<ul>
<li>RpId(今回は<strong>test.com</strong>)を指定します。これは登録のキーとなります。</li>
<li>応答検証のためのチャレンジを渡します。チャレンジは <code>AttestationVerifier.CreateChallenge()</code> で生成して渡してやればOKです。</li>
<li>認証要素としてPIN(今回は<strong>1234</strong>)を指定します。</li>
</ul>
</li>
<li>FIDOキー側でタッチ待ち状態になると<code>OnKeepAlive()</code>イベントが発生しますので、アプリ側でガイドメッセージを出すようなことが可能です。ただしこのイベントはUIスレッドではないので注意してください。</li>
<li>正常に終了すると <code>ResponseMakeCredential</code> クラスが返ってきます。</li>
</ul>

<h4>
<span id="responsemakecredentialの検証" class="fragment"></span><a href="#responsemakecredential%E3%81%AE%E6%A4%9C%E8%A8%BC"><i class="fa fa-link"></i></a>ResponseMakeCredentialの検証</h4>

<ul>
<li>
<code>ResponseMakeCredential.CTAPResponse.Attestation</code> が登録結果情報です。</li>
<li>
<code>Attestation</code> には電子署名が付いていて、これを検証(Verify)することで <strong>なりすまし</strong>や<strong>情報の改ざん</strong>がない事を確認することができます。</li>
<li>
<code>AttestationVerifier</code> クラスの <code>Verify</code> メソッドで検証します。このときRpIdと最初に生成したチャレンジを渡してやる必要があります。</li>
<li>Verifyの結果<code>IsSuccess</code>が<code>true</code>であれば検証OKです、おめでとうございます。<code>CredentialID</code>と<code>PublicKeyPem</code>を保存しておきましょう。</li>
</ul>

<h2>
<span id="getassertionasync---認証" class="fragment"></span><a href="#getassertionasync---%E8%AA%8D%E8%A8%BC"><i class="fa fa-link"></i></a>GetAssertionAsync - 認証</h2>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">g.FIDO2.CTAP.HID</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">g.FIDO2.Util</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">g.FIDO2</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">HIDTest02</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MainWindow</span> <span class="p">:</span> <span class="n">Window</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">HIDAuthenticatorConnector</span> <span class="n">con</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">byte</span><span class="p">[]</span> <span class="n">creid</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">string</span> <span class="n">pubkey</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
            <span class="n">con</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HIDAuthenticatorConnector</span><span class="p">();</span>
            <span class="n">con</span><span class="p">.</span><span class="n">KeepAlive</span> <span class="p">+=</span> <span class="n">OnKeepAlive</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">OnKeepAlive</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// MakeCredentialAsync()、GetAssertionAsync()で</span>
            <span class="c1">// PIN認証が通ってFIDOキーのタッチ待ちになるとこのイベントが発生します</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">async</span> <span class="k">void</span> <span class="nf">ButtonGetAssertion_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
              <span class="kt">var</span> <span class="n">rpid</span> <span class="p">=</span> <span class="s">"test.com"</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">challenge</span> <span class="p">=</span> <span class="n">AttestationVerifier</span><span class="p">.</span><span class="nf">CreateChallenge</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">param</span> <span class="p">=</span> <span class="k">new</span> <span class="n">g</span><span class="p">.</span><span class="n">FIDO2</span><span class="p">.</span><span class="n">CTAP</span><span class="p">.</span><span class="nf">CTAPCommandGetAssertionParam</span><span class="p">(</span><span class="n">rpid</span><span class="p">,</span> <span class="n">challenge</span><span class="p">,</span> <span class="n">creid</span><span class="p">);</span>
            <span class="n">param</span><span class="p">.</span><span class="n">Option_up</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

            <span class="kt">var</span> <span class="n">res</span> <span class="p">=</span> <span class="k">await</span> <span class="n">con</span><span class="p">.</span><span class="nf">GetAssertionAsync</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="s">"1234"</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">DeviceStatus</span> <span class="p">==</span> <span class="n">g</span><span class="p">.</span><span class="n">FIDO2</span><span class="p">.</span><span class="n">CTAP</span><span class="p">.</span><span class="n">DeviceStatus</span><span class="p">.</span><span class="n">NotConnected</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// FIDOキーが接続されていない場合</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">DeviceStatus</span> <span class="p">==</span> <span class="n">g</span><span class="p">.</span><span class="n">FIDO2</span><span class="p">.</span><span class="n">CTAP</span><span class="p">.</span><span class="n">DeviceStatus</span><span class="p">.</span><span class="n">Timeout</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// FIDOキーのタッチ待ちでTimeoutした場合</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">DeviceStatus</span> <span class="p">==</span> <span class="n">g</span><span class="p">.</span><span class="n">FIDO2</span><span class="p">.</span><span class="n">CTAP</span><span class="p">.</span><span class="n">DeviceStatus</span><span class="p">.</span><span class="n">Ok</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">string</span> <span class="n">verifyResult</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span> <span class="n">res</span><span class="p">.</span><span class="n">CTAPResponse</span><span class="p">.</span><span class="n">Assertion</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// verify</span>
                    <span class="kt">var</span> <span class="n">v</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AssertionVerifier</span><span class="p">();</span>
                    <span class="kt">var</span> <span class="n">verify</span> <span class="p">=</span> <span class="n">v</span><span class="p">.</span><span class="nf">Verify</span><span class="p">(</span><span class="n">rpid</span><span class="p">,</span><span class="n">pubkey</span><span class="p">,</span><span class="n">challenge</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">CTAPResponse</span><span class="p">.</span><span class="n">Assertion</span><span class="p">);</span>
                    <span class="n">verifyResult</span> <span class="p">=</span> <span class="s">$"- Verify = </span><span class="p">{</span><span class="n">verify</span><span class="p">.</span><span class="n">IsSuccess</span><span class="p">}</span><span class="s">"</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">$"GetAssertionAsync\r\n- Status = </span><span class="p">{</span><span class="n">res</span><span class="p">.</span><span class="n">CTAPResponse</span><span class="p">.</span><span class="n">Status</span><span class="p">}</span><span class="s">\r\n- StatusMsg = </span><span class="p">{</span><span class="n">res</span><span class="p">.</span><span class="n">CTAPResponse</span><span class="p">.</span><span class="n">StatusMsg</span><span class="p">}</span><span class="s">\r\n</span><span class="p">{</span><span class="n">verifyResult</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>          
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="処理概要-2" class="fragment"></span><a href="#%E5%87%A6%E7%90%86%E6%A6%82%E8%A6%81-2"><i class="fa fa-link"></i></a>処理概要</h3>

<ul>
<li>
<code>HIDAuthenticatorConnector</code> クラスの <code>GetAssertionAsync</code>メソッドでUSB FIDOキーの認証を実行します。</li>
<li>
<code>GetAssertionAsync</code>には以下の情報を渡します。

<ul>
<li>キーとして、RpId(今回は<strong>test.com</strong>)を指定します。登録の時に指定したものと同じものを指定する必要があります。</li>
<li>もう一つのキーとして、登録時にGetした<code>CredentialID</code>を指定します。</li>
<li>応答検証のためのチャレンジを渡します。チャレンジは <code>AssertionVerifier.CreateChallenge()</code> で生成した値を渡してやればOK。</li>
<li>認証要素としてPIN(今回は<strong>1234</strong>)を指定します。</li>
</ul>
</li>
<li>FIDOキー側でタッチ待ち状態になると<code>OnKeepAlive()</code>イベントが発生しますので、アプリ側でガイドメッセージを出すようなことが可能です。ただしこのイベントはUIスレッドではないので注意してください。</li>
<li>正常に終了すると <code>ResponseGetAssertion</code> クラスが返ってきます。</li>
</ul>

<h4>
<span id="responsegetassertionの検証" class="fragment"></span><a href="#responsegetassertion%E3%81%AE%E6%A4%9C%E8%A8%BC"><i class="fa fa-link"></i></a>ResponseGetAssertionの検証</h4>

<ul>
<li>
<code>ResponseGetAssertion.CTAPResponse.Assertion</code> が認証結果情報です。</li>
<li>
<code>Assertion</code>には電子署名が付いていて、これを検証(Verify)することで <strong>なりすまし</strong>や<strong>情報の改ざん</strong>がない事を確認することができます。</li>
<li>
<code>AssertionVerifier</code> クラスの <code>Verify</code> メソッドで検証します。このときRpIdと登録時に生成した公開鍵、最初に生成した <code>challenge</code> を渡してやる必要があります。</li>
<li>Verifyの結果<code>IsSuccess</code>が<code>true</code>であれば検証OKです。認証OKということでログインさせてやりましょう。</li>
</ul>

<h2>
<span id="clientpingetretriesasync---pinリトライ回数を調べる" class="fragment"></span><a href="#clientpingetretriesasync---pin%E3%83%AA%E3%83%88%E3%83%A9%E3%82%A4%E5%9B%9E%E6%95%B0%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B"><i class="fa fa-link"></i></a>ClientPINgetRetriesAsync - PINリトライ回数を調べる</h2>

<p>FIDOキーでPINを何度も間違うとロックがかかります。ロックがかかるという事はすなわち<strong>詰み</strong>です。FIDOキーをリセットして出荷状態に戻さないと使えません。<br>
以下のコードでPINリトライカウンタを調べることができます。リトライカウンタはPINを間違えると減り、PINが通ると初期値に戻ります。ゼロになるとロック状態になります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="k">void</span> <span class="nf">ButtonClientPINgetRetries_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">con2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HIDAuthenticatorConnector</span><span class="p">();</span>
    <span class="kt">var</span> <span class="n">res</span> <span class="p">=</span> <span class="k">await</span> <span class="n">con2</span><span class="p">.</span><span class="nf">ClientPINgetRetriesAsync</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">DeviceStatus</span> <span class="p">==</span> <span class="n">g</span><span class="p">.</span><span class="n">FIDO2</span><span class="p">.</span><span class="n">CTAP</span><span class="p">.</span><span class="n">DeviceStatus</span><span class="p">.</span><span class="n">Ok</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">$"ClientPINgetRetriesAsync\r\n- Status = </span><span class="p">{</span><span class="n">res</span><span class="p">.</span><span class="n">CTAPResponse</span><span class="p">.</span><span class="n">Status</span><span class="p">}</span><span class="s">\r\n- StatusMsg = </span><span class="p">{</span><span class="n">res</span><span class="p">.</span><span class="n">CTAPResponse</span><span class="p">.</span><span class="n">StatusMsg</span><span class="p">}</span><span class="s">\r\n- PIN Retry Count = </span><span class="p">{</span><span class="n">res</span><span class="p">.</span><span class="n">CTAPResponse</span><span class="p">.</span><span class="n">RetryCount</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="winkasync---fidoキーのledを光らせる" class="fragment"></span><a href="#winkasync---fido%E3%82%AD%E3%83%BC%E3%81%AEled%E3%82%92%E5%85%89%E3%82%89%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>WinkAsync - FIDOキーのLEDを光らせる</h2>

<p>どうでもいい機能として、FIDOキーのLEDを光らせることができます。<strong>ただ光らせるだけです。</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="k">void</span> <span class="nf">ButtonWink_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">con</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HIDAuthenticatorConnector</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">intIc</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">intIc</span> <span class="p">&lt;</span> <span class="m">5</span><span class="p">;</span> <span class="n">intIc</span><span class="p">++)</span> <span class="p">{</span>
        <span class="kt">var</span> <span class="n">ret</span> <span class="p">=</span> <span class="k">await</span> <span class="n">con</span><span class="p">.</span><span class="nf">WinkAsync</span><span class="p">();</span>
        <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">1000</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h1>
<span id="登録と認証のシーケンス" class="fragment"></span><a href="#%E7%99%BB%E9%8C%B2%E3%81%A8%E8%AA%8D%E8%A8%BC%E3%81%AE%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>登録と認証のシーケンス</h1>

<p>今回のサンプルプログラムは簡単な利用例ですが、実際はクライアント側とサーバー側で役割を分ける構成を想定しています。</p>

<h2>
<span id="registration" class="fragment"></span><a href="#registration"><i class="fa fa-link"></i></a>Registration</h2>

<p><a href="https://camo.qiitausercontent.com/a2f9094288aab0af8d0decf483d3ba5a715ba527/68747470733a2f2f6769746875622e636f6d2f6765626f6765626f6765626f2f4354415063732f626c6f622f6d61737465722f70752f5553425f4649444f5f4b65795f526567697374726174696f6e2f5553422532304649444f2532304b6579253230526567697374726174696f6e253230284e6f6e2532305265736964656e742532304b6579292e706e673f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fgebogebogebo%2FCTAPcs%2Fblob%2Fmaster%2Fpu%2FUSB_FIDO_Key_Registration%2FUSB%2520FIDO%2520Key%2520Registration%2520%28Non%2520Resident%2520Key%29.png%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6eb65ef55bf44a405cfb955688ad1d32" alt="pic" data-canonical-src="https://github.com/gebogebogebo/CTAPcs/blob/master/pu/USB_FIDO_Key_Registration/USB%20FIDO%20Key%20Registration%20(Non%20Resident%20Key).png?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fgebogebogebo%2FCTAPcs%2Fblob%2Fmaster%2Fpu%2FUSB_FIDO_Key_Registration%2FUSB%2520FIDO%2520Key%2520Registration%2520%28Non%2520Resident%2520Key%29.png%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5998eaffcf79a7cd8e1671a23f094aa5 1x" loading="lazy"></a></p>

<h2>
<span id="authentication" class="fragment"></span><a href="#authentication"><i class="fa fa-link"></i></a>Authentication</h2>

<p><a href="https://camo.qiitausercontent.com/5add73251626deda5387ff718de975db054f5419/68747470733a2f2f6769746875622e636f6d2f6765626f6765626f6765626f2f4354415063732f626c6f622f6d61737465722f70752f5553425f4649444f5f4b65795f417574686569636174696f6e2f5553422532304649444f2532304b6579253230417574686569636174696f6e253230284e6f6e2532305265736964656e742532304b6579292e706e673f7261773d74727565" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fgebogebogebo%2FCTAPcs%2Fblob%2Fmaster%2Fpu%2FUSB_FIDO_Key_Autheication%2FUSB%2520FIDO%2520Key%2520Autheication%2520%28Non%2520Resident%2520Key%29.png%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4b5dfd6d16673a77de2e476bf1b83a10" alt="pic" data-canonical-src="https://github.com/gebogebogebo/CTAPcs/blob/master/pu/USB_FIDO_Key_Autheication/USB%20FIDO%20Key%20Autheication%20(Non%20Resident%20Key).png?raw=true" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fgebogebogebo%2FCTAPcs%2Fblob%2Fmaster%2Fpu%2FUSB_FIDO_Key_Autheication%2FUSB%2520FIDO%2520Key%2520Autheication%2520%28Non%2520Resident%2520Key%29.png%3Fraw%3Dtrue?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2a381a087c50c42630b16efde8761820 1x" loading="lazy"></a></p>

<h1>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h1>

<p>ほかには以下のような機能があります。<br>
- NFCタイプのFIDOキーが使えます。<br>
- BLEタイプのFIDOキーが使えます。<br>
- 指紋センサが付いたFIDOキーでPINではなく、指紋認証をすることができます。<br>
- キーにデータを記録することができます。（Resident Key）<br>
- PINの登録、変更をすることができます。</p>

<p>以下のことはできません。<br>
- 指紋の登録。ベンダー提供の専用ツールで行ってください。<br>
- キーのリセット。ベンダー提供の専用ツールで行ってください。</p>

<h1>
<span id="おつかれさまでした" class="fragment"></span><a href="#%E3%81%8A%E3%81%A4%E3%81%8B%E3%82%8C%E3%81%95%E3%81%BE%E3%81%A7%E3%81%97%E3%81%9F"><i class="fa fa-link"></i></a>おつかれさまでした</h1>

<p>需要なさそうなものを謎のモチベーションで作ってしまいました。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fgebo%2Fitems%2F13fa8092f83ba92ba193&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fgebo%2Fitems%2F13fa8092f83ba92ba193&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/gebo/items/13fa8092f83ba92ba193/likers" class="css-1iupg5d">5</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">3</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/13fa8092f83ba92ba193/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/gebo/items/13fa8092f83ba92ba193/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/gebo/items/13fa8092f83ba92ba193/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/gebo/items/13fa8092f83ba92ba193/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/gebo/items/13fa8092f83ba92ba193.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-1ae95980-7b7f-4f2e-9aea-00299776a5a8">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-6adc4b5c-98fc-4c19-b724-984a375fda8c"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-6adc4b5c-98fc-4c19-b724-984a375fda8c">{}</script>
      
<div id="LoginModal-react-component-0fe4f2fb-27a2-4622-82ab-15c49b983cf7"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-0fe4f2fb-27a2-4622-82ab-15c49b983cf7">{}</script>
      
<div id="StockModal-react-component-7bf9b2ce-5674-48bd-9c66-484273ef0e07"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-7bf9b2ce-5674-48bd-9c66-484273ef0e07">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;4sB+j4L0sG71M0Ey7ovd+NMennMCdKkudCU1dFeVDGfSX3KV4NjzLGPu0XeWZfy82EltE/fL8Mgh5IX71RhN9A==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eずいぶん前に \u003ca href=\"https://qiita.com/gebo/items/f6d3024f7e164ac0a195\" id=\"reference-6582cb6762bcbdbc80a2\"\u003eWebAuthnぽいことができるWinデスクトップアプリ用ライブラリWebAuthnModokiDesktopβ\u003c/a\u003e を作ったんですけど、それを全体的に見直して作り替えました。\u003cbr\u003e\nこの記事では\u003cstrong\u003eCTAPcs\u003c/strong\u003eの基本的な使い方を紹介したいと思います。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003egebogebogebo/CTAPcs\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/gebogebogebo/CTAPcs\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/gebogebogebo/CTAPcs\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCTAP(シータップ)です。\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e本ライブラリ・デモプログラムはWebAuthn、CTAPを勉強しながら作成した検証プログラムです。\u003c/li\u003e\n\u003cli\u003eサンプルレベルの品質なので重要なクレデンシャル情報が入っているFIDOキーは使わないことをお勧めします。\u003c/li\u003e\n\u003cli\u003e本ライブラリ・デモプログラムを利用することによって生じるいかなる問題についても、その責任を負いません。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eWindows10 1903,1909\u003c/li\u003e\n\u003cli\u003eVisual Studio 2017,2019\u003c/li\u003e\n\u003cli\u003eC# Desktop Applicaion\u003c/li\u003e\n\u003cli\u003e.Net Framework 4.6.1\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"どんなものか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A9%E3%82%93%E3%81%AA%E3%82%82%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eどんなものか\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eYubikeyなどのFIDOキーをデスクトップアプリから使うためのDllです。\n\n\u003cul\u003e\n\u003cli\u003eg.FIDO2.dll\u003c/li\u003e\n\u003cli\u003eg.FIDO2.CTAP.dll\u003c/li\u003e\n\u003cli\u003eg.FIDO2.CTAP.HID.dll\u003c/li\u003e\n\u003cli\u003eg.FIDO2.CTAP.NFC.dll\u003c/li\u003e\n\u003cli\u003eg.FIDO2.CTAP.BLE.dll\u003c/li\u003e\n\u003cli\u003eg.FIDO2.Util.dll\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eFIDOキーはFIDO2対応しているものだけ使えます。U2Fは使えません。\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eJavaScriptのWebAuthnみたいなもので、似たようなことをデスクトップアプリからできます。\u003c/li\u003e\n\u003cli\u003eFIDOキーとの通信は\u003ca href=\"https://fidoalliance.org/specs/fido-v2.0-ps-20190130/fido-client-to-authenticator-protocol-v2.0-ps-20190130.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCTAPの仕様\u003c/a\u003eで行っています。\n\n\u003cul\u003e\n\u003cli\u003eHID(USB)\u003c/li\u003e\n\u003cli\u003eNFC\u003c/li\u003e\n\u003cli\u003eBLE\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eCTAP以外に、FIDOサーバー的な機能も実装しています。\n\n\u003cul\u003e\n\u003cli\u003eチャレンジ生成\u003c/li\u003e\n\u003cli\u003e登録結果（Attestation）の署名検証\u003c/li\u003e\n\u003cli\u003e認証結果（Assertion）の署名検証\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ソース\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eソース\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/gebogebogebo/CTAPcs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGitHub\u003c/a\u003eに公開しています。\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003egebogebogebo/CTAPcs\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/gebogebogebo/CTAPcs\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/gebogebogebo/CTAPcs\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eライセンスはMITです。\u003c/li\u003e\n\u003cli\u003eOSSをいくつか使っています。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"とりあえず使ってみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eとりあえず使ってみる\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eHID(USB)タイプのFIDOキーを使います。\u003c/li\u003e\n\u003cli\u003e以下のAPIを使います。\n\n\u003cul\u003e\n\u003cli\u003eGetInfoAsync - FIDOキーの情報の取得\u003c/li\u003e\n\u003cli\u003eMakeCredentialAsync - 登録\u003c/li\u003e\n\u003cli\u003eGetAssertionAsync - 認証\u003c/li\u003e\n\u003cli\u003eClientPINgetRetriesAsync - PINリトライ回数を調べる\u003c/li\u003e\n\u003cli\u003eWinkAsync - FIDOキーのLEDを光らせる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePIN認証でResidentKey無しのシンプルな利用です。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"注意事項\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e注意事項\u003c/h3\u003e\n\n\u003cp\u003eUSBタイプのFIDOキーはHID（ヒューマンインタフェースデバイス）でWindowsに認識されるので、専用のドライバが不要ですべてのアプリから取り扱い可能、という点が良いところだったのですが、Windowsさんはいつの間にか（たぶん1903から）制限をかけるようになり、アクセスに\u003cstrong\u003eAdministratorの権限が必要\u003c/strong\u003eになりました。これは手軽に使うことができなくなったという点で非常に残念ですが、Windows Helloなどセキュリティに関わる部分のポリシーに基づく対応なのかもしれません。この権限に関わる仕様変更について、Microsoftのドキュメント等の公式情報は見つけられていないのですが、そういう制限があるのでご注意ください。この時点で一般のアプリではつかえねーもの化しちゃっているのではと個人的には思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"プロジェクト作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプロジェクト作成\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/gebogebogebo/CTAPcs/blob/master/readme/CTAPcs_ReadMe_01.md#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E6%96%B0%E8%A6%8F%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95\" rel=\"nofollow noopener\" target=\"_blank\"\u003eプロジェクトを新規作成する方法\u003c/a\u003eをみてプロジェクトを作成します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"getinfoasync---fidoキーの情報を取得する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#getinfoasync---fido%E3%82%AD%E3%83%BC%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGetInfoAsync - FIDOキーの情報を取得する\u003c/h2\u003e\n\n\u003cp\u003eFIDOキーをUSBに挿して以下のコードを実行します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Windows\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eg.FIDO2.CTAP.HID\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eg.FIDO2.Util\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eg.FIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eHIDTest02\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMainWindow\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eWindow\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eHIDAuthenticatorConnector\u003c/span\u003e \u003cspan class=\"n\"\u003econ\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eMainWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eInitializeComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econ\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHIDAuthenticatorConnector\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eButtonGetInfo_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003econ\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetInfoAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUnauthorized\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Excute Administrator ?\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotConnected\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"FIDO Key Not Connected\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOk\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"GetInfoAsync\\r\\n- Status = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAPResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\\r\\n- StatusMsg = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAPResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatusMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Error\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"処理概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%87%A6%E7%90%86%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e処理概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eHIDAuthenticatorConnector\u003c/code\u003e クラスの \u003ccode\u003eGetInfoAsync\u003c/code\u003e メソッドでUSB FIDOキーの情報を取得します。\u003c/li\u003e\n\u003cli\u003e正常に終了すると \u003ccode\u003eResponseGetInfo\u003c/code\u003e クラスが戻り値で返ってきます。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eResponseGetInfo\u003c/code\u003e クラスは \u003ccode\u003eDeviceStatus\u003c/code\u003e メンバと \u003ccode\u003eCTAPResponse\u003c/code\u003e メンバで構成されていて、\u003ccode\u003eDeviceStatus\u003c/code\u003e にHIDレイヤのステータス、\u003ccode\u003eCTAPResponse\u003c/code\u003e にCTAPレイヤのステータスを持っています。\u003c/li\u003e\n\u003cli\u003eFIDOキーを正常に認識してCTAPコマンドが通った場合は \u003ccode\u003eDeviceStatus\u003c/code\u003e に \u003ccode\u003eg.FIDO2.CTAP.DeviceStatus.Ok\u003c/code\u003e がセットされ、\u003ccode\u003eCTAPResponse.Status\u003c/code\u003e に \u003ccode\u003e0\u003c/code\u003e がセットされます。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"responsegetinfoについて\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#responsegetinfo%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eResponseGetInfoについて\u003c/h4\u003e\n\n\u003cp\u003eさて、FIDOキーの情報ですが、以下のような情報が取れます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eVersions\n\n\u003cul\u003e\n\u003cli\u003eFIDOキーが対応しているバージョンです。\u003ccode\u003eU2F_V2,FIDO_2_0\u003c/code\u003eなどどセットされてきます。\u003c/li\u003e\n\u003cli\u003e本DllはU2Fには対応していないので、\u003ccode\u003eFIDO_2_0\u003c/code\u003e がないと正常に動作しません。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAaguid\n\n\u003cul\u003e\n\u003cli\u003eAuthenticator Attestation GUID。FIDOキーの製品を識別するためのIDです。個体識別情報ではありませんので注意。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eOption_rk\n\n\u003cul\u003e\n\u003cli\u003eResident Key機能を持っているかどうか。通常 \u003ccode\u003epresent_and_set_to_true\u003c/code\u003e です。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eOption_up\n\n\u003cul\u003e\n\u003cli\u003eUser Presence機能を持っているかどうか。通常 \u003ccode\u003epresent_and_set_to_true\u003c/code\u003e です。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eOption_clientPin\n\n\u003cul\u003e\n\u003cli\u003ePINの機能を持っているかどうか。PINがセットされているかどうかもわかります。\n\n\u003cul\u003e\n\u003cli\u003ePINの機能を持っていないってことはないので、\u003ccode\u003eabsent\u003c/code\u003e はありません。\u003c/li\u003e\n\u003cli\u003ePINがまだ設定されていない場合、\u003ccode\u003epresent_and_set_to_false\u003c/code\u003e となります。\u003c/li\u003e\n\u003cli\u003ePINが設定されていれば、\u003ccode\u003epresent_and_set_to_true\u003c/code\u003e となります。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eOption_uv\n\n\u003cul\u003e\n\u003cli\u003eUser Verification機能（生体認証機能）を持っているかどうか。Feitian BioPassは指紋センサが付いているので \u003ccode\u003epresent_and_set_to_true\u003c/code\u003e となりますが、Yubikeyは \u003ccode\u003eabsent\u003c/code\u003e となります。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"makecredentialasync---登録\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#makecredentialasync---%E7%99%BB%E9%8C%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMakeCredentialAsync - 登録\u003c/h2\u003e\n\n\u003cp\u003eFIDOキーにユーザー情報を登録します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Windows\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eg.FIDO2.CTAP.HID\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eg.FIDO2.Util\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eg.FIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eHIDTest02\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMainWindow\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eWindow\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eHIDAuthenticatorConnector\u003c/span\u003e \u003cspan class=\"n\"\u003econ\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ecreid\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003epubkey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eMainWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eInitializeComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econ\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHIDAuthenticatorConnector\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econ\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eKeepAlive\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eOnKeepAlive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnKeepAlive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// MakeCredentialAsync()、GetAssertionAsync()で\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// PIN認証が通ってFIDOキーのタッチ待ちになるとこのイベントが発生します\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eButtonMakeCredential_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003erpid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"test.com\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003echallenge\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAttestationVerifier\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateChallenge\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eparam\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCTAPCommandMakeCredentialParam\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erpid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003echallenge\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003econ\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMakeCredentialAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1234\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotConnected\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// FIDOキーが接続されていない場合\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// FIDOキーのタッチ待ちでTimeoutした場合\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOk\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003everifyResult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAPResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatus\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAPResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAttestation\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// verify\u003c/span\u003e\n                        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAttestationVerifier\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003everify\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eVerify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erpid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003echallenge\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAPResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAttestation\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003everifyResult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"- Verify = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003everify\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\\r\\n- CredentialID = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eCommon\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBytesToHexString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003everify\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCredentialID\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s\"\u003e\\r\\n- PublicKey = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003everify\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePublicKeyPem\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003everify\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                            \u003cspan class=\"c1\"\u003e// store\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003ecreid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003everify\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCredentialID\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003epubkey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003everify\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePublicKeyPem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"MakeCredentialAsync\\r\\n- Status = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAPResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\\r\\n- StatusMsg = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAPResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatusMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\\r\\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003everifyResult\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"処理概要-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%87%A6%E7%90%86%E6%A6%82%E8%A6%81-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e処理概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eHIDAuthenticatorConnector\u003c/code\u003e クラスの \u003ccode\u003eMakeCredentialAsync\u003c/code\u003e メソッドでUSB FIDOキーの登録を実行します。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eMakeCredentialAsync\u003c/code\u003e には以下の情報を渡します。\n\n\u003cul\u003e\n\u003cli\u003eRpId(今回は\u003cstrong\u003etest.com\u003c/strong\u003e)を指定します。これは登録のキーとなります。\u003c/li\u003e\n\u003cli\u003e応答検証のためのチャレンジを渡します。チャレンジは \u003ccode\u003eAttestationVerifier.CreateChallenge()\u003c/code\u003e で生成して渡してやればOKです。\u003c/li\u003e\n\u003cli\u003e認証要素としてPIN(今回は\u003cstrong\u003e1234\u003c/strong\u003e)を指定します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eFIDOキー側でタッチ待ち状態になると\u003ccode\u003eOnKeepAlive()\u003c/code\u003eイベントが発生しますので、アプリ側でガイドメッセージを出すようなことが可能です。ただしこのイベントはUIスレッドではないので注意してください。\u003c/li\u003e\n\u003cli\u003e正常に終了すると \u003ccode\u003eResponseMakeCredential\u003c/code\u003e クラスが返ってきます。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"responsemakecredentialの検証\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#responsemakecredential%E3%81%AE%E6%A4%9C%E8%A8%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eResponseMakeCredentialの検証\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eResponseMakeCredential.CTAPResponse.Attestation\u003c/code\u003e が登録結果情報です。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eAttestation\u003c/code\u003e には電子署名が付いていて、これを検証(Verify)することで \u003cstrong\u003eなりすまし\u003c/strong\u003eや\u003cstrong\u003e情報の改ざん\u003c/strong\u003eがない事を確認することができます。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eAttestationVerifier\u003c/code\u003e クラスの \u003ccode\u003eVerify\u003c/code\u003e メソッドで検証します。このときRpIdと最初に生成したチャレンジを渡してやる必要があります。\u003c/li\u003e\n\u003cli\u003eVerifyの結果\u003ccode\u003eIsSuccess\u003c/code\u003eが\u003ccode\u003etrue\u003c/code\u003eであれば検証OKです、おめでとうございます。\u003ccode\u003eCredentialID\u003c/code\u003eと\u003ccode\u003ePublicKeyPem\u003c/code\u003eを保存しておきましょう。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"getassertionasync---認証\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#getassertionasync---%E8%AA%8D%E8%A8%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGetAssertionAsync - 認証\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Windows\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eg.FIDO2.CTAP.HID\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eg.FIDO2.Util\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eg.FIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eHIDTest02\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMainWindow\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eWindow\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eHIDAuthenticatorConnector\u003c/span\u003e \u003cspan class=\"n\"\u003econ\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ecreid\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003epubkey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eMainWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eInitializeComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econ\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHIDAuthenticatorConnector\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econ\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eKeepAlive\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eOnKeepAlive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnKeepAlive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// MakeCredentialAsync()、GetAssertionAsync()で\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// PIN認証が通ってFIDOキーのタッチ待ちになるとこのイベントが発生します\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eButtonGetAssertion_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003erpid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"test.com\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003echallenge\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAttestationVerifier\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateChallenge\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eparam\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCTAPCommandGetAssertionParam\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erpid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003echallenge\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecreid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOption_up\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003econ\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAssertionAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1234\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotConnected\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// FIDOキーが接続されていない場合\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// FIDOキーのタッチ待ちでTimeoutした場合\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOk\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003everifyResult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAPResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAssertion\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// verify\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAssertionVerifier\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003everify\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eVerify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erpid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003epubkey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003echallenge\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAPResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAssertion\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003everifyResult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"- Verify = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003everify\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"GetAssertionAsync\\r\\n- Status = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAPResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\\r\\n- StatusMsg = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAPResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatusMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\\r\\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003everifyResult\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e          \n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"処理概要-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%87%A6%E7%90%86%E6%A6%82%E8%A6%81-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e処理概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eHIDAuthenticatorConnector\u003c/code\u003e クラスの \u003ccode\u003eGetAssertionAsync\u003c/code\u003eメソッドでUSB FIDOキーの認証を実行します。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eGetAssertionAsync\u003c/code\u003eには以下の情報を渡します。\n\n\u003cul\u003e\n\u003cli\u003eキーとして、RpId(今回は\u003cstrong\u003etest.com\u003c/strong\u003e)を指定します。登録の時に指定したものと同じものを指定する必要があります。\u003c/li\u003e\n\u003cli\u003eもう一つのキーとして、登録時にGetした\u003ccode\u003eCredentialID\u003c/code\u003eを指定します。\u003c/li\u003e\n\u003cli\u003e応答検証のためのチャレンジを渡します。チャレンジは \u003ccode\u003eAssertionVerifier.CreateChallenge()\u003c/code\u003e で生成した値を渡してやればOK。\u003c/li\u003e\n\u003cli\u003e認証要素としてPIN(今回は\u003cstrong\u003e1234\u003c/strong\u003e)を指定します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eFIDOキー側でタッチ待ち状態になると\u003ccode\u003eOnKeepAlive()\u003c/code\u003eイベントが発生しますので、アプリ側でガイドメッセージを出すようなことが可能です。ただしこのイベントはUIスレッドではないので注意してください。\u003c/li\u003e\n\u003cli\u003e正常に終了すると \u003ccode\u003eResponseGetAssertion\u003c/code\u003e クラスが返ってきます。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"responsegetassertionの検証\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#responsegetassertion%E3%81%AE%E6%A4%9C%E8%A8%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eResponseGetAssertionの検証\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eResponseGetAssertion.CTAPResponse.Assertion\u003c/code\u003e が認証結果情報です。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eAssertion\u003c/code\u003eには電子署名が付いていて、これを検証(Verify)することで \u003cstrong\u003eなりすまし\u003c/strong\u003eや\u003cstrong\u003e情報の改ざん\u003c/strong\u003eがない事を確認することができます。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eAssertionVerifier\u003c/code\u003e クラスの \u003ccode\u003eVerify\u003c/code\u003e メソッドで検証します。このときRpIdと登録時に生成した公開鍵、最初に生成した \u003ccode\u003echallenge\u003c/code\u003e を渡してやる必要があります。\u003c/li\u003e\n\u003cli\u003eVerifyの結果\u003ccode\u003eIsSuccess\u003c/code\u003eが\u003ccode\u003etrue\u003c/code\u003eであれば検証OKです。認証OKということでログインさせてやりましょう。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"clientpingetretriesasync---pinリトライ回数を調べる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#clientpingetretriesasync---pin%E3%83%AA%E3%83%88%E3%83%A9%E3%82%A4%E5%9B%9E%E6%95%B0%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClientPINgetRetriesAsync - PINリトライ回数を調べる\u003c/h2\u003e\n\n\u003cp\u003eFIDOキーでPINを何度も間違うとロックがかかります。ロックがかかるという事はすなわち\u003cstrong\u003e詰み\u003c/strong\u003eです。FIDOキーをリセットして出荷状態に戻さないと使えません。\u003cbr\u003e\n以下のコードでPINリトライカウンタを調べることができます。リトライカウンタはPINを間違えると減り、PINが通ると初期値に戻ります。ゼロになるとロック状態になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eButtonClientPINgetRetries_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econ2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHIDAuthenticatorConnector\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003econ2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClientPINgetRetriesAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFIDO2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOk\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"ClientPINgetRetriesAsync\\r\\n- Status = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAPResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\\r\\n- StatusMsg = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAPResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatusMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\\r\\n- PIN Retry Count = \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCTAPResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRetryCount\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"winkasync---fidoキーのledを光らせる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#winkasync---fido%E3%82%AD%E3%83%BC%E3%81%AEled%E3%82%92%E5%85%89%E3%82%89%E3%81%9B%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWinkAsync - FIDOキーのLEDを光らせる\u003c/h2\u003e\n\n\u003cp\u003eどうでもいい機能として、FIDOキーのLEDを光らせることができます。\u003cstrong\u003eただ光らせるだけです。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eButtonWink_Click\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econ\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHIDAuthenticatorConnector\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eintIc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003eintIc\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003eintIc\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003econ\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWinkAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"登録と認証のシーケンス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%99%BB%E9%8C%B2%E3%81%A8%E8%AA%8D%E8%A8%BC%E3%81%AE%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e登録と認証のシーケンス\u003c/h1\u003e\n\n\u003cp\u003e今回のサンプルプログラムは簡単な利用例ですが、実際はクライアント側とサーバー側で役割を分ける構成を想定しています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"registration\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#registration\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRegistration\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/a2f9094288aab0af8d0decf483d3ba5a715ba527/68747470733a2f2f6769746875622e636f6d2f6765626f6765626f6765626f2f4354415063732f626c6f622f6d61737465722f70752f5553425f4649444f5f4b65795f526567697374726174696f6e2f5553422532304649444f2532304b6579253230526567697374726174696f6e253230284e6f6e2532305265736964656e742532304b6579292e706e673f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fgebogebogebo%2FCTAPcs%2Fblob%2Fmaster%2Fpu%2FUSB_FIDO_Key_Registration%2FUSB%2520FIDO%2520Key%2520Registration%2520%28Non%2520Resident%2520Key%29.png%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6eb65ef55bf44a405cfb955688ad1d32\" alt=\"pic\" data-canonical-src=\"https://github.com/gebogebogebo/CTAPcs/blob/master/pu/USB_FIDO_Key_Registration/USB%20FIDO%20Key%20Registration%20(Non%20Resident%20Key).png?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fgebogebogebo%2FCTAPcs%2Fblob%2Fmaster%2Fpu%2FUSB_FIDO_Key_Registration%2FUSB%2520FIDO%2520Key%2520Registration%2520%28Non%2520Resident%2520Key%29.png%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5998eaffcf79a7cd8e1671a23f094aa5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"authentication\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#authentication\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAuthentication\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/5add73251626deda5387ff718de975db054f5419/68747470733a2f2f6769746875622e636f6d2f6765626f6765626f6765626f2f4354415063732f626c6f622f6d61737465722f70752f5553425f4649444f5f4b65795f417574686569636174696f6e2f5553422532304649444f2532304b6579253230417574686569636174696f6e253230284e6f6e2532305265736964656e742532304b6579292e706e673f7261773d74727565\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fgebogebogebo%2FCTAPcs%2Fblob%2Fmaster%2Fpu%2FUSB_FIDO_Key_Autheication%2FUSB%2520FIDO%2520Key%2520Autheication%2520%28Non%2520Resident%2520Key%29.png%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4b5dfd6d16673a77de2e476bf1b83a10\" alt=\"pic\" data-canonical-src=\"https://github.com/gebogebogebo/CTAPcs/blob/master/pu/USB_FIDO_Key_Autheication/USB%20FIDO%20Key%20Autheication%20(Non%20Resident%20Key).png?raw=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fgebogebogebo%2FCTAPcs%2Fblob%2Fmaster%2Fpu%2FUSB_FIDO_Key_Autheication%2FUSB%2520FIDO%2520Key%2520Autheication%2520%28Non%2520Resident%2520Key%29.png%3Fraw%3Dtrue?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2a381a087c50c42630b16efde8761820 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"その他\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他\u003c/h1\u003e\n\n\u003cp\u003eほかには以下のような機能があります。\u003cbr\u003e\n- NFCタイプのFIDOキーが使えます。\u003cbr\u003e\n- BLEタイプのFIDOキーが使えます。\u003cbr\u003e\n- 指紋センサが付いたFIDOキーでPINではなく、指紋認証をすることができます。\u003cbr\u003e\n- キーにデータを記録することができます。（Resident Key）\u003cbr\u003e\n- PINの登録、変更をすることができます。\u003c/p\u003e\n\n\u003cp\u003e以下のことはできません。\u003cbr\u003e\n- 指紋の登録。ベンダー提供の専用ツールで行ってください。\u003cbr\u003e\n- キーのリセット。ベンダー提供の専用ツールで行ってください。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おつかれさまでした\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%A4%E3%81%8B%E3%82%8C%E3%81%95%E3%81%BE%E3%81%A7%E3%81%97%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおつかれさまでした\u003c/h1\u003e\n\n\u003cp\u003e需要なさそうなものを謎のモチベーションで作ってしまいました。\u003c/p\u003e\n","createdAt":"2020-03-22T01:18:12Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"2GHLq8i+p7akw42R7qI1jR49bNqdIGlT8A==--e5gWviUhJu5P3Eog--98r207kNZ1iOu/yf1bN0nw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":false,"lastModifiedAt":"2020-03-22T01:18:12Z","likesCount":5,"linkUrl":"https://qiita.com/gebo/items/13fa8092f83ba92ba193","organization":null,"originalId":1190214,"stockedCount":3,"title":"FIDOキーをWindowsデスクトップアプリで使うためのライブラリ CTAPcs","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%92%B0%E5%A2%83\"\u003e環境\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%A9%E3%82%93%E3%81%AA%E3%82%82%E3%81%AE%E3%81%8B\"\u003eどんなものか\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9\"\u003eソース\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003eとりあえず使ってみる\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85\"\u003e注意事項\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E4%BD%9C%E6%88%90\"\u003eプロジェクト作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#getinfoasync---fido%E3%82%AD%E3%83%BC%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\"\u003eGetInfoAsync - FIDOキーの情報を取得する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%87%A6%E7%90%86%E6%A6%82%E8%A6%81\"\u003e処理概要\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#responsegetinfo%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003eResponseGetInfoについて\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#makecredentialasync---%E7%99%BB%E9%8C%B2\"\u003eMakeCredentialAsync - 登録\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%87%A6%E7%90%86%E6%A6%82%E8%A6%81-1\"\u003e処理概要\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#responsemakecredential%E3%81%AE%E6%A4%9C%E8%A8%BC\"\u003eResponseMakeCredentialの検証\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#getassertionasync---%E8%AA%8D%E8%A8%BC\"\u003eGetAssertionAsync - 認証\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%87%A6%E7%90%86%E6%A6%82%E8%A6%81-2\"\u003e処理概要\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#responsegetassertion%E3%81%AE%E6%A4%9C%E8%A8%BC\"\u003eResponseGetAssertionの検証\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#clientpingetretriesasync---pin%E3%83%AA%E3%83%88%E3%83%A9%E3%82%A4%E5%9B%9E%E6%95%B0%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B\"\u003eClientPINgetRetriesAsync - PINリトライ回数を調べる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#winkasync---fido%E3%82%AD%E3%83%BC%E3%81%AEled%E3%82%92%E5%85%89%E3%82%89%E3%81%9B%E3%82%8B\"\u003eWinkAsync - FIDOキーのLEDを光らせる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cli\u003e\n\u003ca href=\"#%E7%99%BB%E9%8C%B2%E3%81%A8%E8%AA%8D%E8%A8%BC%E3%81%AE%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9\"\u003e登録と認証のシーケンス\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#registration\"\u003eRegistration\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#authentication\"\u003eAuthentication\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96\"\u003eその他\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%81%A4%E3%81%8B%E3%82%8C%E3%81%95%E3%81%BE%E3%81%A7%E3%81%97%E3%81%9F\"\u003eおつかれさまでした\u003c/a\u003e\n\u003c/li\u003e\n\n","totalPv":3102,"uuid":"13fa8092f83ba92ba193","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"0jlHOWylzxFPs3v6vLUvbrdBM5FP--b7cga5oRPSov3yCJ--w4DexRVWiskXhdCkfLQtVA==","originalId":252291,"description":"認証,認可,FIDO,CTAP,NFC,BLE,c,c++,c#,Rust,ねこのげぼく","facebookUrl":null,"githubUrl":"https://github.com/gebogebogebo","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"Satoshi Suzuki","profileImageUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/252291/259049ef3da2854c57fc30166d776b5ac272df00/x_large.png?1614046902","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F252291%2F259049ef3da2854c57fc30166d776b5ac272df00%2Fx_large.png%3F1614046902?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=da68ce3463d091cbdf102f2918d35763","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F252291%2F259049ef3da2854c57fc30166d776b5ac272df00%2Fx_large.png%3F1614046902?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=5099eac7ef4c965d458c7a95649b4f8d","urlName":"gebo","websiteUrl":"https://zenn.dev/gebo","twitterUrl":"https://twitter.com/gebogebogeboge","twitterUrlName":"gebogebogeboge","revealedOrganizations":{"edges":[]}},"tags":[{"name":"Windows","urlName":"windows"},{"name":"C#","urlName":"csharp"},{"name":"FIDO","urlName":"fido"},{"name":"CTAP","urlName":"ctap"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

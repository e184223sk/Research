More than 1 year has passed since last update.この記事はC# Advent Calendar 2018 24日目の記事です。何番煎じか分かりませんが、Discord.Netを使ってC#で簡単なDiscordBotを作成し、それをそのままAzureにデプロイさせてみようと思います。今回の開発環境は以下の通りになります。アカウント作成、ログイン、新規サーバー作成は省略します。まずは、DiscordのDEVELOPER PORTALに遷移し、”Create an application”から新規アプリケーションを作成します。
アプリケーション設定画面でBotアカウント名（Description、Botアイコン画像）を入力します。

次に左のSETTINGSから Bot を選び、 ”Add Bot” でアカウントにBotを実装します。
ちなみに、一度Botを追加するとアプリケーションを削除しない限り、botをなくす事はできないようです。


以上でBotアカウントの作成は完了ですので、このアカウントをサーバーに追加してあげましょう。アクセストークンが知られるとBotが乗っ取られますので、管理には十分注意してください。左のSETTINGSから OAuth2 を選び、 SCOPES から "bot"を選択、BOTの権限を聞かれるので今回は面倒だからAdministratorを選びます。
（必要に応じて適切な権限を与えて下さい。）

その後、SCOPESにあるURLにアクセスすると追加先のサーバーを聞かれるので、最初に作ったサーバーと紐付けます。
選択出来るサーバーは自身が管理者のサーバーだけになります。
以上の手順で、作成したBotがサーバーにログインできます。
以上でDiscord側の作業は全て完了です。あとはBotに機能を追加していきましょう。ここからはC#でDiscord.Netを使ってBot機能を実装していきます。
Discord.Netについての詳しい事は以下を参照にしてください。とりあえず、コンソールアプリケーションを新規作成し、DiscordサーバーとBotとがやり取りするメイン部分を実装していきます。
ここでの主な実装内容は「Botアカウントログイン」と「Botに行わせたいActionのトリガー」です。Discordとのやり取り部分が実装できたら、エントリーポイントからそれを呼び出してあげましょう。これで、DiscordとBotプログラムのやり取りは完了です。あとはBot機能を実装していきます。とりあえず、pingと打ったらpongを返す機能を実装していきます。ポイントは以下の通りです。以上で実装完了です。
あとはプログラムを実行してDiscordでpingと発言してみましょう。
無事、Botが正しく反応してくれました！ついでにもう一つぐらい機能を追加してみます。
今度は引数を受け取って、その面のサイコロを指定回数振って結果を表示する機能です。今回の機能は引数を受け取る以外にも以下の機能を実装してみました。以下がそのコードになります。そしたらまたプログラムを起動させてDiscord上で呼び出してみます。
最後に、せっかく作成したBotプログラムなので、自身がPCを起動させていない時でも動いてくれるようにAzure上にデプロイさせてあげましょう。
VisualStudioからAzureへのデプロイはVSだけで簡単に出来るのでお薦めです！（Azureアカウントやリソースグループが必要ですが、それらの作成方法については省略します。）プロジェクトを右クリックしての「発行(B)」から「新規作成」でプロファイルを作成します。
プロファイルには「アプリ名、使用するサブスクリプション、リソースグループ、ホスティングプラン」を入力してください。

上記の手順で作成するとプロファイルが作られますが、そのままだと種別が「トリガー」になっていますので、常駐起動用の「継続」に変更します。
今回はついでに、デプロイ方法も「前回のリソースを削除」にしました。

上記で作成したプロファイルを使って発行するだけでデプロイ完了です。簡単・・・。
これで発行すると、指定したリソースグループ内のWebジョブにアプリケーションが追加されます。ちなみに、継続的なWebジョブの場合はアプリケーションの「常時接続」をONにする必要があります。
これはAzure Potalに入ってAppServiceの「設定 &gt; アプリケーション設定 &gt; 常時接続」から設定することができます。無事、設定が完了したらDiscordを確認します。
Botアカウントがオンラインになっていれば成功です。

無事、DiscordサーバーにC#で作成してAzureにデプロイしたBotを動かす事が出来ました。簡単ではありますが、今回使用したソースコードは自分のgithubに公開してありますので、よろしければどーぞ。
https://github.com/xxi-noxx/CSharpAdCal2018（PullRequestは優しくお願いします。何卒・・・何卒・・・。。。）今ではゲーム好きには当たり前になったと思っているDiscordですが、
最近スマブラとか発売されて新規オンラインゲーム勢も増えたと思うので、
コミュニケーションツールにDiscordを使って、Botを仕込んでドヤってみましょう！（



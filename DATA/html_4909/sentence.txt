More than 3 years have passed since last update.TwitterのTLをボイスロイドに読み上げてもらう
この記事をまねてPythonでTwitterのタイムラインを読み上げてもらってたがTweepyではMuteメソッドを扱ってなく、Friendshipの方もエラーをはいて取得できなかったのでCoreTweetを用いてC#で作ろうと思った。
ついでにGUIのクライアントみたいなものも作ろうと思った。
ついでに民安★TALKも経由せずに読み上げさせようと思った(一応民安★TALK経由バージョンも書いときます)
あとWindows FormsとWindows Presentation Foundationの2通りで作ったんでそれについてもちょっと触れます。C#を今まで触ったことのない人間が作ったので色々変な部分があると思います。NuGet経由で必要なパッケージを入れる重要だと思った部分だけ抜きだして書きますストリーミングAPIを使う・CoreTweet/CoreTweet Wiki
C#でTwitterアプリを作る 第3回 Streamingタイムラインを止めるにはこのconnectionを使ってすればいい。System.DiagnosticsのProcessStartInfoを使う。同様に民安★TALKも起動してあげる。
あとは[TwitterのTLをボイスロイドに読み上げてもらう]と同様に
ツイートの処理タイミングで民安★TALKの引数に読み上げる文章を設定し、Process.Startしてあげればいい。CodeerのLogicalTreeが上手く動かず悩んでたところ
SeikaCenterのコードにVOICEROIDの解析結果があるおかげで何とか動かすことができた (というかほとんどそのまま)
SeikaCenterの関係コード[努力したWiki]VOICEROID+用の奴しかやってないんでVOICEROID2等はSeikaCenterのコードを見てくださいまずはVOICEROIDを起動しプロセスからVOICEROIDのテキストボックス・再生ボタン・保存ボタンを取得する今回は起動後”VOICEROID”にマッチするプロセスの1番目だけを取得しそこからコンポーネントを取得したが
SeikaCenterの方ではすべてVOICEROID＋の名前("VOICEROID＋ 東北きりたん EX" 等)を配列に格納し
すべてのプロセスを取得してからVOICEROIDの名前に合うプロセスを取得してたはず。その後VOICEROIDに喋らせるにはテキストボックスにテキストを渡した後すぐに再生すると上手く読み上げてくれないのでSleepを入れる必要がある。
また、VOICEROIDは再生中は保存ボタンが押せないので、それを利用して再生終了を検知する。フォームやGUI上にタイムラインを表示しない場合はツイート処理のタイミングで読み上げる処理を入れてあげるだけでいい。
一方、タイムラインを表示する場合この方法だと
ツイートの取得→読み上げ→ツイートの取得→読み上げ→...
のように1つのツイートごとの同期処理になり、タイムライン表示と読み上げを別々にしたい
つまりTLは読み込むタイミングで表示していき、読み上げは1ツイートずつ順番に読み上げてもらいたい場合は非同期処理が必要になる。
その場合、キュー(リスト)とタスクを使用すればいいまずはTaskを定義する終了したTaskや同じTaskは再起動できないので無限ループさせ、キューに要素がある間だけ読み上げてもらう。
無間ループの間にSleepを入れないとCPU使用率が上がるので注意。次に、ツイートの取得時にキューに追加する処理を加えてあげるあとはVOICEROIDの起動時に一回だけtalktask.Start()をすればいい。今回はアイコン・ScreenName・Tweetの内容を表示する。DataGridViewにタイムラインを表示するようにする。
まずはColumnの追加と設定次に行を追加する処理
DataGridViewImageColumnはImage型しか表示できないのでURLから読み込んで加工する必要がある。
DataGridViewにURLで指定した画像を表示したい後はこれをツイートの読み込みタイミングで実行すればいいWPF DataGridの列に画像を表示
まずはDataGridに表示する3要素をまとめたクラスを作るカラムを作りBindingするBindingで指定した変数名を表示してくれる。
ImageのSourceにURLを指定してあげれば表示してくれる模様最後にデータを追加する処理あとはそれぞれ見栄えを整えたり、Streamingと読み上げのON/OFFをボタンで切り替えるようにしたりすれば完成
(WPFはElysiumを使用)メインのVOICEROID読み上げのついでにGUIの方の説明もしてしまいましたが正直TweetDeck見ながら読み上げをしてもらえばいいので必要ないと思います。
多分メニューバーつけてそこからVOICEROIDのパスの設定やTwitterの認証、あと現状でミュートワードをテキストファイルにまとめているものをDBに入れたりすることを出来るようにすればもっとまともなクライアントになるんじゃないかと思う。(まぁめんどくさいのでやらないだろうけど)
初めてのC#と.NETでのGUIアプリケーション作成だったけどなかなか面白かったです。



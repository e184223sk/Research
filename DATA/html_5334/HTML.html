<!DOCTYPE html><html><head><meta charset="utf-8" /><title>NUnitでVSTOアドイン(Outlook)の単体テストを実施した話 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/YunaNakanishi/items/b2fee27bea0ca5068569" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="K7bHhzBjxAn7blhR3sYVo9CBoBPqnMZ1bQABPm9b5AQIKZis6dAE0h5dBedk4L9Emnx49sk+BvKn6JQhmA0E4A==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="NUnitでVSTOアドイン(Outlook)の単体テストを実施した話 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1UbFZ1YVhUamdhZFdVMVJQNDRLaTQ0T0o0NEtrNDRPektFOTFkR3h2YjJzcDQ0R3U1WTJZNUwyVDQ0T0c0NEs1NDRPSTQ0S1M1YTZmNXBhOTQ0R1g0NEdmNktteCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1jZTlkYjc4NTJmN2Y2Y2Q3ZjY2MzQ0ZGNiOTViMmU0ZA&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRmwxYm1GT1lXdGhibWx6YUdrJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9ZmFiM2M1NjA0NzlhNzg0YzNkYmQ4Mjc2YmE1NmRkZjk&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=3fbddb1db3abd1678bcf864c868a8c67"><meta property="og:description" content="

概要

SE1年生の私ですが、先日Visual Studioを使い、Outlook用のVSTOアドインを開発しました。
そのアドインの単体テストの話を、備忘録として記事にします。

今回は、NUnitで単体テストを行うにあたり「リ..."><meta content="https://qiita.com/YunaNakanishi/items/b2fee27bea0ca5068569" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,VisualStudio,単体テスト,Outlook,VSTO" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-9224c28e-42ea-42be-a899-af2d64de5b00"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2FYunaNakanishi%2Fitems%2Fb2fee27bea0ca5068569">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2FYunaNakanishi%2Fitems%2Fb2fee27bea0ca5068569">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-9224c28e-42ea-42be-a899-af2d64de5b00">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-03-27T17:45:01.000+09:00","dateModified":"2018-03-28T15:52:23.000+09:00","headline":"NUnitでVSTOアドイン(Outlook)の単体テストを実施した話","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1UbFZ1YVhUamdhZFdVMVJQNDRLaTQ0T0o0NEtrNDRPektFOTFkR3h2YjJzcDQ0R3U1WTJZNUwyVDQ0T0c0NEs1NDRPSTQ0S1M1YTZmNXBhOTQ0R1g0NEdmNktteCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1jZTlkYjc4NTJmN2Y2Y2Q3ZjY2MzQ0ZGNiOTViMmU0ZA\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRmwxYm1GT1lXdGhibWx6YUdrJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9ZmFiM2M1NjA0NzlhNzg0YzNkYmQ4Mjc2YmE1NmRkZjk\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=3fbddb1db3abd1678bcf864c868a8c67","mainEntityOfPage":"https://qiita.com/YunaNakanishi/items/b2fee27bea0ca5068569","author":{"@type":"Person","address":"","email":null,"identifier":"YunaNakanishi","name":"YunaNakanishi","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F29644865%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=22c4df0962a04df9839cd2f9651be38f","url":"https://qiita.com/YunaNakanishi","description":"0.2人前くらいのSE。温かい目で見守っていただけると嬉しいです。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"YunaNakanishi","type":"items","id":"b2fee27bea0ca5068569"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"YunaNakanishi","type":"items","id":"b2fee27bea0ca5068569"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"YunaNakanishi","type":"items","id":"b2fee27bea0ca5068569"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/YunaNakanishi/items/b2fee27bea0ca5068569","location":"/YunaNakanishi/items/b2fee27bea0ca5068569","scheme":"https","host":"qiita.com","port":null,"pathname":"/YunaNakanishi/items/b2fee27bea0ca5068569","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"8u1q0hg5AkISIPfg4STBYcPJQezEcV3PgC6SHjHmYvrRcjX5wYrCmfcTqlZbAmuGiTSZCefTnUhKxgcBxrCCHg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-6f1924bd-8797-4b67-995b-14ae78389784"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/YunaNakanishi/items/b2fee27bea0ca5068569/likers" class="css-1iupg5d">1</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">2</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/b2fee27bea0ca5068569/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/YunaNakanishi/items/b2fee27bea0ca5068569/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/YunaNakanishi/items/b2fee27bea0ca5068569/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/YunaNakanishi/items/b2fee27bea0ca5068569/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/YunaNakanishi/items/b2fee27bea0ca5068569.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/YunaNakanishi"><img class="css-100alwu eyfquo10" src="https://avatars1.githubusercontent.com/u/29644865?v=4" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/YunaNakanishi" class="css-10ougpm">@<!-- -->YunaNakanishi</a><div class="css-1ay9vb9"><span><meta content="2018-03-27T08:45:01Z"/><time dateTime="2018-03-28T06:52:23Z" class="css-m19uds">updated at 2018-03-28</time></span></div></div></div></div></div><h1 class="css-cgzq40">NUnitでVSTOアドイン(Outlook)の単体テストを実施した話</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/visualstudio" class="css-4czcte">VisualStudio</a><a href="/tags/%e5%8d%98%e4%bd%93%e3%83%86%e3%82%b9%e3%83%88" class="css-4czcte">単体テスト</a><a href="/tags/outlook" class="css-4czcte">Outlook</a><a href="/tags/vsto" class="css-4czcte">VSTO</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h1>

<p>SE1年生の私ですが、先日Visual Studioを使い、Outlook用のVSTOアドインを開発しました。<br>
そのアドインの単体テストの話を、備忘録として記事にします。</p>

<p>今回は、<strong>NUnit</strong>で単体テストを行うにあたり「<strong>リフレクション</strong>」や、<br>
モックライブラリの「<strong>NSubstitute</strong>」を用いました。</p>

<h4>
<span id="開発環境" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>開発環境</h4>

<ul>
<li>Visual Studio 2015 Professional</li>
<li>NUnit 3.9.0</li>
<li>NSubstitute 3.1.0</li>
</ul>

<h2>
<span id="構成" class="fragment"></span><a href="#%E6%A7%8B%E6%88%90"><i class="fa fa-link"></i></a>構成</h2>

<p>開発したアドインのソリューションの構成はこのようになっています。<br>
<a href="https://camo.qiitausercontent.com/95ec19757210a0ab0bd67a51666ffa9b46db9c2d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3234333333312f63353336313734302d636436662d336531312d653965662d6135643334363839393737332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F243331%2Fc5361740-cd6f-3e11-e9ef-a5d346899773.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4b6ba3f2ebba5e9cbd53662d062ba360" alt="tree_colored.PNG" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/243331/c5361740-cd6f-3e11-e9ef-a5d346899773.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F243331%2Fc5361740-cd6f-3e11-e9ef-a5d346899773.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=401fa0a86f5bb7e2805429d0e294ce89 1x" loading="lazy"></a></p>

<p>以下、この記事に出てくる、クラス名やメソッド名の紹介です。</p>

<p><font color="DarkOrange"><strong>テストクラス</strong> </font>(テストする側)<br>
プロジェクト名： ORCAUnitTest<br>
クラス名： GetRecipientsUnitTest</p>

<p><font color="ForestGreen"><strong>テスト対象</strong>  </font>(テストされる側)<br>
プロジェクト名： OutlookRecipientConfirmationAddin<br>
クラス名： Utility<br>
メソッド名：  GetRecipients</p>

<p><details><summary>GetRecipientsメソッドのソースコードはこちら<br>
</summary><div>  

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">Utility.cs</span></div>
<div class="highlight"><pre class="with-code"><code>        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// アイテムから、宛先(Recipient)のリスト取得する</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="Item"&gt;Outlookアイテムオブジェクト&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="type"&gt;アイテムの種類&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="IgnoreMeetingResponse"&gt;会議招集の返信かどうか&lt;/param&gt;</span>
        <span class="c1">/// &lt;returns&gt;Recipientsインスタンス(会議招集の返信や、MailItem,MeetingItem,AppointmentItemでない場合null)&lt;/returns&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Outlook</span><span class="p">.</span><span class="n">Recipient</span><span class="p">&gt;</span> <span class="nf">GetRecipients</span><span class="p">(</span><span class="kt">object</span> <span class="n">Item</span><span class="p">,</span> <span class="k">ref</span> <span class="n">OutlookItemType</span> <span class="n">type</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">IgnoreMeetingResponse</span> <span class="p">=</span> <span class="k">false</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Outlook</span><span class="p">.</span><span class="n">Recipients</span> <span class="n">recipients</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="kt">bool</span> <span class="n">isAppointmentItem</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

            <span class="n">Outlook</span><span class="p">.</span><span class="n">MailItem</span> <span class="n">mail</span> <span class="p">=</span> <span class="n">Item</span> <span class="k">as</span> <span class="n">Outlook</span><span class="p">.</span><span class="n">MailItem</span><span class="p">;</span>
            <span class="c1">// MailItemの場合</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mail</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">recipients</span> <span class="p">=</span> <span class="n">mail</span><span class="p">.</span><span class="n">Recipients</span><span class="p">;</span>
                <span class="n">type</span> <span class="p">=</span> <span class="n">OutlookItemType</span><span class="p">.</span><span class="n">Mail</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// (中略)</span>

            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Item</span> <span class="k">is</span> <span class="n">Outlook</span><span class="p">.</span><span class="n">ReportItem</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Outlook</span><span class="p">.</span><span class="n">ReportItem</span> <span class="n">item</span> <span class="p">=</span> <span class="n">Item</span> <span class="k">as</span> <span class="n">Outlook</span><span class="p">.</span><span class="n">ReportItem</span><span class="p">;</span>

                <span class="c1">//ReportItemのままだと送信先が取れないため、</span>
                <span class="c1">//いったんIPM.Noteとして別名保存⇒ロードしてからRecipientsを取得する</span>
                <span class="n">Outlook</span><span class="p">.</span><span class="n">ReportItem</span> <span class="n">copiedReport</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="nf">Copy</span><span class="p">();</span>
                <span class="n">copiedReport</span><span class="p">.</span><span class="n">MessageClass</span> <span class="p">=</span> <span class="s">"IPM.Note"</span><span class="p">;</span>
                <span class="n">copiedReport</span><span class="p">.</span><span class="nf">Save</span><span class="p">();</span>

                <span class="c1">//IPM.Noteとして保存してからロードするとMailItemとして扱えるようになる</span>
                <span class="kt">var</span> <span class="n">newReportItem</span> <span class="p">=</span> <span class="n">Globals</span><span class="p">.</span><span class="n">ThisAddIn</span><span class="p">.</span><span class="n">Application</span><span class="p">.</span><span class="n">Session</span><span class="p">.</span><span class="nf">GetItemFromID</span><span class="p">(</span><span class="n">copiedReport</span><span class="p">.</span><span class="n">EntryID</span><span class="p">);</span>
                <span class="n">Outlook</span><span class="p">.</span><span class="n">MailItem</span> <span class="n">newMailItem</span> <span class="p">=</span> <span class="n">newReportItem</span> <span class="k">as</span> <span class="n">Outlook</span><span class="p">.</span><span class="n">MailItem</span><span class="p">;</span>
                <span class="n">recipients</span> <span class="p">=</span> <span class="n">newMailItem</span><span class="p">.</span><span class="n">Recipients</span><span class="p">;</span>
                <span class="n">type</span> <span class="p">=</span> <span class="n">OutlookItemType</span><span class="p">.</span><span class="n">Report</span><span class="p">;</span>

                <span class="n">copiedReport</span><span class="p">.</span><span class="nf">Delete</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="c1">// 受信者の情報をリストに入れる</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">Outlook</span><span class="p">.</span><span class="n">Recipient</span><span class="p">&gt;</span> <span class="n">recipientsList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Outlook</span><span class="p">.</span><span class="n">Recipient</span><span class="p">&gt;();</span>

            <span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="n">isAppointmentItem</span> <span class="p">?</span> <span class="m">2</span> <span class="p">:</span> <span class="m">1</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="n">recipients</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="c1">// recipients[i]がBccまたはリソース</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">recipients</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Type</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Outlook</span><span class="p">.</span><span class="n">OlMailRecipientType</span><span class="p">.</span><span class="n">olBCC</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// Bccや、選択されたリソースの場合</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">recipients</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Sendable</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">recipientsList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">recipients</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                    <span class="p">}</span>
                    <span class="c1">// 選択されていないリソースの場合</span>
                    <span class="k">else</span>
                    <span class="p">{</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="c1">// 送信者、To、Ccの場合</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">recipientsList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">recipients</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">recipientsList</span><span class="p">;</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<p></p>
</div></details></p>

<h1>
<span id="直面した問題たち" class="fragment"></span><a href="#%E7%9B%B4%E9%9D%A2%E3%81%97%E3%81%9F%E5%95%8F%E9%A1%8C%E3%81%9F%E3%81%A1"><i class="fa fa-link"></i></a>直面した問題たち</h1>

<p>初心者の私が、単体テストを作成するにあたり、直面した問題は以下の通り。</p>

<p><strong>「テスト対象のクラス/メソッドにアクセスできない(publicでない)場合、どうすればテストできるのか？」</strong><br>
<strong>「Outlookを起動しないテストプロジェクトから、どのようにGlobals.ThisAddinインスタンスを生成するか？」</strong></p>

<p>セットアップメソッド（テストが実行される前、1度だけ実行されるメソッド）のコーディング時に<br>
少し頑張ることで、これらの問題を解決しました。</p>

<h1>
<span id="セットアップメソッドに記述したこと" class="fragment"></span><a href="#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AB%E8%A8%98%E8%BF%B0%E3%81%97%E3%81%9F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>セットアップメソッドに記述したこと</h1>

<h2>
<span id="1-アセンブリでクラスメソッドの呼出し" class="fragment"></span><a href="#1-%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E3%81%A7%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%91%BC%E5%87%BA%E3%81%97"><i class="fa fa-link"></i></a>1. アセンブリでクラスメソッドの呼出し</h2>

<h3>
<span id="背景" class="fragment"></span><a href="#%E8%83%8C%E6%99%AF"><i class="fa fa-link"></i></a>背景</h3>

<p>テストコードから、publicでないクラスやメソッドを呼出すと、ビルドエラーになります。<br>
「'〇〇〇（publicでないクラスやメソッド名）'はアクセスできない保護レベルになっています」<br>
との事。</p>

<p>テストプロジェクトとテスト対象の、アクセシビリティの問題です<img alt=":pensive:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f614.png" title=":pensive:" width="20" loading="lazy"></p>

<p><strong>問題「テスト対象のクラス/メソッドにアクセスできない(publicでない)場合、どうすればテストできるのか？」</strong></p>

<h3>
<span id="解決策" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E7%AD%96"><i class="fa fa-link"></i></a>解決策</h3>

<p>ズバリ、<strong>「リフレクションを使った、アセンブリの動的呼出し」</strong>です！</p>

<p>Init()メソッド内で、DLLファイルから動的にテスト対象のメソッドを呼び出しました。</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">GetRecipientsUnitTest.cs</span></div>
<div class="highlight"><pre class="with-code"><code>        <span class="p">[</span><span class="n">OneTimeSetUp</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">//(中略)</span>

            <span class="c1">// アセンブリを読み込み、モジュールを取得</span>
            <span class="n">Assembly</span> <span class="n">asm</span> <span class="p">=</span> <span class="n">Assembly</span><span class="p">.</span><span class="nf">LoadFrom</span><span class="p">(</span><span class="s">@".\ORCAUnitTest\bin\Debug\OutlookRecipientConfirmationAddin.dll"</span><span class="p">);</span>
            <span class="n">Module</span> <span class="n">mod</span> <span class="p">=</span> <span class="n">asm</span><span class="p">.</span><span class="nf">GetModule</span><span class="p">(</span><span class="s">"OutlookRecipientConfirmationAddin.dll"</span><span class="p">);</span>

            <span class="c1">// テスト対象のクラス（Utility）のタイプを取得</span>
            <span class="n">Type</span> <span class="n">type</span> <span class="p">=</span> <span class="n">mod</span><span class="p">.</span><span class="nf">GetType</span><span class="p">(</span><span class="s">"OutlookRecipientConfirmationAddin.Utility"</span><span class="p">);</span>

            <span class="c1">// インスタンスを生成し、メソッドにアクセスできるようにする</span>
            <span class="kt">object</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">Activator</span><span class="p">.</span><span class="nf">CreateInstance</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
            <span class="n">MethodInfo</span> <span class="n">mi</span> <span class="p">=</span> <span class="n">type</span><span class="p">.</span><span class="nf">GetMethod</span><span class="p">(</span><span class="s">"GetRecipients"</span><span class="p">);</span>

            <span class="c1">//(中略)</span>
        <span class="p">}</span>
</code></pre></div>
</div>

<p>まず、アセンブリからモジュールを取得。<br>
モジュールから、クラスの型(Type)を取得します。<br>
最後に、クラスの型からインスタンスを生成すると、<strong>メソッドの属性 「mi」</strong> を取得できます。  </p>

<p>セットアップメソッドでの下準備は、以上です。</p>

<p>次に、テストコードです。</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">GetRecipientsUnitTest.cs</span></div>
<div class="highlight"><pre class="with-code"><code>            <span class="kt">var</span> <span class="n">objArray</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[]</span> <span class="p">{</span> <span class="n">testReport</span><span class="p">,</span> <span class="n">Utility</span><span class="p">.</span><span class="n">OutlookItemType</span><span class="p">.</span><span class="n">Mail</span><span class="p">,</span> <span class="k">false</span> <span class="p">};</span>
            <span class="kt">object</span> <span class="n">actualObj</span> <span class="p">=</span> <span class="n">mi</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">objArray</span><span class="p">);</span>
</code></pre></div>
</div>

<p><strong>Invoke</strong> メソッドを使うと、テストしたいメソッドを呼び出せました！<img alt=":clap:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44f.png" title=":clap:" width="20" loading="lazy"></p>

<h2>
<span id="2-モックオブジェクトの作成" class="fragment"></span><a href="#2-%E3%83%A2%E3%83%83%E3%82%AF%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>2. モックオブジェクトの作成</h2>

<h3>
<span id="背景-1" class="fragment"></span><a href="#%E8%83%8C%E6%99%AF-1"><i class="fa fa-link"></i></a>背景</h3>

<p>例えば、テスト対象のメソッドには、このようなコードがあります。  </p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">Utility.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">recResolve</span> <span class="p">=</span> <span class="n">Globals</span><span class="p">.</span><span class="n">ThisAddIn</span><span class="p">.</span><span class="n">Application</span><span class="p">.</span><span class="n">Session</span><span class="p">.</span><span class="nf">CreateRecipient</span><span class="p">(</span><span class="n">sender</span><span class="p">.</span><span class="n">Address</span><span class="p">);</span>
</code></pre></div>
</div>

<p>このGlobals.ThisAddinインスタンスは、Outlook起動時に自動で生成されるものです。<br>
しかし、今回の単体テストはNUnitで実行するため、Outlookを起動しません。</p>

<p><strong>問題「Outlookを起動しないテストプロジェクトから、どのようにGlobals.ThisAddinインスタンスを生成するか？」</strong></p>

<h3>
<span id="解決策-1" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E7%AD%96-1"><i class="fa fa-link"></i></a>解決策</h3>

<p>ズバリ、<strong>「モックオブジェクトを駆使する」</strong>ことです！</p>

<p>単体テストクラスからは、この「ThisAddIn」にアクセスできないので、<strong>自分でThisAddInクラス</strong>を作成します。<br>
NSubstituteを使い、あたかも本物の「ThisAddIn」が取得できたかのように、振る舞いを定義します。</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">GetRecipientsUnitTest.cs</span></div>
<div class="highlight"><pre class="with-code"><code>        <span class="p">[</span><span class="n">OneTimeSetUp</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">//(中略)</span>

            <span class="c1">// ThisAddInクラスのインスタンスを生成</span>
            <span class="n">TestFactory</span> <span class="n">testFactory</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TestFactory</span><span class="p">();</span>
            <span class="n">IServiceProvider</span> <span class="n">testService</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">IServiceProvider</span><span class="p">&gt;();</span>
            <span class="n">ThisAddIn</span> <span class="n">testAddIn</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ThisAddIn</span><span class="p">(</span><span class="n">testFactory</span><span class="p">,</span> <span class="n">testService</span><span class="p">);</span>

            <span class="c1">// ThisAddInのApplicaitionフィールドを取得し、モックの値（testApp）をセット</span>
            <span class="n">Type</span> <span class="n">typeThisAddIn</span> <span class="p">=</span> <span class="n">testAddIn</span><span class="p">.</span><span class="nf">GetType</span><span class="p">();</span>
            <span class="n">FieldInfo</span> <span class="n">fieldApp</span> <span class="p">=</span> <span class="n">typeThisAddIn</span><span class="p">.</span><span class="nf">GetField</span><span class="p">(</span><span class="s">"Application"</span><span class="p">,</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span><span class="p">);</span>
            <span class="n">Application</span> <span class="n">testApp</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">TestApplication</span><span class="p">&gt;();</span>
            <span class="n">fieldApp</span><span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="n">testAddIn</span><span class="p">,</span> <span class="n">testApp</span><span class="p">);</span>

            <span class="c1">// モックのApplication（testApp）のSessionに値(tesNs)をセットする</span>
            <span class="n">testNs</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">NameSpace</span><span class="p">&gt;();</span>
            <span class="n">testApp</span><span class="p">.</span><span class="n">Session</span><span class="p">.</span><span class="nf">Returns</span><span class="p">(</span><span class="n">testNs</span><span class="p">);</span>

            <span class="c1">// GlobalsのThisAddinプロパティに、モックなどを使って作った値(testAddIn)をセットする</span>
            <span class="n">Type</span> <span class="n">typeGlobal</span> <span class="p">=</span> <span class="n">mod</span><span class="p">.</span><span class="nf">GetType</span><span class="p">(</span><span class="s">"OutlookRecipientConfirmationAddin.Globals"</span><span class="p">);</span>
            <span class="n">PropertyInfo</span> <span class="n">testProp</span> <span class="p">=</span> <span class="n">typeGlobal</span><span class="p">.</span><span class="nf">GetProperty</span><span class="p">(</span><span class="s">"ThisAddIn"</span><span class="p">,</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Static</span><span class="p">);</span>
            <span class="n">testProp</span><span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">testAddIn</span><span class="p">);</span>

            <span class="c1">// モックのApplication（testApp）のSessionに値(tesNS)をセットする</span>
            <span class="n">testNs</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">NameSpace</span><span class="p">&gt;();</span>
            <span class="n">testApp</span><span class="p">.</span><span class="n">Session</span><span class="p">.</span><span class="nf">Returns</span><span class="p">(</span><span class="n">testNs</span><span class="p">);</span>

            <span class="c1">//(中略)</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<p>少しややこしいですが、これでThisAddInやApplication、Sessionの偽装が完了です。</p>

<p>全てのテストケースで、モックオブジェクトに同じ動作を期待する処理は、<br>
以下のようなコードをセットアップメソッドに記述してもいいです。</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">GetRecipientsUnitTest.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">Recipient</span> <span class="n">testRec</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">Recipient</span><span class="p">&gt;();</span>
<span class="n">testNs</span><span class="p">.</span><span class="nf">CreateRecipient</span><span class="p">(</span><span class="n">Arg</span><span class="p">.</span><span class="n">Any</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;()).</span><span class="nf">Returns</span><span class="p">(</span><span class="n">testRec</span><span class="p">);</span>
</code></pre></div>
</div>

<p>ここでは、私は <strong>.Returns() メソッド</strong>を使っています。<br>
テスト対象でCreateRecipientメソッドが呼ばれると、Recipient型の「testRec」が返却されるようになりました。</p>

<p>その他のモックについては、各テストコードで、テスト内容に応じてモックの動作の指定をします。  </p>

<h5>
<span id="複数のテストクラスを同時に実行する場合の注意点" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E5%90%8C%E6%99%82%E3%81%AB%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>複数のテストクラスを同時に実行する場合の注意点</h5>

<p>ThisAddInクラスを、上記の手順で複数生成すると、<strong>System.NotSupportedException</strong> になります。<br>
その理由は、ThisAddInのコンストラクタにあります。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">ThisAddIn.Designer.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
        <span class="c1">// (中略)</span>

        <span class="k">public</span> <span class="nf">ThisAddIn</span><span class="p">(</span><span class="k">global</span><span class="p">::</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">Office</span><span class="p">.</span><span class="n">Tools</span><span class="p">.</span><span class="n">Outlook</span><span class="p">.</span><span class="n">Factory</span> <span class="n">factory</span><span class="p">,</span> <span class="k">global</span><span class="p">::</span><span class="n">System</span><span class="p">.</span><span class="n">IServiceProvider</span> <span class="n">serviceProvider</span><span class="p">)</span> <span class="p">:</span> 
                <span class="k">base</span><span class="p">(</span><span class="n">factory</span><span class="p">,</span> <span class="n">serviceProvider</span><span class="p">,</span> <span class="s">"AddIn"</span><span class="p">,</span> <span class="s">"ThisAddIn"</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Globals</span><span class="p">.</span><span class="n">Factory</span> <span class="p">=</span> <span class="n">factory</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// (中略)</span>

        <span class="k">internal</span> <span class="k">static</span> <span class="k">global</span><span class="p">::</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">Office</span><span class="p">.</span><span class="n">Tools</span><span class="p">.</span><span class="n">Outlook</span><span class="p">.</span><span class="n">Factory</span> <span class="n">Factory</span> <span class="p">{</span>
            <span class="k">get</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">_factory</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">set</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">_factory</span> <span class="p">==</span> <span class="k">null</span><span class="p">))</span> <span class="p">{</span>
                    <span class="n">_factory</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="nf">NotSupportedException</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// (中略)</span>
</code></pre></div>
</div>

<p>ThisAddInのコンストラクタが、Factoryプロパティのセッターにアクセスする際に例外が発生したようです<img alt=":warning:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/26a0-fe0f.png" title=":warning:" width="20" loading="lazy"></p>

<p>手っ取り早い解決法は、ThisAddInクラスを一度生成したら、<br>
「そのインスタンスをクラス間で使い回す」ことです。</p>

<h2>
<span id="おまけテスト実行時に困ったこと" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91%E3%83%86%E3%82%B9%E3%83%88%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AB%E5%9B%B0%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>おまけ：テスト実行時に困ったこと</h2>

<p>その他、単体テストで難しいと感じたポイントを1点紹介します。<br>
動的型付け変数である<strong>dynamic</strong>と、モックについてです。</p>

<h3>
<span id="発生内容" class="fragment"></span><a href="#%E7%99%BA%E7%94%9F%E5%86%85%E5%AE%B9"><i class="fa fa-link"></i></a>発生内容</h3>

<h4>
<span id="手順" class="fragment"></span><a href="#%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>　手順</h4>

<p>テストコード内で、先程紹介した通りにモックオブジェクトのメソッドの返り値を指定。</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">GetRecipientsUnitTest.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">ReportItem</span> <span class="n">reportItem</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">ReportItem</span><span class="p">&gt;();</span>
<span class="n">reportItem</span><span class="p">.</span><span class="nf">Copy</span><span class="p">().</span><span class="nf">Returns</span><span class="p">(</span><span class="n">reportItem</span><span class="p">);</span>
</code></pre></div>
</div>

<p>テストコードの残りの部分も完成させ、テストを実行。  </p>

<h4>
<span id="現象" class="fragment"></span><a href="#%E7%8F%BE%E8%B1%A1"><i class="fa fa-link"></i></a>　現象</h4>

<p><strong>RuntimeBinderException</strong>が発生。<br>
追加情報:「'Castle.Proxies.ContactItemProxy'に'Returns'の定義がありません」<br>
<a href="https://camo.qiitausercontent.com/ac959cf6e706a2e79d20af676ee71231fbe008c5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3234333333312f33643331616366632d626362392d313338642d326234342d6434333337366231353938642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F243331%2F3d31acfc-bcb9-138d-2b44-d43376b1598d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=63d9f13262c613f8b8bce988329f64ee" alt="RuntimeBinderException.PNG" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/243331/3d31acfc-bcb9-138d-2b44-d43376b1598d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F243331%2F3d31acfc-bcb9-138d-2b44-d43376b1598d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=05533440f4338e2b204feb0af9f6c777 1x" loading="lazy"></a>   </p>

<h3>
<span id="解析内容" class="fragment"></span><a href="#%E8%A7%A3%E6%9E%90%E5%86%85%E5%AE%B9"><i class="fa fa-link"></i></a>解析内容</h3>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">_ReportItem[メタデータから]</span></div>
<div class="highlight"><pre class="with-code"><code>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">_ReportItem</span>
    <span class="p">{</span>
        <span class="c1">//(中略)</span>
        <span class="kt">dynamic</span> <span class="nf">Copy</span><span class="p">();</span>
        <span class="c1">//(中略)</span>
    <span class="p">}</span>
</code></pre></div>
</div>

<p>Copy()メソッドの返り値が「dynamic」となっているので、上手くいかない模様。</p>

<p>単体テスト中、他にもdynamicを返すメソッドを通ることありましたが、<br>
そこでもRuntimeBinderException が発生しました<img alt=":droplet:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f4a7.png" title=":droplet:" width="20" loading="lazy"><br>
どうやら、<strong>NSubstituteのモックでは、動的型付け変数（dynamic）をうまく扱えない</strong>ようです。</p>

<h3>
<span id="対応" class="fragment"></span><a href="#%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>対応</h3>

<ul>
<li>ReportItemインターフェースを実装した、TestReportItemクラスを作成</li>
</ul>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">MyTestClasses.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">TestReportItem</span> <span class="p">:</span> <span class="n">ReportItem</span>
    <span class="p">{</span>
        <span class="c1">//(中略)</span>

        <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Close</span><span class="p">(</span><span class="n">OlInspectorClose</span> <span class="n">SaveMode</span><span class="p">);</span>

        <span class="k">public</span> <span class="kt">dynamic</span> <span class="nf">Copy</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">CopyHon</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">virtual</span> <span class="n">ReportItem</span> <span class="nf">CopyHon</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//(中略)</span>
</code></pre></div>
</div>

<p><strong>CopyHon()</strong>というメソッドを追加し、モックオブジェクトには、このメソッドを使ってもらうことにします。<br>
Copy()メソッドのreturn値に、ReportItem型を返すCopyHon()メソッドを指定。</p>

<p>テスト対象のメソッドでは、変わりなくCopy()メソッドを使います。</p>

<ul>
<li>「手順」で紹介したテストコード2行を、以下の通りに修正</li>
</ul>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">GetRecipientsUnitTest.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">TestReportItem</span> <span class="n">testReport</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">TestReportItem</span><span class="p">&gt;();</span>
<span class="n">testReport</span><span class="p">.</span><span class="nf">CopyHon</span><span class="p">().</span><span class="nf">Returns</span><span class="p">(</span><span class="n">testReport</span><span class="p">)</span>
</code></pre></div>
</div>

<p>こうすると、モックオブジェクトがdynamicを返り値とするメソッドにアクセスしないようになります。</p>

<p>以上2点を修正すると、RuntimeBinderExceptionを回避でき、思い通りの動作になりました。</p>

<h2>
<span id="完成したテストメソッド" class="fragment"></span><a href="#%E5%AE%8C%E6%88%90%E3%81%97%E3%81%9F%E3%83%86%E3%82%B9%E3%83%88%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>完成したテストメソッド</h2>

<p>そんなこんなで、遂に完成したテストメソッド！<br>
長いので折りたたんでおきますが、興味のある方はご覧ください。</p>

<p><details><summary>ソースコードはこちら<br>
</summary><div>  

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">ReportItemUnitTest.cs</span></div>
<div class="highlight"><pre class="with-code"><code>        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// アイテムが、ReportItemの場合&lt;/para&gt;</span>
        <span class="c1">/// 【期待結果】Recipientsを取得できる</span>
        <span class="c1">/// TypeがReportになる</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="p">[</span><span class="n">Test</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">ReportItemRecipientsTest</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// モックでつかうデータを用意</span>
            <span class="kt">string</span><span class="p">[]</span> <span class="n">testRecNames</span> <span class="p">=</span> <span class="p">{</span> <span class="s">"testemailaddress1@example.com"</span><span class="p">,</span> <span class="s">"testemailaddress2@example.com"</span> <span class="p">};</span>
            <span class="kt">bool</span><span class="p">[]</span> <span class="n">testRecSendable</span> <span class="p">=</span> <span class="p">{</span> <span class="k">true</span><span class="p">,</span> <span class="k">true</span> <span class="p">};</span>
            <span class="kt">int</span><span class="p">[]</span> <span class="n">testRecType</span> <span class="p">=</span> <span class="p">{</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">OlMailRecipientType</span><span class="p">.</span><span class="n">olTo</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">OlMailRecipientType</span><span class="p">.</span><span class="n">olCC</span> <span class="p">};</span>

            <span class="c1">// 期待結果を入れるリスト</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">Recipient</span><span class="p">&gt;</span> <span class="n">expectedRecList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Recipient</span><span class="p">&gt;();</span>
            <span class="n">expectedRecList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">expectedRec1</span><span class="p">);</span>
            <span class="n">expectedRecList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">expectedRec2</span><span class="p">);</span>

            <span class="n">testReport</span><span class="p">.</span><span class="nf">CopyHon</span><span class="p">().</span><span class="nf">Returns</span><span class="p">(</span><span class="n">testReport</span><span class="p">);</span>

            <span class="c1">// モックのReturn値と、期待結果のリストの値を設定</span>
            <span class="n">MyTestNs</span> <span class="n">myTestNs</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">MyTestNs</span><span class="p">&gt;();</span>
            <span class="n">testApp</span><span class="p">.</span><span class="n">Session</span><span class="p">.</span><span class="nf">Returns</span><span class="p">(</span><span class="n">myTestNs</span><span class="p">);</span>
            <span class="n">myTestNs</span><span class="p">.</span><span class="nf">GetItemFromIDHon</span><span class="p">(</span><span class="n">Arg</span><span class="p">.</span><span class="n">Any</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;()).</span><span class="nf">Returns</span><span class="p">(</span><span class="n">testMail</span><span class="p">);</span>

            <span class="c1">// テストするメソッドにアクセスし、実際の結果を取得</span>
            <span class="kt">var</span> <span class="n">objArray</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[]</span> <span class="p">{</span> <span class="n">testReport</span><span class="p">,</span> <span class="n">Utility</span><span class="p">.</span><span class="n">OutlookItemType</span><span class="p">.</span><span class="n">Mail</span><span class="p">,</span> <span class="k">false</span> <span class="p">};</span>
            <span class="kt">object</span> <span class="n">actualObj</span> <span class="p">=</span> <span class="n">mi</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">objArray</span><span class="p">);</span>

            <span class="c1">// テスト対象メソッドの返り値をList&lt;Recipient&gt;型にする</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">Recipient</span><span class="p">&gt;</span> <span class="n">actualRecList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Recipient</span><span class="p">&gt;();</span>
            <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Recipient</span><span class="p">&gt;</span> <span class="n">actualEnumList</span> <span class="p">=</span> <span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Recipient</span><span class="p">&gt;)</span><span class="n">actualObj</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">actual</span> <span class="k">in</span> <span class="n">actualEnumList</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">actualRecList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">actual</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nf">SetExpectedValues</span><span class="p">(</span><span class="n">testRecNames</span><span class="p">,</span> <span class="n">testRecSendable</span><span class="p">,</span> <span class="n">testRecType</span><span class="p">,</span> <span class="n">expectedRecList</span><span class="p">);</span>

            <span class="c1">// actualとexpectedのリストを比較</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="n">actualRecList</span><span class="p">.</span><span class="n">Count</span><span class="p">,</span> <span class="n">expectedRecList</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
            <span class="nf">CompareLists</span><span class="p">(</span><span class="n">actualRecList</span><span class="p">,</span> <span class="n">expectedRecList</span><span class="p">);</span>

            <span class="c1">// ref引数のtypeが正しいことを確認</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">That</span><span class="p">(</span><span class="n">objArray</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">Is</span><span class="p">.</span><span class="nf">EqualTo</span><span class="p">(</span><span class="n">Utility</span><span class="p">.</span><span class="n">OutlookItemType</span><span class="p">.</span><span class="n">Report</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 期待する結果リストの値を設定するメソッド</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="testRecNames"&gt;Recipientのアドレス&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="testRecSendable"&gt;RecipientのSendableプロパティ&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="testRecType"&gt;RecipientのType&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="expectedRecList"&gt;期待結果のRecipient型リスト&lt;/param&gt;</span>
        <span class="k">private</span> <span class="k">void</span> <span class="nf">SetExpectedValues</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">testRecNames</span><span class="p">,</span> <span class="kt">bool</span><span class="p">[]</span> <span class="n">testRecSendable</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">testRecType</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Recipient</span><span class="p">&gt;</span> <span class="n">expectedRecList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">string</span> <span class="n">testRec</span> <span class="k">in</span> <span class="n">testRecNames</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">expectedRecList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Address</span><span class="p">.</span><span class="nf">Returns</span><span class="p">(</span><span class="n">testRecNames</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="n">expectedRecList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Sendable</span> <span class="p">=</span> <span class="n">testRecSendable</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">expectedRecList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Type</span> <span class="p">=</span> <span class="n">testRecType</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">i</span><span class="p">++;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 実際の値と、期待する値を比較するメソッド</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="actualList"&gt;メソッドからもどってきたRecipient型リスト&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="expectedList"&gt;期待する結果を入れたRecipient型リスト&lt;/param&gt;</span>
        <span class="k">private</span> <span class="k">void</span> <span class="nf">CompareLists</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Recipient</span><span class="p">&gt;</span> <span class="n">actualList</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Recipient</span><span class="p">&gt;</span> <span class="n">expectedList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">expectedList</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">Assert</span><span class="p">.</span><span class="nf">That</span><span class="p">(</span><span class="n">actualList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Address</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="nf">EqualTo</span><span class="p">(</span><span class="n">expectedList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Address</span><span class="p">));</span>
                <span class="n">Assert</span><span class="p">.</span><span class="nf">That</span><span class="p">(</span><span class="n">actualList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Sendable</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="nf">EqualTo</span><span class="p">(</span><span class="n">expectedList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Sendable</span><span class="p">));</span>
                <span class="n">Assert</span><span class="p">.</span><span class="nf">That</span><span class="p">(</span><span class="n">actualList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Type</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="nf">EqualTo</span><span class="p">(</span><span class="n">expectedList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Type</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div>
</div>

<p></p>
</div></details></p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>この度は「<strong>NSubstitute</strong>」に、大々的にお世話になりました。<br>
テスト対象のクラスに渡すデータの偽装ができ、とても便利です。</p>

<p>既存のインターフェースやクラスを継承した、<br>
<strong>自作クラス</strong>（内容は、テストの都合の良いように変更する）を作成するのも必要不可欠ですね。</p>

<p>また、VSTOアドインの開発者向け情報が、インターネットにあまりなく苦戦しました。<br>
Microsoft社のOutlook VBAリファレンスだけでも、もう少し分かりやすいようにしてほしいところ。</p>

<h1>
<span id="関連リンク参考にしたサイト" class="fragment"></span><a href="#%E9%96%A2%E9%80%A3%E3%83%AA%E3%83%B3%E3%82%AF%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>関連リンク・参考にしたサイト</h1>

<ul>
<li>
<a href="https://github.com/ykinoshi1015/OutlookRecipientConfirmationAddin" rel="nofollow noopener" target="_blank">Outlook宛先表示アドイン</a> ← 開発したアドインの配布元</li>
<li><a href="https://www.ipentec.com/document/csharp-dynamic-load-assembly-use-reflection" rel="nofollow noopener" target="_blank">動的にDLLファイルのクラスメソッドを呼び出す</a></li>
<li><a href="https://qiita.com/sengoku/items/48f58f778a05f13f922e" id="reference-522cf1d32d729d4b716f">[C#][.NET] モックライブラリNSubstitute使い方メモ</a></li>
</ul>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2FYunaNakanishi%2Fitems%2Fb2fee27bea0ca5068569&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2FYunaNakanishi%2Fitems%2Fb2fee27bea0ca5068569&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/YunaNakanishi/items/b2fee27bea0ca5068569/likers" class="css-1iupg5d">1</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">2</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/b2fee27bea0ca5068569/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/YunaNakanishi/items/b2fee27bea0ca5068569/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/YunaNakanishi/items/b2fee27bea0ca5068569/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/YunaNakanishi/items/b2fee27bea0ca5068569/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/YunaNakanishi/items/b2fee27bea0ca5068569.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-6f1924bd-8797-4b67-995b-14ae78389784">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-ae376cf4-2e0b-4975-beea-e64c0a01f2e9"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-ae376cf4-2e0b-4975-beea-e64c0a01f2e9">{}</script>
      
<div id="LoginModal-react-component-bd4ede3b-050a-4d7d-9047-b41e4b4b689d"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-bd4ede3b-050a-4d7d-9047-b41e4b4b689d">{}</script>
      
<div id="StockModal-react-component-8aec2077-df01-4882-812b-cc120dfff296"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-8aec2077-df01-4882-812b-cc120dfff296">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;p77cne6SDjfyNEbLxaORvJVzcTtt8YUnSWOtU0g5XnGEIYO2NyHO7BcHG31/hTtb346p3k5TRaCDizhMv2++lQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h1\u003e\n\n\u003cp\u003eSE1年生の私ですが、先日Visual Studioを使い、Outlook用のVSTOアドインを開発しました。\u003cbr\u003e\nそのアドインの単体テストの話を、備忘録として記事にします。\u003c/p\u003e\n\n\u003cp\u003e今回は、\u003cstrong\u003eNUnit\u003c/strong\u003eで単体テストを行うにあたり「\u003cstrong\u003eリフレクション\u003c/strong\u003e」や、\u003cbr\u003e\nモックライブラリの「\u003cstrong\u003eNSubstitute\u003c/strong\u003e」を用いました。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"開発環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e開発環境\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003eVisual Studio 2015 Professional\u003c/li\u003e\n\u003cli\u003eNUnit 3.9.0\u003c/li\u003e\n\u003cli\u003eNSubstitute 3.1.0\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"構成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A7%8B%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e構成\u003c/h2\u003e\n\n\u003cp\u003e開発したアドインのソリューションの構成はこのようになっています。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/95ec19757210a0ab0bd67a51666ffa9b46db9c2d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3234333333312f63353336313734302d636436662d336531312d653965662d6135643334363839393737332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F243331%2Fc5361740-cd6f-3e11-e9ef-a5d346899773.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4b6ba3f2ebba5e9cbd53662d062ba360\" alt=\"tree_colored.PNG\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/243331/c5361740-cd6f-3e11-e9ef-a5d346899773.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F243331%2Fc5361740-cd6f-3e11-e9ef-a5d346899773.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=401fa0a86f5bb7e2805429d0e294ce89 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e以下、この記事に出てくる、クラス名やメソッド名の紹介です。\u003c/p\u003e\n\n\u003cp\u003e\u003cfont color=\"DarkOrange\"\u003e\u003cstrong\u003eテストクラス\u003c/strong\u003e \u003c/font\u003e(テストする側)\u003cbr\u003e\nプロジェクト名： ORCAUnitTest\u003cbr\u003e\nクラス名： GetRecipientsUnitTest\u003c/p\u003e\n\n\u003cp\u003e\u003cfont color=\"ForestGreen\"\u003e\u003cstrong\u003eテスト対象\u003c/strong\u003e  \u003c/font\u003e(テストされる側)\u003cbr\u003e\nプロジェクト名： OutlookRecipientConfirmationAddin\u003cbr\u003e\nクラス名： Utility\u003cbr\u003e\nメソッド名：  GetRecipients\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eGetRecipientsメソッドのソースコードはこちら\u003cbr\u003e\n\u003c/summary\u003e\u003cdiv\u003e  \n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eUtility.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// アイテムから、宛先(Recipient)のリスト取得する\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"Item\"\u0026gt;Outlookアイテムオブジェクト\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"type\"\u0026gt;アイテムの種類\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"IgnoreMeetingResponse\"\u0026gt;会議招集の返信かどうか\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;returns\u0026gt;Recipientsインスタンス(会議招集の返信や、MailItem,MeetingItem,AppointmentItemでない場合null)\u0026lt;/returns\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetRecipients\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003eItem\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eOutlookItemType\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eIgnoreMeetingResponse\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipients\u003c/span\u003e \u003cspan class=\"n\"\u003erecipients\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisAppointmentItem\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMailItem\u003c/span\u003e \u003cspan class=\"n\"\u003email\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eItem\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMailItem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// MailItemの場合\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003email\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003erecipients\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipients\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eOutlookItemType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMail\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// (中略)\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eItem\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReportItem\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReportItem\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eItem\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReportItem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e//ReportItemのままだと送信先が取れないため、\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e//いったんIPM.Noteとして別名保存⇒ロードしてからRecipientsを取得する\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReportItem\u003c/span\u003e \u003cspan class=\"n\"\u003ecopiedReport\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCopy\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecopiedReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageClass\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"IPM.Note\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecopiedReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSave\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e//IPM.Noteとして保存してからロードするとMailItemとして扱えるようになる\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enewReportItem\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGlobals\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eThisAddIn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSession\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetItemFromID\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecopiedReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntryID\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMailItem\u003c/span\u003e \u003cspan class=\"n\"\u003enewMailItem\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enewReportItem\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMailItem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003erecipients\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enewMailItem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipients\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eOutlookItemType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReport\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003ecopiedReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelete\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 受信者の情報をリストに入れる\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003erecipientsList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eisAppointmentItem\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003erecipients\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// recipients[i]がBccまたはリソース\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erecipients\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOlMailRecipientType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eolBCC\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// Bccや、選択されたリソースの場合\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erecipients\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eSendable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003erecipientsList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erecipients\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 選択されていないリソースの場合\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 送信者、To、Ccの場合\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003erecipientsList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erecipients\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003erecipientsList\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"直面した問題たち\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%B4%E9%9D%A2%E3%81%97%E3%81%9F%E5%95%8F%E9%A1%8C%E3%81%9F%E3%81%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e直面した問題たち\u003c/h1\u003e\n\n\u003cp\u003e初心者の私が、単体テストを作成するにあたり、直面した問題は以下の通り。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e「テスト対象のクラス/メソッドにアクセスできない(publicでない)場合、どうすればテストできるのか？」\u003c/strong\u003e\u003cbr\u003e\n\u003cstrong\u003e「Outlookを起動しないテストプロジェクトから、どのようにGlobals.ThisAddinインスタンスを生成するか？」\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eセットアップメソッド（テストが実行される前、1度だけ実行されるメソッド）のコーディング時に\u003cbr\u003e\n少し頑張ることで、これらの問題を解決しました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"セットアップメソッドに記述したこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AB%E8%A8%98%E8%BF%B0%E3%81%97%E3%81%9F%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eセットアップメソッドに記述したこと\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-アセンブリでクラスメソッドの呼出し\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E3%81%A7%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%91%BC%E5%87%BA%E3%81%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. アセンブリでクラスメソッドの呼出し\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"背景\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%83%8C%E6%99%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e背景\u003c/h3\u003e\n\n\u003cp\u003eテストコードから、publicでないクラスやメソッドを呼出すと、ビルドエラーになります。\u003cbr\u003e\n「'〇〇〇（publicでないクラスやメソッド名）'はアクセスできない保護レベルになっています」\u003cbr\u003e\nとの事。\u003c/p\u003e\n\n\u003cp\u003eテストプロジェクトとテスト対象の、アクセシビリティの問題です\u003cimg alt=\":pensive:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f614.png\" title=\":pensive:\" width=\"20\" loading=\"lazy\"\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e問題「テスト対象のクラス/メソッドにアクセスできない(publicでない)場合、どうすればテストできるのか？」\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"解決策\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E6%B1%BA%E7%AD%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解決策\u003c/h3\u003e\n\n\u003cp\u003eズバリ、\u003cstrong\u003e「リフレクションを使った、アセンブリの動的呼出し」\u003c/strong\u003eです！\u003c/p\u003e\n\n\u003cp\u003eInit()メソッド内で、DLLファイルから動的にテスト対象のメソッドを呼び出しました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eGetRecipientsUnitTest.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eOneTimeSetUp\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//(中略)\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// アセンブリを読み込み、モジュールを取得\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e \u003cspan class=\"n\"\u003easm\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\".\\ORCAUnitTest\\bin\\Debug\\OutlookRecipientConfirmationAddin.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eModule\u003c/span\u003e \u003cspan class=\"n\"\u003emod\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003easm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetModule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"OutlookRecipientConfirmationAddin.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// テスト対象のクラス（Utility）のタイプを取得\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emod\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"OutlookRecipientConfirmationAddin.Utility\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// インスタンスを生成し、メソッドにアクセスできるようにする\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eActivator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMethodInfo\u003c/span\u003e \u003cspan class=\"n\"\u003emi\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"GetRecipients\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//(中略)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eまず、アセンブリからモジュールを取得。\u003cbr\u003e\nモジュールから、クラスの型(Type)を取得します。\u003cbr\u003e\n最後に、クラスの型からインスタンスを生成すると、\u003cstrong\u003eメソッドの属性 「mi」\u003c/strong\u003e を取得できます。  \u003c/p\u003e\n\n\u003cp\u003eセットアップメソッドでの下準備は、以上です。\u003c/p\u003e\n\n\u003cp\u003e次に、テストコードです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eGetRecipientsUnitTest.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eobjArray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003etestReport\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUtility\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOutlookItemType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMail\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003eactualObj\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eobjArray\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eInvoke\u003c/strong\u003e メソッドを使うと、テストしたいメソッドを呼び出せました！\u003cimg alt=\":clap:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44f.png\" title=\":clap:\" width=\"20\" loading=\"lazy\"\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-モックオブジェクトの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-%E3%83%A2%E3%83%83%E3%82%AF%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. モックオブジェクトの作成\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"背景-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%83%8C%E6%99%AF-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e背景\u003c/h3\u003e\n\n\u003cp\u003e例えば、テスト対象のメソッドには、このようなコードがあります。  \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eUtility.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003erecResolve\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGlobals\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eThisAddIn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSession\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAddress\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこのGlobals.ThisAddinインスタンスは、Outlook起動時に自動で生成されるものです。\u003cbr\u003e\nしかし、今回の単体テストはNUnitで実行するため、Outlookを起動しません。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e問題「Outlookを起動しないテストプロジェクトから、どのようにGlobals.ThisAddinインスタンスを生成するか？」\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"解決策-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E6%B1%BA%E7%AD%96-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解決策\u003c/h3\u003e\n\n\u003cp\u003eズバリ、\u003cstrong\u003e「モックオブジェクトを駆使する」\u003c/strong\u003eことです！\u003c/p\u003e\n\n\u003cp\u003e単体テストクラスからは、この「ThisAddIn」にアクセスできないので、\u003cstrong\u003e自分でThisAddInクラス\u003c/strong\u003eを作成します。\u003cbr\u003e\nNSubstituteを使い、あたかも本物の「ThisAddIn」が取得できたかのように、振る舞いを定義します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eGetRecipientsUnitTest.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eOneTimeSetUp\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//(中略)\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// ThisAddInクラスのインスタンスを生成\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eTestFactory\u003c/span\u003e \u003cspan class=\"n\"\u003etestFactory\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTestFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eIServiceProvider\u003c/span\u003e \u003cspan class=\"n\"\u003etestService\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSubstitute\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIServiceProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eThisAddIn\u003c/span\u003e \u003cspan class=\"n\"\u003etestAddIn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eThisAddIn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etestFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etestService\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// ThisAddInのApplicaitionフィールドを取得し、モックの値（testApp）をセット\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"n\"\u003etypeThisAddIn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etestAddIn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eFieldInfo\u003c/span\u003e \u003cspan class=\"n\"\u003efieldApp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeThisAddIn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Application\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNonPublic\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eApplication\u003c/span\u003e \u003cspan class=\"n\"\u003etestApp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSubstitute\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTestApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efieldApp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etestAddIn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etestApp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// モックのApplication（testApp）のSessionに値(tesNs)をセットする\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etestNs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSubstitute\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eNameSpace\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etestApp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSession\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReturns\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etestNs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// GlobalsのThisAddinプロパティに、モックなどを使って作った値(testAddIn)をセットする\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"n\"\u003etypeGlobal\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emod\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"OutlookRecipientConfirmationAddin.Globals\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ePropertyInfo\u003c/span\u003e \u003cspan class=\"n\"\u003etestProp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeGlobal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ThisAddIn\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNonPublic\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatic\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etestProp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etestAddIn\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// モックのApplication（testApp）のSessionに値(tesNS)をセットする\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etestNs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSubstitute\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eNameSpace\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etestApp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSession\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReturns\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etestNs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//(中略)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e少しややこしいですが、これでThisAddInやApplication、Sessionの偽装が完了です。\u003c/p\u003e\n\n\u003cp\u003e全てのテストケースで、モックオブジェクトに同じ動作を期待する処理は、\u003cbr\u003e\n以下のようなコードをセットアップメソッドに記述してもいいです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eGetRecipientsUnitTest.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eRecipient\u003c/span\u003e \u003cspan class=\"n\"\u003etestRec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSubstitute\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\u003cspan class=\"n\"\u003etestNs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eArg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAny\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()).\u003c/span\u003e\u003cspan class=\"nf\"\u003eReturns\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etestRec\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eここでは、私は \u003cstrong\u003e.Returns() メソッド\u003c/strong\u003eを使っています。\u003cbr\u003e\nテスト対象でCreateRecipientメソッドが呼ばれると、Recipient型の「testRec」が返却されるようになりました。\u003c/p\u003e\n\n\u003cp\u003eその他のモックについては、各テストコードで、テスト内容に応じてモックの動作の指定をします。  \u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"複数のテストクラスを同時に実行する場合の注意点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E5%90%8C%E6%99%82%E3%81%AB%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e複数のテストクラスを同時に実行する場合の注意点\u003c/h5\u003e\n\n\u003cp\u003eThisAddInクラスを、上記の手順で複数生成すると、\u003cstrong\u003eSystem.NotSupportedException\u003c/strong\u003e になります。\u003cbr\u003e\nその理由は、ThisAddInのコンストラクタにあります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eThisAddIn.Designer.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n        \u003cspan class=\"c1\"\u003e// (中略)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eThisAddIn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eglobal\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMicrosoft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOffice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTools\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFactory\u003c/span\u003e \u003cspan class=\"n\"\u003efactory\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eglobal\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIServiceProvider\u003c/span\u003e \u003cspan class=\"n\"\u003eserviceProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \n                \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efactory\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eserviceProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"AddIn\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ThisAddIn\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eGlobals\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFactory\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efactory\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// (中略)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eglobal\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMicrosoft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOffice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTools\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOutlook\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFactory\u003c/span\u003e \u003cspan class=\"n\"\u003eFactory\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003e_factory\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003e_factory\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003e_factory\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNotSupportedException\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// (中略)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eThisAddInのコンストラクタが、Factoryプロパティのセッターにアクセスする際に例外が発生したようです\u003cimg alt=\":warning:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/26a0-fe0f.png\" title=\":warning:\" width=\"20\" loading=\"lazy\"\u003e\u003c/p\u003e\n\n\u003cp\u003e手っ取り早い解決法は、ThisAddInクラスを一度生成したら、\u003cbr\u003e\n「そのインスタンスをクラス間で使い回す」ことです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"おまけテスト実行時に困ったこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91%E3%83%86%E3%82%B9%E3%83%88%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AB%E5%9B%B0%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおまけ：テスト実行時に困ったこと\u003c/h2\u003e\n\n\u003cp\u003eその他、単体テストで難しいと感じたポイントを1点紹介します。\u003cbr\u003e\n動的型付け変数である\u003cstrong\u003edynamic\u003c/strong\u003eと、モックについてです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"発生内容\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%99%BA%E7%94%9F%E5%86%85%E5%AE%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e発生内容\u003c/h3\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"手順\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%89%8B%E9%A0%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e　手順\u003c/h4\u003e\n\n\u003cp\u003eテストコード内で、先程紹介した通りにモックオブジェクトのメソッドの返り値を指定。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eGetRecipientsUnitTest.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eReportItem\u003c/span\u003e \u003cspan class=\"n\"\u003ereportItem\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSubstitute\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eReportItem\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\u003cspan class=\"n\"\u003ereportItem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCopy\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eReturns\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereportItem\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eテストコードの残りの部分も完成させ、テストを実行。  \u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"現象\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%8F%BE%E8%B1%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e　現象\u003c/h4\u003e\n\n\u003cp\u003e\u003cstrong\u003eRuntimeBinderException\u003c/strong\u003eが発生。\u003cbr\u003e\n追加情報:「'Castle.Proxies.ContactItemProxy'に'Returns'の定義がありません」\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ac959cf6e706a2e79d20af676ee71231fbe008c5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3234333333312f33643331616366632d626362392d313338642d326234342d6434333337366231353938642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F243331%2F3d31acfc-bcb9-138d-2b44-d43376b1598d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=63d9f13262c613f8b8bce988329f64ee\" alt=\"RuntimeBinderException.PNG\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/243331/3d31acfc-bcb9-138d-2b44-d43376b1598d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F243331%2F3d31acfc-bcb9-138d-2b44-d43376b1598d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=05533440f4338e2b204feb0af9f6c777 1x\" loading=\"lazy\"\u003e\u003c/a\u003e   \u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"解析内容\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E6%9E%90%E5%86%85%E5%AE%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解析内容\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e_ReportItem[メタデータから]\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003e_ReportItem\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//(中略)\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003edynamic\u003c/span\u003e \u003cspan class=\"nf\"\u003eCopy\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//(中略)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eCopy()メソッドの返り値が「dynamic」となっているので、上手くいかない模様。\u003c/p\u003e\n\n\u003cp\u003e単体テスト中、他にもdynamicを返すメソッドを通ることありましたが、\u003cbr\u003e\nそこでもRuntimeBinderException が発生しました\u003cimg alt=\":droplet:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f4a7.png\" title=\":droplet:\" width=\"20\" loading=\"lazy\"\u003e\u003cbr\u003e\nどうやら、\u003cstrong\u003eNSubstituteのモックでは、動的型付け変数（dynamic）をうまく扱えない\u003c/strong\u003eようです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"対応\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AF%BE%E5%BF%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e対応\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eReportItemインターフェースを実装した、TestReportItemクラスを作成\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMyTestClasses.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTestReportItem\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eReportItem\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//(中略)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOlInspectorClose\u003c/span\u003e \u003cspan class=\"n\"\u003eSaveMode\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003edynamic\u003c/span\u003e \u003cspan class=\"nf\"\u003eCopy\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eCopyHon\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"n\"\u003eReportItem\u003c/span\u003e \u003cspan class=\"nf\"\u003eCopyHon\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//(中略)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eCopyHon()\u003c/strong\u003eというメソッドを追加し、モックオブジェクトには、このメソッドを使ってもらうことにします。\u003cbr\u003e\nCopy()メソッドのreturn値に、ReportItem型を返すCopyHon()メソッドを指定。\u003c/p\u003e\n\n\u003cp\u003eテスト対象のメソッドでは、変わりなくCopy()メソッドを使います。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e「手順」で紹介したテストコード2行を、以下の通りに修正\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eGetRecipientsUnitTest.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eTestReportItem\u003c/span\u003e \u003cspan class=\"n\"\u003etestReport\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSubstitute\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTestReportItem\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\u003cspan class=\"n\"\u003etestReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCopyHon\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eReturns\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etestReport\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこうすると、モックオブジェクトがdynamicを返り値とするメソッドにアクセスしないようになります。\u003c/p\u003e\n\n\u003cp\u003e以上2点を修正すると、RuntimeBinderExceptionを回避でき、思い通りの動作になりました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"完成したテストメソッド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%8C%E6%88%90%E3%81%97%E3%81%9F%E3%83%86%E3%82%B9%E3%83%88%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e完成したテストメソッド\u003c/h2\u003e\n\n\u003cp\u003eそんなこんなで、遂に完成したテストメソッド！\u003cbr\u003e\n長いので折りたたんでおきますが、興味のある方はご覧ください。\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eソースコードはこちら\u003cbr\u003e\n\u003c/summary\u003e\u003cdiv\u003e  \n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eReportItemUnitTest.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// アイテムが、ReportItemの場合\u0026lt;/para\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 【期待結果】Recipientsを取得できる\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// TypeがReportになる\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eTest\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eReportItemRecipientsTest\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// モックでつかうデータを用意\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003etestRecNames\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"testemailaddress1@example.com\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"testemailaddress2@example.com\"\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003etestRecSendable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003etestRecType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eOlMailRecipientType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eolTo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eOlMailRecipientType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eolCC\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 期待結果を入れるリスト\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eexpectedRecList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eexpectedRecList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexpectedRec1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eexpectedRecList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexpectedRec2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003etestReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCopyHon\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eReturns\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etestReport\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// モックのReturn値と、期待結果のリストの値を設定\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMyTestNs\u003c/span\u003e \u003cspan class=\"n\"\u003emyTestNs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSubstitute\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMyTestNs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etestApp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSession\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReturns\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emyTestNs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emyTestNs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetItemFromIDHon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eArg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAny\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()).\u003c/span\u003e\u003cspan class=\"nf\"\u003eReturns\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etestMail\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// テストするメソッドにアクセスし、実際の結果を取得\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eobjArray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003etestReport\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUtility\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOutlookItemType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMail\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003eactualObj\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eobjArray\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// テスト対象メソッドの返り値をList\u0026lt;Recipient\u0026gt;型にする\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eactualRecList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eactualEnumList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;)\u003c/span\u003e\u003cspan class=\"n\"\u003eactualObj\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eactual\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eactualEnumList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eactualRecList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eactual\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"nf\"\u003eSetExpectedValues\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etestRecNames\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etestRecSendable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etestRecType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eexpectedRecList\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// actualとexpectedのリストを比較\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAreEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eactualRecList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eexpectedRecList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eCompareLists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eactualRecList\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eexpectedRecList\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// ref引数のtypeが正しいことを確認\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eThat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobjArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eIs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEqualTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUtility\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOutlookItemType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReport\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 期待する結果リストの値を設定するメソッド\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"testRecNames\"\u0026gt;Recipientのアドレス\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"testRecSendable\"\u0026gt;RecipientのSendableプロパティ\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"testRecType\"\u0026gt;RecipientのType\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"expectedRecList\"\u0026gt;期待結果のRecipient型リスト\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetExpectedValues\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003etestRecNames\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003etestRecSendable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003etestRecType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eexpectedRecList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etestRec\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etestRecNames\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eexpectedRecList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eAddress\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReturns\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etestRecNames\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eexpectedRecList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eSendable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etestRecSendable\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eexpectedRecList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etestRecType\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 実際の値と、期待する値を比較するメソッド\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"actualList\"\u0026gt;メソッドからもどってきたRecipient型リスト\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"expectedList\"\u0026gt;期待する結果を入れたRecipient型リスト\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCompareLists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eactualList\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eexpectedList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eexpectedList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eThat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eactualList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eAddress\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEqualTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexpectedList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eAddress\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eThat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eactualList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eSendable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEqualTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexpectedList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eSendable\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eThat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eactualList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEqualTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexpectedList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003eこの度は「\u003cstrong\u003eNSubstitute\u003c/strong\u003e」に、大々的にお世話になりました。\u003cbr\u003e\nテスト対象のクラスに渡すデータの偽装ができ、とても便利です。\u003c/p\u003e\n\n\u003cp\u003e既存のインターフェースやクラスを継承した、\u003cbr\u003e\n\u003cstrong\u003e自作クラス\u003c/strong\u003e（内容は、テストの都合の良いように変更する）を作成するのも必要不可欠ですね。\u003c/p\u003e\n\n\u003cp\u003eまた、VSTOアドインの開発者向け情報が、インターネットにあまりなく苦戦しました。\u003cbr\u003e\nMicrosoft社のOutlook VBAリファレンスだけでも、もう少し分かりやすいようにしてほしいところ。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"関連リンク参考にしたサイト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%A2%E9%80%A3%E3%83%AA%E3%83%B3%E3%82%AF%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e関連リンク・参考にしたサイト\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/ykinoshi1015/OutlookRecipientConfirmationAddin\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOutlook宛先表示アドイン\u003c/a\u003e ← 開発したアドインの配布元\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.ipentec.com/document/csharp-dynamic-load-assembly-use-reflection\" rel=\"nofollow noopener\" target=\"_blank\"\u003e動的にDLLファイルのクラスメソッドを呼び出す\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/sengoku/items/48f58f778a05f13f922e\" id=\"reference-522cf1d32d729d4b716f\"\u003e[C#][.NET] モックライブラリNSubstitute使い方メモ\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","createdAt":"2018-03-27T08:45:01Z","elapsedYearsFromLastModifiedAt":3,"encryptedId":"NOzae9Y+HI94q3/r3p6FRryzVVyhZKfY--vFEm3nFlgAU9Hgt3--tons7IcPRgvDEL2zJzMY4Q==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-03-28T06:52:23Z","likesCount":1,"linkUrl":"https://qiita.com/YunaNakanishi/items/b2fee27bea0ca5068569","organization":null,"originalId":623614,"stockedCount":2,"title":"NUnitでVSTOアドイン(Outlook)の単体テストを実施した話","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e概要\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\"\u003e開発環境\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cli\u003e\n\u003ca href=\"#%E6%A7%8B%E6%88%90\"\u003e構成\u003c/a\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#%E7%9B%B4%E9%9D%A2%E3%81%97%E3%81%9F%E5%95%8F%E9%A1%8C%E3%81%9F%E3%81%A1\"\u003e直面した問題たち\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AB%E8%A8%98%E8%BF%B0%E3%81%97%E3%81%9F%E3%81%93%E3%81%A8\"\u003eセットアップメソッドに記述したこと\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1-%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E3%81%A7%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%91%BC%E5%87%BA%E3%81%97\"\u003e1. アセンブリでクラスメソッドの呼出し\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%83%8C%E6%99%AF\"\u003e背景\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A7%A3%E6%B1%BA%E7%AD%96\"\u003e解決策\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-%E3%83%A2%E3%83%83%E3%82%AF%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e2. モックオブジェクトの作成\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%83%8C%E6%99%AF-1\"\u003e背景\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A7%A3%E6%B1%BA%E7%AD%96-1\"\u003e解決策\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E5%90%8C%E6%99%82%E3%81%AB%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e複数のテストクラスを同時に実行する場合の注意点\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91%E3%83%86%E3%82%B9%E3%83%88%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AB%E5%9B%B0%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003eおまけ：テスト実行時に困ったこと\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%99%BA%E7%94%9F%E5%86%85%E5%AE%B9\"\u003e発生内容\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%89%8B%E9%A0%86\"\u003e　手順\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%8F%BE%E8%B1%A1\"\u003e　現象\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A7%A3%E6%9E%90%E5%86%85%E5%AE%B9\"\u003e解析内容\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AF%BE%E5%BF%9C\"\u003e対応\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%8C%E6%88%90%E3%81%97%E3%81%9F%E3%83%86%E3%82%B9%E3%83%88%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e完成したテストメソッド\u003c/a\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%96%A2%E9%80%A3%E3%83%AA%E3%83%B3%E3%82%AF%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88\"\u003e関連リンク・参考にしたサイト\u003c/a\u003e\n\u003c/li\u003e\n\n","totalPv":2549,"uuid":"b2fee27bea0ca5068569","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"jlfkj9vcOkkJOQ4eBCeSYn32xRqj--NRw5Xz+Lk8r2+PO/--I4WBFlnnmgUxDXWbkSVmEw==","originalId":243331,"description":"0.2人前くらいのSE。温かい目で見守っていただけると嬉しいです。","facebookUrl":null,"githubUrl":"https://github.com/YunaNakanishi","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://avatars1.githubusercontent.com/u/29644865?v=4","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F29644865%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=83374972b91429253950c8d8aeee804c","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F29644865%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=22c4df0962a04df9839cd2f9651be38f","urlName":"YunaNakanishi","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"VisualStudio","urlName":"visualstudio"},{"name":"単体テスト","urlName":"%e5%8d%98%e4%bd%93%e3%83%86%e3%82%b9%e3%83%88"},{"name":"Outlook","urlName":"outlook"},{"name":"VSTO","urlName":"vsto"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

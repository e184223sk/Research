More than 1 year has passed since last update.DragMove便利なんですがやろうと思ってるScreenの縁へのスナップがうまいこといかず。
やりたいのは一定以上縁に近づいたら縁に吸着させるというもの。
VBの場合は
①ドラッグの開始時にウインドウのTOP・LEFTを取っておく
②ドラッグ中は左ボタンが押されてる間マージンのサイズを加算してカーソルポジションを算出し、ウインドウを算出座標にロケートする、というのような実装でOKでした。VB↓最初DragMoveを使わずにそのままC#に置き換えてみましたが、早いドラッグ操作に画面がついてこれません。で画面からカーソルアウトしてしまうと、そこで制御が失われます。
どうにも使えそうにないので、やはり反応がいいDragMoveを使い、以下のような手順に変更。
ドラッグ中のChangeLocationイベント内で、ウインドウの上下左右の座標がScreenのWorkingエリアにスナップマージンを加算・減算した範囲内になった場合、スナップ後の指定値にウインドウ位置を変更。
C#ではこんな感じで↓（G.SRには画面解像度が入ってます。1.25みたいな）結果、縁へのスナップは成功したのですが、枠外にドラッグし続けた場合ちらつきが発生します。見た感じ、DragMoveによっていったん枠外に描画して、そのあとLocationChanged内のSetWindowPosで枠内に描画している風。
解決策思いつかないので、このままでいくことに。




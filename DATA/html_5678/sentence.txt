More than 3 years have passed since last update.これはVisual Basic Advent Calendar 2017の23日の記事となります。お仕事で外部アプリケーションが出力するログを監視し、ある条件なら警告画面を前面に表示させる要望がありました。
【.NET】外部アプリケーションの画面上すべてのタイトル(キャプション)を取得するログなので最終行を読み込む処理を作る必要があるなと先走って作成してみたところ、そのログは先頭に行を追加されるようになっていたため、作り損になってしまいました。
まー先頭行を取得する処理はすごく簡単なんですが、最終行を取得する処理は結構面倒なんです。しかし、先頭に行を追加するってログって初めて見た。ログサイズが小さいからいいけど、全行をを読み込んで、先頭行に追加した上で全行を書き込む必要があるので処理コストが高いよね。何か理由があってそうしているんだろうけどさ。
Hey, Scripting Guy! テキスト ファイルの先頭に行を追加する方法はありますかTail関数には引数として、ファイル名、読込行数(デフォルト=1)、文字コード(デフォルト=UTF-8)を指定します。何か大きめなサイズのログがないかと検索してみたところ、以前インストールしたOracle Database 11g Express Edition(XE) のlistener.log が21MByteありましたので動かしてみました。
listener.log はUTF-8と思ったらShift-JISで作られてました。念のためサクラエディタでUTF-8に変換したのでも読み込みテストを行いました。サクラエディタで「listener.log」を読み込み末尾を表示。
Tail関数で「listener.log」の末尾6行を読み込んだ。
VisualBasic版となります。C#版となります。コード改変や配布は自由です。
このツールによる義務／責任を何ら負いません。もともとstackoverflowの記事を参考にC#で作成したのを、この記事用にVisualBasicで書き直しました。
汎用っぽく末尾からn行にしたけど、最終行だけだったらシンプルに作れるような気もします。あと、外部アプリケーション側で「別のプロセスで使用されているため、プロセスはファイル 'xxxxxx.xxx' にアクセスできません。」のエラーダイアログ画面がまれに表示されたため、別名ファイルにコピーした上で読む込むようにしました。



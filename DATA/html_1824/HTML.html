<!DOCTYPE html><html><head><meta charset="utf-8" /><title>診断用情報収集にSystem.Diagnostics.DiagnosticSourceを使う - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/skitoy4321/items/9d33e9ce93a9e66000fb" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="DGx2o5yfWwiM3reENzOh4FcfLzoANG3kILs9a4AnOGhCTP8PeYcYhEHQLPqHLLbJ9Yv4LJ2jBr2nJXZD6iZ7nQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@skitoy4321" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="診断用情報収集にSystem.Diagnostics.DiagnosticSourceを使う - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND02S2k2NXBhdDU1U281b09GNWFDeDVZLU82WnVHNDRHclUzbHpkR1Z0TGtScFlXZHViM04wYVdOekxrUnBZV2R1YjNOMGFXTlRiM1Z5WTJYamdwTGt2Yl9qZ1lZJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTM3ZTkyOTIxYzZkZjc3OTYzOTJjYjg1MzVkYmUzYjcx&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSE5yYVhSdmVUUXpNakUmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1jY2M1MmMxZWFiYjkwYjFjMmY5ZTYyZjVkZDk3ZmU4Zg&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=07620453a6e20f1d59788e96310ebb79"><meta property="og:description" content="

初めに

.NET Coreで、イベント情報収集のためにSystem.Diagnostics.DiagnosticSourceというものが追加された。

一応公式文書として DiagnosticsSource User&#39;s Gui..."><meta content="https://qiita.com/skitoy4321/items/9d33e9ce93a9e66000fb" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Diagnostics" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-4aaa2659-4504-42f0-9597-dd870d8b9099"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fskitoy4321%2Fitems%2F9d33e9ce93a9e66000fb">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fskitoy4321%2Fitems%2F9d33e9ce93a9e66000fb">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-4aaa2659-4504-42f0-9597-dd870d8b9099">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-03-03T23:59:43.000+09:00","dateModified":"2020-03-04T04:34:40.000+09:00","headline":"診断用情報収集にSystem.Diagnostics.DiagnosticSourceを使う","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND02S2k2NXBhdDU1U281b09GNWFDeDVZLU82WnVHNDRHclUzbHpkR1Z0TGtScFlXZHViM04wYVdOekxrUnBZV2R1YjNOMGFXTlRiM1Z5WTJYamdwTGt2Yl9qZ1lZJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTM3ZTkyOTIxYzZkZjc3OTYzOTJjYjg1MzVkYmUzYjcx\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSE5yYVhSdmVUUXpNakUmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1jY2M1MmMxZWFiYjkwYjFjMmY5ZTYyZjVkZDk3ZmU4Zg\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=07620453a6e20f1d59788e96310ebb79","mainEntityOfPage":"https://qiita.com/skitoy4321/items/9d33e9ce93a9e66000fb","author":{"@type":"Person","address":"","email":null,"identifier":"skitoy4321","name":"skitoy4321","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F103253%2Fprofile-images%2F1526359222?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=9623ed561bd61ca207da0cb6419ba01d","url":"https://qiita.com/skitoy4321","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"skitoy4321","type":"items","id":"9d33e9ce93a9e66000fb"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"skitoy4321","type":"items","id":"9d33e9ce93a9e66000fb"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"skitoy4321","type":"items","id":"9d33e9ce93a9e66000fb"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/skitoy4321/items/9d33e9ce93a9e66000fb","location":"/skitoy4321/items/9d33e9ce93a9e66000fb","scheme":"https","host":"qiita.com","port":null,"pathname":"/skitoy4321/items/9d33e9ce93a9e66000fb","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"8uNU52IcPs2r7XF5RhVPMzTJpKGmW2RKAn7B2y2mPZC8w91LhwR9QWbj6gf2Clgall1ztzvMDxOF4IrzR6d+ZQ==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-9108f300-a8c2-420e-9f1a-a3a768ae6b15"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/skitoy4321/items/9d33e9ce93a9e66000fb/likers" class="css-1iupg5d">12</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">16</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/9d33e9ce93a9e66000fb/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/skitoy4321/items/9d33e9ce93a9e66000fb/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/skitoy4321/items/9d33e9ce93a9e66000fb/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/skitoy4321/items/9d33e9ce93a9e66000fb/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/skitoy4321/items/9d33e9ce93a9e66000fb.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/skitoy4321"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/103253/profile-images/1526359222" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/skitoy4321" class="css-10ougpm">@<!-- -->skitoy4321</a><div class="css-1ay9vb9"><span><meta content="2020-03-03T14:59:43Z"/><time dateTime="2020-03-03T19:34:40Z" class="css-m19uds">updated at 2020-03-03</time></span></div></div></div></div></div><h1 class="css-cgzq40">診断用情報収集にSystem.Diagnostics.DiagnosticSourceを使う</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/diagnostics" class="css-4czcte">Diagnostics</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="初めに" class="fragment"></span><a href="#%E5%88%9D%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>初めに</h1>

<p>.NET Coreで、イベント情報収集のために<a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.diagnosticsource" rel="nofollow noopener" target="_blank">System.Diagnostics.DiagnosticSource</a>というものが追加された。</p>

<p>一応公式文書として <a href="https://github.com/dotnet/runtime/blob/e05718a2f810481cec6d2768aead9ba4580e3ddb/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md" rel="nofollow noopener" target="_blank">DiagnosticsSource User's Guide</a>はあるが、日本語リソースはあまりなく、かつガイドでも若干自分が知りたいことについてわかりにくい部分があったので記事を書こうと思う。<br>
DiagnosticSourceにはさらに<a href="https://github.com/dotnet/runtime/blob/e90b018a3b9f8f1df910a6c41522eaa860c753ac/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md" rel="nofollow noopener" target="_blank">Activity</a>というものも存在するが、記事が長くなるのでこれはまた別の機会に。</p>

<h1>
<span id="diagnosticsourceとは" class="fragment"></span><a href="#diagnosticsource%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>DiagnosticSourceとは</h1>

<p>簡単に言うと、動作中のアプリから、診断用のイベント情報を収集するためのクラス。<br>
ここでいう診断用のイベント情報とは、ロギング、トレース等、アプリケーションの状態を把握するために、アプリケーション内部から発信される情報を言う。<br>
特徴としては、</p>

<ul>
<li>インプロセスで動く

<ul>
<li>シリアライズしたり、ファイル等プロセス外に持ち出したりする場合には別途仕組みが必要</li>
<li>データをオブジェクトとして扱っているため、取り廻す間は余計なエスケープ処理等は不要</li>
</ul>
</li>
<li>ログ情報をC#のオブジェクトで共有可能</li>
<li>低負荷

<ul>
<li>例えばHTTPの1リクエストごとの所要時間などの、高頻度に発生すると予想される処理にも使うことを想定</li>
</ul>
</li>
<li>場所を選ばない

<ul>
<li>例えばライブラリの中でも使用可能</li>
</ul>
</li>
<li>ログを送信する側が主体

<ul>
<li>上層からロガーインスタンスを渡すのではなく、受信する側がイベントを購読するという形になる</li>
</ul>
</li>
<li>ピュアマネージド

<ul>
<li>ETW等の外部フレームワークに依存しない</li>
</ul>
</li>
</ul>

<p>ただ、</p>

<ul>
<li>受信側の処理を自前で書く必要がある

<ul>
<li>ファイルやコンソール出力も標準では存在しない</li>
</ul>
</li>
<li>イベントの仕様を決める必要がある</li>
<li>イベント発生時に渡す値は、必ずヒープに確保する必要がある(構造体の場合は必ずboxingする)</li>
</ul>

<p>という点があることも注意。</p>

<p>受信側の処理としては、<a href="https://opentelemetry.io" rel="nofollow noopener" target="_blank">opentelemetry</a>と組み合わせることで、多様なプラットフォームに情報を送信することも可能となる。実際<a href="https://github.com/open-telemetry/opentelemetry-dotnet" rel="nofollow noopener" target="_blank">opentelemetryのdotnet実装</a>では、<a href="https://github.com/open-telemetry/opentelemetry-dotnet/blob/0c92b3e054f26fbcfe0b43e47094797ef431961a/src/OpenTelemetry.Collector.Dependencies/Implementation/HttpHandlerDiagnosticListener.cs" rel="nofollow noopener" target="_blank">System.Net.Http.HttpClientの統計情報の取得を行うモジュール</a>を、<a href="https://github.com/dotnet/runtime/blob/e90b018a3b9f8f1df910a6c41522eaa860c753ac/src/libraries/System.Net.Http/src/HttpDiagnosticsGuide.md" rel="nofollow noopener" target="_blank">HttpClientが提供するDiagnosticSource</a>を使って実現している。</p>

<h2>
<span id="iloggerとの比較" class="fragment"></span><a href="#ilogger%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83"><i class="fa fa-link"></i></a>ILoggerとの比較</h2>

<p>現在のdotnetのメジャーなロギングフレームワークとして、<a href="https://docs.microsoft.com/ja-jp/dotnet/api/microsoft.extensions.logging.ilogger" rel="nofollow noopener" target="_blank">Microsoft.Extensions.Logging.ILogger</a>とその仲間たちがある。<br>
これはロギングにおいては確かに優秀ではあるが、ログのメイン情報が不定形な文字列であるという前提があるため、型付の情報を扱う場合に、文字列のパース等でオーバーヘッドが大きくなるという欠点がある。<br>
よって、エラー等の不定形な情報を単純にファイルに記録したい等の用途には向いていると思うが、例えば処理経過時間の統計を取りたいという時には、jsonやcsv等の特定の形式に出力して解析する等、回りくどい方法をとる必要があり、また効率も良くない。<br>
それに対して、DiagnosticSourceはイベント受信時点でobjectの状態で渡されるため、キャストの必要はあるものの、型情報を失うことなく統計情報を効率的にトレースサービスに送信することが可能となる。</p>

<p>また、ILoggerは基本的に上層から渡されたILoggerインスタンスを使うという仕組みのため、必ずILoggerを受け取る口を作らなければならず、ライブラリ側がILoggerの取り廻しに苦労してしまう場合がある。</p>

<h2>
<span id="eventsourceとの比較" class="fragment"></span><a href="#eventsource%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83"><i class="fa fa-link"></i></a>EventSourceとの比較</h2>

<p>さて、イベント収集というと、既存の仕組みでも様々あるが、中でも役割が一番重なるのが<a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.tracing.eventsource" rel="nofollow noopener" target="_blank">EventSource</a>だろう。<br>
EventSourceも昔からあるが、ETWやLTTng等、プラットフォームが持つトレースフレームワークに依存しているのが特徴で、これに由来する制約もあったりする(シリアライズ可能な型しか渡しちゃダメとか)。</p>

<p>ただし、フレームワークに依存する強みとして、外部からの情報取得が容易(<a href="https://docs.microsoft.com/en-us/dotnet/core/diagnostics/dotnet-trace" rel="nofollow noopener" target="_blank">dotnet-trace</a>や、APIからの取得等)という点や、ログ出力のオーバーヘッドが小さい特徴がある。</p>

<p>どちらがいいのという話であれば、個人的には制約が少ないDiagnosticSourceを使うのがいいと思う。出力方法については頑張るという感じで。<br>
一応<a href="https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/System/Diagnostics/DiagnosticSourceEventSource.cs" rel="nofollow noopener" target="_blank">DiagnosticSourceからEventSourceへの出力</a>というものもあるので、どうしてもEventSourceを使う要件が出てきたならば、こちらを使うこともできる(使い方は少々面倒だったりするが)。</p>

<h1>
<span id="使用方法" class="fragment"></span><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>使用方法</h1>

<h2>
<span id="準備" class="fragment"></span><a href="#%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>準備</h2>

<p>まず、機能を使うための準備を行う。netcoreappでは1.0のころからあるものなので、特に準備の必要はないが、netstandardでは2.1でも追加はされていないため、ライブラリプロジェクト等で使う場合は<a href="https://www.nuget.org/packages/System.Diagnostics.DiagnosticSource/" rel="nofollow noopener" target="_blank">nugetで追加する必要がある</a>。</p>

<p>追加されれば、<code>System.Diagnostics.DiagnosticSource</code>と<code>System.Dianostics.DiagnosticListener</code>が使用できるようになっているはず。</p>

<h2>
<span id="イベント送信側" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E9%80%81%E4%BF%A1%E5%81%B4"><i class="fa fa-link"></i></a>イベント送信側</h2>

<p>イベントを送信するには、以下のような実装が必要。</p>

<ol>
<li>内部で名前を付けてDiagnosticListener生成

<ul>
<li>生成時点でグローバルなDiagnosticListener.AllListeners(型は<code>IObservable&lt;DiagnosticListener&gt;</code>)に登録される</li>
</ul>
</li>
<li>生成したDiagnosticListenerをDiagnosticsSourceにキャストして内部に保持</li>
<li>
<code>DiagnosticSource.IsEnabled("[イベント名等]")</code>で出力するか判定

<ul>
<li>後で使用するイベント名に合わせる必要はないが、関連性は持たせた方が良い</li>
</ul>
</li>
<li>
<code>DiagnosticSource.Write("[イベント名]", [イベントに付随するobject])</code>を実行してログ出力</li>
</ol>

<p>注意点として、DiagnosticListenerは名前(Nameプロパティ)でその一意性を判断するように設計されているため、DiagnosticListenerの名前つけは非常に重要な要素となる。<br>
dotnet core開発チームが推奨しているルールとしては、</p>

<ul>
<li>DiagnosticListenerの名前はクラスの名前空間分けのようにする("."で区切る)</li>
<li>頻度が高いイベントと低いイベントが存在する場合、DiagnosticListenerを分ける</li>
<li>名前の後に"Listener"を付けない</li>
<li>イベント名は短めに(16文字以内)</li>
<li>始まりと終わりがあるイベントには<a href="https://github.com/dotnet/runtime/blob/e90b018a3b9f8f1df910a6c41522eaa860c753ac/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md" rel="nofollow noopener" target="_blank">Activity</a>を使用する</li>
<li>何らかの事情があってActivityを使えない場合は、イベントの末尾にそれぞれ"Start"と"Stop"を付ける</li>
<li>Writeする前に必ずIsEnabledで有効かどうか確認する

<ul>
<li>余計なオブジェクト生成等のオーバーヘッドを防ぐため</li>
</ul>
</li>
<li>Writeで渡すオブジェクトは匿名オブジェクトを基本とするが、データが巨大になる場合はインスタンスの使い回しも考える

<ul>
<li>生存期間の問題が出てくるが</li>
</ul>
</li>
<li>DiagnosticListenerはpublicにせず、AllListeners経由でSubscribeさせるようにする</li>
</ul>

<p>等がある。ただし、これらはあくまでも推奨なので、従わなくても良い。</p>

<h2>
<span id="イベント受信側" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E5%8F%97%E4%BF%A1%E5%81%B4"><i class="fa fa-link"></i></a>イベント受信側</h2>

<p>受信する側は以下の処理が必要</p>

<ol>
<li>
<a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.diagnosticlistener.alllisteners" rel="nofollow noopener" target="_blank"><code>System.Diagnostics.DiagnosticListener.AllListeners(IObservable&lt;DiagnosticListener&gt;)</code></a>をSubscribeして、どのDiagnosticListenerを使用するか選択</li>
<li>Subscribeの中で、受信するものを<code>Name</code>で判断して、<a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.diagnosticlistener.subscribe" rel="nofollow noopener" target="_blank">Subscribe</a>する

<ul>
<li>この時、第二引数に<code>Func&lt;string, object, object&gt;</code>または<code>Predicate&lt;string&gt;</code>をとるものがあるが、これは<code>DiagnosticSource.IsEnabled("[イベント名]")</code>または<code>DiagnosticSource.IsEnabled("[イベント名]", object, object)</code>を実行したときに呼ばれるものとなり、デフォルトは常にtrueとなる</li>
<li>Subscribeの中で、イベントを処理する</li>
<li>Subscribeの中では基本的にasyncは使えないと思っていいので、非同期性を重視するならば、System.Threading.Channelsに処理を投げるのもあり(オブジェクトの生存期間に注意)</li>
<li>とりあえず出したいだけならばILogger等の他のフレームワークに丸投げするのもいいかも</li>
</ul>
</li>
</ol>

<h1>
<span id="実装例" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E4%BE%8B"><i class="fa fa-link"></i></a>実装例</h1>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// added System.Reactive and System.Diagnostics.DiagnosticSource to PackageReference </span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Diagnostics.Tracing</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Diagnostics</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">diagtest</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">SampleClass</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">DiagnosticName</span> <span class="p">=</span> <span class="s">"dntracetest.SampleClass"</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">DiagnosticListener</span> <span class="n">_listener</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DiagnosticListener</span><span class="p">(</span><span class="n">DiagnosticName</span><span class="p">);</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">X</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"X"</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">_listener</span><span class="p">.</span><span class="nf">IsEnabled</span><span class="p">(</span><span class="s">"Event1"</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">_listener</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">"Event1"</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">X</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">Y</span> <span class="p">=</span> <span class="s">"aaa"</span> <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">DiagnosticListener</span><span class="p">.</span><span class="n">AllListeners</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">dl</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">dl</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="n">SampleClass</span><span class="p">.</span><span class="n">DiagnosticName</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">dl</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">kv</span> <span class="p">=&gt;</span>
                    <span class="p">{</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"event written: </span><span class="p">{</span><span class="n">kv</span><span class="p">.</span><span class="n">Key</span><span class="p">}</span><span class="s">, </span><span class="p">{</span><span class="n">kv</span><span class="p">.</span><span class="n">Value</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">});</span>
            <span class="k">new</span> <span class="nf">SampleClass</span><span class="p">().</span><span class="nf">X</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<h1>
<span id="便利ツール" class="fragment"></span><a href="#%E4%BE%BF%E5%88%A9%E3%83%84%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>便利ツール</h1>

<h2>
<span id="microsoftextensionsdiagnosticadapter" class="fragment"></span><a href="#microsoftextensionsdiagnosticadapter"><i class="fa fa-link"></i></a>Microsoft.Extensions.DiagnosticAdapter</h2>

<p>dotnet/extensionsから提供されているもので、NuGetで取得可能(<a href="https://www.nuget.org/packages/Microsoft.Extensions.DiagnosticAdapter/" rel="nofollow noopener" target="_blank">Microsoft.Extensions.DiagnosticAdapter</a>)<br>
Subscribeの引数をより楽に記述できるようにしよう、という趣旨のライブラリ。</p>

<p>参照を追加すると、以下の機能が拡張メソッドとして使用できる</p>

<ul>
<li><code>DiagnosticListener.SubscribeWithAdapter(object target)</code></li>
<li><code>DiagnosticListener.SubscribeWithAdapter(object target, Func&lt;string, bool&gt; isEnabled)</code></li>
<li><code>DiagnosticListener.SubscribeWithAdapter(object target, Func&lt;string, object, object, bool&gt; isEnabled)</code></li>
</ul>

<p>isEnabledは<code>DiagnosticSource.IsEnabled</code>で使用されるものということで分かりやすい。しかし、第一引数のobjectは説明も少ないため使い方がわかり辛い。</p>

<p>例えば、以下のようにDiagnosticSourceを使用しているクラスがあったとする。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Hoge</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">DiagnosticSource</span> <span class="n">_src</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DiagnosticListener</span><span class="p">(</span><span class="s">"Hoge"</span><span class="p">);</span>
    <span class="k">public</span> <span class="nf">F</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">_src</span><span class="p">.</span><span class="nf">IsEnabled</span><span class="p">(</span><span class="s">"EventName1"</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">src</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">"EventName1"</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">X</span> <span class="p">=</span> <span class="s">"aaa"</span><span class="p">,</span> <span class="n">Y</span> <span class="p">=</span> <span class="m">1</span> <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>targetとして、以下のようなクラスを実装する。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">X</span>
<span class="p">{</span>
  <span class="c1">// 引数を指定しない場合は[DiagnosticName("[メソッド名]")]と等価</span>
  <span class="p">[</span><span class="nf">DiagnosticName</span><span class="p">(</span><span class="s">"EventName1"</span><span class="p">)]</span>
  <span class="k">public</span> <span class="k">void</span> <span class="nf">OnEventName1</span><span class="p">(</span><span class="kt">string</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
  <span class="p">{</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ポイントは2点</p>

<ul>
<li>
<code>[DiagnosticName("[EventName]")]</code>属性を付ける</li>
<li>引数に、イベント時に指定されるオブジェクトの <strong>メンバー名</strong> と同じ名前(大文字小文字の違いはOK)を指定する</li>
</ul>

<p>以上のクラスを作り、以下のようにする</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">DiagnosticListener</span><span class="p">.</span><span class="n">AllListeners</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">d</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"Hoge"</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">d</span><span class="p">.</span><span class="nf">SubscribeWithAdapter</span><span class="p">(</span><span class="k">new</span> <span class="nf">X</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>すると、リフレクションを使って対応するイベント名に対して自動的に振り分けてメソッドを実行してくれるように設定を行ってくれる。なお、戻り値は見ないので、<code>async Task</code>を使うとおかしなことになるので注意。</p>

<h1>
<span id="終わりに" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>終わりに</h1>

<p>DiagnosticSourceは単純にログを出力するには面倒な部分もあるが、やはりちゃんとした統計情報を取りたい場合は避けて通れない道だろうとは思う。<br>
また、ライブラリ側で何らかのログ機構を作りたい場合、上からILoggerを受け取るよりもすっきりした設計にできるので、ライブラリを作成している場合は有用だろう。</p>

<p>今回は紹介していないが、EventSourceに流す方法や、Activityの使い方も、そのうち記事にしてみたい。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fskitoy4321%2Fitems%2F9d33e9ce93a9e66000fb&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fskitoy4321%2Fitems%2F9d33e9ce93a9e66000fb&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/skitoy4321/items/9d33e9ce93a9e66000fb/likers" class="css-1iupg5d">12</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">16</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/9d33e9ce93a9e66000fb/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/skitoy4321/items/9d33e9ce93a9e66000fb/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/skitoy4321/items/9d33e9ce93a9e66000fb/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/skitoy4321/items/9d33e9ce93a9e66000fb/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/skitoy4321/items/9d33e9ce93a9e66000fb.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-9108f300-a8c2-420e-9f1a-a3a768ae6b15">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-5cfdc13a-2b76-43ed-97a6-7684b1986359"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-5cfdc13a-2b76-43ed-97a6-7684b1986359">{}</script>
      
<div id="LoginModal-react-component-00215046-18ab-4b4c-aa20-bd143c56b3b0"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-00215046-18ab-4b4c-aa20-bd143c56b3b0">{}</script>
      
<div id="StockModal-react-component-239cc9eb-40ca-4f08-8195-c3af0f5ebfad"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-239cc9eb-40ca-4f08-8195-c3af0f5ebfad">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;hZmErNnCQRZIf5pK6Gxp/om912jB6p/ONYs92PCLwsPLuQ0APNoCmoVxATRYc37XKykAflx99JeyFXbwmoqBNg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"初めに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%9D%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e初めに\u003c/h1\u003e\n\n\u003cp\u003e.NET Coreで、イベント情報収集のために\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.diagnosticsource\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSystem.Diagnostics.DiagnosticSource\u003c/a\u003eというものが追加された。\u003c/p\u003e\n\n\u003cp\u003e一応公式文書として \u003ca href=\"https://github.com/dotnet/runtime/blob/e05718a2f810481cec6d2768aead9ba4580e3ddb/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDiagnosticsSource User's Guide\u003c/a\u003eはあるが、日本語リソースはあまりなく、かつガイドでも若干自分が知りたいことについてわかりにくい部分があったので記事を書こうと思う。\u003cbr\u003e\nDiagnosticSourceにはさらに\u003ca href=\"https://github.com/dotnet/runtime/blob/e90b018a3b9f8f1df910a6c41522eaa860c753ac/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md\" rel=\"nofollow noopener\" target=\"_blank\"\u003eActivity\u003c/a\u003eというものも存在するが、記事が長くなるのでこれはまた別の機会に。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"diagnosticsourceとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#diagnosticsource%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDiagnosticSourceとは\u003c/h1\u003e\n\n\u003cp\u003e簡単に言うと、動作中のアプリから、診断用のイベント情報を収集するためのクラス。\u003cbr\u003e\nここでいう診断用のイベント情報とは、ロギング、トレース等、アプリケーションの状態を把握するために、アプリケーション内部から発信される情報を言う。\u003cbr\u003e\n特徴としては、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eインプロセスで動く\n\n\u003cul\u003e\n\u003cli\u003eシリアライズしたり、ファイル等プロセス外に持ち出したりする場合には別途仕組みが必要\u003c/li\u003e\n\u003cli\u003eデータをオブジェクトとして扱っているため、取り廻す間は余計なエスケープ処理等は不要\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eログ情報をC#のオブジェクトで共有可能\u003c/li\u003e\n\u003cli\u003e低負荷\n\n\u003cul\u003e\n\u003cli\u003e例えばHTTPの1リクエストごとの所要時間などの、高頻度に発生すると予想される処理にも使うことを想定\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e場所を選ばない\n\n\u003cul\u003e\n\u003cli\u003e例えばライブラリの中でも使用可能\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eログを送信する側が主体\n\n\u003cul\u003e\n\u003cli\u003e上層からロガーインスタンスを渡すのではなく、受信する側がイベントを購読するという形になる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eピュアマネージド\n\n\u003cul\u003e\n\u003cli\u003eETW等の外部フレームワークに依存しない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eただ、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e受信側の処理を自前で書く必要がある\n\n\u003cul\u003e\n\u003cli\u003eファイルやコンソール出力も標準では存在しない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eイベントの仕様を決める必要がある\u003c/li\u003e\n\u003cli\u003eイベント発生時に渡す値は、必ずヒープに確保する必要がある(構造体の場合は必ずboxingする)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eという点があることも注意。\u003c/p\u003e\n\n\u003cp\u003e受信側の処理としては、\u003ca href=\"https://opentelemetry.io\" rel=\"nofollow noopener\" target=\"_blank\"\u003eopentelemetry\u003c/a\u003eと組み合わせることで、多様なプラットフォームに情報を送信することも可能となる。実際\u003ca href=\"https://github.com/open-telemetry/opentelemetry-dotnet\" rel=\"nofollow noopener\" target=\"_blank\"\u003eopentelemetryのdotnet実装\u003c/a\u003eでは、\u003ca href=\"https://github.com/open-telemetry/opentelemetry-dotnet/blob/0c92b3e054f26fbcfe0b43e47094797ef431961a/src/OpenTelemetry.Collector.Dependencies/Implementation/HttpHandlerDiagnosticListener.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSystem.Net.Http.HttpClientの統計情報の取得を行うモジュール\u003c/a\u003eを、\u003ca href=\"https://github.com/dotnet/runtime/blob/e90b018a3b9f8f1df910a6c41522eaa860c753ac/src/libraries/System.Net.Http/src/HttpDiagnosticsGuide.md\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHttpClientが提供するDiagnosticSource\u003c/a\u003eを使って実現している。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"iloggerとの比較\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ilogger%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eILoggerとの比較\u003c/h2\u003e\n\n\u003cp\u003e現在のdotnetのメジャーなロギングフレームワークとして、\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/api/microsoft.extensions.logging.ilogger\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMicrosoft.Extensions.Logging.ILogger\u003c/a\u003eとその仲間たちがある。\u003cbr\u003e\nこれはロギングにおいては確かに優秀ではあるが、ログのメイン情報が不定形な文字列であるという前提があるため、型付の情報を扱う場合に、文字列のパース等でオーバーヘッドが大きくなるという欠点がある。\u003cbr\u003e\nよって、エラー等の不定形な情報を単純にファイルに記録したい等の用途には向いていると思うが、例えば処理経過時間の統計を取りたいという時には、jsonやcsv等の特定の形式に出力して解析する等、回りくどい方法をとる必要があり、また効率も良くない。\u003cbr\u003e\nそれに対して、DiagnosticSourceはイベント受信時点でobjectの状態で渡されるため、キャストの必要はあるものの、型情報を失うことなく統計情報を効率的にトレースサービスに送信することが可能となる。\u003c/p\u003e\n\n\u003cp\u003eまた、ILoggerは基本的に上層から渡されたILoggerインスタンスを使うという仕組みのため、必ずILoggerを受け取る口を作らなければならず、ライブラリ側がILoggerの取り廻しに苦労してしまう場合がある。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"eventsourceとの比較\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#eventsource%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEventSourceとの比較\u003c/h2\u003e\n\n\u003cp\u003eさて、イベント収集というと、既存の仕組みでも様々あるが、中でも役割が一番重なるのが\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.tracing.eventsource\" rel=\"nofollow noopener\" target=\"_blank\"\u003eEventSource\u003c/a\u003eだろう。\u003cbr\u003e\nEventSourceも昔からあるが、ETWやLTTng等、プラットフォームが持つトレースフレームワークに依存しているのが特徴で、これに由来する制約もあったりする(シリアライズ可能な型しか渡しちゃダメとか)。\u003c/p\u003e\n\n\u003cp\u003eただし、フレームワークに依存する強みとして、外部からの情報取得が容易(\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/core/diagnostics/dotnet-trace\" rel=\"nofollow noopener\" target=\"_blank\"\u003edotnet-trace\u003c/a\u003eや、APIからの取得等)という点や、ログ出力のオーバーヘッドが小さい特徴がある。\u003c/p\u003e\n\n\u003cp\u003eどちらがいいのという話であれば、個人的には制約が少ないDiagnosticSourceを使うのがいいと思う。出力方法については頑張るという感じで。\u003cbr\u003e\n一応\u003ca href=\"https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/System/Diagnostics/DiagnosticSourceEventSource.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDiagnosticSourceからEventSourceへの出力\u003c/a\u003eというものもあるので、どうしてもEventSourceを使う要件が出てきたならば、こちらを使うこともできる(使い方は少々面倒だったりするが)。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"使用方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使用方法\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e準備\u003c/h2\u003e\n\n\u003cp\u003eまず、機能を使うための準備を行う。netcoreappでは1.0のころからあるものなので、特に準備の必要はないが、netstandardでは2.1でも追加はされていないため、ライブラリプロジェクト等で使う場合は\u003ca href=\"https://www.nuget.org/packages/System.Diagnostics.DiagnosticSource/\" rel=\"nofollow noopener\" target=\"_blank\"\u003enugetで追加する必要がある\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003e追加されれば、\u003ccode\u003eSystem.Diagnostics.DiagnosticSource\u003c/code\u003eと\u003ccode\u003eSystem.Dianostics.DiagnosticListener\u003c/code\u003eが使用できるようになっているはず。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"イベント送信側\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E9%80%81%E4%BF%A1%E5%81%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイベント送信側\u003c/h2\u003e\n\n\u003cp\u003eイベントを送信するには、以下のような実装が必要。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e内部で名前を付けてDiagnosticListener生成\n\n\u003cul\u003e\n\u003cli\u003e生成時点でグローバルなDiagnosticListener.AllListeners(型は\u003ccode\u003eIObservable\u0026lt;DiagnosticListener\u0026gt;\u003c/code\u003e)に登録される\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e生成したDiagnosticListenerをDiagnosticsSourceにキャストして内部に保持\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eDiagnosticSource.IsEnabled(\"[イベント名等]\")\u003c/code\u003eで出力するか判定\n\n\u003cul\u003e\n\u003cli\u003e後で使用するイベント名に合わせる必要はないが、関連性は持たせた方が良い\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eDiagnosticSource.Write(\"[イベント名]\", [イベントに付随するobject])\u003c/code\u003eを実行してログ出力\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e注意点として、DiagnosticListenerは名前(Nameプロパティ)でその一意性を判断するように設計されているため、DiagnosticListenerの名前つけは非常に重要な要素となる。\u003cbr\u003e\ndotnet core開発チームが推奨しているルールとしては、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eDiagnosticListenerの名前はクラスの名前空間分けのようにする(\".\"で区切る)\u003c/li\u003e\n\u003cli\u003e頻度が高いイベントと低いイベントが存在する場合、DiagnosticListenerを分ける\u003c/li\u003e\n\u003cli\u003e名前の後に\"Listener\"を付けない\u003c/li\u003e\n\u003cli\u003eイベント名は短めに(16文字以内)\u003c/li\u003e\n\u003cli\u003e始まりと終わりがあるイベントには\u003ca href=\"https://github.com/dotnet/runtime/blob/e90b018a3b9f8f1df910a6c41522eaa860c753ac/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md\" rel=\"nofollow noopener\" target=\"_blank\"\u003eActivity\u003c/a\u003eを使用する\u003c/li\u003e\n\u003cli\u003e何らかの事情があってActivityを使えない場合は、イベントの末尾にそれぞれ\"Start\"と\"Stop\"を付ける\u003c/li\u003e\n\u003cli\u003eWriteする前に必ずIsEnabledで有効かどうか確認する\n\n\u003cul\u003e\n\u003cli\u003e余計なオブジェクト生成等のオーバーヘッドを防ぐため\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eWriteで渡すオブジェクトは匿名オブジェクトを基本とするが、データが巨大になる場合はインスタンスの使い回しも考える\n\n\u003cul\u003e\n\u003cli\u003e生存期間の問題が出てくるが\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eDiagnosticListenerはpublicにせず、AllListeners経由でSubscribeさせるようにする\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e等がある。ただし、これらはあくまでも推奨なので、従わなくても良い。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"イベント受信側\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E5%8F%97%E4%BF%A1%E5%81%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイベント受信側\u003c/h2\u003e\n\n\u003cp\u003e受信する側は以下の処理が必要\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.diagnosticlistener.alllisteners\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eSystem.Diagnostics.DiagnosticListener.AllListeners(IObservable\u0026lt;DiagnosticListener\u0026gt;)\u003c/code\u003e\u003c/a\u003eをSubscribeして、どのDiagnosticListenerを使用するか選択\u003c/li\u003e\n\u003cli\u003eSubscribeの中で、受信するものを\u003ccode\u003eName\u003c/code\u003eで判断して、\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.diagnosticlistener.subscribe\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSubscribe\u003c/a\u003eする\n\n\u003cul\u003e\n\u003cli\u003eこの時、第二引数に\u003ccode\u003eFunc\u0026lt;string, object, object\u0026gt;\u003c/code\u003eまたは\u003ccode\u003ePredicate\u0026lt;string\u0026gt;\u003c/code\u003eをとるものがあるが、これは\u003ccode\u003eDiagnosticSource.IsEnabled(\"[イベント名]\")\u003c/code\u003eまたは\u003ccode\u003eDiagnosticSource.IsEnabled(\"[イベント名]\", object, object)\u003c/code\u003eを実行したときに呼ばれるものとなり、デフォルトは常にtrueとなる\u003c/li\u003e\n\u003cli\u003eSubscribeの中で、イベントを処理する\u003c/li\u003e\n\u003cli\u003eSubscribeの中では基本的にasyncは使えないと思っていいので、非同期性を重視するならば、System.Threading.Channelsに処理を投げるのもあり(オブジェクトの生存期間に注意)\u003c/li\u003e\n\u003cli\u003eとりあえず出したいだけならばILogger等の他のフレームワークに丸投げするのもいいかも\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実装例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装例\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// added System.Reactive and System.Diagnostics.DiagnosticSource to PackageReference \u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Diagnostics.Tracing\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Diagnostics\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003ediagtest\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSampleClass\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eDiagnosticName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"dntracetest.SampleClass\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eDiagnosticListener\u003c/span\u003e \u003cspan class=\"n\"\u003e_listener\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDiagnosticListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDiagnosticName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eX\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"X\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_listener\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Event1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003e_listener\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Event1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"aaa\"\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDiagnosticListener\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAllListeners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eSampleClass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDiagnosticName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003edl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekv\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"event written: \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ekv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eKey\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e, \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ekv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSampleClass\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eX\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"便利ツール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BE%BF%E5%88%A9%E3%83%84%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e便利ツール\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"microsoftextensionsdiagnosticadapter\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#microsoftextensionsdiagnosticadapter\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMicrosoft.Extensions.DiagnosticAdapter\u003c/h2\u003e\n\n\u003cp\u003edotnet/extensionsから提供されているもので、NuGetで取得可能(\u003ca href=\"https://www.nuget.org/packages/Microsoft.Extensions.DiagnosticAdapter/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMicrosoft.Extensions.DiagnosticAdapter\u003c/a\u003e)\u003cbr\u003e\nSubscribeの引数をより楽に記述できるようにしよう、という趣旨のライブラリ。\u003c/p\u003e\n\n\u003cp\u003e参照を追加すると、以下の機能が拡張メソッドとして使用できる\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eDiagnosticListener.SubscribeWithAdapter(object target)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eDiagnosticListener.SubscribeWithAdapter(object target, Func\u0026lt;string, bool\u0026gt; isEnabled)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eDiagnosticListener.SubscribeWithAdapter(object target, Func\u0026lt;string, object, object, bool\u0026gt; isEnabled)\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eisEnabledは\u003ccode\u003eDiagnosticSource.IsEnabled\u003c/code\u003eで使用されるものということで分かりやすい。しかし、第一引数のobjectは説明も少ないため使い方がわかり辛い。\u003c/p\u003e\n\n\u003cp\u003e例えば、以下のようにDiagnosticSourceを使用しているクラスがあったとする。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eHoge\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eDiagnosticSource\u003c/span\u003e \u003cspan class=\"n\"\u003e_src\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDiagnosticListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eF\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_src\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"EventName1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"EventName1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"aaa\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003etargetとして、以下のようなクラスを実装する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eX\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// 引数を指定しない場合は[DiagnosticName(\"[メソッド名]\")]と等価\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDiagnosticName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"EventName1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnEventName1\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eポイントは2点\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e[DiagnosticName(\"[EventName]\")]\u003c/code\u003e属性を付ける\u003c/li\u003e\n\u003cli\u003e引数に、イベント時に指定されるオブジェクトの \u003cstrong\u003eメンバー名\u003c/strong\u003e と同じ名前(大文字小文字の違いはOK)を指定する\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e以上のクラスを作り、以下のようにする\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eDiagnosticListener\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAllListeners\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribeWithAdapter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eX\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eすると、リフレクションを使って対応するイベント名に対して自動的に振り分けてメソッドを実行してくれるように設定を行ってくれる。なお、戻り値は見ないので、\u003ccode\u003easync Task\u003c/code\u003eを使うとおかしなことになるので注意。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"終わりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e終わりに\u003c/h1\u003e\n\n\u003cp\u003eDiagnosticSourceは単純にログを出力するには面倒な部分もあるが、やはりちゃんとした統計情報を取りたい場合は避けて通れない道だろうとは思う。\u003cbr\u003e\nまた、ライブラリ側で何らかのログ機構を作りたい場合、上からILoggerを受け取るよりもすっきりした設計にできるので、ライブラリを作成している場合は有用だろう。\u003c/p\u003e\n\n\u003cp\u003e今回は紹介していないが、EventSourceに流す方法や、Activityの使い方も、そのうち記事にしてみたい。\u003c/p\u003e\n","createdAt":"2020-03-03T14:59:43Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"HlKusJpatXykwPVAalOxNTVGF6m4perq5A==--fWHT7Wr1OnNTLldO--D1avqRKh4izxBQYQ+2vz9Q==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-03-03T19:34:40Z","likesCount":12,"linkUrl":"https://qiita.com/skitoy4321/items/9d33e9ce93a9e66000fb","organization":null,"originalId":1177877,"stockedCount":16,"title":"診断用情報収集にSystem.Diagnostics.DiagnosticSourceを使う","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%88%9D%E3%82%81%E3%81%AB\"\u003e初めに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#diagnosticsource%E3%81%A8%E3%81%AF\"\u003eDiagnosticSourceとは\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#ilogger%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83\"\u003eILoggerとの比較\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#eventsource%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83\"\u003eEventSourceとの比較\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95\"\u003e使用方法\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%BA%96%E5%82%99\"\u003e準備\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E9%80%81%E4%BF%A1%E5%81%B4\"\u003eイベント送信側\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E5%8F%97%E4%BF%A1%E5%81%B4\"\u003eイベント受信側\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85%E4%BE%8B\"\u003e実装例\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BE%BF%E5%88%A9%E3%83%84%E3%83%BC%E3%83%AB\"\u003e便利ツール\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#microsoftextensionsdiagnosticadapter\"\u003eMicrosoft.Extensions.DiagnosticAdapter\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e終わりに\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":2080,"uuid":"9d33e9ce93a9e66000fb","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"TYtZ15zGdXfJroJ5b4TElUGlWdWe--lAdFWaz41pX8rOUr--Zj2Yr9ojEZbVCQ7GFUWAhg==","originalId":103253,"description":"","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/103253/profile-images/1526359222","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F103253%2Fprofile-images%2F1526359222?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=a7dce827dc16582e1b8e9c7a52216638","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F103253%2Fprofile-images%2F1526359222?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=9623ed561bd61ca207da0cb6419ba01d","urlName":"skitoy4321","websiteUrl":"","twitterUrl":"https://twitter.com/skitoy4321","twitterUrlName":"skitoy4321","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Diagnostics","urlName":"diagnostics"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

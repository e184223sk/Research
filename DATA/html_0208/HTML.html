<!DOCTYPE html><html><head><meta charset="utf-8" /><title>【逆アセ】 C#でlongに代入してみる  - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/kurema/items/90177242828af01f7c1d" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="kiih0Ikyagw6Wc6yF90N/qEEbIMD6CduZgI07vIoHAANm7kXE9bY9bi+bxOh7bf5LeHfafTO56WHm6PhTwPpGA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@kurema_makoto" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="【逆アセ】 C#でlongに代入してみる  - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRNllDRzQ0S2k0NEs3NDRDUklFTWo0NEduYkc5dVotT0JxLVM3by1XRnBlT0JsLU9CcHVPQnYtT0NpeUEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9ZGFjMTFjMGQ0MThmNmRjYTc2ODBmMjdlN2JkOGQzNmI&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3QxY21WdFlRJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9NDdkOWE0NjIxNWEwYzQzNDVkOGQxNjQ0Yjg0MjgzZTc&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=ca057b3e8c1c6d68c45b04f40938b8c7"><meta property="og:description" content="

はじめに

さて皆さん。次のコードはどんなふうにコンパイルされると思いますか。

long value = 1L;


「うーん、こんな感じ？」

;x64
movq    $1, -8(%rbp) 


;x86
sub    ..."><meta content="https://qiita.com/kurema/items/90177242828af01f7c1d" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,MSIL,dotnet" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-30d48832-bf2c-4f14-b1a2-7b6b63e67010"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fkurema%2Fitems%2F90177242828af01f7c1d">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fkurema%2Fitems%2F90177242828af01f7c1d">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-30d48832-bf2c-4f14-b1a2-7b6b63e67010">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-12-18T11:35:04.000+09:00","dateModified":"2020-12-25T15:31:49.000+09:00","headline":"【逆アセ】 C#でlongに代入してみる ","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRNllDRzQ0S2k0NEs3NDRDUklFTWo0NEduYkc5dVotT0JxLVM3by1XRnBlT0JsLU9CcHVPQnYtT0NpeUEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9ZGFjMTFjMGQ0MThmNmRjYTc2ODBmMjdlN2JkOGQzNmI\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3QxY21WdFlRJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9NDdkOWE0NjIxNWEwYzQzNDVkOGQxNjQ0Yjg0MjgzZTc\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=ca057b3e8c1c6d68c45b04f40938b8c7","mainEntityOfPage":"https://qiita.com/kurema/items/90177242828af01f7c1d","author":{"@type":"Person","address":"","email":"kurema_makoto_software@yahoo.co.jp","identifier":"kurema","name":"kurema","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F10556974%3Fv%3D3?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=796754f7c11031fdc3703568a48ac8c9","url":"https://qiita.com/kurema","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kurema","type":"items","id":"90177242828af01f7c1d"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kurema","type":"items","id":"90177242828af01f7c1d"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kurema","type":"items","id":"90177242828af01f7c1d"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/kurema/items/90177242828af01f7c1d","location":"/kurema/items/90177242828af01f7c1d","scheme":"https","host":"qiita.com","port":null,"pathname":"/kurema/items/90177242828af01f7c1d","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"sEwzJSnYEUcUDDGjwyzkaenMXUzGOrk8ktd/GUTeEAQv/yviszyjvpbrkAJ1HF5uZSnupjEcefdzTugW+fXlHA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-54f7ccf7-5491-4b16-9535-9dd53ba3c08b"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/kurema/items/90177242828af01f7c1d/likers" class="css-1iupg5d">4</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">3</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/90177242828af01f7c1d/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/kurema/items/90177242828af01f7c1d/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/kurema/items/90177242828af01f7c1d/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/kurema/items/90177242828af01f7c1d/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/kurema/items/90177242828af01f7c1d.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/kurema"><img class="css-100alwu eyfquo10" src="https://avatars.githubusercontent.com/u/10556974?v=3" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/kurema" class="css-10ougpm">@<!-- -->kurema</a><div class="css-1ay9vb9"><span><meta content="2020-12-18T02:35:04Z"/><time dateTime="2020-12-25T06:31:49Z" class="css-m19uds">updated at 2020-12-25</time></span></div></div></div></div></div><h1 class="css-cgzq40">【逆アセ】 C#でlongに代入してみる </h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/msil" class="css-4czcte">MSIL</a><a href="/tags/dotnet" class="css-4czcte">dotnet</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>さて皆さん。次のコードはどんなふうにコンパイルされると思いますか。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="k">value</span> <span class="p">=</span> <span class="m">1L</span><span class="p">;</span>
</code></pre></div></div>

<p>「うーん、こんな感じ？」</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>;x64
movq    $1, -8(%rbp) 
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>;x86
sub     rsp, 24
mov     DWORD PTR a$[rsp], 1
</code></pre></div></div>

<p>正解です。<br>
しかし、C#では違います。<br>
<strong>結構違います</strong>。</p>

<p>さっき知ったこの驚きを共有しようと思って書きました。<br>
そんな記事です。<br>
結論から言えば、単なる定数代入が7パターンにコンパイルされます。</p>

<p><a href="https://sharplab.io/#v2:EYLgtghgzgLgpgJwDQxASwDZICYgNQA+GA9gHYDmABAG4QYCucA3ALABQtDcAvAAysc6jbgEYBnYQA5xQngE4ZXUQCYA7IuEjl09hJ7KRAFlWHJAZgBsxgDJMA9Hd7ARL12/cfPr3bO4Hjppamtg5OIrwRkVHRMbGRPkqGynKGchaqIukhjs5eeR68ngnCSSlpGRaS2WH5ta6xxTylqenJhtW5dV1uvI3czeXJAKwd3WPegoltg2mjcfML0ex9ALRiq8oaPGvaW9w7ChtGJuZWVXsr/idBcrbsQA" rel="nofollow noopener" target="_blank">sharplab.io</a>も開きながら読めば分かりやすいかもしれません。<br>
Cの逆コンパイルは<a href="https://gcc.godbolt.org/" rel="nofollow noopener" target="_blank">Compiler Explorer</a>を利用させていただきました。</p>

<p><details><summary>逆コンパイル結果一覧</summary><div>
<br>
C#: ソースコード

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="k">value</span><span class="p">;</span>
<span class="k">value</span><span class="p">=</span><span class="m">0</span><span class="p">;</span>
<span class="k">value</span><span class="p">=</span><span class="m">1</span><span class="p">;</span>
<span class="k">value</span><span class="p">=</span><span class="m">8</span><span class="p">;</span>
<span class="k">value</span><span class="p">=</span><span class="m">9</span><span class="p">;</span>
<span class="k">value</span><span class="p">=</span><span class="m">127</span><span class="p">;</span>
<span class="k">value</span><span class="p">=</span><span class="m">128</span><span class="p">;</span>
<span class="k">value</span><span class="p">=</span><span class="m">2147483647L</span><span class="p">;</span><span class="c1">//0b1111111111111111111111111111111</span>
<span class="k">value</span><span class="p">=</span><span class="m">2147483648L</span><span class="p">;</span><span class="c1">//0b10000000000000000000000000000000</span>
<span class="k">value</span><span class="p">=</span><span class="m">4294967167L</span><span class="p">;</span><span class="c1">//0b11111111111111111111111101111111</span>
<span class="k">value</span><span class="p">=</span><span class="m">4294967168L</span><span class="p">;</span><span class="c1">//0b11111111111111111111111110000000</span>
<span class="k">value</span><span class="p">=</span><span class="m">4294967294L</span><span class="p">;</span><span class="c1">//0b11111111111111111111111111111110</span>
<span class="k">value</span><span class="p">=</span><span class="m">4294967295L</span><span class="p">;</span><span class="c1">//0b11111111111111111111111111111111</span>
<span class="k">value</span><span class="p">=</span><span class="m">4294967296L</span><span class="p">;</span><span class="c1">//0b100000000000000000000000000000000</span>

<span class="k">value</span><span class="p">=-</span><span class="m">1</span><span class="p">;</span>
<span class="k">value</span><span class="p">=-</span><span class="m">2</span><span class="p">;</span>
<span class="k">value</span><span class="p">=-</span><span class="m">128</span><span class="p">;</span>
<span class="k">value</span><span class="p">=-</span><span class="m">129</span><span class="p">;</span>
<span class="k">value</span><span class="p">=-</span><span class="m">2147483648L</span><span class="p">;</span>
<span class="k">value</span><span class="p">=-</span><span class="m">2147483649L</span><span class="p">;</span>
</code></pre></div></div>

<p>MSIL: 逆アセンブル結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>.class private auto ansi '&lt;Module&gt;'
{
} // end of class &lt;Module&gt;

.class private auto ansi abstract sealed beforefieldinit '&lt;Program&gt;$'
    extends [System.Private.CoreLib]System.Object
{
    .custom instance void [System.Private.CoreLib]System.Runtime.CompilerServices.CompilerGeneratedAttribute::.ctor() = (
        01 00 00 00
    )
    // Methods
    .method private hidebysig static 
        void '&lt;Main&gt;$' (
            string[] args
        ) cil managed 
    {
        // Method begins at RVA 0x2050
        // Code size 102 (0x66)
        .maxstack 1
        .entrypoint
        .locals init (
            [0] int64 'value'
        )

        IL_0000: ldc.i4.0
        IL_0001: conv.i8
        IL_0002: stloc.0
        IL_0003: ldc.i4.1
        IL_0004: conv.i8
        IL_0005: stloc.0
        IL_0006: ldc.i4.8
        IL_0007: conv.i8
        IL_0008: stloc.0
        IL_0009: ldc.i4.s 9
        IL_000b: conv.i8
        IL_000c: stloc.0
        IL_000d: ldc.i4.s 127
        IL_000f: conv.i8
        IL_0010: stloc.0
        IL_0011: ldc.i4 128
        IL_0016: conv.i8
        IL_0017: stloc.0
        IL_0018: ldc.i4 2147483647
        IL_001d: conv.i8
        IL_001e: stloc.0
        IL_001f: ldc.i4 -2147483648
        IL_0024: conv.u8
        IL_0025: stloc.0
        IL_0026: ldc.i4 -129
        IL_002b: conv.u8
        IL_002c: stloc.0
        IL_002d: ldc.i4.s -128
        IL_002f: conv.u8
        IL_0030: stloc.0
        IL_0031: ldc.i4.s -2
        IL_0033: conv.u8
        IL_0034: stloc.0
        IL_0035: ldc.i4.m1
        IL_0036: conv.u8
        IL_0037: stloc.0
        IL_0038: ldc.i8 4294967296
        IL_0041: stloc.0
        IL_0042: ldc.i4.m1
        IL_0043: conv.i8
        IL_0044: stloc.0
        IL_0045: ldc.i4.s -2
        IL_0047: conv.i8
        IL_0048: stloc.0
        IL_0049: ldc.i4.s -128
        IL_004b: conv.i8
        IL_004c: stloc.0
        IL_004d: ldc.i4 -129
        IL_0052: conv.i8
        IL_0053: stloc.0
        IL_0054: ldc.i4 -2147483648
        IL_0059: conv.i8
        IL_005a: stloc.0
        IL_005b: ldc.i8 -2147483649
        IL_0064: stloc.0
        IL_0065: ret
    } // end of method '&lt;Program&gt;$'::'&lt;Main&gt;$'

} // end of class &lt;Program&gt;$
</code></pre></div></div>

<p>C言語: ソースコード</p>

<div class="code-frame" data-lang="c"><div class="highlight"><pre class="with-code"><code><span class="kt">void</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">long</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">a</span><span class="o">=</span><span class="mi">2147483647L</span><span class="p">;</span>
    <span class="n">a</span><span class="o">=</span><span class="mi">2147483648L</span><span class="p">;</span>
    <span class="n">a</span><span class="o">=</span><span class="mi">4294967296L</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>x64アセンブラ: x86-64 gcc 10.2</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>_Z4testv:
test():
        pushq   %rbp
        movq    %rsp, %rbp
        movq    $0, -8(%rbp)
        movq    $1, -8(%rbp)
        movq    $2147483647, -8(%rbp)
        movl    $2147483648, %eax
        movq    %rax, -8(%rbp)
        movabsq $4294967296, %rax
        movq    %rax, -8(%rbp)
        nop
        popq    %rbp
        ret
</code></pre></div></div>

<p>x64アセンブラ: x86-64 gcc 4.1.2</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>_Z4testv:
test():
        pushq   %rbp
        movq    %rsp, %rbp
        movq    $0, -8(%rbp)
        movq    $1, -8(%rbp)
        movq    $2147483647, -8(%rbp)
        movl    $-2147483648, -8(%rbp)
        movl    $0, -4(%rbp)
        movl    $0, -8(%rbp)
        movl    $1, -4(%rbp)
        leave
        ret
</code></pre></div></div>

<p></p>
</div></details></p>

<p>同時公開のAdvent Calendar記事<a href="https://qiita.com/kurema/items/5a3456f9a32d08b1db74" id="reference-6158eb4f238775730b9e">「【C#】 演算子のオーバーロードで遊ぶ」</a>もどうぞ。</p>

<h1>
<span id="正数" class="fragment"></span><a href="#%E6%AD%A3%E6%95%B0"><i class="fa fa-link"></i></a>正数</h1>

<h2>
<span id="08--ldci4convi8" class="fragment"></span><a href="#08--ldci4convi8"><i class="fa fa-link"></i></a>0～8 : ldc.i4.*+conv.i8</h2>

<p><strong>パターン1: ldc.i4.*+conv.i8</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="k">value</span> <span class="p">=</span> <span class="m">1L</span><span class="p">;</span>
</code></pre></div></div>

<p>1の代入はこうなります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        IL_0000: ldc.i4.1
        IL_0001: conv.i8
        IL_0002: stloc.0
</code></pre></div></div>

<p>よく分かりませんね。<br>
1行目の<code>ldc.i4.1</code>というのは、</p>

<blockquote>
<p>ldc.i4.1<br>
Push 1 onto the stack as int32 (0x17)</p>
</blockquote>

<p>だそうです。つまり、「スタックにint32で1をプッシュする」という操作です。<br>
つまりdotnetの中間言語、MSIL(<a href="https://ja.wikipedia.org/wiki/%E5%85%B1%E9%80%9A%E4%B8%AD%E9%96%93%E8%A8%80%E8%AA%9E" rel="nofollow noopener" target="_blank">共通中間言語</a>)には、「1をスタックにプッシュする」なんて命令があるんです。<br>
-1～8まであります。</p>

<p>2行目はそれをint64に変換する命令。</p>

<blockquote>
<p>conv.i8<br>
Convert to int64, pushing int64 on stack (0x6A)</p>
</blockquote>

<p>3行目はスタックから値を取り出して変数に代入する命令です。</p>

<blockquote>
<p>stloc.0<br>
Pop a value from stack into local variable 0 (0x0A)</p>
</blockquote>

<p>変数の型と名前もきちんと残っています。これのおかげでdotnetの逆コンパイルはローカル変数まで見えます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        .locals init (
            [0] int64 'value'
        )
</code></pre></div></div>

<p>最初は特定の値をスタックに積む専用命令があって、しかもわざわざ型変換をしてるのには驚きました。<br>
おそらくメリットは即値にほぼ0の8バイトを消費するより容量が小さくて済むことでしょう。<br>
実在のCPUでこんな命令はなさそうです(というかCPUが型を認識したりしない)。<br>
さらに言えば、アセンブラっぽいのに変数という概念があるのも不思議ですが、MSILってのはこういうものみたいです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="k">value</span> <span class="p">=</span> <span class="m">8L</span><span class="p">;</span>
</code></pre></div></div>

<p>なお8の代入はこうなります。-1～8まで同様。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        IL_0000: ldc.i4.8
        IL_0001: conv.i8
        IL_0002: stloc.0
</code></pre></div></div>

<h3>
<span id="c言語" class="fragment"></span><a href="#c%E8%A8%80%E8%AA%9E"><i class="fa fa-link"></i></a>C言語</h3>

<p>ちなみにCでは最初に書いた通りこうなります(x64)。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        movq    $1, -8(%rbp)
</code></pre></div></div>

<p>movqってのは<code>Move Quadword</code>で8バイトの値のコピーです。<br>
<code>%rbp</code>というのはベースポインタ、つまり「rbpは関数内においてスタック領域を扱う処理の基準」だそうです。<br>
ヒープはプラス方向に、スタックはマイナス方向に延びるので+8ではなく-8。<br>
普通ですね。</p>

<p>ちなみにこの一行で8バイトの命令になります。<br>
なぜ8バイトの値をコピーするのに8バイトで済むのか疑問ですが、<code>-8(%rbp)</code>みたいな場合の即値は4バイトだからのようです。</p>

<p>2147483647までは特に面白い事は起きません。</p>

<p><details><summary>ちなみにC#のJITコンパイル結果 (x86)はこうなります。</summary><div>
<br>
ちなみにC#のJITコンパイル結果 (x86)はこうなります。<br>
sharplab.ioでJIT Asmを選択した結果です。x64版は今のところなさそうです。

<p><a href="https://camo.qiitausercontent.com/e1330a3c096b9ab856bd2939b3fe29795863a3ab/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3134363436372f38663135353030372d613538322d663032322d646532352d3831633563663738333262622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146467%2F8f155007-a582-f022-de25-81c5cf7832bb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f3bf046d26702a1c9022bb9b8a8ff0b0" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/146467/8f155007-a582-f022-de25-81c5cf7832bb.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146467%2F8f155007-a582-f022-de25-81c5cf7832bb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b389f6c95ae01e3c55b48f243c47869f 1x" loading="lazy"></a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>    L001f: mov dword ptr [ebp-0x10], 1
    L0026: mov eax, [ebp-0x10]
    L0029: mov edx, [ebp-0x10]
    L002c: sar edx, 0x1f
    L002f: mov [ebp-0xc], eax
    L0032: mov [ebp-8], edx
</code></pre></div></div>

<p>x86のmovはx64と引数の順序が逆なこと(2番目の引数を1番目の場所に代入)、リトルエンディアンなのでメモリアドレスが多い方に上位ビットが来ることに注意してください。<br>
ebpはrbpの32ビット版です(x64にもあります)。4バイト程度ずれてるようですが気にしないでおきます。</p>

<p>SARは<code>Shift Arithmetic Right</code>で算術右シフトのことです。すなわち正の場合は0で負の場合は1でシフトしたビットをセットするビットシフトです。<br>
つまり<code>sar edx, 0x1f</code>は正の場合は0に、負の場合は<code>0xffffffff</code>(-1)になるわけです。<br>
<code>conv.i8</code>の指示通り、律儀にintからlongに変換しているわけですね。<br>
やたら行数が多いですし、わざわざメモリを経由する必要があるのか、定数なんだから<code>sar</code>使わずに<code>xor</code>とかで0を作れば良さそうですし、色々謎ですね。<br>
まぁJITですし、ILを複数行見るような処理はやらない設定なんでしょう多分。</p>

<p>intの場合は普通に1行になります。<br>
32ビットCPUで64ビット型を使うのは、単なるストアの時点から命令が増えて遅いだろうなという話ですね。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>    L001c: mov dword ptr [ebp-8], 1
</code></pre></div></div>

<p></p>
</div></details></p>

<h3>
<span id="参考文献" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-link"></i></a>参考文献</h3>

<ul>
<li>yone-ken (2007) 「[IL6] 定数のロードあれこれ」 <a href="http://www5b.biglobe.ne.jp/%7Eyone-ken/VBNET/IL/il06_LoadConstant.html" rel="nofollow noopener" target="_blank">KEN's .NET</a>
</li>
<li>yone-ken (2007) 「[IL13] 型と型変換」 <a href="http://www5b.biglobe.ne.jp/%7Eyone-ken/VBNET/IL/il13_TypeAndConvert.html" rel="nofollow noopener" target="_blank">KEN's .NET</a>
</li>
<li>
<a href="/tobira-code" class="user-mention js-hovercard" title="tobira-code" data-hovercard-target-type="user" data-hovercard-target-name="tobira-code">@tobira-code</a> (2016) 「x86-64プロセッサのスタックを理解する」 <a href="https://qiita.com/tobira-code/items/75d3034aed8bb9828981" id="reference-4400fe247a1cd72b593b">qiita</a>
</li>
<li>「X86アセンブラ/x86アーキテクチャ」 <a href="https://ja.wikibooks.org/wiki/X86%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%A9/x86%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3" rel="nofollow noopener" target="_blank">WIKIBOOKS</a>
</li>
<li>
<a href="/Nina_Petipa" class="user-mention js-hovercard" title="Nina_Petipa" data-hovercard-target-type="user" data-hovercard-target-name="Nina_Petipa">@Nina_Petipa</a>「Tips　IA32（x86）汎用命令一覧　Sから始まる命令　SAL/SAR/SHL/SHR命令 」 <a href="http://softwaretechnique.jp/OS_Development/Tips/IA32_Instructions/SAL.html" rel="nofollow noopener" target="_blank">０から作るソフトウェア開発 日々勉強中。。。</a>
</li>
<li>Intel (2004) 「<a href="https://www.intel.co.jp/content/dam/www/public/ijkk/jp/ja/documents/developer/IA32_Arh_Dev_Man_Vol1_Online_i.pdf" rel="nofollow noopener" target="_blank">IA-32 インテル®アーキテクチャソフトウェア・デベロッパーズ・マニュアル 上巻</a>」 7-14ページ</li>
</ul>

<h2>
<span id="9127--ldci4sconvi8" class="fragment"></span><a href="#9127--ldci4sconvi8"><i class="fa fa-link"></i></a>9～127 : ldc.i4.s+conv.i8</h2>

<p><strong>パターン2: ldc.i4.s+conv.i8</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="n">a</span> <span class="p">=</span> <span class="m">8L</span><span class="p">;</span>
</code></pre></div></div>

<p>9からは即値を使います。ただし、即値は1バイトです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        IL_0009: ldc.i4.s 9
        IL_000b: conv.i8
        IL_000c: stloc.0
</code></pre></div></div>

<p><code>ldc.i4.s</code>はint8の即値をint32としてスタックにプッシュする命令です。これは127まで続きます。<br>
地味にメモリの節約になりそうです。</p>

<blockquote>
<p>ldc.i4.s<br>
Push num onto the stack as int32, short form (0x1F )</p>
</blockquote>

<h2>
<span id="1282147483647--ldci4convi8" class="fragment"></span><a href="#1282147483647--ldci4convi8"><i class="fa fa-link"></i></a>128～2147483647 : ldc.i4+conv.i8</h2>

<p><strong>パターン3: ldc.i4+conv.i8</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="k">value</span> <span class="p">=</span> <span class="m">8L</span><span class="p">;</span>
</code></pre></div></div>

<p>128からはint32の即値をスタックにプッシュする命令を使うようになります。<br>
これは2147483647(<code>int.MaxValue</code>)まで続きます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        IL_0011: ldc.i4 128
        IL_0016: conv.i8
        IL_0017: stloc.0
</code></pre></div></div>

<blockquote>
<p>ldc.i4<br>
Push num of type int32 onto the stack as int32 (0x20 )</p>
</blockquote>

<h2>
<span id="21474836484294967167--ldci4convu8" class="fragment"></span><a href="#21474836484294967167--ldci4convu8"><i class="fa fa-link"></i></a>2147483648～4294967167 : ldc.i4+conv.u8</h2>

<p><strong>パターン4: ldc.i4+conv.u8</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="k">value</span> <span class="p">=</span> <span class="m">2147483648L</span><span class="p">;</span> <span class="c1">//0b10000000000000000000000000000000</span>
</code></pre></div></div>

<p>2147483648では負数が出てきます。可読性がぐんと下がります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        IL_001f: ldc.i4 -2147483648
        IL_0024: conv.u8
        IL_0025: stloc.0
</code></pre></div></div>

<p>たまたま符号のあるなしだけみたいになってますが、2147483649だと-2147483647です。<br>
<code>conv.u8</code>はその名の通り<code>unsigned int64</code>に変換する命令です。<br>
負数を符号なし整数型に変換することで大きな値を得ているわけですね。</p>

<blockquote>
<p>conv.u8<br>
Convert to unsigned int64, pushing int64 on stack (0x6E)</p>
</blockquote>

<h3>
<span id="c言語-1" class="fragment"></span><a href="#c%E8%A8%80%E8%AA%9E-1"><i class="fa fa-link"></i></a>C言語</h3>

<p>C言語ではコンパイラーによって結果が異なるようです。</p>

<p>x86-64 gcc 4.1.2</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        movl    $-2147483648, -8(%rbp)
        movl    $0, -4(%rbp)
</code></pre></div></div>

<p>4バイトずつ代入しています。直観的です。<br>
ちなみにこの2行で14バイトになります。</p>

<p>x86-64 gcc 10.2 / x86-64 clang 11.0.0</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        movl    $2147483648, %eax
        movq    %rax, -8(%rbp)
</code></pre></div></div>

<p>EAXは、RAXに使っているレジスタの下位32ビットのことです。代入すると上位32ビットもクリアされる…のだと思います。<br>
下位32ビットに代入し、64ビットコピーすることで目的の値を得ているわけですね。<br>
この2行で9バイトです。上より5バイト節約、1を代入するだけより1バイト多いだけです。<br>
コンパイラが進歩してるんだなぁと感じます。メモリの節約はCPUキャッシュなどでも大事です。</p>

<p><details><summary>ちなみにC#のJITコンパイル結果 (x86)はこうなります。</summary><div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>    L001f: mov eax, 0x80000000
    L0024: xor edx, edx
    L0026: mov [ebp-0xc], eax
    L0029: mov [ebp-8], edx
</code></pre></div></div>

<p><code>xor edx, edx</code>は0を作っているだけです。<br>
4バイトずつ書き込んでるだけですね。</p>

<p></p>
</div></details></p>

<h2>
<span id="42949671684294967294--ldci4sconvu8" class="fragment"></span><a href="#42949671684294967294--ldci4sconvu8"><i class="fa fa-link"></i></a>4294967168～4294967294 : ldc.i4.s+conv.u8</h2>

<p><strong>パターン5: ldc.i4.s+conv.u8</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="k">value</span> <span class="p">=</span> <span class="m">4294967168L</span><span class="p">;</span> <span class="c1">//0b11111111111111111111111110000000</span>
</code></pre></div></div>

<p>4294967168は何の変哲もない数字に見えます。どうなるか予想できますか。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        IL_002d: ldc.i4.s -128
        IL_002f: conv.u8
        IL_0030: stloc.0
</code></pre></div></div>

<p>そうです<code>ldc.i4.s</code>の復活です。<br>
見た目が変わり、(コンパイル結果が)短くなるだけでそんなに意味はないですね。</p>

<h2>
<span id="4294967295--ldci4m1convu8" class="fragment"></span><a href="#4294967295--ldci4m1convu8"><i class="fa fa-link"></i></a>4294967295 : ldc.i4.m1+conv.u8</h2>

<p><strong>パターン6: ldc.i4.m1+conv.u8</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="k">value</span> <span class="p">=</span> <span class="m">4294967295L</span><span class="p">;</span><span class="c1">//0b11111111111111111111111111111111</span>
</code></pre></div></div>

<p>上で書きましたが、-1だけは特別な命令があるのでこうなります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        IL_0035: ldc.i4.m1
        IL_0036: conv.u8
        IL_0037: stloc.0
</code></pre></div></div>

<blockquote>
<p>ldc.i4.m1<br>
Push -1 onto the stack as int32 (0x15)</p>
</blockquote>

<h2>
<span id="4294967296--ldci8" class="fragment"></span><a href="#4294967296--ldci8"><i class="fa fa-link"></i></a>4294967296～ : ldc.i8</h2>

<p><strong>パターン7: ldc.i8</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="k">value</span> <span class="p">=</span> <span class="m">4294967296L</span><span class="p">;</span><span class="c1">//0b100000000000000000000000000000000</span>
</code></pre></div></div>

<p>これ以降は普通に8バイトの即値をストアするだけの簡単な作業です。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        IL_0038: ldc.i8 4294967296
        IL_0041: stloc.0
</code></pre></div></div>

<blockquote>
<p>ldc.i8<br>
Push num of type int64 onto the stack as int64 (0x21 )</p>
</blockquote>

<h3>
<span id="c言語-2" class="fragment"></span><a href="#c%E8%A8%80%E8%AA%9E-2"><i class="fa fa-link"></i></a>C言語</h3>

<p>C言語ではこうなります。</p>

<p>x86-64 gcc 4.1.2</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        movl    $0, -8(%rbp)
        movl    $1, -4(%rbp)
</code></pre></div></div>

<p>こっちはいっしょ。</p>

<p>x86-64 gcc 10.2 / x86-64 clang 11.0.0</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        movabsq $4294967296, %rax
        movq    %rax, -8(%rbp)
</code></pre></div></div>

<p>こちらは<code>movabsq</code>という長い名前の命令が出てきます。<br>
単純に64ビットの即値を取るmovですね。恐怖の10バイト命令です。<br>
2行で14バイトも使います。</p>

<p><a href="https://camo.qiitausercontent.com/496ab4cb48233dca9d40c72c4b931f17ea89f479/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3134363436372f39303334393234352d373736342d666235632d643363662d3237396262633863376365632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146467%2F90349245-7764-fb5c-d3cf-279bbc8c7cec.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=fcdb4c7014b78dd721f704634f8d7c7e" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/146467/90349245-7764-fb5c-d3cf-279bbc8c7cec.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146467%2F90349245-7764-fb5c-d3cf-279bbc8c7cec.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d2bd1cb5c5c0fba62f63a30af576d90a 1x" loading="lazy"></a></p>

<h1>
<span id="負数" class="fragment"></span><a href="#%E8%B2%A0%E6%95%B0"><i class="fa fa-link"></i></a>負数</h1>

<p>では0からマイナス方向へ行きましょう。<br>
ちなみに「-2～-128」のように絶対値の順に書きます。<br>
基本、正数と同じなのでサクサク紹介していきましょう。</p>

<h2>
<span id="-1--ldci4convi8" class="fragment"></span><a href="#-1--ldci4convi8"><i class="fa fa-link"></i></a>-1 : ldc.i4.*+conv.i8</h2>

<p><strong>パターン1: ldc.i4.*+conv.i8</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="k">value</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        IL_0042: ldc.i4.m1
        IL_0043: conv.i8
        IL_0044: stloc.0
</code></pre></div></div>

<p><code>ldc.i4.m1</code>という命令があります。-2以降はありません。<br>
既に書きましたね。</p>

<h2>
<span id="-2-128--ldci4sconvi8" class="fragment"></span><a href="#-2-128--ldci4sconvi8"><i class="fa fa-link"></i></a>-2～-128 : ldc.i4.s+conv.i8</h2>

<p><strong>パターン2: ldc.i4.s+conv.i8</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="k">value</span> <span class="p">=</span> <span class="p">-</span><span class="m">2</span><span class="p">;</span>
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        IL_0045: ldc.i4.s -2
        IL_0047: conv.i8
        IL_0048: stloc.0
</code></pre></div></div>

<p>「9～127」と同じ。<br>
2の補数表現なので絶対値が1ずれます。</p>

<h2>
<span id="-129-2147483648--ldci4convi8" class="fragment"></span><a href="#-129-2147483648--ldci4convi8"><i class="fa fa-link"></i></a>-129～-2147483648 : ldc.i4+conv.i8</h2>

<p><strong>パターン3: ldc.i4+conv.i8</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="k">value</span> <span class="p">=</span> <span class="p">-</span><span class="m">129</span><span class="p">;</span>
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        IL_004d: ldc.i4 -129
        IL_0052: conv.i8
        IL_0053: stloc.0
</code></pre></div></div>

<p>「128～2147483647」と同じ。</p>

<h2>
<span id="-2147483649--ldci8" class="fragment"></span><a href="#-2147483649--ldci8"><i class="fa fa-link"></i></a>-2147483649～ : ldc.i8</h2>

<p><strong>パターン7: ldc.i8</strong></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="k">value</span> <span class="p">=</span> <span class="p">-</span><span class="m">2147483649L</span><span class="p">;</span>
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>        IL_005b: ldc.i8 -2147483649
        IL_0064: stloc.0
</code></pre></div></div>

<p>「4294967296～」と同じ。<br>
負数を<code>conv.u8</code>にするテクニックが使えないので、8バイトの即値を持つ命令を正数より広い範囲で使わざるを得ません。</p>

<h1>
<span id="感想" class="fragment"></span><a href="#%E6%84%9F%E6%83%B3"><i class="fa fa-link"></i></a>感想</h1>

<p>単なる定数のストアにこんなに種類があるのは驚きでした。7パターンもあります。<br>
出力されるILのサイズをかなり真剣に削っているようです。<br>
さらに-1～8の為の専用命令ってのも不思議ですね。驚きました。<br>
一方で、JITコンパイルの結果はちょっと見た限りではあまり洗練されていないように感じました。</p>

<p>MSILはちょくちょく読みはするんですが、これくらい読み込む機会はないので新鮮でした。<br>
普通のアセンブラもですね。<br>
アセンブラ初心者なので用語とか知識とか間違っていれば申し訳ないです。</p>

<p>以前似た話を(岩永さんの?)ツイートで見たような記憶があるので既出かもしれません。<br>
ただ知ってる人が多いわけでもなさそうなので良いんじゃないでしょうか。</p>

<p>これは元々Advent Calendar用の企画で演算子オーバーロードの調査をしている時に見つけたのですが、面白かったので記事にしたものです。<br>
それなりの分量になったので、本題が間に合わなさそうならこっちを代わりにします。公開時期も遅らせときます。</p>

<h1>
<span id="表" class="fragment"></span><a href="#%E8%A1%A8"><i class="fa fa-link"></i></a>表</h1>

<p>命令長/パターンは以下になります。</p>

<table>
<thead>
<tr>
<th>数値</th>
<th>パターン</th>
<th>命令長(合計)</th>
<th>命令</th>
</tr>
</thead>
<tbody>
<tr>
<td>-9,223,372,036,854,775,808</td>
<td>7</td>
<td>9</td>
<td>ldc.i8</td>
</tr>
<tr>
<td>-2,147,483,649</td>
<td>7</td>
<td>9</td>
<td>ldc.i8</td>
</tr>
<tr>
<td>-2,147,483,648</td>
<td>3</td>
<td>6</td>
<td>ldc.i4+conv.i8</td>
</tr>
<tr>
<td>-129</td>
<td>3</td>
<td>6</td>
<td>ldc.i4+conv.i8</td>
</tr>
<tr>
<td>-128</td>
<td>2</td>
<td>3</td>
<td>ldc.i4.s+conv.i8</td>
</tr>
<tr>
<td>-2</td>
<td>2</td>
<td>3</td>
<td>ldc.i4.s+conv.i8</td>
</tr>
<tr>
<td>-1</td>
<td>1</td>
<td>2</td>
<td>ldc.i4.m1+conv.i8</td>
</tr>
<tr>
<td>8</td>
<td>1</td>
<td>2</td>
<td>ldc.i4.8+conv.i8</td>
</tr>
<tr>
<td>9</td>
<td>2</td>
<td>3</td>
<td>ldc.i4.s+conv.i8</td>
</tr>
<tr>
<td>127</td>
<td>2</td>
<td>3</td>
<td>ldc.i4.s+conv.i8</td>
</tr>
<tr>
<td>128</td>
<td>3</td>
<td>6</td>
<td>ldc.i4+conv.i8</td>
</tr>
<tr>
<td>2,147,483,647</td>
<td>3</td>
<td>6</td>
<td>ldc.i4+conv.i8</td>
</tr>
<tr>
<td>2,147,483,648</td>
<td>4</td>
<td>6</td>
<td>ldc.i4+conv.u8</td>
</tr>
<tr>
<td>4,294,967,167</td>
<td>4</td>
<td>6</td>
<td>ldc.i4+conv.u8</td>
</tr>
<tr>
<td>4,294,967,168</td>
<td>5</td>
<td>3</td>
<td>ldc.i4.s+conv.u8</td>
</tr>
<tr>
<td>4,294,967,294</td>
<td>5</td>
<td>3</td>
<td>ldc.i4.s+conv.u8</td>
</tr>
<tr>
<td>4,294,967,295</td>
<td>6</td>
<td>2</td>
<td>ldc.i4.m1+conv.u8</td>
</tr>
<tr>
<td>4,294,967,296</td>
<td>7</td>
<td>9</td>
<td>ldc.i8</td>
</tr>
<tr>
<td>9,223,372,036,854,775,807</td>
<td>7</td>
<td>9</td>
<td>ldc.i8</td>
</tr>
</tbody>
</table>

<p><a href="https://camo.qiitausercontent.com/bda008295441e1781f0c2a2637f8b79b7e20d20c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3134363436372f32623836313264642d353839362d343237322d386436662d6533343236646432613964302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146467%2F2b8612dd-5896-4272-8d6f-e3426dd2a9d0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=587934a715c6c15e8c85693f9a06e1d4" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/146467/2b8612dd-5896-4272-8d6f-e3426dd2a9d0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146467%2F2b8612dd-5896-4272-8d6f-e3426dd2a9d0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1a12a4fb5ed001f969d80d6ba66074a2 1x" loading="lazy"></a></p>

<h1>
<span id="おまけ" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91"><i class="fa fa-link"></i></a>おまけ</h1>

<p>C#上でILを手軽に触る方法もあります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Reflection.Emit</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Reflection</span><span class="p">;</span>

<span class="n">DynamicMethod</span> <span class="n">method</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DynamicMethod</span><span class="p">(</span><span class="s">"DynamicMethod"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="k">void</span><span class="p">),</span> <span class="n">Type</span><span class="p">.</span><span class="n">EmptyTypes</span><span class="p">);</span>
<span class="n">ILGenerator</span> <span class="n">il</span> <span class="p">=</span> <span class="n">method</span><span class="p">.</span><span class="nf">GetILGenerator</span><span class="p">();</span>

<span class="n">il</span><span class="p">.</span><span class="nf">DeclareLocal</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="kt">long</span><span class="p">));</span>

<span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">OpCodes</span><span class="p">.</span><span class="n">Ldc_I4_S</span><span class="p">,</span> <span class="p">(</span><span class="kt">sbyte</span><span class="p">)-</span><span class="m">128</span><span class="p">);</span>
<span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">OpCodes</span><span class="p">.</span><span class="n">Conv_U8</span><span class="p">);</span>
<span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">OpCodes</span><span class="p">.</span><span class="n">Stloc_0</span><span class="p">);</span>
<span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">OpCodes</span><span class="p">.</span><span class="n">Ldloc_0</span><span class="p">);</span>
<span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">OpCodes</span><span class="p">.</span><span class="n">Call</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Console</span><span class="p">).</span><span class="nf">GetMethod</span><span class="p">(</span><span class="s">"WriteLine"</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Reflection</span><span class="p">.</span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">Static</span> <span class="p">|</span> <span class="n">System</span><span class="p">.</span><span class="n">Reflection</span><span class="p">.</span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">Public</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">new</span> <span class="n">Type</span><span class="p">[]</span> <span class="p">{</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Int64</span><span class="p">)</span> <span class="p">},</span> <span class="k">null</span><span class="p">));</span>
<span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">OpCodes</span><span class="p">.</span><span class="n">Ret</span><span class="p">);</span>

<span class="n">Action</span> <span class="n">action</span> <span class="p">=</span> <span class="p">(</span><span class="n">Action</span><span class="p">)</span><span class="n">method</span><span class="p">.</span><span class="nf">CreateDelegate</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Action</span><span class="p">));</span>
<span class="nf">action</span><span class="p">();</span>
</code></pre></div></div>

<ul>
<li>aharisu (2009) 「DynamicMethodで末尾再帰」 <a href="https://aharisu.hatenadiary.org/entry/20091009/1255089862" rel="nofollow noopener" target="_blank">aharisuのごみ箱</a>
</li>
</ul>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fkurema%2Fitems%2F90177242828af01f7c1d&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fkurema%2Fitems%2F90177242828af01f7c1d&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/kurema/items/90177242828af01f7c1d/likers" class="css-1iupg5d">4</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">3</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/90177242828af01f7c1d/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/kurema/items/90177242828af01f7c1d/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/kurema/items/90177242828af01f7c1d/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/kurema/items/90177242828af01f7c1d/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/kurema/items/90177242828af01f7c1d.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-54f7ccf7-5491-4b16-9535-9dd53ba3c08b">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-158b51f4-1d94-4d43-aa42-61abba8293df"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-158b51f4-1d94-4d43-aa42-61abba8293df">{}</script>
      
<div id="LoginModal-react-component-59d50989-bd2e-4e07-9058-cb780b59e7a3"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-59d50989-bd2e-4e07-9058-cb780b59e7a3">{}</script>
      
<div id="StockModal-react-component-530801ce-9959-4ae0-a611-8c76af7e387b"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-530801ce-9959-4ae0-a611-8c76af7e387b">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;wFbEQeVchWjCLd/CsCkyZyanojs/eJkcSWSDuTEC50pf5dyGf7g3kUDKfmMGGYhgqkIR0cheWdeo/RS2jCkSUg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eさて皆さん。次のコードはどんなふうにコンパイルされると思いますか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e「うーん、こんな感じ？」\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e;x64\nmovq    $1, -8(%rbp) \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e;x86\nsub     rsp, 24\nmov     DWORD PTR a$[rsp], 1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e正解です。\u003cbr\u003e\nしかし、C#では違います。\u003cbr\u003e\n\u003cstrong\u003e結構違います\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003eさっき知ったこの驚きを共有しようと思って書きました。\u003cbr\u003e\nそんな記事です。\u003cbr\u003e\n結論から言えば、単なる定数代入が7パターンにコンパイルされます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://sharplab.io/#v2:EYLgtghgzgLgpgJwDQxASwDZICYgNQA+GA9gHYDmABAG4QYCucA3ALABQtDcAvAAysc6jbgEYBnYQA5xQngE4ZXUQCYA7IuEjl09hJ7KRAFlWHJAZgBsxgDJMA9Hd7ARL12/cfPr3bO4Hjppamtg5OIrwRkVHRMbGRPkqGynKGchaqIukhjs5eeR68ngnCSSlpGRaS2WH5ta6xxTylqenJhtW5dV1uvI3czeXJAKwd3WPegoltg2mjcfML0ex9ALRiq8oaPGvaW9w7ChtGJuZWVXsr/idBcrbsQA\" rel=\"nofollow noopener\" target=\"_blank\"\u003esharplab.io\u003c/a\u003eも開きながら読めば分かりやすいかもしれません。\u003cbr\u003e\nCの逆コンパイルは\u003ca href=\"https://gcc.godbolt.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCompiler Explorer\u003c/a\u003eを利用させていただきました。\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003e逆コンパイル結果一覧\u003c/summary\u003e\u003cdiv\u003e\n\u003cbr\u003e\nC#: ソースコード\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e127\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e128\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2147483647L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e//0b1111111111111111111111111111111\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2147483648L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e//0b10000000000000000000000000000000\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4294967167L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e//0b11111111111111111111111101111111\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4294967168L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e//0b11111111111111111111111110000000\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4294967294L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e//0b11111111111111111111111111111110\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4294967295L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e//0b11111111111111111111111111111111\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4294967296L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e//0b100000000000000000000000000000000\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=-\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=-\u003c/span\u003e\u003cspan class=\"m\"\u003e128\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=-\u003c/span\u003e\u003cspan class=\"m\"\u003e129\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=-\u003c/span\u003e\u003cspan class=\"m\"\u003e2147483648L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e=-\u003c/span\u003e\u003cspan class=\"m\"\u003e2147483649L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eMSIL: 逆アセンブル結果\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e.class private auto ansi '\u0026lt;Module\u0026gt;'\n{\n} // end of class \u0026lt;Module\u0026gt;\n\n.class private auto ansi abstract sealed beforefieldinit '\u0026lt;Program\u0026gt;$'\n    extends [System.Private.CoreLib]System.Object\n{\n    .custom instance void [System.Private.CoreLib]System.Runtime.CompilerServices.CompilerGeneratedAttribute::.ctor() = (\n        01 00 00 00\n    )\n    // Methods\n    .method private hidebysig static \n        void '\u0026lt;Main\u0026gt;$' (\n            string[] args\n        ) cil managed \n    {\n        // Method begins at RVA 0x2050\n        // Code size 102 (0x66)\n        .maxstack 1\n        .entrypoint\n        .locals init (\n            [0] int64 'value'\n        )\n\n        IL_0000: ldc.i4.0\n        IL_0001: conv.i8\n        IL_0002: stloc.0\n        IL_0003: ldc.i4.1\n        IL_0004: conv.i8\n        IL_0005: stloc.0\n        IL_0006: ldc.i4.8\n        IL_0007: conv.i8\n        IL_0008: stloc.0\n        IL_0009: ldc.i4.s 9\n        IL_000b: conv.i8\n        IL_000c: stloc.0\n        IL_000d: ldc.i4.s 127\n        IL_000f: conv.i8\n        IL_0010: stloc.0\n        IL_0011: ldc.i4 128\n        IL_0016: conv.i8\n        IL_0017: stloc.0\n        IL_0018: ldc.i4 2147483647\n        IL_001d: conv.i8\n        IL_001e: stloc.0\n        IL_001f: ldc.i4 -2147483648\n        IL_0024: conv.u8\n        IL_0025: stloc.0\n        IL_0026: ldc.i4 -129\n        IL_002b: conv.u8\n        IL_002c: stloc.0\n        IL_002d: ldc.i4.s -128\n        IL_002f: conv.u8\n        IL_0030: stloc.0\n        IL_0031: ldc.i4.s -2\n        IL_0033: conv.u8\n        IL_0034: stloc.0\n        IL_0035: ldc.i4.m1\n        IL_0036: conv.u8\n        IL_0037: stloc.0\n        IL_0038: ldc.i8 4294967296\n        IL_0041: stloc.0\n        IL_0042: ldc.i4.m1\n        IL_0043: conv.i8\n        IL_0044: stloc.0\n        IL_0045: ldc.i4.s -2\n        IL_0047: conv.i8\n        IL_0048: stloc.0\n        IL_0049: ldc.i4.s -128\n        IL_004b: conv.i8\n        IL_004c: stloc.0\n        IL_004d: ldc.i4 -129\n        IL_0052: conv.i8\n        IL_0053: stloc.0\n        IL_0054: ldc.i4 -2147483648\n        IL_0059: conv.i8\n        IL_005a: stloc.0\n        IL_005b: ldc.i8 -2147483649\n        IL_0064: stloc.0\n        IL_0065: ret\n    } // end of method '\u0026lt;Program\u0026gt;$'::'\u0026lt;Main\u0026gt;$'\n\n} // end of class \u0026lt;Program\u0026gt;$\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eC言語: ソースコード\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003etest\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e2147483647L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e2147483648L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e4294967296L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ex64アセンブラ: x86-64 gcc 10.2\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e_Z4testv:\ntest():\n        pushq   %rbp\n        movq    %rsp, %rbp\n        movq    $0, -8(%rbp)\n        movq    $1, -8(%rbp)\n        movq    $2147483647, -8(%rbp)\n        movl    $2147483648, %eax\n        movq    %rax, -8(%rbp)\n        movabsq $4294967296, %rax\n        movq    %rax, -8(%rbp)\n        nop\n        popq    %rbp\n        ret\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ex64アセンブラ: x86-64 gcc 4.1.2\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e_Z4testv:\ntest():\n        pushq   %rbp\n        movq    %rsp, %rbp\n        movq    $0, -8(%rbp)\n        movq    $1, -8(%rbp)\n        movq    $2147483647, -8(%rbp)\n        movl    $-2147483648, -8(%rbp)\n        movl    $0, -4(%rbp)\n        movl    $0, -8(%rbp)\n        movl    $1, -4(%rbp)\n        leave\n        ret\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003cp\u003e同時公開のAdvent Calendar記事\u003ca href=\"https://qiita.com/kurema/items/5a3456f9a32d08b1db74\" id=\"reference-6158eb4f238775730b9e\"\u003e「【C#】 演算子のオーバーロードで遊ぶ」\u003c/a\u003eもどうぞ。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"正数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AD%A3%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e正数\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"08--ldci4convi8\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#08--ldci4convi8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e0～8 : ldc.i4.*+conv.i8\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eパターン1: ldc.i4.*+conv.i8\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e1の代入はこうなります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        IL_0000: ldc.i4.1\n        IL_0001: conv.i8\n        IL_0002: stloc.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eよく分かりませんね。\u003cbr\u003e\n1行目の\u003ccode\u003eldc.i4.1\u003c/code\u003eというのは、\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eldc.i4.1\u003cbr\u003e\nPush 1 onto the stack as int32 (0x17)\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eだそうです。つまり、「スタックにint32で1をプッシュする」という操作です。\u003cbr\u003e\nつまりdotnetの中間言語、MSIL(\u003ca href=\"https://ja.wikipedia.org/wiki/%E5%85%B1%E9%80%9A%E4%B8%AD%E9%96%93%E8%A8%80%E8%AA%9E\" rel=\"nofollow noopener\" target=\"_blank\"\u003e共通中間言語\u003c/a\u003e)には、「1をスタックにプッシュする」なんて命令があるんです。\u003cbr\u003e\n-1～8まであります。\u003c/p\u003e\n\n\u003cp\u003e2行目はそれをint64に変換する命令。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003econv.i8\u003cbr\u003e\nConvert to int64, pushing int64 on stack (0x6A)\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e3行目はスタックから値を取り出して変数に代入する命令です。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003estloc.0\u003cbr\u003e\nPop a value from stack into local variable 0 (0x0A)\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e変数の型と名前もきちんと残っています。これのおかげでdotnetの逆コンパイルはローカル変数まで見えます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        .locals init (\n            [0] int64 'value'\n        )\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e最初は特定の値をスタックに積む専用命令があって、しかもわざわざ型変換をしてるのには驚きました。\u003cbr\u003e\nおそらくメリットは即値にほぼ0の8バイトを消費するより容量が小さくて済むことでしょう。\u003cbr\u003e\n実在のCPUでこんな命令はなさそうです(というかCPUが型を認識したりしない)。\u003cbr\u003e\nさらに言えば、アセンブラっぽいのに変数という概念があるのも不思議ですが、MSILってのはこういうものみたいです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e8L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなお8の代入はこうなります。-1～8まで同様。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        IL_0000: ldc.i4.8\n        IL_0001: conv.i8\n        IL_0002: stloc.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"c言語\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E8%A8%80%E8%AA%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC言語\u003c/h3\u003e\n\n\u003cp\u003eちなみにCでは最初に書いた通りこうなります(x64)。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        movq    $1, -8(%rbp)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003emovqってのは\u003ccode\u003eMove Quadword\u003c/code\u003eで8バイトの値のコピーです。\u003cbr\u003e\n\u003ccode\u003e%rbp\u003c/code\u003eというのはベースポインタ、つまり「rbpは関数内においてスタック領域を扱う処理の基準」だそうです。\u003cbr\u003e\nヒープはプラス方向に、スタックはマイナス方向に延びるので+8ではなく-8。\u003cbr\u003e\n普通ですね。\u003c/p\u003e\n\n\u003cp\u003eちなみにこの一行で8バイトの命令になります。\u003cbr\u003e\nなぜ8バイトの値をコピーするのに8バイトで済むのか疑問ですが、\u003ccode\u003e-8(%rbp)\u003c/code\u003eみたいな場合の即値は4バイトだからのようです。\u003c/p\u003e\n\n\u003cp\u003e2147483647までは特に面白い事は起きません。\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eちなみにC#のJITコンパイル結果 (x86)はこうなります。\u003c/summary\u003e\u003cdiv\u003e\n\u003cbr\u003e\nちなみにC#のJITコンパイル結果 (x86)はこうなります。\u003cbr\u003e\nsharplab.ioでJIT Asmを選択した結果です。x64版は今のところなさそうです。\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/e1330a3c096b9ab856bd2939b3fe29795863a3ab/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3134363436372f38663135353030372d613538322d663032322d646532352d3831633563663738333262622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146467%2F8f155007-a582-f022-de25-81c5cf7832bb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f3bf046d26702a1c9022bb9b8a8ff0b0\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/146467/8f155007-a582-f022-de25-81c5cf7832bb.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146467%2F8f155007-a582-f022-de25-81c5cf7832bb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b389f6c95ae01e3c55b48f243c47869f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    L001f: mov dword ptr [ebp-0x10], 1\n    L0026: mov eax, [ebp-0x10]\n    L0029: mov edx, [ebp-0x10]\n    L002c: sar edx, 0x1f\n    L002f: mov [ebp-0xc], eax\n    L0032: mov [ebp-8], edx\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ex86のmovはx64と引数の順序が逆なこと(2番目の引数を1番目の場所に代入)、リトルエンディアンなのでメモリアドレスが多い方に上位ビットが来ることに注意してください。\u003cbr\u003e\nebpはrbpの32ビット版です(x64にもあります)。4バイト程度ずれてるようですが気にしないでおきます。\u003c/p\u003e\n\n\u003cp\u003eSARは\u003ccode\u003eShift Arithmetic Right\u003c/code\u003eで算術右シフトのことです。すなわち正の場合は0で負の場合は1でシフトしたビットをセットするビットシフトです。\u003cbr\u003e\nつまり\u003ccode\u003esar edx, 0x1f\u003c/code\u003eは正の場合は0に、負の場合は\u003ccode\u003e0xffffffff\u003c/code\u003e(-1)になるわけです。\u003cbr\u003e\n\u003ccode\u003econv.i8\u003c/code\u003eの指示通り、律儀にintからlongに変換しているわけですね。\u003cbr\u003e\nやたら行数が多いですし、わざわざメモリを経由する必要があるのか、定数なんだから\u003ccode\u003esar\u003c/code\u003e使わずに\u003ccode\u003exor\u003c/code\u003eとかで0を作れば良さそうですし、色々謎ですね。\u003cbr\u003e\nまぁJITですし、ILを複数行見るような処理はやらない設定なんでしょう多分。\u003c/p\u003e\n\n\u003cp\u003eintの場合は普通に1行になります。\u003cbr\u003e\n32ビットCPUで64ビット型を使うのは、単なるストアの時点から命令が増えて遅いだろうなという話ですね。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    L001c: mov dword ptr [ebp-8], 1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"参考文献\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考文献\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eyone-ken (2007) 「[IL6] 定数のロードあれこれ」 \u003ca href=\"http://www5b.biglobe.ne.jp/%7Eyone-ken/VBNET/IL/il06_LoadConstant.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eKEN's .NET\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eyone-ken (2007) 「[IL13] 型と型変換」 \u003ca href=\"http://www5b.biglobe.ne.jp/%7Eyone-ken/VBNET/IL/il13_TypeAndConvert.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eKEN's .NET\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"/tobira-code\" class=\"user-mention js-hovercard\" title=\"tobira-code\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"tobira-code\"\u003e@tobira-code\u003c/a\u003e (2016) 「x86-64プロセッサのスタックを理解する」 \u003ca href=\"https://qiita.com/tobira-code/items/75d3034aed8bb9828981\" id=\"reference-4400fe247a1cd72b593b\"\u003eqiita\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e「X86アセンブラ/x86アーキテクチャ」 \u003ca href=\"https://ja.wikibooks.org/wiki/X86%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%A9/x86%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWIKIBOOKS\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"/Nina_Petipa\" class=\"user-mention js-hovercard\" title=\"Nina_Petipa\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"Nina_Petipa\"\u003e@Nina_Petipa\u003c/a\u003e「Tips　IA32（x86）汎用命令一覧　Sから始まる命令　SAL/SAR/SHL/SHR命令 」 \u003ca href=\"http://softwaretechnique.jp/OS_Development/Tips/IA32_Instructions/SAL.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e０から作るソフトウェア開発 日々勉強中。。。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eIntel (2004) 「\u003ca href=\"https://www.intel.co.jp/content/dam/www/public/ijkk/jp/ja/documents/developer/IA32_Arh_Dev_Man_Vol1_Online_i.pdf\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIA-32 インテル®アーキテクチャソフトウェア・デベロッパーズ・マニュアル 上巻\u003c/a\u003e」 7-14ページ\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"9127--ldci4sconvi8\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#9127--ldci4sconvi8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e9～127 : ldc.i4.s+conv.i8\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eパターン2: ldc.i4.s+conv.i8\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e8L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e9からは即値を使います。ただし、即値は1バイトです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        IL_0009: ldc.i4.s 9\n        IL_000b: conv.i8\n        IL_000c: stloc.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eldc.i4.s\u003c/code\u003eはint8の即値をint32としてスタックにプッシュする命令です。これは127まで続きます。\u003cbr\u003e\n地味にメモリの節約になりそうです。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eldc.i4.s\u003cbr\u003e\nPush num onto the stack as int32, short form (0x1F )\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1282147483647--ldci4convi8\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1282147483647--ldci4convi8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e128～2147483647 : ldc.i4+conv.i8\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eパターン3: ldc.i4+conv.i8\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e8L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e128からはint32の即値をスタックにプッシュする命令を使うようになります。\u003cbr\u003e\nこれは2147483647(\u003ccode\u003eint.MaxValue\u003c/code\u003e)まで続きます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        IL_0011: ldc.i4 128\n        IL_0016: conv.i8\n        IL_0017: stloc.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eldc.i4\u003cbr\u003e\nPush num of type int32 onto the stack as int32 (0x20 )\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"21474836484294967167--ldci4convu8\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#21474836484294967167--ldci4convu8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2147483648～4294967167 : ldc.i4+conv.u8\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eパターン4: ldc.i4+conv.u8\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2147483648L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//0b10000000000000000000000000000000\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e2147483648では負数が出てきます。可読性がぐんと下がります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        IL_001f: ldc.i4 -2147483648\n        IL_0024: conv.u8\n        IL_0025: stloc.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eたまたま符号のあるなしだけみたいになってますが、2147483649だと-2147483647です。\u003cbr\u003e\n\u003ccode\u003econv.u8\u003c/code\u003eはその名の通り\u003ccode\u003eunsigned int64\u003c/code\u003eに変換する命令です。\u003cbr\u003e\n負数を符号なし整数型に変換することで大きな値を得ているわけですね。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003econv.u8\u003cbr\u003e\nConvert to unsigned int64, pushing int64 on stack (0x6E)\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"c言語-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E8%A8%80%E8%AA%9E-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC言語\u003c/h3\u003e\n\n\u003cp\u003eC言語ではコンパイラーによって結果が異なるようです。\u003c/p\u003e\n\n\u003cp\u003ex86-64 gcc 4.1.2\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        movl    $-2147483648, -8(%rbp)\n        movl    $0, -4(%rbp)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e4バイトずつ代入しています。直観的です。\u003cbr\u003e\nちなみにこの2行で14バイトになります。\u003c/p\u003e\n\n\u003cp\u003ex86-64 gcc 10.2 / x86-64 clang 11.0.0\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        movl    $2147483648, %eax\n        movq    %rax, -8(%rbp)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eEAXは、RAXに使っているレジスタの下位32ビットのことです。代入すると上位32ビットもクリアされる…のだと思います。\u003cbr\u003e\n下位32ビットに代入し、64ビットコピーすることで目的の値を得ているわけですね。\u003cbr\u003e\nこの2行で9バイトです。上より5バイト節約、1を代入するだけより1バイト多いだけです。\u003cbr\u003e\nコンパイラが進歩してるんだなぁと感じます。メモリの節約はCPUキャッシュなどでも大事です。\u003c/p\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eちなみにC#のJITコンパイル結果 (x86)はこうなります。\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    L001f: mov eax, 0x80000000\n    L0024: xor edx, edx\n    L0026: mov [ebp-0xc], eax\n    L0029: mov [ebp-8], edx\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003exor edx, edx\u003c/code\u003eは0を作っているだけです。\u003cbr\u003e\n4バイトずつ書き込んでるだけですね。\u003c/p\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"42949671684294967294--ldci4sconvu8\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#42949671684294967294--ldci4sconvu8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4294967168～4294967294 : ldc.i4.s+conv.u8\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eパターン5: ldc.i4.s+conv.u8\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e4294967168L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//0b11111111111111111111111110000000\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e4294967168は何の変哲もない数字に見えます。どうなるか予想できますか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        IL_002d: ldc.i4.s -128\n        IL_002f: conv.u8\n        IL_0030: stloc.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eそうです\u003ccode\u003eldc.i4.s\u003c/code\u003eの復活です。\u003cbr\u003e\n見た目が変わり、(コンパイル結果が)短くなるだけでそんなに意味はないですね。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"4294967295--ldci4m1convu8\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4294967295--ldci4m1convu8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4294967295 : ldc.i4.m1+conv.u8\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eパターン6: ldc.i4.m1+conv.u8\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e4294967295L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e//0b11111111111111111111111111111111\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e上で書きましたが、-1だけは特別な命令があるのでこうなります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        IL_0035: ldc.i4.m1\n        IL_0036: conv.u8\n        IL_0037: stloc.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eldc.i4.m1\u003cbr\u003e\nPush -1 onto the stack as int32 (0x15)\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"4294967296--ldci8\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4294967296--ldci8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4294967296～ : ldc.i8\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eパターン7: ldc.i8\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e4294967296L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e//0b100000000000000000000000000000000\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれ以降は普通に8バイトの即値をストアするだけの簡単な作業です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        IL_0038: ldc.i8 4294967296\n        IL_0041: stloc.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eldc.i8\u003cbr\u003e\nPush num of type int64 onto the stack as int64 (0x21 )\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"c言語-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E8%A8%80%E8%AA%9E-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC言語\u003c/h3\u003e\n\n\u003cp\u003eC言語ではこうなります。\u003c/p\u003e\n\n\u003cp\u003ex86-64 gcc 4.1.2\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        movl    $0, -8(%rbp)\n        movl    $1, -4(%rbp)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこっちはいっしょ。\u003c/p\u003e\n\n\u003cp\u003ex86-64 gcc 10.2 / x86-64 clang 11.0.0\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        movabsq $4294967296, %rax\n        movq    %rax, -8(%rbp)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこちらは\u003ccode\u003emovabsq\u003c/code\u003eという長い名前の命令が出てきます。\u003cbr\u003e\n単純に64ビットの即値を取るmovですね。恐怖の10バイト命令です。\u003cbr\u003e\n2行で14バイトも使います。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/496ab4cb48233dca9d40c72c4b931f17ea89f479/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3134363436372f39303334393234352d373736342d666235632d643363662d3237396262633863376365632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146467%2F90349245-7764-fb5c-d3cf-279bbc8c7cec.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=fcdb4c7014b78dd721f704634f8d7c7e\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/146467/90349245-7764-fb5c-d3cf-279bbc8c7cec.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146467%2F90349245-7764-fb5c-d3cf-279bbc8c7cec.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d2bd1cb5c5c0fba62f63a30af576d90a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"負数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%B2%A0%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e負数\u003c/h1\u003e\n\n\u003cp\u003eでは0からマイナス方向へ行きましょう。\u003cbr\u003e\nちなみに「-2～-128」のように絶対値の順に書きます。\u003cbr\u003e\n基本、正数と同じなのでサクサク紹介していきましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"-1--ldci4convi8\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-1--ldci4convi8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e-1 : ldc.i4.*+conv.i8\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eパターン1: ldc.i4.*+conv.i8\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        IL_0042: ldc.i4.m1\n        IL_0043: conv.i8\n        IL_0044: stloc.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eldc.i4.m1\u003c/code\u003eという命令があります。-2以降はありません。\u003cbr\u003e\n既に書きましたね。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"-2-128--ldci4sconvi8\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-2-128--ldci4sconvi8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e-2～-128 : ldc.i4.s+conv.i8\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eパターン2: ldc.i4.s+conv.i8\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        IL_0045: ldc.i4.s -2\n        IL_0047: conv.i8\n        IL_0048: stloc.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e「9～127」と同じ。\u003cbr\u003e\n2の補数表現なので絶対値が1ずれます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"-129-2147483648--ldci4convi8\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-129-2147483648--ldci4convi8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e-129～-2147483648 : ldc.i4+conv.i8\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eパターン3: ldc.i4+conv.i8\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e129\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        IL_004d: ldc.i4 -129\n        IL_0052: conv.i8\n        IL_0053: stloc.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e「128～2147483647」と同じ。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"-2147483649--ldci8\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-2147483649--ldci8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e-2147483649～ : ldc.i8\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eパターン7: ldc.i8\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e2147483649L\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        IL_005b: ldc.i8 -2147483649\n        IL_0064: stloc.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e「4294967296～」と同じ。\u003cbr\u003e\n負数を\u003ccode\u003econv.u8\u003c/code\u003eにするテクニックが使えないので、8バイトの即値を持つ命令を正数より広い範囲で使わざるを得ません。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"感想\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%84%9F%E6%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e感想\u003c/h1\u003e\n\n\u003cp\u003e単なる定数のストアにこんなに種類があるのは驚きでした。7パターンもあります。\u003cbr\u003e\n出力されるILのサイズをかなり真剣に削っているようです。\u003cbr\u003e\nさらに-1～8の為の専用命令ってのも不思議ですね。驚きました。\u003cbr\u003e\n一方で、JITコンパイルの結果はちょっと見た限りではあまり洗練されていないように感じました。\u003c/p\u003e\n\n\u003cp\u003eMSILはちょくちょく読みはするんですが、これくらい読み込む機会はないので新鮮でした。\u003cbr\u003e\n普通のアセンブラもですね。\u003cbr\u003e\nアセンブラ初心者なので用語とか知識とか間違っていれば申し訳ないです。\u003c/p\u003e\n\n\u003cp\u003e以前似た話を(岩永さんの?)ツイートで見たような記憶があるので既出かもしれません。\u003cbr\u003e\nただ知ってる人が多いわけでもなさそうなので良いんじゃないでしょうか。\u003c/p\u003e\n\n\u003cp\u003eこれは元々Advent Calendar用の企画で演算子オーバーロードの調査をしている時に見つけたのですが、面白かったので記事にしたものです。\u003cbr\u003e\nそれなりの分量になったので、本題が間に合わなさそうならこっちを代わりにします。公開時期も遅らせときます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"表\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A1%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e表\u003c/h1\u003e\n\n\u003cp\u003e命令長/パターンは以下になります。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e数値\u003c/th\u003e\n\u003cth\u003eパターン\u003c/th\u003e\n\u003cth\u003e命令長(合計)\u003c/th\u003e\n\u003cth\u003e命令\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e-9,223,372,036,854,775,808\u003c/td\u003e\n\u003ctd\u003e7\u003c/td\u003e\n\u003ctd\u003e9\u003c/td\u003e\n\u003ctd\u003eldc.i8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e-2,147,483,649\u003c/td\u003e\n\u003ctd\u003e7\u003c/td\u003e\n\u003ctd\u003e9\u003c/td\u003e\n\u003ctd\u003eldc.i8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e-2,147,483,648\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003eldc.i4+conv.i8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e-129\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003eldc.i4+conv.i8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e-128\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003eldc.i4.s+conv.i8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e-2\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003eldc.i4.s+conv.i8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e-1\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003eldc.i4.m1+conv.i8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e8\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003eldc.i4.8+conv.i8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e9\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003eldc.i4.s+conv.i8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e127\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003eldc.i4.s+conv.i8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e128\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003eldc.i4+conv.i8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2,147,483,647\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003eldc.i4+conv.i8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2,147,483,648\u003c/td\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003eldc.i4+conv.u8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4,294,967,167\u003c/td\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003eldc.i4+conv.u8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4,294,967,168\u003c/td\u003e\n\u003ctd\u003e5\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003eldc.i4.s+conv.u8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4,294,967,294\u003c/td\u003e\n\u003ctd\u003e5\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003eldc.i4.s+conv.u8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4,294,967,295\u003c/td\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003eldc.i4.m1+conv.u8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4,294,967,296\u003c/td\u003e\n\u003ctd\u003e7\u003c/td\u003e\n\u003ctd\u003e9\u003c/td\u003e\n\u003ctd\u003eldc.i8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e9,223,372,036,854,775,807\u003c/td\u003e\n\u003ctd\u003e7\u003c/td\u003e\n\u003ctd\u003e9\u003c/td\u003e\n\u003ctd\u003eldc.i8\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/bda008295441e1781f0c2a2637f8b79b7e20d20c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3134363436372f32623836313264642d353839362d343237322d386436662d6533343236646432613964302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146467%2F2b8612dd-5896-4272-8d6f-e3426dd2a9d0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=587934a715c6c15e8c85693f9a06e1d4\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/146467/2b8612dd-5896-4272-8d6f-e3426dd2a9d0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F146467%2F2b8612dd-5896-4272-8d6f-e3426dd2a9d0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1a12a4fb5ed001f969d80d6ba66074a2 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おまけ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおまけ\u003c/h1\u003e\n\n\u003cp\u003eC#上でILを手軽に触る方法もあります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Reflection.Emit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Reflection\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eDynamicMethod\u003c/span\u003e \u003cspan class=\"n\"\u003emethod\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDynamicMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"DynamicMethod\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmptyTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eILGenerator\u003c/span\u003e \u003cspan class=\"n\"\u003eil\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetILGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeclareLocal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLdc_I4_S\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003esbyte\u003c/span\u003e\u003cspan class=\"p\"\u003e)-\u003c/span\u003e\u003cspan class=\"m\"\u003e128\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eConv_U8\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStloc_0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLdloc_0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCall\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"WriteLine\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReflection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatic\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReflection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePublic\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInt64\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRet\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eAction\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateDelegate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003eaharisu (2009) 「DynamicMethodで末尾再帰」 \u003ca href=\"https://aharisu.hatenadiary.org/entry/20091009/1255089862\" rel=\"nofollow noopener\" target=\"_blank\"\u003eaharisuのごみ箱\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","createdAt":"2020-12-18T02:35:04Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"NgGfYAUIVIs9lzpAmHwOlxBE05WVSVsMmQ==--YLbYTbu2Z380BB8J--NQHG6ddRy7Gj/pN+Q0HSiQ==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-12-25T06:31:49Z","likesCount":4,"linkUrl":"https://qiita.com/kurema/items/90177242828af01f7c1d","organization":null,"originalId":1361063,"stockedCount":3,"title":"【逆アセ】 C#でlongに代入してみる ","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%AD%A3%E6%95%B0\"\u003e正数\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#08--ldci4convi8\"\u003e0～8 : ldc.i4.*+conv.i8\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#c%E8%A8%80%E8%AA%9E\"\u003eC言語\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\"\u003e参考文献\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#9127--ldci4sconvi8\"\u003e9～127 : ldc.i4.s+conv.i8\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1282147483647--ldci4convi8\"\u003e128～2147483647 : ldc.i4+conv.i8\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#21474836484294967167--ldci4convu8\"\u003e2147483648～4294967167 : ldc.i4+conv.u8\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#c%E8%A8%80%E8%AA%9E-1\"\u003eC言語\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#42949671684294967294--ldci4sconvu8\"\u003e4294967168～4294967294 : ldc.i4.s+conv.u8\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4294967295--ldci4m1convu8\"\u003e4294967295 : ldc.i4.m1+conv.u8\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4294967296--ldci8\"\u003e4294967296～ : ldc.i8\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#c%E8%A8%80%E8%AA%9E-2\"\u003eC言語\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%B2%A0%E6%95%B0\"\u003e負数\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#-1--ldci4convi8\"\u003e-1 : ldc.i4.*+conv.i8\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#-2-128--ldci4sconvi8\"\u003e-2～-128 : ldc.i4.s+conv.i8\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#-129-2147483648--ldci4convi8\"\u003e-129～-2147483648 : ldc.i4+conv.i8\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#-2147483649--ldci8\"\u003e-2147483649～ : ldc.i8\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%84%9F%E6%83%B3\"\u003e感想\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A1%A8\"\u003e表\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91\"\u003eおまけ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":551,"uuid":"90177242828af01f7c1d","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"7Qzu4PDY2YQ6LwF1rgk4Is0n+Hmu--W5pL78PhI3hiOu80--T/f/Yw/ZtKIexAxgsRHUVw==","originalId":146467,"description":"","facebookUrl":null,"githubUrl":"https://github.com/kurema","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://avatars.githubusercontent.com/u/10556974?v=3","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F10556974%3Fv%3D3?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=27e0b4a3d6a0c36fee1e61d21a436525","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F10556974%3Fv%3D3?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=796754f7c11031fdc3703568a48ac8c9","urlName":"kurema","websiteUrl":"","twitterUrl":"https://twitter.com/kurema_makoto","twitterUrlName":"kurema_makoto","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"MSIL","urlName":"msil"},{"name":"dotnet","urlName":"dotnet"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

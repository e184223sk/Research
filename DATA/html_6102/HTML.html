<!DOCTYPE html><html><head><meta charset="utf-8" /><title>[C#備忘録]MultiThreadデザインパターンのC#版について - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/tassi-yuzukko/items/4953654bad83798d2457" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="BQH+v1xukKOp9lgbg1Kh0Y53wmF0Xj+Kdsz4/ti6SOF/P1wW6r0c3S43Ytzcxwxzcfn+ritg9W6BzLL22fSywg==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="[C#備忘録]MultiThreadデザインパターンのC#版について - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XME1qNVlLWjViLVk2WXl5WFUxMWJIUnBWR2h5WldGazQ0T0g0NEsyNDRLazQ0T3o0NE9SNDRLXzQ0Tzg0NE96NDRHdVF5UG5pWWpqZ2F2amdhVGpnWVRqZ2FZJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTVhZjZkNzAyNTA4NGI1ZDI3MmQzMjIzNjVkY2RjZDc3&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJoYzNOcExYbDFlblZyYTI4JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9N2YzOThlNWQxNDhmNjVmNGEyNjM2NGQzMzQ4MDNjNzA&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=bc6f5532a0401817bb27822b1344a52b"><meta property="og:description" content="

What&#39;s This ?

結城浩氏著の「Java言語で学ぶデザインパターン【マルチスレッド編】」をC#で使用するにはどうするか？
ということで、C#で実際に実装してみた。
また、デザインパターンの自分なりの理解を備忘録として残..."><meta content="https://qiita.com/tassi-yuzukko/items/4953654bad83798d2457" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,.NET,マルチスレッド,デザインパターン" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-c3cc9497-b75e-40e5-8af0-18e311d89f54"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Ftassi-yuzukko%2Fitems%2F4953654bad83798d2457">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Ftassi-yuzukko%2Fitems%2F4953654bad83798d2457">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-c3cc9497-b75e-40e5-8af0-18e311d89f54">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-08-20T07:58:07.000+09:00","dateModified":"2018-04-21T20:18:37.000+09:00","headline":"[C#備忘録]MultiThreadデザインパターンのC#版について","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XME1qNVlLWjViLVk2WXl5WFUxMWJIUnBWR2h5WldGazQ0T0g0NEsyNDRLazQ0T3o0NE9SNDRLXzQ0Tzg0NE96NDRHdVF5UG5pWWpqZ2F2amdhVGpnWVRqZ2FZJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTVhZjZkNzAyNTA4NGI1ZDI3MmQzMjIzNjVkY2RjZDc3\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJoYzNOcExYbDFlblZyYTI4JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9N2YzOThlNWQxNDhmNjVmNGEyNjM2NGQzMzQ4MDNjNzA\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=bc6f5532a0401817bb27822b1344a52b","mainEntityOfPage":"https://qiita.com/tassi-yuzukko/items/4953654bad83798d2457","author":{"@type":"Person","address":null,"email":null,"identifier":"tassi-yuzukko","name":"tassi-yuzukko","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F132272%2Fprofile-images%2F1473718569?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=a8be6eb48db8609fd79cbeee3b4f63ea","url":"https://qiita.com/tassi-yuzukko","description":null,"memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita&amp;utm_medium=header-banner">グループ会社出納業務の証票処理を70％自動化。日立のAI-OCR技術とは？</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tassi-yuzukko","type":"items","id":"4953654bad83798d2457"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"グループ会社出納業務の証票処理を70％自動化。日立のAI-OCR技術とは？","url":"https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tassi-yuzukko","type":"items","id":"4953654bad83798d2457"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"グループ会社出納業務の証票処理を70％自動化。日立のAI-OCR技術とは？","url":"https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tassi-yuzukko","type":"items","id":"4953654bad83798d2457"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"グループ会社出納業務の証票処理を70％自動化。日立のAI-OCR技術とは？","url":"https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/tassi-yuzukko/items/4953654bad83798d2457","location":"/tassi-yuzukko/items/4953654bad83798d2457","scheme":"https","host":"qiita.com","port":null,"pathname":"/tassi-yuzukko/items/4953654bad83798d2457","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"3/G6GYnhHXPNl7xvb3EhReX65iXxiXM+rpR3ixej6jSlzxiwPzKRDUpWhqgw5IznGnTa6q63udpZlD2DFu0QFw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-16099521-ec73-4c9f-a0d3-98d486e7045e"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tassi-yuzukko/items/4953654bad83798d2457/likers" class="css-1iupg5d">24</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">25</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/4953654bad83798d2457/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tassi-yuzukko/items/4953654bad83798d2457/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tassi-yuzukko/items/4953654bad83798d2457/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tassi-yuzukko/items/4953654bad83798d2457/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tassi-yuzukko/items/4953654bad83798d2457.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/tassi-yuzukko"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/132272/profile-images/1473718569" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/tassi-yuzukko" class="css-10ougpm">@<!-- -->tassi-yuzukko</a><div class="css-1ay9vb9"><span><meta content="2017-08-19T22:58:07Z"/><time dateTime="2018-04-21T11:18:37Z" class="css-m19uds">updated at 2018-04-21</time></span></div></div></div></div></div><h1 class="css-cgzq40">[C#備忘録]MultiThreadデザインパターンのC#版について</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/.net" class="css-4czcte">.NET</a><a href="/tags/%e3%83%9e%e3%83%ab%e3%83%81%e3%82%b9%e3%83%ac%e3%83%83%e3%83%89" class="css-4czcte">マルチスレッド</a><a href="/tags/%e3%83%87%e3%82%b6%e3%82%a4%e3%83%b3%e3%83%91%e3%82%bf%e3%83%bc%e3%83%b3" class="css-4czcte">デザインパターン</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="whats-this-" class="fragment"></span><a href="#whats-this-"><i class="fa fa-link"></i></a>What's This ?</h1>

<p>結城浩氏著の「<a href="http://amzn.asia/aJZOXEw" rel="nofollow noopener" target="_blank">Java言語で学ぶデザインパターン【マルチスレッド編】</a>」をC#で使用するにはどうするか？<br>
ということで、C#で実際に実装してみた。<br>
また、デザインパターンの自分なりの理解を備忘録として残しておく。</p>

<p><a href="http://qiita.com/tassi-yuzukko/items/45d6db3bd873d88bce6f" id="reference-b32f38939c90a6cd62b7">こちら</a>から移動</p>

<p><a href="http://qiita.com/tassi-yuzukko/items/79edec981dc8fa05a4aa" id="reference-ddb31d8209c32dc0133c">ここ</a>に独断と偏見でまとめた</p>

<h2>
<span id="注意" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F"><i class="fa fa-link"></i></a>注意</h2>

<p>一応、ここに書いているのは個人の解釈が主なので、正解じゃない可能性が高いです。<br><br>
現に、かなりの頻度で修正を入れています。（現在進行形）</p>

<h1>
<span id="デザインパターン一覧" class="fragment"></span><a href="#%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E4%B8%80%E8%A6%A7"><i class="fa fa-link"></i></a>デザインパターン一覧</h1>

<h2>
<span id="１single-thread-execution-パターン" class="fragment"></span><a href="#%EF%BC%91single-thread-execution-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>１．<a href="https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/01_SingleThreadedExecution" rel="nofollow noopener" target="_blank">Single Thread Execution パターン</a>
</h2>

<h3>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h3>

<p>クラスメソッドを以下の２パターンに分類する</p>

<ul>
<li>SafeMethod・・・スレッドセーフを考慮しないでよいメソッド</li>
<li>UnsafeMethod・・・スレッドセーフを考慮する必要があるメソッド</li>
</ul>

<p>上記<code>UnsafeMethod</code>に対して、<code>lock</code>ステートメントを使用してスレッドセーフにする</p>

<h3>
<span id="気を付けること" class="fragment"></span><a href="#%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8B%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>気を付けること</h3>

<ul>
<li>クラスを継承したり、メソッドを追加するとき、その人は<code>lock</code>ステートメントを使うべきかどうかを判断する必要がある（「異常継承」というらしい）</li>
<li>パフォーマンスがちょっと落ちる</li>
</ul>

<h2>
<span id="２immutable-パターン" class="fragment"></span><a href="#%EF%BC%92immutable-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>２．<a href="https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_02_Immutable" rel="nofollow noopener" target="_blank">Immutable パターン</a>
</h2>

<h3>
<span id="概要-1" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81-1"><i class="fa fa-link"></i></a>概要</h3>

<p>クラスを以下の２パターンに分類する</p>

<ul>
<li>Immutable・・・メンバやクラスが参照するインスタンスの状態が変わることのないクラス<br>
（例えば、<code>string</code>はImmutableである）</li>
<li>Mutable・・・状態が変わるクラス</li>
</ul>

<p>上記のImmutableクラスは、複数のスレッドから同時にアクセスしても問題ない<br>
そのため、<code>lock</code>ステートメントを使用しなくてもよい<br>
クラスが<code>Immutable</code>であるかどうかを意識することが重要である<br>
<code>Immutable</code>クラスは、外部フィールドはreadonlyまたは読み取り専用メソッドのみとし、メソッドもクラス内部を変更する処理は行わない</p>

<h3>
<span id="気を付けること-1" class="fragment"></span><a href="#%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8B%E3%81%93%E3%81%A8-1"><i class="fa fa-link"></i></a>気を付けること</h3>

<ul>
<li>
<code>Immutable</code>であることは非常に脆い。ちょっとの変更ですぐに崩れる。<br>
→Single Thread Execution パターンと同様に、異常継承になる場合がある</li>
<li>クラスに <code>sealed</code> オプションを付けることで、継承異常を防ぐことが可能</li>
</ul>

<h3>
<span id="個人的な解釈" class="fragment"></span><a href="#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88"><i class="fa fa-link"></i></a>個人的な解釈</h3>

<p><strong>値オブジェクトは<code>Immutable</code>なクラスである</strong>といえるっぽい　<br>
　→値オブジェクトは状態を持たないから<br>
つまり、値オブジェクトはスレッドセーフであるといえる（はず）</p>

<h2>
<span id="３guarded-suspension-パターン" class="fragment"></span><a href="#%EF%BC%93guarded-suspension-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>３．<a href="https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_03_GuardedSuspension" rel="nofollow noopener" target="_blank">Guarded Suspension パターン</a>
</h2>

<h3>
<span id="概要-2" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81-2"><i class="fa fa-link"></i></a>概要</h3>

<ul>
<li>
<code>Monitor.Wait</code>と<code>Monitor.Pulse</code>メソッドを使う<sup id="fnref1"><a href="#fn1" title="WaitメソッドおよびPulseメソッドは、lockステートメント内で実行することが前提となる。Waitメソッドを実行すると、内部ではlockによる排他制御を開放してスレッドがwait状態に入る。これは、コード的には直感的でないように思えるんだけど、かなり重要なことだと思う。">1</a></sup>
</li>
<li>スレッドAは実行条件に合致するまで動作をWait状態にする。実行条件に合致するときは、待たずに処理を即実行する。<br>
（上記の実行条件のことを、「ガード条件」という）</li>
<li>スレッドBはガード条件を満たした際に、Pulseを通知する</li>
<li>Wait状態やPulseを通知するのは、ガードオブジェクトとして定義されたクラスが行う。つまり、スレッドAとスレッドBはガードオブジェクトを操作するのみで、ガード条件などには関与しない。ガード条件とそれに伴うWait／Pulseの責務はガードオブジェクトのみが負うことが重要。</li>
</ul>

<p>つまり、<strong>「条件が満たされるまでは待ちが発生するスレッド」を実現する</strong><br>
パターンの意図としては、条件付きのSingle Thread Execution パターンとして使用する</p>

<h3>
<span id="気を付けること-2" class="fragment"></span><a href="#%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8B%E3%81%93%E3%81%A8-2"><i class="fa fa-link"></i></a>気を付けること</h3>

<ul>
<li>スレッドAで「ガード条件の評価」と「条件に合致しなければWaitすること」を行う。<br>
スレッドBで「ガード条件を満たす処理」と「Pulseすること」を行う。<br>
つまり、ちょっとのミスでスレッド処理が進まなくなることになる。

<ul>
<li>これを回避するために、Waitメソッドにタイムアウトを設ける方法がある</li>
</ul>
</li>
<li>恐らくC#4.0以降では、<code>Monitor.*</code>の代わりに<code>ManualResetEventSlim</code>を使うべきっぽい<br>
（詳しくは<a href="http://qiita.com/laughter/items/1e64ab8712e410a8f047" id="reference-193d17ca9ec2969215c3">こちら</a>を参照）

<ul>
<li>が、現段階ではこれは今後の課題としとく</li>
</ul>
</li>
</ul>

<h3>
<span id="その他concurrentqueue誤りを使うべきとしていたのを修正" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96concurrentqueue%E8%AA%A4%E3%82%8A%E3%82%92%E4%BD%BF%E3%81%86%E3%81%B9%E3%81%8D%E3%81%A8%E3%81%97%E3%81%A6%E3%81%84%E3%81%9F%E3%81%AE%E3%82%92%E4%BF%AE%E6%AD%A3"><i class="fa fa-link"></i></a>その他（ConcurrentQueue誤りを使うべきとしていたのを修正）</h3>

<ul>
<li>
<del><a href="https://msdn.microsoft.com/ja-jp/library/dd267265(v=vs.110).aspx" rel="nofollow noopener" target="_blank">ConcurrentQueue</a>を使用することで、lockやWait／Pulseを使用することなく実装できる</del>

<ul>
<li><del><code>TryDequeue</code>メソッドと<code>Enqueue</code>メソッドを使用する</del></li>
<li><del>たぶん、実現するなら<code>ConcurrentQueue</code>を使用すべき</del></li>
</ul>
</li>
<li>
<a href="https://msdn.microsoft.com/ja-jp/library/dd997371(v=vs.110).aspx" rel="nofollow noopener" target="_blank">BlockingCollection</a>を使用すべきでした。<code>ConcurrentQueue</code>はWait/Pulseを内部的に持っていないようで、スレッドを待たせることはできないです。（たぶん）

<ul>
<li>
<code>Add/Take</code>メソッドで、Take時にキューが空なら内部で待ちが発生する</li>
<li>ということで、実現するなら<code>BlockingCollection</code>を使用すべき</li>
</ul>
</li>
</ul>

<h3>
<span id="個人的な解釈-1" class="fragment"></span><a href="#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-1"><i class="fa fa-link"></i></a>個人的な解釈</h3>

<ul>
<li>応用することでメッセージキューを実現できるような気がする（<a href="https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_03_GuardedSuspension/MsgQueTest" rel="nofollow noopener" target="_blank">サンプル</a>）

<ul>
<li>素朴なメッセージキューだと、メッセージを受け取れない間は、短いSleepをはさみつつ無限ループで待つ方式になる</li>
<li>このパターンで<code>Wait</code>を使用することで、効率的な待ちを実現できる（気がする）</li>
</ul>
</li>
</ul>

<h2>
<span id="４balking-パターン" class="fragment"></span><a href="#%EF%BC%94balking-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>４．<a href="https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_04_Balking" rel="nofollow noopener" target="_blank">Balking パターン</a>
</h2>

<h3>
<span id="概要-3" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81-3"><i class="fa fa-link"></i></a>概要</h3>

<ul>
<li>「Balk」とは、野球のボークと同じ意味。「途中でやめる」こと。</li>
<li>基本的には、Guarded Suspension パターンの派生と思ってよいかも

<ul>
<li>ガード条件に一致しない場合、処理を終了させる</li>
</ul>
</li>
<li>つまり、１つのスレッドで処理が実行中または実行完了していたら、他のスレッドからは実行しなくてよいときとかに使える</li>
</ul>

<h3>
<span id="使えるシチュエーション" class="fragment"></span><a href="#%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>使えるシチュエーション</h3>

<ul>
<li>途中でやめることでパフォーマンスを上げる（または応答性を上げる）</li>
<li>ガード条件が満たされるのが最初の一回だけのとき

<ul>
<li>例</li>
</ul>
</li>
</ul>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">スレッドセーフで最初の一回だけ初期化する処理.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Something</span>
<span class="p">{</span>
  <span class="kt">bool</span> <span class="n">_isInited</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
  <span class="kt">object</span> <span class="n">_lock</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">object</span><span class="p">();</span>

  <span class="k">public</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">lock</span><span class="p">(</span><span class="n">_lock</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">_isInited</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="k">return</span><span class="p">:</span>
      <span class="p">}</span>

      <span class="c1">// 何かしらの初期化処理を実行</span>

      <span class="n">_isInited</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h3>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h3>

<ul>
<li>タイムアウトを設定することで、Guarded Suspension パターンと Balking パターンの中間を表現することができる

<ul>
<li>タイムアウトまでにガード条件が成立すると、処理を実行する</li>
<li>タイムアウトしてもガード条件が成立しなければ、処理を放棄する（途中でやめる）</li>
</ul>
</li>
</ul>

<h2>
<span id="５producer-consumer-パターン" class="fragment"></span><a href="#%EF%BC%95producer-consumer-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>５．<a href="https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_05_Producer-Consumer" rel="nofollow noopener" target="_blank">Producer-Consumer パターン</a>
</h2>

<h3>
<span id="概要-4" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81-4"><i class="fa fa-link"></i></a>概要</h3>

<ul>
<li>Producer・・・生産者：データを作成するスレッド</li>
<li>Consumer・・・消費者：データを利用するスレッド</li>
<li>Channel・・・ProducerがConsumerへ安全にデータを渡す橋渡し役</li>
<li>Channelはキューで実装し、Producerはキューに仕事を追加し、Consumerはキューから仕事を取り出す</li>
</ul>

<p>Channelは、Producer向けとConsumer向けそれぞれのガード条件付きメソッドを持つ。<br>
ProducerおよびConsumerは、Channelのメソッドを呼び出すだけなので、ガード条件の存在を知る必要がない。もっというとスレッドセーフであるかどうかを気にする必要もない。<br>
→スレッドセーフの責務を負うのはChannelのみ</p>

<h3>
<span id="個人的な解釈使えるシチュエーション" class="fragment"></span><a href="#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>個人的な解釈＆使えるシチュエーション</h3>

<ul>
<li>Guarded Suspension パターンと似ているが、ガード条件がProducer側向けメソッド（サンプルでいうPutメソッド）とConsumer側向けメソッド（サンプルでいうTakeメソッド）の両方にそれぞれ存在するのが異なる。</li>
<li>Guarded Suspension パターンではputする側（＝Producer）は条件なくputできていたが、Producer-Consumer パターンではputする際にも条件が必要になる。

<ul>
<li>大きさが有限のキューなどに適用できる？と思う</li>
</ul>
</li>
<li>実際に実装する場合は、<code>BlockingCollection</code>を使うべき

<ul>
<li>スレッドセーフなキュー</li>
<li>ブロッキング処理を内包（WaitとPulseをカプセル化）</li>
<li>キューイングできる範囲を指定可</li>
</ul>
</li>
</ul>

<h2>
<span id="６read-write-lock-パターン" class="fragment"></span><a href="#%EF%BC%96read-write-lock-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>６．<a href="https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_06_Read_Write_%20Lock" rel="nofollow noopener" target="_blank">Read-Write Lock パターン</a>
</h2>

<h3>
<span id="概要-5" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81-5"><i class="fa fa-link"></i></a>概要</h3>

<ul>
<li>「読む」処理と「書く」処理を分けて考える。

<ul>
<li>スレッドがインスタンスの状態を「読む」処理を行っても、インスタンスの状態は変化しない。<br>
しかし、「書く」処理を行うと、インスタンスの状態は変化する。</li>
</ul>
</li>
<li>「読み用ロック」と「書き用ロック」をそれぞれ用意する

<ul>
<li>「読む」処理は、インスタンスの状態が変わらないから、複数スレッドから同時に読むのは問題ない。しかし、<strong>あるスレッドが「読む」処理実行中は、他のスレッドは「書く」処理は禁止する</strong>。</li>
<li>同様に、<strong>あるスレッドが「書く」処理中は、他のスレッドは「読む」処理および「書く」処理を禁止する</strong>。</li>
</ul>
</li>
</ul>

<h4>
<span id="排他制御の詳細衝突の種類" class="fragment"></span><a href="#%E6%8E%92%E4%BB%96%E5%88%B6%E5%BE%A1%E3%81%AE%E8%A9%B3%E7%B4%B0%E8%A1%9D%E7%AA%81%E3%81%AE%E7%A8%AE%E9%A1%9E"><i class="fa fa-link"></i></a>排他制御の詳細（衝突の種類）</h4>

<table>
<thead>
<tr>
<th style="text-align: center"></th>
<th style="text-align: left">読む</th>
<th style="text-align: left">書く</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">読む</td>
<td style="text-align: left">衝突なし</td>
<td style="text-align: left">「読む」と「書く」の衝突<br>⇒read-write conflict</td>
</tr>
<tr>
<td style="text-align: center">書く</td>
<td style="text-align: left">「読む」と「書く」の衝突<br>⇒read-write conflict</td>
<td style="text-align: left">「書く」と「書く」の衝突<br>⇒write-write conflict</td>
</tr>
</tbody>
</table>

<p>以上より、排他制御には３種類存在する。</p>

<h3>
<span id="個人的な解釈-2" class="fragment"></span><a href="#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-2"><i class="fa fa-link"></i></a>個人的な解釈</h3>

<ul>
<li>「読み用ロック」および「書き用ロック」を自前で作る？

<ul>
<li>ロックの中身は<code>Semaphore</code>と同様で、値をインクリメント／デクリメントして制御する</li>
<li>自前Semaphoreってこと？なんか車輪の再開発な感じがするが・・・</li>
</ul>
</li>
<li>スレッド間で「読む」処理が同時に起こった場合は、衝突としない。このように自前条件を拡張できるから自前Semaphoreってこと？</li>
</ul>

<h3>
<span id="使えるシチュエーション-1" class="fragment"></span><a href="#%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-1"><i class="fa fa-link"></i></a>使えるシチュエーション</h3>

<ul>
<li>読む処理と書き処理が同時発生する可能性がある場合で、読む処理同士を止める必要がない場合に使える？</li>
</ul>

<h3>
<span id="その他-1" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96-1"><i class="fa fa-link"></i></a>その他</h3>

<ul>
<li>.NETでは、<a href="https://msdn.microsoft.com/ja-jp/library/system.threading.readerwriterlockslim(v=vs.110).aspx" rel="nofollow noopener" target="_blank"><code>ReaderWriterLockSlim</code></a>という既製クラスが存在する。これ使えば格段とコードしやすくなる。</li>
</ul>

<h2>
<span id="７thread-per-message-パターン" class="fragment"></span><a href="#%EF%BC%97thread-per-message-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>７．<a href="https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_07_Thread_Per_Message" rel="nofollow noopener" target="_blank">Thread-Per-Message パターン</a>
</h2>

<h3>
<span id="概要-6" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81-6"><i class="fa fa-link"></i></a>概要</h3>

<ul>
<li>何らかの命令（要求）ごとに、新しくスレッドが処理を行う。</li>
<li>「依頼する側」は、「処理する側」が実際に処理していることを関知しない<br>
⇒非同期で処理が実行される。処理を待たない。 </li>
</ul>

<h3>
<span id="個人的な解釈-3" class="fragment"></span><a href="#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-3"><i class="fa fa-link"></i></a>個人的な解釈</h3>

<ul>
<li>スレッドを立てる際、インスタンスメソッドを並列で呼び出す仕組みなのがミソ？

<ul>
<li>→並列処理するが、インスタンスは「依頼する側」で生成するため、インスタンスが複数生成されるわけではない。 </li>
</ul>
</li>
<li>こうすることで、以下の点を狙っている？（メリット？）にしても、スレッドごとにインスタンスを生成して処理してもいいような・・・<br>

<ul>
<li>メモリの無駄な浪費を避ける</li>
<li>インスタンス内のフィールドを共有できる</li>
</ul>
</li>
<li>そういうことまではこのパターンでは意図していないのかな？</li>
<li>なんかしっくりこないパターン・・・

<ul>
<li>ただの非同期処理のことなら、わざわざパターンとして定義するほどのことではないと思うが？</li>
</ul>
</li>
</ul>

<h2>
<span id="８worker-thread-パターン" class="fragment"></span><a href="#%EF%BC%98worker-thread-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>８．<a href="https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_08_WorkerThread" rel="nofollow noopener" target="_blank">Worker Thread パターン</a>
</h2>

<h3>
<span id="概要-7" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81-7"><i class="fa fa-link"></i></a>概要</h3>

<ul>
<li>一般的に<code>Thread Pool</code>と呼ばれるもの</li>
<li>あらかじめワーカスレッドを起動しておき、クライアントスレッドはキューに仕事を追加し、ワーカスレッドはキューから仕事を取り出す、を繰り返す

<ul>
<li>つまり、<code>Producer-Consumer</code>パターンを使用している。</li>
</ul>
</li>
<li>
<code>Producer-Consumer</code>パターンと同じく、クライアント側とワーカ側はスレッドセーフとかを意識しなくてよい</li>
<li>あらかじめワーカスレッドを起動するので、起動するスレッド数は固定となる</li>
</ul>

<h3>
<span id="個人的な解釈-4" class="fragment"></span><a href="#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-4"><i class="fa fa-link"></i></a>個人的な解釈</h3>

<ul>
<li>このパターンの実体は、<strong>あらかじめ先にスレッドを生成しておく<code>Producer-Consumer</code>パターン</strong>と言い切ってしまってよいかも？</li>
<li>できることは、 <code>Producer-Consumer</code>パターンと同じと思ってよい？<br>
</li>
<li>以下の点が異なる。

<ul>
<li>起動時にあらかじめワーカスレッドを起動することで、新しいスレッドを起動するコストを軽減する</li>
<li>スレッドの生成数をあらかじめ決める</li>
</ul>
</li>
</ul>

<h3>
<span id="使えるシチュエーション-2" class="fragment"></span><a href="#%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-2"><i class="fa fa-link"></i></a>使えるシチュエーション</h3>

<ul>
<li>処理コストに比べて、スレッド生成コストがネックとなる場合</li>
<li>あらかじめ起動スレッドの数を決めておきたいとき</li>
<li>
<code>Thread-Per-Message</code>パターンと<code>WorkerThread</code>パターンの両方に言えることだが、<code>Command</code>パターンの実現に使用できる

<ul>
<li>命令（仕事）をクラス化するのが<code>Command</code>パターン</li>
</ul>
</li>
<li>
<code>Thread-Per-Message</code>パターンと<code>WorkerThread</code>パターンにおいて、仕事をクラス化してマルチスレッドで処理することを実現できる</li>
</ul>

<h3>
<span id="補足" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3"><i class="fa fa-link"></i></a>補足</h3>

<ul>
<li>C#5.0以降は<code>Task</code>がThreadPoolの役割を果たしているらしい</li>
<li>つまり、ここで提示したサンプルプログラムは<code>Task</code>を使用しているので、冗長で意味がない</li>
<li>もっというと、<code>Thread-Per-Message</code>パターンのサンプルも<code>Task</code>を使用しているので、内部的にはThreadPoolになっているので、実際はサンプルになっていない</li>
</ul>

<h2>
<span id="９future-パターン" class="fragment"></span><a href="#%EF%BC%99future-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>９．<a href="https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_09_Future" rel="nofollow noopener" target="_blank">Future パターン</a>
</h2>

<h3>
<span id="概要-8" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81-8"><i class="fa fa-link"></i></a>概要</h3>

<ul>
<li>処理を別スレッドで実行し、依頼側に疑似的な答えをすぐに返す。実際の処理結果は後から取得する。</li>
<li>本には「実行結果が得るまで待つ代わりに「引換券」をもらう」と記載されている。</li>
<li>いきなり難易度が上がった感じがする。というか、かなり複雑・・・

<ul>
<li>[追記]しかし、どうやら本質的にはC#でいう<code>await</code>実装だけで実現できるみたいなので、解釈の仕方が合っているなら、目的も単純であるし、実装も簡単。</li>
<li>サンプルでは、<code>Main</code>メソッドと実際に仕事を行う<code>RealData</code>クラスは、マルチスレッドで処理していることを関知していない。マルチスレッドであることをカプセル化するならば、ちょっとややこしくなるかも。</li>
</ul>
</li>
</ul>

<h3>
<span id="個人的な解釈-5" class="fragment"></span><a href="#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-5"><i class="fa fa-link"></i></a>個人的な解釈</h3>

<ul>
<li>処理開始は非同期で実行し、結果受け取りは同期する処理を実現する。

<ul>
<li><del>C#の場合、同期処理は通常<code>async/await</code>を使用するが、awaitせずに同期処理を実行できる感じ？</del></li>
</ul>
</li>
<li>↑ かなり頓珍漢なことを言っていた。どうやら<code>await</code>キーワードそのものがFutureパターンを満たすものっぽい。</li>
<li>つまり、<strong>C#ではFutureパターンをゴリゴリ実装する必要はなく、<code>await</code>キーワード一発で実現できるっぽい</strong>
</li>
<li>疑似的な答えを返すクラスと、実処理の答えを返すクラスが、同じインターフェイスを実装しているあたり、Proxyパターンと同じような考え方のようだ。

<ul>
<li>というか、たぶんFutureパターン＝Proxyパターンと考えて良さそう。</li>
<li>Future役＝Proxy役。RealData役＝RealSubject役。</li>
</ul>
</li>
</ul>

<p>以下、C#での<code>Task.Start</code>と<code>await</code>を使用することで、非同期で処理をスタートし、処理の終了は同期をとれるかを確認してみた。<br>
（処理結果を受け取ることはしていないが、Futureパターンの本質は上記のように<strong>処理開始は非同期だが、処理の終わりは待合せたい</strong>ということだと解釈しています）</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">async</span> <span class="n">Task</span> <span class="nf">FutureSampleAsync</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Async BEGIN"</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">task</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Task</span><span class="p">(()</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Task BEGIN"</span><span class="p">);</span>
        <span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="m">2000</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Task END"</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="n">task</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Async END"</span><span class="p">);</span>

    <span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="m">1000</span><span class="p">);</span>

    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Await BEGIN"</span><span class="p">);</span>
    <span class="k">await</span> <span class="n">task</span><span class="p">;</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Await END"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上記<code>FutureSampleAsync</code>を実行すると、以下のように出力された。<br>
<code>Await BEGIN</code>の前に<code>Task BEGIN</code>が出力されたことで、<code>task.Start</code>ですぐに制御が戻って、かつラムダ式内の処理が非同期に裏で実行されていることがわかる。 <br>
最後、<code>Task END</code>の後に<code>Await END</code>と出力されていることから、処理完了を待合せていることがわかる。</p>

<div class="code-frame" data-lang="cmd"><div class="highlight"><pre class="with-code"><code>Async BEGIN
Async END
Task BEGIN
Await BEGIN
Task END
Await END
</code></pre></div></div>

<h2>
<span id="１０two-phase-termination-パターン" class="fragment"></span><a href="#%EF%BC%91%EF%BC%90two-phase-termination-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>１０．<a href="https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_10_TwoPhaseTermination" rel="nofollow noopener" target="_blank">Two-Phase Termination パターン</a>
</h2>

<h3>
<span id="概要-9" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81-9"><i class="fa fa-link"></i></a>概要</h3>

<ul>
<li>終了処理をちゃんと行ってからスレッドを終了するように、「２段階の終了」を行うパターン</li>
<li>スレッドが終了させる際に、まず「終了要求」を通知する。これで、スレッドは「作業中」状態から「終了処理中」状態へ移行する</li>
<li>スレッドは「終了処理中」に、正しく終了処理を完了すると、スレッドが終了する。</li>
<li>ポイントは以下の通りらしい（本からそのまま受け売り）

<ul>
<li>安全に終了すること（安全性）</li>
<li>必ず終了処理を行うこと（生存性）</li>
<li>「終了要求」を出したら、できるだけ早く終了処理に入ること（応答性）</li>
</ul>
</li>
</ul>

<h3>
<span id="個人的な解釈-6" class="fragment"></span><a href="#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-6"><i class="fa fa-link"></i></a>個人的な解釈</h3>

<ul>
<li>スレッドの終了方法のパターンであり、今までのパターンとは趣向が違う。</li>
<li>常駐スレッドなどでは必須（というか当たり前）なこと。</li>
<li>本のサンプルではキャンセル時の処理が含まれていたが、C#実装した自分のサンプルではあえてその処理は入れていない。

<ul>
<li>
<code>CancellationToken</code>等を利用すればたぶん実現できるけど、ここの本質ではないと思ったので省略</li>
</ul>
</li>
</ul>

<h3>
<span id="その他-2" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96-2"><i class="fa fa-link"></i></a>その他</h3>

<p>本の中では、<code>volatile</code>修飾子が出てくる。本はjavaだが、たぶんC#でも本質は変わらないはず。<br>
<code>volatile</code>の効果については<a href="http://qiita.com/tassi-yuzukko/items/45d6db3bd873d88bce6f#volatile" id="reference-b32f38939c90a6cd62b7">こちら</a>を参照。</p>

<h2>
<span id="１１thread-specific-storage-パターン" class="fragment"></span><a href="#%EF%BC%91%EF%BC%91thread-specific-storage-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>１１．Thread-Specific Storage パターン</h2>

<h3>
<span id="概要-10" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81-10"><i class="fa fa-link"></i></a>概要</h3>

<ul>
<li>入り口は１つでも、内部ではスレッド固有の領域が用意されている</li>
<li>後述する<code>ThraedLocal</code>クラスを使用して実現するのがよさそうだが、スレッドプールを使用したマルチスレッド処理では恐らく使えない（＝<code>Task</code>では使えない）ので、個人的には流し読み程度とする。

<ul>
<li>というか、そもそも個人的に以下の欠点があるのが好みではない。</li>
</ul>
</li>
<li>以下の点でトレードオフである

<ul>
<li>（利点）スレッド固有の領域であるため、他のオブジェクトからアクセスされる心配がない</li>
<li>（利点？）情報を取得するのにスレッドID等の引数が不要である</li>
<li>（欠点）処理の流れを追う際、グローバル変数のようにメソッド内で閉じていないのでわかりにくくなる</li>
</ul>
</li>
</ul>

<h3>
<span id="threadlocalクラスの紹介" class="fragment"></span><a href="#threadlocal%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E7%B4%B9%E4%BB%8B"><i class="fa fa-link"></i></a>ThreadLocalクラスの紹介</h3>

<p>本ではjavaの同名クラスを紹介していたが、たぶん同じ</p>

<ul>
<li>これを使うと、1つのスレッド内からだけしか読み書きできない変数を作れる

<ul>
<li>つまり、同名だが領域は異なるスレッドごとの変数を用意できる</li>
<li>これは<code>ThreadLocal&lt;T&gt;</code>クラスがstaticだとしても同様である</li>
<li>コレクションの一種と考えていいかも（本にはそう書いてた）</li>
</ul>
</li>
<li>注意しないといけないのが、C#ではデファクトスタンダードになりつつある<code>Task</code>を使用したマルチスレッド処理においては、恐らく期待した通りの動作をしない

<ul>
<li>→<code>Task</code>は内部ではスレッドプールを使用しているため、スレッドの使い回しである</li>
<li>そのため異なるTask同士で同じ領域を共有することになるかもしれない（基本的にTaskはタスクが終了してから次のTaskへ使い回すことになると思うが、前のTaskで使用した値が入っているかもしれない（未確認））</li>
<li>あと、<code>await</code>したりすると、内部でスレッドが切り替わるので、変数格納領域が切り替わる

<ul>
<li>これは、<code>AsyncLocal&lt;T&gt;</code>スレッドというのを使用すればよいかも</li>
</ul>
</li>
</ul>
</li>
</ul>

<h2>
<span id="１２active-object-パターン" class="fragment"></span><a href="#%EF%BC%91%EF%BC%92active-object-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>１２．<a href="https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_12_ActiveObject" rel="nofollow noopener" target="_blank">Active Object パターン</a>
</h2>

<h3>
<span id="概要-11" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81-11"><i class="fa fa-link"></i></a>概要</h3>

<ul>
<li>「能動的なオブジェクト」として、オブジェクトが固有のスレッドを持つ</li>
<li>この「能動的なオブジェクト」は、外部から（他スレッドから）非同期にメッセージを受け取って処理し、必要に応じて処理の結果を返せる

<ul>
<li>各オブジェクトが自律的な処理を可能とする</li>
</ul>
</li>
<li>本のサンプルは複雑すぎる。やばい・・・</li>
</ul>

<h3>
<span id="個人的な解釈-7" class="fragment"></span><a href="#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-7"><i class="fa fa-link"></i></a>個人的な解釈</h3>

<p>サンプルが複雑でかなりげんなりしたが、たぶん言いたいことは以下だと勝手に意訳</p>

<ul>
<li>処理を依頼するクライアントと、処理を実行するワーカーをスレッドを分ける。

<ul>
<li>ワーカースレッドは常駐スレッドとして処理を待ち受けて、処理が来れば処理をするし、なければ何もしない。</li>
<li>つまり<code>WokerThread</code>パターン</li>
</ul>
</li>
<li>クライアント側はマルチスレッドを意識しなくてよい仕組みとする。そのために、クライアントの依頼はノンブロッキングで制御が返る。<br>

<ul>
<li>つまり<code>Future</code>パターン</li>
</ul>
</li>
<li>ワーカースレッドは処理が終わると、クライアントスレッドのメモリ領域に、処理結果を格納する

<ul>
<li>
<code>WokerThread</code>パターンと<code>Future</code>パターンの融合。たぶんここがミソ</li>
</ul>
</li>
<li>クライアントスレッド複数に対して、ワーカースレッドは１つでシーケンシャルに処理をする。（たぶんこれは必須ではない？が以下のメリットがある）

<ul>
<li>ワーカーでの処理は排他制御を取る必要がなくなる。</li>
</ul>
</li>
</ul>

<p>つまり、勝手に解釈すると、<code>Future</code>パターンと<code>WokerThread</code>パターンの融合？</p>

<h3>
<span id="使えるシチュエーション-3" class="fragment"></span><a href="#%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-3"><i class="fa fa-link"></i></a>使えるシチュエーション</h3>

<p>個人的な解釈としては以下。</p>

<ul>
<li>非同期で処理を行いたい（例えばUI処理とか通信関連の処理とか）</li>
<li>でも、クライアント側はマルチスレッドを意識しない作りとしたい（既存からの変更とか、並行処理の箇所と逐次処理の箇所を分離するためとか）</li>
<li>そのために、クライアント側は内部でメッセージキューみたいな感じでワーカースレッドに通知を行い、ワーカースレッドでは処理を行う。

<ul>
<li>処理結果をクライアント側のメモリ領域に格納するので、クライアント側はあたかも逐次処理しているかのように振舞える</li>
</ul>
</li>
</ul>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>WaitメソッドおよびPulseメソッドは、lockステートメント内で実行することが前提となる。<strong>Waitメソッドを実行すると、内部ではlockによる排他制御を開放してスレッドがwait状態に入る。</strong>これは、コード的には直感的でないように思えるんだけど、かなり重要なことだと思う。 <a href="#fnref1">↩</a></p>
</li>

</ol>
</div>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Ftassi-yuzukko%2Fitems%2F4953654bad83798d2457&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Ftassi-yuzukko%2Fitems%2F4953654bad83798d2457&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tassi-yuzukko/items/4953654bad83798d2457/likers" class="css-1iupg5d">24</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">25</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/4953654bad83798d2457/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tassi-yuzukko/items/4953654bad83798d2457/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tassi-yuzukko/items/4953654bad83798d2457/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tassi-yuzukko/items/4953654bad83798d2457/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tassi-yuzukko/items/4953654bad83798d2457.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-16099521-ec73-4c9f-a0d3-98d486e7045e">{"authorAnalyticsTrackingId":"UA-106182313-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-3ce7a1ff-5832-4c31-9cc0-a9d511dbed5a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-3ce7a1ff-5832-4c31-9cc0-a9d511dbed5a">{}</script>
      
<div id="LoginModal-react-component-82f0fea4-f4d8-4eec-a456-388d317afb2a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-82f0fea4-f4d8-4eec-a456-388d317afb2a">{}</script>
      
<div id="StockModal-react-component-7eeab69c-1f0f-4f9e-a4bb-d720ba243f3e"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-7eeab69c-1f0f-4f9e-a4bb-d720ba243f3e">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;46hIfiJM3l04h4HO3xBwRDDlQ7L2gn+IR9t2Dji+MC2ZlurXlJ9SI79GuwmAhd3mz2t/fam8tWyw2zwGOfDKDg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"whats-this-\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#whats-this-\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWhat's This ?\u003c/h1\u003e\n\n\u003cp\u003e結城浩氏著の「\u003ca href=\"http://amzn.asia/aJZOXEw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eJava言語で学ぶデザインパターン【マルチスレッド編】\u003c/a\u003e」をC#で使用するにはどうするか？\u003cbr\u003e\nということで、C#で実際に実装してみた。\u003cbr\u003e\nまた、デザインパターンの自分なりの理解を備忘録として残しておく。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://qiita.com/tassi-yuzukko/items/45d6db3bd873d88bce6f\" id=\"reference-b32f38939c90a6cd62b7\"\u003eこちら\u003c/a\u003eから移動\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://qiita.com/tassi-yuzukko/items/79edec981dc8fa05a4aa\" id=\"reference-ddb31d8209c32dc0133c\"\u003eここ\u003c/a\u003eに独断と偏見でまとめた\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"注意\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B3%A8%E6%84%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e注意\u003c/h2\u003e\n\n\u003cp\u003e一応、ここに書いているのは個人の解釈が主なので、正解じゃない可能性が高いです。\u003cbr\u003e\u003cbr\u003e\n現に、かなりの頻度で修正を入れています。（現在進行形）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"デザインパターン一覧\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E4%B8%80%E8%A6%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデザインパターン一覧\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"１single-thread-execution-パターン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%91single-thread-execution-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e１．\u003ca href=\"https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/01_SingleThreadedExecution\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSingle Thread Execution パターン\u003c/a\u003e\n\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h3\u003e\n\n\u003cp\u003eクラスメソッドを以下の２パターンに分類する\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSafeMethod・・・スレッドセーフを考慮しないでよいメソッド\u003c/li\u003e\n\u003cli\u003eUnsafeMethod・・・スレッドセーフを考慮する必要があるメソッド\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e上記\u003ccode\u003eUnsafeMethod\u003c/code\u003eに対して、\u003ccode\u003elock\u003c/code\u003eステートメントを使用してスレッドセーフにする\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"気を付けること\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8B%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e気を付けること\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eクラスを継承したり、メソッドを追加するとき、その人は\u003ccode\u003elock\u003c/code\u003eステートメントを使うべきかどうかを判断する必要がある（「異常継承」というらしい）\u003c/li\u003e\n\u003cli\u003eパフォーマンスがちょっと落ちる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"２immutable-パターン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%92immutable-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e２．\u003ca href=\"https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_02_Immutable\" rel=\"nofollow noopener\" target=\"_blank\"\u003eImmutable パターン\u003c/a\u003e\n\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h3\u003e\n\n\u003cp\u003eクラスを以下の２パターンに分類する\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eImmutable・・・メンバやクラスが参照するインスタンスの状態が変わることのないクラス\u003cbr\u003e\n（例えば、\u003ccode\u003estring\u003c/code\u003eはImmutableである）\u003c/li\u003e\n\u003cli\u003eMutable・・・状態が変わるクラス\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e上記のImmutableクラスは、複数のスレッドから同時にアクセスしても問題ない\u003cbr\u003e\nそのため、\u003ccode\u003elock\u003c/code\u003eステートメントを使用しなくてもよい\u003cbr\u003e\nクラスが\u003ccode\u003eImmutable\u003c/code\u003eであるかどうかを意識することが重要である\u003cbr\u003e\n\u003ccode\u003eImmutable\u003c/code\u003eクラスは、外部フィールドはreadonlyまたは読み取り専用メソッドのみとし、メソッドもクラス内部を変更する処理は行わない\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"気を付けること-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8B%E3%81%93%E3%81%A8-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e気を付けること\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eImmutable\u003c/code\u003eであることは非常に脆い。ちょっとの変更ですぐに崩れる。\u003cbr\u003e\n→Single Thread Execution パターンと同様に、異常継承になる場合がある\u003c/li\u003e\n\u003cli\u003eクラスに \u003ccode\u003esealed\u003c/code\u003e オプションを付けることで、継承異常を防ぐことが可能\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"個人的な解釈\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e個人的な解釈\u003c/h3\u003e\n\n\u003cp\u003e\u003cstrong\u003e値オブジェクトは\u003ccode\u003eImmutable\u003c/code\u003eなクラスである\u003c/strong\u003eといえるっぽい　\u003cbr\u003e\n　→値オブジェクトは状態を持たないから\u003cbr\u003e\nつまり、値オブジェクトはスレッドセーフであるといえる（はず）\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"３guarded-suspension-パターン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%93guarded-suspension-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e３．\u003ca href=\"https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_03_GuardedSuspension\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGuarded Suspension パターン\u003c/a\u003e\n\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eMonitor.Wait\u003c/code\u003eと\u003ccode\u003eMonitor.Pulse\u003c/code\u003eメソッドを使う\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"WaitメソッドおよびPulseメソッドは、lockステートメント内で実行することが前提となる。Waitメソッドを実行すると、内部ではlockによる排他制御を開放してスレッドがwait状態に入る。これは、コード的には直感的でないように思えるんだけど、かなり重要なことだと思う。\"\u003e1\u003c/a\u003e\u003c/sup\u003e\n\u003c/li\u003e\n\u003cli\u003eスレッドAは実行条件に合致するまで動作をWait状態にする。実行条件に合致するときは、待たずに処理を即実行する。\u003cbr\u003e\n（上記の実行条件のことを、「ガード条件」という）\u003c/li\u003e\n\u003cli\u003eスレッドBはガード条件を満たした際に、Pulseを通知する\u003c/li\u003e\n\u003cli\u003eWait状態やPulseを通知するのは、ガードオブジェクトとして定義されたクラスが行う。つまり、スレッドAとスレッドBはガードオブジェクトを操作するのみで、ガード条件などには関与しない。ガード条件とそれに伴うWait／Pulseの責務はガードオブジェクトのみが負うことが重要。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eつまり、\u003cstrong\u003e「条件が満たされるまでは待ちが発生するスレッド」を実現する\u003c/strong\u003e\u003cbr\u003e\nパターンの意図としては、条件付きのSingle Thread Execution パターンとして使用する\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"気を付けること-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8B%E3%81%93%E3%81%A8-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e気を付けること\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eスレッドAで「ガード条件の評価」と「条件に合致しなければWaitすること」を行う。\u003cbr\u003e\nスレッドBで「ガード条件を満たす処理」と「Pulseすること」を行う。\u003cbr\u003e\nつまり、ちょっとのミスでスレッド処理が進まなくなることになる。\n\n\u003cul\u003e\n\u003cli\u003eこれを回避するために、Waitメソッドにタイムアウトを設ける方法がある\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e恐らくC#4.0以降では、\u003ccode\u003eMonitor.*\u003c/code\u003eの代わりに\u003ccode\u003eManualResetEventSlim\u003c/code\u003eを使うべきっぽい\u003cbr\u003e\n（詳しくは\u003ca href=\"http://qiita.com/laughter/items/1e64ab8712e410a8f047\" id=\"reference-193d17ca9ec2969215c3\"\u003eこちら\u003c/a\u003eを参照）\n\n\u003cul\u003e\n\u003cli\u003eが、現段階ではこれは今後の課題としとく\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"その他concurrentqueue誤りを使うべきとしていたのを修正\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96concurrentqueue%E8%AA%A4%E3%82%8A%E3%82%92%E4%BD%BF%E3%81%86%E3%81%B9%E3%81%8D%E3%81%A8%E3%81%97%E3%81%A6%E3%81%84%E3%81%9F%E3%81%AE%E3%82%92%E4%BF%AE%E6%AD%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他（ConcurrentQueue誤りを使うべきとしていたのを修正）\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cdel\u003e\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/dd267265(v=vs.110).aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eConcurrentQueue\u003c/a\u003eを使用することで、lockやWait／Pulseを使用することなく実装できる\u003c/del\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cdel\u003e\u003ccode\u003eTryDequeue\u003c/code\u003eメソッドと\u003ccode\u003eEnqueue\u003c/code\u003eメソッドを使用する\u003c/del\u003e\u003c/li\u003e\n\u003cli\u003e\u003cdel\u003eたぶん、実現するなら\u003ccode\u003eConcurrentQueue\u003c/code\u003eを使用すべき\u003c/del\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/dd997371(v=vs.110).aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eBlockingCollection\u003c/a\u003eを使用すべきでした。\u003ccode\u003eConcurrentQueue\u003c/code\u003eはWait/Pulseを内部的に持っていないようで、スレッドを待たせることはできないです。（たぶん）\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eAdd/Take\u003c/code\u003eメソッドで、Take時にキューが空なら内部で待ちが発生する\u003c/li\u003e\n\u003cli\u003eということで、実現するなら\u003ccode\u003eBlockingCollection\u003c/code\u003eを使用すべき\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"個人的な解釈-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e個人的な解釈\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e応用することでメッセージキューを実現できるような気がする（\u003ca href=\"https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_03_GuardedSuspension/MsgQueTest\" rel=\"nofollow noopener\" target=\"_blank\"\u003eサンプル\u003c/a\u003e）\n\n\u003cul\u003e\n\u003cli\u003e素朴なメッセージキューだと、メッセージを受け取れない間は、短いSleepをはさみつつ無限ループで待つ方式になる\u003c/li\u003e\n\u003cli\u003eこのパターンで\u003ccode\u003eWait\u003c/code\u003eを使用することで、効率的な待ちを実現できる（気がする）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"４balking-パターン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%94balking-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e４．\u003ca href=\"https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_04_Balking\" rel=\"nofollow noopener\" target=\"_blank\"\u003eBalking パターン\u003c/a\u003e\n\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要-3\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81-3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e「Balk」とは、野球のボークと同じ意味。「途中でやめる」こと。\u003c/li\u003e\n\u003cli\u003e基本的には、Guarded Suspension パターンの派生と思ってよいかも\n\n\u003cul\u003e\n\u003cli\u003eガード条件に一致しない場合、処理を終了させる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eつまり、１つのスレッドで処理が実行中または実行完了していたら、他のスレッドからは実行しなくてよいときとかに使える\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"使えるシチュエーション\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使えるシチュエーション\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e途中でやめることでパフォーマンスを上げる（または応答性を上げる）\u003c/li\u003e\n\u003cli\u003eガード条件が満たされるのが最初の一回だけのとき\n\n\u003cul\u003e\n\u003cli\u003e例\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eスレッドセーフで最初の一回だけ初期化する処理.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSomething\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003e_isInited\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003e_lock\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003elock\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_lock\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_isInited\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n      \u003cspan class=\"c1\"\u003e// 何かしらの初期化処理を実行\u003c/span\u003e\n\n      \u003cspan class=\"n\"\u003e_isInited\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"その他\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eタイムアウトを設定することで、Guarded Suspension パターンと Balking パターンの中間を表現することができる\n\n\u003cul\u003e\n\u003cli\u003eタイムアウトまでにガード条件が成立すると、処理を実行する\u003c/li\u003e\n\u003cli\u003eタイムアウトしてもガード条件が成立しなければ、処理を放棄する（途中でやめる）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"５producer-consumer-パターン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%95producer-consumer-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e５．\u003ca href=\"https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_05_Producer-Consumer\" rel=\"nofollow noopener\" target=\"_blank\"\u003eProducer-Consumer パターン\u003c/a\u003e\n\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要-4\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81-4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eProducer・・・生産者：データを作成するスレッド\u003c/li\u003e\n\u003cli\u003eConsumer・・・消費者：データを利用するスレッド\u003c/li\u003e\n\u003cli\u003eChannel・・・ProducerがConsumerへ安全にデータを渡す橋渡し役\u003c/li\u003e\n\u003cli\u003eChannelはキューで実装し、Producerはキューに仕事を追加し、Consumerはキューから仕事を取り出す\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eChannelは、Producer向けとConsumer向けそれぞれのガード条件付きメソッドを持つ。\u003cbr\u003e\nProducerおよびConsumerは、Channelのメソッドを呼び出すだけなので、ガード条件の存在を知る必要がない。もっというとスレッドセーフであるかどうかを気にする必要もない。\u003cbr\u003e\n→スレッドセーフの責務を負うのはChannelのみ\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"個人的な解釈使えるシチュエーション\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e個人的な解釈＆使えるシチュエーション\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eGuarded Suspension パターンと似ているが、ガード条件がProducer側向けメソッド（サンプルでいうPutメソッド）とConsumer側向けメソッド（サンプルでいうTakeメソッド）の両方にそれぞれ存在するのが異なる。\u003c/li\u003e\n\u003cli\u003eGuarded Suspension パターンではputする側（＝Producer）は条件なくputできていたが、Producer-Consumer パターンではputする際にも条件が必要になる。\n\n\u003cul\u003e\n\u003cli\u003e大きさが有限のキューなどに適用できる？と思う\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e実際に実装する場合は、\u003ccode\u003eBlockingCollection\u003c/code\u003eを使うべき\n\n\u003cul\u003e\n\u003cli\u003eスレッドセーフなキュー\u003c/li\u003e\n\u003cli\u003eブロッキング処理を内包（WaitとPulseをカプセル化）\u003c/li\u003e\n\u003cli\u003eキューイングできる範囲を指定可\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"６read-write-lock-パターン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%96read-write-lock-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e６．\u003ca href=\"https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_06_Read_Write_%20Lock\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRead-Write Lock パターン\u003c/a\u003e\n\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要-5\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81-5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e「読む」処理と「書く」処理を分けて考える。\n\n\u003cul\u003e\n\u003cli\u003eスレッドがインスタンスの状態を「読む」処理を行っても、インスタンスの状態は変化しない。\u003cbr\u003e\nしかし、「書く」処理を行うと、インスタンスの状態は変化する。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e「読み用ロック」と「書き用ロック」をそれぞれ用意する\n\n\u003cul\u003e\n\u003cli\u003e「読む」処理は、インスタンスの状態が変わらないから、複数スレッドから同時に読むのは問題ない。しかし、\u003cstrong\u003eあるスレッドが「読む」処理実行中は、他のスレッドは「書く」処理は禁止する\u003c/strong\u003e。\u003c/li\u003e\n\u003cli\u003e同様に、\u003cstrong\u003eあるスレッドが「書く」処理中は、他のスレッドは「読む」処理および「書く」処理を禁止する\u003c/strong\u003e。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"排他制御の詳細衝突の種類\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8E%92%E4%BB%96%E5%88%B6%E5%BE%A1%E3%81%AE%E8%A9%B3%E7%B4%B0%E8%A1%9D%E7%AA%81%E3%81%AE%E7%A8%AE%E9%A1%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e排他制御の詳細（衝突の種類）\u003c/h4\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003e\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e読む\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e書く\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003e読む\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e衝突なし\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e「読む」と「書く」の衝突\u003cbr\u003e⇒read-write conflict\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003e書く\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e「読む」と「書く」の衝突\u003cbr\u003e⇒read-write conflict\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e「書く」と「書く」の衝突\u003cbr\u003e⇒write-write conflict\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e以上より、排他制御には３種類存在する。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"個人的な解釈-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e個人的な解釈\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e「読み用ロック」および「書き用ロック」を自前で作る？\n\n\u003cul\u003e\n\u003cli\u003eロックの中身は\u003ccode\u003eSemaphore\u003c/code\u003eと同様で、値をインクリメント／デクリメントして制御する\u003c/li\u003e\n\u003cli\u003e自前Semaphoreってこと？なんか車輪の再開発な感じがするが・・・\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eスレッド間で「読む」処理が同時に起こった場合は、衝突としない。このように自前条件を拡張できるから自前Semaphoreってこと？\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"使えるシチュエーション-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使えるシチュエーション\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e読む処理と書き処理が同時発生する可能性がある場合で、読む処理同士を止める必要がない場合に使える？\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"その他-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e.NETでは、\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/system.threading.readerwriterlockslim(v=vs.110).aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eReaderWriterLockSlim\u003c/code\u003e\u003c/a\u003eという既製クラスが存在する。これ使えば格段とコードしやすくなる。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"７thread-per-message-パターン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%97thread-per-message-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e７．\u003ca href=\"https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_07_Thread_Per_Message\" rel=\"nofollow noopener\" target=\"_blank\"\u003eThread-Per-Message パターン\u003c/a\u003e\n\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要-6\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81-6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e何らかの命令（要求）ごとに、新しくスレッドが処理を行う。\u003c/li\u003e\n\u003cli\u003e「依頼する側」は、「処理する側」が実際に処理していることを関知しない\u003cbr\u003e\n⇒非同期で処理が実行される。処理を待たない。 \u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"個人的な解釈-3\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e個人的な解釈\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eスレッドを立てる際、インスタンスメソッドを並列で呼び出す仕組みなのがミソ？\n\n\u003cul\u003e\n\u003cli\u003e→並列処理するが、インスタンスは「依頼する側」で生成するため、インスタンスが複数生成されるわけではない。 \u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eこうすることで、以下の点を狙っている？（メリット？）にしても、スレッドごとにインスタンスを生成して処理してもいいような・・・\u003cbr\u003e\n\n\u003cul\u003e\n\u003cli\u003eメモリの無駄な浪費を避ける\u003c/li\u003e\n\u003cli\u003eインスタンス内のフィールドを共有できる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eそういうことまではこのパターンでは意図していないのかな？\u003c/li\u003e\n\u003cli\u003eなんかしっくりこないパターン・・・\n\n\u003cul\u003e\n\u003cli\u003eただの非同期処理のことなら、わざわざパターンとして定義するほどのことではないと思うが？\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"８worker-thread-パターン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%98worker-thread-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e８．\u003ca href=\"https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_08_WorkerThread\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWorker Thread パターン\u003c/a\u003e\n\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要-7\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81-7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e一般的に\u003ccode\u003eThread Pool\u003c/code\u003eと呼ばれるもの\u003c/li\u003e\n\u003cli\u003eあらかじめワーカスレッドを起動しておき、クライアントスレッドはキューに仕事を追加し、ワーカスレッドはキューから仕事を取り出す、を繰り返す\n\n\u003cul\u003e\n\u003cli\u003eつまり、\u003ccode\u003eProducer-Consumer\u003c/code\u003eパターンを使用している。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eProducer-Consumer\u003c/code\u003eパターンと同じく、クライアント側とワーカ側はスレッドセーフとかを意識しなくてよい\u003c/li\u003e\n\u003cli\u003eあらかじめワーカスレッドを起動するので、起動するスレッド数は固定となる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"個人的な解釈-4\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e個人的な解釈\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eこのパターンの実体は、\u003cstrong\u003eあらかじめ先にスレッドを生成しておく\u003ccode\u003eProducer-Consumer\u003c/code\u003eパターン\u003c/strong\u003eと言い切ってしまってよいかも？\u003c/li\u003e\n\u003cli\u003eできることは、 \u003ccode\u003eProducer-Consumer\u003c/code\u003eパターンと同じと思ってよい？\u003cbr\u003e\n\u003c/li\u003e\n\u003cli\u003e以下の点が異なる。\n\n\u003cul\u003e\n\u003cli\u003e起動時にあらかじめワーカスレッドを起動することで、新しいスレッドを起動するコストを軽減する\u003c/li\u003e\n\u003cli\u003eスレッドの生成数をあらかじめ決める\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"使えるシチュエーション-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使えるシチュエーション\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e処理コストに比べて、スレッド生成コストがネックとなる場合\u003c/li\u003e\n\u003cli\u003eあらかじめ起動スレッドの数を決めておきたいとき\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eThread-Per-Message\u003c/code\u003eパターンと\u003ccode\u003eWorkerThread\u003c/code\u003eパターンの両方に言えることだが、\u003ccode\u003eCommand\u003c/code\u003eパターンの実現に使用できる\n\n\u003cul\u003e\n\u003cli\u003e命令（仕事）をクラス化するのが\u003ccode\u003eCommand\u003c/code\u003eパターン\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eThread-Per-Message\u003c/code\u003eパターンと\u003ccode\u003eWorkerThread\u003c/code\u003eパターンにおいて、仕事をクラス化してマルチスレッドで処理することを実現できる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"補足\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A3%9C%E8%B6%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e補足\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eC#5.0以降は\u003ccode\u003eTask\u003c/code\u003eがThreadPoolの役割を果たしているらしい\u003c/li\u003e\n\u003cli\u003eつまり、ここで提示したサンプルプログラムは\u003ccode\u003eTask\u003c/code\u003eを使用しているので、冗長で意味がない\u003c/li\u003e\n\u003cli\u003eもっというと、\u003ccode\u003eThread-Per-Message\u003c/code\u003eパターンのサンプルも\u003ccode\u003eTask\u003c/code\u003eを使用しているので、内部的にはThreadPoolになっているので、実際はサンプルになっていない\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"９future-パターン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%99future-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e９．\u003ca href=\"https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_09_Future\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFuture パターン\u003c/a\u003e\n\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要-8\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81-8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e処理を別スレッドで実行し、依頼側に疑似的な答えをすぐに返す。実際の処理結果は後から取得する。\u003c/li\u003e\n\u003cli\u003e本には「実行結果が得るまで待つ代わりに「引換券」をもらう」と記載されている。\u003c/li\u003e\n\u003cli\u003eいきなり難易度が上がった感じがする。というか、かなり複雑・・・\n\n\u003cul\u003e\n\u003cli\u003e[追記]しかし、どうやら本質的にはC#でいう\u003ccode\u003eawait\u003c/code\u003e実装だけで実現できるみたいなので、解釈の仕方が合っているなら、目的も単純であるし、実装も簡単。\u003c/li\u003e\n\u003cli\u003eサンプルでは、\u003ccode\u003eMain\u003c/code\u003eメソッドと実際に仕事を行う\u003ccode\u003eRealData\u003c/code\u003eクラスは、マルチスレッドで処理していることを関知していない。マルチスレッドであることをカプセル化するならば、ちょっとややこしくなるかも。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"個人的な解釈-5\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e個人的な解釈\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e処理開始は非同期で実行し、結果受け取りは同期する処理を実現する。\n\n\u003cul\u003e\n\u003cli\u003e\u003cdel\u003eC#の場合、同期処理は通常\u003ccode\u003easync/await\u003c/code\u003eを使用するが、awaitせずに同期処理を実行できる感じ？\u003c/del\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e↑ かなり頓珍漢なことを言っていた。どうやら\u003ccode\u003eawait\u003c/code\u003eキーワードそのものがFutureパターンを満たすものっぽい。\u003c/li\u003e\n\u003cli\u003eつまり、\u003cstrong\u003eC#ではFutureパターンをゴリゴリ実装する必要はなく、\u003ccode\u003eawait\u003c/code\u003eキーワード一発で実現できるっぽい\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003e疑似的な答えを返すクラスと、実処理の答えを返すクラスが、同じインターフェイスを実装しているあたり、Proxyパターンと同じような考え方のようだ。\n\n\u003cul\u003e\n\u003cli\u003eというか、たぶんFutureパターン＝Proxyパターンと考えて良さそう。\u003c/li\u003e\n\u003cli\u003eFuture役＝Proxy役。RealData役＝RealSubject役。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e以下、C#での\u003ccode\u003eTask.Start\u003c/code\u003eと\u003ccode\u003eawait\u003c/code\u003eを使用することで、非同期で処理をスタートし、処理の終了は同期をとれるかを確認してみた。\u003cbr\u003e\n（処理結果を受け取ることはしていないが、Futureパターンの本質は上記のように\u003cstrong\u003e処理開始は非同期だが、処理の終わりは待合せたい\u003c/strong\u003eということだと解釈しています）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eFutureSampleAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Async BEGIN\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etask\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Task BEGIN\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Task END\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Async END\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Await BEGIN\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Await END\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e上記\u003ccode\u003eFutureSampleAsync\u003c/code\u003eを実行すると、以下のように出力された。\u003cbr\u003e\n\u003ccode\u003eAwait BEGIN\u003c/code\u003eの前に\u003ccode\u003eTask BEGIN\u003c/code\u003eが出力されたことで、\u003ccode\u003etask.Start\u003c/code\u003eですぐに制御が戻って、かつラムダ式内の処理が非同期に裏で実行されていることがわかる。 \u003cbr\u003e\n最後、\u003ccode\u003eTask END\u003c/code\u003eの後に\u003ccode\u003eAwait END\u003c/code\u003eと出力されていることから、処理完了を待合せていることがわかる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cmd\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eAsync BEGIN\nAsync END\nTask BEGIN\nAwait BEGIN\nTask END\nAwait END\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"１０two-phase-termination-パターン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%91%EF%BC%90two-phase-termination-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e１０．\u003ca href=\"https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_10_TwoPhaseTermination\" rel=\"nofollow noopener\" target=\"_blank\"\u003eTwo-Phase Termination パターン\u003c/a\u003e\n\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要-9\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81-9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e終了処理をちゃんと行ってからスレッドを終了するように、「２段階の終了」を行うパターン\u003c/li\u003e\n\u003cli\u003eスレッドが終了させる際に、まず「終了要求」を通知する。これで、スレッドは「作業中」状態から「終了処理中」状態へ移行する\u003c/li\u003e\n\u003cli\u003eスレッドは「終了処理中」に、正しく終了処理を完了すると、スレッドが終了する。\u003c/li\u003e\n\u003cli\u003eポイントは以下の通りらしい（本からそのまま受け売り）\n\n\u003cul\u003e\n\u003cli\u003e安全に終了すること（安全性）\u003c/li\u003e\n\u003cli\u003e必ず終了処理を行うこと（生存性）\u003c/li\u003e\n\u003cli\u003e「終了要求」を出したら、できるだけ早く終了処理に入ること（応答性）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"個人的な解釈-6\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e個人的な解釈\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eスレッドの終了方法のパターンであり、今までのパターンとは趣向が違う。\u003c/li\u003e\n\u003cli\u003e常駐スレッドなどでは必須（というか当たり前）なこと。\u003c/li\u003e\n\u003cli\u003e本のサンプルではキャンセル時の処理が含まれていたが、C#実装した自分のサンプルではあえてその処理は入れていない。\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eCancellationToken\u003c/code\u003e等を利用すればたぶん実現できるけど、ここの本質ではないと思ったので省略\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"その他-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他\u003c/h3\u003e\n\n\u003cp\u003e本の中では、\u003ccode\u003evolatile\u003c/code\u003e修飾子が出てくる。本はjavaだが、たぶんC#でも本質は変わらないはず。\u003cbr\u003e\n\u003ccode\u003evolatile\u003c/code\u003eの効果については\u003ca href=\"http://qiita.com/tassi-yuzukko/items/45d6db3bd873d88bce6f#volatile\" id=\"reference-b32f38939c90a6cd62b7\"\u003eこちら\u003c/a\u003eを参照。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"１１thread-specific-storage-パターン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%91%EF%BC%91thread-specific-storage-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e１１．Thread-Specific Storage パターン\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要-10\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81-10\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e入り口は１つでも、内部ではスレッド固有の領域が用意されている\u003c/li\u003e\n\u003cli\u003e後述する\u003ccode\u003eThraedLocal\u003c/code\u003eクラスを使用して実現するのがよさそうだが、スレッドプールを使用したマルチスレッド処理では恐らく使えない（＝\u003ccode\u003eTask\u003c/code\u003eでは使えない）ので、個人的には流し読み程度とする。\n\n\u003cul\u003e\n\u003cli\u003eというか、そもそも個人的に以下の欠点があるのが好みではない。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e以下の点でトレードオフである\n\n\u003cul\u003e\n\u003cli\u003e（利点）スレッド固有の領域であるため、他のオブジェクトからアクセスされる心配がない\u003c/li\u003e\n\u003cli\u003e（利点？）情報を取得するのにスレッドID等の引数が不要である\u003c/li\u003e\n\u003cli\u003e（欠点）処理の流れを追う際、グローバル変数のようにメソッド内で閉じていないのでわかりにくくなる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"threadlocalクラスの紹介\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#threadlocal%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E7%B4%B9%E4%BB%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eThreadLocalクラスの紹介\u003c/h3\u003e\n\n\u003cp\u003e本ではjavaの同名クラスを紹介していたが、たぶん同じ\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eこれを使うと、1つのスレッド内からだけしか読み書きできない変数を作れる\n\n\u003cul\u003e\n\u003cli\u003eつまり、同名だが領域は異なるスレッドごとの変数を用意できる\u003c/li\u003e\n\u003cli\u003eこれは\u003ccode\u003eThreadLocal\u0026lt;T\u0026gt;\u003c/code\u003eクラスがstaticだとしても同様である\u003c/li\u003e\n\u003cli\u003eコレクションの一種と考えていいかも（本にはそう書いてた）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e注意しないといけないのが、C#ではデファクトスタンダードになりつつある\u003ccode\u003eTask\u003c/code\u003eを使用したマルチスレッド処理においては、恐らく期待した通りの動作をしない\n\n\u003cul\u003e\n\u003cli\u003e→\u003ccode\u003eTask\u003c/code\u003eは内部ではスレッドプールを使用しているため、スレッドの使い回しである\u003c/li\u003e\n\u003cli\u003eそのため異なるTask同士で同じ領域を共有することになるかもしれない（基本的にTaskはタスクが終了してから次のTaskへ使い回すことになると思うが、前のTaskで使用した値が入っているかもしれない（未確認））\u003c/li\u003e\n\u003cli\u003eあと、\u003ccode\u003eawait\u003c/code\u003eしたりすると、内部でスレッドが切り替わるので、変数格納領域が切り替わる\n\n\u003cul\u003e\n\u003cli\u003eこれは、\u003ccode\u003eAsyncLocal\u0026lt;T\u0026gt;\u003c/code\u003eスレッドというのを使用すればよいかも\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"１２active-object-パターン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%91%EF%BC%92active-object-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e１２．\u003ca href=\"https://github.com/tassi-yuzukko/MutliThreadDesignPattern/tree/master/_12_ActiveObject\" rel=\"nofollow noopener\" target=\"_blank\"\u003eActive Object パターン\u003c/a\u003e\n\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要-11\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81-11\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e「能動的なオブジェクト」として、オブジェクトが固有のスレッドを持つ\u003c/li\u003e\n\u003cli\u003eこの「能動的なオブジェクト」は、外部から（他スレッドから）非同期にメッセージを受け取って処理し、必要に応じて処理の結果を返せる\n\n\u003cul\u003e\n\u003cli\u003e各オブジェクトが自律的な処理を可能とする\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e本のサンプルは複雑すぎる。やばい・・・\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"個人的な解釈-7\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e個人的な解釈\u003c/h3\u003e\n\n\u003cp\u003eサンプルが複雑でかなりげんなりしたが、たぶん言いたいことは以下だと勝手に意訳\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e処理を依頼するクライアントと、処理を実行するワーカーをスレッドを分ける。\n\n\u003cul\u003e\n\u003cli\u003eワーカースレッドは常駐スレッドとして処理を待ち受けて、処理が来れば処理をするし、なければ何もしない。\u003c/li\u003e\n\u003cli\u003eつまり\u003ccode\u003eWokerThread\u003c/code\u003eパターン\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eクライアント側はマルチスレッドを意識しなくてよい仕組みとする。そのために、クライアントの依頼はノンブロッキングで制御が返る。\u003cbr\u003e\n\n\u003cul\u003e\n\u003cli\u003eつまり\u003ccode\u003eFuture\u003c/code\u003eパターン\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eワーカースレッドは処理が終わると、クライアントスレッドのメモリ領域に、処理結果を格納する\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eWokerThread\u003c/code\u003eパターンと\u003ccode\u003eFuture\u003c/code\u003eパターンの融合。たぶんここがミソ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eクライアントスレッド複数に対して、ワーカースレッドは１つでシーケンシャルに処理をする。（たぶんこれは必須ではない？が以下のメリットがある）\n\n\u003cul\u003e\n\u003cli\u003eワーカーでの処理は排他制御を取る必要がなくなる。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eつまり、勝手に解釈すると、\u003ccode\u003eFuture\u003c/code\u003eパターンと\u003ccode\u003eWokerThread\u003c/code\u003eパターンの融合？\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"使えるシチュエーション-3\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使えるシチュエーション\u003c/h3\u003e\n\n\u003cp\u003e個人的な解釈としては以下。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e非同期で処理を行いたい（例えばUI処理とか通信関連の処理とか）\u003c/li\u003e\n\u003cli\u003eでも、クライアント側はマルチスレッドを意識しない作りとしたい（既存からの変更とか、並行処理の箇所と逐次処理の箇所を分離するためとか）\u003c/li\u003e\n\u003cli\u003eそのために、クライアント側は内部でメッセージキューみたいな感じでワーカースレッドに通知を行い、ワーカースレッドでは処理を行う。\n\n\u003cul\u003e\n\u003cli\u003e処理結果をクライアント側のメモリ領域に格納するので、クライアント側はあたかも逐次処理しているかのように振舞える\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003eWaitメソッドおよびPulseメソッドは、lockステートメント内で実行することが前提となる。\u003cstrong\u003eWaitメソッドを実行すると、内部ではlockによる排他制御を開放してスレッドがwait状態に入る。\u003c/strong\u003eこれは、コード的には直感的でないように思えるんだけど、かなり重要なことだと思う。 \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","createdAt":"2017-08-19T22:58:07Z","elapsedYearsFromLastModifiedAt":3,"encryptedId":"r+3kRRLNP6/bNwHtysiY8pkLOeTaXkaB--UCALwEdcg/NzQTQ0--YKrZfVD+tF7VyOfA7fL8Bw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-04-21T11:18:37Z","likesCount":24,"linkUrl":"https://qiita.com/tassi-yuzukko/items/4953654bad83798d2457","organization":null,"originalId":517198,"stockedCount":25,"title":"[C#備忘録]MultiThreadデザインパターンのC#版について","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#whats-this-\"\u003eWhat's This ?\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B3%A8%E6%84%8F\"\u003e注意\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E4%B8%80%E8%A6%A7\"\u003eデザインパターン一覧\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%91single-thread-execution-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e１．Single Thread Execution パターン\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8B%E3%81%93%E3%81%A8\"\u003e気を付けること\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%92immutable-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e２．Immutable パターン\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81-1\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8B%E3%81%93%E3%81%A8-1\"\u003e気を付けること\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88\"\u003e個人的な解釈\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%93guarded-suspension-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e３．Guarded Suspension パターン\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81-2\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B0%97%E3%82%92%E4%BB%98%E3%81%91%E3%82%8B%E3%81%93%E3%81%A8-2\"\u003e気を付けること\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96concurrentqueue%E8%AA%A4%E3%82%8A%E3%82%92%E4%BD%BF%E3%81%86%E3%81%B9%E3%81%8D%E3%81%A8%E3%81%97%E3%81%A6%E3%81%84%E3%81%9F%E3%81%AE%E3%82%92%E4%BF%AE%E6%AD%A3\"\u003eその他（ConcurrentQueue誤りを使うべきとしていたのを修正）\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-1\"\u003e個人的な解釈\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%94balking-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e４．Balking パターン\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81-3\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e使えるシチュエーション\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96\"\u003eその他\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%95producer-consumer-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e５．Producer-Consumer パターン\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81-4\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e個人的な解釈＆使えるシチュエーション\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%96read-write-lock-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e６．Read-Write Lock パターン\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81-5\"\u003e概要\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%8E%92%E4%BB%96%E5%88%B6%E5%BE%A1%E3%81%AE%E8%A9%B3%E7%B4%B0%E8%A1%9D%E7%AA%81%E3%81%AE%E7%A8%AE%E9%A1%9E\"\u003e排他制御の詳細（衝突の種類）\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-2\"\u003e個人的な解釈\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-1\"\u003e使えるシチュエーション\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96-1\"\u003eその他\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%97thread-per-message-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e７．Thread-Per-Message パターン\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81-6\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-3\"\u003e個人的な解釈\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%98worker-thread-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e８．Worker Thread パターン\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81-7\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-4\"\u003e個人的な解釈\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-2\"\u003e使えるシチュエーション\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A3%9C%E8%B6%B3\"\u003e補足\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%99future-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e９．Future パターン\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81-8\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-5\"\u003e個人的な解釈\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%91%EF%BC%90two-phase-termination-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e１０．Two-Phase Termination パターン\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81-9\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-6\"\u003e個人的な解釈\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96-2\"\u003eその他\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%91%EF%BC%91thread-specific-storage-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e１１．Thread-Specific Storage パターン\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81-10\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#threadlocal%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E7%B4%B9%E4%BB%8B\"\u003eThreadLocalクラスの紹介\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%EF%BC%91%EF%BC%92active-object-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"\u003e１２．Active Object パターン\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81-11\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A7%A3%E9%87%88-7\"\u003e個人的な解釈\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-3\"\u003e使えるシチュエーション\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":8588,"uuid":"4953654bad83798d2457","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"HENCcdku73RhEg10f38JyPCdCQwT--M7iR1KYFV/IVaUmG--t5r83ZDvHdVstLEnSiXnFQ==","originalId":132272,"description":"","facebookUrl":null,"githubUrl":"https://github.com/tassi-yuzukko","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/132272/profile-images/1473718569","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F132272%2Fprofile-images%2F1473718569?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=ecae99c82d80071e796745b29d91645e","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F132272%2Fprofile-images%2F1473718569?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=a8be6eb48db8609fd79cbeee3b4f63ea","urlName":"tassi-yuzukko","websiteUrl":null,"twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":".NET","urlName":".net"},{"name":"マルチスレッド","urlName":"%e3%83%9e%e3%83%ab%e3%83%81%e3%82%b9%e3%83%ac%e3%83%83%e3%83%89"},{"name":"デザインパターン","urlName":"%e3%83%87%e3%82%b6%e3%82%a4%e3%83%b3%e3%83%91%e3%82%bf%e3%83%bc%e3%83%b3"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

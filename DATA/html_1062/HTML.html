<!DOCTYPE html><html><head><meta charset="utf-8" /><title>【Unity】MessagePipeのSubscribe, Dispose処理について - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/Toshizabeth/items/20f951fd38920c73b050" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="wqgqsED6Tk/m/N0j0+JJTXd+VkzEgUyux0qnmKjA63kFMK5R9Y46p0L1KnuGcr+n7friCidUWGZEk/jY5XPmZA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@toshi_zabeth" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="【Unity】MessagePipeのSubscribe, Dispose処理について - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRVlc1cGRIbmpnSkZOWlhOellXZGxVR2x3WmVPQnJsTjFZbk5qY21saVpTd2dSR2x6Y0c5elplV0hwdWVRaHVPQnEtT0JwT09CaE9PQnBnJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTU2YmIxOTVjZmQyMGExYmRkMjdlZDM3NmU4MGNlODIw&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRlJ2YzJocGVtRmlaWFJvJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9ZTc3OTM3Yjg2NDY3NmQ3NjMzMjhiYjAyYzhkNWE5ZTc&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=026a7fb8e254a45f36942259670b39bb"><meta property="og:description" content="

はじめに

以下の環境で実行しています
- MacOS
- Unity2021.2.0b2
- MessagePipe v1.6.1
- Zenject

前回のMessagePipeの記事



こちらのMessagePipeの..."><meta content="https://qiita.com/Toshizabeth/items/20f951fd38920c73b050" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Unity,MessagePipe" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-2ad24f65-4d9d-43cb-8f0c-8103bcd0674b"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2FToshizabeth%2Fitems%2F20f951fd38920c73b050">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2FToshizabeth%2Fitems%2F20f951fd38920c73b050">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-2ad24f65-4d9d-43cb-8f0c-8103bcd0674b">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2021-07-04T18:59:06.000+09:00","dateModified":"2021-07-04T19:21:03.000+09:00","headline":"【Unity】MessagePipeのSubscribe, Dispose処理について","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRVlc1cGRIbmpnSkZOWlhOellXZGxVR2x3WmVPQnJsTjFZbk5qY21saVpTd2dSR2x6Y0c5elplV0hwdWVRaHVPQnEtT0JwT09CaE9PQnBnJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTU2YmIxOTVjZmQyMGExYmRkMjdlZDM3NmU4MGNlODIw\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRlJ2YzJocGVtRmlaWFJvJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9ZTc3OTM3Yjg2NDY3NmQ3NjMzMjhiYjAyYzhkNWE5ZTc\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=026a7fb8e254a45f36942259670b39bb","mainEntityOfPage":"https://qiita.com/Toshizabeth/items/20f951fd38920c73b050","author":{"@type":"Person","address":"","email":null,"identifier":"Toshizabeth","name":"Toshizabeth","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F9328751%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=89d60273ed831e85bb41b28f073d9d8e","url":"https://qiita.com/Toshizabeth","description":"スローペースで個人開発をしています\r\nhttps://github.com/Toshizabeth/Ling","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"Toshizabeth","type":"items","id":"20f951fd38920c73b050"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"Toshizabeth","type":"items","id":"20f951fd38920c73b050"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"Toshizabeth","type":"items","id":"20f951fd38920c73b050"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/Toshizabeth/items/20f951fd38920c73b050","location":"/Toshizabeth/items/20f951fd38920c73b050","scheme":"https","host":"qiita.com","port":null,"pathname":"/Toshizabeth/items/20f951fd38920c73b050","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"U8kPbSuUh+QvGiQMNzE1/6YEZ000DTbqvBKgPCWaX0eUUYuMnuDzDIsT01RiocMVPIDTC9fYIiI/y/98aClSWg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-e91cb613-dfc2-49b9-98ed-759f8308aa17"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/Toshizabeth/items/20f951fd38920c73b050/likers" class="css-1iupg5d">3</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">2</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/20f951fd38920c73b050/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/Toshizabeth/items/20f951fd38920c73b050/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/Toshizabeth/items/20f951fd38920c73b050/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/Toshizabeth/items/20f951fd38920c73b050/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/Toshizabeth/items/20f951fd38920c73b050.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/Toshizabeth"><img class="css-100alwu eyfquo10" src="https://avatars3.githubusercontent.com/u/9328751?v=4" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/Toshizabeth" class="css-10ougpm">@<!-- -->Toshizabeth</a><div class="css-1ay9vb9"><span><meta content="2021-07-04T09:59:06Z"/><time dateTime="2021-07-04T10:21:03Z" class="css-m19uds">updated at 2021-07-04</time></span></div></div></div></div></div><h1 class="css-cgzq40">【Unity】MessagePipeのSubscribe, Dispose処理について</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/messagepipe" class="css-4czcte">MessagePipe</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>以下の環境で実行しています<br>
- MacOS<br>
- Unity2021.2.0b2<br>
- MessagePipe v1.6.1<br>
- Zenject</p>

<p>前回のMessagePipeの記事</p>

<p><qiita-embed-ogp src="https://qiita.com/Toshizabeth/items/f4d429fe1ac566ed7924"></qiita-embed-ogp></p>

<p>こちらのMessagePipeのReadmeを元に学んだことを記事にまとめています</p>

<p><qiita-embed-ogp src="https://github.com/Cysharp/MessagePipe"></qiita-embed-ogp></p>

<h2>
<span id="subscribe-dispose" class="fragment"></span><a href="#subscribe-dispose"><i class="fa fa-link"></i></a>Subscribe, Dispose</h2>

<p>MessagePipeはSubcribeでイベント受信（購読）を行います。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Hoge</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">Hoge</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// MyEventの通知を受け取る</span>
        <span class="kt">var</span> <span class="n">subscriber</span> <span class="p">=</span> <span class="n">MessagePipe</span><span class="p">.</span><span class="n">GlobalMessagePipe</span><span class="p">.</span><span class="n">GetSubscriber</span><span class="p">&lt;</span><span class="n">MyEvent</span><span class="p">&gt;();</span>
        <span class="n">subscriber</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">ev</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="c1">// 購読処理</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Subscribeの戻り値は<code>IDisposable</code><br>
このIDisposableを適切に処理しなければ<b>リーク</b>が発生します。</p>

<p>つまり、<b>クラスが破棄されたとしてもイベント購読し続けることになる</b><br>
（バグが出る可能性が非常に高い！）</p>

<p>基本的には購読しているクラスの破棄と同時にイベントの購読も消したいはず。<br>
今回はイベントの破棄を担当する<code>Dispose</code>について書いていきます。</p>

<h2>
<span id="非monobehaviourクラスでイベントを破棄したい場合" class="fragment"></span><a href="#%E9%9D%9Emonobehaviour%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%82%92%E7%A0%B4%E6%A3%84%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>非Monobehaviourクラスでイベントを破棄したい場合</h2>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Hoge</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">IDisposable</span> <span class="n">_disposable</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">Hoge</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">bag</span> <span class="p">=</span> <span class="n">DisposableBag</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">();</span>

        <span class="c1">// MyEventの通知を受け取る</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">subscriber</span> <span class="p">=</span> <span class="n">MessagePipe</span><span class="p">.</span><span class="n">GlobalMessagePipe</span><span class="p">.</span><span class="n">GetSubscriber</span><span class="p">&lt;</span><span class="n">MyEvent</span><span class="p">&gt;();</span>
            <span class="n">subscriber</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">ev</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="c1">// 購読処理</span>
            <span class="p">}).</span><span class="nf">AddTo</span><span class="p">(</span><span class="n">bag</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// stringの通知を受け取る</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">subscriber</span> <span class="p">=</span> <span class="n">MessagePipe</span><span class="p">.</span><span class="n">GlobalMessagePipe</span><span class="p">.</span><span class="n">GetSubscriber</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
            <span class="n">subscriber</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">ev</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="c1">// 購読処理</span>
            <span class="p">}).</span><span class="nf">AddTo</span><span class="p">(</span><span class="n">bag</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">_disposable</span> <span class="p">=</span> <span class="n">bag</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Close</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// _disposable.Disposeですべて破棄される。</span>
        <span class="c1">// 必ずクラス終了前に呼び出すこと</span>
        <span class="n">_disposable</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Subscribeの戻り値に対してAddToメソッドを呼び出す</p>

<p>そこに <code>DisposableBag.CreateBuilder()</code> で作り出した <code>DisposableBagBuilder</code> を渡します。<br>
そして <code>_disposable.Dispose</code> を呼び出すことでイベントすべての購読が破棄されます。</p>

<p>イベント単体の破棄であればSubscribeの戻り値をそのままメンバ変数に持ち、最後にDisposeするだけでも良</p>

<p><b>Disposeは明示的に呼び出す必要があるので注意</b></p>

<h2>
<span id="monobehaviourを継承しているクラスでイベントを破棄したい場合" class="fragment"></span><a href="#monobehaviour%E3%82%92%E7%B6%99%E6%89%BF%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%82%92%E7%A0%B4%E6%A3%84%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>Monobehaviourを継承しているクラスでイベントを破棄したい場合</h2>

<p>UniRxを組み込んでいる場合、Monobehaviourクラスはもう少し楽に破棄の処理ができます</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre><code><span class="k">namespace</span> <span class="nn">UniRx</span><span class="p">;</span> <span class="c1">// UniRx必須</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Hoge</span> <span class="p">:</span> <span class="n">Monobehaviour</span>
<span class="p">{</span>
    <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// MyEventの通知を受け取る</span>
        <span class="kt">var</span> <span class="n">subscriber</span> <span class="p">=</span> <span class="n">MessagePipe</span><span class="p">.</span><span class="n">GlobalMessagePipe</span><span class="p">.</span><span class="n">GetSubscriber</span><span class="p">&lt;</span><span class="n">MyEvent</span><span class="p">&gt;();</span>
        <span class="n">subscriber</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">ev</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
        <span class="p">}).</span><span class="nf">AddTo</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// 自分を渡してGameObjectの破棄時に削除をしてもらう</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>UniRxではおなじみの処理ですが<br>
AddToに自分自身を渡してGameObjectのライフサイクルに結びつけます。<br>
これで<strong>GameObjectが破棄されるときにイベントも破棄されます。</strong></p>

<h2>
<span id="subscribeを適切にハンドリングしてない場合エラーを出す" class="fragment"></span><a href="#subscribe%E3%82%92%E9%81%A9%E5%88%87%E3%81%AB%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%97%E3%81%A6%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88%E3%82%A8%E3%83%A9%E3%83%BC%E3%82%92%E5%87%BA%E3%81%99"><i class="fa fa-link"></i></a>Subscribeを適切にハンドリングしてない場合エラーを出す</h2>

<p>Disposeの仕方はわかりましたが<b>『Subcribeを適切に処理しているかどうか』</b>は結局コードを書く人に委ねられている状態です。</p>

<p>忘れないように心がけていても<strong>抜けは必ず発生します(必ず）</strong></p>

<p>しかし！ (Unity2020.2以降であれば)<strong>Subcribeの戻り値をハンドリングしてないものがあれば、ビルド時にエラーになる<code>MessagePipe.Analyzer</code>という便利機能が公開されているようです</strong></p>

<p>MessagePipe.Analyzerは<b>Roslyn analyzers</b> という、ユーザー独自のコード解析を組み込める仕組みを利用されています(以下記事参考）</p>

<p><qiita-embed-ogp src="https://docs.unity3d.com/2020.2/Documentation/Manual/roslyn-analyzers.html"></qiita-embed-ogp></p>

<hr>

<p>結果からいうと <b>MessagePipe.Analyzer.dll</b>  を組み込むことで<br>
Subscribeに対して何も処理をしていない場合<b>Unityのコンソール上やVisualStudio上でエラーが出るようになります</b></p>

<ul>
<li><p>VisualStudio<br>
↓ Subscribeに対して何もしていない<br>
<a href="https://camo.qiitausercontent.com/3e326333137e19a5a959145576bf9d2f827e4ef6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f32643165313534312d613162652d653030612d356138662d6632383333306531643036392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F2d1e1541-a1be-e00a-5a8f-f28330e1d069.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d01e0a907934d277a9687b10fddb72a6" alt="20210704173534.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/2d1e1541-a1be-e00a-5a8f-f28330e1d069.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F2d1e1541-a1be-e00a-5a8f-f28330e1d069.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=051101e4c97dcc1d1ea26c58402b911f 1x" loading="lazy"></a></p></li>
<li><p>Unity<br>
<a href="https://camo.qiitausercontent.com/86b5f92dc7651790a5bbc2b12bbb3ecc90030ec5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f61363134363131312d363430382d303332312d636563362d6262353863643062303235662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2Fa6146111-6408-0321-cec6-bb58cd0b025f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4140fcb6931453866bdca223c0d7169a" alt="20210704173442.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/a6146111-6408-0321-cec6-bb58cd0b025f.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2Fa6146111-6408-0321-cec6-bb58cd0b025f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d80fc022e59f998fdb3dd1dae76d846b 1x" loading="lazy"></a></p></li>
</ul>

<p>こうしてエラーが出てくれれば忘れることもない(実行できないので)</p>

<h3>
<span id="導入手順" class="fragment"></span><a href="#%E5%B0%8E%E5%85%A5%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>導入手順</h3>

<p>++++++++++++++++++++++++++++++++++++++++++++++++<br>
<b>Unity2021.2.0b2</b> で動作を確認しています。<br>
<b><font color="#ff0000">Unity2020.3.X系だとUnityでエラーが出ませんでした...(VisualStudioではエラーが出る)</font></b></p>

<p>バグか自分の設定が悪いのか.. <font color="Green">調査中</font><br>
++++++++++++++++++++++++++++++++++++++++++++++++</p>

<h4>
<span id="1-messagepipeanalyzerdll-を-unityに入れる" class="fragment"></span><a href="#1-messagepipeanalyzerdll-%E3%82%92-unity%E3%81%AB%E5%85%A5%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>1. MessagePipe.Analyzer.dll を Unityに入れる</h4>

<p>MessagePipeのGithubに<b>MessagePipe.Analyzer.dll</b> が上がっています。<br>
(以下GithubのReleaseを参照)</p>

<p><qiita-embed-ogp src="https://github.com/Cysharp/MessagePipe"></qiita-embed-ogp></p>

<p>DLLをダウンロード<br>
<a href="https://camo.qiitausercontent.com/6dbb7d4986319a904504003743c90200d558e3ee/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f35363637623164342d613137642d393962322d613437342d3330633532313563343364662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F5667b1d4-a17d-99b2-a474-30c5215c43df.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=fc95d6c772681416c4294b4d870cc155" alt="20210630233610.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/5667b1d4-a17d-99b2-a474-30c5215c43df.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F5667b1d4-a17d-99b2-a474-30c5215c43df.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e8dd0498dd75526f272b9b22ae21efb3 1x" loading="lazy"></a></p>

<p>そしてAsset以下のどこか適切なディレクトリにぶっこむ。<br>
<a href="https://camo.qiitausercontent.com/270ac58409d349d3df55e585d33bef794458b482/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f38313036336164652d343834332d666237622d633439352d6161646161336231373437382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F81063ade-4843-fb7b-c495-aadaa3b17478.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=58ab1fdd0e7cbd4b1fe26064f84a07f4" alt="20210704174052.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/81063ade-4843-fb7b-c495-aadaa3b17478.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F81063ade-4843-fb7b-c495-aadaa3b17478.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e07e3f56a0e5449732c3f197ab42c54f 1x" loading="lazy"></a></p>

<h4>
<span id="2-設定変更" class="fragment"></span><a href="#2-%E8%A8%AD%E5%AE%9A%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>2. 設定変更</h4>

<p>MessagePipe.AnalyzerのInspectorで以下のように設定変更すること</p>

<ul>
<li>
<code>SelectPlatforms for Plugin</code> のチェックをすべて外す</li>
<li>右下のAssetLabelsボタンをクリックして <code>RoslynAnalyzer</code> を入力してEnterを押してラベルを付ける</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/855524638c455a251dd55e7e21d46bfe624ca3ca/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f65313630363165362d323262312d623030612d323235322d6432396633353137626662362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2Fe16061e6-22b1-b00a-2252-d29f3517bfb6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=568402a4ff3934518c20c51d37ec2164" alt="20210704174456.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/e16061e6-22b1-b00a-2252-d29f3517bfb6.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2Fe16061e6-22b1-b00a-2252-d29f3517bfb6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b508da33613f1a1c5168aad2baa0d85d 1x" loading="lazy"></a><br>
ロード終了後、<b>Subscribeを処理していない箇所に対してUnityがエラーを出すようになります</b></p>

<h4>
<span id="3-visualstudioでもエラーを出す" class="fragment"></span><a href="#3-visualstudio%E3%81%A7%E3%82%82%E3%82%A8%E3%83%A9%E3%83%BC%E3%82%92%E5%87%BA%E3%81%99"><i class="fa fa-link"></i></a>3. Visualstudioでもエラーを出す</h4>

<p>VisualStudio上でもエラーを出すためには、Unityに対して更に一工夫する必要がありました。</p>

<p>同じくCysharpが公開している<b>CsprojModifier</b>を導入します</p>

<p><qiita-embed-ogp src="https://github.com/Cysharp/CsprojModifier"></qiita-embed-ogp></p>

<p>公開されている最新バージョンのパッケージをインストールします</p>

<p><qiita-embed-ogp src="https://github.com/Cysharp/CsprojModifier/releases/tag/1.1.1"></qiita-embed-ogp></p>

<p><code>Unity &gt; Project Settings &gt; C# Project Modifier</code> を開き、<code>Add Roslyn Analyzer references to .csproj</code> にチェックを付け、 <strong>Regenerate project files</strong> を押して .csproj を作り直します。</p>

<p><a href="https://camo.qiitausercontent.com/fe10c26313faf26a20c9bf57d715575bb6b37eb5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f38366234626564612d306635392d316163392d633264312d3232323432376434323463322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F86b4beda-0f59-1ac9-c2d1-222427d424c2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=07c34b81e530b5cc5874ad531e5d0cf2" alt="20210704175014.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/86b4beda-0f59-1ac9-c2d1-222427d424c2.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F86b4beda-0f59-1ac9-c2d1-222427d424c2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8712ab3fd098c336d2ed88710db81e84 1x" loading="lazy"></a></p>

<p><b>終了後再度VIsualStudioを開き直したらVisualStudio上でも検知できるようになりました</b></p>

<p>(現状、Unity2020.2以降のバージョンを使用している場合VisualStudioCode, Rider ではこの機能は使用できないようです。<br>
MacのVisualStudioでは正常に確認ができました）<br>
Unityでエラーが出る以上実行ができないのでUnityでカバーしていればまあよし！とも捉えられる</p>

<h2>
<span id="messagepipediagnostics-を使用する" class="fragment"></span><a href="#messagepipediagnostics-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>MessagePipeDiagnostics を使用する</h2>

<p>MessagePipeは更に機能があり(凄い)、実行中のプロジェクトで現在Subscribeされている数や情報を取得できる機能があります。(MessagePipeDiagnosticsInfo)</p>

<p>そして気軽に情報を見れるようにSubscribeしている箇所のモニターが出来る拡張機能が用意してあります(凄い)</p>

<p><code>Window &gt; MessagePipeDiagnostics</code> を開くと、EditorWindowが立ち上がります。</p>

<p><a href="https://camo.qiitausercontent.com/02ec29936239df7b41fc40148c15928cc91a715a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f38643232326462362d626534622d383433372d336266362d6462623334323136656366622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F8d222db6-be4b-8437-3bf6-dbb34216ecfb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=43c359f670a625001f4166e9fa04375d" alt="20210701100112.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/8d222db6-be4b-8437-3bf6-dbb34216ecfb.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F8d222db6-be4b-8437-3bf6-dbb34216ecfb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=00fa3c567cedbebe958bed4b09d5c684 1x" loading="lazy"></a></p>

<p>そして実行中にWindowを見みると以下画像のようにSubscribeしている箇所が確認できます</p>

<p><a href="https://camo.qiitausercontent.com/c979a4b4e4ddfb6329f6cd191e9b098e606ae600/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f33633865653531612d363139642d366235302d393338342d6237653162376563626161662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F3c8ee51a-619d-6b50-9384-b7e1b7ecbaaf.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=04995cf59e012a71a7a685f45317963d" alt="20210704181756.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/3c8ee51a-619d-6b50-9384-b7e1b7ecbaaf.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F3c8ee51a-619d-6b50-9384-b7e1b7ecbaaf.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=00ef43b4d7b19ae3a7fc0608b6e38807 1x" loading="lazy"></a></p>

<p>この機能を利用するには <code>GlobalMessagePipe.SetProvider</code> を予め設定しておく事と、optionの<code>EnableCaptureStackTrace</code>をtrueにしておく必要があります。</p>

<p><a href="https://camo.qiitausercontent.com/03b02a3e201e5ea463444cb1a095191361171c11/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f34656537393238662d613330652d383934392d333765392d3038636334313865616138342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F4ee7928f-a30e-8949-37e9-08cc418eaa84.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=adbd8883a13412995488d0391b8539f8" alt="20210704181941.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/4ee7928f-a30e-8949-37e9-08cc418eaa84.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F4ee7928f-a30e-8949-37e9-08cc418eaa84.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5d1e568ee7b5c5daedb7c6c306e9491f 1x" loading="lazy"></a></p>

<h2>
<span id="終わりに" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>終わりに</h2>

<p>今回はSubscribeした結果のイベント購読破棄について書きました。<br>
Subscribeは適切に処理をしないと不具合の原因になるので標準にAnalyer機能、モニターEditor機能が用意されているのは本当に素晴らしいと感じました。</p>

<p>今回のDispose周りについて更に理解したことができたら追記していきます</p>

<h5>
<span id="お試しコード" class="fragment"></span><a href="#%E3%81%8A%E8%A9%A6%E3%81%97%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>お試しコード</h5>

<p><details><summary>Disposeで破棄</summary><div>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre><code><span class="k">using</span> <span class="nn">NUnit.Framework</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MessagePipe</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Zenject</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">XXXX</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">DisposableTest</span>
    <span class="p">{</span>
        <span class="c1">// イベント送る方</span>
        <span class="k">public</span> <span class="k">class</span> <span class="nc">Publisher</span>
        <span class="p">{</span>
            <span class="p">[</span><span class="n">Inject</span><span class="p">]</span> <span class="k">private</span> <span class="n">IPublisher</span><span class="p">&lt;</span><span class="n">MyEvent</span><span class="p">&gt;</span> <span class="n">_publisher</span><span class="p">;</span>

            <span class="k">public</span> <span class="k">void</span> <span class="nf">Send</span><span class="p">(</span><span class="n">MyEvent</span> <span class="n">ev</span><span class="p">)</span> <span class="p">=&gt;</span>
                <span class="n">_publisher</span><span class="p">.</span><span class="nf">Publish</span><span class="p">(</span><span class="n">ev</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// イベント受け取る方</span>
        <span class="k">public</span> <span class="k">class</span> <span class="nc">Subscriber</span> <span class="p">:</span> <span class="n">IDisposable</span>
        <span class="p">{</span>
            <span class="k">private</span> <span class="k">readonly</span> <span class="n">IDisposable</span> <span class="n">_disposable</span><span class="p">;</span>

            <span class="k">public</span> <span class="nf">Subscriber</span><span class="p">(</span><span class="n">ISubscriber</span><span class="p">&lt;</span><span class="n">MyEvent</span><span class="p">&gt;</span> <span class="n">subscriber</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">bag</span> <span class="p">=</span> <span class="n">DisposableBag</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">();</span>

                <span class="n">subscriber</span>
                    <span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">x</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">))</span>
                    <span class="p">.</span><span class="nf">AddTo</span><span class="p">(</span><span class="n">bag</span><span class="p">);</span>

                <span class="n">_disposable</span> <span class="p">=</span> <span class="n">bag</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="k">void</span> <span class="n">IDisposable</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">_disposable</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// 送るイベント</span>
        <span class="k">public</span> <span class="k">class</span> <span class="nc">MyEvent</span> 
        <span class="p">{</span> 
            <span class="k">public</span> <span class="kt">string</span> <span class="n">Message</span><span class="p">;</span> 
        <span class="p">}</span>


        <span class="k">private</span> <span class="n">DiContainer</span> <span class="n">_container</span><span class="p">;</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// SubscribeのIDosposableをかならず何らかの形でハンドリングする必要がある。</span>
        <span class="c1">/// しなければリークする</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="p">[</span><span class="n">Test</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="err">イベントを破棄する</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_container</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DiContainer</span><span class="p">();</span>

            <span class="kt">var</span> <span class="n">option</span> <span class="p">=</span> <span class="n">_container</span><span class="p">.</span><span class="nf">BindMessagePipe</span><span class="p">();</span>
            <span class="n">_container</span><span class="p">.</span><span class="n">BindMessageBroker</span><span class="p">&lt;</span><span class="n">MyEvent</span><span class="p">&gt;(</span><span class="n">option</span><span class="p">);</span>

            <span class="c1">// イベントを受ける方</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">_container</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">&lt;</span><span class="n">Subscriber</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="c1">// イベントを投げる方</span>
                <span class="kt">var</span> <span class="n">publisher</span> <span class="p">=</span> <span class="n">_container</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">&lt;</span><span class="n">Publisher</span><span class="p">&gt;();</span>
                <span class="n">publisher</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="k">new</span> <span class="n">MyEvent</span> <span class="p">{</span> <span class="n">Message</span> <span class="p">=</span> <span class="s">"テストメッセージ"</span> <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p></p>
</div></details></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2FToshizabeth%2Fitems%2F20f951fd38920c73b050&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2FToshizabeth%2Fitems%2F20f951fd38920c73b050&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/Toshizabeth/items/20f951fd38920c73b050/likers" class="css-1iupg5d">3</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">2</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/20f951fd38920c73b050/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/Toshizabeth/items/20f951fd38920c73b050/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/Toshizabeth/items/20f951fd38920c73b050/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/Toshizabeth/items/20f951fd38920c73b050/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/Toshizabeth/items/20f951fd38920c73b050.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-e91cb613-dfc2-49b9-98ed-759f8308aa17">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-a1d64aae-d12d-4f40-b177-9e05d26078eb"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-a1d64aae-d12d-4f40-b177-9e05d26078eb">{}</script>
      
<div id="LoginModal-react-component-47cc7c95-01f5-4117-9d72-a6dfa7703613"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-47cc7c95-01f5-4117-9d72-a6dfa7703613">{}</script>
      
<div id="StockModal-react-component-e16136fe-72fe-46fd-90a2-53ff8cddb9f0"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-e16136fe-72fe-46fd-90a2-53ff8cddb9f0">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;N5lSi/1n0aF/JeVj49ygxHM+Q26Or2tUzNWero9Jv5DwAdZqSBOlSdssEju2TFYu6br3KG16f5xPDMHuwvqyjQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch2\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h2\u003e\n\n\u003cp\u003e以下の環境で実行しています\u003cbr\u003e\n- MacOS\u003cbr\u003e\n- Unity2021.2.0b2\u003cbr\u003e\n- MessagePipe v1.6.1\u003cbr\u003e\n- Zenject\u003c/p\u003e\n\n\u003cp\u003e前回のMessagePipeの記事\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/Toshizabeth/items/f4d429fe1ac566ed7924\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003eこちらのMessagePipeのReadmeを元に学んだことを記事にまとめています\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/Cysharp/MessagePipe\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"subscribe-dispose\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#subscribe-dispose\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSubscribe, Dispose\u003c/h2\u003e\n\n\u003cp\u003eMessagePipeはSubcribeでイベント受信（購読）を行います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eHoge\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// MyEventの通知を受け取る\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esubscriber\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMessagePipe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGlobalMessagePipe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetSubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMyEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 購読処理\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eSubscribeの戻り値は\u003ccode\u003eIDisposable\u003c/code\u003e\u003cbr\u003e\nこのIDisposableを適切に処理しなければ\u003cb\u003eリーク\u003c/b\u003eが発生します。\u003c/p\u003e\n\n\u003cp\u003eつまり、\u003cb\u003eクラスが破棄されたとしてもイベント購読し続けることになる\u003c/b\u003e\u003cbr\u003e\n（バグが出る可能性が非常に高い！）\u003c/p\u003e\n\n\u003cp\u003e基本的には購読しているクラスの破棄と同時にイベントの購読も消したいはず。\u003cbr\u003e\n今回はイベントの破棄を担当する\u003ccode\u003eDispose\u003c/code\u003eについて書いていきます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"非monobehaviourクラスでイベントを破棄したい場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%9D%9Emonobehaviour%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%82%92%E7%A0%B4%E6%A3%84%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e非Monobehaviourクラスでイベントを破棄したい場合\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eHoge\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e \u003cspan class=\"n\"\u003e_disposable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebag\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDisposableBag\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// MyEventの通知を受け取る\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esubscriber\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMessagePipe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGlobalMessagePipe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetSubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMyEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 購読処理\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebag\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// stringの通知を受け取る\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esubscriber\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMessagePipe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGlobalMessagePipe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetSubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 購読処理\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebag\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003e_disposable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebag\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBuild\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// _disposable.Disposeですべて破棄される。\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 必ずクラス終了前に呼び出すこと\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_disposable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eSubscribeの戻り値に対してAddToメソッドを呼び出す\u003c/p\u003e\n\n\u003cp\u003eそこに \u003ccode\u003eDisposableBag.CreateBuilder()\u003c/code\u003e で作り出した \u003ccode\u003eDisposableBagBuilder\u003c/code\u003e を渡します。\u003cbr\u003e\nそして \u003ccode\u003e_disposable.Dispose\u003c/code\u003e を呼び出すことでイベントすべての購読が破棄されます。\u003c/p\u003e\n\n\u003cp\u003eイベント単体の破棄であればSubscribeの戻り値をそのままメンバ変数に持ち、最後にDisposeするだけでも良\u003c/p\u003e\n\n\u003cp\u003e\u003cb\u003eDisposeは明示的に呼び出す必要があるので注意\u003c/b\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"monobehaviourを継承しているクラスでイベントを破棄したい場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#monobehaviour%E3%82%92%E7%B6%99%E6%89%BF%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%82%92%E7%A0%B4%E6%A3%84%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMonobehaviourを継承しているクラスでイベントを破棄したい場合\u003c/h2\u003e\n\n\u003cp\u003eUniRxを組み込んでいる場合、Monobehaviourクラスはもう少し楽に破棄の処理ができます\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUniRx\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// UniRx必須\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eHoge\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonobehaviour\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAwake\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// MyEventの通知を受け取る\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esubscriber\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMessagePipe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGlobalMessagePipe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetSubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMyEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 自分を渡してGameObjectの破棄時に削除をしてもらう\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eUniRxではおなじみの処理ですが\u003cbr\u003e\nAddToに自分自身を渡してGameObjectのライフサイクルに結びつけます。\u003cbr\u003e\nこれで\u003cstrong\u003eGameObjectが破棄されるときにイベントも破棄されます。\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"subscribeを適切にハンドリングしてない場合エラーを出す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#subscribe%E3%82%92%E9%81%A9%E5%88%87%E3%81%AB%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%97%E3%81%A6%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88%E3%82%A8%E3%83%A9%E3%83%BC%E3%82%92%E5%87%BA%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSubscribeを適切にハンドリングしてない場合エラーを出す\u003c/h2\u003e\n\n\u003cp\u003eDisposeの仕方はわかりましたが\u003cb\u003e『Subcribeを適切に処理しているかどうか』\u003c/b\u003eは結局コードを書く人に委ねられている状態です。\u003c/p\u003e\n\n\u003cp\u003e忘れないように心がけていても\u003cstrong\u003e抜けは必ず発生します(必ず）\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eしかし！ (Unity2020.2以降であれば)\u003cstrong\u003eSubcribeの戻り値をハンドリングしてないものがあれば、ビルド時にエラーになる\u003ccode\u003eMessagePipe.Analyzer\u003c/code\u003eという便利機能が公開されているようです\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eMessagePipe.Analyzerは\u003cb\u003eRoslyn analyzers\u003c/b\u003e という、ユーザー独自のコード解析を組み込める仕組みを利用されています(以下記事参考）\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://docs.unity3d.com/2020.2/Documentation/Manual/roslyn-analyzers.html\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e結果からいうと \u003cb\u003eMessagePipe.Analyzer.dll\u003c/b\u003e  を組み込むことで\u003cbr\u003e\nSubscribeに対して何も処理をしていない場合\u003cb\u003eUnityのコンソール上やVisualStudio上でエラーが出るようになります\u003c/b\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eVisualStudio\u003cbr\u003e\n↓ Subscribeに対して何もしていない\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/3e326333137e19a5a959145576bf9d2f827e4ef6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f32643165313534312d613162652d653030612d356138662d6632383333306531643036392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F2d1e1541-a1be-e00a-5a8f-f28330e1d069.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d01e0a907934d277a9687b10fddb72a6\" alt=\"20210704173534.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/2d1e1541-a1be-e00a-5a8f-f28330e1d069.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F2d1e1541-a1be-e00a-5a8f-f28330e1d069.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=051101e4c97dcc1d1ea26c58402b911f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eUnity\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/86b5f92dc7651790a5bbc2b12bbb3ecc90030ec5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f61363134363131312d363430382d303332312d636563362d6262353863643062303235662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2Fa6146111-6408-0321-cec6-bb58cd0b025f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4140fcb6931453866bdca223c0d7169a\" alt=\"20210704173442.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/a6146111-6408-0321-cec6-bb58cd0b025f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2Fa6146111-6408-0321-cec6-bb58cd0b025f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d80fc022e59f998fdb3dd1dae76d846b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこうしてエラーが出てくれれば忘れることもない(実行できないので)\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"導入手順\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%B0%8E%E5%85%A5%E6%89%8B%E9%A0%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e導入手順\u003c/h3\u003e\n\n\u003cp\u003e++++++++++++++++++++++++++++++++++++++++++++++++\u003cbr\u003e\n\u003cb\u003eUnity2021.2.0b2\u003c/b\u003e で動作を確認しています。\u003cbr\u003e\n\u003cb\u003e\u003cfont color=\"#ff0000\"\u003eUnity2020.3.X系だとUnityでエラーが出ませんでした...(VisualStudioではエラーが出る)\u003c/font\u003e\u003c/b\u003e\u003c/p\u003e\n\n\u003cp\u003eバグか自分の設定が悪いのか.. \u003cfont color=\"Green\"\u003e調査中\u003c/font\u003e\u003cbr\u003e\n++++++++++++++++++++++++++++++++++++++++++++++++\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"1-messagepipeanalyzerdll-を-unityに入れる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-messagepipeanalyzerdll-%E3%82%92-unity%E3%81%AB%E5%85%A5%E3%82%8C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. MessagePipe.Analyzer.dll を Unityに入れる\u003c/h4\u003e\n\n\u003cp\u003eMessagePipeのGithubに\u003cb\u003eMessagePipe.Analyzer.dll\u003c/b\u003e が上がっています。\u003cbr\u003e\n(以下GithubのReleaseを参照)\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/Cysharp/MessagePipe\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003eDLLをダウンロード\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6dbb7d4986319a904504003743c90200d558e3ee/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f35363637623164342d613137642d393962322d613437342d3330633532313563343364662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F5667b1d4-a17d-99b2-a474-30c5215c43df.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=fc95d6c772681416c4294b4d870cc155\" alt=\"20210630233610.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/5667b1d4-a17d-99b2-a474-30c5215c43df.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F5667b1d4-a17d-99b2-a474-30c5215c43df.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e8dd0498dd75526f272b9b22ae21efb3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eそしてAsset以下のどこか適切なディレクトリにぶっこむ。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/270ac58409d349d3df55e585d33bef794458b482/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f38313036336164652d343834332d666237622d633439352d6161646161336231373437382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F81063ade-4843-fb7b-c495-aadaa3b17478.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=58ab1fdd0e7cbd4b1fe26064f84a07f4\" alt=\"20210704174052.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/81063ade-4843-fb7b-c495-aadaa3b17478.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F81063ade-4843-fb7b-c495-aadaa3b17478.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e07e3f56a0e5449732c3f197ab42c54f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"2-設定変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-%E8%A8%AD%E5%AE%9A%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. 設定変更\u003c/h4\u003e\n\n\u003cp\u003eMessagePipe.AnalyzerのInspectorで以下のように設定変更すること\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eSelectPlatforms for Plugin\u003c/code\u003e のチェックをすべて外す\u003c/li\u003e\n\u003cli\u003e右下のAssetLabelsボタンをクリックして \u003ccode\u003eRoslynAnalyzer\u003c/code\u003e を入力してEnterを押してラベルを付ける\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/855524638c455a251dd55e7e21d46bfe624ca3ca/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f65313630363165362d323262312d623030612d323235322d6432396633353137626662362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2Fe16061e6-22b1-b00a-2252-d29f3517bfb6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=568402a4ff3934518c20c51d37ec2164\" alt=\"20210704174456.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/e16061e6-22b1-b00a-2252-d29f3517bfb6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2Fe16061e6-22b1-b00a-2252-d29f3517bfb6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b508da33613f1a1c5168aad2baa0d85d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nロード終了後、\u003cb\u003eSubscribeを処理していない箇所に対してUnityがエラーを出すようになります\u003c/b\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"3-visualstudioでもエラーを出す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-visualstudio%E3%81%A7%E3%82%82%E3%82%A8%E3%83%A9%E3%83%BC%E3%82%92%E5%87%BA%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. Visualstudioでもエラーを出す\u003c/h4\u003e\n\n\u003cp\u003eVisualStudio上でもエラーを出すためには、Unityに対して更に一工夫する必要がありました。\u003c/p\u003e\n\n\u003cp\u003e同じくCysharpが公開している\u003cb\u003eCsprojModifier\u003c/b\u003eを導入します\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/Cysharp/CsprojModifier\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003e公開されている最新バージョンのパッケージをインストールします\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/Cysharp/CsprojModifier/releases/tag/1.1.1\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eUnity \u0026gt; Project Settings \u0026gt; C# Project Modifier\u003c/code\u003e を開き、\u003ccode\u003eAdd Roslyn Analyzer references to .csproj\u003c/code\u003e にチェックを付け、 \u003cstrong\u003eRegenerate project files\u003c/strong\u003e を押して .csproj を作り直します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/fe10c26313faf26a20c9bf57d715575bb6b37eb5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f38366234626564612d306635392d316163392d633264312d3232323432376434323463322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F86b4beda-0f59-1ac9-c2d1-222427d424c2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=07c34b81e530b5cc5874ad531e5d0cf2\" alt=\"20210704175014.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/86b4beda-0f59-1ac9-c2d1-222427d424c2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F86b4beda-0f59-1ac9-c2d1-222427d424c2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8712ab3fd098c336d2ed88710db81e84 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cb\u003e終了後再度VIsualStudioを開き直したらVisualStudio上でも検知できるようになりました\u003c/b\u003e\u003c/p\u003e\n\n\u003cp\u003e(現状、Unity2020.2以降のバージョンを使用している場合VisualStudioCode, Rider ではこの機能は使用できないようです。\u003cbr\u003e\nMacのVisualStudioでは正常に確認ができました）\u003cbr\u003e\nUnityでエラーが出る以上実行ができないのでUnityでカバーしていればまあよし！とも捉えられる\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"messagepipediagnostics-を使用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#messagepipediagnostics-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMessagePipeDiagnostics を使用する\u003c/h2\u003e\n\n\u003cp\u003eMessagePipeは更に機能があり(凄い)、実行中のプロジェクトで現在Subscribeされている数や情報を取得できる機能があります。(MessagePipeDiagnosticsInfo)\u003c/p\u003e\n\n\u003cp\u003eそして気軽に情報を見れるようにSubscribeしている箇所のモニターが出来る拡張機能が用意してあります(凄い)\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eWindow \u0026gt; MessagePipeDiagnostics\u003c/code\u003e を開くと、EditorWindowが立ち上がります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/02ec29936239df7b41fc40148c15928cc91a715a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f38643232326462362d626534622d383433372d336266362d6462623334323136656366622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F8d222db6-be4b-8437-3bf6-dbb34216ecfb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=43c359f670a625001f4166e9fa04375d\" alt=\"20210701100112.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/8d222db6-be4b-8437-3bf6-dbb34216ecfb.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F8d222db6-be4b-8437-3bf6-dbb34216ecfb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=00fa3c567cedbebe958bed4b09d5c684 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eそして実行中にWindowを見みると以下画像のようにSubscribeしている箇所が確認できます\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/c979a4b4e4ddfb6329f6cd191e9b098e606ae600/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f33633865653531612d363139642d366235302d393338342d6237653162376563626161662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F3c8ee51a-619d-6b50-9384-b7e1b7ecbaaf.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=04995cf59e012a71a7a685f45317963d\" alt=\"20210704181756.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/3c8ee51a-619d-6b50-9384-b7e1b7ecbaaf.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F3c8ee51a-619d-6b50-9384-b7e1b7ecbaaf.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=00ef43b4d7b19ae3a7fc0608b6e38807 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこの機能を利用するには \u003ccode\u003eGlobalMessagePipe.SetProvider\u003c/code\u003e を予め設定しておく事と、optionの\u003ccode\u003eEnableCaptureStackTrace\u003c/code\u003eをtrueにしておく必要があります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/03b02a3e201e5ea463444cb1a095191361171c11/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535333133382f34656537393238662d613330652d383934392d333765392d3038636334313865616138342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F4ee7928f-a30e-8949-37e9-08cc418eaa84.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=adbd8883a13412995488d0391b8539f8\" alt=\"20210704181941.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/553138/4ee7928f-a30e-8949-37e9-08cc418eaa84.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F553138%2F4ee7928f-a30e-8949-37e9-08cc418eaa84.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5d1e568ee7b5c5daedb7c6c306e9491f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"終わりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e終わりに\u003c/h2\u003e\n\n\u003cp\u003e今回はSubscribeした結果のイベント購読破棄について書きました。\u003cbr\u003e\nSubscribeは適切に処理をしないと不具合の原因になるので標準にAnalyer機能、モニターEditor機能が用意されているのは本当に素晴らしいと感じました。\u003c/p\u003e\n\n\u003cp\u003e今回のDispose周りについて更に理解したことができたら追記していきます\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"お試しコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E8%A9%A6%E3%81%97%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eお試しコード\u003c/h5\u003e\n\n\u003cp\u003e\u003cdetails\u003e\u003csummary\u003eDisposeで破棄\u003c/summary\u003e\u003cdiv\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eNUnit.Framework\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMessagePipe\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eZenject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eXXXX\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDisposableTest\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// イベント送る方\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ePublisher\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eInject\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMyEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_publisher\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyEvent\u003c/span\u003e \u003cspan class=\"n\"\u003eev\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003e_publisher\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePublish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eev\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// イベント受け取る方\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSubscriber\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e \u003cspan class=\"n\"\u003e_disposable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eISubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMyEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebag\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDisposableBag\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003esubscriber\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebag\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003e_disposable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebag\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBuild\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003e_disposable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 送るイベント\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMyEvent\u003c/span\u003e \n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e \n            \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eDiContainer\u003c/span\u003e \u003cspan class=\"n\"\u003e_container\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// SubscribeのIDosposableをかならず何らかの形でハンドリングする必要がある。\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// しなければリークする\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eTest\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"err\"\u003eイベントを破棄する\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003e_container\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDiContainer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eoption\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_container\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBindMessagePipe\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003e_container\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBindMessageBroker\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eMyEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eoption\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// イベントを受ける方\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_container\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstantiate\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSubscriber\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;())\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// イベントを投げる方\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003epublisher\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_container\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstantiate\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n                \u003cspan class=\"n\"\u003epublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eMyEvent\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"テストメッセージ\"\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/details\u003e\u003c/p\u003e\n","createdAt":"2021-07-04T09:59:06Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"wYVaiwvvti4aBSFNSOmnJhehIkB+mwQnnQ==--R5EPjYDXIkmKNdZt--2dpYjEXdFrfpU80o8bW36Q==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2021-07-04T10:21:03Z","likesCount":3,"linkUrl":"https://qiita.com/Toshizabeth/items/20f951fd38920c73b050","organization":null,"originalId":1457313,"stockedCount":2,"title":"【Unity】MessagePipeのSubscribe, Dispose処理について","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#subscribe-dispose\"\u003eSubscribe, Dispose\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%9D%9Emonobehaviour%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%82%92%E7%A0%B4%E6%A3%84%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88\"\u003e非Monobehaviourクラスでイベントを破棄したい場合\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#monobehaviour%E3%82%92%E7%B6%99%E6%89%BF%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%82%92%E7%A0%B4%E6%A3%84%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88\"\u003eMonobehaviourを継承しているクラスでイベントを破棄したい場合\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#subscribe%E3%82%92%E9%81%A9%E5%88%87%E3%81%AB%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%97%E3%81%A6%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88%E3%82%A8%E3%83%A9%E3%83%BC%E3%82%92%E5%87%BA%E3%81%99\"\u003eSubscribeを適切にハンドリングしてない場合エラーを出す\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%B0%8E%E5%85%A5%E6%89%8B%E9%A0%86\"\u003e導入手順\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1-messagepipeanalyzerdll-%E3%82%92-unity%E3%81%AB%E5%85%A5%E3%82%8C%E3%82%8B\"\u003e1. MessagePipe.Analyzer.dll を Unityに入れる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-%E8%A8%AD%E5%AE%9A%E5%A4%89%E6%9B%B4\"\u003e2. 設定変更\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3-visualstudio%E3%81%A7%E3%82%82%E3%82%A8%E3%83%A9%E3%83%BC%E3%82%92%E5%87%BA%E3%81%99\"\u003e3. Visualstudioでもエラーを出す\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#messagepipediagnostics-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003eMessagePipeDiagnostics を使用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e終わりに\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E8%A9%A6%E3%81%97%E3%82%B3%E3%83%BC%E3%83%89\"\u003eお試しコード\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\n\n","totalPv":1001,"uuid":"20f951fd38920c73b050","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"H3Kcur3jack3B4baSKxr1KTxwafJ--QtTrTU4+IKgdpZ9t--Qo8qP0C5q2w81y9vxlD9Eg==","originalId":553138,"description":"スローペースで個人開発をしています\r\nhttps://github.com/Toshizabeth/Ling","facebookUrl":null,"githubUrl":"https://github.com/Toshizabeth","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://avatars3.githubusercontent.com/u/9328751?v=4","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F9328751%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=b0f89dbffd66c7f7797e31635e9d2c60","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F9328751%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=89d60273ed831e85bb41b28f073d9d8e","urlName":"Toshizabeth","websiteUrl":"","twitterUrl":"https://twitter.com/toshi_zabeth","twitterUrlName":"toshi_zabeth","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Unity","urlName":"unity"},{"name":"MessagePipe","urlName":"messagepipe"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

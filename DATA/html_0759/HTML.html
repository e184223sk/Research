<!DOCTYPE html><html><head><meta charset="utf-8" /><title>【C#】IReadOnlyList&lt;T&gt;とReadOnlyCollection&lt;T&gt;とImmutableList&lt;T&gt;の違い - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/yutorisan/items/3f5fdb1495be03e56d3c" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="wZrptvzLXGTro7Bez+4SmPiJcwjXo8InOIMlWwmnDlqHOy/cFiRQAG0S16hvgL2o58ACVwkABsrgoB5mqxZ+dw==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@yutorisan19" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="【C#】IReadOnlyList&lt;T&gt;とReadOnlyCollection&lt;T&gt;とImmutableList&lt;T&gt;の違い - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRUXlQamdKRkpVbVZoWkU5dWJIbE1hWE4wUEZRLTQ0R29VbVZoWkU5dWJIbERiMnhzWldOMGFXOXVQRlEtNDRHb1NXMXRkWFJoWW14bFRHbHpkRHhVUHVPQnJ1bUJsZU9CaEEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9OGI2MWRkMWI4ZTA1ZWQ3YmM5MzEwZTM1MjIzMjBmOTM&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGwxZEc5eWFYTmhiZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTgxODZjNmQyOWMyMjMwNjA0NDYxZjBhZTI0ODQ3YzI4&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=88c9e8191e5ae5c81adfbed54e80e720"><meta property="og:description" content="

はじめに

先日、下記記事を公開しました。

【C#】インターフェイスの利点が理解できない人は「インターフェイスには３つのタイプがある」ことを理解しよう
https://qiita.com/yutorisan/items/d283..."><meta content="https://qiita.com/yutorisan/items/3f5fdb1495be03e56d3c" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,.NET,初心者" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-ec33f350-61cf-417f-985c-aa07843c1aa2"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fyutorisan%2Fitems%2F3f5fdb1495be03e56d3c">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fyutorisan%2Fitems%2F3f5fdb1495be03e56d3c">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-ec33f350-61cf-417f-985c-aa07843c1aa2">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-09-14T23:21:20.000+09:00","dateModified":"2020-09-14T23:21:20.000+09:00","headline":"【C#】IReadOnlyList\u003cT\u003eとReadOnlyCollection\u003cT\u003eとImmutableList\u003cT\u003eの違い","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRUXlQamdKRkpVbVZoWkU5dWJIbE1hWE4wUEZRLTQ0R29VbVZoWkU5dWJIbERiMnhzWldOMGFXOXVQRlEtNDRHb1NXMXRkWFJoWW14bFRHbHpkRHhVUHVPQnJ1bUJsZU9CaEEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9OGI2MWRkMWI4ZTA1ZWQ3YmM5MzEwZTM1MjIzMjBmOTM\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGwxZEc5eWFYTmhiZyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTgxODZjNmQyOWMyMjMwNjA0NDYxZjBhZTI0ODQ3YzI4\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=88c9e8191e5ae5c81adfbed54e80e720","mainEntityOfPage":"https://qiita.com/yutorisan/items/3f5fdb1495be03e56d3c","author":{"@type":"Person","address":"","email":null,"identifier":"yutorisan","name":"yutorisan","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F1274400166120812544%2FDAWcpHec_bigger.jpg?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=754be610f489085be0fdfc48de5585a9","url":"https://qiita.com/yutorisan","description":"C#が好きです","memberOf":[{"@type":"Organization","address":"オンライン@Slack","legalName":"Unityゲーム開発者ギルド","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/5e3ba3bb442371003e6b5d4618ef627b9b478357/original.jpg?1570216541","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","identifier":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yutorisan","type":"items","id":"3f5fdb1495be03e56d3c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yutorisan","type":"items","id":"3f5fdb1495be03e56d3c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yutorisan","type":"items","id":"3f5fdb1495be03e56d3c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/yutorisan/items/3f5fdb1495be03e56d3c","location":"/yutorisan/items/3f5fdb1495be03e56d3c","scheme":"https","host":"qiita.com","port":null,"pathname":"/yutorisan/items/3f5fdb1495be03e56d3c","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"QNKMXtAe7dNZVDHoFCEmDdr1W9wt0TO5XJ+05XBGj2kGc0o0OvHht9/lVh60T4k9xbwqg/Ny91SEvI/Y0vf/RA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-50085ad1-1d4b-49a3-bd7a-b0154f0374d7"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yutorisan/items/3f5fdb1495be03e56d3c/likers" class="css-1iupg5d">47</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">44</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3f5fdb1495be03e56d3c/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yutorisan/items/3f5fdb1495be03e56d3c/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yutorisan/items/3f5fdb1495be03e56d3c/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yutorisan/items/3f5fdb1495be03e56d3c/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yutorisan/items/3f5fdb1495be03e56d3c.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/yutorisan"><img class="css-100alwu eyfquo10" src="https://pbs.twimg.com/profile_images/1274400166120812544/DAWcpHec_bigger.jpg" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/yutorisan" class="css-10ougpm">@<!-- -->yutorisan</a><div class="css-1ay9vb9"><time dateTime="2020-09-14T14:21:20Z" class="css-m19uds">posted at 2020-09-14</time></div></div></div></div></div><h1 class="css-cgzq40">【C#】IReadOnlyList&lt;T&gt;とReadOnlyCollection&lt;T&gt;とImmutableList&lt;T&gt;の違い</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/.net" class="css-4czcte">.NET</a><a href="/tags/%e5%88%9d%e5%bf%83%e8%80%85" class="css-4czcte">初心者</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>先日、下記記事を公開しました。</p>

<p><strong>【C#】インターフェイスの利点が理解できない人は「インターフェイスには３つのタイプがある」ことを理解しよう</strong><br>
<a href="https://qiita.com/yutorisan/items/d28386f168f2f3ab166d" class="autolink" id="reference-032e67bb0384574a7d93">https://qiita.com/yutorisan/items/d28386f168f2f3ab166d</a></p>

<p>この記事でIReadOnly系インターフェイスの役割と重要性について簡単に説明し、</p>

<blockquote>
<p><code>List</code>をそのまま渡すのではなく、<code>IReadOnlyList</code>として渡すだけで、渡した先で勝手に書き換えられる危険性が皆無になります</p>
</blockquote>

<p>と記述しましたが、これに対して「<strong><code>IReadOnlyList</code>では<code>IList</code>にキャストされてしまうので、変更される危険性が皆無ではない。本当に皆無にしたければ<code>ImuutableList</code>で公開すべき</strong>」とのご意見をいただきました。</p>

<p><code>ImmutableList</code>のことは正直あまり知らなかったので、調べてみると「不変なコレクション」とのこと。<br>
<code>ReadOnlyCollection</code>とどう違うんだ…？と思ったので、それぞれ違いを整理しました。</p>

<h2>
<span id="ireadonlylisttインターフェイス" class="fragment"></span><a href="#ireadonlylistt%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9"><i class="fa fa-link"></i></a><code>IReadOnlyList&lt;T&gt;</code>インターフェイス</h2>

<p><code>IReadOnlyList&lt;T&gt;</code>は、ListのReadOnlyなインターフェイスです。</p>

<p>定義は次のようになっています。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>
<span class="k">public</span> <span class="k">interface</span> <span class="nc">IReadOnlyList</span><span class="p">&lt;</span><span class="k">out</span> <span class="n">T</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;,</span> <span class="n">IEnumerable</span><span class="p">,</span> <span class="n">IReadOnlyCollection</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="n">T</span> <span class="k">this</span> <span class="p">[</span><span class="kt">int</span> <span class="n">index</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">get</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code>IReadOnlyList&lt;T&gt;</code>が継承<sup id="fnref1"><a href="#fn1" title="ちなみにインターフェイスがインターフェイスを「継承」しているっていうんですかね？それとも「実装」？意味合い的には「継承」が正しい気もしますが。">1</a></sup>している<code>IReadOnlyCollection&lt;T&gt;</code>の定義はこうです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>
<span class="k">public</span> <span class="k">interface</span> <span class="nc">IReadOnlyCollection</span><span class="p">&lt;</span><span class="k">out</span> <span class="n">T</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;,</span> <span class="n">IEnumerable</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">Count</span> <span class="p">{</span>
        <span class="k">get</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>つまり、<strong>インデクサによる値の取得</strong>と<strong>要素数の取得</strong>、それから<strong><code>IEnumerator&lt;T&gt;</code>の取得（foreachで回す）</strong>だけができるコレクションというわけですね。<br>
<code>List&lt;T&gt;</code>を<code>IReadOnlyList&lt;T&gt;</code>で渡すと、コレクション変更系メソッドが呼べなくなるので安全ですよ、というインターフェイスです。</p>

<h3>
<span id="問題点キャストされるとreadonlyじゃなくなる" class="fragment"></span><a href="#%E5%95%8F%E9%A1%8C%E7%82%B9%E3%82%AD%E3%83%A3%E3%82%B9%E3%83%88%E3%81%95%E3%82%8C%E3%82%8B%E3%81%A8readonly%E3%81%98%E3%82%83%E3%81%AA%E3%81%8F%E3%81%AA%E3%82%8B"><i class="fa fa-link"></i></a>問題点：キャストされるとReadOnlyじゃなくなる</h3>

<p>さて、ここからが本題で、冒頭で記述した「<strong>キャストされたら普通に変更されちゃう問題</strong>」についてです。</p>

<p><code>IReadOnlyList&lt;T&gt;</code>は<code>List&lt;T&gt;</code>のインターフェイス<sup id="fnref2"><a href="#fn2" title="もちろんList&lt;T&gt;だけじゃなくて色々なクラスに実装されていますが代表として挙げました">2</a></sup>なので、<strong><code>List&lt;T&gt;</code>にキャストされてしまえば普通に変更できちゃう</strong>という問題です。</p>

<p>以下の例をご覧ください。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IReadOnlyList</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">ireadonlylist</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;()</span> <span class="p">{</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span> <span class="p">};</span>

        <span class="n">ReadOnlyBreaker</span><span class="p">.</span><span class="nf">Break</span><span class="p">(</span><span class="n">ireadonlylist</span><span class="p">);</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">ireadonlylist</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">ReadOnlyBreaker</span>
<span class="p">{</span>
    <span class="c1">//IReadOnlyListで受け取っても…</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Break</span><span class="p">(</span><span class="n">IReadOnlyList</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">rolist</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//キャストしてしまえばAddできる</span>
        <span class="p">(</span><span class="n">rolist</span> <span class="k">as</span> <span class="n">IList</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;).</span><span class="nf">Add</span><span class="p">(</span><span class="m">100</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>1,2,3で<code>List&lt;int&gt;</code>を初期化して、<code>IReadOnlyList&lt;int&gt;</code>にして渡しても、受け取った側が勝手に<code>IList&lt;int&gt;</code>にキャストすればAddできてしまうという例です。</p>

<p>実行結果がこちら。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>1
2
3
100
</code></pre></div></div>

<p><code>IReadOnlyList&lt;int&gt;</code>で渡したのに、100がAddされてしまっています。</p>

<p>これは、<code>IReadOnlyList&lt;T&gt;</code>がインターフェイスであるがゆえ、必ず具象クラスが存在するので、もともとの具象クラス側で変更を許可しているならば無理やり変更できるという、悲しい問題です。</p>

<p>しかし、<strong>普通のプログラマーであれば「<code>IReadOnlyList</code>」と書いてあれば、「あ、このコレクションは変更してはいけないんだな」と理解できる</strong>ため、わざわざキャストしてまで無理やり変更されることは少ないと思います。<br>
したがって、決して<strong><code>IReadOnlyList&lt;T&gt;</code>では危険だ！と主張しているわけではありません</strong>のでご留意ください。</p>

<p>しかしながら、汎用的なライブラリとして公開するなど、どんな使い方をされるかわからない場合や、キャストによる変更される危険もなくしたいと言った場合は、次に紹介する<code>ReadOnlyCollection&lt;T&gt;</code>クラスまたは<code>ImmutableList&lt;T&gt;</code>クラスを使用すれば、この問題を解決することができます。</p>

<h2>
<span id="readonlycollectiontクラス" class="fragment"></span><a href="#readonlycollectiont%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a><code>ReadOnlyCollection&lt;T&gt;</code>クラス</h2>

<p><code>ReadOnlyCollection&lt;T&gt;</code>クラスは、<code>List&lt;T&gt;</code>をラップして読み取り専用なメンバのみ外部に公開するクラスです。</p>

<p>このクラスを生成するには<code>AsReadOnly()</code>メソッドを利用するか、<code>IList&lt;T&gt;</code>を引数にとったコンストラクタを利用します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>
<span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">list</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;()</span> <span class="p">{</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span> <span class="p">};</span>

<span class="c1">//AsReadOnly()による生成</span>
<span class="n">ReadOnlyCollection</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">readonlyCollection</span> <span class="p">=</span> <span class="n">list</span><span class="p">.</span><span class="nf">AsReadOnly</span><span class="p">();</span>

<span class="c1">//コンストラクタによる生成</span>
<span class="n">ReadOnlyCollection</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">readonlyCollection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ReadOnlyCollection</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="n">list</span><span class="p">);</span>
</code></pre></div></div>

<h3>
<span id="ireadonlylisttとの違い" class="fragment"></span><a href="#ireadonlylistt%E3%81%A8%E3%81%AE%E9%81%95%E3%81%84"><i class="fa fa-link"></i></a><code>IReadOnlyList&lt;T&gt;</code>との違い</h3>

<p><code>IReadOnlyList&lt;T&gt;</code>はインターフェイスで、<strong>実体としてはあくまでも具象クラスを参照している</strong>ため、具象クラスにキャストされれば<code>List&lt;T&gt;</code>が変更される危険があります。<br>
ところが、この<strong><code>ReadOnlyCollecion&lt;T&gt;</code>はインターフェイスではなく、元の<code>List&lt;T&gt;</code>とはまた別のクラス</strong>なので、キャストされる心配がありません。</p>

<p>具体的には、元となる<code>List&lt;T&gt;</code>の参照を内部で持ち、読み取り専用のメンバのみを外部に公開しています。<br>
そのため、内部の<code>List&lt;T&gt;</code>は完全にプロテクトされており、変更される危険がないのです。</p>

<h4>
<span id="図による解説" class="fragment"></span><a href="#%E5%9B%B3%E3%81%AB%E3%82%88%E3%82%8B%E8%A7%A3%E8%AA%AC"><i class="fa fa-link"></i></a>図による解説</h4>

<p>ちょっと分かりづらいかと思いますので図を用意しました。<br>
<code>IReadOnlyList&lt;T&gt;</code>の場合は次のようになります。</p>

<p><a href="https://camo.qiitausercontent.com/db18d3468bb9382fab723b57f28f7f019160ac95/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f31393435383832372d653266362d313135392d613230662d6134373433613466393766372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F19458827-e2f6-1159-a20f-a4743a4f97f7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f6bb68c6379782816db5612b8c3a8004" alt="IReadOnlyList.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/19458827-e2f6-1159-a20f-a4743a4f97f7.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F19458827-e2f6-1159-a20f-a4743a4f97f7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f3f0e78434d589058c87a490e581f169 1x" loading="lazy"></a></p>

<p><code>IReadOnlyList&lt;T&gt;</code>は<code>List&lt;T&gt;</code>のうち読み取り専用のメンバのみを提供するインターフェイスです。<br>
しかし、あくまでも<code>List&lt;T&gt;</code>に実装されたインターフェイスなので、キャストされれば<code>List&lt;T&gt;</code>に直接アクセスされます。</p>

<p>対して、<code>ReadOnlyCollection&lt;T&gt;</code>は次のようになります。<br>
<a href="https://camo.qiitausercontent.com/e0c9ee865b3b8dd19fbf8c79d72d488a824a6ae8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f37313530386133342d633238312d316265392d396366302d3561393339663031653739612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F71508a34-c281-1be9-9cf0-5a939f01e79a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3e15b162f87ca3d0b9395a09e46f4360" alt="ReadOnlyCollection.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/71508a34-c281-1be9-9cf0-5a939f01e79a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F71508a34-c281-1be9-9cf0-5a939f01e79a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d822bccafb1705fcbdc3eb5d0bbc161a 1x" loading="lazy"></a></p>

<p><code>ReadOnlyCollection&lt;T&gt;</code>は、インターフェイスではなく実体があるクラスで、内部に元となる<code>List&lt;T&gt;</code>の参照を持っています。<br>
<code>ReadOnlyCollection&lt;T&gt;</code>は<code>List&lt;T&gt;</code>のメンバのうち読み取り専用メンバのみを外部に公開するため、<code>List&lt;T&gt;</code>自体は安全が保たれます。<br>
さらに、外部からアクセスされる<code>ReadOnlyCollection&lt;T&gt;</code>は内部の<code>List&lt;T&gt;</code>とは独立した存在なので、キャストによって内部の<code>List&lt;T&gt;</code>が変更される危険はありません。</p>

<h2>
<span id="immutablelisttクラス" class="fragment"></span><a href="#immutablelistt%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a><code>ImmutableList&lt;T&gt;</code>クラス</h2>

<p><code>ImmutableList&lt;T&gt;</code>クラスも、<code>ReadOnlyCollection&lt;T&gt;</code>と同様に、元となる<code>List&lt;T&gt;</code>を内部にラップします。</p>

<p>このクラスを生成するには、<code>ToImmutable()</code>メソッドを利用するか、<code>ImmutableList.CreateRange(IEnumerable&lt;T&gt;)</code>ファクトリメソッドを利用します。コンストラクタによる生成はできません。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>
<span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">list</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;()</span> <span class="p">{</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span> <span class="p">};</span>

<span class="c1">//ToImmutable()による生成</span>
<span class="n">ImmutableList</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">immutableList</span> <span class="p">=</span> <span class="n">list</span><span class="p">.</span><span class="nf">ToImmutable</span><span class="p">();</span>

<span class="c1">//ImmutableList.CreateRangeによる生成</span>
<span class="n">ImmutableList</span> <span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">immutableList</span> <span class="p">=</span> <span class="n">ImmutableList</span><span class="p">.</span><span class="nf">CreateRange</span><span class="p">(</span><span class="n">list</span><span class="p">);</span>
</code></pre></div></div>

<h3>
<span id="参照ではなくコピーをラップする" class="fragment"></span><a href="#%E5%8F%82%E7%85%A7%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8F%E3%82%B3%E3%83%94%E3%83%BC%E3%82%92%E3%83%A9%E3%83%83%E3%83%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>参照ではなくコピーをラップする</h3>

<p><code>ReadOnlyCollection&lt;T&gt;</code>との違いは、<strong>参照ではなくコピーをラップする</strong>ことです。<br>
参照ではなくコピーをラップするため、<code>ImmutableList&lt;T&gt;</code>を生成したあとに元となるコレクションに変更を加えても、<code>ImmutableList&lt;T&gt;</code>の読み出し値は変わりません。</p>

<p>以下のコードで、<code>ReadOnlyCollection&lt;T&gt;</code>と<code>ImmutableList&lt;T&gt;</code>を両方生成したあとに、元のコレクションに変更を加えて、動作の違いを確認してみます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">list</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;()</span> <span class="p">{</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span> <span class="p">};</span>

    <span class="n">ReadOnlyCollection</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">readonlyCollection</span> <span class="p">=</span> <span class="n">list</span><span class="p">.</span><span class="nf">AsReadOnly</span><span class="p">();</span>
    <span class="n">ImmutableList</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">immutableList</span> <span class="p">=</span> <span class="n">list</span><span class="p">.</span><span class="nf">ToImmutableList</span><span class="p">();</span>

    <span class="c1">//ReadOnlyCollection, ImmutableListを生成したあとに元となるコレクションに変更を加える</span>
    <span class="n">list</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="m">100</span><span class="p">);</span>

    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"ReadOnlyCollection:"</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">readonlyCollection</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"ImmutableList:"</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">immutableList</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>ReadOnlyCollection:
1
2
3
100
ImmutableList:
1
2
3
</code></pre></div></div>

<p><code>ReadOnlyCollection&lt;T&gt;</code>のほうは、インスタンス生成後に元となるコレクションに変更が加えられた場合でも、その変更内容が反映されています。元となるコレクションの参照を内部にラップしているからですね。<br>
対して、<code>ImmutableList&lt;T&gt;</code>のほうは、インスタンス生成後の変更内容が反映されていません。これは、元となるコレクションのコピーを内部にラップしているためです。</p>

<p>言うならば、<strong>コレクションのスナップショットを撮影しているような感覚</strong>だと思います。</p>

<h3>
<span id="変更系メソッドが利用可能" class="fragment"></span><a href="#%E5%A4%89%E6%9B%B4%E7%B3%BB%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%8C%E5%88%A9%E7%94%A8%E5%8F%AF%E8%83%BD"><i class="fa fa-link"></i></a>変更系メソッドが利用可能</h3>

<p><code>ImmutableList&lt;T&gt;</code>の場合は<strong>変更系メソッドが呼び出し可能</strong>です。<br>
変更系メソッドを呼び出した場合、内部にラップされた元となる<code>List&lt;T&gt;</code>のコピーがまた生成され、そのコピーに対して変更内容が適用されて、メソッドの戻り値として返されます。</p>

<p>したがって、変更系メソッドを呼び出した場合でも、元となるコレクションはもちろん、内部にラップしたコレクションにも変更が加えられることはありません。</p>

<h3>
<span id="図による解説-1" class="fragment"></span><a href="#%E5%9B%B3%E3%81%AB%E3%82%88%E3%82%8B%E8%A7%A3%E8%AA%AC-1"><i class="fa fa-link"></i></a>図による解説</h3>

<p><code>ImmutableList&lt;T&gt;</code>の挙動を図で表すと次のようになります。<br>
<a href="https://camo.qiitausercontent.com/aac85ed168b892a7b19fa9d9acd8698dc5c8cac0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f63316361363434622d373166342d633139302d666662322d3661396466353635623766352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Fc1ca644b-71f4-c190-ffb2-6a9df565b7f5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=eb6becaf8f74037137563a8793cf6a18" alt="ImmutableList.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/c1ca644b-71f4-c190-ffb2-6a9df565b7f5.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Fc1ca644b-71f4-c190-ffb2-6a9df565b7f5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=09aec6b3261b092d25da20469284d000 1x" loading="lazy"></a></p>

<p><code>ReadOnlyCollection&lt;T&gt;</code>と同様、キャストによる変更の危険性はなくなっています。</p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p><code>IReadOnlyList&lt;T&gt;</code>, <code>ReadOnlyCollection&lt;T&gt;</code>, <code>ImmutableList&lt;T&gt;</code>の違いをまとめると次のようになります。</p>

<table>
<thead>
<tr>
<th></th>
<th><code>IReadOnlyList&lt;T&gt;</code></th>
<th><code>ReadOnlyCollection&lt;T&gt;</code></th>
<th><code>ImmutableList&lt;T&gt;</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>種類</td>
<td>インターフェイス</td>
<td>クラス</td>
<td>クラス</td>
</tr>
<tr>
<td>利用方法</td>
<td>そのまま渡せばOK</td>
<td>
<code>AsReadOnly()</code><br>または<br><code>new ReadOnlyCollection(IList&lt;T&gt;)</code>
</td>
<td>
<code>ToImmutable()</code><br>または<br><code>ImmutableList.CreateRange(IEnumerable&lt;T&gt;)</code>
</td>
</tr>
<tr>
<td>元コレクション</td>
<td>直接参照している</td>
<td>参照がラップされる</td>
<td>コピーがラップされる</td>
</tr>
<tr>
<td>変更系メソッド</td>
<td>
<strong>利用不能</strong><br>（ただしキャストで利用可能）</td>
<td><strong>利用不能</strong></td>
<td>
<strong>利用可能</strong><br>ただしコピーに適用され、ソースには影響しない</td>
</tr>
<tr>
<td>利用場面</td>
<td>「この<code>List</code>は変更してほしくない」という意思を伝えたい</td>
<td>
<code>List</code>を絶対に変更できない形で渡したい</td>
<td>コレクションのスナップショットを渡したい</td>
</tr>
</tbody>
</table>

<h3>
<span id="メソッド名から伝わるニュアンス" class="fragment"></span><a href="#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E5%90%8D%E3%81%8B%E3%82%89%E4%BC%9D%E3%82%8F%E3%82%8B%E3%83%8B%E3%83%A5%E3%82%A2%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>メソッド名から伝わるニュアンス</h3>

<p><code>AsReadOnly()</code>と<code>ToImmutable()</code>のメソッド名をこうやって比べてみると、確かにAsの方は「オブジェクト参照はそのままで、型を変化させる」といったニュアンスが伝わりますし、Toの方は「オブジェクトを元にして別のインスンタンスを生成する」といったニュアンスが伝わります。細かなメソッド名の違いも、その挙動を正確に表現しているようです。メソッド名はきちんと考えて付けなければならないと感じました。</p>

<h2>
<span id="おまけilisttインターフェイスの実装について" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91ilistt%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>おまけ：<code>IList&lt;T&gt;</code>インターフェイスの実装について</h2>

<p>実は、<code>ReadOnlyCollection&lt;T&gt;</code>クラスと<code>ImmutableList&lt;T&gt;</code>クラスは、共に<code>IList&lt;T&gt;</code>インターフェイスを実装しています。<br>
<code>IList&lt;T&gt;</code>インターフェイスを実装しているということは、<code>Add</code>や<code>Remove</code>ができるはずですよね？</p>

<p>すごく疑問に思い調べてみると、<strong>インターフェイスの明示的な実装</strong>というものを使っているらしいです。</p>

<h3>
<span id="インターフェイスの明示的な実装" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%81%AE%E6%98%8E%E7%A4%BA%E7%9A%84%E3%81%AA%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>インターフェイスの明示的な実装</h3>

<p>詳しくは<a href="https://ufcpp.net/study/csharp/oo_interface.html?p=4" rel="nofollow noopener" target="_blank">このサイト</a>を参考にしてほしいのですが、インターフェイスのメンバにあるけども、<code>public</code>にしたくないメンバを隠すために使われることがあるようです。</p>

<p>インターフェイスの明示的な実装を行うには下記のよう、<code>インターフェイス名.メンバ名</code>でインターフェイスメンバを実装します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>
<span class="k">public</span> <span class="k">interface</span> <span class="nc">ITestInterface</span> 
<span class="p">{</span>
    <span class="k">void</span> <span class="nf">MethodA</span><span class="p">();</span>
    <span class="k">void</span> <span class="nf">MethodB</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">TestClass</span> <span class="p">:</span> <span class="n">ITestInterface</span> 
<span class="p">{</span>
    <span class="c1">//普通のインターフェイス実装</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="c1">//明示的なインターフェイスの実装</span>
    <span class="k">void</span> <span class="n">ITestInterface</span><span class="p">.</span><span class="nf">MethodB</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>    
<span class="p">}</span>

</code></pre></div></div>

<p>このようにすると、<code>MethodB</code>は<code>TestClass</code>クラスのインスタンスから呼ぶことはできなくなり、メンバを隠すことができます。</p>

<p>しかし、インターフェイスを実装している以上、メンバは呼べなければなりません。<br>
ではどうすれば呼べるかと言うと、<code>インターフェイス名.メンバ名</code>で呼ぶことができます。<br>
実装しているクラスのインスタンスから直接呼び出すことはできないけども、インターフェイス経由ならば呼び出せるようです。</p>

<p>「インターフェイスの明示的な実装」、使う場面にはあまり出くわしたことがないですが、まだ知らないことがたくさんあると勉強になりました。</p>

<h3>
<span id="呼び出すと必ずnotsupportedexceptionがスローされる" class="fragment"></span><a href="#%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E3%81%A8%E5%BF%85%E3%81%9Anotsupportedexception%E3%81%8C%E3%82%B9%E3%83%AD%E3%83%BC%E3%81%95%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>呼び出すと必ず<code>NotSupportedException</code>がスローされる</h3>

<p>では、<code>ReadOnlyCollection&lt;T&gt;</code>や<code>ImmutableList&lt;T&gt;</code>でも、<code>IList&lt;T&gt;</code>インターフェイス経由であれば<code>Add</code>や<code>Remove</code>ができるのかといえば、そうではないようです。</p>

<p>両者のクラスは、<strong><code>IList&lt;T&gt;</code>インターフェイス経由で変更系メソッドを呼び出すと、必ず<code>NotSupportedException</code>がスローされる</strong>ようです。</p>

<p>この実装って正しいんですかね…？そこまでして<code>IList&lt;T&gt;</code>インターフェイスを実装する理由は…？<br>
まぁ、マイクロソフトのやることなので正しいのでしょう（適当）</p>

<p>誰か<code>ReadOnlyCollection&lt;T&gt;</code>や<code>ImmutableList&lt;T&gt;</code>が<code>IList&lt;T&gt;</code>を実装してる理由知っていたら教えて下さい。</p>

<p>以上、長くなってしまいましたが<code>IReadOnlyList&lt;T&gt;</code>と<code>ReadOnlyCollection&lt;T&gt;</code>と<code>ImmutableList&lt;T&gt;</code>の違いでした。</p>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>ちなみにインターフェイスがインターフェイスを「継承」しているっていうんですかね？それとも「実装」？意味合い的には「継承」が正しい気もしますが。 <a href="#fnref1">↩</a></p>
</li>

<li id="fn2">
<p>もちろん<code>List&lt;T&gt;</code>だけじゃなくて色々なクラスに実装されていますが代表として挙げました <a href="#fnref2">↩</a></p>
</li>

</ol>
</div>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fyutorisan%2Fitems%2F3f5fdb1495be03e56d3c&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fyutorisan%2Fitems%2F3f5fdb1495be03e56d3c&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yutorisan/items/3f5fdb1495be03e56d3c/likers" class="css-1iupg5d">47</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">44</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3f5fdb1495be03e56d3c/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yutorisan/items/3f5fdb1495be03e56d3c/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yutorisan/items/3f5fdb1495be03e56d3c/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yutorisan/items/3f5fdb1495be03e56d3c/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yutorisan/items/3f5fdb1495be03e56d3c.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-50085ad1-1d4b-49a3-bd7a-b0154f0374d7">{"authorAnalyticsTrackingId":"UA-135447292-3","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-09526b82-3321-4404-87a4-c5ae53ae2841"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-09526b82-3321-4404-87a4-c5ae53ae2841">{}</script>
      
<div id="LoginModal-react-component-5241c98b-608e-47d5-9d9f-4892ef310d7d"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-5241c98b-608e-47d5-9d9f-4892ef310d7d">{}</script>
      
<div id="StockModal-react-component-142e7119-2dc6-4ae1-aa00-3c93c9ef40f5"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-142e7119-2dc6-4ae1-aa00-3c93c9ef40f5">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;mF31vrtDfo3umynT/mjXjGp4ckFGvzPKho+ATFGkiYPe/DPUUaxy6WgqTiVeBni8dTEDHpgc9yderLtx8xX5rg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch2\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h2\u003e\n\n\u003cp\u003e先日、下記記事を公開しました。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e【C#】インターフェイスの利点が理解できない人は「インターフェイスには３つのタイプがある」ことを理解しよう\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/yutorisan/items/d28386f168f2f3ab166d\" class=\"autolink\" id=\"reference-032e67bb0384574a7d93\"\u003ehttps://qiita.com/yutorisan/items/d28386f168f2f3ab166d\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこの記事でIReadOnly系インターフェイスの役割と重要性について簡単に説明し、\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003eList\u003c/code\u003eをそのまま渡すのではなく、\u003ccode\u003eIReadOnlyList\u003c/code\u003eとして渡すだけで、渡した先で勝手に書き換えられる危険性が皆無になります\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eと記述しましたが、これに対して「\u003cstrong\u003e\u003ccode\u003eIReadOnlyList\u003c/code\u003eでは\u003ccode\u003eIList\u003c/code\u003eにキャストされてしまうので、変更される危険性が皆無ではない。本当に皆無にしたければ\u003ccode\u003eImuutableList\u003c/code\u003eで公開すべき\u003c/strong\u003e」とのご意見をいただきました。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eImmutableList\u003c/code\u003eのことは正直あまり知らなかったので、調べてみると「不変なコレクション」とのこと。\u003cbr\u003e\n\u003ccode\u003eReadOnlyCollection\u003c/code\u003eとどう違うんだ…？と思ったので、それぞれ違いを整理しました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ireadonlylisttインターフェイス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ireadonlylistt%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイス\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eは、ListのReadOnlyなインターフェイスです。\u003c/p\u003e\n\n\u003cp\u003e定義は次のようになっています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIReadOnlyList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;,\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIReadOnlyCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eが継承\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"ちなみにインターフェイスがインターフェイスを「継承」しているっていうんですかね？それとも「実装」？意味合い的には「継承」が正しい気もしますが。\"\u003e1\u003c/a\u003e\u003c/sup\u003eしている\u003ccode\u003eIReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eの定義はこうです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIReadOnlyCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;,\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eつまり、\u003cstrong\u003eインデクサによる値の取得\u003c/strong\u003eと\u003cstrong\u003e要素数の取得\u003c/strong\u003e、それから\u003cstrong\u003e\u003ccode\u003eIEnumerator\u0026lt;T\u0026gt;\u003c/code\u003eの取得（foreachで回す）\u003c/strong\u003eだけができるコレクションというわけですね。\u003cbr\u003e\n\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eを\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eで渡すと、コレクション変更系メソッドが呼べなくなるので安全ですよ、というインターフェイスです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"問題点キャストされるとreadonlyじゃなくなる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%95%8F%E9%A1%8C%E7%82%B9%E3%82%AD%E3%83%A3%E3%82%B9%E3%83%88%E3%81%95%E3%82%8C%E3%82%8B%E3%81%A8readonly%E3%81%98%E3%82%83%E3%81%AA%E3%81%8F%E3%81%AA%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e問題点：キャストされるとReadOnlyじゃなくなる\u003c/h3\u003e\n\n\u003cp\u003eさて、ここからが本題で、冒頭で記述した「\u003cstrong\u003eキャストされたら普通に変更されちゃう問題\u003c/strong\u003e」についてです。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eは\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eのインターフェイス\u003csup id=\"fnref2\"\u003e\u003ca href=\"#fn2\" title=\"もちろんList\u0026lt;T\u0026gt;だけじゃなくて色々なクラスに実装されていますが代表として挙げました\"\u003e2\u003c/a\u003e\u003c/sup\u003eなので、\u003cstrong\u003e\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eにキャストされてしまえば普通に変更できちゃう\u003c/strong\u003eという問題です。\u003c/p\u003e\n\n\u003cp\u003e以下の例をご覧ください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eIReadOnlyList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eireadonlylist\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eReadOnlyBreaker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBreak\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eireadonlylist\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eireadonlylist\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eReadOnlyBreaker\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//IReadOnlyListで受け取っても…\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eBreak\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIReadOnlyList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003erolist\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//キャストしてしまえばAddできる\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erolist\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eIList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;).\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e1,2,3で\u003ccode\u003eList\u0026lt;int\u0026gt;\u003c/code\u003eを初期化して、\u003ccode\u003eIReadOnlyList\u0026lt;int\u0026gt;\u003c/code\u003eにして渡しても、受け取った側が勝手に\u003ccode\u003eIList\u0026lt;int\u0026gt;\u003c/code\u003eにキャストすればAddできてしまうという例です。\u003c/p\u003e\n\n\u003cp\u003e実行結果がこちら。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e1\n2\n3\n100\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eIReadOnlyList\u0026lt;int\u0026gt;\u003c/code\u003eで渡したのに、100がAddされてしまっています。\u003c/p\u003e\n\n\u003cp\u003eこれは、\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eがインターフェイスであるがゆえ、必ず具象クラスが存在するので、もともとの具象クラス側で変更を許可しているならば無理やり変更できるという、悲しい問題です。\u003c/p\u003e\n\n\u003cp\u003eしかし、\u003cstrong\u003e普通のプログラマーであれば「\u003ccode\u003eIReadOnlyList\u003c/code\u003e」と書いてあれば、「あ、このコレクションは変更してはいけないんだな」と理解できる\u003c/strong\u003eため、わざわざキャストしてまで無理やり変更されることは少ないと思います。\u003cbr\u003e\nしたがって、決して\u003cstrong\u003e\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eでは危険だ！と主張しているわけではありません\u003c/strong\u003eのでご留意ください。\u003c/p\u003e\n\n\u003cp\u003eしかしながら、汎用的なライブラリとして公開するなど、どんな使い方をされるかわからない場合や、キャストによる変更される危険もなくしたいと言った場合は、次に紹介する\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eクラスまたは\u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003eクラスを使用すれば、この問題を解決することができます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"readonlycollectiontクラス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#readonlycollectiont%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eクラス\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eクラスは、\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eをラップして読み取り専用なメンバのみ外部に公開するクラスです。\u003c/p\u003e\n\n\u003cp\u003eこのクラスを生成するには\u003ccode\u003eAsReadOnly()\u003c/code\u003eメソッドを利用するか、\u003ccode\u003eIList\u0026lt;T\u0026gt;\u003c/code\u003eを引数にとったコンストラクタを利用します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//AsReadOnly()による生成\u003c/span\u003e\n\u003cspan class=\"n\"\u003eReadOnlyCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereadonlyCollection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAsReadOnly\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//コンストラクタによる生成\u003c/span\u003e\n\u003cspan class=\"n\"\u003eReadOnlyCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereadonlyCollection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eReadOnlyCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ireadonlylisttとの違い\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ireadonlylistt%E3%81%A8%E3%81%AE%E9%81%95%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eとの違い\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eはインターフェイスで、\u003cstrong\u003e実体としてはあくまでも具象クラスを参照している\u003c/strong\u003eため、具象クラスにキャストされれば\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eが変更される危険があります。\u003cbr\u003e\nところが、この\u003cstrong\u003e\u003ccode\u003eReadOnlyCollecion\u0026lt;T\u0026gt;\u003c/code\u003eはインターフェイスではなく、元の\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eとはまた別のクラス\u003c/strong\u003eなので、キャストされる心配がありません。\u003c/p\u003e\n\n\u003cp\u003e具体的には、元となる\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eの参照を内部で持ち、読み取り専用のメンバのみを外部に公開しています。\u003cbr\u003e\nそのため、内部の\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eは完全にプロテクトされており、変更される危険がないのです。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"図による解説\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9B%B3%E3%81%AB%E3%82%88%E3%82%8B%E8%A7%A3%E8%AA%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e図による解説\u003c/h4\u003e\n\n\u003cp\u003eちょっと分かりづらいかと思いますので図を用意しました。\u003cbr\u003e\n\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eの場合は次のようになります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/db18d3468bb9382fab723b57f28f7f019160ac95/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f31393435383832372d653266362d313135392d613230662d6134373433613466393766372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F19458827-e2f6-1159-a20f-a4743a4f97f7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f6bb68c6379782816db5612b8c3a8004\" alt=\"IReadOnlyList.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/19458827-e2f6-1159-a20f-a4743a4f97f7.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F19458827-e2f6-1159-a20f-a4743a4f97f7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f3f0e78434d589058c87a490e581f169 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eは\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eのうち読み取り専用のメンバのみを提供するインターフェイスです。\u003cbr\u003e\nしかし、あくまでも\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eに実装されたインターフェイスなので、キャストされれば\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eに直接アクセスされます。\u003c/p\u003e\n\n\u003cp\u003e対して、\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eは次のようになります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e0c9ee865b3b8dd19fbf8c79d72d488a824a6ae8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f37313530386133342d633238312d316265392d396366302d3561393339663031653739612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F71508a34-c281-1be9-9cf0-5a939f01e79a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3e15b162f87ca3d0b9395a09e46f4360\" alt=\"ReadOnlyCollection.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/71508a34-c281-1be9-9cf0-5a939f01e79a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2F71508a34-c281-1be9-9cf0-5a939f01e79a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d822bccafb1705fcbdc3eb5d0bbc161a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eは、インターフェイスではなく実体があるクラスで、内部に元となる\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eの参照を持っています。\u003cbr\u003e\n\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eは\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eのメンバのうち読み取り専用メンバのみを外部に公開するため、\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003e自体は安全が保たれます。\u003cbr\u003e\nさらに、外部からアクセスされる\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eは内部の\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eとは独立した存在なので、キャストによって内部の\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eが変更される危険はありません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"immutablelisttクラス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#immutablelistt%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003eクラス\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003eクラスも、\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eと同様に、元となる\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eを内部にラップします。\u003c/p\u003e\n\n\u003cp\u003eこのクラスを生成するには、\u003ccode\u003eToImmutable()\u003c/code\u003eメソッドを利用するか、\u003ccode\u003eImmutableList.CreateRange(IEnumerable\u0026lt;T\u0026gt;)\u003c/code\u003eファクトリメソッドを利用します。コンストラクタによる生成はできません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//ToImmutable()による生成\u003c/span\u003e\n\u003cspan class=\"n\"\u003eImmutableList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eimmutableList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToImmutable\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//ImmutableList.CreateRangeによる生成\u003c/span\u003e\n\u003cspan class=\"n\"\u003eImmutableList\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eimmutableList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eImmutableList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"参照ではなくコピーをラップする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E7%85%A7%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8F%E3%82%B3%E3%83%94%E3%83%BC%E3%82%92%E3%83%A9%E3%83%83%E3%83%97%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参照ではなくコピーをラップする\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eとの違いは、\u003cstrong\u003e参照ではなくコピーをラップする\u003c/strong\u003eことです。\u003cbr\u003e\n参照ではなくコピーをラップするため、\u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003eを生成したあとに元となるコレクションに変更を加えても、\u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003eの読み出し値は変わりません。\u003c/p\u003e\n\n\u003cp\u003e以下のコードで、\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eと\u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003eを両方生成したあとに、元のコレクションに変更を加えて、動作の違いを確認してみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eReadOnlyCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereadonlyCollection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAsReadOnly\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eImmutableList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eimmutableList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToImmutableList\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//ReadOnlyCollection, ImmutableListを生成したあとに元となるコレクションに変更を加える\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ReadOnlyCollection:\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ereadonlyCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ImmutableList:\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eimmutableList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eReadOnlyCollection:\n1\n2\n3\n100\nImmutableList:\n1\n2\n3\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eのほうは、インスタンス生成後に元となるコレクションに変更が加えられた場合でも、その変更内容が反映されています。元となるコレクションの参照を内部にラップしているからですね。\u003cbr\u003e\n対して、\u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003eのほうは、インスタンス生成後の変更内容が反映されていません。これは、元となるコレクションのコピーを内部にラップしているためです。\u003c/p\u003e\n\n\u003cp\u003e言うならば、\u003cstrong\u003eコレクションのスナップショットを撮影しているような感覚\u003c/strong\u003eだと思います。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"変更系メソッドが利用可能\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%A4%89%E6%9B%B4%E7%B3%BB%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%8C%E5%88%A9%E7%94%A8%E5%8F%AF%E8%83%BD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e変更系メソッドが利用可能\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003eの場合は\u003cstrong\u003e変更系メソッドが呼び出し可能\u003c/strong\u003eです。\u003cbr\u003e\n変更系メソッドを呼び出した場合、内部にラップされた元となる\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eのコピーがまた生成され、そのコピーに対して変更内容が適用されて、メソッドの戻り値として返されます。\u003c/p\u003e\n\n\u003cp\u003eしたがって、変更系メソッドを呼び出した場合でも、元となるコレクションはもちろん、内部にラップしたコレクションにも変更が加えられることはありません。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"図による解説-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9B%B3%E3%81%AB%E3%82%88%E3%82%8B%E8%A7%A3%E8%AA%AC-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e図による解説\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003eの挙動を図で表すと次のようになります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/aac85ed168b892a7b19fa9d9acd8698dc5c8cac0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3639373833302f63316361363434622d373166342d633139302d666662322d3661396466353635623766352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Fc1ca644b-71f4-c190-ffb2-6a9df565b7f5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=eb6becaf8f74037137563a8793cf6a18\" alt=\"ImmutableList.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697830/c1ca644b-71f4-c190-ffb2-6a9df565b7f5.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F697830%2Fc1ca644b-71f4-c190-ffb2-6a9df565b7f5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=09aec6b3261b092d25da20469284d000 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eと同様、キャストによる変更の危険性はなくなっています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003e, \u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003e, \u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003eの違いをまとめると次のようになります。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e\u003c/th\u003e\n\u003cth\u003e\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/th\u003e\n\u003cth\u003e\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/th\u003e\n\u003cth\u003e\u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e種類\u003c/td\u003e\n\u003ctd\u003eインターフェイス\u003c/td\u003e\n\u003ctd\u003eクラス\u003c/td\u003e\n\u003ctd\u003eクラス\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e利用方法\u003c/td\u003e\n\u003ctd\u003eそのまま渡せばOK\u003c/td\u003e\n\u003ctd\u003e\n\u003ccode\u003eAsReadOnly()\u003c/code\u003e\u003cbr\u003eまたは\u003cbr\u003e\u003ccode\u003enew ReadOnlyCollection(IList\u0026lt;T\u0026gt;)\u003c/code\u003e\n\u003c/td\u003e\n\u003ctd\u003e\n\u003ccode\u003eToImmutable()\u003c/code\u003e\u003cbr\u003eまたは\u003cbr\u003e\u003ccode\u003eImmutableList.CreateRange(IEnumerable\u0026lt;T\u0026gt;)\u003c/code\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e元コレクション\u003c/td\u003e\n\u003ctd\u003e直接参照している\u003c/td\u003e\n\u003ctd\u003e参照がラップされる\u003c/td\u003e\n\u003ctd\u003eコピーがラップされる\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e変更系メソッド\u003c/td\u003e\n\u003ctd\u003e\n\u003cstrong\u003e利用不能\u003c/strong\u003e\u003cbr\u003e（ただしキャストで利用可能）\u003c/td\u003e\n\u003ctd\u003e\u003cstrong\u003e利用不能\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e\n\u003cstrong\u003e利用可能\u003c/strong\u003e\u003cbr\u003eただしコピーに適用され、ソースには影響しない\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e利用場面\u003c/td\u003e\n\u003ctd\u003e「この\u003ccode\u003eList\u003c/code\u003eは変更してほしくない」という意思を伝えたい\u003c/td\u003e\n\u003ctd\u003e\n\u003ccode\u003eList\u003c/code\u003eを絶対に変更できない形で渡したい\u003c/td\u003e\n\u003ctd\u003eコレクションのスナップショットを渡したい\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"メソッド名から伝わるニュアンス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E5%90%8D%E3%81%8B%E3%82%89%E4%BC%9D%E3%82%8F%E3%82%8B%E3%83%8B%E3%83%A5%E3%82%A2%E3%83%B3%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメソッド名から伝わるニュアンス\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eAsReadOnly()\u003c/code\u003eと\u003ccode\u003eToImmutable()\u003c/code\u003eのメソッド名をこうやって比べてみると、確かにAsの方は「オブジェクト参照はそのままで、型を変化させる」といったニュアンスが伝わりますし、Toの方は「オブジェクトを元にして別のインスンタンスを生成する」といったニュアンスが伝わります。細かなメソッド名の違いも、その挙動を正確に表現しているようです。メソッド名はきちんと考えて付けなければならないと感じました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"おまけilisttインターフェイスの実装について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91ilistt%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおまけ：\u003ccode\u003eIList\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスの実装について\u003c/h2\u003e\n\n\u003cp\u003e実は、\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eクラスと\u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003eクラスは、共に\u003ccode\u003eIList\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスを実装しています。\u003cbr\u003e\n\u003ccode\u003eIList\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスを実装しているということは、\u003ccode\u003eAdd\u003c/code\u003eや\u003ccode\u003eRemove\u003c/code\u003eができるはずですよね？\u003c/p\u003e\n\n\u003cp\u003eすごく疑問に思い調べてみると、\u003cstrong\u003eインターフェイスの明示的な実装\u003c/strong\u003eというものを使っているらしいです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"インターフェイスの明示的な実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%81%AE%E6%98%8E%E7%A4%BA%E7%9A%84%E3%81%AA%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eインターフェイスの明示的な実装\u003c/h3\u003e\n\n\u003cp\u003e詳しくは\u003ca href=\"https://ufcpp.net/study/csharp/oo_interface.html?p=4\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこのサイト\u003c/a\u003eを参考にしてほしいのですが、インターフェイスのメンバにあるけども、\u003ccode\u003epublic\u003c/code\u003eにしたくないメンバを隠すために使われることがあるようです。\u003c/p\u003e\n\n\u003cp\u003eインターフェイスの明示的な実装を行うには下記のよう、\u003ccode\u003eインターフェイス名.メンバ名\u003c/code\u003eでインターフェイスメンバを実装します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eITestInterface\u003c/span\u003e \n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMethodA\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMethodB\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTestClass\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eITestInterface\u003c/span\u003e \n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//普通のインターフェイス実装\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMethodA\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//明示的なインターフェイスの実装\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eITestInterface\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMethodB\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e    \n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのようにすると、\u003ccode\u003eMethodB\u003c/code\u003eは\u003ccode\u003eTestClass\u003c/code\u003eクラスのインスタンスから呼ぶことはできなくなり、メンバを隠すことができます。\u003c/p\u003e\n\n\u003cp\u003eしかし、インターフェイスを実装している以上、メンバは呼べなければなりません。\u003cbr\u003e\nではどうすれば呼べるかと言うと、\u003ccode\u003eインターフェイス名.メンバ名\u003c/code\u003eで呼ぶことができます。\u003cbr\u003e\n実装しているクラスのインスタンスから直接呼び出すことはできないけども、インターフェイス経由ならば呼び出せるようです。\u003c/p\u003e\n\n\u003cp\u003e「インターフェイスの明示的な実装」、使う場面にはあまり出くわしたことがないですが、まだ知らないことがたくさんあると勉強になりました。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"呼び出すと必ずnotsupportedexceptionがスローされる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E3%81%A8%E5%BF%85%E3%81%9Anotsupportedexception%E3%81%8C%E3%82%B9%E3%83%AD%E3%83%BC%E3%81%95%E3%82%8C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e呼び出すと必ず\u003ccode\u003eNotSupportedException\u003c/code\u003eがスローされる\u003c/h3\u003e\n\n\u003cp\u003eでは、\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eや\u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003eでも、\u003ccode\u003eIList\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイス経由であれば\u003ccode\u003eAdd\u003c/code\u003eや\u003ccode\u003eRemove\u003c/code\u003eができるのかといえば、そうではないようです。\u003c/p\u003e\n\n\u003cp\u003e両者のクラスは、\u003cstrong\u003e\u003ccode\u003eIList\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイス経由で変更系メソッドを呼び出すと、必ず\u003ccode\u003eNotSupportedException\u003c/code\u003eがスローされる\u003c/strong\u003eようです。\u003c/p\u003e\n\n\u003cp\u003eこの実装って正しいんですかね…？そこまでして\u003ccode\u003eIList\u0026lt;T\u0026gt;\u003c/code\u003eインターフェイスを実装する理由は…？\u003cbr\u003e\nまぁ、マイクロソフトのやることなので正しいのでしょう（適当）\u003c/p\u003e\n\n\u003cp\u003e誰か\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eや\u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003eが\u003ccode\u003eIList\u0026lt;T\u0026gt;\u003c/code\u003eを実装してる理由知っていたら教えて下さい。\u003c/p\u003e\n\n\u003cp\u003e以上、長くなってしまいましたが\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eと\u003ccode\u003eReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eと\u003ccode\u003eImmutableList\u0026lt;T\u0026gt;\u003c/code\u003eの違いでした。\u003c/p\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003eちなみにインターフェイスがインターフェイスを「継承」しているっていうんですかね？それとも「実装」？意味合い的には「継承」が正しい気もしますが。 \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn2\"\u003e\n\u003cp\u003eもちろん\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eだけじゃなくて色々なクラスに実装されていますが代表として挙げました \u003ca href=\"#fnref2\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","createdAt":"2020-09-14T14:21:20Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"/NdS9r1KmSAV848VoHkzwSBhfFBeBkwn4Q==--n48RSikrxFpX4NO8--mSWzUtPdj8bftXrIsshK5Q==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":false,"lastModifiedAt":"2020-09-14T14:21:20Z","likesCount":47,"linkUrl":"https://qiita.com/yutorisan/items/3f5fdb1495be03e56d3c","organization":null,"originalId":1300875,"stockedCount":44,"title":"【C#】IReadOnlyList\u003cT\u003eとReadOnlyCollection\u003cT\u003eとImmutableList\u003cT\u003eの違い","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ireadonlylistt%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9\"\u003eIReadOnlyList\u0026lt;T\u0026gt;インターフェイス\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%95%8F%E9%A1%8C%E7%82%B9%E3%82%AD%E3%83%A3%E3%82%B9%E3%83%88%E3%81%95%E3%82%8C%E3%82%8B%E3%81%A8readonly%E3%81%98%E3%82%83%E3%81%AA%E3%81%8F%E3%81%AA%E3%82%8B\"\u003e問題点：キャストされるとReadOnlyじゃなくなる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#readonlycollectiont%E3%82%AF%E3%83%A9%E3%82%B9\"\u003eReadOnlyCollection\u0026lt;T\u0026gt;クラス\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#ireadonlylistt%E3%81%A8%E3%81%AE%E9%81%95%E3%81%84\"\u003eIReadOnlyList\u0026lt;T\u0026gt;との違い\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%9B%B3%E3%81%AB%E3%82%88%E3%82%8B%E8%A7%A3%E8%AA%AC\"\u003e図による解説\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#immutablelistt%E3%82%AF%E3%83%A9%E3%82%B9\"\u003eImmutableList\u0026lt;T\u0026gt;クラス\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E7%85%A7%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8F%E3%82%B3%E3%83%94%E3%83%BC%E3%82%92%E3%83%A9%E3%83%83%E3%83%97%E3%81%99%E3%82%8B\"\u003e参照ではなくコピーをラップする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%A4%89%E6%9B%B4%E7%B3%BB%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%8C%E5%88%A9%E7%94%A8%E5%8F%AF%E8%83%BD\"\u003e変更系メソッドが利用可能\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%9B%B3%E3%81%AB%E3%82%88%E3%82%8B%E8%A7%A3%E8%AA%AC-1\"\u003e図による解説\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E5%90%8D%E3%81%8B%E3%82%89%E4%BC%9D%E3%82%8F%E3%82%8B%E3%83%8B%E3%83%A5%E3%82%A2%E3%83%B3%E3%82%B9\"\u003eメソッド名から伝わるニュアンス\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91ilistt%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003eおまけ：IList\u0026lt;T\u0026gt;インターフェイスの実装について\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%81%AE%E6%98%8E%E7%A4%BA%E7%9A%84%E3%81%AA%E5%AE%9F%E8%A3%85\"\u003eインターフェイスの明示的な実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E3%81%A8%E5%BF%85%E3%81%9Anotsupportedexception%E3%81%8C%E3%82%B9%E3%83%AD%E3%83%BC%E3%81%95%E3%82%8C%E3%82%8B\"\u003e呼び出すと必ずNotSupportedExceptionがスローされる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":5604,"uuid":"3f5fdb1495be03e56d3c","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"JViIev6aLpeIfnYexT0jhwCndzil--m1bn3DE43q1xFU5k--MuIPb8sSQKLI3uLCq9Q+WA==","originalId":697830,"description":"C#が好きです","facebookUrl":null,"githubUrl":"https://github.com/yutorisan","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://pbs.twimg.com/profile_images/1274400166120812544/DAWcpHec_bigger.jpg","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F1274400166120812544%2FDAWcpHec_bigger.jpg?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=b517115d0e848c54aa4fe1fc93bfa0ff","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F1274400166120812544%2FDAWcpHec_bigger.jpg?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=754be610f489085be0fdfc48de5585a9","urlName":"yutorisan","websiteUrl":"","twitterUrl":"https://twitter.com/yutorisan19","twitterUrlName":"yutorisan19","revealedOrganizations":{"edges":[{"node":{"encryptedId":"WdC1auHptZgh/lIfoZw3U6cus3VVYpHUd5o=--lZzNZhvb2QilYmM6--p9sujh2TvRVXC0Ej1fhRSw==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"Unityゲーム開発者ギルド","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","urlName":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。","url":"https://unity-game-dev-guild.github.io/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":".NET","urlName":".net"},{"name":"初心者","urlName":"%e5%88%9d%e5%bf%83%e8%80%85"}],"followingLikers":{"edges":[]},"comments":{"totalCount":14}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

オープンソースのライブラリ「OpenPop.net」を使用して全メールを取得してみます。コードサンプルでは下記の項目を取得しています。
- 全メールのUIDリスト
- UID
- 差出人メールアドレス
- 件名
- 本文差出人メールアドレスと本文取得の箇所でnullのチェックをいれているのは、
NullReferenceExceptionが発生する可能性があるためです。
メール情報を一通り(4項目)取得したらちゃんと取得に成功しているかチェックをいれる処理を必ずしてください。
(fromAddressやbodyが空文字のケースがありますので・・・)全メールのUIDをデータベースに保存して再度メール取得した際に
データベースと比較をしてデータベースに該当UIDが存在しなければ新着として検出することができます。
(フラグや未開封などを使った方法もあるみたいです)メールホストとメールユーザー、メールパスワードには対象メールサーバー情報を記述してください。
もちろんNuGetで「OpenPop.net」のインストールも忘れずに・・・OpenPop.Common.Logging.DefaultLogger.SetLogを使用してロガークラスを上書きします。まずは下記の様に独自ロガークラスを作成します。
デバッグ出力はコメントアウトして出力させないようにします。メール受信を行うクラスの関数内で下記のメソッドを実行



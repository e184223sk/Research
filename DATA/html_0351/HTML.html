<!DOCTYPE html><html><head><meta charset="utf-8" /><title>【C#】ソースジェネレーターを駆使してAtCoderに提出可能なファイルを出力する競技プログラミングライブラリ - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/naminodarie/items/bd15dfeedd48925fda54" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="xnfWkFpasvhN/xfAHYBl3vo/HMSuYHIpS7WNrBm9hvHZ6s8z1k4IsfFhRsm/4s8rmiA8gH13e48ZBA7gY2/F9A==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@kzlogos" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="【C#】ソースジェネレーターを駆使してAtCoderに提出可能なファイルを出力する競技プログラミングライブラリ - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRUXlQamdKSGpncjNqZzd6amdybmpncmpqZ3Fmamc0M2pnNnpqZzd6amdyX2pnN3pqZ3BMcHA0Ymt2Yl9qZ1pmamdhWkJkRU52WkdWeTQ0R3I1by1RNVllNjVZLXY2SU85NDRHcTQ0T1Y0NEtoNDRLazQ0T3I0NEtTNVllNjVZcWI0NEdaNDRLTDU2dTI1b3FBNDRPWDQ0T3Q0NEt3NDRPcDQ0T2Y0NE96NDRLdzQ0T3A0NEtrNDRPVzQ0T3A0NE9xJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTJjMTUxYTUwOWMzODliYzExNzdiYjIzZjVhODc3ODA3&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzVoYldsdWIyUmhjbWxsJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9Njc0NzYyZmEwYTg4NDg5ODA3YTYxMzQ0ZDE3ODk3MWY&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=83c6f4335420837ea0634ac5885d4aad"><meta property="og:description" content="本記事はC# Advent Calendar 2020の5日目の記事です。

競技プログラミング用ライブラリについての記事ですが、競技プログラミングの記事ではなくソースジェネレーター開発記事です。
競技プログラミングのテクニックや知識..."><meta content="https://qiita.com/naminodarie/items/bd15dfeedd48925fda54" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,AtCoder,競技プログラミング,ソースジェネレーター,C#9.0" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-a3427e74-0000-4390-ac2f-9a405ba30c8b"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fnaminodarie%2Fitems%2Fbd15dfeedd48925fda54">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fnaminodarie%2Fitems%2Fbd15dfeedd48925fda54">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-a3427e74-0000-4390-ac2f-9a405ba30c8b">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-12-02T18:32:21.000+09:00","dateModified":"2020-12-05T07:00:43.000+09:00","headline":"【C#】ソースジェネレーターを駆使してAtCoderに提出可能なファイルを出力する競技プログラミングライブラリ","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRUXlQamdKSGpncjNqZzd6amdybmpncmpqZ3Fmamc0M2pnNnpqZzd6amdyX2pnN3pqZ3BMcHA0Ymt2Yl9qZ1pmamdhWkJkRU52WkdWeTQ0R3I1by1RNVllNjVZLXY2SU85NDRHcTQ0T1Y0NEtoNDRLazQ0T3I0NEtTNVllNjVZcWI0NEdaNDRLTDU2dTI1b3FBNDRPWDQ0T3Q0NEt3NDRPcDQ0T2Y0NE96NDRLdzQ0T3A0NEtrNDRPVzQ0T3A0NE9xJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTJjMTUxYTUwOWMzODliYzExNzdiYjIzZjVhODc3ODA3\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzVoYldsdWIyUmhjbWxsJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9Njc0NzYyZmEwYTg4NDg5ODA3YTYxMzQ0ZDE3ODk3MWY\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=83c6f4335420837ea0634ac5885d4aad","mainEntityOfPage":"https://qiita.com/naminodarie/items/bd15dfeedd48925fda54","author":{"@type":"Person","address":"","email":null,"identifier":"naminodarie","name":"naminodarie","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars2.githubusercontent.com%2Fu%2F32071278%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=f21ea7bbb9e1873e743d0b4f3ea1312c","url":"https://qiita.com/naminodarie","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"naminodarie","type":"items","id":"bd15dfeedd48925fda54"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"naminodarie","type":"items","id":"bd15dfeedd48925fda54"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"naminodarie","type":"items","id":"bd15dfeedd48925fda54"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/naminodarie/items/bd15dfeedd48925fda54","location":"/naminodarie/items/bd15dfeedd48925fda54","scheme":"https","host":"qiita.com","port":null,"pathname":"/naminodarie/items/bd15dfeedd48925fda54","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"9cxIIydw8HzMuj0AbMsFJmw5ljW/mf6t0jzYIk8yxDHqUVGAq2RKNXAkbAnOqa/TDCa2cWyO9wuAjVtuNeCHNA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-e5579689-0373-417a-9748-c0ad8eb5ca23"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/naminodarie/items/bd15dfeedd48925fda54/likers" class="css-1iupg5d">5</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">3</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/bd15dfeedd48925fda54/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/naminodarie/items/bd15dfeedd48925fda54/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/naminodarie/items/bd15dfeedd48925fda54/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/naminodarie/items/bd15dfeedd48925fda54/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/naminodarie/items/bd15dfeedd48925fda54.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><span><a href="/advent-calendar/2020/csharplang" class="it-AdcalRibbon_title">C#<!-- --> Advent Calendar<!-- --> <!-- -->2020</a>Day 5</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/naminodarie"><img class="css-100alwu eyfquo10" src="https://avatars2.githubusercontent.com/u/32071278?v=4" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/naminodarie" class="css-10ougpm">@<!-- -->naminodarie</a><div class="css-1ay9vb9"><span><meta content="2020-12-02T09:32:21Z"/><time dateTime="2020-12-04T22:00:43Z" class="css-m19uds">updated at 2020-12-04</time></span></div></div></div></div></div><h1 class="css-cgzq40">【C#】ソースジェネレーターを駆使してAtCoderに提出可能なファイルを出力する競技プログラミングライブラリ</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/atcoder" class="css-4czcte">AtCoder</a><a href="/tags/%e7%ab%b6%e6%8a%80%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0" class="css-4czcte">競技プログラミング</a><a href="/tags/%e3%82%bd%e3%83%bc%e3%82%b9%e3%82%b8%e3%82%a7%e3%83%8d%e3%83%ac%e3%83%bc%e3%82%bf%e3%83%bc" class="css-4czcte">ソースジェネレーター</a><a href="/tags/c%239.0" class="css-4czcte">C#9.0</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>本記事は<a href="https://qiita.com/advent-calendar/2020/csharplang">C# Advent Calendar 2020</a>の5日目の記事です。</p>

<p>競技プログラミング用ライブラリについての記事ですが、競技プログラミングの記事ではなく<strong>ソースジェネレーター開発記事</strong>です。<br>
競技プログラミングのテクニックや知識については記述していません。あらかじめご了承ください。</p>

<h1>
<span id="従来の競技プログラミング用ライブラリの課題" class="fragment"></span><a href="#%E5%BE%93%E6%9D%A5%E3%81%AE%E7%AB%B6%E6%8A%80%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E7%94%A8%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E8%AA%B2%E9%A1%8C"><i class="fa fa-link"></i></a>従来の競技プログラミング用ライブラリの課題</h1>

<p>通常のC#開発では、NuGetからダウンロードするだけでライブラリを扱うことができます。</p>

<p>しかし、単一のソースコードを提出する競技プログラミングにおいては、ライブラリへの参照を提出できないため、ライブラリのソースコードを提出ファイルにコピペする必要があります。</p>

<p>これではNuGet配布もできませんし、依存関係も含めてコピペが必要となり非常に扱いづらくなってしまいます。</p>

<p>それを解決するためライブラリ <a href="https://github.com/naminodarie/SourceExpander" rel="nofollow noopener" target="_blank">SourceExpander</a> を作成しました。</p>

<h1>
<span id="ac-library-csharp" class="fragment"></span><a href="#ac-library-csharp"><i class="fa fa-link"></i></a><a href="https://github.com/naminodarie/ac-library-csharp" rel="nofollow noopener" target="_blank">ac-library-csharp</a>
</h1>

<p><a href="https://atcoder.jp/" rel="nofollow noopener" target="_blank">AtCoder</a>で使用できるC++用のライブラリ <a href="https://github.com/atcoder/ac-library/" rel="nofollow noopener" target="_blank">ac-library</a> の移植プロジェクトの<a href="https://github.com/key-moon/ac-library-cs" rel="nofollow noopener" target="_blank">ac-library-cs</a>からフォークして</p>

<p><strong><a href="https://github.com/naminodarie/ac-library-csharp" rel="nofollow noopener" target="_blank">ac-library-csharp</a></strong></p>

<p>を作成しました。</p>

<p>このライブラリでは、<a href="https://github.com/naminodarie/SourceExpander" rel="nofollow noopener" target="_blank">SourceExpander</a> を使用することで下記の動作を実現しています。</p>

<h2>
<span id="成果物" class="fragment"></span><a href="#%E6%88%90%E6%9E%9C%E7%89%A9"><i class="fa fa-link"></i></a>成果物</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>Install-Package SourceExpander
Install-Package ac-library-csharp
</code></pre></div></div>

<p>でNuGetからインストールして、</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">Program.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">AtCoder</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">SourceExpander</span><span class="p">.</span><span class="n">Expander</span><span class="p">.</span><span class="nf">Expand</span><span class="p">();</span>

        <span class="c1">// https://atcoder.jp/contests/practice2/tasks/practice2_a</span>
        <span class="kt">var</span> <span class="n">line</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">().</span><span class="nf">Split</span><span class="p">(</span><span class="sc">' '</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">n</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
        <span class="kt">var</span> <span class="n">Q</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>

        <span class="kt">var</span> <span class="n">dsu</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DSU</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">Q</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">line</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">().</span><span class="nf">Split</span><span class="p">(</span><span class="sc">' '</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">t</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
            <span class="kt">int</span> <span class="n">u</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
            <span class="kt">int</span> <span class="n">v</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="m">2</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">dsu</span><span class="p">.</span><span class="nf">Merge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">dsu</span><span class="p">.</span><span class="nf">Same</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="p">?</span> <span class="m">1</span> <span class="p">:</span> <span class="m">0</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>を実行すると、</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">Combined.csx</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">AtCoder</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">AtCoder.Internal</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Diagnostics</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">SourceExpander</span><span class="p">.</span><span class="n">Expander</span><span class="p">.</span><span class="nf">Expand</span><span class="p">();</span>

        <span class="c1">// https://atcoder.jp/contests/practice2/tasks/practice2_a</span>
        <span class="kt">var</span> <span class="n">line</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">().</span><span class="nf">Split</span><span class="p">(</span><span class="sc">' '</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">n</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
        <span class="kt">var</span> <span class="n">Q</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>

        <span class="kt">var</span> <span class="n">dsu</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DSU</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">Q</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">line</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">().</span><span class="nf">Split</span><span class="p">(</span><span class="sc">' '</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">t</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
            <span class="kt">int</span> <span class="n">u</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
            <span class="kt">int</span> <span class="n">v</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="m">2</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">dsu</span><span class="p">.</span><span class="nf">Merge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">dsu</span><span class="p">.</span><span class="nf">Same</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="p">?</span> <span class="m">1</span> <span class="p">:</span> <span class="m">0</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">#region Expanded
</span><span class="k">namespace</span> <span class="nn">AtCoder</span> <span class="p">{</span> <span class="k">public</span> <span class="k">class</span> <span class="nc">DSU</span> <span class="p">{</span> <span class="k">internal</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">_n</span><span class="p">;</span> <span class="k">internal</span> <span class="k">readonly</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">_parentOrSize</span><span class="p">;</span> <span class="k">public</span> <span class="nf">DSU</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="n">_n</span> <span class="p">=</span> <span class="n">n</span><span class="p">;</span> <span class="n">_parentOrSize</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">n</span><span class="p">];</span> <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">_parentOrSize</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> <span class="n">_parentOrSize</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span> <span class="p">}</span> <span class="k">public</span> <span class="kt">int</span> <span class="nf">Merge</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="n">DebugUtil</span><span class="p">.</span><span class="nf">Assert</span><span class="p">(</span><span class="m">0</span> <span class="p">&lt;=</span> <span class="n">a</span> <span class="p">&amp;&amp;</span> <span class="n">a</span> <span class="p">&lt;</span> <span class="n">_n</span><span class="p">);</span> <span class="n">DebugUtil</span><span class="p">.</span><span class="nf">Assert</span><span class="p">(</span><span class="m">0</span> <span class="p">&lt;=</span> <span class="n">b</span> <span class="p">&amp;&amp;</span> <span class="n">b</span> <span class="p">&lt;</span> <span class="n">_n</span><span class="p">);</span> <span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="nf">Leader</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">y</span> <span class="p">=</span> <span class="nf">Leader</span><span class="p">(</span><span class="n">b</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="p">==</span> <span class="n">y</span><span class="p">)</span> <span class="k">return</span> <span class="n">x</span><span class="p">;</span> <span class="k">if</span> <span class="p">(-</span><span class="n">_parentOrSize</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="p">&lt;</span> <span class="p">-</span><span class="n">_parentOrSize</span><span class="p">[</span><span class="n">y</span><span class="p">])</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span> <span class="n">_parentOrSize</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="p">+=</span> <span class="n">_parentOrSize</span><span class="p">[</span><span class="n">y</span><span class="p">];</span> <span class="n">_parentOrSize</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="p">=</span> <span class="n">x</span><span class="p">;</span> <span class="k">return</span> <span class="n">x</span><span class="p">;</span> <span class="p">}</span> <span class="k">public</span> <span class="kt">bool</span> <span class="nf">Same</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="n">DebugUtil</span><span class="p">.</span><span class="nf">Assert</span><span class="p">(</span><span class="m">0</span> <span class="p">&lt;=</span> <span class="n">a</span> <span class="p">&amp;&amp;</span> <span class="n">a</span> <span class="p">&lt;</span> <span class="n">_n</span><span class="p">);</span> <span class="n">DebugUtil</span><span class="p">.</span><span class="nf">Assert</span><span class="p">(</span><span class="m">0</span> <span class="p">&lt;=</span> <span class="n">b</span> <span class="p">&amp;&amp;</span> <span class="n">b</span> <span class="p">&lt;</span> <span class="n">_n</span><span class="p">);</span> <span class="k">return</span> <span class="nf">Leader</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="p">==</span> <span class="nf">Leader</span><span class="p">(</span><span class="n">b</span><span class="p">);</span> <span class="p">}</span> <span class="k">public</span> <span class="kt">int</span> <span class="nf">Leader</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">_parentOrSize</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">a</span><span class="p">;</span> <span class="k">while</span> <span class="p">(</span><span class="m">0</span> <span class="p">&lt;=</span> <span class="n">_parentOrSize</span><span class="p">[</span><span class="n">_parentOrSize</span><span class="p">[</span><span class="n">a</span><span class="p">]])</span> <span class="p">{</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_parentOrSize</span><span class="p">[</span><span class="n">a</span><span class="p">])</span> <span class="p">=</span> <span class="p">(</span><span class="n">_parentOrSize</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">_parentOrSize</span><span class="p">[</span><span class="n">_parentOrSize</span><span class="p">[</span><span class="n">a</span><span class="p">]]);</span> <span class="p">}</span> <span class="k">return</span> <span class="n">_parentOrSize</span><span class="p">[</span><span class="n">a</span><span class="p">];</span> <span class="p">}</span> <span class="k">public</span> <span class="kt">int</span> <span class="nf">Size</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">DebugUtil</span><span class="p">.</span><span class="nf">Assert</span><span class="p">(</span><span class="m">0</span> <span class="p">&lt;=</span> <span class="n">a</span> <span class="p">&amp;&amp;</span> <span class="n">a</span> <span class="p">&lt;</span> <span class="n">_n</span><span class="p">);</span> <span class="k">return</span> <span class="p">-</span><span class="n">_parentOrSize</span><span class="p">[</span><span class="nf">Leader</span><span class="p">(</span><span class="n">a</span><span class="p">)];</span> <span class="p">}</span> <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">[</span><span class="k">]&gt;</span> <span class="nf">Groups</span><span class="p">()</span> <span class="p">{</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">leaderBuf</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">_n</span><span class="p">];</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">id</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">_n</span><span class="p">];</span> <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">[</span><span class="k">]&gt;</span><span class="p">(</span><span class="n">_n</span><span class="p">);</span> <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">leaderBuf</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> <span class="p">{</span> <span class="n">leaderBuf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="nf">Leader</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">==</span> <span class="n">leaderBuf</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span> <span class="n">id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">result</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">result</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="p">[-</span><span class="n">_parentOrSize</span><span class="p">[</span><span class="n">i</span><span class="p">]]);</span> <span class="p">}</span> <span class="p">}</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">ind</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">result</span><span class="p">.</span><span class="n">Count</span><span class="p">];</span> <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">leaderBuf</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> <span class="p">{</span> <span class="kt">var</span> <span class="n">leaderID</span> <span class="p">=</span> <span class="n">id</span><span class="p">[</span><span class="n">leaderBuf</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span> <span class="n">result</span><span class="p">[</span><span class="n">leaderID</span><span class="p">][</span><span class="n">ind</span><span class="p">[</span><span class="n">leaderID</span><span class="p">]]</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span> <span class="n">ind</span><span class="p">[</span><span class="n">leaderID</span><span class="p">]++;</span> <span class="p">}</span> <span class="k">return</span> <span class="n">result</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> 
<span class="k">namespace</span> <span class="nn">SourceExpander</span> <span class="p">{</span> <span class="k">public</span> <span class="k">class</span> <span class="nc">Expander</span> <span class="p">{</span> <span class="p">[</span><span class="nf">Conditional</span><span class="p">(</span><span class="s">"EXPANDER"</span><span class="p">)]</span> <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Expand</span><span class="p">(</span><span class="kt">string</span> <span class="n">inputFilePath</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="kt">string</span> <span class="n">outputFilePath</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">ignoreAnyError</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">ExpandString</span><span class="p">(</span><span class="kt">string</span> <span class="n">inputFilePath</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">ignoreAnyError</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="s">""</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> 
<span class="k">namespace</span> <span class="nn">AtCoder.Internal</span> <span class="p">{</span> <span class="k">internal</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">DebugUtil</span> <span class="p">{</span> <span class="p">[</span><span class="nf">Conditional</span><span class="p">(</span><span class="s">"DEBUG"</span><span class="p">)]</span> <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Assert</span><span class="p">(</span><span class="kt">bool</span> <span class="n">condition</span><span class="p">,</span> <span class="kt">string</span> <span class="n">reason</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(!</span><span class="n">condition</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">DebugAssertException</span><span class="p">(</span><span class="n">reason</span><span class="p">);</span> <span class="p">}</span> <span class="p">[</span><span class="nf">Conditional</span><span class="p">(</span><span class="s">"DEBUG"</span><span class="p">)]</span> <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Assert</span><span class="p">(</span><span class="n">Func</span><span class="p">&lt;</span><span class="kt">bool</span><span class="p">&gt;</span> <span class="n">conditionFunc</span><span class="p">,</span> <span class="kt">string</span> <span class="n">reason</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(!</span><span class="nf">conditionFunc</span><span class="p">())</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">DebugAssertException</span><span class="p">(</span><span class="n">reason</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> 
<span class="k">namespace</span> <span class="nn">AtCoder.Internal</span> <span class="p">{</span> <span class="k">public</span> <span class="k">class</span> <span class="nc">DebugAssertException</span> <span class="p">:</span> <span class="n">Exception</span> <span class="p">{</span> <span class="k">public</span> <span class="nf">DebugAssertException</span><span class="p">()</span> <span class="p">:</span> <span class="k">base</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span> <span class="k">public</span> <span class="nf">DebugAssertException</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="k">public</span> <span class="nf">DebugAssertException</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">,</span> <span class="n">Exception</span> <span class="n">innerException</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">innerException</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> 
<span class="cp">#endregion Expanded
</span></code></pre></div>
</div>

<p>とライブラリのソースコードと合体したソースコードが出力されます。</p>

<p><a href="https://github.com/naminodarie/ac-library-csharp/tree/master/Sample.Usage" rel="nofollow noopener" target="_blank">Sample Project</a></p>

<h1>
<span id="sourceexpander" class="fragment"></span><a href="#sourceexpander"><i class="fa fa-link"></i></a><a href="https://github.com/naminodarie/SourceExpander" rel="nofollow noopener" target="_blank">SourceExpander</a>
</h1>

<p>ソースジェネレーターを使ってソースコードの埋め込み・利用を行うライブラリです。ac-library-csharpに限らず、ソースコードを埋め込みたいライブラリがあるならば使用できます。</p>

<p>大きく3つのパッケージに分かれています。</p>

<ul>
<li>
<a href="https://www.nuget.org/packages/SourceExpander.Embedder/" rel="nofollow noopener" target="_blank">SourceExpander.Embedder</a><br>
競技プログラミングライブラリにソースコードを埋め込むためのソースジェネレーター。ライブラリ開発者向け。</li>
<li>
<a href="https://www.nuget.org/packages/SourceExpander.Generator/" rel="nofollow noopener" target="_blank">SourceExpander.Generator</a><br>
埋め込まれたソースコードを展開するソースジェネレーター。ライブラリ利用者向け。</li>
<li>
<a href="https://www.nuget.org/packages/SourceExpander/" rel="nofollow noopener" target="_blank">SourceExpander</a><br>
SourceExpander.Generatorが展開したコードを読み取るライブラリ。ライブラリ利用者向け。</li>
</ul>

<p>以下、それぞれについて解説します。ソースジェネレーターを作成する際は公式のドキュメントが非常に参考になるので合わせて見ることを推奨します。<br>
<a href="https://github.com/dotnet/roslyn/blob/master/docs/features/source-generators.cookbook.md" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/dotnet/roslyn/blob/master/docs/features/source-generators.cookbook.md</a></p>

<h2>
<span id="sourceexpanderembedder" class="fragment"></span><a href="#sourceexpanderembedder"><i class="fa fa-link"></i></a>SourceExpander.Embedder</h2>

<h3>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h3>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Reflection</span><span class="p">;</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyMetadata</span><span class="p">(</span><span class="s">"SourceExpander.EmbedderVersion"</span><span class="p">,</span> <span class="s">"2.2.0.101"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyMetadata</span><span class="p">(</span><span class="s">"SourceExpander.EmbeddedLanguageVersion"</span><span class="p">,</span> <span class="s">"2"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyMetadata</span><span class="p">(</span><span class="s">"SourceExpander.EmbeddedAllowUnsafe"</span><span class="p">,</span> <span class="s">"true"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyMetadata</span><span class="p">(</span><span class="s">"SourceExpander.EmbeddedSourceCode.GZipBase32768"</span><span class="p">,</span> <span class="s">"㘅桠ҠҠԀᏕ䴾阺㹈斪筟楸厮嫉盆炚磈臤梽胍㦬竂帙詪煩㔬樄ᗗ踜鲯诇ᠩ珱䪜䐽闾鱏珣茙灸䏙⨧㤄寨砳⬅ស䮙松Ꝉ㥅䱀餯ꃣ虱嫁榏㪰糰蝃技夛䥘谼礞䐿斄禕蚷屔彺㪪賳鱥䝢鰨覶⬴誼⬼獬鞨胒宝䭴摺眚䅗䃝䚏隻嫻痛簴Ꜿ変⇣㇋聼欈Ꭽ墷霶勎嶐窢銖㤁┠䁺⠛缧䋹凬☂䁸栣僼邐䑹瘜蛭諠賿㨚咈鍂ꄱ禱唨毊崨叼緭䥜榄闺䦖麷䘘㨵ᖶ琜鎎ᰇ髎飭㪬採ꅈ㥞盧䢽䃘煃⬘喔渻莖案ᯋ硟ꋛ叝谴缄ꍢ⋗溁ᣒ颂浢ꍈꉭ㑆焤鹠杳煄㾳䴡䂱㙽楯裦鷬梙掫取颤⩑㰑㕋ꂤ碎麓㾕昖啘繅餬簚盎鍣䨽籭詽绑襌硲❞擧ꌥ膩辪聫㭒珥㴟囓䓖焜铽痢ꊆꍼᓥ囦纇維Ⲡ㤬垇螇感縋㼎砾褳強襓瀕樥阵瀭蜺兔峃絻藈萢饑㶬櫊綖嶅鏕㻶坶禵䓓Ⴐ咇詤煑⬐毱㱒獅鐥椳䖑ᙋ冄㴼㗭隯顑命貽职葅苫⢸栚䀹䢳噂槝䲰䰮⇷ᔈ⎙䕪絑㝖垿䞉場珟䉛㰭䵶日憭蕼馣㸩涴䓋䃇懚鹯琥镌ⴊ電萞猛流癊⏔恚Ԉң"</span><span class="p">)]</span>
<span class="c1">//[assembly: AssemblyMetadata("SourceExpander.EmbeddedSourceCode", "[{\"CodeBody\":\"namespace SampleLibrary { public static class Bit { [MethodImpl(MethodImplOptions.AggressiveInlining)] public static int ExtractLowestSetBit(int n) { if (Bmi1.IsSupported) { return (int)Bmi1.ExtractLowestSetBit((uint)n); } return n &amp; -n; } } } \",\"Dependencies\":[],\"FileName\":\"_SampleLibrary&gt;Bit.cs\",\"TypeNames\":[\"SampleLibrary.Bit\"],\"Usings\":[\"using System.Runtime.CompilerServices;\",\"using System.Runtime.Intrinsics.X86;\"]},{\"CodeBody\":\"namespace SampleLibrary { public static class Put { private static readonly Xorshift rnd = new Xorshift(); public static void WriteRandom() { Trace.WriteLine(rnd.Next()); } } } \",\"Dependencies\":[\"_SampleLibrary&gt;Xorshift.cs\"],\"FileName\":\"_SampleLibrary&gt;Put.cs\",\"TypeNames\":[\"SampleLibrary.Put\"],\"Usings\":[\"using System.Diagnostics;\"]},{\"CodeBody\":\"namespace SampleLibrary { public class Xorshift : Random { private uint x = 123456789; private uint y = 362436069; private uint z = 521288629; private uint w; private static readonly Random rnd = new Random(); public Xorshift() : this(rnd.Next()) { } public Xorshift(int seed) { w = (uint)seed; } protected override double Sample() { return InternalSample() * (1.0 \\/ uint.MaxValue); } private uint InternalSample() { uint t = x ^ (x &lt;&lt; 11); x = y; y = z; z = w; return w = (w ^ (w &gt;&gt; 19)) ^ (t ^ (t &gt;&gt; 8)); } } } \",\"Dependencies\":[],\"FileName\":\"_SampleLibrary&gt;Xorshift.cs\",\"TypeNames\":[\"SampleLibrary.Xorshift\"],\"Usings\":[\"using System;\"]}]")]</span>
</code></pre></div></div>

<p>とソースコード情報を <code>AssemblyMetadataAttribute</code> で埋め込みます。</p>

<h3>
<span id="埋め込む情報" class="fragment"></span><a href="#%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80%E6%83%85%E5%A0%B1"><i class="fa fa-link"></i></a>埋め込む情報</h3>

<h4>
<span id="embedderversion" class="fragment"></span><a href="#embedderversion"><i class="fa fa-link"></i></a>EmbedderVersion</h4>

<p><code>Assembly.GetExecutingAssembly().GetName().Version</code>で取得できる<code>SourceExpander.Embedder</code>のAssemblyVersion。<br>
ライブラリでソースコード埋め込みに使用したSourceExpanderのバージョンがライブラリ利用側のバージョンより低い場合に警告を出すなどの用途に使用します。</p>

<h4>
<span id="embeddedlanguageversion" class="fragment"></span><a href="#embeddedlanguageversion"><i class="fa fa-link"></i></a>EmbeddedLanguageVersion</h4>

<p>ライブラリのC#バージョン。<br>
ライブラリ利用側のバージョンがこれより低い場合に警告を出すなどの用途に使用します。</p>

<h4>
<span id="embeddedallowunsafe" class="fragment"></span><a href="#embeddedallowunsafe"><i class="fa fa-link"></i></a>EmbeddedAllowUnsafe</h4>

<p>ライブラリが<code>unsafe</code>を許可してビルドされている場合はtrueが設定されます。<br>
ライブラリ利用側が<code>unsafe</code>を許可していない場合に警告を出すなどの用途に使用します。</p>

<h4>
<span id="embeddedsourcecode" class="fragment"></span><a href="#embeddedsourcecode"><i class="fa fa-link"></i></a>EmbeddedSourceCode</h4>

<p>上記の例ではコメントアウトしていますが、<code>SourceExpander.EmbeddedSourceCode.GZipBase32768</code>と対応しています。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">SourceFileInfo</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// ファイルの固有名</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">FileName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// ファイル内で定義されているclass, struct, enum, delegate</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">TypeNames</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// ファイル先頭のusingディレクティブ</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">Usings</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// ファイルが依存している先のFileName</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">Dependencies</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// usingディレクティブを除いたコード本体</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">CodeBody</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>のような型の配列を埋め込んでいます。</p>

<h4>
<span id="embeddedsourcecodegzipbase32768" class="fragment"></span><a href="#embeddedsourcecodegzipbase32768"><i class="fa fa-link"></i></a>EmbeddedSourceCode.GZipBase32768</h4>

<p>例で示した<code>SourceExpander.EmbeddedSourceCode.GZipBase32768</code>は<code>SourceExpander.EmbeddedSourceCode</code>のJSONと同等の情報を保持しています。</p>

<ol>
<li>JSONを作成</li>
<li>JSONをUTF-8で<code>byte[]</code>に変換</li>
<li>
<code>byte[]</code>を<code>System.IO.Compression.GZipStream</code>でgzip圧縮</li>
<li>gzip圧縮されたバイナリデータをBase32768で文字列化</li>
</ol>

<p>としたものを埋め込んでいます。</p>

<p>これを採用することで埋め込む文字列のサイズを1/10程度まで圧縮できました(ac-library-csharpの場合)。</p>

<table>
<thead>
<tr>
<th style="text-align: left">埋め込み形式</th>
<th style="text-align: right">DLLサイズ [KB]</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">ソースコードを埋め込まない</td>
<td style="text-align: right">64 KB</td>
</tr>
<tr>
<td style="text-align: left">JSONを直接埋め込み</td>
<td style="text-align: right">313 KB</td>
</tr>
<tr>
<td style="text-align: left">GZip &amp; Base32768で埋め込み</td>
<td style="text-align: right">90 KB</td>
</tr>
</tbody>
</table>

<h5>
<span id="base32768" class="fragment"></span><a href="#base32768"><i class="fa fa-link"></i></a>base32768</h5>

<p><a href="https://github.com/qntm/base32768" rel="nofollow noopener" target="_blank">base32768</a> はバイナリデータをUTF-16文字列に変換するアルゴリズムです。</p>

<p>C#の文字列はUTF-16であることや<code>AssemblyMetadata</code>に埋め込めるバイナリデータを埋め込むのに適していることから採用しました。</p>

<p>C#実装が存在しなかったので<a href="https://github.com/naminodarie/Base32768/" rel="nofollow noopener" target="_blank">移植しました</a>。</p>

<h3>
<span id="ソース情報-sourcefileinfo-の埋め込み" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E6%83%85%E5%A0%B1-sourcefileinfo-%E3%81%AE%E5%9F%8B%E3%82%81%E8%BE%BC%E3%81%BF"><i class="fa fa-link"></i></a>ソース情報 <code>SourceFileInfo</code> の埋め込み</h3>

<p>埋め込むための<code>SourceFileInfo</code>を作成する流れについて説明します。</p>

<p><code>GeneratorExecutionContext</code>(ソースジェネレーターに渡される引数)の<code>Compilation</code>(コンパイル情報)に含まれる<code>SyntaxTrees</code>が埋め込まれるソースコードの本体になります。</p>

<p>つまり、<code>Microsoft.CodeAnalysis.SyntaxTree</code>が<code>SourceFileInfo</code>に対応します。</p>

<h4>
<span id="filenameの生成" class="fragment"></span><a href="#filename%E3%81%AE%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a><code>FileName</code>の生成</h4>

<p><code>SyntaxTree</code>は<code>FilePath</code>プロパティでファイルのパスを取得できるのでそれを使用します。</p>

<p>入力される<code>SyntaxTree</code>が1つの場合はディレクトリ名を削除したもの、2つ以上の場合は最も上位の共通祖先ディレクトリまでを削除したものをファイル名とします。</p>

<p>そして、それぞれのファイル名にアセンブリ名を合わせて<code>{アセンブリ名}&gt;{ファイル名}</code>としたものが<code>FileName</code>プロパティの値になります。</p>

<p>例：</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>D:\Sources\TestProject\
├─── TestProject.csproj
├─── Root.cs
└─── Extra\
      └───Ext.cs
</code></pre></div></div>

<p>というファイル構成ならば、埋め込まれるファイルの<code>FileName</code>プロパティは<code>TestProject&gt;Root.cs</code>, <code>TestProject&gt;Extra\Ext.cs</code>になります。</p>

<h4>
<span id="typenamesの生成" class="fragment"></span><a href="#typenames%E3%81%AE%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a><code>TypeNames</code>の生成</h4>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">semanticModel</span> <span class="p">=</span> <span class="n">Compilation</span><span class="p">.</span><span class="nf">GetSemanticModel</span><span class="p">(</span><span class="n">SyntaxTree</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="n">SyntaxTree</span><span class="p">.</span><span class="nf">GetRoot</span><span class="p">().</span><span class="nf">DescendantNodes</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="n">s</span> <span class="k">is</span> <span class="n">BaseTypeDeclarationSyntax</span> <span class="p">||</span> <span class="n">s</span> <span class="k">is</span> <span class="n">DelegateDeclarationSyntax</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">syntax</span> <span class="p">=&gt;</span> <span class="n">semanticModel</span><span class="p">.</span><span class="nf">GetDeclaredSymbol</span><span class="p">(</span><span class="n">syntax</span><span class="p">)?.</span><span class="nf">ToDisplayString</span><span class="p">())</span>
    <span class="p">.</span><span class="n">OfType</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;()</span>
    <span class="p">.</span><span class="nf">Distinct</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">ToArray</span><span class="p">()</span>
</code></pre></div></div>

<p>で取得します。</p>

<p>各操作の説明</p>

<ul>
<li>
<code>Compilation.GetSemanticModel(SyntaxTree, true)</code><br>
<code>SemanticModel</code>はコンパイル情報から詳細な情報を取得できるものです</li>
<li>
<code>SyntaxTree.GetRoot().DescendantNodes()</code><br>
<code>DescendantNodes</code>で式ツリーに含まれる<code>SyntaxNode</code>を列挙します</li>
<li>
<code>BaseTypeDeclarationSyntax</code>, <code>DelegateDeclarationSyntax</code><br>
<code>BaseTypeDeclarationSyntax</code>ならばclass, struct, enum, recordの定義、<code>DelegateDeclarationSyntax</code>ならばdelegateの定義です</li>
<li>
<code>semanticModel.GetDeclaredSymbol(syntax)</code><br>
型定義の詳細情報を取得します。</li>
</ul>

<h5>
<span id="syntaxnodeから取得できる情報とgetdeclaredsymbolから取得できる情報の違い" class="fragment"></span><a href="#syntaxnode%E3%81%8B%E3%82%89%E5%8F%96%E5%BE%97%E3%81%A7%E3%81%8D%E3%82%8B%E6%83%85%E5%A0%B1%E3%81%A8getdeclaredsymbol%E3%81%8B%E3%82%89%E5%8F%96%E5%BE%97%E3%81%A7%E3%81%8D%E3%82%8B%E6%83%85%E5%A0%B1%E3%81%AE%E9%81%95%E3%81%84"><i class="fa fa-link"></i></a><code>SyntaxNode</code>から取得できる情報と<code>GetDeclaredSymbol</code>から取得できる情報の違い</h5>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">Space</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>というコードがある場合は<code>Foo</code>の部分が<code>SyntaxNode</code>です。namespaceの情報などは含まれません。</p>

<p>一方、<code>GetDeclaredSymbol</code>では<code>Foo</code>の<code>SyntaxNode</code>が<code>Space.Foo</code>という型情報を持っていることを取得できます。</p>

<p>そのためSymbolが必要です。</p>

<h4>
<span id="usingsの生成" class="fragment"></span><a href="#usings%E3%81%AE%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a><code>Usings</code>の生成</h4>

<p><code>SyntaxTree.GetRoot()</code>は実際には<code>CompilationUnitSyntax</code>型です。</p>

<p><code>CompilationUnitSyntax</code>は<code>Usings</code>プロパティでusingディレクティブの定義が取得できるのでそこから取得できます。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">root</span> <span class="p">=</span> <span class="p">(</span><span class="n">CompilationUnitSyntax</span><span class="p">)</span><span class="n">tree</span><span class="p">.</span><span class="nf">GetRoot</span><span class="p">(</span><span class="n">cancellationToken</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">usings</span> <span class="p">=</span> <span class="n">root</span><span class="p">.</span><span class="n">Usings</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">u</span> <span class="p">=&gt;</span> <span class="n">u</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">Trim</span><span class="p">()).</span><span class="nf">ToArray</span><span class="p">();</span>
</code></pre></div></div>

<h4>
<span id="dependenciesの生成" class="fragment"></span><a href="#dependencies%E3%81%AE%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a><code>Dependencies</code>の生成</h4>

<p>まずは<code>SyntaxTree</code>で呼び出されている型の一覧を取得します。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="n">semanticModel</span><span class="p">.</span><span class="nf">GetSymbolInfo</span><span class="p">(</span><span class="n">syntaxNode</span><span class="p">).</span><span class="n">Symbol</span><span class="p">?.</span><span class="n">OriginalDefinition</span>
</code></pre></div></div>

<p>でシンボル情報を取得します。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">static</span> <span class="kt">string</span><span class="p">?</span> <span class="nf">GetTypeNameFromSymbol</span><span class="p">(</span><span class="n">ISymbol</span><span class="p">?</span> <span class="n">symbol</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">symbol</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">symbol</span> <span class="k">is</span> <span class="n">INamedTypeSymbol</span> <span class="n">named</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">named</span><span class="p">.</span><span class="n">ConstructedFrom</span><span class="p">.</span><span class="nf">ToDisplayString</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">symbol</span><span class="p">.</span><span class="n">ContainingType</span><span class="p">?.</span><span class="n">ConstructedFrom</span><span class="p">?.</span><span class="nf">ToDisplayString</span><span class="p">()</span> <span class="p">??</span> <span class="n">symbol</span><span class="p">.</span><span class="nf">ToDisplayString</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>シンボル情報が何かはわかりませんが、型情報っぽいものを総当たりして呼び出されている型を列挙します。</p>

<p>大量に重複する結果が出るので<code>Distinct</code>しておきましょう。</p>

<p>競技プログラミング的に考えると、<code>SyntaxTree</code>の数を$N$として計算量が $O(N^2)$ とかになりそうでちょっと不安になりますが、$N$はせいぜい100とかなので実用上問題はなさそうです。</p>

<p>別のソース埋め込みされたライブラリへ依存がある場合もここで解決しておきます。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">reference</span> <span class="k">in</span> <span class="n">compilation</span><span class="p">.</span><span class="n">References</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">dic</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;();</span>
    <span class="kt">var</span> <span class="n">symbol</span> <span class="p">=</span> <span class="n">compilation</span><span class="p">.</span><span class="nf">GetAssemblyOrModuleSymbol</span><span class="p">(</span><span class="n">reference</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">symbol</span> <span class="k">is</span> <span class="k">null</span><span class="p">)</span>
        <span class="k">continue</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">attr</span> <span class="k">in</span> <span class="n">symbol</span><span class="p">.</span><span class="nf">GetAttributes</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">attr</span><span class="p">.</span><span class="n">AttributeClass</span><span class="p">?.</span><span class="nf">ToString</span><span class="p">()</span> <span class="p">==</span> <span class="s">"System.Reflection.AssemblyMetadataAttribute"</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">args</span> <span class="p">=</span> <span class="n">attr</span><span class="p">.</span><span class="n">ConstructorArguments</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">Length</span> <span class="p">==</span> <span class="m">2</span> <span class="p">&amp;&amp;</span> <span class="n">args</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Value</span> <span class="k">is</span> <span class="kt">string</span> <span class="n">key</span> <span class="p">&amp;&amp;</span> <span class="n">args</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Value</span> <span class="k">is</span> <span class="kt">string</span> <span class="n">val</span><span class="p">)</span>
                <span class="n">dic</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>参照しているアセンブリの<code>AssemblyMetadataAttribute</code>はコンパイル情報から取得できます。</p>

<p>あとは埋め込んだソースコードをパースして<code>SourceFileInfo</code>として扱えます。</p>

<h4>
<span id="codebodyの生成" class="fragment"></span><a href="#codebody%E3%81%AE%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a><code>CodeBody</code>の生成</h4>

<p><code>SyntaxTree</code>からusingディレクティブとスペースを削除したものを埋め込みます。</p>

<p><code>CSharpSyntaxRewriter</code>で削除します。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">internal</span> <span class="k">class</span> <span class="nc">MinifyRewriter</span> <span class="p">:</span> <span class="n">CSharpSyntaxRewriter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">SyntaxTrivia</span> <span class="nf">VisitTrivia</span><span class="p">(</span><span class="n">SyntaxTrivia</span> <span class="n">trivia</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">SyntaxFactory</span><span class="p">.</span><span class="n">Space</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">SyntaxNode</span><span class="p">?</span> <span class="nf">VisitUsingDirective</span><span class="p">(</span><span class="n">UsingDirectiveSyntax</span> <span class="n">node</span><span class="p">)</span>
        <span class="p">=&gt;</span> <span class="n">node</span><span class="p">.</span><span class="n">Parent</span><span class="p">.</span><span class="nf">IsKind</span><span class="p">(</span><span class="n">SyntaxKind</span><span class="p">.</span><span class="n">CompilationUnit</span><span class="p">)</span> <span class="p">==</span> <span class="k">true</span> <span class="p">?</span> <span class="k">default</span> <span class="p">:</span> <span class="k">base</span><span class="p">.</span><span class="nf">VisitUsingDirective</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
<li><code>VisitTrivia</code></li>
</ul>

<p>スペース、タブ、改行、コメントなどのコード本体ではない箇所をすべて半角スペース(<code>SyntaxFactory.Space</code>)に置き換えることでコードを圧縮します。</p>

<p>関連記事: <a href="https://qiita.com/naminodarie/items/50468bebaf5df6969b1e" id="reference-34e3118fa96220d4fe31">【ネタ】スペースも改行も使わずC#のコードを書く</a></p>

<ul>
<li><code>VisitUsingDirective</code></li>
</ul>

<p>usingディレクティブを削除します。<br>
<code>node.Parent.IsKind(SyntaxKind.CompilationUnit)</code>で親がRootであることを確認しているのは、namespace内にもusingディレクティブを書くことができ、その場合は削除しないようにするためです。</p>

<h4>
<span id="埋め込み処理" class="fragment"></span><a href="#%E5%9F%8B%E3%82%81%E8%BE%BC%E3%81%BF%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>埋め込み処理</h4>

<p>C#のソースコードを生成する際には文字列リテラルとして埋め込む必要があります。</p>

<p>たとえば</p>

<table>
<thead>
<tr>
<th style="text-align: left"></th>
<th style="text-align: left">文字列</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">文字列の値</td>
<td style="text-align: left"><code>{"foo":"bar"}</code></td>
</tr>
<tr>
<td style="text-align: left">文字列リテラル</td>
<td style="text-align: left"><code>"{\"foo\":\"bar\"}"</code></td>
</tr>
</tbody>
</table>

<p>のような感じです。</p>

<p>文字列置換で実現しても良いのですが、Roslynへの参照があるのでRoslynで文字列リテラルを生成してしまうことにします。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Microsoft.CodeAnalysis.CSharp</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">SourceExpander</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">RoslynUtil</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">ToLiteral</span><span class="p">(</span><span class="k">this</span> <span class="kt">string</span> <span class="n">str</span><span class="p">)</span>
            <span class="p">=&gt;</span> <span class="n">SyntaxFactory</span><span class="p">.</span><span class="nf">LiteralExpression</span><span class="p">(</span><span class="n">SyntaxKind</span><span class="p">.</span><span class="n">StringLiteralExpression</span><span class="p">,</span> <span class="n">SyntaxFactory</span><span class="p">.</span><span class="nf">Literal</span><span class="p">(</span><span class="n">str</span><span class="p">)).</span><span class="nf">ToFullString</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="sourceexpandergenerator" class="fragment"></span><a href="#sourceexpandergenerator"><i class="fa fa-link"></i></a>SourceExpander.Generator</h2>

<h3>
<span id="概要-1" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81-1"><i class="fa fa-link"></i></a>概要</h3>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">SourceExpander.Expanded</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">ExpandedContainer</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">IReadOnlyDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">SourceCode</span><span class="p">&gt;</span> <span class="n">Files</span> <span class="p">{</span> <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_Files</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
        <span class="k">private</span> <span class="k">static</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">SourceCode</span><span class="p">&gt;</span> <span class="n">_Files</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">SourceCode</span><span class="p">&gt;{</span>
            <span class="p">{</span><span class="s">"Z:\\source\\repos\\SourceExpander\\Sample\\SampleProject\\Program.cs"</span><span class="p">,</span><span class="n">SourceCode</span><span class="p">.</span><span class="nf">FromDictionary</span><span class="p">(</span><span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="kt">object</span><span class="p">&gt;{{</span><span class="s">"path"</span><span class="p">,</span><span class="s">"Z:\\source\\repos\\SourceExpander\\Sample\\SampleProject\\Program.cs"</span><span class="p">},{</span><span class="s">"code"</span><span class="p">,</span><span class="s">"using SampleLibrary;\r\nusing System;\r\nusing System.Diagnostics;\r\nusing System.Runtime.CompilerServices;\r\nusing System.Runtime.Intrinsics.X86;\r\nclass Program\r\n{\r\n    static void Main()\r\n    {\r\n        SourceExpander.Expanded.ExpandedContainer.Files\r\n        SourceExpander.Expander.Expand(ignoreAnyError: false);\r\n        Put2.Write();\r\n        Console.WriteLine(\"fofao\");\r\n        Console.WriteLine(SampleLibrary.Bit.ExtractLowestSetBit(13));\r\n    }\r\n}\r\n#region Expanded\r\nnamespace SourceExpander { public class Expander { [Conditional(\"EXPANDER\")] public static void Expand(string inputFilePath = null, string outputFilePath = null, bool ignoreAnyError = true) { } public static string ExpandString(string inputFilePath = null, bool ignoreAnyError = true) { return \"\"; } } } \r\nnamespace SampleLibrary { public static class Bit { [MethodImpl(MethodImplOptions.AggressiveInlining)] public static int ExtractLowestSetBit(int n) { if (Bmi1.IsSupported) { return (int)Bmi1.ExtractLowestSetBit((uint)n); } return n &amp; -n; } } } \r\nnamespace SampleLibrary { public static class Put2 { public static void Write() =&gt; Put.WriteRandom(); } } \r\nnamespace SampleLibrary { public static class Put { private static readonly Xorshift rnd = new Xorshift(); public static void WriteRandom() { Trace.WriteLine(rnd.Next()); } } } \r\nnamespace SampleLibrary { public class Xorshift : Random { private uint x = 123456789; private uint y = 362436069; private uint z = 521288629; private uint w; private static readonly Random rnd = new Random(); public Xorshift() : this(rnd.Next()) { } public Xorshift(int seed) { w = (uint)seed; } protected override double Sample() { return InternalSample() * (1.0 / uint.MaxValue); } private uint InternalSample() { uint t = x ^ (x &lt;&lt; 11); x = y; y = z; z = w; return w = (w ^ (w &gt;&gt; 19)) ^ (t ^ (t &gt;&gt; 8)); } } } \r\n#endregion Expanded\r\n"</span><span class="p">},})},</span>
            <span class="p">{</span><span class="s">"Z:\\source\\repos\\SourceExpander\\Sample\\SampleProject\\obj\\Debug\\netcoreapp3.1\\SampleProject.AssemblyInfo.cs"</span><span class="p">,</span><span class="n">SourceCode</span><span class="p">.</span><span class="nf">FromDictionary</span><span class="p">(</span><span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="kt">object</span><span class="p">&gt;{{</span><span class="s">"path"</span><span class="p">,</span><span class="s">"Z:\\source\\repos\\SourceExpander\\Sample\\SampleProject\\obj\\Debug\\netcoreapp3.1\\SampleProject.AssemblyInfo.cs"</span><span class="p">},{</span><span class="s">"code"</span><span class="p">,</span><span class="s">"[assembly: System.Reflection.AssemblyCompanyAttribute(\"naminodarie\")]\r\n[assembly: System.Reflection.AssemblyConfigurationAttribute(\"Debug\")]\r\n[assembly: System.Reflection.AssemblyFileVersionAttribute(\"2.2.0.101\")]\r\n[assembly: System.Reflection.AssemblyInformationalVersionAttribute(\"2.2.0\")]\r\n[assembly: System.Reflection.AssemblyProductAttribute(\"SampleProject\")]\r\n[assembly: System.Reflection.AssemblyTitleAttribute(\"SampleProject\")]\r\n[assembly: System.Reflection.AssemblyVersionAttribute(\"2.2.0.101\")]\r\n[assembly: System.Reflection.AssemblyMetadataAttribute(\"RepositoryUrl\", \"https://github.com/naminodarie/SourceExpander\")]\r\n\r\n// MSBuild WriteCodeFragment クラスによって生成されました。\r\n\r\n#region Expanded\r\n#endregion Expanded\r\n"</span><span class="p">},})},</span>
            <span class="p">{</span><span class="s">"Z:\\source\\repos\\SourceExpander\\Sample\\SampleProject\\obj\\Debug\\netcoreapp3.1\\.NETCoreApp,Version=v3.1.AssemblyAttributes.cs"</span><span class="p">,</span><span class="n">SourceCode</span><span class="p">.</span><span class="nf">FromDictionary</span><span class="p">(</span><span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="kt">object</span><span class="p">&gt;{{</span><span class="s">"path"</span><span class="p">,</span><span class="s">"Z:\\source\\repos\\SourceExpander\\Sample\\SampleProject\\obj\\Debug\\netcoreapp3.1\\.NETCoreApp,Version=v3.1.AssemblyAttributes.cs"</span><span class="p">},{</span><span class="s">"code"</span><span class="p">,</span><span class="s">"using System;\r\nusing System.Reflection;\r\n[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(\".NETCoreApp,Version=v3.1\", FrameworkDisplayName = \"\")]\r\n#region Expanded\r\n#endregion Expanded\r\n"</span><span class="p">},})},</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code>SourceCode</code>クラスは SourceExpander.Core パッケージでも定義しており、その参照がある場合はその型を使い、参照がない場合は<code>SourceCode</code>クラスのコードも追加します。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">SourceCode</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">SourceCode</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">,</span> <span class="kt">string</span> <span class="n">code</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Path</span> <span class="p">=</span> <span class="n">path</span><span class="p">;</span>
        <span class="n">Code</span> <span class="p">=</span> <span class="n">code</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">private</span> <span class="k">static</span> <span class="kt">bool</span> <span class="n">TryGet</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">dic</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">,</span> <span class="k">out</span> <span class="n">T</span> <span class="n">val</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">object</span> <span class="n">obj</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dic</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="k">out</span> <span class="n">obj</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">obj</span> <span class="k">is</span> <span class="n">T</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">val</span> <span class="p">=</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">obj</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">val</span> <span class="p">=</span> <span class="k">default</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">SourceCode</span> <span class="nf">FromDictionary</span><span class="p">(</span><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">dic</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">string</span> <span class="n">path</span><span class="p">;</span>
        <span class="kt">string</span> <span class="n">code</span><span class="p">;</span>
        <span class="nf">TryGet</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="s">"path"</span><span class="p">,</span> <span class="k">out</span> <span class="n">path</span><span class="p">);</span>
        <span class="nf">TryGet</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="s">"code"</span><span class="p">,</span> <span class="k">out</span> <span class="n">code</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">SourceCode</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">code</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Path</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Code</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code>FromDictionary</code>で初期化しているのは、SourceExpander.CoreとSourceExpander.Generatorのバージョンが異なるせいでコンパイルエラーになるといったことにならないようにするためです。<br>
こうすることで、コンストラクタ引数を増やしても破壊的変更にならずにすみます。</p>

<h3>
<span id="ソースコードを文字列として埋め込み" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%96%87%E5%AD%97%E5%88%97%E3%81%A8%E3%81%97%E3%81%A6%E5%9F%8B%E3%82%81%E8%BE%BC%E3%81%BF"><i class="fa fa-link"></i></a>ソースコードを文字列として埋め込み</h3>

<p>基本的には<a href="#dependencies%E3%81%AE%E7%94%9F%E6%88%90">SourceExpander.Embedder-Dependenciesの生成)</a>と同じ方針です。</p>

<ul>
<li>依存しているソースコードの情報を元のソースコードと結合する

<ul>
<li>usingディレクティブは先頭にまとめる。</li>
<li>ソースコード本体はソースコードの末尾に追記する。</li>
</ul>
</li>
</ul>

<h4>
<span id="不要なusingディレクティブを削除" class="fragment"></span><a href="#%E4%B8%8D%E8%A6%81%E3%81%AAusing%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%82%92%E5%89%8A%E9%99%A4"><i class="fa fa-link"></i></a>不要なusingディレクティブを削除</h4>

<p>存在しないnamespaceをusingしているとコンパイルエラーになってしまいます。「ソースコードは使わないが、usingは書かれている」という状況で起こりうるので対処が必要です。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">specificDiagnosticOptions</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">ReportDiagnostic</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="p">{</span> <span class="s">"CS8019"</span><span class="p">,</span> <span class="n">ReportDiagnostic</span><span class="p">.</span><span class="n">Error</span> <span class="p">},</span>
    <span class="p">{</span> <span class="s">"CS0105"</span><span class="p">,</span> <span class="n">ReportDiagnostic</span><span class="p">.</span><span class="n">Error</span> <span class="p">},</span>
<span class="p">};</span>
<span class="kt">var</span> <span class="n">opts</span> <span class="p">=</span> <span class="n">compilation</span><span class="p">.</span><span class="n">Options</span>
    <span class="p">.</span><span class="nf">WithSpecificDiagnosticOptions</span><span class="p">(</span><span class="n">specificDiagnosticOptions</span><span class="p">);</span>
<span class="n">Compilation</span> <span class="p">=</span> <span class="n">compilation</span><span class="p">.</span><span class="nf">WithOptions</span><span class="p">(</span><span class="n">opts</span><span class="p">);</span>
</code></pre></div></div>

<p>元のコンパイル設定にかかわらず、<code>CS8019</code>,<code>CS0105</code>がエラーとなるコンパイル情報に置き換えます。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="n">semanticModel</span>
    <span class="p">.</span><span class="nf">GetDiagnostics</span><span class="p">(</span><span class="k">null</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">d</span> <span class="p">=&gt;</span> <span class="n">d</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="s">"CS8019"</span> <span class="p">||</span> <span class="n">d</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="s">"CS0105"</span> <span class="p">||</span> <span class="n">d</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="s">"CS0246"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">d</span> <span class="p">=&gt;</span> <span class="n">origRoot</span><span class="p">.</span><span class="nf">FindNode</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">Location</span><span class="p">.</span><span class="n">SourceSpan</span><span class="p">))</span>
    <span class="p">.</span><span class="n">OfType</span><span class="p">&lt;</span><span class="n">UsingDirectiveSyntax</span><span class="p">&gt;()</span>
</code></pre></div></div>

<p>そうすると、不要なusingのDiagnosticsが取れるので該当するusingディレクティブの<code>SyntaxNode</code>を取得できます。</p>

<h2>
<span id="sourceexpander-1" class="fragment"></span><a href="#sourceexpander-1"><i class="fa fa-link"></i></a>SourceExpander</h2>

<p>SourceExpander.Generatorで埋め込んだソースコードを出力するだけです。</p>

<p><code>Assembly.GetCallingAssembly()</code>で呼び出し元のアセンブリが取得できるので、SourceExpander.Generatorで埋め込んだで埋め込んだ<code>SourceExpander.Expanded.ExpandedContainer</code>をリフレクションで取得し、ファイルに書き出したり、文字列を返したりします。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">expandedContainerType</span> <span class="p">=</span> <span class="n">callingAssembly</span><span class="p">.</span><span class="nf">GetType</span><span class="p">(</span><span class="s">"SourceExpander.Expanded.ExpandedContainer"</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">expandedContainerType</span> <span class="k">is</span> <span class="k">null</span><span class="p">)</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">"Needs SourceExpander.Generator"</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">expandedContainerType</span><span class="p">.</span><span class="nf">GetProperty</span><span class="p">(</span><span class="s">"Files"</span><span class="p">).</span><span class="nf">GetValue</span><span class="p">(</span><span class="k">null</span><span class="p">)</span>
    <span class="k">is</span> <span class="n">not</span> <span class="n">IReadOnlyDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">Expanded</span><span class="p">.</span><span class="n">SourceCode</span><span class="p">&gt;</span> <span class="n">dic</span><span class="p">)</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">"SourceExpander.Expanded.ExpandedContainer.Files is invalid"</span><span class="p">);</span>
</code></pre></div></div>

<h3>
<span id="提出形式で埋め込む" class="fragment"></span><a href="#%E6%8F%90%E5%87%BA%E5%BD%A2%E5%BC%8F%E3%81%A7%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80"><i class="fa fa-link"></i></a>提出形式で埋め込む</h3>

<p><code>SourceExpander.Expander</code>クラスはSourceExpander.Generatorパッケージに依存していたりと、提出できるようなソースコードにはなっていません。</p>

<p>そこで、AssemblyMetadataを直接記述して実際とは異なるダミーのソースコードを埋め込みます。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Reflection</span><span class="p">;</span>

<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyMetadata</span><span class="p">(</span><span class="s">"SourceExpander.EmbeddedSourceCode.GZipBase32768"</span><span class="p">,</span> <span class="s">"㘅桠ҠҠԀስ䛺鈣㹆敪躩餸乔ጸ䆴䲻㱲鲸㡜牴邃䐀耧㗱仝幉鋥䄆㻡ꐃ谳镄籇咘頳釡臤宻邉䊪ᘥ㧯笜匒甼汼跐骔莢鰊ቼ⺷萋㖯禱羊耴劾▍痗痪燮诒颢傈釳ꅻ茥誇䤔ꆣ岎褓臚㩜䚳詢嵹滁ᔜ鞟ꃄ憐ᕥ瘕礵╢換蜱㨭㣎祇ꄃ䓴昖飊鶭鹅ꗢ澛惣㑴幂䁏妬䬈鞘應癵愌珦矖㷰礉疝嘞❖彿様㒮獬ጾᅕꆀ劶濎䛻丁䁫㩃檊剜簌滖⎘埌纼玗ꛓ喑㒀ᖀƁ"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyMetadata</span><span class="p">(</span><span class="s">"SourceExpander.EmbeddedLanguageVersion"</span><span class="p">,</span> <span class="s">"4"</span><span class="p">)]</span>
</code></pre></div></div>

<p>埋め込んでいるソースコードは以下になります。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Diagnostics</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">SourceExpander</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Expander</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">Conditional</span><span class="p">(</span><span class="s">"EXPANDER"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Expand</span><span class="p">(</span><span class="kt">string</span> <span class="n">inputFilePath</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="kt">string</span> <span class="n">outputFilePath</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">ignoreAnyError</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">ExpandString</span><span class="p">(</span><span class="kt">string</span> <span class="n">inputFilePath</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">ignoreAnyError</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="s">""</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これで提出先ではなにもしないメソッドとして扱われるため安全です。</p>

<h2>
<span id="nugetで公開するための設定" class="fragment"></span><a href="#nuget%E3%81%A7%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>NuGetで公開するための設定</h2>

<p>いくつか特殊な対応が必要でした。</p>

<h3>
<span id="ソースジェネレーター全般" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AC%E3%83%BC%E3%82%BF%E3%83%BC%E5%85%A8%E8%88%AC"><i class="fa fa-link"></i></a>ソースジェネレーター全般</h3>

<p>ソースジェネレーター(およびアナライザー)をNuGetで公開する場合にはいくつか特殊な手順が必要です。</p>

<div class="code-frame" data-lang="XML"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;PropertyGroup&gt;</span>
  <span class="nt">&lt;IncludeBuildOutput&gt;</span>false<span class="nt">&lt;/IncludeBuildOutput&gt;</span>
  <span class="nt">&lt;IncludeSymbols&gt;</span>false<span class="nt">&lt;/IncludeSymbols&gt;</span>
  <span class="nt">&lt;TargetsForTfmSpecificContentInPackage&gt;</span>$(TargetsForTfmSpecificContentInPackage);PackBuildOutputs<span class="nt">&lt;/TargetsForTfmSpecificContentInPackage&gt;</span>
  <span class="nt">&lt;GetTargetPathDependsOn&gt;</span>$(GetTargetPathDependsOn);GetDependencyTargetPaths<span class="nt">&lt;/GetTargetPathDependsOn&gt;</span>
  <span class="nt">&lt;SuppressDependenciesWhenPacking&gt;</span>true<span class="nt">&lt;/SuppressDependenciesWhenPacking&gt;</span>
  <span class="nt">&lt;DevelopmentDependency&gt;</span>true<span class="nt">&lt;/DevelopmentDependency&gt;</span>
<span class="nt">&lt;/PropertyGroup&gt;</span>
</code></pre></div></div>

<h4>
<span id="利用するライブラリで依存関係を公開しないようにする" class="fragment"></span><a href="#%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%A7%E4%BE%9D%E5%AD%98%E9%96%A2%E4%BF%82%E3%82%92%E5%85%AC%E9%96%8B%E3%81%97%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>利用するライブラリで依存関係を公開しないようにする</h4>

<p>NuGetに公開したときにPackageReferenceが</p>

<div class="code-frame" data-lang="XML"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"SourceExpander.Embedder"</span> <span class="na">Version=</span><span class="s">"2.2.0"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;PrivateAssets&gt;</span>all<span class="nt">&lt;/PrivateAssets&gt;</span>
  <span class="nt">&lt;IncludeAssets&gt;</span>runtime; build; native; contentfiles; analyzers<span class="nt">&lt;/IncludeAssets&gt;</span>
<span class="nt">&lt;/PackageReference&gt;</span>
</code></pre></div></div>

<p>とアナライザー用の設定になるよう、</p>

<div class="code-frame" data-lang="XML"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;DevelopmentDependency&gt;</span>true<span class="nt">&lt;/DevelopmentDependency&gt;</span>
</code></pre></div></div>

<p>と入れるようにします。</p>

<h4>
<span id="他のnugetパッケージへの依存" class="fragment"></span><a href="#%E4%BB%96%E3%81%AEnuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%B8%E3%81%AE%E4%BE%9D%E5%AD%98"><i class="fa fa-link"></i></a>他のNuGetパッケージへの依存</h4>

<p>NuGetパッケージへの依存がある場合は、DLLをパッケージに含める必要があると公式ドキュメントにも記載があります。</p>

<p><qiita-embed-ogp src="https://github.com/dotnet/roslyn/blob/master/docs/features/source-generators.cookbook.md#use-functionality-from-nuget-packages"></qiita-embed-ogp></p>

<div class="code-frame" data-lang="XML"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;ItemGroup&gt;</span>
  <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Base32768"</span> <span class="na">Version=</span><span class="s">"1.0.5"</span> <span class="na">GeneratePathProperty=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/ItemGroup&gt;</span>
<span class="nt">&lt;PropertyGroup&gt;</span>
  <span class="nt">&lt;TargetsForTfmSpecificContentInPackage&gt;</span>$(TargetsForTfmSpecificContentInPackage);PackBuildOutputs<span class="nt">&lt;/TargetsForTfmSpecificContentInPackage&gt;</span>
  <span class="nt">&lt;GetTargetPathDependsOn&gt;</span>$(GetTargetPathDependsOn);GetDependencyTargetPaths<span class="nt">&lt;/GetTargetPathDependsOn&gt;</span>
  <span class="nt">&lt;DevelopmentDependency&gt;</span>true<span class="nt">&lt;/DevelopmentDependency&gt;</span>
<span class="nt">&lt;/PropertyGroup&gt;</span>
<span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"GetDependencyTargetPaths"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;TargetPathWithTargetPlatformMoniker</span> <span class="na">Include=</span><span class="s">"$(PkgBase32768)\lib\netstandard2.0\*.dll"</span> <span class="na">IncludeRuntimeDependency=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>
<span class="nt">&lt;/Target&gt;</span>

<span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"PackBuildOutputs"</span> <span class="na">DependsOnTargets=</span><span class="s">"SatelliteDllsProjectOutputGroup;DebugSymbolsProjectOutputGroup"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;TfmSpecificPackageFile</span> <span class="na">Include=</span><span class="s">"$(TargetDir)\*.dll"</span> <span class="na">PackagePath=</span><span class="s">"analyzers\dotnet\"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;TfmSpecificPackageFile</span> <span class="na">Include=</span><span class="s">"$(PkgBase32768)\lib\netstandard2.0\*.dll"</span> <span class="na">PackagePath=</span><span class="s">"analyzers\dotnet\"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;TfmSpecificPackageFile</span> <span class="na">Include=</span><span class="s">"@(SatelliteDllsProjectOutputGroupOutput-&gt;'%(FinalOutputPath)')"</span> <span class="na">PackagePath=</span><span class="s">"analyzers\dotnet\%(SatelliteDllsProjectOutputGroupOutput.Culture)\"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>
<span class="nt">&lt;/Target&gt;</span>
</code></pre></div></div>

<p>としてnupkgにBase32768.dllも含まれるようにしておきます。</p>

<h3>
<span id="sourceexpanderからsourceexpandergeneratorへの依存" class="fragment"></span><a href="#sourceexpander%E3%81%8B%E3%82%89sourceexpandergenerator%E3%81%B8%E3%81%AE%E4%BE%9D%E5%AD%98"><i class="fa fa-link"></i></a>SourceExpanderからSourceExpander.Generatorへの依存</h3>

<p>同一のソリューションにあるので、</p>

<div class="code-frame" data-lang="XML"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;ProjectReference</span> <span class="na">Include=</span><span class="s">"..\SourceExpander.Generator\SourceExpander.Generator.csproj"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>でジェネレーターとしては動作させずに、SourceExpander.Generatorへの依存だけを持たせられます。</p>

<p>これによって、SourceExpanderを利用しているライブラリにSourceExpander.Generatorの動作を強制できます。</p>

<p>これが別ソリューションだった場合にジェネレーターとして動作させずにパッケージの依存関係をもたせるならば、nuspecファイルを手書きする必要があります。</p>

<p>xunitとxunit.analyzersの関係に近いので興味があるならば調べてみてください。</p>

<p><qiita-embed-ogp src="https://github.com/xunit/xunit/blob/6bc9543856f17cd69ec96e63307529edec2c60cd/src/xunit.v3.assert/xunit.v3.nuspec#L21"></qiita-embed-ogp></p>

<h2>
<span id="応用例" class="fragment"></span><a href="#%E5%BF%9C%E7%94%A8%E4%BE%8B"><i class="fa fa-link"></i></a>応用例</h2>

<p><a href="https://github.com/naminodarie/AtCoderProject" rel="nofollow noopener" target="_blank">自作ライブラリ</a>で活用しているテクニックを紹介しておきます。</p>

<h3>
<span id="ビルド時にファイルを出力する" class="fragment"></span><a href="#%E3%83%93%E3%83%AB%E3%83%89%E6%99%82%E3%81%AB%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ビルド時にファイルを出力する</h3>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">AtCoder</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">==</span> <span class="s">"expand"</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">SourceExpander</span><span class="p">.</span><span class="n">Expander</span><span class="p">.</span><span class="nf">Expand</span><span class="p">();</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// ソースコード</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>のように、引数でexpandモードだと判定したらexpandとして、そうでなければ普通に実行するようなコードにします。</p>

<div class="code-frame" data-lang="XML">
<div class="code-lang"><span class="bold">csproj</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"PostBuild"</span> <span class="na">AfterTargets=</span><span class="s">"PostBuildEvent"</span> <span class="na">Condition=</span><span class="s">"'$(Configuration)' != 'Release'"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">"dotnet $(TargetPath) expand"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Target&gt;</span>
</code></pre></div>
</div>

<p>csprojのPostBuildでexpandモードで実行すれば、ビルド時に出力可能です。</p>

<h3>
<span id="通常時はソースコードを展開しないが明示的にビルドしたときだけ展開する" class="fragment"></span><a href="#%E9%80%9A%E5%B8%B8%E6%99%82%E3%81%AF%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%B1%95%E9%96%8B%E3%81%97%E3%81%AA%E3%81%84%E3%81%8C%E6%98%8E%E7%A4%BA%E7%9A%84%E3%81%AB%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%A0%E3%81%91%E5%B1%95%E9%96%8B%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>通常時はソースコードを展開しないが明示的にビルドしたときだけ展開する</h3>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">AtCoder</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>

<span class="cp">#if EXPAND
</span>        <span class="n">SourceExpander</span><span class="p">.</span><span class="n">Expander</span><span class="p">.</span><span class="nf">Expand</span><span class="p">();</span>
        <span class="k">return</span><span class="p">;</span>
<span class="cp">#endif
</span>
        <span class="c1">// ソースコード</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="XML">
<div class="code-lang"><span class="bold">csproj</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nt">&lt;PackageReference</span> <span class="na">Condition=</span><span class="s">" '$(DefineConstants)' == 'EXPAND' "</span> <span class="na">Include=</span><span class="s">"SourceExpander"</span> <span class="na">Version=</span><span class="s">"2.2.0"</span> <span class="nt">/&gt;</span>
</code></pre></div>
</div>

<p>と設定すれば</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>dotnet build SampleProject.csproj /p:DefineConstants="EXPAND"
</code></pre></div></div>

<p>のように明示的に設定したビルドのときだけソースコードが展開されます。</p>

<p>別途ファイルを監視するなどすれば有効に使えるかもしれません。</p>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>競技プログラミングライブラリ用のソースジェネレーターを作成してみました。</p>

<p>もし良ければ、ac-library-csharpを利用したり、自作ライブラリにSourceExpanderを組み込んだりしてみてください。</p>

<h2>
<span id="ソースジェネレーター開発で感じたこと" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AC%E3%83%BC%E3%82%BF%E3%83%BC%E9%96%8B%E7%99%BA%E3%81%A7%E6%84%9F%E3%81%98%E3%81%9F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>ソースジェネレーター開発で感じたこと</h2>

<ul>
<li>
<strong>プロジェクト参照まわりがわかりづらい</strong><br>
アナライザーでも同じなのですが、プロジェクト参照のために<a href="https://github.com/naminodarie/SourceExpander/blob/ce337742a2b7974852a3695651c9df95821d3ffd/Source/SourceExpander.Embedder/SourceExpander.Embedder.csproj" rel="nofollow noopener" target="_blank">csproj</a>に黒魔術が入り乱れます。</li>
<li>
<strong>コンパイル情報が取得できるのは強力</strong><br>
式ツリーや参照アセンブリなどをすべて取得できるので、自動生成したい何かがあるなら非常に有用です。</li>
<li>
<strong>テストを書くのが大変</strong><br>
ソースジェネレーターを作るときは「コンパイル情報を取得できるので便利」なのですが、テストでは「コンパイル情報を手動生成するのが大変」となってしまいます。せめて<code>MetadataReference</code>はUtilityが欲しいです。</li>
</ul>

<h2>
<span id="sourceexpanderの今後の展望" class="fragment"></span><a href="#sourceexpander%E3%81%AE%E4%BB%8A%E5%BE%8C%E3%81%AE%E5%B1%95%E6%9C%9B"><i class="fa fa-link"></i></a>SourceExpanderの今後の展望</h2>

<ul>
<li>ジェネレーター用の設定ファイルに対応する

<ul>
<li>
<code>SourceExpander.EmbeddedSourceCode</code> と <code>SourceExpander.EmbeddedSourceCode.GZipBase32768</code> を出し分ける</li>
<li>埋め込むソースコードを差し替えられるようにする</li>
<li>展開するソースコードをホワイトリスト化する</li>
</ul>
</li>
</ul>

<p>などを検討しています。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fnaminodarie%2Fitems%2Fbd15dfeedd48925fda54&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fnaminodarie%2Fitems%2Fbd15dfeedd48925fda54&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/naminodarie/items/bd15dfeedd48925fda54/likers" class="css-1iupg5d">5</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">3</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/bd15dfeedd48925fda54/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/naminodarie/items/bd15dfeedd48925fda54/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/naminodarie/items/bd15dfeedd48925fda54/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/naminodarie/items/bd15dfeedd48925fda54/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/naminodarie/items/bd15dfeedd48925fda54.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-e5579689-0373-417a-9748-c0ad8eb5ca23">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-5c838e3e-c0e0-4c7b-882e-71b46c96709a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-5c838e3e-c0e0-4c7b-882e-71b46c96709a">{}</script>
      
<div id="LoginModal-react-component-d72afe49-7c93-4c5c-bb99-b4a38c5917f0"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-d72afe49-7c93-4c5c-bb99-b4a38c5917f0">{}</script>
      
<div id="StockModal-react-component-b748fd67-86f0-4b0f-815d-e21ddd0783f6"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-b748fd67-86f0-4b0f-815d-e21ddd0783f6">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;3YQQAbn3Zy/xFuO8CsFO4hDkqUvnGALc9LdJCc7TLL7CGQmiNePdZk2IsrWoo+QXcPuJDzQPC3qmBspFtAFvuw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e本記事は\u003ca href=\"https://qiita.com/advent-calendar/2020/csharplang\"\u003eC# Advent Calendar 2020\u003c/a\u003eの5日目の記事です。\u003c/p\u003e\n\n\u003cp\u003e競技プログラミング用ライブラリについての記事ですが、競技プログラミングの記事ではなく\u003cstrong\u003eソースジェネレーター開発記事\u003c/strong\u003eです。\u003cbr\u003e\n競技プログラミングのテクニックや知識については記述していません。あらかじめご了承ください。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"従来の競技プログラミング用ライブラリの課題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BE%93%E6%9D%A5%E3%81%AE%E7%AB%B6%E6%8A%80%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E7%94%A8%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E8%AA%B2%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e従来の競技プログラミング用ライブラリの課題\u003c/h1\u003e\n\n\u003cp\u003e通常のC#開発では、NuGetからダウンロードするだけでライブラリを扱うことができます。\u003c/p\u003e\n\n\u003cp\u003eしかし、単一のソースコードを提出する競技プログラミングにおいては、ライブラリへの参照を提出できないため、ライブラリのソースコードを提出ファイルにコピペする必要があります。\u003c/p\u003e\n\n\u003cp\u003eこれではNuGet配布もできませんし、依存関係も含めてコピペが必要となり非常に扱いづらくなってしまいます。\u003c/p\u003e\n\n\u003cp\u003eそれを解決するためライブラリ \u003ca href=\"https://github.com/naminodarie/SourceExpander\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSourceExpander\u003c/a\u003e を作成しました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ac-library-csharp\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ac-library-csharp\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ca href=\"https://github.com/naminodarie/ac-library-csharp\" rel=\"nofollow noopener\" target=\"_blank\"\u003eac-library-csharp\u003c/a\u003e\n\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://atcoder.jp/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAtCoder\u003c/a\u003eで使用できるC++用のライブラリ \u003ca href=\"https://github.com/atcoder/ac-library/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eac-library\u003c/a\u003e の移植プロジェクトの\u003ca href=\"https://github.com/key-moon/ac-library-cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eac-library-cs\u003c/a\u003eからフォークして\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/naminodarie/ac-library-csharp\" rel=\"nofollow noopener\" target=\"_blank\"\u003eac-library-csharp\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eを作成しました。\u003c/p\u003e\n\n\u003cp\u003eこのライブラリでは、\u003ca href=\"https://github.com/naminodarie/SourceExpander\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSourceExpander\u003c/a\u003e を使用することで下記の動作を実現しています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"成果物\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%88%90%E6%9E%9C%E7%89%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e成果物\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eInstall-Package SourceExpander\nInstall-Package ac-library-csharp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eでNuGetからインストールして、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eProgram.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eAtCoder\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSourceExpander\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExpander\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExpand\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// https://atcoder.jp/contests/practice2/tasks/practice2_a\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e' '\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eQ\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edsu\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDSU\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eQ\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e' '\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eu\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003edsu\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMerge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edsu\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eを実行すると、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCombined.csx\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eAtCoder\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eAtCoder.Internal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Diagnostics\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eSourceExpander\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExpander\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExpand\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// https://atcoder.jp/contests/practice2/tasks/practice2_a\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e' '\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eQ\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edsu\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDSU\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eQ\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e' '\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eu\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003edsu\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMerge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edsu\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#region Expanded\n\u003c/span\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eAtCoder\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDSU\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003e_n\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eDSU\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003e_n\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e \u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003eMerge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eDebugUtil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_n\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"n\"\u003eDebugUtil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_n\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(-\u003c/span\u003e\u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e \u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eSame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eDebugUtil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_n\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"n\"\u003eDebugUtil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_n\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e]]);\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003eSize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eDebugUtil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_n\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eLeader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)];\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003e]\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGroups\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eleaderBuf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003e_n\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003e_n\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003e]\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_n\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eleaderBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eleaderBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eleaderBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[-\u003c/span\u003e\u003cspan class=\"n\"\u003e_parentOrSize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]]);\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eind\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eleaderBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eleaderID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eleaderBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]];\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eleaderID\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"n\"\u003eind\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eleaderID\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003eind\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eleaderID\u003c/span\u003e\u003cspan class=\"p\"\u003e]++;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSourceExpander\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eExpander\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eConditional\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"EXPANDER\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eExpand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003einputFilePath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eoutputFilePath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eignoreAnyError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eExpandString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003einputFilePath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eignoreAnyError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eAtCoder.Internal\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDebugUtil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eConditional\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"DEBUG\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003econdition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ereason\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003econdition\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDebugAssertException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereason\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eConditional\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"DEBUG\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003econditionFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ereason\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"nf\"\u003econditionFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDebugAssertException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereason\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eAtCoder.Internal\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDebugAssertException\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eDebugAssertException\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eDebugAssertException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eDebugAssertException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003einnerException\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einnerException\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n\u003cspan class=\"cp\"\u003e#endregion Expanded\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eとライブラリのソースコードと合体したソースコードが出力されます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/naminodarie/ac-library-csharp/tree/master/Sample.Usage\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSample Project\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"sourceexpander\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sourceexpander\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ca href=\"https://github.com/naminodarie/SourceExpander\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSourceExpander\u003c/a\u003e\n\u003c/h1\u003e\n\n\u003cp\u003eソースジェネレーターを使ってソースコードの埋め込み・利用を行うライブラリです。ac-library-csharpに限らず、ソースコードを埋め込みたいライブラリがあるならば使用できます。\u003c/p\u003e\n\n\u003cp\u003e大きく3つのパッケージに分かれています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://www.nuget.org/packages/SourceExpander.Embedder/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSourceExpander.Embedder\u003c/a\u003e\u003cbr\u003e\n競技プログラミングライブラリにソースコードを埋め込むためのソースジェネレーター。ライブラリ開発者向け。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://www.nuget.org/packages/SourceExpander.Generator/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSourceExpander.Generator\u003c/a\u003e\u003cbr\u003e\n埋め込まれたソースコードを展開するソースジェネレーター。ライブラリ利用者向け。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://www.nuget.org/packages/SourceExpander/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSourceExpander\u003c/a\u003e\u003cbr\u003e\nSourceExpander.Generatorが展開したコードを読み取るライブラリ。ライブラリ利用者向け。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e以下、それぞれについて解説します。ソースジェネレーターを作成する際は公式のドキュメントが非常に参考になるので合わせて見ることを推奨します。\u003cbr\u003e\n\u003ca href=\"https://github.com/dotnet/roslyn/blob/master/docs/features/source-generators.cookbook.md\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/dotnet/roslyn/blob/master/docs/features/source-generators.cookbook.md\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"sourceexpanderembedder\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sourceexpanderembedder\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSourceExpander.Embedder\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Reflection\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eAssemblyMetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SourceExpander.EmbedderVersion\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"2.2.0.101\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eAssemblyMetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SourceExpander.EmbeddedLanguageVersion\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eAssemblyMetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SourceExpander.EmbeddedAllowUnsafe\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"true\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eAssemblyMetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SourceExpander.EmbeddedSourceCode.GZipBase32768\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"㘅桠ҠҠԀᏕ䴾阺㹈斪筟楸厮嫉盆炚磈臤梽胍㦬竂帙詪煩㔬樄ᗗ踜鲯诇ᠩ珱䪜䐽闾鱏珣茙灸䏙⨧㤄寨砳⬅ស䮙松Ꝉ㥅䱀餯ꃣ虱嫁榏㪰糰蝃技夛䥘谼礞䐿斄禕蚷屔彺㪪賳鱥䝢鰨覶⬴誼⬼獬鞨胒宝䭴摺眚䅗䃝䚏隻嫻痛簴Ꜿ変⇣㇋聼欈Ꭽ墷霶勎嶐窢銖㤁┠䁺⠛缧䋹凬☂䁸栣僼邐䑹瘜蛭諠賿㨚咈鍂ꄱ禱唨毊崨叼緭䥜榄闺䦖麷䘘㨵ᖶ琜鎎ᰇ髎飭㪬採ꅈ㥞盧䢽䃘煃⬘喔渻莖案ᯋ硟ꋛ叝谴缄ꍢ⋗溁ᣒ颂浢ꍈꉭ㑆焤鹠杳煄㾳䴡䂱㙽楯裦鷬梙掫取颤⩑㰑㕋ꂤ碎麓㾕昖啘繅餬簚盎鍣䨽籭詽绑襌硲❞擧ꌥ膩辪聫㭒珥㴟囓䓖焜铽痢ꊆꍼᓥ囦纇維Ⲡ㤬垇螇感縋㼎砾褳強襓瀕樥阵瀭蜺兔峃絻藈萢饑㶬櫊綖嶅鏕㻶坶禵䓓Ⴐ咇詤煑⬐毱㱒獅鐥椳䖑ᙋ冄㴼㗭隯顑命貽职葅苫⢸栚䀹䢳噂槝䲰䰮⇷ᔈ⎙䕪絑㝖垿䞉場珟䉛㰭䵶日憭蕼馣㸩涴䓋䃇懚鹯琥镌ⴊ電萞猛流癊⏔恚Ԉң\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//[assembly: AssemblyMetadata(\"SourceExpander.EmbeddedSourceCode\", \"[{\\\"CodeBody\\\":\\\"namespace SampleLibrary { public static class Bit { [MethodImpl(MethodImplOptions.AggressiveInlining)] public static int ExtractLowestSetBit(int n) { if (Bmi1.IsSupported) { return (int)Bmi1.ExtractLowestSetBit((uint)n); } return n \u0026amp; -n; } } } \\\",\\\"Dependencies\\\":[],\\\"FileName\\\":\\\"_SampleLibrary\u0026gt;Bit.cs\\\",\\\"TypeNames\\\":[\\\"SampleLibrary.Bit\\\"],\\\"Usings\\\":[\\\"using System.Runtime.CompilerServices;\\\",\\\"using System.Runtime.Intrinsics.X86;\\\"]},{\\\"CodeBody\\\":\\\"namespace SampleLibrary { public static class Put { private static readonly Xorshift rnd = new Xorshift(); public static void WriteRandom() { Trace.WriteLine(rnd.Next()); } } } \\\",\\\"Dependencies\\\":[\\\"_SampleLibrary\u0026gt;Xorshift.cs\\\"],\\\"FileName\\\":\\\"_SampleLibrary\u0026gt;Put.cs\\\",\\\"TypeNames\\\":[\\\"SampleLibrary.Put\\\"],\\\"Usings\\\":[\\\"using System.Diagnostics;\\\"]},{\\\"CodeBody\\\":\\\"namespace SampleLibrary { public class Xorshift : Random { private uint x = 123456789; private uint y = 362436069; private uint z = 521288629; private uint w; private static readonly Random rnd = new Random(); public Xorshift() : this(rnd.Next()) { } public Xorshift(int seed) { w = (uint)seed; } protected override double Sample() { return InternalSample() * (1.0 \\\\/ uint.MaxValue); } private uint InternalSample() { uint t = x ^ (x \u0026lt;\u0026lt; 11); x = y; y = z; z = w; return w = (w ^ (w \u0026gt;\u0026gt; 19)) ^ (t ^ (t \u0026gt;\u0026gt; 8)); } } } \\\",\\\"Dependencies\\\":[],\\\"FileName\\\":\\\"_SampleLibrary\u0026gt;Xorshift.cs\\\",\\\"TypeNames\\\":[\\\"SampleLibrary.Xorshift\\\"],\\\"Usings\\\":[\\\"using System;\\\"]}]\")]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとソースコード情報を \u003ccode\u003eAssemblyMetadataAttribute\u003c/code\u003e で埋め込みます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"埋め込む情報\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80%E6%83%85%E5%A0%B1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e埋め込む情報\u003c/h3\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"embedderversion\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#embedderversion\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEmbedderVersion\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003eAssembly.GetExecutingAssembly().GetName().Version\u003c/code\u003eで取得できる\u003ccode\u003eSourceExpander.Embedder\u003c/code\u003eのAssemblyVersion。\u003cbr\u003e\nライブラリでソースコード埋め込みに使用したSourceExpanderのバージョンがライブラリ利用側のバージョンより低い場合に警告を出すなどの用途に使用します。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"embeddedlanguageversion\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#embeddedlanguageversion\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEmbeddedLanguageVersion\u003c/h4\u003e\n\n\u003cp\u003eライブラリのC#バージョン。\u003cbr\u003e\nライブラリ利用側のバージョンがこれより低い場合に警告を出すなどの用途に使用します。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"embeddedallowunsafe\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#embeddedallowunsafe\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEmbeddedAllowUnsafe\u003c/h4\u003e\n\n\u003cp\u003eライブラリが\u003ccode\u003eunsafe\u003c/code\u003eを許可してビルドされている場合はtrueが設定されます。\u003cbr\u003e\nライブラリ利用側が\u003ccode\u003eunsafe\u003c/code\u003eを許可していない場合に警告を出すなどの用途に使用します。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"embeddedsourcecode\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#embeddedsourcecode\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEmbeddedSourceCode\u003c/h4\u003e\n\n\u003cp\u003e上記の例ではコメントアウトしていますが、\u003ccode\u003eSourceExpander.EmbeddedSourceCode.GZipBase32768\u003c/code\u003eと対応しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSourceFileInfo\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// ファイルの固有名\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eFileName\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// ファイル内で定義されているclass, struct, enum, delegate\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeNames\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// ファイル先頭のusingディレクティブ\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eUsings\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// ファイルが依存している先のFileName\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDependencies\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// usingディレクティブを除いたコード本体\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eCodeBody\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのような型の配列を埋め込んでいます。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"embeddedsourcecodegzipbase32768\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#embeddedsourcecodegzipbase32768\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEmbeddedSourceCode.GZipBase32768\u003c/h4\u003e\n\n\u003cp\u003e例で示した\u003ccode\u003eSourceExpander.EmbeddedSourceCode.GZipBase32768\u003c/code\u003eは\u003ccode\u003eSourceExpander.EmbeddedSourceCode\u003c/code\u003eのJSONと同等の情報を保持しています。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eJSONを作成\u003c/li\u003e\n\u003cli\u003eJSONをUTF-8で\u003ccode\u003ebyte[]\u003c/code\u003eに変換\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ebyte[]\u003c/code\u003eを\u003ccode\u003eSystem.IO.Compression.GZipStream\u003c/code\u003eでgzip圧縮\u003c/li\u003e\n\u003cli\u003egzip圧縮されたバイナリデータをBase32768で文字列化\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eとしたものを埋め込んでいます。\u003c/p\u003e\n\n\u003cp\u003eこれを採用することで埋め込む文字列のサイズを1/10程度まで圧縮できました(ac-library-csharpの場合)。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003e埋め込み形式\u003c/th\u003e\n\u003cth style=\"text-align: right\"\u003eDLLサイズ [KB]\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eソースコードを埋め込まない\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e64 KB\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eJSONを直接埋め込み\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e313 KB\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eGZip \u0026amp; Base32768で埋め込み\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e90 KB\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"base32768\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#base32768\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ebase32768\u003c/h5\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/qntm/base32768\" rel=\"nofollow noopener\" target=\"_blank\"\u003ebase32768\u003c/a\u003e はバイナリデータをUTF-16文字列に変換するアルゴリズムです。\u003c/p\u003e\n\n\u003cp\u003eC#の文字列はUTF-16であることや\u003ccode\u003eAssemblyMetadata\u003c/code\u003eに埋め込めるバイナリデータを埋め込むのに適していることから採用しました。\u003c/p\u003e\n\n\u003cp\u003eC#実装が存在しなかったので\u003ca href=\"https://github.com/naminodarie/Base32768/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e移植しました\u003c/a\u003e。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ソース情報-sourcefileinfo-の埋め込み\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9%E6%83%85%E5%A0%B1-sourcefileinfo-%E3%81%AE%E5%9F%8B%E3%82%81%E8%BE%BC%E3%81%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eソース情報 \u003ccode\u003eSourceFileInfo\u003c/code\u003e の埋め込み\u003c/h3\u003e\n\n\u003cp\u003e埋め込むための\u003ccode\u003eSourceFileInfo\u003c/code\u003eを作成する流れについて説明します。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eGeneratorExecutionContext\u003c/code\u003e(ソースジェネレーターに渡される引数)の\u003ccode\u003eCompilation\u003c/code\u003e(コンパイル情報)に含まれる\u003ccode\u003eSyntaxTrees\u003c/code\u003eが埋め込まれるソースコードの本体になります。\u003c/p\u003e\n\n\u003cp\u003eつまり、\u003ccode\u003eMicrosoft.CodeAnalysis.SyntaxTree\u003c/code\u003eが\u003ccode\u003eSourceFileInfo\u003c/code\u003eに対応します。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"filenameの生成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#filename%E3%81%AE%E7%94%9F%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eFileName\u003c/code\u003eの生成\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003eSyntaxTree\u003c/code\u003eは\u003ccode\u003eFilePath\u003c/code\u003eプロパティでファイルのパスを取得できるのでそれを使用します。\u003c/p\u003e\n\n\u003cp\u003e入力される\u003ccode\u003eSyntaxTree\u003c/code\u003eが1つの場合はディレクトリ名を削除したもの、2つ以上の場合は最も上位の共通祖先ディレクトリまでを削除したものをファイル名とします。\u003c/p\u003e\n\n\u003cp\u003eそして、それぞれのファイル名にアセンブリ名を合わせて\u003ccode\u003e{アセンブリ名}\u0026gt;{ファイル名}\u003c/code\u003eとしたものが\u003ccode\u003eFileName\u003c/code\u003eプロパティの値になります。\u003c/p\u003e\n\n\u003cp\u003e例：\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eD:\\Sources\\TestProject\\\n├─── TestProject.csproj\n├─── Root.cs\n└─── Extra\\\n      └───Ext.cs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eというファイル構成ならば、埋め込まれるファイルの\u003ccode\u003eFileName\u003c/code\u003eプロパティは\u003ccode\u003eTestProject\u0026gt;Root.cs\u003c/code\u003e, \u003ccode\u003eTestProject\u0026gt;Extra\\Ext.cs\u003c/code\u003eになります。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"typenamesの生成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#typenames%E3%81%AE%E7%94%9F%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eTypeNames\u003c/code\u003eの生成\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esemanticModel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCompilation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetSemanticModel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSyntaxTree\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eSyntaxTree\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetRoot\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eDescendantNodes\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003eBaseTypeDeclarationSyntax\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003eDelegateDeclarationSyntax\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esyntax\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esemanticModel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDeclaredSymbol\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esyntax\u003c/span\u003e\u003cspan class=\"p\"\u003e)?.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToDisplayString\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOfType\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDistinct\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eで取得します。\u003c/p\u003e\n\n\u003cp\u003e各操作の説明\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eCompilation.GetSemanticModel(SyntaxTree, true)\u003c/code\u003e\u003cbr\u003e\n\u003ccode\u003eSemanticModel\u003c/code\u003eはコンパイル情報から詳細な情報を取得できるものです\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eSyntaxTree.GetRoot().DescendantNodes()\u003c/code\u003e\u003cbr\u003e\n\u003ccode\u003eDescendantNodes\u003c/code\u003eで式ツリーに含まれる\u003ccode\u003eSyntaxNode\u003c/code\u003eを列挙します\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eBaseTypeDeclarationSyntax\u003c/code\u003e, \u003ccode\u003eDelegateDeclarationSyntax\u003c/code\u003e\u003cbr\u003e\n\u003ccode\u003eBaseTypeDeclarationSyntax\u003c/code\u003eならばclass, struct, enum, recordの定義、\u003ccode\u003eDelegateDeclarationSyntax\u003c/code\u003eならばdelegateの定義です\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003esemanticModel.GetDeclaredSymbol(syntax)\u003c/code\u003e\u003cbr\u003e\n型定義の詳細情報を取得します。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"syntaxnodeから取得できる情報とgetdeclaredsymbolから取得できる情報の違い\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#syntaxnode%E3%81%8B%E3%82%89%E5%8F%96%E5%BE%97%E3%81%A7%E3%81%8D%E3%82%8B%E6%83%85%E5%A0%B1%E3%81%A8getdeclaredsymbol%E3%81%8B%E3%82%89%E5%8F%96%E5%BE%97%E3%81%A7%E3%81%8D%E3%82%8B%E6%83%85%E5%A0%B1%E3%81%AE%E9%81%95%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eSyntaxNode\u003c/code\u003eから取得できる情報と\u003ccode\u003eGetDeclaredSymbol\u003c/code\u003eから取得できる情報の違い\u003c/h5\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSpace\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFoo\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eというコードがある場合は\u003ccode\u003eFoo\u003c/code\u003eの部分が\u003ccode\u003eSyntaxNode\u003c/code\u003eです。namespaceの情報などは含まれません。\u003c/p\u003e\n\n\u003cp\u003e一方、\u003ccode\u003eGetDeclaredSymbol\u003c/code\u003eでは\u003ccode\u003eFoo\u003c/code\u003eの\u003ccode\u003eSyntaxNode\u003c/code\u003eが\u003ccode\u003eSpace.Foo\u003c/code\u003eという型情報を持っていることを取得できます。\u003c/p\u003e\n\n\u003cp\u003eそのためSymbolが必要です。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"usingsの生成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#usings%E3%81%AE%E7%94%9F%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eUsings\u003c/code\u003eの生成\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003eSyntaxTree.GetRoot()\u003c/code\u003eは実際には\u003ccode\u003eCompilationUnitSyntax\u003c/code\u003e型です。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eCompilationUnitSyntax\u003c/code\u003eは\u003ccode\u003eUsings\u003c/code\u003eプロパティでusingディレクティブの定義が取得できるのでそこから取得できます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eroot\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCompilationUnitSyntax\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003etree\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetRoot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellationToken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eusings\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eroot\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUsings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eu\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e()).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"dependenciesの生成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dependencies%E3%81%AE%E7%94%9F%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eDependencies\u003c/code\u003eの生成\u003c/h4\u003e\n\n\u003cp\u003eまずは\u003ccode\u003eSyntaxTree\u003c/code\u003eで呼び出されている型の一覧を取得します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003esemanticModel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetSymbolInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esyntaxNode\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eSymbol\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003eOriginalDefinition\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eでシンボル情報を取得します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetTypeNameFromSymbol\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eISymbol\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003esymbol\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esymbol\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esymbol\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003eINamedTypeSymbol\u003c/span\u003e \u003cspan class=\"n\"\u003enamed\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003enamed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eConstructedFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToDisplayString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esymbol\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainingType\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003eConstructedFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToDisplayString\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e??\u003c/span\u003e \u003cspan class=\"n\"\u003esymbol\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToDisplayString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eシンボル情報が何かはわかりませんが、型情報っぽいものを総当たりして呼び出されている型を列挙します。\u003c/p\u003e\n\n\u003cp\u003e大量に重複する結果が出るので\u003ccode\u003eDistinct\u003c/code\u003eしておきましょう。\u003c/p\u003e\n\n\u003cp\u003e競技プログラミング的に考えると、\u003ccode\u003eSyntaxTree\u003c/code\u003eの数を$N$として計算量が $O(N^2)$ とかになりそうでちょっと不安になりますが、$N$はせいぜい100とかなので実用上問題はなさそうです。\u003c/p\u003e\n\n\u003cp\u003e別のソース埋め込みされたライブラリへ依存がある場合もここで解決しておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ecompilation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edic\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esymbol\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecompilation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAssemblyOrModuleSymbol\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereference\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esymbol\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eattr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003esymbol\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eattr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAttributeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"System.Reflection.AssemblyMetadataAttribute\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eattr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eConstructorArguments\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eval\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eval\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e参照しているアセンブリの\u003ccode\u003eAssemblyMetadataAttribute\u003c/code\u003eはコンパイル情報から取得できます。\u003c/p\u003e\n\n\u003cp\u003eあとは埋め込んだソースコードをパースして\u003ccode\u003eSourceFileInfo\u003c/code\u003eとして扱えます。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"codebodyの生成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#codebody%E3%81%AE%E7%94%9F%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eCodeBody\u003c/code\u003eの生成\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003eSyntaxTree\u003c/code\u003eからusingディレクティブとスペースを削除したものを埋め込みます。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eCSharpSyntaxRewriter\u003c/code\u003eで削除します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMinifyRewriter\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCSharpSyntaxRewriter\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eSyntaxTrivia\u003c/span\u003e \u003cspan class=\"nf\"\u003eVisitTrivia\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSyntaxTrivia\u003c/span\u003e \u003cspan class=\"n\"\u003etrivia\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eSyntaxFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSpace\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eSyntaxNode\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"nf\"\u003eVisitUsingDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUsingDirectiveSyntax\u003c/span\u003e \u003cspan class=\"n\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsKind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSyntaxKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompilationUnit\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eVisitUsingDirective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eVisitTrivia\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eスペース、タブ、改行、コメントなどのコード本体ではない箇所をすべて半角スペース(\u003ccode\u003eSyntaxFactory.Space\u003c/code\u003e)に置き換えることでコードを圧縮します。\u003c/p\u003e\n\n\u003cp\u003e関連記事: \u003ca href=\"https://qiita.com/naminodarie/items/50468bebaf5df6969b1e\" id=\"reference-34e3118fa96220d4fe31\"\u003e【ネタ】スペースも改行も使わずC#のコードを書く\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eVisitUsingDirective\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eusingディレクティブを削除します。\u003cbr\u003e\n\u003ccode\u003enode.Parent.IsKind(SyntaxKind.CompilationUnit)\u003c/code\u003eで親がRootであることを確認しているのは、namespace内にもusingディレクティブを書くことができ、その場合は削除しないようにするためです。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"埋め込み処理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9F%8B%E3%82%81%E8%BE%BC%E3%81%BF%E5%87%A6%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e埋め込み処理\u003c/h4\u003e\n\n\u003cp\u003eC#のソースコードを生成する際には文字列リテラルとして埋め込む必要があります。\u003c/p\u003e\n\n\u003cp\u003eたとえば\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003e\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e文字列\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e文字列の値\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003e{\"foo\":\"bar\"}\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e文字列リテラル\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003e\"{\\\"foo\\\":\\\"bar\\\"}\"\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eのような感じです。\u003c/p\u003e\n\n\u003cp\u003e文字列置換で実現しても良いのですが、Roslynへの参照があるのでRoslynで文字列リテラルを生成してしまうことにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.CodeAnalysis.CSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSourceExpander\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eRoslynUtil\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eToLiteral\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eSyntaxFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLiteralExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSyntaxKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStringLiteralExpression\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSyntaxFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLiteral\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToFullString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"sourceexpandergenerator\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sourceexpandergenerator\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSourceExpander.Generator\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSourceExpander.Expanded\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eExpandedContainer\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIReadOnlyDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSourceCode\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eFiles\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003e_Files\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSourceCode\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_Files\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSourceCode\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;{\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Z:\\\\source\\\\repos\\\\SourceExpander\\\\Sample\\\\SampleProject\\\\Program.cs\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eSourceCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;{{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"path\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Z:\\\\source\\\\repos\\\\SourceExpander\\\\Sample\\\\SampleProject\\\\Program.cs\"\u003c/span\u003e\u003cspan class=\"p\"\u003e},{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"code\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"using SampleLibrary;\\r\\nusing System;\\r\\nusing System.Diagnostics;\\r\\nusing System.Runtime.CompilerServices;\\r\\nusing System.Runtime.Intrinsics.X86;\\r\\nclass Program\\r\\n{\\r\\n    static void Main()\\r\\n    {\\r\\n        SourceExpander.Expanded.ExpandedContainer.Files\\r\\n        SourceExpander.Expander.Expand(ignoreAnyError: false);\\r\\n        Put2.Write();\\r\\n        Console.WriteLine(\\\"fofao\\\");\\r\\n        Console.WriteLine(SampleLibrary.Bit.ExtractLowestSetBit(13));\\r\\n    }\\r\\n}\\r\\n#region Expanded\\r\\nnamespace SourceExpander { public class Expander { [Conditional(\\\"EXPANDER\\\")] public static void Expand(string inputFilePath = null, string outputFilePath = null, bool ignoreAnyError = true) { } public static string ExpandString(string inputFilePath = null, bool ignoreAnyError = true) { return \\\"\\\"; } } } \\r\\nnamespace SampleLibrary { public static class Bit { [MethodImpl(MethodImplOptions.AggressiveInlining)] public static int ExtractLowestSetBit(int n) { if (Bmi1.IsSupported) { return (int)Bmi1.ExtractLowestSetBit((uint)n); } return n \u0026amp; -n; } } } \\r\\nnamespace SampleLibrary { public static class Put2 { public static void Write() =\u0026gt; Put.WriteRandom(); } } \\r\\nnamespace SampleLibrary { public static class Put { private static readonly Xorshift rnd = new Xorshift(); public static void WriteRandom() { Trace.WriteLine(rnd.Next()); } } } \\r\\nnamespace SampleLibrary { public class Xorshift : Random { private uint x = 123456789; private uint y = 362436069; private uint z = 521288629; private uint w; private static readonly Random rnd = new Random(); public Xorshift() : this(rnd.Next()) { } public Xorshift(int seed) { w = (uint)seed; } protected override double Sample() { return InternalSample() * (1.0 / uint.MaxValue); } private uint InternalSample() { uint t = x ^ (x \u0026lt;\u0026lt; 11); x = y; y = z; z = w; return w = (w ^ (w \u0026gt;\u0026gt; 19)) ^ (t ^ (t \u0026gt;\u0026gt; 8)); } } } \\r\\n#endregion Expanded\\r\\n\"\u003c/span\u003e\u003cspan class=\"p\"\u003e},})},\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Z:\\\\source\\\\repos\\\\SourceExpander\\\\Sample\\\\SampleProject\\\\obj\\\\Debug\\\\netcoreapp3.1\\\\SampleProject.AssemblyInfo.cs\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eSourceCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;{{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"path\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Z:\\\\source\\\\repos\\\\SourceExpander\\\\Sample\\\\SampleProject\\\\obj\\\\Debug\\\\netcoreapp3.1\\\\SampleProject.AssemblyInfo.cs\"\u003c/span\u003e\u003cspan class=\"p\"\u003e},{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"code\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"[assembly: System.Reflection.AssemblyCompanyAttribute(\\\"naminodarie\\\")]\\r\\n[assembly: System.Reflection.AssemblyConfigurationAttribute(\\\"Debug\\\")]\\r\\n[assembly: System.Reflection.AssemblyFileVersionAttribute(\\\"2.2.0.101\\\")]\\r\\n[assembly: System.Reflection.AssemblyInformationalVersionAttribute(\\\"2.2.0\\\")]\\r\\n[assembly: System.Reflection.AssemblyProductAttribute(\\\"SampleProject\\\")]\\r\\n[assembly: System.Reflection.AssemblyTitleAttribute(\\\"SampleProject\\\")]\\r\\n[assembly: System.Reflection.AssemblyVersionAttribute(\\\"2.2.0.101\\\")]\\r\\n[assembly: System.Reflection.AssemblyMetadataAttribute(\\\"RepositoryUrl\\\", \\\"https://github.com/naminodarie/SourceExpander\\\")]\\r\\n\\r\\n// MSBuild WriteCodeFragment クラスによって生成されました。\\r\\n\\r\\n#region Expanded\\r\\n#endregion Expanded\\r\\n\"\u003c/span\u003e\u003cspan class=\"p\"\u003e},})},\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Z:\\\\source\\\\repos\\\\SourceExpander\\\\Sample\\\\SampleProject\\\\obj\\\\Debug\\\\netcoreapp3.1\\\\.NETCoreApp,Version=v3.1.AssemblyAttributes.cs\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eSourceCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;{{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"path\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Z:\\\\source\\\\repos\\\\SourceExpander\\\\Sample\\\\SampleProject\\\\obj\\\\Debug\\\\netcoreapp3.1\\\\.NETCoreApp,Version=v3.1.AssemblyAttributes.cs\"\u003c/span\u003e\u003cspan class=\"p\"\u003e},{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"code\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"using System;\\r\\nusing System.Reflection;\\r\\n[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(\\\".NETCoreApp,Version=v3.1\\\", FrameworkDisplayName = \\\"\\\")]\\r\\n#region Expanded\\r\\n#endregion Expanded\\r\\n\"\u003c/span\u003e\u003cspan class=\"p\"\u003e},})},\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eSourceCode\u003c/code\u003eクラスは SourceExpander.Core パッケージでも定義しており、その参照がある場合はその型を使い、参照がない場合は\u003ccode\u003eSourceCode\u003c/code\u003eクラスのコードも追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSourceCode\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSourceCode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eTryGet\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eval\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eval\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eval\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eSourceCode\u003c/span\u003e \u003cspan class=\"nf\"\u003eFromDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eTryGet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"path\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eTryGet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"code\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSourceCode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ePath\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eCode\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eFromDictionary\u003c/code\u003eで初期化しているのは、SourceExpander.CoreとSourceExpander.Generatorのバージョンが異なるせいでコンパイルエラーになるといったことにならないようにするためです。\u003cbr\u003e\nこうすることで、コンストラクタ引数を増やしても破壊的変更にならずにすみます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ソースコードを文字列として埋め込み\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%96%87%E5%AD%97%E5%88%97%E3%81%A8%E3%81%97%E3%81%A6%E5%9F%8B%E3%82%81%E8%BE%BC%E3%81%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eソースコードを文字列として埋め込み\u003c/h3\u003e\n\n\u003cp\u003e基本的には\u003ca href=\"#dependencies%E3%81%AE%E7%94%9F%E6%88%90\"\u003eSourceExpander.Embedder-Dependenciesの生成)\u003c/a\u003eと同じ方針です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e依存しているソースコードの情報を元のソースコードと結合する\n\n\u003cul\u003e\n\u003cli\u003eusingディレクティブは先頭にまとめる。\u003c/li\u003e\n\u003cli\u003eソースコード本体はソースコードの末尾に追記する。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"不要なusingディレクティブを削除\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%8D%E8%A6%81%E3%81%AAusing%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%82%92%E5%89%8A%E9%99%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e不要なusingディレクティブを削除\u003c/h4\u003e\n\n\u003cp\u003e存在しないnamespaceをusingしているとコンパイルエラーになってしまいます。「ソースコードは使わないが、usingは書かれている」という状況で起こりうるので対処が必要です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003especificDiagnosticOptions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eReportDiagnostic\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"CS8019\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eReportDiagnostic\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"CS0105\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eReportDiagnostic\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eopts\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecompilation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOptions\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithSpecificDiagnosticOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003especificDiagnosticOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eCompilation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecompilation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e元のコンパイル設定にかかわらず、\u003ccode\u003eCS8019\u003c/code\u003e,\u003ccode\u003eCS0105\u003c/code\u003eがエラーとなるコンパイル情報に置き換えます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003esemanticModel\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDiagnostics\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"CS8019\"\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"CS0105\"\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"CS0246\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eorigRoot\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindNode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLocation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSourceSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOfType\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUsingDirectiveSyntax\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eそうすると、不要なusingのDiagnosticsが取れるので該当するusingディレクティブの\u003ccode\u003eSyntaxNode\u003c/code\u003eを取得できます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"sourceexpander-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sourceexpander-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSourceExpander\u003c/h2\u003e\n\n\u003cp\u003eSourceExpander.Generatorで埋め込んだソースコードを出力するだけです。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eAssembly.GetCallingAssembly()\u003c/code\u003eで呼び出し元のアセンブリが取得できるので、SourceExpander.Generatorで埋め込んだで埋め込んだ\u003ccode\u003eSourceExpander.Expanded.ExpandedContainer\u003c/code\u003eをリフレクションで取得し、ファイルに書き出したり、文字列を返したりします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eexpandedContainerType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecallingAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SourceExpander.Expanded.ExpandedContainer\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexpandedContainerType\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eInvalidOperationException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Needs SourceExpander.Generator\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexpandedContainerType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Files\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003enot\u003c/span\u003e \u003cspan class=\"n\"\u003eIReadOnlyDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eExpanded\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSourceCode\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eInvalidOperationException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SourceExpander.Expanded.ExpandedContainer.Files is invalid\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"提出形式で埋め込む\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8F%90%E5%87%BA%E5%BD%A2%E5%BC%8F%E3%81%A7%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e提出形式で埋め込む\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eSourceExpander.Expander\u003c/code\u003eクラスはSourceExpander.Generatorパッケージに依存していたりと、提出できるようなソースコードにはなっていません。\u003c/p\u003e\n\n\u003cp\u003eそこで、AssemblyMetadataを直接記述して実際とは異なるダミーのソースコードを埋め込みます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Reflection\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eAssemblyMetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SourceExpander.EmbeddedSourceCode.GZipBase32768\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"㘅桠ҠҠԀስ䛺鈣㹆敪躩餸乔ጸ䆴䲻㱲鲸㡜牴邃䐀耧㗱仝幉鋥䄆㻡ꐃ谳镄籇咘頳釡臤宻邉䊪ᘥ㧯笜匒甼汼跐骔莢鰊ቼ⺷萋㖯禱羊耴劾▍痗痪燮诒颢傈釳ꅻ茥誇䤔ꆣ岎褓臚㩜䚳詢嵹滁ᔜ鞟ꃄ憐ᕥ瘕礵╢換蜱㨭㣎祇ꄃ䓴昖飊鶭鹅ꗢ澛惣㑴幂䁏妬䬈鞘應癵愌珦矖㷰礉疝嘞❖彿様㒮獬ጾᅕꆀ劶濎䛻丁䁫㩃檊剜簌滖⎘埌纼玗ꛓ喑㒀ᖀƁ\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eAssemblyMetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SourceExpander.EmbeddedLanguageVersion\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"4\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e埋め込んでいるソースコードは以下になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Diagnostics\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSourceExpander\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eExpander\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eConditional\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"EXPANDER\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eExpand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003einputFilePath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eoutputFilePath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eignoreAnyError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eExpandString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003einputFilePath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eignoreAnyError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれで提出先ではなにもしないメソッドとして扱われるため安全です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"nugetで公開するための設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nuget%E3%81%A7%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eNuGetで公開するための設定\u003c/h2\u003e\n\n\u003cp\u003eいくつか特殊な対応が必要でした。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ソースジェネレーター全般\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AC%E3%83%BC%E3%82%BF%E3%83%BC%E5%85%A8%E8%88%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eソースジェネレーター全般\u003c/h3\u003e\n\n\u003cp\u003eソースジェネレーター(およびアナライザー)をNuGetで公開する場合にはいくつか特殊な手順が必要です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"XML\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;PropertyGroup\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;IncludeBuildOutput\u0026gt;\u003c/span\u003efalse\u003cspan class=\"nt\"\u003e\u0026lt;/IncludeBuildOutput\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;IncludeSymbols\u0026gt;\u003c/span\u003efalse\u003cspan class=\"nt\"\u003e\u0026lt;/IncludeSymbols\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;TargetsForTfmSpecificContentInPackage\u0026gt;\u003c/span\u003e$(TargetsForTfmSpecificContentInPackage);PackBuildOutputs\u003cspan class=\"nt\"\u003e\u0026lt;/TargetsForTfmSpecificContentInPackage\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;GetTargetPathDependsOn\u0026gt;\u003c/span\u003e$(GetTargetPathDependsOn);GetDependencyTargetPaths\u003cspan class=\"nt\"\u003e\u0026lt;/GetTargetPathDependsOn\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;SuppressDependenciesWhenPacking\u0026gt;\u003c/span\u003etrue\u003cspan class=\"nt\"\u003e\u0026lt;/SuppressDependenciesWhenPacking\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;DevelopmentDependency\u0026gt;\u003c/span\u003etrue\u003cspan class=\"nt\"\u003e\u0026lt;/DevelopmentDependency\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/PropertyGroup\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"利用するライブラリで依存関係を公開しないようにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%A7%E4%BE%9D%E5%AD%98%E9%96%A2%E4%BF%82%E3%82%92%E5%85%AC%E9%96%8B%E3%81%97%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e利用するライブラリで依存関係を公開しないようにする\u003c/h4\u003e\n\n\u003cp\u003eNuGetに公開したときにPackageReferenceが\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"XML\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;PackageReference\u003c/span\u003e \u003cspan class=\"na\"\u003eInclude=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SourceExpander.Embedder\"\u003c/span\u003e \u003cspan class=\"na\"\u003eVersion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"2.2.0\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;PrivateAssets\u0026gt;\u003c/span\u003eall\u003cspan class=\"nt\"\u003e\u0026lt;/PrivateAssets\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;IncludeAssets\u0026gt;\u003c/span\u003eruntime; build; native; contentfiles; analyzers\u003cspan class=\"nt\"\u003e\u0026lt;/IncludeAssets\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/PackageReference\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとアナライザー用の設定になるよう、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"XML\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;DevelopmentDependency\u0026gt;\u003c/span\u003etrue\u003cspan class=\"nt\"\u003e\u0026lt;/DevelopmentDependency\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eと入れるようにします。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"他のnugetパッケージへの依存\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%96%E3%81%AEnuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%B8%E3%81%AE%E4%BE%9D%E5%AD%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e他のNuGetパッケージへの依存\u003c/h4\u003e\n\n\u003cp\u003eNuGetパッケージへの依存がある場合は、DLLをパッケージに含める必要があると公式ドキュメントにも記載があります。\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/dotnet/roslyn/blob/master/docs/features/source-generators.cookbook.md#use-functionality-from-nuget-packages\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"XML\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;ItemGroup\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;PackageReference\u003c/span\u003e \u003cspan class=\"na\"\u003eInclude=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Base32768\"\u003c/span\u003e \u003cspan class=\"na\"\u003eVersion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"1.0.5\"\u003c/span\u003e \u003cspan class=\"na\"\u003eGeneratePathProperty=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"true\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/ItemGroup\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;PropertyGroup\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;TargetsForTfmSpecificContentInPackage\u0026gt;\u003c/span\u003e$(TargetsForTfmSpecificContentInPackage);PackBuildOutputs\u003cspan class=\"nt\"\u003e\u0026lt;/TargetsForTfmSpecificContentInPackage\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;GetTargetPathDependsOn\u0026gt;\u003c/span\u003e$(GetTargetPathDependsOn);GetDependencyTargetPaths\u003cspan class=\"nt\"\u003e\u0026lt;/GetTargetPathDependsOn\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;DevelopmentDependency\u0026gt;\u003c/span\u003etrue\u003cspan class=\"nt\"\u003e\u0026lt;/DevelopmentDependency\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/PropertyGroup\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;Target\u003c/span\u003e \u003cspan class=\"na\"\u003eName=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"GetDependencyTargetPaths\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;ItemGroup\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;TargetPathWithTargetPlatformMoniker\u003c/span\u003e \u003cspan class=\"na\"\u003eInclude=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"$(PkgBase32768)\\lib\\netstandard2.0\\*.dll\"\u003c/span\u003e \u003cspan class=\"na\"\u003eIncludeRuntimeDependency=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"false\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/ItemGroup\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/Target\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"nt\"\u003e\u0026lt;Target\u003c/span\u003e \u003cspan class=\"na\"\u003eName=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"PackBuildOutputs\"\u003c/span\u003e \u003cspan class=\"na\"\u003eDependsOnTargets=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SatelliteDllsProjectOutputGroup;DebugSymbolsProjectOutputGroup\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;ItemGroup\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;TfmSpecificPackageFile\u003c/span\u003e \u003cspan class=\"na\"\u003eInclude=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"$(TargetDir)\\*.dll\"\u003c/span\u003e \u003cspan class=\"na\"\u003ePackagePath=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"analyzers\\dotnet\\\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;TfmSpecificPackageFile\u003c/span\u003e \u003cspan class=\"na\"\u003eInclude=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"$(PkgBase32768)\\lib\\netstandard2.0\\*.dll\"\u003c/span\u003e \u003cspan class=\"na\"\u003ePackagePath=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"analyzers\\dotnet\\\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;TfmSpecificPackageFile\u003c/span\u003e \u003cspan class=\"na\"\u003eInclude=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"@(SatelliteDllsProjectOutputGroupOutput-\u0026gt;'%(FinalOutputPath)')\"\u003c/span\u003e \u003cspan class=\"na\"\u003ePackagePath=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"analyzers\\dotnet\\%(SatelliteDllsProjectOutputGroupOutput.Culture)\\\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/ItemGroup\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/Target\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとしてnupkgにBase32768.dllも含まれるようにしておきます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"sourceexpanderからsourceexpandergeneratorへの依存\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sourceexpander%E3%81%8B%E3%82%89sourceexpandergenerator%E3%81%B8%E3%81%AE%E4%BE%9D%E5%AD%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSourceExpanderからSourceExpander.Generatorへの依存\u003c/h3\u003e\n\n\u003cp\u003e同一のソリューションにあるので、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"XML\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;ProjectReference\u003c/span\u003e \u003cspan class=\"na\"\u003eInclude=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"..\\SourceExpander.Generator\\SourceExpander.Generator.csproj\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eでジェネレーターとしては動作させずに、SourceExpander.Generatorへの依存だけを持たせられます。\u003c/p\u003e\n\n\u003cp\u003eこれによって、SourceExpanderを利用しているライブラリにSourceExpander.Generatorの動作を強制できます。\u003c/p\u003e\n\n\u003cp\u003eこれが別ソリューションだった場合にジェネレーターとして動作させずにパッケージの依存関係をもたせるならば、nuspecファイルを手書きする必要があります。\u003c/p\u003e\n\n\u003cp\u003exunitとxunit.analyzersの関係に近いので興味があるならば調べてみてください。\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/xunit/xunit/blob/6bc9543856f17cd69ec96e63307529edec2c60cd/src/xunit.v3.assert/xunit.v3.nuspec#L21\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"応用例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%9C%E7%94%A8%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e応用例\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/naminodarie/AtCoderProject\" rel=\"nofollow noopener\" target=\"_blank\"\u003e自作ライブラリ\u003c/a\u003eで活用しているテクニックを紹介しておきます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ビルド時にファイルを出力する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%93%E3%83%AB%E3%83%89%E6%99%82%E3%81%AB%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eビルド時にファイルを出力する\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eAtCoder\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"expand\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eSourceExpander\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExpander\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExpand\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// ソースコード\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように、引数でexpandモードだと判定したらexpandとして、そうでなければ普通に実行するようなコードにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"XML\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecsproj\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;Target\u003c/span\u003e \u003cspan class=\"na\"\u003eName=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"PostBuild\"\u003c/span\u003e \u003cspan class=\"na\"\u003eAfterTargets=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"PostBuildEvent\"\u003c/span\u003e \u003cspan class=\"na\"\u003eCondition=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"'$(Configuration)' != 'Release'\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;Exec\u003c/span\u003e \u003cspan class=\"na\"\u003eCommand=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"dotnet $(TargetPath) expand\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/Target\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003ecsprojのPostBuildでexpandモードで実行すれば、ビルド時に出力可能です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"通常時はソースコードを展開しないが明示的にビルドしたときだけ展開する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%80%9A%E5%B8%B8%E6%99%82%E3%81%AF%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%B1%95%E9%96%8B%E3%81%97%E3%81%AA%E3%81%84%E3%81%8C%E6%98%8E%E7%A4%BA%E7%9A%84%E3%81%AB%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%A0%E3%81%91%E5%B1%95%E9%96%8B%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e通常時はソースコードを展開しないが明示的にビルドしたときだけ展開する\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eAtCoder\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if EXPAND\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eSourceExpander\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExpander\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExpand\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ソースコード\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"XML\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecsproj\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;PackageReference\u003c/span\u003e \u003cspan class=\"na\"\u003eCondition=\u003c/span\u003e\u003cspan class=\"s\"\u003e\" '$(DefineConstants)' == 'EXPAND' \"\u003c/span\u003e \u003cspan class=\"na\"\u003eInclude=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SourceExpander\"\u003c/span\u003e \u003cspan class=\"na\"\u003eVersion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"2.2.0\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eと設定すれば\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003edotnet build SampleProject.csproj /p:DefineConstants=\"EXPAND\"\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように明示的に設定したビルドのときだけソースコードが展開されます。\u003c/p\u003e\n\n\u003cp\u003e別途ファイルを監視するなどすれば有効に使えるかもしれません。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h1\u003e\n\n\u003cp\u003e競技プログラミングライブラリ用のソースジェネレーターを作成してみました。\u003c/p\u003e\n\n\u003cp\u003eもし良ければ、ac-library-csharpを利用したり、自作ライブラリにSourceExpanderを組み込んだりしてみてください。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ソースジェネレーター開発で感じたこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AC%E3%83%BC%E3%82%BF%E3%83%BC%E9%96%8B%E7%99%BA%E3%81%A7%E6%84%9F%E3%81%98%E3%81%9F%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eソースジェネレーター開発で感じたこと\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003eプロジェクト参照まわりがわかりづらい\u003c/strong\u003e\u003cbr\u003e\nアナライザーでも同じなのですが、プロジェクト参照のために\u003ca href=\"https://github.com/naminodarie/SourceExpander/blob/ce337742a2b7974852a3695651c9df95821d3ffd/Source/SourceExpander.Embedder/SourceExpander.Embedder.csproj\" rel=\"nofollow noopener\" target=\"_blank\"\u003ecsproj\u003c/a\u003eに黒魔術が入り乱れます。\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eコンパイル情報が取得できるのは強力\u003c/strong\u003e\u003cbr\u003e\n式ツリーや参照アセンブリなどをすべて取得できるので、自動生成したい何かがあるなら非常に有用です。\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eテストを書くのが大変\u003c/strong\u003e\u003cbr\u003e\nソースジェネレーターを作るときは「コンパイル情報を取得できるので便利」なのですが、テストでは「コンパイル情報を手動生成するのが大変」となってしまいます。せめて\u003ccode\u003eMetadataReference\u003c/code\u003eはUtilityが欲しいです。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"sourceexpanderの今後の展望\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sourceexpander%E3%81%AE%E4%BB%8A%E5%BE%8C%E3%81%AE%E5%B1%95%E6%9C%9B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSourceExpanderの今後の展望\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eジェネレーター用の設定ファイルに対応する\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eSourceExpander.EmbeddedSourceCode\u003c/code\u003e と \u003ccode\u003eSourceExpander.EmbeddedSourceCode.GZipBase32768\u003c/code\u003e を出し分ける\u003c/li\u003e\n\u003cli\u003e埋め込むソースコードを差し替えられるようにする\u003c/li\u003e\n\u003cli\u003e展開するソースコードをホワイトリスト化する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eなどを検討しています。\u003c/p\u003e\n","createdAt":"2020-12-02T09:32:21Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"k6a0Iwa6dFaMBZRuL2xmA3lLFbktgn/1iA==--NStS0l2cxdjMuLXQ--gCBOg25X664P6v/eCeSUGg==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-12-04T22:00:43Z","likesCount":5,"linkUrl":"https://qiita.com/naminodarie/items/bd15dfeedd48925fda54","organization":null,"originalId":1348233,"stockedCount":3,"title":"【C#】ソースジェネレーターを駆使してAtCoderに提出可能なファイルを出力する競技プログラミングライブラリ","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BE%93%E6%9D%A5%E3%81%AE%E7%AB%B6%E6%8A%80%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E7%94%A8%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E8%AA%B2%E9%A1%8C\"\u003e従来の競技プログラミング用ライブラリの課題\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ac-library-csharp\"\u003eac-library-csharp\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%88%90%E6%9E%9C%E7%89%A9\"\u003e成果物\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#sourceexpander\"\u003eSourceExpander\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#sourceexpanderembedder\"\u003eSourceExpander.Embedder\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80%E6%83%85%E5%A0%B1\"\u003e埋め込む情報\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#embedderversion\"\u003eEmbedderVersion\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#embeddedlanguageversion\"\u003eEmbeddedLanguageVersion\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#embeddedallowunsafe\"\u003eEmbeddedAllowUnsafe\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#embeddedsourcecode\"\u003eEmbeddedSourceCode\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#embeddedsourcecodegzipbase32768\"\u003eEmbeddedSourceCode.GZipBase32768\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#base32768\"\u003ebase32768\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9%E6%83%85%E5%A0%B1-sourcefileinfo-%E3%81%AE%E5%9F%8B%E3%82%81%E8%BE%BC%E3%81%BF\"\u003eソース情報 SourceFileInfo の埋め込み\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#filename%E3%81%AE%E7%94%9F%E6%88%90\"\u003eFileNameの生成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#typenames%E3%81%AE%E7%94%9F%E6%88%90\"\u003eTypeNamesの生成\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#syntaxnode%E3%81%8B%E3%82%89%E5%8F%96%E5%BE%97%E3%81%A7%E3%81%8D%E3%82%8B%E6%83%85%E5%A0%B1%E3%81%A8getdeclaredsymbol%E3%81%8B%E3%82%89%E5%8F%96%E5%BE%97%E3%81%A7%E3%81%8D%E3%82%8B%E6%83%85%E5%A0%B1%E3%81%AE%E9%81%95%E3%81%84\"\u003eSyntaxNodeから取得できる情報とGetDeclaredSymbolから取得できる情報の違い\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#usings%E3%81%AE%E7%94%9F%E6%88%90\"\u003eUsingsの生成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#dependencies%E3%81%AE%E7%94%9F%E6%88%90\"\u003eDependenciesの生成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#codebody%E3%81%AE%E7%94%9F%E6%88%90\"\u003eCodeBodyの生成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%9F%8B%E3%82%81%E8%BE%BC%E3%81%BF%E5%87%A6%E7%90%86\"\u003e埋め込み処理\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#sourceexpandergenerator\"\u003eSourceExpander.Generator\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81-1\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%96%87%E5%AD%97%E5%88%97%E3%81%A8%E3%81%97%E3%81%A6%E5%9F%8B%E3%82%81%E8%BE%BC%E3%81%BF\"\u003eソースコードを文字列として埋め込み\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%B8%8D%E8%A6%81%E3%81%AAusing%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%82%92%E5%89%8A%E9%99%A4\"\u003e不要なusingディレクティブを削除\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#sourceexpander-1\"\u003eSourceExpander\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%8F%90%E5%87%BA%E5%BD%A2%E5%BC%8F%E3%81%A7%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80\"\u003e提出形式で埋め込む\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#nuget%E3%81%A7%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003eNuGetで公開するための設定\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AC%E3%83%BC%E3%82%BF%E3%83%BC%E5%85%A8%E8%88%AC\"\u003eソースジェネレーター全般\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%A7%E4%BE%9D%E5%AD%98%E9%96%A2%E4%BF%82%E3%82%92%E5%85%AC%E9%96%8B%E3%81%97%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e利用するライブラリで依存関係を公開しないようにする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%96%E3%81%AEnuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%B8%E3%81%AE%E4%BE%9D%E5%AD%98\"\u003e他のNuGetパッケージへの依存\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#sourceexpander%E3%81%8B%E3%82%89sourceexpandergenerator%E3%81%B8%E3%81%AE%E4%BE%9D%E5%AD%98\"\u003eSourceExpanderからSourceExpander.Generatorへの依存\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BF%9C%E7%94%A8%E4%BE%8B\"\u003e応用例\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%93%E3%83%AB%E3%83%89%E6%99%82%E3%81%AB%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B\"\u003eビルド時にファイルを出力する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%80%9A%E5%B8%B8%E6%99%82%E3%81%AF%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%B1%95%E9%96%8B%E3%81%97%E3%81%AA%E3%81%84%E3%81%8C%E6%98%8E%E7%A4%BA%E7%9A%84%E3%81%AB%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%A0%E3%81%91%E5%B1%95%E9%96%8B%E3%81%99%E3%82%8B\"\u003e通常時はソースコードを展開しないが明示的にビルドしたときだけ展開する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003eおわりに\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AC%E3%83%BC%E3%82%BF%E3%83%BC%E9%96%8B%E7%99%BA%E3%81%A7%E6%84%9F%E3%81%98%E3%81%9F%E3%81%93%E3%81%A8\"\u003eソースジェネレーター開発で感じたこと\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#sourceexpander%E3%81%AE%E4%BB%8A%E5%BE%8C%E3%81%AE%E5%B1%95%E6%9C%9B\"\u003eSourceExpanderの今後の展望\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":1396,"uuid":"bd15dfeedd48925fda54","banReason":null,"adventCalendarItem":{"day":5,"calendar":{"name":"C#","urlName":"csharplang","year":2020,"organization":null}},"author":{"encryptedId":"sWvkgef7lurdJGRmlFViuQxQ+SON--a1e9TVaQVXdkU6q4--u96hZqj6nO7SxK9KnVSaRw==","originalId":325052,"description":"","facebookUrl":null,"githubUrl":"https://github.com/naminodarie","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://avatars2.githubusercontent.com/u/32071278?v=4","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars2.githubusercontent.com%2Fu%2F32071278%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=12c62be23315c85279ba675045448ef3","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars2.githubusercontent.com%2Fu%2F32071278%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=f21ea7bbb9e1873e743d0b4f3ea1312c","urlName":"naminodarie","websiteUrl":"","twitterUrl":"https://twitter.com/kzlogos","twitterUrlName":"kzlogos","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"AtCoder","urlName":"atcoder"},{"name":"競技プログラミング","urlName":"%e7%ab%b6%e6%8a%80%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0"},{"name":"ソースジェネレーター","urlName":"%e3%82%bd%e3%83%bc%e3%82%b9%e3%82%b8%e3%82%a7%e3%83%8d%e3%83%ac%e3%83%bc%e3%82%bf%e3%83%bc"},{"name":"C#9.0","urlName":"c%239.0"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

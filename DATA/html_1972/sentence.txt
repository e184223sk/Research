More than 1 year has passed since last update.AudioClipを選択したとき、Inspectorウィンドウ下部に表示される波形プレビュー。
これをカスタムInspectorやEditorWindowの指定したRect内に描画したいこと、ありますよね？　私はあります。例えばAudioClipのカスタムPropertyDrawer。こんな風に波形を出して、部分ループのプレビューとかしたい。

この波形部分を描画する方法を紹介します。色も変えられます。※一部間接的にReflectionを使用、2019.2.6および2019.3.0f5で動作確認済。任意のAssetについて、プレビューテクスチャを取得するAPIは存在します。
それがこのAssetPreview.GetAssetPreview()なんですが、ダメな点がいくつか。過程に興味が無い方は飛ばしてどうぞ。まず、エディタ上でAudioClipを扱うための内部ユーティリティ、AudioUtilクラスが存在します。
内部ユーティリティなので当然公開APIではありませんが、Reflectedなラッパークラスを作ってあります。詳細はリンク先の別記事で。波形を表示するだけなら恐らく頑張ればAudioUtilなしでもできるんですが、使うと楽なので使っていきましょう。まずはUnity公式がどうAudioClipのプレビューを実装しているのか、覗きにいきましょう。Editor/Mono/Inspector/AudioClipInspector.cs160行目あたりにそれらしきものが見つかります。つまり、AudioCurveRendering.DrawMinMaxFilledCurve()というAPIが用意されていて、波形の内容を定義するためのデリゲートであるAudioCurveRendering.AudioMinMaxCurveAndColorEvaluatorでコールバックを生成してRectと一緒に渡していると。
そして嬉しいことに、これらは公開APIなのでReflectionしなくて済みます。DoRenderPreviewメソッド、引数が５つもあります。AudioImporterが使われているのはこの部分のみです。出ましたAudioUtil。表示に使うデータはAudioImporterが持っているようです。ところでAudioClipにはGetData()というpublicメソッドがあります。
これを使えばAudioUtilに頼らずAudioClipだけでいけるんじゃないかと思い試してみましたが、ダメでした。
ちゃんとキャッシングしないと重すぎて動かないのはともかく、吐き出されるデータもGetMinMaxData()とは形式が違います。AudioMinMaxCurveAndColorEvaluatorのout Color colに渡せばよさそうです。
デフォルトでは何が渡っているのかといえば、決め打ちのnew Color(1.0f, 140.0f / 255.0f, 0.0f, 1.0f)。
グラデーションをつけたり、振幅に合わせて色を変えたりしたい。楽しいので。というわけで、色替え用デリゲートを用意しました。ここまでの情報をもとに実装したのがこちら。
※別の記事で作ったInternalAudioUtilクラスを前提にしています。
　InternalAudioUtilクラス内に実装しちゃってもいいんじゃないでしょうか。今回作成した波形表示APIを使ってAudioClipのカスタムPropertyDrawerを簡単に作ってみました。
↓AudioClipをInspector上に表示する際にこんな感じになります。

Attributeにはしていません。
お好みで色を変えたり、AudioUtil等で再生機能をつけたりしてどうぞ。※このコードはRenderPreview()をInternalAudioUtilクラス内に定義している前提で書かれています。
　必要に応じて適当に書き換えてください。



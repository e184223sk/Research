2018年からサーバーリプレース作業（Windows Server 2008R2 → Windows Server 2016）でデータベースを Oracle 11g から PostgreSQL 9.6 に移行作業をしました。PostgreSQL 9.6 のサポート終了期限が 2021年11月となっているため、PostgreSQL 12 に移行する準備を進めています。
最新のPostgreSQL 13 にしないのは、現時点(2021/04/18)で某N社のサポートがPostgreSQL 12 までだからです。20近くの既存アプリケーションのSQLを抜き出して、PostgreSQL 9.6とPostgreSQL 12で性能検証をする必要があります。1000近くのSQLがあるため、プログラムを組んで自動で性能検証をしたいと考えました。自動でやるためには、登録・更新・削除するデータをDB上から抜き出し、該当のSQLに抽出条件や登録・更新データのパラメーターとして当てはめて実行したいのです。当初は正規表現を多様してSQLを解析しようと考えていたのですが、他言語でSQL文を構文解析するという記事を見つけて、それならC#版でも似たようなのがあるだろうと、NuGetで見つけたのが「TSQL Parser」になります。オンライン上でC#のコードを簡単に試せる「.NET Fiddle」を初めて使用してみました。
他のC#オンラインエディタと違って、NuGet Packageを指定することで「TSQL.Parser」を使用できます。ちなみにまだ研究中です。
PostgreSQLのNpgsqlのプレースホルダーは「: (コロン)」なのですが、TSQL Parserで変数として認識させるなら「@」に置き換えるとか必要かも知れません。実は開発はこれからなので、何か気付いたことがあれば追記していきます。


